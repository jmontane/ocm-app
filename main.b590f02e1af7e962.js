(self.webpackChunkapp=self.webpackChunkapp||[]).push([[179],{4244:(An,vt,k)=>{"use strict";k.d(vt,{N0:()=>g,Ar:()=>ge});var b=k(6738),d=k(6895),pe=k(1709),l=k(5254),J=k(529);const j=new b.OlP("JWT_OPTIONS");let g=(()=>{class Q{constructor(se=null){this.tokenGetter=se&&se.tokenGetter||function(){}}urlBase64Decode(se){let ue=se.replace(/-/g,"+").replace(/_/g,"/");switch(ue.length%4){case 0:break;case 2:ue+="==";break;case 3:ue+="=";break;default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(ue)}b64decode(se){let ye="";if((se=String(se).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let Ee,We,xe=0,be=0;We=se.charAt(be++);~We&&(Ee=xe%4?64*Ee+We:We,xe++%4)?ye+=String.fromCharCode(255&Ee>>(-2*xe&6)):0)We="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(We);return ye}b64DecodeUnicode(se){return decodeURIComponent(Array.prototype.map.call(this.b64decode(se),ue=>"%"+("00"+ue.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(se=this.tokenGetter()){if(!se||""===se)return null;const ue=se.split(".");if(3!==ue.length)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");const ye=this.urlBase64Decode(ue[1]);if(!ye)throw new Error("Cannot decode the token.");return JSON.parse(ye)}getTokenExpirationDate(se=this.tokenGetter()){let ue;if(ue=this.decodeToken(se),!ue||!ue.hasOwnProperty("exp"))return null;const ye=new Date(0);return ye.setUTCSeconds(ue.exp),ye}isTokenExpired(se=this.tokenGetter(),ue){if(!se||""===se)return!0;const ye=this.getTokenExpirationDate(se);return ue=ue||0,null!==ye&&!(ye.valueOf()>(new Date).valueOf()+1e3*ue)}getAuthScheme(se,ue){return"function"==typeof se?se(ue):se}}return Q.\u0275fac=function(se){return new(se||Q)(b.LFG(j))},Q.\u0275prov=b.Yz7({token:Q,factory:Q.\u0275fac}),Q})(),ne=(()=>{class Q{constructor(se,ue,ye){this.jwtHelper=ue,this.document=ye,this.standardPorts=["80","443"],this.tokenGetter=se.tokenGetter,this.headerName=se.headerName||"Authorization",this.authScheme=se.authScheme||""===se.authScheme?se.authScheme:"Bearer ",this.allowedDomains=se.allowedDomains||[],this.disallowedRoutes=se.disallowedRoutes||[],this.throwNoTokenError=se.throwNoTokenError||!1,this.skipWhenExpired=se.skipWhenExpired}isAllowedDomain(se){const ue=new URL(se.url,this.document.location.origin);if(ue.host===this.document.location.host)return!0;const ye=`${ue.hostname}${ue.port&&!this.standardPorts.includes(ue.port)?":"+ue.port:""}`;return this.allowedDomains.findIndex(xe=>"string"==typeof xe?xe===ye:xe instanceof RegExp&&xe.test(ye))>-1}isDisallowedRoute(se){const ue=new URL(se.url,this.document.location.origin);return this.disallowedRoutes.findIndex(ye=>{if("string"==typeof ye){const xe=new URL(ye,this.document.location.origin);return xe.hostname===ue.hostname&&xe.pathname===ue.pathname}return ye instanceof RegExp&&ye.test(se.url)})>-1}handleInterception(se,ue,ye){const xe=this.jwtHelper.getAuthScheme(this.authScheme,ue);let Ee=!1;if(!se&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");return this.skipWhenExpired&&(Ee=!se||this.jwtHelper.isTokenExpired(se)),se&&Ee&&this.skipWhenExpired?ue=ue.clone():se&&(ue=ue.clone({setHeaders:{[this.headerName]:`${xe}${se}`}})),ye.handle(ue)}intercept(se,ue){if(!this.isAllowedDomain(se)||this.isDisallowedRoute(se))return ue.handle(se);const ye=this.tokenGetter(se);return ye instanceof Promise?(0,l.D)(ye).pipe((0,pe.zg)(xe=>this.handleInterception(xe,se,ue))):this.handleInterception(ye,se,ue)}}return Q.\u0275fac=function(se){return new(se||Q)(b.LFG(j),b.LFG(g),b.LFG(d.K0))},Q.\u0275prov=b.Yz7({token:Q,factory:Q.\u0275fac}),Q})(),ge=(()=>{class Q{constructor(se){if(se)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(se){return{ngModule:Q,providers:[{provide:J.TP,useClass:ne,multi:!0},se.jwtOptionsProvider||{provide:j,useValue:se.config},g]}}}return Q.\u0275fac=function(se){return new(se||Q)(b.LFG(Q,12))},Q.\u0275mod=b.oAB({type:Q}),Q.\u0275inj=b.cJS({}),Q})()},7423:(An,vt,k)=>{"use strict";k.d(vt,{Uw:()=>We,fo:()=>ye});var b=k(6099);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global&&global;var ne=(()=>{return(Se=ne||(ne={})).Unimplemented="UNIMPLEMENTED",Se.Unavailable="UNAVAILABLE",ne;var Se})();class ge extends Error{constructor(ze,tt){super(ze),this.message=ze,this.code=tt}}const Y=Se=>{var ze,tt,et,Be,C;const Ge=Se.CapacitorCustomPlatform||null,_t=Se.Capacitor||{},ht=_t.Plugins=_t.Plugins||{},wt=Se.CapacitorPlatforms,gt=(null===(ze=null==wt?void 0:wt.currentPlatform)||void 0===ze?void 0:ze.getPlatform)||(()=>null!==Ge?Ge.name:(Se=>{var ze,tt;return(null==Se?void 0:Se.androidBridge)?"android":(null===(tt=null===(ze=null==Se?void 0:Se.webkit)||void 0===ze?void 0:ze.messageHandlers)||void 0===tt?void 0:tt.bridge)?"ios":"web"})(Se)),Ht=(null===(tt=null==wt?void 0:wt.currentPlatform)||void 0===tt?void 0:tt.isNativePlatform)||(()=>"web"!==gt()),It=(null===(et=null==wt?void 0:wt.currentPlatform)||void 0===et?void 0:et.isPluginAvailable)||(an=>{const Kt=Zt.get(an);return!(!(null==Kt?void 0:Kt.platforms.has(gt()))&&!Ut(an))}),Ut=(null===(Be=null==wt?void 0:wt.currentPlatform)||void 0===Be?void 0:Be.getPluginHeader)||(an=>{var Kt;return null===(Kt=_t.PluginHeaders)||void 0===Kt?void 0:Kt.find(mt=>mt.name===an)}),Zt=new Map,xn=(null===(C=null==wt?void 0:wt.currentPlatform)||void 0===C?void 0:C.registerPlugin)||((an,Kt={})=>{const mt=Zt.get(an);if(mt)return console.warn(`Capacitor plugin "${an}" already registered. Cannot register plugins twice.`),mt.proxy;const Wt=gt(),On=Ut(an);let bn;const jn=function(){var gi=(0,b.Z)(function*(){return!bn&&Wt in Kt?bn=bn="function"==typeof Kt[Wt]?yield Kt[Wt]():Kt[Wt]:null!==Ge&&!bn&&"web"in Kt&&(bn=bn="function"==typeof Kt.web?yield Kt.web():Kt.web),bn});return function(){return gi.apply(this,arguments)}}(),$i=gi=>{let Ti;const Xt=(...Oe)=>{const ae=jn().then(Re=>{const lt=((gi,Ti)=>{var Xt,Oe;if(!On){if(gi)return null===(Oe=gi[Ti])||void 0===Oe?void 0:Oe.bind(gi);throw new ge(`"${an}" plugin is not implemented on ${Wt}`,ne.Unimplemented)}{const ae=null==On?void 0:On.methods.find(Re=>Ti===Re.name);if(ae)return"promise"===ae.rtype?Re=>_t.nativePromise(an,Ti.toString(),Re):(Re,lt)=>_t.nativeCallback(an,Ti.toString(),Re,lt);if(gi)return null===(Xt=gi[Ti])||void 0===Xt?void 0:Xt.bind(gi)}})(Re,gi);if(lt){const Le=lt(...Oe);return Ti=null==Le?void 0:Le.remove,Le}throw new ge(`"${an}.${gi}()" is not implemented on ${Wt}`,ne.Unimplemented)});return"addListener"===gi&&(ae.remove=(0,b.Z)(function*(){return Ti()})),ae};return Xt.toString=()=>`${gi.toString()}() { [capacitor code] }`,Object.defineProperty(Xt,"name",{value:gi,writable:!1,configurable:!1}),Xt},rr=$i("addListener"),Bi=$i("removeListener"),_i=(gi,Ti)=>{const Xt=rr({eventName:gi},Ti),Oe=function(){var Re=(0,b.Z)(function*(){const lt=yield Xt;Bi({eventName:gi,callbackId:lt},Ti)});return function(){return Re.apply(this,arguments)}}(),ae=new Promise(Re=>Xt.then(()=>Re({remove:Oe})));return ae.remove=(0,b.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield Oe()}),ae},tr=new Proxy({},{get(gi,Ti){switch(Ti){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return On?_i:rr;case"removeListener":return Bi;default:return $i(Ti)}}});return ht[an]=tr,Zt.set(an,{name:an,proxy:tr,platforms:new Set([...Object.keys(Kt),...On?[Wt]:[]])}),tr});return _t.convertFileSrc||(_t.convertFileSrc=an=>an),_t.getPlatform=gt,_t.handleError=an=>Se.console.error(an),_t.isNativePlatform=Ht,_t.isPluginAvailable=It,_t.pluginMethodNoop=(an,Kt,mt)=>Promise.reject(`${mt} does not have an implementation of "${Kt}".`),_t.registerPlugin=xn,_t.Exception=ge,_t.DEBUG=!!_t.DEBUG,_t.isLoggingEnabled=!!_t.isLoggingEnabled,_t.platform=_t.getPlatform(),_t.isNative=_t.isNativePlatform(),_t},ue=(Se=>Se.Capacitor=Y(Se))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),ye=ue.registerPlugin;class We{constructor(ze){this.listeners={},this.windowListeners={},ze&&(console.warn(`Capacitor WebPlugin "${ze.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=ze)}addListener(ze,tt){var et=this;this.listeners[ze]||(this.listeners[ze]=[]),this.listeners[ze].push(tt);const C=this.windowListeners[ze];C&&!C.registered&&this.addWindowListener(C);const Ge=function(){var ht=(0,b.Z)(function*(){return et.removeListener(ze,tt)});return function(){return ht.apply(this,arguments)}}(),_t=Promise.resolve({remove:Ge});return Object.defineProperty(_t,"remove",{value:(ht=(0,b.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield Ge()}),function(){return ht.apply(this,arguments)})}),_t;var ht}removeAllListeners(){var ze=this;return(0,b.Z)(function*(){ze.listeners={};for(const tt in ze.windowListeners)ze.removeWindowListener(ze.windowListeners[tt]);ze.windowListeners={}})()}notifyListeners(ze,tt){const et=this.listeners[ze];et&&et.forEach(Be=>Be(tt))}hasListeners(ze){return!!this.listeners[ze].length}registerWindowListener(ze,tt){this.windowListeners[tt]={registered:!1,windowEventName:ze,pluginEventName:tt,handler:et=>{this.notifyListeners(tt,et)}}}unimplemented(ze="not implemented"){return new ue.Exception(ze,ne.Unimplemented)}unavailable(ze="not available"){return new ue.Exception(ze,ne.Unavailable)}removeListener(ze,tt){var et=this;return(0,b.Z)(function*(){const Be=et.listeners[ze];if(!Be)return;const C=Be.indexOf(tt);et.listeners[ze].splice(C,1),et.listeners[ze].length||et.removeWindowListener(et.windowListeners[ze])})()}addWindowListener(ze){window.addEventListener(ze.windowEventName,ze.handler),ze.registered=!0}removeWindowListener(ze){!ze||(window.removeEventListener(ze.windowEventName,ze.handler),ze.registered=!1)}}},7429:(An,vt,k)=>{"use strict";function J(D,N,A,re){var Rn,De=arguments.length,kt=De<3?N:null===re?re=Object.getOwnPropertyDescriptor(N,A):re;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)kt=Reflect.decorate(D,N,A,re);else for(var Xn=D.length-1;Xn>=0;Xn--)(Rn=D[Xn])&&(kt=(De<3?Rn(kt):De>3?Rn(N,A,kt):Rn(N,A))||kt);return De>3&&kt&&Object.defineProperty(N,A,kt),kt}function j(D,N){return function(A,re){N(A,re,D)}}function ne(D,N,A,re){return new(A||(A=Promise))(function(kt,Rn){function Xn(lr){try{pi(re.next(lr))}catch(so){Rn(so)}}function Wi(lr){try{pi(re.throw(lr))}catch(so){Rn(so)}}function pi(lr){lr.done?kt(lr.value):function De(kt){return kt instanceof A?kt:new A(function(Rn){Rn(kt)})}(lr.value).then(Xn,Wi)}pi((re=re.apply(D,N||[])).next())})}k.d(vt,{BX:()=>Yr,Br:()=>us,w:()=>ci,dr:()=>Pn,BJ:()=>Vn,oU:()=>Yn,cs:()=>Na,yp:()=>ni,YG:()=>Li,Sm:()=>Mi,PM:()=>di,FN:()=>En,Zi:()=>ti,wI:()=>fr,W2:()=>or,IJ:()=>wo,W4:()=>xi,zq:()=>io,fr:()=>$r,jY:()=>jr,Gu:()=>Pr,gu:()=>Cr,pK:()=>qe,Ie:()=>ct,Q$:()=>Cn,q_:()=>Un,yh:()=>St,z0:()=>on,fG:()=>Ri,zc:()=>Ur,uN:()=>Qi,I_:()=>Gi,nJ:()=>Ai,Wo:()=>Lo,jP:()=>cs,Nd:()=>Tt,VI:()=>nn,cJ:()=>ii,GO:()=>hi,t9:()=>ro,n0:()=>sr,PQ:()=>Bo,jI:()=>zi,g2:()=>oo,Bs:()=>Jo,wd:()=>Ms,ho:()=>Gr,sr:()=>Vs,Pc:()=>Vo,r4:()=>Zo,HT:()=>Uo,IN:()=>ha,SH:()=>we,X1:()=>Co,as:()=>Ii,t4:()=>Oi,YI:()=>yr,QI:()=>gr,j9:()=>Ci,yF:()=>ks});var C=k(6738),Ge=k(4006),_t=k(6895),ht=k(3334),wt=k(929),Bt=(k(8127),k(62),k(5536)),Ht=k(1597),Gn=k(9821),It=k(6536),jt=k(2307),Ut=k(9370),Yt=k(7350),Zt=(k(1497),k(5225)),Wt=k(8929),On=k(3753),bn=k(591),jn=k(3489);class $i{constructor(N,A){this.compare=N,this.keySelector=A}call(N,A){return A.subscribe(new rr(N,this.compare,this.keySelector))}}class rr extends jn.L{constructor(N,A,re){super(N),this.keySelector=re,this.hasKey=!1,"function"==typeof A&&(this.compare=A)}compare(N,A){return N===A}_next(N){let A;try{const{keySelector:De}=this;A=De?De(N):N}catch(De){return this.destination.error(De)}let re=!1;if(this.hasKey)try{const{compare:De}=this;re=De(this.key,A)}catch(De){return this.destination.error(De)}else this.hasKey=!0;re||(this.key=A,this.destination.next(N))}}var Bi=k(2198),_i=k(7545);const gi=Gn.i,Oe=["*"],Le=D=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(D):"function"==typeof requestAnimationFrame?requestAnimationFrame(D):setTimeout(D);let Rt=(()=>{class D{constructor(A,re){this.injector=A,this.el=re,this.onChange=()=>{},this.onTouched=()=>{}}writeValue(A){this.el.nativeElement.value=this.lastValue=A??"",me(this.el)}handleChangeEvent(A,re){A===this.el.nativeElement&&(re!==this.lastValue&&(this.lastValue=re,this.onChange(re)),me(this.el))}_handleBlurEvent(A){A===this.el.nativeElement&&(this.onTouched(),me(this.el))}registerOnChange(A){this.onChange=A}registerOnTouched(A){this.onTouched=A}setDisabledState(A){this.el.nativeElement.disabled=A}ngOnDestroy(){this.statusChanges&&this.statusChanges.unsubscribe()}ngAfterViewInit(){let A;try{A=this.injector.get(Ge.a5)}catch{}if(!A)return;A.statusChanges&&(this.statusChanges=A.statusChanges.subscribe(()=>me(this.el)));const re=A.control;re&&["markAsTouched","markAllAsTouched","markAsUntouched","markAsDirty","markAsPristine"].forEach(kt=>{if(re[kt]){const Rn=re[kt].bind(re);re[kt]=(...Xn)=>{Rn(...Xn),me(this.el)}}})}}return D.\u0275fac=function(A){C.$Z()},D.\u0275dir=C.lG2({type:D,hostBindings:function(A,re){1&A&&C.NdJ("ionBlur",function(kt){return re._handleBlurEvent(kt.target)})}}),J([(0,C.L6J)("ionBlur",["$event.target"])],D.prototype,"_handleBlurEvent",null),D})();const me=D=>{Le(()=>{const N=D.nativeElement,A=He(N);Qt(N,A);const re=N.closest("ion-item");re&&Qt(re,A)})},He=D=>{const N=D.classList,A=[];for(let re=0;re<N.length;re++){const De=N.item(re);null!==De&&Ki(De,"ng-")&&A.push(`ion-${De.substr(3)}`)}return A},Qt=(D,N)=>{const A=D.classList;["ion-valid","ion-invalid","ion-touched","ion-untouched","ion-dirty","ion-pristine"].forEach(re=>A.remove(re)),N.forEach(re=>A.add(re))},Ki=(D,N)=>D.substr(0,N.length)===N;var mi;let ci=mi=class extends Rt{constructor(N,A){super(N,A)}writeValue(N){this.el.nativeElement.checked=this.lastValue=N??!1,me(this.el)}_handleIonChange(N){this.handleChangeEvent(N,N.checked)}};var xr;ci.\u0275fac=function(N){return new(N||ci)(C.Y36(C.zs3),C.Y36(C.SBq))},ci.\u0275dir=C.lG2({type:ci,selectors:[["ion-checkbox"],["ion-toggle"]],hostBindings:function(N,A){1&N&&C.NdJ("ionChange",function(De){return A._handleIonChange(De.target)})},features:[C._Bn([{provide:Ge.JU,useExisting:mi,multi:!0}]),C.qOj]}),ci.ctorParameters=()=>[{type:C.zs3},{type:C.SBq}],J([(0,C.L6J)("ionChange",["$event.target"])],ci.prototype,"_handleIonChange",null);let Ii=xr=class extends Rt{constructor(N,A){super(N,A)}_handleIonChange(N){this.handleChangeEvent(N,N.value)}registerOnChange(N){super.registerOnChange(A=>{N(""===A?null:parseFloat(A))})}};var hr;Ii.\u0275fac=function(N){return new(N||Ii)(C.Y36(C.zs3),C.Y36(C.SBq))},Ii.\u0275dir=C.lG2({type:Ii,selectors:[["ion-input","type","number"]],hostBindings:function(N,A){1&N&&C.NdJ("ionChange",function(De){return A._handleIonChange(De.target)})},features:[C._Bn([{provide:Ge.JU,useExisting:xr,multi:!0}]),C.qOj]}),Ii.ctorParameters=()=>[{type:C.zs3},{type:C.SBq}],J([(0,C.L6J)("ionChange",["$event.target"])],Ii.prototype,"_handleIonChange",null);let yi=hr=class extends Rt{constructor(N,A){super(N,A)}_handleIonSelect(N){this.handleChangeEvent(N,N.checked)}};var kr;yi.\u0275fac=function(N){return new(N||yi)(C.Y36(C.zs3),C.Y36(C.SBq))},yi.\u0275dir=C.lG2({type:yi,selectors:[["ion-radio"]],hostBindings:function(N,A){1&N&&C.NdJ("ionSelect",function(De){return A._handleIonSelect(De.target)})},features:[C._Bn([{provide:Ge.JU,useExisting:hr,multi:!0}]),C.qOj]}),yi.ctorParameters=()=>[{type:C.zs3},{type:C.SBq}],J([(0,C.L6J)("ionSelect",["$event.target"])],yi.prototype,"_handleIonSelect",null);let gr=kr=class extends Rt{constructor(N,A){super(N,A)}_handleChangeEvent(N){this.handleChangeEvent(N,N.value)}};var Tr;gr.\u0275fac=function(N){return new(N||gr)(C.Y36(C.zs3),C.Y36(C.SBq))},gr.\u0275dir=C.lG2({type:gr,selectors:[["ion-range"],["ion-select"],["ion-radio-group"],["ion-segment"],["ion-datetime"]],hostBindings:function(N,A){1&N&&C.NdJ("ionChange",function(De){return A._handleChangeEvent(De.target)})},features:[C._Bn([{provide:Ge.JU,useExisting:kr,multi:!0}]),C.qOj]}),gr.ctorParameters=()=>[{type:C.zs3},{type:C.SBq}],J([(0,C.L6J)("ionChange",["$event.target"])],gr.prototype,"_handleChangeEvent",null);let Ci=Tr=class extends Rt{constructor(N,A){super(N,A)}_handleInputEvent(N){this.handleChangeEvent(N,N.value)}};Ci.\u0275fac=function(N){return new(N||Ci)(C.Y36(C.zs3),C.Y36(C.SBq))},Ci.\u0275dir=C.lG2({type:Ci,selectors:[["ion-input",3,"type","number"],["ion-textarea"],["ion-searchbar"]],hostBindings:function(N,A){1&N&&C.NdJ("ionChange",function(De){return A._handleInputEvent(De.target)})},features:[C._Bn([{provide:Ge.JU,useExisting:Tr,multi:!0}]),C.qOj]}),Ci.ctorParameters=()=>[{type:C.zs3},{type:C.SBq}],J([(0,C.L6J)("ionChange",["$event.target"])],Ci.prototype,"_handleInputEvent",null);let Oi=class{constructor(N,A){this.doc=N,this.backButton=new Wt.xQ,this.keyboardDidShow=new Wt.xQ,this.keyboardDidHide=new Wt.xQ,this.pause=new Wt.xQ,this.resume=new Wt.xQ,this.resize=new Wt.xQ,A.run(()=>{let re;this.win=N.defaultView,this.backButton.subscribeWithPriority=function(De,kt){return this.subscribe(Rn=>Rn.register(De,Xn=>A.run(()=>kt(Xn))))},L(this.pause,N,"pause"),L(this.resume,N,"resume"),L(this.backButton,N,"ionBackButton"),L(this.resize,this.win,"resize"),L(this.keyboardDidShow,this.win,"ionKeyboardDidShow"),L(this.keyboardDidHide,this.win,"ionKeyboardDidHide"),this._readyPromise=new Promise(De=>{re=De}),this.win&&this.win.cordova?N.addEventListener("deviceready",()=>{re("cordova")},{once:!0}):re("dom")})}is(N){return(0,Gn.a)(this.win,N)}platforms(){return(0,Gn.g)(this.win)}ready(){return this._readyPromise}get isRTL(){return"rtl"===this.doc.dir}getQueryParam(N){return K(this.win.location.href,N)}isLandscape(){return!this.isPortrait()}isPortrait(){return this.win.matchMedia&&this.win.matchMedia("(orientation: portrait)").matches}testUserAgent(N){const A=this.win.navigator;return!!(A&&A.userAgent&&A.userAgent.indexOf(N)>=0)}url(){return this.win.location.href}width(){return this.win.innerWidth}height(){return this.win.innerHeight}};Oi.\u0275fac=function(N){return new(N||Oi)(C.LFG(_t.K0),C.LFG(C.R0b))},Oi.\u0275prov=C.Yz7({token:Oi,factory:function(D){return Oi.\u0275fac(D)},providedIn:"root"}),Oi.ngInjectableDef=(0,C.Yz7)({factory:function(){return new Oi((0,C.LFG)(_t.K0),(0,C.LFG)(C.R0b))},token:Oi,providedIn:"root"}),Oi=J([j(0,(0,C.tBr)(_t.K0))],Oi);const K=(D,N)=>{N=N.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const re=new RegExp("[\\?&]"+N+"=([^&#]*)").exec(D);return re?decodeURIComponent(re[1].replace(/\+/g," ")):null},L=(D,N,A)=>{N&&N.addEventListener(A,re=>{D.next(null!=re?re.detail:void 0)})};let we=class{constructor(N,A,re,De){this.location=A,this.serializer=re,this.router=De,this.direction=Ct,this.animated=Je,this.guessDirection="forward",this.lastNavId=-1,De&&De.events.subscribe(kt=>{if(kt instanceof ht.OD){const Rn=kt.restoredState?kt.restoredState.navigationId:kt.id;this.guessDirection=Rn<this.lastNavId?"back":"forward",this.guessAnimation=kt.restoredState?void 0:this.guessDirection,this.lastNavId="forward"===this.guessDirection?kt.id:Rn}}),N.backButton.subscribeWithPriority(0,kt=>{this.pop(),kt()})}navigateForward(N,A={}){return this.setDirection("forward",A.animated,A.animationDirection,A.animation),this.navigate(N,A)}navigateBack(N,A={}){return this.setDirection("back",A.animated,A.animationDirection,A.animation),this.navigate(N,A)}navigateRoot(N,A={}){return this.setDirection("root",A.animated,A.animationDirection,A.animation),this.navigate(N,A)}back(N={animated:!0,animationDirection:"back"}){return this.setDirection("back",N.animated,N.animationDirection,N.animation),this.location.back()}pop(){return ne(this,void 0,void 0,function*(){let N=this.topOutlet;for(;N&&!(yield N.pop());)N=N.parentOutlet})}setDirection(N,A,re,De){this.direction=N,this.animated=Ye(N,A,re),this.animationBuilder=De}setTopOutlet(N){this.topOutlet=N}consumeTransition(){let A,N="root";const re=this.animationBuilder;return"auto"===this.direction?(N=this.guessDirection,A=this.guessAnimation):(A=this.animated,N=this.direction),this.direction=Ct,this.animated=Je,this.animationBuilder=void 0,{direction:N,animation:A,animationBuilder:re}}navigate(N,A){if(Array.isArray(N))return this.router.navigate(N,A);{const re=this.serializer.parse(N.toString());return void 0!==A.queryParams&&(re.queryParams=Object.assign({},A.queryParams)),void 0!==A.fragment&&(re.fragment=A.fragment),this.router.navigateByUrl(re,A)}}};we.\u0275fac=function(N){return new(N||we)(C.LFG(Oi),C.LFG(_t.Ye),C.LFG(ht.Hx),C.LFG(ht.F0,8))},we.\u0275prov=C.Yz7({token:we,factory:function(D){return we.\u0275fac(D)},providedIn:"root"}),we.ngInjectableDef=(0,C.Yz7)({factory:function(){return new we((0,C.LFG)(Oi),(0,C.LFG)(_t.Ye),(0,C.LFG)(ht.Hx),(0,C.LFG)(ht.F0,8))},token:we,providedIn:"root"}),we=J([j(3,(0,C.FiY)())],we);const Ye=(D,N,A)=>{if(!1!==N){if(void 0!==A)return A;if("forward"===D||"back"===D)return D;if("root"===D&&!0===N)return"forward"}},Ct="auto",Je=void 0,Lt=(D,N)=>{const A=D.prototype;N.forEach(re=>{Object.defineProperty(A,re,{get(){return this.el[re]},set(De){this.z.runOutsideAngular(()=>this.el[re]=De)}})})},en=(D,N)=>{const A=D.prototype;N.forEach(re=>{A[re]=function(){const De=arguments;return this.z.runOutsideAngular(()=>this.el[re].apply(this.el,De))}})},Gt=(D,N,A)=>{A.forEach(re=>D[re]=(0,On.R)(N,re))};function At(D){return function(A){return D.inputs&&Lt(A,D.inputs),D.methods&&en(A,D.methods),A}}let Pn=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-app"]],ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D})(),Vn=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-avatar"]],ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D})(),Yn=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-back-button"]],inputs:{color:"color",defaultHref:"defaultHref",disabled:"disabled",icon:"icon",mode:"mode",routerAnimation:"routerAnimation",text:"text",type:"type"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["color","defaultHref","disabled","icon","mode","routerAnimation","text","type"]})],D),D})(),ni=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-badge"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["color","mode"]})],D),D})(),Li=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement,Gt(this,this.el,["ionFocus","ionBlur"])}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-button"]],inputs:{buttonType:"buttonType",color:"color",disabled:"disabled",download:"download",expand:"expand",fill:"fill",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",size:"size",strong:"strong",target:"target",type:"type"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["buttonType","color","disabled","download","expand","fill","href","mode","rel","routerAnimation","routerDirection","shape","size","strong","target","type"]})],D),D})(),Mi=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-buttons"]],inputs:{collapse:"collapse"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["collapse"]})],D),D})(),di=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-card"]],inputs:{button:"button",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",target:"target",type:"type"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["button","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","target","type"]})],D),D})(),En=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-card-content"]],inputs:{mode:"mode"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["mode"]})],D),D})(),ti=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-card-header"]],inputs:{color:"color",mode:"mode",translucent:"translucent"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["color","mode","translucent"]})],D),D})(),fr=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-col"]],inputs:{offset:"offset",offsetLg:"offsetLg",offsetMd:"offsetMd",offsetSm:"offsetSm",offsetXl:"offsetXl",offsetXs:"offsetXs",pull:"pull",pullLg:"pullLg",pullMd:"pullMd",pullSm:"pullSm",pullXl:"pullXl",pullXs:"pullXs",push:"push",pushLg:"pushLg",pushMd:"pushMd",pushSm:"pushSm",pushXl:"pushXl",pushXs:"pushXs",size:"size",sizeLg:"sizeLg",sizeMd:"sizeMd",sizeSm:"sizeSm",sizeXl:"sizeXl",sizeXs:"sizeXs"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["offset","offsetLg","offsetMd","offsetSm","offsetXl","offsetXs","pull","pullLg","pullMd","pullSm","pullXl","pullXs","push","pushLg","pushMd","pushSm","pushXl","pushXs","size","sizeLg","sizeMd","sizeSm","sizeXl","sizeXs"]})],D),D})(),or=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement,Gt(this,this.el,["ionScrollStart","ionScroll","ionScrollEnd"])}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-content"]],inputs:{color:"color",forceOverscroll:"forceOverscroll",fullscreen:"fullscreen",scrollEvents:"scrollEvents",scrollX:"scrollX",scrollY:"scrollY"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["color","forceOverscroll","fullscreen","scrollEvents","scrollX","scrollY"],methods:["getScrollElement","scrollToTop","scrollToBottom","scrollByPoint","scrollToPoint"]})],D),D})(),wo=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-fab"]],inputs:{activated:"activated",edge:"edge",horizontal:"horizontal",vertical:"vertical"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["activated","edge","horizontal","vertical"],methods:["close"]})],D),D})(),xi=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement,Gt(this,this.el,["ionFocus","ionBlur"])}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-fab-button"]],inputs:{activated:"activated",closeIcon:"closeIcon",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",show:"show",size:"size",target:"target",translucent:"translucent",type:"type"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["activated","closeIcon","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","show","size","target","translucent","type"]})],D),D})(),io=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-fab-list"]],inputs:{activated:"activated",side:"side"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["activated","side"]})],D),D})(),$r=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-footer"]],inputs:{mode:"mode",translucent:"translucent"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["mode","translucent"]})],D),D})(),jr=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-grid"]],inputs:{fixed:"fixed"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["fixed"]})],D),D})(),Pr=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-header"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["collapse","mode","translucent"]})],D),D})(),Cr=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-icon"]],inputs:{ariaHidden:"ariaHidden",ariaLabel:"ariaLabel",color:"color",flipRtl:"flipRtl",icon:"icon",ios:"ios",lazy:"lazy",md:"md",mode:"mode",name:"name",sanitize:"sanitize",size:"size",src:"src"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["ariaHidden","ariaLabel","color","flipRtl","icon","ios","lazy","md","mode","name","sanitize","size","src"]})],D),D})(),qe=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement,Gt(this,this.el,["ionInput","ionChange","ionBlur","ionFocus"])}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-input"]],inputs:{accept:"accept",autocapitalize:"autocapitalize",autocomplete:"autocomplete",autocorrect:"autocorrect",autofocus:"autofocus",clearInput:"clearInput",clearOnEdit:"clearOnEdit",color:"color",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",max:"max",maxlength:"maxlength",min:"min",minlength:"minlength",mode:"mode",multiple:"multiple",name:"name",pattern:"pattern",placeholder:"placeholder",readonly:"readonly",required:"required",size:"size",spellcheck:"spellcheck",step:"step",type:"type",value:"value"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["accept","autocapitalize","autocomplete","autocorrect","autofocus","clearInput","clearOnEdit","color","debounce","disabled","enterkeyhint","inputmode","max","maxlength","min","minlength","mode","multiple","name","pattern","placeholder","readonly","required","size","spellcheck","step","type","value"],methods:["setFocus","getInputElement"]})],D),D})(),ct=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-item"]],inputs:{button:"button",color:"color",detail:"detail",detailIcon:"detailIcon",disabled:"disabled",download:"download",href:"href",lines:"lines",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",target:"target",type:"type"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["button","color","detail","detailIcon","disabled","download","href","lines","mode","rel","routerAnimation","routerDirection","target","type"]})],D),D})(),Cn=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-label"]],inputs:{color:"color",mode:"mode",position:"position"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["color","mode","position"]})],D),D})(),Un=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-list"]],inputs:{inset:"inset",lines:"lines",mode:"mode"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["inset","lines","mode"],methods:["closeSlidingItems"]})],D),D})(),St=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-list-header"]],inputs:{color:"color",lines:"lines",mode:"mode"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["color","lines","mode"]})],D),D})(),on=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement,Gt(this,this.el,["ionWillOpen","ionWillClose","ionDidOpen","ionDidClose"])}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-menu"]],inputs:{contentId:"contentId",disabled:"disabled",maxEdgeStart:"maxEdgeStart",menuId:"menuId",side:"side",swipeGesture:"swipeGesture",type:"type"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["contentId","disabled","maxEdgeStart","menuId","side","swipeGesture","type"],methods:["isOpen","isActive","open","close","toggle","setOpen"]})],D),D})(),Ri=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-menu-button"]],inputs:{autoHide:"autoHide",color:"color",disabled:"disabled",menu:"menu",mode:"mode",type:"type"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["autoHide","color","disabled","menu","mode","type"]})],D),D})(),Ur=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-menu-toggle"]],inputs:{autoHide:"autoHide",menu:"menu"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["autoHide","menu"]})],D),D})(),Qi=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-note"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["color","mode"]})],D),D})(),Gi=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement,Gt(this,this.el,["ionChange","ionFocus","ionBlur"])}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-range"]],inputs:{color:"color",debounce:"debounce",disabled:"disabled",dualKnobs:"dualKnobs",max:"max",min:"min",mode:"mode",name:"name",pin:"pin",snaps:"snaps",step:"step",ticks:"ticks",value:"value"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["color","debounce","disabled","dualKnobs","max","min","mode","name","pin","snaps","step","ticks","value"]})],D),D})(),Ai=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement,Gt(this,this.el,["ionRefresh","ionPull","ionStart"])}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-refresher"]],inputs:{closeDuration:"closeDuration",disabled:"disabled",pullFactor:"pullFactor",pullMax:"pullMax",pullMin:"pullMin",snapbackDuration:"snapbackDuration"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["closeDuration","disabled","pullFactor","pullMax","pullMin","snapbackDuration"],methods:["complete","cancel","getProgress"]})],D),D})(),Lo=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-refresher-content"]],inputs:{pullingIcon:"pullingIcon",pullingText:"pullingText",refreshingSpinner:"refreshingSpinner",refreshingText:"refreshingText"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["pullingIcon","pullingText","refreshingSpinner","refreshingText"]})],D),D})(),Tt=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-row"]],ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D})(),nn=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement,Gt(this,this.el,["ionInput","ionChange","ionCancel","ionClear","ionBlur","ionFocus"])}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-searchbar"]],inputs:{animated:"animated",autocomplete:"autocomplete",autocorrect:"autocorrect",cancelButtonIcon:"cancelButtonIcon",cancelButtonText:"cancelButtonText",clearIcon:"clearIcon",color:"color",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",mode:"mode",placeholder:"placeholder",searchIcon:"searchIcon",showCancelButton:"showCancelButton",showClearButton:"showClearButton",spellcheck:"spellcheck",type:"type",value:"value"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["animated","autocomplete","autocorrect","cancelButtonIcon","cancelButtonText","clearIcon","color","debounce","disabled","enterkeyhint","inputmode","mode","placeholder","searchIcon","showCancelButton","showClearButton","spellcheck","type","value"],methods:["setFocus","getInputElement"]})],D),D})(),ii=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement,Gt(this,this.el,["ionChange"])}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-segment"]],inputs:{color:"color",disabled:"disabled",mode:"mode",scrollable:"scrollable",swipeGesture:"swipeGesture",value:"value"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["color","disabled","mode","scrollable","swipeGesture","value"]})],D),D})(),hi=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-segment-button"]],inputs:{disabled:"disabled",layout:"layout",mode:"mode",type:"type",value:"value"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["disabled","layout","mode","type","value"]})],D),D})(),ro=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement,Gt(this,this.el,["ionChange","ionCancel","ionFocus","ionBlur"])}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-select"]],inputs:{cancelText:"cancelText",compareWith:"compareWith",disabled:"disabled",interface:"interface",interfaceOptions:"interfaceOptions",mode:"mode",multiple:"multiple",name:"name",okText:"okText",placeholder:"placeholder",selectedText:"selectedText",value:"value"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["cancelText","compareWith","disabled","interface","interfaceOptions","mode","multiple","name","okText","placeholder","selectedText","value"],methods:["open"]})],D),D})(),sr=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-select-option"]],inputs:{disabled:"disabled",value:"value"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["disabled","value"]})],D),D})(),Bo=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-spinner"]],inputs:{color:"color",duration:"duration",name:"name",paused:"paused"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["color","duration","name","paused"]})],D),D})(),zi=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement,Gt(this,this.el,["ionSplitPaneVisible"])}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-split-pane"]],inputs:{contentId:"contentId",disabled:"disabled",when:"when"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["contentId","disabled","when"]})],D),D})(),oo=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement,Gt(this,this.el,["ionChange","ionInput","ionBlur","ionFocus"])}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-textarea"]],inputs:{autoGrow:"autoGrow",autocapitalize:"autocapitalize",autofocus:"autofocus",clearOnEdit:"clearOnEdit",color:"color",cols:"cols",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",maxlength:"maxlength",minlength:"minlength",mode:"mode",name:"name",placeholder:"placeholder",readonly:"readonly",required:"required",rows:"rows",spellcheck:"spellcheck",value:"value",wrap:"wrap"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["autoGrow","autocapitalize","autofocus","clearOnEdit","color","cols","debounce","disabled","enterkeyhint","inputmode","maxlength","minlength","mode","name","placeholder","readonly","required","rows","spellcheck","value","wrap"],methods:["setFocus","getInputElement"]})],D),D})(),Jo=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-thumbnail"]],ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D})(),Ms=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-title"]],inputs:{color:"color",size:"size"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["color","size"]})],D),D})(),Gr=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement,Gt(this,this.el,["ionChange","ionFocus","ionBlur"])}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-toggle"]],inputs:{checked:"checked",color:"color",disabled:"disabled",mode:"mode",name:"name",value:"value"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["checked","color","disabled","mode","name","value"]})],D),D})(),Vs=(()=>{let D=class{constructor(A,re,De){this.z=De,A.detach(),this.el=re.nativeElement}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.R0b))},D.\u0275cmp=C.Xpm({type:D,selectors:[["ion-toolbar"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:Oe,decls:1,vars:0,template:function(A,re){1&A&&(C.F$t(),C.Hsn(0))},encapsulation:2,changeDetection:0}),D=J([At({inputs:["color","mode"]})],D),D})(),lo=class{get(N,A){const re=As();return re?re.get(N,A):null}getBoolean(N,A){const re=As();return!!re&&re.getBoolean(N,A)}getNumber(N,A){const re=As();return re?re.getNumber(N,A):0}set(N,A){console.warn("[DEPRECATION][Config]: The Config.set() method is deprecated and will be removed in Ionic Framework 6.0. Please see https://ionicframework.com/docs/angular/config for alternatives.");const re=As();re&&re.set(N,A)}};lo.\u0275fac=function(N){return new(N||lo)},lo.\u0275prov=C.Yz7({token:lo,factory:function(D){return lo.\u0275fac(D)},providedIn:"root"}),lo.ngInjectableDef=(0,C.Yz7)({factory:function(){return new lo},token:lo,providedIn:"root"});const Kr=new C.OlP("USERCONFIG"),As=()=>{if("undefined"!=typeof window){const D=window.Ionic;if(D&&D.config)return D.config}return null};class Co{constructor(N={}){this.data=N}get(N){return this.data[N]}}let No=(()=>{let D=class{constructor(A,re){this.zone=A,this.appRef=re}create(A,re,De){return new So(A,re,De,this.appRef,this.zone)}};return D.\u0275fac=function(A){return new(A||D)(C.LFG(C.R0b),C.LFG(C.z2F))},D.\u0275prov=C.Yz7({token:D,factory:function(N){return D.\u0275fac(N)}}),D})();class So{constructor(N,A,re,De,kt){this.resolver=N,this.injector=A,this.location=re,this.appRef=De,this.zone=kt,this.elRefMap=new WeakMap,this.elEventsMap=new WeakMap}attachViewToDom(N,A,re,De){return this.zone.run(()=>new Promise(kt=>{kt(Xo(this.zone,this.resolver,this.injector,this.location,this.appRef,this.elRefMap,this.elEventsMap,N,A,re,De))}))}removeViewFromDom(N,A){return this.zone.run(()=>new Promise(re=>{const De=this.elRefMap.get(A);if(De){De.destroy(),this.elRefMap.delete(A);const kt=this.elEventsMap.get(A);kt&&(kt(),this.elEventsMap.delete(A))}re()}))}}const Xo=(D,N,A,re,De,kt,Rn,Xn,Wi,pi,lr)=>{const so=N.resolveComponentFactory(Wi),Lr=C.zs3.create({providers:te(pi),parent:A}),xo=re?re.createComponent(so,re.length,Lr):so.create(Lr),Eo=xo.instance,uo=xo.location.nativeElement;if(pi&&Object.assign(Eo,pi),lr)for(const Jr of lr)uo.classList.add(Jr);const Ss=ee(D,Eo,uo);return Xn.appendChild(uo),re||De.attachView(xo.hostView),xo.changeDetectorRef.reattach(),kt.set(uo,xo),Rn.set(uo,Ss),uo},ua=[jt.L,jt.a,jt.b,jt.c,jt.d],ee=(D,N,A)=>D.run(()=>{const re=ua.filter(De=>"function"==typeof N[De]).map(De=>{const kt=Rn=>N[De](Rn.detail);return A.addEventListener(De,kt),()=>A.removeEventListener(De,kt)});return()=>re.forEach(De=>De())}),Ce=new C.OlP("NavParamsToken"),te=D=>[{provide:Ce,useValue:D},{provide:Co,useFactory:Dt,deps:[Ce]}],Dt=D=>new Co(D),Hn=(D,N)=>((D=D.filter(A=>A.stackId!==N.stackId)).push(N),D),ie=(D,N)=>{const A=D.createUrlTree(["."],{relativeTo:N});return D.serializeUrl(A)},H=(D,N)=>{if(!D)return;const A=Fe(N);for(let re=0;re<A.length;re++){if(re>=D.length)return A[re];if(A[re]!==D[re])return}},Fe=D=>D.split("/").map(N=>N.trim()).filter(N=>""!==N),dn=D=>{D&&(D.ref.destroy(),D.unlistenEvents())};class ei{constructor(N,A,re,De,kt,Rn){this.containerEl=A,this.router=re,this.navCtrl=De,this.zone=kt,this.location=Rn,this.views=[],this.skipTransition=!1,this.nextId=0,this.tabsPrefix=void 0!==N?Fe(N):void 0}createView(N,A){const re=ie(this.router,A),De=N&&N.location&&N.location.nativeElement,kt=ee(this.zone,N.instance,De);return{id:this.nextId++,stackId:H(this.tabsPrefix,re),unlistenEvents:kt,element:De,ref:N,url:re}}getExistingView(N){const A=ie(this.router,N),re=this.views.find(De=>De.url===A);return re&&re.ref.changeDetectorRef.reattach(),re}setActive(N){const A=this.navCtrl.consumeTransition();let{direction:re,animation:De,animationBuilder:kt}=A;const Rn=this.activeView,Xn=((D,N)=>!N||D.stackId!==N.stackId)(N,Rn);Xn&&(re="back",De=void 0);const Wi=this.views.slice();let pi;const lr=this.router;lr.getCurrentNavigation?pi=lr.getCurrentNavigation():lr.navigations&&lr.navigations.value&&(pi=lr.navigations.value),pi&&pi.extras&&pi.extras.replaceUrl&&this.views.length>0&&this.views.splice(-1,1);const so=this.views.includes(N),Lr=this.insertView(N,re);so||N.ref.changeDetectorRef.detectChanges();const xo=N.animationBuilder;return void 0===kt&&"back"===re&&!Xn&&void 0!==xo&&(kt=xo),Rn&&(Rn.animationBuilder=kt),this.zone.runOutsideAngular(()=>this.wait(()=>(Rn&&Rn.ref.changeDetectorRef.detach(),N.ref.changeDetectorRef.reattach(),this.transition(N,Rn,De,this.canGoBack(1),!1,kt).then(()=>Or(N,Lr,Wi,this.location)).then(()=>({enteringView:N,direction:re,animation:De,tabSwitch:Xn})))))}canGoBack(N,A=this.getActiveStackId()){return this.getStack(A).length>N}pop(N,A=this.getActiveStackId()){return this.zone.run(()=>{const re=this.getStack(A);if(re.length<=N)return Promise.resolve(!1);const De=re[re.length-N-1];let kt=De.url;const Rn=De.savedData;if(Rn){const Wi=Rn.get("primary");Wi&&Wi.route&&Wi.route._routerState&&Wi.route._routerState.snapshot&&Wi.route._routerState.snapshot.url&&(kt=Wi.route._routerState.snapshot.url)}const{animationBuilder:Xn}=this.navCtrl.consumeTransition();return this.navCtrl.navigateBack(kt,Object.assign({},De.savedExtras,{animation:Xn})).then(()=>!0)})}startBackTransition(){const N=this.activeView;if(N){const A=this.getStack(N.stackId),re=A[A.length-2],De=re.animationBuilder;return this.wait(()=>this.transition(re,N,"back",this.canGoBack(2),!0,De))}return Promise.resolve()}endBackTransition(N){N?(this.skipTransition=!0,this.pop(1)):this.activeView&&Ko(this.activeView,this.views,this.views,this.location)}getLastUrl(N){const A=this.getStack(N);return A.length>0?A[A.length-1]:void 0}getRootUrl(N){const A=this.getStack(N);return A.length>0?A[0]:void 0}getActiveStackId(){return this.activeView?this.activeView.stackId:void 0}hasRunningTask(){return void 0!==this.runningTask}destroy(){this.containerEl=void 0,this.views.forEach(dn),this.activeView=void 0,this.views=[]}getStack(N){return this.views.filter(A=>A.stackId===N)}insertView(N,A){return this.activeView=N,this.views=((D,N,A)=>"root"===A?Hn(D,N):"forward"===A?((D,N)=>(D.indexOf(N)>=0?D=D.filter(re=>re.stackId!==N.stackId||re.id<=N.id):D.push(N),D))(D,N):((D,N)=>D.indexOf(N)>=0?D.filter(re=>re.stackId!==N.stackId||re.id<=N.id):Hn(D,N))(D,N))(this.views,N,A),this.views.slice()}transition(N,A,re,De,kt,Rn){if(this.skipTransition)return this.skipTransition=!1,Promise.resolve(!1);if(A===N)return Promise.resolve(!1);const Xn=N?N.element:void 0,Wi=A?A.element:void 0,pi=this.containerEl;return Xn&&Xn!==Wi&&(Xn.classList.add("ion-page"),Xn.classList.add("ion-page-invisible"),Xn.parentElement!==pi&&pi.appendChild(Xn),pi.commit)?pi.commit(Xn,Wi,{deepWait:!0,duration:void 0===re?0:void 0,direction:re,showGoBack:De,progressAnimation:kt,animationBuilder:Rn}):Promise.resolve(!1)}wait(N){return ne(this,void 0,void 0,function*(){void 0!==this.runningTask&&(yield this.runningTask,this.runningTask=void 0);const A=this.runningTask=N();return A.finally(()=>this.runningTask=void 0),A})}}const Or=(D,N,A,re)=>"function"==typeof requestAnimationFrame?new Promise(De=>{requestAnimationFrame(()=>{Ko(D,N,A,re),De()})}):Promise.resolve(),Ko=(D,N,A,re)=>{A.filter(De=>!N.includes(De)).forEach(dn),N.forEach(De=>{const Rn=re.path().split("?")[0].split("#")[0];if(De!==D&&De.url!==Rn){const Xn=De.element;Xn.setAttribute("aria-hidden","true"),Xn.classList.add("ion-page-hidden"),De.ref.changeDetectorRef.detach()}})};let cs=(()=>{let D=class{constructor(A,re,De,kt,Rn,Xn,Wi,pi,lr,so,Lr,xo,Eo){this.parentContexts=A,this.location=re,this.resolver=De,this.config=Xn,this.navCtrl=Wi,this.parentOutlet=Eo,this.activated=null,this.activatedView=null,this._activatedRoute=null,this.proxyMap=new WeakMap,this.currentActivatedRoute$=new bn.X(null),this.stackEvents=new C.vpe,this.activateEvents=new C.vpe,this.deactivateEvents=new C.vpe,this.nativeEl=lr.nativeElement,this.name=kt||ht.eC,this.tabsPrefix="true"===Rn?ie(so,xo):void 0,this.stackCtrl=new ei(this.tabsPrefix,this.nativeEl,so,Wi,Lr,pi),A.onChildOutletCreated(this.name,this)}set animation(A){this.nativeEl.animation=A}set animated(A){this.nativeEl.animated=A}set swipeGesture(A){this._swipeGesture=A,this.nativeEl.swipeHandler=A?{canStart:()=>this.stackCtrl.canGoBack(1)&&!this.stackCtrl.hasRunningTask(),onStart:()=>this.stackCtrl.startBackTransition(),onEnd:re=>this.stackCtrl.endBackTransition(re)}:void 0}ngOnDestroy(){this.stackCtrl.destroy()}getContext(){return this.parentContexts.getContext(this.name)}ngOnInit(){if(!this.activated){const A=this.getContext();A&&A.route&&this.activateWith(A.route,A.resolver||null)}new Promise(A=>(0,It.c)(this.nativeEl,A)).then(()=>{void 0===this._swipeGesture&&(this.swipeGesture=this.config.getBoolean("swipeBackEnabled","ios"===this.nativeEl.mode))})}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){throw new Error("incompatible reuse strategy")}attach(A,re){throw new Error("incompatible reuse strategy")}deactivate(){if(this.activated){if(this.activatedView){const re=this.getContext();this.activatedView.savedData=new Map(re.children.contexts);const De=this.activatedView.savedData.get("primary");if(De&&re.route&&(De.route=Object.assign({},re.route)),this.activatedView.savedExtras={},re.route){const kt=re.route.snapshot;this.activatedView.savedExtras.queryParams=kt.queryParams,this.activatedView.savedExtras.fragment=kt.fragment}}const A=this.component;this.activatedView=null,this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(A)}}activateWith(A,re){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=A;let De,kt=this.stackCtrl.getExistingView(A);if(kt){De=this.activated=kt.ref;const Rn=kt.savedData;Rn&&(this.getContext().children.contexts=Rn),this.updateActivatedRouteProxy(De.instance,A)}else{const Wi=(re=re||this.resolver).resolveComponentFactory(A._futureSnapshot.routeConfig.component),pi=this.parentContexts.getOrCreateContext(this.name).children,lr=new bn.X(null),so=this.createActivatedRouteProxy(lr,A),Lr=new $s(so,pi,this.location.injector);De=this.activated=this.location.createComponent(Wi,this.location.length,Lr),lr.next(De.instance),kt=this.stackCtrl.createView(this.activated,A),this.proxyMap.set(De.instance,so),this.currentActivatedRoute$.next({component:De.instance,activatedRoute:A})}this.activatedView=kt,this.stackCtrl.setActive(kt).then(Rn=>{this.navCtrl.setTopOutlet(this),this.activateEvents.emit(De.instance),this.stackEvents.emit(Rn)})}canGoBack(A=1,re){return this.stackCtrl.canGoBack(A,re)}pop(A=1,re){return this.stackCtrl.pop(A,re)}getLastUrl(A){const re=this.stackCtrl.getLastUrl(A);return re?re.url:void 0}getLastRouteView(A){return this.stackCtrl.getLastUrl(A)}getRootView(A){return this.stackCtrl.getRootUrl(A)}getActiveStackId(){return this.stackCtrl.getActiveStackId()}createActivatedRouteProxy(A,re){const De=new ht.gz;return De._futureSnapshot=re._futureSnapshot,De._routerState=re._routerState,De.snapshot=re.snapshot,De.outlet=re.outlet,De.component=re.component,De._paramMap=this.proxyObservable(A,"paramMap"),De._queryParamMap=this.proxyObservable(A,"queryParamMap"),De.url=this.proxyObservable(A,"url"),De.params=this.proxyObservable(A,"params"),De.queryParams=this.proxyObservable(A,"queryParams"),De.fragment=this.proxyObservable(A,"fragment"),De.data=this.proxyObservable(A,"data"),De}proxyObservable(A,re){return A.pipe((0,Bi.h)(De=>!!De),(0,_i.w)(De=>this.currentActivatedRoute$.pipe((0,Bi.h)(kt=>null!==kt&&kt.component===De),(0,_i.w)(kt=>kt&&kt.activatedRoute[re]),function li(D,N){return A=>A.lift(new $i(D,N))}())))}updateActivatedRouteProxy(A,re){const De=this.proxyMap.get(A);if(!De)throw new Error("Could not find activated route proxy for view");De._futureSnapshot=re._futureSnapshot,De._routerState=re._routerState,De.snapshot=re.snapshot,De.outlet=re.outlet,De.component=re.component,this.currentActivatedRoute$.next({component:A,activatedRoute:re})}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(ht.y6),C.Y36(C.s_b),C.Y36(C._Vd),C.$8M("name"),C.$8M("tabs"),C.Y36(lo),C.Y36(we),C.Y36(_t.Ye),C.Y36(C.SBq),C.Y36(ht.F0),C.Y36(C.R0b),C.Y36(ht.gz),C.Y36(D,12))},D.\u0275dir=C.lG2({type:D,selectors:[["ion-router-outlet"]],inputs:{animated:"animated",animation:"animation",swipeGesture:"swipeGesture"},outputs:{stackEvents:"stackEvents",activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),J([(0,C.r_U)()],D.prototype,"stackEvents",void 0),J([(0,C.r_U)("activate")],D.prototype,"activateEvents",void 0),J([(0,C.r_U)("deactivate")],D.prototype,"deactivateEvents",void 0),D=J([j(3,(0,C.ahi)("name")),j(4,(0,C.FiY)()),j(4,(0,C.ahi)("tabs")),j(12,(0,C.tp0)()),j(12,(0,C.FiY)())],D),D})();class $s{constructor(N,A,re){this.route=N,this.childContexts=A,this.parent=re}get(N,A){return N===ht.gz?this.route:N===ht.y6?this.childContexts:this.parent.get(N,A)}}let Na=(()=>{let D=class{constructor(A,re,De){this.routerOutlet=A,this.navCtrl=re,this.config=De}onClick(A){const re=this.defaultHref||this.config.get("backButtonDefaultHref");this.routerOutlet&&this.routerOutlet.canGoBack()?(this.navCtrl.setDirection("back",void 0,void 0,this.routerAnimation),this.routerOutlet.pop(),A.preventDefault()):null!=re&&(this.navCtrl.navigateBack(re,{animation:this.routerAnimation}),A.preventDefault())}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(cs,8),C.Y36(we),C.Y36(lo))},D.\u0275dir=C.lG2({type:D,selectors:[["ion-back-button"]],hostBindings:function(A,re){1&A&&C.NdJ("click",function(kt){return re.onClick(kt)})},inputs:{defaultHref:"defaultHref",routerAnimation:"routerAnimation"}}),J([(0,C.L6J)("click",["$event"])],D.prototype,"onClick",null),D=J([j(0,(0,C.FiY)())],D),D})(),yr=(()=>{let D=class{constructor(A,re,De,kt,Rn){this.locationStrategy=A,this.navCtrl=re,this.elementRef=De,this.router=kt,this.routerLink=Rn,this.routerDirection="forward"}ngOnInit(){this.updateTargetUrlAndHref()}ngOnChanges(){this.updateTargetUrlAndHref()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}updateTargetUrlAndHref(){if(this.routerLink){const A=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.routerLink.urlTree));this.elementRef.nativeElement.href=A}}onClick(A){this.navCtrl.setDirection(this.routerDirection,void 0,void 0,this.routerAnimation),A.preventDefault()}};return D.\u0275fac=function(A){return new(A||D)(C.Y36(_t.S$),C.Y36(we),C.Y36(C.SBq),C.Y36(ht.F0),C.Y36(ht.rH,8))},D.\u0275dir=C.lG2({type:D,selectors:[["","routerLink",""]],hostBindings:function(A,re){1&A&&C.NdJ("click",function(kt){return re.onClick(kt)})},inputs:{routerDirection:"routerDirection",routerAnimation:"routerAnimation"},features:[C.TTD]}),J([(0,C.L6J)("click",["$event"])],D.prototype,"onClick",null),D=J([j(4,(0,C.FiY)())],D),D})();class Gs{constructor(N){this.ctrl=N}create(N){return this.ctrl.create(N||{})}dismiss(N,A,re){return this.ctrl.dismiss(N,A,re)}getTop(){return this.ctrl.getTop()}}let Yr=class extends Gs{constructor(){super(Yt.b)}};Yr.\u0275fac=function(N){return new(N||Yr)},Yr.\u0275prov=C.Yz7({token:Yr,factory:function(D){return Yr.\u0275fac(D)},providedIn:"root"}),Yr.ngInjectableDef=(0,C.Yz7)({factory:function(){return new Yr},token:Yr,providedIn:"root"});let us=class extends Gs{constructor(){super(Yt.a)}};us.\u0275fac=function(N){return new(N||us)},us.\u0275prov=C.Yz7({token:us,factory:function(D){return us.\u0275fac(D)},providedIn:"root"}),us.ngInjectableDef=(0,C.Yz7)({factory:function(){return new us},token:us,providedIn:"root"});let Uo=class extends Gs{constructor(){super(Yt.l)}};Uo.\u0275fac=function(N){return new(N||Uo)},Uo.\u0275prov=C.Yz7({token:Uo,factory:function(D){return Uo.\u0275fac(D)},providedIn:"root"}),Uo.ngInjectableDef=(0,C.Yz7)({factory:function(){return new Uo},token:Uo,providedIn:"root"});let vo=class{open(N){return Ut.m.open(N)}close(N){return Ut.m.close(N)}toggle(N){return Ut.m.toggle(N)}enable(N,A){return Ut.m.enable(N,A)}swipeGesture(N,A){return Ut.m.swipeGesture(N,A)}isOpen(N){return Ut.m.isOpen(N)}isEnabled(N){return Ut.m.isEnabled(N)}get(N){return Ut.m.get(N)}getOpen(){return Ut.m.getOpen()}getMenus(){return Ut.m.getMenus()}};vo.\u0275fac=function(N){return new(N||vo)},vo.\u0275prov=C.Yz7({token:vo,factory:function(D){return vo.\u0275fac(D)},providedIn:"root"}),vo.ngInjectableDef=(0,C.Yz7)({factory:function(){return new vo},token:vo,providedIn:"root"});let rs=class extends Gs{constructor(){super(Yt.p)}};rs.\u0275fac=function(N){return new(N||rs)},rs.\u0275prov=C.Yz7({token:rs,factory:function(D){return rs.\u0275fac(D)},providedIn:"root"}),rs.ngInjectableDef=(0,C.Yz7)({factory:function(){return new rs},token:rs,providedIn:"root"});let ha=(()=>{let D=class extends Gs{constructor(A,re,De){super(Yt.m),this.angularDelegate=A,this.resolver=re,this.injector=De}create(A){return super.create(Object.assign({},A,{delegate:this.angularDelegate.create(this.resolver,this.injector)}))}};return D.\u0275fac=function(A){return new(A||D)(C.LFG(No),C.LFG(C._Vd),C.LFG(C.zs3))},D.\u0275prov=C.Yz7({token:D,factory:function(N){return D.\u0275fac(N)}}),D})(),wc=(()=>{let D=class extends Gs{constructor(A,re,De){super(Yt.c),this.angularDelegate=A,this.resolver=re,this.injector=De}create(A){return super.create(Object.assign({},A,{delegate:this.angularDelegate.create(this.resolver,this.injector)}))}};return D.\u0275fac=function(A){return new(A||D)(C.LFG(No),C.LFG(C._Vd),C.LFG(C.zs3))},D.\u0275prov=C.Yz7({token:D,factory:function(N){return D.\u0275fac(N)}}),D})(),ks=class extends Gs{constructor(){super(Yt.t)}};ks.\u0275fac=function(N){return new(N||ks)},ks.\u0275prov=C.Yz7({token:ks,factory:function(D){return ks.\u0275fac(D)},providedIn:"root"}),ks.ngInjectableDef=(0,C.Yz7)({factory:function(){return new ks},token:ks,providedIn:"root"});let Po=class{read(N){qs().read(N)}write(N){qs().write(N)}};Po.\u0275fac=function(N){return new(N||Po)},Po.\u0275prov=C.Yz7({token:Po,factory:function(D){return Po.\u0275fac(D)},providedIn:"root"}),Po.ngInjectableDef=(0,C.Yz7)({factory:function(){return new Po},token:Po,providedIn:"root"});const qs=()=>{const D="undefined"!=typeof window?window:null;if(null!=D){const N=D.Ionic;return N&&N.queue?N.queue:{read:A=>D.requestAnimationFrame(A),write:A=>D.requestAnimationFrame(A)}}return{read:N=>N(),write:N=>N()}};let Dr=class{create(N){return(0,wt.c)(N)}easingTime(N,A,re,De,kt){return(0,Bt.g)(N,A,re,De,kt)}};Dr.\u0275fac=function(N){return new(N||Dr)},Dr.\u0275prov=C.Yz7({token:Dr,factory:function(D){return Dr.\u0275fac(D)},providedIn:"root"}),Dr.ngInjectableDef=(0,C.Yz7)({factory:function(){return new Dr},token:Dr,providedIn:"root"});let _s=class{constructor(N){this.zone=N}create(N,A=!1){return A&&Object.getOwnPropertyNames(N).forEach(re=>{if("function"==typeof N[re]){const De=N[re];N[re]=(...kt)=>this.zone.run(()=>De(...kt))}}),(0,Ht.createGesture)(N)}};_s.\u0275fac=function(N){return new(N||_s)(C.LFG(C.R0b))},_s.\u0275prov=C.Yz7({token:_s,factory:function(D){return _s.\u0275fac(D)},providedIn:"root"}),_s.ngInjectableDef=(0,C.Yz7)({factory:function(){return new _s((0,C.LFG)(C.R0b))},token:_s,providedIn:"root"});class Zo{shouldDetach(N){return!1}shouldAttach(N){return!1}store(N,A){}retrieve(N){return null}shouldReuseRoute(N,A){if(N.routeConfig!==A.routeConfig)return!1;const re=N.params,De=A.params,kt=Object.keys(re),Rn=Object.keys(De);if(kt.length!==Rn.length)return!1;for(const Xn of kt)if(De[Xn]!==re[Xn])return!1;return!0}}const ys=(D,N,A)=>()=>{if(N.defaultView&&"undefined"!=typeof window){(D=>{const N=window,A=N.Ionic;A&&A.config&&"Object"!==A.config.constructor.name||(N.Ionic=N.Ionic||{},N.Ionic.config=Object.assign(Object.assign({},N.Ionic.config),D))})(Object.assign({},D,{_zoneGate:kt=>A.run(kt)}));const De="__zone_symbol__addEventListener"in N.body?"__zone_symbol__addEventListener":"addEventListener";return function tr(){var D=[];if("undefined"!=typeof window){var N=window;(!N.customElements||N.Element&&(!N.Element.prototype.closest||!N.Element.prototype.matches||!N.Element.prototype.remove||!N.Element.prototype.getRootNode))&&D.push(k.e(6748).then(k.t.bind(k,723,23))),("function"!=typeof Object.assign||!Object.entries||!Array.prototype.find||!Array.prototype.includes||!String.prototype.startsWith||!String.prototype.endsWith||N.NodeList&&!N.NodeList.prototype.forEach||!N.fetch||!function(){try{var re=new URL("b","http://a");return re.pathname="c%20d","http://a/c%20d"===re.href&&re.searchParams}catch{return!1}}()||"undefined"==typeof WeakMap)&&D.push(k.e(2214).then(k.t.bind(k,4144,23)))}return Promise.all(D)}().then(()=>((D,N)=>"undefined"==typeof window?Promise.resolve():(Zt.C&&Zt.C.supports&&Zt.C.supports("color","var(--c)")?(0,Zt.a)():k.e(1843).then(k.t.bind(k,2408,23)).then(()=>(Zt.p.$cssShim$=Zt.w.__cssshim)?Zt.p.$cssShim$.i():0)).then(()=>(gi(),(0,Zt.b)(JSON.parse('[["ion-select_3",[[2,"ion-select-popover",{"header":[1],"subHeader":[1,"sub-header"],"message":[1],"options":[16]},[[0,"ionChange","onSelect"]]],[33,"ion-select",{"disabled":[4],"cancelText":[1,"cancel-text"],"okText":[1,"ok-text"],"placeholder":[1],"name":[1],"selectedText":[1,"selected-text"],"multiple":[4],"interface":[1],"interfaceOptions":[8,"interface-options"],"compareWith":[1,"compare-with"],"value":[1032],"isExpanded":[32],"open":[64]}],[1,"ion-select-option",{"disabled":[4],"value":[8]}]]],["ion-menu_3",[[33,"ion-menu-button",{"color":[513],"disabled":[4],"menu":[1],"autoHide":[4,"auto-hide"],"type":[1],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]],[33,"ion-menu",{"contentId":[513,"content-id"],"menuId":[513,"menu-id"],"type":[1025],"disabled":[1028],"side":[513],"swipeGesture":[4,"swipe-gesture"],"maxEdgeStart":[2,"max-edge-start"],"isPaneVisible":[32],"isEndSide":[32],"isOpen":[64],"isActive":[64],"open":[64],"close":[64],"toggle":[64],"setOpen":[64]},[[16,"ionSplitPaneVisible","onSplitPaneChanged"],[2,"click","onBackdropClick"],[0,"keydown","onKeydown"]]],[1,"ion-menu-toggle",{"menu":[1],"autoHide":[4,"auto-hide"],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]]]],["ion-action-sheet",[[34,"ion-action-sheet",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"header":[1],"subHeader":[1,"sub-header"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-fab_3",[[33,"ion-fab-button",{"color":[513],"activated":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1],"show":[4],"translucent":[4],"type":[1],"size":[1],"closeIcon":[1,"close-icon"]}],[1,"ion-fab",{"horizontal":[1],"vertical":[1],"edge":[4],"activated":[1028],"close":[64]}],[1,"ion-fab-list",{"activated":[4],"side":[1]}]]],["ion-refresher_2",[[0,"ion-refresher-content",{"pullingIcon":[1025,"pulling-icon"],"pullingText":[1,"pulling-text"],"refreshingSpinner":[1025,"refreshing-spinner"],"refreshingText":[1,"refreshing-text"]}],[32,"ion-refresher",{"pullMin":[2,"pull-min"],"pullMax":[2,"pull-max"],"closeDuration":[1,"close-duration"],"snapbackDuration":[1,"snapback-duration"],"pullFactor":[2,"pull-factor"],"disabled":[4],"nativeRefresher":[32],"state":[32],"complete":[64],"cancel":[64],"getProgress":[64]}]]],["ion-alert",[[34,"ion-alert",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"header":[1],"subHeader":[1,"sub-header"],"message":[1],"buttons":[16],"inputs":[1040],"backdropDismiss":[4,"backdrop-dismiss"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},[[4,"keydown","onKeydown"]]]]],["ion-back-button",[[33,"ion-back-button",{"color":[513],"defaultHref":[1025,"default-href"],"disabled":[516],"icon":[1],"text":[1],"type":[1],"routerAnimation":[16]}]]],["ion-loading",[[34,"ion-loading",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"message":[1],"cssClass":[1,"css-class"],"duration":[2],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"spinner":[1025],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-toast",[[33,"ion-toast",{"overlayIndex":[2,"overlay-index"],"color":[513],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"duration":[2],"header":[1],"message":[1],"keyboardClose":[4,"keyboard-close"],"position":[1],"buttons":[16],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-card_5",[[33,"ion-card",{"color":[513],"button":[4],"type":[1],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}],[32,"ion-card-content"],[33,"ion-card-header",{"color":[513],"translucent":[4]}],[33,"ion-card-subtitle",{"color":[513]}],[33,"ion-card-title",{"color":[513]}]]],["ion-item-option_3",[[33,"ion-item-option",{"color":[513],"disabled":[4],"download":[1],"expandable":[4],"href":[1],"rel":[1],"target":[1],"type":[1]}],[32,"ion-item-options",{"side":[1],"fireSwipeEvent":[64]}],[0,"ion-item-sliding",{"disabled":[4],"state":[32],"getOpenAmount":[64],"getSlidingRatio":[64],"open":[64],"close":[64],"closeOpened":[64]}]]],["ion-infinite-scroll_2",[[32,"ion-infinite-scroll-content",{"loadingSpinner":[1025,"loading-spinner"],"loadingText":[1,"loading-text"]}],[0,"ion-infinite-scroll",{"threshold":[1],"disabled":[4],"position":[1],"isLoading":[32],"complete":[64]}]]],["ion-reorder_2",[[33,"ion-reorder",null,[[2,"click","onClick"]]],[0,"ion-reorder-group",{"disabled":[4],"state":[32],"complete":[64]}]]],["ion-segment_2",[[33,"ion-segment-button",{"disabled":[4],"layout":[1],"type":[1],"value":[1],"checked":[32]}],[33,"ion-segment",{"color":[513],"disabled":[4],"scrollable":[4],"swipeGesture":[4,"swipe-gesture"],"value":[1025],"activated":[32]}]]],["ion-tab-bar_2",[[33,"ion-tab-button",{"disabled":[4],"download":[1],"href":[1],"rel":[1],"layout":[1025],"selected":[1028],"tab":[1],"target":[1]},[[8,"ionTabBarChanged","onTabBarChanged"]]],[33,"ion-tab-bar",{"color":[513],"selectedTab":[1,"selected-tab"],"translucent":[4],"keyboardVisible":[32]}]]],["ion-chip",[[33,"ion-chip",{"color":[513],"outline":[4],"disabled":[4]}]]],["ion-modal",[[34,"ion-modal",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"component":[1],"componentProps":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"animated":[4],"swipeToClose":[4,"swipe-to-close"],"presentingElement":[16],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-popover",[[34,"ion-popover",{"delegate":[16],"overlayIndex":[2,"overlay-index"],"enterAnimation":[16],"leaveAnimation":[16],"component":[1],"componentProps":[16],"keyboardClose":[4,"keyboard-close"],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"event":[8],"showBackdrop":[4,"show-backdrop"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-searchbar",[[34,"ion-searchbar",{"color":[513],"animated":[4],"autocomplete":[1],"autocorrect":[1],"cancelButtonIcon":[1,"cancel-button-icon"],"cancelButtonText":[1,"cancel-button-text"],"clearIcon":[1,"clear-icon"],"debounce":[2],"disabled":[4],"inputmode":[1],"enterkeyhint":[1],"placeholder":[1],"searchIcon":[1,"search-icon"],"showCancelButton":[1,"show-cancel-button"],"showClearButton":[1,"show-clear-button"],"spellcheck":[4],"type":[1],"value":[1025],"focused":[32],"noAnimate":[32],"setFocus":[64],"getInputElement":[64]}]]],["ion-app_8",[[0,"ion-app"],[34,"ion-buttons",{"collapse":[4]}],[1,"ion-content",{"color":[513],"fullscreen":[4],"forceOverscroll":[1028,"force-overscroll"],"scrollX":[4,"scroll-x"],"scrollY":[4,"scroll-y"],"scrollEvents":[4,"scroll-events"],"getScrollElement":[64],"scrollToTop":[64],"scrollToBottom":[64],"scrollByPoint":[64],"scrollToPoint":[64]},[[8,"appload","onAppLoad"]]],[36,"ion-footer",{"translucent":[4]}],[36,"ion-header",{"collapse":[1],"translucent":[4]}],[1,"ion-router-outlet",{"mode":[1025],"delegate":[16],"animated":[4],"animation":[16],"swipeHandler":[16],"commit":[64],"setRouteId":[64],"getRouteId":[64]}],[33,"ion-title",{"color":[513],"size":[1]}],[33,"ion-toolbar",{"color":[513]},[[0,"ionStyle","childrenStyle"]]]]],["ion-route_4",[[0,"ion-route",{"url":[1],"component":[1],"componentProps":[16],"beforeLeave":[16],"beforeEnter":[16]}],[0,"ion-route-redirect",{"from":[1],"to":[1]}],[0,"ion-router",{"root":[1],"useHash":[4,"use-hash"],"canTransition":[64],"push":[64],"back":[64],"printDebug":[64],"navChanged":[64]},[[8,"popstate","onPopState"],[4,"ionBackButton","onBackButton"]]],[1,"ion-router-link",{"color":[513],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}]]],["ion-avatar_3",[[33,"ion-avatar"],[33,"ion-badge",{"color":[513]}],[1,"ion-thumbnail"]]],["ion-col_3",[[1,"ion-col",{"offset":[1],"offsetXs":[1,"offset-xs"],"offsetSm":[1,"offset-sm"],"offsetMd":[1,"offset-md"],"offsetLg":[1,"offset-lg"],"offsetXl":[1,"offset-xl"],"pull":[1],"pullXs":[1,"pull-xs"],"pullSm":[1,"pull-sm"],"pullMd":[1,"pull-md"],"pullLg":[1,"pull-lg"],"pullXl":[1,"pull-xl"],"push":[1],"pushXs":[1,"push-xs"],"pushSm":[1,"push-sm"],"pushMd":[1,"push-md"],"pushLg":[1,"push-lg"],"pushXl":[1,"push-xl"],"size":[1],"sizeXs":[1,"size-xs"],"sizeSm":[1,"size-sm"],"sizeMd":[1,"size-md"],"sizeLg":[1,"size-lg"],"sizeXl":[1,"size-xl"]},[[9,"resize","onResize"]]],[1,"ion-grid",{"fixed":[4]}],[1,"ion-row"]]],["ion-nav_2",[[1,"ion-nav",{"delegate":[16],"swipeGesture":[1028,"swipe-gesture"],"animated":[4],"animation":[16],"rootParams":[16],"root":[1],"push":[64],"insert":[64],"insertPages":[64],"pop":[64],"popTo":[64],"popToRoot":[64],"removeIndex":[64],"setRoot":[64],"setPages":[64],"setRouteId":[64],"getRouteId":[64],"getActive":[64],"getByIndex":[64],"canGoBack":[64],"getPrevious":[64]}],[0,"ion-nav-link",{"component":[1],"componentProps":[16],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}]]],["ion-slide_2",[[0,"ion-slide"],[36,"ion-slides",{"options":[8],"pager":[4],"scrollbar":[4],"update":[64],"updateAutoHeight":[64],"slideTo":[64],"slideNext":[64],"slidePrev":[64],"getActiveIndex":[64],"getPreviousIndex":[64],"length":[64],"isEnd":[64],"isBeginning":[64],"startAutoplay":[64],"stopAutoplay":[64],"lockSwipeToNext":[64],"lockSwipeToPrev":[64],"lockSwipes":[64],"getSwiper":[64]}]]],["ion-tab_2",[[1,"ion-tab",{"active":[1028],"delegate":[16],"tab":[1],"component":[1],"setActive":[64]}],[1,"ion-tabs",{"useRouter":[1028,"use-router"],"selectedTab":[32],"select":[64],"getTab":[64],"getSelected":[64],"setRouteId":[64],"getRouteId":[64]}]]],["ion-checkbox",[[33,"ion-checkbox",{"color":[513],"name":[1],"checked":[1028],"indeterminate":[1028],"disabled":[4],"value":[1]}]]],["ion-img",[[1,"ion-img",{"alt":[1],"src":[1],"loadSrc":[32],"loadError":[32]}]]],["ion-input",[[34,"ion-input",{"fireFocusEvents":[4,"fire-focus-events"],"color":[513],"accept":[1],"autocapitalize":[1],"autocomplete":[1],"autocorrect":[1],"autofocus":[4],"clearInput":[4,"clear-input"],"clearOnEdit":[4,"clear-on-edit"],"debounce":[2],"disabled":[4],"enterkeyhint":[1],"inputmode":[1],"max":[1],"maxlength":[2],"min":[1],"minlength":[2],"multiple":[4],"name":[1],"pattern":[1],"placeholder":[1],"readonly":[4],"required":[4],"spellcheck":[4],"step":[1],"size":[2],"type":[1],"value":[1032],"hasFocus":[32],"setFocus":[64],"setBlur":[64],"getInputElement":[64]}]]],["ion-progress-bar",[[33,"ion-progress-bar",{"type":[1],"reversed":[4],"value":[2],"buffer":[2],"color":[513]}]]],["ion-range",[[33,"ion-range",{"color":[513],"debounce":[2],"name":[1],"dualKnobs":[4,"dual-knobs"],"min":[2],"max":[2],"pin":[4],"snaps":[4],"step":[2],"ticks":[4],"disabled":[4],"value":[1026],"ratioA":[32],"ratioB":[32],"pressedKnob":[32]}]]],["ion-split-pane",[[33,"ion-split-pane",{"contentId":[513,"content-id"],"disabled":[4],"when":[8],"visible":[32]}]]],["ion-text",[[1,"ion-text",{"color":[513]}]]],["ion-textarea",[[34,"ion-textarea",{"fireFocusEvents":[4,"fire-focus-events"],"color":[513],"autocapitalize":[1],"autofocus":[4],"clearOnEdit":[1028,"clear-on-edit"],"debounce":[2],"disabled":[4],"inputmode":[1],"enterkeyhint":[1],"maxlength":[2],"minlength":[2],"name":[1],"placeholder":[1],"readonly":[4],"required":[4],"spellcheck":[4],"cols":[2],"rows":[2],"wrap":[1],"autoGrow":[4,"auto-grow"],"value":[1025],"hasFocus":[32],"setFocus":[64],"setBlur":[64],"getInputElement":[64]}]]],["ion-toggle",[[33,"ion-toggle",{"color":[513],"name":[1],"checked":[1028],"disabled":[4],"value":[1],"activated":[32]}]]],["ion-virtual-scroll",[[0,"ion-virtual-scroll",{"approxItemHeight":[2,"approx-item-height"],"approxHeaderHeight":[2,"approx-header-height"],"approxFooterHeight":[2,"approx-footer-height"],"headerFn":[16],"footerFn":[16],"items":[16],"itemHeight":[16],"headerHeight":[16],"footerHeight":[16],"renderItem":[16],"renderHeader":[16],"renderFooter":[16],"nodeRender":[16],"domRender":[16],"totalHeight":[32],"positionForItem":[64],"checkRange":[64],"checkEnd":[64]},[[9,"resize","onResize"]]]]],["ion-datetime_3",[[34,"ion-picker",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"columns":[16],"cssClass":[1,"css-class"],"duration":[2],"showBackdrop":[4,"show-backdrop"],"backdropDismiss":[4,"backdrop-dismiss"],"animated":[4],"htmlAttributes":[16],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"getColumn":[64]}],[33,"ion-datetime",{"name":[1],"disabled":[4],"readonly":[4],"min":[1025],"max":[1025],"displayFormat":[1,"display-format"],"displayTimezone":[1,"display-timezone"],"pickerFormat":[1,"picker-format"],"cancelText":[1,"cancel-text"],"doneText":[1,"done-text"],"yearValues":[8,"year-values"],"monthValues":[8,"month-values"],"dayValues":[8,"day-values"],"hourValues":[8,"hour-values"],"minuteValues":[8,"minute-values"],"monthNames":[1,"month-names"],"monthShortNames":[1,"month-short-names"],"dayNames":[1,"day-names"],"dayShortNames":[1,"day-short-names"],"pickerOptions":[16],"placeholder":[1],"value":[1025],"isExpanded":[32],"open":[64]}],[32,"ion-picker-column",{"col":[16]}]]],["ion-radio_2",[[33,"ion-radio",{"color":[513],"name":[1],"disabled":[4],"value":[8],"checked":[32],"buttonTabindex":[32],"setFocus":[64],"setButtonTabindex":[64]}],[0,"ion-radio-group",{"allowEmptySelection":[4,"allow-empty-selection"],"name":[1],"value":[1032]},[[4,"keydown","onKeydown"]]]]],["ion-spinner",[[1,"ion-spinner",{"color":[513],"duration":[2],"name":[1],"paused":[4]}]]],["ion-backdrop",[[33,"ion-backdrop",{"visible":[4],"tappable":[4],"stopPropagation":[4,"stop-propagation"]},[[2,"click","onMouseDown"]]]]],["ion-ripple-effect",[[1,"ion-ripple-effect",{"type":[1],"addRipple":[64]}]]],["ion-button_2",[[33,"ion-button",{"color":[513],"buttonType":[1025,"button-type"],"disabled":[516],"expand":[513],"fill":[1537],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"download":[1],"href":[1],"rel":[1],"shape":[513],"size":[513],"strong":[4],"target":[1],"type":[1]}],[1,"ion-icon",{"mode":[1025],"color":[1],"ariaLabel":[1537,"aria-label"],"ariaHidden":[513,"aria-hidden"],"ios":[1],"md":[1],"flipRtl":[4,"flip-rtl"],"name":[513],"src":[1],"icon":[8],"size":[1],"lazy":[4],"sanitize":[4],"svgContent":[32],"isVisible":[32]}]]],["ion-item_8",[[33,"ion-item-divider",{"color":[513],"sticky":[4]}],[32,"ion-item-group"],[33,"ion-note",{"color":[513]}],[1,"ion-skeleton-text",{"animated":[4]}],[49,"ion-item",{"color":[513],"button":[4],"detail":[4],"detailIcon":[1,"detail-icon"],"disabled":[4],"download":[1],"href":[1],"rel":[1],"lines":[1],"routerAnimation":[16],"routerDirection":[1,"router-direction"],"target":[1],"type":[1],"multipleInputs":[32],"focusable":[32]},[[0,"ionColor","labelColorChanged"],[0,"ionStyle","itemStyle"]]],[34,"ion-label",{"color":[513],"position":[1],"noAnimate":[32]}],[32,"ion-list",{"lines":[1],"inset":[4],"closeSlidingItems":[64]}],[33,"ion-list-header",{"color":[513],"lines":[1]}]]]]'),N))))(0,{exclude:["ion-tabs","ion-tab"],syncQueue:!0,raf:Le,jmp:kt=>A.runOutsideAngular(kt),ael(kt,Rn,Xn,Wi){kt[De](Rn,Xn,Wi)},rel(kt,Rn,Xn,Wi){kt.removeEventListener(Rn,Xn,Wi)}}))}};var dl;let Vo=dl=class{static forRoot(N){return{ngModule:dl,providers:[{provide:Kr,useValue:N},{provide:C.ip1,useFactory:ys,multi:!0,deps:[Kr,_t.K0,C.R0b]}]}}};Vo.\u0275fac=function(N){return new(N||Vo)},Vo.\u0275mod=C.oAB({type:Vo}),Vo.\u0275inj=C.cJS({providers:[No,ha,wc],imports:[[_t.ez]]})},929:(An,vt,k)=>{"use strict";k.d(vt,{c:()=>xe});var b=k(6536);let d;const l=Ee=>Ee.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),J=Ee=>{if(void 0===d){const be=void 0!==Ee.style.webkitAnimationName;d=void 0===Ee.style.animationName&&be?"-webkit-":""}return d},j=(Ee,We,be)=>{const Se=We.startsWith("animation")?J(Ee):"";Ee.style.setProperty(Se+We,be)},g=(Ee,We)=>{const be=We.startsWith("animation")?J(Ee):"";Ee.style.removeProperty(be+We)},Q=[],ye=(Ee=[],We)=>{if(void 0!==We){const be=Array.isArray(We)?We:[We];return[...Ee,...be]}return Ee},xe=Ee=>{let We,be,Se,ze,tt,et,ht,jt,Ut,Yt,zt,an,Kt,Be=[],C=[],Ge=[],_t=!1,wt={},xt=[],gt=[],Bt={},Ht=0,Gn=!1,It=!1,Zt=!0,ln=!1,xn=!0;const mt=Ee,Wt=[],On=[],bn=[],jn=[],li=[],$i=[],rr=[],Bi=[],_i=[],tr=[],gi="function"==typeof AnimationEffect||"function"==typeof window.AnimationEffect,Ti="function"==typeof Element&&"function"==typeof Element.prototype.animate&&gi,Le=(_e,qe)=>((qe&&qe.oneTimeCallback?On:Wt).push({c:_e,o:qe}),Kt),me=()=>{if(Ti)tr.forEach(_e=>{_e.cancel()}),tr.length=0;else{const _e=bn.slice();(0,b.r)(()=>{_e.forEach(qe=>{g(qe,"animation-name"),g(qe,"animation-duration"),g(qe,"animation-timing-function"),g(qe,"animation-iteration-count"),g(qe,"animation-delay"),g(qe,"animation-play-state"),g(qe,"animation-fill-mode"),g(qe,"animation-direction")})})}},He=()=>{li.forEach(_e=>{_e&&_e.parentNode&&_e.parentNode.removeChild(_e)}),li.length=0},gr=()=>void 0!==tt?tt:ht?ht.getFill():"both",Tr=()=>void 0!==Ut?Ut:void 0!==et?et:ht?ht.getDirection():"normal",Ci=()=>Gn?"linear":void 0!==Se?Se:ht?ht.getEasing():"linear",Oi=()=>It?0:void 0!==Yt?Yt:void 0!==be?be:ht?ht.getDuration():0,K=()=>void 0!==ze?ze:ht?ht.getIterations():1,q=()=>void 0!==zt?zt:void 0!==We?We:ht?ht.getDelay():0,Yn=()=>{0!==Ht&&(Ht--,0===Ht&&((()=>{Sr(),Bi.forEach(Pt=>Pt()),_i.forEach(Pt=>Pt());const _e=Zt?1:0,qe=xt,ct=gt,Vt=Bt;bn.forEach(Pt=>{const rn=Pt.classList;qe.forEach(fn=>rn.add(fn)),ct.forEach(fn=>rn.remove(fn));for(const fn in Vt)Vt.hasOwnProperty(fn)&&j(Pt,fn,Vt[fn])}),Wt.forEach(Pt=>Pt.c(_e,Kt)),On.forEach(Pt=>Pt.c(_e,Kt)),On.length=0,xn=!0,Zt&&(ln=!0),Zt=!0})(),ht&&ht.animationFinish()))},Li=(_e=!0)=>{(()=>{$i.forEach(Vt=>Vt()),rr.forEach(Vt=>Vt());const _e=C,qe=Ge,ct=wt;bn.forEach(Vt=>{const Pt=Vt.classList;_e.forEach(rn=>Pt.add(rn)),qe.forEach(rn=>Pt.remove(rn));for(const rn in ct)ct.hasOwnProperty(rn)&&j(Vt,rn,ct[rn])})})(),Be.length>0&&(Ti?(bn.forEach(_e=>{const qe=_e.animate(Be,{id:mt,delay:q(),duration:Oi(),easing:Ci(),iterations:K(),fill:gr(),direction:Tr()});qe.pause(),tr.push(qe)}),tr.length>0&&(tr[0].onfinish=()=>{Yn()})):((_e=!0)=>{He();const qe=(Ee=>(Ee.forEach(We=>{for(const be in We)if(We.hasOwnProperty(be)){const Se=We[be];if("easing"===be)We["animation-timing-function"]=Se,delete We[be];else{const ze=l(be);ze!==be&&(We[ze]=Se,delete We[be])}}}),Ee))(Be);bn.forEach(ct=>{if(qe.length>0){const Vt=((Ee=[])=>Ee.map(We=>{const be=We.offset,Se=[];for(const ze in We)We.hasOwnProperty(ze)&&"offset"!==ze&&Se.push(`${ze}: ${We[ze]};`);return`${100*be}% { ${Se.join(" ")} }`}).join(" "))(qe);an=void 0!==Ee?Ee:(Ee=>{let We=Q.indexOf(Ee);return We<0&&(We=Q.push(Ee)-1),`ion-animation-${We}`})(Vt);const Pt=((Ee,We,be)=>{const Se=(Ee=>{const We=Ee.getRootNode();return We.head||We})(be),ze=J(be),tt=Se.querySelector("#"+Ee);if(tt)return tt;const et=(be.ownerDocument||document).createElement("style");return et.id=Ee,et.textContent=`@${ze}keyframes ${Ee} { ${We} } @${ze}keyframes ${Ee}-alt { ${We} }`,Se.appendChild(et),et})(an,Vt,ct);li.push(Pt),j(ct,"animation-duration",`${Oi()}ms`),j(ct,"animation-timing-function",Ci()),j(ct,"animation-delay",`${q()}ms`),j(ct,"animation-fill-mode",gr()),j(ct,"animation-direction",Tr());const rn=K()===1/0?"infinite":K().toString();j(ct,"animation-iteration-count",rn),j(ct,"animation-play-state","paused"),_e&&j(ct,"animation-name",`${Pt.id}-alt`),(0,b.r)(()=>{j(ct,"animation-name",Pt.id||null)})}})})(_e)),_t=!0},Mi=_e=>{if(_e=Math.min(Math.max(_e,0),.9999),Ti)tr.forEach(qe=>{qe.currentTime=qe.effect.getComputedTiming().delay+Oi()*_e,qe.pause()});else{const qe=`-${Oi()*_e}ms`;bn.forEach(ct=>{Be.length>0&&(j(ct,"animation-delay",qe),j(ct,"animation-play-state","paused"))})}},di=_e=>{tr.forEach(qe=>{qe.effect.updateTiming({delay:q(),duration:Oi(),easing:Ci(),iterations:K(),fill:gr(),direction:Tr()})}),void 0!==_e&&Mi(_e)},En=(_e=!0,qe)=>{(0,b.r)(()=>{bn.forEach(ct=>{j(ct,"animation-name",an||null),j(ct,"animation-duration",`${Oi()}ms`),j(ct,"animation-timing-function",Ci()),j(ct,"animation-delay",void 0!==qe?`-${qe*Oi()}ms`:`${q()}ms`),j(ct,"animation-fill-mode",gr()||null),j(ct,"animation-direction",Tr()||null);const Vt=K()===1/0?"infinite":K().toString();j(ct,"animation-iteration-count",Vt),_e&&j(ct,"animation-name",`${an}-alt`),(0,b.r)(()=>{j(ct,"animation-name",an||null)})})})},ti=(_e=!1,qe=!0,ct)=>(_e&&jn.forEach(Vt=>{Vt.update(_e,qe,ct)}),Ti?di(ct):En(qe,ct),Kt),oi=()=>{_t&&(Ti?tr.forEach(_e=>{_e.pause()}):bn.forEach(_e=>{j(_e,"animation-play-state","paused")}))},or=()=>{jt=void 0,Yn()},Sr=()=>{jt&&clearTimeout(jt)},jr=_e=>new Promise(qe=>{_e&&_e.sync&&(It=!0,Le(()=>It=!1,{oneTimeCallback:!0})),_t||Li(),ln&&(Ti?(Mi(0),di()):En(),ln=!1),xn&&(Ht=jn.length+1,xn=!1),Le(()=>qe(),{oneTimeCallback:!0}),jn.forEach(ct=>{ct.play()}),Ti?(tr.forEach(_e=>{_e.play()}),(0===Be.length||0===bn.length)&&Yn()):(()=>{if(Sr(),(0,b.r)(()=>{bn.forEach(_e=>{Be.length>0&&j(_e,"animation-play-state","running")})}),0===Be.length||0===bn.length)Yn();else{const _e=q()||0,qe=Oi()||0,ct=K()||1;isFinite(ct)&&(jt=setTimeout(or,_e+qe*ct+100)),((Ee,We)=>{let be;const Se={passive:!0},tt=et=>{Ee===et.target&&(be&&be(),Sr(),(0,b.r)(()=>{bn.forEach(_e=>{g(_e,"animation-duration"),g(_e,"animation-delay"),g(_e,"animation-play-state")}),(0,b.r)(Yn)}))};Ee&&(Ee.addEventListener("webkitAnimationEnd",tt,Se),Ee.addEventListener("animationend",tt,Se),be=()=>{Ee.removeEventListener("webkitAnimationEnd",tt,Se),Ee.removeEventListener("animationend",tt,Se)})})(bn[0])}})()}),Cr=(_e,qe)=>{const ct=Be[0];return void 0===ct||void 0!==ct.offset&&0!==ct.offset?Be=[{offset:0,[_e]:qe},...Be]:ct[_e]=qe,Kt};return Kt={parentAnimation:ht,elements:bn,childAnimations:jn,id:mt,animationFinish:Yn,from:Cr,to:(_e,qe)=>{const ct=Be[Be.length-1];return void 0===ct||void 0!==ct.offset&&1!==ct.offset?Be=[...Be,{offset:1,[_e]:qe}]:ct[_e]=qe,Kt},fromTo:(_e,qe,ct)=>Cr(_e,qe).to(_e,ct),parent:_e=>(ht=_e,Kt),play:jr,pause:()=>(jn.forEach(_e=>{_e.pause()}),oi(),Kt),stop:()=>{jn.forEach(_e=>{_e.stop()}),_t&&(me(),_t=!1),Gn=!1,It=!1,xn=!0,Ut=void 0,Yt=void 0,zt=void 0,Ht=0,ln=!1,Zt=!0},destroy:_e=>(jn.forEach(qe=>{qe.destroy(_e)}),(_e=>{me(),_e&&He()})(_e),bn.length=0,jn.length=0,Be.length=0,Wt.length=0,On.length=0,_t=!1,xn=!0,Kt),keyframes:_e=>(Be=_e,Kt),addAnimation:_e=>{if(null!=_e)if(Array.isArray(_e))for(const qe of _e)qe.parent(Kt),jn.push(qe);else _e.parent(Kt),jn.push(_e);return Kt},addElement:_e=>{if(null!=_e)if(1===_e.nodeType)bn.push(_e);else if(_e.length>=0)for(let qe=0;qe<_e.length;qe++)bn.push(_e[qe]);else console.error("Invalid addElement value");return Kt},update:ti,fill:_e=>(tt=_e,ti(!0),Kt),direction:_e=>(et=_e,ti(!0),Kt),iterations:_e=>(ze=_e,ti(!0),Kt),duration:_e=>(!Ti&&0===_e&&(_e=1),be=_e,ti(!0),Kt),easing:_e=>(Se=_e,ti(!0),Kt),delay:_e=>(We=_e,ti(!0),Kt),getWebAnimations:()=>tr,getKeyframes:()=>Be,getFill:gr,getDirection:Tr,getDelay:q,getIterations:K,getEasing:Ci,getDuration:Oi,afterAddRead:_e=>(Bi.push(_e),Kt),afterAddWrite:_e=>(_i.push(_e),Kt),afterClearStyles:(_e=[])=>{for(const qe of _e)Bt[qe]="";return Kt},afterStyles:(_e={})=>(Bt=_e,Kt),afterRemoveClass:_e=>(gt=ye(gt,_e),Kt),afterAddClass:_e=>(xt=ye(xt,_e),Kt),beforeAddRead:_e=>($i.push(_e),Kt),beforeAddWrite:_e=>(rr.push(_e),Kt),beforeClearStyles:(_e=[])=>{for(const qe of _e)wt[qe]="";return Kt},beforeStyles:(_e={})=>(wt=_e,Kt),beforeRemoveClass:_e=>(Ge=ye(Ge,_e),Kt),beforeAddClass:_e=>(C=ye(C,_e),Kt),onFinish:Le,progressStart:(_e=!1,qe)=>(jn.forEach(ct=>{ct.progressStart(_e,qe)}),oi(),Gn=_e,_t?ti(!1,!0,qe):Li(),Kt),progressStep:_e=>(jn.forEach(qe=>{qe.progressStep(_e)}),Mi(_e),Kt),progressEnd:(_e,qe,ct)=>(Gn=!1,jn.forEach(Vt=>{Vt.progressEnd(_e,qe,ct)}),void 0!==ct&&(Yt=ct),ln=!1,Zt=!0,0===_e?(Ut="reverse"===Tr()?"normal":"reverse","reverse"===Ut&&(Zt=!1),Ti?(ti(),Mi(1-qe)):(zt=(1-qe)*Oi()*-1,ti(!1,!1))):1===_e&&(Ti?(ti(),Mi(qe)):(zt=qe*Oi()*-1,ti(!1,!1))),void 0!==_e&&(Le(()=>{Yt=void 0,Ut=void 0,zt=void 0},{oneTimeCallback:!0}),ht||jr()),Kt)}}},5536:(An,vt,k)=>{"use strict";k.d(vt,{g:()=>b});const b=(j,g,ne,ge,Q)=>pe(j[1],g[1],ne[1],ge[1],Q).map(Y=>d(j[0],g[0],ne[0],ge[0],Y)),d=(j,g,ne,ge,Q)=>Q*(3*g*Math.pow(Q-1,2)+Q*(-3*ne*Q+3*ne+ge*Q))-j*Math.pow(Q-1,3),pe=(j,g,ne,ge,Q)=>J((ge-=Q)-3*(ne-=Q)+3*(g-=Q)-(j-=Q),3*ne-6*g+3*j,3*g-3*j,j).filter(se=>se>=0&&se<=1),J=(j,g,ne,ge)=>{if(0===j)return((j,g,ne)=>{const ge=g*g-4*j*ne;return ge<0?[]:[(-g+Math.sqrt(ge))/(2*j),(-g-Math.sqrt(ge))/(2*j)]})(g,ne,ge);const Q=(3*(ne/=j)-(g/=j)*g)/3,Y=(2*g*g*g-9*g*ne+27*(ge/=j))/27;if(0===Q)return[Math.pow(-Y,1/3)];if(0===Y)return[Math.sqrt(-Q),-Math.sqrt(-Q)];const se=Math.pow(Y/2,2)+Math.pow(Q/3,3);if(0===se)return[Math.pow(Y/2,.5)-g/3];if(se>0)return[Math.pow(-Y/2+Math.sqrt(se),1/3)-Math.pow(Y/2+Math.sqrt(se),1/3)-g/3];const ue=Math.sqrt(Math.pow(-Q/3,3)),ye=Math.acos(-Y/(2*Math.sqrt(Math.pow(-Q/3,3)))),xe=2*Math.pow(ue,1/3);return[xe*Math.cos(ye/3)-g/3,xe*Math.cos((ye+2*Math.PI)/3)-g/3,xe*Math.cos((ye+4*Math.PI)/3)-g/3]}},1497:(An,vt,k)=>{"use strict";k.d(vt,{G:()=>J});class d{constructor(g,ne,ge,Q,Y){this.id=ne,this.name=ge,this.disableScroll=Y,this.priority=1e6*Q+ne,this.ctrl=g}canStart(){return!!this.ctrl&&this.ctrl.canStart(this.name)}start(){return!!this.ctrl&&this.ctrl.start(this.name,this.id,this.priority)}capture(){if(!this.ctrl)return!1;const g=this.ctrl.capture(this.name,this.id,this.priority);return g&&this.disableScroll&&this.ctrl.disableScroll(this.id),g}release(){this.ctrl&&(this.ctrl.release(this.id),this.disableScroll&&this.ctrl.enableScroll(this.id))}destroy(){this.release(),this.ctrl=void 0}}class pe{constructor(g,ne,ge,Q){this.id=ne,this.disable=ge,this.disableScroll=Q,this.ctrl=g}block(){if(this.ctrl){if(this.disable)for(const g of this.disable)this.ctrl.disableGesture(g,this.id);this.disableScroll&&this.ctrl.disableScroll(this.id)}}unblock(){if(this.ctrl){if(this.disable)for(const g of this.disable)this.ctrl.enableGesture(g,this.id);this.disableScroll&&this.ctrl.enableScroll(this.id)}}destroy(){this.unblock(),this.ctrl=void 0}}const l="backdrop-no-scroll",J=new class b{constructor(){this.gestureId=0,this.requestedStart=new Map,this.disabledGestures=new Map,this.disabledScroll=new Set}createGesture(g){return new d(this,this.newID(),g.name,g.priority||0,!!g.disableScroll)}createBlocker(g={}){return new pe(this,this.newID(),g.disable,!!g.disableScroll)}start(g,ne,ge){return this.canStart(g)?(this.requestedStart.set(ne,ge),!0):(this.requestedStart.delete(ne),!1)}capture(g,ne,ge){if(!this.start(g,ne,ge))return!1;const Q=this.requestedStart;let Y=-1e4;if(Q.forEach(se=>{Y=Math.max(Y,se)}),Y===ge){this.capturedId=ne,Q.clear();const se=new CustomEvent("ionGestureCaptured",{detail:{gestureName:g}});return document.dispatchEvent(se),!0}return Q.delete(ne),!1}release(g){this.requestedStart.delete(g),this.capturedId===g&&(this.capturedId=void 0)}disableGesture(g,ne){let ge=this.disabledGestures.get(g);void 0===ge&&(ge=new Set,this.disabledGestures.set(g,ge)),ge.add(ne)}enableGesture(g,ne){const ge=this.disabledGestures.get(g);void 0!==ge&&ge.delete(ne)}disableScroll(g){this.disabledScroll.add(g),1===this.disabledScroll.size&&document.body.classList.add(l)}enableScroll(g){this.disabledScroll.delete(g),0===this.disabledScroll.size&&document.body.classList.remove(l)}canStart(g){return!(void 0!==this.capturedId||this.isDisabled(g))}isCaptured(){return void 0!==this.capturedId}isScrollDisabled(){return this.disabledScroll.size>0}isDisabled(g){const ne=this.disabledGestures.get(g);return!!(ne&&ne.size>0)}newID(){return this.gestureId++,this.gestureId}}},6247:(An,vt,k)=>{"use strict";k.r(vt),k.d(vt,{MENU_BACK_BUTTON_PRIORITY:()=>J,OVERLAY_BACK_BUTTON_PRIORITY:()=>l,blockHardwareBackButton:()=>d,startHardwareBackButton:()=>pe});var b=k(6099);const d=()=>{document.addEventListener("backbutton",()=>{})},pe=()=>{const j=document;let g=!1;j.addEventListener("backbutton",()=>{if(g)return;let ne=0,ge=[];const Q=new CustomEvent("ionBackButton",{bubbles:!1,detail:{register(ue,ye){ge.push({priority:ue,handler:ye,id:ne++})}}});j.dispatchEvent(Q);const Y=function(){var ue=(0,b.Z)(function*(ye){try{if(ye&&ye.handler){const xe=ye.handler(se);null!=xe&&(yield xe)}}catch(xe){console.error(xe)}});return function(xe){return ue.apply(this,arguments)}}(),se=()=>{if(ge.length>0){let ue={priority:Number.MIN_SAFE_INTEGER,handler:()=>{},id:-1};ge.forEach(ye=>{ye.priority>=ue.priority&&(ue=ye)}),g=!0,ge=ge.filter(ye=>ye.id!==ue.id),Y(ue).then(()=>g=!1)}};se()})},l=100,J=99},6536:(An,vt,k)=>{"use strict";k.d(vt,{a:()=>pe,b:()=>l,c:()=>b,d:()=>ge,e:()=>Q,f:()=>Ee,g:()=>J,h:()=>ne,i:()=>d,j:()=>Y,k:()=>g,l:()=>se,m:()=>xe,n:()=>We,o:()=>ue,p:()=>ye,r:()=>j});const b=(be,Se)=>{be.componentOnReady?be.componentOnReady().then(ze=>Se(ze)):j(()=>Se(be))},d=(be,Se=[])=>{const ze={};return Se.forEach(tt=>{be.hasAttribute(tt)&&(null!==be.getAttribute(tt)&&(ze[tt]=be.getAttribute(tt)),be.removeAttribute(tt))}),ze},pe=(be,Se,ze,tt)=>{if("undefined"!=typeof window){const et=window,Be=et&&et.Ionic&&et.Ionic.config;if(Be){const C=Be.get("_ael");if(C)return C(be,Se,ze,tt);if(Be._ael)return Be._ael(be,Se,ze,tt)}}return be.addEventListener(Se,ze,tt)},l=(be,Se,ze,tt)=>{if("undefined"!=typeof window){const et=window,Be=et&&et.Ionic&&et.Ionic.config;if(Be){const C=Be.get("_rel");if(C)return C(be,Se,ze,tt);if(Be._rel)return Be._rel(be,Se,ze,tt)}}return be.removeEventListener(Se,ze,tt)},J=(be,Se=be)=>be.shadowRoot||Se,j=be=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(be):"function"==typeof requestAnimationFrame?requestAnimationFrame(be):setTimeout(be),g=be=>!!be.shadowRoot&&!!be.attachShadow,ne=be=>{const Se=be.closest("ion-item");return Se?Se.querySelector("ion-label"):null},ge=(be,Se)=>{let ze;const tt=be.getAttribute("aria-labelledby"),et=be.id;let Be=null!==tt&&""!==tt.trim()?tt:Se+"-lbl",C=null!==tt&&""!==tt.trim()?document.getElementById(tt):ne(be);return C?(null===tt&&(C.id=Be),ze=C.textContent,C.setAttribute("aria-hidden","true")):""!==et.trim()&&(C=document.querySelector(`label[for="${et}"]`),C&&(""!==C.id?Be=C.id:C.id=Be=`${et}-lbl`,ze=C.textContent)),{label:C,labelId:Be,labelText:ze}},Q=(be,Se,ze,tt,et)=>{if(be||g(Se)){let Be=Se.querySelector("input.aux-input");Be||(Be=Se.ownerDocument.createElement("input"),Be.type="hidden",Be.classList.add("aux-input"),Se.appendChild(Be)),Be.disabled=et,Be.name=ze,Be.value=tt||""}},Y=(be,Se,ze)=>Math.max(be,Math.min(Se,ze)),se=(be,Se)=>{if(!be){const ze="ASSERT: "+Se;throw console.error(ze),new Error(ze)}},ue=be=>be.timeStamp||Date.now(),ye=be=>{if(be){const Se=be.changedTouches;if(Se&&Se.length>0){const ze=Se[0];return{x:ze.clientX,y:ze.clientY}}if(void 0!==be.pageX)return{x:be.pageX,y:be.pageY}}return{x:0,y:0}},xe=be=>{const Se="rtl"===document.dir;switch(be){case"start":return Se;case"end":return!Se;default:throw new Error(`"${be}" is not a valid value for [side]. Use "start" or "end" instead.`)}},Ee=(be,Se)=>{const ze=be._original||be;return{_original:be,emit:We(ze.emit.bind(ze),Se)}},We=(be,Se=0)=>{let ze;return(...tt)=>{clearTimeout(ze),ze=setTimeout(be,Se,...tt)}}},9370:(An,vt,k)=>{"use strict";k.d(vt,{m:()=>Y});var b=k(6099),d=k(6247),pe=k(6536),l=k(9821),J=k(929);const j=se=>(0,J.c)().duration(se?400:300),g=se=>{let ue,ye;const xe=se.width+8,Ee=(0,J.c)(),We=(0,J.c)();se.isEndSide?(ue=xe+"px",ye="0px"):(ue=-xe+"px",ye="0px"),Ee.addElement(se.menuInnerEl).fromTo("transform",`translateX(${ue})`,`translateX(${ye})`);const Se="ios"===(0,l.b)(se),ze=Se?.2:.25;return We.addElement(se.backdropEl).fromTo("opacity",.01,ze),j(Se).addAnimation([Ee,We])},ne=se=>{let ue,ye;const xe=(0,l.b)(se),Ee=se.width;se.isEndSide?(ue=-Ee+"px",ye=Ee+"px"):(ue=Ee+"px",ye=-Ee+"px");const We=(0,J.c)().addElement(se.menuInnerEl).fromTo("transform",`translateX(${ye})`,"translateX(0px)"),be=(0,J.c)().addElement(se.contentEl).fromTo("transform","translateX(0px)",`translateX(${ue})`),Se=(0,J.c)().addElement(se.backdropEl).fromTo("opacity",.01,.32);return j("ios"===xe).addAnimation([We,be,Se])},ge=se=>{const ue=(0,l.b)(se),ye=se.width*(se.isEndSide?-1:1)+"px",xe=(0,J.c)().addElement(se.contentEl).fromTo("transform","translateX(0px)",`translateX(${ye})`);return j("ios"===ue).addAnimation(xe)},Y=(()=>{const se=new Map,ue=[],ye=function(){var Ut=(0,b.Z)(function*(Yt){const zt=yield tt(Yt);return!!zt&&zt.open()});return function(zt){return Ut.apply(this,arguments)}}(),xe=function(){var Ut=(0,b.Z)(function*(Yt){const zt=yield void 0!==Yt?tt(Yt):et();return void 0!==zt&&zt.close()});return function(zt){return Ut.apply(this,arguments)}}(),Ee=function(){var Ut=(0,b.Z)(function*(Yt){const zt=yield tt(Yt);return!!zt&&zt.toggle()});return function(zt){return Ut.apply(this,arguments)}}(),We=function(){var Ut=(0,b.Z)(function*(Yt,zt){const Zt=yield tt(zt);return Zt&&(Zt.disabled=!Yt),Zt});return function(zt,Zt){return Ut.apply(this,arguments)}}(),be=function(){var Ut=(0,b.Z)(function*(Yt,zt){const Zt=yield tt(zt);return Zt&&(Zt.swipeGesture=Yt),Zt});return function(zt,Zt){return Ut.apply(this,arguments)}}(),Se=function(){var Ut=(0,b.Z)(function*(Yt){if(null!=Yt){const zt=yield tt(Yt);return void 0!==zt&&zt.isOpen()}return void 0!==(yield et())});return function(zt){return Ut.apply(this,arguments)}}(),ze=function(){var Ut=(0,b.Z)(function*(Yt){const zt=yield tt(Yt);return!!zt&&!zt.disabled});return function(zt){return Ut.apply(this,arguments)}}(),tt=function(){var Ut=(0,b.Z)(function*(Yt){return yield jt(),"start"===Yt||"end"===Yt?It(ln=>ln.side===Yt&&!ln.disabled)||It(ln=>ln.side===Yt):null!=Yt?It(Zt=>Zt.menuId===Yt):It(Zt=>!Zt.disabled)||(ue.length>0?ue[0].el:void 0)});return function(zt){return Ut.apply(this,arguments)}}(),et=function(){var Ut=(0,b.Z)(function*(){return yield jt(),Bt()});return function(){return Ut.apply(this,arguments)}}(),Be=function(){var Ut=(0,b.Z)(function*(){return yield jt(),Ht()});return function(){return Ut.apply(this,arguments)}}(),C=function(){var Ut=(0,b.Z)(function*(){return yield jt(),Gn()});return function(){return Ut.apply(this,arguments)}}(),Ge=(Ut,Yt)=>{se.set(Ut,Yt)},wt=Ut=>{const Yt=Ut.side;ue.filter(zt=>zt.side===Yt&&zt!==Ut).forEach(zt=>zt.disabled=!0)},xt=function(){var Ut=(0,b.Z)(function*(Yt,zt,Zt){if(Gn())return!1;if(zt){const ln=yield et();ln&&Yt.el!==ln&&(yield ln.setOpen(!1,!1))}return Yt._setOpen(zt,Zt)});return function(zt,Zt,ln){return Ut.apply(this,arguments)}}(),Bt=()=>It(Ut=>Ut._isOpen),Ht=()=>ue.map(Ut=>Ut.el),Gn=()=>ue.some(Ut=>Ut.isAnimating),It=Ut=>{const Yt=ue.find(Ut);if(void 0!==Yt)return Yt.el},jt=()=>Promise.all(Array.from(document.querySelectorAll("ion-menu")).map(Ut=>new Promise(Yt=>(0,pe.c)(Ut,Yt))));return Ge("reveal",ge),Ge("push",ne),Ge("overlay",g),"undefined"!=typeof document&&document.addEventListener("ionBackButton",Ut=>{const Yt=Bt();Yt&&Ut.detail.register(d.MENU_BACK_BUTTON_PRIORITY,()=>Yt.close())}),{registerAnimation:Ge,get:tt,getMenus:Be,getOpen:et,isEnabled:ze,swipeGesture:be,isAnimating:C,isOpen:Se,enable:We,toggle:Ee,close:xe,open:ye,_getOpenSync:Bt,_createAnimation:(Ut,Yt)=>{const zt=se.get(Ut);if(!zt)throw new Error("animation not registered");return zt(Yt)},_register:Ut=>{ue.indexOf(Ut)<0&&(Ut.disabled||wt(Ut),ue.push(Ut))},_unregister:Ut=>{const Yt=ue.indexOf(Ut);Yt>-1&&ue.splice(Yt,1)},_setOpen:xt,_setActiveMenu:wt}})()},1597:(An,vt,k)=>{"use strict";k.r(vt),k.d(vt,{GESTURE_CONTROLLER:()=>b.G,createGesture:()=>ge});var b=k(1497);const d=(ue,ye,xe,Ee)=>{const We=pe(ue)?{capture:!!Ee.capture,passive:!!Ee.passive}:!!Ee.capture;let be,Se;return ue.__zone_symbol__addEventListener?(be="__zone_symbol__addEventListener",Se="__zone_symbol__removeEventListener"):(be="addEventListener",Se="removeEventListener"),ue[be](ye,xe,We),()=>{ue[Se](ye,xe,We)}},pe=ue=>{if(void 0===l)try{const ye=Object.defineProperty({},"passive",{get:()=>{l=!0}});ue.addEventListener("optsTest",()=>{},ye)}catch{l=!1}return!!l};let l;const g=ue=>ue instanceof Document?ue:ue.ownerDocument,ge=ue=>{let ye=!1,xe=!1,Ee=!0,We=!1;const be=Object.assign({disableScroll:!1,direction:"x",gesturePriority:0,passive:!0,maxAngle:40,threshold:10},ue),Se=be.canStart,ze=be.onWillStart,tt=be.onStart,et=be.onEnd,Be=be.notCaptured,C=be.onMove,Ge=be.threshold,_t=be.passive,ht=be.blurOnStart,wt={type:"pan",startX:0,startY:0,startTime:0,currentX:0,currentY:0,velocityX:0,velocityY:0,deltaX:0,deltaY:0,currentTime:0,event:void 0,data:void 0},xt=((ue,ye,xe)=>{const Ee=xe*(Math.PI/180),We="x"===ue,be=Math.cos(Ee),Se=ye*ye;let ze=0,tt=0,et=!1,Be=0;return{start(C,Ge){ze=C,tt=Ge,Be=0,et=!0},detect(C,Ge){if(!et)return!1;const _t=C-ze,ht=Ge-tt,wt=_t*_t+ht*ht;if(wt<Se)return!1;const xt=Math.sqrt(wt),gt=(We?_t:ht)/xt;return Be=gt>be?1:gt<-be?-1:0,et=!1,!0},isGesture:()=>0!==Be,getDirection:()=>Be}})(be.direction,be.threshold,be.maxAngle),gt=b.G.createGesture({name:ue.gestureName,priority:ue.gesturePriority,disableScroll:ue.disableScroll}),Gn=()=>{!ye||(We=!1,C&&C(wt))},It=()=>!(gt&&!gt.capture()||(ye=!0,Ee=!1,wt.startX=wt.currentX,wt.startY=wt.currentY,wt.startTime=wt.currentTime,ze?ze(wt).then(Ut):Ut(),0)),Ut=()=>{ht&&(()=>{if("undefined"!=typeof document){const xn=document.activeElement;null!==xn&&xn.blur&&xn.blur()}})(),tt&&tt(wt),Ee=!0},Yt=()=>{ye=!1,xe=!1,We=!1,Ee=!0,gt.release()},zt=xn=>{const an=ye,Kt=Ee;if(Yt(),Kt){if(Q(wt,xn),an)return void(et&&et(wt));Be&&Be(wt)}},Zt=((ue,ye,xe,Ee,We)=>{let be,Se,ze,tt,et,Be,C,Ge=0;const _t=jt=>{Ge=Date.now()+2e3,ye(jt)&&(!Se&&xe&&(Se=d(ue,"touchmove",xe,We)),ze||(ze=d(jt.target,"touchend",wt,We)),tt||(tt=d(jt.target,"touchcancel",wt,We)))},ht=jt=>{Ge>Date.now()||!ye(jt)||(!Be&&xe&&(Be=d(g(ue),"mousemove",xe,We)),C||(C=d(g(ue),"mouseup",xt,We)))},wt=jt=>{gt(),Ee&&Ee(jt)},xt=jt=>{Bt(),Ee&&Ee(jt)},gt=()=>{Se&&Se(),ze&&ze(),tt&&tt(),Se=ze=tt=void 0},Bt=()=>{Be&&Be(),C&&C(),Be=C=void 0},Ht=()=>{gt(),Bt()},Gn=(jt=!0)=>{jt?(be||(be=d(ue,"touchstart",_t,We)),et||(et=d(ue,"mousedown",ht,We))):(be&&be(),et&&et(),be=et=void 0,Ht())};return{enable:Gn,stop:Ht,destroy:()=>{Gn(!1),Ee=xe=ye=void 0}}})(be.el,xn=>{const an=se(xn);return!(xe||!Ee||(Y(xn,wt),wt.startX=wt.currentX,wt.startY=wt.currentY,wt.startTime=wt.currentTime=an,wt.velocityX=wt.velocityY=wt.deltaX=wt.deltaY=0,wt.event=xn,Se&&!1===Se(wt))||(gt.release(),!gt.start()))&&(xe=!0,0===Ge?It():(xt.start(wt.startX,wt.startY),!0))},xn=>{ye?!We&&Ee&&(We=!0,Q(wt,xn),requestAnimationFrame(Gn)):(Q(wt,xn),xt.detect(wt.currentX,wt.currentY)&&(!xt.isGesture()||!It())&&ln())},zt,{capture:!1,passive:_t}),ln=()=>{Yt(),Zt.stop(),Be&&Be(wt)};return{enable(xn=!0){xn||(ye&&zt(void 0),Yt()),Zt.enable(xn)},destroy(){gt.destroy(),Zt.destroy()}}},Q=(ue,ye)=>{if(!ye)return;const xe=ue.currentX,Ee=ue.currentY,We=ue.currentTime;Y(ye,ue);const be=ue.currentX,Se=ue.currentY,tt=(ue.currentTime=se(ye))-We;if(tt>0&&tt<100){const Be=(Se-Ee)/tt;ue.velocityX=(be-xe)/tt*.7+.3*ue.velocityX,ue.velocityY=.7*Be+.3*ue.velocityY}ue.deltaX=be-ue.startX,ue.deltaY=Se-ue.startY,ue.event=ye},Y=(ue,ye)=>{let xe=0,Ee=0;if(ue){const We=ue.changedTouches;if(We&&We.length>0){const be=We[0];xe=be.clientX,Ee=be.clientY}else void 0!==ue.pageX&&(xe=ue.pageX,Ee=ue.pageY)}ye.currentX=xe,ye.currentY=Ee},se=ue=>ue.timeStamp||Date.now()},5225:(An,vt,k)=>{"use strict";k.d(vt,{B:()=>to,C:()=>se,H:()=>li,a:()=>Ee,b:()=>ni,c:()=>Cr,e:()=>Ii,f:()=>Pr,g:()=>xn,h:()=>bn,i:()=>xr,j:()=>K,k:()=>Li,p:()=>ye,r:()=>En,s:()=>ln,w:()=>Y});var b=k(6099);let pe,l,J,j=!1,g=!1,ne=!1,ge=!1,Q=!1;const Y="undefined"!=typeof window?window:{},se=Y.CSS,ue=Y.document||{head:{}},ye={$flags$:0,$resourcesUrl$:"",jmp:Ie=>Ie(),raf:Ie=>requestAnimationFrame(Ie),ael:(Ie,_e,qe,ct)=>Ie.addEventListener(_e,qe,ct),rel:(Ie,_e,qe,ct)=>Ie.removeEventListener(_e,qe,ct),ce:(Ie,_e)=>new CustomEvent(Ie,_e)},xe=(()=>(ue.head.attachShadow+"").indexOf("[native")>-1)(),Ee=Ie=>Promise.resolve(Ie),We=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replace}catch{}return!1})(),be=(Ie,_e,qe,ct)=>{qe&&qe.map(([Vt,Pt,rn])=>{const fn=ze(Ie,Vt),un=Se(_e,rn),Cn=tt(Vt);ye.ael(fn,Pt,un,Cn),(_e.$rmListeners$=_e.$rmListeners$||[]).push(()=>ye.rel(fn,Pt,un,Cn))})},Se=(Ie,_e)=>qe=>{try{256&Ie.$flags$?Ie.$lazyInstance$[_e](qe):(Ie.$queuedListeners$=Ie.$queuedListeners$||[]).push([_e,qe])}catch(ct){Ni(ct)}},ze=(Ie,_e)=>4&_e?ue:8&_e?Y:16&_e?ue.body:Ie,tt=Ie=>0!=(2&Ie),_t="s-id",ht="sty-id",gt="http://www.w3.org/1999/xlink",Gn=new WeakMap,It=(Ie,_e,qe)=>{let ct=fr.get(Ie);We&&qe?(ct=ct||new CSSStyleSheet,ct.replace(_e)):ct=_e,fr.set(Ie,ct)},jt=(Ie,_e,qe,ct)=>{let Vt=Yt(_e,qe),Pt=fr.get(Vt);if(Ie=11===Ie.nodeType?Ie:ue,Pt)if("string"==typeof Pt){let fn,rn=Gn.get(Ie=Ie.head||Ie);if(rn||Gn.set(Ie,rn=new Set),!rn.has(Vt)){if(Ie.host&&(fn=Ie.querySelector(`[${ht}="${Vt}"]`)))fn.innerHTML=Pt;else{if(ye.$cssShim$){fn=ye.$cssShim$.createHostStyle(ct,Vt,Pt,!!(10&_e.$flags$));const un=fn["s-sc"];un&&(Vt=un,rn=null)}else fn=ue.createElement("style"),fn.innerHTML=Pt;Ie.insertBefore(fn,Ie.querySelector("link"))}rn&&rn.add(Vt)}}else Ie.adoptedStyleSheets.includes(Pt)||(Ie.adoptedStyleSheets=[...Ie.adoptedStyleSheets,Pt]);return Vt},Yt=(Ie,_e)=>"sc-"+(_e&&32&Ie.$flags$?Ie.$tagName$+"-"+_e:Ie.$tagName$),zt=Ie=>Ie.replace(/\/\*!@([^\/]+)\*\/[^\{]+\{/g,"$1{"),ln=Ie=>or.push(Ie),xn=Ie=>di(Ie).$modeName$,an={},On=Ie=>"object"==(Ie=typeof Ie)||"function"===Ie,bn=(Ie,_e,...qe)=>{let ct=null,Vt=null,Pt=null,rn=!1,fn=!1,un=[];const Cn=St=>{for(let on=0;on<St.length;on++)ct=St[on],Array.isArray(ct)?Cn(ct):null!=ct&&"boolean"!=typeof ct&&((rn="function"!=typeof Ie&&!On(ct))&&(ct=String(ct)),rn&&fn?un[un.length-1].$text$+=ct:un.push(rn?jn(null,ct):ct),fn=rn)};if(Cn(qe),_e){_e.key&&(Vt=_e.key),_e.name&&(Pt=_e.name);{const St=_e.className||_e.class;St&&(_e.class="object"!=typeof St?St:Object.keys(St).filter(on=>St[on]).join(" "))}}if("function"==typeof Ie)return Ie(null===_e?{}:_e,un,rr);const Un=jn(Ie,null);return Un.$attrs$=_e,un.length>0&&(Un.$children$=un),Un.$key$=Vt,Un.$name$=Pt,Un},jn=(Ie,_e)=>({$flags$:0,$tag$:Ie,$text$:_e,$elm$:null,$children$:null,$attrs$:null,$key$:null,$name$:null}),li={},rr={forEach:(Ie,_e)=>Ie.map(Bi).forEach(_e),map:(Ie,_e)=>Ie.map(Bi).map(_e).map(_i)},Bi=Ie=>({vattrs:Ie.$attrs$,vchildren:Ie.$children$,vkey:Ie.$key$,vname:Ie.$name$,vtag:Ie.$tag$,vtext:Ie.$text$}),_i=Ie=>{if("function"==typeof Ie.vtag){const qe=Object.assign({},Ie.vattrs);return Ie.vkey&&(qe.key=Ie.vkey),Ie.vname&&(qe.name=Ie.vname),bn(Ie.vtag,qe,...Ie.vchildren||[])}const _e=jn(Ie.vtag,Ie.vtext);return _e.$attrs$=Ie.vattrs,_e.$children$=Ie.vchildren,_e.$key$=Ie.vkey,_e.$name$=Ie.vname,_e},tr=(Ie,_e,qe,ct,Vt,Pt)=>{if(qe!==ct){let rn=Yi(Ie,_e),fn=_e.toLowerCase();if("class"===_e){const un=Ie.classList,Cn=Ti(qe),Un=Ti(ct);un.remove(...Cn.filter(St=>St&&!Un.includes(St))),un.add(...Un.filter(St=>St&&!Cn.includes(St)))}else if("style"===_e){for(const un in qe)(!ct||null==ct[un])&&(un.includes("-")?Ie.style.removeProperty(un):Ie.style[un]="");for(const un in ct)(!qe||ct[un]!==qe[un])&&(un.includes("-")?Ie.style.setProperty(un,ct[un]):Ie.style[un]=ct[un])}else if("key"!==_e)if("ref"===_e)ct&&ct(Ie);else if(rn||"o"!==_e[0]||"n"!==_e[1]){const un=On(ct);if((rn||un&&null!==ct)&&!Vt)try{if(Ie.tagName.includes("-"))Ie[_e]=ct;else{let Un=ct??"";"list"===_e?rn=!1:(null==qe||Ie[_e]!=Un)&&(Ie[_e]=Un)}}catch{}let Cn=!1;fn!==(fn=fn.replace(/^xlink\:?/,""))&&(_e=fn,Cn=!0),null==ct||!1===ct?(!1!==ct||""===Ie.getAttribute(_e))&&(Cn?Ie.removeAttributeNS(gt,_e):Ie.removeAttribute(_e)):(!rn||4&Pt||Vt)&&!un&&(ct=!0===ct?"":ct,Cn?Ie.setAttributeNS(gt,_e,ct):Ie.setAttribute(_e,ct))}else _e="-"===_e[2]?_e.slice(3):Yi(Y,fn)?fn.slice(2):fn[2]+_e.slice(3),qe&&ye.rel(Ie,_e,qe,!1),ct&&ye.ael(Ie,_e,ct,!1)}},gi=/\s/,Ti=Ie=>Ie?Ie.split(gi):[],Xt=(Ie,_e,qe,ct)=>{const Vt=11===_e.$elm$.nodeType&&_e.$elm$.host?_e.$elm$.host:_e.$elm$,Pt=Ie&&Ie.$attrs$||an,rn=_e.$attrs$||an;for(ct in Pt)ct in rn||tr(Vt,ct,Pt[ct],void 0,qe,_e.$flags$);for(ct in rn)tr(Vt,ct,Pt[ct],rn[ct],qe,_e.$flags$)},Oe=(Ie,_e,qe,ct)=>{let rn,fn,un,Vt=_e.$children$[qe],Pt=0;if(j||(ne=!0,"slot"===Vt.$tag$&&(pe&&ct.classList.add(pe+"-s"),Vt.$flags$|=Vt.$children$?2:1)),null!==Vt.$text$)rn=Vt.$elm$=ue.createTextNode(Vt.$text$);else if(1&Vt.$flags$)rn=Vt.$elm$=ue.createTextNode("");else{if(ge||(ge="svg"===Vt.$tag$),rn=Vt.$elm$=ue.createElementNS(ge?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",2&Vt.$flags$?"slot-fb":Vt.$tag$),ge&&"foreignObject"===Vt.$tag$&&(ge=!1),Xt(null,Vt,ge),(Ie=>null!=Ie)(pe)&&rn["s-si"]!==pe&&rn.classList.add(rn["s-si"]=pe),Vt.$children$)for(Pt=0;Pt<Vt.$children$.length;++Pt)fn=Oe(Ie,Vt,Pt,rn),fn&&rn.appendChild(fn);"svg"===Vt.$tag$?ge=!1:"foreignObject"===rn.tagName&&(ge=!0)}return rn["s-hn"]=J,3&Vt.$flags$&&(rn["s-sr"]=!0,rn["s-cr"]=l,rn["s-sn"]=Vt.$name$||"",un=Ie&&Ie.$children$&&Ie.$children$[qe],un&&un.$tag$===Vt.$tag$&&Ie.$elm$&&ae(Ie.$elm$,!1)),rn},ae=(Ie,_e)=>{ye.$flags$|=1;const qe=Ie.childNodes;for(let ct=qe.length-1;ct>=0;ct--){const Vt=qe[ct];Vt["s-hn"]!==J&&Vt["s-ol"]&&(He(Vt).insertBefore(Vt,me(Vt)),Vt["s-ol"].remove(),Vt["s-ol"]=void 0,ne=!0),_e&&ae(Vt,_e)}ye.$flags$&=-2},Re=(Ie,_e,qe,ct,Vt,Pt)=>{let fn,rn=Ie["s-cr"]&&Ie["s-cr"].parentNode||Ie;for(rn.shadowRoot&&rn.tagName===J&&(rn=rn.shadowRoot);Vt<=Pt;++Vt)ct[Vt]&&(fn=Oe(null,qe,Vt,Ie),fn&&(ct[Vt].$elm$=fn,rn.insertBefore(fn,me(_e))))},lt=(Ie,_e,qe,ct,Vt)=>{for(;_e<=qe;++_e)(ct=Ie[_e])&&(Vt=ct.$elm$,mi(ct),g=!0,Vt["s-ol"]?Vt["s-ol"].remove():ae(Vt,!0),Vt.remove())},Rt=(Ie,_e)=>Ie.$tag$===_e.$tag$&&("slot"===Ie.$tag$?Ie.$name$===_e.$name$:Ie.$key$===_e.$key$),me=Ie=>Ie&&Ie["s-ol"]||Ie,He=Ie=>(Ie["s-ol"]?Ie["s-ol"]:Ie).parentNode,Ft=(Ie,_e)=>{const qe=_e.$elm$=Ie.$elm$,ct=Ie.$children$,Vt=_e.$children$,Pt=_e.$tag$,rn=_e.$text$;let fn;null===rn?(ge="svg"===Pt||"foreignObject"!==Pt&&ge,"slot"===Pt||Xt(Ie,_e,ge),null!==ct&&null!==Vt?((Ie,_e,qe,ct)=>{let Ur,ji,Vt=0,Pt=0,rn=0,fn=0,un=_e.length-1,Cn=_e[0],Un=_e[un],St=ct.length-1,on=ct[0],Ri=ct[St];for(;Vt<=un&&Pt<=St;)if(null==Cn)Cn=_e[++Vt];else if(null==Un)Un=_e[--un];else if(null==on)on=ct[++Pt];else if(null==Ri)Ri=ct[--St];else if(Rt(Cn,on))Ft(Cn,on),Cn=_e[++Vt],on=ct[++Pt];else if(Rt(Un,Ri))Ft(Un,Ri),Un=_e[--un],Ri=ct[--St];else if(Rt(Cn,Ri))("slot"===Cn.$tag$||"slot"===Ri.$tag$)&&ae(Cn.$elm$.parentNode,!1),Ft(Cn,Ri),Ie.insertBefore(Cn.$elm$,Un.$elm$.nextSibling),Cn=_e[++Vt],Ri=ct[--St];else if(Rt(Un,on))("slot"===Cn.$tag$||"slot"===Ri.$tag$)&&ae(Un.$elm$.parentNode,!1),Ft(Un,on),Ie.insertBefore(Un.$elm$,Cn.$elm$),Un=_e[--un],on=ct[++Pt];else{for(rn=-1,fn=Vt;fn<=un;++fn)if(_e[fn]&&null!==_e[fn].$key$&&_e[fn].$key$===on.$key$){rn=fn;break}rn>=0?(ji=_e[rn],ji.$tag$!==on.$tag$?Ur=Oe(_e&&_e[Pt],qe,rn,Ie):(Ft(ji,on),_e[rn]=void 0,Ur=ji.$elm$),on=ct[++Pt]):(Ur=Oe(_e&&_e[Pt],qe,Pt,Ie),on=ct[++Pt]),Ur&&He(Cn.$elm$).insertBefore(Ur,me(Cn.$elm$))}Vt>un?Re(Ie,null==ct[St+1]?null:ct[St+1].$elm$,qe,ct,Pt,St):Pt>St&&lt(_e,Vt,un)})(qe,ct,_e,Vt):null!==Vt?(null!==Ie.$text$&&(qe.textContent=""),Re(qe,null,_e,Vt,0,Vt.length-1)):null!==ct&&lt(ct,0,ct.length-1),ge&&"svg"===Pt&&(ge=!1)):(fn=qe["s-cr"])?fn.parentNode.textContent=rn:Ie.$text$!==rn&&(qe.data=rn)},Qt=Ie=>{let qe,ct,Vt,Pt,rn,fn,_e=Ie.childNodes;for(ct=0,Vt=_e.length;ct<Vt;ct++)if(qe=_e[ct],1===qe.nodeType){if(qe["s-sr"])for(rn=qe["s-sn"],qe.hidden=!1,Pt=0;Pt<Vt;Pt++)if(fn=_e[Pt].nodeType,_e[Pt]["s-hn"]!==qe["s-hn"]||""!==rn){if(1===fn&&rn===_e[Pt].getAttribute("slot")){qe.hidden=!0;break}}else if(1===fn||3===fn&&""!==_e[Pt].textContent.trim()){qe.hidden=!0;break}Qt(qe)}},Jn=[],Ki=Ie=>{let _e,qe,ct,Vt,Pt,rn,fn=0,un=Ie.childNodes,Cn=un.length;for(;fn<Cn;fn++){if(_e=un[fn],_e["s-sr"]&&(qe=_e["s-cr"])&&qe.parentNode)for(ct=qe.parentNode.childNodes,Vt=_e["s-sn"],rn=ct.length-1;rn>=0;rn--)qe=ct[rn],!qe["s-cn"]&&!qe["s-nr"]&&qe["s-hn"]!==_e["s-hn"]&&(Di(qe,Vt)?(Pt=Jn.find(Un=>Un.$nodeToRelocate$===qe),g=!0,qe["s-sn"]=qe["s-sn"]||Vt,Pt?Pt.$slotRefNode$=_e:Jn.push({$slotRefNode$:_e,$nodeToRelocate$:qe}),qe["s-sr"]&&Jn.map(Un=>{Di(Un.$nodeToRelocate$,qe["s-sn"])&&(Pt=Jn.find(St=>St.$nodeToRelocate$===qe),Pt&&!Un.$slotRefNode$&&(Un.$slotRefNode$=Pt.$slotRefNode$))})):Jn.some(Un=>Un.$nodeToRelocate$===qe)||Jn.push({$nodeToRelocate$:qe}));1===_e.nodeType&&Ki(_e)}},Di=(Ie,_e)=>1===Ie.nodeType?null===Ie.getAttribute("slot")&&""===_e||Ie.getAttribute("slot")===_e:Ie["s-sn"]===_e||""===_e,mi=Ie=>{Ie.$attrs$&&Ie.$attrs$.ref&&Ie.$attrs$.ref(null),Ie.$children$&&Ie.$children$.map(mi)},xr=Ie=>di(Ie).$hostElement$,Ii=(Ie,_e,qe)=>{const ct=xr(Ie);return{emit:Vt=>hr(ct,_e,{bubbles:!!(4&qe),composed:!!(2&qe),cancelable:!!(1&qe),detail:Vt})}},hr=(Ie,_e,qe)=>{const ct=ye.ce(_e,qe);return Ie.dispatchEvent(ct),ct},yi=(Ie,_e)=>{_e&&!Ie.$onRenderResolve$&&_e["s-p"]&&_e["s-p"].push(new Promise(qe=>Ie.$onRenderResolve$=qe))},kr=(Ie,_e)=>{if(Ie.$flags$|=16,!(4&Ie.$flags$))return yi(Ie,Ie.$ancestorComponent$),Cr(()=>gr(Ie,_e));Ie.$flags$|=512},gr=(Ie,_e)=>{const ct=Ie.$lazyInstance$;let Vt;return _e&&(Ie.$flags$|=256,Ie.$queuedListeners$&&(Ie.$queuedListeners$.map(([Pt,rn])=>L(ct,Pt,rn)),Ie.$queuedListeners$=null),Vt=L(ct,"componentWillLoad")),Vt=de(Vt,()=>L(ct,"componentWillRender")),de(Vt,()=>Tr(Ie,ct,_e))},Tr=function(){var Ie=(0,b.Z)(function*(_e,qe,ct){const Vt=_e.$hostElement$,rn=Vt["s-rc"];ct&&(Ie=>{const _e=Ie.$cmpMeta$,qe=Ie.$hostElement$,ct=_e.$flags$,Pt=jt(xe&&qe.shadowRoot?qe.shadowRoot:qe.getRootNode(),_e,Ie.$modeName$,qe);10&ct&&(qe["s-sc"]=Pt,qe.classList.add(Pt+"-h"),2&ct&&qe.classList.add(Pt+"-s"))})(_e);Ci(_e,qe),ye.$cssShim$&&ye.$cssShim$.updateHost(Vt),rn&&(rn.map(un=>un()),Vt["s-rc"]=void 0);{const un=Vt["s-p"],Cn=()=>Oi(_e);0===un.length?Cn():(Promise.all(un).then(Cn),_e.$flags$|=4,un.length=0)}});return function(qe,ct,Vt){return Ie.apply(this,arguments)}}(),Ci=(Ie,_e,qe)=>{try{_e=_e.render&&_e.render(),Ie.$flags$&=-17,Ie.$flags$|=2,((Ie,_e)=>{const qe=Ie.$hostElement$,ct=Ie.$cmpMeta$,Vt=Ie.$vnode$||jn(null,null),Pt=(Ie=>Ie&&Ie.$tag$===li)(_e)?_e:bn(null,null,_e);if(J=qe.tagName,ct.$attrsToReflect$&&(Pt.$attrs$=Pt.$attrs$||{},ct.$attrsToReflect$.map(([rn,fn])=>Pt.$attrs$[fn]=qe[rn])),Pt.$tag$=null,Pt.$flags$|=4,Ie.$vnode$=Pt,Pt.$elm$=Vt.$elm$=qe.shadowRoot||qe,pe=qe["s-sc"],l=qe["s-cr"],j=xe&&0!=(1&ct.$flags$),g=!1,Ft(Vt,Pt),ye.$flags$|=1,ne){Ki(Pt.$elm$);let rn,fn,un,Cn,Un,St,on=0;for(;on<Jn.length;on++)rn=Jn[on],fn=rn.$nodeToRelocate$,fn["s-ol"]||(un=ue.createTextNode(""),un["s-nr"]=fn,fn.parentNode.insertBefore(fn["s-ol"]=un,fn));for(on=0;on<Jn.length;on++)if(rn=Jn[on],fn=rn.$nodeToRelocate$,rn.$slotRefNode$){for(Cn=rn.$slotRefNode$.parentNode,Un=rn.$slotRefNode$.nextSibling,un=fn["s-ol"];un=un.previousSibling;)if(St=un["s-nr"],St&&St["s-sn"]===fn["s-sn"]&&Cn===St.parentNode&&(St=St.nextSibling,!St||!St["s-nr"])){Un=St;break}(!Un&&Cn!==fn.parentNode||fn.nextSibling!==Un)&&fn!==Un&&(!fn["s-hn"]&&fn["s-ol"]&&(fn["s-hn"]=fn["s-ol"].parentNode.nodeName),Cn.insertBefore(fn,Un))}else 1===fn.nodeType&&(fn.hidden=!0)}g&&Qt(Pt.$elm$),ye.$flags$&=-2,Jn.length=0})(Ie,_e)}catch(ct){Ni(ct,Ie.$hostElement$)}return null},Oi=Ie=>{const qe=Ie.$hostElement$,Vt=Ie.$lazyInstance$,Pt=Ie.$ancestorComponent$;64&Ie.$flags$?L(Vt,"componentDidUpdate"):(Ie.$flags$|=64,we(qe),L(Vt,"componentDidLoad"),Ie.$onReadyResolve$(qe),Pt||q()),Ie.$onInstanceResolve$(qe),Ie.$onRenderResolve$&&(Ie.$onRenderResolve$(),Ie.$onRenderResolve$=void 0),512&Ie.$flags$&&jr(()=>kr(Ie,!1)),Ie.$flags$&=-517},K=Ie=>{{const _e=di(Ie),qe=_e.$hostElement$.isConnected;return qe&&2==(18&_e.$flags$)&&kr(_e,!1),qe}},q=Ie=>{we(ue.documentElement),jr(()=>hr(Y,"appload",{detail:{namespace:"ionic"}}))},L=(Ie,_e,qe)=>{if(Ie&&Ie[_e])try{return Ie[_e](qe)}catch(ct){Ni(ct)}},de=(Ie,_e)=>Ie&&Ie.then?Ie.then(_e):_e(),we=Ie=>Ie.classList.add("hydrated"),pt=(Ie,_e,qe,ct,Vt,Pt,rn)=>{let fn,un,Cn,Un;if(1===Pt.nodeType){for(fn=Pt.getAttribute("c-id"),fn&&(un=fn.split("."),(un[0]===rn||"0"===un[0])&&(Cn={$flags$:0,$hostId$:un[0],$nodeId$:un[1],$depth$:un[2],$index$:un[3],$tag$:Pt.tagName.toLowerCase(),$elm$:Pt,$attrs$:null,$children$:null,$key$:null,$name$:null,$text$:null},_e.push(Cn),Pt.removeAttribute("c-id"),Ie.$children$||(Ie.$children$=[]),Ie.$children$[Cn.$index$]=Cn,Ie=Cn,ct&&"0"===Cn.$depth$&&(ct[Cn.$index$]=Cn.$elm$))),Un=Pt.childNodes.length-1;Un>=0;Un--)pt(Ie,_e,qe,ct,Vt,Pt.childNodes[Un],rn);if(Pt.shadowRoot)for(Un=Pt.shadowRoot.childNodes.length-1;Un>=0;Un--)pt(Ie,_e,qe,ct,Vt,Pt.shadowRoot.childNodes[Un],rn)}else if(8===Pt.nodeType)un=Pt.nodeValue.split("."),(un[1]===rn||"0"===un[1])&&(fn=un[0],Cn={$flags$:0,$hostId$:un[1],$nodeId$:un[2],$depth$:un[3],$index$:un[4],$elm$:Pt,$attrs$:null,$children$:null,$key$:null,$name$:null,$tag$:null,$text$:null},"t"===fn?(Cn.$elm$=Pt.nextSibling,Cn.$elm$&&3===Cn.$elm$.nodeType&&(Cn.$text$=Cn.$elm$.textContent,_e.push(Cn),Pt.remove(),Ie.$children$||(Ie.$children$=[]),Ie.$children$[Cn.$index$]=Cn,ct&&"0"===Cn.$depth$&&(ct[Cn.$index$]=Cn.$elm$))):Cn.$hostId$===rn&&("s"===fn?(Cn.$tag$="slot",Pt["s-sn"]=un[5]?Cn.$name$=un[5]:"",Pt["s-sr"]=!0,ct&&(Cn.$elm$=ue.createElement(Cn.$tag$),Cn.$name$&&Cn.$elm$.setAttribute("name",Cn.$name$),Pt.parentNode.insertBefore(Cn.$elm$,Pt),Pt.remove(),"0"===Cn.$depth$&&(ct[Cn.$index$]=Cn.$elm$)),qe.push(Cn),Ie.$children$||(Ie.$children$=[]),Ie.$children$[Cn.$index$]=Cn):"r"===fn&&(ct?Pt.remove():(Vt["s-cr"]=Pt,Pt["s-cn"]=!0))));else if(Ie&&"style"===Ie.$tag$){const St=jn(null,Pt.textContent);St.$elm$=Pt,St.$index$="0",Ie.$children$=[St]}},Ct=(Ie,_e)=>{if(1===Ie.nodeType){let qe=0;for(;qe<Ie.childNodes.length;qe++)Ct(Ie.childNodes[qe],_e);if(Ie.shadowRoot)for(qe=0;qe<Ie.shadowRoot.childNodes.length;qe++)Ct(Ie.shadowRoot.childNodes[qe],_e)}else if(8===Ie.nodeType){const qe=Ie.nodeValue.split(".");"o"===qe[0]&&(_e.set(qe[1]+"."+qe[2],Ie),Ie.nodeValue="",Ie["s-en"]=qe[3])}},Gt=(Ie,_e,qe)=>{if(_e.$members$){Ie.watchers&&(_e.$watchers$=Ie.watchers);const ct=Object.entries(_e.$members$),Vt=Ie.prototype;if(ct.map(([Pt,[rn]])=>{31&rn||2&qe&&32&rn?Object.defineProperty(Vt,Pt,{get(){return((Ie,_e)=>di(this).$instanceValues$.get(_e))(0,Pt)},set(fn){((Ie,_e,qe,ct)=>{const Vt=di(Ie),Pt=Vt.$hostElement$,rn=Vt.$instanceValues$.get(_e),fn=Vt.$flags$,un=Vt.$lazyInstance$;if(qe=((Ie,_e)=>null==Ie||On(Ie)?Ie:4&_e?"false"!==Ie&&(""===Ie||!!Ie):2&_e?parseFloat(Ie):1&_e?String(Ie):Ie)(qe,ct.$members$[_e][0]),(!(8&fn)||void 0===rn)&&qe!==rn&&(Vt.$instanceValues$.set(_e,qe),un)){if(ct.$watchers$&&128&fn){const Cn=ct.$watchers$[_e];Cn&&Cn.map(Un=>{try{un[Un](qe,rn,_e)}catch(St){Ni(St,Pt)}})}2==(18&fn)&&kr(Vt,!1)}})(this,Pt,fn,_e)},configurable:!0,enumerable:!0}):1&qe&&64&rn&&Object.defineProperty(Vt,Pt,{value(...fn){const un=di(this);return un.$onInstancePromise$.then(()=>un.$lazyInstance$[Pt](...fn))}})}),1&qe){const Pt=new Map;Vt.attributeChangedCallback=function(rn,fn,un){ye.jmp(()=>{const Cn=Pt.get(rn);this[Cn]=(null!==un||"boolean"!=typeof this[Cn])&&un})},Ie.observedAttributes=ct.filter(([rn,fn])=>15&fn[0]).map(([rn,fn])=>{const un=fn[1]||rn;return Pt.set(un,rn),512&fn[0]&&_e.$attrsToReflect$.push([rn,un]),un})}}return Ie},At=function(){var Ie=(0,b.Z)(function*(_e,qe,ct,Vt,Pt){if(0==(32&qe.$flags$)){{if(qe.$flags$|=32,(Pt=oi(ct)).then){const Cn=()=>{};Pt=yield Pt,Cn()}Pt.isProxied||(ct.$watchers$=Pt.watchers,Gt(Pt,ct,2),Pt.isProxied=!0);const un=()=>{};qe.$flags$|=8;try{new Pt(qe)}catch(Cn){Ni(Cn)}qe.$flags$&=-9,qe.$flags$|=128,un(),Pn(qe.$lazyInstance$)}if(Pt.style){let un=Pt.style;"string"!=typeof un&&(un=un[qe.$modeName$=(Ie=>or.map(_e=>_e(Ie)).find(_e=>!!_e))(_e)]);const Cn=Yt(ct,qe.$modeName$);if(!fr.has(Cn)){const Un=()=>{};8&ct.$flags$&&(un=yield k.e(2861).then(k.bind(k,2861)).then(St=>St.scopeCss(un,Cn,!1))),It(Cn,un,!!(1&ct.$flags$)),Un()}}}const rn=qe.$ancestorComponent$,fn=()=>kr(qe,!0);rn&&rn["s-rc"]?rn["s-rc"].push(fn):fn()});return function(qe,ct,Vt,Pt,rn){return Ie.apply(this,arguments)}}(),Pn=Ie=>{L(Ie,"connectedCallback")},Yn=Ie=>{const _e=Ie["s-cr"]=ue.createComment("");_e["s-cn"]=!0,Ie.insertBefore(_e,Ie.firstChild)},ni=(Ie,_e={})=>{const ct=[],Vt=_e.exclude||[],Pt=Y.customElements,rn=ue.head,fn=rn.querySelector("meta[charset]"),un=ue.createElement("style"),Cn=[],Un=ue.querySelectorAll(`[${ht}]`);let St,on=!0,Ri=0;for(Object.assign(ye,_e),ye.$resourcesUrl$=new URL(_e.resourcesUrl||"./",ue.baseURI).href,ye.$flags$|=2;Ri<Un.length;Ri++)It(Un[Ri].getAttribute(ht),zt(Un[Ri].innerHTML),!0);Ie.map(Ur=>Ur[1].map(ji=>{const _r={$flags$:ji[0],$tagName$:ji[1],$members$:ji[2],$listeners$:ji[3]};_r.$members$=ji[2],_r.$listeners$=ji[3],_r.$attrsToReflect$=[],_r.$watchers$={},!xe&&1&_r.$flags$&&(_r.$flags$|=8);const Qi=_r.$tagName$,Ao=class extends HTMLElement{constructor(fo){super(fo),ti(fo=this,_r),1&_r.$flags$&&(xe?fo.attachShadow({mode:"open",delegatesFocus:!!(16&_r.$flags$)}):"shadowRoot"in fo||(fo.shadowRoot=fo))}connectedCallback(){St&&(clearTimeout(St),St=null),on?Cn.push(this):ye.jmp(()=>(Ie=>{if(0==(1&ye.$flags$)){const _e=di(Ie),qe=_e.$cmpMeta$,ct=()=>{};if(1&_e.$flags$)be(Ie,_e,qe.$listeners$),Pn(_e.$lazyInstance$);else{let Vt;if(_e.$flags$|=1,Vt=Ie.getAttribute(_t),Vt){if(xe&&1&qe.$flags$){const Pt=jt(Ie.shadowRoot,qe,Ie.getAttribute("s-mode"));Ie.classList.remove(Pt+"-h",Pt+"-s")}((Ie,_e,qe,ct)=>{const Pt=Ie.shadowRoot,rn=[],un=Pt?[]:null,Cn=ct.$vnode$=jn(_e,null);ye.$orgLocNodes$||Ct(ue.body,ye.$orgLocNodes$=new Map),Ie[_t]=qe,Ie.removeAttribute(_t),pt(Cn,rn,[],un,Ie,Ie,qe),rn.map(Un=>{const St=Un.$hostId$+"."+Un.$nodeId$,on=ye.$orgLocNodes$.get(St),Ri=Un.$elm$;on&&xe&&""===on["s-en"]&&on.parentNode.insertBefore(Ri,on.nextSibling),Pt||(Ri["s-hn"]=_e,on&&(Ri["s-ol"]=on,Ri["s-ol"]["s-nr"]=Ri)),ye.$orgLocNodes$.delete(St)}),Pt&&un.map(Un=>{Un&&Pt.appendChild(Un)})})(Ie,qe.$tagName$,Vt,_e)}Vt||12&qe.$flags$&&Yn(Ie);{let Pt=Ie;for(;Pt=Pt.parentNode||Pt.host;)if(1===Pt.nodeType&&Pt.hasAttribute("s-id")&&Pt["s-p"]||Pt["s-p"]){yi(_e,_e.$ancestorComponent$=Pt);break}}qe.$members$&&Object.entries(qe.$members$).map(([Pt,[rn]])=>{if(31&rn&&Ie.hasOwnProperty(Pt)){const fn=Ie[Pt];delete Ie[Pt],Ie[Pt]=fn}}),jr(()=>At(Ie,_e,qe))}ct()}})(this))}disconnectedCallback(){ye.jmp(()=>(Ie=>{if(0==(1&ye.$flags$)){const _e=di(Ie),qe=_e.$lazyInstance$;_e.$rmListeners$&&(_e.$rmListeners$.map(ct=>ct()),_e.$rmListeners$=void 0),ye.$cssShim$&&ye.$cssShim$.removeHost(Ie),L(qe,"disconnectedCallback")}})(this))}componentOnReady(){return di(this).$onReadyPromise$}};_r.$lazyBundleId$=Ur[0],!Vt.includes(Qi)&&!Pt.get(Qi)&&(ct.push(Qi),Pt.define(Qi,Gt(Ao,_r,1)))})),un.innerHTML=ct+"{visibility:hidden}.hydrated{visibility:inherit}",un.setAttribute("data-styles",""),rn.insertBefore(un,fn?fn.nextSibling:rn.firstChild),on=!1,Cn.length?Cn.map(Ur=>Ur.connectedCallback()):ye.jmp(()=>St=setTimeout(q,30))},Li=Ie=>{const _e=new URL(Ie,ye.$resourcesUrl$);return _e.origin!==Y.location.origin?_e.href:_e.pathname},Mi=new WeakMap,di=Ie=>Mi.get(Ie),En=(Ie,_e)=>Mi.set(_e.$lazyInstance$=Ie,_e),ti=(Ie,_e)=>{const qe={$flags$:0,$hostElement$:Ie,$cmpMeta$:_e,$instanceValues$:new Map};return qe.$onInstancePromise$=new Promise(ct=>qe.$onInstanceResolve$=ct),qe.$onReadyPromise$=new Promise(ct=>qe.$onReadyResolve$=ct),Ie["s-p"]=[],Ie["s-rc"]=[],be(Ie,qe,_e.$listeners$),Mi.set(Ie,qe)},Yi=(Ie,_e)=>_e in Ie,Ni=(Ie,_e)=>(0,console.error)(Ie,_e),pr=new Map,oi=(Ie,_e,qe)=>{const ct=Ie.$tagName$.replace(/-/g,"_"),Vt=Ie.$lazyBundleId$,Pt=pr.get(Vt);return Pt?Pt[ct]:k(863)(`./${Vt}.entry.js`).then(rn=>(pr.set(Vt,rn),rn[ct]),Ni)},fr=new Map,or=[],Sr=[],wo=[],xi=(Ie,_e)=>qe=>{Ie.push(qe),Q||(Q=!0,_e&&4&ye.$flags$?jr($r):ye.raf($r))},io=Ie=>{for(let _e=0;_e<Ie.length;_e++)try{Ie[_e](performance.now())}catch(qe){Ni(qe)}Ie.length=0},$r=()=>{io(Sr),io(wo),(Q=Sr.length>0)&&ye.raf($r)},jr=Ie=>Ee().then(Ie),Pr=xi(Sr,!1),Cr=xi(wo,!0),to={isDev:!1,isBrowser:!0,isServer:!1,isTesting:!1}},2307:(An,vt,k)=>{"use strict";k.d(vt,{L:()=>l,a:()=>J,b:()=>j,c:()=>g,d:()=>ne,e:()=>Ge,g:()=>wt,l:()=>Be,s:()=>_t,t:()=>Y});var b=k(6099),d=k(5225),pe=k(6536);const l="ionViewWillEnter",J="ionViewDidEnter",j="ionViewWillLeave",g="ionViewDidLeave",ne="ionViewWillUnload",Y=xt=>new Promise((gt,Bt)=>{(0,d.c)(()=>{se(xt),ue(xt).then(Ht=>{Ht.animation&&Ht.animation.destroy(),ye(xt),gt(Ht)},Ht=>{ye(xt),Bt(Ht)})})}),se=xt=>{const gt=xt.enteringEl,Bt=xt.leavingEl;ht(gt,Bt,xt.direction),xt.showGoBack?gt.classList.add("can-go-back"):gt.classList.remove("can-go-back"),_t(gt,!1),gt.style.setProperty("pointer-events","none"),Bt&&(_t(Bt,!1),Bt.style.setProperty("pointer-events","none"))},ue=function(){var xt=(0,b.Z)(function*(gt){const Bt=yield xe(gt);return Bt&&d.B.isBrowser?Ee(Bt,gt):We(gt)});return function(Bt){return xt.apply(this,arguments)}}(),ye=xt=>{const gt=xt.enteringEl,Bt=xt.leavingEl;gt.classList.remove("ion-page-invisible"),gt.style.removeProperty("pointer-events"),void 0!==Bt&&(Bt.classList.remove("ion-page-invisible"),Bt.style.removeProperty("pointer-events"))},xe=function(){var xt=(0,b.Z)(function*(gt){return gt.leavingEl&&gt.animated&&0!==gt.duration?gt.animationBuilder?gt.animationBuilder:"ios"===gt.mode?(yield Promise.resolve().then(k.bind(k,8127))).iosTransitionAnimation:(yield Promise.resolve().then(k.bind(k,62))).mdTransitionAnimation:void 0});return function(Bt){return xt.apply(this,arguments)}}(),Ee=function(){var xt=(0,b.Z)(function*(gt,Bt){yield be(Bt,!0);const Ht=gt(Bt.baseEl,Bt);tt(Bt.enteringEl,Bt.leavingEl);const Gn=yield ze(Ht,Bt);return Bt.progressCallback&&Bt.progressCallback(void 0),Gn&&et(Bt.enteringEl,Bt.leavingEl),{hasCompleted:Gn,animation:Ht}});return function(Bt,Ht){return xt.apply(this,arguments)}}(),We=function(){var xt=(0,b.Z)(function*(gt){const Bt=gt.enteringEl,Ht=gt.leavingEl;return yield be(gt,!1),tt(Bt,Ht),et(Bt,Ht),{hasCompleted:!0}});return function(Bt){return xt.apply(this,arguments)}}(),be=function(){var xt=(0,b.Z)(function*(gt,Bt){const Gn=(void 0!==gt.deepWait?gt.deepWait:Bt)?[Ge(gt.enteringEl),Ge(gt.leavingEl)]:[C(gt.enteringEl),C(gt.leavingEl)];yield Promise.all(Gn),yield Se(gt.viewIsReady,gt.enteringEl)});return function(Bt,Ht){return xt.apply(this,arguments)}}(),Se=function(){var xt=(0,b.Z)(function*(gt,Bt){gt&&(yield gt(Bt))});return function(Bt,Ht){return xt.apply(this,arguments)}}(),ze=(xt,gt)=>{const Bt=gt.progressCallback,Ht=new Promise(Gn=>{xt.onFinish(It=>Gn(1===It))});return Bt?(xt.progressStart(!0),Bt(xt)):xt.play(),Ht},tt=(xt,gt)=>{Be(gt,j),Be(xt,l)},et=(xt,gt)=>{Be(xt,J),Be(gt,g)},Be=(xt,gt)=>{if(xt){const Bt=new CustomEvent(gt,{bubbles:!1,cancelable:!1});xt.dispatchEvent(Bt)}},C=xt=>xt?new Promise(gt=>(0,pe.c)(xt,gt)):Promise.resolve(),Ge=function(){var xt=(0,b.Z)(function*(gt){const Bt=gt;if(Bt){if(null!=Bt.componentOnReady&&null!=(yield Bt.componentOnReady()))return;yield Promise.all(Array.from(Bt.children).map(Ge))}});return function(Bt){return xt.apply(this,arguments)}}(),_t=(xt,gt)=>{gt?(xt.setAttribute("aria-hidden","true"),xt.classList.add("ion-page-hidden")):(xt.hidden=!1,xt.removeAttribute("aria-hidden"),xt.classList.remove("ion-page-hidden"))},ht=(xt,gt,Bt)=>{void 0!==xt&&(xt.style.zIndex="back"===Bt?"99":"101"),void 0!==gt&&(gt.style.zIndex="100")},wt=xt=>xt.classList.contains("ion-page")?xt:xt.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")||xt},9821:(An,vt,k)=>{"use strict";k.d(vt,{a:()=>pe,b:()=>Gn,c:()=>Ge,g:()=>d,i:()=>It});var b=k(5225);const d=jt=>l(jt),pe=(jt,Ut)=>("string"==typeof jt&&(Ut=jt,jt=void 0),d(jt).includes(Ut)),l=(jt=window)=>{if(void 0===jt)return[];jt.Ionic=jt.Ionic||{};let Ut=jt.Ionic.platforms;return null==Ut&&(Ut=jt.Ionic.platforms=J(jt),Ut.forEach(Yt=>jt.document.documentElement.classList.add(`plt-${Yt}`))),Ut},J=jt=>Object.keys(Be).filter(Ut=>Be[Ut](jt)),g=jt=>!!(tt(jt,/iPad/i)||tt(jt,/Macintosh/i)&&ye(jt)),Q=jt=>tt(jt,/android|sink/i),ye=jt=>et(jt,"(any-pointer:coarse)"),Ee=jt=>We(jt)||be(jt),We=jt=>!!(jt.cordova||jt.phonegap||jt.PhoneGap),be=jt=>{const Ut=jt.Capacitor;return!(!Ut||!Ut.isNative)},tt=(jt,Ut)=>Ut.test(jt.navigator.userAgent),et=(jt,Ut)=>jt.matchMedia(Ut).matches,Be={ipad:g,iphone:jt=>tt(jt,/iPhone/i),ios:jt=>tt(jt,/iPhone|iPod/i)||g(jt),android:Q,phablet:jt=>{const Ut=jt.innerWidth,Yt=jt.innerHeight,zt=Math.min(Ut,Yt),Zt=Math.max(Ut,Yt);return zt>390&&zt<520&&Zt>620&&Zt<800},tablet:jt=>{const Ut=jt.innerWidth,Yt=jt.innerHeight,zt=Math.min(Ut,Yt),Zt=Math.max(Ut,Yt);return g(jt)||(jt=>Q(jt)&&!tt(jt,/mobile/i))(jt)||zt>460&&zt<820&&Zt>780&&Zt<1400},cordova:We,capacitor:be,electron:jt=>tt(jt,/electron/i),pwa:jt=>!(!jt.matchMedia("(display-mode: standalone)").matches&&!jt.navigator.standalone),mobile:ye,mobileweb:jt=>ye(jt)&&!Ee(jt),desktop:jt=>!ye(jt),hybrid:Ee};class C{constructor(){this.m=new Map}reset(Ut){this.m=new Map(Object.entries(Ut))}get(Ut,Yt){const zt=this.m.get(Ut);return void 0!==zt?zt:Yt}getBoolean(Ut,Yt=!1){const zt=this.m.get(Ut);return void 0===zt?Yt:"string"==typeof zt?"true"===zt:!!zt}getNumber(Ut,Yt){const zt=parseFloat(this.m.get(Ut));return isNaN(zt)?void 0!==Yt?Yt:NaN:zt}set(Ut,Yt){this.m.set(Ut,Yt)}}const Ge=new C,Bt="ionic-persist-config";let Ht;const Gn=jt=>jt&&(0,b.g)(jt)||Ht,It=(jt={})=>{if("undefined"==typeof window)return;const Ut=window.document,Yt=window,zt=Yt.Ionic=Yt.Ionic||{};l(Yt);const Zt=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},(jt=>{try{const Ut=jt.sessionStorage.getItem(Bt);return null!==Ut?JSON.parse(Ut):{}}catch{return{}}})(Yt)),{persistConfig:!1}),zt.config),(jt=>{const Ut={};return jt.location.search.slice(1).split("&").map(Yt=>Yt.split("=")).map(([Yt,zt])=>[decodeURIComponent(Yt),decodeURIComponent(zt)]).filter(([Yt])=>((jt,Ut)=>jt.substr(0,Ut.length)===Ut)(Yt,"ionic:")).map(([Yt,zt])=>[Yt.slice("ionic:".length),zt]).forEach(([Yt,zt])=>{Ut[Yt]=zt}),Ut})(Yt)),jt);Ge.reset(Zt),Ge.getBoolean("persistConfig")&&((jt,Ut)=>{try{jt.sessionStorage.setItem(Bt,JSON.stringify(Ut))}catch{return}})(Yt,Zt),zt.config=Ge,zt.mode=Ht=Ge.get("mode",Ut.documentElement.getAttribute("mode")||(pe(Yt,"ios")?"ios":"md")),Ge.set("mode",Ht),Ut.documentElement.setAttribute("mode",Ht),Ut.documentElement.classList.add(Ht),Ge.getBoolean("_testing")&&Ge.set("animated",!1);const ln=an=>an.tagName&&an.tagName.startsWith("ION-"),xn=an=>["ios","md"].includes(an);(0,b.s)(an=>{for(;an;){const Kt=an.mode||an.getAttribute("mode");if(Kt){if(xn(Kt))return Kt;ln(an)&&console.warn('Invalid ionic mode: "'+Kt+'", expected: "ios" or "md"')}an=an.parentElement}return Ht})}},8127:(An,vt,k)=>{"use strict";k.r(vt),k.d(vt,{iosTransitionAnimation:()=>se,shadow:()=>j});var b=k(929),d=k(2307);k(5225);const J=ue=>document.querySelector(`${ue}.ion-cloned-element`),j=ue=>ue.shadowRoot||ue,g=ue=>{const ye="ION-TABS"===ue.tagName?ue:ue.querySelector("ion-tabs"),xe="ion-content ion-header:not(.header-collapse-condense-inactive) ion-title.title-large";if(null!=ye){const Ee=ye.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");return null!=Ee?Ee.querySelector(xe):null}return ue.querySelector(xe)},ne=(ue,ye)=>{const xe="ION-TABS"===ue.tagName?ue:ue.querySelector("ion-tabs");let Ee=[];if(null!=xe){const We=xe.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");null!=We&&(Ee=We.querySelectorAll("ion-buttons"))}else Ee=ue.querySelectorAll("ion-buttons");for(const We of Ee){const be=We.closest("ion-header"),Se=be&&!be.classList.contains("header-collapse-condense-inactive"),ze=We.querySelector("ion-back-button"),tt=We.classList.contains("buttons-collapse"),et="start"===We.slot||""===We.slot;if(null!==ze&&et&&(tt&&Se&&ye||!tt))return ze}return null},Q=(ue,ye,xe,Ee,We,be)=>{const Se=ye?`calc(100% - ${be.right+4}px)`:be.left-4+"px",ze=ye?"7px":"-7px",tt=ye?"-4px":"4px",et=ye?"-4px":"4px",Be=ye?"right":"left",C=ye?"left":"right",ht=xe?[{offset:0,opacity:1,transform:`translate3d(${tt}, ${be.top-46}px, 0) scale(1)`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${ze}, ${We.top-40}px, 0) scale(2.1)`}]:[{offset:0,opacity:0,transform:`translate3d(${ze}, ${We.top-40}px, 0) scale(2.1)`},{offset:1,opacity:1,transform:`translate3d(${tt}, ${be.top-46}px, 0) scale(1)`}],gt=xe?[{offset:0,opacity:1,transform:`translate3d(${et}, ${be.top-46}px, 0) scale(1)`},{offset:.2,opacity:0,transform:`translate3d(${et}, ${be.top-41}px, 0) scale(0.6)`},{offset:1,opacity:0,transform:`translate3d(${et}, ${be.top-41}px, 0) scale(0.6)`}]:[{offset:0,opacity:0,transform:`translate3d(${et}, ${be.top-41}px, 0) scale(0.6)`},{offset:1,opacity:1,transform:`translate3d(${et}, ${be.top-46}px, 0) scale(1)`}],Bt=(0,b.c)(),Ht=(0,b.c)(),Gn=J("ion-back-button"),It=j(Gn).querySelector(".button-text"),jt=j(Gn).querySelector("ion-icon");Gn.text=Ee.text,Gn.mode=Ee.mode,Gn.icon=Ee.icon,Gn.color=Ee.color,Gn.disabled=Ee.disabled,Gn.style.setProperty("display","block"),Gn.style.setProperty("position","fixed"),Ht.addElement(jt),Bt.addElement(It),Bt.beforeStyles({"transform-origin":`${Be} center`}).beforeAddWrite(()=>{Ee.style.setProperty("display","none"),Gn.style.setProperty(Be,Se)}).afterAddWrite(()=>{Ee.style.setProperty("display",""),Gn.style.setProperty("display","none"),Gn.style.removeProperty(Be)}).keyframes(ht),Ht.beforeStyles({"transform-origin":`${C} center`}).keyframes(gt),ue.addAnimation([Bt,Ht])},Y=(ue,ye,xe,Ee,We,be)=>{const Se=ye?`calc(100% - ${We.right}px)`:`${We.left}px`,ze=ye?"-18px":"18px",tt=ye?"right":"left",C=xe?[{offset:0,opacity:0,transform:`translate3d(${ze}, ${be.top-4}px, 0) scale(0.49)`},{offset:.1,opacity:0},{offset:1,opacity:1,transform:`translate3d(0, ${We.top-2}px, 0) scale(1)`}]:[{offset:0,opacity:.99,transform:`translate3d(0, ${We.top-2}px, 0) scale(1)`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${ze}, ${be.top-4}px, 0) scale(0.5)`}],Ge=J("ion-title"),_t=(0,b.c)();Ge.innerText=Ee.innerText,Ge.size=Ee.size,Ge.color=Ee.color,_t.addElement(Ge),_t.beforeStyles({"transform-origin":`${tt} center`,height:"46px",display:"",position:"relative",[tt]:Se}).beforeAddWrite(()=>{Ee.style.setProperty("display","none")}).afterAddWrite(()=>{Ee.style.setProperty("display",""),Ge.style.setProperty("display","none")}).keyframes(C),ue.addAnimation(_t)},se=(ue,ye)=>{try{const xe="cubic-bezier(0.32,0.72,0,1)",Ee="opacity",We="transform",be="0%",Se=.8,ze="rtl"===ue.ownerDocument.dir,tt=ze?"-99.5%":"99.5%",et=ze?"33%":"-33%",Be=ye.enteringEl,C=ye.leavingEl,Ge="back"===ye.direction,_t=Be.querySelector(":scope > ion-content"),ht=Be.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *"),wt=Be.querySelectorAll(":scope > ion-header > ion-toolbar"),xt=(0,b.c)(),gt=(0,b.c)();if(xt.addElement(Be).duration(ye.duration||540).easing(ye.easing||xe).fill("both").beforeRemoveClass("ion-page-invisible"),C&&ue){const It=(0,b.c)();It.addElement(ue),xt.addAnimation(It)}if(_t||0!==wt.length||0!==ht.length?(gt.addElement(_t),gt.addElement(ht)):gt.addElement(Be.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),xt.addAnimation(gt),Ge?gt.beforeClearStyles([Ee]).fromTo("transform",`translateX(${et})`,`translateX(${be})`).fromTo(Ee,Se,1):gt.beforeClearStyles([Ee]).fromTo("transform",`translateX(${tt})`,`translateX(${be})`),_t){const It=j(_t).querySelector(".transition-effect");if(It){const jt=It.querySelector(".transition-cover"),Ut=It.querySelector(".transition-shadow"),Yt=(0,b.c)(),zt=(0,b.c)(),Zt=(0,b.c)();Yt.addElement(It).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),zt.addElement(jt).beforeClearStyles([Ee]).fromTo(Ee,0,.1),Zt.addElement(Ut).beforeClearStyles([Ee]).fromTo(Ee,.03,.7),Yt.addAnimation([zt,Zt]),gt.addAnimation([Yt])}}const Bt=Be.querySelector("ion-header.header-collapse-condense"),{forward:Ht,backward:Gn}=((ue,ye,xe,Ee,We)=>{const be=ne(Ee,xe),Se=g(We),ze=g(Ee),tt=ne(We,xe),et=null!==be&&null!==Se&&!xe,Be=null!==ze&&null!==tt&&xe;if(et){const C=Se.getBoundingClientRect(),Ge=be.getBoundingClientRect();Y(ue,ye,xe,Se,C,Ge),Q(ue,ye,xe,be,C,Ge)}else if(Be){const C=ze.getBoundingClientRect(),Ge=tt.getBoundingClientRect();Y(ue,ye,xe,ze,C,Ge),Q(ue,ye,xe,tt,C,Ge)}return{forward:et,backward:Be}})(xt,ze,Ge,Be,C);if(wt.forEach(It=>{const jt=(0,b.c)();jt.addElement(It),xt.addAnimation(jt);const Ut=(0,b.c)();Ut.addElement(It.querySelector("ion-title"));const Yt=(0,b.c)(),zt=Array.from(It.querySelectorAll("ion-buttons,[menuToggle]")),Zt=It.closest("ion-header"),ln=Zt&&Zt.classList.contains("header-collapse-condense-inactive");let xn;xn=zt.filter(Ge?On=>{const bn=On.classList.contains("buttons-collapse");return bn&&!ln||!bn}:On=>!On.classList.contains("buttons-collapse")),Yt.addElement(xn);const an=(0,b.c)();an.addElement(It.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])"));const Kt=(0,b.c)();Kt.addElement(j(It).querySelector(".toolbar-background"));const mt=(0,b.c)(),Wt=It.querySelector("ion-back-button");if(Wt&&mt.addElement(Wt),jt.addAnimation([Ut,Yt,an,Kt,mt]),Yt.fromTo(Ee,.01,1),an.fromTo(Ee,.01,1),Ge)ln||Ut.fromTo("transform",`translateX(${et})`,`translateX(${be})`).fromTo(Ee,.01,1),an.fromTo("transform",`translateX(${et})`,`translateX(${be})`),mt.fromTo(Ee,.01,1);else if(Bt||Ut.fromTo("transform",`translateX(${tt})`,`translateX(${be})`).fromTo(Ee,.01,1),an.fromTo("transform",`translateX(${tt})`,`translateX(${be})`),Kt.beforeClearStyles([Ee,"transform"]),(null==Zt?void 0:Zt.translucent)?Kt.fromTo("transform",ze?"translateX(-100%)":"translateX(100%)","translateX(0px)"):Kt.fromTo(Ee,.01,"var(--opacity)"),Ht||mt.fromTo(Ee,.01,1),Wt&&!Ht){const bn=(0,b.c)();bn.addElement(j(Wt).querySelector(".button-text")).fromTo("transform",ze?"translateX(-100px)":"translateX(100px)","translateX(0px)"),jt.addAnimation(bn)}}),C){const It=(0,b.c)(),jt=C.querySelector(":scope > ion-content"),Ut=C.querySelectorAll(":scope > ion-header > ion-toolbar"),Yt=C.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *");if(jt||0!==Ut.length||0!==Yt.length?(It.addElement(jt),It.addElement(Yt)):It.addElement(C.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),xt.addAnimation(It),Ge){It.beforeClearStyles([Ee]).fromTo("transform",`translateX(${be})`,ze?"translateX(-100%)":"translateX(100%)");const zt=(0,d.g)(C);xt.afterAddWrite(()=>{"normal"===xt.getDirection()&&zt.style.setProperty("display","none")})}else It.fromTo("transform",`translateX(${be})`,`translateX(${et})`).fromTo(Ee,1,Se);if(jt){const zt=j(jt).querySelector(".transition-effect");if(zt){const Zt=zt.querySelector(".transition-cover"),ln=zt.querySelector(".transition-shadow"),xn=(0,b.c)(),an=(0,b.c)(),Kt=(0,b.c)();xn.addElement(zt).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),an.addElement(Zt).beforeClearStyles([Ee]).fromTo(Ee,.1,0),Kt.addElement(ln).beforeClearStyles([Ee]).fromTo(Ee,.7,.03),xn.addAnimation([an,Kt]),It.addAnimation([xn])}}Ut.forEach(zt=>{const Zt=(0,b.c)();Zt.addElement(zt);const ln=(0,b.c)();ln.addElement(zt.querySelector("ion-title"));const xn=(0,b.c)(),an=zt.querySelectorAll("ion-buttons,[menuToggle]"),Kt=zt.closest("ion-header"),mt=Kt&&Kt.classList.contains("header-collapse-condense-inactive"),Wt=Array.from(an).filter(rr=>{const Bi=rr.classList.contains("buttons-collapse");return Bi&&!mt||!Bi});xn.addElement(Wt);const On=(0,b.c)(),bn=zt.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])");bn.length>0&&On.addElement(bn);const jn=(0,b.c)();jn.addElement(j(zt).querySelector(".toolbar-background"));const li=(0,b.c)(),$i=zt.querySelector("ion-back-button");if($i&&li.addElement($i),Zt.addAnimation([ln,xn,On,li,jn]),xt.addAnimation(Zt),li.fromTo(Ee,.99,0),xn.fromTo(Ee,.99,0),On.fromTo(Ee,.99,0),Ge){if(mt||ln.fromTo("transform",`translateX(${be})`,ze?"translateX(-100%)":"translateX(100%)").fromTo(Ee,.99,0),On.fromTo("transform",`translateX(${be})`,ze?"translateX(-100%)":"translateX(100%)"),jn.beforeClearStyles([Ee,"transform"]),(null==Kt?void 0:Kt.translucent)?jn.fromTo("transform","translateX(0px)",ze?"translateX(-100%)":"translateX(100%)"):jn.fromTo(Ee,"var(--opacity)",0),$i&&!Gn){const Bi=(0,b.c)();Bi.addElement(j($i).querySelector(".button-text")).fromTo("transform",`translateX(${be})`,`translateX(${(ze?-124:124)+"px"})`),Zt.addAnimation(Bi)}}else mt||ln.fromTo("transform",`translateX(${be})`,`translateX(${et})`).fromTo(Ee,.99,0).afterClearStyles([We,Ee]),On.fromTo("transform",`translateX(${be})`,`translateX(${et})`).afterClearStyles([We,Ee]),li.afterClearStyles([Ee]),ln.afterClearStyles([Ee]),xn.afterClearStyles([Ee])})}return xt}catch(xe){throw xe}}},62:(An,vt,k)=>{"use strict";k.r(vt),k.d(vt,{mdTransitionAnimation:()=>l});var b=k(929),d=k(2307);k(5225);const l=(J,j)=>{const ge="back"===j.direction,Y=j.leavingEl,se=(0,d.g)(j.enteringEl),ue=se.querySelector("ion-toolbar"),ye=(0,b.c)();if(ye.addElement(se).fill("both").beforeRemoveClass("ion-page-invisible"),ge?ye.duration(j.duration||200).easing("cubic-bezier(0.47,0,0.745,0.715)"):ye.duration(j.duration||280).easing("cubic-bezier(0.36,0.66,0.04,1)").fromTo("transform","translateY(40px)","translateY(0px)").fromTo("opacity",.01,1),ue){const xe=(0,b.c)();xe.addElement(ue),ye.addAnimation(xe)}if(Y&&ge){ye.duration(j.duration||200).easing("cubic-bezier(0.47,0,0.745,0.715)");const xe=(0,b.c)();xe.addElement((0,d.g)(Y)).onFinish(Ee=>{1===Ee&&xe.elements.length>0&&xe.elements[0].style.setProperty("display","none")}).fromTo("transform","translateY(0px)","translateY(40px)").fromTo("opacity",1,0),ye.addAnimation(xe)}return ye}},7350:(An,vt,k)=>{"use strict";k.d(vt,{B:()=>Yt,a:()=>ne,b:()=>ge,c:()=>ue,d:()=>ht,e:()=>xe,f:()=>xt,g:()=>Ht,h:()=>j,i:()=>It,l:()=>Q,m:()=>Y,p:()=>se,s:()=>Ut,t:()=>ye});var b=k(6099),d=k(9821),pe=k(6247),l=k(6536);let J=0;const j=new WeakMap,g=zt=>({create:Zt=>Ee(zt,Zt),dismiss:(Zt,ln,xn)=>Be(document,Zt,ln,zt,xn),getTop:()=>(0,b.Z)(function*(){return Ge(document,zt)})()}),ne=g("ion-alert"),ge=g("ion-action-sheet"),Q=g("ion-loading"),Y=g("ion-modal"),se=g("ion-picker"),ue=g("ion-popover"),ye=g("ion-toast"),xe=zt=>{"undefined"!=typeof document&&et(document);const Zt=J++;zt.overlayIndex=Zt,zt.hasAttribute("id")||(zt.id=`ion-overlay-${Zt}`)},Ee=(zt,Zt)=>"undefined"!=typeof customElements?customElements.whenDefined(zt).then(()=>{const ln=document.createElement(zt);return ln.classList.add("overlay-hidden"),Object.assign(ln,Zt),gt(document).appendChild(ln),new Promise(xn=>(0,l.c)(ln,xn))}):Promise.resolve(),We='[tabindex]:not([tabindex^="-"]), input:not([type=hidden]):not([tabindex^="-"]), textarea:not([tabindex^="-"]), button:not([tabindex^="-"]), select:not([tabindex^="-"]), .ion-focusable:not([tabindex^="-"])',be="input:not([type=hidden]), textarea, button, select",et=zt=>{0===J&&(J=1,zt.addEventListener("focus",Zt=>((zt,Zt)=>{const ln=Ge(Zt),xn=zt.target;if(ln&&xn)if(ln===xn)ln.lastFocus=void 0;else{const an=(0,l.g)(ln);if(!an.contains(xn))return;const Kt=an.querySelector(".ion-overlay-wrapper");if(!Kt)return;if(Kt.contains(xn))ln.lastFocus=xn;else{const mt=ln.lastFocus;((zt,Zt)=>{let ln=zt.querySelector(We);const xn=ln&&ln.shadowRoot;xn&&(ln=xn.querySelector(be)||ln),ln?ln.focus():Zt.focus()})(Kt,ln),mt===Zt.activeElement&&((zt,Zt)=>{const ln=Array.from(zt.querySelectorAll(We));let xn=ln.length>0?ln[ln.length-1]:null;const an=xn&&xn.shadowRoot;an&&(xn=an.querySelector(be)||xn),xn?xn.focus():Zt.focus()})(Kt,ln),ln.lastFocus=Zt.activeElement}}})(Zt,zt),!0),zt.addEventListener("ionBackButton",Zt=>{const ln=Ge(zt);ln&&ln.backdropDismiss&&Zt.detail.register(pe.OVERLAY_BACK_BUTTON_PRIORITY,()=>ln.dismiss(void 0,Yt))}),zt.addEventListener("keyup",Zt=>{if("Escape"===Zt.key){const ln=Ge(zt);ln&&ln.backdropDismiss&&ln.dismiss(void 0,Yt)}}))},Be=(zt,Zt,ln,xn,an)=>{const Kt=Ge(zt,xn,an);return Kt?Kt.dismiss(Zt,ln):Promise.reject("overlay does not exist")},Ge=(zt,Zt,ln)=>{const xn=((zt,Zt)=>(void 0===Zt&&(Zt="ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker,ion-popover,ion-toast"),Array.from(zt.querySelectorAll(Zt)).filter(ln=>ln.overlayIndex>0)))(zt,Zt);return void 0===ln?xn[xn.length-1]:xn.find(an=>an.id===ln)},_t=(zt=!1)=>{const ln=gt(document).querySelector("ion-router-outlet, ion-nav, #ion-view-container-root");!ln||(zt?ln.setAttribute("aria-hidden","true"):ln.removeAttribute("aria-hidden"))},ht=function(){var zt=(0,b.Z)(function*(Zt,ln,xn,an,Kt){if(Zt.presented)return;_t(!0),Zt.presented=!0,Zt.willPresent.emit();const mt=(0,d.b)(Zt),Wt=Zt.enterAnimation?Zt.enterAnimation:d.c.get(ln,"ios"===mt?xn:an);(yield Bt(Zt,Wt,Zt.el,Kt))&&Zt.didPresent.emit(),"ION-TOAST"!==Zt.el.tagName&&wt(Zt.el),Zt.keyboardClose&&Zt.el.focus()});return function(ln,xn,an,Kt,mt){return zt.apply(this,arguments)}}(),wt=function(){var zt=(0,b.Z)(function*(Zt){let ln=document.activeElement;if(!ln)return;const xn=ln&&ln.shadowRoot;xn&&(ln=xn.querySelector(be)||ln),yield Zt.onDidDismiss(),ln.focus()});return function(ln){return zt.apply(this,arguments)}}(),xt=function(){var zt=(0,b.Z)(function*(Zt,ln,xn,an,Kt,mt,Wt){if(!Zt.presented)return!1;_t(!1),Zt.presented=!1;try{Zt.el.style.setProperty("pointer-events","none"),Zt.willDismiss.emit({data:ln,role:xn});const On=(0,d.b)(Zt),bn=Zt.leaveAnimation?Zt.leaveAnimation:d.c.get(an,"ios"===On?Kt:mt);"gesture"!==xn&&(yield Bt(Zt,bn,Zt.el,Wt)),Zt.didDismiss.emit({data:ln,role:xn}),j.delete(Zt)}catch(On){console.error(On)}return Zt.el.remove(),!0});return function(ln,xn,an,Kt,mt,Wt,On){return zt.apply(this,arguments)}}(),gt=zt=>zt.querySelector("ion-app")||zt.body,Bt=function(){var zt=(0,b.Z)(function*(Zt,ln,xn,an){xn.classList.remove("overlay-hidden");const mt=ln(xn.shadowRoot||Zt.el,an);(!Zt.animated||!d.c.getBoolean("animated",!0))&&mt.duration(0),Zt.keyboardClose&&mt.beforeAddWrite(()=>{const On=xn.ownerDocument.activeElement;On&&On.matches("input, ion-input, ion-textarea")&&On.blur()});const Wt=j.get(Zt)||[];return j.set(Zt,[...Wt,mt]),yield mt.play(),!0});return function(ln,xn,an,Kt){return zt.apply(this,arguments)}}(),Ht=(zt,Zt)=>{let ln;const xn=new Promise(an=>ln=an);return Gn(zt,Zt,an=>{ln(an.detail)}),xn},Gn=(zt,Zt,ln)=>{const xn=an=>{(0,l.b)(zt,Zt,xn),ln(an)};(0,l.a)(zt,Zt,xn)},It=zt=>"cancel"===zt||zt===Yt,jt=zt=>zt(),Ut=(zt,Zt)=>{if("function"==typeof zt)return d.c.get("_zoneGate",jt)(()=>{try{return zt(Zt)}catch(xn){console.error(xn)}})},Yt="backdrop"},1099:(An,vt,k)=>{"use strict";k.d(vt,{B:()=>se});var b=k(6738),d=k(6579),pe=k(7429),l=k(6895);function J(ue,ye){if(1&ue&&(b.TgZ(0,"ion-badge",7),b._uU(1),b.qZA()),2&ue){const xe=b.oxw().$implicit;b.xp6(1),b.hij("",xe.Quantity," x")}}function j(ue,ye){if(1&ue&&(b.TgZ(0,"strong"),b._uU(1),b.qZA()),2&ue){const xe=b.oxw().$implicit;b.xp6(1),b.hij("",xe.PowerKW," kW ")}}function g(ue,ye){if(1&ue&&(b.TgZ(0,"div"),b._uU(1),b.qZA()),2&ue){const xe=b.oxw().$implicit;b.xp6(1),b.hij("",null==xe.CurrentType?null:xe.CurrentType.Title," ")}}function ne(ue,ye){if(1&ue&&(b.TgZ(0,"span"),b._uU(1),b.qZA()),2&ue){const xe=b.oxw().$implicit;b.xp6(1),b.hij("",xe.Amps,"A ")}}function ge(ue,ye){if(1&ue&&(b.TgZ(0,"span"),b._uU(1),b.qZA()),2&ue){const xe=b.oxw().$implicit;b.xp6(1),b.hij("",xe.Voltage,"V ")}}function Q(ue,ye){if(1&ue){const xe=b.EpF();b.TgZ(0,"ion-col"),b.TgZ(1,"ion-button",8),b.NdJ("click",function(){b.CHM(xe);const We=b.oxw().$implicit;return b.oxw().editConnection(We)}),b._UZ(2,"ion-icon",9),b.qZA(),b._UZ(3,"br"),b.TgZ(4,"ion-button",10),b.NdJ("click",function(){b.CHM(xe);const We=b.oxw().$implicit;return b.oxw().deleteConnection(We)}),b._UZ(5,"ion-icon",11),b.qZA(),b.qZA()}}function Y(ue,ye){if(1&ue&&(b.TgZ(0,"ion-row"),b.TgZ(1,"ion-col"),b.TgZ(2,"ion-row"),b.TgZ(3,"ion-col",1),b._UZ(4,"img",2),b.YNc(5,J,2,1,"ion-badge",3),b.TgZ(6,"div",4),b._uU(7),b.qZA(),b.qZA(),b.TgZ(8,"ion-col"),b.TgZ(9,"ion-row"),b.TgZ(10,"ion-col"),b.TgZ(11,"ion-note"),b.TgZ(12,"div"),b.TgZ(13,"strong",5),b._uU(14),b.qZA(),b.qZA(),b.YNc(15,j,2,1,"strong",6),b.YNc(16,g,2,1,"div",6),b.qZA(),b.TgZ(17,"ion-note"),b.YNc(18,ne,2,1,"span",6),b.YNc(19,ge,2,1,"span",6),b.qZA(),b.qZA(),b.qZA(),b.TgZ(20,"ion-row"),b.TgZ(21,"ion-col",4),b._uU(22),b.qZA(),b.TgZ(23,"ion-col",4),b._uU(24),b.qZA(),b.qZA(),b.qZA(),b.YNc(25,Q,6,0,"ion-col",6),b.qZA(),b.qZA(),b.qZA()),2&ue){const xe=ye.$implicit,Ee=b.oxw();b.xp6(4),b.Q6J("src",Ee.getConnectorTypeIcon(xe.ConnectionTypeID),b.LSH),b.xp6(1),b.Q6J("ngIf",xe.Quantity),b.xp6(2),b.Oqu(null==xe.StatusType?null:xe.StatusType.Title),b.xp6(6),b.s9C("title",null==xe.ConnectionType?null:xe.ConnectionType.FormalName),b.xp6(1),b.hij("",null==xe.ConnectionType?null:xe.ConnectionType.Title," "),b.xp6(1),b.Q6J("ngIf",xe.PowerKW),b.xp6(1),b.Q6J("ngIf",xe.CurrentTypeID),b.xp6(2),b.Q6J("ngIf",xe.Amps),b.xp6(1),b.Q6J("ngIf",xe.Voltage),b.xp6(3),b.Oqu(xe.Reference),b.xp6(2),b.Oqu(xe.Comments),b.xp6(1),b.Q6J("ngIf",Ee.enableEdit)}}let se=(()=>{class ue{constructor(){this.enableEdit=!1,this.onEdit=new b.vpe,this.onDelete=new b.vpe}ngOnInit(){}editConnection(xe){this.onEdit.emit(xe)}deleteConnection(xe){this.onDelete.emit(xe)}getConnectorTypeIcon(xe){return d.c.getIconForConnector(xe)}}return ue.\u0275fac=function(xe){return new(xe||ue)},ue.\u0275cmp=b.Xpm({type:ue,selectors:[["app-equipment-details"]],inputs:{item:"item",enableEdit:"enableEdit"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],["size","3"],[2,"max-width","64px",3,"src"],["color","primary",4,"ngIf"],[1,"info"],[3,"title"],[4,"ngIf"],["color","primary"],["size","small","color","secondary",3,"click"],["name","create","slot","icon-only"],["size","small","color","danger",3,"click"],["name","trash","slot","icon-only"]],template:function(xe,Ee){1&xe&&(b.TgZ(0,"ion-grid"),b.YNc(1,Y,26,12,"ion-row",0),b.qZA()),2&xe&&(b.xp6(1),b.Q6J("ngForOf",Ee.item.Connections))},directives:[pe.jY,l.sg,pe.Nd,pe.wI,l.O5,pe.yp,pe.uN,pe.YG,pe.gu],styles:[""]}),ue})()},2428:(An,vt,k)=>{"use strict";k.d(vt,{v:()=>se});var b=k(6099),d=k(7689),pe=k(6738),l=k(553),J=k(7429),j=k(529),g=k(6260),ne=k(6895);function ge(ue,ye){1&ue&&(pe.TgZ(0,"div"),pe._UZ(1,"ion-spinner"),pe.qZA())}function Q(ue,ye){if(1&ue){const xe=pe.EpF();pe.TgZ(0,"ion-item",5),pe.NdJ("click",function(){const be=pe.CHM(xe).$implicit;return pe.oxw(2).placeSelected(be)}),pe.TgZ(1,"ion-avatar",6),pe._UZ(2,"ion-icon",7),pe.qZA(),pe.TgZ(3,"ion-label"),pe.TgZ(4,"p"),pe._uU(5),pe.qZA(),pe.qZA(),pe.qZA()}if(2&ue){const xe=ye.$implicit;pe.xp6(5),pe.Oqu(xe.Address)}}function Y(ue,ye){if(1&ue&&(pe.TgZ(0,"div",1),pe.YNc(1,ge,2,0,"div",2),pe.TgZ(2,"ion-list"),pe.YNc(3,Q,6,1,"ion-item",3),pe.TgZ(4,"ion-item"),pe.TgZ(5,"p",4),pe._uU(6),pe.qZA(),pe.qZA(),pe.qZA(),pe.qZA()),2&ue){const xe=pe.oxw();pe.xp6(1),pe.Q6J("ngIf",xe.searchInProgress),pe.xp6(2),pe.Q6J("ngForOf",xe.placeList),pe.xp6(3),pe.hij(" ",xe.placeAttribution," ")}}let se=(()=>{class ue{constructor(xe,Ee,We,be,Se){this.logging=xe,this.changeDetector=Ee,this.platform=We,this.http=be,this.events=Se,this.searchInProgress=!1,this.placeSearchActive=!1,this.placeAttribution="",this.placeChanged=new pe.vpe,this.searchKeyword="",this.searchInProgress=!1,this.mapService=new l.k(Se,xe,be)}ngOnInit(){var xe=this;return(0,b.Z)(function*(){yield xe.platform.ready(),xe.mapService.initAPI()})()}onSearchFocus(){this.placeSearchFocused=!0}onSearchBlur(){this.placeSearchFocused=!1}onSearchCancel(){}getPlacesAutoComplete(xe,Ee){var We=this;return(0,b.Z)(function*(){We.placeSearchType=Ee;let be=xe.target.value;if(be&&be.length>3){We.logging.log("Starting place lookup for:"+be),We.placeSearchActive=!0,We.searchInProgress=!0,We.searchInProgress=!1,We.placeSearchActive=!0;try{We.placeList=yield We.mapService.placeSearch(be),We.placeList&&We.placeList.length>0&&(We.placeAttribution=We.placeList[0].Attribution)}catch{}We.searchInProgress=!1,We.placeSearchActive=!0}else We.searchInProgress=!1,We.placeSearchActive=!1})()}placeSelected(xe){this.logging.log("Looking up place details:"+xe.Title+"::"+xe.ReferenceID),this.selectedPlace=xe,this.placeChanged.emit(xe),this.placeSearchActive=!1}}return ue.\u0275fac=function(xe){return new(xe||ue)(pe.Y36(d.z),pe.Y36(pe.sBO),pe.Y36(J.t4),pe.Y36(j.eN),pe.Y36(g.z))},ue.\u0275cmp=pe.Xpm({type:ue,selectors:[["place-search"]],inputs:{searchKeyword:"searchKeyword"},outputs:{selectedPlace:"selectedPlace",placeChanged:"placeChanged"},decls:1,vars:1,consts:[["class","place-search",4,"ngIf"],[1,"place-search"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],[1,"place-attribution"],[3,"click"],["item-left",""],["name","locate"]],template:function(xe,Ee){1&xe&&pe.YNc(0,Y,7,3,"div",0),2&xe&&pe.Q6J("ngIf",Ee.placeSearchActive)},directives:[ne.O5,J.PQ,J.q_,ne.sg,J.Ie,J.BJ,J.gu,J.Q$],styles:[".place-search[_ngcontent-%COMP%]{position:absolute;z-index:1000}.place-attribution[_ngcontent-%COMP%]{font-size:9px;color:#dcdcdc;max-width:100%}"]}),ue})()},6585:(An,vt,k)=>{"use strict";k.d(vt,{o:()=>ne});var b=k(6738),d=k(6579),pe=k(7429),l=k(6895);function J(ge,Q){if(1&ge){const Y=b.EpF();b.TgZ(0,"ion-button",5),b.NdJ("click",function(){b.CHM(Y);const ue=b.oxw().$implicit;return b.oxw().onCopyCommand(ue)}),b._uU(1,"Copy"),b.qZA()}}function j(ge,Q){if(1&ge){const Y=b.EpF();b.TgZ(0,"ion-button",5),b.NdJ("click",function(){b.CHM(Y);const ue=b.oxw().$implicit;return b.oxw().onEditCommand(ue)}),b._uU(1,"Edit"),b.qZA()}}function g(ge,Q){if(1&ge&&(b.TgZ(0,"ion-item",1),b.TgZ(1,"ion-grid"),b.TgZ(2,"ion-row"),b.TgZ(3,"ion-col"),b._uU(4),b.qZA(),b.qZA(),b.TgZ(5,"ion-row"),b.TgZ(6,"ion-col",2),b.TgZ(7,"p"),b._UZ(8,"img",3),b.qZA(),b.TgZ(9,"ion-note"),b._uU(10),b.qZA(),b.YNc(11,J,2,0,"ion-button",4),b.YNc(12,j,2,0,"ion-button",4),b.qZA(),b.TgZ(13,"ion-col"),b.TgZ(14,"ion-row"),b.TgZ(15,"ion-col"),b.TgZ(16,"p"),b._uU(17),b.qZA(),b.TgZ(18,"ion-note"),b._uU(19),b.qZA(),b.qZA(),b.qZA(),b.TgZ(20,"ion-row"),b.TgZ(21,"ion-col"),b._uU(22),b.qZA(),b.TgZ(23,"ion-col"),b._uU(24),b.qZA(),b.qZA(),b.qZA(),b.qZA(),b.qZA(),b.qZA()),2&ge){const Y=Q.$implicit,se=b.oxw();b.xp6(4),b.hij(" ",Y.AddressInfo.Title," "),b.xp6(4),b.Q6J("src",se.getIconForPOI(Y),b.LSH),b.xp6(2),b.hij(" ",se.getFormattedDistance(Y)," "),b.xp6(1),b.Q6J("ngIf",se.enableCopyOption),b.xp6(1),b.Q6J("ngIf",se.enableEditOption),b.xp6(5),b.hij(" ",se.getFormattedAddress(Y)," "),b.xp6(2),b.hij(" ",se.getFormattedConnectorList(Y)," "),b.xp6(3),b.hij(" ",null==Y.UsageType?null:Y.UsageType.Title," "),b.xp6(2),b.hij(" ",null==Y.OperatorInfo?null:Y.OperatorInfo.Title," ")}}let ne=(()=>{class ge{constructor(){this.enableCopyOption=!1,this.enableEditOption=!1,this.poiList=[],this.onCopy=new b.vpe,this.onEdit=new b.vpe}ngOnInit(){}onCopyCommand(Y){this.onCopy.emit(Y)}onEditCommand(Y){this.onEdit.emit(Y)}getFormattedAddress(Y){let se="";return se+=Y.AddressInfo.Title!=Y.AddressInfo.AddressLine1?Y.AddressInfo.Title:Y.AddressInfo.Town,se}getFormattedConnectorList(Y){if(!Y.Connections)return;let se=[];for(let ue of Y.Connections)null!=ue.ConnectionType&&(se.find(ye=>ye==ue.ConnectionType.Title)||se.push(ue.ConnectionType.Title));return se.join(", ")}getIconForPOI(Y){return d.c.getIconForPOI(Y)}getFormattedDistance(Y){return d.c.getFormattedDistance(Y)}}return ge.\u0275fac=function(Y){return new(Y||ge)},ge.\u0275cmp=b.Xpm({type:ge,selectors:[["app-poi-list"]],inputs:{enableCopyOption:"enableCopyOption",enableEditOption:"enableEditOption",poiList:"poiList"},outputs:{onCopy:"onCopy",onEdit:"onEdit"},decls:2,vars:1,consts:[["style","max-width:400px;",4,"ngFor","ngForOf"],[2,"max-width","400px"],["size","3"],[2,"width","24px",3,"src"],["size","small",3,"click",4,"ngIf"],["size","small",3,"click"]],template:function(Y,se){1&Y&&(b.TgZ(0,"ion-list"),b.YNc(1,g,25,9,"ion-item",0),b.qZA()),2&Y&&(b.xp6(1),b.Q6J("ngForOf",se.poiList))},directives:[pe.q_,l.sg,pe.Ie,pe.jY,pe.Nd,pe.wI,pe.uN,l.O5,pe.YG],styles:[""]}),ge})()},8936:(An,vt,k)=>{"use strict";k.d(vt,{e:()=>j});var b=k(6895),d=k(7429),pe=k(4006),l=k(9397),J=k(6738);let j=(()=>{class g{}return g.\u0275fac=function(ge){return new(ge||g)},g.\u0275mod=J.oAB({type:g}),g.\u0275inj=J.cJS({providers:[b.JJ],imports:[[b.ez,d.Pc,pe.u5,l.aw]]}),g})()},2951:(An,vt,k)=>{"use strict";k.d(vt,{X:()=>d});var b=k(2340);class d{constructor(){this.baseURL="https://map.openchargemap.io",this.loginProviderRedirectBaseURL="https://openchargemap.org/site/loginprovider/?_mode=silent&_forceLogin=true&_redirectURL=",this.loginProviderRedirectURL=this.loginProviderRedirectBaseURL+this.baseURL,this.enableLiveMapQuerying=!0,this.googleMapsAPIKey=b.N.googleMapsKey,this.enableStaticMaps=b.N.enableStaticMaps}}},6579:(An,vt,k)=>{"use strict";k.d(vt,{c:()=>d});var b=k(2340);let d=(()=>{class pe{static isFeatureEnabled(J){return!!b.N.enabledFeatures.find(j=>j===J)}static getClientHeight(){const J=document.body,j=document.documentElement;return Math.max(J.scrollHeight,J.offsetHeight,j.clientHeight,j.scrollHeight,j.offsetHeight)}static getClientWidth(){const J=document.body,j=document.documentElement;return Math.max(J.scrollWidth,J.offsetWidth,j.clientWidth,j.scrollWidth,j.offsetWidth)}static getMaxLevelOfPOI(J){let j=0;if(null!=J.Connections)for(let g=0;g<J.Connections.length;g++)null!=J.Connections[g].Level&&J.Connections[g].Level.ID>j&&(j=J.Connections[g].Level.ID);return 4===j&&(j=2),j>4&&(j=3),j}static getIconForPOI(J){let g="assets/images/icons/map/level"+pe.getMaxLevelOfPOI(J);return null!=J.UsageType&&J.UsageType.Title.indexOf("Private")>-1?g+="_private":g+=null!=J.StatusType&&!0!==J.StatusType.IsOperational?"_nonoperational":"_operational",g+="_icon.png",g}static getColorForPOI(J){const j=pe.getMaxLevelOfPOI(J);let g="#c0c0c0";return null!=J.UsageType&&J.UsageType.Title.indexOf("Private")>-1?g="#FF0000":null!=J.StatusType&&!0!==J.StatusType.IsOperational?g="#a0a0a0":2==j?g="#72EB0D":3==j&&(g="#EB800D"),g}static getIconForConnector(J){let j="assets/images/icons/connectors/";return j+=1===J?"Type1_J1772.svg":2===J?"Chademo_type4.svg":25===J?"Type2_socket.svg":32===J?"Type1_CCS.svg":33===J?"Type2_CCS.svg":1036===J?"Type2_tethered.svg":28===J?"schuko.svg":"Unknown.svg",j}static getFormattedDistance(J){return J&&J.AddressInfo&&J.AddressInfo.Distance?J.AddressInfo.Distance.toFixed(1)+" "+(1===J.AddressInfo.DistanceUnit?"km":"miles"):""}static fixJSONDate(J){if(null==J)return null;if(0==J.indexOf("/")){let g=/Date\(([^)]+)\)/.exec(J);J=new Date(parseFloat(g[1]))}else J=new Date(J);return J}static formatMapLinkFromPosition(J,j,g,ne,ge){return'<a href="https://maps.google.com/maps?saddr='+j+","+g+"&daddr="+J.AddressInfo.Latitude+","+J.AddressInfo.Longitude+'">Map ('+Math.ceil(ne)+" "+ge+")</a>"}static formatSystemWebLink(J,j){return"<a href='#' onclick=\"window.open('"+J+"', '_system');return false;\">"+j+"</a>"}static formatMapLink(J,j,g){return g?device&&"WinCE"==device.platform?this.formatSystemWebLink("maps:"+J.AddressInfo.Latitude+","+J.AddressInfo.Longitude,j):device&&"iOS"===device.platform?this.formatSystemWebLink("https://maps.apple.com/?q="+J.AddressInfo.Latitude+","+J.AddressInfo.Longitude,j):this.formatSystemWebLink("https://maps.google.com/maps?q="+J.AddressInfo.Latitude+","+J.AddressInfo.Longitude,j):'<a target="_blank"  href="https://maps.google.com/maps?q='+J.AddressInfo.Latitude+","+J.AddressInfo.Longitude+'">'+j+"</a>"}static formatURL(J,j=null){return null==J||""==J?"":(-1==J.indexOf("http")&&(J="https://"+J),'<a target="_blank" href="'+J+'">'+(j??J)+"</a>")}static formatString(J){return null==J?"":J.toString()}static formatTextField(J,j=null,g=!1,ne=!1,ge=null){if(null==J||""==J||null==J)return"";let Q=(null!=j?"<strong class='ocm-label' "+(null!=ge?"data-localize='"+ge+"' ":"")+">"+j+"</strong>: ":"")+(g?"<br/>":"")+J.toString().replace("\n","<br/>")+"<br/>";return 1==ne&&(Q="<p>"+Q+"</p>"),Q}static formatEmailAddress(J){return null!=J&&null!=J&&""!=J?"<i class='fa fa-envelope fa-fw'></i> <a href=\"mailto:"+J+'">'+J+"</a><br/>":""}static formatPhone(J,j=null){return null!=J&&null!=J&&""!=J?(null==j?j="<i class='fa fa-phone fa-fw '></i> ":j+=": ",j+'<a href="tel:'+J+'">'+J+"</a><br/>"):""}static formatPOIDetails(J,j){let ne=new Date;null==j&&(j=!1);let ge=this.formatPOIAddress(J,!1),Q="";Q+=this.formatPhone(J.AddressInfo.ContactTelephone1),Q+=this.formatPhone(J.AddressInfo.ContactTelephone2),Q+=this.formatEmailAddress(J.AddressInfo.ContactEmail);let Y="";if(null!=J.AddressInfo.Distance){let We="https://maps.google.com/maps?saddr=&daddr="+J.AddressInfo.Latitude+","+J.AddressInfo.Longitude;Y+="<strong id='addr_distance'><span data-localize='details.approxDistance'>Distance</span>: "+J.AddressInfo.Distance.toFixed(1)+" "+(2==J.AddressInfo.DistanceUnit?"Miles":"KM")+"</strong>",Y+="<p>"+this.formatSystemWebLink(We,"Get Directions")+"</p>"}if(null!=J.AddressInfo.RelatedURL&&""!=J.AddressInfo.RelatedURL){let We=J.AddressInfo.RelatedURL;We=We.replace(/.*?:\/\//g,""),We.length>40&&(We=We.substr(0,40)+".."),Q+="<i class='fa fa-fw fa-external-link'></i>  "+this.formatSystemWebLink(J.AddressInfo.RelatedURL,"<span data-localize='details.addressRelatedURL'>"+We+"</span>")}Q+="</p>";const se=this.formatTextField(J.GeneralComments,null,!1,!0)+this.formatTextField(J.AddressInfo.AccessComments,"Access",!0,!0,"details.accessComments");let ue="";null!=J.NumberOfPoints&&(ue+=this.formatTextField(J.NumberOfPoints,"Bays",!1,!0,"details.numberOfPoints")),null!=J.UsageType&&(ue+=this.formatTextField(J.UsageType.Title,"Usage",!1,!0,"details.usageType")),null!=J.UsageCost&&(ue+=this.formatTextField(J.UsageCost,"Usage Cost",!1,!0,"details.usageCost")),null!=J.OperatorInfo&&1!=J.OperatorInfo.ID&&(ue+=this.formatTextField(J.OperatorInfo.Title,"Operator",!1,!0,"details.operatorTitle"),null!=J.OperatorInfo.WebsiteURL&&(ue+=this.formatTextField(this.formatURL(J.OperatorInfo.WebsiteURL),"Operator Website",!0,!0,"details.operatorWebsite")));let ye="";if(null!=J.StatusType&&(ye+=this.formatTextField(J.StatusType.Title,"Status",!1,!0,"details.operationalStatus"),null!=J.DateLastStatusUpdate&&(ye+=this.formatTextField(Math.round((ne-this.fixJSONDate(J.DateLastStatusUpdate))/864e5)+" days ago","Last Updated",!1,!0,"details.lastUpdated"))),null!=J.Connections&&J.Connections.length>0){ye+="<table class='table table-striped'>",ye+="<tr><th data-localize='details.equipment.connectionType'>Connection</th><th data-localize='details.equipment.powerLevel'>Power Level</th><th data-localize='details.operationalStatus'>Status</th></tr>";for(let We=0;We<J.Connections.length;We++){let be=J.Connections[We];""==be.Amps&&(be.Amps=null),""==be.Voltage&&(be.Voltage=null),""==be.Quantity&&(be.Quantity=null),""==be.PowerKW&&(be.PowerKW=null),ye+="<tr><td>"+(null!=be.ConnectionType?be.ConnectionType.Title:"")+"</td><td>"+(null!=be.Level?"<strong>"+be.Level.Title+"</strong><br/>":"")+(null!=be.Amps?this.formatString(be.Amps)+"A/ ":"")+(null!=be.Voltage?this.formatString(be.Voltage)+"V/ ":"")+(null!=be.PowerKW?this.formatString(be.PowerKW)+"kW <br/>":"")+(null!=be.CurrentType?be.CurrentType.Title:"")+"<br/>"+(null!=be.Quantity?this.formatString(be.Quantity):"1")+" Present</td><td>"+(null!=be.StatusType?be.StatusType.Title:"-")+"</td></tr>"}ye+="</table>"}let xe="";return xe+=this.formatTextField("<a target='_blank' href='https://openchargemap.org/site/poi/details/"+J.ID+"'>OCM-"+J.ID+"</a>","OpenChargeMap Ref",!1,!0,"details.refNumber"),null!=J.DataProvider&&(xe+=this.formatTextField(J.DataProvider.Title,"Data Provider",!1,!0,"details.dataProviderTitle"),null!=J.DataProvider.WebsiteURL&&(xe+=this.formatTextField(this.formatURL(J.DataProvider.WebsiteURL),"Website",!1,!0,"details.dataProviderWebsite")),xe+=this.formatTextField(J.AddressInfo.Latitude,"Latitude",!1,!0,null),xe+=this.formatTextField(J.AddressInfo.Longitude,"Longitude",!1,!0,null)),{address:ge,drivingInfo:Y,contactInfo:Q,additionalInfo:se+ue+ye,advancedInfo:xe}}static debounce(J,j,g){let ne;return function(){let ge=this,Q=arguments,Y=function(){ne=null,g||J.apply(ge,Q)},se=g&&!ne;clearTimeout(ne),ne=setTimeout(Y,j),se&&J.apply(ge,Q)}}static getRandomInt(J){return Math.floor(Math.random()*Math.floor(J))}}return pe.formatPOIAddress=function(l,J=!0){let j="";return j=J?""+this.formatTextField(l.AddressInfo.AddressLine1)+this.formatTextField(l.AddressInfo.AddressLine2)+this.formatTextField(l.AddressInfo.Town)+this.formatTextField(l.AddressInfo.StateOrProvince)+this.formatTextField(l.AddressInfo.Postcode)+(null!=l.AddressInfo.Country?this.formatTextField(l.AddressInfo.Country.Title):""):this.formatStringArray([l.AddressInfo.AddressLine1,l.AddressInfo.AddressLine2,l.AddressInfo.Town,l.AddressInfo.StateOrProvince,l.AddressInfo.Postcode,null!=l.AddressInfo.Country?l.AddressInfo.Country.Title:""]),j},pe.formatStringArray=function(l,J=", "){if(null==l)return"";let j="";for(let g=0;g<l.length;g++)null!=l[g]&&""!=l[g].trim()&&(j+=g==l.length-1?l[g]:l[g]+J);return j},pe})()},4120:(An,vt,k)=>{"use strict";k.d(vt,{wC:()=>b,jR:()=>d,LL:()=>pe});class b{constructor(J=null,j=null){this.latitude=J,this.longitude=j}}class d{constructor(J=null,j=null){this.coords=new b,this.coords.latitude=J,this.coords.longitude=j}static fromPosition(J){return new d(J.coords.latitude,J.coords.longitude)}}class pe{constructor(J,j){this.northEast=J,this.southWest=j}}},129:(An,vt,k)=>{"use strict";k.d(vt,{Qp:()=>pe,fw:()=>j,JJ:()=>ne,eN:()=>g,vw:()=>J,kA:()=>l});class b{constructor(Q,Y){this.itemType=Q,this.itemId=b.getNewItemId(),this.version=1,this.schemaVersion=Y,this.syncTimeStamp=b.getNewSyncTimeStamp()}static getNewSyncTimeStamp(){return Date.now().toString()}static getNewItemId(){return"_syncitem_"+Date.now().toString()}}class d{constructor(Q,Y){this._sync=new b(Q,Y)}}class pe extends d{}class l extends d{constructor(){super("waypoint",1)}}class J extends d{constructor(){super("journey_stage",1),this.WayPoints=[]}}class j extends d{constructor(){super("journey",1),this.ID=""+Date.now(),this.Stages=[]}}class g{}class ne{}},2206:(An,vt,k)=>{"use strict";k.d(vt,{b:()=>b});class b{constructor(){this.poiIdList=null,this.countryCode=null,this.latitude=null,this.longitude=null,this.locationTitle=null,this.distance=null,this.distanceUnit=null,this.connectionTypeIdList=null,this.operatorIdList=null,this.levelIdList=null,this.countryIdList=null,this.usageTypeIdList=null,this.statusTypeIdList=null,this.minPowerKW=null,this.maxPowerKW=null,this.submissionStatusTypeIdList=null,this.maxResults=500,this.additionalParams=null,this.includeComments=!1,this.compact=!0,this.enableCaching=!0,this.levelOfDetail=1,this.polyline=null,this.boundingbox=null}}},4209:(An,vt,k)=>{"use strict";k.d(vt,{n:()=>b});class b{}},7627:(An,vt,k)=>{"use strict";k.d(vt,{U:()=>b,N:()=>d});const b=650;class d{constructor(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MaxPowerKW=null,this.MinPowerKW=null,this.HasActiveFilters=!1,this.FilterOptionsByCountryId=null,this.UseDistanceInKM=!0,this.MapType="ROADMAP",this.EnableAdvancedEditorFeatures=!1}LoadSettings(){}SaveSettings(){}ClearActiveFilters(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MinPowerKW=null,this.MaxPowerKW=null}CheckForActiveFilters(){return this.HasActiveFilters=this.OperatorList.length>0||this.ConnectionTypeList.length>0||this.CountryList.length>0||this.UsageTypeList.length>0||this.StatusTypeList.length>0||this.MinPowerKW>0||this.MaxPowerKW>0||null!=this.MaxPowerKW&&this.MaxPowerKW<b,this.HasActiveFilters}}},8649:(An,vt,k)=>{"use strict";k.d(vt,{q:()=>b});var b=(()=>{return(d=b||(b={}))[d.POI=0]="POI",d[d.Comment=1]="Comment",d[d.Media=2]="Media",b;var d})()},534:(An,vt,k)=>{"use strict";k.r(vt),k.d(vt,{AboutPageModule:()=>Q});var b=k(6895),d=k(4006),pe=k(7429),l=k(3334),J=k(388),j=k(6738);const g=[{path:"",component:J.t}];let ne=(()=>{class Y{}return Y.\u0275fac=function(ue){return new(ue||Y)},Y.\u0275mod=j.oAB({type:Y}),Y.\u0275inj=j.cJS({imports:[[l.Bz.forChild(g)],l.Bz]}),Y})();var ge=k(9397);let Q=(()=>{class Y{}return Y.\u0275fac=function(ue){return new(ue||Y)},Y.\u0275mod=j.oAB({type:Y}),Y.\u0275inj=j.cJS({imports:[[b.ez,d.u5,pe.Pc,ge.aw,ne]]}),Y})()},388:(An,vt,k)=>{"use strict";k.d(vt,{t:()=>J});var b=k(2340),d=k(6738),pe=k(7429),l=k(9397);let J=(()=>{class j{constructor(ne){this.modalController=ne}get appVersion(){return b.N.version}get apiUrl(){return b.N.apiBase}ngOnInit(){}close(){this.modalController.dismiss()}}return j.\u0275fac=function(ne){return new(ne||j)(d.Y36(pe.IN))},j.\u0275cmp=d.Xpm({type:j,selectors:[["app-about"]],decls:49,vars:5,consts:[[1,"ion-padding"],["size","2"],["src","assets/images/icons/branding/AppIcon_128x128.png",2,"padding-top","2em"],["href","https://openchargemap.org"],["href","https://community.openchargemap.org"],["href","https://github.com/openchargemap/ocm-system/issues"],["href","https://webprofusion.com"],["href","https://opencollective.com/openchargemap"],["slot","end"],[3,"click"],["name","close","slot","start"]],template:function(ne,ge){1&ne&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-title"),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(5,"ion-content",0),d.TgZ(6,"ion-grid"),d.TgZ(7,"ion-row"),d.TgZ(8,"ion-col",1),d._UZ(9,"img",2),d.qZA(),d.TgZ(10,"ion-col"),d.TgZ(11,"h1"),d._uU(12,"Open Charge Map"),d.qZA(),d.TgZ(13,"h2"),d._uU(14,"The global public registry of Electric Vehicle charging locations"),d.qZA(),d.TgZ(15,"p"),d._uU(16,"Web: "),d.TgZ(17,"a",3),d._uU(18,"https://openchargemap.org"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(19,"p"),d._uU(20,"Community Discussions: "),d.TgZ(21,"a",4),d._uU(22,"https://community.openchargemap.org"),d.qZA(),d.qZA(),d.TgZ(23,"p"),d._uU(24,"App or System Bugs and feature suggestions: "),d.TgZ(25,"a",5),d._uU(26,"GitHub"),d.qZA(),d.qZA(),d.TgZ(27,"p"),d._uU(28,"App development by Webprofusion Pty Ltd ("),d.TgZ(29,"a",6),d._uU(30,"https://webprofusion.com"),d.qZA(),d._uU(31,")"),d.qZA(),d.TgZ(32,"h3"),d._uU(33,"Funding"),d.qZA(),d.TgZ(34,"p"),d._uU(35,"Our software is developed and hosted by volunteers, our data is crowdsourced by you. To help further development please encourage your organisation to sponsor us: "),d.TgZ(36,"a",7),d._uU(37,"Open Collective"),d.qZA(),d.qZA(),d.TgZ(38,"ion-note"),d.TgZ(39,"p"),d._uU(40),d.qZA(),d.TgZ(41,"p"),d._uU(42),d.qZA(),d.qZA(),d.qZA(),d.TgZ(43,"ion-footer"),d.TgZ(44,"ion-toolbar"),d.TgZ(45,"ion-buttons",8),d.TgZ(46,"ion-button",9),d.NdJ("click",function(){return ge.close()}),d._UZ(47,"ion-icon",10),d._uU(48," Close "),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&ne&&(d.xp6(3),d.Oqu(d.lcZ(4,3,"ocm.general.about")),d.xp6(37),d.hij("App Version: ",ge.appVersion,""),d.xp6(2),d.hij("API: ",ge.apiUrl,""))},directives:[pe.Gu,pe.sr,pe.wd,pe.W2,pe.jY,pe.Nd,pe.wI,pe.uN,pe.fr,pe.Sm,pe.YG,pe.gu],pipes:[l.X$],styles:[""]}),j})()},5476:(An,vt,k)=>{"use strict";k.r(vt),k.d(vt,{JourneysModule:()=>ge});var b=k(9741),d=k(8936),pe=k(9397),l=k(6895),J=k(4006),j=k(7429),g=k(3334),ne=k(6738);let ge=(()=>{class Q{}return Q.\u0275fac=function(se){return new(se||Q)},Q.\u0275mod=ne.oAB({type:Q}),Q.\u0275inj=ne.cJS({imports:[[l.ez,J.u5,j.Pc,pe.aw,d.e,g.Bz.forChild([{path:"",component:b.g}])]]}),Q})()},9741:(An,vt,k)=>{"use strict";k.d(vt,{g:()=>ze});var b=k(3912),d=k(7814),pe=k(3855),l=k(4120),J=k(3399),j=k(6738),g=k(7429),ne=k(6895);function ge(tt,et){1&tt&&(j.TgZ(0,"p"),j._uU(1," You have no journeys yet. Start by browsing to a charging location, then add it as Favourite to start a new Journey. "),j.qZA())}function Q(tt,et){if(1&tt&&(j.TgZ(0,"p"),j._uU(1),j.qZA()),2&tt){const Be=j.oxw(2).$implicit;j.xp6(1),j.hij(" ",Be.Poi.AddressInfo.AddressLine1,"")}}function Y(tt,et){if(1&tt&&(j.TgZ(0,"p"),j._uU(1),j.qZA()),2&tt){const Be=j.oxw(2).$implicit;j.xp6(1),j.hij(" ",Be.Poi.AddressInfo.AddressLine2,"")}}function se(tt,et){if(1&tt&&(j.TgZ(0,"p"),j._uU(1),j.qZA()),2&tt){const Be=j.oxw(2).$implicit;j.xp6(1),j.hij(" ",Be.Poi.AddressInfo.Town,"")}}function ue(tt,et){if(1&tt&&(j.TgZ(0,"p"),j._uU(1),j.qZA()),2&tt){const Be=j.oxw(2).$implicit;j.xp6(1),j.hij(" ",Be.Poi.AddressInfo.StateOrProvince,"")}}function ye(tt,et){if(1&tt&&(j.TgZ(0,"p"),j._uU(1),j.qZA()),2&tt){const Be=j.oxw(2).$implicit;j.xp6(1),j.hij(" ",Be.Poi.AddressInfo.Postcode,"")}}function xe(tt,et){if(1&tt){const Be=j.EpF();j.TgZ(0,"div"),j.TgZ(1,"div",18),j.NdJ("click",function(){j.CHM(Be);const Ge=j.oxw().$implicit;return j.oxw(4).viewPOIDetails(Ge.Poi)}),j.YNc(2,Q,2,1,"p",4),j.YNc(3,Y,2,1,"p",4),j.YNc(4,se,2,1,"p",4),j.YNc(5,ue,2,1,"p",4),j.YNc(6,ye,2,1,"p",4),j.qZA(),j.TgZ(7,"ion-button",19),j.NdJ("click",function(){j.CHM(Be);const Ge=j.oxw().$implicit;return j.oxw(4).launchNavigation(Ge.Poi)}),j._UZ(8,"ion-icon",20),j._uU(9," Navigate "),j.qZA(),j.qZA()}if(2&tt){const Be=j.oxw().$implicit;j.xp6(2),j.Q6J("ngIf",Be.Poi.AddressInfo.AddressLine1),j.xp6(1),j.Q6J("ngIf",Be.Poi.AddressInfo.AddressLine2),j.xp6(1),j.Q6J("ngIf",Be.Poi.AddressInfo.Town),j.xp6(1),j.Q6J("ngIf",Be.Poi.AddressInfo.StateOrProvince),j.xp6(1),j.Q6J("ngIf",Be.Poi.AddressInfo.Postcode)}}function Ee(tt,et){if(1&tt&&(j.TgZ(0,"div",17),j.YNc(1,xe,10,5,"div",4),j.qZA()),2&tt){const Be=et.$implicit;j.xp6(1),j.Q6J("ngIf",Be.Poi)}}function We(tt,et){if(1&tt&&(j.TgZ(0,"ion-item"),j.TgZ(1,"h2"),j._uU(2),j.qZA(),j.TgZ(3,"ion-thumbnail",0),j._UZ(4,"ion-icon",15),j.qZA(),j.TgZ(5,"p"),j._uU(6),j.qZA(),j.YNc(7,Ee,2,1,"div",16),j.qZA()),2&tt){const Be=et.$implicit;j.xp6(2),j.Oqu(Be.Title),j.xp6(4),j.Oqu(Be.Notes),j.xp6(1),j.Q6J("ngForOf",Be.PoiList)}}function be(tt,et){if(1&tt&&(j.TgZ(0,"ion-list"),j.TgZ(1,"ion-list-header",11),j._uU(2),j._UZ(3,"ion-icon",12),j._uU(4," -- "),j._UZ(5,"ion-icon",13),j._uU(6," -- "),j._UZ(7,"ion-icon",14),j._uU(8," -- "),j.qZA(),j.YNc(9,We,8,3,"ion-item",5),j.qZA()),2&tt){const Be=et.$implicit;j.xp6(2),j.hij(" ",Be.Title," "),j.xp6(7),j.Q6J("ngForOf",Be.WayPoints)}}function Se(tt,et){if(1&tt){const Be=j.EpF();j.TgZ(0,"ion-card"),j.TgZ(1,"ion-card-content"),j.TgZ(2,"ion-toolbar",8),j.TgZ(3,"ion-title"),j._uU(4),j.qZA(),j.TgZ(5,"ion-buttons",9),j.TgZ(6,"ion-button",1),j.NdJ("click",function(){const _t=j.CHM(Be).$implicit;return j.oxw().deleteJourney(_t.ID)}),j._UZ(7,"ion-icon",10),j.qZA(),j.qZA(),j.qZA(),j.TgZ(8,"p"),j._uU(9),j.qZA(),j.YNc(10,be,10,2,"ion-list",5),j.qZA(),j.qZA()}if(2&tt){const Be=et.$implicit;j.xp6(4),j.hij(" ",Be.Title,""),j.xp6(5),j.Oqu(Be.Notes),j.xp6(1),j.Q6J("ngForOf",Be.Stages)}}let ze=(()=>{class tt{constructor(Be,C,Ge,_t,ht){this.appManager=Be,this.journeyManager=C,this.api=Ge,this.modalController=_t,this.alertController=ht}dismiss(){this.modalController.dismiss()}discoverImages(){this.journeyManager.journeys.forEach(Be=>{Be.Stages.forEach(C=>{C.WayPoints.forEach(Ge=>{null!=Ge.PoiList&&Ge.PoiList.forEach(_t=>{_t.Poi&&this.api.getPanoramioLocationPhotos(new l.wC(_t.Poi.AddressInfo.Latitude,_t.Poi.AddressInfo.Longitude)).then(ht=>{_t.Photos=ht})})})})})}getJson(Be){return JSON.stringify(Be,null,4)}viewPOIDetails(Be){this.modalController.create({component:J.H,componentProps:{item:Be}}).then(C=>C.present())}get staticMapSize(){return"60x60"}getStaticMapURL(Be){return"https://maps.googleapis.com/maps/api/staticmap?center="+Be.AddressInfo.Latitude+","+Be.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+Be.AddressInfo.Latitude+","+Be.AddressInfo.Longitude}deleteJourney(Be){this.alertController.create({header:"Delete this Journey?",message:"Are you sure you want to delete this Journey?",buttons:[{text:"No",handler:()=>{}},{text:"Delete",handler:()=>{this.journeyManager.deleteJourney(Be)}}]}).then(C=>C.present())}launchNavigation(Be){let C="https://maps.google.com/?q="+Be.AddressInfo.Latitude+","+Be.AddressInfo.Longitude;this.appManager.platform.is("ios")&&(C="https://maps.apple.com?q="+Be.AddressInfo.Latitude+","+Be.AddressInfo.Longitude),window.open(C,"_system")}}return tt.\u0275fac=function(Be){return new(Be||tt)(j.Y36(pe.c),j.Y36(b.i),j.Y36(d.l),j.Y36(g.IN),j.Y36(g.Br))},tt.\u0275cmp=j.Xpm({type:tt,selectors:[["ng-component"]],decls:18,vars:2,consts:[["slot","start"],[3,"click"],[1,"journeys-page"],[1,"ion-padding"],[4,"ngIf"],[4,"ngFor","ngForOf"],["slot","end"],["name","close","slot","start"],["primary",""],["slot","primary"],["name","close","slot","icon-only"],[2,"font-size","1.5rem"],["name","car"],["name","time"],["name","flash"],["name","caret-down",2,"font-size","4rem"],["style","text-align:right;width:100%;",4,"ngFor","ngForOf"],[2,"text-align","right","width","100%"],["tappable","",3,"click"],["clear","","item-right","",3,"click"],["name","navigate","slot","start"]],template:function(Be,C){1&Be&&(j.TgZ(0,"ion-header"),j.TgZ(1,"ion-toolbar"),j.TgZ(2,"ion-buttons",0),j.TgZ(3,"ion-back-button",1),j.NdJ("click",function(){return C.dismiss()}),j.qZA(),j.qZA(),j.TgZ(4,"ion-title"),j._uU(5," Journeys "),j.qZA(),j.qZA(),j.qZA(),j.TgZ(6,"ion-content",2),j.TgZ(7,"div",3),j.TgZ(8,"p"),j._uU(9," You can create and plan journeys to group your favourite charging routes together. "),j.qZA(),j.YNc(10,ge,2,0,"p",4),j.qZA(),j.YNc(11,Se,11,3,"ion-card",5),j.qZA(),j.TgZ(12,"ion-footer"),j.TgZ(13,"ion-toolbar"),j.TgZ(14,"ion-buttons",6),j.TgZ(15,"ion-button",1),j.NdJ("click",function(){return C.dismiss()}),j._UZ(16,"ion-icon",7),j._uU(17," Close "),j.qZA(),j.qZA(),j.qZA(),j.qZA()),2&Be&&(j.xp6(10),j.Q6J("ngIf",null==C.journeyManager.journeys||0==C.journeyManager.journeys.length),j.xp6(1),j.Q6J("ngForOf",C.journeyManager.journeys))},directives:[g.Gu,g.sr,g.Sm,g.oU,g.cs,g.wd,g.W2,ne.O5,ne.sg,g.PM,g.FN,g.YG,g.gu,g.q_,g.yh,g.Ie,g.Bs,g.fr],encapsulation:2}),tt})()},5005:(An,vt,k)=>{"use strict";k.r(vt),k.d(vt,{LayerEditorPageModule:()=>Q});var b=k(6895),d=k(4006),pe=k(7429),l=k(3334),J=k(6588),j=k(6738);const g=[{path:"",component:J.A}];let ne=(()=>{class Y{}return Y.\u0275fac=function(ue){return new(ue||Y)},Y.\u0275mod=j.oAB({type:Y}),Y.\u0275inj=j.cJS({imports:[[l.Bz.forChild(g)],l.Bz]}),Y})();var ge=k(8936);let Q=(()=>{class Y{}return Y.\u0275fac=function(ue){return new(ue||Y)},Y.\u0275mod=j.oAB({type:Y}),Y.\u0275inj=j.cJS({imports:[[b.ez,d.u5,pe.Pc,ne,ge.e]]}),Y})()},6588:(An,vt,k)=>{"use strict";k.d(vt,{A:()=>ne});var b=k(6099),d=k(6799),pe=k(6738),l=k(7429),J=k(6895),j=k(6585);function g(ge,Q){if(1&ge&&(pe.TgZ(0,"div"),pe._uU(1),pe._UZ(2,"app-poi-list",10),pe.qZA()),2&ge){const Y=pe.oxw();pe.xp6(1),pe.hij(" Items Parsed: ",Y.fileData.length," "),pe.xp6(1),pe.Q6J("poiList",Y.fileData)}}let ne=(()=>{class ge{constructor(Y,se){this.modalController=Y,this.refData=se}ngOnInit(){}previewFile(){var Y=this;return(0,b.Z)(function*(){yield Y.loadFile(!1)})()}cancel(){var Y=this;return(0,b.Z)(function*(){yield Y.modalController.dismiss(Y.fileData)})()}loadFile(Y=!0){var se=this;return(0,b.Z)(function*(){const ue=new FileReader;ue.onload=()=>{let xe=JSON.parse(ue.result);for(let Ee of xe)Ee.ID="imp_"+Ee.ID;se.fileData=se.refData.hydrateCompactPOIList(xe),Y&&se.modalController.dismiss(se.fileData)},ue.onerror=()=>{},ue.readAsText(document.getElementById("file-upload").files[0])})()}add(){var Y=this;return(0,b.Z)(function*(){Y.modalController.dismiss(Y.fileData)})()}}return ge.\u0275fac=function(Y){return new(Y||ge)(pe.Y36(l.IN),pe.Y36(d.W))},ge.\u0275cmp=pe.Xpm({type:ge,selectors:[["app-layer-editor"]],decls:27,vars:1,consts:[[1,"ion-padding"],[1,"upload"],["name","file","aria-label","file","slot","start"],["type","file","required","","id","file-upload",3,"change"],[4,"ngIf"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","checkmark-circle-outline","slot","end"],[3,"poiList"]],template:function(Y,se){1&Y&&(pe.TgZ(0,"ion-header"),pe.TgZ(1,"ion-toolbar"),pe.TgZ(2,"ion-title"),pe._uU(3," Edit Layer "),pe.qZA(),pe.qZA(),pe.qZA(),pe.TgZ(4,"ion-content",0),pe.TgZ(5,"p"),pe._uU(6,"POI layers are used to preview data from other Open Data sources. "),pe.qZA(),pe.TgZ(7,"p"),pe._uU(8,"Select a POI layer JSON file: "),pe.qZA(),pe.TgZ(9,"div"),pe.TgZ(10,"label",1),pe.TgZ(11,"ion-button"),pe._UZ(12,"ion-icon",2),pe.TgZ(13,"ion-label"),pe._uU(14,"Choose File.."),pe.qZA(),pe.qZA(),pe.TgZ(15,"input",3),pe.NdJ("change",function(){return se.previewFile()}),pe.qZA(),pe.qZA(),pe.qZA(),pe.YNc(16,g,3,2,"div",4),pe.qZA(),pe.TgZ(17,"ion-footer"),pe.TgZ(18,"ion-toolbar"),pe.TgZ(19,"ion-buttons",5),pe.TgZ(20,"ion-button",6),pe.NdJ("click",function(){return se.cancel()}),pe._UZ(21,"ion-icon",7),pe._uU(22," Cancel "),pe.qZA(),pe.qZA(),pe.TgZ(23,"ion-buttons",8),pe.TgZ(24,"ion-button",6),pe.NdJ("click",function(){return se.add()}),pe._uU(25," Add "),pe._UZ(26,"ion-icon",9),pe.qZA(),pe.qZA(),pe.qZA(),pe.qZA()),2&Y&&(pe.xp6(16),pe.Q6J("ngIf",se.fileData&&se.fileData.length>0))},directives:[l.Gu,l.sr,l.wd,l.W2,l.YG,l.gu,l.Q$,J.O5,j.o,l.fr,l.Sm],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]}),ge})()},3399:(An,vt,k)=>{"use strict";k.d(vt,{H:()=>Oi});var b=k(3855),d=k(6738),pe=k(7429),l=k(6099),J=k(3912),j=k(129),g=k(4006),ne=k(6895);function ge(K,q){if(1&K&&(d.TgZ(0,"ion-select-option",13),d._uU(1),d.qZA()),2&K){const L=q.$implicit;d.Q6J("value",L.ID),d.xp6(1),d.Oqu(L.Title)}}function Q(K,q){if(1&K&&(d.TgZ(0,"ion-select-option",16),d._uU(1),d.qZA()),2&K){const L=q.$implicit;d.Q6J("value",q.index),d.xp6(1),d.Oqu(L.Title)}}function Y(K,q){if(1&K){const L=d.EpF();d.TgZ(0,"ion-item"),d.TgZ(1,"ion-label",2),d._uU(2,"Journey Stage"),d.qZA(),d.TgZ(3,"ion-select",3),d.NdJ("ngModelChange",function(we){return d.CHM(L),d.oxw().selectedStageIndex=we}),d.TgZ(4,"ion-select-option",14),d._uU(5,"Create a Journey Stage"),d.qZA(),d.YNc(6,Q,2,2,"ion-select-option",15),d.qZA(),d.qZA()}if(2&K){const L=d.oxw();d.xp6(3),d.Q6J("ngModel",L.selectedStageIndex),d.xp6(3),d.Q6J("ngForOf",L.journeyManager.getJourneyStages(L.selectedJourneyID))}}function se(K,q){if(1&K){const L=d.EpF();d.TgZ(0,"ion-item"),d.TgZ(1,"ion-label",2),d._uU(2,"New Journey Name"),d.qZA(),d.TgZ(3,"ion-input",7),d.NdJ("ngModelChange",function(we){return d.CHM(L),d.oxw().newJourneyName=we}),d.qZA(),d.qZA()}if(2&K){const L=d.oxw();d.xp6(3),d.Q6J("ngModel",L.newJourneyName)}}let ue=(()=>{class K{constructor(L,de,we,Ye){this.appManager=L,this.navParams=de,this.journeyManager=we,this.modalController=Ye,this.poi=this.navParams.get("poi"),this.waypoint=new j.kA,this.waypoint.Title=this.poi.AddressInfo.Title,this.waypoint.PoiIDs=[this.poi.ID],this.waypoint.PoiList=[];const pt=new j.Qp("charging",1);pt.Poi=this.poi,pt.PoiID=this.poi.ID,this.waypoint.PoiList.push(pt),this.newJourneyName="Trip to "+this.poi.AddressInfo.Title}cancel(){this.modalController.dismiss()}add(){if(null!=this.selectedJourneyID&&""!==this.selectedJourneyID)this.journeyManager.addJourneyWaypoint(this.selectedJourneyID,this.selectedStageIndex,this.waypoint);else{const L=new j.fw;L.ID=Date.now().toString(),""===this.newJourneyName&&(this.newJourneyName="New Journey"),L.Title=this.newJourneyName,this.journeyManager.addJourney(L,this.waypoint)}this.journeyManager.saveJourneys(),this.modalController.dismiss()}}return K.\u0275fac=function(L){return new(L||K)(d.Y36(b.c),d.Y36(pe.X1),d.Y36(J.i),d.Y36(pe.IN))},K.\u0275cmp=d.Xpm({type:K,selectors:[["ng-component"]],decls:39,vars:8,consts:[[1,"journeys-page","ion-padding"],[1,"banner"],["position","stacked"],[3,"ngModel","ngModelChange"],["value","","checked",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","text",3,"ngModel","ngModelChange"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","add","slot","end"],[3,"value"],["value",""],["checked","",3,"value",4,"ngFor","ngForOf"],["checked","",3,"value"]],template:function(L,de){1&L&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-title"),d._uU(3," Edit Favourite "),d.qZA(),d.qZA(),d.qZA(),d.TgZ(4,"ion-content",0),d.TgZ(5,"div",1),d.TgZ(6,"h1"),d._uU(7),d.qZA(),d.TgZ(8,"p"),d._uU(9),d.qZA(),d.qZA(),d.TgZ(10,"p"),d._uU(11," Add Charging Location as a Journey Waypoint "),d.qZA(),d.TgZ(12,"ion-item"),d.TgZ(13,"ion-label",2),d._uU(14,"Add to a Journey"),d.qZA(),d.TgZ(15,"ion-select",3),d.NdJ("ngModelChange",function(Ye){return de.selectedJourneyID=Ye}),d.TgZ(16,"ion-select-option",4),d._uU(17,"Create a New Journey"),d.qZA(),d.YNc(18,ge,2,2,"ion-select-option",5),d.qZA(),d.qZA(),d.YNc(19,Y,7,2,"ion-item",6),d.YNc(20,se,4,1,"ion-item",6),d.TgZ(21,"ion-item"),d.TgZ(22,"ion-label",2),d._uU(23,"Name for this step of your journey"),d.qZA(),d.TgZ(24,"ion-input",7),d.NdJ("ngModelChange",function(Ye){return de.waypoint.Title=Ye}),d.qZA(),d.qZA(),d.TgZ(25,"ion-item"),d.TgZ(26,"ion-label",2),d._uU(27,"Other Notes"),d.qZA(),d.TgZ(28,"ion-textarea",3),d.NdJ("ngModelChange",function(Ye){return de.waypoint.Notes=Ye}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(29,"ion-footer"),d.TgZ(30,"ion-toolbar"),d.TgZ(31,"ion-buttons",8),d.TgZ(32,"ion-button",9),d.NdJ("click",function(){return de.cancel()}),d._UZ(33,"ion-icon",10),d._uU(34," Cancel "),d.qZA(),d.qZA(),d.TgZ(35,"ion-buttons",11),d.TgZ(36,"ion-button",9),d.NdJ("click",function(){return de.add()}),d._uU(37," Add "),d._UZ(38,"ion-icon",12),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&L&&(d.xp6(7),d.Oqu(de.poi.AddressInfo.Title),d.xp6(2),d.Oqu(de.poi.AddressInfo.AddressLine1),d.xp6(6),d.Q6J("ngModel",de.selectedJourneyID),d.xp6(3),d.Q6J("ngForOf",de.journeyManager.journeys),d.xp6(1),d.Q6J("ngIf",de.selectedJourneyID),d.xp6(1),d.Q6J("ngIf",!de.selectedJourneyID),d.xp6(4),d.Q6J("ngModel",de.waypoint.Title),d.xp6(4),d.Q6J("ngModel",de.waypoint.Notes))},directives:[pe.Gu,pe.sr,pe.wd,pe.W2,pe.Ie,pe.Q$,pe.t9,pe.QI,g.JJ,g.On,pe.n0,ne.sg,ne.O5,pe.pK,pe.j9,pe.g2,pe.fr,pe.Sm,pe.YG,pe.gu],encapsulation:2}),K})();var ye=k(7689);function xe(K,q){if(1&K){const L=d.EpF();d.TgZ(0,"ion-card"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-title",14),d._uU(3,"Preview"),d.qZA(),d.TgZ(4,"ion-buttons",15),d.TgZ(5,"ion-button",4),d.NdJ("click",function(){return d.CHM(L),d.oxw().rotateImage()}),d._UZ(6,"ion-icon",16),d.TgZ(7,"ion-label"),d._uU(8,"Rotate"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(9,"ion-card-content"),d.TgZ(10,"ion-list"),d.TgZ(11,"ion-item"),d.TgZ(12,"ion-label",17),d._uU(13,"Comment"),d.qZA(),d.TgZ(14,"ion-input",18),d.NdJ("ngModelChange",function(we){return d.CHM(L),d.oxw().comment=we}),d.qZA(),d.qZA(),d.qZA(),d._UZ(15,"img",19),d.qZA(),d.qZA()}if(2&K){const L=d.oxw();d.xp6(14),d.Q6J("ngModel",L.comment)}}let Ee=(()=>{class K{constructor(L,de,we,Ye,pt){this.navParams=L,this.appManager=de,this.nav=we,this.modalController=Ye,this.logging=pt,this.processingQuality=.8,this.targetWidth=1024,this.targetHeight=800,this.mode=de.platformMode,this.chargePointId=this.navParams.get("id"),this.poi=this.navParams.get("poi"),this.comment=""}processNativeImageSource(L){let de=L;const we=document.getElementById("img-upload-canvas"),Ye=we.getContext("2d"),pt=new Image;pt.onload=()=>{this.logging.log("img load:"+pt.width),we.width=pt.width,we.height=pt.height,Ye.fillStyle="rgb(0,0,0)",Ye.fillRect(0,0,we.width,we.height),Ye.drawImage(pt,0,0,we.width,we.height),this.imgData=we.toDataURL("image/png"),this.processImage()},pt.src=de}loadCameraOrLibraryImage(L=!1){this.logging.log("PWA mode: fetching image");const de=new FileReader;de.onload=()=>{this.imgData=de.result,this.processImage()},de.onerror=()=>{},de.readAsDataURL(document.getElementById("img-upload-media").files[0])}isBrowserMode(){return this.appManager.isPlatform("desktop")||this.appManager.isPlatform("hybrid")}processImage(){if(null!=this.imgData){const de=document.getElementById("img-upload-canvas"),we=de.getContext("2d"),Ye=new Image;Ye.onload=()=>{de.width=Ye.width,de.height=Ye.height,we.fillStyle="rgb(0,0,0)",we.fillRect(0,0,de.width,de.height),we.drawImage(Ye,0,0,de.width,de.height),this.refreshImageFromCanvas()},Ye.src=this.imgData}else this.logging.log("processImage: nothing to process.")}refreshImageFromCanvas(){const L=document.getElementById("img-upload-canvas");this.imgData=L.toDataURL("image/jpeg",.8),document.getElementById("preview").src=this.imgData}rotateImage(){const L=document.getElementById("img-upload-canvas");let de=new Image;de.src=L.toDataURL(),de.onload=()=>{let we=L.height,Ye=L.width;L.width=we,L.height=Ye,we=L.height,Ye=L.width;const pt=L.getContext("2d");pt.save(),pt.translate(Ye,we/Ye),pt.rotate(Math.PI/2),pt.drawImage(de,0,0),pt.restore(),de=null,this.refreshImageFromCanvas()}}performUpload(){var L=this;return(0,l.Z)(function*(){if(!L.imgData)return void(yield L.appManager.showToastNotification("Select an image to upload."));const de={chargePointID:L.chargePointId,comment:L.comment,imageDataBase64:L.imgData};yield L.appManager.showLoadingProgress("Uploading photo..");try{yield L.appManager.submitMediaItem(de),L.appManager.dismissLoadingProgress().then(()=>{L.appManager.showToastNotification("Upload completed"),L.modalController.dismiss()}),L.appManager.analytics.appEvent("MediaUpload","Completed")}catch{yield L.appManager.dismissLoadingProgress(),yield L.appManager.showToastNotification("Upload failed, please try again."),L.appManager.analytics.appEvent("MediaUpload","Failed")}})()}cancel(){var L=this;return(0,l.Z)(function*(){yield L.modalController.dismiss()})()}}return K.\u0275fac=function(L){return new(L||K)(d.Y36(pe.X1),d.Y36(b.c),d.Y36(pe.SH),d.Y36(pe.IN),d.Y36(ye.z))},K.\u0275cmp=d.Xpm({type:K,selectors:[["ng-component"]],decls:32,vars:3,consts:[[1,"media-upload"],[1,"ion-padding"],[1,"banner"],[1,"upload"],[3,"click"],["name","camera","aria-label","camera","slot","start"],["type","file","required","","id","img-upload-media",3,"change"],["inputFile",""],["id","img-upload-canvas",2,"display","none","width","500","height","500","border","1px solid red"],[4,"ngIf"],["slot","secondary"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],["slot","start"],["slot","end"],["name","refresh","slot","start"],["position","floating"],["type","text","placeholder","(optional comment)",3,"ngModel","ngModelChange"],["id","preview",2,"max-width","500px"]],template:function(L,de){if(1&L){const we=d.EpF();d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-title"),d._uU(3," Share Photo "),d.qZA(),d.qZA(),d.qZA(),d.TgZ(4,"ion-content",0),d.TgZ(5,"div",1),d.TgZ(6,"div",2),d.TgZ(7,"h1"),d._uU(8),d.qZA(),d.TgZ(9,"p"),d._uU(10),d.qZA(),d.qZA(),d.TgZ(11,"p"),d._uU(12,"You can upload a photo from your device or take a new photo: "),d.qZA(),d.TgZ(13,"div",3),d.TgZ(14,"ion-button",4),d.NdJ("click",function(){return d.CHM(we),d.MAs(19).click()}),d._UZ(15,"ion-icon",5),d.TgZ(16,"ion-label"),d._uU(17,"Choose Photo.."),d.qZA(),d.qZA(),d.TgZ(18,"input",6,7),d.NdJ("change",function(){return de.loadCameraOrLibraryImage()}),d.qZA(),d.qZA(),d._UZ(20,"canvas",8),d.YNc(21,xe,16,1,"ion-card",9),d.qZA(),d.qZA(),d.TgZ(22,"ion-footer"),d.TgZ(23,"ion-toolbar"),d.TgZ(24,"ion-buttons",10),d.TgZ(25,"ion-button",4),d.NdJ("click",function(){return de.cancel()}),d._UZ(26,"ion-icon",11),d._uU(27," Cancel "),d.qZA(),d.qZA(),d.TgZ(28,"ion-buttons",12),d.TgZ(29,"ion-button",4),d.NdJ("click",function(){return de.performUpload()}),d._uU(30," Upload "),d._UZ(31,"ion-icon",13),d.qZA(),d.qZA(),d.qZA(),d.qZA()}2&L&&(d.xp6(8),d.Oqu(de.poi.AddressInfo.Title),d.xp6(2),d.Oqu(de.poi.AddressInfo.AddressLine1),d.xp6(11),d.Q6J("ngIf",null!=de.imgData))},directives:[pe.Gu,pe.sr,pe.wd,pe.W2,pe.YG,pe.gu,pe.Q$,ne.O5,pe.PM,pe.Sm,pe.FN,pe.q_,pe.Ie,pe.pK,pe.j9,g.JJ,g.On,pe.fr],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]}),K})();var We=k(3334);function be(K,q){if(1&K&&(d.TgZ(0,"ion-select-option",19),d._uU(1),d.qZA()),2&K){const L=q.$implicit;d.Q6J("value",L.ID),d.xp6(1),d.Oqu(L.Title)}}function Se(K,q){if(1&K&&(d.TgZ(0,"ion-select-option",19),d._uU(1),d.qZA()),2&K){const L=q.$implicit;d.Q6J("value",L.ID),d.xp6(1),d.Oqu(L.Title)}}let ze=(()=>{class K{constructor(L,de,we,Ye,pt,Ct,Je,Lt){this.navParams=L,this.appManager=de,this.nav=we,this.zone=Ye,this.loadingController=pt,this.modalController=Ct,this.logging=Je,this.router=Lt,this.commentModel={ChargePointID:this.navParams.get("id"),Comment:"",CheckinStatusTypeID:10,CommentTypeID:10,Rating:null},this.poi=this.navParams.get("poi"),this.commentTypes=de.referenceDataManager.getCommentTypes(!0,!0),this.checkinTypes=de.referenceDataManager.getCheckinStatusTypes(!0,!0)}onPageWillEnter(){}cancel(){this.modalController.dismiss()}add(){var L=this;return(0,l.Z)(function*(){const de=yield L.loadingController.create({message:"Sending .."});yield de.present(),(yield L.appManager.submitComment(L.commentModel).catch(Ye=>{L.appManager.showToastNotification("There was a problem submitting your comment."),L.loadingController.dismiss(),L.appManager.analytics.appEvent("Comment","Failed")}))&&(L.logging.log("Comment submitted"),yield de.dismiss(),yield L.modalController.dismiss(),L.appManager.analytics.appEvent("Comment","Submitted"))})()}}return K.\u0275fac=function(L){return new(L||K)(d.Y36(pe.X1),d.Y36(b.c),d.Y36(pe.SH),d.Y36(d.R0b),d.Y36(pe.HT),d.Y36(pe.IN),d.Y36(ye.z),d.Y36(We.F0))},K.\u0275cmp=d.Xpm({type:K,selectors:[["ng-component"]],decls:53,vars:8,consts:[["color","primary"],[1,"comment-page","ion-padding"],[1,"banner"],[1,"ion-padding"],["position","stacked"],[3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","(optional comment)",3,"ngModel","ngModelChange"],["value","5"],["value","4"],["value","3"],["value","2"],["value","1"],["value",""],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],[3,"value"]],template:function(L,de){1&L&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar",0),d.TgZ(2,"ion-title"),d._uU(3," Add Comment "),d.qZA(),d.qZA(),d.qZA(),d.TgZ(4,"ion-content",1),d.TgZ(5,"div",2),d.TgZ(6,"h1"),d._uU(7),d.qZA(),d.TgZ(8,"p"),d._uU(9),d.qZA(),d.qZA(),d.TgZ(10,"p",3),d._uU(11,"Recent Check-ins are a big help to other drivers when planning their journey. Tell everyone what you thought about this charging location. "),d.qZA(),d.TgZ(12,"ion-list"),d.TgZ(13,"ion-item"),d.TgZ(14,"ion-label",4),d._uU(15,"Comment Type"),d.qZA(),d.TgZ(16,"ion-select",5),d.NdJ("ngModelChange",function(Ye){return de.commentModel.CommentTypeID=Ye}),d.YNc(17,be,2,2,"ion-select-option",6),d.qZA(),d.qZA(),d.TgZ(18,"ion-item"),d.TgZ(19,"ion-label",4),d._uU(20,"What Did You Think?"),d.qZA(),d.TgZ(21,"ion-input",7),d.NdJ("ngModelChange",function(Ye){return de.commentModel.Comment=Ye}),d.qZA(),d.qZA(),d.TgZ(22,"ion-item"),d.TgZ(23,"ion-label",4),d._uU(24,"Did You Successfully Charge?"),d.qZA(),d.TgZ(25,"ion-select",5),d.NdJ("ngModelChange",function(Ye){return de.commentModel.CheckinStatusTypeID=Ye}),d.YNc(26,Se,2,2,"ion-select-option",6),d.qZA(),d.qZA(),d.TgZ(27,"ion-item"),d.TgZ(28,"ion-label",4),d._uU(29,"Your Rating"),d.qZA(),d.TgZ(30,"ion-select",5),d.NdJ("ngModelChange",function(Ye){return de.commentModel.Rating=Ye}),d.TgZ(31,"ion-select-option",8),d._uU(32,"5 - Excellent"),d.qZA(),d.TgZ(33,"ion-select-option",9),d._uU(34,"4 - Good"),d.qZA(),d.TgZ(35,"ion-select-option",10),d._uU(36,"3 - Average"),d.qZA(),d.TgZ(37,"ion-select-option",11),d._uU(38,"2 - Not Good"),d.qZA(),d.TgZ(39,"ion-select-option",12),d._uU(40,"1 - Bad"),d.qZA(),d.TgZ(41,"ion-select-option",13),d._uU(42,"Not Rated"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(43,"ion-footer"),d.TgZ(44,"ion-toolbar"),d.TgZ(45,"ion-buttons",14),d.TgZ(46,"ion-button",15),d.NdJ("click",function(){return de.cancel()}),d._UZ(47,"ion-icon",16),d._uU(48," Cancel "),d.qZA(),d.qZA(),d.TgZ(49,"ion-buttons",17),d.TgZ(50,"ion-button",15),d.NdJ("click",function(){return de.add()}),d._uU(51," Submit "),d._UZ(52,"ion-icon",18),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&L&&(d.xp6(7),d.Oqu(de.poi.AddressInfo.Title),d.xp6(2),d.Oqu(de.poi.AddressInfo.AddressLine1),d.xp6(7),d.Q6J("ngModel",de.commentModel.CommentTypeID),d.xp6(1),d.Q6J("ngForOf",de.commentTypes),d.xp6(4),d.Q6J("ngModel",de.commentModel.Comment),d.xp6(4),d.Q6J("ngModel",de.commentModel.CheckinStatusTypeID),d.xp6(1),d.Q6J("ngForOf",de.checkinTypes),d.xp6(4),d.Q6J("ngModel",de.commentModel.Rating))},directives:[pe.Gu,pe.sr,pe.wd,pe.W2,pe.q_,pe.Ie,pe.Q$,pe.t9,pe.QI,g.JJ,g.On,ne.sg,pe.n0,pe.pK,pe.j9,pe.fr,pe.Sm,pe.YG,pe.gu],encapsulation:2}),K})();var tt=k(2951),et=k(9698),Be=k(9492),C=k(4508),Ge=k(6579),_t=k(9397),ht=k(1099);function wt(K,q){if(1&K&&(d.TgZ(0,"div"),d.TgZ(1,"small"),d._uU(2),d.qZA(),d.qZA()),2&K){const L=d.oxw(2);d.xp6(2),d.Oqu(L.connectionSummary)}}function xt(K,q){if(1&K&&(d.TgZ(0,"div"),d.TgZ(1,"small"),d._uU(2),d.qZA(),d.qZA()),2&K){const L=d.oxw(2);d.xp6(2),d.Oqu(L.poi.OperatorInfo.Title)}}function gt(K,q){if(1&K){const L=d.EpF();d.ynx(0),d.TgZ(1,"ion-button",28),d.NdJ("click",function(){return d.CHM(L),d.oxw(2).addFavourite()}),d._UZ(2,"ion-icon",29),d.TgZ(3,"ion-label"),d._uU(4,"Favourite"),d.qZA(),d.qZA(),d.TgZ(5,"ion-button",13),d.NdJ("click",function(){return d.CHM(L),d.oxw(2).edit()}),d._UZ(6,"ion-icon",30),d.TgZ(7,"ion-label"),d._uU(8,"Edit"),d.qZA(),d.qZA(),d.BQk()}}function Bt(K,q){if(1&K){const L=d.EpF();d.ynx(0),d.TgZ(1,"ion-button",31),d.NdJ("click",function(){return d.CHM(L),d.oxw(2).launchNavigation()}),d._UZ(2,"ion-icon",32),d.TgZ(3,"ion-label"),d._uU(4,"Navigate"),d.qZA(),d.qZA(),d.BQk()}}function Ht(K,q){if(1&K){const L=d.EpF();d.ynx(0),d.TgZ(1,"ion-button",33),d.NdJ("click",function(){return d.CHM(L),d.oxw(2).addComment()}),d._UZ(2,"ion-icon",34),d.TgZ(3,"ion-label"),d._uU(4,"Add Comment"),d.qZA(),d.qZA(),d.BQk()}}function Gn(K,q){if(1&K){const L=d.EpF();d.ynx(0),d.TgZ(1,"ion-button",35),d.NdJ("click",function(){return d.CHM(L),d.oxw(2).addMedia()}),d._UZ(2,"ion-icon",36),d.TgZ(3,"ion-label"),d._uU(4," Add Photo"),d.qZA(),d.qZA(),d.BQk()}}function It(K,q){if(1&K&&(d.TgZ(0,"div"),d._uU(1),d.qZA()),2&K){const L=d.oxw(4);d.xp6(1),d.hij(" ",L.poi.AddressInfo.AddressLine1,"")}}function jt(K,q){if(1&K&&(d.TgZ(0,"div"),d._uU(1),d.qZA()),2&K){const L=d.oxw(4);d.xp6(1),d.hij(" ",L.poi.AddressInfo.AddressLine2,"")}}function Ut(K,q){if(1&K&&(d.TgZ(0,"div"),d._uU(1),d.qZA()),2&K){const L=d.oxw(4);d.xp6(1),d.hij(" ",L.poi.AddressInfo.Town,"")}}function Yt(K,q){if(1&K&&(d.TgZ(0,"div"),d._uU(1),d.qZA()),2&K){const L=d.oxw(4);d.xp6(1),d.hij(" ",L.poi.AddressInfo.StateOrProvince,"")}}function zt(K,q){if(1&K&&(d.TgZ(0,"div"),d._uU(1),d.qZA()),2&K){const L=d.oxw(4);d.xp6(1),d.hij(" ",L.poi.AddressInfo.Postcode,"")}}function Zt(K,q){if(1&K&&(d.TgZ(0,"div"),d._uU(1),d.qZA()),2&K){const L=d.oxw(4);d.xp6(1),d.hij(" ",L.poi.AddressInfo.Country.Title,"")}}function ln(K,q){if(1&K&&(d.TgZ(0,"p"),d._uU(1),d.qZA()),2&K){const L=d.oxw(4);d.xp6(1),d.hij(" ",L.poi.AddressInfo.AccessComments," ")}}function xn(K,q){if(1&K&&(d.TgZ(0,"p"),d._UZ(1,"ion-icon",48),d.TgZ(2,"span",45),d._uU(3),d.qZA(),d.qZA()),2&K){const L=d.oxw(4);d.xp6(3),d.Oqu(L.poi.AddressInfo.ContactTelephone1)}}function an(K,q){if(1&K&&(d.TgZ(0,"p"),d._UZ(1,"ion-icon",48),d.TgZ(2,"span",45),d._uU(3),d.qZA(),d.qZA()),2&K){const L=d.oxw(4);d.xp6(3),d.Oqu(L.poi.AddressInfo.ContactTelephone2)}}function Kt(K,q){if(1&K&&(d.TgZ(0,"p"),d._UZ(1,"ion-icon",49),d.TgZ(2,"span",45),d._uU(3),d.qZA(),d.qZA()),2&K){const L=d.oxw(4);d.xp6(3),d.Oqu(L.poi.AddressInfo.ContactEmail)}}function mt(K,q){if(1&K&&(d.TgZ(0,"p"),d._UZ(1,"ion-icon",50),d.TgZ(2,"span",45),d.TgZ(3,"a",51),d._uU(4),d.qZA(),d.qZA(),d.qZA()),2&K){const L=d.oxw(4);d.xp6(3),d.s9C("href",L.poi.AddressInfo.RelatedURL,d.LSH),d.xp6(1),d.Oqu(L.poi.AddressInfo.RelatedURL)}}function Wt(K,q){if(1&K&&(d.TgZ(0,"ion-card"),d.TgZ(1,"ion-card-header"),d._UZ(2,"ion-icon",43),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.TgZ(5,"ion-card-content"),d.TgZ(6,"ion-grid"),d.TgZ(7,"ion-row"),d.TgZ(8,"ion-col"),d.TgZ(9,"ion-label",44),d._uU(10),d.ALo(11,"translate"),d.qZA(),d.TgZ(12,"div",45),d.YNc(13,It,2,1,"div",0),d.YNc(14,jt,2,1,"div",0),d.YNc(15,Ut,2,1,"div",0),d.YNc(16,Yt,2,1,"div",0),d.YNc(17,zt,2,1,"div",0),d.YNc(18,Zt,2,1,"div",0),d.qZA(),d.qZA(),d.TgZ(19,"ion-col"),d.YNc(20,ln,2,1,"p",0),d.YNc(21,xn,4,1,"p",0),d.YNc(22,an,4,1,"p",0),d.YNc(23,Kt,4,1,"p",0),d.YNc(24,mt,5,2,"p",0),d.qZA(),d.qZA(),d.TgZ(25,"ion-row"),d.TgZ(26,"ion-col"),d._UZ(27,"ion-icon",46),d.TgZ(28,"ion-label",47),d._uU(29),d.ALo(30,"number"),d.ALo(31,"number"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&K){const L=d.oxw(3);d.xp6(3),d.hij(" ",d.lcZ(4,15,"ocm.details.location.sectionTitle")," "),d.xp6(7),d.hij(" ",d.lcZ(11,17,"ocm.details.location.address"),""),d.xp6(3),d.Q6J("ngIf",L.poi.AddressInfo.AddressLine1),d.xp6(1),d.Q6J("ngIf",L.poi.AddressInfo.AddressLine2),d.xp6(1),d.Q6J("ngIf",L.poi.AddressInfo.Town),d.xp6(1),d.Q6J("ngIf",L.poi.AddressInfo.StateOrProvince),d.xp6(1),d.Q6J("ngIf",L.poi.AddressInfo.Postcode),d.xp6(1),d.Q6J("ngIf",L.poi.AddressInfo.Country),d.xp6(2),d.Q6J("ngIf",L.poi.AddressInfo.AccessComments),d.xp6(1),d.Q6J("ngIf",L.poi.AddressInfo.ContactTelephone1),d.xp6(1),d.Q6J("ngIf",L.poi.AddressInfo.ContactTelephone2),d.xp6(1),d.Q6J("ngIf",L.poi.AddressInfo.ContactEmail),d.xp6(1),d.Q6J("ngIf",L.poi.AddressInfo.RelatedURL),d.xp6(5),d.AsE(" ",d.xi3(30,19,L.poi.AddressInfo.Latitude,"1.1-13")," , ",d.xi3(31,22,L.poi.AddressInfo.Longitude,"1.1-13")," ")}}function On(K,q){if(1&K&&(d.TgZ(0,"p"),d.TgZ(1,"span",44),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"span",45),d._uU(5),d.qZA(),d.qZA()),2&K){const L=d.oxw(3);d.xp6(2),d.hij("",d.lcZ(3,2,"ocm.details.numberOfPoints"),":"),d.xp6(3),d.Oqu(L.poi.NumberOfPoints)}}function bn(K,q){if(1&K&&(d.TgZ(0,"p"),d.TgZ(1,"span",44),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"span",45),d._uU(5),d.qZA(),d.qZA()),2&K){const L=d.oxw(3);d.xp6(2),d.hij("",d.lcZ(3,2,"ocm.details.operationalStatus"),":"),d.xp6(3),d.hij(" ",L.poi.StatusType.Title," ")}}function jn(K,q){if(1&K&&(d.TgZ(0,"p"),d.TgZ(1,"span",44),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"span",45),d._uU(5),d.qZA(),d.qZA()),2&K){const L=d.oxw(3);d.xp6(2),d.hij("",d.lcZ(3,2,"ocm.details.usageType"),":"),d.xp6(3),d.Oqu(L.poi.UsageType.Title)}}function li(K,q){if(1&K&&(d.TgZ(0,"p"),d.TgZ(1,"span",44),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"span",45),d._uU(5),d.qZA(),d.qZA()),2&K){const L=d.oxw(3);d.xp6(2),d.hij("",d.lcZ(3,2,"ocm.details.usageCost"),":"),d.xp6(3),d.hij(" ",L.poi.UsageCost,"")}}function $i(K,q){if(1&K&&(d.TgZ(0,"p"),d._UZ(1,"br"),d._uU(2),d.ALo(3,"translate"),d._UZ(4,"br"),d.TgZ(5,"span",45),d._uU(6),d.qZA(),d.qZA()),2&K){const L=d.oxw(3);d.xp6(2),d.hij("",d.lcZ(3,2,"ocm.details.generalComments"),": "),d.xp6(4),d.Oqu(L.poi.GeneralComments)}}function rr(K,q){if(1&K&&(d.TgZ(0,"p"),d._UZ(1,"ion-icon",54),d._uU(2),d.qZA()),2&K){const L=d.oxw(4);d.xp6(2),d.hij(" ",L.poi.OperatorInfo.WebsiteURL," ")}}function Bi(K,q){if(1&K&&(d.TgZ(0,"p"),d._UZ(1,"ion-icon",49),d._uU(2),d.qZA()),2&K){const L=d.oxw(4);d.xp6(2),d.hij(" ",L.poi.OperatorInfo.ContactEmail," ")}}function _i(K,q){if(1&K&&(d.TgZ(0,"p"),d._UZ(1,"ion-icon",49),d._uU(2),d.qZA()),2&K){const L=d.oxw(4);d.xp6(2),d.hij(" ",L.poi.OperatorInfo.FaultReportEmail," ")}}function tr(K,q){if(1&K&&(d.TgZ(0,"ion-card"),d.TgZ(1,"ion-card-header"),d._UZ(2,"ion-icon",52),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.TgZ(5,"ion-card-content"),d.TgZ(6,"div",45),d.TgZ(7,"p",53),d._uU(8),d.qZA(),d.YNc(9,rr,3,1,"p",0),d.YNc(10,Bi,3,1,"p",0),d.YNc(11,_i,3,1,"p",0),d.qZA(),d.qZA(),d.qZA()),2&K){const L=d.oxw(3);d.xp6(3),d.hij(" ",d.lcZ(4,5,"ocm.details.operator.sectionTitle")," "),d.xp6(5),d.hij(" ",L.poi.OperatorInfo.Title," "),d.xp6(1),d.Q6J("ngIf",L.poi.OperatorInfo.WebsiteURL),d.xp6(1),d.Q6J("ngIf",null!=L.poi.OperatorInfo.ContactEmail),d.xp6(1),d.Q6J("ngIf",null!=L.poi.OperatorInfo.FaultReportEmail&&L.poi.OperatorInfo.FaultReportEmail!=L.poi.OperatorInfo.ContactEmail)}}function gi(K,q){if(1&K){const L=d.EpF();d.TgZ(0,"a",56),d.NdJ("click",function(){d.CHM(L);const we=d.oxw(4);return we.launchURL(we.poi.DataProvider.WebsiteURL)}),d._uU(1),d.qZA()}if(2&K){const L=d.oxw(4);d.xp6(1),d.Oqu(L.poi.DataProvider.WebsiteURL)}}function Ti(K,q){if(1&K&&(d.TgZ(0,"div",45),d.TgZ(1,"h3"),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"p"),d._uU(5),d.qZA(),d.YNc(6,gi,2,1,"a",55),d.TgZ(7,"p"),d._uU(8),d.qZA(),d.qZA()),2&K){const L=d.oxw(3);d.xp6(2),d.hij(" ",d.lcZ(3,4,"ocm.details.dataProvider.sectionTitle")," "),d.xp6(3),d.Oqu(null==L.poi.DataProvider?null:L.poi.DataProvider.Title),d.xp6(1),d.Q6J("ngIf",L.poi.DataProvider.WebsiteURL),d.xp6(2),d.Oqu(null==L.poi.DataProvider?null:L.poi.DataProvider.License)}}function Xt(K,q){if(1&K&&(d.TgZ(0,"div",37),d.YNc(1,Wt,32,25,"ion-card",0),d.TgZ(2,"ion-card"),d.TgZ(3,"ion-card-header"),d._UZ(4,"ion-icon",38),d._uU(5),d.ALo(6,"translate"),d.qZA(),d.TgZ(7,"ion-card-content"),d.YNc(8,On,6,4,"p",0),d._UZ(9,"app-equipment-details",39),d.qZA(),d.qZA(),d.TgZ(10,"ion-card"),d.TgZ(11,"ion-card-header"),d._UZ(12,"ion-icon",40),d._uU(13," Usage Restrictions "),d.qZA(),d.TgZ(14,"ion-card-content"),d.YNc(15,bn,6,4,"p",0),d.YNc(16,jn,6,4,"p",0),d.YNc(17,li,6,4,"p",0),d.YNc(18,$i,7,4,"p",0),d.qZA(),d.qZA(),d.YNc(19,tr,12,7,"ion-card",0),d.TgZ(20,"ion-card"),d.TgZ(21,"ion-card-header"),d._UZ(22,"ion-icon",41),d._uU(23),d.ALo(24,"translate"),d.qZA(),d.TgZ(25,"ion-card-content"),d.YNc(26,Ti,9,6,"div",42),d.qZA(),d.qZA(),d.qZA()),2&K){const L=d.oxw(2);d.xp6(1),d.Q6J("ngIf",L.poi.AddressInfo),d.xp6(4),d.hij(" ",d.lcZ(6,11,"ocm.details.equipment.sectionTitle")," "),d.xp6(3),d.Q6J("ngIf",null!=L.poi.NumberOfPoints),d.xp6(1),d.Q6J("item",L.poi),d.xp6(6),d.Q6J("ngIf",null!=L.poi.StatusType),d.xp6(1),d.Q6J("ngIf",null!=L.poi.UsageType),d.xp6(1),d.Q6J("ngIf",null!=L.poi.UsageCost),d.xp6(1),d.Q6J("ngIf",null!=L.poi.GeneralComments),d.xp6(1),d.Q6J("ngIf",L.poi.OperatorInfo),d.xp6(4),d.hij(" ",d.lcZ(24,13,"ocm.details.advancedDetails")," "),d.xp6(3),d.Q6J("ngIf",L.poi.DataProvider)}}function Oe(K,q){if(1&K&&d._UZ(0,"img",60),2&K){const L=d.oxw().$implicit;d.s9C("src",null==L.User?null:L.User.ProfileImageURL,d.LSH)}}function ae(K,q){if(1&K&&(d.TgZ(0,"span"),d._uU(1),d.qZA()),2&K){const L=d.oxw().$implicit;d.xp6(1),d.Oqu(L.User.Username)}}function Re(K,q){if(1&K&&(d.TgZ(0,"span"),d._uU(1),d.qZA()),2&K){const L=d.oxw().$implicit;d.xp6(1),d.Oqu(L.Username)}}function lt(K,q){if(1&K&&(d.TgZ(0,"p",45),d._uU(1),d.qZA()),2&K){const L=d.oxw().$implicit;d.xp6(1),d.hij(" ",null==L.CommentType?null:L.CommentType.Title," ")}}function Le(K,q){if(1&K&&(d.TgZ(0,"p"),d.TgZ(1,"span",44),d._uU(2,"Rating:"),d.qZA(),d.TgZ(3,"span",45),d._uU(4),d.qZA(),d.qZA()),2&K){const L=d.oxw().$implicit;d.xp6(4),d.hij("",L.Rating," out of 5")}}function Rt(K,q){1&K&&(d.ynx(0),d._UZ(1,"ion-icon",61),d.BQk())}function me(K,q){1&K&&(d.ynx(0),d._UZ(1,"ion-icon",62),d.BQk())}function He(K,q){if(1&K&&(d.TgZ(0,"p"),d.YNc(1,Rt,2,0,"ng-container",0),d.YNc(2,me,2,0,"ng-container",0),d._uU(3),d.qZA()),2&K){const L=d.oxw().$implicit;d.xp6(1),d.Q6J("ngIf",!0===L.CheckinStatusType.IsPositive),d.xp6(1),d.Q6J("ngIf",!1===L.CheckinStatusType.IsPositive),d.xp6(1),d.hij(" ",L.CheckinStatusType.Title," ")}}function Ft(K,q){if(1&K&&(d.TgZ(0,"ion-card"),d.TgZ(1,"ion-item"),d.TgZ(2,"ion-avatar",19),d.YNc(3,Oe,1,1,"img",59),d.qZA(),d.TgZ(4,"ion-label"),d.YNc(5,ae,2,1,"span",0),d.YNc(6,Re,2,1,"span",0),d.qZA(),d.TgZ(7,"ion-label",20),d._uU(8),d.ALo(9,"date"),d.qZA(),d.qZA(),d.TgZ(10,"ion-card-content"),d.TgZ(11,"p"),d._uU(12),d.qZA(),d.YNc(13,lt,2,1,"p",42),d.YNc(14,Le,5,1,"p",0),d.YNc(15,He,4,3,"p",0),d.qZA(),d.qZA()),2&K){const L=q.$implicit;d.xp6(3),d.Q6J("ngIf",L.User&&L.User.ProfileImageURL),d.xp6(2),d.Q6J("ngIf",L.User),d.xp6(1),d.Q6J("ngIf",!L.User),d.xp6(2),d.hij(" ",d.lcZ(9,8,L.DateCreated)," "),d.xp6(4),d.Oqu(L.Comment),d.xp6(1),d.Q6J("ngIf",10!=L.CommentTypeID),d.xp6(1),d.Q6J("ngIf",L.Rating),d.xp6(1),d.Q6J("ngIf",L.CheckinStatusType)}}function Qt(K,q){if(1&K&&(d.ynx(0),d.YNc(1,Ft,16,10,"ion-card",58),d.BQk()),2&K){const L=d.oxw(3);d.xp6(1),d.Q6J("ngForOf",L.poi.UserComments)}}function Jn(K,q){1&K&&(d.TgZ(0,"p",21),d._uU(1),d.ALo(2,"translate"),d.qZA()),2&K&&(d.xp6(1),d.hij(" ",d.lcZ(2,1,"ocm.details.commentsAndRatings.zeroComments")," "))}function Ki(K,q){if(1&K&&(d.TgZ(0,"div"),d.YNc(1,Qt,2,1,"ng-container",0),d.YNc(2,Jn,3,3,"p",57),d.qZA()),2&K){const L=d.oxw(2);d.xp6(1),d.Q6J("ngIf",1==L.poi._hasComments),d.xp6(1),d.Q6J("ngIf",0==L.poi._hasComments)}}function Di(K,q){if(1&K&&d._UZ(0,"img",60),2&K){const L=d.oxw().$implicit;d.s9C("src",null==L.User?null:L.User.ProfileImageURL,d.LSH)}}function mi(K,q){if(1&K&&(d.TgZ(0,"span"),d._uU(1),d.qZA()),2&K){const L=d.oxw().$implicit;d.xp6(1),d.Oqu(L.User.Username)}}function ci(K,q){if(1&K&&(d.TgZ(0,"span"),d._uU(1),d.qZA()),2&K){const L=d.oxw().$implicit;d.xp6(1),d.Oqu(L.Username)}}function xr(K,q){if(1&K&&(d.TgZ(0,"ion-card"),d._UZ(1,"img",60),d.TgZ(2,"ion-item"),d.TgZ(3,"ion-avatar",19),d.YNc(4,Di,1,1,"img",59),d.qZA(),d.TgZ(5,"ion-label"),d.YNc(6,mi,2,1,"span",0),d.YNc(7,ci,2,1,"span",0),d.qZA(),d.TgZ(8,"ion-label",20),d._uU(9),d.ALo(10,"date"),d.qZA(),d.qZA(),d.TgZ(11,"ion-card-content"),d.TgZ(12,"p"),d._uU(13),d.qZA(),d.qZA(),d.qZA()),2&K){const L=q.$implicit;d.xp6(1),d.s9C("src",L.ItemMediumURL,d.LSH),d.xp6(3),d.Q6J("ngIf",L.User&&L.User.ProfileImageURL),d.xp6(2),d.Q6J("ngIf",L.User),d.xp6(1),d.Q6J("ngIf",!L.User),d.xp6(2),d.hij(" ",d.lcZ(10,6,L.DateCreated)," "),d.xp6(4),d.Oqu(L.Comment)}}function Ii(K,q){if(1&K&&(d.TgZ(0,"div"),d.YNc(1,xr,14,8,"ion-card",58),d.qZA()),2&K){const L=d.oxw(3);d.xp6(1),d.Q6J("ngForOf",L.poi.MediaItems)}}function hr(K,q){1&K&&(d.TgZ(0,"div",21),d.TgZ(1,"p",63),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.qZA()),2&K&&(d.xp6(2),d.hij(" ",d.lcZ(3,1,"ocm.details.mediaItems.addPrompt"),""))}function yi(K,q){if(1&K&&(d.TgZ(0,"div"),d.YNc(1,Ii,2,1,"div",0),d.YNc(2,hr,4,3,"div",57),d.qZA()),2&K){const L=d.oxw(2);d.xp6(1),d.Q6J("ngIf",L.poi._hasPhotos),d.xp6(1),d.Q6J("ngIf",!L.poi._hasPhotos)}}function kr(K,q){if(1&K&&(d.TgZ(0,"p",64),d._uU(1),d.qZA()),2&K){const L=d.oxw(2);d.xp6(1),d.hij(" ",L.json,"")}}function gr(K,q){if(1&K){const L=d.EpF();d.TgZ(0,"div"),d.TgZ(1,"div",1),d.TgZ(2,"div",2),d.TgZ(3,"h2"),d._uU(4),d.qZA(),d.TgZ(5,"div"),d.TgZ(6,"small"),d._uU(7),d.qZA(),d.qZA(),d.YNc(8,wt,3,1,"div",0),d.YNc(9,xt,3,1,"div",0),d.TgZ(10,"ion-badge",3),d._uU(11),d.ALo(12,"number"),d.qZA(),d.qZA(),d.TgZ(13,"ion-fab",4),d.TgZ(14,"ion-fab-button"),d._UZ(15,"ion-icon",5),d.qZA(),d.TgZ(16,"ion-fab-list",6),d.TgZ(17,"ion-fab-button",7),d.NdJ("click",function(){return d.CHM(L),d.oxw().addComment()}),d._UZ(18,"ion-icon",8),d.qZA(),d.TgZ(19,"ion-fab-button",9),d.NdJ("click",function(){return d.CHM(L),d.oxw().addMedia()}),d._UZ(20,"ion-icon",10),d.qZA(),d.TgZ(21,"ion-fab-button",11),d.NdJ("click",function(){return d.CHM(L),d.oxw().addFavourite()}),d._UZ(22,"ion-icon",12),d.qZA(),d.TgZ(23,"ion-fab-button",13),d.NdJ("click",function(){return d.CHM(L),d.oxw().edit()}),d._UZ(24,"ion-icon",14),d.qZA(),d.TgZ(25,"ion-fab-button",15),d.NdJ("click",function(){return d.CHM(L),d.oxw().refresh()}),d._UZ(26,"ion-icon",16),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(27,"ion-refresher",17),d.NdJ("ionRefresh",function(we){return d.CHM(L),d.oxw().refresh(we)}),d._UZ(28,"ion-refresher-content",18),d.qZA(),d.TgZ(29,"ion-toolbar"),d.TgZ(30,"ion-buttons",19),d.YNc(31,gt,9,0,"ng-container",0),d.qZA(),d.TgZ(32,"ion-buttons",20),d.YNc(33,Bt,5,0,"ng-container",0),d.YNc(34,Ht,5,0,"ng-container",0),d.YNc(35,Gn,5,0,"ng-container",0),d.qZA(),d.qZA(),d.TgZ(36,"div",21),d.TgZ(37,"ion-segment",22),d.NdJ("ngModelChange",function(we){return d.CHM(L),d.oxw().selectedTab=we}),d.TgZ(38,"ion-segment-button",23),d.TgZ(39,"ion-label"),d._uU(40," Details "),d.qZA(),d.qZA(),d.TgZ(41,"ion-segment-button",24),d.TgZ(42,"ion-label"),d._uU(43),d.qZA(),d.qZA(),d.TgZ(44,"ion-segment-button",25),d.TgZ(45,"ion-label"),d._uU(46),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.YNc(47,Xt,27,15,"div",26),d.YNc(48,Ki,3,2,"div",0),d.YNc(49,yi,3,2,"div",0),d.YNc(50,kr,2,1,"p",27),d.qZA()}if(2&K){const L=d.oxw();d.xp6(1),d.Udp("background-image",L.backdropImage?"url("+L.backdropImage+")":""),d.xp6(3),d.hij(" ",L.poi.AddressInfo.Title," "),d.xp6(3),d.hij("OCM-",L.poi.ID,""),d.xp6(1),d.Q6J("ngIf",L.connectionSummary),d.xp6(1),d.Q6J("ngIf",L.poi.OperatorInfo),d.xp6(2),d.Oqu(d.xi3(12,18,L.avgRating,"1.1-1")),d.xp6(20),d.Q6J("ngIf","location"==L.selectedTab),d.xp6(2),d.Q6J("ngIf","location"==L.selectedTab),d.xp6(1),d.Q6J("ngIf","comments"==L.selectedTab),d.xp6(1),d.Q6J("ngIf","media"==L.selectedTab),d.xp6(2),d.Q6J("ngModel",L.selectedTab),d.xp6(6),d.hij("Comments (",L.poi.UserComments?L.poi.UserComments.length:0,")"),d.xp6(3),d.hij(" Photos (",L.poi.MediaItems?L.poi.MediaItems.length:0,")"),d.xp6(1),d.Q6J("ngIf","location"==L.selectedTab),d.xp6(1),d.Q6J("ngIf","comments"==L.selectedTab),d.xp6(1),d.Q6J("ngIf","media"==L.selectedTab),d.xp6(1),d.Q6J("ngIf",1==L.appManager.isDebugMode)}}function Tr(K,q){1&K&&(d.TgZ(0,"div"),d.TgZ(1,"h2"),d._uU(2,"POI Not Found"),d.qZA(),d.TgZ(3,"p"),d._uU(4,"The POI details could not be loaded."),d.qZA(),d.qZA())}let Ci=(()=>{class K{constructor(L,de,we,Ye,pt,Ct,Je,Lt){this.appManager=L,this.nav=de,this.translate=we,this.logging=Ye,this.modalController=pt,this.actionSheetController=Ct,this.poiManager=Je,this.router=Lt,this.hasNavBar=!1}ngOnChanges(L){if(this.logging.log("In ngOnChanges of POI Details"),null!=this.poi&&null!=this.poi.AddressInfo){if(this.selectedTab="location",null!=this.poi.MediaItems&&this.poi.MediaItems.length>0){this.poi._hasPhotos=!0;for(let de of this.poi.MediaItems)de.ItemMediumURL=de.ItemThumbnailURL.replace(".thmb.",".medi.");this.backdropImage=this.poi.MediaItems[this.poi.MediaItems.length-1].ItemThumbnailURL.replace(".thmb.",".medi.")}else this.poi._hasPhotos=!1,this.backdropImage=null;if(null!=this.poi.UserComments&&this.poi.UserComments.length>0){this.poi._hasComments=!0;try{let de=this.poi.UserComments.filter(we=>we.Rating>0);if(de.length>0){let we=0;for(let Ye of de)we+=Ye.Rating;this.avgRating=we/de.length}else this.avgRating=null}catch{}}else this.poi._hasComments=!1;if(this.poi.Connections&&this.poi.Connections.length>0){let de="";for(let we of this.poi.Connections)-1==de.indexOf(we.ConnectionType.Title)&&(de+=(""!=de?", ":"")+we.ConnectionType.Title);this.connectionSummary=de}}}ngOnInit(){this.logging.log("In ngInit of POI Details")}get staticMapURL(){return"https://maps.googleapis.com/maps/api/staticmap?key="+(new tt.X).googleMapsAPIKey+"&center="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude}get staticMapSize(){return 0===this.appManager.clientWidth?"240x100":this.appManager.clientWidth>=800?"640x100":this.appManager.clientWidth>=400?"400x100":"240x100"}continueAddComment(){var L=this;return(0,l.Z)(function*(){const de=yield L.modalController.create({component:ze,componentProps:{id:L.poi.ID,poi:L.poi}});setTimeout(()=>{L.refresh()},1e3),yield de.present()})()}addComment(){var L=this;return(0,l.Z)(function*(){if(L.appManager.isUserAuthenticated(!0))yield L.continueAddComment();else{const de=yield L.modalController.create({component:Be.F});de.onDidDismiss().then((0,l.Z)(function*(){L.appManager.isUserAuthenticated(!0)&&(yield L.continueAddComment())})),yield de.present()}})()}continueAddMedia(){var L=this;return(0,l.Z)(function*(){const de=yield L.modalController.create({component:Ee,componentProps:{id:L.poi.ID,poi:L.poi}});de.onDidDismiss().then(()=>{setTimeout(()=>{L.refresh()},1e3)}),yield de.present()})()}addMedia(){var L=this;return(0,l.Z)(function*(){if(L.appManager.isUserAuthenticated(!0))yield L.continueAddMedia();else{const de=yield L.modalController.create({component:Be.F});de.onDidDismiss().then((0,l.Z)(function*(){L.appManager.isUserAuthenticated(!0)&&(yield L.continueAddMedia())})),yield de.present()}})()}addFavourite(){var L=this;return(0,l.Z)(function*(){yield(yield L.actionSheetController.create({header:"Add Favourite",buttons:[{text:"Add to Journey",handler:()=>{L.modalController.create({component:ue,componentProps:{poi:L.poi}}).then(we=>we.present())}},{text:"Cancel",role:"cancel",handler:()=>{}}]})).present()})()}launchNavigation(){this.appManager.isPlatform("ios")?this.appManager.launchWebPage("https://maps.apple.com/?ll="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude):this.appManager.launchWebPage("https://maps.google.com/?q="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude)}launchURL(L){this.appManager.launchWebPage(L)}continueEdit(){var L=this;return(0,l.Z)(function*(){const de=yield L.modalController.create({component:C.Y,componentProps:{id:L.poi.ID}});return de.onDidDismiss().then(we=>{L.refresh()}),yield de.present()})()}edit(){var L=this;return(0,l.Z)(function*(){if(Ge.c.isFeatureEnabled("EDIT_POI"))if(L.appManager.isUserAuthenticated(!0))yield L.continueEdit();else{const de=yield L.modalController.create({component:Be.F});de.onDidDismiss().then((0,l.Z)(function*(){L.appManager.isUserAuthenticated(!0)&&(yield L.continueEdit())})),yield de.present()}else L.appManager.launchOCMWebPage("/poi/edit/"+L.poi.ID)})()}refresh(L=null){this.poi&&this.poiManager.getPOIById(this.poi.ID,!0,!0).then(de=>{de&&(this.poi=de,this.ngOnChanges(null)),L&&L.target.complete()})}}return K.\u0275fac=function(L){return new(L||K)(d.Y36(b.c),d.Y36(pe.SH),d.Y36(_t.sK),d.Y36(ye.z),d.Y36(pe.IN),d.Y36(pe.BX),d.Y36(et.R),d.Y36(We.F0))},K.\u0275cmp=d.Xpm({type:K,selectors:[["poi-details"]],inputs:{poi:"poi"},features:[d.TTD],decls:2,vars:2,consts:[[4,"ngIf"],[1,"banner"],[1,"banner-content"],["color","primary","title","Average User Rating"],["vertical","top","horizontal","end","slot","fixed"],["name","add"],["side","bottom"],["title","Add a comment or charging check-in",3,"click"],["name","chatbubbles"],["title","Add a Photo",3,"click"],["name","camera"],["title","Add to Favourites",3,"click"],["name","star"],["title","Submit an Edit",3,"click"],["name","create"],["title","Refresh",3,"click"],["name","refresh"],["slot","fixed",3,"ionRefresh"],["pullingIcon","caret-down","pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refreshing..."],["slot","start"],["slot","end"],[1,"ion-padding"],[3,"ngModel","ngModelChange"],["value","location","selected",""],["value","comments"],["value","media"],["class","address-details",4,"ngIf"],["style","white-space: pre-wrap;",4,"ngIf"],["size","small","title","Add to Favourites",3,"click"],["name","star","slot","start"],["name","create","slot","start"],[3,"click"],["name","navigate","slot","start"],["size","small","title","Add a comment or charging check-in",3,"click"],["name","chatbubbles","slot","start"],["size","small","title","Add a Photo",3,"click"],["name","camera","slot","start"],[1,"address-details"],["name","battery-charging"],[3,"item"],["name","book"],["name","information-circle"],["class","details",4,"ngIf"],["name","map"],[1,"label"],[1,"details"],["name","pin"],[1,"details-minor"],["name","call"],["name","mail"],["name","globe"],["target","_system",3,"href"],["name","help-circle"],[1,"ion-padding-left"],["name","link"],["href","javascript:void(0)",3,"click",4,"ngIf"],["href","javascript:void(0)",3,"click"],["class","ion-padding",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"src",4,"ngIf"],[3,"src"],["name","checkmark-circle","color","success",2,"font-size","2em"],["name","close-circle","color","danger"],[1,"subtle"],[2,"white-space","pre-wrap"]],template:function(L,de){1&L&&(d.YNc(0,gr,51,21,"div",0),d.YNc(1,Tr,5,0,"div",0)),2&L&&(d.Q6J("ngIf",null!=de.poi&&null!=de.poi.AddressInfo),d.xp6(1),d.Q6J("ngIf",null==de.poi||null==de.poi.AddressInfo))},directives:[ne.O5,pe.yp,pe.IJ,pe.W4,pe.gu,pe.zq,pe.nJ,pe.Wo,pe.sr,pe.Sm,pe.YG,pe.Q$,pe.cJ,pe.QI,g.JJ,g.On,pe.GO,pe.PM,pe.Zi,pe.FN,pe.jY,pe.Nd,pe.wI,ht.B,ne.sg,pe.Ie,pe.BJ],pipes:[ne.JJ,_t.X$,ne.uU],styles:[".banner[_ngcontent-%COMP%]{background-color:#4f712f;color:#ffffffec;padding:1em;text-shadow:#000 1px 1px 1px;min-height:180px;background-size:cover}.banner[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.banner-content[_ngcontent-%COMP%]{padding-right:48px}h3[_ngcontent-%COMP%]{font-weight:700}.label[_ngcontent-%COMP%]{color:#000;font-weight:700;font-size:12px}.details[_ngcontent-%COMP%]{color:#707d61;margin-left:1em;font-size:12px}.details-minor[_ngcontent-%COMP%]{color:#707d61;font-size:12px}p[_ngcontent-%COMP%]{display:block;padding:4px}ion-card-header[_ngcontent-%COMP%]{font-weight:700;padding-bottom:0}ion-card-content[_ngcontent-%COMP%]{padding-top:4px}"]}),K})(),Oi=(()=>{class K{constructor(L,de,we){this.modalController=L,this.navParams=de,this.appManager=we,this.hasNavbar=!1,this.poi=this.navParams.get("item"),this.appManager.analytics.viewEvent("POIDetails")}close(){this.modalController.dismiss()}}return K.\u0275fac=function(L){return new(L||K)(d.Y36(pe.IN),d.Y36(pe.X1),d.Y36(b.c))},K.\u0275cmp=d.Xpm({type:K,selectors:[["ng-component"]],decls:11,vars:3,consts:[["color","primary"],["slot","start"],[3,"click"],["name","close","slot","icon-only"],[1,"poi-details"],[3,"poi"]],template:function(L,de){1&L&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar",0),d.TgZ(2,"ion-title"),d._uU(3),d.TgZ(4,"small"),d._uU(5),d.qZA(),d.qZA(),d.TgZ(6,"ion-buttons",1),d.TgZ(7,"ion-button",2),d.NdJ("click",function(){return de.close()}),d._UZ(8,"ion-icon",3),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(9,"ion-content",4),d._UZ(10,"poi-details",5),d.qZA()),2&L&&(d.xp6(3),d.hij(" ",de.poi.AddressInfo.Title," "),d.xp6(2),d.hij("OCM-",de.poi.ID,""),d.xp6(5),d.Q6J("poi",de.poi))},directives:[pe.Gu,pe.sr,pe.wd,pe.Sm,pe.YG,pe.gu,pe.W2,Ci],styles:['.left-col[_ngcontent-%COMP%]{float:left;width:50%;overflow:auto}.right-col[_ngcontent-%COMP%]{float:right;width:50%;overflow:auto}.row[_ngcontent-%COMP%]:after{content:"";display:table;clear:both;overflow:auto}.row[_ngcontent-%COMP%]{margin-bottom:1em}.subtle[_ngcontent-%COMP%]{color:silver}@media screen and (max-width: 768px){.left-col[_ngcontent-%COMP%]{float:none;width:100%}.right-col[_ngcontent-%COMP%]{margin-top:1em;float:none;width:100%}}.address-details[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:200px;width:auto}ion-label[_ngcontent-%COMP%]{overflow:inherit}ion-title[_ngcontent-%COMP%] > small[_ngcontent-%COMP%]{color:#ffffffbf}']}),K})()},1948:(An,vt,k)=>{"use strict";k.r(vt),k.d(vt,{PoiEditorPageModule:()=>Q});var b=k(6895),d=k(4006),pe=k(3334),l=k(7429),J=k(4508),j=k(9397),g=k(8936),ne=k(6738);const ge=[{path:"",component:J.Y}];let Q=(()=>{class Y{}return Y.\u0275fac=function(ue){return new(ue||Y)},Y.\u0275mod=ne.oAB({type:Y}),Y.\u0275inj=ne.cJS({imports:[[b.ez,d.u5,l.Pc,j.aw,g.e,pe.Bz.forChild(ge)]]}),Y})()},4508:(An,vt,k)=>{"use strict";k.d(vt,{Y:()=>lt});var b=k(6099),d=k(3855),pe=k(2206),l=k(6579),J=k(9698),j=k(4781),g=k(6738),ne=k(4120),ge=k(5906),Q=k(553),Y=k(7689),se=k(6260),ue=k(529),ye=k(6895),xe=k(7429);function Ee(Le,Rt){if(1&Le){const me=g.EpF();g.ynx(0),g.TgZ(1,"ion-note"),g.TgZ(2,"p"),g._uU(3," The closest address to this position is: "),g.qZA(),g.TgZ(4,"p"),g.TgZ(5,"strong"),g._uU(6),g.qZA(),g._UZ(7,"br"),g._uU(8),g._UZ(9,"br"),g.TgZ(10,"ion-button",3),g.NdJ("click",function(){return g.CHM(me),g.oxw().useAddressSelection()}),g._uU(11,"Use this address below "),g._UZ(12,"ion-icon",4),g.qZA(),g.qZA(),g.qZA(),g.BQk()}if(2&Le){const me=g.oxw();g.xp6(6),g.Oqu(me.suggestedAddress.AddressLine1),g.xp6(2),g.HOy(" ",me.suggestedAddress.AddressLine2," ",me.suggestedAddress.Town," ",me.suggestedAddress.StateOrProvince," ",me.suggestedAddress.Postcode," ")}}let We=(()=>{class Le{constructor(me,He,Ft,Qt,Jn){this.mapping=me,this.events=He,this.logging=Ft,this.http=Qt,this.appManager=Jn,this.latitudeChange=new g.vpe,this.longitudeChange=new g.vpe,this.suggestedAddress=null,this.suggestedAddressChange=new g.vpe,this.onUseSuggestedAddress=new g.vpe,this.suggestedAddressAttribution=null,this.suggestedAddressAttributionChange=new g.vpe,this.isMapInitialised=!1}ngOnInit(){this.mapService=new Q.k(this.events,this.logging,this.http),this.mapService.initAPI(),this.mapOptions=new ge._,this.mapOptions.mapType=this.appManager.searchSettings.MapType,this.mapOptions.onMapMoveCompleted=()=>{let me;me=this.mapService.getMapCenter(),me.subscribe(He=>{He&&(this.latitude=He.coords.latitude,this.longitude=He.coords.longitude,this.latitudeChange.emit(this.latitude),this.longitudeChange.emit(this.longitude),this.getAddressForCurrentLatLng())})}}ngAfterContentInit(){this.focusMap()}ngOnDestroy(){this.mapService.disposeMap()}focusMap(){0==this.isMapInitialised&&this.mapService&&0!=this.latitude&&0!=this.longitude&&(this.isMapInitialised=!0,this.mapService.initMap("editor-map",this.mapOptions,null),this.mapService.setMapCenter(new ne.jR(this.latitude,this.longitude)),this.originalMarkerPos=new ne.wC(this.latitude,this.longitude))}ngOnChanges(me){this.focusMap()}getAddressForCurrentLatLng(){var me=this;return(0,b.Z)(function*(){me.latitude&&me.longitude&&me.appManager.api.fetchReverseGeocodeResult(me.latitude,me.longitude).then(He=>{He.AddressInfo&&(me.suggestedAddress=He.AddressInfo)})})()}useAddressSelection(){this.onUseSuggestedAddress.emit({suggestedAddress:this.suggestedAddress,attribution:this.suggestedAddressAttribution}),this.suggestedAddress=null,this.suggestedAddressAttribution=null}}return Le.\u0275fac=function(me){return new(me||Le)(g.Y36(j.v),g.Y36(se.z),g.Y36(Y.z),g.Y36(ue.eN),g.Y36(d.c))},Le.\u0275cmp=g.Xpm({type:Le,selectors:[["app-poi-location-editor"]],inputs:{latitude:"latitude",longitude:"longitude"},outputs:{latitudeChange:"latitudeChange",longitudeChange:"longitudeChange",suggestedAddressChange:"suggestedAddressChange",onUseSuggestedAddress:"onUseSuggestedAddress",suggestedAddressAttributionChange:"suggestedAddressAttributionChange"},features:[g.TTD],decls:4,vars:1,consts:[[1,"instruction"],["id","editor-map"],[4,"ngIf"],["size","small",3,"click"],["slot","end","name","copy"]],template:function(me,He){1&me&&(g.TgZ(0,"p",0),g._uU(1,"Drag the map to center the marker on the charging location:"),g.qZA(),g._UZ(2,"div",1),g.YNc(3,Ee,13,5,"ng-container",2)),2&me&&(g.xp6(3),g.Q6J("ngIf",He.suggestedAddress))},directives:[ye.O5,xe.uN,xe.YG,xe.gu],styles:["#editor-map[_ngcontent-%COMP%]{border:1px solid gainsboro;background-color:gray;width:100%;height:128px}"]}),Le})();var be=k(6799),Se=k(4006);function ze(Le,Rt){if(1&Le&&(g.TgZ(0,"ion-select-option",14),g._uU(1),g.qZA()),2&Le){const me=Rt.$implicit;g.Q6J("value",me.ID),g.xp6(1),g.Oqu(me.Title)}}function tt(Le,Rt){if(1&Le&&(g.TgZ(0,"ion-select-option",14),g._uU(1),g.qZA()),2&Le){const me=Rt.$implicit;g.Q6J("value",me.ID),g.xp6(1),g.Oqu(me.Title)}}function et(Le,Rt){if(1&Le&&(g.TgZ(0,"ion-select-option",14),g._uU(1),g.qZA()),2&Le){const me=Rt.$implicit;g.Q6J("value",me.ID),g.xp6(1),g.Oqu(me.Title)}}let Be=(()=>{class Le{constructor(me,He){this.modalController=me,this.referenceDataManager=He,this.useFilteredConnectionTypes=!0,this.useFilteredOperators=!0}get isAddMode(){return!(null!=this.conn&&this.conn.ID>0)}get connectionTypes(){return this.referenceDataManager.getConnectionTypes(this.useFilteredConnectionTypes)}get currentTypes(){return this.referenceDataManager.getOutputCurrentTypes()}get statusTypes(){return this.referenceDataManager.getStatusTypes().filter(me=>1==me.IsUserSelectable)}ngOnInit(){}save(){this.modalController.dismiss({item:this.conn})}cancel(){this.modalController.dismiss()}}return Le.\u0275fac=function(me){return new(me||Le)(g.Y36(xe.IN),g.Y36(be.W))},Le.\u0275cmp=g.Xpm({type:Le,selectors:[["app-poi-equipment-editor"]],decls:60,vars:13,consts:[[1,"ion-padding"],["position","floating"],[3,"ngModel","ngModelChange"],["value","0"],[3,"value",4,"ngFor","ngForOf"],["type","number",3,"ngModel","ngModelChange"],["type","text","placeholder","(optional) other comments",3,"ngModel","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],["slot","start"],[3,"click"],["name","close","slot","start"],["slot","end"],["color","success",3,"click"],["name","send","slot","end"],[3,"value"]],template:function(me,He){1&me&&(g.TgZ(0,"ion-header"),g.TgZ(1,"ion-toolbar"),g.TgZ(2,"ion-title"),g._uU(3),g.qZA(),g.qZA(),g.qZA(),g.TgZ(4,"ion-content",0),g.TgZ(5,"p"),g._uU(6,"Please provide as much information as you can about the equipment. If you don't know then leave the field blank. At a minimum you should include the Connection Type and approximate Power kW (max)."),g.qZA(),g.TgZ(7,"ion-item"),g.TgZ(8,"ion-label",1),g._uU(9,"Connection Type"),g.qZA(),g.TgZ(10,"ion-select",2),g.NdJ("ngModelChange",function(Qt){return He.conn.ConnectionTypeID=Qt}),g.TgZ(11,"ion-select-option",3),g._uU(12,"Unknown"),g.qZA(),g.YNc(13,ze,2,2,"ion-select-option",4),g.qZA(),g.qZA(),g.TgZ(14,"ion-item"),g.TgZ(15,"ion-label",1),g._uU(16,"Supply Type"),g.qZA(),g.TgZ(17,"ion-select",2),g.NdJ("ngModelChange",function(Qt){return He.conn.CurrentTypeID=Qt}),g.TgZ(18,"ion-select-option",3),g._uU(19,"Unknown"),g.qZA(),g.YNc(20,tt,2,2,"ion-select-option",4),g.qZA(),g.qZA(),g.TgZ(21,"ion-item"),g.TgZ(22,"ion-label",1),g._uU(23,"Power (kW)"),g.qZA(),g.TgZ(24,"ion-input",5),g.NdJ("ngModelChange",function(Qt){return He.conn.PowerKW=Qt}),g.qZA(),g.qZA(),g.TgZ(25,"ion-item"),g.TgZ(26,"ion-label",1),g._uU(27,"Amps"),g.qZA(),g.TgZ(28,"ion-input",5),g.NdJ("ngModelChange",function(Qt){return He.conn.Amps=Qt}),g.qZA(),g.qZA(),g.TgZ(29,"ion-item"),g.TgZ(30,"ion-label",1),g._uU(31,"Voltage"),g.qZA(),g.TgZ(32,"ion-input",5),g.NdJ("ngModelChange",function(Qt){return He.conn.Voltage=Qt}),g.qZA(),g.qZA(),g.TgZ(33,"ion-item"),g.TgZ(34,"ion-label",1),g._uU(35,"Status"),g.qZA(),g.TgZ(36,"ion-select",2),g.NdJ("ngModelChange",function(Qt){return He.conn.StatusTypeID=Qt}),g.YNc(37,et,2,2,"ion-select-option",4),g.qZA(),g.qZA(),g.TgZ(38,"ion-item"),g.TgZ(39,"ion-label",1),g._uU(40,"Quantity Available"),g.qZA(),g.TgZ(41,"ion-input",5),g.NdJ("ngModelChange",function(Qt){return He.conn.Quantity=Qt}),g.qZA(),g.qZA(),g.TgZ(42,"ion-item"),g.TgZ(43,"ion-label",1),g._uU(44,"Comment"),g.qZA(),g.TgZ(45,"ion-input",6),g.NdJ("ngModelChange",function(Qt){return He.conn.Comments=Qt}),g.qZA(),g.qZA(),g.TgZ(46,"ion-item"),g.TgZ(47,"ion-label",1),g._uU(48,"Operators Reference"),g.qZA(),g.TgZ(49,"ion-input",7),g.NdJ("ngModelChange",function(Qt){return He.conn.Reference=Qt}),g.qZA(),g.qZA(),g.qZA(),g.TgZ(50,"ion-footer"),g.TgZ(51,"ion-toolbar"),g.TgZ(52,"ion-buttons",8),g.TgZ(53,"ion-button",9),g.NdJ("click",function(){return He.cancel()}),g._UZ(54,"ion-icon",10),g._uU(55," Cancel "),g.qZA(),g.qZA(),g.TgZ(56,"ion-buttons",11),g.TgZ(57,"ion-button",12),g.NdJ("click",function(){return He.save()}),g._uU(58," OK "),g._UZ(59,"ion-icon",13),g.qZA(),g.qZA(),g.qZA(),g.qZA()),2&me&&(g.xp6(3),g.Oqu(He.isAddMode?"Add Equipment":"Edit Equipment"),g.xp6(7),g.Q6J("ngModel",He.conn.ConnectionTypeID),g.xp6(3),g.Q6J("ngForOf",He.connectionTypes),g.xp6(4),g.Q6J("ngModel",He.conn.CurrentTypeID),g.xp6(3),g.Q6J("ngForOf",He.currentTypes),g.xp6(4),g.Q6J("ngModel",He.conn.PowerKW),g.xp6(4),g.Q6J("ngModel",He.conn.Amps),g.xp6(4),g.Q6J("ngModel",He.conn.Voltage),g.xp6(4),g.Q6J("ngModel",He.conn.StatusTypeID),g.xp6(1),g.Q6J("ngForOf",He.statusTypes),g.xp6(4),g.Q6J("ngModel",He.conn.Quantity),g.xp6(4),g.Q6J("ngModel",He.conn.Comments),g.xp6(4),g.Q6J("ngModel",He.conn.Reference))},directives:[xe.Gu,xe.sr,xe.wd,xe.W2,xe.Ie,xe.Q$,xe.t9,xe.QI,Se.JJ,Se.On,xe.n0,ye.sg,xe.pK,xe.as,xe.j9,xe.fr,xe.Sm,xe.YG,xe.gu],styles:[""]}),Le})();var C=(()=>{return(Le=C||(C={}))[Le.Unknown=0]="Unknown",Le[Le.CurrentlyAvailable=10]="CurrentlyAvailable",Le[Le.CurrentlyInUse=20]="CurrentlyInUse",Le[Le.TemporarilyUnavailable=30]="TemporarilyUnavailable",Le[Le.Operational=50]="Operational",Le[Le.PartlyOperational=75]="PartlyOperational",Le[Le.NotOperational=100]="NotOperational",Le[Le.PlannedForFutureDate=150]="PlannedForFutureDate",Le[Le.RemovedDecomissioned=200]="RemovedDecomissioned",C;var Le})(),Ge=(()=>{return(Le=Ge||(Ge={}))[Le.UnknownOperator=1]="UnknownOperator",Le[Le.SiteOwner=45]="SiteOwner",Ge;var Le})(),wt=k(6585);function xt(Le,Rt){if(1&Le&&(g.TgZ(0,"ion-select-option",5),g._uU(1),g.qZA()),2&Le){const me=Rt.$implicit;g.Q6J("value",me.ID),g.xp6(1),g.Oqu(me.Title)}}function gt(Le,Rt){1&Le&&(g.TgZ(0,"ion-select-option",6),g._uU(1,"Other..."),g.qZA())}function Bt(Le,Rt){if(1&Le){const me=g.EpF();g.TgZ(0,"ion-item"),g.TgZ(1,"ion-label",1),g._uU(2,"Network Operator"),g.qZA(),g.TgZ(3,"ion-select",2),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw().operatorId=Ft})("ionChange",function(){return g.CHM(me),g.oxw().onOperatorChange()}),g.YNc(4,xt,2,2,"ion-select-option",3),g.YNc(5,gt,2,0,"ion-select-option",4),g.qZA(),g.qZA()}if(2&Le){const me=g.oxw();g.xp6(3),g.Q6J("ngModel",me.operatorId),g.xp6(1),g.Q6J("ngForOf",me.operators),g.xp6(1),g.Q6J("ngIf",me.useFilteredOperators)}}function Ht(Le,Rt){if(1&Le){const me=g.EpF();g.TgZ(0,"ion-item"),g.TgZ(1,"ion-label"),g._uU(2,"Network Operator"),g.qZA(),g.TgZ(3,"ion-searchbar",7),g.NdJ("ionCancel",function(){return g.CHM(me),g.oxw().cancelOperatorLookup()})("ngModelChange",function(Ft){return g.CHM(me),g.oxw().operatorSearchKeyword=Ft})("ionChange",function(Ft){return g.CHM(me),g.oxw().searchOperators(Ft)}),g.qZA(),g.qZA()}if(2&Le){const me=g.oxw();g.xp6(3),g.Q6J("ngModel",me.operatorSearchKeyword)}}function Gn(Le,Rt){if(1&Le){const me=g.EpF();g.TgZ(0,"ion-item",9),g.NdJ("click",function(){const Qt=g.CHM(me).$implicit;return g.oxw(2).onOperatorChange(Qt)}),g.TgZ(1,"ion-avatar",10),g._UZ(2,"ion-icon",11),g.qZA(),g.TgZ(3,"ion-label"),g.TgZ(4,"p"),g._uU(5),g.qZA(),g.TgZ(6,"p"),g._uU(7),g.qZA(),g.qZA(),g.qZA()}if(2&Le){const me=Rt.$implicit;g.xp6(5),g.Oqu(me.Title),g.xp6(2),g.Oqu(me.WebsiteURL)}}function It(Le,Rt){if(1&Le&&(g.ynx(0),g.TgZ(1,"ion-list"),g.YNc(2,Gn,8,2,"ion-item",8),g.qZA(),g.BQk()),2&Le){const me=g.oxw();g.xp6(2),g.Q6J("ngForOf",me.operatorSearchResults)}}function jt(Le,Rt){if(1&Le){const me=g.EpF();g.ynx(0),g.TgZ(1,"ion-item"),g.TgZ(2,"ion-avatar",10),g._UZ(3,"ion-icon",12),g.qZA(),g.TgZ(4,"ion-label"),g.TgZ(5,"p"),g._uU(6),g.qZA(),g.TgZ(7,"p"),g._uU(8),g.qZA(),g.TgZ(9,"ion-button",9),g.NdJ("click",function(){return g.CHM(me),g.oxw().selectedOperator=null}),g._uU(10,"Change"),g.qZA(),g.qZA(),g.qZA(),g.BQk()}if(2&Le){const me=g.oxw();g.xp6(6),g.Oqu(me.selectedOperator.Title),g.xp6(2),g.Oqu(me.selectedOperator.WebsiteURL)}}let Ut=(()=>{class Le{constructor(me){this.referenceDataManager=me,this.operatorId=null,this.useFilteredOperators=null,this.operatorChanged=new g.vpe,this.operatorCache=[],this.operatorSearchResults=[],this.operatorSearchKeyword="",this.selectedOperator=null}get operators(){return this.referenceDataManager.getNetworkOperators(this.useFilteredOperators)}ngOnInit(){this.operatorCache=this.referenceDataManager.getNetworkOperators(!1),null!=this.operatorId&&(this.selectedOperator=this.operatorCache.find(me=>me.ID==this.operatorId))}searchOperators(){this.operatorSearchResults=[],0!=this.operatorSearchKeyword.length&&(this.operatorSearchResults=this.operatorCache?this.operatorCache.filter(me=>me.Title.toLowerCase().startsWith(this.operatorSearchKeyword.toLowerCase())||me.Title.toLowerCase().startsWith("("+this.operatorSearchKeyword.toLowerCase())).slice(0,10):[])}onOperatorChange(me=null){var He=this;return(0,b.Z)(function*(){null==me&&He.operatorId&&(me=He.operatorCache.find(Ft=>Ft.ID==He.operatorId)),null!=me&&(He.operatorSearchResults=[],He.selectedOperator=me,He.operatorId=me.ID),He.operatorId?He.operatorChanged.emit(He.selectedOperator):He.useFilteredOperators=!1})()}cancelOperatorLookup(){this.selectedOperator=null}}return Le.\u0275fac=function(me){return new(me||Le)(g.Y36(be.W))},Le.\u0275cmp=g.Xpm({type:Le,selectors:[["app-operator-lookup"]],inputs:{operatorId:"operatorId",useFilteredOperators:"useFilteredOperators"},outputs:{operatorChanged:"operatorChanged"},decls:4,vars:4,consts:[[4,"ngIf"],["position","floating"],[3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["value","",4,"ngIf"],[3,"value"],["value",""],["placeholder","Search by network name (in any country)","showCancelButton","focus","autocomplete","on",3,"ngModel","ionCancel","ngModelChange","ionChange"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["item-left",""],["name","card"],["name","locate"]],template:function(me,He){1&me&&(g.YNc(0,Bt,6,3,"ion-item",0),g.YNc(1,Ht,4,1,"ion-item",0),g.YNc(2,It,3,1,"ng-container",0),g.YNc(3,jt,11,2,"ng-container",0)),2&me&&(g.Q6J("ngIf",He.useFilteredOperators&&!He.selectedOperator),g.xp6(1),g.Q6J("ngIf",!He.useFilteredOperators&&!He.selectedOperator),g.xp6(1),g.Q6J("ngIf",He.operatorSearchResults.length>0),g.xp6(1),g.Q6J("ngIf",null!=He.selectedOperator))},directives:[ye.O5,xe.Ie,xe.Q$,xe.t9,xe.QI,Se.JJ,Se.On,ye.sg,xe.n0,xe.VI,xe.j9,xe.q_,xe.BJ,xe.gu,xe.YG],styles:[""]}),Le})();var Yt=k(1099);function zt(Le,Rt){1&Le&&g._UZ(0,"ion-icon",13)}function Zt(Le,Rt){1&Le&&g._UZ(0,"ion-icon",13)}function ln(Le,Rt){1&Le&&g._UZ(0,"ion-icon",13)}function xn(Le,Rt){if(1&Le&&(g.TgZ(0,"ion-select-option",27),g._uU(1),g.qZA()),2&Le){const me=Rt.$implicit;g.Q6J("value",me.ID),g.xp6(1),g.Oqu(me.Title)}}function an(Le,Rt){if(1&Le){const me=g.EpF();g.ynx(0),g.TgZ(1,"app-poi-location-editor",14,15),g.NdJ("latitudeChange",function(Ft){return g.CHM(me),g.oxw(2).item.AddressInfo.Latitude=Ft})("longitudeChange",function(Ft){return g.CHM(me),g.oxw(2).item.AddressInfo.Longitude=Ft})("onUseSuggestedAddress",function(Ft){return g.CHM(me),g.oxw(2).useSuggestedAddress(Ft)}),g.qZA(),g.TgZ(3,"ion-list"),g.TgZ(4,"ion-item"),g.TgZ(5,"ion-label",16),g._uU(6,"Location Name"),g.qZA(),g.TgZ(7,"ion-input",17),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw(2).item.AddressInfo.Title=Ft}),g.qZA(),g.qZA(),g.TgZ(8,"ion-item"),g.TgZ(9,"ion-label",16),g._uU(10,"Address Line 1"),g.qZA(),g.TgZ(11,"ion-input",18),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw(2).item.AddressInfo.AddressLine1=Ft}),g.qZA(),g.qZA(),g.TgZ(12,"ion-item"),g.TgZ(13,"ion-label",16),g._uU(14,"Address Line 2"),g.qZA(),g.TgZ(15,"ion-input",19),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw(2).item.AddressInfo.AddressLine2=Ft}),g.qZA(),g.qZA(),g.TgZ(16,"ion-item"),g.TgZ(17,"ion-label",16),g._uU(18,"Town"),g.qZA(),g.TgZ(19,"ion-input",20),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw(2).item.AddressInfo.Town=Ft}),g.qZA(),g.qZA(),g.TgZ(20,"ion-item"),g.TgZ(21,"ion-label",16),g._uU(22,"State or Province"),g.qZA(),g.TgZ(23,"ion-input",21),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw(2).item.AddressInfo.StateOrProvince=Ft}),g.qZA(),g.qZA(),g.TgZ(24,"ion-item"),g.TgZ(25,"ion-label",16),g._uU(26,"Postal Code"),g.qZA(),g.TgZ(27,"ion-input",22),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw(2).item.AddressInfo.Postcode=Ft}),g.qZA(),g.qZA(),g.TgZ(28,"ion-item"),g.TgZ(29,"ion-label",16),g._uU(30,"Country"),g.qZA(),g.TgZ(31,"ion-select",23),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw(2).item.AddressInfo.CountryID=Ft})("ionChange",function(){return g.CHM(me),g.oxw(2).onCountryChange()}),g.YNc(32,xn,2,2,"ion-select-option",24),g.qZA(),g.qZA(),g.TgZ(33,"ion-item"),g.TgZ(34,"ion-label",16),g._uU(35,"Latitude"),g.qZA(),g.TgZ(36,"ion-input",25),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw(2).item.AddressInfo.Latitude=Ft}),g.qZA(),g.qZA(),g.TgZ(37,"ion-item"),g.TgZ(38,"ion-label",16),g._uU(39,"Longitude"),g.qZA(),g.TgZ(40,"ion-input",26),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw(2).item.AddressInfo.Longitude=Ft}),g.qZA(),g.qZA(),g.qZA(),g.BQk()}if(2&Le){const me=g.oxw(2);g.xp6(1),g.Q6J("latitude",me.item.AddressInfo.Latitude)("longitude",me.item.AddressInfo.Longitude),g.xp6(6),g.Q6J("ngModel",me.item.AddressInfo.Title),g.xp6(4),g.Q6J("ngModel",me.item.AddressInfo.AddressLine1),g.xp6(4),g.Q6J("ngModel",me.item.AddressInfo.AddressLine2),g.xp6(4),g.Q6J("ngModel",me.item.AddressInfo.Town),g.xp6(4),g.Q6J("ngModel",me.item.AddressInfo.StateOrProvince),g.xp6(4),g.Q6J("ngModel",me.item.AddressInfo.Postcode),g.xp6(4),g.Q6J("ngModel",me.item.AddressInfo.CountryID),g.xp6(1),g.Q6J("ngForOf",me.countries),g.xp6(4),g.Q6J("ngModel",me.item.AddressInfo.Latitude),g.xp6(4),g.Q6J("ngModel",me.item.AddressInfo.Longitude)}}function Kt(Le,Rt){if(1&Le){const me=g.EpF();g.ynx(0),g.TgZ(1,"h3"),g._uU(2,"Locations Nearby"),g.qZA(),g.TgZ(3,"p"),g.TgZ(4,"strong"),g._uU(5,"The following locations already exist nearby."),g.qZA(),g.qZA(),g.TgZ(6,"div",28),g.TgZ(7,"p"),g._uU(8,"Ensure you are not adding a duplicate site unless it is for different equipment from another network operator."),g.qZA(),g.TgZ(9,"p"),g._uU(10,"You can edit any of these listings if required instead:"),g.qZA(),g.qZA(),g.TgZ(11,"app-poi-list",29),g.NdJ("onEdit",function(Ft){return g.CHM(me),g.oxw(2).editPOI(Ft)}),g.qZA(),g.BQk()}if(2&Le){const me=g.oxw(2);g.xp6(11),g.Q6J("poiList",me.nearbySites)("enableEditOption",!0)}}function mt(Le,Rt){if(1&Le&&(g.ynx(0),g.YNc(1,an,41,12,"ng-container",9),g.YNc(2,Kt,12,2,"ng-container",9),g.BQk()),2&Le){const me=g.oxw();g.xp6(1),g.Q6J("ngIf","location"==me.step),g.xp6(1),g.Q6J("ngIf","poi-nearby"==me.step)}}function Wt(Le,Rt){if(1&Le){const me=g.EpF();g.ynx(0),g.TgZ(1,"p"),g._uU(2,"Copied the equipment configuration from:"),g.qZA(),g.TgZ(3,"ion-item"),g.TgZ(4,"ion-label"),g._uU(5),g._UZ(6,"br"),g._uU(7),g._UZ(8,"br"),g._uU(9),g._UZ(10,"br"),g._uU(11),g._UZ(12,"br"),g._uU(13),g.qZA(),g.TgZ(14,"ion-button",31),g.NdJ("click",function(){return g.CHM(me),g.oxw(5).changeTemplatePOI()}),g._uU(15,"Change.."),g.qZA(),g.qZA(),g.BQk()}if(2&Le){const me=g.oxw(5);g.xp6(5),g.hij(" ",me.selectedTemplatePOI.AddressInfo.Title," "),g.xp6(2),g.hij(" ",me.selectedTemplatePOI.AddressInfo.AddressLine1," "),g.xp6(2),g.hij(" ",null==me.selectedTemplatePOI.Connections[0].ConnectionType?null:me.selectedTemplatePOI.Connections[0].ConnectionType.Title," "),g.xp6(2),g.hij(" ",me.selectedTemplatePOI.Connections[0].PowerKW," "),g.xp6(2),g.hij(" ",me.selectedTemplatePOI.DateCreated," ")}}function On(Le,Rt){if(1&Le){const me=g.EpF();g.ynx(0),g.TgZ(1,"h4"),g._uU(2,"Similar Sites"),g.qZA(),g.TgZ(3,"app-poi-list",32),g.NdJ("onCopy",function(Ft){return g.CHM(me),g.oxw(6).useTemplatePOI(Ft)}),g.qZA(),g.BQk()}if(2&Le){const me=g.oxw(6);g.xp6(3),g.Q6J("enableCopyOption",!0)("poiList",me.templateSites)}}function bn(Le,Rt){1&Le&&(g.ynx(0),g.TgZ(1,"p"),g._uU(2," There are no suggested sites to copy for this network operator. "),g.qZA(),g.BQk())}function jn(Le,Rt){if(1&Le&&(g.ynx(0),g.YNc(1,On,4,2,"ng-container",9),g.YNc(2,bn,3,0,"ng-container",9),g.BQk()),2&Le){const me=g.oxw(5);g.xp6(1),g.Q6J("ngIf",me.templateSites.length>0),g.xp6(1),g.Q6J("ngIf",0==me.templateSites.length)}}function li(Le,Rt){if(1&Le&&(g.ynx(0),g.YNc(1,Wt,16,5,"ng-container",9),g.YNc(2,jn,3,2,"ng-container",9),g.BQk()),2&Le){const me=g.oxw(4);g.xp6(1),g.Q6J("ngIf",me.selectedTemplatePOI),g.xp6(1),g.Q6J("ngIf",!me.selectedTemplatePOI)}}function $i(Le,Rt){if(1&Le){const me=g.EpF();g.ynx(0),g.TgZ(1,"p",28),g._uU(2,"You can copy the equipment settings from other sites operated by the same network operator or choose 'Next' to skip this step: "),g.qZA(),g.TgZ(3,"app-operator-lookup",30),g.NdJ("operatorChanged",function(Ft){return g.CHM(me),g.oxw(3).onOperatorChange(Ft)}),g.qZA(),g.YNc(4,li,3,2,"ng-container",9),g.BQk()}if(2&Le){const me=g.oxw(3);g.xp6(3),g.Q6J("operatorId",me.item.OperatorID),g.xp6(1),g.Q6J("ngIf",me.item.AddressInfo.CountryID&&me.item.OperatorID)}}function rr(Le,Rt){if(1&Le&&(g.ynx(0),g.YNc(1,$i,5,2,"ng-container",9),g.BQk()),2&Le){const me=g.oxw(2);g.xp6(1),g.Q6J("ngIf",!me.skipPOICopy)}}function Bi(Le,Rt){if(1&Le){const me=g.EpF();g.ynx(0),g.TgZ(1,"app-operator-lookup",33),g.NdJ("operatorChanged",function(Ft){return g.CHM(me),g.oxw(2).onOperatorChange(Ft)}),g.qZA(),g.TgZ(2,"ion-item"),g.TgZ(3,"ion-label",16),g._uU(4,"Number of Stations or Parking Bays"),g.qZA(),g.TgZ(5,"ion-input",21),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw(2).item.NumberOfPoints=Ft}),g.qZA(),g.qZA(),g.TgZ(6,"h4"),g._uU(7,"Equipment"),g.qZA(),g.TgZ(8,"ion-button",34),g.NdJ("click",function(){return g.CHM(me),g.oxw(2).addConnection()}),g._UZ(9,"ion-icon",35),g.qZA(),g.TgZ(10,"app-equipment-details",36),g.NdJ("onEdit",function(Ft){return g.CHM(me),g.oxw(2).editConnection(Ft)})("onDelete",function(Ft){return g.CHM(me),g.oxw(2).deleteConnection(Ft)}),g.qZA(),g.BQk()}if(2&Le){const me=g.oxw(2);g.xp6(1),g.Q6J("operatorId",me.item.OperatorID)("useFilteredOperators",!1),g.xp6(4),g.Q6J("ngModel",me.item.NumberOfPoints),g.xp6(5),g.Q6J("item",me.item)("enableEdit",!0)}}function _i(Le,Rt){if(1&Le&&(g.ynx(0),g.YNc(1,rr,2,1,"ng-container",9),g.YNc(2,Bi,11,5,"ng-container",9),g.BQk()),2&Le){const me=g.oxw();g.xp6(1),g.Q6J("ngIf","copy-equipment"==me.step),g.xp6(1),g.Q6J("ngIf","edit-equipment"==me.step)}}function tr(Le,Rt){if(1&Le&&(g.TgZ(0,"p",43),g.TgZ(1,"strong"),g._uU(2,"Your changes cannot be saved until the following issues are resolved:"),g.qZA(),g.TgZ(3,"ion-label",44),g._uU(4),g.qZA(),g.qZA()),2&Le){const me=g.oxw(2);g.xp6(4),g.hij(" ",me.validationMsg,"")}}function gi(Le,Rt){if(1&Le&&(g.TgZ(0,"ion-select-option",27),g._uU(1),g.qZA()),2&Le){const me=Rt.$implicit;g.Q6J("value",me.ID),g.xp6(1),g.Oqu(me.Title)}}function Ti(Le,Rt){if(1&Le&&(g.TgZ(0,"ion-select-option",27),g._uU(1),g.qZA()),2&Le){const me=Rt.$implicit;g.Q6J("value",me.ID),g.xp6(1),g.Oqu(me.Title)}}function Xt(Le,Rt){if(1&Le){const me=g.EpF();g.ynx(0),g.YNc(1,tr,5,1,"p",37),g.TgZ(2,"p"),g._uU(3,"Please provide any other facts related to this site. Additional comments (your charging experiences etc) can be added as check-in comments once the site is listed."),g.qZA(),g.TgZ(4,"ion-item"),g.TgZ(5,"ion-label",16),g._uU(6,"Operational Status (All Equipment))"),g.qZA(),g.TgZ(7,"ion-select",38),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw().item.StatusTypeID=Ft}),g.YNc(8,gi,2,2,"ion-select-option",24),g.qZA(),g.qZA(),g.TgZ(9,"ion-item"),g.TgZ(10,"ion-label",16),g._uU(11,"Usage Type"),g.qZA(),g.TgZ(12,"ion-select",38),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw().item.UsageTypeID=Ft}),g.YNc(13,Ti,2,2,"ion-select-option",24),g.qZA(),g.qZA(),g.TgZ(14,"ion-item"),g.TgZ(15,"ion-label",16),g._uU(16,"Usage Cost"),g.qZA(),g.TgZ(17,"ion-input",21),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw().item.UsageCost=Ft}),g.qZA(),g.qZA(),g.TgZ(18,"ion-item"),g.TgZ(19,"ion-label",16),g._uU(20,"General Comments"),g.qZA(),g.TgZ(21,"ion-input",39),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw().item.GeneralComments=Ft}),g.qZA(),g.qZA(),g.TgZ(22,"ion-item"),g.TgZ(23,"ion-label",16),g._uU(24,"Main Telephone Number "),g.qZA(),g.TgZ(25,"ion-input",40),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw().item.AddressInfo.ContactTelephone1=Ft}),g.qZA(),g.qZA(),g.TgZ(26,"ion-item"),g.TgZ(27,"ion-label",16),g._uU(28,"Other Telephone Number "),g.qZA(),g.TgZ(29,"ion-input",40),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw().item.AddressInfo.ContactTelephone2=Ft}),g.qZA(),g.qZA(),g.TgZ(30,"ion-item"),g.TgZ(31,"ion-label",16),g._uU(32,"Access Comments"),g.qZA(),g.TgZ(33,"ion-input",41),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw().item.AddressInfo.AccessComments=Ft}),g.qZA(),g.qZA(),g.TgZ(34,"ion-item"),g.TgZ(35,"ion-label",16),g._uU(36,"Related Website"),g.qZA(),g.TgZ(37,"ion-input",42),g.NdJ("ngModelChange",function(Ft){return g.CHM(me),g.oxw().item.AddressInfo.RelatedURL=Ft}),g.qZA(),g.qZA(),g.BQk()}if(2&Le){const me=g.oxw();g.xp6(1),g.Q6J("ngIf",me.validationMsg),g.xp6(6),g.Q6J("ngModel",me.item.StatusTypeID),g.xp6(1),g.Q6J("ngForOf",me.statusTypes),g.xp6(4),g.Q6J("ngModel",me.item.UsageTypeID),g.xp6(1),g.Q6J("ngForOf",me.usageTypes),g.xp6(4),g.Q6J("ngModel",me.item.UsageCost),g.xp6(4),g.Q6J("ngModel",me.item.GeneralComments),g.xp6(4),g.Q6J("ngModel",me.item.AddressInfo.ContactTelephone1),g.xp6(4),g.Q6J("ngModel",me.item.AddressInfo.ContactTelephone2),g.xp6(4),g.Q6J("ngModel",me.item.AddressInfo.AccessComments),g.xp6(4),g.Q6J("ngModel",me.item.AddressInfo.RelatedURL)}}function Oe(Le,Rt){if(1&Le){const me=g.EpF();g.TgZ(0,"ion-button",1),g.NdJ("click",function(){return g.CHM(me),g.oxw().previous()}),g._uU(1," Previous "),g._UZ(2,"ion-icon",45),g.qZA()}}function ae(Le,Rt){if(1&Le){const me=g.EpF();g.TgZ(0,"ion-button",1),g.NdJ("click",function(){return g.CHM(me),g.oxw().next()}),g._uU(1," Next "),g._UZ(2,"ion-icon",46),g.qZA()}}function Re(Le,Rt){if(1&Le){const me=g.EpF();g.TgZ(0,"ion-button",47),g.NdJ("click",function(){return g.CHM(me),g.oxw().save()}),g._uU(1," Submit "),g._UZ(2,"ion-icon",48),g.qZA()}}let lt=(()=>{class Le{constructor(me,He,Ft,Qt,Jn,Ki){this.appManager=me,this.modalController=He,this.poiManager=Ft,this.mapping=Qt,this.loadingController=Jn,this.alertController=Ki,this.useFilteredConnectionTypes=!0,this.templateSites=[],this.nearbySites=[],this.selectedTemplatePOI=null,this.suggestedAddress=null,this.suggestedAddressAttribution=null,this.isNonDuplicateConfirmed=!1,this.skipPOICopy=!1,this.validationMsg=null,this.initNewItem()}get countries(){return this.appManager.referenceDataManager.getCountries()}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes()}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes().filter(me=>1==me.IsUserSelectable)}get isAddMode(){return this.item.ID<=0}initNewItem(){this.item={ID:-1,DataProviderID:1,DataProvidersReference:null,OperatorsReference:null,OperatorID:1,UsageCost:null,UsageTypeID:4,NumberOfPoints:1,GeneralComments:null,DatePlanned:null,StatusTypeID:50,SubmissionStatusTypeID:null,Connections:[],MetadataValues:[],AddressInfo:{ID:-1,CountryID:18,Title:"",AddressLine1:"",Latitude:0,Longitude:0}},this.step="location",this.selectedTab="location"}get isReadyToSubmit(){return this.validate().isValid&&"info"==this.step}ngOnInit(){}presentLoadingUI(){var me=this;return(0,b.Z)(function*(){me.loading=yield me.loadingController.create({message:"Please Wait.."}),yield me.loading.present()})()}dismissLoadingUI(){var me=this;return(0,b.Z)(function*(){me.loading&&(yield me.loading.dismiss())})()}ionViewDidEnter(){if(null!=this.id)this.editExistingPOI(this.id);else{let me=localStorage.getItem("_editor-operatorid");me&&(this.item.OperatorID=parseInt(me,10)),this.startPos?(this.item.AddressInfo.Latitude=this.startPos.latitude,this.item.AddressInfo.Longitude=this.startPos.longitude):this.mapping&&this.mapping.getMapCenter().subscribe(He=>{He&&(this.item.AddressInfo.Latitude=He.coords.latitude,this.item.AddressInfo.Longitude=He.coords.longitude)})}this.refreshFilteredReferenceData()}previous(){var me=this;return(0,b.Z)(function*(){switch(me.step){case"info":me.step="edit-equipment";break;case"edit-equipment":me.step=me.isAddMode?"copy-equipment":"location";break;case"copy-equipment":case"poi-nearby":me.step="location"}yield me.initCurrentStep(!1)})()}next(){var me=this;return(0,b.Z)(function*(){if("poi-nearby"==me.step&&me.nearbySites.length>0&&!me.isNonDuplicateConfirmed)return void(yield me.alertController.create({header:"Confirm",message:"Please confirm you are not adding a duplicate site.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:Qt=>{}},{text:"Confirm",handler:()=>{me.isNonDuplicateConfirmed=!0,me.next()}}]})).present();const He=me.validate(me.step);if(He.isValid){switch(me.step){case"location":me.step=me.isAddMode?"poi-nearby":"edit-equipment";break;case"poi-nearby":me.step=me.isAddMode?"copy-equipment":"edit-equipment";break;case"copy-equipment":me.step="edit-equipment";break;case"edit-equipment":me.step="info"}yield me.initCurrentStep(!0)}else(yield me.alertController.create({message:He.msg})).present()})()}initCurrentStep(me){var He=this;return(0,b.Z)(function*(){"poi-nearby"==He.step?(He.selectedTab="location",0==(yield He.refreshNearbySites())&&(me?yield He.next():yield He.previous())):"location"==He.step?He.selectedTab="location":"copy-equipment"==He.step?(He.selectedTab="equipment",yield He.refreshTemplateSites()):"edit-equipment"==He.step?He.selectedTab="equipment":"info"==He.step&&(He.selectedTab="info")})()}onCountryChange(){var me=this;return(0,b.Z)(function*(){me.refreshFilteredReferenceData()})()}onOperatorChange(me=null){var He=this;return(0,b.Z)(function*(){null!=me&&He.item.OperatorID!=me.ID&&(He.item.OperatorID=me.ID,localStorage.setItem("_editor-operatorid",He.item.OperatorID.toString()),yield He.refreshTemplateSites())})()}useSuggestedAddress(me=null){me&&(this.suggestedAddress=me.suggestedAddress,this.suggestedAddressAttribution=me.suggestedAddressAttribution),Object.assign(this.item.AddressInfo,this.suggestedAddress),this.suggestedAddressAttribution&&(this.item.MetadataValues.find(He=>4==He.MetadataFieldID)||this.item.MetadataValues.push({ID:-1,MetadataFieldID:4,ItemValue:this.suggestedAddressAttribution,MetadataFieldOptionID:null,MetadataFieldOption:null}))}editConnection(me){var He=this;return(0,b.Z)(function*(){const Ft=He.item.Connections.find(Ki=>Ki.ID==me.ID),Qt=Object.assign({},Ft),Jn=yield He.modalController.create({component:Be,componentProps:{conn:Qt}});return Jn.onWillDismiss().then(Ki=>{Ki&&Ki.data&&Ki.data.item&&He.updateConnection(Ki.data.item)}),yield Jn.present()})()}deleteConnection(me){var He=this;return(0,b.Z)(function*(){const Ft=He.item.Connections.find(Jn=>Jn.ID==me.ID);(yield He.alertController.create({header:"Confirm Delete",message:"Are you sure you want to delete this connection information?",buttons:[{text:"No",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Yes",handler:()=>{He.item.Connections=He.item.Connections.filter(Jn=>Jn.ID!=Ft.ID),He.appManager.referenceDataManager.hydrateCompactPOI(He.item,!0)}}]})).present()})()}addConnection(){var me=this;return(0,b.Z)(function*(){const He={ID:-l.c.getRandomInt(1e4),ConnectionTypeID:null,StatusTypeID:50,PowerKW:null,Quantity:1},Ft=yield me.modalController.create({component:Be,componentProps:{conn:He}});return Ft.onWillDismiss().then(Qt=>{Qt&&Qt.data&&Qt.data.item&&me.updateConnection(Qt.data.item)}),yield Ft.present()})()}refreshFilteredReferenceData(){this.appManager.referenceDataManager.refreshFilteredReferenceData(this.appManager.api,{CountryIds:[this.item.AddressInfo.CountryID]})}updateConnection(me){if(me){let He=this.item.Connections.find(Ft=>Ft.ID==me.ID);He?Object.assign(He,me):this.item.Connections.push(me)}this.appManager.referenceDataManager.hydrateCompactPOI(this.item,!0)}validate(me="all"){let He=null;return("all"==me||"location"==me)&&((!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(He="Location is required"),""==this.item.AddressInfo.Title&&(He="A location title is required"),this.item.AddressInfo.CountryID||(He="A country selection is required"),(!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(He="A location latitude and longitude is required")),("all"==me||"poi-nearby"==me)&&this.nearbySites.length>0&&!this.isNonDuplicateConfirmed&&(He="Please confirm that the site is not a duplicate"),("all"==me||"equipment"==me)&&(this.item.OperatorID||(He="Please confirm the charging network or equipment operator."),0==this.item.Connections.length&&(He="Equipment information is required")),He?(this.validationMsg=He,{isValid:!1,msg:He}):(this.validationMsg=null,{isValid:!0,msg:null})}save(){var me=this;return(0,b.Z)(function*(){let He=me.validate();if(He.isValid){yield me.presentLoadingUI();try{yield me.appManager.submitPOI(me.item),yield me.dismissLoadingUI(),me.appManager.showToastNotification("You submission will be reviewed (if required) and published shortly."),me.modalController.dismiss()}catch(Ft){yield me.dismissLoadingUI(),Ft.error&&alert("Sorry, your submission could not be completed at this time. Please try again later.")}}else alert(He.msg)})()}cancel(){var me=this;return(0,b.Z)(function*(){me.modalController.dismiss()})()}refreshTemplateSites(){var me=this;return(0,b.Z)(function*(){if(me.item.AddressInfo.CountryID&&me.item.OperatorID){yield me.presentLoadingUI(),me.templateSites=[];let He=new pe.b;He.countryIdList=[me.item.AddressInfo.CountryID],He.minPowerKW=1,He.operatorIdList=[me.item.OperatorID],He.maxResults=10;let Ft=yield me.poiManager.fetchPOIList(He);Ft.sort((Qt,Jn)=>new Date(Qt.DateCreated).getTime()-new Date(Jn.DateCreated).getTime()),me.templateSites=Ft,me.dismissLoadingUI()}})()}refreshNearbySites(){var me=this;return(0,b.Z)(function*(){if(me.item.AddressInfo.Latitude&&me.item.AddressInfo.Longitude){yield me.presentLoadingUI(),me.nearbySites=[];let He=new pe.b;He.latitude=me.item.AddressInfo.Latitude,He.longitude=me.item.AddressInfo.Longitude,He.distance=5,He.distanceUnit="km",He.maxResults=10;let Ft=yield me.poiManager.fetchPOIList(He);return Ft.sort((Qt,Jn)=>Qt.Distance-Jn.Distance),me.nearbySites=Ft,me.dismissLoadingUI(),Ft.length}return 0})()}confirmNonDuplicate(){this.isNonDuplicateConfirmed=!0,this.next()}changeTemplatePOI(){this.selectedTemplatePOI=null}editPOI(me){this.editExistingPOI(me.ID)}editExistingPOI(me){var He=this;return(0,b.Z)(function*(){He.skipPOICopy=!0,He.isNonDuplicateConfirmed=!0,yield He.presentLoadingUI(),He.poiManager.getPOIById(me,!0,!0).then(Ft=>{He.item=Object.assign({},Ft),null==He.item.OperatorID&&(He.item.OperatorID=Ge.UnknownOperator),He.refreshFilteredReferenceData(),He.dismissLoadingUI()})})()}useTemplatePOI(me){this.selectedTemplatePOI=me,Object.assign(this.item.Connections,me.Connections);for(let He of this.item.Connections)He.ID=-l.c.getRandomInt(1e4),He.Reference=null,He.Comments=null,He.StatusTypeID=C.Operational;this.item.UsageCost=me.UsageCost,this.item.UsageTypeID=me.UsageTypeID,this.appManager.referenceDataManager.hydrateCompactPOI(this.item)}skipCopyingPOI(){this.skipPOICopy=!0}}return Le.\u0275fac=function(me){return new(me||Le)(g.Y36(d.c),g.Y36(xe.IN),g.Y36(J.R),g.Y36(j.v),g.Y36(xe.HT),g.Y36(xe.Br))},Le.\u0275cmp=g.Xpm({type:Le,selectors:[["app-poi-editor"]],viewQuery:function(me,He){if(1&me&&g.Gf(We,5),2&me){let Ft;g.iGM(Ft=g.CRH())&&(He.editorMap=Ft.first)}},decls:33,vars:14,consts:[["slot","end"],[3,"click"],["name","close","slot","start"],[1,"ion-padding"],[3,"ngModel"],["value","location","layout","icon-start",3,"disabled"],["name","caret-forward",4,"ngIf"],["value","equipment","layout","icon-start",3,"disabled"],["value","info","layout","icon-start",3,"disabled"],[4,"ngIf"],["slot","start"],[3,"click",4,"ngIf"],["color","success",3,"click",4,"ngIf"],["name","caret-forward"],[3,"latitude","longitude","latitudeChange","longitudeChange","onUseSuggestedAddress"],["editorMap",""],["position","floating"],["type","text","autocapitalize","words","placeholder","A title for this location",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","The nearest street address",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Optional",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Town or City",3,"ngModel","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Optional Postal Code",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["type","number","placeholder","Latitude (if entering manually)",3,"ngModel","ngModelChange"],["type","number","placeholder","Longitude (if entering manually)",3,"ngModel","ngModelChange"],[3,"value"],[1,"instruction"],[3,"poiList","enableEditOption","onEdit"],[3,"operatorId","operatorChanged"],["slot","start","size","small",3,"click"],[3,"enableCopyOption","poiList","onCopy"],[3,"operatorId","useFilteredOperators","operatorChanged"],["size","small",3,"click"],["name","add","slot","icon-only"],[3,"item","enableEdit","onEdit","onDelete"],["color","warning",4,"ngIf"],[3,"ngModel","ngModelChange"],["type","text","autocapitalize","sentences",3,"ngModel","ngModelChange"],["type","tel","placeholder","",3,"ngModel","ngModelChange"],["type","text","autocapitalize","sentences","placeholder","Instructions for access or tips for finding charging location",3,"ngModel","ngModelChange"],["type","url","placeholder","Website related to this site",3,"ngModel","ngModelChange"],["color","warning"],["color","danger"],["name","caret-back","slot","start"],["name","caret-forward","slot","end"],["color","success",3,"click"],["name","send","slot","end"]],template:function(me,He){1&me&&(g.TgZ(0,"ion-header"),g.TgZ(1,"ion-toolbar"),g.TgZ(2,"ion-title"),g._uU(3),g.qZA(),g.TgZ(4,"ion-buttons",0),g.TgZ(5,"ion-button",1),g.NdJ("click",function(){return He.cancel()}),g._UZ(6,"ion-icon",2),g._uU(7," Cancel "),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.TgZ(8,"ion-content",3),g.ynx(9),g.TgZ(10,"ion-segment",4),g.TgZ(11,"ion-segment-button",5),g.YNc(12,zt,1,0,"ion-icon",6),g.TgZ(13,"ion-label"),g._uU(14,"Location"),g.qZA(),g.qZA(),g.TgZ(15,"ion-segment-button",7),g.YNc(16,Zt,1,0,"ion-icon",6),g.TgZ(17,"ion-label"),g._uU(18,"Equipment"),g.qZA(),g.qZA(),g.TgZ(19,"ion-segment-button",8),g.YNc(20,ln,1,0,"ion-icon",6),g.TgZ(21,"ion-label"),g._uU(22,"Info"),g.qZA(),g.qZA(),g.qZA(),g.YNc(23,mt,3,2,"ng-container",9),g.YNc(24,_i,3,2,"ng-container",9),g.YNc(25,Xt,38,11,"ng-container",9),g.BQk(),g.qZA(),g.TgZ(26,"ion-footer"),g.TgZ(27,"ion-toolbar"),g.TgZ(28,"ion-buttons",10),g.YNc(29,Oe,3,0,"ion-button",11),g.qZA(),g.TgZ(30,"ion-buttons",0),g.YNc(31,ae,3,0,"ion-button",11),g.YNc(32,Re,3,0,"ion-button",12),g.qZA(),g.qZA(),g.qZA()),2&me&&(g.xp6(3),g.Oqu(He.isAddMode?"Add Location":"Edit Location"),g.xp6(7),g.Q6J("ngModel",He.selectedTab),g.xp6(1),g.Q6J("disabled",!0),g.xp6(1),g.Q6J("ngIf","location"==He.selectedTab),g.xp6(3),g.Q6J("disabled",!0),g.xp6(1),g.Q6J("ngIf","equipment"==He.selectedTab),g.xp6(3),g.Q6J("disabled",!0),g.xp6(1),g.Q6J("ngIf","info"==He.selectedTab),g.xp6(3),g.Q6J("ngIf","location"==He.selectedTab),g.xp6(1),g.Q6J("ngIf","equipment"==He.selectedTab),g.xp6(1),g.Q6J("ngIf","info"==He.selectedTab),g.xp6(4),g.Q6J("ngIf","location"!=He.step),g.xp6(2),g.Q6J("ngIf",!He.isReadyToSubmit&&"info"!=He.step),g.xp6(1),g.Q6J("ngIf",He.isReadyToSubmit))},directives:[xe.Gu,xe.sr,xe.wd,xe.Sm,xe.YG,xe.gu,xe.W2,xe.cJ,xe.QI,Se.JJ,Se.On,xe.GO,ye.O5,xe.Q$,We,xe.q_,xe.Ie,xe.pK,xe.j9,xe.t9,ye.sg,xe.n0,xe.as,wt.o,Ut,Yt.B,xe.fr],styles:['ul.breadcrumb[_ngcontent-%COMP%]{display:inline-flex;margin:0;padding:0}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-flex;margin-right:6px;color:var(--ion-color-light-shade);font-size:10px}ul.breadcrumb[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{color:var(--ion-color-dark-shade)}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:">";padding-right:4px}']}),Le})()},6763:(An,vt,k)=>{"use strict";k.d(vt,{u:()=>C});var b=k(6738),d=k(7429),pe=k(4120),l=k(3912),J=k(7689),j=k(129),g=k(529);let ne=(()=>{class Ge{constructor(ht,wt){this.http=ht,this.journeyManager=wt}getDirections(ht,wt){return new Promise((xt,gt)=>{(new google.maps.DirectionsService).route({origin:ht,destination:wt,travelMode:google.maps.TravelMode.DRIVING},(Ht,Gn)=>{Gn===google.maps.DirectionsStatus.OK?xt(Ht):gt(Gn)})})}analyseRoutes(ht,wt){const xt=new Array;return ht.routes.forEach(gt=>{const Bt=new j.JJ;Bt.Title=""+xt.length+1,Bt.JourneyRouteLegs=new Array,Bt.TotalDistanceKM=0,Bt.TotalDurationMinutes=0,Bt.TotalEnergykWh=0,gt.legs.forEach(Ht=>{const Gn=Ht.duration.value,It=Ht.distance.value/1e3,jt=this.journeyManager.calculateEnergyConsumptionkWh(It,0,null,wt),Ut=new j.eN;Ut.DistanceKM=It,Ut.DurationMinutes=Gn/60,Ut.EnergyConsumptionkWh=jt,Bt.JourneyRouteLegs.push(Ut),Bt.TotalDistanceKM+=Ut.DistanceKM,Bt.TotalDurationMinutes+=Ut.DurationMinutes,Bt.TotalEnergykWh=Ut.EnergyConsumptionkWh}),xt.push(Bt)}),xt}}return Ge.\u0275fac=function(ht){return new(ht||Ge)(b.LFG(g.eN),b.LFG(l.i))},Ge.\u0275prov=b.Yz7({token:Ge,factory:Ge.\u0275fac,providedIn:"root"}),Ge})();var ge=k(4781),Q=k(6895),Y=k(4006),se=k(2428);function ue(Ge,_t){if(1&Ge){const ht=b.EpF();b.TgZ(0,"ion-item"),b._UZ(1,"ion-icon",12),b.TgZ(2,"ion-searchbar",13),b.NdJ("ngModelChange",function(xt){return b.CHM(ht),b.oxw().routeStart=xt})("ionInput",function(xt){return b.CHM(ht),b.oxw(),b.MAs(18).getPlacesAutoComplete(xt,"routeStart")})("ionCancel",function(xt){return b.CHM(ht),b.oxw().onPlaceSearchCancel(xt)}),b.qZA(),b.qZA()}if(2&Ge){const ht=b.oxw();b.xp6(2),b.Q6J("ngModel",ht.routeStart)("debounce",500)}}function ye(Ge,_t){if(1&Ge){const ht=b.EpF();b.TgZ(0,"ion-item",14),b.NdJ("click",function(){return b.CHM(ht),b.oxw().clearRouteStart()}),b._UZ(1,"ion-icon",12),b.TgZ(2,"h2"),b._uU(3),b.qZA(),b.qZA()}if(2&Ge){b.oxw();const ht=b.MAs(18);b.xp6(3),b.Oqu(null==ht.selectedPlace?null:ht.selectedPlace.name)}}function xe(Ge,_t){if(1&Ge){const ht=b.EpF();b.TgZ(0,"ion-item"),b._UZ(1,"ion-icon",15),b.TgZ(2,"ion-searchbar",16),b.NdJ("ngModelChange",function(xt){return b.CHM(ht),b.oxw().routeDestination=xt})("ionInput",function(xt){return b.CHM(ht),b.oxw(),b.MAs(20).getPlacesAutoComplete(xt,"routeDestination")})("ionCancel",function(xt){return b.CHM(ht),b.oxw().onPlaceSearchCancel(xt)}),b.qZA(),b.qZA()}if(2&Ge){const ht=b.oxw();b.xp6(2),b.Q6J("ngModel",ht.routeDestination)("debounce",500)}}function Ee(Ge,_t){if(1&Ge){const ht=b.EpF();b.TgZ(0,"ion-item",14),b.NdJ("click",function(){return b.CHM(ht),b.oxw().clearRouteDestination()}),b._UZ(1,"ion-icon",15),b.TgZ(2,"h2"),b._uU(3),b.qZA(),b.qZA()}if(2&Ge){b.oxw();const ht=b.MAs(20);b.xp6(3),b.Oqu(null==ht.selectedPlace?null:ht.selectedPlace.name)}}function We(Ge,_t){if(1&Ge){const ht=b.EpF();b.TgZ(0,"ion-button",14),b.NdJ("click",function(){return b.CHM(ht),b.oxw().clearRoute()}),b._UZ(1,"ion-icon",17),b._uU(2," Clear Route "),b.qZA()}}function be(Ge,_t){if(1&Ge){const ht=b.EpF();b.TgZ(0,"ion-button",14),b.NdJ("click",function(){return b.CHM(ht),b.oxw().showSettings()}),b._uU(1," Show Settings "),b._UZ(2,"ion-icon",18),b.qZA()}}function Se(Ge,_t){if(1&Ge){const ht=b.EpF();b.TgZ(0,"ion-button",14),b.NdJ("click",function(){return b.CHM(ht),b.oxw().hideSettings()}),b._uU(1," Hide Settings "),b._UZ(2,"ion-icon",18),b.qZA()}}function ze(Ge,_t){1&Ge&&(b.TgZ(0,"p",19),b._UZ(1,"ion-spinner",19),b._uU(2," Calculating Route.. "),b.qZA())}function tt(Ge,_t){if(1&Ge&&(b.TgZ(0,"ion-list"),b.TgZ(1,"ion-list-header"),b._uU(2),b.ALo(3,"number"),b.ALo(4,"number"),b.qZA(),b.qZA()),2&Ge){const ht=b.oxw();b.xp6(2),b.lnq(" Total Distance ",b.xi3(3,3,ht.selectedJourneyRoute.TotalDistanceKM,"1.0-2")," km, ",ht.formatDuration(ht.selectedJourneyRoute.TotalDurationMinutes),", ",b.xi3(4,6,ht.selectedJourneyRoute.TotalEnergykWh,"1.0-2")," kWh ")}}function et(Ge,_t){if(1&Ge){const ht=b.EpF();b.TgZ(0,"div"),b.TgZ(1,"ion-list"),b.TgZ(2,"ion-list-header"),b._UZ(3,"ion-icon",20),b._uU(4," Route Settings "),b.qZA(),b.TgZ(5,"ion-item"),b.TgZ(6,"ion-label",21),b._uU(7),b.qZA(),b.TgZ(8,"ion-range",22),b.NdJ("ngModelChange",function(xt){return b.CHM(ht),b.oxw().routeSearchDistance=xt}),b._UZ(9,"ion-icon",23),b._UZ(10,"ion-icon",24),b.qZA(),b.qZA(),b.TgZ(11,"ion-item"),b.TgZ(12,"ion-label",21),b._uU(13,"Energy Efficiency (kWh Per km)"),b.qZA(),b.TgZ(14,"ion-input",25),b.NdJ("ngModelChange",function(xt){return b.CHM(ht),b.oxw().kWhPerKM=xt}),b.qZA(),b.qZA(),b.qZA(),b.qZA()}if(2&Ge){const ht=b.oxw();b.xp6(7),b.hij("Search Distance (",ht.routeSearchDistance,")"),b.xp6(1),b.Q6J("ngModel",ht.routeSearchDistance),b.xp6(6),b.Q6J("ngModel",ht.kWhPerKM)}}let Be=(()=>{class Ge{constructor(ht,wt,xt,gt,Bt,Ht){this.mapping=ht,this.logging=wt,this.directions=xt,this.journeyManager=gt,this.changeDetector=Bt,this.numberPipe=Ht,this.routeSearchDistance=5,this.routeCalcInProgress=!1,this.advancedSettingsMode=!1,this.routeStart="",this.routeDestination="",this.kWhPerKM=.212}get isRouteSet(){return null!=this.routeStartPlace&&null!=this.routeDestinationPlace}showSettings(){this.advancedSettingsMode=!0}hideSettings(){this.advancedSettingsMode=!1}routeStartSelected(ht){this.routeStartPlace=ht,this.calculateRoute(),this.changeDetector.detectChanges()}routeDestinationSelected(ht){this.routeDestinationPlace=ht,this.calculateRoute(),this.changeDetector.detectChanges()}clearRouteStart(){this.routeStartPlace=null,this.changeDetector.detectChanges()}clearRouteDestination(){this.routeDestinationPlace=null,this.changeDetector.detectChanges()}clearRoute(){this.routeStartPlace=null,this.routeDestinationPlace=null,this.journeyManager.setRoutePolyline(null),this.mapping.clearPolyline()}formatDuration(ht){if(ht<=60)return this.numberPipe.transform(ht,"1.0-2")+" mins";{const wt=Math.round(ht/60),xt=Math.floor(ht-60*wt);return wt+" hours "+(xt>0?xt+" mins":"")}}calculateRoute(){null!=this.routeStartPlace&&null!=this.routeDestinationPlace&&(this.logging.log("Fetching route directions.."),this.routeCalcInProgress=!0,this.directions.getDirections(this.routeStartPlace.Location.latitude+","+this.routeStartPlace.Location.longitude,this.routeDestinationPlace.Location.latitude+","+this.routeDestinationPlace.Location.longitude).then(ht=>{if(null!=ht.routes&&ht.routes.length>0){this.logging.log("Got route directions, analysing.."),this.routePolyline=ht.routes[0].overview_polyline;const wt=ht.routes[0].bounds.getSouthWest(),xt=ht.routes[0].bounds.getNorthEast(),gt=new pe.wC(xt.lat(),xt.lng()),Bt=new pe.wC(wt.lat(),wt.lng()),Ht=new pe.LL(gt,Bt);this.journeyRoutes=this.directions.analyseRoutes(ht,this.kWhPerKM),this.journeyRoutes.length>0&&(this.selectedJourneyRoute=this.journeyRoutes[0]),this.journeyManager.setRoutePolyline(this.routePolyline),this.mapping.renderPolyline(this.routePolyline),this.mapping.moveToMapBounds(Ht)}else this.logging.log("No route returned..");this.routeCalcInProgress=!1}))}}return Ge.\u0275fac=function(ht){return new(ht||Ge)(b.Y36(ge.v),b.Y36(J.z),b.Y36(ne),b.Y36(l.i),b.Y36(b.sBO),b.Y36(Q.JJ))},Ge.\u0275cmp=b.Xpm({type:Ge,selectors:[["route-planner"]],decls:24,vars:10,consts:[[1,"route"],[1,"route-places"],["name","map","slot","start"],[4,"ngIf"],[3,"click",4,"ngIf"],["primary",""],["slot","secondary"],["slot","primary"],[3,"placeChanged"],["placeSearchRouteStart",""],["placeSearchRouteDestination",""],["class","ion-padding",4,"ngIf"],["name","ionic","item-left",""],["placeholder","Starting Point",3,"ngModel","debounce","ngModelChange","ionInput","ionCancel"],[3,"click"],["name","pin","item-left",""],["placeholder","Destination",3,"ngModel","debounce","ngModelChange","ionInput","ionCancel"],["name","close","slot","start"],["name","cog","slot","end"],[1,"ion-padding"],["name","cog"],["position","stacked"],["min","1","max","200","step","5","snaps","true","pin","true","light","",3,"ngModel","ngModelChange"],["slot","start","small","","name","map"],["slot","end","large","","name","map"],["type","number","min","0.1","max","1",3,"ngModel","ngModelChange"]],template:function(ht,wt){1&ht&&(b.TgZ(0,"div",0),b.TgZ(1,"div",1),b.TgZ(2,"ion-list"),b.TgZ(3,"ion-list-header"),b._UZ(4,"ion-icon",2),b.TgZ(5,"ion-label"),b._uU(6,"Plan Your Journey"),b.qZA(),b.qZA(),b.YNc(7,ue,3,2,"ion-item",3),b.YNc(8,ye,4,1,"ion-item",4),b.YNc(9,xe,3,2,"ion-item",3),b.YNc(10,Ee,4,1,"ion-item",4),b.qZA(),b.TgZ(11,"ion-toolbar",5),b.TgZ(12,"ion-buttons",6),b.YNc(13,We,3,0,"ion-button",4),b.qZA(),b.TgZ(14,"ion-buttons",7),b.YNc(15,be,3,0,"ion-button",4),b.YNc(16,Se,3,0,"ion-button",4),b.qZA(),b.qZA(),b.qZA(),b.TgZ(17,"place-search",8,9),b.NdJ("placeChanged",function(gt){return wt.routeStartSelected(gt)}),b.qZA(),b.TgZ(19,"place-search",8,10),b.NdJ("placeChanged",function(gt){return wt.routeDestinationSelected(gt)}),b.qZA(),b.YNc(21,ze,3,0,"p",11),b.YNc(22,tt,5,9,"ion-list",3),b.YNc(23,et,15,3,"div",3),b.qZA()),2&ht&&(b.xp6(7),b.Q6J("ngIf",null==wt.routeStartPlace),b.xp6(1),b.Q6J("ngIf",null!=wt.routeStartPlace),b.xp6(1),b.Q6J("ngIf",null==wt.routeDestinationPlace),b.xp6(1),b.Q6J("ngIf",null!=wt.routeDestinationPlace),b.xp6(3),b.Q6J("ngIf",wt.isRouteSet),b.xp6(2),b.Q6J("ngIf",!wt.advancedSettingsMode),b.xp6(1),b.Q6J("ngIf",wt.advancedSettingsMode),b.xp6(5),b.Q6J("ngIf",wt.routeCalcInProgress),b.xp6(1),b.Q6J("ngIf",null!=wt.selectedJourneyRoute),b.xp6(1),b.Q6J("ngIf",wt.advancedSettingsMode))},directives:[d.q_,d.yh,d.gu,d.Q$,Q.O5,d.Ie,d.VI,d.j9,Y.JJ,Y.On,d.sr,d.Sm,d.YG,se.v,d.PQ,d.I_,d.QI,d.pK,d.as],pipes:[Q.JJ],encapsulation:2}),Ge})(),C=(()=>{class Ge{constructor(ht){this.modalController=ht,this.hasNavbar=!1}close(){this.modalController.dismiss()}}return Ge.\u0275fac=function(ht){return new(ht||Ge)(b.Y36(d.IN))},Ge.\u0275cmp=b.Xpm({type:Ge,selectors:[["ng-component"]],decls:10,vars:0,consts:[["slot","end"],[3,"click"],["name","close","slot","end"],[1,"route-planner","ion-padding"]],template:function(ht,wt){1&ht&&(b.TgZ(0,"ion-header"),b.TgZ(1,"ion-toolbar"),b.TgZ(2,"ion-title"),b._uU(3," Route Planner "),b.qZA(),b.TgZ(4,"ion-buttons",0),b.TgZ(5,"ion-button",1),b.NdJ("click",function(){return wt.close()}),b._UZ(6,"ion-icon",2),b._uU(7," Close "),b.qZA(),b.qZA(),b.qZA(),b.qZA(),b.TgZ(8,"ion-content",3),b._UZ(9,"route-planner"),b.qZA())},directives:[d.Gu,d.sr,d.wd,d.Sm,d.YG,d.gu,d.W2,Be],encapsulation:2}),Ge})()},9671:(An,vt,k)=>{"use strict";k.r(vt),k.d(vt,{SearchPageModule:()=>xn});var b=k(8936),d=k(9397),pe=k(6895),l=k(4006),J=k(7429),j=k(3334),g=k(6099),ne=k(2340),ge=k(2951),Q=k(6314),Y=k(6763),se=k(3399),ue=k(4120),ye=k(2206),xe=k(6579),Ee=k(7689),We=k(3912),be=k(4781),Se=k(9698),ze=k(3855),tt=k(2428),et=k(3753),Be=k(3489),C=k(6686);const ht=new(k(2268).v)(C.o);class xt{constructor(Kt,mt){this.dueTime=Kt,this.scheduler=mt}call(Kt,mt){return mt.subscribe(new gt(Kt,this.dueTime,this.scheduler))}}class gt extends Be.L{constructor(Kt,mt,Wt){super(Kt),this.dueTime=mt,this.scheduler=Wt,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(Kt){this.clearDebounce(),this.lastValue=Kt,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(Bt,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:Kt}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(Kt)}}clearDebounce(){const Kt=this.debouncedSubscription;null!==Kt&&(this.remove(Kt),Kt.unsubscribe(),this.debouncedSubscription=null)}}function Bt(an){an.debouncedNext()}const Gn=(0,k(7423).fo)("Geolocation",{web:()=>k.e(4561).then(k.bind(k,4561)).then(an=>new an.GeolocationWeb)});var It=k(6738),jt=k(6260);function Ut(an,Kt){1&an&&It._UZ(0,"ion-icon",13)}function Yt(an,Kt){1&an&&It._UZ(0,"ion-spinner")}function zt(an,Kt){if(1&an){const mt=It.EpF();It.TgZ(0,"ion-button",3),It.NdJ("click",function(){return It.CHM(mt),It.oxw().openSideView()}),It._UZ(1,"ion-icon",14),It.qZA()}}function Zt(an,Kt){1&an&&(It.ynx(0),It.TgZ(1,"div",15),It.TgZ(2,"p"),It._uU(3,"There was a problem communicating with Open Charge Map. Please check your data connection."),It.qZA(),It.qZA(),It.BQk())}let ln=(()=>{class an{constructor(mt,Wt,On,bn,jn,li,$i,rr,Bi,_i,tr,gi){this.appManager=mt,this.nav=Wt,this.events=On,this.translate=bn,this.platform=jn,this.poiManager=li,this.mapping=$i,this.journeyManager=rr,this.zone=Bi,this.modalController=_i,this.alertController=tr,this.logging=gi,this.mapDisplayed=!1,this.initialResultsShown=!1,this.searchOnDemand=!1,this.poiViewMode="modal",this.sideViewAvailable=!1,this.routePlanningMode=!0,this.searchKeyword="",this.appConfig=new ge.X,this.defaultMapZoom=15,this.defaultStartPos=new ue.wC(37.415328,-122.076575),this._watchId=null,this.mapCanvasID="map-canvas",this.mapping.setMapType(mt.searchSettings.MapType),this.mapping.setMapAPI(ne.N.defaultMapProvider),(0,et.R)(window,"resize").pipe(function wt(an,Kt=ht){return mt=>mt.lift(new xt(an,Kt))}(500)).subscribe(Xt=>{let Oe={width:xe.c.getClientHeight(),height:xe.c.getClientWidth()};this.events.publish("ocm:window:resized",[Oe])})}ionViewDidEnter(){this.logging.log("Entered search page.",Ee.i.VERBOSE),this.mapping.focusMap(),this.mapping.updateMapSize()}ionViewWillLeave(){this.logging.log("Leaving search page.",Ee.i.VERBOSE),this.mapping.unfocusMap()}getPreferredMapHeight(mt){return null==mt&&(mt=xe.c.getClientHeight()),mt-56}enforceMapHeight(mt){this.logging.log("Would resize map:"+mt.width+" "+mt.height,Ee.i.VERBOSE),this.checkViewportMode();const Wt=this.getPreferredMapHeight(mt[0]);document.getElementById(this.mapCanvasID).offsetHeight!==Wt&&(document.getElementById(this.mapCanvasID).style.height=Wt+"px"),this.mapping&&(this.logging.log("Map height:"+Wt,Ee.i.VERBOSE),this.mapping.updateMapSize())}checkViewportMode(){}initialiseMapping(){var mt=this;return(0,g.Z)(function*(){yield mt.platform.ready(),mt.debouncedRefreshMapResults=xe.c.debounce(mt.refreshMapResults,1e3,!1),mt.events.subscribe("ocm:mapping:ready",(0,g.Z)(function*(){if(mt.logging.log("init map: mapping ready"),mt.mapping&&mt.mapping.updateMapSize(),!mt.initialResultsShown)if(mt.appManager.searchSettings.StartSearchPosition)mt.searchOnDemand=!0,mt.mapping.updateMapCentrePos(mt.appManager.searchSettings.StartSearchPosition.latitude,mt.appManager.searchSettings.StartSearchPosition.longitude,!0,mt.defaultMapZoom);else{let Wt=localStorage.getItem("_locationEnabled");1==mt.appManager.isEmbeddedMode&&"true"!=Wt?yield(yield mt.alertController.create({header:"Search using your location?",message:"Select OK to continue.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:(bn=(0,g.Z)(function*(jn){yield mt.useFallbackPosition()}),function(li){return bn.apply(this,arguments)})},{text:"OK",handler:function(){var bn=(0,g.Z)(function*(){yield mt.locateUser()});return function(){return bn.apply(this,arguments)}}()}]})).present():(yield mt.locateUser(),mt.mapping&&mt.mapping.updateMapSize())}var bn})),mt.events.subscribe("ocm:mapping:zoom",()=>{mt.debouncedRefreshMapResults()}),mt.events.subscribe("ocm:mapping:dragend",()=>{mt.debouncedRefreshMapResults()}),mt.events.subscribe("ocm:poiList:updated",Wt=>{mt.showPOIListOnMap(Wt)}),mt.events.subscribe("ocm:poiList:cleared",()=>{mt.mapping.clearMarkers(),setTimeout(()=>{mt.debouncedRefreshMapResults()},500)}),mt.events.subscribe("ocm:window:resized",Wt=>{null!=Wt&&Wt.length>0&&mt.enforceMapHeight(Wt[0])}),mt.events.subscribe("ocm:poi:selected",Wt=>{if(Wt.poi)mt.viewPOIDetails(Wt,Wt.poi);else{let On=mt.getPOIByID(Wt.poiId);mt.viewPOIDetails(Wt,On)}}),mt.checkViewportMode(),mt.mapping.initMap(mt.mapCanvasID)})()}ngAfterViewInit(){var mt=this;return(0,g.Z)(function*(){yield mt.initialiseMapping()})()}ngOnInit(){var mt=this;return(0,g.Z)(function*(){mt.logging.log("Refreshing reference data ..",Ee.i.VERBOSE),(yield mt.appManager.referenceDataManager.refreshReferenceData(mt.appManager.api))||(mt.appManager.isOffline=!0)})()}showPOIListOnMap(mt){const Wt=this.getPreferredMapHeight(null);this.mapping.refreshMapView(Wt,this.poiManager.poiList,null),this.mapDisplayed||(this.mapDisplayed=!0)}getIconForPOI(mt){return xe.c.getIconForPOI(mt)}getPOIByID(mt){const Wt=this.poiManager.poiList;for(let On=0;On<Wt.length;On++)if(Wt[On].ID===mt)return Wt[On];return null}refreshMapResults(){var mt=this;return(0,g.Z)(function*(){if(!mt.searchOnDemand)return void mt.logging.log("Skipping refresh, search on demand disabled..",Ee.i.VERBOSE);mt.logging.log("Refreshing Results..",Ee.i.VERBOSE);const Wt=new ye.b;let On=null;if(mt.appManager.searchSettings.StartSearchPosition&&(On=new ue.jR(mt.appManager.searchSettings.StartSearchPosition.latitude,mt.appManager.searchSettings.StartSearchPosition.longitude),mt.appManager.searchSettings.StartSearchPosition=null),On&&0==On.coords.latitude&&0==On.coords.longitude)return void mt.logging.log("Map center is zero. No query will be performed",Ee.i.WARNING);if(null!=On)Wt.latitude=On.coords.latitude,Wt.longitude=On.coords.longitude,Wt.distance=25,Wt.boundingbox=null,mt.appManager.searchSettings.LastSearchPosition=new ue.wC(On.coords.latitude,On.coords.longitude);else{Wt.latitude=null,Wt.longitude=null;let jn=yield mt.mapping.getMapBounds().toPromise();Wt.boundingbox="("+jn[0].latitude+","+jn[0].longitude+"),("+jn[1].latitude+","+jn[1].longitude+")",mt.logging.log(JSON.stringify(jn),Ee.i.VERBOSE)}Wt.includeComments=!0,Wt.enableCaching=!0,null!=mt.appManager.searchSettings&&(null!=mt.appManager.searchSettings.ConnectionTypeList&&(Wt.connectionTypeIdList=mt.appManager.searchSettings.ConnectionTypeList),null!=mt.appManager.searchSettings.UsageTypeList&&(Wt.usageTypeIdList=mt.appManager.searchSettings.UsageTypeList),null!=mt.appManager.searchSettings.StatusTypeList&&(Wt.statusTypeIdList=mt.appManager.searchSettings.StatusTypeList),null!=mt.appManager.searchSettings.OperatorList&&(Wt.operatorIdList=mt.appManager.searchSettings.OperatorList),null!=mt.appManager.searchSettings.MinPowerKW&&mt.appManager.searchSettings.MinPowerKW>0&&(Wt.minPowerKW=mt.appManager.searchSettings.MinPowerKW),null!=mt.appManager.searchSettings.MaxPowerKW&&mt.appManager.searchSettings.MaxPowerKW>0&&(Wt.maxPowerKW=mt.appManager.searchSettings.MaxPowerKW),null!=mt.journeyManager.getRoutePolyline()&&(Wt.polyline=mt.journeyManager.getRoutePolyline(),Wt.boundingbox=null,Wt.levelOfDetail=null,Wt.latitude=null,Wt.longitude=null)),mt.appManager.isRequestInProgress=!0;let bn=yield mt.poiManager.refreshPOIList(Wt);mt.appManager.isRequestInProgress=!1,mt.initialResultsShown=!0,bn>=Wt.maxResults&&mt.appManager.showToastNotification("A maximum of "+bn+" results are returned per search. Zoom in for details.")})()}viewPOIDetails(mt,Wt){this.logging.log("Viewing/fetching ["+this.poiViewMode+"] POI Details "+mt.poiId),null!=Wt?(this.mapping.unfocusMap(),this.modalController.create({component:se.H,componentProps:{item:Wt}}).then(On=>{On.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),On.present()})):this.poiManager.getPOIById(mt.poiId,!0).then(On=>{this.logging.log("Got POI Details "+On.ID),"modal"===this.poiViewMode&&(this.searchOnDemand=!1,this.modalController.create({component:se.H,componentProps:{item:On}}).then(bn=>{bn.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),bn.present()}),this.mapping.unfocusMap()),"side"===this.poiViewMode&&(this.selectedPOI=On)},On=>{this.appManager.showToastNotification("POI Details not available")})}closePOIDetails(){this.selectedPOI=null}openRoutePlannerModal(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:Y.u}).then(mt=>{mt.onDidDismiss().then(Wt=>{this.logging.log("Dismissing Route Planner Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),mt.present()})}openSearchOptions(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:Q.N}).then(mt=>{mt.onDidDismiss().then(Wt=>{this.mapping.focusMap(),this.searchOnDemand=!0}),mt.present()})}openSideView(){this.poiViewMode="side",this.mapping.updateMapSize()}closeSideView(){this.poiViewMode="modal",this.mapping.updateMapSize()}planRoute(){this.routePlanningMode=!0}search(mt){this.placeSearchMapPOI.getPlacesAutoComplete(mt,"poiSearch")}useFallbackPosition(){let mt=this.defaultStartPos;null!=this.appManager.searchSettings.LastSearchPosition&&(mt=this.appManager.searchSettings.LastSearchPosition),this.appManager.searchSettings.StartSearchPosition=mt,this.appManager.searchSettings.LastSearchPosition=null,this.searchOnDemand=!0,this.mapping.updateMapCentrePos(mt.latitude,mt.longitude,!0,this.defaultMapZoom)}getPosition(mt={}){var Wt=this;return(0,g.Z)(function*(){return new Promise((On,bn)=>{Wt._watchId=Gn.watchPosition(mt,(jn,li)=>{Gn.clearWatch({id:Wt._watchId}),li?bn(li):On(jn)})})})()}locateUser(){var mt=this;return(0,g.Z)(function*(){mt.useFallbackPosition();try{mt.logging.log("Attempting to locate user..");const Wt=yield mt.getPosition({timeout:1e4});if(!Wt)throw"Failed to get user location.";return mt.logging.log("Got user location."),mt.appManager.searchSettings.StartSearchPosition=new ue.wC(Wt.coords.latitude,Wt.coords.longitude),mt.searchOnDemand=!0,mt.mapping.updateMapCentrePos(Wt.coords.latitude,Wt.coords.longitude,!0,mt.defaultMapZoom),localStorage.setItem("_locationEnabled","true"),!0}catch(Wt){return mt.logging.log("Failed to get user location. Searching using default or last position."+Wt),mt.appManager.showToastNotification("Your location could not be determined."),mt.useFallbackPosition(),!1}})()}placeSelected(mt){this.searchKeyword=mt.Address,this.logging.log("Got place details:"+mt.Address),this.mapping.focusMap(),this.mapping.updateMapCentrePos(mt.Location.latitude,mt.Location.longitude,!0),this.debouncedRefreshMapResults()}}return an.\u0275fac=function(mt){return new(mt||an)(It.Y36(ze.c),It.Y36(J.SH),It.Y36(jt.z),It.Y36(d.sK),It.Y36(J.t4),It.Y36(Se.R),It.Y36(be.v),It.Y36(We.i),It.Y36(It.R0b),It.Y36(J.IN),It.Y36(J.Br),It.Y36(Ee.z))},an.\u0275cmp=It.Xpm({type:an,selectors:[["ng-component"]],viewQuery:function(mt,Wt){if(1&mt&&It.Gf(tt.v,7),2&mt){let On;It.iGM(On=It.CRH())&&(Wt.placeSearchMapPOI=On.first)}},decls:18,vars:10,consts:[["slot","start"],["autocapitalize","on","autocomplete","on",3,"ngModel","placeholder","debounce","ngModelChange","ionInput"],["slot","end"],[3,"click"],["name","locate","slot","start",4,"ngIf"],[4,"ngIf"],[3,"color","click"],["name","options","slot","end"],[3,"click",4,"ngIf"],[1,"search-page"],[3,"placeChanged"],["placeSearchMapPOI",""],["id","map-canvas",2,"height","100%","width","100%","min-height","300px"],["name","locate","slot","start"],["name","car","title","Route","slot","end"],[2,"position","absolute"]],template:function(mt,Wt){1&mt&&(It.TgZ(0,"ion-header"),It.TgZ(1,"ion-toolbar"),It.TgZ(2,"ion-buttons",0),It._UZ(3,"ion-menu-button"),It.qZA(),It.TgZ(4,"ion-searchbar",1),It.NdJ("ngModelChange",function(bn){return Wt.searchKeyword=bn})("ionInput",function(bn){return Wt.search(bn)}),It.ALo(5,"translate"),It.qZA(),It.TgZ(6,"ion-buttons",2),It.TgZ(7,"ion-button",3),It.NdJ("click",function(){return Wt.locateUser()}),It.YNc(8,Ut,1,0,"ion-icon",4),It.YNc(9,Yt,1,0,"ion-spinner",5),It.qZA(),It.TgZ(10,"ion-button",6),It.NdJ("click",function(){return Wt.openSearchOptions()}),It._UZ(11,"ion-icon",7),It.qZA(),It.YNc(12,zt,2,0,"ion-button",8),It.qZA(),It.qZA(),It.qZA(),It.TgZ(13,"ion-content",9),It.TgZ(14,"place-search",10,11),It.NdJ("placeChanged",function(bn){return Wt.placeSelected(bn)}),It.qZA(),It.YNc(16,Zt,4,0,"ng-container",5),It._UZ(17,"div",12),It.qZA()),2&mt&&(It.xp6(4),It.Q6J("ngModel",Wt.searchKeyword)("placeholder",It.lcZ(5,8,"ocm.search.performSearch"))("debounce",500),It.xp6(4),It.Q6J("ngIf",!Wt.appManager.isRequestInProgress),It.xp6(1),It.Q6J("ngIf",Wt.appManager.isRequestInProgress),It.xp6(1),It.Q6J("color",Wt.appManager.searchSettings.HasActiveFilters?"danger":"default"),It.xp6(2),It.Q6J("ngIf",1==Wt.sideViewAvailable&&"modal"==Wt.poiViewMode),It.xp6(4),It.Q6J("ngIf",Wt.appManager.isOffline))},directives:[J.Gu,J.sr,J.Sm,J.fG,J.VI,J.j9,l.JJ,l.On,J.YG,pe.O5,J.gu,J.PQ,J.W2,tt.v],pipes:[d.X$],styles:[".search-page[_ngcontent-%COMP%]   #map-canvas[_ngcontent-%COMP%]{width:100%;height:98%}.search-page[_ngcontent-%COMP%]   #place-search[_ngcontent-%COMP%]{min-height:300px;background-color:#f0f0f0;position:absolute;z-index:100;width:100%}.search-page[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]{flex:.4}.search-page[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%], .search-page[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%], .search-page[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding:0}.search-page[_ngcontent-%COMP%]   scroll-content[_ngcontent-%COMP%]{overflow-y:hidden}.search-page[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]{padding-left:2em}.search-page[_ngcontent-%COMP%]   .sideview[_ngcontent-%COMP%]{background:#eeeeee;background:linear-gradient(to bottom,#eeeeee 0%,white 100%)}"]}),an})(),xn=(()=>{class an{}return an.\u0275fac=function(mt){return new(mt||an)},an.\u0275mod=It.oAB({type:an}),an.\u0275inj=It.cJS({imports:[[pe.ez,l.u5,J.Pc,d.aw,b.e,j.Bz.forChild([{path:"",component:ln}])]]}),an})()},6314:(An,vt,k)=>{"use strict";k.d(vt,{N:()=>et});var b=k(6099),d=k(9698),pe=k(3855),l=k(7627),J=k(6579),j=k(4781),g=k(6738),ne=k(7429),ge=k(6260),Q=k(6895),Y=k(4006),se=k(9397);let ue=(()=>{class Be extends se.X${constructor(Ge,_t){super(Ge,_t)}transform(Ge,..._t){let ht=super.transform(Ge,..._t);return ht==Ge?null!=_t&&_t[0].default?_t[0].default:_t[0].Title?_t[0].Title:ht:ht}}return Be.\u0275fac=function(Ge){return new(Ge||Be)(g.Y36(se.sK,16),g.Y36(g.sBO,16))},Be.\u0275pipe=g.Yjl({name:"nullableTranslate",type:Be,pure:!0}),Be.\u0275prov=g.Yz7({token:Be,factory:Be.\u0275fac}),Be})();function ye(Be,C){if(1&Be){const Ge=g.EpF();g.TgZ(0,"p",21),g._UZ(1,"ion-icon",22),g._uU(2," One or more filters are currently being applied. "),g.TgZ(3,"ion-button",23),g.NdJ("click",function(){return g.CHM(Ge),g.oxw().clearFilters()}),g._UZ(4,"ion-icon",24),g.TgZ(5,"ion-label"),g._uU(6,"Clear"),g.qZA(),g.qZA(),g.qZA()}}function xe(Be,C){if(1&Be&&(g.TgZ(0,"ion-select-option",26),g._uU(1),g.qZA()),2&Be){const Ge=C.$implicit;g.Q6J("value",Ge.ID),g.xp6(1),g.Oqu(Ge.Title)}}function Ee(Be,C){if(1&Be){const Ge=g.EpF();g.TgZ(0,"ion-item"),g.TgZ(1,"ion-label"),g._uU(2),g.ALo(3,"translate"),g.qZA(),g.TgZ(4,"ion-select",14),g.NdJ("ngModelChange",function(ht){return g.CHM(Ge),g.oxw().searchSettings.FilterOptionsByCountryId=ht})("ionChange",function(){return g.CHM(Ge),g.oxw().onCountryChange()}),g.TgZ(5,"ion-select",25),g._uU(6,"(All Countries)"),g.qZA(),g.YNc(7,xe,2,2,"ion-select-option",4),g.qZA(),g.qZA()}if(2&Be){const Ge=g.oxw();g.xp6(2),g.Oqu(g.lcZ(3,3,"ocm.search.countries")),g.xp6(2),g.Q6J("ngModel",Ge.searchSettings.FilterOptionsByCountryId),g.xp6(3),g.Q6J("ngForOf",Ge.countries)}}function We(Be,C){if(1&Be&&(g.TgZ(0,"ion-select-option",26),g._uU(1),g.ALo(2,"nullableTranslate"),g.qZA()),2&Be){const Ge=C.$implicit;g.Q6J("value",Ge.ID),g.xp6(1),g.Oqu(g.xi3(2,2,"ocm.reference.operatorInfo.value_"+Ge.ID,Ge))}}function be(Be,C){if(1&Be&&(g.TgZ(0,"ion-select-option",26),g._uU(1),g.ALo(2,"nullableTranslate"),g.qZA()),2&Be){const Ge=C.$implicit;g.Q6J("value",Ge.ID),g.xp6(1),g.Oqu(g.xi3(2,2,"ocm.reference.usageType.value_"+Ge.ID,Ge))}}function Se(Be,C){if(1&Be&&(g.TgZ(0,"ion-select-option",26),g._uU(1),g.ALo(2,"nullableTranslate"),g.qZA()),2&Be){const Ge=C.$implicit;g.Q6J("value",Ge.ID),g.xp6(1),g.Oqu(g.xi3(2,2,"ocm.reference.statusType.value_"+Ge.ID,Ge))}}function ze(Be,C){if(1&Be&&(g.TgZ(0,"ion-select-option",26),g._uU(1),g.ALo(2,"nullableTranslate"),g.qZA()),2&Be){const Ge=C.$implicit;g.Q6J("value",Ge.ID),g.xp6(1),g.Oqu(g.xi3(2,2,"ocm.reference.connectionType.value_"+Ge.ID,Ge))}}function tt(Be,C){if(1&Be&&(g.TgZ(0,"ion-select-option",26),g._uU(1),g.qZA()),2&Be){const Ge=C.$implicit;g.Q6J("value",Ge.code),g.xp6(1),g.Oqu(Ge.title)}}let et=(()=>{class Be{constructor(Ge,_t,ht,wt,xt){this.appManager=Ge,this.poiManager=_t,this.mapping=ht,this.modalController=wt,this.events=xt,this.maxPower=l.U,this.powerRange={lower:0,upper:this.maxPower},this._languages=[],this.searchSettings=Ge.searchSettings}ngOnInit(){var Ge=this;return(0,b.Z)(function*(){null!=Ge.searchSettings.MinPowerKW&&(Ge.powerRange.lower=Ge.searchSettings.MinPowerKW),null!=Ge.searchSettings.MaxPowerKW&&(Ge.powerRange.upper=Ge.searchSettings.MaxPowerKW),0==Ge.powerRange.upper&&(Ge.powerRange.upper=Ge.maxPower),Ge.appManager.analytics.viewEvent("Settings"),Ge.useFilteredOptions&&(yield Ge.onCountryChange())})()}get useFilteredOptions(){return this.searchSettings.FilterOptionsByCountryId>0}clearFilters(){this.searchSettings.ClearActiveFilters(),this.powerRange={lower:0,upper:this.maxPower},this.searchSettings.CheckForActiveFilters()}get operators(){return this.appManager.referenceDataManager.getNetworkOperators(this.useFilteredOptions)}get connectionTypes(){return this.appManager.referenceDataManager.getConnectionTypes(this.useFilteredOptions)}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes(this.useFilteredOptions)}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes(this.useFilteredOptions)}get countries(){return this.appManager.referenceDataManager.getCountries(this.useFilteredOptions)}get isCountryFilterFeatureEnabled(){return J.c.isFeatureEnabled("FILTER_OPTIONS_BY_COUNTRY")}get languages(){return this._languages.length>0||(this._languages=this.appManager.getLanguages()),this._languages}ionViewWillLeave(){null!=this.searchSettings.Language&&this.appManager.setLanguage(this.searchSettings.Language),this.searchSettings.MinPowerKW=this.powerRange.lower,this.searchSettings.MaxPowerKW=this.powerRange.upper,1==this.searchSettings.MinPowerKW&&(this.searchSettings.MinPowerKW=null),this.searchSettings.MaxPowerKW==this.maxPower&&(this.searchSettings.MaxPowerKW=null),this.appManager.searchSettings=this.searchSettings,this.appManager.saveSearchSettings(),this.events.publish("ocm:poiList:cleared")}onLanguageChange(){null!=this.searchSettings.Language&&""!=this.searchSettings.Language&&this.appManager.setLanguage(this.searchSettings.Language)}onCountryChange(){var Ge=this;return(0,b.Z)(function*(){Ge.appManager.referenceDataManager.refreshFilteredReferenceData(Ge.appManager.api,{CountryIds:[Ge.searchSettings.FilterOptionsByCountryId]})})()}onMapTypeChange(){var Ge=this;return(0,b.Z)(function*(){Ge.mapping.setMapType(Ge.searchSettings.MapType)})()}close(){this.modalController.dismiss()}}return Be.\u0275fac=function(Ge){return new(Ge||Be)(g.Y36(pe.c),g.Y36(d.R),g.Y36(j.v),g.Y36(ne.IN),g.Y36(ge.z))},Be.\u0275cmp=g.Xpm({type:Be,selectors:[["ng-component"]],decls:77,vars:38,consts:[[1,"settings-page","ion-padding"],["danger","",4,"ngIf"],[4,"ngIf"],["multiple","true","cancelText","Cancel","okText","OK",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["lines","none"],["dualKnobs","true","min","0","max","650","pin","true",3,"ngModel","ngModelChange"],["slot","start","size","small","name","flash"],["slot","end","name","flash"],["slot","start",2,"padding-top","0"],["type","number","min","0",2,"width","3em","border","none",3,"ngModel","max","ngModelChange"],["slot","end",2,"padding-top","0"],["type","number",2,"width","3em","border","none",3,"ngModel","max","min","ngModelChange"],["multiple","false",3,"ngModel","ngModelChange","ionChange"],["multiple","false","cancelText","Cancel","okText","OK",3,"ngModel","ngModelChange","ionChange"],["value","ROADMAP"],["value","SATELLITE"],[3,"ngModel","ngModelChange"],["slot","end"],[3,"click"],["name","close","slot","start"],["danger",""],["name","alert"],["size","small","color","light",3,"click"],["slot","start","name","close"],["value",""],[3,"value"]],template:function(Ge,_t){1&Ge&&(g.TgZ(0,"ion-header"),g.TgZ(1,"ion-toolbar"),g.TgZ(2,"ion-title"),g._uU(3),g.ALo(4,"translate"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(5,"ion-content",0),g.TgZ(6,"h2"),g._uU(7,"Search Filters"),g.qZA(),g.TgZ(8,"p"),g._uU(9,"Note: Filters will remove usable charging locations from your search results if we do not have complete data (i.e Operator or Power Levels)."),g.qZA(),g.YNc(10,ye,7,0,"p",1),g.TgZ(11,"ion-list"),g.YNc(12,Ee,8,5,"ion-item",2),g.TgZ(13,"ion-item"),g.TgZ(14,"ion-label"),g._uU(15),g.ALo(16,"translate"),g.qZA(),g.TgZ(17,"ion-select",3),g.NdJ("ngModelChange",function(wt){return _t.searchSettings.OperatorList=wt}),g.YNc(18,We,3,5,"ion-select-option",4),g.qZA(),g.qZA(),g.TgZ(19,"ion-item"),g.TgZ(20,"ion-label"),g._uU(21),g.ALo(22,"translate"),g.qZA(),g.TgZ(23,"ion-select",3),g.NdJ("ngModelChange",function(wt){return _t.searchSettings.UsageTypeList=wt}),g.YNc(24,be,3,5,"ion-select-option",4),g.qZA(),g.qZA(),g.TgZ(25,"ion-item"),g.TgZ(26,"ion-label"),g._uU(27),g.ALo(28,"translate"),g.qZA(),g.TgZ(29,"ion-select",3),g.NdJ("ngModelChange",function(wt){return _t.searchSettings.StatusTypeList=wt}),g.YNc(30,Se,3,5,"ion-select-option",4),g.qZA(),g.qZA(),g.TgZ(31,"ion-item"),g.TgZ(32,"ion-label"),g._uU(33),g.ALo(34,"translate"),g.qZA(),g.TgZ(35,"ion-select",3),g.NdJ("ngModelChange",function(wt){return _t.searchSettings.ConnectionTypeList=wt}),g.YNc(36,ze,3,5,"ion-select-option",4),g.qZA(),g.qZA(),g.TgZ(37,"ion-item",5),g.TgZ(38,"ion-range",6),g.NdJ("ngModelChange",function(wt){return _t.powerRange=wt}),g.TgZ(39,"ion-icon",7),g._uU(40,"0"),g.qZA(),g._UZ(41,"ion-icon",8),g.qZA(),g.qZA(),g.TgZ(42,"ion-item",5),g.TgZ(43,"ion-note",9),g._uU(44,"Min. Power (kW)"),g._UZ(45,"br"),g.TgZ(46,"input",10),g.NdJ("ngModelChange",function(wt){return _t.powerRange.lower=wt}),g.qZA(),g.qZA(),g.TgZ(47,"ion-note",11),g._uU(48,"Max. Power (kW)"),g._UZ(49,"br"),g.TgZ(50,"input",12),g.NdJ("ngModelChange",function(wt){return _t.powerRange.upper=wt}),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.TgZ(51,"h2"),g._uU(52," General Settings "),g.qZA(),g.TgZ(53,"ion-item"),g.TgZ(54,"ion-label"),g._uU(55,"Language"),g.qZA(),g.TgZ(56,"ion-select",13),g.NdJ("ngModelChange",function(wt){return _t.searchSettings.Language=wt})("ionChange",function(){return _t.onLanguageChange()}),g.YNc(57,tt,2,2,"ion-select-option",4),g.qZA(),g.qZA(),g.TgZ(58,"ion-item"),g.TgZ(59,"ion-label"),g._uU(60),g.ALo(61,"translate"),g.qZA(),g.TgZ(62,"ion-select",14),g.NdJ("ngModelChange",function(wt){return _t.searchSettings.MapType=wt})("ionChange",function(){return _t.onMapTypeChange()}),g.TgZ(63,"ion-select-option",15),g._uU(64,"Road Map"),g.qZA(),g.TgZ(65,"ion-select-option",16),g._uU(66,"Satellite"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(67,"ion-item"),g.TgZ(68,"ion-label"),g._uU(69,"Enable Advanced Editor Options"),g.qZA(),g.TgZ(70,"ion-toggle",17),g.NdJ("ngModelChange",function(wt){return _t.searchSettings.EnableAdvancedEditorFeatures=wt}),g.qZA(),g.qZA(),g.qZA(),g.TgZ(71,"ion-footer"),g.TgZ(72,"ion-toolbar"),g.TgZ(73,"ion-buttons",18),g.TgZ(74,"ion-button",19),g.NdJ("click",function(){return _t.close()}),g._UZ(75,"ion-icon",20),g._uU(76," Close "),g.qZA(),g.qZA(),g.qZA(),g.qZA()),2&Ge&&(g.xp6(3),g.hij(" ",g.lcZ(4,26,"ocm.general.settings")," "),g.xp6(7),g.Q6J("ngIf",1==_t.searchSettings.HasActiveFilters),g.xp6(2),g.Q6J("ngIf",_t.isCountryFilterFeatureEnabled),g.xp6(3),g.Oqu(g.lcZ(16,28,"ocm.search.networkOperators")),g.xp6(2),g.Q6J("ngModel",_t.searchSettings.OperatorList),g.xp6(1),g.Q6J("ngForOf",_t.operators),g.xp6(3),g.Oqu(g.lcZ(22,30,"ocm.search.usageTypes")),g.xp6(2),g.Q6J("ngModel",_t.searchSettings.UsageTypeList),g.xp6(1),g.Q6J("ngForOf",_t.usageTypes),g.xp6(3),g.Oqu(g.lcZ(28,32,"ocm.search.operationalStatusTypes")),g.xp6(2),g.Q6J("ngModel",_t.searchSettings.StatusTypeList),g.xp6(1),g.Q6J("ngForOf",_t.statusTypes),g.xp6(3),g.Oqu(g.lcZ(34,34,"ocm.search.connectionTypes")),g.xp6(2),g.Q6J("ngModel",_t.searchSettings.ConnectionTypeList),g.xp6(1),g.Q6J("ngForOf",_t.connectionTypes),g.xp6(2),g.Q6J("ngModel",_t.powerRange),g.xp6(8),g.Q6J("ngModel",_t.powerRange.lower)("max",_t.powerRange.upper),g.xp6(4),g.Q6J("ngModel",_t.powerRange.upper)("max",_t.maxPower)("min",_t.powerRange.lower),g.xp6(6),g.Q6J("ngModel",_t.searchSettings.Language),g.xp6(1),g.Q6J("ngForOf",_t.languages),g.xp6(3),g.Oqu(g.lcZ(61,36,"ocm.details.location.map")),g.xp6(2),g.Q6J("ngModel",_t.searchSettings.MapType),g.xp6(8),g.Q6J("ngModel",_t.searchSettings.EnableAdvancedEditorFeatures))},directives:[ne.Gu,ne.sr,ne.wd,ne.W2,Q.O5,ne.gu,ne.YG,ne.Q$,ne.q_,ne.Ie,ne.t9,ne.QI,Y.JJ,Y.On,Q.sg,ne.n0,ne.I_,ne.uN,Y.qQ,Y.wV,Y.Fd,Y.Fj,ne.ho,ne.w,ne.fr,ne.Sm],pipes:[se.X$,ue],encapsulation:2}),Be})()},6779:(An,vt,k)=>{"use strict";k.r(vt),k.d(vt,{SignInModule:()=>ge});var b=k(9492),d=k(8936),pe=k(9397),l=k(6895),J=k(4006),j=k(7429),g=k(3334),ne=k(6738);let ge=(()=>{class Q{}return Q.\u0275fac=function(se){return new(se||Q)},Q.\u0275mod=ne.oAB({type:Q}),Q.\u0275inj=ne.cJS({imports:[[l.ez,J.u5,j.Pc,pe.aw,d.e,g.Bz.forChild([{path:"",component:b.F}])]]}),Q})()},9492:(An,vt,k)=>{"use strict";k.d(vt,{F:()=>Q});var b=k(6099),d=k(7689),pe=k(3855),l=k(6738),J=k(7429),j=k(9397),g=k(3334),ne=k(6895),ge=k(4006);let Q=(()=>{class Y{constructor(ue,ye,xe,Ee,We,be,Se,ze){this.appManager=ue,this.modalController=ye,this.translate=xe,this.alertController=Ee,this.loadingController=We,this.logging=be,this.router=Se,this.location=ze,this.email=""}cancelSignIn(){this.modalController.dismiss()}performSignIn(){var ue=this;return(0,b.Z)(function*(){const ye=yield ue.loadingController.create({message:"Signing In.."});yield ye.present();let xe=!1;try{yield ue.appManager.api.performSignIn(ue.email,ue.password),ye.dismiss(),localStorage.setItem("authResponse",JSON.stringify(ue.appManager.api.authResponse)),ue.appManager.isUserAuthenticated(!0),ue.modalController.dismiss(),ue.appManager.analytics.appEvent("Profile","SignedIn")}catch(Ee){xe=!0,ye.dismiss(),yield(yield ue.alertController.create({header:"Open Charge Map",subHeader:"Email or Password not recognised",buttons:["Ok"]})).present(),ue.logging.log("Error logging in:"+Ee)}})()}}return Y.\u0275fac=function(ue){return new(ue||Y)(l.Y36(pe.c),l.Y36(J.IN),l.Y36(j.sK),l.Y36(J.Br),l.Y36(J.HT),l.Y36(d.z),l.Y36(g.F0),l.Y36(ne.Ye))},Y.\u0275cmp=l.Xpm({type:Y,selectors:[["ng-component"]],decls:37,vars:8,consts:[[1,"signin-page","ion-padding"],["item-left",""],["src","assets/images/icons/branding/AppIcon_128x128.png"],[1,"ion-padding"],["position","floating"],["type","text",3,"ngModel","ngModelChange"],["type","password",3,"ngModel","ngModelChange"],[3,"click"],["slot","secondary"],["name","close","slot","start"],["slot","primary"],["type","submit","color","primary",3,"click"],["name","log-in","slot","start"]],template:function(ue,ye){1&ue&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-title"),l._uU(3),l.ALo(4,"translate"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(5,"ion-content",0),l.TgZ(6,"ion-avatar",1),l._UZ(7,"img",2),l.qZA(),l.TgZ(8,"p",3),l._uU(9," Sign in using your Open Charge Map account. "),l.qZA(),l.TgZ(10,"ion-list"),l.TgZ(11,"ion-item"),l.TgZ(12,"ion-label",4),l._uU(13,"Email"),l.qZA(),l.TgZ(14,"ion-input",5),l.NdJ("ngModelChange",function(Ee){return ye.email=Ee}),l.qZA(),l.qZA(),l.TgZ(15,"ion-item"),l.TgZ(16,"ion-label",4),l._uU(17,"Password"),l.qZA(),l.TgZ(18,"ion-input",6),l.NdJ("ngModelChange",function(Ee){return ye.password=Ee}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(19,"p"),l._uU(20,"or "),l.TgZ(21,"a",7),l.NdJ("click",function(){return ye.appManager.launchWebPage("https://openchargemap.org/site/loginprovider/register")}),l._uU(22,"Register as New User"),l.qZA(),l._uU(23," or "),l.TgZ(24,"a",7),l.NdJ("click",function(){return ye.appManager.launchWebPage("https://openchargemap.org/site/loginprovider/passwordreset")}),l._uU(25,"Reset your password"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(26,"ion-footer"),l.TgZ(27,"ion-toolbar"),l.TgZ(28,"ion-buttons",8),l.TgZ(29,"ion-button",7),l.NdJ("click",function(){return ye.cancelSignIn()}),l._UZ(30,"ion-icon",9),l._uU(31," Cancel"),l.qZA(),l.qZA(),l.TgZ(32,"ion-buttons",10),l.TgZ(33,"ion-button",11),l.NdJ("click",function(){return ye.performSignIn()}),l._UZ(34,"ion-icon",12),l._uU(35),l.ALo(36,"translate"),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&ue&&(l.xp6(3),l.hij(" ",l.lcZ(4,4,"ocm.general.signIn")," "),l.xp6(11),l.Q6J("ngModel",ye.email),l.xp6(4),l.Q6J("ngModel",ye.password),l.xp6(17),l.hij(" ",l.lcZ(36,6,"ocm.general.signIn"),""))},directives:[J.Gu,J.sr,J.wd,J.W2,J.BJ,J.q_,J.Ie,J.Q$,J.pK,J.j9,ge.JJ,ge.On,J.fr,J.Sm,J.YG,J.gu],pipes:[j.X$],encapsulation:2}),Y})()},7814:(An,vt,k)=>{"use strict";k.d(vt,{l:()=>ne});var b=k(6099),d=k(7689),pe=k(6799),l=k(8649),J=k(529),j=k(2340),g=k(6738);let ne=(()=>{class ge{constructor(Y,se,ue){this.http=Y,this.refData=se,this.logging=ue,this.serviceBase="https://api.openchargemap.io",this.serviceBaseURL=this.serviceBase+"/v3",this.hasAuthorizationError=!1,this.ATTRIBUTION_METADATAFIELDID=4,this.clientName="ocm.api.default",this.allowMirror=!1,this.lastPOIApiCallURL="",this.serviceBaseURL=j.N.apiBase+"/v3"}getNumberListString(Y){let se="";for(let ue=0;ue<Y.length;ue++)se+=Y[ue],ue<Y.length&&(se+=",");return se}fetchPOIListByParam(Y){var se=this;return(0,b.Z)(function*(){const ue=se.serviceBaseURL+"/poi/?client="+se.clientName+(se.allowMirror?" &allowmirror=true":"")+"&verbose=false&output=json";Y.compact=!0;let ye="";null!=Y.countryCode&&(ye+="&countrycode="+Y.countryCode),null!=Y.latitude&&(ye+="&latitude="+Y.latitude),null!=Y.longitude&&(ye+="&longitude="+Y.longitude),null!=Y.distance&&(ye+="&distance="+Y.distance),null!=Y.distanceUnit&&(ye+="&distanceunit="+Y.distanceUnit),null!=Y.includeComments&&(ye+="&includecomments="+Y.includeComments),null!=Y.maxResults&&(ye+="&maxresults="+Y.maxResults),null!=Y.countryIdList&&(ye+="&countryid="+se.getNumberListString(Y.countryIdList)),null!=Y.levelIdList&&(ye+="&levelid="+se.getNumberListString(Y.levelIdList)),null!=Y.connectionTypeIdList&&Y.connectionTypeIdList.length>0&&(ye+="&connectiontypeid="+se.getNumberListString(Y.connectionTypeIdList)),null!=Y.operatorIdList&&Y.operatorIdList.length>0&&(ye+="&operatorid="+se.getNumberListString(Y.operatorIdList)),null!=Y.usageTypeIdList&&Y.usageTypeIdList.length>0&&(ye+="&usagetypeid="+se.getNumberListString(Y.usageTypeIdList)),null!=Y.statusTypeIdList&&Y.statusTypeIdList.length>0&&(ye+="&statustypeid="+se.getNumberListString(Y.statusTypeIdList)),null!=Y.locationTitle&&(ye+="&locationtitle="+Y.locationTitle),null!=Y.minPowerKW&&Y.minPowerKW>0&&(ye+="&minpowerkw="+Y.minPowerKW),null!=Y.maxPowerKW&&Y.maxPowerKW>0&&(ye+="&maxpowerkw="+Y.maxPowerKW),null!=Y.submissionStatusTypeIdList&&(ye+="&submissionstatustypeid="+se.getNumberListString(Y.submissionStatusTypeIdList)),null!=Y.poiIdList&&Y.poiIdList.length>0&&(ye+="&chargepointid="+se.getNumberListString(Y.poiIdList)),0==Y.enableCaching&&(ye+="&enablecaching=false"),null!=Y.compact&&(ye+="&compact="+Y.compact),Y.levelOfDetail>1&&(ye+="&levelofdetail="+Y.levelOfDetail),null!=Y.polyline&&(ye+="&polyline="+Y.polyline),null!=Y.boundingbox&&(ye+="&boundingbox="+Y.boundingbox),null!=Y.additionalParams&&(ye+="&"+Y.additionalParams);const xe=ue+ye;if(se.lastPOIApiCallURL===xe&&0!=Y.enableCaching)return se.logging.log("Skipped API call due to same query being repeated."),[];se.lastPOIApiCallURL=xe,se.logging.log("API Call:"+xe,d.i.VERBOSE);try{let Ee=yield se.http.get(xe,se.getHttpRequestOptions()).toPromise();return se.refData.hydrateCompactPOIList(Ee)}catch(Ee){const We=Ee.message||"Could not fetch POI list from server.";throw se.logging.log("API Client: "+JSON.stringify(Ee),d.i.ERROR),We}})()}getHttpRequestOptions(Y=!0){let se=new J.WM;return Y&&(se=se.append("Content-Type","application/json")),this.authResponse&&this.authResponse.Data&&this.authResponse.Data.access_token&&(se=se.append("Authorization","Bearer "+this.authResponse.Data.access_token)),se=se.append("X-API-Key",j.N.apiKey),{headers:se}}fetchCoreReferenceData(Y){let se=this.serviceBaseURL+"/referencedata/?client="+this.clientName+"&output=json"+(this.allowMirror?"&allowmirror=true":"")+"&verbose=false&compact=true";return null!=Y&&null!=Y.CountryIds&&(se+="&countryid="+this.getNumberListString(Y.CountryIds)),this.logging.log("API Call:"+se,d.i.VERBOSE),this.http.get(se,this.getHttpRequestOptions())}performSignIn(Y,se){return this.http.post(this.serviceBaseURL+"/profile/authenticate/",JSON.stringify({emailaddress:Y,password:se}),this.getHttpRequestOptions()).toPromise().then(xe=>(this.authResponse=xe,this.authResponse))}performSubmission(Y,se){return Y===l.q.POI?this.submitPOI(se):Y===l.q.Comment?this.submitUserComment(se):Y===l.q.Media?this.submitMediaItem(se):void 0}submitUserComment(Y){const se=JSON.stringify(Y);return this.logging.log("[api] Submitting user comment"),this.http.post(this.serviceBaseURL+"/comment/",se,this.getHttpRequestOptions()).toPromise()}submitMediaItem(Y){const se=JSON.stringify(Y);return this.http.post(this.serviceBaseURL+"/mediaitem/",se,this.getHttpRequestOptions()).toPromise()}submitPOI(Y){const se=JSON.stringify(Y);return this.http.post(this.serviceBaseURL+"/poi/",se,this.getHttpRequestOptions()).toPromise()}getPanoramioLocationPhotos(Y){return new Promise(se=>{const ue=.001,ye="https://www.panoramio.com/map/get_panoramas.php?set=public&from=0&to=2&minx="+(Y.longitude-ue)+"&miny="+(Y.latitude-ue)+"&maxx="+(Y.longitude+ue)+"maxy="+(Y.latitude+ue)+"&size=medium&mapfilter=true&callback=?";return console.log(ye),this.http.get(ye).toPromise()})}fetchReverseGeocodeResult(Y,se){return this.http.get(this.serviceBaseURL+"/geocode/?client="+this.clientName+"&output=json&camelcase=false&latitude="+Y+"&longitude="+se,this.getHttpRequestOptions()).toPromise()}isLocalStorageAvailable(){return void 0!==window.localStorage}setCachedDataObject(Y,se){this.isLocalStorageAvailable()&&(void 0===se&&(se=null),null===se?localStorage.removeItem(Y):localStorage.setItem(Y,JSON.stringify(se)))}getCachedDataObject(Y){if(this.isLocalStorageAvailable()){const se=localStorage.getItem(Y);if(null!=se&&se.length>0)return JSON.parse(se)}return null}}return ge.\u0275fac=function(Y){return new(Y||ge)(g.LFG(J.eN),g.LFG(pe.W),g.LFG(d.z))},ge.\u0275prov=g.Yz7({token:ge,factory:ge.\u0275fac,providedIn:"root"}),ge})()},56:(An,vt,k)=>{"use strict";k.d(vt,{c:()=>J});var b=k(6099),d=k(7689),pe=k(6738),l=k(7429);let J=(()=>{class j{constructor(ne,ge){this.logger=ne,this.platform=ge,this.isCordova=!1,this.ga=null,this.isCordova=!(!ge.is("cordova")&&!ge.is("capacitor"))}init(ne){var ge=this;return(0,b.Z)(function*(){ge.isCordova&&ge.ga?yield ge.ga.startTrackerWithId(ne):ge.logger.log("Could not initialise analytics")})()}setAppVersion(ne){var ge=this;return(0,b.Z)(function*(){if(ge.isCordova&&ge.ga)return ge.ga.setAppVersion(ne);ge.logger.log(ne)})()}appEvent(ne,ge){var Q=this;return(0,b.Z)(function*(){if(Q.isCordova&&Q.ga)return Q.ga.trackEvent(ne,ge);Q.logger.log(ge)})()}viewEvent(ne){var ge=this;return(0,b.Z)(function*(){if(ge.isCordova&&ge.ga)return ge.ga.trackView(ne);ge.logger.log(ne)})()}}return j.\u0275fac=function(ne){return new(ne||j)(pe.LFG(d.z),pe.LFG(l.t4))},j.\u0275prov=pe.Yz7({token:j,factory:j.\u0275fac,providedIn:"root"}),j})()},3855:(An,vt,k)=>{"use strict";k.d(vt,{c:()=>Se});var b=k(6099),d=k(7689),pe=k(7814),l=k(7627),J=k(4120),j=k(8649),g=k(6799),ne=k(3912),ge=k(56),Q=k(2340),Y=k(6738),se=k(529),ue=k(6260);class ye{constructor(tt,et){this.SubmissionType=tt,this.Data=et,this.DateQueued=new Date,this.IsSubmitted=!1,this.IsInProgress=!1,this.IsCancelled=!1,this.IsFailure=!1,this.Attempts=0,this.ID=new Date+"_"+100*Math.random()}}let xe=(()=>{class ze{constructor(et){this.events=et,this.isQueueProcessing=!1}setAppManager(et){this.appManager=et}add(et,Be){let C=this.getQueueItems();C.push(new ye(et,Be)),this.saveQueueItems(C)}update(et){let Be=this.getQueueItems(),C=new Array;return Be.forEach(Ge=>{C.push(Ge.ID==et.ID?et:Ge)}),C}processNextQueueItem(){let et=this.getNextQueueItem();null!=et&&null!=this.appManager&&this.appManager.api.performSubmission(et.SubmissionType,et.Data).then(()=>{et.IsSubmitted=!0,et.Attempts++,this.update(et),this.clear()})}getNextQueueItem(){let et=this.getQueueItems(),Be=null;return et.forEach(C=>{null==Be&&!C.IsCancelled&&!C.IsInProgress&&!C.IsSubmitted&&(Be=C)}),Be}hasPendingItems(){let et=!1;return this.getQueueItems().forEach(C=>{!C.IsFailure&&!C.IsCancelled&&!C.IsSubmitted&&(et=!0)}),et}isCompleted(){let et=this.getQueueItems(),Be=!0;return et.forEach(C=>{(C.IsInProgress||C.IsFailure)&&(Be=!1)}),Be}clear(et=!1){let Be=this.getQueueItems(),C=new Array;et||Be.forEach(Ge=>{(Ge.IsInProgress||Ge.IsFailure)&&C.push(Ge)}),this.saveQueueItems(C)}saveQueueItems(et){localStorage.setItem("submissionQueue",JSON.stringify(et))}getQueueItems(){let et=localStorage.getItem("submissionQueue");return null!=et?JSON.parse(et):new Array}}return ze.\u0275fac=function(et){return new(et||ze)(Y.LFG(ue.z))},ze.\u0275prov=Y.Yz7({token:ze,factory:ze.\u0275fac,providedIn:"root"}),ze})();var Ee=k(7429),We=k(9397),be=k(4244);let Se=(()=>{class ze{constructor(et,Be,C,Ge,_t,ht,wt,xt,gt,Bt,Ht,Gn,It){this.http=et,this.events=Be,this.api=C,this.submissionQueue=Ge,this.platform=_t,this.referenceDataManager=ht,this.journeyManager=wt,this.translateService=xt,this.toastController=gt,this.loadingController=Bt,this.jwtHelper=Ht,this.logging=Gn,this.analytics=It,this.isRequestInProgress=!1,this.title="Open Charge Map",this._isUserAuthenticated=null,this.isEmbeddedMode=!1,this.isOffline=!1,this.api.clientName="ocm.app.ionic."+Q.N.version,this.isDebugMode=!1,this.enableSubmissionQueue=!1,this.submissionQueue.setAppManager(this),this.platformMode=_t.is("cordova")?"cordova":"web",this.initAppManager(),this.searchSettings=new l.N,this.loadSearchSettings(),this.applyURLQueryStringOptions(),this.searchSettings.CheckForActiveFilters(),this.journeyManager.loadJourneys()}loadSearchSettings(){if(null!=localStorage.getItem("searchSettings")){this.searchSettings=new l.N;try{let et=JSON.parse(localStorage.getItem("searchSettings"));Object.assign(this.searchSettings,et)}catch{}}}savePushRegistration(et){localStorage.setItem("_pushToken",et.toString())}getPushRegistration(){localStorage.getItem("_pushToken")}getQueryVariable(et){let C=window.location.search.substring(1).split("&");for(let Ge=0;Ge<C.length;Ge++){let _t=C[Ge].split("=");if(decodeURIComponent(_t[0])==et)return _t[1].split(",").map(xt=>decodeURIComponent(xt))}return null}applyURLQueryStringOptions(){if(this.getQueryVariable("mode")&&"embedded"==this.getQueryVariable("mode")[0]&&(this.isEmbeddedMode=!0),this.getQueryVariable("operatorid")){let et=this.getQueryVariable("operatorid");for(let Be of et)this.searchSettings.OperatorList.unshift(parseInt(Be,10))}if(this.getQueryVariable("latitude")&&this.getQueryVariable("longitude")){let et=this.getQueryVariable("latitude")[0],Be=this.getQueryVariable("longitude")[0];this.searchSettings.StartSearchPosition=new J.wC(parseFloat(et),parseFloat(Be))}this.getQueryVariable("title")&&(this.title=this.getQueryVariable("title")[0]),this.getQueryVariable("languagecode")&&this.setLanguage(this.getQueryVariable("languagecode")[0])}saveSearchSettings(){this.searchSettings.CheckForActiveFilters(),localStorage.setItem("searchSettings",JSON.stringify(this.searchSettings))}getLanguages(){return[{code:"ar",title:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629 / Arabic"},{code:"bg",title:"Bulgarian / \u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438"},{code:"cs",title:"Czech / \u010ce\u0161tina"},{code:"de",title:"German / Deutsch"},{code:"el",title:"Greek / \u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ae"},{code:"en",title:"English"},{code:"es",title:"Spanish / Espa\xf1ol"},{code:"et",title:"Estonian / Eesti"},{code:"fi",title:"Finnish / Suomi"},{code:"fr",title:"French / Fran\xe7ais"},{code:"fy",title:"West Frisian / Frysk"},{code:"hu",title:"Hungarian / Magyar"},{code:"it",title:"Italian / Italiano"},{code:"ja",title:"Japanese / \u65e5\u672c\u8a9e"},{code:"lt",title:"Lithuanian / Lietuvi\u0173"},{code:"nl",title:"Dutch / Nederlands"},{code:"pt",title:"Portuguese / portugu\xeas"},{code:"ru",title:"Russian / P\u0443\u0441\u0441\u043a\u0438\u0439"},{code:"sk",title:"Slovak / Sloven\u010dina"},{code:"tr",title:"Turkish / T\xfcrk\xe7e"},{code:"zh",title:"Chinese / \u4e2d\u56fd\u7684"}]}setLanguage(et){(null==et||""==et)&&(et="en"),this.logging.log("Changing language: "+et),this.translateService.use(et)}initAppManager(){this.initAuthFromStorage(),this.isUserAuthenticated(!0)&&this.enableSubmissionQueue&&null!=this.submissionQueue&&this.submissionQueue.hasPendingItems()&&this.submissionQueue.processNextQueueItem()}initAuthFromStorage(){let et=localStorage.getItem("authResponse");if(null!=et){let Be=JSON.parse(et);null!=Be.Data&&null!=Be.Data.access_token&&(this.jwtHelper.decodeToken(Be.Data.access_token),this.jwtHelper.isTokenExpired(Be.Data.access_token)?localStorage.removeItem("authResponse"):(this.api.authResponse=Be,this.logging.log("User has valid auth token in local storage",d.i.VERBOSE)))}}isUserAuthenticated(et=!1){return!1===et&&null!=this._isUserAuthenticated||(this._isUserAuthenticated=!1,null!=this.api.authResponse&&(this.jwtHelper.isTokenExpired(this.api.authResponse.Data.access_token)||(this._isUserAuthenticated=!0))),this._isUserAuthenticated}getCurrentAuthToken(){return null!=this.api.authResponse?this.api.authResponse.Data.access_token:null}getUserProfile(){return null!=this.api.authResponse?this.api.authResponse.Data.UserProfile:null}signOutCurrentUser(){localStorage.removeItem("authResponse"),this.api.authResponse=null,this._isUserAuthenticated=!1}submitComment(et){if(!this.enableSubmissionQueue)return this.api.performSubmission(j.q.Comment,et);this.submissionQueue.add(j.q.Comment,et),this.submissionQueue.processNextQueueItem()}submitMediaItem(et){if(!this.enableSubmissionQueue)return this.api.performSubmission(j.q.Media,et);this.submissionQueue.add(j.q.Media,et),this.submissionQueue.processNextQueueItem()}submitPOI(et){if(!this.enableSubmissionQueue)return this.api.performSubmission(j.q.POI,et);this.submissionQueue.add(j.q.POI,et),this.submissionQueue.processNextQueueItem()}showToastNotification(et){var Be=this;return(0,b.Z)(function*(){yield(yield Be.toastController.create({message:et,duration:3e3})).present()})()}showLoadingProgress(et){var Be=this;return(0,b.Z)(function*(){yield(yield Be.loadingController.create({message:et})).present()})()}dismissLoadingProgress(){var et=this;return(0,b.Z)(function*(){return et.loadingController.dismiss()})()}launchOCMWebPage(et){this.isUserAuthenticated(!0)&&(-1===et.indexOf("?")&&(et+="?"),et+="&auth="+this.getCurrentAuthToken()),et="https://openchargemap.org/site"+et,window.open(et,"_system")}launchWebPage(et){window.open(et,"_system")}isPlatform(et){return this.platform.is(et)}}return ze.\u0275fac=function(et){return new(et||ze)(Y.LFG(se.eN),Y.LFG(ue.z),Y.LFG(pe.l),Y.LFG(xe),Y.LFG(Ee.t4),Y.LFG(g.W),Y.LFG(ne.i),Y.LFG(We.sK),Y.LFG(Ee.yF),Y.LFG(Ee.HT),Y.LFG(be.N0),Y.LFG(d.z),Y.LFG(ge.c))},ze.\u0275prov=Y.Yz7({token:ze,factory:ze.\u0275fac,providedIn:"root"}),ze})()},6260:(An,vt,k)=>{"use strict";k.d(vt,{z:()=>d});var b=k(6738);let d=(()=>{class pe{constructor(){this.c=new Map}subscribe(J,...j){let g=this.c.get(J);g||this.c.set(J,g=[]),g.push(...j)}unsubscribe(J,j){if(!j)return this.c.delete(J);const g=this.c.get(J);if(!g)return!1;const ne=g.indexOf(j);return!(ne<0||(g.splice(ne,1),0===g.length&&this.c.delete(J),0))}publish(J,...j){const g=this.c.get(J);return g?g.map(ne=>{try{return ne(...j)}catch(ge){return console.error(ge),null}}):null}}return pe.\u0275fac=function(J){return new(J||pe)},pe.\u0275prov=b.Yz7({token:pe,factory:pe.\u0275fac,providedIn:"root"}),pe})()},3912:(An,vt,k)=>{"use strict";k.d(vt,{i:()=>ne});var b=k(7689),d=k(7814),pe=k(9698),l=k(2206),J=k(129),j=k(4120),g=k(6738);let ne=(()=>{class ge{constructor(Y,se,ue){this.api=Y,this.poiManager=se,this.logging=ue,this.journeys=[],this.favourites=[]}loadJourneys(){let Y=localStorage.getItem("journeys");if(null!=Y&&(this.journeys=JSON.parse(Y)),null!=this.journeys)for(let se of this.journeys)this.fetchAllJourneyPOIDetails(se)}fetchAllJourneyPOIDetails(Y){this.logging.log("Journeys - fetching poi details for Journey "+Y.Title);let se=new l.b;se.poiIdList=[];for(let ue of Y.Stages)for(let ye of ue.WayPoints)for(let xe of ye.PoiIDs)se.poiIdList.push(xe);this.api.fetchPOIListByParam(se).then(ue=>{for(let ye of ue)this.updateStoredPOI(ye)})}updateStoredPOI(Y){if(this.journeys.forEach(se=>{se.Stages.forEach(ue=>{ue.WayPoints.forEach(ye=>{ye.PoiIDs.forEach(xe=>{if(xe==Y.ID)if(null==ye.PoiList){ye.PoiList=[];let Ee=new J.Qp("charging",1);Ee.Poi=Y,Ee.PoiID=Y.ID,ye.PoiList.push(Ee)}else for(let Ee of ye.PoiList)Ee.PoiID==Y.ID&&(Ee.Poi=Y)})})})}),null!=this.favourites)for(let se of this.favourites)"charging"==se.Type&&se.PoiID==Y.ID&&(se.Poi=Y)}saveJourneys(){let Y=JSON.parse(JSON.stringify(this.journeys));for(let ue of Y)for(const ye of ue.Stages)for(let xe of ye.WayPoints)for(let Ee of xe.PoiList)Ee.Poi=null,Ee.Photos=null;const se=JSON.stringify(Y);localStorage.setItem("journeys",se)}addJourney(Y,se){let ue=new J.vw;ue.Title="Stage 1",null!=se&&ue.WayPoints.push(se),Y.Stages.push(ue),this.journeys.push(Y)}deleteJourney(Y){this.journeys=this.journeys.filter(se=>se.ID!=Y),this.saveJourneys()}getJourney(Y){let se=this.journeys.filter(ue=>ue.ID==Y);return se.length>0?se[0]:null}getJourneyStages(Y){return this.getJourney(Y).Stages}addJourneyWaypoint(Y,se,ue){let ye=this.getJourney(Y);if(null==se){let xe=new J.vw;xe.Title="Stage "+(ye.Stages.length+1),xe.WayPoints.push(ue),ye.Stages.push(xe)}else{let xe=ye.Stages[se];null==xe.WayPoints&&(xe.WayPoints=[]),xe.WayPoints.push(ue)}}addJourneyStage(Y,se){return this.getJourney(Y).Stages.push(se)-1}setupTestJourneys(){this.journeys=[];let Y=new J.fw;Y.Title="New York to Brooklyn",Y.Notes="A little jaunt to Brooklyn",Y.Stages=[];let se=new J.vw,ue=new J.kA;ue.Notes="Starting point",ue.Position=new j.wC(40,1.2),ue.Title="Start",se.WayPoints.push(ue);let ye=new J.kA;ye.Notes="Middle point",ye.Position=new j.wC(40,1.33),ye.Title="Middle",se.WayPoints.push(ye);let xe=new J.kA;xe.Notes="End point",xe.Position=new j.wC(40,1.33),xe.Title="End",se.WayPoints.push(xe),Y.Stages.push(se),this.journeys.push(Y);let Ee=new J.fw;Ee.Title="Aberdeen to London",Ee.Notes="Roadtrip",Ee.Stages=[],this.journeys.push(Ee)}calculateEnergyConsumptionkWh(Y,se,ue=0,ye){return Y*ye}setRoutePolyline(Y){this.routePolyline=Y}getRoutePolyline(){return this.routePolyline}}return ge.\u0275fac=function(Y){return new(Y||ge)(g.LFG(d.l),g.LFG(pe.R),g.LFG(b.z))},ge.\u0275prov=g.Yz7({token:ge,factory:ge.\u0275fac,providedIn:"root"}),ge})()},7689:(An,vt,k)=>{"use strict";k.d(vt,{i:()=>pe,z:()=>l});var b=k(2340),d=k(6738),pe=(()=>{return(J=pe||(pe={}))[J.VERBOSE=0]="VERBOSE",J[J.INFO=1]="INFO",J[J.WARNING=2]="WARNING",J[J.ERROR=3]="ERROR",pe;var J})();let l=(()=>{class J{constructor(){this.logLevel=pe.VERBOSE,b.N.production&&(this.logLevel=pe.INFO)}log(g,ne=pe.VERBOSE){console&&console.log&&ne>=this.logLevel&&console.log("["+pe[ne]+"] {"+(new Date).toLocaleTimeString()+"} "+g)}}return J.\u0275fac=function(g){return new(g||J)},J.\u0275prov=d.Yz7({token:J,factory:J.\u0275fac,providedIn:"root"}),J})()},9698:(An,vt,k)=>{"use strict";k.d(vt,{R:()=>g});var b=k(6099),d=k(7689),pe=k(7814),l=k(56),J=k(6738),j=k(6260);let g=(()=>{class ne{constructor(Q,Y,se,ue){this.api=Q,this.events=Y,this.logging=se,this.analytics=ue,this.isRequestInProgress=!1}refreshPOIList(Q){var Y=this;return(0,b.Z)(function*(){try{return Y.poiList=yield Y.fetchPOIList(Q),Y.events.publish("ocm:poiList:updated"),Y.analytics.appEvent("Search","Fetched Results"),Y.poiList.length}catch{return 0}})()}fetchPOIList(Q){var Y=this;return(0,b.Z)(function*(){Y.isRequestInProgress=!0;try{let se=yield Y.api.fetchPOIListByParam(Q);return Y.isRequestInProgress=!1,se&&se.length&&Y.logging.log("fetched POI list ["+se.length+"]"),se}catch{return Y.isRequestInProgress=!1,[]}})()}clearResults(){this.poiList=[],this.events.publish("ocm:poiList:cleared"),this.logging.log("clearing results after settings change",d.i.VERBOSE)}getPOIById(Q,Y=!1,se=!1){var ue=this;return(0,b.Z)(function*(){if(!se&&null!=ue.poiList){const Ee=ue.poiList.find(We=>We.ID==Q);if(Ee)return Ee}const ye={poiIdList:[Q],enableCaching:!se,includeComments:!0},xe=yield ue.api.fetchPOIListByParam(ye);return xe&&xe.length>0?(ue.poiList&&xe[0].ID==Q&&(ue.poiList=ue.poiList.filter(Ee=>Ee.ID!=Q),ue.poiList.push(xe[0]),ue.logging.log("POI refreshed in cache "+Q)),xe[0]):null})()}}return ne.\u0275fac=function(Q){return new(Q||ne)(J.LFG(pe.l),J.LFG(j.z),J.LFG(d.z),J.LFG(l.c))},ne.\u0275prov=J.Yz7({token:ne,factory:ne.\u0275fac,providedIn:"root"}),ne})()},6799:(An,vt,k)=>{"use strict";k.d(vt,{W:()=>J});var b=k(6099),d=k(7689),pe=k(6738),l=k(529);let J=(()=>{class j{constructor(ne,ge){this.http=ne,this.logging=ge,this.loadCachedRefData()}refreshReferenceData(ne){var ge=this;return(0,b.Z)(function*(){try{const Q=yield ne.fetchCoreReferenceData(null).toPromise();return ge.setCoreReferenceData(Q),ge.setFilteredReferenceData(Q),ge.logging.log("Got refreshed core ref data.",d.i.VERBOSE),ge.sortCoreReferenceData(),ge.cacheCurrentRefData(),!0}catch(Q){return ge.logging.log("Error fetching core ref data:"+Q),!1}})()}refreshFilteredReferenceData(ne,ge){ne.fetchCoreReferenceData(ge).subscribe(Q=>{this.setFilteredReferenceData(Q),this.sortCoreReferenceData(),this.logging.log("Got refreshed filtered reference data.",d.i.VERBOSE)},Q=>{this.logging.log("Error fetching filtered reference data:"+Q)})}setCoreReferenceData(ne){this.referenceData=ne}setFilteredReferenceData(ne){this.filteredReferenceData=ne}referenceDataLoaded(){return null!=this.referenceData}getCountries(ne=!1){return 1==ne?this.filteredReferenceData.Countries:this.referenceData.Countries}getCountryByID(ne){return this.getRefDataByID(this.referenceData.Countries,ne)}getConnectionTypes(ne=!1){return 1==ne?this.filteredReferenceData.ConnectionTypes:this.referenceData.ConnectionTypes}getConnectionTypeByID(ne){return this.getRefDataByID(this.referenceData.ConnectionTypes,ne)}getUsageTypes(ne=!1){return 1==ne?this.filteredReferenceData.UsageTypes:this.referenceData.UsageTypes.filter(ge=>ge.ID>0)}getUsageTypeByID(ne){return this.getRefDataByID(this.referenceData.UsageTypes,ne)}getStatusTypes(ne=!1){return 1==ne?this.filteredReferenceData.StatusTypes:this.referenceData.StatusTypes.filter(ge=>ge.ID>0)}getStatusTypeByID(ne){return this.getRefDataByID(this.referenceData.StatusTypes,ne)}getNetworkOperators(ne=!1){return 1==ne?this.filteredReferenceData.Operators:this.referenceData.Operators}getNetworkOperatorByID(ne){return this.getRefDataByID(this.referenceData.Operators,ne)}getDataProviders(ne=!1){return 1==ne?this.filteredReferenceData.DataProviders:this.referenceData.DataProviders}getDataProviderByID(ne){return this.getRefDataByID(this.referenceData.DataProviders,ne)}getCheckinStatusTypes(ne=!1,ge=!0){let Q=null;return Q=1==ne?this.filteredReferenceData.CheckinStatusTypes:this.referenceData.CheckinStatusTypes,ge&&(Q=Q.filter(Y=>!1===Y.IsAutomatedCheckin)),Q}getCheckinStatusTypeByID(ne){return this.getRefDataByID(this.referenceData.CheckinStatusTypes,ne)}getCommentTypes(ne=!1,ge=!0){let Q;return Q=1==ne?this.filteredReferenceData.UserCommentTypes:this.referenceData.UserCommentTypes,ge&&(Q=Q.filter(Y=>100!==Y.ID&&110!==Y.ID)),Q}getCommentTypeByID(ne){return this.getRefDataByID(this.referenceData.UserCommentTypes,ne)}getSubmissionStatusTypes(ne=!1){return 1==ne?this.filteredReferenceData.SubmissionStatusTypes:this.referenceData.SubmissionStatusTypes}getSubmissionStatusTypesByID(ne){return this.getRefDataByID(this.referenceData.SubmissionStatusTypes,ne)}getChargingLevelTypes(ne=!1){return 1==ne?this.filteredReferenceData.ChargerTypes:this.referenceData.ChargerTypes}getChargingLevelTypeByID(ne){return this.getRefDataByID(this.referenceData.ChargerTypes,ne)}getOutputCurrentTypes(ne=!1){return ne?this.referenceData.CurrentTypes:this.filteredReferenceData.CurrentTypes}getOutputCurrentTypeByID(ne){return this.getRefDataByID(this.referenceData.CurrentTypes,ne)}loadCachedRefData(){const ne=localStorage.getItem("referenceData");if(null==ne)this.http.get("./assets/data/CoreReferenceData.json").subscribe(ge=>{this.logging.log("Using bundled reference data as cached ref data."),this.setCoreReferenceData(ge),this.setFilteredReferenceData(ge)});else{let ge=JSON.parse(ne);this.setCoreReferenceData(ge)}this.setFilteredReferenceData(this.referenceData)}cacheCurrentRefData(){null!=this.referenceData&&(this.referenceData.CacheDate=new Date,localStorage.setItem("referenceData",JSON.stringify(this.referenceData)))}getRefDataByID(ne,ge){if(""!==ge&&(ge=parseInt(ge,10)),null!=ne)for(let Q=0;Q<ne.length;Q++)if(ne[Q].ID===ge)return ne[Q];return null}sortCoreReferenceData(){this.sortReferenceData(this.referenceData.ConnectionTypes),this.sortReferenceData(this.referenceData.Countries),this.sortReferenceData(this.referenceData.Operators),this.sortReferenceData(this.referenceData.DataProviders),this.sortReferenceData(this.referenceData.UsageTypes),this.sortReferenceData(this.referenceData.StatusTypes),this.sortReferenceData(this.referenceData.CheckinStatusTypes),this.sortReferenceData(this.referenceData.SubmissionStatusTypes),this.filteredReferenceData&&(this.sortReferenceData(this.filteredReferenceData.ConnectionTypes),this.sortReferenceData(this.filteredReferenceData.Operators))}sortReferenceData(ne){ne.sort(this.sortListByTitle)}sortListByTitle(ne,ge){return ne.Title<ge.Title?-1:ne.Title>ge.Title?1:0}getMetadataValueByMetadataFieldID(ne,ge){if(""!==ge&&(ge=parseInt(ge,10)),null!=ne)for(let Q=0;Q<ne.length;Q++)if(ne[Q].ID===ge)return ne[Q];return null}hydrateCompactPOI(ne,ge=!1){const Q=this;if(null!=ne.DataProviderID&&(ge||null==ne.DataProvider)&&(ne.DataProvider=Q.getDataProviderByID(ne.DataProviderID)),null!=ne.OperatorID&&(ge||null==ne.OperatorInfo)&&(ne.OperatorInfo=Q.getNetworkOperatorByID(ne.OperatorID)),null!=ne.UsageTypeID&&(ge||null==ne.UsageType)&&(ne.UsageType=Q.getUsageTypeByID(ne.UsageTypeID)),null!=ne.AddressInfo.CountryID&&(ge||null==ne.AddressInfo.Country)&&(ne.AddressInfo.Country=Q.getCountryByID(ne.AddressInfo.CountryID)),null!=ne.StatusTypeID&&(ge||null==ne.StatusType)&&(ne.StatusType=Q.getStatusTypeByID(ne.StatusTypeID)),null!=ne.SubmissionStatusTypeID&&(ge||null==ne.SubmissionStatusType)&&(ne.SubmissionStatusType=Q.getSubmissionStatusTypesByID(ne.SubmissionStatusTypeID)),null!=ne.Connections)for(let Y=0;Y<ne.Connections.length;Y++){const se=ne.Connections[Y];null!=se.ConnectionTypeID&&(ge||null==se.ConnectionType)&&(se.ConnectionType=Q.getConnectionTypeByID(se.ConnectionTypeID)),null!=se.LevelID&&(ge||null==se.Level)&&(se.Level=Q.getChargingLevelTypeByID(se.LevelID)),null!=se.CurrentTypeID&&(ge||null==se.CurrentType)&&(se.CurrentType=Q.getOutputCurrentTypeByID(se.CurrentTypeID)),null!=se.StatusTypeID&&(ge||null==se.StatusType)&&(se.StatusType=Q.getStatusTypeByID(se.StatusTypeID)),ne.Connections[Y]=se}if(null!=ne.UserComments)for(let Y=0;Y<ne.UserComments.length;Y++){const se=ne.UserComments[Y];null!=se.CommentTypeID&&(ge||null==se.CommentType)&&(se.CommentType=Q.getCommentTypeByID(se.CommentTypeID)),null!=se.CheckinStatusTypeID&&(ge||null==se.CheckinStatusType)&&(se.CheckinStatusType=Q.getCheckinStatusTypeByID(se.CheckinStatusTypeID)),ne.UserComments[Y]=se}return ne}hydrateCompactPOIList(ne){for(let ge=0;ge<ne.length;ge++)ne[ge]=this.hydrateCompactPOI(ne[ge]);return ne}}return j.\u0275fac=function(ne){return new(ne||j)(pe.LFG(l.eN),pe.LFG(d.z))},j.\u0275prov=pe.Yz7({token:j,factory:j.\u0275fac,providedIn:"root"}),j})()},4781:(An,vt,k)=>{"use strict";k.d(vt,{v:()=>Ee});var b=k(553),d=k(5906),pe=k(6579),l=k(7689),J=k(6099),j=k(2916),g=k(4120),ne=k(2340),ge=k(4209);class Q{constructor(be,Se){this.events=be,this.logging=Se,this.events=be,this.mapAPIType=d.b.MAPKIT_JS,this.mapReady=!1,this.markerList=new Map,this.mapkitUtils=new Y}initAPI(){mapkit&&mapkit.init({authorizationCallback:function(be){be(ne.N.mapKitToken)}})}disposeMap(){}initMap(be,Se,ze){this.mapCanvasID=be;let tt=!0;if(tt="undefined"!=typeof mapkit,!tt)return this.logging.log("Call to initMap before API is ready:"+d.b[this.mapAPIType],l.i.ERROR),this.mapReady=!1,!1;this.initAPI(),null==this.map&&(document.getElementById(be),this.map=new mapkit.Map(be),this.map.annotationForCluster=function(Be){"poi"===Be.clusteringIdentifier&&(Be.title="Charging Location",Be.subtitle=Be.memberAnnotations.reduce((C,Ge)=>C+Ge.population,0))},this.mapReady=!0,mapkit.addEventListener("configuration-change",Be=>{this.events.publish("ocm:mapping:ready")}),this.map.addEventListener("scroll-end",Be=>{this.events.publish("ocm:mapping:dragend")}),this.map.addEventListener("zoom-end",Be=>{this.events.publish("ocm:mapping:zoom")}))}clearMarkers(){null!=this.markerList&&this.markerList.forEach((be,Se)=>{try{this.map.removeAnnotation(Se)}catch{}}),this.markerList=new Map}showPOIListOnMap(be,Se){let Be=0,Ge=0==this.markerList.size;if(null!=be){let ht=[];for(let wt=0;wt<be.length;wt++)if(null!=be[wt].AddressInfo&&null!=be[wt].AddressInfo.Latitude&&null!=be[wt].AddressInfo.Longitude){let xt=be[wt],gt=!0;if(null!=this.markerList&&this.markerList.has(xt.ID)&&(gt=!1),gt){let Bt=null;Bt=pe.c.getIconForPOI(xt);let jt="OCM-"+xt.ID+": "+xt.AddressInfo.Title+":";null!=xt.UsageType&&(jt+=" "+xt.UsageType.Title),null!=xt.StatusType&&(jt+=" "+xt.StatusType.Title);const Ut=new mapkit.Coordinate(xt.AddressInfo.Latitude,xt.AddressInfo.Longitude);let Yt=new mapkit.ImageAnnotation(Ut,{title:jt,size:{width:34,height:50},url:{1:Bt},clusteringIdentifier:"poi"});Yt.poi=xt,Yt.addEventListener("select",zt=>{const Zt=zt.target.poi;this.events.publish("ocm:poi:selected",{poi:Zt,poiId:Zt.ID})}),this.markerList.set(xt.ID,Yt),ht.push(Yt),Be++}}ht.length>0&&(this.map.addAnnotations(ht),Ge&&this.map.showItems(ht,{animate:!0,padding:new mapkit.Padding(60,25,60,25)})),this.logging.log(Be+" new map markers added out of a total "+this.markerList.size)}}refreshMapLayout(){null!=this.map&&setTimeout(()=>{this.logging.log("MapKit: refreshMapLayout",l.i.VERBOSE)},200)}setMapCenter(be,Se){this.map&&(this.map.setCenterAnimated(new mapkit.Coordinate(be.coords.latitude,be.coords.longitude),!1),Se&&this.setMapZoom(Se))}getMapCenter(){return new j.y(Se=>{if(null!=this.map){let ze=this.map.center;null!=ze&&(Se.next(new g.jR(ze.latitude,ze.longitude)),Se.complete())}})}setMapZoom(be){const Se=Math.min(be,28),ze=this.mapkitUtils.deltaFromZoomLevel(this.map,this.map.center,Math.round(Se)),tt=new mapkit.CoordinateSpan(111*ze.latitudeDelta,111*ze.longitudeDelta),et=new mapkit.CoordinateRegion(this.map.center,tt);this.map.setRegionAnimated(et)}getMapZoom(){return new j.y(Se=>{this.logging.log("MapKit: getMapZoom not supported",l.i.VERBOSE),Se.next(this.map._impl.zoomLevel),Se.complete()})}setMapType(be){this.logging.log("MapKit: skipped setting Map Type :"+be)}getMapBounds(){return new j.y(Se=>{let ze=new Array,tt=this.map.region.toBoundingRegion();ze.push(new g.wC(tt.southLatitude,tt.westLongitude)),ze.push(new g.wC(tt.northLatitude,tt.eastLongitude)),Se.next(ze),Se.complete()})}moveToMapBounds(be){this.logging.log("MapKit: map bounds not implemented")}renderMap(be,Se,ze){return document.getElementById(this.mapCanvasID).style.height=Se+"px",this.mapReady&&this.showPOIListOnMap(be,ze),!0}renderPolyline(be){this.clearPolyline()}clearPolyline(){null!=this.polylinePath&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(be){return(0,J.Z)(function*(){let Se=new mapkit.Search({getsUserLocation:!0});return new Promise(function(){var ze=(0,J.Z)(function*(tt,et){let Be=[];Se.search(be,function(){var C=(0,J.Z)(function*(Ge,_t){Ge&&et(Ge),Be=[],_t.places.map(ht=>{let wt=new ge.n;wt.Title=ht.name,wt.Address=ht.formattedAddress,wt.Type="place",wt.Location=new g.wC(ht.coordinate.latitude,ht.coordinate.longitude),Be.push(wt)}),tt(Be)});return function(Ge,_t){return C.apply(this,arguments)}}())});return function(tt,et){return ze.apply(this,arguments)}}())})()}addPOILayer(be){this.logging.log("Add POI Layer not implemented in this provider.")}}class Y{constructor(){this.mercatorRadius=85445659.44705395,this.mercatorOffset=268435456}longitudeToPixelSpaceX(be){return Math.round(this.mercatorOffset+this.mercatorRadius*be*Math.PI/180)}latitudeToPixelSpaceY(be){return Math.round(this.mercatorOffset-this.mercatorRadius*Math.log((1+Math.sin(be*Math.PI/180))/(1-Math.sin(be*Math.PI/180)))/2)}pixelSpaceXToLongitude(be){return(Math.round(be)-this.mercatorOffset)/this.mercatorRadius*180/Math.PI}pixelSpaceYToLatitude(be){return 180*(Math.PI/2-2*Math.atan(Math.exp((Math.round(be)-this.mercatorOffset)/this.mercatorRadius)))/Math.PI}deltaFromZoomLevel(be,Se,ze){let tt=this.longitudeToPixelSpaceX(Se.longitude),et=this.latitudeToPixelSpaceY(Se.latitude),C=Math.pow(2,20-ze),Ge=be.visibleMapRect.size,_t=Ge.width*C,ht=Ge.height*C,wt=tt-_t/2,xt=et-ht/2,gt=this.pixelSpaceXToLongitude(wt),Ht=this.pixelSpaceXToLongitude(wt+_t)-gt,Gn=this.pixelSpaceYToLatitude(xt);return{latitudeDelta:-1*(this.pixelSpaceYToLatitude(xt+ht)-Gn),longitudeDelta:Ht}}}var se=k(6738),ue=k(6260),ye=k(529);let xe=(()=>{class We extends b.k{constructor(Se,ze,tt){super(Se,ze,tt),this.mapAPIType=d.b.MAPTILER,this.mapTileSet="https://maps.tilehosting.com/styles/streets/style.json?key=Gs9z7krALe3CGI60d5cL"}initAPI(){}}return We.\u0275fac=function(Se){return new(Se||We)(se.LFG(ue.z),se.LFG(l.z),se.LFG(ye.eN))},We.\u0275prov=se.Yz7({token:We,factory:We.\u0275fac}),We})(),Ee=(()=>{class We{constructor(Se,ze,tt){this.logging=ze,this.http=tt,this.isFocused=!1,this.events=Se,this.mapOptions=new d._,this.mapAPIReady=!1,this.mapsInitialised=!1,this.setMapAPI(this.mapOptions.mapAPI);let et=this;this.debouncedMapPositionUpdate=pe.c.debounce(()=>{this.logging.log("signaling map position change:"),et.mapProvider.mapReady&&et.getMapCenter().subscribe(Be=>{null!=Be?(this.logging.log("Map centre/zoom changed, updating search position:"+Be),this.updateMapCentrePos(Be.coords.latitude,Be.coords.longitude,!1)):this.logging.log("Map centre/zoom changed - map not ready to change centre pos:")})},300,!1)}setParentAppContext(Se){this.parentAppContext=Se}setMapAPI(Se){this.mapOptions.mapAPI=Se,this.mapOptions.mapAPI==d.b.MAPBOX&&(this.mapProvider=new b.k(this.events,this.logging,this.http)),this.mapOptions.mapAPI==d.b.MAPKIT_JS&&(this.mapProvider=new Q(this.events,this.logging)),this.mapOptions.mapAPI==d.b.MAPTILER&&(this.mapProvider=new xe(this.events,this.logging,this.http))}isMapReady(){return null!=this.mapProvider&&this.mapProvider.mapReady}externalAPILoaded(Se){this.mapAPIReady=!0,this.logging.log("Mapping API Loaded: "+d.b[Se])}initMap(Se){if(!this.isMapReady())if(null!=this.mapProvider)this.mapsInitialised&&this.logging.log("initMap: Map provider already initialised"),this.logging.log("Mapping Manager: Init "+d.b[this.mapProvider.mapAPIType]),this.mapProvider.initMap(Se,this.mapOptions,this);else{if(this.mapsInitialised)return void this.logging.log("initMap: map already initialised");this.logging.log("initMap: "+this.mapOptions.mapAPI)}}mapManipulationPerformed(Se){this.logging.log("map manipulated:"+Se),("drag"==Se||"zoom"==Se)&&this.debouncedMapPositionUpdate()}updateMapSize(){this.mapProvider&&this.mapProvider.refreshMapLayout()}updateMapCentrePos(Se,ze,tt,et){tt&&null!=this.mapProvider&&this.mapProvider.setMapCenter(new g.jR(Se,ze),et),this.mapOptions.mapCentre=new g.jR(Se,ze)}moveToMapBounds(Se){this.mapProvider.moveToMapBounds(Se)}refreshMapView(Se,ze,tt){return null!=this.mapProvider?(this.logging.log("Mapping Manager: renderMap "+d.b[this.mapProvider.mapAPIType]),this.isMapReady()?this.mapProvider.renderMap(ze,Se,this.parentAppContext):this.logging.log("refreshMapView: map provider not initialised..")):this.logging.log("Unsupported Map API: refreshMapView",l.i.ERROR),!0}setMapType(Se){this.mapOptions.mapType!=Se&&(this.mapOptions.mapType=Se,this.isMapReady()&&null!=this.mapProvider?(this.logging.log("Changing map type:"+Se),this.mapProvider.setMapType(Se)):this.logging.log("Map type set, maps not initialised yet."))}unfocusMap(){this.logging.log("[mapping] Unfocus Map."),this.isFocused=!1,this.mapProvider.unfocusMap()}focusMap(){this.logging.log("[mapping] Focus Map."),this.isFocused=!0,this.mapProvider.focusMap()}getMapBounds(){return this.mapProvider.getMapBounds()}getMapZoom(){return this.mapProvider.getMapZoom()}setMapZoom(Se){this.mapProvider.setMapZoom(Se)}getMapCenter(){return this.mapProvider.getMapCenter()}showPOIOnStaticMap(Se,ze,tt=!1,et=!1,Be=200,C=200){let Ge=document.getElementById(Se);if(null!=Ge){let ht=ze.AddressInfo.Latitude,wt=ze.AddressInfo.Longitude;Be>640&&(Be=640),C>640&&(C=640);let xt=Be,gt=C,Bt="https://maps.googleapis.com/maps/api/staticmap?center="+ht+","+wt+"&zoom=14&size="+xt+"x"+gt+"&maptype=roadmap&markers=color:blue%7Clabel:A%7C"+ht+","+wt+"&sensor=false",Ht="";Ht+=1==tt?"<div>"+pe.c.formatMapLink(ze,'<div><img width="'+xt+'" height="'+gt+'" src="'+Bt+'" /></div>',et)+"</div>":'<div><img width="'+xt+'" height="'+gt+'" src="'+Bt+'" /></div>',Ge.innerHTML=Ht}}renderPolyline(Se){this.mapProvider.renderPolyline(Se)}clearPolyline(){this.mapProvider.clearPolyline()}clearMarkers(){this.logging.log("mapping: clearing markers"),this.mapProvider.clearMarkers()}addPOILayer(Se){this.mapProvider.addPOILayer(Se)}}return We.\u0275fac=function(Se){return new(Se||We)(se.LFG(ue.z),se.LFG(l.z),se.LFG(ye.eN))},We.\u0275prov=se.Yz7({token:We,factory:We.\u0275fac,providedIn:"root"}),We})()},5906:(An,vt,k)=>{"use strict";k.d(vt,{b:()=>d,_:()=>pe});var b=k(2340),d=(()=>{return(l=d||(d={}))[l.GOOGLE_WEB=1]="GOOGLE_WEB",l[l.GOOGLE_NATIVE=2]="GOOGLE_NATIVE",l[l.LEAFLET=3]="LEAFLET",l[l.MAPBOX=4]="MAPBOX",l[l.MAPKIT_JS=5]="MAPKIT_JS",l[l.MAPTILER=6]="MAPTILER",d;var l})();class pe{constructor(){this.enableClustering=!1,this.resultBatchID=-1,this.useMarkerIcons=!0,this.useMarkerAnimation=!0,this.enableTrackingMapCentre=!1,this.enableSearchByWatchingLocation=!1,this.mapCentre=null,this.mapAPI=b.N.defaultMapProvider,this.mapType="ROADMAP",this.searchDistanceKM=1e5,this.mapMoveQueryRefreshMS=300,this.enableSearchRadiusIndicator=!1,this.minZoomLevel=2}}},553:(An,vt,k)=>{"use strict";k.d(vt,{k:()=>xe});var b=k(6099),d=k(6579),pe=k(5906),l=k(2916),J=k(4120),j=k(7689),g=k(9898),ge=k(2340),Q=k(4209),Y=k(6738),se=k(6260),ue=k(529);let xe=(()=>{class Ee{constructor(be,Se,ze){this.events=be,this.logging=Se,this.http=ze,this._isMapAnimating=!1,this.events=be,this.mapAPIType=pe.b.MAPBOX,this.mapReady=!1,this.markerList=new Map}initAPI(){g&&(g.accessToken=ge.N.mapBoxToken)}disposeMap(){this.map&&(this.logging.log("Disposing map",j.i.INFO),this.map.remove())}getCurrentMapTileSet(be){return"SATELLITE"==be?"mapbox://styles/mapbox/satellite-streets-v11?optimize=true":"mapbox://styles/mapbox/streets-v11?optimize=true"}flyAroundPoint(be){if(this._isMapAnimating){this.map.rotateTo(be/100%360,{duration:0});const Se=this;requestAnimationFrame(function(ze){Se.flyAroundPoint(ze)})}}initMap(be,Se,ze){this.mapCanvasID=be;let tt=!0;if(tt=void 0!==g,!tt)return this.logging.log("Call to initMap before API is ready:"+pe.b[this.mapAPIType],j.i.ERROR),this.mapReady=!1,!1;if(null==this.map){let Ge=function(ht){return ht*(2-ht)};document.getElementById(be),this.initAPI(),this.map=new g.Map({container:be,style:this.getCurrentMapTileSet(Se.mapType),zoom:15,attributionControl:!1}),this.map.addControl(new g.AttributionControl({compact:!0,customAttribution:["Open Charge Map Contributors"]})),this.map.addControl(new g.NavigationControl),this.mapReady=!0,this.map.getCanvas().focus();let Be=100,C=25;this.map.getCanvas().addEventListener("keydown",ht=>{ht.preventDefault(),38===ht.which?this.map.panBy([0,-Be],{easing:Ge}):40===ht.which?this.map.panBy([0,Be],{easing:Ge}):37===ht.which?this.map.easeTo({bearing:this.map.getBearing()-C,easing:Ge}):39===ht.which?this.map.easeTo({bearing:this.map.getBearing()+C,easing:Ge}):32===ht.which&&(this._isMapAnimating?this._isMapAnimating=!1:(this._isMapAnimating=!0,this.flyAroundPoint(0)))},!0),this.map.on("load",()=>{this.events.publish("ocm:mapping:ready")});let _t=d.c.debounce(()=>{this.getMapCenter().subscribe(ht=>{this.searchMarker.setLngLat(new g.LngLat(ht.coords.longitude,ht.coords.latitude))})},500,!1);this.map.on("move",()=>{this.searchMarker&&_t()}),this.map.on("moveend",()=>{this.events.publish("ocm:mapping:dragend"),Se.onMapMoveCompleted&&Se.onMapMoveCompleted()}),this.map.on("zoomend",()=>{this.events.publish("ocm:mapping:zoom")})}}clearMarkers(){null!=this.markerList&&this.markerList.forEach((be,Se)=>{be.remove()}),this.markerList=new Map}showPOIListOnMap(be,Se,ze=!0){let et=this.map,Be=new g.LngLatBounds,C=0;if(et.getZoom(),null!=be){for(let xt=0;xt<be.length;xt++)if(null!=be[xt].AddressInfo&&null!=be[xt].AddressInfo.Latitude&&null!=be[xt].AddressInfo.Longitude){let gt=be[xt],Bt=!0;if(null!=this.markerList&&this.markerList.has(gt.ID)){Bt=!1;let Ht=this.markerList.get(gt.ID);Ht&&Ht.poi&&Ht.poi.DateLastStatusUpdate!=gt.DateLastStatusUpdate&&(Ht.remove(),Bt=!0)}if(Bt){let Ht=null,Gn=null;ze?(Ht=document.createElement("img"),Ht.src=d.c.getIconForPOI(gt),Ht.width=34,Ht.height=50):(Ht=null,Gn=d.c.getColorForPOI(gt));let jt=(ze?"OCM-":"EXT-")+gt.ID+": "+gt.AddressInfo.Title+":";null!=gt.UsageType&&(jt+=" "+gt.UsageType.Title),null!=gt.StatusType&&(jt+=" "+gt.StatusType.Title);let Ut=new g.Marker({element:Ht,color:Gn}).setLngLat([gt.AddressInfo.Longitude,gt.AddressInfo.Latitude]).addTo(et);Ut.poi=gt;let Yt=Ut.getElement();Yt.poi=gt,Yt.addEventListener("click",zt=>{const Zt=zt.currentTarget.poi;this.events.publish("ocm:poi:selected",{poiId:Zt.ID,poi:Zt})}),Be.extend(Ut.getLngLat()),this.markerList.set(gt.ID,Ut),C++}}this.logging.log(C+" new map markers added out of a total "+this.markerList.size)}if(null!=be&&be.length>0)if(null==Se||Se.appConfig.enableLiveMapQuerying)null==et.getCenter()&&et.setCenter(Be.getCenter());else{this.logging.log("Fitting to marker bounds:"+Be),et.setCenter(Be.getCenter()),this.logging.log("zoom before fit bounds:"+et.getZoom()),et.fitBounds(Be);let wt=et.getZoom();et.setZoom(wt<6?6:wt)}}refreshMapLayout(){null!=this.map&&setTimeout(()=>{this.logging.log("MapBoxGL: refreshMapLayout",j.i.VERBOSE),this.map.resize()},200)}setMapCenter(be){this.mapReady&&(this.map.setCenter(new g.LngLat(be.coords.longitude,be.coords.latitude)),this.searchMarker||(this.searchMarker=new g.Marker({color:"#99ccff",anchor:"top"}).setLngLat(new g.LngLat(be.coords.longitude,be.coords.latitude)).addTo(this.map),this.searchMarker.getElement().addEventListener("click",()=>{let Se=this.searchMarker.getLngLat();this.events.publish("ocm:mapping:addpoi",new J.wC(Se.lat,Se.lng))})))}getMapCenter(){return new l.y(Se=>{if(null!=this.map){let ze=this.map.getCenter();null!=ze&&(Se.next(new J.jR(ze.lat,ze.lng)),Se.complete())}})}setMapZoom(be){this.map.setZoom(be)}getMapZoom(){return new l.y(Se=>{let ze=this.map.getZoom();Se.next(ze),Se.complete()})}setMapType(be){this.map.setStyle(this.getCurrentMapTileSet(be))}getMapBounds(){return new l.y(Se=>{let ze=new Array,tt=this.map.getBounds();ze.push(new J.wC(tt.getSouthWest().lat,tt.getSouthWest().lng)),ze.push(new J.wC(tt.getNorthEast().lat,tt.getNorthEast().lng)),Se.next(ze),Se.complete()})}moveToMapBounds(be){this.map.fitBounds(new g.LngLatBounds(new g.LngLat(be.southWest.longitude,be.southWest.latitude),new g.LngLat(be.northEast.longitude,be.northEast.latitude)))}renderMap(be,Se,ze){return document.getElementById(this.mapCanvasID).style.height=Se+"px",this.mapReady&&this.showPOIListOnMap(be,ze),!0}renderPolyline(be){this.clearPolyline()}clearPolyline(){null!=this.polylinePath&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(be,Se,ze){var tt=this;return(0,b.Z)(function*(){let et=`https://api.mapbox.com/geocoding/v5/mapbox.places/${be||ze+","+Se}.json?access_token=${ge.N.mapBoxToken}`;return new Promise(function(){var Be=(0,b.Z)(function*(C,Ge){tt.http.get(et).toPromise().then(_t=>{let ht=[];ht=[],_t.features&&_t.features.map(wt=>{let xt=new Q.n;xt.Title=wt.place_name,xt.Address=wt.place_name,xt.Type="place",xt.Location=new J.wC(wt.center[1],wt.center[0]),xt.Attribution=_t.attribution,ht.push(xt)}),C(ht)})});return function(C,Ge){return Be.apply(this,arguments)}}())})()}addPOILayer(be){this.logging.log("Add POI Layer not implemented in this provider."),this.showPOIListOnMap(be,null,!1)}}return Ee.\u0275fac=function(be){return new(be||Ee)(Y.LFG(se.z),Y.LFG(j.z),Y.LFG(ue.eN))},Ee.\u0275prov=Y.Yz7({token:Ee,factory:Ee.\u0275fac}),Ee})()},2340:(An,vt,k)=>{"use strict";k.d(vt,{N:()=>b});const b={name:"prod",version:"8.1.3",production:!0,analyticsId:"",googleMapsKey:"",mapBoxToken:"pk.eyJ1Ijoid2VicHJvZnVzaW9uIiwiYSI6ImNrdHZlc2N5dTI5Zjcydm8zYWFwc2JnbTMifQ.M7b5SOzbPcg_8XAHCOeP0w",mapKitToken:"",enableStaticMaps:!1,defaultMapProvider:4,apiBase:"https://api.openchargemap.io",apiKey:"9bb03e5b-0fb2-4916-9b2b-26c6bd27a56a",enabledFeatures:["MAP","ADD_COMMENT","ADD_PHOTO","FAVOURITES","FILTER_OPTIONS_BY_COUNTRY","ADD_POI","EDIT_POI","LAYERS"]}},3592:(An,vt,k)=>{"use strict";var b=k(6895),d=k(6738);class pe extends b.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class l extends pe{static makeCurrent(){(0,b.HT)(new l)}onAndCancel(Xe,ke,Tt){return Xe.addEventListener(ke,Tt,!1),()=>{Xe.removeEventListener(ke,Tt,!1)}}dispatchEvent(Xe,ke){Xe.dispatchEvent(ke)}remove(Xe){Xe.parentNode&&Xe.parentNode.removeChild(Xe)}createElement(Xe,ke){return(ke=ke||this.getDefaultDocument()).createElement(Xe)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(Xe){return Xe.nodeType===Node.ELEMENT_NODE}isShadowRoot(Xe){return Xe instanceof DocumentFragment}getGlobalEventTarget(Xe,ke){return"window"===ke?window:"document"===ke?Xe:"body"===ke?Xe.body:null}getBaseHref(Xe){const ke=function j(){return J=J||document.querySelector("base"),J?J.getAttribute("href"):null}();return null==ke?null:function ne(nt){g=g||document.createElement("a"),g.setAttribute("href",nt);const Xe=g.pathname;return"/"===Xe.charAt(0)?Xe:`/${Xe}`}(ke)}resetBaseElement(){J=null}getUserAgent(){return window.navigator.userAgent}getCookie(Xe){return(0,b.Mx)(document.cookie,Xe)}}let g,J=null;const ge=new d.OlP("TRANSITION_ID"),Y=[{provide:d.ip1,useFactory:function Q(nt,Xe,ke){return()=>{ke.get(d.CZH).donePromise.then(()=>{const Tt=(0,b.q)(),nn=Xe.querySelectorAll(`style[ng-transition="${nt}"]`);for(let ii=0;ii<nn.length;ii++)Tt.remove(nn[ii])})}},deps:[ge,b.K0,d.zs3],multi:!0}];class se{static init(){(0,d.VLi)(new se)}addToWindow(Xe){d.dqk.getAngularTestability=(Tt,nn=!0)=>{const ii=Xe.findTestabilityInTree(Tt,nn);if(null==ii)throw new Error("Could not find testability for element.");return ii},d.dqk.getAllAngularTestabilities=()=>Xe.getAllTestabilities(),d.dqk.getAllAngularRootElements=()=>Xe.getAllRootElements(),d.dqk.frameworkStabilizers||(d.dqk.frameworkStabilizers=[]),d.dqk.frameworkStabilizers.push(Tt=>{const nn=d.dqk.getAllAngularTestabilities();let ii=nn.length,hi=!1;const ro=function(sr){hi=hi||sr,ii--,0==ii&&Tt(hi)};nn.forEach(function(sr){sr.whenStable(ro)})})}findTestabilityInTree(Xe,ke,Tt){return null==ke?null:Xe.getTestability(ke)??(Tt?(0,b.q)().isShadowRoot(ke)?this.findTestabilityInTree(Xe,ke.host,!0):this.findTestabilityInTree(Xe,ke.parentElement,!0):null)}}let ue=(()=>{class nt{build(){return new XMLHttpRequest}}return nt.\u0275fac=function(ke){return new(ke||nt)},nt.\u0275prov=d.Yz7({token:nt,factory:nt.\u0275fac}),nt})();const ye=new d.OlP("EventManagerPlugins");let xe=(()=>{class nt{constructor(ke,Tt){this._zone=Tt,this._eventNameToPlugin=new Map,ke.forEach(nn=>nn.manager=this),this._plugins=ke.slice().reverse()}addEventListener(ke,Tt,nn){return this._findPluginFor(Tt).addEventListener(ke,Tt,nn)}addGlobalEventListener(ke,Tt,nn){return this._findPluginFor(Tt).addGlobalEventListener(ke,Tt,nn)}getZone(){return this._zone}_findPluginFor(ke){const Tt=this._eventNameToPlugin.get(ke);if(Tt)return Tt;const nn=this._plugins;for(let ii=0;ii<nn.length;ii++){const hi=nn[ii];if(hi.supports(ke))return this._eventNameToPlugin.set(ke,hi),hi}throw new Error(`No event manager plugin found for event ${ke}`)}}return nt.\u0275fac=function(ke){return new(ke||nt)(d.LFG(ye),d.LFG(d.R0b))},nt.\u0275prov=d.Yz7({token:nt,factory:nt.\u0275fac}),nt})();class Ee{constructor(Xe){this._doc=Xe}addGlobalEventListener(Xe,ke,Tt){const nn=(0,b.q)().getGlobalEventTarget(this._doc,Xe);if(!nn)throw new Error(`Unsupported event target ${nn} for event ${ke}`);return this.addEventListener(nn,ke,Tt)}}let We=(()=>{class nt{constructor(){this._stylesSet=new Set}addStyles(ke){const Tt=new Set;ke.forEach(nn=>{this._stylesSet.has(nn)||(this._stylesSet.add(nn),Tt.add(nn))}),this.onStylesAdded(Tt)}onStylesAdded(ke){}getAllStyles(){return Array.from(this._stylesSet)}}return nt.\u0275fac=function(ke){return new(ke||nt)},nt.\u0275prov=d.Yz7({token:nt,factory:nt.\u0275fac}),nt})(),be=(()=>{class nt extends We{constructor(ke){super(),this._doc=ke,this._hostNodes=new Map,this._hostNodes.set(ke.head,[])}_addStylesToHost(ke,Tt,nn){ke.forEach(ii=>{const hi=this._doc.createElement("style");hi.textContent=ii,nn.push(Tt.appendChild(hi))})}addHost(ke){const Tt=[];this._addStylesToHost(this._stylesSet,ke,Tt),this._hostNodes.set(ke,Tt)}removeHost(ke){const Tt=this._hostNodes.get(ke);Tt&&Tt.forEach(Se),this._hostNodes.delete(ke)}onStylesAdded(ke){this._hostNodes.forEach((Tt,nn)=>{this._addStylesToHost(ke,nn,Tt)})}ngOnDestroy(){this._hostNodes.forEach(ke=>ke.forEach(Se))}}return nt.\u0275fac=function(ke){return new(ke||nt)(d.LFG(b.K0))},nt.\u0275prov=d.Yz7({token:nt,factory:nt.\u0275fac}),nt})();function Se(nt){(0,b.q)().remove(nt)}const ze={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},tt=/%COMP%/g;function wt(nt,Xe,ke){for(let Tt=0;Tt<Xe.length;Tt++){let nn=Xe[Tt];Array.isArray(nn)?wt(nt,nn,ke):(nn=nn.replace(tt,nt),ke.push(nn))}return ke}function xt(nt){return Xe=>{if("__ngUnwrap__"===Xe)return nt;!1===nt(Xe)&&(Xe.preventDefault(),Xe.returnValue=!1)}}let Bt=(()=>{class nt{constructor(ke,Tt,nn){this.eventManager=ke,this.sharedStylesHost=Tt,this.appId=nn,this.rendererByCompId=new Map,this.defaultRenderer=new Ht(ke)}createRenderer(ke,Tt){if(!ke||!Tt)return this.defaultRenderer;switch(Tt.encapsulation){case d.ifc.Emulated:{let nn=this.rendererByCompId.get(Tt.id);return nn||(nn=new jt(this.eventManager,this.sharedStylesHost,Tt,this.appId),this.rendererByCompId.set(Tt.id,nn)),nn.applyToHost(ke),nn}case 1:case d.ifc.ShadowDom:return new Ut(this.eventManager,this.sharedStylesHost,ke,Tt);default:if(!this.rendererByCompId.has(Tt.id)){const nn=wt(Tt.id,Tt.styles,[]);this.sharedStylesHost.addStyles(nn),this.rendererByCompId.set(Tt.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return nt.\u0275fac=function(ke){return new(ke||nt)(d.LFG(xe),d.LFG(be),d.LFG(d.AFp))},nt.\u0275prov=d.Yz7({token:nt,factory:nt.\u0275fac}),nt})();class Ht{constructor(Xe){this.eventManager=Xe,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(Xe,ke){return ke?document.createElementNS(ze[ke]||ke,Xe):document.createElement(Xe)}createComment(Xe){return document.createComment(Xe)}createText(Xe){return document.createTextNode(Xe)}appendChild(Xe,ke){Xe.appendChild(ke)}insertBefore(Xe,ke,Tt){Xe&&Xe.insertBefore(ke,Tt)}removeChild(Xe,ke){Xe&&Xe.removeChild(ke)}selectRootElement(Xe,ke){let Tt="string"==typeof Xe?document.querySelector(Xe):Xe;if(!Tt)throw new Error(`The selector "${Xe}" did not match any elements`);return ke||(Tt.textContent=""),Tt}parentNode(Xe){return Xe.parentNode}nextSibling(Xe){return Xe.nextSibling}setAttribute(Xe,ke,Tt,nn){if(nn){ke=nn+":"+ke;const ii=ze[nn];ii?Xe.setAttributeNS(ii,ke,Tt):Xe.setAttribute(ke,Tt)}else Xe.setAttribute(ke,Tt)}removeAttribute(Xe,ke,Tt){if(Tt){const nn=ze[Tt];nn?Xe.removeAttributeNS(nn,ke):Xe.removeAttribute(`${Tt}:${ke}`)}else Xe.removeAttribute(ke)}addClass(Xe,ke){Xe.classList.add(ke)}removeClass(Xe,ke){Xe.classList.remove(ke)}setStyle(Xe,ke,Tt,nn){nn&(d.JOm.DashCase|d.JOm.Important)?Xe.style.setProperty(ke,Tt,nn&d.JOm.Important?"important":""):Xe.style[ke]=Tt}removeStyle(Xe,ke,Tt){Tt&d.JOm.DashCase?Xe.style.removeProperty(ke):Xe.style[ke]=""}setProperty(Xe,ke,Tt){Xe[ke]=Tt}setValue(Xe,ke){Xe.nodeValue=ke}listen(Xe,ke,Tt){return"string"==typeof Xe?this.eventManager.addGlobalEventListener(Xe,ke,xt(Tt)):this.eventManager.addEventListener(Xe,ke,xt(Tt))}}class jt extends Ht{constructor(Xe,ke,Tt,nn){super(Xe),this.component=Tt;const ii=wt(nn+"-"+Tt.id,Tt.styles,[]);ke.addStyles(ii),this.contentAttr=function _t(nt){return"_ngcontent-%COMP%".replace(tt,nt)}(nn+"-"+Tt.id),this.hostAttr=function ht(nt){return"_nghost-%COMP%".replace(tt,nt)}(nn+"-"+Tt.id)}applyToHost(Xe){super.setAttribute(Xe,this.hostAttr,"")}createElement(Xe,ke){const Tt=super.createElement(Xe,ke);return super.setAttribute(Tt,this.contentAttr,""),Tt}}class Ut extends Ht{constructor(Xe,ke,Tt,nn){super(Xe),this.sharedStylesHost=ke,this.hostEl=Tt,this.shadowRoot=Tt.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const ii=wt(nn.id,nn.styles,[]);for(let hi=0;hi<ii.length;hi++){const ro=document.createElement("style");ro.textContent=ii[hi],this.shadowRoot.appendChild(ro)}}nodeOrShadowRoot(Xe){return Xe===this.hostEl?this.shadowRoot:Xe}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(Xe,ke){return super.appendChild(this.nodeOrShadowRoot(Xe),ke)}insertBefore(Xe,ke,Tt){return super.insertBefore(this.nodeOrShadowRoot(Xe),ke,Tt)}removeChild(Xe,ke){return super.removeChild(this.nodeOrShadowRoot(Xe),ke)}parentNode(Xe){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(Xe)))}}let Yt=(()=>{class nt extends Ee{constructor(ke){super(ke)}supports(ke){return!0}addEventListener(ke,Tt,nn){return ke.addEventListener(Tt,nn,!1),()=>this.removeEventListener(ke,Tt,nn)}removeEventListener(ke,Tt,nn){return ke.removeEventListener(Tt,nn)}}return nt.\u0275fac=function(ke){return new(ke||nt)(d.LFG(b.K0))},nt.\u0275prov=d.Yz7({token:nt,factory:nt.\u0275fac}),nt})();const zt=["alt","control","meta","shift"],ln={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},xn={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},an={alt:nt=>nt.altKey,control:nt=>nt.ctrlKey,meta:nt=>nt.metaKey,shift:nt=>nt.shiftKey};let Kt=(()=>{class nt extends Ee{constructor(ke){super(ke)}supports(ke){return null!=nt.parseEventName(ke)}addEventListener(ke,Tt,nn){const ii=nt.parseEventName(Tt),hi=nt.eventCallback(ii.fullKey,nn,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,b.q)().onAndCancel(ke,ii.domEventName,hi))}static parseEventName(ke){const Tt=ke.toLowerCase().split("."),nn=Tt.shift();if(0===Tt.length||"keydown"!==nn&&"keyup"!==nn)return null;const ii=nt._normalizeKey(Tt.pop());let hi="";if(zt.forEach(sr=>{const ms=Tt.indexOf(sr);ms>-1&&(Tt.splice(ms,1),hi+=sr+".")}),hi+=ii,0!=Tt.length||0===ii.length)return null;const ro={};return ro.domEventName=nn,ro.fullKey=hi,ro}static getEventFullKey(ke){let Tt="",nn=function mt(nt){let Xe=nt.key;if(null==Xe){if(Xe=nt.keyIdentifier,null==Xe)return"Unidentified";Xe.startsWith("U+")&&(Xe=String.fromCharCode(parseInt(Xe.substring(2),16)),3===nt.location&&xn.hasOwnProperty(Xe)&&(Xe=xn[Xe]))}return ln[Xe]||Xe}(ke);return nn=nn.toLowerCase()," "===nn?nn="space":"."===nn&&(nn="dot"),zt.forEach(ii=>{ii!=nn&&an[ii](ke)&&(Tt+=ii+".")}),Tt+=nn,Tt}static eventCallback(ke,Tt,nn){return ii=>{nt.getEventFullKey(ii)===ke&&nn.runGuarded(()=>Tt(ii))}}static _normalizeKey(ke){return"esc"===ke?"escape":ke}}return nt.\u0275fac=function(ke){return new(ke||nt)(d.LFG(b.K0))},nt.\u0275prov=d.Yz7({token:nt,factory:nt.\u0275fac}),nt})();const li=(0,d.eFA)(d._c5,"browser",[{provide:d.Lbi,useValue:b.bD},{provide:d.g9A,useValue:function Wt(){l.makeCurrent(),se.init()},multi:!0},{provide:b.K0,useFactory:function bn(){return(0,d.RDi)(document),document},deps:[]}]),$i=[{provide:d.zSh,useValue:"root"},{provide:d.qLn,useFactory:function On(){return new d.qLn},deps:[]},{provide:ye,useClass:Yt,multi:!0,deps:[b.K0,d.R0b,d.Lbi]},{provide:ye,useClass:Kt,multi:!0,deps:[b.K0]},{provide:Bt,useClass:Bt,deps:[xe,be,d.AFp]},{provide:d.FYo,useExisting:Bt},{provide:We,useExisting:be},{provide:be,useClass:be,deps:[b.K0]},{provide:d.dDg,useClass:d.dDg,deps:[d.R0b]},{provide:xe,useClass:xe,deps:[ye,d.R0b]},{provide:b.JF,useClass:ue,deps:[]}];let rr=(()=>{class nt{constructor(ke){if(ke)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(ke){return{ngModule:nt,providers:[{provide:d.AFp,useValue:ke.appId},{provide:ge,useExisting:d.AFp},Y]}}}return nt.\u0275fac=function(ke){return new(ke||nt)(d.LFG(nt,12))},nt.\u0275mod=d.oAB({type:nt}),nt.\u0275inj=d.cJS({providers:$i,imports:[b.ez,d.hGG]}),nt})();"undefined"!=typeof window&&window;var Ye=k(8936),pt=k(9397),Ct=k(4006),Je=k(7429);let Lt=(()=>{class nt{}return nt.\u0275fac=function(ke){return new(ke||nt)},nt.\u0275mod=d.oAB({type:nt}),nt.\u0275inj=d.cJS({imports:[[b.ez,Ct.u5,Je.Pc,pt.aw,Ye.e]]}),nt})(),en=(()=>{class nt{}return nt.\u0275fac=function(ke){return new(ke||nt)},nt.\u0275mod=d.oAB({type:nt}),nt.\u0275inj=d.cJS({imports:[[b.ez,Ct.u5,Je.Pc,pt.aw,Ye.e]]}),nt})(),Gt=(()=>{class nt{}return nt.\u0275fac=function(ke){return new(ke||nt)},nt.\u0275mod=d.oAB({type:nt}),nt.\u0275inj=d.cJS({imports:[[b.ez,Ct.u5,Je.Pc,pt.aw,Ye.e]]}),nt})();var At=k(9671),Pn=k(529),Vn=k(3334),Yn=k(4244);class qn{constructor(Xe,ke="/assets/i18n/",Tt=".json"){this.http=Xe,this.prefix=ke,this.suffix=Tt}getTranslation(Xe){return this.http.get(`${this.prefix}${Xe}${this.suffix}`)}}var ni=k(6099),Li=k(4781),Mi=k(6763),di=k(9492),En=k(9741),ti=k(3855);function Yi(nt,Xe){if(1&nt){const ke=d.EpF();d.TgZ(0,"div"),d._uU(1," You are not signed in. "),d.TgZ(2,"button",5),d.NdJ("click",function(){return d.CHM(ke),d.oxw().showSignInModal()}),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.qZA()}2&nt&&(d.xp6(3),d.Oqu(d.lcZ(4,1,"ocm.general.signIn")))}function Ni(nt,Xe){if(1&nt&&(d.TgZ(0,"div"),d.TgZ(1,"ion-card"),d.TgZ(2,"ion-item"),d.TgZ(3,"ion-avatar",6),d._UZ(4,"img",7),d.qZA(),d.TgZ(5,"h2"),d._uU(6),d.qZA(),d.qZA(),d.TgZ(7,"ion-card-content"),d.TgZ(8,"p"),d._uU(9),d.qZA(),d.TgZ(10,"p"),d._uU(11),d.qZA(),d.qZA(),d.TgZ(12,"ion-item"),d.TgZ(13,"ion-note",8),d._UZ(14,"ion-icon",9),d._uU(15),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&nt){const ke=d.oxw();d.xp6(4),d.s9C("src",ke.userProfile.ProfileImageURL,d.LSH),d.xp6(2),d.Oqu(ke.userProfile.Username),d.xp6(3),d.hij(" ",ke.userProfile.Profile,""),d.xp6(2),d.hij(" Date Joined: ",ke.userProfile.DateCreated," "),d.xp6(4),d.hij(" ",ke.userProfile.ReputationPoints," Contributor Points ")}}let pr=(()=>{class nt{constructor(ke,Tt,nn,ii){this.appManager=ke,this.nav=Tt,this.translate=nn,this.modalController=ii}ionViewDidEnter(){this.userProfile=this.appManager.getUserProfile(),null!=this.userProfile&&this.appManager.isUserAuthenticated(!0)?this.refreshProfileView():this.showSignInModal(),this.appManager.analytics.viewEvent("Profile")}refreshProfileView(){this.userProfile=this.appManager.getUserProfile()}showSignInModal(){this.modalController.create({component:di.F,componentProps:{Profile:this.userProfile}}).then(ke=>{ke.onDidDismiss().then(()=>{this.refreshProfileView()}),ke.present()})}close(){this.modalController.dismiss()}}return nt.\u0275fac=function(ke){return new(ke||nt)(d.Y36(ti.c),d.Y36(Je.SH),d.Y36(pt.sK),d.Y36(Je.IN))},nt.\u0275cmp=d.Xpm({type:nt,selectors:[["ng-component"]],decls:14,vars:5,consts:[[1,"profile-page","ion-padding"],[4,"ngIf"],["slot","end"],[3,"click"],["name","close","slot","start"],["ion-button","",3,"click"],["slot","start"],[3,"src"],["item-left",""],["name","star"]],template:function(ke,Tt){1&ke&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-title"),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(5,"ion-content",0),d.YNc(6,Yi,5,3,"div",1),d.YNc(7,Ni,16,5,"div",1),d.qZA(),d.TgZ(8,"ion-footer"),d.TgZ(9,"ion-toolbar"),d.TgZ(10,"ion-buttons",2),d.TgZ(11,"ion-button",3),d.NdJ("click",function(){return Tt.close()}),d._UZ(12,"ion-icon",4),d._uU(13," Close "),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&ke&&(d.xp6(3),d.hij(" ",d.lcZ(4,3,"ocm.navigation.profile.sectionTitle")," "),d.xp6(3),d.Q6J("ngIf",null==Tt.userProfile),d.xp6(1),d.Q6J("ngIf",null!=Tt.userProfile))},directives:[Je.Gu,Je.sr,Je.wd,Je.W2,b.O5,Je.PM,Je.Ie,Je.BJ,Je.FN,Je.uN,Je.gu,Je.fr,Je.Sm,Je.YG],pipes:[pt.X$],encapsulation:2}),nt})();var oi=k(7689),fr=k(2340),or=k(4508),Sr=k(56),wo=k(6579),xi=k(388),io=k(6588),$r=k(7423);const jr=(0,$r.fo)("PushNotifications",{}),Pr=(0,$r.fo)("StatusBar"),Cr=(0,$r.fo)("SplashScreen",{web:()=>k.e(2680).then(k.bind(k,2680)).then(nt=>new nt.SplashScreenWeb)}),to=(0,$r.fo)("App",{web:()=>k.e(4477).then(k.bind(k,4477)).then(nt=>new nt.AppWeb)});var Ie=k(6260);function _e(nt,Xe){if(1&nt){const ke=d.EpF();d.TgZ(0,"ion-item",9),d.NdJ("click",function(){return d.CHM(ke),d.oxw().openRoutePlannerModal()}),d._UZ(1,"ion-icon",12),d.TgZ(2,"ion-label"),d._uU(3," Route Planner "),d.qZA(),d.qZA()}}function qe(nt,Xe){if(1&nt){const ke=d.EpF();d.TgZ(0,"ion-item",9),d.NdJ("click",function(){return d.CHM(ke),d.oxw().add()}),d._UZ(1,"ion-icon",13),d.TgZ(2,"ion-label"),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.qZA()}2&nt&&(d.xp6(3),d.hij(" ",d.lcZ(4,1,"ocm.general.addLocation")," "))}function ct(nt,Xe){if(1&nt){const ke=d.EpF();d.TgZ(0,"ion-item",9),d.NdJ("click",function(){return d.CHM(ke),d.oxw().journeys()}),d._UZ(1,"ion-icon",12),d.TgZ(2,"ion-label"),d._uU(3," Journeys "),d.qZA(),d.qZA()}}function Vt(nt,Xe){if(1&nt){const ke=d.EpF();d.TgZ(0,"ion-item",9),d.NdJ("click",function(){return d.CHM(ke),d.oxw().addLayer()}),d._UZ(1,"ion-icon",14),d.TgZ(2,"ion-label"),d._uU(3," Add Layer "),d.qZA(),d.qZA()}}function Pt(nt,Xe){if(1&nt){const ke=d.EpF();d.ynx(0),d.TgZ(1,"ion-item",9),d.NdJ("click",function(){return d.CHM(ke),d.oxw().signIn()}),d._UZ(2,"ion-icon",15),d.TgZ(3,"ion-label"),d._uU(4),d.ALo(5,"translate"),d.qZA(),d.qZA(),d.BQk()}2&nt&&(d.xp6(4),d.hij(" ",d.lcZ(5,1,"ocm.general.signIn")," "))}function rn(nt,Xe){if(1&nt){const ke=d.EpF();d.ynx(0),d.TgZ(1,"ion-item",9),d.NdJ("click",function(){return d.CHM(ke),d.oxw().profile()}),d._UZ(2,"ion-icon",15),d.TgZ(3,"ion-label"),d._uU(4),d.ALo(5,"translate"),d.qZA(),d.qZA(),d.TgZ(6,"ion-item",9),d.NdJ("click",function(){return d.CHM(ke),d.oxw().signOut()}),d._UZ(7,"ion-icon",16),d.TgZ(8,"ion-label"),d._uU(9),d.ALo(10,"translate"),d._UZ(11,"br"),d.TgZ(12,"small",17),d._uU(13),d.qZA(),d.qZA(),d.qZA(),d.BQk()}if(2&nt){const ke=d.oxw();d.xp6(4),d.hij(" ",d.lcZ(5,3,"ocm.navigation.profile.sectionTitle")," "),d.xp6(5),d.hij(" ",d.lcZ(10,5,"ocm.general.signOut")," "),d.xp6(4),d.hij(" ",ke.getUserName(),"")}}const fn=function(){return["/search"]};let un=(()=>{class nt{constructor(ke,Tt,nn,ii,hi,ro,sr,ms){this.platform=ke,this.translate=Tt,this.mapping=nn,this.modalController=ii,this.appManager=hi,this.logger=ro,this.analytics=sr,this.events=ms,this.logger.log("Environment: "+fr.N.name),this.initializeApp(),this.enabledFeatures=fr.N.enabledFeatures,1!=hi.searchSettings.EnableAdvancedEditorFeatures&&(this.enabledFeatures=this.enabledFeatures.filter(gs=>"LAYERS"!=gs))}configurePushNotifications(){jr.register(),jr.addListener("registration",ke=>{this.logger.log("Push registration success, token: "+ke.value),this.appManager.savePushRegistration(ke.value)}),jr.addListener("registrationError",ke=>{this.logger.log("Error on registration: "+JSON.stringify(ke))}),jr.addListener("pushNotificationReceived",ke=>{this.logger.log("Push received: "+JSON.stringify(ke),oi.i.INFO)}),jr.addListener("pushNotificationActionPerformed",ke=>{this.logger.log("Push action performed: "+JSON.stringify(ke))})}isUserAuthenticated(){return this.appManager.isUserAuthenticated()}getUserName(){let ke=this.appManager.getUserProfile();return ke?ke.EmailAddress?ke.EmailAddress:ke.Username:"Not Signed In"}initializeApp(){var ke=this;this.platform.ready().then(()=>{this.platform.is("capacitor")&&(Pr.show(),Cr.hide()),this.translate.addLangs(this.appManager.getLanguages().map(Tt=>Tt.code)),this.translate.setDefaultLang("en"),null!=this.appManager.searchSettings.Language?this.translate.use(this.appManager.searchSettings.Language):this.translate.currentLang||this.translate.use("en"),this.translate.get("ocm.search.performSearch").toPromise().then(Tt=>{}),this.analytics.init(fr.N.analyticsId).then(()=>{this.analytics.setAppVersion(fr.N.version),this.analytics.appEvent("Startup","App Loaded")}).catch(Tt=>this.logger.log("Error starting analytics")),this.events.subscribe("ocm:mapping:addpoi",function(){var Tt=(0,ni.Z)(function*(nn){wo.c.isFeatureEnabled("ADD_POI")&&ke.add(nn)});return function(nn){return Tt.apply(this,arguments)}}()),(this.platform.is("ios")||this.platform.is("android"))&&(this.configurePushNotifications(),this.checkForAppOpenUrl())})}checkForAppOpenUrl(){return(0,ni.Z)(function*(){to.addListener("appUrlOpen",Tt=>{alert("App (re)opened with URL: "+Tt.url)});let ke=yield to.getLaunchUrl();ke&&ke.url&&alert("App opened with URL: "+ke.url)})()}openRoutePlannerModal(){var ke=this;return(0,ni.Z)(function*(){ke.mapping.unfocusMap();const Tt=yield ke.modalController.create({component:Mi.u});Tt.onDidDismiss().then(nn=>{ke.mapping.focusMap()}),yield Tt.present()})()}continueAdd(ke){var Tt=this;return(0,ni.Z)(function*(){const nn=yield Tt.modalController.create({component:or.Y,componentProps:{startPos:ke}});nn.onDidDismiss().then(ii=>{Tt.mapping.focusMap()}),yield nn.present()})()}add(ke){var Tt=this;return(0,ni.Z)(function*(){if(Tt.mapping.unfocusMap(),!Tt.appManager.isUserAuthenticated(!0)){const nn=yield Tt.modalController.create({component:di.F});return nn.onDidDismiss().then(function(){var ii=(0,ni.Z)(function*(hi){Tt.mapping.focusMap(),Tt.appManager.isUserAuthenticated(!0)&&(yield Tt.continueAdd(ke))});return function(hi){return ii.apply(this,arguments)}}()),yield nn.present()}yield Tt.continueAdd(ke)})()}signIn(){var ke=this;return(0,ni.Z)(function*(){ke.mapping.unfocusMap();const Tt=yield ke.modalController.create({component:di.F});return Tt.onDidDismiss().then(nn=>{ke.mapping.focusMap(),ke.appManager.isUserAuthenticated(!0)}),yield Tt.present()})()}signOut(){var ke=this;return(0,ni.Z)(function*(){ke.appManager.signOutCurrentUser()})()}profile(){var ke=this;return(0,ni.Z)(function*(){ke.mapping.unfocusMap();const Tt=yield ke.modalController.create({component:pr});Tt.onDidDismiss().then(nn=>{ke.mapping.focusMap()}),yield Tt.present()})()}journeys(){var ke=this;return(0,ni.Z)(function*(){ke.mapping.unfocusMap();const Tt=yield ke.modalController.create({component:En.g});Tt.onDidDismiss().then(nn=>{ke.mapping.focusMap()}),yield Tt.present()})()}addLayer(){var ke=this;return(0,ni.Z)(function*(){const Tt=yield ke.modalController.create({component:io.A});yield Tt.present();const{data:nn}=yield Tt.onWillDismiss();nn&&ke.mapping.addPOILayer(nn)})()}about(){var ke=this;return(0,ni.Z)(function*(){ke.mapping.unfocusMap();const Tt=yield ke.modalController.create({component:xi.t});Tt.onDidDismiss().then(nn=>{ke.mapping.focusMap()}),yield Tt.present()})()}}return nt.\u0275fac=function(ke){return new(ke||nt)(d.Y36(Je.t4),d.Y36(pt.sK),d.Y36(Li.v),d.Y36(Je.IN),d.Y36(ti.c),d.Y36(oi.z),d.Y36(Sr.c),d.Y36(Ie.z))},nt.\u0275cmp=d.Xpm({type:nt,selectors:[["app-root"]],decls:29,vars:17,consts:[["contentId","main-content",3,"disabled"],["contentId","main-content","swipeGesture","false"],["slot","start"],["src","assets/images/icons/branding/AppIcon_128x128.png"],["auto-hide","false"],[3,"routerDirection","routerLink"],["slot","start","name","home"],[3,"click",4,"ngIf"],[4,"ngIf"],[3,"click"],["slot","start","name","information-circle-outline"],["id","main-content"],["slot","start","name","map"],["slot","start","name","add-circle-outline"],["slot","start","name","albums"],["slot","start","name","person"],["slot","start","name","log-out"],[2,"color","#c0c0c0"]],template:function(ke,Tt){1&ke&&(d.TgZ(0,"ion-app"),d.TgZ(1,"ion-split-pane",0),d.TgZ(2,"ion-menu",1),d.TgZ(3,"ion-header"),d.TgZ(4,"ion-toolbar"),d.TgZ(5,"ion-thumbnail",2),d._UZ(6,"img",3),d.qZA(),d.TgZ(7,"ion-title"),d._uU(8),d.qZA(),d.qZA(),d.qZA(),d.TgZ(9,"ion-content"),d.TgZ(10,"ion-list"),d.TgZ(11,"ion-menu-toggle",4),d.TgZ(12,"ion-item",5),d._UZ(13,"ion-icon",6),d.TgZ(14,"ion-label"),d._uU(15),d.ALo(16,"translate"),d.qZA(),d.qZA(),d.YNc(17,_e,4,0,"ion-item",7),d.YNc(18,qe,5,3,"ion-item",7),d.YNc(19,ct,4,0,"ion-item",7),d.YNc(20,Vt,4,0,"ion-item",7),d.YNc(21,Pt,6,3,"ng-container",8),d.YNc(22,rn,14,7,"ng-container",8),d.TgZ(23,"ion-item",9),d.NdJ("click",function(){return Tt.about()}),d._UZ(24,"ion-icon",10),d.TgZ(25,"ion-label"),d._uU(26),d.ALo(27,"translate"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d._UZ(28,"ion-router-outlet",11),d.qZA(),d.qZA()),2&ke&&(d.xp6(1),d.Q6J("disabled",!0),d.xp6(7),d.Oqu(Tt.appManager.title),d.xp6(4),d.Q6J("routerDirection","root")("routerLink",d.DdM(16,fn)),d.xp6(3),d.hij(" ",d.lcZ(16,12,"ocm.search.sectionTitle")," "),d.xp6(2),d.Q6J("ngIf",Tt.enabledFeatures.includes("ROUTE_PLANNER")),d.xp6(1),d.Q6J("ngIf",Tt.enabledFeatures.includes("ADD_POI")),d.xp6(1),d.Q6J("ngIf",Tt.enabledFeatures.includes("FAVOURITES")),d.xp6(1),d.Q6J("ngIf",Tt.enabledFeatures.includes("LAYERS")),d.xp6(1),d.Q6J("ngIf",!Tt.isUserAuthenticated()),d.xp6(1),d.Q6J("ngIf",Tt.isUserAuthenticated()),d.xp6(4),d.hij(" ",d.lcZ(27,14,"ocm.general.about")," "))},directives:[Je.dr,Je.jI,Je.z0,Je.Gu,Je.sr,Je.Bs,Je.wd,Je.W2,Je.q_,Je.zc,Je.Ie,Je.YI,Vn.rH,Je.gu,Je.Q$,b.O5,Je.jP],pipes:[pt.X$],encapsulation:2}),nt})();const Cn=[{path:"",redirectTo:"search",pathMatch:"full"},{path:"search",loadChildren:()=>Promise.resolve().then(k.bind(k,9671)).then(nt=>nt.SearchPageModule)},{path:"journeys",loadChildren:()=>Promise.resolve().then(k.bind(k,5476)).then(nt=>nt.JourneysModule)},{path:"signin",loadChildren:()=>Promise.resolve().then(k.bind(k,6779)).then(nt=>nt.SignInModule)},{path:"poi-editor/:id",loadChildren:()=>Promise.resolve().then(k.bind(k,1948)).then(nt=>nt.PoiEditorPageModule)},{path:"about",loadChildren:()=>Promise.resolve().then(k.bind(k,534)).then(nt=>nt.AboutPageModule)},{path:"layer-editor",loadChildren:()=>Promise.resolve().then(k.bind(k,5005)).then(nt=>nt.LayerEditorPageModule)}];let Un=(()=>{class nt{}return nt.\u0275fac=function(ke){return new(ke||nt)},nt.\u0275mod=d.oAB({type:nt}),nt.\u0275inj=d.cJS({imports:[[Vn.Bz.forRoot(Cn,{useHash:!0})],Vn.Bz]}),nt})(),St=(()=>{class nt{}return nt.\u0275fac=function(ke){return new(ke||nt)},nt.\u0275mod=d.oAB({type:nt}),nt.\u0275inj=d.cJS({imports:[[b.ez,Ct.u5,Je.Pc,pt.aw,Ye.e]]}),nt})();var on=k(6779);let Ri=(()=>{class nt{}return nt.\u0275fac=function(ke){return new(ke||nt)},nt.\u0275mod=d.oAB({type:nt}),nt.\u0275inj=d.cJS({imports:[[b.ez,Ct.u5,Je.Pc,pt.aw,Ye.e,Vn.Bz.forChild([{path:"",component:pr}])]]}),nt})();var Ur=k(6314);let ji=(()=>{class nt{}return nt.\u0275fac=function(ke){return new(ke||nt)},nt.\u0275mod=d.oAB({type:nt}),nt.\u0275inj=d.cJS({imports:[[b.ez,Ct.u5,Je.Pc,pt.aw,Ye.e,Vn.Bz.forChild([{path:"",component:Ur.N}])]]}),nt})();var _r=k(5476),Qi=k(1948),Ao=k(534),fo=k(5005);function zn(){return localStorage.getItem("access_token")}function Gi(nt){return new qn(nt,"/assets/i18n/",".json")}let Lo=(()=>{class nt{}return nt.\u0275fac=function(ke){return new(ke||nt)},nt.\u0275mod=d.oAB({type:nt,bootstrap:[un]}),nt.\u0275inj=d.cJS({providers:[{provide:Vn.wN,useClass:Je.r4}],imports:[[rr,Pn.JF,pt.aw.forRoot({loader:{provide:pt.Zw,useFactory:Gi,deps:[Pn.eN]}}),Je.Pc.forRoot(),Un,Yn.Ar.forRoot({config:{tokenGetter:zn}}),At.SearchPageModule,St,_r.JourneysModule,on.SignInModule,Gt,Lt,en,Qi.PoiEditorPageModule,Ri,ji,Ao.AboutPageModule,fo.LayerEditorPageModule]]}),nt})();fr.N.production&&(0,d.G48)(),li().bootstrapModule(Lo).catch(nt=>console.log(nt))},9898:function(An){An.exports=function(){"use strict";var vt,k,b;function d(l,J){if(vt)if(k){var j="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+vt+")(sharedChunk); ("+k+")(sharedChunk); self.onerror = null;",g={};vt(g),b=J(g),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(b.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}else k=J;else vt=J}return d(0,function(l){var J="2.7.0",j=g;function g(t,e,i,s){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=s,this.p2x=i,this.p2y=s}g.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},g.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},g.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},g.prototype.solveCurveX=function(t,e){var i,s,u,p,_;for(void 0===e&&(e=1e-6),u=t,_=0;_<8;_++){if(p=this.sampleCurveX(u)-t,Math.abs(p)<e)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=p/x}if((u=t)<(i=0))return i;if(u>(s=1))return s;for(;i<s;){if(p=this.sampleCurveX(u),Math.abs(p-t)<e)return u;t>p?i=u:s=u,u=.5*(s-i)+i}return u},g.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var ne=ge;function ge(t,e){this.x=t,this.y=e}ge.prototype={clone:function(){return new ge(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround:function(t,e){var i=Math.cos(t),s=Math.sin(t),u=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ge.convert=function(t){return t instanceof ge?t:Array.isArray(t)?new ge(t[0],t[1]):t};var Q="undefined"!=typeof self?self:{},Y=1e-6,se="undefined"!=typeof Float32Array?Float32Array:Array;function ue(){var t=new se(9);return se!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ye(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xe(t,e,i){var s=e[0],u=e[1],p=e[2],_=e[3],x=e[4],E=e[5],M=e[6],F=e[7],U=e[8],V=e[9],ce=e[10],ve=e[11],Ae=e[12],Ve=e[13],Ke=e[14],dt=e[15],bt=i[0],Mt=i[1],Ot=i[2],Nt=i[3];return t[0]=bt*s+Mt*x+Ot*U+Nt*Ae,t[1]=bt*u+Mt*E+Ot*V+Nt*Ve,t[2]=bt*p+Mt*M+Ot*ce+Nt*Ke,t[3]=bt*_+Mt*F+Ot*ve+Nt*dt,t[4]=(bt=i[4])*s+(Mt=i[5])*x+(Ot=i[6])*U+(Nt=i[7])*Ae,t[5]=bt*u+Mt*E+Ot*V+Nt*Ve,t[6]=bt*p+Mt*M+Ot*ce+Nt*Ke,t[7]=bt*_+Mt*F+Ot*ve+Nt*dt,t[8]=(bt=i[8])*s+(Mt=i[9])*x+(Ot=i[10])*U+(Nt=i[11])*Ae,t[9]=bt*u+Mt*E+Ot*V+Nt*Ve,t[10]=bt*p+Mt*M+Ot*ce+Nt*Ke,t[11]=bt*_+Mt*F+Ot*ve+Nt*dt,t[12]=(bt=i[12])*s+(Mt=i[13])*x+(Ot=i[14])*U+(Nt=i[15])*Ae,t[13]=bt*u+Mt*E+Ot*V+Nt*Ve,t[14]=bt*p+Mt*M+Ot*ce+Nt*Ke,t[15]=bt*_+Mt*F+Ot*ve+Nt*dt,t}function Ee(t,e,i){var s,u,p,_,x,E,M,F,U,V,ce,ve,Ae=i[0],Ve=i[1],Ke=i[2];return e===t?(t[12]=e[0]*Ae+e[4]*Ve+e[8]*Ke+e[12],t[13]=e[1]*Ae+e[5]*Ve+e[9]*Ke+e[13],t[14]=e[2]*Ae+e[6]*Ve+e[10]*Ke+e[14],t[15]=e[3]*Ae+e[7]*Ve+e[11]*Ke+e[15]):(u=e[1],p=e[2],_=e[3],x=e[4],E=e[5],M=e[6],F=e[7],U=e[8],V=e[9],ce=e[10],ve=e[11],t[0]=s=e[0],t[1]=u,t[2]=p,t[3]=_,t[4]=x,t[5]=E,t[6]=M,t[7]=F,t[8]=U,t[9]=V,t[10]=ce,t[11]=ve,t[12]=s*Ae+x*Ve+U*Ke+e[12],t[13]=u*Ae+E*Ve+V*Ke+e[13],t[14]=p*Ae+M*Ve+ce*Ke+e[14],t[15]=_*Ae+F*Ve+ve*Ke+e[15]),t}function We(t,e,i){var s=i[0],u=i[1],p=i[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*p,t[9]=e[9]*p,t[10]=e[10]*p,t[11]=e[11]*p,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function be(t,e,i){var s=Math.sin(i),u=Math.cos(i),p=e[4],_=e[5],x=e[6],E=e[7],M=e[8],F=e[9],U=e[10],V=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=p*u+M*s,t[5]=_*u+F*s,t[6]=x*u+U*s,t[7]=E*u+V*s,t[8]=M*u-p*s,t[9]=F*u-_*s,t[10]=U*u-x*s,t[11]=V*u-E*s,t}function Se(t,e,i){var s=Math.sin(i),u=Math.cos(i),p=e[0],_=e[1],x=e[2],E=e[3],M=e[8],F=e[9],U=e[10],V=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=p*u-M*s,t[1]=_*u-F*s,t[2]=x*u-U*s,t[3]=E*u-V*s,t[8]=p*s+M*u,t[9]=_*s+F*u,t[10]=x*s+U*u,t[11]=E*s+V*u,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ze=xe;function tt(){var t=new se(3);return se!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function et(t){var e=new se(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Be(t){return Math.hypot(t[0],t[1],t[2])}function C(t,e,i){var s=new se(3);return s[0]=t,s[1]=e,s[2]=i,s}function Ge(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function _t(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function ht(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function wt(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function xt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function gt(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t}function Bt(t,e){var i=e[0],s=e[1],u=e[2],p=i*i+s*s+u*u;return p>0&&(p=1/Math.sqrt(p)),t[0]=e[0]*p,t[1]=e[1]*p,t[2]=e[2]*p,t}function Ht(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Gn(t,e,i){var s=e[0],u=e[1],p=e[2],_=i[0],x=i[1],E=i[2];return t[0]=u*E-p*x,t[1]=p*_-s*E,t[2]=s*x-u*_,t}function It(t,e,i){var s=e[0],u=e[1],p=e[2],_=i[3]*s+i[7]*u+i[11]*p+i[15];return t[0]=(i[0]*s+i[4]*u+i[8]*p+i[12])/(_=_||1),t[1]=(i[1]*s+i[5]*u+i[9]*p+i[13])/_,t[2]=(i[2]*s+i[6]*u+i[10]*p+i[14])/_,t}function jt(t,e,i){var s=i[0],u=i[1],p=i[2],_=e[0],x=e[1],E=e[2],M=u*E-p*x,F=p*_-s*E,U=s*x-u*_,V=u*U-p*F,ce=p*M-s*U,ve=s*F-u*M,Ae=2*i[3];return F*=Ae,U*=Ae,ce*=2,ve*=2,t[0]=_+(M*=Ae)+(V*=2),t[1]=x+F+ce,t[2]=E+U+ve,t}var Ut,t,Yt=_t,zt=ht,Zt=Be;function ln(t,e,i){var s=e[0],u=e[1],p=e[2],_=e[3];return t[0]=i[0]*s+i[4]*u+i[8]*p+i[12]*_,t[1]=i[1]*s+i[5]*u+i[9]*p+i[13]*_,t[2]=i[2]*s+i[6]*u+i[10]*p+i[14]*_,t[3]=i[3]*s+i[7]*u+i[11]*p+i[15]*_,t}function xn(){var t=new se(4);return se!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function an(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Kt(t,e,i){i*=.5;var s=e[0],u=e[1],p=e[2],_=e[3],x=Math.sin(i),E=Math.cos(i);return t[0]=s*E+_*x,t[1]=u*E+p*x,t[2]=p*E-u*x,t[3]=_*E-s*x,t}function mt(t,e){return t[0]===e[0]&&t[1]===e[1]}tt(),Ut=new se(4),se!=Float32Array&&(Ut[0]=0,Ut[1]=0,Ut[2]=0,Ut[3]=0),tt(),C(1,0,0),C(0,1,0),xn(),xn(),ue(),t=new se(2),se!=Float32Array&&(t[0]=0,t[1]=0);const Wt=Math.PI/180,On=180/Math.PI;function bn(t){return t*Wt}function jn(t){return t*On}const li=[[0,0],[1,0],[1,1],[0,1]];function $i(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function rr(t,e,i,s){const u=new j(t,e,i,s);return function(p){return u.solve(p)}}const Bi=rr(.25,.1,.25,1);function _i(t,e,i){return Math.min(i,Math.max(e,t))}function tr(t,e,i){return(i=_i((i-t)/(e-t),0,1))*i*(3-2*i)}function gi(t,e,i){const s=i-e,u=((t-e)%s+s)%s+e;return u===e?i:u}function Ti(t,e,i){if(!t.length)return i(null,[]);let s=t.length;const u=new Array(t.length);let p=null;t.forEach((_,x)=>{e(_,(E,M)=>{E&&(p=E),u[x]=M,0==--s&&i(p,u)})})}function Xt(t){const e=[];for(const i in t)e.push(t[i]);return e}function Oe(t,...e){for(const i of e)for(const s in i)t[s]=i[s];return t}let ae=1;function Re(){return ae++}function lt(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Le(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Rt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function me(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function He(t,e){return-1!==t.indexOf(e,t.length-e.length)}function Ft(t,e,i){const s={};for(const u in t)s[u]=e.call(i||this,t[u],u,t);return s}function Qt(t,e,i){const s={};for(const u in t)e.call(i||this,t[u],u,t)&&(s[u]=t[u]);return s}function Jn(t){return Array.isArray(t)?t.map(Jn):"object"==typeof t&&t?Ft(t,Jn):t}const Ki={};function Di(t){Ki[t]||("undefined"!=typeof console&&console.warn(t),Ki[t]=!0)}function mi(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function ci(t){let e=0;for(let i,s,u=0,p=t.length,_=p-1;u<p;_=u++)i=t[u],s=t[_],e+=(s.x-i.x)*(i.y+s.y);return e}function xr(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Ii(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,u,p)=>{const _=u||p;return e[s]=!_||_.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let hr,yi,kr,gr=null;function Tr(t){if(null==gr){const e=t.navigator?t.navigator.userAgent:null;gr=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return gr}function Ci(t){try{const e=Q[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const Oi={now:()=>void 0!==kr?kr:Q.performance.now(),setNow(t){kr=t},restoreNow(){kr=void 0},frame(t){const e=Q.requestAnimationFrame(t);return{cancel:()=>Q.cancelAnimationFrame(e)}},getImageData(t,e=0){const i=Q.document.createElement("canvas"),s=i.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return i.width=t.width,i.height=t.height,s.drawImage(t,0,0,t.width,t.height),s.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(hr||(hr=Q.document.createElement("a")),hr.href=t,hr.href),get devicePixelRatio(){return Q.devicePixelRatio},get prefersReducedMotion(){return!!Q.matchMedia&&(null==yi&&(yi=Q.matchMedia("(prefers-reduced-motion: reduce)")),yi.matches)}};let K;const q={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==K){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{K=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{K=t}}return K},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},L={supported:!1,testSupport:function(t){!Ye&&we&&(pt?Ct(t):de=t)}};let de,we,Ye=!1,pt=!1;function Ct(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,we),t.isContextLost())return;L.supported=!0}catch{}t.deleteTexture(e),Ye=!0}Q.document&&(we=Q.document.createElement("img"),we.onload=function(){de&&Ct(de),de=null,pt=!0},we.onerror=function(){Ye=!0,de=null},we.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Je="01",Lt="NO_ACCESS_TOKEN";function en(t){return 0===t.indexOf("mapbox:")}function Gt(t){return q.API_URL_REGEX.test(t)}const At=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Pn(t){const e=t.match(At);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Vn(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function Yn(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Q.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class qn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Yn(q.ACCESS_TOKEN);let s="";return s=i&&i.u?Q.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(u,p)=>String.fromCharCode(Number("0x"+p)))):q.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=Ci("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const u=Q.localStorage.getItem(i);u&&(this.eventData=JSON.parse(u));const p=Q.localStorage.getItem(s);p&&(this.anonId=p)}catch{Di("Unable to read from LocalStorage")}}saveEventData(){const e=Ci("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{Q.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Q.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Di("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,s,u){if(!q.EVENTS_URL)return;const p=Pn(q.EVENTS_URL);p.params.push(`access_token=${u||q.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:J,skuId:Je,userId:this.anonId},x=i?Oe(_,i):_,E={url:Vn(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=to(E,M=>{this.pendingRequest=null,s(M),this.saveEventData(),this.processRequests(u)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const ni=new class extends qn{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){q.EVENTS_URL&&q.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>en(i)||Gt(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Yn(q.ACCESS_TOKEN),i=e?e.u:q.ACCESS_TOKEN;let s=i!==this.eventData.tokenU;Rt(this.anonId)||(this.anonId=lt(),s=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),_=new Date(u),x=(u-this.eventData.lastSuccess)/864e5;s=s||x>=1||x<-1||p.getDate()!==_.getDate()}else s=!0;if(!s)return this.processRequests();this.postEvent(u,{"enabled.telemetry":!1},p=>{p||(this.eventData.lastSuccess=u,this.eventData.tokenU=i)},t)}},Li=ni.postTurnstileEvent.bind(ni),Mi=new class extends qn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,s){this.skuToken=e,this.errorCb=s,q.EVENTS_URL&&(i||q.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Lt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Rt(this.anonId)||(this.anonId=lt()),this.postEvent(i,{skuToken:this.skuToken},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}},di=Mi.postMapLoadEvent.bind(Mi),En=new class extends qn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,s){if(!q.API_URL||!q.SESSION_PATH)return;const u=Pn(q.API_URL+q.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${s||q.ACCESS_TOKEN||""}`);const p={url:Vn(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Ie(p,_=>{this.pendingRequest=null,i(_),this.saveEventData(),this.processRequests(s)})}getSessionAPI(t,e,i,s){this.skuToken=e,this.errorCb=s,q.SESSION_PATH&&q.API_URL&&(i||q.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Lt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}},ti=En.getSessionAPI.bind(En),Yi=new Set,Ni="mapbox-tiles";let pr,oi,fr=500,or=50;function Sr(){Q.caches&&!pr&&(pr=Q.caches.open(Ni))}function wo(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}let xi=1/0;const io={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(io);class $r extends Error{constructor(e,i,s){401===i&&Gt(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const jr=xr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Q.location.protocol?Q.parent:Q).location.href,Pr=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(jr())&&!/^\w+:/.test(i))){if(Q.fetch&&Q.Request&&Q.AbortController&&Q.Request.prototype.hasOwnProperty("signal"))return function(s,u){const p=new Q.AbortController,_=new Q.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:jr(),signal:p.signal});let x=!1,E=!1;const M=(F=_.url).indexOf("sku=")>0&&Gt(F);var F;"json"===s.type&&_.headers.set("Accept","application/json");const U=(ce,ve,Ae)=>{if(E)return;if(ce&&"SecurityError"!==ce.message&&Di(ce),ve&&Ae)return V(ve);const Ve=Date.now();Q.fetch(_).then(Ke=>{if(Ke.ok){const dt=M?Ke.clone():null;return V(Ke,dt,Ve)}return u(new $r(Ke.statusText,Ke.status,s.url))}).catch(Ke=>{20!==Ke.code&&u(new Error(Ke.message))})},V=(ce,ve,Ae)=>{("arrayBuffer"===s.type?ce.arrayBuffer():"json"===s.type?ce.json():ce.text()).then(Ve=>{E||(ve&&Ae&&function(Ke,dt,bt){if(Sr(),!pr)return;const Mt={status:dt.status,statusText:dt.statusText,headers:new Q.Headers};dt.headers.forEach((Nt,gn)=>Mt.headers.set(gn,Nt));const Ot=Ii(dt.headers.get("Cache-Control")||"");Ot["no-store"]||(Ot["max-age"]&&Mt.headers.set("Expires",new Date(bt+1e3*Ot["max-age"]).toUTCString()),new Date(Mt.headers.get("Expires")).getTime()-bt<42e4||function(Nt,gn){if(void 0===oi)try{new Response(new ReadableStream),oi=!0}catch{oi=!1}oi?gn(Nt.body):Nt.blob().then(gn)}(dt,Nt=>{const gn=new Q.Response(Nt,Mt);Sr(),pr&&pr.then(hn=>hn.put(wo(Ke.url),gn)).catch(hn=>Di(hn.message))}))}(_,ve,Ae),x=!0,u(null,Ve,ce.headers.get("Cache-Control"),ce.headers.get("Expires")))}).catch(Ve=>{E||u(new Error(Ve.message))})};return M?function(ce,ve){if(Sr(),!pr)return ve(null);const Ae=wo(ce.url);pr.then(Ve=>{Ve.match(Ae).then(Ke=>{const dt=function(bt){if(!bt)return!1;const Mt=new Date(bt.headers.get("Expires")||0),Ot=Ii(bt.headers.get("Cache-Control")||"");return Mt>Date.now()&&!Ot["no-cache"]}(Ke);Ve.delete(Ae),dt&&Ve.put(Ae,Ke.clone()),ve(null,Ke,dt)}).catch(ve)}).catch(ve)}(_,U):U(null,null),{cancel:()=>{E=!0,x||p.abort()}}}(t,e);if(xr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(s,u){const p=new Q.XMLHttpRequest;p.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(p.responseType="arraybuffer");for(const _ in s.headers)p.setRequestHeader(_,s.headers[_]);return"json"===s.type&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials="include"===s.credentials,p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||0===p.status)&&null!==p.response){let _=p.response;if("json"===s.type)try{_=JSON.parse(p.response)}catch(x){return u(x)}u(null,_,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else u(new $r(p.statusText,p.status,s.url))},p.send(s.body),{cancel:()=>p.abort()}}(t,e)},Cr=function(t,e){return Pr(Oe(t,{type:"arrayBuffer"}),e)},to=function(t,e){return Pr(Oe(t,{method:"POST"}),e)},Ie=function(t,e){return Pr(Oe(t,{method:"GET"}),e)};function _e(t){const e=Q.document.createElement("a");return e.href=t,e.protocol===Q.document.location.protocol&&e.host===Q.document.location.host}const qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ct,Vt;ct=[],Vt=0;const Pt=function(t,e){if(L.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Vt>=q.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ct.push(p),p}Vt++;let i=!1;const s=()=>{if(!i)for(i=!0,Vt--;ct.length&&Vt<q.MAX_PARALLEL_IMAGE_REQUESTS;){const p=ct.shift(),{requestParameters:_,callback:x,cancelled:E}=p;E||(p.cancel=Pt(_,x).cancel)}},u=Cr(t,(p,_,x,E)=>{s(),p?e(p):_&&(Q.createImageBitmap?function(M,F){const U=new Q.Blob([new Uint8Array(M)],{type:"image/png"});Q.createImageBitmap(U).then(V=>{F(null,V)}).catch(V=>{F(new Error(`Could not load image because of ${V.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(M,F)=>e(M,F,x,E)):function(M,F){const U=new Q.Image,V=Q.URL;U.onload=()=>{F(null,U),V.revokeObjectURL(U.src),U.onload=null,Q.requestAnimationFrame(()=>{U.src=qe})},U.onerror=()=>F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const ce=new Q.Blob([new Uint8Array(M)],{type:"image/png"});U.src=M.byteLength?V.createObjectURL(ce):qe}(_,(M,F)=>e(M,F,x,E)))});return{cancel:()=>{u.cancel(),s()}}};function rn(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function fn(t,e,i){if(i&&i[t]){const s=i[t].indexOf(e);-1!==s&&i[t].splice(s,1)}}class un{constructor(e,i={}){Oe(this,i),this.type=e}}class Cn extends un{constructor(e,i={}){super("error",Oe({error:e},i))}}class Un{on(e,i){return this._listeners=this._listeners||{},rn(e,i,this._listeners),this}off(e,i){return fn(e,i,this._listeners),fn(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},rn(e,i,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,i){"string"==typeof e&&(e=new un(e,i||{}));const s=e.type;if(this.listens(s)){e.target=this;const u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const x of u)x.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const x of p)fn(s,x,this._oneTimeListeners),x.call(this,e);const _=this._eventedParent;_&&(Oe(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof Cn&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var St=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class on{constructor(e,i,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),null!=i&&i.__line__&&(this.line=i.__line__)}}function Ri(t){const e=t.value;return e?[new on(t.key,e,"constants have been deprecated as of v8")]:[]}function Ur(t,...e){for(const i of e)for(const s in i)t[s]=i[s];return t}function ji(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function _r(t){if(Array.isArray(t))return t.map(_r);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=_r(t[i]);return e}return ji(t)}class Qi extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Ao{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,u]of i)this.bindings[s]=u}concat(e){return new Ao(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const fo={kind:"null"},zn={kind:"number"},Gi={kind:"string"},Ai={kind:"boolean"},Lo={kind:"color"},nt={kind:"object"},Xe={kind:"value"},ke={kind:"collator"},Tt={kind:"formatted"},nn={kind:"resolvedImage"};function ii(t,e){return{kind:"array",itemType:t,N:e}}function hi(t){if("array"===t.kind){const e=hi(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const ro=[fo,zn,Gi,Ai,Lo,Tt,nt,ii(Xe),nn];function sr(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!sr(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const i of ro)if(!sr(i,e))return null}return`Expected ${hi(t)} but found ${hi(e)} instead.`}function ms(t,e){return e.some(i=>i.kind===t.kind)}function gs(t,e){return e.some(i=>"null"===i?null===t:"array"===i?Array.isArray(t):"object"===i?t&&!Array.isArray(t)&&"object"==typeof t:i===typeof t)}function Is(t){var e={exports:{}};return t(e,e.exports),e.exports}var Bo=Is(function(t,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(x){return(x=Math.round(x))<0?0:x>255?255:x}function u(x){return s("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function p(x){return(E="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:E>1?1:E;var E}function _(x,E,M){return M<0?M+=1:M>1&&(M-=1),6*M<1?x+(E-x)*M*6:2*M<1?E:3*M<2?x+(E-x)*(2/3-M)*6:x}try{e.parseCSSColor=function(x){var E,M=x.replace(/ /g,"").toLowerCase();if(M in i)return i[M].slice();if("#"===M[0])return 4===M.length?(E=parseInt(M.substr(1),16))>=0&&E<=4095?[(3840&E)>>4|(3840&E)>>8,240&E|(240&E)>>4,15&E|(15&E)<<4,1]:null:7===M.length&&(E=parseInt(M.substr(1),16))>=0&&E<=16777215?[(16711680&E)>>16,(65280&E)>>8,255&E,1]:null;var F=M.indexOf("("),U=M.indexOf(")");if(-1!==F&&U+1===M.length){var V=M.substr(0,F),ce=M.substr(F+1,U-(F+1)).split(","),ve=1;switch(V){case"rgba":if(4!==ce.length)return null;ve=p(ce.pop());case"rgb":return 3!==ce.length?null:[u(ce[0]),u(ce[1]),u(ce[2]),ve];case"hsla":if(4!==ce.length)return null;ve=p(ce.pop());case"hsl":if(3!==ce.length)return null;var Ae=(parseFloat(ce[0])%360+360)%360/360,Ve=p(ce[1]),Ke=p(ce[2]),dt=Ke<=.5?Ke*(Ve+1):Ke+Ve-Ke*Ve,bt=2*Ke-dt;return[s(255*_(bt,dt,Ae+1/3)),s(255*_(bt,dt,Ae)),s(255*_(bt,dt,Ae-1/3)),ve];default:return null}}return null}}catch{}});class zi{constructor(e,i,s,u=1){this.r=e,this.g=i,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof zi)return e;if("string"!=typeof e)return;const i=Bo.parseCSSColor(e);return i?new zi(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,s,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(s)},${u})`}toArray(){const{r:e,g:i,b:s,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*i/u,255*s/u,u]}}zi.black=new zi(0,0,0,1),zi.white=new zi(1,1,1,1),zi.transparent=new zi(0,0,0,0),zi.red=new zi(1,0,0,1),zi.blue=new zi(0,0,1,1);class Ls{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Xs{constructor(e,i,s,u,p){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=u,this.textColor=p}}class ki{constructor(e){this.sections=e}static fromString(e){return new ki([new Xs(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof ki?e:ki.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(s)}return e}}class oo{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new oo({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Jo(t,e,i,s){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[t,e,i,s]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ms(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof zi||t instanceof Ls||t instanceof ki||t instanceof oo)return!0;if(Array.isArray(t)){for(const e of t)if(!Ms(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!Ms(t[e]))return!1;return!0}return!1}function Gr(t){if(null===t)return fo;if("string"==typeof t)return Gi;if("boolean"==typeof t)return Ai;if("number"==typeof t)return zn;if(t instanceof zi)return Lo;if(t instanceof Ls)return ke;if(t instanceof ki)return Tt;if(t instanceof oo)return nn;if(Array.isArray(t)){const e=t.length;let i;for(const s of t){const u=Gr(s);if(i){if(i===u)continue;i=Xe;break}i=u}return ii(i||Xe,e)}return nt}function Vs(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof zi||t instanceof ki||t instanceof oo?t.toString():JSON.stringify(t)}class lo{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(2!==e.length)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ms(e[1]))return i.error("invalid value");const s=e[1];let u=Gr(s);const p=i.expectedType;return"array"!==u.kind||0!==u.N||!p||"array"!==p.kind||"number"==typeof p.N&&0!==p.N||(u=p),new lo(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof zi?["rgba"].concat(this.value.toArray()):this.value instanceof ki?this.value.serialize():this.value}}class Kr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const As={string:Gi,number:zn,boolean:Ai,object:nt};class To{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,u=1;const p=e[0];if("array"===p){let x,E;if(e.length>2){const M=e[1];if("string"!=typeof M||!(M in As)||"object"===M)return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=As[M],u++}else x=Xe;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);E=e[2],u++}s=ii(x,E)}else s=As[p];const _=[];for(;u<e.length;u++){const x=i.parse(e[u],u,Xe);if(!x)return null;_.push(x)}return new To(s,_)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!sr(this.type,Gr(s)))return s;if(i===this.args.length-1)throw new Kr(`Expected value to be of type ${hi(this.type)}, but found ${hi(Gr(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){i.push(s.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(s=>s.serialize()))}}class Co{constructor(e){this.type=Tt,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return i.error("First argument must be an image or text section.");const u=[];let p=!1;for(let _=1;_<=e.length-1;++_){const x=e[_];if(p&&"object"==typeof x&&!Array.isArray(x)){p=!1;let E=null;if(x["font-scale"]&&(E=i.parse(x["font-scale"],1,zn),!E))return null;let M=null;if(x["text-font"]&&(M=i.parse(x["text-font"],1,ii(Gi)),!M))return null;let F=null;if(x["text-color"]&&(F=i.parse(x["text-color"],1,Lo),!F))return null;const U=u[u.length-1];U.scale=E,U.font=M,U.textColor=F}else{const E=i.parse(e[_],1,Xe);if(!E)return null;const M=E.type.kind;if("string"!==M&&"value"!==M&&"null"!==M&&"resolvedImage"!==M)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:E,scale:null,font:null,textColor:null})}}return new Co(u)}evaluate(e){return new ki(this.sections.map(i=>{const s=i.content.evaluate(e);return Gr(s)===nn?new Xs("",s,null,null,null):new Xs(Vs(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class No{constructor(e){this.type=nn,this.input=e}static parse(e,i){if(2!==e.length)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Gi);return s?new No(s):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),s=oo.fromString(i);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(i)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const So={"to-boolean":Ai,"to-color":Lo,"to-number":zn,"to-string":Gi};class Xo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return i.error("Expected one argument.");const u=So[s],p=[];for(let _=1;_<e.length;_++){const x=i.parse(e[_],_,Xe);if(!x)return null;p.push(x)}return new Xo(u,p)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let i,s;for(const u of this.args){if(i=u.evaluate(e),s=null,i instanceof zi)return i;if("string"==typeof i){const p=e.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Jo(i[0],i[1],i[2],i[3]),!s))return new zi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Kr(s||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(const s of this.args){if(i=s.evaluate(e),null===i)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Kr(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?ki.fromString(Vs(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?oo.fromString(Vs(this.args[0].evaluate(e))):Vs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Co([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new No(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const ua=["Unknown","Point","LineString","Polygon"];class ee{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ua[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(u*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=zi.parse(e)),i}}class Ce{constructor(e,i,s,u){this.name=e,this.type=i,this._evaluate=s,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],u=Ce.definitions[s];if(!u)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=_.filter(([M])=>!Array.isArray(M)||M.length===e.length-1);let E=null;for(const[M,F]of x){E=new $s(i.registry,i.path,null,i.scope);const U=[];let V=!1;for(let ce=1;ce<e.length;ce++){const ve=e[ce],Ae=Array.isArray(M)?M[ce-1]:M.type,Ve=E.parse(ve,1+U.length,Ae);if(!Ve){V=!0;break}U.push(Ve)}if(!V)if(Array.isArray(M)&&M.length!==U.length)E.error(`Expected ${M.length} arguments, but found ${U.length} instead.`);else{for(let ce=0;ce<U.length;ce++){const ve=Array.isArray(M)?M[ce]:M.type,Ae=U[ce];E.concat(ce+1).checkSubtype(ve,Ae.type)}if(0===E.errors.length)return new Ce(s,p,F,U)}}if(1===x.length)i.errors.push(...E.errors);else{const M=(x.length?x:_).map(([U])=>{return V=U,Array.isArray(V)?`(${V.map(hi).join(", ")})`:`(${hi(V.type)}...)`;var V}).join(" | "),F=[];for(let U=1;U<e.length;U++){const V=i.parse(e[U],1+F.length);if(!V)return null;F.push(hi(V.type))}i.error(`Expected arguments of type ${M}, but found (${F.join(", ")}) instead.`)}return null}static register(e,i){Ce.definitions=i;for(const s in i)e[s]=Ce}}class te{constructor(e,i,s){this.type=ke,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(2!==e.length)return i.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return i.error("Collator options argument must be an object.");const u=i.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Ai);if(!u)return null;const p=i.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Ai);if(!p)return null;let _=null;return s.locale&&(_=i.parse(s.locale,1,Gi),!_)?null:new te(u,p,_)}evaluate(e){return new Ls(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Ne=8192;function Dt(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function sn(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Fn(t,e){const i=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*Ne),Math.round(s*u*Ne)]}function Hn(t,e,i){const s=t[0]-e[0],u=t[1]-e[1],p=t[0]-i[0],_=t[1]-i[1];return s*_-p*u==0&&s*p<=0&&u*_<=0}function Fr(t,e){let i=!1;for(let _=0,x=e.length;_<x;_++){const E=e[_];for(let M=0,F=E.length;M<F-1;M++){if(Hn(t,E[M],E[M+1]))return!1;(u=E[M])[1]>(s=t)[1]!=(p=E[M+1])[1]>s[1]&&s[0]<(p[0]-u[0])*(s[1]-u[1])/(p[1]-u[1])+u[0]&&(i=!i)}}var s,u,p;return i}function Er(t,e){for(let i=0;i<e.length;i++)if(Fr(t,e[i]))return!0;return!1}function Fi(t,e,i,s){const u=s[0]-i[0],p=s[1]-i[1],_=(t[0]-i[0])*p-u*(t[1]-i[1]),x=(e[0]-i[0])*p-u*(e[1]-i[1]);return _>0&&x<0||_<0&&x>0}function mr(t,e,i){for(const M of i)for(let F=0;F<M.length-1;++F)if((x=[(_=M[F+1])[0]-(p=M[F])[0],_[1]-p[1]])[0]*(E=[(u=e)[0]-(s=t)[0],u[1]-s[1]])[1]-x[1]*E[0]!=0&&Fi(s,u,p,_)&&Fi(p,_,s,u))return!0;var s,u,p,_,x,E;return!1}function co(t,e){for(let i=0;i<t.length;++i)if(!Fr(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(mr(t[i],t[i+1],e))return!1;return!0}function ie(t,e){for(let i=0;i<e.length;i++)if(co(t,e[i]))return!0;return!1}function W(t,e,i){const s=[];for(let u=0;u<t.length;u++){const p=[];for(let _=0;_<t[u].length;_++){const x=Fn(t[u][_],i);Dt(e,x),p.push(x)}s.push(p)}return s}function H(t,e,i){const s=[];for(let u=0;u<t.length;u++){const p=W(t[u],e,i);s.push(p)}return s}function Fe(t,e,i,s){if(t[0]<i[0]||t[0]>i[2]){const u=.5*s;let p=t[0]-i[0]>u?-s:i[0]-t[0]>u?s:0;0===p&&(p=t[0]-i[2]>u?-s:i[2]-t[0]>u?s:0),t[0]+=p}Dt(e,t)}function dn(t,e,i,s){const u=Math.pow(2,s.z)*Ne,p=[s.x*Ne,s.y*Ne],_=[];for(const x of t)for(const E of x){const M=[E.x+p[0],E.y+p[1]];Fe(M,e,i,u),_.push(M)}return _}function ei(t,e,i,s){const u=Math.pow(2,s.z)*Ne,p=[s.x*Ne,s.y*Ne],_=[];for(const E of t){const M=[];for(const F of E){const U=[F.x+p[0],F.y+p[1]];Dt(e,U),M.push(U)}_.push(M)}if(e[2]-e[0]<=u/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of _)for(const M of E)Fe(M,e,i,u)}var x;return _}class Or{constructor(e,i){this.type=Ai,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ms(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let u=0;u<s.features.length;++u){const p=s.features[u].geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new Or(s,s.features[u].geometry)}else if("Feature"===s.type){const u=s.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new Or(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new Or(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(i,s){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if("Polygon"===s.type){const x=W(s.coordinates,p,_),E=dn(i.geometry(),u,p,_);if(!sn(u,p))return!1;for(const M of E)if(!Fr(M,x))return!1}if("MultiPolygon"===s.type){const x=H(s.coordinates,p,_),E=dn(i.geometry(),u,p,_);if(!sn(u,p))return!1;for(const M of E)if(!Er(M,x))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(i,s){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if("Polygon"===s.type){const x=W(s.coordinates,p,_),E=ei(i.geometry(),u,p,_);if(!sn(u,p))return!1;for(const M of E)if(!co(M,x))return!1}if("MultiPolygon"===s.type){const x=H(s.coordinates,p,_),E=ei(i.geometry(),u,p,_);if(!sn(u,p))return!1;for(const M of E)if(!ie(M,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Rr(t){if(t instanceof Ce&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof Or)return!1;let e=!0;return t.eachChild(i=>{e&&!Rr(i)&&(e=!1)}),e}function Ko(t){if(t instanceof Ce&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(i=>{e&&!Ko(i)&&(e=!1)}),e}function zo(t,e){if(t instanceof Ce&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(s=>{i&&!zo(s,e)&&(i=!1)}),i}class cs{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(2!==e.length||"string"!=typeof e[1])return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new cs(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class $s{constructor(e,i=[],s,u=new Ao,p=[]){this.registry=e,this.path=i,this.key=i.map(_=>`[${_}]`).join(""),this.scope=u,this.errors=p,this.expectedType=s}parse(e,i,s,u,p={}){return i?this.concat(i,s,u)._parse(e,p):this._parse(e,p)}_parse(e,i){function s(u,p,_){return"assert"===_?new To(p,[u]):"coerce"===_?new Xo(p,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let _=p.parse(e,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,E=_.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==E.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(x,E))return null}else _=s(_,x,i.typeAnnotation||"coerce");else _=s(_,x,i.typeAnnotation||"assert")}if(!(_ instanceof lo)&&"resolvedImage"!==_.type.kind&&Ui(_)){const x=new ee;try{_=new lo(_.type,_.evaluate(x))}catch(E){return this.error(E.message),null}}return _}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s){const u="number"==typeof e?this.path.concat(e):this.path,p=s?this.scope.concat(s):this.scope;return new $s(this.registry,u,i||null,p,this.errors)}error(e,...i){const s=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new Qi(s,e))}checkSubtype(e,i){const s=sr(e,i);return s&&this.error(s),s}}function Ui(t){if(t instanceof cs)return Ui(t.boundExpression);if(t instanceof Ce&&"error"===t.name||t instanceof te||t instanceof Or)return!1;const e=t instanceof Xo||t instanceof To;let i=!0;return t.eachChild(s=>{i=e?i&&Ui(s):i&&s instanceof lo}),!!i&&Rr(t)&&zo(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Na(t,e){const i=t.length-1;let s,u,p=0,_=i,x=0;for(;p<=_;)if(x=Math.floor((p+_)/2),s=t[x],u=t[x+1],s<=e){if(x===i||e<u)return x;p=x+1}else{if(!(s>e))throw new Kr("Input is not a number.");_=x-1}return 0}class za{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,p]of s)this.labels.push(u),this.outputs.push(p)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,zn);if(!s)return null;const u=[];let p=null;i.expectedType&&"value"!==i.expectedType.kind&&(p=i.expectedType);for(let _=1;_<e.length;_+=2){const x=1===_?-1/0:e[_],E=e[_+1],M=_,F=_+1;if("number"!=typeof x)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(u.length&&u[u.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const U=i.parse(E,F,p);if(!U)return null;p=p||U.type,u.push([x,U])}return new za(p,s,u)}evaluate(e){const i=this.labels,s=this.outputs;if(1===i.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return s[0].evaluate(e);const p=i.length;return u>=i[p-1]?s[p-1].evaluate(e):s[Na(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}function yr(t,e,i){return t*(1-i)+e*i}var js=Object.freeze({__proto__:null,number:yr,color:function(t,e,i){return new zi(yr(t.r,e.r,i),yr(t.g,e.g,i),yr(t.b,e.b,i),yr(t.a,e.a,i))},array:function(t,e,i){return t.map((s,u)=>yr(s,e[u],i))}});const da=4/29,In=6/29,ar=3*In*In,Gs=Math.PI/180,Yr=180/Math.PI;function us(t){return t>.008856451679035631?Math.pow(t,1/3):t/ar+da}function Uo(t){return t>In?t*t*t:ar*(t-da)}function vo(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function rs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ha(t){const e=rs(t.r),i=rs(t.g),s=rs(t.b),u=us((.4124564*e+.3575761*i+.1804375*s)/.95047),p=us((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-us((.0193339*e+.119192*i+.9503041*s)/1.08883)),alpha:t.a}}function wc(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*Uo(e),i=.95047*Uo(i),s=1.08883*Uo(s),new zi(vo(3.2404542*i-1.5371385*e-.4985314*s),vo(-.969266*i+1.8760108*e+.041556*s),vo(.0556434*i-.2040259*e+1.0572252*s),t.alpha)}function ks(t,e,i){const s=e-t;return t+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const Po={forward:ha,reverse:wc,interpolate:function(t,e,i){return{l:yr(t.l,e.l,i),a:yr(t.a,e.a,i),b:yr(t.b,e.b,i),alpha:yr(t.alpha,e.alpha,i)}}},qs={forward:function(t){const{l:e,a:i,b:s}=ha(t),u=Math.atan2(s,i)*Yr;return{h:u<0?u+360:u,c:Math.sqrt(i*i+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Gs,i=t.c;return wc({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:ks(t.h,e.h,i),c:yr(t.c,e.c,i),l:yr(t.l,e.l,i),alpha:yr(t.alpha,e.alpha,i)}}};var Qo=Object.freeze({__proto__:null,lab:Po,hcl:qs});class Dr{constructor(e,i,s,u,p){this.type=e,this.operator=i,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[_,x]of p)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(e,i,s,u){let p=0;if("exponential"===e.name)p=_s(i,e.base,s,u);else if("linear"===e.name)p=_s(i,1,s,u);else if("cubic-bezier"===e.name){const _=e.controlPoints;p=new j(_[0],_[1],_[2],_[3]).solve(_s(i,1,s,u))}return p}static parse(e,i){let[s,u,p,..._]=e;if(!Array.isArray(u)||0===u.length)return i.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const M=u[1];if("number"!=typeof M)return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:M}}else{if("cubic-bezier"!==u[0])return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const M=u.slice(1);if(4!==M.length||M.some(F=>"number"!=typeof F||F<0||F>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:M}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,zn),!p)return null;const x=[];let E=null;"interpolate-hcl"===s||"interpolate-lab"===s?E=Lo:i.expectedType&&"value"!==i.expectedType.kind&&(E=i.expectedType);for(let M=0;M<_.length;M+=2){const F=_[M],U=_[M+1],V=M+3,ce=M+4;if("number"!=typeof F)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(x.length&&x[x.length-1][0]>=F)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const ve=i.parse(U,ce,E);if(!ve)return null;E=E||ve.type,x.push([F,ve])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new Dr(E,s,u,p,x):i.error(`Type ${hi(E)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(1===i.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return s[0].evaluate(e);const p=i.length;if(u>=i[p-1])return s[p-1].evaluate(e);const _=Na(i,u),x=Dr.interpolationFactor(this.interpolation,u,i[_],i[_+1]),E=s[_].evaluate(e),M=s[_+1].evaluate(e);return"interpolate"===this.operator?js[this.type.kind.toLowerCase()](E,M,x):"interpolate-hcl"===this.operator?qs.reverse(qs.interpolate(qs.forward(E),qs.forward(M),x)):Po.reverse(Po.interpolate(Po.forward(E),Po.forward(M),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function _s(t,e,i,s){const u=s-i,p=t-i;return 0===u?0:1===e?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}class Zo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const u=i.expectedType;u&&"value"!==u.kind&&(s=u);const p=[];for(const x of e.slice(1)){const E=i.parse(x,1+p.length,s,void 0,{typeAnnotation:"omit"});if(!E)return null;s=s||E.type,p.push(E)}const _=u&&p.some(x=>sr(u,x.type));return new Zo(_?Xe:s,p)}evaluate(e){let i,s=null,u=0;for(const p of this.args){if(u++,s=p.evaluate(e),s&&s instanceof oo&&!s.available&&(i||(i=s),s=null,u===this.args.length))return i;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class ys{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let p=1;p<e.length-1;p+=2){const _=e[p];if("string"!=typeof _)return i.error(`Expected string, but found ${typeof _} instead.`,p);if(/[^a-zA-Z0-9_]/.test(_))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=i.parse(e[p+1],p+1);if(!x)return null;s.push([_,x])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return u?new ys(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class dl{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,zn),u=i.parse(e[2],2,ii(i.expectedType||Xe));return s&&u?new dl(u.type.itemType,s,u):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new Kr(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new Kr(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new Kr(`Array index must be an integer, but found ${i} instead.`);return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class pa{constructor(e,i){this.type=Ai,this.needle=e,this.haystack=i}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Xe),u=i.parse(e[2],2,Xe);return s&&u?ms(s.type,[Ai,Gi,zn,fo,Xe])?new pa(s,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${hi(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!gs(i,["boolean","string","number","null"]))throw new Kr(`Expected first argument to be of type boolean, string, number or null, but found ${hi(Gr(i))} instead.`);if(!gs(s,["string","array"]))throw new Kr(`Expected second argument to be of type array or string, but found ${hi(Gr(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Vo{constructor(e,i,s){this.type=zn,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Xe),u=i.parse(e[2],2,Xe);if(!s||!u)return null;if(!ms(s.type,[Ai,Gi,zn,fo,Xe]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${hi(s.type)} instead`);if(4===e.length){const p=i.parse(e[3],3,zn);return p?new Vo(s,u,p):null}return new Vo(s,u)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!gs(i,["boolean","string","number","null"]))throw new Kr(`Expected first argument to be of type boolean, string, number or null, but found ${hi(Gr(i))} instead.`);if(!gs(s,["string","array"]))throw new Kr(`Expected second argument to be of type array or string, but found ${hi(Gr(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return s.indexOf(i,u)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class D{constructor(e,i,s,u,p,_){this.inputType=e,this.type=i,this.input=s,this.cases=u,this.outputs=p,this.otherwise=_}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,u;i.expectedType&&"value"!==i.expectedType.kind&&(u=i.expectedType);const p={},_=[];for(let M=2;M<e.length-1;M+=2){let F=e[M];const U=e[M+1];Array.isArray(F)||(F=[F]);const V=i.concat(M);if(0===F.length)return V.error("Expected at least one branch label.");for(const ve of F){if("number"!=typeof ve&&"string"!=typeof ve)return V.error("Branch labels must be numbers or strings.");if("number"==typeof ve&&Math.abs(ve)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof ve&&Math.floor(ve)!==ve)return V.error("Numeric branch labels must be integer values.");if(s){if(V.checkSubtype(s,Gr(ve)))return null}else s=Gr(ve);if(void 0!==p[String(ve)])return V.error("Branch labels must be unique.");p[String(ve)]=_.length}const ce=i.parse(U,M,u);if(!ce)return null;u=u||ce.type,_.push(ce)}const x=i.parse(e[1],1,Xe);if(!x)return null;const E=i.parse(e[e.length-1],e.length-1,u);return E?"value"!==x.type.kind&&i.concat(1).checkSubtype(s,x.type)?null:new D(s,u,x,p,_,E):null}evaluate(e){const i=this.input.evaluate(e);return(Gr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],u={};for(const _ of i){const x=u[this.cases[_]];void 0===x?(u[this.cases[_]]=s.length,s.push([this.cases[_],[_]])):s[x][1].push(_)}const p=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,x]of s)e.push(1===x.length?p(x[0]):x.map(p)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class N{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&"value"!==i.expectedType.kind&&(s=i.expectedType);const u=[];for(let _=1;_<e.length-1;_+=2){const x=i.parse(e[_],_,Ai);if(!x)return null;const E=i.parse(e[_+1],_+1,s);if(!E)return null;u.push([x,E]),s=s||E.type}const p=i.parse(e[e.length-1],e.length-1,s);return p?new N(s,u,p):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class A{constructor(e,i,s,u){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Xe),u=i.parse(e[2],2,zn);if(!s||!u)return null;if(!ms(s.type,[ii(Xe),Gi,Xe]))return i.error(`Expected first argument to be of type array or string, but found ${hi(s.type)} instead`);if(4===e.length){const p=i.parse(e[3],3,zn);return p?new A(s.type,s,u,p):null}return new A(s.type,s,u)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!gs(i,["string","array"]))throw new Kr(`Expected first argument to be of type array or string, but found ${hi(Gr(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(s,u)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function re(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function De(t,e,i,s){return 0===s.compare(e,i)}function kt(t,e,i){const s="=="!==t&&"!="!==t;return class E0{constructor(p,_,x){this.type=Ai,this.lhs=p,this.rhs=_,this.collator=x,this.hasUntypedArgument="value"===p.type.kind||"value"===_.type.kind}static parse(p,_){if(3!==p.length&&4!==p.length)return _.error("Expected two or three arguments.");const x=p[0];let E=_.parse(p[1],1,Xe);if(!E)return null;if(!re(x,E.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${hi(E.type)}'.`);let M=_.parse(p[2],2,Xe);if(!M)return null;if(!re(x,M.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${hi(M.type)}'.`);if(E.type.kind!==M.type.kind&&"value"!==E.type.kind&&"value"!==M.type.kind)return _.error(`Cannot compare types '${hi(E.type)}' and '${hi(M.type)}'.`);s&&("value"===E.type.kind&&"value"!==M.type.kind?E=new To(M.type,[E]):"value"!==E.type.kind&&"value"===M.type.kind&&(M=new To(E.type,[M])));let F=null;if(4===p.length){if("string"!==E.type.kind&&"string"!==M.type.kind&&"value"!==E.type.kind&&"value"!==M.type.kind)return _.error("Cannot use collator to compare non-string types.");if(F=_.parse(p[3],3,ke),!F)return null}return new E0(E,M,F)}evaluate(p){const _=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(s&&this.hasUntypedArgument){const E=Gr(_),M=Gr(x);if(E.kind!==M.kind||"string"!==E.kind&&"number"!==E.kind)throw new Kr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${E.kind}, ${M.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const E=Gr(_),M=Gr(x);if("string"!==E.kind||"string"!==M.kind)return e(p,_,x)}return this.collator?i(p,_,x,this.collator.evaluate(p)):e(p,_,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[t];return this.eachChild(_=>{p.push(_.serialize())}),p}}}const Rn=kt("==",function(t,e,i){return e===i},De),Xn=kt("!=",function(t,e,i){return e!==i},function(t,e,i,s){return!De(0,e,i,s)}),Wi=kt("<",function(t,e,i){return e<i},function(t,e,i,s){return s.compare(e,i)<0}),pi=kt(">",function(t,e,i){return e>i},function(t,e,i,s){return s.compare(e,i)>0}),lr=kt("<=",function(t,e,i){return e<=i},function(t,e,i,s){return s.compare(e,i)<=0}),so=kt(">=",function(t,e,i){return e>=i},function(t,e,i,s){return s.compare(e,i)>=0});class Lr{constructor(e,i,s,u,p){this.type=Gi,this.number=e,this.locale=i,this.currency=s,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,i){if(3!==e.length)return i.error("Expected two arguments.");const s=i.parse(e[1],1,zn);if(!s)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=i.parse(u.locale,1,Gi),!p))return null;let _=null;if(u.currency&&(_=i.parse(u.currency,1,Gi),!_))return null;let x=null;if(u["min-fraction-digits"]&&(x=i.parse(u["min-fraction-digits"],1,zn),!x))return null;let E=null;return u["max-fraction-digits"]&&(E=i.parse(u["max-fraction-digits"],1,zn),!E)?null:new Lr(s,p,_,x,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class xo{constructor(e){this.type=zn,this.input=e}static parse(e,i){if(2!==e.length)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?i.error(`Expected argument of type string or array, but found ${hi(s.type)} instead.`):new xo(s):null}evaluate(e){const i=this.input.evaluate(e);if("string"==typeof i||Array.isArray(i))return i.length;throw new Kr(`Expected value to be of type string or array, but found ${hi(Gr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Eo={"==":Rn,"!=":Xn,">":pi,"<":Wi,">=":so,"<=":lr,array:To,at:dl,boolean:To,case:N,coalesce:Zo,collator:te,format:Co,image:No,in:pa,"index-of":Vo,interpolate:Dr,"interpolate-hcl":Dr,"interpolate-lab":Dr,length:xo,let:ys,literal:lo,match:D,number:To,"number-format":Lr,object:To,slice:A,step:za,string:To,"to-boolean":Xo,"to-color":Xo,"to-number":Xo,"to-string":Xo,var:cs,within:Or};function uo(t,[e,i,s,u]){e=e.evaluate(t),i=i.evaluate(t),s=s.evaluate(t);const p=u?u.evaluate(t):1,_=Jo(e,i,s,p);if(_)throw new Kr(_);return new zi(e/255*p,i/255*p,s/255*p,p)}function Ss(t,e){return t in e}function Jr(t,e){const i=e[t];return void 0===i?null:i}function fa(t){return{type:t}}function Tc(t){return{result:"success",value:t}}function ma(t){return{result:"error",value:t}}function hl(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Yc(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Cc(t){return!!t.expression&&t.expression.interpolated}function cr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Ua(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function ga(t){return t}function Da(t,e){const i="color"===e.type,s=t.stops&&"object"==typeof t.stops[0][0],u=s||!(s||void 0!==t.property),p=t.type||(Cc(e)?"exponential":"interval");if(i&&((t=Ur({},t)).stops&&(t.stops=t.stops.map(M=>[M[0],zi.parse(M[1])])),t.default=zi.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Qo[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let _,x,E;if("exponential"===p)_=Za;else if("interval"===p)_=Qs;else if("categorical"===p){_=tc,x=Object.create(null);for(const M of t.stops)x[M[0]]=M[1];E=typeof t.stops[0][0]}else{if("identity"!==p)throw new Error(`Unknown function type "${p}"`);_=Mu}if(s){const M={},F=[];for(let ce=0;ce<t.stops.length;ce++){const ve=t.stops[ce],Ae=ve[0].zoom;void 0===M[Ae]&&(M[Ae]={zoom:Ae,type:t.type,property:t.property,default:t.default,stops:[]},F.push(Ae)),M[Ae].stops.push([ve[0].value,ve[1]])}const U=[];for(const ce of F)U.push([M[ce].zoom,Da(M[ce],e)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:Dr.interpolationFactor.bind(void 0,V),zoomStops:U.map(ce=>ce[0]),evaluate:({zoom:ce},ve)=>Za({stops:U,base:t.base},e,ce).evaluate(ce,ve)}}if(u){const M="exponential"===p?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Dr.interpolationFactor.bind(void 0,M),zoomStops:t.stops.map(F=>F[0]),evaluate:({zoom:F})=>_(t,e,F,x,E)}}return{kind:"source",evaluate(M,F){const U=F&&F.properties?F.properties[t.property]:void 0;return void 0===U?$o(t.default,e.default):_(t,e,U,x,E)}}}function $o(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function tc(t,e,i,s,u){return $o(typeof i===u?s[i]:void 0,t.default,e.default)}function Qs(t,e,i){if("number"!==cr(i))return $o(t.default,e.default);const s=t.stops.length;if(1===s||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[s-1][0])return t.stops[s-1][1];const u=Na(t.stops.map(p=>p[0]),i);return t.stops[u][1]}function Za(t,e,i){const s=void 0!==t.base?t.base:1;if("number"!==cr(i))return $o(t.default,e.default);const u=t.stops.length;if(1===u||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[u-1][0])return t.stops[u-1][1];const p=Na(t.stops.map(F=>F[0]),i),_=function(F,U,V,ce){const ve=ce-V,Ae=F-V;return 0===ve?0:1===U?Ae/ve:(Math.pow(U,Ae)-1)/(Math.pow(U,ve)-1)}(i,s,t.stops[p][0],t.stops[p+1][0]),x=t.stops[p][1],E=t.stops[p+1][1];let M=js[e.type]||ga;if(t.colorSpace&&"rgb"!==t.colorSpace){const F=Qo[t.colorSpace];M=(U,V)=>F.reverse(F.interpolate(F.forward(U),F.forward(V),_))}return"function"==typeof x.evaluate?{evaluate(...F){const U=x.evaluate.apply(void 0,F),V=E.evaluate.apply(void 0,F);if(void 0!==U&&void 0!==V)return M(U,V,_)}}:M(x,E,_)}function Mu(t,e,i){return"color"===e.type?i=zi.parse(i):"formatted"===e.type?i=ki.fromString(i.toString()):"resolvedImage"===e.type?i=oo.fromString(i.toString()):cr(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),$o(i,t.default,e.default)}Ce.register(Eo,{error:[{kind:"error"},[Gi],(t,[e])=>{throw new Kr(e.evaluate(t))}],typeof:[Gi,[Xe],(t,[e])=>hi(Gr(e.evaluate(t)))],"to-rgba":[ii(zn,4),[Lo],(t,[e])=>e.evaluate(t).toArray()],rgb:[Lo,[zn,zn,zn],uo],rgba:[Lo,[zn,zn,zn,zn],uo],has:{type:Ai,overloads:[[[Gi],(t,[e])=>Ss(e.evaluate(t),t.properties())],[[Gi,nt],(t,[e,i])=>Ss(e.evaluate(t),i.evaluate(t))]]},get:{type:Xe,overloads:[[[Gi],(t,[e])=>Jr(e.evaluate(t),t.properties())],[[Gi,nt],(t,[e,i])=>Jr(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Xe,[Gi],(t,[e])=>Jr(e.evaluate(t),t.featureState||{})],properties:[nt,[],t=>t.properties()],"geometry-type":[Gi,[],t=>t.geometryType()],id:[Xe,[],t=>t.id()],zoom:[zn,[],t=>t.globals.zoom],pitch:[zn,[],t=>t.globals.pitch||0],"distance-from-center":[zn,[],t=>t.distanceFromCenter()],"heatmap-density":[zn,[],t=>t.globals.heatmapDensity||0],"line-progress":[zn,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[zn,[],t=>t.globals.skyRadialProgress||0],accumulated:[Xe,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[zn,fa(zn),(t,e)=>{let i=0;for(const s of e)i+=s.evaluate(t);return i}],"*":[zn,fa(zn),(t,e)=>{let i=1;for(const s of e)i*=s.evaluate(t);return i}],"-":{type:zn,overloads:[[[zn,zn],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[zn],(t,[e])=>-e.evaluate(t)]]},"/":[zn,[zn,zn],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[zn,[zn,zn],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[zn,[],()=>Math.LN2],pi:[zn,[],()=>Math.PI],e:[zn,[],()=>Math.E],"^":[zn,[zn,zn],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[zn,[zn],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[zn,[zn],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[zn,[zn],(t,[e])=>Math.log(e.evaluate(t))],log2:[zn,[zn],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[zn,[zn],(t,[e])=>Math.sin(e.evaluate(t))],cos:[zn,[zn],(t,[e])=>Math.cos(e.evaluate(t))],tan:[zn,[zn],(t,[e])=>Math.tan(e.evaluate(t))],asin:[zn,[zn],(t,[e])=>Math.asin(e.evaluate(t))],acos:[zn,[zn],(t,[e])=>Math.acos(e.evaluate(t))],atan:[zn,[zn],(t,[e])=>Math.atan(e.evaluate(t))],min:[zn,fa(zn),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[zn,fa(zn),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[zn,[zn],(t,[e])=>Math.abs(e.evaluate(t))],round:[zn,[zn],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[zn,[zn],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[zn,[zn],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Ai,[Gi,Xe],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Ai,[Xe],(t,[e])=>t.id()===e.value],"filter-type-==":[Ai,[Gi],(t,[e])=>t.geometryType()===e.value],"filter-<":[Ai,[Gi,Xe],(t,[e,i])=>{const s=t.properties()[e.value],u=i.value;return typeof s==typeof u&&s<u}],"filter-id-<":[Ai,[Xe],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[Ai,[Gi,Xe],(t,[e,i])=>{const s=t.properties()[e.value],u=i.value;return typeof s==typeof u&&s>u}],"filter-id->":[Ai,[Xe],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[Ai,[Gi,Xe],(t,[e,i])=>{const s=t.properties()[e.value],u=i.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[Ai,[Xe],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[Ai,[Gi,Xe],(t,[e,i])=>{const s=t.properties()[e.value],u=i.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[Ai,[Xe],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[Ai,[Xe],(t,[e])=>e.value in t.properties()],"filter-has-id":[Ai,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Ai,[ii(Gi)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Ai,[ii(Xe)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Ai,[Gi,ii(Xe)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Ai,[Gi,ii(Xe)],(t,[e,i])=>function(s,u,p,_){for(;p<=_;){const x=p+_>>1;if(u[x]===s)return!0;u[x]>s?_=x-1:p=x+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Ai,overloads:[[[Ai,Ai],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[fa(Ai),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Ai,overloads:[[[Ai,Ai],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[fa(Ai),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Ai,[Ai],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Ai,[Gi],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Gi,[Gi],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Gi,[Gi],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Gi,fa(Xe),(t,e)=>e.map(i=>Vs(i.evaluate(t))).join("")],"resolved-locale":[Gi,[ke],(t,[e])=>e.evaluate(t).resolvedLocale()]});class Ec{constructor(e,i){var s;this.expression=e,this._warningHistory={},this._evaluator=new ee,this._defaultValue=i?"color"===(s=i).type&&Ua(s.default)?new zi(0,0,0,0):"color"===s.type?zi.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(e,i,s,u,p,_,x,E){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,u,p,_,x,E){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null;try{const M=this.expression.evaluate(this._evaluator);if(null==M||"number"==typeof M&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Kr(`Expected value to be one of ${Object.keys(this._enumValues).map(F=>JSON.stringify(F)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,"undefined"!=typeof console&&console.warn(M.message)),this._defaultValue}}}function ea(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Eo}function Va(t,e){const i=new $s(Eo,[],e?function(u){const p={color:Lo,string:Gi,number:zn,enum:Gi,boolean:Ai,formatted:Tt,resolvedImage:nn};return"array"===u.type?ii(p[u.value]||Xe,u.length):p[u.type]}(e):void 0),s=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?Tc(new Ec(s,e)):ma(i.errors)}class pl{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent="constant"!==e&&!Ko(i.expression)}evaluateWithoutErrorHandling(e,i,s,u,p,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,u,p,_)}evaluate(e,i,s,u,p,_){return this._styleExpression.evaluate(e,i,s,u,p,_)}}class Dc{constructor(e,i,s,u){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent="camera"!==e&&!Ko(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,s,u,p,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,u,p,_)}evaluate(e,i,s,u,p,_){return this._styleExpression.evaluate(e,i,s,u,p,_)}interpolationFactor(e,i,s){return this.interpolationType?Dr.interpolationFactor(this.interpolationType,e,i,s):0}}function Au(t,e){if("error"===(t=Va(t,e)).result)return t;const i=t.value.expression,s=Rr(i);if(!s&&!hl(e))return ma([new Qi("","data expressions not supported")]);const u=zo(i,["zoom","pitch","distance-from-center"]);if(!u&&!Yc(e))return ma([new Qi("","zoom expressions not supported")]);const p=$a(i);return p||u?p instanceof Qi?ma([p]):p instanceof Dr&&!Cc(e)?ma([new Qi("",'"interpolate" expressions cannot be used with this property')]):Tc(p?new Dc(s?"camera":"composite",t.value,p.labels,p instanceof Dr?p.interpolation:void 0):new pl(s?"constant":"source",t.value)):ma([new Qi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class jo{constructor(e,i){this._parameters=e,this._specification=i,Ur(this,Da(this._parameters,this._specification))}static deserialize(e){return new jo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function $a(t){let e=null;if(t instanceof ys)e=$a(t.result);else if(t instanceof Zo){for(const i of t.args)if(e=$a(i),e)break}else(t instanceof za||t instanceof Dr)&&t.input instanceof Ce&&"zoom"===t.input.name&&(e=t);return e instanceof Qi||t.eachChild(i=>{const s=$a(i);s instanceof Qi?e=s:!e&&s?e=new Qi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Qi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function os(t){const e=t.key,i=t.value,s=t.valueSpec||{},u=t.objectElementValidators||{},p=t.style,_=t.styleSpec;let x=[];const E=cr(i);if("object"!==E)return[new on(e,i,`object expected, ${E} found`)];for(const M in i){const F=M.split(".")[0],U=s[F]||s["*"];let V;if(u[F])V=u[F];else if(s[F])V=G;else if(u["*"])V=u["*"];else{if(!s["*"]){x.push(new on(e,i[M],`unknown property "${M}"`));continue}V=G}x=x.concat(V({key:(e&&`${e}.`)+M,value:i[M],valueSpec:U,style:p,styleSpec:_,object:i,objectKey:M},i))}for(const M in s)u[M]||s[M].required&&void 0===s[M].default&&void 0===i[M]&&x.push(new on(e,i,`missing required property "${M}"`));return x}function Ia(t){const e=t.value,i=t.valueSpec,s=t.style,u=t.styleSpec,p=t.key,_=t.arrayElementValidator||G;if("array"!==cr(e))return[new on(p,e,`array expected, ${cr(e)} found`)];if(i.length&&e.length!==i.length)return[new on(p,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new on(p,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let x={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum};u.$version<7&&(x.function=i.function),"object"===cr(i.value)&&(x=i.value);let E=[];for(let M=0;M<e.length;M++)E=E.concat(_({array:e,arrayIndex:M,value:e[M],valueSpec:x,style:s,styleSpec:u,key:`${p}[${M}]`}));return E}function ja(t){const e=t.key,i=t.value,s=t.valueSpec;let u=cr(i);if("number"===u&&i!=i&&(u="NaN"),"number"!==u)return[new on(e,i,`number expected, ${u} found`)];if("minimum"in s){let p=s.minimum;if("array"===cr(s.minimum)&&(p=s.minimum[t.arrayIndex]),i<p)return[new on(e,i,`${i} is less than the minimum value ${p}`)]}if("maximum"in s){let p=s.maximum;if("array"===cr(s.maximum)&&(p=s.maximum[t.arrayIndex]),i>p)return[new on(e,i,`${i} is greater than the maximum value ${p}`)]}return[]}function ta(t){const e=t.valueSpec,i=ji(t.value.type);let s,u,p,_={};const x="categorical"!==i&&void 0===t.value.property,E=!x,M="array"===cr(t.value.stops)&&"array"===cr(t.value.stops[0])&&"object"===cr(t.value.stops[0][0]),F=os({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(ce){if("identity"===i)return[new on(ce.key,ce.value,'identity function may not have a "stops" property')];let ve=[];const Ae=ce.value;return ve=ve.concat(Ia({key:ce.key,value:Ae,valueSpec:ce.valueSpec,style:ce.style,styleSpec:ce.styleSpec,arrayElementValidator:U})),"array"===cr(Ae)&&0===Ae.length&&ve.push(new on(ce.key,Ae,"array must have at least one stop")),ve},default:function(ce){return G({key:ce.key,value:ce.value,valueSpec:e,style:ce.style,styleSpec:ce.styleSpec})}}});return"identity"===i&&x&&F.push(new on(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||F.push(new on(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!Cc(t.valueSpec)&&F.push(new on(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(E&&!hl(t.valueSpec)?F.push(new on(t.key,t.value,"property functions not supported")):x&&!Yc(t.valueSpec)&&F.push(new on(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!M||void 0!==t.value.property||F.push(new on(t.key,t.value,'"property" property is required')),F;function U(ce){let ve=[];const Ae=ce.value,Ve=ce.key;if("array"!==cr(Ae))return[new on(Ve,Ae,`array expected, ${cr(Ae)} found`)];if(2!==Ae.length)return[new on(Ve,Ae,`array length 2 expected, length ${Ae.length} found`)];if(M){if("object"!==cr(Ae[0]))return[new on(Ve,Ae,`object expected, ${cr(Ae[0])} found`)];if(void 0===Ae[0].zoom)return[new on(Ve,Ae,"object stop key must have zoom")];if(void 0===Ae[0].value)return[new on(Ve,Ae,"object stop key must have value")];if(p&&p>ji(Ae[0].zoom))return[new on(Ve,Ae[0].zoom,"stop zoom values must appear in ascending order")];ji(Ae[0].zoom)!==p&&(p=ji(Ae[0].zoom),u=void 0,_={}),ve=ve.concat(os({key:`${Ve}[0]`,value:Ae[0],valueSpec:{zoom:{}},style:ce.style,styleSpec:ce.styleSpec,objectElementValidators:{zoom:ja,value:V}}))}else ve=ve.concat(V({key:`${Ve}[0]`,value:Ae[0],valueSpec:{},style:ce.style,styleSpec:ce.styleSpec},Ae));return ea(_r(Ae[1]))?ve.concat([new on(`${Ve}[1]`,Ae[1],"expressions are not allowed in function stops.")]):ve.concat(G({key:`${Ve}[1]`,value:Ae[1],valueSpec:e,style:ce.style,styleSpec:ce.styleSpec}))}function V(ce,ve){const Ae=cr(ce.value),Ve=ji(ce.value),Ke=null!==ce.value?ce.value:ve;if(s){if(Ae!==s)return[new on(ce.key,Ke,`${Ae} stop domain type must match previous stop domain type ${s}`)]}else s=Ae;if("number"!==Ae&&"string"!==Ae&&"boolean"!==Ae)return[new on(ce.key,Ke,"stop domain value must be a number, string, or boolean")];if("number"!==Ae&&"categorical"!==i){let dt=`number expected, ${Ae} found`;return hl(e)&&void 0===i&&(dt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new on(ce.key,Ke,dt)]}return"categorical"!==i||"number"!==Ae||isFinite(Ve)&&Math.floor(Ve)===Ve?"categorical"!==i&&"number"===Ae&&void 0!==u&&Ve<u?[new on(ce.key,Ke,"stop domain values must appear in ascending order")]:(u=Ve,"categorical"===i&&Ve in _?[new on(ce.key,Ke,"stop domain values must be unique")]:(_[Ve]=!0,[])):[new on(ce.key,Ke,`integer expected, found ${Ve}`)]}}function na(t){const e=("property"===t.expressionContext?Au:Va)(_r(t.value),t.valueSpec);if("error"===e.result)return e.value.map(s=>new on(`${t.key}${s.key}`,t.value,s.message));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new on(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Ko(i))return[new on(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return Ma(i,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!zo(i,["zoom","feature-state"]))return[new on(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Rr(i))return[new on(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ma(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const u of e.valueSpec.expression.parameters)i.delete(u);if(0===i.size)return[];const s=[];return t instanceof Ce&&i.has(t.name)?[new on(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(u=>{s.push(...Ma(u,e))}),s)}function Pl(t){const e=t.key,i=t.value,s=t.valueSpec,u=[];return Array.isArray(s.values)?-1===s.values.indexOf(ji(i))&&u.push(new on(e,i,`expected one of [${s.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(s.values).indexOf(ji(i))&&u.push(new on(e,i,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function _a(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!_a(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Ga(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};_a(t)||(t=Pa(t));const i=t;let s=!0;try{s=function(M){if(!fl(M))return M;let F=_r(M);return Ic(F),F=Aa(F),F}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const u=St[`filter_${e}`],p=Va(s,u);let _=null;if("error"===p.result)throw new Error(p.value.map(M=>`${M.key}: ${M.message}`).join(", "));_=(M,F,U)=>p.value.evaluate(M,F,{},U);let x=null,E=null;if(s!==i){const M=Va(i,u);if("error"===M.result)throw new Error(M.value.map(F=>`${F.key}: ${F.message}`).join(", "));x=(F,U,V,ce,ve)=>M.value.evaluate(F,U,{},V,void 0,void 0,ce,ve),E=!Rr(M.value.expression)}return _=_,{filter:_,dynamicFilter:x||void 0,needGeometry:Mc(s),needFeature:!!E}}function Aa(t){if(!Array.isArray(t))return t;const e=function(i){if(Sa.has(i[0]))for(let s=1;s<i.length;s++)if(fl(i[s]))return!0;return i}(t);return!0===e?e:e.map(i=>Aa(i))}function Ic(t){let e=!1;const i=[];if("case"===t[0]){for(let s=1;s<t.length-1;s+=2)e=e||fl(t[s]),i.push(t[s+1]);i.push(t[t.length-1])}else if("match"===t[0]){e=e||fl(t[1]);for(let s=2;s<t.length-1;s+=2)i.push(t[s+1]);i.push(t[t.length-1])}else if("step"===t[0]){e=e||fl(t[1]);for(let s=1;s<t.length-1;s+=2)i.push(t[s+1])}e&&(t.length=0,t.push("any",...i));for(let s=1;s<t.length;s++)Ic(t[s])}function fl(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let i=1;i<t.length;i++)if(fl(t[i]))return!0;return!1}const Sa=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Jc(t,e){return t<e?-1:t>e?1:0}function Mc(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Mc(t[e]))return!0;return!1}function Pa(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Ol(t[1],t[2],"=="):"!="===e?qa(Ol(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Ol(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(Pa))):"all"===e?["all"].concat(t.slice(1).map(Pa)):"none"===e?["all"].concat(t.slice(1).map(Pa).map(qa)):"in"===e?nc(t[1],t.slice(2)):"!in"===e?qa(nc(t[1],t.slice(2))):"has"===e?Rl(t[1]):"!has"===e?qa(Rl(t[1])):"within"!==e||t;var i}function Ol(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function nc(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Jc)]]:["filter-in-small",t,["literal",e]]}}function Rl(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function qa(t){return["!",t]}function ic(t){if(_a(_r(t.value))){const e=_r(t.layerType);return na(Ur({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${e||"fill"}`]}))}return Ac(t)}function Ac(t){const e=t.value,i=t.key;if("array"!==cr(e))return[new on(i,e,`array expected, ${cr(e)} found`)];const s=t.styleSpec;let u,p=[];if(e.length<1)return[new on(i,e,"filter array must have at least 1 element")];switch(p=p.concat(Pl({key:`${i}[0]`,value:e[0],valueSpec:s.filter_operator,style:t.style,styleSpec:t.styleSpec})),ji(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===ji(e[1])&&p.push(new on(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&p.push(new on(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=cr(e[1]),"string"!==u&&p.push(new on(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let _=2;_<e.length;_++)u=cr(e[_]),"$type"===ji(e[1])?p=p.concat(Pl({key:`${i}[${_}]`,value:e[_],valueSpec:s.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&p.push(new on(`${i}[${_}]`,e[_],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)p=p.concat(Ac({key:`${i}[${_}]`,value:e[_],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":u=cr(e[1]),2!==e.length?p.push(new on(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&p.push(new on(`${i}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=cr(e[1]),2!==e.length?p.push(new on(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&p.push(new on(`${i}[1]`,e[1],`object expected, ${u} found`))}return p}function ml(t,e){const i=t.key,s=t.style,u=t.styleSpec,p=t.value,_=t.objectKey,x=u[`${e}_${t.layerType}`];if(!x)return[];const E=_.match(/^(.*)-transition$/);if("paint"===e&&E&&x[E[1]]&&x[E[1]].transition)return G({key:i,value:p,valueSpec:u.transition,style:s,styleSpec:u});const M=t.valueSpec||x[_];if(!M)return[new on(i,p,`unknown property "${_}"`)];let F;if("string"===cr(p)&&hl(M)&&!M.tokens&&(F=/^{([^}]+)}$/.exec(p)))return[new on(i,p,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];const U=[];return"symbol"===t.layerType&&("text-field"===_&&s&&!s.glyphs&&U.push(new on(i,p,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&Ua(_r(p))&&"identity"===ji(p.type)&&U.push(new on(i,p,'"text-font" does not support identity functions'))),U.concat(G({key:t.key,value:p,valueSpec:M,style:s,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:_}))}function Sc(t){return ml(t,"paint")}function Ll(t){return ml(t,"layout")}function kl(t){let e=[];const i=t.value,s=t.key,u=t.style,p=t.styleSpec;i.type||i.ref||e.push(new on(s,i,'either "type" or "ref" is required'));let _=ji(i.type);const x=ji(i.ref);if(i.id){const E=ji(i.id);for(let M=0;M<t.arrayIndex;M++){const F=u.layers[M];ji(F.id)===E&&e.push(new on(s,i.id,`duplicate layer id "${i.id}", previously used at line ${F.id.__line__}`))}}if("ref"in i){let E;["type","source","source-layer","filter","layout"].forEach(M=>{M in i&&e.push(new on(s,i[M],`"${M}" is prohibited for ref layers`))}),u.layers.forEach(M=>{ji(M.id)===x&&(E=M)}),E?E.ref?e.push(new on(s,i.ref,"ref cannot reference another ref layer")):_=ji(E.type):e.push(new on(s,i.ref,`ref layer "${x}" not found`))}else if("background"!==_&&"sky"!==_)if(i.source){const E=u.sources&&u.sources[i.source],M=E&&ji(E.type);E?"vector"===M&&"raster"===_?e.push(new on(s,i.source,`layer "${i.id}" requires a raster source`)):"raster"===M&&"raster"!==_?e.push(new on(s,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==M||i["source-layer"]?"raster-dem"===M&&"hillshade"!==_?e.push(new on(s,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!i.paint||!i.paint["line-gradient"]||"geojson"===M&&E.lineMetrics||e.push(new on(s,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new on(s,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new on(s,i.source,`source "${i.source}" not found`))}else e.push(new on(s,i,'missing required property "source"'));return e=e.concat(os({key:s,value:i,valueSpec:p.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>G({key:`${s}.type`,value:i.type,valueSpec:p.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:E=>ic(Ur({layerType:_},E)),layout:E=>os({layer:i,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":M=>Ll(Ur({layerType:_},M))}}),paint:E=>os({layer:i,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":M=>Sc(Ur({layerType:_},M))}})}})),e}function gl(t){const e=t.value,i=t.key,s=cr(e);return"string"!==s?[new on(i,e,`string expected, ${s} found`)]:[]}const Ha={promoteId:function({key:t,value:e}){if("string"===cr(e))return gl({key:t,value:e});{const i=[];for(const s in e)i.push(...gl({key:`${t}.${s}`,value:e[s]}));return i}}};function _l(t){const e=t.value,i=t.key,s=t.styleSpec,u=t.style;if(!e.type)return[new on(i,e,'"type" is required')];const p=ji(e.type);let _;switch(p){case"vector":case"raster":case"raster-dem":return _=os({key:i,value:e,valueSpec:s[`source_${p.replace("-","_")}`],style:t.style,styleSpec:s,objectElementValidators:Ha}),_;case"geojson":if(_=os({key:i,value:e,valueSpec:s.source_geojson,style:u,styleSpec:s,objectElementValidators:Ha}),e.cluster)for(const x in e.clusterProperties){const[E,M]=e.clusterProperties[x],F="string"==typeof E?[E,["accumulated"],["get",x]]:E;_.push(...na({key:`${i}.${x}.map`,value:M,expressionContext:"cluster-map"})),_.push(...na({key:`${i}.${x}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return _;case"video":return os({key:i,value:e,valueSpec:s.source_video,style:u,styleSpec:s});case"image":return os({key:i,value:e,valueSpec:s.source_image,style:u,styleSpec:s});case"canvas":return[new on(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Pl({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:s})}}function Xc(t){const e=t.value,i=t.styleSpec,s=i.light,u=t.style;let p=[];const _=cr(e);if(void 0===e)return p;if("object"!==_)return p=p.concat([new on("light",e,`object expected, ${_} found`)]),p;for(const x in e){const E=x.match(/^(.*)-transition$/);p=p.concat(E&&s[E[1]]&&s[E[1]].transition?G({key:x,value:e[x],valueSpec:i.transition,style:u,styleSpec:i}):s[x]?G({key:x,value:e[x],valueSpec:s[x],style:u,styleSpec:i}):[new on(x,e[x],`unknown property "${x}"`)])}return p}function z(t){const e=t.value,i=t.key,s=t.style,u=t.styleSpec,p=u.terrain;let _=[];const x=cr(e);if(void 0===e)return _;if("object"!==x)return _=_.concat([new on("terrain",e,`object expected, ${x} found`)]),_;for(const E in e){const M=E.match(/^(.*)-transition$/);_=_.concat(M&&p[M[1]]&&p[M[1]].transition?G({key:E,value:e[E],valueSpec:u.transition,style:s,styleSpec:u}):p[E]?G({key:E,value:e[E],valueSpec:p[E],style:s,styleSpec:u}):[new on(E,e[E],`unknown property "${E}"`)])}if(e.source){const E=s.sources&&s.sources[e.source],M=E&&ji(E.type);E?"raster-dem"!==M&&_.push(new on(i,e.source,`terrain cannot be used with a source of type ${M}, it only be used with a "raster-dem" source type`)):_.push(new on(i,e.source,`source "${e.source}" not found`))}else _.push(new on(i,e,'terrain is missing required property "source"'));return _}function O(t){const e=t.value,i=t.style,s=t.styleSpec,u=s.fog;let p=[];const _=cr(e);if(void 0===e)return p;if("object"!==_)return p=p.concat([new on("fog",e,`object expected, ${_} found`)]),p;for(const x in e){const E=x.match(/^(.*)-transition$/);p=p.concat(E&&u[E[1]]&&u[E[1]].transition?G({key:x,value:e[x],valueSpec:s.transition,style:i,styleSpec:s}):u[x]?G({key:x,value:e[x],valueSpec:u[x],style:i,styleSpec:s}):[new on(x,e[x],`unknown property "${x}"`)])}return p}const P={"*":()=>[],array:Ia,boolean:function(t){const e=t.value,i=t.key,s=cr(e);return"boolean"!==s?[new on(i,e,`boolean expected, ${s} found`)]:[]},number:ja,color:function(t){const e=t.key,i=t.value,s=cr(i);return"string"!==s?[new on(e,i,`color expected, ${s} found`)]:null===Bo.parseCSSColor(i)?[new on(e,i,`color expected, "${i}" found`)]:[]},constants:Ri,enum:Pl,filter:ic,function:ta,layer:kl,object:os,source:_l,light:Xc,terrain:z,fog:O,string:gl,formatted:function(t){return 0===gl(t).length?[]:na(t)},resolvedImage:function(t){return 0===gl(t).length?[]:na(t)},projection:function(t){const e=t.value,i=t.styleSpec,s=i.projection,u=t.style;let p=[];const _=cr(e);if("object"===_)for(const x in e)p=p.concat(G({key:x,value:e[x],valueSpec:s[x],style:u,styleSpec:i}));else"string"!==_&&(p=p.concat([new on("projection",e,`object or string expected, ${_} found`)]));return p}};function G(t){const e=t.value,i=t.valueSpec,s=t.styleSpec;return i.expression&&Ua(ji(e))?ta(t):i.expression&&ea(_r(e))?na(t):i.type&&P[i.type]?P[i.type](t):os(Ur({},t,{valueSpec:i.type?s[i.type]:i}))}function le(t){const e=t.value,i=t.key,s=gl(t);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new on(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new on(i,e,'"glyphs" url must include a "{range}" token'))),s}function Pe(t,e=St){let i=[];return i=i.concat(G({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:le,"*":()=>[]}})),t.constants&&(i=i.concat(Ri({key:"constants",value:t.constants,style:t,styleSpec:e}))),st(i)}function st(t){return[].concat(t).sort((e,i)=>e.line-i.line)}function yt(t){return function(...e){return st(t.apply(this,e))}}Pe.source=yt(_l),Pe.light=yt(Xc),Pe.terrain=yt(z),Pe.fog=yt(O),Pe.layer=yt(kl),Pe.filter=yt(ic),Pe.paintProperty=yt(Sc),Pe.layoutProperty=yt(Ll);const _n=Pe,fi=_n.light,Zr=_n.fog,Si=_n.paintProperty,qr=_n.layoutProperty;function Br(t,e){let i=!1;if(e&&e.length)for(const s of e)t.fire(new Cn(new Error(s.message))),i=!0;return i}var Ir=Do;function Do(t,e,i){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(i=u[2]);for(var p=0;p<this.d*this.d;p++){var _=u[3+p],x=u[3+p+1];s.push(_===x?null:u.subarray(_,x))}var E=u[3+s.length+1];this.keys=u.subarray(u[3+s.length],E),this.bboxes=u.subarray(E),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var M=0;M<this.d*this.d;M++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var F=i/e*t;this.min=-F,this.max=t+F}Do.prototype.insert=function(t,e,i,s,u){this._forEachCell(e,i,s,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(u)},Do.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Do.prototype._insertCell=function(t,e,i,s,u,p){this.cells[u].push(p)},Do.prototype.query=function(t,e,i,s,u){var p=this.min,_=this.max;if(t<=p&&e<=p&&_<=i&&_<=s&&!u)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(t,e,i,s,this._queryCell,x,{},u),x},Do.prototype._queryCell=function(t,e,i,s,u,p,_,x){var E=this.cells[u];if(null!==E)for(var M=this.keys,F=this.bboxes,U=0;U<E.length;U++){var V=E[U];if(void 0===_[V]){var ce=4*V;(x?x(F[ce+0],F[ce+1],F[ce+2],F[ce+3]):t<=F[ce+2]&&e<=F[ce+3]&&i>=F[ce+0]&&s>=F[ce+1])?(_[V]=!0,p.push(M[V])):_[V]=!1}}},Do.prototype._forEachCell=function(t,e,i,s,u,p,_,x){for(var E=this._convertToCellCoord(t),M=this._convertToCellCoord(e),F=this._convertToCellCoord(i),U=this._convertToCellCoord(s),V=E;V<=F;V++)for(var ce=M;ce<=U;ce++){var ve=this.d*ce+V;if((!x||x(this._convertFromCellCoord(V),this._convertFromCellCoord(ce),this._convertFromCellCoord(V+1),this._convertFromCellCoord(ce+1)))&&u.call(this,t,e,i,s,ve,p,_,x))return}},Do.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Do.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Do.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,s=0;s<this.cells.length;s++)i+=this.cells[s].length;var u=new Int32Array(e+i+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var p=e,_=0;_<t.length;_++){var x=t[_];u[3+_]=p,u.set(x,p),p+=x.length}return u[3+t.length]=p,u.set(this.keys,p),u[3+t.length+1]=p+=this.keys.length,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer};const{ImageData:vs,ImageBitmap:xs}=Q,Wa={};function Kn(t,e,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Wa[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}Kn("Object",Object),Ir.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},Ir.deserialize=function(t){return new Ir(t.buffer)},Kn("Grid",Ir),Kn("Color",zi),Kn("Error",Error),Kn("ResolvedImage",oo),Kn("StylePropertyFunction",jo),Kn("StyleExpression",Ec,{omit:["_evaluator"]}),Kn("ZoomDependentExpression",Dc),Kn("ZoomConstantExpression",pl),Kn("CompoundExpression",Ce,{omit:["_evaluate"]});for(const t in Eo)Eo[t]._classRegistryKey||Kn(`Expression_${t}`,Eo[t]);function Fl(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function ud(t){return xs&&t instanceof xs}function Ya(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Fl(t)||ud(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof vs)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const s of t)i.push(Ya(s,e));return i}if("object"==typeof t){const i=t.constructor,s=i._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");const u=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const p in t){if(!t.hasOwnProperty(p)||Wa[s].omit.indexOf(p)>=0)continue;const _=t[p];u[p]=Wa[s].shallow.indexOf(p)>=0?_:Ya(_,e)}t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof t)}function Bl(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Fl(t)||ud(t)||ArrayBuffer.isView(t)||t instanceof vs)return t;if(Array.isArray(t))return t.map(Bl);if("object"==typeof t){const e=t.$name||"Object",{klass:i}=Wa[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const s=Object.create(i.prototype);for(const u of Object.keys(t)){if("$name"===u)continue;const p=t[u];s[u]=Wa[e].shallow.indexOf(u)>=0?p:Bl(p)}return s}throw new Error("can't deserialize object of type "+typeof t)}class f{constructor(){this.first=!0}update(e,i){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const n=t=>t>=1536&&t<=1791,c=t=>t>=1872&&t<=1919,m=t=>t>=2208&&t<=2303,v=t=>t>=11904&&t<=12031,T=t=>t>=12032&&t<=12255,I=t=>t>=12272&&t<=12287,R=t=>t>=12288&&t<=12351,$=t=>t>=12352&&t<=12447,X=t=>t>=12448&&t<=12543,oe=t=>t>=12544&&t<=12591,he=t=>t>=12704&&t<=12735,Me=t=>t>=12736&&t<=12783,$e=t=>t>=12784&&t<=12799,Ue=t=>t>=12800&&t<=13055,je=t=>t>=13056&&t<=13311,at=t=>t>=13312&&t<=19903,Ze=t=>t>=19968&&t<=40959,ot=t=>t>=40960&&t<=42127,ut=t=>t>=42128&&t<=42191,it=t=>t>=44032&&t<=55215,rt=t=>t>=63744&&t<=64255,ft=t=>t>=64336&&t<=65023,$t=t=>t>=65040&&t<=65055,tn=t=>t>=65072&&t<=65103,Nn=t=>t>=65104&&t<=65135,Dn=t=>t>=65136&&t<=65279,Tn=t=>t>=65280&&t<=65519;function cn(t){for(const e of t)if(mn(e.charCodeAt(0)))return!0;return!1}function Jt(t){for(const e of t)if(!yn(e.charCodeAt(0)))return!1;return!0}function yn(t){return!(n(t)||c(t)||m(t)||ft(t)||Dn(t))}function mn(t){return!(746!==t&&747!==t&&(t<4352||!(he(t)||oe(t)||tn(t)&&!(t>=65097&&t<=65103)||rt(t)||je(t)||v(t)||Me(t)||!(!R(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||at(t)||Ze(t)||Ue(t)||(e=t,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||it(t)||$(t)||I(t)||(e=>e>=12688&&e<=12703)(t)||T(t)||$e(t)||X(t)&&12540!==t||!(!Tn(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Nn(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||$t(t)||(e=>e>=19904&&e<=19967)(t)||ot(t)||ut(t))));var e}function ui(t){return!(mn(t)||(e=t,(i=e)>=128&&i<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(i=>i>=8192&&i<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&9251!==e||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||R(e)||X(e)||(i=>i>=57344&&i<=63743)(e)||tn(e)||Nn(e)||Tn(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,i}function Ei(t){return t>=1424&&t<=2303||ft(t)||Dn(t)}function nr(t,e){return!(!e&&Ei(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(i=t,i>=6016&&i<=6143));var i}function Bn(t){for(const e of t)if(Ei(e.charCodeAt(0)))return!0;return!1}const vi="deferred",qi="loading",Mr="loaded";let Qr=null,Zi="unavailable",Pi=null;const ho=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Zi="error"),Qr&&Qr(t)};function es(){bs.fire(new un("pluginStateChange",{pluginStatus:Zi,pluginURL:Pi}))}const bs=new Un,ws=function(){return Zi},ya=function(){if(Zi!==vi||!Pi)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Zi=qi,es(),Pi&&Cr({url:Pi},t=>{t?ho(t):(Zi=Mr,es())})},br={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Zi===Mr||null!=br.applyArabicShaping,isLoading:()=>Zi===qi,setState(t){Zi=t.pluginStatus,Pi=t.pluginURL},isParsed:()=>null!=br.applyArabicShaping&&null!=br.processBidirectionalText&&null!=br.processStyledBidirectionalText,getPluginURL:()=>Pi};class Hi{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new f,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,s){for(const u of i)if(!nr(u.charCodeAt(0),s))return!1;return!0}(e,br.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*i}}}class ir{constructor(e,i){this.property=e,this.value=i,this.expression=function(s,u){if(Ua(s))return new jo(s,u);if(ea(s)){const p=Au(s,u);if("error"===p.result)throw new Error(p.value.map(_=>`${_.key}: ${_.message}`).join(", "));return p.value}{let p=s;return"string"==typeof s&&"color"===u.type&&(p=zi.parse(s)),{kind:"constant",evaluate:()=>p}}}(void 0===i?e.specification.default:i,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,i,s){return this.property.possiblyEvaluate(this,e,i,s)}}class no{constructor(e){this.property=e,this.value=new ir(e,void 0)}transitioned(e,i){return new Hr(this.property,this.value,i,Oe({},e.transition,this.transition),e.now)}untransitioned(){return new Hr(this.property,this.value,null,{},0)}}class Fs{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Jn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new no(this._values[e].property)),this._values[e].value=new ir(this._values[e].property,null===i?void 0:Jn(i))}getTransition(e){return Jn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new no(this._values[e].property)),this._values[e].transition=Jn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);void 0!==s&&(e[i]=s);const u=this.getTransition(i);void 0!==u&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const s=new Hs(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,i._values[u]);return s}untransitioned(){const e=new Hs(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Hr{constructor(e,i,s,u,p){const _=u.delay||0,x=u.duration||0;p=p||0,this.property=e,this.value=i,this.begin=p+_,this.end=this.begin+x,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const u=e.now||0,p=this.value.possiblyEvaluate(e,i,s),_=this.prior;if(_){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return _.possiblyEvaluate(e,i,s);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,i,s),p,$i(x))}}return p}}class Hs{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const u=new Oa(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,i,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class rc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Jn(this._values[e].value)}setValue(e,i){this._values[e]=new ir(this._values[e].property,null===i?void 0:Jn(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);void 0!==s&&(e[i]=s)}return e}possiblyEvaluate(e,i,s){const u=new Oa(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,i,s);return u}}class Ts{constructor(e,i,s){this.property=e,this.value=i,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,i,s,u){return this.property.evaluate(this.value,this.parameters,e,i,s,u)}}class Oa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class si{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const u=js[this.specification.type];return u?u(e,i,s):e}}class bi{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,u){return new Ts(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(i,null,{},s,u)}:e.expression,i)}interpolate(e,i,s){if("constant"!==e.value.kind||"constant"!==i.value.kind)return e;if(void 0===e.value.value||void 0===i.value.value)return new Ts(this,{kind:"constant",value:void 0},e.parameters);const u=js[this.specification.type];return u?new Ts(this,{kind:"constant",value:u(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,u,p,_){return"constant"===e.kind?e.value:e.evaluate(i,s,u,p,_)}}class ss extends bi{possiblyEvaluate(e,i,s,u){if(void 0===e.value)return new Ts(this,{kind:"constant",value:void 0},i);if("constant"===e.expression.kind){const p=e.expression.evaluate(i,null,{},s,u),_="resolvedImage"===e.property.specification.type&&"string"!=typeof p?p.name:p,x=this._calculate(_,_,_,i);return new Ts(this,{kind:"constant",value:x},i)}if("camera"===e.expression.kind){const p=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new Ts(this,{kind:"constant",value:p},i)}return new Ts(this,e.expression,i)}evaluate(e,i,s,u,p,_){if("source"===e.kind){const x=e.evaluate(i,s,u,p,_);return this._calculate(x,x,x,i)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},s,u),e.evaluate({zoom:Math.floor(i.zoom)},s,u),e.evaluate({zoom:Math.floor(i.zoom)+1},s,u),i):e.value}_calculate(e,i,s,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i,other:s}:{from:s,to:i,other:e}}interpolate(e){return e}}class ia{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,u){if(void 0!==e.value){if("constant"===e.expression.kind){const p=e.expression.evaluate(i,null,{},s,u);return this._calculate(p,p,p,i)}return this._calculate(e.expression.evaluate(new Hi(Math.floor(i.zoom-1),i)),e.expression.evaluate(new Hi(Math.floor(i.zoom),i)),e.expression.evaluate(new Hi(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,s,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:s,to:i}}interpolate(e){return e}}class ra{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,u){return!!e.expression.evaluate(i,null,{},s,u)}interpolate(){return!1}}class ds{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const s=e[i];s.specification.overridable&&this.overridableProperties.push(i);const u=this.defaultPropertyValues[i]=new ir(s,void 0),p=this.defaultTransitionablePropertyValues[i]=new no(s);this.defaultTransitioningPropertyValues[i]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=u.possiblyEvaluate({})}}}function jm(t,e){return 256*(t=_i(Math.floor(t),0,255))+_i(Math.floor(e),0,255)}Kn("DataDrivenProperty",bi),Kn("DataConstantProperty",si),Kn("CrossFadedDataDrivenProperty",ss),Kn("CrossFadedProperty",ia),Kn("ColorRampProperty",ra);const tf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Su{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Go{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function bo(t,e=1){let i=0,s=0;return{members:t.map(u=>{const p=tf[u.type].BYTES_PER_ELEMENT,_=i=nf(i,Math.max(e,p)),x=u.components||1;return s=Math.max(s,p),i+=p*x,{name:u.name,type:u.type,components:x,offset:_}}),size:nf(i,Math.max(s,e)),alignment:e}}function nf(t,e){return Math.ceil(t/e)*e}class Kc extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=s,e}}Kc.prototype.bytesPerElement=4,Kn("StructArrayLayout2i4",Kc);class Nl extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const _=4*e;return this.int16[_+0]=i,this.int16[_+1]=s,this.int16[_+2]=u,this.int16[_+3]=p,e}}Nl.prototype.bytesPerElement=8,Kn("StructArrayLayout4i8",Nl);class Pu extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,s,u,p,_,x)}emplace(e,i,s,u,p,_,x,E){const M=6*e,F=12*e,U=3*e;return this.int16[M+0]=i,this.int16[M+1]=s,this.uint8[F+4]=u,this.uint8[F+5]=p,this.uint8[F+6]=_,this.uint8[F+7]=x,this.float32[U+2]=E,e}}Pu.prototype.bytesPerElement=12,Kn("StructArrayLayout2i4ub1f12",Pu);class Ja extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=3*e;return this.float32[p+0]=i,this.float32[p+1]=s,this.float32[p+2]=u,e}}Ja.prototype.bytesPerElement=12,Kn("StructArrayLayout3f12",Ja);class oc extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x,E,M,F){const U=this.length;return this.resize(U+1),this.emplace(U,e,i,s,u,p,_,x,E,M,F)}emplace(e,i,s,u,p,_,x,E,M,F,U){const V=10*e;return this.uint16[V+0]=i,this.uint16[V+1]=s,this.uint16[V+2]=u,this.uint16[V+3]=p,this.uint16[V+4]=_,this.uint16[V+5]=x,this.uint16[V+6]=E,this.uint16[V+7]=M,this.uint16[V+8]=F,this.uint16[V+9]=U,e}}oc.prototype.bytesPerElement=20,Kn("StructArrayLayout10ui20",oc);class dd extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x,E){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,s,u,p,_,x,E)}emplace(e,i,s,u,p,_,x,E,M){const F=8*e;return this.uint16[F+0]=i,this.uint16[F+1]=s,this.uint16[F+2]=u,this.uint16[F+3]=p,this.uint16[F+4]=_,this.uint16[F+5]=x,this.uint16[F+6]=E,this.uint16[F+7]=M,e}}dd.prototype.bytesPerElement=16,Kn("StructArrayLayout8ui16",dd);class rf extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x,E,M,F,U,V,ce,ve,Ae,Ve){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,e,i,s,u,p,_,x,E,M,F,U,V,ce,ve,Ae,Ve)}emplace(e,i,s,u,p,_,x,E,M,F,U,V,ce,ve,Ae,Ve,Ke){const dt=16*e;return this.int16[dt+0]=i,this.int16[dt+1]=s,this.int16[dt+2]=u,this.int16[dt+3]=p,this.uint16[dt+4]=_,this.uint16[dt+5]=x,this.uint16[dt+6]=E,this.uint16[dt+7]=M,this.int16[dt+8]=F,this.int16[dt+9]=U,this.int16[dt+10]=V,this.int16[dt+11]=ce,this.int16[dt+12]=ve,this.int16[dt+13]=Ae,this.int16[dt+14]=Ve,this.int16[dt+15]=Ke,e}}rf.prototype.bytesPerElement=32,Kn("StructArrayLayout4i4ui4i4i32",rf);class Qc extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Qc.prototype.bytesPerElement=4,Kn("StructArrayLayout1ul4",Qc);class Ou extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x,E,M,F,U,V,ce){const ve=this.length;return this.resize(ve+1),this.emplace(ve,e,i,s,u,p,_,x,E,M,F,U,V,ce)}emplace(e,i,s,u,p,_,x,E,M,F,U,V,ce,ve){const Ae=20*e,Ve=10*e;return this.int16[Ae+0]=i,this.int16[Ae+1]=s,this.int16[Ae+2]=u,this.int16[Ae+3]=p,this.int16[Ae+4]=_,this.float32[Ve+3]=x,this.float32[Ve+4]=E,this.float32[Ve+5]=M,this.float32[Ve+6]=F,this.int16[Ae+14]=U,this.uint32[Ve+8]=V,this.uint16[Ae+18]=ce,this.uint16[Ae+19]=ve,e}}Ou.prototype.bytesPerElement=40,Kn("StructArrayLayout5i4f1i1ul2ui40",Ou);class Ru extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,s,u,p,_,x)}emplace(e,i,s,u,p,_,x,E){const M=8*e;return this.int16[M+0]=i,this.int16[M+1]=s,this.int16[M+2]=u,this.int16[M+4]=p,this.int16[M+5]=_,this.int16[M+6]=x,this.int16[M+7]=E,e}}Ru.prototype.bytesPerElement=16,Kn("StructArrayLayout3i2i2i16",Ru);class hd extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,s,u,p)}emplace(e,i,s,u,p,_){const x=4*e,E=8*e;return this.float32[x+0]=i,this.float32[x+1]=s,this.float32[x+2]=u,this.int16[E+6]=p,this.int16[E+7]=_,e}}hd.prototype.bytesPerElement=16,Kn("StructArrayLayout2f1f2i16",hd);class pd extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const _=12*e,x=3*e;return this.uint8[_+0]=i,this.uint8[_+1]=s,this.float32[x+1]=u,this.float32[x+2]=p,e}}pd.prototype.bytesPerElement=12,Kn("StructArrayLayout2ub2f12",pd);class oa extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=s,this.uint16[p+2]=u,e}}oa.prototype.bytesPerElement=6,Kn("StructArrayLayout3ui6",oa);class yh extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x,E,M,F,U,V,ce,ve,Ae,Ve,Ke,dt,bt,Mt,Ot){const Nt=this.length;return this.resize(Nt+1),this.emplace(Nt,e,i,s,u,p,_,x,E,M,F,U,V,ce,ve,Ae,Ve,Ke,dt,bt,Mt,Ot)}emplace(e,i,s,u,p,_,x,E,M,F,U,V,ce,ve,Ae,Ve,Ke,dt,bt,Mt,Ot,Nt){const gn=30*e,hn=15*e,Zn=60*e;return this.int16[gn+0]=i,this.int16[gn+1]=s,this.int16[gn+2]=u,this.float32[hn+2]=p,this.float32[hn+3]=_,this.uint16[gn+8]=x,this.uint16[gn+9]=E,this.uint32[hn+5]=M,this.uint32[hn+6]=F,this.uint32[hn+7]=U,this.uint16[gn+16]=V,this.uint16[gn+17]=ce,this.uint16[gn+18]=ve,this.float32[hn+10]=Ae,this.float32[hn+11]=Ve,this.uint8[Zn+48]=Ke,this.uint8[Zn+49]=dt,this.uint8[Zn+50]=bt,this.uint32[hn+13]=Mt,this.int16[gn+28]=Ot,this.uint8[Zn+58]=Nt,e}}yh.prototype.bytesPerElement=60,Kn("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",yh);class vh extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x,E,M,F,U,V,ce,ve,Ae,Ve,Ke,dt,bt,Mt,Ot,Nt,gn,hn,Zn,Ln,pn,kn,$n,vn){const Qn=this.length;return this.resize(Qn+1),this.emplace(Qn,e,i,s,u,p,_,x,E,M,F,U,V,ce,ve,Ae,Ve,Ke,dt,bt,Mt,Ot,Nt,gn,hn,Zn,Ln,pn,kn,$n,vn)}emplace(e,i,s,u,p,_,x,E,M,F,U,V,ce,ve,Ae,Ve,Ke,dt,bt,Mt,Ot,Nt,gn,hn,Zn,Ln,pn,kn,$n,vn,Qn){const ai=38*e,vr=19*e;return this.int16[ai+0]=i,this.int16[ai+1]=s,this.int16[ai+2]=u,this.float32[vr+2]=p,this.float32[vr+3]=_,this.int16[ai+8]=x,this.int16[ai+9]=E,this.int16[ai+10]=M,this.int16[ai+11]=F,this.int16[ai+12]=U,this.int16[ai+13]=V,this.uint16[ai+14]=ce,this.uint16[ai+15]=ve,this.uint16[ai+16]=Ae,this.uint16[ai+17]=Ve,this.uint16[ai+18]=Ke,this.uint16[ai+19]=dt,this.uint16[ai+20]=bt,this.uint16[ai+21]=Mt,this.uint16[ai+22]=Ot,this.uint16[ai+23]=Nt,this.uint16[ai+24]=gn,this.uint16[ai+25]=hn,this.uint16[ai+26]=Zn,this.uint16[ai+27]=Ln,this.uint16[ai+28]=pn,this.uint32[vr+15]=kn,this.float32[vr+16]=$n,this.float32[vr+17]=vn,this.float32[vr+18]=Qn,e}}vh.prototype.bytesPerElement=76,Kn("StructArrayLayout3i2f6i15ui1ul3f76",vh);class fd extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}fd.prototype.bytesPerElement=4,Kn("StructArrayLayout1f4",fd);class xh extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=3*e;return this.int16[p+0]=i,this.int16[p+1]=s,this.int16[p+2]=u,e}}xh.prototype.bytesPerElement=6,Kn("StructArrayLayout3i6",xh);class Lu extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,s,u,p,_,x)}emplace(e,i,s,u,p,_,x,E){const M=7*e;return this.float32[M+0]=i,this.float32[M+1]=s,this.float32[M+2]=u,this.float32[M+3]=p,this.float32[M+4]=_,this.float32[M+5]=x,this.float32[M+6]=E,e}}Lu.prototype.bytesPerElement=28,Kn("StructArrayLayout7f28",Lu);class yl extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const _=6*e;return this.uint32[3*e+0]=i,this.uint16[_+2]=s,this.uint16[_+3]=u,this.uint16[_+4]=p,e}}yl.prototype.bytesPerElement=12,Kn("StructArrayLayout1ul3ui12",yl);class Ra extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=s,e}}Ra.prototype.bytesPerElement=4,Kn("StructArrayLayout2ui4",Ra);class md extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}md.prototype.bytesPerElement=2,Kn("StructArrayLayout1ui2",md);class bh extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=s,e}}bh.prototype.bytesPerElement=8,Kn("StructArrayLayout2f8",bh);class of extends Go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const _=4*e;return this.float32[_+0]=i,this.float32[_+1]=s,this.float32[_+2]=u,this.float32[_+3]=p,e}}of.prototype.bytesPerElement=16,Kn("StructArrayLayout4f16",of);class Gm extends Su{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Gm.prototype.size=40;class sf extends Ou{get(e){return new Gm(this,e)}}Kn("CollisionBoxArray",sf);class qm extends Su{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}qm.prototype.size=60;class wh extends yh{get(e){return new qm(this,e)}}Kn("PlacedSymbolArray",wh);class af extends Su{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}af.prototype.size=76;class lf extends vh{get(e){return new af(this,e)}}Kn("SymbolInstanceArray",lf);class cf extends fd{getoffsetX(e){return this.float32[1*e+0]}}Kn("GlyphOffsetArray",cf);class uf extends xh{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Kn("SymbolLineVertexArray",uf);class Hm extends Su{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Hm.prototype.size=12;class df extends yl{get(e){return new Hm(this,e)}}Kn("FeatureIndexArray",df);class ku extends Su{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}ku.prototype.size=4;class Th extends Ra{get(e){return new ku(this,e)}}Kn("FillExtrusionCentroidArray",Th);const vl=bo([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Fu=bo([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Ch=Is(function(t){t.exports=function(e,i){var s,u,p,_,x,E,M,F;for(u=e.length-(s=3&e.length),p=i,x=3432918353,E=461845907,F=0;F<u;)M=255&e.charCodeAt(F)|(255&e.charCodeAt(++F))<<8|(255&e.charCodeAt(++F))<<16|(255&e.charCodeAt(++F))<<24,++F,p=27492+(65535&(_=5*(65535&(p=(p^=M=(65535&(M=(M=(65535&M)*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*E+(((M>>>16)*E&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(M=0,s){case 3:M^=(255&e.charCodeAt(F+2))<<16;case 2:M^=(255&e.charCodeAt(F+1))<<8;case 1:p^=M=(65535&(M=(M=(65535&(M^=255&e.charCodeAt(F)))*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*E+(((M>>>16)*E&65535)<<16)&4294967295}return p^=e.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}}),hf=Is(function(t){t.exports=function(e,i){for(var s,u=e.length,p=i^u,_=0;u>=4;)s=1540483477*(65535&(s=255&e.charCodeAt(_)|(255&e.charCodeAt(++_))<<8|(255&e.charCodeAt(++_))<<16|(255&e.charCodeAt(++_))<<24))+((1540483477*(s>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),u-=4,++_;switch(u){case 3:p^=(255&e.charCodeAt(_+2))<<16;case 2:p^=(255&e.charCodeAt(_+1))<<8;case 1:p=1540483477*(65535&(p^=255&e.charCodeAt(_)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}}),eu=Ch,V_=hf;eu.murmur3=Ch,eu.murmur2=V_;class Eh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,s,u){this.ids.push(Wm(e)),this.positions.push(i,s,u)}getPositions(e){const i=Wm(e);let s=0,u=this.ids.length-1;for(;s<u;){const _=s+u>>1;this.ids[_]>=i?u=_:s=_+1}const p=[];for(;this.ids[s]===i;)p.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return p}static serialize(e,i){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Bu(s,u,0,s.length-1),i&&i.push(s.buffer,u.buffer),{ids:s,positions:u}}static deserialize(e){const i=new Eh;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Wm(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:eu(String(t))}function Bu(t,e,i,s){for(;i<s;){const u=t[i+s>>1];let p=i-1,_=s+1;for(;;){do{p++}while(t[p]<u);do{_--}while(t[_]>u);if(p>=_)break;tu(t,p,_),tu(e,3*p,3*_),tu(e,3*p+1,3*_+1),tu(e,3*p+2,3*_+2)}_-i<s-_?(Bu(t,e,i,_),i=_+1):(Bu(t,e,_+1,s),s=_)}}function tu(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}Kn("FeaturePositionMap",Eh);class Xa{constructor(e,i){this.gl=e.gl,this.location=i}}class Dh extends Xa{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Ym extends Xa{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ih extends Xa{constructor(e,i){super(e,i),this.current=zi.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Jm=new Float32Array(16),Xm=new Float32Array(9),Km=new Float32Array(4);function Mh(t){return[jm(255*t.r,255*t.g),jm(255*t.b,255*t.a)]}class nu{constructor(e,i,s){this.value=e,this.uniformNames=i.map(u=>`u_${u}`),this.type=s}setUniform(e,i,s){e.set(s.constantOr(this.value))}getBinding(e,i,s){return"color"===this.type?new Ih(e,i):new Dh(e,i)}}class zl{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tl.concat(i.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,i,s,u){const p="u_pattern_to"===u||"u_dash_to"===u?this.patternTo:"u_pattern_from"===u||"u_dash_from"===u?this.patternFrom:"u_pixel_ratio_to"===u?this.pixelRatioTo:"u_pixel_ratio_from"===u?this.pixelRatioFrom:null;p&&e.set(p)}getBinding(e,i,s){return"u_pattern_from"===s||"u_pattern_to"===s||"u_dash_from"===s||"u_dash_to"===s?new Ym(e,i):new Dh(e,i)}}class Ul{constructor(e,i,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,s,u,p,_){const x=this.paintVertexArray.length,E=this.expression.evaluate(new Hi(0),i,{},p,u,_);this.paintVertexArray.resize(e),this._setPaintValue(x,e,E)}updatePaintArray(e,i,s,u,p){const _=this.expression.evaluate({zoom:0},s,u,void 0,p);this._setPaintValue(e,i,_)}_setPaintValue(e,i,s){if("color"===this.type){const u=Mh(s);for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class va{constructor(e,i,s,u,p,_){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=s,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,i,s,u,p,_){const x=this.expression.evaluate(new Hi(this.zoom),i,{},p,u,_),E=this.expression.evaluate(new Hi(this.zoom+1),i,{},p,u,_),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,x,E)}updatePaintArray(e,i,s,u,p){const _=this.expression.evaluate({zoom:this.zoom},s,u,void 0,p),x=this.expression.evaluate({zoom:this.zoom+1},s,u,void 0,p);this._setPaintValue(e,i,_,x)}_setPaintValue(e,i,s,u){if("color"===this.type){const p=Mh(s),_=Mh(u);for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,p[0],p[1],_[0],_[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const s=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,u=_i(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,i,s){return new Dh(e,i)}}class sc{constructor(e,i,s,u,p,_,x){this.expression=e,this.type=s,this.useIntegerZoom=u,this.zoom=p,this.layerId=x,this.paintVertexAttributes=("array"===s?Fu:vl).members;for(let E=0;E<i.length;++E);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,i,s){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,u,p,_){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],_)}_setPaintValues(e,i,s,u){if(!u||!s)return;const{min:p,mid:_,max:x}=s,E=u[p],M=u[_],F=u[x];if(E&&M&&F)for(let U=e;U<i;U++)this._setPaintValue(this.zoomInPaintVertexArray,U,M,E),this._setPaintValue(this.zoomOutPaintVertexArray,U,M,F)}_setPaintValue(e,i,s,u){e.emplace(i,s.tl[0],s.tl[1],s.br[0],s.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],s.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class mo{constructor(e,i,s=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const p in e.paint._values){if(!s(p))continue;const _=e.paint.get(p);if(!(_ instanceof Ts&&hl(_.property.specification)))continue;const x=Ah(p,e.type),E=_.value,M=_.property.specification.type,F=_.property.useIntegerZoom,U=_.property.specification["property-type"],V="cross-faded"===U||"cross-faded-data-driven"===U,ce="line-dasharray"===String(p)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==E.kind||ce)if("source"===E.kind||ce||V){const ve=ff(p,M,"source");this.binders[p]=V?new sc(E,x,M,F,i,ve,e.id):new Ul(E,x,M,ve),u.push(`/a_${p}`)}else{const ve=ff(p,M,"composite");this.binders[p]=new va(E,x,M,F,i,ve),u.push(`/z_${p}`)}else this.binders[p]=V?new zl(E.value,x):new nu(E.value,x,M),u.push(`/u_${p}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Ul||i instanceof va?i.maxValue:0}populatePaintArrays(e,i,s,u,p,_){for(const x in this.binders){const E=this.binders[x];(E instanceof Ul||E instanceof va||E instanceof sc)&&E.populatePaintArray(e,i,s,u,p,_)}}setConstantPatternPositions(e,i){for(const s in this.binders){const u=this.binders[s];u instanceof zl&&u.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,s,u,p,_){let x=!1;for(const E in e){const M=i.getPositions(E);for(const F of M){const U=s.feature(F.index);for(const V in this.binders){const ce=this.binders[V];if((ce instanceof Ul||ce instanceof va||ce instanceof sc)&&!0===ce.expression.isStateDependent){const ve=u.paint.get(V);ce.expression=ve.value,ce.updatePaintArray(F.start,F.end,U,e[E],p,_),x=!0}}}}return x}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof nu||s instanceof zl)&&e.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Ul||s instanceof va||s instanceof sc)for(let u=0;u<s.paintVertexAttributes.length;u++)e.push(s.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof nu||s instanceof zl||s instanceof va)for(const u of s.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const s=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof nu||p instanceof zl||p instanceof va)for(const _ of p.uniformNames)if(i[_]){const x=p.getBinding(e,i[_],_);s.push({name:_,property:u,binding:x})}}return s}setUniforms(e,i,s,u){for(const{name:p,property:_,binding:x}of i)this.binders[_].setUniform(x,u,s.get(_),p)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const s=this.binders[i];if(e&&s instanceof sc){const u=2===e.fromScale?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(s instanceof Ul||s instanceof va)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof Ul||s instanceof va||s instanceof sc)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Ul||i instanceof va||i instanceof sc)&&i.destroy()}}}class Pc{constructor(e,i,s=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new mo(u,i,s);this.needsUpload=!1,this._featureMap=new Eh,this._bufferOffset=0}populatePaintArrays(e,i,s,u,p,_,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(e,i,u,p,_,x);void 0!==i.id&&this._featureMap.add(i.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,u,p){for(const _ of s)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,i,_,u,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Qm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Ah(t,e){return Qm[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const pf={"line-pattern":{source:oc,composite:oc},"fill-pattern":{source:oc,composite:oc},"fill-extrusion-pattern":{source:oc,composite:oc},"line-dasharray":{source:dd,composite:dd}},eg={color:{source:bh,composite:of},number:{source:fd,composite:bh}};function ff(t,e,i){const s=pf[t];return s&&s[i]||eg[e][i]}Kn("ConstantBinder",nu),Kn("CrossFadedConstantBinder",zl),Kn("SourceExpressionBinder",Ul),Kn("CrossFadedCompositeBinder",sc),Kn("CompositeExpressionBinder",va),Kn("ProgramConfiguration",mo,{omit:["_buffers"]}),Kn("ProgramConfigurationSet",Pc);const gd="-transition";class Ka extends Un{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new rc(i.layout)),i.paint)){this._transitionablePaint=new Fs(i.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Oa(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,s={}){null!=i&&this._validate(qr,`layers.${this.id}.layout.${e}`,e,i,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return He(e,gd)?this._transitionablePaint.getTransition(e.slice(0,-gd.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,s={}){if(null!=i&&this._validate(Si,`layers.${this.id}.paint.${e}`,e,i,s))return!1;if(He(e,gd))return this._transitionablePaint.setTransition(e.slice(0,-gd.length),i||void 0),!1;{const u=this._transitionablePaint._values[e],p="cross-faded-data-driven"===u.property.specification["property-type"],_=u.value.isDataDriven(),x=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const E=this._transitionablePaint._values[e].value;return E.isDataDriven()||_||p||this._handleOverridablePaintPropertyUpdate(e,x,E)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Qt(e,(i,s)=>!(void 0===i||"layout"===s&&!Object.keys(i).length||"paint"===s&&!Object.keys(i).length))}_validate(e,i,s,u,p={}){return(!p||!1!==p.validate)&&Br(this,e.call(_n,{key:i,layerType:this.type,objectKey:s,value:u,styleSpec:St,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ts&&hl(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ga(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const tg=bo([{name:"a_pos",components:2,type:"Int16"}],4),{members:$_}=tg;class qo{constructor(e=[]){this.segments=e}prepareSegment(e,i,s,u){let p=this.segments[this.segments.length-1];return e>qo.MAX_VERTEX_ARRAY_LENGTH&&Di(`Max vertices per segment is ${qo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>qo.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:i.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==u&&(p.sortKey=u),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,u){return new qo([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}qo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Kn("SegmentVector",qo);var er=8192;class ts{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Xr?new Xr(e.lng,e.lat):Xr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Xr?new Xr(e.lng,e.lat):Xr.convert(e),this}extend(e){const i=this._sw,s=this._ne;let u,p;if(e instanceof Xr)u=e,p=e;else{if(!(e instanceof ts))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(ts.convert(e)):this.extend(Xr.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return i||s?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),s.lng=Math.max(p.lng,s.lng),s.lat=Math.max(p.lat,s.lat)):(this._sw=new Xr(u.lng,u.lat),this._ne=new Xr(p.lng,p.lat)),this}getCenter(){return new Xr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Xr(this.getWest(),this.getNorth())}getSouthEast(){return new Xr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=Xr.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){return!e||e instanceof ts?e:new ts(e)}}const _d=6371008.8;class Xr{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xr(gi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,u=e.lat*i,p=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return _d*Math.acos(Math.min(p,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new ts(new Xr(this.lng-s,this.lat-i),new Xr(this.lng+s,this.lat+i))}static convert(e){if(e instanceof Xr)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Xr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Xr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Sh=2*Math.PI*_d;function Ps(t){return Sh*Math.cos(t*Math.PI/180)}function xl(t){return(180+t)/360}function ac(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Qa(t,e){return t/Ps(e)}function Zl(t){return 360*t-180}function xa(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function mf(t,e){return t*Ps(xa(e))}const el=85.051129;class yd{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=Xr.convert(e);return new yd(xl(s.lng),ac(s.lat),Qa(i,s.lat))}toLngLat(){return new Xr(Zl(this.x),xa(this.y))}toAltitude(){return mf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Sh*(e=xa(this.y),1/Math.cos(e*Math.PI/180));var e}}function vd(t,e,i,s,u,p,_,x,E){const M=(e+s)/2,F=(i+u)/2,U=new ne(M,F);x(U),function(V,ce,ve,Ae,Ve,Ke){const dt=ve-Ve,bt=Ae-Ke;return Math.abs((Ae-ce)*dt-(ve-V)*bt)/Math.hypot(dt,bt)}(U.x,U.y,p.x,p.y,_.x,_.y)>=E?(vd(t,e,i,M,F,p,U,x,E),vd(t,M,F,s,u,U,_,x,E)):t.push(_)}function ng(t,e,i){const s=[];let u,p,_;for(const x of t){const{x:E,y:M}=x;e(x),_?vd(s,u,p,E,M,_,x,e,i):s.push(x),u=E,p=M,_=x}return s}const Ph=Math.pow(2,14)-1,xd=-Ph-1;function ig(t,e){const i=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=_i(i,xd,Ph),t.y=_i(s,xd,Ph),(i<t.x||i>t.x+1||s<t.y||s>t.y+1)&&Di("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Vl(t,e,i){const s=t.loadGeometry(),u=t.extent,p=er/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:x,x:E,y:M,projection:F}=i,U=V=>{const ce=Zl((e.x+V.x/u)/_),ve=xa((e.y+V.y/u)/_),Ae=F.project(ce,ve);V.x=(Ae.x*x-E)*u,V.y=(Ae.y*x-M)*u};for(let V=0;V<s.length;V++)if(1!==t.type)s[V]=ng(s[V],U,1);else{const ce=[];for(const ve of s[V])ve.x<0||ve.x>=u||ve.y<0||ve.y>=u||(U(ve),ce.push(ve));s[V]=ce}}for(const _ of s)for(const x of _)ig(x,p);return s}function $l(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Vl(t):[]}}function bd(t,e,i,s,u){t.emplaceBack(2*e+(s+1)/2,2*i+(u+1)/2)}class Oh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Kc,this.indexArray=new oa,this.segments=new qo,this.programConfigurations=new Pc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,u){const p=this.layers[0],_=[];let x=null;"circle"===p.type&&(x=p.layout.get("circle-sort-key"));for(const{feature:E,id:M,index:F,sourceLayerIndex:U}of e){const V=this.layers[0]._featureFilter.needGeometry,ce=$l(E,V);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom),ce,s))continue;const ve=x?x.evaluate(ce,{},s):void 0,Ae={id:M,properties:E.properties,type:E.type,sourceLayerIndex:U,index:F,geometry:V?ce.geometry:Vl(E,s,u),patterns:{},sortKey:ve};_.push(Ae)}x&&_.sort((E,M)=>E.sortKey-M.sortKey);for(const E of _){const{geometry:M,index:F,sourceLayerIndex:U}=E,V=e[F].feature;this.addFeature(E,M,F,i.availableImages,s),i.featureIndex.insert(V,M,F,U,this.index)}}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,u,p){for(const _ of i)for(const x of _){const E=x.x,M=x.y;if(E<0||E>=er||M<0||M>=er)continue;const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),U=F.vertexLength;bd(this.layoutVertexArray,E,M,-1,-1),bd(this.layoutVertexArray,E,M,1,-1),bd(this.layoutVertexArray,E,M,1,1),bd(this.layoutVertexArray,E,M,-1,1),this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+3,U+2),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,p)}}function iu(t,e){for(let i=0;i<t.length;i++)if(ru(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(ru(t,e[i]))return!0;return!!Rh(t,e)}function rg(t,e,i){return!!ru(t,e)||!!wd(e,t,i)}function gf(t,e){if(1===t.length)return yf(e,t[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let u=0;u<s.length;u++)if(ru(t,s[u]))return!0}for(let i=0;i<t.length;i++)if(yf(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Rh(t,e[i]))return!0;return!1}function og(t,e,i){if(t.length>1){if(Rh(t,e))return!0;for(let s=0;s<e.length;s++)if(wd(e[s],t,i))return!0}for(let s=0;s<t.length;s++)if(wd(t[s],e,i))return!0;return!1}function Rh(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const s=t[i],u=t[i+1];for(let p=0;p<e.length-1;p++)if(sg(s,u,e[p],e[p+1]))return!0}return!1}function sg(t,e,i,s){return mi(t,i,s)!==mi(e,i,s)&&mi(t,e,i)!==mi(t,e,s)}function wd(t,e,i){const s=i*i;if(1===e.length)return t.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(_f(t,e[u-1],e[u])<s)return!0;return!1}function _f(t,e,i){const s=e.distSqr(i);if(0===s)return t.distSqr(e);const u=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/s;return t.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function yf(t,e){let i,s,u,p=!1;for(let _=0;_<t.length;_++){i=t[_];for(let x=0,E=i.length-1;x<i.length;E=x++)s=i[x],u=i[E],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(p=!p)}return p}function ru(t,e){let i=!1;for(let s=0,u=t.length-1;s<t.length;u=s++){const p=t[s],_=t[u];p.y>e.y!=_.y>e.y&&e.x<(_.x-p.x)*(e.y-p.y)/(_.y-p.y)+p.x&&(i=!i)}return i}function vf(t,e,i,s,u){for(const _ of t)if(e<=_.x&&i<=_.y&&s>=_.x&&u>=_.y)return!0;const p=[new ne(e,i),new ne(e,u),new ne(s,u),new ne(s,i)];if(t.length>2)for(const _ of p)if(ru(t,_))return!0;for(let _=0;_<t.length-1;_++)if(xf(t[_],t[_+1],p))return!0;return!1}function xf(t,e,i){const s=i[0],u=i[2];if(t.x<s.x&&e.x<s.x||t.x>u.x&&e.x>u.x||t.y<s.y&&e.y<s.y||t.y>u.y&&e.y>u.y)return!1;const p=mi(t,e,i[0]);return p!==mi(t,e,i[1])||p!==mi(t,e,i[2])||p!==mi(t,e,i[3])}function ou(t,e,i){const s=e.paint.get(t).value;return"constant"===s.kind?s.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Td(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function bf(t,e,i,s,u){if(!e[0]&&!e[1])return t;const p=ne.convert(e)._mult(u);"viewport"===i&&p._rotate(-s);const _=[];for(let x=0;x<t.length;x++)_.push(t[x].sub(p));return _}function Oc(t,e,i,s){const u=ne.convert(t)._mult(s);return"viewport"===e&&u._rotate(-i),u}Kn("CircleBucket",Oh,{omit:["layers"]});const bl=new ds({"circle-sort-key":new bi(St.layout_circle["circle-sort-key"])});var j_={paint:new ds({"circle-radius":new bi(St.paint_circle["circle-radius"]),"circle-color":new bi(St.paint_circle["circle-color"]),"circle-blur":new bi(St.paint_circle["circle-blur"]),"circle-opacity":new bi(St.paint_circle["circle-opacity"]),"circle-translate":new si(St.paint_circle["circle-translate"]),"circle-translate-anchor":new si(St.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new si(St.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new si(St.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bi(St.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bi(St.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bi(St.paint_circle["circle-stroke-opacity"])}),layout:bl};class wf{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,s,u){const p=Math.pow(2,s),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const M=ln([],E,e),F=1/M[3]/i*p;return(U=M)[0]=(V=M)[0]*(ce=[F,F,u?1/M[3]:F,F])[0],U[1]=V[1]*ce[1],U[2]=V[2]*ce[2],U[3]=V[3]*ce[3],U;var U,V,ce}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const M=Bt([],Gn([],Yt([],_[E[0]],_[E[1]]),Yt([],_[E[2]],_[E[1]]))),F=-Ht(M,_[E[1]]);return M.concat(F)});return new wf(_,x)}}class La{constructor(e,i){this.min=e,this.max=i,this.center=xt([],Ge([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=et(this.min),u=et(this.max);for(let p=0;p<i.length;p++)s[p]=i[p]?this.min[p]:this.center[p],u[p]=i[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new La(s,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let s=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let _=0;for(let x=0;x<i.length;x++)_+=Ht(p,i[x])+p[3]>=0;if(0===_)return 0;_!==i.length&&(s=!1)}if(s)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let x=0;x<e.points.length;x++){const E=e.points[x][u]-this.min[u];p=Math.min(p,E),_=Math.max(_,E)}if(_<0||p>this.max[u]-this.min[u])return 0}return 1}}function ag(t,e,i,s,u,p,_,x,E){if(p&&t.queryGeometry.isAboveHorizon)return!1;p&&(E*=t.pixelToTileUnitsFactor);for(const M of e)for(const F of M){const U=F.add(x),V=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(U.x,U.y,!0):0,ce=p?U:wl(U,V,s),ve=p?t.tilespaceRays.map(Ve=>lg(Ve,V)):t.queryGeometry.screenGeometry,Ae=ln([],[F.x,F.y,V,1],s);if(!_&&p?E*=Ae[3]/i.cameraToCenterDistance:_&&!p&&(E*=i.cameraToCenterDistance/Ae[3]),rg(ve,ce,E))return!0}return!1}function wl(t,e,i){const s=ln([],[t.x,t.y,e,1],i);return new ne(s[0]/s[3],s[1]/s[3])}const Cd=C(0,0,0),Lh=C(0,0,1);function lg(t,e){const i=tt();return Cd[2]=e,t.intersectsPlane(Cd,Lh,i),new ne(i[0],i[1])}class kh extends Oh{}function Rc(t,{width:e,height:i},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*s);return t.width=e,t.height=i,t.data=u,t}function Fh(t,{width:e,height:i},s){if(e===t.width&&i===t.height)return;const u=Rc({},{width:e,height:i},s);Ed(t,u,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,i)},s),t.width=e,t.height=i,t.data=u.data}function Ed(t,e,i,s,u,p){if(0===u.width||0===u.height)return e;if(u.width>t.width||u.height>t.height||i.x>t.width-u.width||i.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const _=t.data,x=e.data;for(let E=0;E<u.height;E++){const M=((i.y+E)*t.width+i.x)*p,F=((s.y+E)*e.width+s.x)*p;for(let U=0;U<u.width*p;U++)x[F+U]=_[M+U]}return e}Kn("HeatmapBucket",kh,{omit:["layers"]});class Tl{constructor(e,i){Rc(this,e,1,i)}resize(e){Fh(this,e,1)}clone(){return new Tl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,u,p){Ed(e,i,s,u,p,1)}}class Ws{constructor(e,i){Rc(this,e,4,i)}resize(e){Fh(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ws({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,u,p){Ed(e,i,s,u,p,4)}}Kn("AlphaImage",Tl),Kn("RGBAImage",Ws);var Tf={paint:new ds({"heatmap-radius":new bi(St.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bi(St.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new si(St.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ra(St.paint_heatmap["heatmap-color"]),"heatmap-opacity":new si(St.paint_heatmap["heatmap-opacity"])})};function Cf(t){const e={},i=t.resolution||256,s=t.clips?t.clips.length:1,u=t.image||new Ws({width:i,height:s}),p=(_,x,E)=>{e[t.evaluationKey]=E;const M=t.expression.evaluate(e);u.data[_+x+0]=Math.floor(255*M.r/M.a),u.data[_+x+1]=Math.floor(255*M.g/M.a),u.data[_+x+2]=Math.floor(255*M.b/M.a),u.data[_+x+3]=Math.floor(255*M.a)};if(t.clips)for(let _=0,x=0;_<s;++_,x+=4*i)for(let E=0,M=0;E<i;E++,M+=4){const F=E/(i-1),{start:U,end:V}=t.clips[_];p(x,M,U*(1-F)+V*F)}else for(let _=0,x=0;_<i;_++,x+=4)p(0,x,_/(i-1));return u}var su={paint:new ds({"hillshade-illumination-direction":new si(St.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new si(St.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new si(St.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new si(St.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new si(St.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new si(St.paint_hillshade["hillshade-accent-color"])})};const Bh=bo([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ef}=Bh;var Dd=Id,Nh=Id;function Id(t,e,i){i=i||2;var s,u,p,_,x,E,M,F=e&&e.length,U=F?e[0]*i:t.length,V=Df(t,0,U,i,!0),ce=[];if(!V||V.next===V.prev)return ce;if(F&&(V=function(Ae,Ve,Ke,dt){var bt,Mt,Ot,Nt=[];for(bt=0,Mt=Ve.length;bt<Mt;bt++)(Ot=Df(Ae,Ve[bt]*dt,bt<Mt-1?Ve[bt+1]*dt:Ae.length,dt,!1))===Ot.next&&(Ot.steiner=!0),Nt.push(Af(Ot));for(Nt.sort(Mf),bt=0;bt<Nt.length;bt++)Ke=lc(Ke=Uh(Nt[bt],Ke),Ke.next);return Ke}(t,e,V,i)),t.length>80*i){s=p=t[0],u=_=t[1];for(var ve=i;ve<U;ve+=i)(x=t[ve])<s&&(s=x),(E=t[ve+1])<u&&(u=E),x>p&&(p=x),E>_&&(_=E);M=0!==(M=Math.max(p-s,_-u))?1/M:0}return Nu(V,ce,i,s,u,M),ce}function Df(t,e,i,s,u){var p,_;if(u===lu(t,e,i,s)>0)for(p=e;p<i;p+=s)_=$h(p,t[p],t[p+1],_);else for(p=i-s;p>=e;p-=s)_=$h(p,t[p],t[p+1],_);return _&&zu(_,_.next)&&(Bc(_),_=_.next),_}function lc(t,e){if(!t)return t;e||(e=t);var i,s=t;do{if(i=!1,s.steiner||!zu(s,s.next)&&0!==Oo(s.prev,s,s.next))s=s.next;else{if(Bc(s),(s=e=s.prev)===s.next)break;i=!0}}while(i||s!==e);return e}function Nu(t,e,i,s,u,p,_){if(t){!_&&p&&function(F,U,V,ce){var ve=F;do{null===ve.z&&(ve.z=Zh(ve.x,ve.y,U,V,ce)),ve.prevZ=ve.prev,ve.nextZ=ve.next,ve=ve.next}while(ve!==F);ve.prevZ.nextZ=null,ve.prevZ=null,function(Ae){var Ve,Ke,dt,bt,Mt,Ot,Nt,gn,hn=1;do{for(Ke=Ae,Ae=null,Mt=null,Ot=0;Ke;){for(Ot++,dt=Ke,Nt=0,Ve=0;Ve<hn&&(Nt++,dt=dt.nextZ);Ve++);for(gn=hn;Nt>0||gn>0&&dt;)0!==Nt&&(0===gn||!dt||Ke.z<=dt.z)?(bt=Ke,Ke=Ke.nextZ,Nt--):(bt=dt,dt=dt.nextZ,gn--),Mt?Mt.nextZ=bt:Ae=bt,bt.prevZ=Mt,Mt=bt;Ke=dt}Mt.nextZ=null,hn*=2}while(Ot>1)}(ve)}(t,s,u,p);for(var x,E,M=t;t.prev!==t.next;)if(x=t.prev,E=t.next,p?ug(t,s,u,p):cg(t))e.push(x.i/i),e.push(t.i/i),e.push(E.i/i),Bc(t),t=E.next,M=E.next;else if((t=E)===M){_?1===_?Nu(t=If(lc(t),e,i),e,i,s,u,p,2):2===_&&zh(t,e,i,s,u,p):Nu(lc(t),e,i,s,u,p,1);break}}}function cg(t){var e=t.prev,i=t,s=t.next;if(Oo(e,i,s)>=0)return!1;for(var u=t.next.next;u!==t.prev;){if(Lc(e.x,e.y,i.x,i.y,s.x,s.y,u.x,u.y)&&Oo(u.prev,u,u.next)>=0)return!1;u=u.next}return!0}function ug(t,e,i,s){var u=t.prev,p=t,_=t.next;if(Oo(u,p,_)>=0)return!1;for(var x=u.x>p.x?u.x>_.x?u.x:_.x:p.x>_.x?p.x:_.x,E=u.y>p.y?u.y>_.y?u.y:_.y:p.y>_.y?p.y:_.y,M=Zh(u.x<p.x?u.x<_.x?u.x:_.x:p.x<_.x?p.x:_.x,u.y<p.y?u.y<_.y?u.y:_.y:p.y<_.y?p.y:_.y,e,i,s),F=Zh(x,E,e,i,s),U=t.prevZ,V=t.nextZ;U&&U.z>=M&&V&&V.z<=F;){if(U!==t.prev&&U!==t.next&&Lc(u.x,u.y,p.x,p.y,_.x,_.y,U.x,U.y)&&Oo(U.prev,U,U.next)>=0||(U=U.prevZ,V!==t.prev&&V!==t.next&&Lc(u.x,u.y,p.x,p.y,_.x,_.y,V.x,V.y)&&Oo(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;U&&U.z>=M;){if(U!==t.prev&&U!==t.next&&Lc(u.x,u.y,p.x,p.y,_.x,_.y,U.x,U.y)&&Oo(U.prev,U,U.next)>=0)return!1;U=U.prevZ}for(;V&&V.z<=F;){if(V!==t.prev&&V!==t.next&&Lc(u.x,u.y,p.x,p.y,_.x,_.y,V.x,V.y)&&Oo(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function If(t,e,i){var s=t;do{var u=s.prev,p=s.next.next;!zu(u,p)&&Sf(u,s,s.next,p)&&au(u,p)&&au(p,u)&&(e.push(u.i/i),e.push(s.i/i),e.push(p.i/i),Bc(s),Bc(s.next),s=t=p),s=s.next}while(s!==t);return lc(s)}function zh(t,e,i,s,u,p){var _=t;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&kc(_,x)){var E=Vh(_,x);return _=lc(_,_.next),E=lc(E,E.next),Nu(_,e,i,s,u,p),void Nu(E,e,i,s,u,p)}x=x.next}_=_.next}while(_!==t)}function Mf(t,e){return t.x-e.x}function Uh(t,e){var i=function(p,_){var x,E=_,M=p.x,F=p.y,U=-1/0;do{if(F<=E.y&&F>=E.next.y&&E.next.y!==E.y){var V=E.x+(F-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(V<=M&&V>U){if(U=V,V===M){if(F===E.y)return E;if(F===E.next.y)return E.next}x=E.x<E.next.x?E:E.next}}E=E.next}while(E!==_);if(!x)return null;if(M===U)return x;var ce,ve=x,Ae=x.x,Ve=x.y,Ke=1/0;E=x;do{M>=E.x&&E.x>=Ae&&M!==E.x&&Lc(F<Ve?M:U,F,Ae,Ve,F<Ve?U:M,F,E.x,E.y)&&(ce=Math.abs(F-E.y)/(M-E.x),au(E,p)&&(ce<Ke||ce===Ke&&(E.x>x.x||E.x===x.x&&dg(x,E)))&&(x=E,Ke=ce)),E=E.next}while(E!==ve);return x}(t,e);if(!i)return e;var s=Vh(i,t),u=lc(i,i.next);return lc(s,s.next),e===i?u:e}function dg(t,e){return Oo(t.prev,t,e.prev)<0&&Oo(e.next,t,t.next)<0}function Zh(t,e,i,s,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*u)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*u)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Af(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Lc(t,e,i,s,u,p,_,x){return(u-_)*(e-x)-(t-_)*(p-x)>=0&&(t-_)*(s-x)-(i-_)*(e-x)>=0&&(i-_)*(p-x)-(u-_)*(s-x)>=0}function kc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,s){var u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==s.i&&u.next.i!==s.i&&Sf(u,u.next,i,s))return!0;u=u.next}while(u!==i);return!1}(t,e)&&(au(t,e)&&au(e,t)&&function(i,s){var u=i,p=!1,_=(i.x+s.x)/2,x=(i.y+s.y)/2;do{u.y>x!=u.next.y>x&&u.next.y!==u.y&&_<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next}while(u!==i);return p}(t,e)&&(Oo(t.prev,t,e.prev)||Oo(t,e.prev,e))||zu(t,e)&&Oo(t.prev,t,t.next)>0&&Oo(e.prev,e,e.next)>0)}function Oo(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function zu(t,e){return t.x===e.x&&t.y===e.y}function Sf(t,e,i,s){var u=Md(Oo(t,e,i)),p=Md(Oo(t,e,s)),_=Md(Oo(i,s,t)),x=Md(Oo(i,s,e));return u!==p&&_!==x||!(0!==u||!Fc(t,i,e))||!(0!==p||!Fc(t,s,e))||!(0!==_||!Fc(i,t,s))||!(0!==x||!Fc(i,e,s))}function Fc(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Md(t){return t>0?1:t<0?-1:0}function au(t,e){return Oo(t.prev,t,t.next)<0?Oo(t,e,t.next)>=0&&Oo(t,t.prev,e)>=0:Oo(t,e,t.prev)<0||Oo(t,t.next,e)<0}function Vh(t,e){var i=new Ad(t.i,t.x,t.y),s=new Ad(e.i,e.x,e.y),u=t.next,p=e.prev;return t.next=e,e.prev=t,i.next=u,u.prev=i,s.next=i,i.prev=s,p.next=s,s.prev=p,s}function $h(t,e,i,s){var u=new Ad(t,e,i);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function Bc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ad(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function lu(t,e,i,s){for(var u=0,p=e,_=i-s;p<i;p+=s)u+=(t[_]-t[p])*(t[p+1]+t[_+1]),_=p;return u}function Sd(t,e,i,s,u){jh(t,e,i||0,s||t.length-1,u||Pf)}function jh(t,e,i,s,u){for(;s>i;){if(s-i>600){var p=s-i+1,_=e-i+1,x=Math.log(p),E=.5*Math.exp(2*x/3),M=.5*Math.sqrt(x*E*(p-E)/p)*(_-p/2<0?-1:1);jh(t,e,Math.max(i,Math.floor(e-_*E/p+M)),Math.min(s,Math.floor(e+(p-_)*E/p+M)),u)}var F=t[e],U=i,V=s;for(Nc(t,i,e),u(t[s],F)>0&&Nc(t,i,s);U<V;){for(Nc(t,U,V),U++,V--;u(t[U],F)<0;)U++;for(;u(t[V],F)>0;)V--}0===u(t[i],F)?Nc(t,i,V):Nc(t,++V,s),V<=e&&(i=V+1),e<=V&&(s=V-1)}}function Nc(t,e,i){var s=t[e];t[e]=t[i],t[i]=s}function Pf(t,e){return t<e?-1:t>e?1:0}function Uu(t,e){const i=t.length;if(i<=1)return[t];const s=[];let u,p;for(let _=0;_<i;_++){const x=ci(t[_]);0!==x&&(t[_].area=Math.abs(x),void 0===p&&(p=x<0),p===x<0?(u&&s.push(u),u=[t[_]]):u.push(t[_]))}if(u&&s.push(u),e>1)for(let _=0;_<s.length;_++)s[_].length<=e||(Sd(s[_],e,1,s[_].length-1,Zu),s[_]=s[_].slice(0,e));return s}function Zu(t,e){return e.area-t.area}function Gh(t,e,i){const s=i.patternDependencies;let u=!1;for(const p of e){const _=p.paint.get(`${t}-pattern`);_.isConstant()||(u=!0);const x=_.constantOr(null);x&&(u=!0,s[x.to]=!0,s[x.from]=!0)}return u}function Pd(t,e,i,s,u){const p=u.patternDependencies;for(const _ of e){const x=_.paint.get(`${t}-pattern`).value;if("constant"!==x.kind){let E=x.evaluate({zoom:s-1},i,{},u.availableImages),M=x.evaluate({zoom:s},i,{},u.availableImages),F=x.evaluate({zoom:s+1},i,{},u.availableImages);E=E&&E.name?E.name:E,M=M&&M.name?M.name:M,F=F&&F.name?F.name:F,p[E]=!0,p[M]=!0,p[F]=!0,i.patterns[_.id]={min:E,mid:M,max:F}}}return i}Id.deviation=function(t,e,i,s){var u=e&&e.length,p=Math.abs(lu(t,0,u?e[0]*i:t.length,i));if(u)for(var _=0,x=e.length;_<x;_++)p-=Math.abs(lu(t,e[_]*i,_<x-1?e[_+1]*i:t.length,i));var E=0;for(_=0;_<s.length;_+=3){var M=s[_]*i,F=s[_+1]*i,U=s[_+2]*i;E+=Math.abs((t[M]-t[U])*(t[F+1]-t[M+1])-(t[M]-t[F])*(t[U+1]-t[M+1]))}return 0===p&&0===E?0:Math.abs((E-p)/p)},Id.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,u=0;u<t.length;u++){for(var p=0;p<t[u].length;p++)for(var _=0;_<e;_++)i.vertices.push(t[u][p][_]);u>0&&i.holes.push(s+=t[u-1].length)}return i},Dd.default=Nh;class Od{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Kc,this.indexArray=new oa,this.indexArray2=new Ra,this.programConfigurations=new Pc(e.layers,e.zoom),this.segments=new qo,this.segments2=new qo,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,u){this.hasPattern=Gh("fill",this.layers,i);const p=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:E,index:M,sourceLayerIndex:F}of e){const U=this.layers[0]._featureFilter.needGeometry,V=$l(x,U);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom),V,s))continue;const ce=p?p.evaluate(V,{},s,i.availableImages):void 0,ve={id:E,properties:x.properties,type:x.type,sourceLayerIndex:F,index:M,geometry:U?V.geometry:Vl(x,s,u),patterns:{},sortKey:ce};_.push(ve)}p&&_.sort((x,E)=>x.sortKey-E.sortKey);for(const x of _){const{geometry:E,index:M,sourceLayerIndex:F}=x;if(this.hasPattern){const U=Pd("fill",this.layers,x,this.zoom,i);this.patternFeatures.push(U)}else this.addFeature(x,E,M,s,{},i.availableImages);i.featureIndex.insert(e[M].feature,E,M,F,this.index)}}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}addFeatures(e,i,s,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,i,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ef),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,s,u,p,_=[]){for(const x of Uu(i,500)){let E=0;for(const ve of x)E+=ve.length;const M=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),F=M.vertexLength,U=[],V=[];for(const ve of x){if(0===ve.length)continue;ve!==x[0]&&V.push(U.length/2);const Ae=this.segments2.prepareSegment(ve.length,this.layoutVertexArray,this.indexArray2),Ve=Ae.vertexLength;this.layoutVertexArray.emplaceBack(ve[0].x,ve[0].y),this.indexArray2.emplaceBack(Ve+ve.length-1,Ve),U.push(ve[0].x),U.push(ve[0].y);for(let Ke=1;Ke<ve.length;Ke++)this.layoutVertexArray.emplaceBack(ve[Ke].x,ve[Ke].y),this.indexArray2.emplaceBack(Ve+Ke-1,Ve+Ke),U.push(ve[Ke].x),U.push(ve[Ke].y);Ae.vertexLength+=ve.length,Ae.primitiveLength+=ve.length}const ce=Dd(U,V);for(let ve=0;ve<ce.length;ve+=3)this.indexArray.emplaceBack(F+ce[ve],F+ce[ve+1],F+ce[ve+2]);M.vertexLength+=E,M.primitiveLength+=ce.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,_,u)}}Kn("FillBucket",Od,{omit:["layers","patternFeatures"]});const hg=new ds({"fill-sort-key":new bi(St.layout_fill["fill-sort-key"])});var Of={paint:new ds({"fill-antialias":new si(St.paint_fill["fill-antialias"]),"fill-opacity":new bi(St.paint_fill["fill-opacity"]),"fill-color":new bi(St.paint_fill["fill-color"]),"fill-outline-color":new bi(St.paint_fill["fill-outline-color"]),"fill-translate":new si(St.paint_fill["fill-translate"]),"fill-translate-anchor":new si(St.paint_fill["fill-translate-anchor"]),"fill-pattern":new ss(St.paint_fill["fill-pattern"])}),layout:hg};const qh=bo([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Rf=bo([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:G_}=qh;var Hh=cu;function cu(t,e,i,s,u){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=u,t.readFields(Lf,this,e)}function Lf(t,e,i){1==t?e.id=i.readVarint():2==t?function(s,u){for(var p=s.readVarint()+s.pos;s.pos<p;){var _=u._keys[s.readVarint()],x=u._values[s.readVarint()];u.properties[_]=x}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function pg(t){for(var e,i,s=0,u=0,p=t.length,_=p-1;u<p;_=u++)s+=((i=t[_]).x-(e=t[u]).x)*(e.y+i.y);return s}cu.types=["Unknown","Point","LineString","Polygon"],cu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,s=1,u=0,p=0,_=0,x=[];t.pos<i;){if(u<=0){var E=t.readVarint();s=7&E,u=E>>3}if(u--,1===s||2===s)p+=t.readSVarint(),_+=t.readSVarint(),1===s&&(e&&x.push(e),e=[]),e.push(new ne(p,_));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&x.push(e),x},cu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,s=0,u=0,p=0,_=1/0,x=-1/0,E=1/0,M=-1/0;t.pos<e;){if(s<=0){var F=t.readVarint();i=7&F,s=F>>3}if(s--,1===i||2===i)(u+=t.readSVarint())<_&&(_=u),u>x&&(x=u),(p+=t.readSVarint())<E&&(E=p),p>M&&(M=p);else if(7!==i)throw new Error("unknown command "+i)}return[_,E,x,M]},cu.prototype.toGeoJSON=function(t,e,i){var s,u,p=this.extent*Math.pow(2,i),_=this.extent*t,x=this.extent*e,E=this.loadGeometry(),M=cu.types[this.type];function F(ce){for(var ve=0;ve<ce.length;ve++){var Ae=ce[ve];ce[ve]=[360*(Ae.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ae.y+x)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var U=[];for(s=0;s<E.length;s++)U[s]=E[s][0];F(E=U);break;case 2:for(s=0;s<E.length;s++)F(E[s]);break;case 3:for(E=function(ce){var ve=ce.length;if(ve<=1)return[ce];for(var Ae,Ve,Ke=[],dt=0;dt<ve;dt++){var bt=pg(ce[dt]);0!==bt&&(void 0===Ve&&(Ve=bt<0),Ve===bt<0?(Ae&&Ke.push(Ae),Ae=[ce[dt]]):Ae.push(ce[dt]))}return Ae&&Ke.push(Ae),Ke}(E),s=0;s<E.length;s++)for(u=0;u<E[s].length;u++)F(E[s][u])}1===E.length?E=E[0]:M="Multi"+M;var V={type:"Feature",geometry:{type:M,coordinates:E},properties:this.properties};return"id"in this&&(V.id=this.id),V};var kf=ka;function ka(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(fg,this,e),this.length=this._features.length}function fg(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(s){for(var u=null,p=s.readVarint()+s.pos;s.pos<p;){var _=s.readVarint()>>3;u=1===_?s.readString():2===_?s.readFloat():3===_?s.readDouble():4===_?s.readVarint64():5===_?s.readVarint():6===_?s.readSVarint():7===_?s.readBoolean():null}return u}(i))}function Ff(t,e,i){if(3===t){var s=new kf(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}ka.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Hh(this._pbf,e,this.extent,this._keys,this._values)};var zc={VectorTile:function(t,e){this.layers=t.readFields(Ff,{},e)},VectorTileFeature:Hh,VectorTileLayer:kf};const mg=zc.VectorTileFeature.types,gg=Math.pow(2,13);function Vu(t,e,i,s,u,p,_,x){t.emplaceBack((e<<1)+_,(i<<1)+p,(Math.floor(s*gg)<<1)+u,Math.round(x))}class Wh{constructor(){this.acc=new ne(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ne(e.x,e.y),this.max=new ne(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);let s=!!this.borders;const u=this.min,p=this.max;e.x<u.x?(u.x=e.x,s=!0):e.x>p.x&&(p.x=e.x,s=!0),e.y<u.y?(u.y=e.y,s=!0):e.y>p.y&&(p.y=e.y,s=!0),((0===e.x||e.x===er)&&e.x===i.x)!=((0===e.y||e.y===er)&&e.y===i.y)&&this.processBorderOverlap(e,i),s&&this.checkBorderIntersection(e,i)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,yr(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>er!=e.x>er&&this.addBorderIntersection(1,yr(i.y,e.y,(er-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,yr(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>er!=e.y>er&&this.addBorderIntersection(3,yr(i.x,e.x,(er-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((i,s)=>i+s.edges,0);return 0!==e?this.acc.div(e)._round():new ne(0,0)}span(){return new ne(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class Yh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Nl,this.centroidVertexArray=new Th,this.indexArray=new oa,this.programConfigurations=new Pc(e.layers,e.zoom),this.segments=new qo,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,s,u){this.features=[],this.hasPattern=Gh("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(p){const _=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*_/(_*_+1)/er/(1<<p.z)}(s);for(const{feature:p,id:_,index:x,sourceLayerIndex:E}of e){const M=this.layers[0]._featureFilter.needGeometry,F=$l(p,M);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom),F,s))continue;const U={id:_,sourceLayerIndex:E,index:x,geometry:M?F.geometry:Vl(p,s,u),properties:p.properties,type:p.type,patterns:{}},V=this.layoutVertexArray.length;this.hasPattern?this.features.push(Pd("fill-extrusion",this.layers,U,this.zoom,i)):this.addFeature(U,U.geometry,x,s,{},i.availableImages),i.featureIndex.insert(p,U.geometry,x,E,this.index,V)}this.sortBorders()}addFeatures(e,i,s,u){for(const p of this.features){const{geometry:_}=p;this.addFeature(p,_,p.index,i,s,u)}this.sortBorders()}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,G_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Rf.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,u,p,_){const x=this.enableTerrain?new Wh:null;for(const M of Uu(i,500)){let F=0,U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===M.length||(E=M[0]).every(Ve=>Ve.x<=0)||E.every(Ve=>Ve.x>=er)||E.every(Ve=>Ve.y<=0)||E.every(Ve=>Ve.y>=er))continue;for(let Ve=0;Ve<M.length;Ve++){const Ke=M[Ve];if(0===Ke.length)continue;F+=Ke.length;let dt=0;x&&x.startRing(Ke[0]);for(let bt=0;bt<Ke.length;bt++){const Mt=Ke[bt];if(bt>=1){const Ot=Ke[bt-1];if(!_g(Mt,Ot)){x&&x.append(Mt,Ot),U.vertexLength+4>qo.MAX_VERTEX_ARRAY_LENGTH&&(U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Nt=Mt.sub(Ot)._perp(),gn=Nt.x/(Math.abs(Nt.x)+Math.abs(Nt.y)),hn=Nt.y>0?1:0,Zn=Ot.dist(Mt);dt+Zn>32768&&(dt=0),Vu(this.layoutVertexArray,Mt.x,Mt.y,gn,hn,0,0,dt),Vu(this.layoutVertexArray,Mt.x,Mt.y,gn,hn,0,1,dt),dt+=Zn,Vu(this.layoutVertexArray,Ot.x,Ot.y,gn,hn,0,0,dt),Vu(this.layoutVertexArray,Ot.x,Ot.y,gn,hn,0,1,dt);const Ln=U.vertexLength;this.indexArray.emplaceBack(Ln,Ln+2,Ln+1),this.indexArray.emplaceBack(Ln+1,Ln+2,Ln+3),U.vertexLength+=4,U.primitiveLength+=2}}}}if(U.vertexLength+F>qo.MAX_VERTEX_ARRAY_LENGTH&&(U=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),"Polygon"!==mg[e.type])continue;const V=[],ce=[],ve=U.vertexLength;for(let Ve=0;Ve<M.length;Ve++){const Ke=M[Ve];if(0!==Ke.length){Ke!==M[0]&&ce.push(V.length/2);for(let dt=0;dt<Ke.length;dt++){const bt=Ke[dt];Vu(this.layoutVertexArray,bt.x,bt.y,0,0,1,1,0),V.push(bt.x),V.push(bt.y),x&&x.currentPolyCount.top++}}}const Ae=Dd(V,ce);for(let Ve=0;Ve<Ae.length;Ve+=3)this.indexArray.emplaceBack(ve+Ae[Ve],ve+Ae[Ve+2],ve+Ae[Ve+1]);U.primitiveLength+=Ae.length/3,U.vertexLength+=F}var E;if(x&&x.polyCount.length>0){if(x.borders){x.vertexArrayOffset=this.centroidVertexArray.length;const M=x.borders,F=this.featuresOnBorder.push(x)-1;for(let U=0;U<4;U++)M[U][0]!==Number.MAX_VALUE&&this.borders[U].push(F)}this.encodeCentroid(x.borders?void 0:x.centroid(),x)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,_,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,i,s=!0){let u,p;if(e)if(0!==e.y){const x=i.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(x.x/10)),p=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else u=Math.ceil(7*(e.x+450)),p=0;else u=0,p=+s;let _=s?this.centroidVertexArray.length:i.vertexArrayOffset;for(const x of i.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let E=0;E<2*x.edges;E++)this.centroidVertexArray.emplace(_++,0,p),this.centroidVertexArray.emplace(_++,u,p);for(let E=0;E<x.top;E++)this.centroidVertexArray.emplace(_++,u,p)}}}function _g(t,e){return t.x===e.x&&(t.x<0||t.x>er)||t.y===e.y&&(t.y<0||t.y>er)}Kn("FillExtrusionBucket",Yh,{omit:["layers","features"]}),Kn("PartMetadata",Wh);var yg={paint:new ds({"fill-extrusion-opacity":new si(St["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bi(St["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new si(St["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new si(St["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ss(St["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bi(St["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bi(St["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new si(St["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Xi(t,e){return t.x*e.x+t.y*e.y}function Jh(t,e){if(1===t.length){let i=0;const s=e[i++];let u;for(;!u||s.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const p=e[i],_=t[0],x=u.sub(s),E=p.sub(s),M=_.sub(s),F=Xi(x,x),U=Xi(x,E),V=Xi(E,E),ce=Xi(M,x),ve=Xi(M,E),Ae=F*V-U*U,Ve=(V*ce-U*ve)/Ae,Ke=(F*ve-U*ce)/Ae,dt=s.z*(1-Ve-Ke)+u.z*Ve+p.z*Ke;if(isFinite(dt))return dt}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function Xh(t){const e=new ne(t[0],t[1]);return e.z=t[2],e}function Bf(t,e,i,s,u,p,_,x){const E=_*u.getElevationAt(t,e,!0,!0),M=0!==p[0],F=M?0===p[1]?_*(p[0]/7-450):_*function(U,V,ce){const ve=Math.floor(V[0]/8),Ae=Math.floor(V[1]/8),Ve=10*(V[0]-8*ve),Ke=10*(V[1]-8*Ae),dt=U.getElevationAt(ve,Ae,!0,!0),bt=U.getMeterToDEM(ce),Mt=Math.floor(.5*(Ve*bt-1)),Ot=Math.floor(.5*(Ke*bt-1)),Nt=U.tileCoordToPixel(ve,Ae),gn=2*Mt+1,hn=2*Ot+1,Zn=(eo=gn,ur=hn,[(Qn=U).getElevationAtPixel(ai=Nt.x-Mt,vr=Nt.y-Ot,!0),Qn.getElevationAtPixel(ai+ur,vr,!0),Qn.getElevationAtPixel(ai,vr+ur,!0),Qn.getElevationAtPixel(ai+eo,vr+ur,!0)]),Ln=Math.abs(Zn[0]-Zn[1]),pn=Math.abs(Zn[2]-Zn[3]),kn=Math.abs(Zn[0]-Zn[2])+Math.abs(Zn[1]-Zn[3]),$n=Math.min(.25,.5*bt*(Ln+pn)/gn),vn=Math.min(.25,.5*bt*kn/hn);var Qn,ai,vr,eo,ur;return dt+Math.max($n*Ve,vn*Ke)}(u,p,x):E;return{base:E+(0===i)?-1:i,top:M?Math.max(F+s,E+i+2):E+s}}const Rd=bo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:tl}=Rd,Nf=bo([{name:"a_packed",components:3,type:"Float32"}]),{members:vg}=Nf,Kh=zc.VectorTileFeature.types,jl=Math.cos(Math.PI/180*37.5);class uu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Pu,this.layoutVertexArray2=new Ja,this.indexArray=new oa,this.programConfigurations=new Pc(e.layers,e.zoom),this.segments=new qo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,u){this.hasPattern=Gh("line",this.layers,i);const p=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:F,id:U,index:V,sourceLayerIndex:ce}of e){const ve=this.layers[0]._featureFilter.needGeometry,Ae=$l(F,ve);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom),Ae,s))continue;const Ve=p?p.evaluate(Ae,{},s):void 0,Ke={id:U,properties:F.properties,type:F.type,sourceLayerIndex:ce,index:V,geometry:ve?Ae.geometry:Vl(F,s,u),patterns:{},sortKey:Ve};_.push(Ke)}p&&_.sort((F,U)=>F.sortKey-U.sortKey);const{lineAtlas:x,featureIndex:E}=i,M=this.addConstantDashes(x);for(const F of _){const{geometry:U,index:V,sourceLayerIndex:ce}=F;if(M&&this.addFeatureDashes(F,x),this.hasPattern){const ve=Pd("line",this.layers,F,this.zoom,i);this.patternFeatures.push(ve)}else this.addFeature(F,U,V,s,x.positions,i.availableImages);E.insert(e[V].feature,U,V,ce,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,p=s.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==p.kind)i=!0;else{const _=p.value,x=u.value;if(!x)continue;e.addDash(x.from,_),e.addDash(x.to,_),x.other&&e.addDash(x.other,_)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,_=u.layout.get("line-cap").value;if("constant"===p.kind&&"constant"===_.kind)continue;let x,E,M,F,U,V;if("constant"===p.kind){const Ve=p.value;if(!Ve)continue;x=Ve.other||Ve.to,E=Ve.to,M=Ve.from}else x=p.evaluate({zoom:s-1},e),E=p.evaluate({zoom:s},e),M=p.evaluate({zoom:s+1},e);"constant"===_.kind?F=U=V=_.value:(F=_.evaluate({zoom:s-1},e),U=_.evaluate({zoom:s},e),V=_.evaluate({zoom:s+1},e)),i.addDash(x,F),i.addDash(E,U),i.addDash(M,V);const ce=i.getKey(x,F),ve=i.getKey(E,U),Ae=i.getKey(M,V);e.patterns[u.id]={min:ce,mid:ve,max:Ae}}}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}addFeatures(e,i,s,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,i,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,vg)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tl),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,s,u,p,_){const x=this.layers[0].layout,E=x.get("line-join").evaluate(e,{}),M=x.get("line-cap").evaluate(e,{}),F=x.get("line-miter-limit"),U=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const V of i)this.addLine(V,e,E,M,F,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,_,u)}addLine(e,i,s,u,p,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ke=0;Ke<e.length-1;Ke++)this.totalDistance+=e[Ke].dist(e[Ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===Kh[i.type];let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let M=0;for(;M<E-1&&e[M].equals(e[M+1]);)M++;if(E<(x?3:2))return;"bevel"===s&&(p=1.05);const F=this.overscaling<=16?122880/(512*this.overscaling):0,U=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let V,ce,ve,Ae,Ve;this.e1=this.e2=-1,x&&(V=e[E-2],Ve=e[M].sub(V)._unit()._perp());for(let Ke=M;Ke<E;Ke++){if(ve=Ke===E-1?x?e[M+1]:void 0:e[Ke+1],ve&&e[Ke].equals(ve))continue;Ve&&(Ae=Ve),V&&(ce=V),V=e[Ke],Ve=ve?ve.sub(V)._unit()._perp():Ae,Ae=Ae||Ve;let dt=Ae.add(Ve);0===dt.x&&0===dt.y||dt._unit();const bt=Ae.x*Ve.x+Ae.y*Ve.y,Mt=dt.x*Ve.x+dt.y*Ve.y,Ot=0!==Mt?1/Mt:1/0,Nt=2*Math.sqrt(2-2*Mt),gn=Mt<jl&&ce&&ve,hn=Ae.x*Ve.y-Ae.y*Ve.x>0;if(gn&&Ke>M){const pn=V.dist(ce);if(pn>2*F){const kn=V.sub(V.sub(ce)._mult(F/pn)._round());this.updateDistance(ce,kn),this.addCurrentVertex(kn,Ae,0,0,U),ce=kn}}const Zn=ce&&ve;let Ln=Zn?s:x?"butt":u;if(Zn&&"round"===Ln&&(Ot<_?Ln="miter":Ot<=2&&(Ln="fakeround")),"miter"===Ln&&Ot>p&&(Ln="bevel"),"bevel"===Ln&&(Ot>2&&(Ln="flipbevel"),Ot<p&&(Ln="miter")),ce&&this.updateDistance(ce,V),"miter"===Ln)dt._mult(Ot),this.addCurrentVertex(V,dt,0,0,U);else if("flipbevel"===Ln){if(Ot>100)dt=Ve.mult(-1);else{const pn=Ot*Ae.add(Ve).mag()/Ae.sub(Ve).mag();dt._perp()._mult(pn*(hn?-1:1))}this.addCurrentVertex(V,dt,0,0,U),this.addCurrentVertex(V,dt.mult(-1),0,0,U)}else if("bevel"===Ln||"fakeround"===Ln){const pn=-Math.sqrt(Ot*Ot-1),kn=hn?pn:0,$n=hn?0:pn;if(ce&&this.addCurrentVertex(V,Ae,kn,$n,U),"fakeround"===Ln){const vn=Math.round(180*Nt/Math.PI/20);for(let Qn=1;Qn<vn;Qn++){let ai=Qn/vn;if(.5!==ai){const eo=ai-.5;ai+=ai*eo*(ai-1)*((1.0904+bt*(bt*(3.55645-1.43519*bt)-3.2452))*eo*eo+(.848013+bt*(.215638*bt-1.06021)))}const vr=Ve.sub(Ae)._mult(ai)._add(Ae)._unit()._mult(hn?-1:1);this.addHalfVertex(V,vr.x,vr.y,!1,hn,0,U)}}ve&&this.addCurrentVertex(V,Ve,-kn,-$n,U)}else if("butt"===Ln)this.addCurrentVertex(V,dt,0,0,U);else if("square"===Ln){const pn=ce?1:-1;ce||this.addCurrentVertex(V,dt,pn,pn,U),this.addCurrentVertex(V,dt,0,0,U),ce&&this.addCurrentVertex(V,dt,pn,pn,U)}else"round"===Ln&&(ce&&(this.addCurrentVertex(V,Ae,0,0,U),this.addCurrentVertex(V,Ae,1,1,U,!0)),ve&&(this.addCurrentVertex(V,Ve,-1,-1,U,!0),this.addCurrentVertex(V,Ve,0,0,U)));if(gn&&Ke<E-1){const pn=V.dist(ve);if(pn>2*F){const kn=V.add(ve.sub(V)._mult(F/pn)._round());this.updateDistance(V,kn),this.addCurrentVertex(kn,Ve,0,0,U),V=kn}}}}addCurrentVertex(e,i,s,u,p,_=!1){const x=i.y*u-i.x,E=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*s,i.y-i.x*s,_,!1,s,p),this.addHalfVertex(e,x,E,_,!0,-u,p)}addHalfVertex({x:e,y:i},s,u,p,_,x,E){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(i<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const M=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),E.primitiveLength++),_?this.e2=M:this.e1=M}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Kn("LineBucket",uu,{omit:["layers","patternFeatures"]});const zf=new ds({"line-cap":new bi(St.layout_line["line-cap"]),"line-join":new bi(St.layout_line["line-join"]),"line-miter-limit":new si(St.layout_line["line-miter-limit"]),"line-round-limit":new si(St.layout_line["line-round-limit"]),"line-sort-key":new bi(St.layout_line["line-sort-key"])});var Ld={paint:new ds({"line-opacity":new bi(St.paint_line["line-opacity"]),"line-color":new bi(St.paint_line["line-color"]),"line-translate":new si(St.paint_line["line-translate"]),"line-translate-anchor":new si(St.paint_line["line-translate-anchor"]),"line-width":new bi(St.paint_line["line-width"]),"line-gap-width":new bi(St.paint_line["line-gap-width"]),"line-offset":new bi(St.paint_line["line-offset"]),"line-blur":new bi(St.paint_line["line-blur"]),"line-dasharray":new ss(St.paint_line["line-dasharray"]),"line-pattern":new ss(St.paint_line["line-pattern"]),"line-gradient":new ra(St.paint_line["line-gradient"])}),layout:zf};const xg=new class extends bi{possiblyEvaluate(t,e){return e=new Hi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,s){return e=Oe({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,s)}}(Ld.paint.properties["line-width"].specification);function Qh(t,e){return e>0?e+2*t:t}xg.useIntegerZoom=!0;const q_=bo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),kd=bo([{name:"a_projected_pos",components:3,type:"Float32"}],4);bo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Fd=bo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ep=bo([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);bo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Bd=bo([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),tp=bo([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);bo([{name:"triangle",components:3,type:"Uint16"}]),bo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),bo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),bo([{type:"Float32",name:"offsetX"}]),bo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Cl=128;function np(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Hi(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:u}=i;let p=0;for(;p<s.length&&s[p]<=t;)p++;p=Math.max(0,p-1);let _=p;for(;_<s.length&&s[_]<t+1;)_++;_=Math.min(s.length-1,_);const x=s[p],E=s[_];return"composite"===i.kind?{kind:"composite",minZoom:x,maxZoom:E,interpolationType:u}:{kind:"camera",minZoom:x,maxZoom:E,minSize:i.evaluate(new Hi(x)),maxSize:i.evaluate(new Hi(E)),interpolationType:u}}}function Nd(t,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:u}){return"source"===t.kind?s/Cl:"composite"===t.kind?yr(s/Cl,u/Cl,i):e}function du(t,e){let i=0,s=0;if("constant"===t.kind)s=t.layoutSize;else if("source"!==t.kind){const{interpolationType:u,minZoom:p,maxZoom:_}=t,x=u?_i(Dr.interpolationFactor(u,e,p,_),0,1):0;"camera"===t.kind?s=yr(t.minSize,t.maxSize,x):i=x}return{uSizeT:i,uSize:s}}var Uf=Object.freeze({__proto__:null,getSizeData:np,evaluateSizeForFeature:Nd,evaluateSizeForZoom:du,SIZE_PACK_FACTOR:Cl});function H_(t,e,i){return t.sections.forEach(s=>{s.text=function(u,p,_){const x=p.layout.get("text-transform").evaluate(_,{});return"uppercase"===x?u=u.toLocaleUpperCase():"lowercase"===x&&(u=u.toLocaleLowerCase()),br.applyArabicShaping&&(u=br.applyArabicShaping(u)),u}(s.text,e,i)}),t}const $u={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function W_(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function Zf(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var ip=function(t,e,i,s,u){var p,_,x=8*u-s-1,E=(1<<x)-1,M=E>>1,F=-7,U=i?u-1:0,V=i?-1:1,ce=t[e+U];for(U+=V,p=ce&(1<<-F)-1,ce>>=-F,F+=x;F>0;p=256*p+t[e+U],U+=V,F-=8);for(_=p&(1<<-F)-1,p>>=-F,F+=s;F>0;_=256*_+t[e+U],U+=V,F-=8);if(0===p)p=1-M;else{if(p===E)return _?NaN:1/0*(ce?-1:1);_+=Math.pow(2,s),p-=M}return(ce?-1:1)*_*Math.pow(2,p-s)},Vf=function(t,e,i,s,u,p){var _,x,E,M=8*p-u-1,F=(1<<M)-1,U=F>>1,V=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,ce=s?0:p-1,ve=s?1:-1,Ae=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,_=F):(_=Math.floor(Math.log(e)/Math.LN2),e*(E=Math.pow(2,-_))<1&&(_--,E*=2),(e+=_+U>=1?V/E:V*Math.pow(2,1-U))*E>=2&&(_++,E/=2),_+U>=F?(x=0,_=F):_+U>=1?(x=(e*E-1)*Math.pow(2,u),_+=U):(x=e*Math.pow(2,U-1)*Math.pow(2,u),_=0));u>=8;t[i+ce]=255&x,ce+=ve,x/=256,u-=8);for(_=_<<u|x,M+=u;M>0;t[i+ce]=255&_,ce+=ve,_/=256,M-=8);t[i+ce-ve]|=128*Ae},Uc=ao;function ao(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ao.Varint=0,ao.Fixed64=1,ao.Bytes=2,ao.Fixed32=5;var $f=4294967296,bg=1/$f,wg="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function cc(t){return t.type===ao.Bytes?t.readVarint()+t.pos:t.pos+1}function Tg(t,e,i){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(var u=i.pos-1;u>=t;u--)i.buf[u+s]=i.buf[u]}function Y_(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function J_(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function X_(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function uc(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function rp(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Cg(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function jf(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function op(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Gf(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function hu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function pu(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Gl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function qf(t,e,i){e.glyphs=[],1===t&&i.readMessage(Eg,e)}function Eg(t,e,i){if(3===t){const{id:s,bitmap:u,width:p,height:_,left:x,top:E,advance:M}=i.readMessage(sp,{});e.glyphs.push({id:s,bitmap:new Tl({width:p+6,height:_+6},u),metrics:{width:p,height:_,left:x,top:E,advance:M}})}else 4===t?e.ascender=i.readSVarint():5===t&&(e.descender=i.readSVarint())}function sp(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}function ap(t){let e=0,i=0;for(const _ of t)e+=_.w*_.h,i=Math.max(i,_.w);t.sort((_,x)=>x.h-_.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,p=0;for(const _ of t)for(let x=s.length-1;x>=0;x--){const E=s[x];if(!(_.w>E.w||_.h>E.h)){if(_.x=E.x,_.y=E.y,p=Math.max(p,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===E.w&&_.h===E.h){const M=s.pop();x<s.length&&(s[x]=M)}else _.h===E.h?(E.x+=_.w,E.w-=_.w):_.w===E.w?(E.y+=_.h,E.h-=_.h):(s.push({x:E.x+_.w,y:E.y,w:E.w-_.w,h:_.h}),E.y+=_.h,E.h-=_.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}ao.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),u=s>>3,p=this.pos;this.type=7&s,t(u,e,this),this.pos===p&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=hu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Gl(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=hu(this.buf,this.pos)+hu(this.buf,this.pos+4)*$f;return this.pos+=8,t},readSFixed64:function(){var t=hu(this.buf,this.pos)+Gl(this.buf,this.pos+4)*$f;return this.pos+=8,t},readFloat:function(){var t=ip(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ip(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,s=this.buf;return e=127&(i=s[this.pos++]),i<128?e:(e|=(127&(i=s[this.pos++]))<<7,i<128?e:(e|=(127&(i=s[this.pos++]))<<14,i<128?e:(e|=(127&(i=s[this.pos++]))<<21,i<128?e:function(u,p,_){var x,E,M=_.buf;if(x=(112&(E=M[_.pos++]))>>4,E<128||(x|=(127&(E=M[_.pos++]))<<3,E<128)||(x|=(127&(E=M[_.pos++]))<<10,E<128)||(x|=(127&(E=M[_.pos++]))<<17,E<128)||(x|=(127&(E=M[_.pos++]))<<24,E<128)||(x|=(1&(E=M[_.pos++]))<<31,E<128))return function ju(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(u,x,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&wg?wg.decode(this.buf.subarray(e,t)):function(i,s,u){for(var p="",_=s;_<u;){var x,E,M,F=i[_],U=null,V=F>239?4:F>223?3:F>191?2:1;if(_+V>u)break;1===V?F<128&&(U=F):2===V?128==(192&(x=i[_+1]))&&(U=(31&F)<<6|63&x)<=127&&(U=null):3===V?(E=i[_+2],128==(192&(x=i[_+1]))&&128==(192&E)&&((U=(15&F)<<12|(63&x)<<6|63&E)<=2047||U>=55296&&U<=57343)&&(U=null)):4===V&&(E=i[_+2],M=i[_+3],128==(192&(x=i[_+1]))&&128==(192&E)&&128==(192&M)&&((U=(15&F)<<18|(63&x)<<12|(63&E)<<6|63&M)<=65535||U>=1114112)&&(U=null)),null===U?(U=65533,V=1):U>65535&&(U-=65536,p+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),p+=String.fromCharCode(U),_+=V}return p}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ao.Bytes)return t.push(this.readVarint(e));var i=cc(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ao.Bytes)return t.push(this.readSVarint());var e=cc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ao.Bytes)return t.push(this.readBoolean());var e=cc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ao.Bytes)return t.push(this.readFloat());var e=cc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ao.Bytes)return t.push(this.readDouble());var e=cc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ao.Bytes)return t.push(this.readFixed32());var e=cc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ao.Bytes)return t.push(this.readSFixed32());var e=cc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ao.Bytes)return t.push(this.readFixed64());var e=cc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ao.Bytes)return t.push(this.readSFixed64());var e=cc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===ao.Varint)for(;this.buf[this.pos++]>127;);else if(e===ao.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ao.Fixed32)this.pos+=4;else{if(e!==ao.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),pu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),pu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),pu(this.buf,-1&t,this.pos),pu(this.buf,Math.floor(t*bg),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),pu(this.buf,-1&t,this.pos),pu(this.buf,Math.floor(t*bg),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var s,u,p,x;if(e>=0?(s=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),p=s,(x=i).buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7),function(p,_){var x=(7&p)<<4;_.buf[_.pos++]|=x|((p>>>=3)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p)))))}(u,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,u,p){for(var _,x,E=0;E<u.length;E++){if((_=u.charCodeAt(E))>55295&&_<57344){if(!x){_>56319||E+1===u.length?(s[p++]=239,s[p++]=191,s[p++]=189):x=_;continue}if(_<56320){s[p++]=239,s[p++]=191,s[p++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(s[p++]=239,s[p++]=191,s[p++]=189,x=null);_<128?s[p++]=_:(_<2048?s[p++]=_>>6|192:(_<65536?s[p++]=_>>12|224:(s[p++]=_>>18|240,s[p++]=_>>12&63|128),s[p++]=_>>6&63|128),s[p++]=63&_|128)}return p}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Tg(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Vf(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Vf(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var s=this.pos-i;s>=128&&Tg(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,i){this.writeTag(t,ao.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Y_,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,J_,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,rp,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,X_,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,uc,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Cg,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,jf,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,op,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Gf,e)},writeBytesField:function(t,e){this.writeTag(t,ao.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ao.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ao.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ao.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ao.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ao.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ao.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ao.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ao.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ao.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class zd{constructor(e,{pixelRatio:i,version:s,stretchX:u,stretchY:p,content:_}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=p,this.content=_,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Hf{constructor(e,i){const s={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,s,p),this.addImages(i,u,p);const{w:_,h:x}=ap(p),E=new Ws({width:_||1,height:x||1});for(const M in e){const F=e[M],U=s[M].paddedRect;Ws.copy(F.data,E,{x:0,y:0},{x:U.x+1,y:U.y+1},F.data)}for(const M in i){const F=i[M],U=u[M].paddedRect,V=U.x+1,ce=U.y+1,ve=F.data.width,Ae=F.data.height;Ws.copy(F.data,E,{x:0,y:0},{x:V,y:ce},F.data),Ws.copy(F.data,E,{x:0,y:Ae-1},{x:V,y:ce-1},{width:ve,height:1}),Ws.copy(F.data,E,{x:0,y:0},{x:V,y:ce+Ae},{width:ve,height:1}),Ws.copy(F.data,E,{x:ve-1,y:0},{x:V-1,y:ce},{width:1,height:Ae}),Ws.copy(F.data,E,{x:0,y:0},{x:V+ve,y:ce},{width:1,height:Ae})}this.image=E,this.iconPositions=s,this.patternPositions=u}addImages(e,i,s){for(const u in e){const p=e[u],_={x:0,y:0,w:p.data.width+2,h:p.data.height+2};s.push(_),i[u]=new zd(_,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),i),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),i)}patchUpdatedImage(e,i,s){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,p]=e.tl;s.update(i.data,void 0,{x:u,y:p})}}Kn("ImagePosition",zd),Kn("ImageAtlas",Hf);const ba={horizontal:1,vertical:2,horizontalOnly:3};class ql{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const s=new ql;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new ql;return i.imageName=e,i}}class nl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const s=new nl;for(let u=0;u<e.sections.length;u++){const p=e.sections[u];p.image?s.addImageSection(p):s.addTextSection(p,i)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,s){let u="";for(let p=0;p<i.length;p++){const _=i.charCodeAt(p+1)||null,x=i.charCodeAt(p-1)||null;u+=!s&&(_&&ui(_)&&!$u[i[p+1]]||x&&ui(x)&&!$u[i[p-1]])||!$u[i[p]]?i[p]:$u[i[p]]}return u}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Hl[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Hl[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new nl;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(ql.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e){const i=e.image?e.image.name:"";if(0===i.length)return void Di("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(ql.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Di("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Gu(t,e,i,s,u,p,_,x,E,M,F,U,V,ce,ve,Ae){const Ve=nl.fromFeature(t,u);let Ke;U===ba.vertical&&Ve.verticalizePunctuation(V);const{processBidirectionalText:dt,processStyledBidirectionalText:bt}=br;if(dt&&1===Ve.sections.length){Ke=[];const Nt=dt(Ve.toString(),Hu(Ve,M,p,e,s,ce,ve));for(const gn of Nt){const hn=new nl;hn.text=gn,hn.sections=Ve.sections;for(let Zn=0;Zn<gn.length;Zn++)hn.sectionIndex.push(0);Ke.push(hn)}}else if(bt){Ke=[];const Nt=bt(Ve.text,Ve.sectionIndex,Hu(Ve,M,p,e,s,ce,ve));for(const gn of Nt){const hn=new nl;hn.text=gn[0],hn.sectionIndex=gn[1],hn.sections=Ve.sections,Ke.push(hn)}}else Ke=function(Nt,gn){const hn=[],Zn=Nt.text;let Ln=0;for(const pn of gn)hn.push(Nt.substring(Ln,pn)),Ln=pn;return Ln<Zn.length&&hn.push(Nt.substring(Ln,Zn.length)),hn}(Ve,Hu(Ve,M,p,e,s,ce,ve));const Mt=[],Ot={positionedLines:Mt,text:Ve.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:U,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Nt,gn,hn,Zn,Ln,pn,kn,$n,vn,Qn,ai,vr){let eo=0,ur=0,wr=0;const Mn="right"===$n?1:"left"===$n?0:.5;let Nr=!1;for(const zr of Ln){const dr=zr.getSections();for(const go of dr){if(go.imageName)continue;const Mo=gn[go.fontStack];if(Mo&&(Nr=void 0!==Mo.ascender&&void 0!==Mo.descender,!Nr))break}if(!Nr)break}let Ar=0;for(const zr of Ln){zr.trim();const dr=zr.getMaxScale(),go=24*(dr-1),Mo={positionedGlyphs:[],lineOffset:0};Nt.positionedLines[Ar]=Mo;const Fo=Mo.positionedGlyphs;let Ro=0;if(!zr.length()){ur+=pn,++Ar;continue}let Es=0,la=0;for(let po=0;po<zr.length();po++){const Wo=zr.getSection(po),ca=zr.getSectionIndex(po),ps=zr.getCharCode(po);let Wr=Wo.scale,Yo=null,_o=null,Us=null,ns=24,fs=0;const Ds=!(vn===ba.horizontal||!ai&&!mn(ps)||ai&&(Hl[ps]||(ko=ps,n(ko)||c(ko)||m(ko)||ft(ko)||Dn(ko))));if(Wo.imageName){const Zs=Zn[Wo.imageName];if(!Zs)continue;Us=Wo.imageName,Nt.iconsInText=Nt.iconsInText||!0,_o=Zs.paddedRect;const is=Zs.displaySize;Wr=24*Wr/vr,Yo={width:is[0],height:is[1],left:1,top:-3,advance:Ds?is[1]:is[0],localGlyph:!1},fs=Nr?-Yo.height*Wr:24*dr-17-is[1]*Wr,ns=Yo.advance;const Ta=(Ds?is[0]:is[1])*Wr-24*dr;Ta>0&&Ta>Ro&&(Ro=Ta)}else{const Zs=hn[Wo.fontStack];if(!Zs)continue;Zs[ps]&&(_o=Zs[ps]);const is=gn[Wo.fontStack];if(!is)continue;const Ta=is.glyphs[ps];if(!Ta)continue;if(Yo=Ta.metrics,ns=8203!==ps?24:0,Nr){const Hc=void 0!==is.ascender?Math.abs(is.ascender):0,Du=void 0!==is.descender?Math.abs(is.descender):0,Wc=(Hc+Du)*Wr;Es<Wc&&(Es=Wc,la=(Hc-Du)/2*Wr),fs=-Hc*Wr}else fs=24*(dr-Wr)-17}Ds?(Nt.verticalizable=!0,Fo.push({glyph:ps,imageName:Us,x:eo,y:ur+fs,vertical:Ds,scale:Wr,localGlyph:Yo.localGlyph,fontStack:Wo.fontStack,sectionIndex:ca,metrics:Yo,rect:_o}),eo+=ns*Wr+Qn):(Fo.push({glyph:ps,imageName:Us,x:eo,y:ur+fs,vertical:Ds,scale:Wr,localGlyph:Yo.localGlyph,fontStack:Wo.fontStack,sectionIndex:ca,metrics:Yo,rect:_o}),eo+=Yo.advance*Wr+Qn)}0!==Fo.length&&(wr=Math.max(eo-Qn,wr),Nr?Wu(Fo,Mn,Ro,la,pn*dr/2):Wu(Fo,Mn,Ro,0,pn/2)),eo=0;const hs=pn*dr+Ro;Mo.lineOffset=Math.max(Ro,go),ur+=hs,++Ar}var ko;const Io=ur,{horizontalAlign:as,verticalAlign:Cs}=Zd(kn);(function(zr,dr,go,Mo,Fo,Ro){const Es=(dr-go)*Fo,la=-Ro*Mo;for(const hs of zr)for(const po of hs.positionedGlyphs)po.x+=Es,po.y+=la})(Nt.positionedLines,Mn,as,Cs,wr,Io),Nt.top+=-Cs*Io,Nt.bottom=Nt.top+Io,Nt.left+=-as*wr,Nt.right=Nt.left+wr,Nt.hasBaseline=Nr}(Ot,e,i,s,Ke,_,x,E,U,M,V,Ae),!function(Nt){for(const gn of Nt)if(0!==gn.positionedGlyphs.length)return!1;return!0}(Mt)&&Ot}const Hl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qu={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Zc(t,e,i,s,u,p){if(e.imageName){const _=s[e.imageName];return _?_.displaySize[0]*e.scale*24/p+u:0}{const _=i[e.fontStack],x=_&&_.glyphs[t];return x?x.metrics.advance*e.scale+u:0}}function Wf(t,e,i,s){const u=Math.pow(t-e,2);return s?t<e?u/2:2*u:u+Math.abs(i)*i}function Yf(t,e,i){let s=0;return 10===t&&(s-=1e4),i&&(s+=150),40!==t&&65288!==t||(s+=50),41!==e&&65289!==e||(s+=50),s}function lp(t,e,i,s,u,p){let _=null,x=Wf(e,i,u,p);for(const E of s){const M=Wf(e-E.x,i,u,p)+E.badness;M<=x&&(_=E,x=M)}return{index:t,x:e,priorBreak:_,badness:x}}function Ud(t){return t?Ud(t.priorBreak).concat(t.index):[]}function Hu(t,e,i,s,u,p,_){if("point"!==p)return[];if(!t)return[];const x=[],E=function(V,ce,ve,Ae,Ve,Ke){let dt=0;for(let bt=0;bt<V.length();bt++){const Mt=V.getSection(bt);dt+=Zc(V.getCharCode(bt),Mt,Ae,Ve,ce,Ke)}return dt/Math.max(1,Math.ceil(dt/ve))}(t,e,i,s,u,_),M=t.text.indexOf("\u200b")>=0;let F=0;for(let V=0;V<t.length();V++){const ce=t.getSection(V),ve=t.getCharCode(V);if(Hl[ve]||(F+=Zc(ve,ce,s,u,e,_)),V<t.length()-1){const Ae=!((U=ve)<11904||!(he(U)||oe(U)||tn(U)||rt(U)||je(U)||v(U)||Me(U)||R(U)||at(U)||Ze(U)||Ue(U)||Tn(U)||$(U)||I(U)||T(U)||$e(U)||X(U)||$t(U)||ut(U)||ot(U)));(qu[ve]||Ae||ce.imageName)&&x.push(lp(V+1,F,E,x,Yf(ve,t.getCharCode(V+1),Ae&&M),!1))}}var U;return Ud(lp(t.length(),F,E,x,0,!0))}function Zd(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Wu(t,e,i,s,u){if(!(e||i||s||u))return;const p=t.length-1,_=t[p],x=(_.x+_.metrics.advance*_.scale)*e;for(let E=0;E<=p;E++)t[E].x-=x,t[E].y+=i+s+u}function Dg(t,e,i){const{horizontalAlign:s,verticalAlign:u}=Zd(i),p=e[0]-t.displaySize[0]*s,_=e[1]-t.displaySize[1]*u;return{image:t,top:_,bottom:_+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function cp(t,e,i,s,u,p){const _=t.image;let x;if(_.content){const Ve=_.content,Ke=_.pixelRatio||1;x=[Ve[0]/Ke,Ve[1]/Ke,_.displaySize[0]-Ve[2]/Ke,_.displaySize[1]-Ve[3]/Ke]}const E=e.left*p,M=e.right*p;let F,U,V,ce;"width"===i||"both"===i?(ce=u[0]+E-s[3],U=u[0]+M+s[1]):(ce=u[0]+(E+M-_.displaySize[0])/2,U=ce+_.displaySize[0]);const ve=e.top*p,Ae=e.bottom*p;return"height"===i||"both"===i?(F=u[1]+ve-s[0],V=u[1]+Ae+s[2]):(F=u[1]+(ve+Ae-_.displaySize[1])/2,V=F+_.displaySize[1]),{image:_,top:F,right:U,bottom:V,left:ce,collisionPadding:x}}class dc extends ne{constructor(e,i,s,u,p){super(e,i),this.angle=u,this.z=s,void 0!==p&&(this.segment=p)}clone(){return new dc(this.x,this.y,this.z,this.angle,this.segment)}}function up(t,e,i,s,u){if(void 0===e.segment)return!0;let p=e,_=e.segment+1,x=0;for(;x>-i/2;){if(_--,_<0)return!1;x-=t[_].dist(p),p=t[_]}x+=t[_].dist(t[_+1]),_++;const E=[];let M=0;for(;x<i/2;){const F=t[_],U=t[_+1];if(!U)return!1;let V=t[_-1].angleTo(F)-F.angleTo(U);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:V}),M+=V;x-E[0].distance>s;)M-=E.shift().angleDelta;if(M>u)return!1;_++,x+=F.dist(U)}return!0}function dp(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Jf(t,e,i){return t?.6*e*i:0}function hp(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Ig(t,e,i,s,u,p){const _=Jf(i,u,p),x=hp(i,s)*p;let E=0;const M=dp(t)/2;for(let F=0;F<t.length-1;F++){const U=t[F],V=t[F+1],ce=U.dist(V);if(E+ce>M){const ve=(M-E)/ce,Ae=yr(U.x,V.x,ve),Ve=yr(U.y,V.y,ve),Ke=new dc(Ae,Ve,0,V.angleTo(U),F);return!_||up(t,Ke,x,_,e)?Ke:void 0}E+=ce}}function Mg(t,e,i,s,u,p,_,x,E){const M=Jf(s,p,_),F=hp(s,u),U=F*_,V=0===t[0].x||t[0].x===E||0===t[0].y||t[0].y===E;return e-U<e/4&&(e=U+e/4),sa(t,V?e/2*x%e:(F/2+2*p)*_*x%e,e,M,i,U,V,!1,E)}function sa(t,e,i,s,u,p,_,x,E){const M=p/2,F=dp(t);let U=0,V=e-i,ce=[];for(let ve=0;ve<t.length-1;ve++){const Ae=t[ve],Ve=t[ve+1],Ke=Ae.dist(Ve),dt=Ve.angleTo(Ae);for(;V+i<U+Ke;){V+=i;const bt=(V-U)/Ke,Mt=yr(Ae.x,Ve.x,bt),Ot=yr(Ae.y,Ve.y,bt);if(Mt>=0&&Mt<E&&Ot>=0&&Ot<E&&V-M>=0&&V+M<=F){const Nt=new dc(Mt,Ot,0,dt,ve);Nt._round(),s&&!up(t,Nt,p,s,u)||ce.push(Nt)}}U+=Ke}return x||ce.length||_||(ce=sa(t,U/2,i,s,u,p,_,!0,E)),ce}function Xf(t,e,i,s,u){const p=[];for(let _=0;_<t.length;_++){const x=t[_];let E;for(let M=0;M<x.length-1;M++){let F=x[M],U=x[M+1];F.x<e&&U.x<e||(F.x<e?F=new ne(e,F.y+(e-F.x)/(U.x-F.x)*(U.y-F.y))._round():U.x<e&&(U=new ne(e,F.y+(e-F.x)/(U.x-F.x)*(U.y-F.y))._round()),F.y<i&&U.y<i||(F.y<i?F=new ne(F.x+(i-F.y)/(U.y-F.y)*(U.x-F.x),i)._round():U.y<i&&(U=new ne(F.x+(i-F.y)/(U.y-F.y)*(U.x-F.x),i)._round()),F.x>=s&&U.x>=s||(F.x>=s?F=new ne(s,F.y+(s-F.x)/(U.x-F.x)*(U.y-F.y))._round():U.x>=s&&(U=new ne(s,F.y+(s-F.x)/(U.x-F.x)*(U.y-F.y))._round()),F.y>=u&&U.y>=u||(F.y>=u?F=new ne(F.x+(u-F.y)/(U.y-F.y)*(U.x-F.x),u)._round():U.y>=u&&(U=new ne(F.x+(u-F.y)/(U.y-F.y)*(U.x-F.x),u)._round()),E&&F.equals(E[E.length-1])||(E=[F],p.push(E)),E.push(U)))))}}return p}Kn("Anchor",dc);const Yu=1e20;function Ag(t,e,i,s,u,p,_,x,E){for(let M=e;M<e+s;M++)Sg(t,i*p+M,p,u,_,x,E);for(let M=i;M<i+u;M++)Sg(t,M*p+e,1,s,_,x,E)}function Sg(t,e,i,s,u,p,_){p[0]=0,_[0]=-Yu,_[1]=Yu,u[0]=t[e];for(let x=1,E=0,M=0;x<s;x++){u[x]=t[e+x*i];const F=x*x;do{const U=p[E];M=(u[x]-u[U]+F-U*U)/(x-U)/2}while(M<=_[E]&&--E>-1);E++,p[E]=x,_[E]=M,_[E+1]=Yu}for(let x=0,E=0;x<s;x++){for(;_[E+1]<x;)E++;const M=p[E],F=x-M;t[e+x*i]=u[M]+F*F}}const Vd={none:0,ideographs:1,all:2};class Ju{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const s=[];for(const u in e)for(const p of e[u])s.push({stack:u,id:p});Ti(s,({stack:u,id:p},_)=>{let x=this.entries[u];x||(x=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[p];if(void 0!==E)return void _(null,{stack:u,id:p,glyph:E});if(E=this._tinySDF(x,u,p),E)return x.glyphs[p]=E,void _(null,{stack:u,id:p,glyph:E});const M=Math.floor(p/256);if(256*M>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[M])return void _(null,{stack:u,id:p,glyph:E});let F=x.requests[M];F||(F=x.requests[M]=[],Ju.loadGlyphRange(u,M,this.url,this.requestManager,(U,V)=>{if(V){x.ascender=V.ascender,x.descender=V.descender;for(const ce in V.glyphs)this._doesCharSupportLocalGlyph(+ce)||(x.glyphs[+ce]=V.glyphs[+ce]);x.ranges[M]=!0}for(const ce of F)ce(U,V);delete x.requests[M]})),F.push((U,V)=>{U?_(U):V&&_(null,{stack:u,id:p,glyph:V.glyphs[p]||null})})},(u,p)=>{if(u)i(u);else if(p){const _={};for(const{stack:x,id:E,glyph:M}of p)void 0===_[x]&&(_[x]={}),void 0===_[x].glyphs&&(_[x].glyphs={}),_[x].glyphs[E]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;i(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Vd.none&&(this.localGlyphMode===Vd.all?!!this.localFontFamily:!!this.localFontFamily&&(Ze(e)||it(e)||$(e)||X(e))||R(e))}_tinySDF(e,i,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let p=e.tinySDF;if(!p){let Ae="400";/bold/i.test(i)?Ae="900":/medium/i.test(i)?Ae="500":/light/i.test(i)&&(Ae="200"),p=e.tinySDF=new Ju.TinySDF({fontFamily:u,fontWeight:Ae,fontSize:48,buffer:6,radius:16}),p.fontWeight=Ae}if(this.localGlyphs[p.fontWeight][s])return this.localGlyphs[p.fontWeight][s];const _=String.fromCharCode(s),{data:x,width:E,height:M,glyphWidth:F,glyphHeight:U,glyphLeft:V,glyphTop:ce,glyphAdvance:ve}=p.draw(_);return this.localGlyphs[p.fontWeight][s]={id:s,bitmap:new Tl({width:E,height:M},x),metrics:{width:F/2,height:U/2,left:V/2,top:ce/2-27,advance:ve/2,localGlyph:!0}}}}function Kf(t,e,i,s){const u=[],p=t.image,_=p.pixelRatio,x=p.paddedRect.w-2,E=p.paddedRect.h-2,M=t.right-t.left,F=t.bottom-t.top,U=p.stretchX||[[0,x]],V=p.stretchY||[[0,E]],ce=(pn,kn)=>pn+kn[1]-kn[0],ve=U.reduce(ce,0),Ae=V.reduce(ce,0),Ve=x-ve,Ke=E-Ae;let dt=0,bt=ve,Mt=0,Ot=Ae,Nt=0,gn=Ve,hn=0,Zn=Ke;if(p.content&&s){const pn=p.content;dt=fu(U,0,pn[0]),Mt=fu(V,0,pn[1]),bt=fu(U,pn[0],pn[2]),Ot=fu(V,pn[1],pn[3]),Nt=pn[0]-dt,hn=pn[1]-Mt,gn=pn[2]-pn[0]-bt,Zn=pn[3]-pn[1]-Ot}const Ln=(pn,kn,$n,vn)=>{const Qn=$d(pn.stretch-dt,bt,M,t.left),ai=jd(pn.fixed-Nt,gn,pn.stretch,ve),vr=$d(kn.stretch-Mt,Ot,F,t.top),eo=jd(kn.fixed-hn,Zn,kn.stretch,Ae),ur=$d($n.stretch-dt,bt,M,t.left),wr=jd($n.fixed-Nt,gn,$n.stretch,ve),Mn=$d(vn.stretch-Mt,Ot,F,t.top),Nr=jd(vn.fixed-hn,Zn,vn.stretch,Ae),Ar=new ne(Qn,vr),ko=new ne(ur,vr),Io=new ne(ur,Mn),as=new ne(Qn,Mn),Cs=new ne(ai/_,eo/_),zr=new ne(wr/_,Nr/_),dr=e*Math.PI/180;if(dr){const Fo=Math.sin(dr),Ro=Math.cos(dr),Es=[Ro,-Fo,Fo,Ro];Ar._matMult(Es),ko._matMult(Es),as._matMult(Es),Io._matMult(Es)}const go=pn.stretch+pn.fixed,Mo=kn.stretch+kn.fixed;return{tl:Ar,tr:ko,bl:as,br:Io,tex:{x:p.paddedRect.x+1+go,y:p.paddedRect.y+1+Mo,w:$n.stretch+$n.fixed-go,h:vn.stretch+vn.fixed-Mo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Cs,pixelOffsetBR:zr,minFontScaleX:gn/_/M,minFontScaleY:Zn/_/F,isSDF:i}};if(s&&(p.stretchX||p.stretchY)){const pn=pp(U,Ve,ve),kn=pp(V,Ke,Ae);for(let $n=0;$n<pn.length-1;$n++){const vn=pn[$n],Qn=pn[$n+1];for(let ai=0;ai<kn.length-1;ai++)u.push(Ln(vn,kn[ai],Qn,kn[ai+1]))}}else u.push(Ln({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:E+1}));return u}function fu(t,e,i){let s=0;for(const u of t)s+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return s}function pp(t,e,i){const s=[{fixed:-1,stretch:0}];for(const[u,p]of t){const _=s[s.length-1];s.push({fixed:u-_.stretch,stretch:_.stretch}),s.push({fixed:u-_.stretch,stretch:_.stretch+(p-u)})}return s.push({fixed:e+1,stretch:i}),s}function $d(t,e,i,s){return t/e*i+s}function jd(t,e,i,s){return t-e*i/s}function Pg(t,e,i,s){const u=e+t.positionedLines[s].lineOffset;return 0===s?i+u/2:i+(u+(e+t.positionedLines[s-1].lineOffset))/2}Ju.loadGlyphRange=function(t,e,i,s,u){const p=256*e,_=p+255,x=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${p}-${_}`),io.Glyphs);Cr(x,(E,M)=>{if(E)u(E);else if(M){const F={},U=new Uc(M).readFields(qf,{});for(const V of U.glyphs)F[V.id]=V;u(null,{glyphs:F,ascender:U.ascender,descender:U.descender})}})},Ju.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:_="normal"}){this.buffer=e,this.cutoff=s,this.radius=i;const x=this.size=t+4*e,E=this._createCanvas(x),M=this.ctx=E.getContext("2d",{willReadFrequently:!0});M.font=`${_} ${p} ${t}px ${u}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(t),_=Math.floor(i),x=Math.min(this.size-this.buffer,Math.ceil(p-u)),E=Math.min(this.size-this.buffer,Math.ceil(i)+Math.ceil(s)),M=x+2*this.buffer,F=E+2*this.buffer,U=M*F,V=new Uint8ClampedArray(U),ce={data:V,width:M,height:F,glyphWidth:x,glyphHeight:E,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(0===x||0===E)return ce;const{ctx:ve,buffer:Ae,gridInner:Ve,gridOuter:Ke}=this;ve.clearRect(Ae,Ae,x,E),ve.fillText(t,Ae,Ae+_+1);const dt=ve.getImageData(Ae,Ae,x,E);Ke.fill(Yu,0,U),Ve.fill(0,0,U);for(let bt=0;bt<E;bt++)for(let Mt=0;Mt<x;Mt++){const Ot=dt.data[4*(bt*x+Mt)+3]/255;if(0===Ot)continue;const Nt=(bt+Ae)*M+Mt+Ae;if(1===Ot)Ke[Nt]=0,Ve[Nt]=Yu;else{const gn=.5-Ot;Ke[Nt]=gn>0?gn*gn:0,Ve[Nt]=gn<0?gn*gn:0}}Ag(Ke,0,0,M,F,M,this.f,this.v,this.z),Ag(Ve,Ae,Ae,x,E,M,this.f,this.v,this.z);for(let bt=0;bt<U;bt++){const Mt=Math.sqrt(Ke[bt])-Math.sqrt(Ve[bt]);V[bt]=Math.round(255-255*(Mt/this.radius+this.cutoff))}return ce}};class Qf{constructor(e=[],i=Og){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,u=i[e];for(;e>0;){const p=e-1>>1,_=i[p];if(s(u,_)>=0)break;i[e]=_,e=p}i[e]=u}_down(e){const{data:i,compare:s}=this,u=this.length>>1,p=i[e];for(;e<u;){let _=1+(e<<1),x=i[_];const E=_+1;if(E<this.length&&s(i[E],x)<0&&(_=E,x=i[E]),s(x,p)>=0)break;i[e]=x,e=_}i[e]=p}}function Og(t,e){return t<e?-1:t>e?1:0}function em(t,e=1,i=!1){let s=1/0,u=1/0,p=-1/0,_=-1/0;const x=t[0];for(let ce=0;ce<x.length;ce++){const ve=x[ce];(!ce||ve.x<s)&&(s=ve.x),(!ce||ve.y<u)&&(u=ve.y),(!ce||ve.x>p)&&(p=ve.x),(!ce||ve.y>_)&&(_=ve.y)}const E=Math.min(p-s,_-u);let M=E/2;const F=new Qf([],Rg);if(0===E)return new ne(s,u);for(let ce=s;ce<p;ce+=E)for(let ve=u;ve<_;ve+=E)F.push(new mu(ce+M,ve+M,M,t));let U=function(ce){let ve=0,Ae=0,Ve=0;const Ke=ce[0];for(let dt=0,bt=Ke.length,Mt=bt-1;dt<bt;Mt=dt++){const Ot=Ke[dt],Nt=Ke[Mt],gn=Ot.x*Nt.y-Nt.x*Ot.y;Ae+=(Ot.x+Nt.x)*gn,Ve+=(Ot.y+Nt.y)*gn,ve+=3*gn}return new mu(Ae/ve,Ve/ve,0,ce)}(t),V=F.length;for(;F.length;){const ce=F.pop();(ce.d>U.d||!U.d)&&(U=ce,i&&console.log("found best %d after %d probes",Math.round(1e4*ce.d)/1e4,V)),ce.max-U.d<=e||(M=ce.h/2,F.push(new mu(ce.p.x-M,ce.p.y-M,M,t)),F.push(new mu(ce.p.x+M,ce.p.y-M,M,t)),F.push(new mu(ce.p.x-M,ce.p.y+M,M,t)),F.push(new mu(ce.p.x+M,ce.p.y+M,M,t)),V+=4)}return i&&(console.log(`num probes: ${V}`),console.log(`best distance: ${U.d}`)),U.p}function Rg(t,e){return e.max-t.max}function mu(t,e,i,s){this.p=new ne(t,e),this.h=i,this.d=function(u,p){let _=!1,x=1/0;for(let E=0;E<p.length;E++){const M=p[E];for(let F=0,U=M.length,V=U-1;F<U;V=F++){const ce=M[F],ve=M[V];ce.y>u.y!=ve.y>u.y&&u.x<(ve.x-ce.x)*(u.y-ce.y)/(ve.y-ce.y)+ce.x&&(_=!_),x=Math.min(x,_f(u,ce,ve))}}return(_?1:-1)*Math.sqrt(x)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Gd=Number.POSITIVE_INFINITY,tm=Math.sqrt(2);function nm(t,e){return e[1]!==Gd?function(i,s,u){let p=0,_=0;switch(s=Math.abs(s),u=Math.abs(u),i){case"top-right":case"top-left":case"top":_=u-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-u}switch(i){case"top-right":case"bottom-right":case"right":p=-s;break;case"top-left":case"bottom-left":case"left":p=s}return[p,_]}(t,e[0],e[1]):function(i,s){let u=0,p=0;s<0&&(s=0);const _=s/tm;switch(i){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-s;break;case"top":p=s-7}switch(i){case"top-right":case"bottom-right":u=-_;break;case"top-left":case"bottom-left":u=_;break;case"left":u=s;break;case"right":u=-s}return[u,p]}(t,e[0])}function El(t,e,i,s,u,p,_,x,E,M){t.createArrays(),t.tilePixelRatio=er/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const F=t.layers[0].layout,U=t.layers[0]._unevaluatedLayout._values,V={};if("composite"===t.textSizeData.kind){const{minZoom:Ae,maxZoom:Ve}=t.textSizeData;V.compositeTextSizes=[U["text-size"].possiblyEvaluate(new Hi(Ae),x),U["text-size"].possiblyEvaluate(new Hi(Ve),x)]}if("composite"===t.iconSizeData.kind){const{minZoom:Ae,maxZoom:Ve}=t.iconSizeData;V.compositeIconSizes=[U["icon-size"].possiblyEvaluate(new Hi(Ae),x),U["icon-size"].possiblyEvaluate(new Hi(Ve),x)]}V.layoutTextSize=U["text-size"].possiblyEvaluate(new Hi(E+1),x),V.layoutIconSize=U["icon-size"].possiblyEvaluate(new Hi(E+1),x),V.textMaxSize=U["text-size"].possiblyEvaluate(new Hi(18),x);const ce="map"===F.get("text-rotation-alignment")&&"point"!==F.get("symbol-placement"),ve=F.get("text-size");for(const Ae of t.features){const Ve=F.get("text-font").evaluate(Ae,{},x).join(","),Ke=ve.evaluate(Ae,{},x),dt=V.layoutTextSize.evaluate(Ae,{},x),bt=(V.layoutIconSize.evaluate(Ae,{},x),{horizontal:{},vertical:void 0}),Mt=Ae.text;let Ot,Nt=[0,0];if(Mt){const Zn=Mt.toString(),Ln=24*F.get("text-letter-spacing").evaluate(Ae,{},x),pn=24*F.get("text-line-height").evaluate(Ae,{},x),kn=Jt(Zn)?Ln:0,$n=F.get("text-anchor").evaluate(Ae,{},x),vn=F.get("text-variable-anchor");if(!vn){const wr=F.get("text-radial-offset").evaluate(Ae,{},x);Nt=wr?nm($n,[24*wr,Gd]):F.get("text-offset").evaluate(Ae,{},x).map(Mn=>24*Mn)}let Qn=ce?"center":F.get("text-justify").evaluate(Ae,{},x);const ai=F.get("symbol-placement"),vr="point"===ai,eo="point"===ai?24*F.get("text-max-width").evaluate(Ae,{},x):0,ur=wr=>{t.allowVerticalPlacement&&cn(Zn)&&(bt.vertical=Gu(Mt,e,i,u,Ve,eo,pn,$n,wr,kn,Nt,ba.vertical,!0,ai,dt,Ke))};if(!ce&&vn){const wr="auto"===Qn?vn.map(Nr=>Xu(Nr)):[Qn];let Mn=!1;for(let Nr=0;Nr<wr.length;Nr++){const Ar=wr[Nr];if(!bt.horizontal[Ar])if(Mn)bt.horizontal[Ar]=bt.horizontal[0];else{const ko=Gu(Mt,e,i,u,Ve,eo,pn,"center",Ar,kn,Nt,ba.horizontal,!1,ai,dt,Ke);ko&&(bt.horizontal[Ar]=ko,Mn=1===ko.positionedLines.length)}}ur("left")}else{if("auto"===Qn&&(Qn=Xu($n)),vr||F.get("text-writing-mode").indexOf("horizontal")>=0||!cn(Zn)){const wr=Gu(Mt,e,i,u,Ve,eo,pn,$n,Qn,kn,Nt,ba.horizontal,!1,ai,dt,Ke);wr&&(bt.horizontal[Qn]=wr)}ur("point"===ai?"left":Qn)}}let gn=!1;if(Ae.icon&&Ae.icon.name){const Zn=s[Ae.icon.name];Zn&&(Ot=Dg(u[Ae.icon.name],F.get("icon-offset").evaluate(Ae,{},x),F.get("icon-anchor").evaluate(Ae,{},x)),gn=Zn.sdf,void 0===t.sdfIcons?t.sdfIcons=Zn.sdf:t.sdfIcons!==Zn.sdf&&Di("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Zn.pixelRatio!==t.pixelRatio||0!==F.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const hn=fp(bt.horizontal)||bt.vertical;t.iconsInText||(t.iconsInText=!!hn&&hn.iconsInText),(hn||Ot)&&Lg(t,Ae,bt,Ot,s,V,dt,0,Nt,gn,_,x,M)}p&&t.generateCollisionDebugBuffers(E,t.collisionBoxArray)}function Xu(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Lg(t,e,i,s,u,p,_,x,E,M,F,U,V){let ce=p.textMaxSize.evaluate(e,{},U);void 0===ce&&(ce=_);const ve=t.layers[0].layout,Ae=ve.get("icon-offset").evaluate(e,{},U),Ve=fp(i.horizontal)||i.vertical,Ke=_/24,dt=t.tilePixelRatio*ce/24,bt=t.tilePixelRatio*ve.get("symbol-spacing"),Mt=ve.get("text-padding")*t.tilePixelRatio,Ot=ve.get("icon-padding")*t.tilePixelRatio,Nt=bn(ve.get("text-max-angle")),gn="map"===ve.get("text-rotation-alignment")&&"point"!==ve.get("symbol-placement"),hn="map"===ve.get("icon-rotation-alignment")&&"point"!==ve.get("symbol-placement"),Zn=ve.get("symbol-placement"),Ln=bt/2,pn=ve.get("icon-text-fit");let kn;s&&"none"!==pn&&(t.allowVerticalPlacement&&i.vertical&&(kn=cp(s,i.vertical,pn,ve.get("icon-text-fit-padding"),Ae,Ke)),Ve&&(s=cp(s,Ve,pn,ve.get("icon-text-fit-padding"),Ae,Ke)));const $n=(vn,Qn,ai)=>{if(Qn.x<0||Qn.x>=er||Qn.y<0||Qn.y>=er)return;const{x:vr,y:eo,z:ur}=V.projectTilePoint(Qn.x,Qn.y,ai),wr=new dc(vr,eo,ur,0,void 0);!function(Mn,Nr,Ar,ko,Io,as,Cs,zr,dr,go,Mo,Fo,Ro,Es,la,hs,po,Wo,ca,ps,Wr,Yo,_o,Us,ns){const fs=Mn.addToLineVertexArray(Nr,ko);let Ds,Zs,is,Ta,Hc,Du,Wc,Bp=0,Cm=0,Np=0,zp=0,od=-1,sh=-1;const Al={};let Up=eu(""),ah=0,sd=0;if(void 0===dr._unevaluatedLayout.getValue("text-radial-offset")?[ah,sd]=dr.layout.get("text-offset").evaluate(Wr,{},ns).map(Ys=>24*Ys):(ah=24*dr.layout.get("text-radial-offset").evaluate(Wr,{},ns),sd=Gd),Mn.allowVerticalPlacement&&Io.vertical){const Ys=Io.vertical;if(la)Du=mp(Ys),zr&&(Wc=mp(zr));else{const Js=dr.layout.get("text-rotate").evaluate(Wr,{},ns)+90;is=qd(go,Ar,Nr,Mo,Fo,Ro,Ys,Es,Js,hs),zr&&(Ta=qd(go,Ar,Nr,Mo,Fo,Ro,zr,Wo,Js))}}if(as){const Ys=dr.layout.get("icon-rotate").evaluate(Wr,{},ns),Js="none"!==dr.layout.get("icon-text-fit"),Iu=Kf(as,Ys,_o,Js),ch=zr?Kf(zr,Ys,_o,Js):void 0;Zs=qd(go,Ar,Nr,Mo,Fo,Ro,as,Wo,Ys),Bp=4*Iu.length;const Zp=Mn.iconSizeData;let yc=null;"source"===Zp.kind?(yc=[Cl*dr.layout.get("icon-size").evaluate(Wr,{},ns)],yc[0]>hc&&Di(`${Mn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Zp.kind&&(yc=[Cl*Yo.compositeIconSizes[0].evaluate(Wr,{},ns),Cl*Yo.compositeIconSizes[1].evaluate(Wr,{},ns)],(yc[0]>hc||yc[1]>hc)&&Di(`${Mn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Mn.addSymbols(Mn.icon,Iu,yc,ps,ca,Wr,!1,Ar,Nr,fs.lineStartIndex,fs.lineLength,-1,Us,ns),od=Mn.icon.placedSymbolArray.length-1,ch&&(Cm=4*ch.length,Mn.addSymbols(Mn.icon,ch,yc,ps,ca,Wr,ba.vertical,Ar,Nr,fs.lineStartIndex,fs.lineLength,-1,Us,ns),sh=Mn.icon.placedSymbolArray.length-1)}for(const Ys in Io.horizontal){const Js=Io.horizontal[Ys];Ds||(Up=eu(Js.text),la?Hc=mp(Js):Ds=qd(go,Ar,Nr,Mo,Fo,Ro,Js,Es,dr.layout.get("text-rotate").evaluate(Wr,{},ns),hs));const Iu=1===Js.positionedLines.length;if(Np+=kg(Mn,Ar,Nr,Js,Cs,dr,la,Wr,hs,fs,Io.vertical?ba.horizontal:ba.horizontalOnly,Iu?Object.keys(Io.horizontal):[Ys],Al,od,Yo,Us,ns),Iu)break}Io.vertical&&(zp+=kg(Mn,Ar,Nr,Io.vertical,Cs,dr,la,Wr,hs,fs,ba.vertical,["vertical"],Al,sh,Yo,Us,ns));let Sl=-1;const lh=(Ys,Js)=>Ys?Math.max(Ys,Js):Js;Sl=lh(Hc,Sl),Sl=lh(Du,Sl),Sl=lh(Wc,Sl);const Em=Sl>-1?1:0;Mn.glyphOffsetArray.length>=Dl.MAX_GLYPHS&&Di("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Wr.sortKey&&Mn.addToSortKeyRanges(Mn.symbolInstances.length,Wr.sortKey),Mn.symbolInstances.emplaceBack(Ar.x,Ar.y,Ar.z,Nr.x,Nr.y,Al.right>=0?Al.right:-1,Al.center>=0?Al.center:-1,Al.left>=0?Al.left:-1,Al.vertical>=0?Al.vertical:-1,od,sh,Up,void 0!==Ds?Ds:Mn.collisionBoxArray.length,void 0!==Ds?Ds+1:Mn.collisionBoxArray.length,void 0!==is?is:Mn.collisionBoxArray.length,void 0!==is?is+1:Mn.collisionBoxArray.length,void 0!==Zs?Zs:Mn.collisionBoxArray.length,void 0!==Zs?Zs+1:Mn.collisionBoxArray.length,Ta||Mn.collisionBoxArray.length,Ta?Ta+1:Mn.collisionBoxArray.length,Mo,Np,zp,Bp,Cm,Em,0,ah,sd,Sl)}(t,Qn,wr,vn,i,s,u,kn,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Mt,gn,E,0,Ot,hn,Ae,e,p,M,F,U)};if("line"===Zn)for(const vn of Xf(e.geometry,0,0,er,er)){const Qn=Mg(vn,bt,Nt,i.vertical||Ve,s,24,dt,t.overscaling,er);for(const ai of Qn){const vr=Ve;vr&&Fg(t,vr.text,Ln,ai)||$n(vn,ai,U)}}else if("line-center"===Zn){for(const vn of e.geometry)if(vn.length>1){const Qn=Ig(vn,Nt,i.vertical||Ve,s,24,dt);Qn&&$n(vn,Qn,U)}}else if("Polygon"===e.type)for(const vn of Uu(e.geometry,0)){const Qn=em(vn,16);$n(vn[0],new dc(Qn.x,Qn.y,0,0,void 0),U)}else if("LineString"===e.type)for(const vn of e.geometry)$n(vn,new dc(vn[0].x,vn[0].y,0,0,void 0),U);else if("Point"===e.type)for(const vn of e.geometry)for(const Qn of vn)$n([Qn],new dc(Qn.x,Qn.y,0,0,void 0),U)}const hc=32640;function kg(t,e,i,s,u,p,_,x,E,M,F,U,V,ce,ve,Ae,Ve){const Ke=function(Mt,Ot,Nt,gn,hn,Zn,Ln,pn){const kn=[];if(0===Ot.positionedLines.length)return kn;const $n=gn.layout.get("text-rotate").evaluate(Zn,{})*Math.PI/180,vn=function(ur){const wr=ur[0],Mn=ur[1],Nr=wr*Mn;return Nr>0?[wr,-Mn]:Nr<0?[-wr,Mn]:0===wr?[Mn,wr]:[Mn,-wr]}(Nt);let Qn=Math.abs(Ot.top-Ot.bottom);for(const ur of Ot.positionedLines)Qn-=ur.lineOffset;const ai=Ot.positionedLines.length,vr=Qn/ai;let eo=Ot.top-Nt[1];for(let ur=0;ur<ai;++ur){const wr=Ot.positionedLines[ur];eo=Pg(Ot,vr,eo,ur);for(const Mn of wr.positionedGlyphs){if(!Mn.rect)continue;const Nr=Mn.rect||{};let Ar=4,ko=!0,Io=1,as=0;if(Mn.imageName){const _o=Ln[Mn.imageName];if(!_o)continue;if(_o.sdf){Di("SDF images are not supported in formatted text and will be ignored.");continue}ko=!1,Io=_o.pixelRatio,Ar=1/Io}const Cs=(hn||pn)&&Mn.vertical,zr=Mn.metrics.advance*Mn.scale/2,dr=Mn.metrics,go=Mn.rect;if(null===go)continue;pn&&Ot.verticalizable&&(as=Mn.imageName?zr-Mn.metrics.width*Mn.scale/2:0);const Mo=hn?[Mn.x+zr,Mn.y]:[0,0];let Fo=[0,0],Ro=[0,0],Es=!1;hn||(Cs?(Ro=[Mn.x+zr+vn[0],Mn.y+vn[1]-as],Es=!0):Fo=[Mn.x+zr+Nt[0],Mn.y+Nt[1]-as]);const la=go.w*Mn.scale/(Io*(Mn.localGlyph?2:1)),hs=go.h*Mn.scale/(Io*(Mn.localGlyph?2:1));let po,Wo,ca,ps;if(Cs){const _o=Mn.y-eo,Us=new ne(-zr,zr-_o),ns=-Math.PI/2,fs=new ne(...Ro);po=new ne(-zr+Fo[0],Fo[1]),po._rotateAround(ns,Us)._add(fs),po.x+=-_o+zr,po.y-=(dr.left-Ar)*Mn.scale;const Ds=Mn.imageName?dr.advance*Mn.scale:24*Mn.scale,Zs=String.fromCharCode(Mn.glyph);W_(Zs)?po.x+=(1-Ar)*Mn.scale:Zf(Zs)?po.x+=Ds-dr.height*Mn.scale+(-Ar-1)*Mn.scale:po.x+=Mn.imageName||dr.width+2*Ar===go.w&&dr.height+2*Ar===go.h?(Ds-hs)/2:(Ds-(dr.height+2*Ar)*Mn.scale)/2,Wo=new ne(po.x,po.y-la),ca=new ne(po.x+hs,po.y),ps=new ne(po.x+hs,po.y-la)}else{const _o=(dr.left-Ar)*Mn.scale-zr+Fo[0],Us=(-dr.top-Ar)*Mn.scale+Fo[1],ns=_o+la,fs=Us+hs;po=new ne(_o,Us),Wo=new ne(ns,Us),ca=new ne(_o,fs),ps=new ne(ns,fs)}if($n){let _o;_o=hn?new ne(0,0):Es?new ne(vn[0],vn[1]):new ne(Nt[0],Nt[1]),po._rotateAround($n,_o),Wo._rotateAround($n,_o),ca._rotateAround($n,_o),ps._rotateAround($n,_o)}const Wr=new ne(0,0),Yo=new ne(0,0);kn.push({tl:po,tr:Wo,bl:ca,br:ps,tex:Nr,writingMode:Ot.writingMode,glyphOffset:Mo,sectionIndex:Mn.sectionIndex,isSDF:ko,pixelOffsetTL:Wr,pixelOffsetBR:Yo,minFontScaleX:0,minFontScaleY:0})}}return kn}(0,s,E,p,_,x,u,t.allowVerticalPlacement),dt=t.textSizeData;let bt=null;"source"===dt.kind?(bt=[Cl*p.layout.get("text-size").evaluate(x,{},Ve)],bt[0]>hc&&Di(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===dt.kind&&(bt=[Cl*ve.compositeTextSizes[0].evaluate(x,{},Ve),Cl*ve.compositeTextSizes[1].evaluate(x,{},Ve)],(bt[0]>hc||bt[1]>hc)&&Di(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,Ke,bt,E,_,x,F,e,i,M.lineStartIndex,M.lineLength,ce,Ae,Ve);for(const Mt of U)V[Mt]=t.text.placedSymbolArray.length-1;return 4*Ke.length}function fp(t){for(const e in t)return t[e];return null}function qd(t,e,i,s,u,p,_,x,E,M){let F=_.top,U=_.bottom,V=_.left,ce=_.right;const ve=_.collisionPadding;if(ve&&(V-=ve[0],F-=ve[1],ce+=ve[2],U+=ve[3]),E){const Ae=new ne(V,F),Ve=new ne(ce,F),Ke=new ne(V,U),dt=new ne(ce,U),bt=bn(E);let Mt=new ne(0,0);M&&(Mt=new ne(M[0],M[1])),Ae._rotateAround(bt,Mt),Ve._rotateAround(bt,Mt),Ke._rotateAround(bt,Mt),dt._rotateAround(bt,Mt),V=Math.min(Ae.x,Ve.x,Ke.x,dt.x),ce=Math.max(Ae.x,Ve.x,Ke.x,dt.x),F=Math.min(Ae.y,Ve.y,Ke.y,dt.y),U=Math.max(Ae.y,Ve.y,Ke.y,dt.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,V,F,ce,U,x,s,u,p),t.length-1}function mp(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Fg(t,e,i,s){const u=t.compareText;if(e in u){const p=u[e];for(let _=p.length-1;_>=0;_--)if(s.dist(p[_])<i)return!0}else u[e]=[];return u[e].push(s),!1}const gp=zc.VectorTileFeature.types,Bg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hd(t,e,i,s,u,p,_,x,E,M,F,U,V,ce,ve,Ae){const Ve=F?Math.min(hc,Math.round(F[0])):0,Ke=F?Math.min(hc,Math.round(F[1])):0;t.emplaceBack(e,i,Math.round(32*_),Math.round(32*x),E,M,(Ve<<1)+(U?1:0),Ke,16*V,16*ce,256*ve,256*Ae,s,u,p,0)}function gu(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i)}function _p(t){for(const e of t.sections)if(Bn(e.text))return!0;return!1}class yp{constructor(e){this.layoutVertexArray=new rf,this.indexArray=new oa,this.programConfigurations=e,this.segments=new qo,this.dynamicLayoutVertexArray=new Ja,this.opacityVertexArray=new Qc,this.placedSymbolArray=new wh}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,i,s,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,q_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,kd.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Bg,!0),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Kn("SymbolBuffers",yp);class Ku{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new qo,this.collisionVertexArray=new pd,this.collisionVertexArrayExt=new Ja}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Fd.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,ep.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Kn("CollisionBuffers",Ku);class Dl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ye([]),this.placementViewportMatrix=ye([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=np(this.zoom,i["text-size"]),this.iconSizeData=np(this.zoom,i["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),p=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==p&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===p||"auto"===p&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(_=>ba[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID}createArrays(){this.text=new yp(new Pc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new yp(new Pc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new cf,this.lineVertexArray=new uf,this.symbolInstances=new lf}calculateGlyphDependencies(e,i,s,u,p){for(let _=0;_<e.length;_++)if(i[e.charCodeAt(_)]=!0,u&&p){const x=$u[e.charAt(_)];x&&(i[x.charCodeAt(0)]=!0)}}populate(e,i,s,u){const p=this.layers[0],_=p.layout,x=_.get("text-font"),E=_.get("text-field"),M=_.get("icon-image"),F=("constant"!==E.value.kind||E.value.value instanceof ki&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),U="constant"!==M.value.kind||!!M.value.value||Object.keys(M.parameters).length>0,V=_.get("symbol-sort-key");if(this.features=[],!F&&!U)return;const ce=i.iconDependencies,ve=i.glyphDependencies,Ae=i.availableImages,Ve=new Hi(this.zoom);for(const{feature:Ke,id:dt,index:bt,sourceLayerIndex:Mt}of e){const Ot=p._featureFilter.needGeometry,Nt=$l(Ke,Ot);if(!p._featureFilter.filter(Ve,Nt,s))continue;let gn,hn;if(Ot||(Nt.geometry=Vl(Ke,s,u)),F){const Ln=p.getValueAndResolveTokens("text-field",Nt,s,Ae),pn=ki.factory(Ln);_p(pn)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ws()||this.hasRTLText&&br.isParsed())&&(gn=H_(pn,p,Nt))}if(U){const Ln=p.getValueAndResolveTokens("icon-image",Nt,s,Ae);hn=Ln instanceof oo?Ln:oo.fromString(Ln)}if(!gn&&!hn)continue;const Zn=this.sortFeaturesByKey?V.evaluate(Nt,{},s):void 0;if(this.features.push({id:dt,text:gn,icon:hn,index:bt,sourceLayerIndex:Mt,geometry:Nt.geometry,properties:Ke.properties,type:gp[Ke.type],sortKey:Zn}),hn&&(ce[hn.name]=!0),gn){const Ln=x.evaluate(Nt,{},s).join(","),pn="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ba.vertical)>=0;for(const kn of gn.sections)if(kn.image)ce[kn.image.name]=!0;else{const $n=cn(gn.toString()),vn=kn.fontStack||Ln,Qn=ve[vn]=ve[vn]||{};this.calculateGlyphDependencies(kn.text,Qn,pn,this.allowVerticalPlacement,$n)}}}"line"===_.get("symbol-placement")&&(this.features=function(Ke){const dt={},bt={},Mt=[];let Ot=0;function Nt(Ln){Mt.push(Ke[Ln]),Ot++}function gn(Ln,pn,kn){const $n=bt[Ln];return delete bt[Ln],bt[pn]=$n,Mt[$n].geometry[0].pop(),Mt[$n].geometry[0]=Mt[$n].geometry[0].concat(kn[0]),$n}function hn(Ln,pn,kn){const $n=dt[pn];return delete dt[pn],dt[Ln]=$n,Mt[$n].geometry[0].shift(),Mt[$n].geometry[0]=kn[0].concat(Mt[$n].geometry[0]),$n}function Zn(Ln,pn,kn){const $n=kn?pn[0][pn[0].length-1]:pn[0][0];return`${Ln}:${$n.x}:${$n.y}`}for(let Ln=0;Ln<Ke.length;Ln++){const pn=Ke[Ln],kn=pn.geometry,$n=pn.text?pn.text.toString():null;if(!$n){Nt(Ln);continue}const vn=Zn($n,kn),Qn=Zn($n,kn,!0);if(vn in bt&&Qn in dt&&bt[vn]!==dt[Qn]){const ai=hn(vn,Qn,kn),vr=gn(vn,Qn,Mt[ai].geometry);delete dt[vn],delete bt[Qn],bt[Zn($n,Mt[vr].geometry,!0)]=vr,Mt[ai].geometry=null}else vn in bt?gn(vn,Qn,kn):Qn in dt?hn(vn,Qn,kn):(Nt(Ln),dt[vn]=Ot-1,bt[Qn]=Ot-1)}return Mt.filter(Ln=>Ln.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ke,dt)=>Ke.sortKey-dt.sortKey)}update(e,i,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,s,u),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,s,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(void 0!==e.segment){let u=e.dist(i[e.segment+1]),p=e.dist(i[e.segment]);const _={};for(let x=e.segment+1;x<i.length;x++)_[x]={x:i[x].x,y:i[x].y,tileUnitDistanceFromAnchor:u},x<i.length-1&&(u+=i[x+1].dist(i[x]));for(let x=e.segment||0;x>=0;x--)_[x]={x:i[x].x,y:i[x].y,tileUnitDistanceFromAnchor:p},x>0&&(p+=i[x-1].dist(i[x]));for(let x=0;x<i.length;x++){const E=_[x];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,u,p,_,x,E,M,F,U,V,ce,ve){const Ae=e.indexArray,Ve=e.layoutVertexArray,Ke=e.segments.prepareSegment(4*i.length,Ve,Ae,this.canOverlap?_.sortKey:void 0),dt=this.glyphOffsetArray.length,bt=Ke.vertexLength,Mt=this.allowVerticalPlacement&&x===ba.vertical?Math.PI/2:0,Ot=_.text&&_.text.sections;for(let Nt=0;Nt<i.length;Nt++){const{tl:gn,tr:hn,bl:Zn,br:Ln,tex:pn,pixelOffsetTL:kn,pixelOffsetBR:$n,minFontScaleX:vn,minFontScaleY:Qn,glyphOffset:ai,isSDF:vr,sectionIndex:eo}=i[Nt],ur=Ke.vertexLength,wr=ai[1];Hd(Ve,E.x,E.y,E.z,M.x,M.y,gn.x,wr+gn.y,pn.x,pn.y,s,vr,kn.x,kn.y,vn,Qn),Hd(Ve,E.x,E.y,E.z,M.x,M.y,hn.x,wr+hn.y,pn.x+pn.w,pn.y,s,vr,$n.x,kn.y,vn,Qn),Hd(Ve,E.x,E.y,E.z,M.x,M.y,Zn.x,wr+Zn.y,pn.x,pn.y+pn.h,s,vr,kn.x,$n.y,vn,Qn),Hd(Ve,E.x,E.y,E.z,M.x,M.y,Ln.x,wr+Ln.y,pn.x+pn.w,pn.y+pn.h,s,vr,$n.x,$n.y,vn,Qn),gu(e.dynamicLayoutVertexArray,E,Mt),Ae.emplaceBack(ur,ur+1,ur+2),Ae.emplaceBack(ur+1,ur+2,ur+3),Ke.vertexLength+=4,Ke.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ai[0]),Nt!==i.length-1&&eo===i[Nt+1].sectionIndex||e.programConfigurations.populatePaintArrays(Ve.length,_,_.index,{},ce,ve,Ot&&Ot[eo])}e.placedSymbolArray.emplaceBack(E.x,E.y,E.z,M.x,M.y,dt,this.glyphOffsetArray.length-dt,bt,F,U,M.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],x,0,!1,0,V,0)}_commitLayoutVertex(e,i,s,u,p,_,x){e.emplaceBack(i,s,u,p,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,s,u,p,_,x){const E=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),M=E.vertexLength,F=x.tileAnchorX,U=x.tileAnchorY;for(let ce=0;ce<4;ce++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,u,p,_,F,U,new ne(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,p,_,F,U,new ne(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,p,_,F,U,new ne(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,p,_,F,U,new ne(e.x1,e.y2)),E.vertexLength+=4;const V=s.indexArray;V.emplaceBack(M,M+1),V.emplaceBack(M+1,M+2),V.emplaceBack(M+2,M+3),V.emplaceBack(M+3,M),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,u,p,_){for(let x=u;x<p;x++){const E=s.get(x),M=this.getSymbolInstanceTextSize(e,_,i,x);this._addCollisionDebugVertices(E,M,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,i,s,u,p,_){for(let x=u;x<p;x++){const E=s.get(x),M=this.getSymbolInstanceIconSize(e,i,x);this._addCollisionDebugVertices(E,M,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ku(Ru,Bd.members,Ra),this.iconCollisionBox=new Ku(Ru,Bd.members,Ra);const s=du(this.iconSizeData,e),u=du(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(u,e,i,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(u,e,i,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(s,e,i,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(s,e,i,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,i,s,u){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),_=Nd(this.textSizeData,e,p)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,i,s){const u=this.icon.placedSymbolArray.get(s),p=Nd(this.iconSizeData,e,u);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,i,s){e.emplaceBack(i,-s,-s),e.emplaceBack(i,s,-s),e.emplaceBack(i,s,s),e.emplaceBack(i,-s,s)}_updateTextDebugCollisionBoxes(e,i,s,u,p,_){for(let x=u;x<p;x++){const E=s.get(x),M=this.getSymbolInstanceTextSize(e,_,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,E.padding)}}_updateIconDebugCollisionBoxes(e,i,s,u,p){for(let _=u;_<p;_++){const x=s.get(_),E=this.getSymbolInstanceIconSize(e,i,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,x.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=du(this.iconSizeData,e),u=du(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(u,e,i,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(u,e,i,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(s,e,i,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(s,e,i,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,u,p,_,x,E,M){const F={};for(let U=i;U<s;U++){const V=e.get(U);F.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,padding:V.padding,projectedAnchorX:V.projectedAnchorX,projectedAnchorY:V.projectedAnchorY,projectedAnchorZ:V.projectedAnchorZ,tileAnchorX:V.tileAnchorX,tileAnchorY:V.tileAnchorY},F.textFeatureIndex=V.featureIndex;break}for(let U=u;U<p;U++){const V=e.get(U);F.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,padding:V.padding,projectedAnchorX:V.projectedAnchorX,projectedAnchorY:V.projectedAnchorY,projectedAnchorZ:V.projectedAnchorZ,tileAnchorX:V.tileAnchorX,tileAnchorY:V.tileAnchorY},F.verticalTextFeatureIndex=V.featureIndex;break}for(let U=_;U<x;U++){const V=e.get(U);F.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,padding:V.padding,projectedAnchorX:V.projectedAnchorX,projectedAnchorY:V.projectedAnchorY,projectedAnchorZ:V.projectedAnchorZ,tileAnchorX:V.tileAnchorX,tileAnchorY:V.tileAnchorY},F.iconFeatureIndex=V.featureIndex;break}for(let U=E;U<M;U++){const V=e.get(U);F.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,padding:V.padding,projectedAnchorX:V.projectedAnchorX,projectedAnchorY:V.projectedAnchorY,projectedAnchorZ:V.projectedAnchorZ,tileAnchorX:V.tileAnchorX,tileAnchorY:V.tileAnchorY},F.verticalIconFeatureIndex=V.featureIndex;break}return F}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),u=s.vertexStartIndex+4*s.numGlyphs;for(let p=s.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),u=[],p=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const E=this.symbolInstances.get(x);u.push(0|Math.round(i*E.tileAnchorX+s*E.tileAnchorY)),p.push(E.featureIndex)}return _.sort((x,E)=>u[x]-u[E]||p[E]-p[x]),_}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((u,p,_)=>{u>=0&&_.indexOf(u)===p&&this.addIndicesForPlacedSymbol(this.text,u)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Kn("SymbolBucket",Dl,{omit:["layers","collisionBoxArray","features","compareText"]}),Dl.MAX_GLYPHS=65535,Dl.addDynamicAttributes=gu;const im=new ds({"symbol-placement":new si(St.layout_symbol["symbol-placement"]),"symbol-spacing":new si(St.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new si(St.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bi(St.layout_symbol["symbol-sort-key"]),"symbol-z-order":new si(St.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new si(St.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new si(St.layout_symbol["icon-ignore-placement"]),"icon-optional":new si(St.layout_symbol["icon-optional"]),"icon-rotation-alignment":new si(St.layout_symbol["icon-rotation-alignment"]),"icon-size":new bi(St.layout_symbol["icon-size"]),"icon-text-fit":new si(St.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new si(St.layout_symbol["icon-text-fit-padding"]),"icon-image":new bi(St.layout_symbol["icon-image"]),"icon-rotate":new bi(St.layout_symbol["icon-rotate"]),"icon-padding":new si(St.layout_symbol["icon-padding"]),"icon-keep-upright":new si(St.layout_symbol["icon-keep-upright"]),"icon-offset":new bi(St.layout_symbol["icon-offset"]),"icon-anchor":new bi(St.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new si(St.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new si(St.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new si(St.layout_symbol["text-rotation-alignment"]),"text-field":new bi(St.layout_symbol["text-field"]),"text-font":new bi(St.layout_symbol["text-font"]),"text-size":new bi(St.layout_symbol["text-size"]),"text-max-width":new bi(St.layout_symbol["text-max-width"]),"text-line-height":new bi(St.layout_symbol["text-line-height"]),"text-letter-spacing":new bi(St.layout_symbol["text-letter-spacing"]),"text-justify":new bi(St.layout_symbol["text-justify"]),"text-radial-offset":new bi(St.layout_symbol["text-radial-offset"]),"text-variable-anchor":new si(St.layout_symbol["text-variable-anchor"]),"text-anchor":new bi(St.layout_symbol["text-anchor"]),"text-max-angle":new si(St.layout_symbol["text-max-angle"]),"text-writing-mode":new si(St.layout_symbol["text-writing-mode"]),"text-rotate":new bi(St.layout_symbol["text-rotate"]),"text-padding":new si(St.layout_symbol["text-padding"]),"text-keep-upright":new si(St.layout_symbol["text-keep-upright"]),"text-transform":new bi(St.layout_symbol["text-transform"]),"text-offset":new bi(St.layout_symbol["text-offset"]),"text-allow-overlap":new si(St.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new si(St.layout_symbol["text-ignore-placement"]),"text-optional":new si(St.layout_symbol["text-optional"])});var vp={paint:new ds({"icon-opacity":new bi(St.paint_symbol["icon-opacity"]),"icon-color":new bi(St.paint_symbol["icon-color"]),"icon-halo-color":new bi(St.paint_symbol["icon-halo-color"]),"icon-halo-width":new bi(St.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bi(St.paint_symbol["icon-halo-blur"]),"icon-translate":new si(St.paint_symbol["icon-translate"]),"icon-translate-anchor":new si(St.paint_symbol["icon-translate-anchor"]),"text-opacity":new bi(St.paint_symbol["text-opacity"]),"text-color":new bi(St.paint_symbol["text-color"],{runtimeType:Lo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new bi(St.paint_symbol["text-halo-color"]),"text-halo-width":new bi(St.paint_symbol["text-halo-width"]),"text-halo-blur":new bi(St.paint_symbol["text-halo-blur"]),"text-translate":new si(St.paint_symbol["text-translate"]),"text-translate-anchor":new si(St.paint_symbol["text-translate-anchor"])}),layout:im};class rm{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:fo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Kn("FormatSectionOverride",rm,{omit:["defaultValue"]});class _u extends Ka{constructor(e){super(e,vp)}recalculate(e,i){super.recalculate(e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const p of s)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,s,u){const p=this.layout.get(e).evaluate(i,{},s,u),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||ea(_.value)||!p?p:(x=i.properties,p.replace(/{([^{}]+)}/g,(M,F)=>F in x?String(x[F]):""));var x}createBucket(e){return new Dl(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of vp.paint.overridableProperties){if(!_u.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new rm(i),u=new Ec(s,i.property.specification);let p=null;p="constant"===i.value.kind||"source"===i.value.kind?new pl("source",u):new Dc("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Ts(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&_u.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),u=vp.paint.properties[i];let p=!1;const _=x=>{for(const E of x)if(u.overrides&&u.overrides.hasOverride(E))return void(p=!0)};if("constant"===s.value.kind&&s.value.value instanceof ki)_(s.value.value.sections);else if("source"===s.value.kind){const x=M=>{p||(M instanceof lo&&Gr(M.value)===Tt?_(M.value.sections):M instanceof Co?_(M.sections):M.eachChild(x))},E=s.value;E._styleExpression&&x(E._styleExpression.expression)}return p}getProgramConfiguration(e){return new mo(this,e)}}var K_={paint:new ds({"background-color":new si(St.paint_background["background-color"]),"background-pattern":new ia(St.paint_background["background-pattern"]),"background-opacity":new si(St.paint_background["background-opacity"])})},Ng={paint:new ds({"raster-opacity":new si(St.paint_raster["raster-opacity"]),"raster-hue-rotate":new si(St.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new si(St.paint_raster["raster-brightness-min"]),"raster-brightness-max":new si(St.paint_raster["raster-brightness-max"]),"raster-saturation":new si(St.paint_raster["raster-saturation"]),"raster-contrast":new si(St.paint_raster["raster-contrast"]),"raster-resampling":new si(St.paint_raster["raster-resampling"]),"raster-fade-duration":new si(St.paint_raster["raster-fade-duration"])})};class om extends Ka{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var sm={paint:new ds({"sky-type":new si(St.paint_sky["sky-type"]),"sky-atmosphere-sun":new si(St.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new si(St.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new si(St.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new si(St.paint_sky["sky-gradient-radius"]),"sky-gradient":new ra(St.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new si(St.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new si(St.paint_sky["sky-atmosphere-color"]),"sky-opacity":new si(St.paint_sky["sky-opacity"])})};function Wd(t,e,i){const s=C(0,0,1),u=an(xn());return function(p,_,x){x*=.5;var E=_[0],M=_[1],F=_[2],U=_[3],V=Math.sin(x),ce=Math.cos(x);p[0]=E*ce-F*V,p[1]=M*ce+U*V,p[2]=F*ce+E*V,p[3]=U*ce-M*V}(u,u,i?-bn(t)+Math.PI:bn(t)),Kt(u,u,-bn(e)),jt(s,s,u),Bt(s,s)}const am={circle:class extends Ka{constructor(t){super(t,j_)}createBucket(t){return new Oh(t)}queryRadius(t){const e=t;return ou("circle-radius",this,e)+ou("circle-stroke-width",this,e)+Td(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,s,u,p,_,x){const E=Oc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,t.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return ag(t,s,p,_,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,M)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new mo(this,t)}},heatmap:class extends Ka{createBucket(t){return new kh(t)}constructor(t){super(t,Tf),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Cf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return ou("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,s,u,p,_,x){const E=this.paint.get("heatmap-radius").evaluate(e,i);return ag(t,s,p,_,x,!0,!0,new ne(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new mo(this,t)}},hillshade:class extends Ka{constructor(t){super(t,su)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(t){return new mo(this,t)}},fill:class extends Ka{constructor(t){super(t,Of)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new mo(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Od(t)}queryRadius(){return Td(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,s,u,p){return!t.queryGeometry.isAboveHorizon&&gf(bf(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Ka{constructor(t){super(t,yg)}createBucket(t){return new Yh(t)}queryRadius(){return Td(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new mo(this,t)}queryIntersectsFeature(t,e,i,s,u,p,_,x,E){const M=Oc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,t.pixelToTileUnitsFactor),F=this.paint.get("fill-extrusion-height").evaluate(e,i),U=this.paint.get("fill-extrusion-base").evaluate(e,i),V=[0,0],ce=x&&p.elevation,ve=p.elevation?p.elevation.exaggeration():1;if(ce){const Ke=t.tile.getBucket(this).centroidVertexArray,dt=E+1;if(dt<Ke.length){const bt=Ke.get(dt);V[0]=bt.a_centroid_pos0,V[1]=bt.a_centroid_pos1}}if(0===V[0]&&1===V[1])return!1;const Ae=(Ke=s,dt=U,bt=F,Mt=M,Ot=_,(Nt=ce?x:null)?function(Ln,pn,kn,$n,vn,Qn,ai,vr,eo){const ur=[],wr=[],Mn=[0,0,0,1];for(const Nr of Ln){const Ar=[],ko=[];for(const Io of Nr){const as=Io.x+$n.x,Cs=Io.y+$n.y,zr=Bf(as,Cs,pn,kn,Qn,ai,vr,eo);Mn[0]=as,Mn[1]=Cs,Mn[2]=zr.base,Mn[3]=1,ln(Mn,Mn,vn),Mn[3]=Math.max(Mn[3],1e-5);const dr=Xh([Mn[0]/Mn[3],Mn[1]/Mn[3],Mn[2]/Mn[3]]);Mn[0]=as,Mn[1]=Cs,Mn[2]=zr.top,Mn[3]=1,ln(Mn,Mn,vn),Mn[3]=Math.max(Mn[3],1e-5);const go=Xh([Mn[0]/Mn[3],Mn[1]/Mn[3],Mn[2]/Mn[3]]);Ar.push(dr),ko.push(go)}ur.push(Ar),wr.push(ko)}return[ur,wr]}(Ke,dt,bt,Mt,Ot,Nt,V,ve,p.center.lat):function(Ln,pn,kn,$n,vn){const Qn=[],ai=[],vr=vn[8]*pn,eo=vn[9]*pn,ur=vn[10]*pn,wr=vn[11]*pn,Mn=vn[8]*kn,Nr=vn[9]*kn,Ar=vn[10]*kn,ko=vn[11]*kn;for(const Io of Ln){const as=[],Cs=[];for(const zr of Io){const dr=zr.x+$n.x,go=zr.y+$n.y,Mo=vn[0]*dr+vn[4]*go+vn[12],Fo=vn[1]*dr+vn[5]*go+vn[13],Ro=vn[2]*dr+vn[6]*go+vn[14],Es=vn[3]*dr+vn[7]*go+vn[15],la=Mo+vr,hs=Fo+eo,po=Ro+ur,Wo=Math.max(Es+wr,1e-5),ca=Mo+Mn,ps=Fo+Nr,Wr=Ro+Ar,Yo=Math.max(Es+ko,1e-5),_o=new ne(la/Wo,hs/Wo);_o.z=po/Wo,as.push(_o);const Us=new ne(ca/Yo,ps/Yo);Us.z=Wr/Yo,Cs.push(Us)}Qn.push(as),ai.push(Cs)}return[Qn,ai]}(Ke,dt,bt,Mt,Ot)),Ve=t.queryGeometry;var Ke,dt,bt,Mt,Ot,Nt;return function(Ke,dt,bt){let Mt=1/0;gf(bt,dt)&&(Mt=Jh(bt,dt[0]));for(let Ot=0;Ot<dt.length;Ot++){const Nt=dt[Ot],gn=Ke[Ot];for(let hn=0;hn<Nt.length-1;hn++){const Zn=Nt[hn],Ln=[Zn,Nt[hn+1],gn[hn+1],gn[hn],Zn];iu(bt,Ln)&&(Mt=Math.min(Mt,Jh(bt,Ln)))}}return Mt!==1/0&&Mt}(Ae[0],Ae[1],Ve.isPointQuery()?Ve.screenBounds:Ve.screenGeometry)}},line:class extends Ka{constructor(t){super(t,Ld),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof za,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=xg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new uu(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new mo(this,t)}queryRadius(t){const e=t,i=Qh(ou("line-width",this,e),ou("line-gap-width",this,e)),s=ou("line-offset",this,e);return i/2+Math.abs(s)+Td(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,s,u,p){if(t.queryGeometry.isAboveHorizon)return!1;const _=bf(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,t.pixelToTileUnitsFactor),x=t.pixelToTileUnitsFactor/2*Qh(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),E=this.paint.get("line-offset").evaluate(e,i);return E&&(s=function(M,F){const U=[],V=new ne(0,0);for(let ce=0;ce<M.length;ce++){const ve=M[ce],Ae=[];for(let Ve=0;Ve<ve.length;Ve++){const Ke=ve[Ve-1],dt=ve[Ve],bt=ve[Ve+1],Mt=0===Ve?V:dt.sub(Ke)._unit()._perp(),Ot=Ve===ve.length-1?V:bt.sub(dt)._unit()._perp(),Nt=Mt._add(Ot)._unit();Nt._mult(1/(Nt.x*Ot.x+Nt.y*Ot.y)),Ae.push(Nt._mult(F)._add(dt))}U.push(Ae)}return U}(s,E*t.pixelToTileUnitsFactor)),function(M,F,U){for(let V=0;V<F.length;V++){const ce=F[V];if(M.length>=3)for(let ve=0;ve<ce.length;ve++)if(ru(M,ce[ve]))return!0;if(og(M,ce,U))return!0}return!1}(_,s,x)}isTileClipped(){return!0}},symbol:_u,background:class extends Ka{constructor(t){super(t,K_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ka{constructor(t){super(t,Ng)}getProgramIds(){return["raster"]}},sky:class extends Ka{constructor(t){super(t,sm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Cf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(t,e){const i=this.paint.get("sky-type");if("atmosphere"===i){const s=this.paint.get("sky-atmosphere-sun"),u=!s,p=t.style.light,_=p.properties.get("position");return u&&"viewport"===p.properties.get("anchor")&&Di("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Wd(_.azimuthal,90-_.polar,e):Wd(s[0],90-s[1],e)}if("gradient"===i){const s=this.paint.get("sky-gradient-center");return Wd(s[0],90-s[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}},{HTMLImageElement:xp,HTMLCanvasElement:Il,HTMLVideoElement:Qu,ImageData:lm,ImageBitmap:Yd}=Q;class bp{constructor(e,i,s,u){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,s){const{width:u,height:p}=e,{context:_}=this,{gl:x}=_;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||!1!==i.premultiply)),s||this.size&&this.size[0]===u&&this.size[1]===p){const{x:E,y:M}=s||{x:0,y:0};e instanceof xp||e instanceof Il||e instanceof Qu||e instanceof lm||Yd&&e instanceof Yd?x.texSubImage2D(x.TEXTURE_2D,0,E,M,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,E,M,u,p,x.RGBA,x.UNSIGNED_BYTE,e.data)}else this.size=[u,p],e instanceof xp||e instanceof Il||e instanceof Qu||e instanceof lm||Yd&&e instanceof Yd?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,p,0,this.format,x.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,i){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class ed{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Tl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=Le(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const u=[];let p=e.length%2==1?-e[e.length-1]*s:0,_=e[0]*s,x=!0;u.push({left:p,right:_,isDash:x,zeroLength:0===e[0]});let E=e[0];for(let M=1;M<e.length;M++){x=!x;const F=e[M];p=E*s,E+=F,_=E*s,u.push({left:p,right:_,isDash:x,zeroLength:0===F})}return u}addRoundDash(e,i,s){const u=i/2;for(let p=-s;p<=s;p++){const _=this.width*(this.nextRow+s+p);let x=0,E=e[x];for(let M=0;M<this.width;M++){M/E.right>1&&(E=e[++x]);const F=Math.abs(M-E.left),U=Math.abs(M-E.right),V=Math.min(F,U);let ce;const ve=p/s*(u+1);if(E.isDash){const Ae=u-Math.abs(ve);ce=Math.sqrt(V*V+Ae*Ae)}else ce=u-Math.sqrt(V*V+ve*ve);this.image.data[_+M]=Math.max(0,Math.min(255,ce+128))}}}addRegularDash(e,i){for(let E=e.length-1;E>=0;--E){const M=e[E],F=e[E+1];M.zeroLength?e.splice(E,1):F&&F.isDash===M.isDash&&(F.left=M.left,e.splice(E,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const p=this.width*this.nextRow;let _=0,x=e[_];for(let E=0;E<this.width;E++){E/x.right>1&&(x=e[++_]);const M=Math.abs(E-x.left),F=Math.abs(E-x.right),U=Math.min(M,F);this.image.data[p+E]=Math.max(0,Math.min(255,(x.isDash?U:-U)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const u="round"===i,p=u?7:0,_=2*p+1;if(this.nextRow+_>this.height)return Di("LineAtlas out of space"),null;0===e.length&&e.push(1);let x=0;for(let F=0;F<e.length;F++)e[F]<0&&(Di("Negative value is found in line dasharray, replacing values with 0"),e[F]=0),x+=e[F];if(0!==x){const F=this.width/x,U=this.getDashRanges(e,this.width,F);u?this.addRoundDash(U,F,p):this.addRegularDash(U,"square"===i?.5*F:0)}const E=this.nextRow+p;this.nextRow+=_;const M={tl:[E,p],br:[x,0]};return this.positions[s]=M,M}}Kn("LineAtlas",ed);class cm{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const wp=Q.performance;function yu(t){const e=t?t.url.toString():void 0;return wp.getEntriesByName(e)}class zg{constructor(){this.tasks={},this.taskQueue=[],me(["process"],this),this.invoker=new cm(this.process),this.nextId=0}add(e,i){const s=this.nextId++,u=function({type:p,isSymbolTile:_,zoom:x}){return x=x||0,"message"===p?0:"maybePrepare"!==p||_?"parseTile"!==p||_?"parseTile"===p&&_?300-x:"maybePrepare"===p&&_?400-x:500:200-x:100-x}(i);if(0===u){xr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:i,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){xr();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const p=this.tasks[this.taskQueue[u]];p.priority<i&&(i=p.priority,e=u)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}function Jd(t,e,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[t*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class td{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=nd(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const s=(_=this.y,x=this.z,E=Jd(256*(p=this.x),256*(_=Math.pow(2,x)-_-1),x),M=Jd(256*(p+1),256*(_+1),x),E[0]+","+E[1]+","+M[0]+","+M[1]),u=function(p,_,x){let E,M="";for(let F=p;F>0;F--)E=1<<F-1,M+=(_&E?1:0)+(x&E?2:0);return M}(this.z,this.x,this.y);var p,_,x,E,M;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Xd{constructor(e,i){this.wrap=e,this.canonical=i,this.key=nd(e,i.z,i.z,i.x,i.y)}}class Bs{constructor(e,i,s,u,p){this.overscaledZ=e,this.wrap=i,this.canonical=new td(s,+u,+p),this.key=0===i&&e===s?this.canonical.key:nd(i,e,s,u,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Bs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Bs(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return nd(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return nd(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Bs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new Bs(i,this.wrap,i,s,u),new Bs(i,this.wrap,i,s+1,u),new Bs(i,this.wrap,i,s,u+1),new Bs(i,this.wrap,i,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Bs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Bs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Xd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function nd(t,e,i,s,u){const p=1<<Math.min(i,22);let _=p*(u%p)+s%p;return t&&i<22&&(_+=p*p*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*_+i)+(e-i)}Kn("CanonicalTileID",td),Kn("OverscaledTileID",Bs,{omit:["projMatrix"]});class pc{constructor(e,i,s){this.func=e,this.mask=i,this.range=s}}pc.ReadOnly=!1,pc.ReadWrite=!0,pc.disabled=new pc(519,pc.ReadOnly,[0,1]);class Cp{constructor(e,i,s,u,p,_){this.test=e,this.ref=i,this.mask=s,this.fail=u,this.depthFail=p,this.pass=_}}Cp.disabled=new Cp({func:519,mask:0},0,0,7680,7680,7680);class il{constructor(e,i,s){this.blendFunction=e,this.blendColor=i,this.mask=s}}il.Replace=[1,0],il.disabled=new il(il.Replace,zi.transparent,[!1,!1,!1,!1]),il.unblended=new il(il.Replace,zi.transparent,[!0,!0,!0,!0]),il.alphaBlended=new il([1,771],zi.transparent,[!0,!0,!0,!0]);class rl{constructor(e,i,s){this.enable=e,this.mode=i,this.frontFace=s}}rl.disabled=new rl(!1,1029,2305),rl.backCCW=new rl(!0,1029,2305),rl.backCW=new rl(!0,1029,2304),rl.frontCW=new rl(!0,1028,2304),rl.frontCCW=new rl(!0,1028,2305);class um{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Vc{constructor(e,i,s,u,p){this.type="Feature",this._vectorTileFeature=e,e._z=i,e._x=s,e._y=u,this.properties=e.properties,this.id=p}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)"_geometry"!==i&&"_vectorTileFeature"!==i&&(e[i]=this[i]);return e}}class Ug{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,s){const u=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Oe(this.stateChanges[e][u],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const p in this.state[e][u])s[p]||(this.deletedStates[e][u][p]=null)}else for(const p in s)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][p]&&delete this.deletedStates[e][u][p]}removeFeatureState(e,i,s){if(null===this.deletedStates[e])return;const u=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==i)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][s]=null);else if(void 0!==i)if(this.stateChanges[e]&&this.stateChanges[e][u])for(s in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][s]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,i){const s=String(i),u=Oe({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const p=this.deletedStates[e][i];if(null===p)return{};for(const _ in p)delete u[_]}return u}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const s={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const _ in this.stateChanges[u])this.state[u][_]||(this.state[u][_]={}),Oe(this.state[u][_],this.stateChanges[u][_]),p[_]=this.state[u][_];s[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(null===this.deletedStates[u])for(const _ in this.state[u])p[_]={},this.state[u][_]={};else for(const _ in this.deletedStates[u]){if(null===this.deletedStates[u][_])this.state[u][_]={};else for(const x of Object.keys(this.deletedStates[u][_]))delete this.state[u][_][x];p[_]=this.state[u][_]}s[u]=s[u]||{},Oe(s[u],p)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const u in e)e[u].setFeatureState(s,i)}}class dm{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function hm(t,e,i,s){let u=0,p=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(s[_])<1e-15){if(i[_]<t[_]||i[_]>e[_])return null}else{const x=1/s[_];let E=(t[_]-i[_])*x,M=(e[_]-i[_])*x;if(E>M){const F=E;E=M,M=F}if(E>u&&(u=E),M<p&&(p=M),u>p)return null}return u}function pm(t,e,i,s,u,p,_,x,E,M,F){const U=s-t,V=u-e,ce=p-i,ve=_-t,Ae=x-e,Ve=E-i,Ke=F[1]*Ve-F[2]*Ae,dt=F[2]*ve-F[0]*Ve,bt=F[0]*Ae-F[1]*ve,Mt=U*Ke+V*dt+ce*bt;if(Math.abs(Mt)<1e-15)return null;const Ot=1/Mt,Nt=M[0]-t,gn=M[1]-e,hn=M[2]-i,Zn=(Nt*Ke+gn*dt+hn*bt)*Ot;if(Zn<0||Zn>1)return null;const Ln=gn*ce-hn*V,pn=hn*U-Nt*ce,kn=Nt*V-gn*U,$n=(F[0]*Ln+F[1]*pn+F[2]*kn)*Ot;return $n<0||Zn+$n>1?null:(ve*Ln+Ae*pn+Ve*kn)*Ot}function wa(t,e,i){return(t-e)/(i-e)}function Qd(t,e,i,s,u,p,_,x,E){const M=1<<i,F=p-s,U=_-u,V=(t+1)/M*F+s,ce=(e+0)/M*U+u,ve=(e+1)/M*U+u;x[0]=(t+0)/M*F+s,x[1]=ce,E[0]=V,E[1]=ve}class Ep{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(p){const _=Math.ceil(Math.log2(p.dim/8)),x=[];let E=Math.ceil(Math.pow(2,_));const M=1/E,F=(ce,ve,Ae,Ve,Ke)=>{const dt=Ve?1:0,bt=(ce+1)*Ae-dt,Mt=ve*Ae,Ot=(ve+1)*Ae-dt;Ke[0]=ce*Ae,Ke[1]=Mt,Ke[2]=bt,Ke[3]=Ot};let U=new dm(E);const V=[];for(let ce=0;ce<E*E;ce++){F(ce%E,Math.floor(ce/E),M,!1,V);const ve=Wl(V[0],V[1],p),Ae=Wl(V[2],V[1],p),Ve=Wl(V[2],V[3],p),Ke=Wl(V[0],V[3],p);U.minimums.push(Math.min(ve,Ae,Ve,Ke)),U.maximums.push(Math.max(ve,Ae,Ve,Ke)),U.leaves.push(1)}for(x.push(U),E/=2;E>=1;E/=2){const ce=x[x.length-1];U=new dm(E);for(let ve=0;ve<E*E;ve++){F(ve%E,Math.floor(ve/E),2,!0,V);const Ae=ce.getElevation(V[0],V[1]),Ve=ce.getElevation(V[2],V[1]),Ke=ce.getElevation(V[2],V[3]),dt=ce.getElevation(V[0],V[3]),bt=ce.isLeaf(V[0],V[1]),Mt=ce.isLeaf(V[2],V[1]),Ot=ce.isLeaf(V[2],V[3]),Nt=ce.isLeaf(V[0],V[3]),gn=Math.min(Ae.min,Ve.min,Ke.min,dt.min),hn=Math.max(Ae.max,Ve.max,Ke.max,dt.max),Zn=bt&&Mt&&Ot&&Nt;U.maximums.push(hn),U.minimums.push(gn),U.leaves.push(hn-gn<=5&&Zn?1:0)}x.push(U)}return x}(this.dem),s=i.length-1,u=i[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,u,p,_,x=1){return hm([e,i,-100],[s,u,this.maximums[0]*x],p,_)}raycast(e,i,s,u,p,_,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(e,i,s,u,p,_,x);if(null==E)return null;const M=[],F=[],U=[],V=[],ce=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;ce.length>0;){const{idx:ve,t:Ae,nodex:Ve,nodey:Ke,depth:dt}=ce.pop();if(this.leaves[ve]){Qd(Ve,Ke,dt,e,i,s,u,U,V);const Mt=1<<dt,Ot=(Ve+0)/Mt,Nt=(Ve+1)/Mt,gn=(Ke+0)/Mt,hn=(Ke+1)/Mt,Zn=Wl(Ot,gn,this.dem)*x,Ln=Wl(Nt,gn,this.dem)*x,pn=Wl(Nt,hn,this.dem)*x,kn=Wl(Ot,hn,this.dem)*x,$n=pm(U[0],U[1],Zn,V[0],U[1],Ln,V[0],V[1],pn,p,_),vn=pm(V[0],V[1],pn,U[0],V[1],kn,U[0],U[1],Zn,p,_),Qn=Math.min(null!==$n?$n:Number.MAX_VALUE,null!==vn?vn:Number.MAX_VALUE);if(Qn!==Number.MAX_VALUE)return Qn;{const ai=gt([],p,_,Ae);if(Dp(Zn,Ln,kn,pn,wa(ai[0],U[0],V[0]),wa(ai[1],U[1],V[1]))>=ai[2])return Ae}continue}let bt=0;for(let Mt=0;Mt<this._siblingOffset.length;Mt++){Qd((Ve<<1)+this._siblingOffset[Mt][0],(Ke<<1)+this._siblingOffset[Mt][1],dt+1,e,i,s,u,U,V),U[2]=-100,V[2]=this.maximums[this.childOffsets[ve]+Mt]*x;const Ot=hm(U,V,p,_);if(null!=Ot){const Nt=Ot;M[Mt]=Nt;let gn=!1;for(let hn=0;hn<bt&&!gn;hn++)Nt>=M[F[hn]]&&(F.splice(hn,0,Mt),gn=!0);gn||(F[bt]=Mt),bt++}}for(let Mt=0;Mt<bt;Mt++){const Ot=F[Mt];ce.push({idx:this.childOffsets[ve]+Ot,t:M[Ot],nodex:(Ve<<1)+this._siblingOffset[Ot][0],nodey:(Ke<<1)+this._siblingOffset[Ot][1],depth:dt+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,u,p){if(1===e[u].isLeaf(i,s))return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const _=u-1,x=e[_];let E,M=0;for(let F=0;F<this._siblingOffset.length;F++){const U=2*i+this._siblingOffset[F][0],V=2*s+this._siblingOffset[F][1],ce=x.getElevation(U,V),ve=x.isLeaf(U,V),Ae=this._addNode(ce.min,ce.max,ve);ve&&(M|=1<<F),E||(E=Ae)}for(let F=0;F<this._siblingOffset.length;F++)M&1<<F||this._construct(e,2*i+this._siblingOffset[F][0],2*s+this._siblingOffset[F][1],_,E+F)}}function Dp(t,e,i,s,u,p){return yr(yr(t,i,p),yr(e,s,p),u)}function Wl(t,e,i){const s=i.dim,u=_i(t*s-.5,0,s-1),p=_i(e*s-.5,0,s-1),_=Math.floor(u),x=Math.floor(p),E=Math.min(_+1,s-1),M=Math.min(x+1,s-1);return Dp(i.get(_,x),i.get(E,x),i.get(_,M),i.get(E,M),u-_,p-x)}const Ip={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class eh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,u=!1,p=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return Di(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const _=this.dim=i.height-2;if(this.data=new Uint32Array(i.data.buffer),this.encoding=s||"mapbox",this.borderReady=u,!u){for(let x=0;x<_;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(_,x)]=this.data[this._idx(_-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,_)]=this.data[this._idx(x,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Ep(this)}get(e,i,s=!1){const u=new Uint8Array(this.data.buffer);s&&(e=_i(e,-1,this.dim),i=_i(i,-1,this.dim));const p=4*this._idx(e,i);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])}static getUnpackVector(e){return Ip[e]}get unpackVector(){return Ip[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,s){return(256*e*256+256*i+s)/10-1e4}_unpackTerrarium(e,i,s){return 256*e+i+s/256-32768}static pack(e,i){const s=[0,0,0,0],u=eh.getUnpackVector(i);let p=Math.floor((e+u[3])/u[2]);return s[2]=p%256,p=Math.floor(p/256),s[1]=p%256,p=Math.floor(p/256),s[0]=p,s}getPixels(){return new Ws({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,p=i*this.dim+this.dim,_=s*this.dim,x=s*this.dim+this.dim;switch(i){case-1:u=p-1;break;case 1:p=u+1}switch(s){case-1:_=x-1;break;case 1:x=_+1}const E=-i*this.dim,M=-s*this.dim;for(let F=_;F<x;F++)for(let U=u;U<p;U++)this.data[this._idx(U,F)]=e.data[this._idx(U+E,F+M)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Kn("DEMData",eh),Kn("DemMinMaxQuadTree",Ep,{omit:["dem"]});class Zg{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,s){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const p={value:i,timeout:void 0};if(void 0!==s&&(p.timeout=setTimeout(()=>{this.remove(e,p)},s)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const s=e.wrapped().key,u=void 0===i?0:this.data[s].indexOf(i),p=this.data[s][u];return this.data[s].splice(u,1),p.timeout&&clearTimeout(p.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(p.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const s in this.data)for(const u of this.data[s])e(u.value)||i.push(u);for(const s of i)this.remove(s.value.tileID,s)}}class $c extends Un{constructor(e,i,s){super(),this.id=e,this._onlySymbols=s,i.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new Zg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ug}onAdd(e){this.map=e,this._minTileCacheSize=e?e._minTileCacheSize:null,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const s=this._tiles[i];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return Xt(this._tiles).map(e=>e.tileID).sort(fm).map(e=>e.key)}getRenderableIds(e){const i=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&i.push(this._tiles[s]);return e?i.sort((s,u)=>{const p=s.tileID,_=u.tileID,x=new ne(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),E=new ne(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-_.overscaledZ||E.y-x.y||E.x-x.x}).map(s=>s.tileID.key):i.map(s=>s.tileID).sort(fm).map(s=>s.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=i),this._loadTile(s,this._tileLoaded.bind(this,s,e,i)))}_tileLoaded(e,i,s,u){if(u)if(e.state="errored",404!==u.status)this._source.fire(new Cn(u,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Oi.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new un("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let u=0;u<i.length;u++){const p=i[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const _=this.getTileByID(p);s(e,_),s(_,e)}}function s(u,p){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let _=p.tileID.canonical.x-u.tileID.canonical.x;const x=p.tileID.canonical.y-u.tileID.canonical.y,E=Math.pow(2,u.tileID.canonical.z),M=p.tileID.key;0===_&&0===x||Math.abs(x)>1||(Math.abs(_)>1&&(1===Math.abs(_+E)?_+=E:1===Math.abs(_-E)&&(_-=E)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,_,x),u.neighboringTiles&&u.neighboringTiles[M]&&(u.neighboringTiles[M].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,s,u){for(const p in this._tiles){let _=this._tiles[p];if(u[p]||!_.hasData()||_.tileID.overscaledZ<=i||_.tileID.overscaledZ>s)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>i+1;){const M=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[M.key],_&&_.hasData()&&(x=M)}let E=x;for(;E.overscaledZ>i;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]){u[x.key]=x;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=i?s:null}for(let s=e.overscaledZ-1;s>=i;s--){const u=e.scaledTo(s),p=this._getLoadedTile(u);if(p)return p}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const s=Math.ceil(e.width/i)+1,u=Math.ceil(e.height/i)+1,p=Math.floor(s*u*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,p):p,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(e){const i=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,i){const s={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+i),s[p.tileID.key]=p}this._tiles=s;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,i,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let u;this.updateCacheSize(e,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Bs(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(u=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(x=>this._source.hasTile(x)))):u=[];const p=this._updateRetainedTiles(u);if(Mp(this._source.type)&&0!==u.length){const x={},E={},M=Object.keys(p);for(const U of M){const V=p[U],ce=this._tiles[U];if(!ce||ce.fadeEndTime&&ce.fadeEndTime<=Oi.now())continue;const ve=this.findLoadedParent(V,Math.max(V.overscaledZ-$c.maxOverzooming,this._source.minzoom));ve&&(this._addTile(ve.tileID),x[ve.tileID.key]=ve.tileID),E[U]=V}const F=u[u.length-1].overscaledZ;for(const U in this._tiles){const V=this._tiles[U];if(p[U]||!V.hasData())continue;let ce=V.tileID;for(;ce.overscaledZ>F;){ce=ce.scaledTo(ce.overscaledZ-1);const ve=this._tiles[ce.key];if(ve&&ve.hasData()&&E[ce.key]){p[U]=V.tileID;break}}}for(const U in x)p[U]||(this._coveredTiles[U]=!0,p[U]=x[U])}for(const x in p)this._tiles[x].clearFadeHold();const _=function(x,E){const M=[];for(const F in x)F in E||M.push(F);return M}(this._tiles,p);for(const x of _){const E=this._tiles[x];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(0===e.length)return i;const s={},u=e.reduce((M,F)=>Math.min(M,F.overscaledZ),1/0),p=e[0].overscaledZ,_=Math.max(p-$c.maxOverzooming,this._source.minzoom),x=Math.max(p+$c.maxUnderzooming,this._source.minzoom),E={};for(const M of e){const F=this._addTile(M);i[M.key]=M,F.hasData()||u<this._source.maxzoom&&(E[M.key]=M)}this._retainLoadedChildren(E,u,x,i);for(const M of e){let F=this._tiles[M.key];if(F.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const V=M.children(this._source.maxzoom)[0],ce=this.getTile(V);if(ce&&ce.hasData()){i[V.key]=V;continue}}else{const V=M.children(this._source.maxzoom);if(i[V[0].key]&&i[V[1].key]&&i[V[2].key]&&i[V[3].key])continue}let U=F.wasRequested();for(let V=M.overscaledZ-1;V>=_;--V){const ce=M.scaledTo(V);if(s[ce.key]||(s[ce.key]=!0,F=this.getTile(ce),!F&&U&&(F=this._addTile(ce)),F&&(i[ce.key]=ce,U=F.wasRequested(),F.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let s,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){s=this._loadedParentTiles[u.key];break}i.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(s=this._getLoadedTile(p),s)break;u=p}for(const p of i)this._loadedParentTiles[p]=s}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const s=Boolean(i);if(!s){const u=this.map?this.map.painter:null,p="raster"===this._source.type||"raster-dem"===this._source.type;i=new th(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,p),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,s||this._source.fire(new un("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=i.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&"reloading"!==i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,i,s){const u=[],p=this.transform;if(!p)return u;for(const _ in this._tiles){const x=this._tiles[_];if(s&&x.clearQueryDebugViz(),x.holdingForFade())continue;const E=e.containsTile(x,p,i);E&&u.push(E)}return u}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of i)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(Mp(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=Oi.now())return!0}return!1}setFeatureState(e,i,s){this._state.updateState(e=e||"_geojsonTileLayer",i,s)}removeFeatureState(e,i,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,s)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,s){const u=this._tiles[e];u&&u.setDependencies(i,s)}reloadTilesForDependencies(e,i){for(const s in this._tiles)this._tiles[s].hasDependency(e,i)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,i))}_preloadTiles(e,i){const s=new Map,u=Array.isArray(e)?e:[e],p=this.map.painter.terrain,_=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const M of u){const F=M.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const U of F)s.set(U.key,U);this.usedForTerrain&&M.updateElevation(!1)}const x=Array.from(s.values()),E="raster"===this._source.type||"raster-dem"===this._source.type;Ti(x,(M,F)=>{const U=new th(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,E);this._loadTile(U,V=>{"raster-dem"===this._source.type&&U.dem&&this._backfillDEM(U),F(V,U)})},i)}}function fm(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Mp(t){return"raster"===t||"image"===t||"video"===t}$c.maxOverzooming=10,$c.maxUnderzooming=3;class Ap{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const u=s||e.findDEMTileFor(i);if(!u||!u.dem)return;const p=u.dem,_=u.tileID,x=1<<i.canonical.z-_.canonical.z;return new Ap(u,u.tileSize/er/x,[(i.canonical.x/x-_.canonical.x)*p.dim,(i.canonical.y/x-_.canonical.y)*p.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(s);return new ne(u,p)}getElevationAt(e,i,s,u){const p=e*this._scale+this._offset[0],_=i*this._scale+this._offset[1],x=Math.floor(p),E=Math.floor(_),M=this._dem;return u=!!u,s?yr(yr(M.get(x,E,u),M.get(x,E+1,u),_-E),yr(M.get(x+1,E,u),M.get(x+1,E+1,u),_-E),p-x):M.get(x,E,u)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Qa(1,e)*this._dem.stride}}class Sp{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ir(er,16,0),this.featureIndexArray=new df,this.promoteId=i}insert(e,i,s,u,p,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,p,_);const E=this.grid;for(let M=0;M<i.length;M++){const F=i[M],U=[1/0,1/0,-1/0,-1/0];for(let V=0;V<F.length;V++){const ce=F[V];U[0]=Math.min(U[0],ce.x),U[1]=Math.min(U[1],ce.y),U[2]=Math.max(U[2],ce.x),U[3]=Math.max(U[3],ce.y)}U[0]<er&&U[1]<er&&U[2]>=0&&U[3]>=0&&E.insert(x,U[0],U[1],U[2],U[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new zc.VectorTile(new Uc(this.rawTileData)).layers,this.sourceLayerCoder=new um(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,s,u){this.loadVTLayers();const p=e.params||{},_=Ga(p.filter),x=e.tileResult,E=e.transform,M=x.bufferedTilespaceBounds,F=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(ve,Ae,Ve,Ke)=>vf(x.bufferedTilespaceGeometry,ve,Ae,Ve,Ke));F.sort(Vg);let U=null;E.elevation&&F.length>0&&(U=Ap.create(E.elevation,this.tileID));const V={};let ce;for(let ve=0;ve<F.length;ve++){const Ae=F[ve];if(Ae===ce)continue;ce=Ae;const Ve=this.featureIndexArray.get(Ae);let Ke=null;this.loadMatchingFeature(V,Ve,_,p.layers,p.availableImages,i,s,u,(dt,bt,Mt,Ot=0)=>(Ke||(Ke=Vl(dt,this.tileID.canonical,e.tileTransform)),bt.queryIntersectsFeature(x,dt,Mt,Ke,this.z,e.transform,e.pixelPosMatrix,U,Ot)))}return V}loadMatchingFeature(e,i,s,u,p,_,x,E,M){const{featureIndex:F,bucketIndex:U,sourceLayerIndex:V,layoutVertexArrayOffset:ce}=i,ve=this.bucketLayerIDs[U];if(u&&!function(dt,bt){for(let Mt=0;Mt<dt.length;Mt++)if(bt.indexOf(dt[Mt])>=0)return!0;return!1}(u,ve))return;const Ae=this.sourceLayerCoder.decode(V),Ve=this.vtLayers[Ae].feature(F);if(s.needGeometry){const dt=$l(Ve,!0);if(!s.filter(new Hi(this.tileID.overscaledZ),dt,this.tileID.canonical))return}else if(!s.filter(new Hi(this.tileID.overscaledZ),Ve))return;const Ke=this.getId(Ve,Ae);for(let dt=0;dt<ve.length;dt++){const bt=ve[dt];if(u&&u.indexOf(bt)<0)continue;const Mt=_[bt];if(!Mt)continue;let Ot={};void 0!==Ke&&E&&(Ot=E.getState(Mt.sourceLayer||"_geojsonTileLayer",Ke));const Nt=Oe({},x[bt]);Nt.paint=mm(Nt.paint,Mt.paint,Ve,Ot,p),Nt.layout=mm(Nt.layout,Mt.layout,Ve,Ot,p);const gn=!M||M(Ve,Mt,Ot,ce);if(!gn)continue;const hn=new Vc(Ve,this.z,this.x,this.y,Ke);hn.layer=Nt;let Zn=e[bt];void 0===Zn&&(Zn=e[bt]=[]),Zn.push({featureIndex:F,feature:hn,intersectionZ:gn})}}lookupSymbolFeatures(e,i,s,u,p,_,x,E){const M={};this.loadVTLayers();const F=Ga(p);for(const U of e)this.loadMatchingFeature(M,{bucketIndex:s,sourceLayerIndex:u,featureIndex:U,layoutVertexArrayOffset:0},F,_,x,E,i);return M}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),p=this.vtFeatures[u];if(p[i])return p[i];const _=this.vtLayers[u].feature(i);return p[i]=_,_}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;return this.promoteId&&(s=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[i]],"boolean"==typeof s&&(s=Number(s))),s}}function mm(t,e,i,s,u){return Ft(t,(p,_)=>{const x=e instanceof Oa?e.get(_):null;return x&&x.evaluate?x.evaluate(i,s,u):x})}function Vg(t,e){return e-t}Kn("FeatureIndex",Sp,{omit:["rawTileData","sourceLayerCoder"]});var Q_=bo([{name:"a_pos",type:"Int16",components:2}]);const mc=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,s=0,u=0,p=0,_=0,x=0;for(1&e?u=p=_=32:i=s=x=32;(e>>=1)>1;){const M=i+u>>1,F=s+p>>1;1&e?(u=i,p=s,i=_,s=x):(i=u,s=p,u=_,p=x),_=M,x=F}const E=4*t;mc[E+0]=i,mc[E+1]=s,mc[E+2]=u,mc[E+3]=p}const sl=new Uint16Array(2178),Yl=new Uint8Array(1089),Pp=new Uint16Array(1089);function Ba(t){return 0===t?-.03125:32===t?.03125:0}var gm=bo([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const $g={type:2,extent:er,loadGeometry:()=>[[new ne(0,0),new ne(8193,0),new ne(8193,8193),new ne(0,8193),new ne(0,0)]]};class th{constructor(e,i,s,u,p){this.tileID=e,this.uid=Re(),this.uses=0,this.tileSize=i,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Oi.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=xu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,p){const _={};if(!p)return _;for(const x of u){const E=x.layerIds.map(M=>p.getLayer(M)).filter(Boolean);if(0!==E.length){x.layers=E,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(M=>E.filter(F=>F.id===M)[0]));for(const M of E)_[M.id]=x}}return _}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof Dl){if(this.hasSymbolBuckets=!0,!s)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof Dl&&p.hasRTLText){this.hasRTLText=!0,br.isLoading()||br.isLoaded()||"deferred"!==ws()||ya();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new sf}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const u=this.buckets[s];u.uploadPending()&&u.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new bp(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new bp(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new bp(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,s,u,p,_,x,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:x,transform:_,params:p,tileTransform:this.tileTransform},e,i,s):{}}querySourceFeatures(e,i){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const u=s.loadVTLayers(),p=i?i.sourceLayer:"",_=u._geojsonTileLayer||u[p];if(!_)return;const x=Ga(i&&i.filter),{z:E,x:M,y:F}=this.tileID.canonical,U={z:E,x:M,y:F};for(let V=0;V<_.length;V++){const ce=_.feature(V);if(x.needGeometry){const Ve=$l(ce,!0);if(!x.filter(new Hi(this.tileID.overscaledZ),Ve,this.tileID.canonical))continue}else if(!x.filter(new Hi(this.tileID.overscaledZ),ce))continue;const ve=s.getId(ce,p),Ae=new Vc(ce,E,M,F,ve);Ae.tile=U,e.push(Ae)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const s=Ii(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let u=!1;if(this.expirationTime>s)u=!1;else if(i)if(this.expirationTime<i)u=!0;else{const p=this.expirationTime-i;p?this.expirationTime=s+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!i)return;const s=this.latestFeatureIndex.loadVTLayers(),u=i.style.listImages();for(const p in this.buckets){if(!i.style.hasLayer(p))continue;const _=this.buckets[p],x=_.layers[0].sourceLayer||"_geojsonTileLayer",E=s[x],M=e[x];if(!E||!M||0===Object.keys(M).length)continue;if(_.update(M,E,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof uu||_ instanceof Od){const U=i.style._getSourceCache(_.layers[0].source);i._terrain&&i._terrain.enabled&&U&&_.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(U.id,this.tileID)}const F=i&&i.style&&i.style.getLayer(p);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Oi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Oi.now()+e}setDependencies(e,i){const s={};for(const u of i)s[u]=!0;this.dependencies[e]=s}hasDependency(e,i){for(const s of e){const u=this.dependencies[s];if(u)for(const p of i)if(u[p])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const s=Vl($g,this.tileID.canonical,this.tileTransform)[0],u=new Kc,p=new md;for(let _=0;_<s.length;_++){const{x,y:E}=s[_];u.emplaceBack(x,E),p.emplaceBack(_)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(u,gm.members),this._tileDebugSegments=qo.simpleSegment(0,0,u.length,p.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const s=Vl($g,this.tileID.canonical,this.tileTransform)[0];let u,p;if(this.isRaster){const _=function(x,E){const M=xu(x,E),F=Math.pow(2,x.z);for(let Ve=0;Ve<33;Ve++)for(let Ke=0;Ke<33;Ke++){const dt=Zl((x.x+(Ke+Ba(Ke))/32)/F),bt=xa((x.y+(Ve+Ba(Ve))/32)/F),Mt=E.project(dt,bt),Ot=33*Ve+Ke;sl[2*Ot+0]=Math.round((Mt.x*M.scale-M.x)*er),sl[2*Ot+1]=Math.round((Mt.y*M.scale-M.y)*er)}Yl.fill(0),Pp.fill(0);for(let Ve=2045;Ve>=0;Ve--){const Ke=4*Ve,dt=mc[Ke+0],bt=mc[Ke+1],Mt=mc[Ke+2],Ot=mc[Ke+3],Nt=dt+Mt>>1,gn=bt+Ot>>1,hn=Nt+gn-bt,Zn=gn+dt-Nt,Ln=33*bt+dt,pn=33*Ot+Mt,kn=33*gn+Nt,$n=Math.hypot((sl[2*Ln+0]+sl[2*pn+0])/2-sl[2*kn+0],(sl[2*Ln+1]+sl[2*pn+1])/2-sl[2*kn+1])>=16;if(Yl[kn]=Yl[kn]||($n?1:0),Ve<1022){const vn=33*(bt+Zn>>1)+(dt+hn>>1),Qn=33*(Ot+Zn>>1)+(Mt+hn>>1);Yl[kn]=Yl[kn]||Yl[vn]||Yl[Qn]}}const U=new Nl,V=new oa;let ce=0;function ve(Ve,Ke){const dt=33*Ke+Ve;return 0===Pp[dt]&&(U.emplaceBack(sl[2*dt+0],sl[2*dt+1],Ve*er/32,Ke*er/32),Pp[dt]=++ce),Pp[dt]-1}function Ae(Ve,Ke,dt,bt,Mt,Ot){const Nt=Ve+dt>>1,gn=Ke+bt>>1;if(Math.abs(Ve-Mt)+Math.abs(Ke-Ot)>1&&Yl[33*gn+Nt])Ae(Mt,Ot,Ve,Ke,Nt,gn),Ae(dt,bt,Mt,Ot,Nt,gn);else{const hn=ve(Ve,Ke),Zn=ve(dt,bt),Ln=ve(Mt,Ot);V.emplaceBack(hn,Zn,Ln)}}return Ae(0,0,32,32,32,0),Ae(32,32,0,0,0,32),{vertices:U,indices:V}}(this.tileID.canonical,i);u=_.vertices,p=_.indices}else{u=new Nl,p=new oa;for(const{x,y:E}of s)u.emplaceBack(x,E,0,0);const _=Dd(u.int16,void 0,4);for(let x=0;x<_.length;x+=3)p.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,gm.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=qo.simpleSegment(0,0,u.length,p.length)}}const _m=bo([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),ym=bo([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:vm}=_m;function vu(t,e){const i=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),p=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),_=Math.sin(t._pitch)*p+u;return Math.min(1.01*_,u*(1/t._horizonShift))}const nh=er/Math.PI/2,Ns=-nh,aa=nh,Op=[new La([Ns,Ns,Ns],[aa,aa,aa]),new La([Ns,Ns,Ns],[0,0,aa]),new La([0,Ns,Ns],[aa,0,aa]),new La([Ns,0,Ns],[0,aa,aa]),new La([0,0,Ns],[aa,aa,aa])];function ih(t){if(t.z<=1)return Op[t.z+2*t.y+t.x];const[e,i]=xm(t),s=[rh(e[0],e[1]),rh(e[0],i[1]),rh(i[0],e[1]),rh(i[0],i[1])],u=[aa,aa,aa],p=[Ns,Ns,Ns];for(const _ of s)u[0]=Math.min(u[0],_[0]),u[1]=Math.min(u[1],_[1]),u[2]=Math.min(u[2],_[2]),p[0]=Math.max(p[0],_[0]),p[1]=Math.max(p[1],_[1]),p[2]=Math.max(p[2],_[2]);return new La(u,p)}function xm(t){const e=Math.pow(2,t.z),i=t.x/e,s=(t.x+1)/e,u=(t.y+1)/e;return[[xa(t.y/e),Zl(i)],[xa(u),Zl(s)]]}function Rp(t,e,i,s){return i=bn(i),s||(s=nh),[t*Math.sin(i)*s,-e*s,t*Math.cos(i)*s]}function rh(t,e,i){return Rp(Math.cos(bn(t)),Math.sin(bn(t)),e,i)}function bm(t){return 16383/Math.max(...Yt([],t.max,t.min))}function wm(t){const e=ye(new Float64Array(16)),i=1/bm(t);return Ee(e,e,t.min),We(e,e,[i,i,i]),e}function id(t,e,i){const s=e/(2*Math.PI),u=function(_){const x=er/(2*Math.PI);return _/(2*Math.PI)/x}(e);if(!i){const _=_i(t.center.lat,-85.051129,el);i=[xl(t.center.lng)*e,ac(_)*e]}const p=ye(new Float64Array(16));return Ee(p,p,[i[0],i[1],-s]),We(p,p,[u,u,u]),be(p,p,bn(-t._center.lat)),Se(p,p,bn(-t._center.lng)),p}class gc{constructor(e){const i=this._createGridIndices();this.gridIndexBuffer=e.createIndexBuffer(i,!0),this.gridSegments=qo.simpleSegment(0,0,4225,8192);const s=this._createPoleTriangleIndices();this.poleIndexBuffer=e.createIndexBuffer(s,!0),this.poleSegments=qo.simpleSegment(0,0,66,64);const u=new Lu;u.emplaceBack(-1,1,1,0,0,0,0),u.emplaceBack(1,1,1,0,0,1,0),u.emplaceBack(1,-1,1,0,0,1,1),u.emplaceBack(-1,-1,1,0,0,0,1);const p=new oa;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.atmosphereVertexBuffer=e.createVertexBuffer(u,ym.members),this.atmosphereIndexBuffer=e.createIndexBuffer(p),this.atmosphereSegments=qo.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(e,i,s){const u=new Lu,p=i/Math.PI/2;u.emplaceBack(0,-p,0,0,0,.5,s?0:1);const _=360/e,x=Math.cos(bn(85)),E=Math.sin(bn(85));for(let F=0;F<=64;F++){const U=F/64,V=Rp(x,E,0*(1-(M=U))+_*M,p);u.emplaceBack(V[0],V[1],V[2],0,0,U,s?0:1)}var M;return u}_createPoleTriangleIndices(){const e=new oa;for(let i=0;i<=64;i++)e.emplaceBack(0,i+1,i+2);return e}static createGridVertices(e){const i=Math.pow(2,e.z),s=(E,M,F)=>E*(1-F)+M*F,[u,p]=xm(e),_=new Lu,x=function(E){const M=ye(new Float64Array(16)),F=bm(E);var U,V;return We(M,M,[F,F,F]),Ee(M,M,((U=[])[0]=-(V=E.min)[0],U[1]=-V[1],U[2]=-V[2],U)),M}(ih(e));_.reserve(4096);for(let E=0;E<65;E++){const M=s(u[0],p[0],E/64),F=ac(M),U=F*i-e.y,V=Math.sin(bn(M)),ce=Math.cos(bn(M));for(let ve=0;ve<65;ve++){const Ae=ve/64,Ve=s(u[1],p[1],Ae),Ke=Rp(ce,V,Ve);It(Ke,Ke,x);const dt=xl(Ve);_.emplaceBack(Ke[0],Ke[1],Ke[2],dt,F,Ae,U)}}return _}_createGridIndices(){const e=new oa,i=(s,u)=>{const p=65*u+s;e.emplaceBack(p+1,p,p+65),e.emplaceBack(p+65,p+65+1,p+1)};for(let s=0;s<64;s++)for(let u=0;u<64;u++)i(u,s);return e}getWirefameBuffer(e){if(!this.wireframeSegments){const i=this._createWireframeGrid();this.wireframeIndexBuffer=e.createIndexBuffer(i),this.wireframeSegments=qo.simpleSegment(0,0,4096,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const e=new Ra,i=(s,u)=>{const p=65*u+s;e.emplaceBack(p,p+1),e.emplaceBack(p,p+65),e.emplaceBack(p,p+65+1)};for(let s=0;s<64;s++)for(let u=0;u<64;u++)i(u,s);return e}}function xu(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),s=t.x*i,u=(t.x+1)*i,p=t.y*i,_=(t.y+1)*i,x=Zl(s),E=Zl(u),M=xa(p),F=xa(_),U=e.project(x,M),V=e.project(E,M),ce=e.project(E,F),ve=e.project(x,F);let Ae=Math.min(U.x,V.x,ce.x,ve.x),Ve=Math.min(U.y,V.y,ce.y,ve.y),Ke=Math.max(U.x,V.x,ce.x,ve.x),dt=Math.max(U.y,V.y,ce.y,ve.y);const bt=i/16;function Mt(Nt,gn,hn,Zn,Ln,pn){const kn=(hn+Ln)/2,$n=(Zn+pn)/2,vn=e.project(Zl(kn),xa($n)),Qn=Math.max(0,Ae-vn.x,Ve-vn.y,vn.x-Ke,vn.y-dt);Ae=Math.min(Ae,vn.x),Ke=Math.max(Ke,vn.x),Ve=Math.min(Ve,vn.y),dt=Math.max(dt,vn.y),Qn>bt&&(Mt(Nt,vn,hn,Zn,kn,$n),Mt(vn,gn,kn,$n,Ln,pn))}Mt(U,V,s,p,u,p),Mt(V,ce,u,p,u,_),Mt(ce,ve,u,_,s,_),Mt(ve,U,s,_,s,p),Ae-=bt,Ve-=bt,Ke+=bt,dt+=bt;const Ot=1/Math.max(Ke-Ae,dt-Ve);return{scale:Ot,x:Ae*Ot,y:Ve*Ot,x2:Ke*Ot,y2:dt*Ot,projection:e}}class bu{constructor(e){const i={},s=[];for(const x in e){const E=e[x],M=i[x]={};for(const F in E.glyphs){const U=E.glyphs[+F];if(!U||0===U.bitmap.width||0===U.bitmap.height)continue;const V=U.metrics.localGlyph?2:1,ce={x:0,y:0,w:U.bitmap.width+2*V,h:U.bitmap.height+2*V};s.push(ce),M[F]=ce}}const{w:u,h:p}=ap(s),_=new Tl({width:u||1,height:p||1});for(const x in e){const E=e[x];for(const M in E.glyphs){const F=E.glyphs[+M];if(!F||0===F.bitmap.width||0===F.bitmap.height)continue;const U=i[x][M],V=F.metrics.localGlyph?2:1;Tl.copy(F.bitmap,_,{x:0,y:0},{x:U.x+V,y:U.y+V},F.bitmap)}}this.image=_,this.positions=i}}Kn("GlyphAtlas",bu);class jg{constructor(e){this.tileID=new Bs(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=xu(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,s,u,p){this.status="parsing",this.data=e,this.collisionBoxArray=new sf;const _=new um(Object.keys(e.layers).sort()),x=new Sp(this.tileID,this.promoteId);x.bucketLayerIDs=[];const E={},M=new ed(256,256),F={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:M,availableImages:s},U=i.familiesBySource[this.source];for(const Ot in U){const Nt=e.layers[Ot];if(!Nt)continue;let gn=!1,hn=!1;for(const pn of U[Ot])"symbol"===pn[0].type?gn=!0:hn=!0;if(!0===this.isSymbolTile&&!gn||!1===this.isSymbolTile&&!hn)continue;1===Nt.version&&Di(`Vector tile source "${this.source}" layer "${Ot}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Zn=_.encode(Ot),Ln=[];for(let pn=0;pn<Nt.length;pn++){const kn=Nt.feature(pn),$n=x.getId(kn,Ot);Ln.push({feature:kn,id:$n,index:pn,sourceLayerIndex:Zn})}for(const pn of U[Ot]){const kn=pn[0];void 0!==this.isSymbolTile&&"symbol"===kn.type!==this.isSymbolTile||kn.minzoom&&this.zoom<Math.floor(kn.minzoom)||kn.maxzoom&&this.zoom>=kn.maxzoom||"none"!==kn.visibility&&(Lp(pn,this.zoom,s),(E[kn.id]=kn.createBucket({index:x.bucketLayerIDs.length,layers:pn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Zn,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:s})).populate(Ln,F,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(pn.map($n=>$n.id)))}}let V,ce,ve,Ae;M.trim();const Ve={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ke=Ft(F.glyphDependencies,Ot=>Object.keys(Ot).map(Number));Object.keys(Ke).length?u.send("getGlyphs",{uid:this.uid,stacks:Ke},(Ot,Nt)=>{V||(V=Ot,ce=Nt,Mt.call(this))},void 0,!1,Ve):ce={};const dt=Object.keys(F.iconDependencies);dt.length?u.send("getImages",{icons:dt,source:this.source,tileID:this.tileID,type:"icons"},(Ot,Nt)=>{V||(V=Ot,ve=Nt,Mt.call(this))},void 0,!1,Ve):ve={};const bt=Object.keys(F.patternDependencies);function Mt(){if(V)return p(V);if(ce&&ve&&Ae){const Ot=new bu(ce),Nt=new Hf(ve,Ae);for(const gn in E){const hn=E[gn];hn instanceof Dl?(Lp(hn.layers,this.zoom,s),El(hn,ce,Ot.positions,ve,Nt.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection),hn.projection=this.projection.name):hn.hasPattern&&(hn instanceof uu||hn instanceof Od||hn instanceof Yh)&&(Lp(hn.layers,this.zoom,s),hn.addFeatures(F,this.tileID.canonical,Nt.patternPositions,s))}this.status="done",p(null,{buckets:Xt(E).filter(gn=>!gn.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ot.image,lineAtlas:M,imageAtlas:Nt,glyphMap:this.returnDependencies?ce:null,iconMap:this.returnDependencies?ve:null,glyphPositions:this.returnDependencies?Ot.positions:null})}}bt.length?u.send("getImages",{icons:bt,source:this.source,tileID:this.tileID,type:"patterns"},(Ot,Nt)=>{V||(V=Ot,Ae=Nt,Mt.call(this))},void 0,!1,Ve):Ae={},Mt.call(this)}}function Lp(t,e,i){const s=new Hi(e);for(const u of t)u.recalculate(s,i)}class oh{constructor(e){this.entries={},this.scheduler=e}request(e,i,s,u){const p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){const[_,x]=p.result;return this.scheduler?this.scheduler.add(()=>{u(_,x)},i):u(_,x),()=>{}}return p.callbacks.push(u),p.cancel||(p.cancel=s((_,x)=>{p.result=[_,x];for(const E of p.callbacks)this.scheduler?this.scheduler.add(()=>{E(_,x)},i):E(_,x);setTimeout(()=>delete this.entries[e],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(_=>_!==u),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function al(t,e,i){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{const p=Cr(t.request,(_,x,E,M)=>{_?u(_):x&&u(null,{vectorTile:i?void 0:new zc.VectorTile(new Uc(x)),rawData:x,cacheControl:E,expires:M})});return()=>{p.cancel(),u()}},e)}const rd=ye(new Float64Array(16));class Ho{constructor(e,i){this._tr=e,this._worldSize=i}createInversionMatrix(){return rd}createTileMatrix(e){let i,s,u;const p=e.canonical,_=ye(new Float64Array(16)),x=this._tr.projection;if(x.isReprojectedInTileSpace){const E=xu(p,x);i=1,s=E.x+e.wrap*E.scale,u=E.y,We(_,_,[i/E.scale,i/E.scale,this._tr.pixelsPerMeter/this._worldSize])}else i=this._worldSize/this._tr.zoomScale(p.z),s=(p.x+Math.pow(2,p.z)*e.wrap)*i,u=p.y*i;return Ee(_,_,[s,u,0]),We(_,_,[i/er,i/er,1]),_}pointCoordinate(e,i,s){const u=this._tr.horizonLineFromTop(!1),p=new ne(e,Math.max(u,i));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(p,s))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var jc={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&mt(this.parallels,this.constants.parallels))return;const t=Math.sin(bn(this.parallels[0])),e=(t+Math.sin(bn(this.parallels[1])))/2,i=1+t*(2*e-t),s=Math.sqrt(i)/e;this.constants={n:e,c:i,r0:s,parallels:this.parallels}},project(t,e){this.initializeConstants();const i=bn(t-this.center[0]),s=bn(e),{n:u,c:p,r0:_}=this.constants,x=Math.sqrt(p-2*u*Math.sin(s))/u;return{x:x*Math.sin(i*u),y:x*Math.cos(i*u)-_,z:0}},unproject(t,e){this.initializeConstants();const{n:i,c:s,r0:u}=this.constants,p=u+e;let _=Math.atan2(t,Math.abs(p))*Math.sign(p);p*i<0&&(_-=Math.PI*Math.sign(t)*Math.sign(p));const x=bn(this.center[0])*i;_=gi(_,-Math.PI-x,Math.PI-x);const E=jn(_/i)+this.center[0],M=Math.asin(_i((s-(t*t+p*p)*i*i)/(2*i),-1,1)),F=_i(jn(M),-85.051129,el);return new Xr(E,F)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Qa(1,t)*e,farthestPixelDistance(t){return vu(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ho(t,e)};const _c=1.340264,zs=-.081106,Gc=893e-6,Ml=.003796,Jl=Math.sqrt(3)/2;var wu={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const i=Math.asin(Jl*Math.sin(e)),s=i*i,u=s*s*s;return{x:.5*(t*Math.cos(i)/(Jl*(_c+3*zs*s+u*(7*Gc+9*Ml*s)))/Math.PI+.5),y:1-.5*(i*(_c+zs*s+u*(Gc+Ml*s))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,s=i*i,u=s*s*s;for(let M,F,U,V=0;V<12&&(F=i*(_c+zs*s+u*(Gc+Ml*s))-e,U=_c+3*zs*s+u*(7*Gc+9*Ml*s),M=F/U,i=_i(i-M,-Math.PI/3,Math.PI/3),s=i*i,u=s*s*s,!(Math.abs(M)<1e-12));++V);const p=Jl*t*(_c+3*zs*s+u*(7*Gc+9*Ml*s))/Math.cos(i),_=Math.asin(Math.sin(i)/Jl),x=_i(180*p/Math.PI,-180,180),E=_i(180*_/Math.PI,-85.051129,el);return new Xr(x,E)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Qa(1,t)*e,farthestPixelDistance(t){return vu(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ho(t,e)},Tu={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(t,e)=>({x:.5+t/360,y:.5-e/360,z:0}),unproject(t,e){const i=360*(t-.5),s=_i(360*(.5-e),-85.051129,el);return new Xr(i,s)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Qa(1,t)*e,farthestPixelDistance(t){return vu(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ho(t,e)};const ll=Math.PI/2;function Xl(t){return Math.tan((ll+t)/2)}var Cu={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&mt(this.parallels,this.constants.parallels))return;const t=bn(this.parallels[0]),e=bn(this.parallels[1]),i=Math.cos(t),s=t===e?Math.sin(t):Math.log(i/Math.cos(e))/Math.log(Xl(e)/Xl(t)),u=i*Math.pow(Xl(t),s)/s;this.constants={n:s,f:u,parallels:this.parallels}},project(t,e){this.initializeConstants(),e=bn(e),t=bn(t-this.center[0]);const i=1e-6,{n:s,f:u}=this.constants;u>0?e<-ll+i&&(e=-ll+i):e>ll-i&&(e=ll-i);const p=u/Math.pow(Xl(e),s),_=p*Math.sin(s*t),x=u-p*Math.cos(s*t);return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+.5),z:0}},unproject(t,e){this.initializeConstants(),t=(2*t-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:i,f:s}=this.constants,u=s-e,p=Math.sign(u),_=Math.sign(i)*Math.sqrt(t*t+u*u);let x=Math.atan2(t,Math.abs(u))*p;u*i<0&&(x-=Math.PI*Math.sign(t)*p);const E=_i(jn(x/i)+this.center[0],-180,180),M=_i(jn(2*Math.atan(Math.pow(s/_,1/i))-ll),-85.051129,el);return new Xr(E,M)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Qa(1,t)*e,farthestPixelDistance(t){return vu(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ho(t,e)},Eu={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(t,e)=>({x:xl(t),y:ac(e),z:0}),unproject(t,e){const i=Zl(t),s=xa(e);return new Xr(i,s)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Qa(1,t)*e,farthestPixelDistance(t){return vu(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ho(t,e)};const qc=bn(el);var Tm={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(t,e){const i=(e=bn(e))*e,s=i*i;return{x:.5*((t=bn(t))*(.8707-.131979*i+s*(s*(.003971*i-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+i*(.015085+s*(.028874*i-.044475-.005916*s)))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,s=25,u=0,p=i*i;do{p=i*i;const E=p*p;u=(i*(1.007226+p*(.015085+E*(.028874*p-.044475-.005916*E)))-e)/(1.007226+p*(.045255+E*(.259866*p-.311325-.005916*11*E))),i=_i(i-u,-qc,qc)}while(Math.abs(u)>1e-6&&--s>0);p=i*i;const _=_i(jn(t/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),x=jn(i);return new Xr(_,x)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Qa(1,t)*e,farthestPixelDistance(t){return vu(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ho(t,e)};const kp=bn(el),Fp={albers:jc,equalEarth:wu,equirectangular:Tu,lambertConformalConic:Cu,mercator:Eu,naturalEarth:Tm,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=bn(e),t=bn(t);const i=Math.cos(e),s=2/Math.PI,u=Math.acos(i*Math.cos(t/2)),p=Math.sin(u)/u,_=.5*(t*s+2*i*Math.sin(t/2)/p)||0,x=.5*(e+Math.sin(e)/p)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}},unproject(t,e){let i=t=(2*t-.5)*Math.PI,s=e=(2*(1-e)-1)*Math.PI,u=25;const p=1e-6;let _=0,x=0;do{const E=Math.cos(s),M=Math.sin(s),F=2*M*E,U=M*M,V=E*E,ce=Math.cos(i/2),ve=Math.sin(i/2),Ae=2*ce*ve,Ve=ve*ve,Ke=1-V*ce*ce,dt=Ke?1/Ke:0,bt=Ke?Math.acos(E*ce)*Math.sqrt(1/Ke):0,Mt=.5*(2*bt*E*ve+2*i/Math.PI)-t,Ot=.5*(bt*M+s)-e,Nt=.5*dt*(V*Ve+bt*E*ce*U)+1/Math.PI,gn=dt*(Ae*F/4-bt*M*ve),hn=.125*dt*(F*ve-bt*M*V*Ae),Zn=.5*dt*(U*ce+bt*Ve*E)+.5,Ln=gn*hn-Zn*Nt;_=(Ot*gn-Mt*Zn)/Ln,x=(Mt*hn-Ot*Nt)/Ln,i=_i(i-_,-Math.PI,Math.PI),s=_i(s-x,-kp,kp)}while((Math.abs(_)>p||Math.abs(x)>p)&&--u>0);return new Xr(jn(i),jn(s))},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Qa(1,t)*e,farthestPixelDistance(t){return vu(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ho(t,e)}};l.ARRAY_TYPE=se,l.AUTH_ERR_MSG=Lt,l.Aabb=La,l.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},me(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=xr()?t:Q,this.scheduler=new zg}send(t,e,i,s,u=!1,p){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=p,this.callbacks[_]=i);const x=Tr(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:t,hasCallback:!!i,targetMapId:s,mustQueue:u,sourceMapId:this.mapId,data:Ya(e,x)},x),{cancel:()=>{i&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[i];delete this.cancelCallbacks[i],s&&s.cancel()}else if(e.mustQueue||xr()){const s=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),s&&s.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if("<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(Bl(e.error)):i(null,Bl(e.data)))}else{const i=Tr(this.globalScope)?void 0:[],s=e.hasCallback?(p,_)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:p?Ya(p):null,data:Ya(_,i)},i)}:p=>{},u=Bl(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,s);else if(this.parent.getWorkerSource){const p=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,p[0],u.source)[p[1]](u,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.CanonicalTileID=td,l.Color=zi,l.ColorMode=il,l.CullFaceMode=rl,l.DEMData=eh,l.DataConstantProperty=si,l.DedupedRequest=oh,l.DepthMode=pc,l.EXTENT=er,l.Elevation=class{getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){null==e&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const u=s.getSource().maxzoom,p=1<<u,_=Math.floor(t.x),x=t.x-_,E=new Bs(u,_,u,Math.floor(x*p),Math.floor(t.y*p)),M=this.findDEMTileFor(E);if(!M||!M.dem)return e;const F=M.dem,U=1<<M.tileID.canonical.z,V=(x*U-M.tileID.canonical.x)*F.dim,ce=(t.y*U-M.tileID.canonical.y)*F.dim,ve=Math.floor(V),Ae=Math.floor(ce);return(i?this.exaggeration():1)*yr(yr(F.get(ve,Ae),F.get(ve,Ae+1),ce-Ae),yr(F.get(ve+1,Ae),F.get(ve+1,Ae+1),ce-Ae),V-ve)}getAtTileOffset(t,e,i){const s=1<<t.canonical.z;return this.getAtPointOrZero(new yd(t.wrap+(t.canonical.x+e/er)/s,(t.canonical.y+i/er)/s))}getAtTileOffsetFunc(t,e){return i=>{const s=this.getAtTileOffset(t,i.x,i.y),u=e.upVector(t.canonical,i.x,i.y);return xt(u,u,s*e.upVectorScale(t.canonical)),u}}getForTilePoints(t,e,i,s){const u=Ap.create(this,t,s);return!!u&&(e.forEach(p=>{p[2]=this.exaggeration()*u.getElevationAt(p[0],p[1],i)}),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,u=1<<t.canonical.z-s.canonical.z;let p=t.canonical.x/u-s.canonical.x,_=t.canonical.y/u-s.canonical.y,x=0;for(let E=0;E<t.canonical.z-s.canonical.z&&!i.leaves[x];E++){p*=2,_*=2;const M=2*Math.floor(_)+Math.floor(p);x=i.childOffsets[x]+M,p%=1,_%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},l.ErrorEvent=Cn,l.EvaluationParameters=Hi,l.Event=un,l.Evented=Un,l.Frustum=wf,l.GLOBE_ZOOM_THRESHOLD_MAX=6,l.GlobeSharedBuffers=gc,l.GlyphManager=Ju,l.ImagePosition=zd,l.LineAtlas=ed,l.LngLat=Xr,l.LngLatBounds=ts,l.LocalGlyphMode=Vd,l.MAX_MERCATOR_LATITUDE=el,l.MercatorCoordinate=yd,l.ONE_EM=24,l.OverscaledTileID=Bs,l.Properties=ds,l.RGBAImage=Ws,l.Ray=class{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,i){const s=Ht(e,this.dir);if(Math.abs(s)<1e-6)return!1;const u=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/s;return i[0]=this.pos[0]+this.dir[0]*u,i[1]=this.pos[1]+this.dir[1]*u,i[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(t,e,i){if(ve=(V=this.pos)[0],Ae=V[1],Ve=V[2],Ke=(ce=t)[0],dt=ce[1],bt=ce[2],Math.abs(ve-Ke)<=Y*Math.max(1,Math.abs(ve),Math.abs(Ke))&&Math.abs(Ae-dt)<=Y*Math.max(1,Math.abs(Ae),Math.abs(dt))&&Math.abs(Ve-bt)<=Y*Math.max(1,Math.abs(Ve),Math.abs(bt))||0===e)return i[0]=i[1]=i[2]=0,!1;var V,ce,ve,Ae,Ve,Ke,dt,bt;const[s,u,p]=this.dir,_=this.pos[0]-t[0],x=this.pos[1]-t[1],E=this.pos[2]-t[2],M=s*s+u*u+p*p,F=2*(_*s+x*u+E*p),U=F*F-4*M*(_*_+x*x+E*E-e*e);if(U<0){const V=Math.max(-F/2,0),ce=_+s*V,ve=x+u*V,Ae=E+p*V,Ve=Math.hypot(ce,ve,Ae);return i[0]=ce*e/Ve,i[1]=ve*e/Ve,i[2]=Ae*e/Ve,!1}{const V=(-F-Math.sqrt(U))/(2*M);if(V<0){const ce=Math.hypot(_,x,E);return i[0]=_*e/ce,i[1]=x*e/ce,i[2]=E*e/ce,!1}return i[0]=_+s*V,i[1]=x+u*V,i[2]=E+p*V,!0}}},l.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Je,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!en(t))return t;const i=Pn(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!en(t))return t;const i=Pn(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!en(t))return t;const i=Pn(t);return i.path=`/v4/${i.authority}.json`,i.params.push("secure"),this._makeAPIURL(i,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,s){const u=Pn(t);return en(t)?(u.path=`/styles/v1${u.path}/sprite${e}${i}`,this._makeAPIURL(u,this._customAccessToken||s)):(u.path+=`${e}${i}`,Vn(u))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!en(t))return t;const s=Pn(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==s.authority&&512===i?"@2x":""}${L.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${q.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${q.TILE_URL_VERSION}${s.path}`);const u=this._customAccessToken||function(p){for(const _ of p){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(s.params)||q.ACCESS_TOKEN;return q.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,u)}canonicalizeTileURL(t,e){const i=Pn(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let s="mapbox://";i.path.match(/^\/raster\/v1\//)?s+=`raster/${i.path.replace(`/${q.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${i.path.replace(`/${q.TILE_URL_VERSION}/`,"")}`;let u=i.params;return e&&(u=u.filter(p=>!p.match(/^access_token=/))),u.length&&(s+=`?${u.join("&")}`),s}canonicalizeTileset(t,e){const i=!!e&&en(e),s=[];for(const u of t.tiles||[])Gt(u)?s.push(this.canonicalizeTileURL(u,i)):s.push(u);return s}_makeAPIURL(t,e){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",s=Pn(q.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,"http"===t.protocol){const u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if("/"!==s.path&&(t.path=`${s.path}${t.path}`),!q.REQUIRE_ACCESS_TOKEN)return Vn(t);if(e=e||q.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(u=>-1===u.indexOf("access_token")),t.params.push(`access_token=${e||""}`),Vn(t)}},l.ResourceType=io,l.SegmentVector=qo,l.SourceCache=$c,l.StencilMode=Cp,l.StructArrayLayout1ui2=md,l.StructArrayLayout2f1f2i16=hd,l.StructArrayLayout2i4=Kc,l.StructArrayLayout2ui4=Ra,l.StructArrayLayout3f12=Ja,l.StructArrayLayout3ui6=oa,l.StructArrayLayout4i8=Nl,l.Texture=bp,l.Tile=th,l.Transitionable=Fs,l.Uniform1f=Dh,l.Uniform1i=class extends Xa{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},l.Uniform2f=class extends Xa{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},l.Uniform3f=class extends Xa{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},l.Uniform4f=Ym,l.UniformColor=Ih,l.UniformMatrix2f=class extends Xa{constructor(t,e){super(t,e),this.current=Km}set(t){for(let e=0;e<4;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},l.UniformMatrix3f=class extends Xa{constructor(t,e){super(t,e),this.current=Xm}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},l.UniformMatrix4f=class extends Xa{constructor(t,e){super(t,e),this.current=Jm}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},l.UnwrappedTileID=Xd,l.ValidationError=on,l.VectorTileWorkerSource=class extends Un{constructor(t,e,i,s,u){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=u||al,this.loading={},this.loaded={},this.deduped=new oh(t.scheduler),this.isSpriteLoaded=s,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,s=t&&t.request,u=s&&s.collectResourceTiming,p=this.loading[i]=new jg(t);p.abort=this.loadVectorData(t,(_,x)=>{const E=!this.loading[i];if(delete this.loading[i],E||_||!x)return p.status="done",E||(this.loaded[i]=p),e(_);const M=x.rawData,F={};x.expires&&(F.expires=x.expires),x.cacheControl&&(F.cacheControl=x.cacheControl),p.vectorTile=x.vectorTile||new zc.VectorTile(new Uc(M));const U=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(V,ce)=>{if(V||!ce)return e(V);const ve={};if(u){const Ae=yu(s);Ae.length>0&&(ve.resourceTiming=JSON.parse(JSON.stringify(Ae)))}e(null,Oe({rawTileData:M.slice(0)},ce,F,ve))})};this.isSpriteLoaded?U():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(U,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):U()}),this.loaded=this.loaded||{},this.loaded[i]=p})}reloadTile(t,e){const i=this.loaded,s=t.uid,u=this;if(i&&i[s]){const p=i[s];p.showCollisionBoxes=t.showCollisionBoxes,p.enableTerrain=!!t.enableTerrain,p.projection=t.projection;const _=(x,E)=>{const M=p.reloadCallback;M&&(delete p.reloadCallback,p.parse(p.vectorTile,u.layerIndex,this.availableImages,u.actor,M)),e(x,E)};"parsing"===p.status?p.reloadCallback=_:"done"===p.status&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(t,e){const i=t.uid,s=this.loading[i];s&&(s.abort&&s.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,s=t.uid;i&&i[s]&&delete i[s],e()}},l.WritingMode=ba,l.ZoomHistory=f,l.add=Ge,l.addDynamicAttributes=gu,l.adjoint=function(t,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=e[4],x=e[5],E=e[6],M=e[7],F=e[8];return t[0]=_*F-x*M,t[1]=u*M-s*F,t[2]=s*x-u*_,t[3]=x*E-p*F,t[4]=i*F-u*E,t[5]=u*p-i*x,t[6]=p*M-_*E,t[7]=s*E-i*M,t[8]=i*_-s*p,t},l.asyncAll=Ti,l.bezier=rr,l.bindAll=me,l.boundsAttributes=gm,l.bufferConvexPolygon=function(t,e){const i=[];for(let s=0;s<t.length;s++){const u=gi(s-1,-1,t.length-1),p=gi(s+1,-1,t.length-1),_=t[s],x=t[p],E=t[u].sub(_).unit(),M=x.sub(_).unit(),F=M.angleWithSep(E.x,E.y),U=E.add(M).unit().mult(-1*e/Math.sin(F/2));i.push(_.add(U))}return i},l.cacheEntryPossiblyAdded=function(t){xi++,xi>or&&(t.getActor().send("enforceCacheSizeLimit",fr),xi=0)},l.calculateGlobeMatrix=id,l.calculateGlobeMercatorMatrix=function(t){const e=t.worldSize,i=_i(t.center.lat,-85.051129,el),s=new ne(xl(t.center.lng)*e,ac(i)*e),u=Qa(1,t.center.lat)*e,p=t.pixelsPerMeter,_=e/(u/t.pixelsPerMeter),x=ye(new Float64Array(16));return Ee(x,x,[s.x,s.y,0]),We(x,x,[_,_,p]),x},l.clamp=_i,l.clearTileCache=function(t){const e=Q.caches.delete(Ni);t&&e.catch(t).then(()=>t())},l.clipLine=Xf,l.clone=function(t){var e=new se(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},l.clone$1=Jn,l.collisionCircleLayout=tp,l.config=q,l.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},l.create=function(){var t=new se(16);return se!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},l.create$1=ue,l.createExpression=Va,l.createLayout=bo,l.createStyleLayer=function(t){return"custom"===t.type?new om(t):new am[t.type](t)},l.cross=Gn,l.degToRad=bn,l.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},l.dot=Ht,l.ease=Bi,l.easeCubicInOut=$i,l.emitValidationErrors=Br,l.endsWith=He,l.enforceCacheSizeLimit=function(t){Sr(),pr&&pr.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-t;s++)e.delete(i[s])})})},l.evaluateSizeForFeature=Nd,l.evaluateSizeForZoom=du,l.evaluateVariableOffset=nm,l.evented=bs,l.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},l.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},l.exported=Oi,l.exported$1=L,l.extend=Oe,l.extend$1=Ur,l.filterObject=Qt,l.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},l.fromQuat=function(t,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=i+i,x=s+s,E=u+u,M=i*_,F=s*_,U=s*x,V=u*_,ce=u*x,ve=u*E,Ae=p*_,Ve=p*x,Ke=p*E;return t[0]=1-U-ve,t[1]=F+Ke,t[2]=V-Ve,t[3]=0,t[4]=F-Ke,t[5]=1-M-ve,t[6]=ce+Ae,t[7]=0,t[8]=V+Ve,t[9]=ce-Ae,t[10]=1-M-U,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.fromRotation=function(t,e){var i=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=i,t[2]=0,t[3]=-i,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},l.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return li[e]},l.getAABBPointSquareDist=function(t,e,i){let s=0;for(let u=0;u<2;++u){const p=i?i[u]:0;t[u]>p&&(s+=(t[u]-p)*(t[u]-p)),e[u]<p&&(s+=(p-e[u])*(p-e[u]))}return s},l.getAnchorAlignment=Zd,l.getAnchorJustification=Xu,l.getBounds=function(t){let e=1/0,i=1/0,s=-1/0,u=-1/0;for(const p of t)e=Math.min(e,p.x),i=Math.min(i,p.y),s=Math.max(s,p.x),u=Math.max(u,p.y);return{min:new ne(e,i),max:new ne(s,u)}},l.getColumn=function(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]},l.getImage=Pt,l.getJSON=function(t,e){return Pr(Oe(t,{type:"json"}),e)},l.getMapSessionAPI=ti,l.getPerformanceMeasurement=yu,l.getProjection=function(t){const e=Fp[t.name];if(!e)throw new Error(`Invalid projection name: ${t.name}`);return e.conic?function(i,s){if(s.parallels&&Math.abs(s.parallels[0]+s.parallels[1])<.01){let u=function(p){const _=Math.max(.01,Math.cos(bn(p))),x=1/(2*Math.max(Math.PI*_,1/_));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(E,M){const F=bn(E)*_,U=Math.sin(bn(M))/_;return{x:F*x+.5,y:-U*x+.5,z:0}},unproject(E,M){const F=-(M-.5)/x,U=_i(jn((E-.5)/x)/_,-180,180),V=Math.asin(_i(F*_,-1,1)),ce=_i(jn(V),-85.051129,el);return new Xr(U,ce)}}}(s.parallels[0]);if("lambertConformalConic"===s.name){const{project:p,unproject:_}=Fp.mercator;u={wrap:!0,supportsWorldCopies:!0,project:p,unproject:_}}return Oe({},i,s,u)}return Oe({},i,s)}(e,t):e},l.getRTLTextPluginStatus=ws,l.getReferrer=jr,l.getTilePoint=function(t,{x:e,y:i},s=0){return new ne(((e-s)*t.scale-t.x)*er,(i*t.scale-t.y)*er)},l.getTileVec3=function(t,e,i=0){return C(((e.x-i)*t.scale-t.x)*er,(e.y*t.scale-t.y)*er,mf(e.z,e.y))},l.getVideo=function(t,e){const i=Q.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<t.length;s++){const u=Q.document.createElement("source");_e(t[s])||(i.crossOrigin="Anonymous"),u.src=t[s],i.appendChild(u)}return{cancel:()=>{}}},l.globeBuffersForTileMesh=function(t,e,i,s){const u=t.context,p=t.transform;let _=e.globeGridBuffer,x=e.globePoleBuffer;if(!_){const E=gc.createGridVertices(i.canonical);_=e.globeGridBuffer=u.createVertexBuffer(E,vm,!1)}if(!x){const E=gc.createPoleTriangleVertices(s,p.tileSize*s,0===i.canonical.y);x=e.globePoleBuffer=u.createVertexBuffer(E,vm,!1)}return[_,x]},l.globeDenormalizeECEF=wm,l.globeMatrixForTile=function(t,e){const i=wm(ih(t)),s=((u=new Float64Array(16))[0]=(p=e)[0],u[1]=p[1],u[2]=p[2],u[3]=p[3],u[4]=p[4],u[5]=p[5],u[6]=p[6],u[7]=p[7],u[8]=p[8],u[9]=p[9],u[10]=p[10],u[11]=p[11],u[12]=p[12],u[13]=p[13],u[14]=p[14],u[15]=p[15],u);var u,p;return ze(s,s,i),s},l.globePoleMatrixForTile=function(t,e,i){const s=ye(new Float64Array(16)),u=Math.pow(2,t.z),p=(t.x-u/2)/u*Math.PI*2,_=i.point,x=i.worldSize/(i.tileSize*u);return Ee(s,s,[_.x,_.y,-i.worldSize/Math.PI/2]),We(s,s,[x,x,x]),be(s,s,bn(-i._center.lat)),Se(s,s,bn(-i._center.lng)),Se(s,s,p),e&&We(s,s,[1,-1,1]),s},l.globeTileBounds=ih,l.globeToMercatorTransition=function(t){return tr(5,6,t)},l.identity=ye,l.identity$1=an,l.invert=function(t,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=e[4],x=e[5],E=e[6],M=e[7],F=e[8],U=e[9],V=e[10],ce=e[11],ve=e[12],Ae=e[13],Ve=e[14],Ke=e[15],dt=i*x-s*_,bt=i*E-u*_,Mt=i*M-p*_,Ot=s*E-u*x,Nt=s*M-p*x,gn=u*M-p*E,hn=F*Ae-U*ve,Zn=F*Ve-V*ve,Ln=F*Ke-ce*ve,pn=U*Ve-V*Ae,kn=U*Ke-ce*Ae,$n=V*Ke-ce*Ve,vn=dt*$n-bt*kn+Mt*pn+Ot*Ln-Nt*Zn+gn*hn;return vn?(t[0]=(x*$n-E*kn+M*pn)*(vn=1/vn),t[1]=(u*kn-s*$n-p*pn)*vn,t[2]=(Ae*gn-Ve*Nt+Ke*Ot)*vn,t[3]=(V*Nt-U*gn-ce*Ot)*vn,t[4]=(E*Ln-_*$n-M*Zn)*vn,t[5]=(i*$n-u*Ln+p*Zn)*vn,t[6]=(Ve*Mt-ve*gn-Ke*bt)*vn,t[7]=(F*gn-V*Mt+ce*bt)*vn,t[8]=(_*kn-x*Ln+M*hn)*vn,t[9]=(s*Ln-i*kn-p*hn)*vn,t[10]=(ve*Nt-Ae*Mt+Ke*dt)*vn,t[11]=(U*Mt-F*Nt-ce*dt)*vn,t[12]=(x*Zn-_*pn-E*hn)*vn,t[13]=(i*pn-s*Zn+u*hn)*vn,t[14]=(Ae*bt-ve*Ot-Ve*dt)*vn,t[15]=(F*Ot-U*bt+V*dt)*vn,t):null},l.isMapAuthenticated=function(t){return Yi.has(t)},l.isMapboxURL=en,l.latFromMercatorY=xa,l.len=Zt,l.length=Be,l.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},l.loadVectorTile=al,l.makeRequest=Pr,l.mercatorXfromLng=xl,l.mercatorYfromLat=ac,l.mercatorZfromAltitude=Qa,l.mul=ze,l.mul$1=zt,l.multiply=function(t,e,i){var s=e[0],u=e[1],p=e[2],_=e[3],x=e[4],E=e[5],M=e[6],F=e[7],U=e[8],V=i[0],ce=i[1],ve=i[2],Ae=i[3],Ve=i[4],Ke=i[5],dt=i[6],bt=i[7],Mt=i[8];return t[0]=V*s+ce*_+ve*M,t[1]=V*u+ce*x+ve*F,t[2]=V*p+ce*E+ve*U,t[3]=Ae*s+Ve*_+Ke*M,t[4]=Ae*u+Ve*x+Ke*F,t[5]=Ae*p+Ve*E+Ke*U,t[6]=dt*s+bt*_+Mt*M,t[7]=dt*u+bt*x+Mt*F,t[8]=dt*p+bt*E+Mt*U,t},l.multiply$1=xe,l.multiply$2=ht,l.nextPowerOfTwo=Le,l.normalize=Bt,l.normalize$1=function(t,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=i*i+s*s+u*u+p*p;return _>0&&(_=1/Math.sqrt(_)),t[0]=i*_,t[1]=s*_,t[2]=u*_,t[3]=p*_,t},l.number=yr,l.ortho=function(t,e,i,s,u,p,_){var x=1/(e-i),E=1/(s-u),M=1/(p-_);return t[0]=-2*x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*E,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*M,t[11]=0,t[12]=(e+i)*x,t[13]=(u+s)*E,t[14]=(_+p)*M,t[15]=1,t},l.pbf=Uc,l.perspective=function(t,e,i,s,u){var p,_=1/Math.tan(e/2);return t[0]=_/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=u&&u!==1/0?(t[10]=(u+s)*(p=1/(s-u)),t[14]=2*u*s*p):(t[10]=-1,t[14]=-2*s),t},l.pick=function(t,e){const i={};for(let s=0;s<e.length;s++){const u=e[s];u in t&&(i[u]=t[u])}return i},l.plugin=br,l.pointGeometry=ne,l.polygonIntersectsBox=vf,l.polygonIntersectsPolygon=iu,l.polygonizeBounds=function(t,e,i=0,s=!0){const u=new ne(i,i),p=t.sub(u),_=e.add(u),x=[p,new ne(_.x,p.y),_,new ne(p.x,_.y)];return s&&x.push(p),x},l.posAttributes=Q_,l.postMapLoadEvent=di,l.postTurnstileEvent=Li,l.potpack=ap,l.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},l.radToDeg=jn,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.registerForPluginStateChange=function(t){return t({pluginStatus:Zi,pluginURL:Pi}),bs.on("pluginStateChange",t),t},l.removeAuthState=function(t){Yi.delete(t)},l.renderColorRamp=Cf,l.rotateX=be,l.rotateX$1=Kt,l.rotateY=Se,l.rotateZ=function(t,e,i){var s=Math.sin(i),u=Math.cos(i),p=e[0],_=e[1],x=e[2],E=e[3],M=e[4],F=e[5],U=e[6],V=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=p*u+M*s,t[1]=_*u+F*s,t[2]=x*u+U*s,t[3]=E*u+V*s,t[4]=M*u-p*s,t[5]=F*u-_*s,t[6]=U*u-x*s,t[7]=V*u-E*s,t},l.rotateZ$1=function(t,e,i){i*=.5;var s=e[0],u=e[1],p=e[2],_=e[3],x=Math.sin(i),E=Math.cos(i);return t[0]=s*E+u*x,t[1]=u*E-s*x,t[2]=p*E+_*x,t[3]=_*E-p*x,t},l.scale=We,l.scale$1=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},l.scale$2=xt,l.scaleAndAdd=gt,l.setCacheLimits=function(t,e){fr=t,or=e},l.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},l.setRTLTextPlugin=function(t,e,i=!1){if(Zi===vi||Zi===qi||Zi===Mr)throw new Error("setRTLTextPlugin cannot be called multiple times.");Pi=Oi.resolveURL(t),Zi=vi,Qr=e,es(),i||ya()},l.smoothstep=tr,l.spec=St,l.storeAuthState=function(t,e){e?Yi.add(t):Yi.delete(t)},l.sub=Yt,l.subtract=_t,l.symbolSize=Uf,l.tileAABB=function(t,e,i,s,u,p,_,x,E){if("globe"===E.name){const ce=ih(new Xd(p,new td(i,s,u)).canonical).getCorners(),ve=Number.MAX_VALUE,Ae=[-ve,-ve,-ve],Ve=[ve,ve,ve],Ke=id(t,e);for(let dt=0;dt<ce.length;dt++)It(ce[dt],ce[dt],Ke),F=Ve,U=ce[dt],(M=Ve)[0]=Math.min(F[0],U[0]),M[1]=Math.min(F[1],U[1]),M[2]=Math.min(F[2],U[2]),wt(Ae,Ae,ce[dt]);return new La(Ve,Ae)}var M,F,U;const V=xu({z:i,x:s,y:u},E);return new La([(p+V.x/V.scale)*e,e*(V.y/V.scale),_],[(p+V.x2/V.scale)*e,e*(V.y2/V.scale),x])},l.tileTransform=xu,l.transformMat3=function(t,e,i){var s=e[0],u=e[1],p=e[2];return t[0]=s*i[0]+u*i[3]+p*i[6],t[1]=s*i[1]+u*i[4]+p*i[7],t[2]=s*i[2]+u*i[5]+p*i[8],t},l.transformMat4=It,l.transformMat4$1=ln,l.transformQuat=jt,l.translate=Ee,l.transpose=function(t,e){if(t===e){var i=e[1],s=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=s,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},l.triggerPluginCompletionEvent=ho,l.uniqueId=Re,l.validateCustomStyleLayer=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},l.validateFog=Zr,l.validateLight=fi,l.validateStyle=_n,l.values=Xt,l.vectorTile=zc,l.version=J,l.warnOnce=Di,l.window=Q,l.wrap=gi}),d(0,function(l){function J(K){const q=typeof K;if("number"===q||"boolean"===q||"string"===q||null==K)return JSON.stringify(K);if(Array.isArray(K)){let we="[";for(const Ye of K)we+=`${J(Ye)},`;return`${we}]`}const L=Object.keys(K).sort();let de="{";for(let we=0;we<L.length;we++)de+=`${JSON.stringify(L[we])}:${J(K[L[we]])},`;return`${de}}`}function j(K){let q="";for(const L of l.refProperties)q+=`/${J(K[L])}`;return q}class g{constructor(q){this.keyCache={},q&&this.replace(q)}replace(q){this._layerConfigs={},this._layers={},this.update(q,[])}update(q,L){for(const we of q)this._layerConfigs[we.id]=we,(this._layers[we.id]=l.createStyleLayer(we)).compileFilter(),this.keyCache[we.id]&&delete this.keyCache[we.id];for(const we of L)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const de=function(we,Ye){const pt={};for(let Je=0;Je<we.length;Je++){const Lt=Ye&&Ye[we[Je].id]||j(we[Je]);Ye&&(Ye[we[Je].id]=Lt);let en=pt[Lt];en||(en=pt[Lt]=[]),en.push(we[Je])}const Ct=[];for(const Je in pt)Ct.push(pt[Je]);return Ct}(l.values(this._layerConfigs),this.keyCache);for(const we of de){const Ye=we.map(Gt=>this._layers[Gt.id]),pt=Ye[0];if("none"===pt.visibility)continue;const Ct=pt.source||"";let Je=this.familiesBySource[Ct];Je||(Je=this.familiesBySource[Ct]={});const Lt=pt.sourceLayer||"_geojsonTileLayer";let en=Je[Lt];en||(en=Je[Lt]=[]),en.push(Ye)}}}const{ImageBitmap:ne}=l.window;class ge{loadTile(q,L){const{uid:de,encoding:we,rawImageData:Ye,padding:pt,buildQuadTree:Ct}=q,Je=ne&&Ye instanceof ne?this.getImageData(Ye,pt):Ye;L(null,new l.DEMData(de,Je,we,pt<1,Ct))}getImageData(q,L){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);const de=this.offscreenCanvasContext.getImageData(-L,-L,q.width+2*L,q.height+2*L);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:de.width,height:de.height},de.data)}}var Q=function K(q,L){var de,we=q&&q.type;if("FeatureCollection"===we)for(de=0;de<q.features.length;de++)K(q.features[de],L);else if("GeometryCollection"===we)for(de=0;de<q.geometries.length;de++)K(q.geometries[de],L);else if("Feature"===we)K(q.geometry,L);else if("Polygon"===we)Y(q.coordinates,L);else if("MultiPolygon"===we)for(de=0;de<q.coordinates.length;de++)Y(q.coordinates[de],L);return q};function Y(K,q){if(0!==K.length){se(K[0],q);for(var L=1;L<K.length;L++)se(K[L],!q)}}function se(K,q){for(var L=0,de=0,we=0,Ye=K.length,pt=Ye-1;we<Ye;pt=we++){var Ct=(K[we][0]-K[pt][0])*(K[pt][1]+K[we][1]),Je=L+Ct;de+=Math.abs(L)>=Math.abs(Ct)?L-Je+Ct:Ct-Je+L,L=Je}L+de>=0!=!!q&&K.reverse()}const ue=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ye{constructor(q){this._feature=q,this.extent=l.EXTENT,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))}loadGeometry(){if(1===this._feature.type){const q=[];for(const L of this._feature.geometry)q.push([new l.pointGeometry(L[0],L[1])]);return q}{const q=[];for(const L of this._feature.geometry){const de=[];for(const we of L)de.push(new l.pointGeometry(we[0],we[1]));q.push(de)}return q}}toGeoJSON(q,L,de){return ue.call(this,q,L,de)}}class xe{constructor(q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=q.length,this._features=q}feature(q){return new ye(this._features[q])}}var Ee=l.vectorTile.VectorTileFeature,We=be;function be(K,q){this.options=q||{},this.features=K,this.length=K.length}function Se(K,q){this.id="number"==typeof K.id?K.id:void 0,this.type=K.type,this.rawGeometry=1===K.type?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=q||4096}be.prototype.feature=function(K){return new Se(this.features[K],this.options.extent)},Se.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var q=0;q<K.length;q++){for(var L=K[q],de=[],we=0;we<L.length;we++)de.push(new l.pointGeometry(L[we][0],L[we][1]));this.geometry.push(de)}return this.geometry},Se.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,q=1/0,L=-1/0,de=1/0,we=-1/0,Ye=0;Ye<K.length;Ye++)for(var pt=K[Ye],Ct=0;Ct<pt.length;Ct++){var Je=pt[Ct];q=Math.min(q,Je.x),L=Math.max(L,Je.x),de=Math.min(de,Je.y),we=Math.max(we,Je.y)}return[q,de,L,we]},Se.prototype.toGeoJSON=Ee.prototype.toGeoJSON;var ze=et,tt=We;function et(K){var q=new l.pbf;return function(L,de){for(var we in L.layers)de.writeMessage(3,Be,L.layers[we])}(K,q),q.finish()}function Be(K,q){var L;q.writeVarintField(15,K.version||1),q.writeStringField(1,K.name||""),q.writeVarintField(5,K.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<K.length;L++)de.feature=K.feature(L),q.writeMessage(2,C,de);var we=de.keys;for(L=0;L<we.length;L++)q.writeStringField(3,we[L]);var Ye=de.values;for(L=0;L<Ye.length;L++)q.writeMessage(4,xt,Ye[L])}function C(K,q){var L=K.feature;void 0!==L.id&&q.writeVarintField(1,L.id),q.writeMessage(2,Ge,K),q.writeVarintField(3,L.type),q.writeMessage(4,wt,L)}function Ge(K,q){var L=K.feature,de=K.keys,we=K.values,Ye=K.keycache,pt=K.valuecache;for(var Ct in L.properties){var Je=L.properties[Ct],Lt=Ye[Ct];if(null!==Je){void 0===Lt&&(de.push(Ct),Ye[Ct]=Lt=de.length-1),q.writeVarint(Lt);var en=typeof Je;"string"!==en&&"boolean"!==en&&"number"!==en&&(Je=JSON.stringify(Je));var Gt=en+":"+Je,At=pt[Gt];void 0===At&&(we.push(Je),pt[Gt]=At=we.length-1),q.writeVarint(At)}}}function _t(K,q){return(q<<3)+(7&K)}function ht(K){return K<<1^K>>31}function wt(K,q){for(var L=K.loadGeometry(),de=K.type,we=0,Ye=0,pt=L.length,Ct=0;Ct<pt;Ct++){var Je=L[Ct],Lt=1;1===de&&(Lt=Je.length),q.writeVarint(_t(1,Lt));for(var en=3===de?Je.length-1:Je.length,Gt=0;Gt<en;Gt++){1===Gt&&1!==de&&q.writeVarint(_t(2,en-1));var At=Je[Gt].x-we,Pn=Je[Gt].y-Ye;q.writeVarint(ht(At)),q.writeVarint(ht(Pn)),we+=At,Ye+=Pn}3===de&&q.writeVarint(_t(7,1))}}function xt(K,q){var L=typeof K;"string"===L?q.writeStringField(1,K):"boolean"===L?q.writeBooleanField(7,K):"number"===L&&(K%1!=0?q.writeDoubleField(3,K):K<0?q.writeSVarintField(6,K):q.writeVarintField(5,K))}function gt(K,q,L,de,we,Ye){if(we-de<=L)return;const pt=de+we>>1;Bt(K,q,pt,de,we,Ye%2),gt(K,q,L,de,pt-1,Ye+1),gt(K,q,L,pt+1,we,Ye+1)}function Bt(K,q,L,de,we,Ye){for(;we>de;){if(we-de>600){const Lt=we-de+1,en=L-de+1,Gt=Math.log(Lt),At=.5*Math.exp(2*Gt/3),Pn=.5*Math.sqrt(Gt*At*(Lt-At)/Lt)*(en-Lt/2<0?-1:1);Bt(K,q,L,Math.max(de,Math.floor(L-en*At/Lt+Pn)),Math.min(we,Math.floor(L+(Lt-en)*At/Lt+Pn)),Ye)}const pt=q[2*L+Ye];let Ct=de,Je=we;for(Ht(K,q,de,L),q[2*we+Ye]>pt&&Ht(K,q,de,we);Ct<Je;){for(Ht(K,q,Ct,Je),Ct++,Je--;q[2*Ct+Ye]<pt;)Ct++;for(;q[2*Je+Ye]>pt;)Je--}q[2*de+Ye]===pt?Ht(K,q,de,Je):(Je++,Ht(K,q,Je,we)),Je<=L&&(de=Je+1),L<=Je&&(we=Je-1)}}function Ht(K,q,L,de){Gn(K,L,de),Gn(q,2*L,2*de),Gn(q,2*L+1,2*de+1)}function Gn(K,q,L){const de=K[q];K[q]=K[L],K[L]=de}function It(K,q,L,de){const we=K-L,Ye=q-de;return we*we+Ye*Ye}ze.fromVectorTileJs=et,ze.fromGeojsonVt=function(K,q){q=q||{};var L={};for(var de in K)L[de]=new We(K[de].features,q),L[de].name=de,L[de].version=q.version,L[de].extent=q.extent;return et({layers:L})},ze.GeoJSONWrapper=tt;const jt=K=>K[0],Ut=K=>K[1];class Yt{constructor(q,L=jt,de=Ut,we=64,Ye=Float64Array){this.nodeSize=we,this.points=q;const pt=q.length<65536?Uint16Array:Uint32Array,Ct=this.ids=new pt(q.length),Je=this.coords=new Ye(2*q.length);for(let Lt=0;Lt<q.length;Lt++)Ct[Lt]=Lt,Je[2*Lt]=L(q[Lt]),Je[2*Lt+1]=de(q[Lt]);gt(Ct,Je,we,0,Ct.length-1,0)}range(q,L,de,we){return function(Ye,pt,Ct,Je,Lt,en,Gt){const At=[0,Ye.length-1,0],Pn=[];let Vn,Yn;for(;At.length;){const qn=At.pop(),ni=At.pop(),Li=At.pop();if(ni-Li<=Gt){for(let En=Li;En<=ni;En++)Vn=pt[2*En],Yn=pt[2*En+1],Vn>=Ct&&Vn<=Lt&&Yn>=Je&&Yn<=en&&Pn.push(Ye[En]);continue}const Mi=Math.floor((Li+ni)/2);Vn=pt[2*Mi],Yn=pt[2*Mi+1],Vn>=Ct&&Vn<=Lt&&Yn>=Je&&Yn<=en&&Pn.push(Ye[Mi]);const di=(qn+1)%2;(0===qn?Ct<=Vn:Je<=Yn)&&(At.push(Li),At.push(Mi-1),At.push(di)),(0===qn?Lt>=Vn:en>=Yn)&&(At.push(Mi+1),At.push(ni),At.push(di))}return Pn}(this.ids,this.coords,q,L,de,we,this.nodeSize)}within(q,L,de){return function(we,Ye,pt,Ct,Je,Lt){const en=[0,we.length-1,0],Gt=[],At=Je*Je;for(;en.length;){const Pn=en.pop(),Vn=en.pop(),Yn=en.pop();if(Vn-Yn<=Lt){for(let di=Yn;di<=Vn;di++)It(Ye[2*di],Ye[2*di+1],pt,Ct)<=At&&Gt.push(we[di]);continue}const qn=Math.floor((Yn+Vn)/2),ni=Ye[2*qn],Li=Ye[2*qn+1];It(ni,Li,pt,Ct)<=At&&Gt.push(we[qn]);const Mi=(Pn+1)%2;(0===Pn?pt-Je<=ni:Ct-Je<=Li)&&(en.push(Yn),en.push(qn-1),en.push(Mi)),(0===Pn?pt+Je>=ni:Ct+Je>=Li)&&(en.push(qn+1),en.push(Vn),en.push(Mi))}return Gt}(this.ids,this.coords,q,L,de,this.nodeSize)}}const zt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},Zt=Math.fround||(ln=new Float32Array(1),K=>(ln[0]=+K,ln[0]));var ln;class xn{constructor(q){this.options=li(Object.create(zt),q),this.trees=new Array(this.options.maxZoom+1)}load(q){const{log:L,minZoom:de,maxZoom:we,nodeSize:Ye}=this.options;L&&console.time("total time");const pt=`prepare ${q.length} points`;L&&console.time(pt),this.points=q;let Ct=[];for(let Je=0;Je<q.length;Je++)q[Je].geometry&&Ct.push(Kt(q[Je],Je));this.trees[we+1]=new Yt(Ct,$i,rr,Ye,Float32Array),L&&console.timeEnd(pt);for(let Je=we;Je>=de;Je--){const Lt=+Date.now();Ct=this._cluster(Ct,Je),this.trees[Je]=new Yt(Ct,$i,rr,Ye,Float32Array),L&&console.log("z%d: %d clusters in %dms",Je,Ct.length,+Date.now()-Lt)}return L&&console.timeEnd("total time"),this}getClusters(q,L){let de=((q[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,q[1]));let Ye=180===q[2]?180:((q[2]+180)%360+360)%360-180;const pt=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)de=-180,Ye=180;else if(de>Ye){const en=this.getClusters([de,we,180,pt],L),Gt=this.getClusters([-180,we,Ye,pt],L);return en.concat(Gt)}const Ct=this.trees[this._limitZoom(L)],Je=Ct.range(On(de),bn(pt),On(Ye),bn(we)),Lt=[];for(const en of Je){const Gt=Ct.points[en];Lt.push(Gt.numPoints?mt(Gt):this.points[Gt.index])}return Lt}getChildren(q){const L=this._getOriginId(q),de=this._getOriginZoom(q),we="No cluster with the specified id.",Ye=this.trees[de];if(!Ye)throw new Error(we);const pt=Ye.points[L];if(!pt)throw new Error(we);const Ct=this.options.radius/(this.options.extent*Math.pow(2,de-1)),Je=Ye.within(pt.x,pt.y,Ct),Lt=[];for(const en of Je){const Gt=Ye.points[en];Gt.parentId===q&&Lt.push(Gt.numPoints?mt(Gt):this.points[Gt.index])}if(0===Lt.length)throw new Error(we);return Lt}getLeaves(q,L,de){const we=[];return this._appendLeaves(we,q,L=L||10,de=de||0,0),we}getTile(q,L,de){const we=this.trees[this._limitZoom(q)],Ye=Math.pow(2,q),{extent:pt,radius:Ct}=this.options,Je=Ct/pt,Lt=(de-Je)/Ye,en=(de+1+Je)/Ye,Gt={features:[]};return this._addTileFeatures(we.range((L-Je)/Ye,Lt,(L+1+Je)/Ye,en),we.points,L,de,Ye,Gt),0===L&&this._addTileFeatures(we.range(1-Je/Ye,Lt,1,en),we.points,Ye,de,Ye,Gt),L===Ye-1&&this._addTileFeatures(we.range(0,Lt,Je/Ye,en),we.points,-1,de,Ye,Gt),Gt.features.length?Gt:null}getClusterExpansionZoom(q){let L=this._getOriginZoom(q)-1;for(;L<=this.options.maxZoom;){const de=this.getChildren(q);if(L++,1!==de.length)break;q=de[0].properties.cluster_id}return L}_appendLeaves(q,L,de,we,Ye){const pt=this.getChildren(L);for(const Ct of pt){const Je=Ct.properties;if(Je&&Je.cluster?Ye+Je.point_count<=we?Ye+=Je.point_count:Ye=this._appendLeaves(q,Je.cluster_id,de,we,Ye):Ye<we?Ye++:q.push(Ct),q.length===de)break}return Ye}_addTileFeatures(q,L,de,we,Ye,pt){for(const Ct of q){const Je=L[Ct],Lt=Je.numPoints;let en,Gt,At;if(Lt)en=Wt(Je),Gt=Je.x,At=Je.y;else{const Yn=this.points[Je.index];en=Yn.properties,Gt=On(Yn.geometry.coordinates[0]),At=bn(Yn.geometry.coordinates[1])}const Pn={type:1,geometry:[[Math.round(this.options.extent*(Gt*Ye-de)),Math.round(this.options.extent*(At*Ye-we))]],tags:en};let Vn;Lt?Vn=Je.id:this.options.generateId?Vn=Je.index:this.points[Je.index].id&&(Vn=this.points[Je.index].id),void 0!==Vn&&(Pn.id=Vn),pt.features.push(Pn)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(+q,this.options.maxZoom+1))}_cluster(q,L){const de=[],{radius:we,extent:Ye,reduce:pt,minPoints:Ct}=this.options,Je=we/(Ye*Math.pow(2,L));for(let Lt=0;Lt<q.length;Lt++){const en=q[Lt];if(en.zoom<=L)continue;en.zoom=L;const Gt=this.trees[L+1],At=Gt.within(en.x,en.y,Je),Pn=en.numPoints||1;let Vn=Pn;for(const Yn of At){const qn=Gt.points[Yn];qn.zoom>L&&(Vn+=qn.numPoints||1)}if(Vn>Pn&&Vn>=Ct){let Yn=en.x*Pn,qn=en.y*Pn,ni=pt&&Pn>1?this._map(en,!0):null;const Li=(Lt<<5)+(L+1)+this.points.length;for(const Mi of At){const di=Gt.points[Mi];if(di.zoom<=L)continue;di.zoom=L;const En=di.numPoints||1;Yn+=di.x*En,qn+=di.y*En,di.parentId=Li,pt&&(ni||(ni=this._map(en,!0)),pt(ni,this._map(di)))}en.parentId=Li,de.push(an(Yn/Vn,qn/Vn,Li,Vn,ni))}else if(de.push(en),Vn>1)for(const Yn of At){const qn=Gt.points[Yn];qn.zoom<=L||(qn.zoom=L,de.push(qn))}}return de}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,L){if(q.numPoints)return L?li({},q.properties):q.properties;const de=this.points[q.index].properties,we=this.options.map(de);return L&&we===de?li({},we):we}}function an(K,q,L,de,we){return{x:Zt(K),y:Zt(q),zoom:1/0,id:L,parentId:-1,numPoints:de,properties:we}}function Kt(K,q){const[L,de]=K.geometry.coordinates;return{x:Zt(On(L)),y:Zt(bn(de)),zoom:1/0,index:q,parentId:-1}}function mt(K){return{type:"Feature",id:K.id,properties:Wt(K),geometry:{type:"Point",coordinates:[(q=K.x,360*(q-.5)),jn(K.y)]}};var q}function Wt(K){const q=K.numPoints,L=q>=1e4?`${Math.round(q/1e3)}k`:q>=1e3?Math.round(q/100)/10+"k":q;return li(li({},K.properties),{cluster:!0,cluster_id:K.id,point_count:q,point_count_abbreviated:L})}function On(K){return K/360+.5}function bn(K){const q=Math.sin(K*Math.PI/180),L=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return L<0?0:L>1?1:L}function jn(K){const q=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}function li(K,q){for(const L in q)K[L]=q[L];return K}function $i(K){return K.x}function rr(K){return K.y}function Bi(K,q,L,de){for(var we,Ye=de,pt=L-q>>1,Ct=L-q,Je=K[q],Lt=K[q+1],en=K[L],Gt=K[L+1],At=q+3;At<L;At+=3){var Pn=_i(K[At],K[At+1],Je,Lt,en,Gt);if(Pn>Ye)we=At,Ye=Pn;else if(Pn===Ye){var Vn=Math.abs(At-pt);Vn<Ct&&(we=At,Ct=Vn)}}Ye>de&&(we-q>3&&Bi(K,q,we,de),K[we+2]=Ye,L-we>3&&Bi(K,we,L,de))}function _i(K,q,L,de,we,Ye){var pt=we-L,Ct=Ye-de;if(0!==pt||0!==Ct){var Je=((K-L)*pt+(q-de)*Ct)/(pt*pt+Ct*Ct);Je>1?(L=we,de=Ye):Je>0&&(L+=pt*Je,de+=Ct*Je)}return(pt=K-L)*pt+(Ct=q-de)*Ct}function tr(K,q,L,de){var we={id:void 0===K?null:K,type:q,geometry:L,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ye){var pt=Ye.geometry,Ct=Ye.type;if("Point"===Ct||"MultiPoint"===Ct||"LineString"===Ct)gi(Ye,pt);else if("Polygon"===Ct||"MultiLineString"===Ct)for(var Je=0;Je<pt.length;Je++)gi(Ye,pt[Je]);else if("MultiPolygon"===Ct)for(Je=0;Je<pt.length;Je++)for(var Lt=0;Lt<pt[Je].length;Lt++)gi(Ye,pt[Je][Lt])}(we),we}function gi(K,q){for(var L=0;L<q.length;L+=3)K.minX=Math.min(K.minX,q[L]),K.minY=Math.min(K.minY,q[L+1]),K.maxX=Math.max(K.maxX,q[L]),K.maxY=Math.max(K.maxY,q[L+1])}function Ti(K,q,L,de){if(q.geometry){var we=q.geometry.coordinates,Ye=q.geometry.type,pt=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2),Ct=[],Je=q.id;if(L.promoteId?Je=q.properties[L.promoteId]:L.generateId&&(Je=de||0),"Point"===Ye)Xt(we,Ct);else if("MultiPoint"===Ye)for(var Lt=0;Lt<we.length;Lt++)Xt(we[Lt],Ct);else if("LineString"===Ye)Oe(we,Ct,pt,!1);else if("MultiLineString"===Ye){if(L.lineMetrics){for(Lt=0;Lt<we.length;Lt++)Oe(we[Lt],Ct=[],pt,!1),K.push(tr(Je,"LineString",Ct,q.properties));return}ae(we,Ct,pt,!1)}else if("Polygon"===Ye)ae(we,Ct,pt,!0);else{if("MultiPolygon"!==Ye){if("GeometryCollection"===Ye){for(Lt=0;Lt<q.geometry.geometries.length;Lt++)Ti(K,{id:Je,geometry:q.geometry.geometries[Lt],properties:q.properties},L,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Lt=0;Lt<we.length;Lt++){var en=[];ae(we[Lt],en,pt,!0),Ct.push(en)}}K.push(tr(Je,Ye,Ct,q.properties))}}function Xt(K,q){q.push(Re(K[0])),q.push(lt(K[1])),q.push(0)}function Oe(K,q,L,de){for(var we,Ye,pt=0,Ct=0;Ct<K.length;Ct++){var Je=Re(K[Ct][0]),Lt=lt(K[Ct][1]);q.push(Je),q.push(Lt),q.push(0),Ct>0&&(pt+=de?(we*Lt-Je*Ye)/2:Math.sqrt(Math.pow(Je-we,2)+Math.pow(Lt-Ye,2))),we=Je,Ye=Lt}var en=q.length-3;q[2]=1,Bi(q,0,en,L),q[en+2]=1,q.size=Math.abs(pt),q.start=0,q.end=q.size}function ae(K,q,L,de){for(var we=0;we<K.length;we++){var Ye=[];Oe(K[we],Ye,L,de),q.push(Ye)}}function Re(K){return K/360+.5}function lt(K){var q=Math.sin(K*Math.PI/180),L=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return L<0?0:L>1?1:L}function Le(K,q,L,de,we,Ye,pt,Ct){if(de/=q,Ye>=(L/=q)&&pt<de)return K;if(pt<L||Ye>=de)return null;for(var Je=[],Lt=0;Lt<K.length;Lt++){var en=K[Lt],Gt=en.geometry,At=en.type,Pn=0===we?en.minX:en.minY,Vn=0===we?en.maxX:en.maxY;if(Pn>=L&&Vn<de)Je.push(en);else if(!(Vn<L||Pn>=de)){var Yn=[];if("Point"===At||"MultiPoint"===At)Rt(Gt,Yn,L,de,we);else if("LineString"===At)me(Gt,Yn,L,de,we,!1,Ct.lineMetrics);else if("MultiLineString"===At)Ft(Gt,Yn,L,de,we,!1);else if("Polygon"===At)Ft(Gt,Yn,L,de,we,!0);else if("MultiPolygon"===At)for(var qn=0;qn<Gt.length;qn++){var ni=[];Ft(Gt[qn],ni,L,de,we,!0),ni.length&&Yn.push(ni)}if(Yn.length){if(Ct.lineMetrics&&"LineString"===At){for(qn=0;qn<Yn.length;qn++)Je.push(tr(en.id,At,Yn[qn],en.tags));continue}"LineString"!==At&&"MultiLineString"!==At||(1===Yn.length?(At="LineString",Yn=Yn[0]):At="MultiLineString"),"Point"!==At&&"MultiPoint"!==At||(At=3===Yn.length?"Point":"MultiPoint"),Je.push(tr(en.id,At,Yn,en.tags))}}}return Je.length?Je:null}function Rt(K,q,L,de,we){for(var Ye=0;Ye<K.length;Ye+=3){var pt=K[Ye+we];pt>=L&&pt<=de&&(q.push(K[Ye]),q.push(K[Ye+1]),q.push(K[Ye+2]))}}function me(K,q,L,de,we,Ye,pt){for(var Ct,Je,Lt=He(K),en=0===we?Jn:Ki,Gt=K.start,At=0;At<K.length-3;At+=3){var Pn=K[At],Vn=K[At+1],Yn=K[At+2],qn=K[At+3],ni=K[At+4],Li=0===we?Pn:Vn,Mi=0===we?qn:ni,di=!1;pt&&(Ct=Math.sqrt(Math.pow(Pn-qn,2)+Math.pow(Vn-ni,2))),Li<L?Mi>L&&(Je=en(Lt,Pn,Vn,qn,ni,L),pt&&(Lt.start=Gt+Ct*Je)):Li>de?Mi<de&&(Je=en(Lt,Pn,Vn,qn,ni,de),pt&&(Lt.start=Gt+Ct*Je)):Qt(Lt,Pn,Vn,Yn),Mi<L&&Li>=L&&(Je=en(Lt,Pn,Vn,qn,ni,L),di=!0),Mi>de&&Li<=de&&(Je=en(Lt,Pn,Vn,qn,ni,de),di=!0),!Ye&&di&&(pt&&(Lt.end=Gt+Ct*Je),q.push(Lt),Lt=He(K)),pt&&(Gt+=Ct)}var En=K.length-3;Pn=K[En],Vn=K[En+1],Yn=K[En+2],(Li=0===we?Pn:Vn)>=L&&Li<=de&&Qt(Lt,Pn,Vn,Yn),En=Lt.length-3,Ye&&En>=3&&(Lt[En]!==Lt[0]||Lt[En+1]!==Lt[1])&&Qt(Lt,Lt[0],Lt[1],Lt[2]),Lt.length&&q.push(Lt)}function He(K){var q=[];return q.size=K.size,q.start=K.start,q.end=K.end,q}function Ft(K,q,L,de,we,Ye){for(var pt=0;pt<K.length;pt++)me(K[pt],q,L,de,we,Ye,!1)}function Qt(K,q,L,de){K.push(q),K.push(L),K.push(de)}function Jn(K,q,L,de,we,Ye){var pt=(Ye-q)/(de-q);return K.push(Ye),K.push(L+(we-L)*pt),K.push(1),pt}function Ki(K,q,L,de,we,Ye){var pt=(Ye-L)/(we-L);return K.push(q+(de-q)*pt),K.push(Ye),K.push(1),pt}function Di(K,q){for(var L=[],de=0;de<K.length;de++){var we,Ye=K[de],pt=Ye.type;if("Point"===pt||"MultiPoint"===pt||"LineString"===pt)we=mi(Ye.geometry,q);else if("MultiLineString"===pt||"Polygon"===pt){we=[];for(var Ct=0;Ct<Ye.geometry.length;Ct++)we.push(mi(Ye.geometry[Ct],q))}else if("MultiPolygon"===pt)for(we=[],Ct=0;Ct<Ye.geometry.length;Ct++){for(var Je=[],Lt=0;Lt<Ye.geometry[Ct].length;Lt++)Je.push(mi(Ye.geometry[Ct][Lt],q));we.push(Je)}L.push(tr(Ye.id,pt,we,Ye.tags))}return L}function mi(K,q){var L=[];L.size=K.size,void 0!==K.start&&(L.start=K.start,L.end=K.end);for(var de=0;de<K.length;de+=3)L.push(K[de]+q,K[de+1],K[de+2]);return L}function ci(K,q){if(K.transformed)return K;var L,de,we,Ye=1<<K.z,pt=K.x,Ct=K.y;for(L=0;L<K.features.length;L++){var Je=K.features[L],Lt=Je.geometry,en=Je.type;if(Je.geometry=[],1===en)for(de=0;de<Lt.length;de+=2)Je.geometry.push(xr(Lt[de],Lt[de+1],q,Ye,pt,Ct));else for(de=0;de<Lt.length;de++){var Gt=[];for(we=0;we<Lt[de].length;we+=2)Gt.push(xr(Lt[de][we],Lt[de][we+1],q,Ye,pt,Ct));Je.geometry.push(Gt)}}return K.transformed=!0,K}function xr(K,q,L,de,we,Ye){return[Math.round(L*(K*de-we)),Math.round(L*(q*de-Ye))]}function Ii(K,q,L,de,we){for(var Ye=q===we.maxZoom?0:we.tolerance/((1<<q)*we.extent),pt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:L,y:de,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ct=0;Ct<K.length;Ct++){pt.numFeatures++,hr(pt,K[Ct],Ye,we);var Je=K[Ct].minX,Lt=K[Ct].minY,en=K[Ct].maxX,Gt=K[Ct].maxY;Je<pt.minX&&(pt.minX=Je),Lt<pt.minY&&(pt.minY=Lt),en>pt.maxX&&(pt.maxX=en),Gt>pt.maxY&&(pt.maxY=Gt)}return pt}function hr(K,q,L,de){var we=q.geometry,Ye=q.type,pt=[];if("Point"===Ye||"MultiPoint"===Ye)for(var Ct=0;Ct<we.length;Ct+=3)pt.push(we[Ct]),pt.push(we[Ct+1]),K.numPoints++,K.numSimplified++;else if("LineString"===Ye)yi(pt,we,K,L,!1,!1);else if("MultiLineString"===Ye||"Polygon"===Ye)for(Ct=0;Ct<we.length;Ct++)yi(pt,we[Ct],K,L,"Polygon"===Ye,0===Ct);else if("MultiPolygon"===Ye)for(var Je=0;Je<we.length;Je++){var Lt=we[Je];for(Ct=0;Ct<Lt.length;Ct++)yi(pt,Lt[Ct],K,L,!0,0===Ct)}if(pt.length){var en=q.tags||null;if("LineString"===Ye&&de.lineMetrics){for(var Gt in en={},q.tags)en[Gt]=q.tags[Gt];en.mapbox_clip_start=we.start/we.size,en.mapbox_clip_end=we.end/we.size}var At={geometry:pt,type:"Polygon"===Ye||"MultiPolygon"===Ye?3:"LineString"===Ye||"MultiLineString"===Ye?2:1,tags:en};null!==q.id&&(At.id=q.id),K.features.push(At)}}function yi(K,q,L,de,we,Ye){var pt=de*de;if(de>0&&q.size<(we?pt:de))L.numPoints+=q.length/3;else{for(var Ct=[],Je=0;Je<q.length;Je+=3)(0===de||q[Je+2]>pt)&&(L.numSimplified++,Ct.push(q[Je]),Ct.push(q[Je+1])),L.numPoints++;we&&function(Lt,en){for(var Gt=0,At=0,Pn=Lt.length,Vn=Pn-2;At<Pn;Vn=At,At+=2)Gt+=(Lt[At]-Lt[Vn])*(Lt[At+1]+Lt[Vn+1]);if(Gt>0===en)for(At=0,Pn=Lt.length;At<Pn/2;At+=2){var Yn=Lt[At],qn=Lt[At+1];Lt[At]=Lt[Pn-2-At],Lt[At+1]=Lt[Pn-1-At],Lt[Pn-2-At]=Yn,Lt[Pn-1-At]=qn}}(Ct,Ye),K.push(Ct)}}function kr(K,q){var L=(q=this.options=function(we,Ye){for(var pt in Ye)we[pt]=Ye[pt];return we}(Object.create(this.options),q)).debug;if(L&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");var we,Ye,pt,Ct,Je,Lt,de=function(we,Ye){var pt=[];if("FeatureCollection"===we.type)for(var Ct=0;Ct<we.features.length;Ct++)Ti(pt,we.features[Ct],Ye,Ct);else Ti(pt,"Feature"===we.type?we:{geometry:we},Ye);return pt}(K,q);this.tiles={},this.tileCoords=[],L&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(we=de,Ye=q,pt=Ye.buffer/Ye.extent,Ct=we,Je=Le(we,1,-1-pt,pt,0,-1,2,Ye),Lt=Le(we,1,1-pt,2+pt,0,-1,2,Ye),(Je||Lt)&&(Ct=Le(we,1,-pt,1+pt,0,-1,2,Ye)||[],Je&&(Ct=Di(Je,1).concat(Ct)),Lt&&(Ct=Ct.concat(Di(Lt,-1)))),de=Ct).length&&this.splitTile(de,0,0,0),L&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function gr(K,q,L){return 32*((1<<K)*L+q)+K}function Tr(K,q){const L=K.tileID.canonical;if(!this._geoJSONIndex)return q(null,null);const de=this._geoJSONIndex.getTile(L.z,L.x,L.y);if(!de)return q(null,null);const we=new xe(de.features);let Ye=ze(we);0===Ye.byteOffset&&Ye.byteLength===Ye.buffer.byteLength||(Ye=new Uint8Array(Ye)),q(null,{vectorTile:we,rawData:Ye.buffer})}kr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},kr.prototype.splitTile=function(K,q,L,de,we,Ye,pt){for(var Ct=[K,q,L,de],Je=this.options,Lt=Je.debug;Ct.length;){de=Ct.pop(),L=Ct.pop(),q=Ct.pop(),K=Ct.pop();var en=1<<q,Gt=gr(q,L,de),At=this.tiles[Gt];if(!At&&(Lt>1&&console.time("creation"),At=this.tiles[Gt]=Ii(K,q,L,de,Je),this.tileCoords.push({z:q,x:L,y:de}),Lt)){Lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,L,de,At.numFeatures,At.numPoints,At.numSimplified),console.timeEnd("creation"));var Pn="z"+q;this.stats[Pn]=(this.stats[Pn]||0)+1,this.total++}if(At.source=K,we){if(q===Je.maxZoom||q===we)continue;var Vn=1<<we-q;if(L!==Math.floor(Ye/Vn)||de!==Math.floor(pt/Vn))continue}else if(q===Je.indexMaxZoom||At.numPoints<=Je.indexMaxPoints)continue;if(At.source=null,0!==K.length){Lt>1&&console.time("clipping");var Yn,qn,ni,Li,Mi,di,En=.5*Je.buffer/Je.extent,ti=.5-En,Yi=.5+En,Ni=1+En;Yn=qn=ni=Li=null,Mi=Le(K,en,L-En,L+Yi,0,At.minX,At.maxX,Je),di=Le(K,en,L+ti,L+Ni,0,At.minX,At.maxX,Je),K=null,Mi&&(Yn=Le(Mi,en,de-En,de+Yi,1,At.minY,At.maxY,Je),qn=Le(Mi,en,de+ti,de+Ni,1,At.minY,At.maxY,Je),Mi=null),di&&(ni=Le(di,en,de-En,de+Yi,1,At.minY,At.maxY,Je),Li=Le(di,en,de+ti,de+Ni,1,At.minY,At.maxY,Je),di=null),Lt>1&&console.timeEnd("clipping"),Ct.push(Yn||[],q+1,2*L,2*de),Ct.push(qn||[],q+1,2*L,2*de+1),Ct.push(ni||[],q+1,2*L+1,2*de),Ct.push(Li||[],q+1,2*L+1,2*de+1)}}},kr.prototype.getTile=function(K,q,L){var de=this.options,we=de.extent,Ye=de.debug;if(K<0||K>24)return null;var pt=1<<K,Ct=gr(K,q=(q%pt+pt)%pt,L);if(this.tiles[Ct])return ci(this.tiles[Ct],we);Ye>1&&console.log("drilling down to z%d-%d-%d",K,q,L);for(var Je,Lt=K,en=q,Gt=L;!Je&&Lt>0;)Lt--,en=Math.floor(en/2),Gt=Math.floor(Gt/2),Je=this.tiles[gr(Lt,en,Gt)];return Je&&Je.source?(Ye>1&&console.log("found parent tile z%d-%d-%d",Lt,en,Gt),Ye>1&&console.time("drilling down"),this.splitTile(Je.source,Lt,en,Gt,K,q,L),Ye>1&&console.timeEnd("drilling down"),this.tiles[Ct]?ci(this.tiles[Ct],we):null):null};class Ci extends l.VectorTileWorkerSource{constructor(q,L,de,we,Ye){super(q,L,de,we,Tr),Ye&&(this.loadGeoJSON=Ye)}loadData(q,L){const de=q&&q.request,we=de&&de.collectResourceTiming;this.loadGeoJSON(q,(Ye,pt)=>{if(Ye||!pt)return L(Ye);if("object"!=typeof pt)return L(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));{Q(pt,!0);try{if(q.filter){const Je=l.createExpression(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Je.result)throw new Error(Je.value.map(en=>`${en.key}: ${en.message}`).join(", "));const Lt=pt.features.filter(en=>Je.value.evaluate({zoom:0},en));pt={type:"FeatureCollection",features:Lt}}this._geoJSONIndex=q.cluster?new xn(function({superclusterOptions:Je,clusterProperties:Lt}){if(!Lt||!Je)return Je;const en={},Gt={},At={accumulated:null,zoom:0},Pn={properties:null},Vn=Object.keys(Lt);for(const Yn of Vn){const[qn,ni]=Lt[Yn],Li=l.createExpression(ni),Mi=l.createExpression("string"==typeof qn?[qn,["accumulated"],["get",Yn]]:qn);en[Yn]=Li.value,Gt[Yn]=Mi.value}return Je.map=Yn=>{Pn.properties=Yn;const qn={};for(const ni of Vn)qn[ni]=en[ni].evaluate(At,Pn);return qn},Je.reduce=(Yn,qn)=>{Pn.properties=qn;for(const ni of Vn)At.accumulated=Yn[ni],Yn[ni]=Gt[ni].evaluate(At,Pn)},Je}(q)).load(pt.features):new kr(Je=pt,q.geojsonVtOptions)}catch(Je){return L(Je)}this.loaded={};const Ct={};if(we){const Je=l.getPerformanceMeasurement(de);Je&&(Ct.resourceTiming={},Ct.resourceTiming[q.source]=JSON.parse(JSON.stringify(Je)))}L(null,Ct)}var Je})}reloadTile(q,L){const de=this.loaded;return de&&de[q.uid]?super.reloadTile(q,L):this.loadTile(q,L)}loadGeoJSON(q,L){if(q.request)l.getJSON(q.request,L);else{if("string"!=typeof q.data)return L(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));try{return L(null,JSON.parse(q.data))}catch{return L(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(q,L){try{L(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(de){L(de)}}getClusterChildren(q,L){try{L(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(de){L(de)}}getClusterLeaves(q,L){try{L(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(de){L(de)}}}class Oi{constructor(q){this.self=q,this.actor=new l.Actor(q,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=l.getProjection({name:"mercator"}),this.workerSourceTypes={vector:l.VectorTileWorkerSource,geojson:Ci},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(L,de)=>{if(this.workerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.workerSourceTypes[L]=de},this.self.registerRTLTextPlugin=L=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=L.applyArabicShaping,l.plugin.processBidirectionalText=L.processBidirectionalText,l.plugin.processStyledBidirectionalText=L.processStyledBidirectionalText}}clearCaches(q,L,de){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q],de()}checkIfReady(q,L,de){de()}setReferrer(q,L){this.referrer=L}spriteLoaded(q,L){this.isSpriteLoaded[q]=L;for(const de in this.workerSources[q]){const we=this.workerSources[q][de];for(const Ye in we)we[Ye]instanceof l.VectorTileWorkerSource&&(we[Ye].isSpriteLoaded=L,we[Ye].fire(new l.Event("isSpriteLoaded")))}}setImages(q,L,de){this.availableImages[q]=L;for(const we in this.workerSources[q]){const Ye=this.workerSources[q][we];for(const pt in Ye)Ye[pt].availableImages=L}de()}enableTerrain(q,L,de){this.terrain=L,de()}setProjection(q,L){this.projections[q]=l.getProjection(L)}setLayers(q,L,de){this.getLayerIndex(q).replace(L),de()}updateLayers(q,L,de){this.getLayerIndex(q).update(L.layers,L.removedIds),de()}loadTile(q,L,de){const we=this.enableTerrain?l.extend({enableTerrain:this.terrain},L):L;we.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,L.type,L.source).loadTile(we,de)}loadDEMTile(q,L,de){const we=this.enableTerrain?l.extend({buildQuadTree:this.terrain},L):L;this.getDEMWorkerSource(q,L.source).loadTile(we,de)}reloadTile(q,L,de){const we=this.enableTerrain?l.extend({enableTerrain:this.terrain},L):L;we.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,L.type,L.source).reloadTile(we,de)}abortTile(q,L,de){this.getWorkerSource(q,L.type,L.source).abortTile(L,de)}removeTile(q,L,de){this.getWorkerSource(q,L.type,L.source).removeTile(L,de)}removeSource(q,L,de){if(!this.workerSources[q]||!this.workerSources[q][L.type]||!this.workerSources[q][L.type][L.source])return;const we=this.workerSources[q][L.type][L.source];delete this.workerSources[q][L.type][L.source],void 0!==we.removeSource?we.removeSource(L,de):de()}loadWorkerSource(q,L,de){try{this.self.importScripts(L.url),de()}catch(we){de(we.toString())}}syncRTLPluginState(q,L,de){try{l.plugin.setState(L);const we=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&null!=we){this.self.importScripts(we);const Ye=l.plugin.isParsed();de(Ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${we}`),Ye)}}catch(we){de(we.toString())}}getAvailableImages(q){let L=this.availableImages[q];return L||(L=[]),L}getLayerIndex(q){let L=this.layerIndexes[q];return L||(L=this.layerIndexes[q]=new g),L}getWorkerSource(q,L,de){return this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][L]||(this.workerSources[q][L]={}),this.workerSources[q][L][de]||(this.workerSources[q][L][de]=new this.workerSourceTypes[L]({send:(we,Ye,pt,Ct,Je,Lt)=>{this.actor.send(we,Ye,pt,q,Je,Lt)},scheduler:this.actor.scheduler},this.getLayerIndex(q),this.getAvailableImages(q),this.isSpriteLoaded[q])),this.workerSources[q][L][de]}getDEMWorkerSource(q,L){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][L]||(this.demWorkerSources[q][L]=new ge),this.demWorkerSources[q][L]}enforceCacheSizeLimit(q,L){l.enforceCacheSizeLimit(L)}getWorkerPerformanceMetrics(q,L,de){de(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Oi(self)),Oi}),d(0,function(l){var J=j;function j(f){return n=f,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,v,T=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(T);try{v=new Worker(I),m=!0}catch{m=!1}return v&&v.terminate(),URL.revokeObjectURL(I),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var v=m.getContext("2d");if(!v)return!1;var T=v.getImageData(0,0,1,1);return T&&T.width===m.width}()||(void 0===g[c=n&&n.failIfMajorPerformanceCaveat]&&(g[c]=function(m){var v,I,R,$,T=(I=m,R=document.createElement("canvas"),($=Object.create(j.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,R.getContext("webgl",$)||R.getContext("experimental-webgl",$));if(!T)return!1;try{v=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!v||T.isContextLost())&&(T.shaderSource(v,"void main() {}"),T.compileShader(v),!0===T.getShaderParameter(v,T.COMPILE_STATUS))}(c)),!g[c]||document.documentMode));var n,c}var g={};function ne(f,n){var c=n[0],m=n[1],v=n[2],T=n[3],I=c*T-v*m;return I?(f[0]=T*(I=1/I),f[1]=-m*I,f[2]=-v*I,f[3]=c*I,f):null}function ge(f,n){if(Array.isArray(f)){if(!Array.isArray(n)||f.length!==n.length)return!1;for(let c=0;c<f.length;c++)if(!ge(f[c],n[c]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==n){if("object"!=typeof n||Object.keys(f).length!==Object.keys(n).length)return!1;for(const c in f)if(!ge(f[c],n[c]))return!1;return!0}return f===n}j.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Q={create:function(f,n,c){const m=l.window.document.createElement(f);return void 0!==n&&(m.className=n),c&&c.appendChild(m),m},createSVG:function(f,n,c){const m=l.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const v of Object.keys(n))m.setAttributeNS(null,v,n[v]);return c&&c.appendChild(m),m}},Y=l.window.document&&l.window.document.documentElement.style,se=Y&&void 0!==Y.userSelect?"userSelect":"WebkitUserSelect";let ue;Q.disableDrag=function(){Y&&se&&(ue=Y[se],Y[se]="none")},Q.enableDrag=function(){Y&&se&&(Y[se]=ue)};const ye=function(f){f.preventDefault(),f.stopPropagation(),l.window.removeEventListener("click",ye,!0)};function xe(f,n,c){const m=f.offsetWidth===n.width?1:f.offsetWidth/n.width;return new l.pointGeometry((c.clientX-n.left)*m,(c.clientY-n.top)*m)}function Ee(f){const{userImage:n}=f;return!!(n&&n.render&&n.render())&&(f.data.replace(new Uint8Array(n.data.buffer)),!0)}Q.suppressClick=function(){l.window.addEventListener("click",ye,!0),l.window.setTimeout(()=>{l.window.removeEventListener("click",ye,!0)},0)},Q.mousePos=function(f,n){const c=f.getBoundingClientRect();return xe(f,c,n)},Q.touchPos=function(f,n){const c=f.getBoundingClientRect(),m=[];for(let v=0;v<n.length;v++)m.push(xe(f,c,n[v]));return m},Q.mouseButton=function(f){return void 0!==l.window.InstallTrigger&&2===f.button&&f.ctrlKey&&l.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button};class We extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:c,callback:m}of this.requestors)this._notify(c,m);this.requestors=[]}}getImage(n){return this.images[n]}addImage(n,c){this._validate(n,c)&&(this.images[n]=c)}_validate(n,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new l.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),m=!1),m}_validateStretch(n,c){if(!n)return!0;let m=0;for(const v of n){if(v[0]<m||v[1]<v[0]||c<v[1])return!1;m=v[1]}return!0}_validateContent(n,c){return!(n&&(4!==n.length||n[0]<0||c.data.width<n[0]||n[1]<0||c.data.height<n[1]||n[2]<0||c.data.width<n[2]||n[3]<0||c.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,c){c.version=this.images[n].version+1,this.images[n]=c,this.updatedImages[n]=!0}removeImage(n){const c=this.images[n];delete this.images[n],delete this.patterns[n],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,c){let m=!0;if(!this.isLoaded())for(const v of n)this.images[v]||(m=!1);this.isLoaded()||m?this._notify(n,c):this.requestors.push({ids:n,callback:c})}_notify(n,c){const m={};for(const v of n){this.images[v]||this.fire(new l.Event("styleimagemissing",{id:v}));const T=this.images[v];T?m[v]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:Boolean(T.userImage&&T.userImage.render)}:l.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,m)}getPixelSize(){const{width:n,height:c}=this.atlasImage;return{width:n,height:c}}getPattern(n){const c=this.patterns[n],m=this.getImage(n);if(!m)return null;if(c&&c.position.version===m.version)return c.position;if(c)c.position.version=m.version;else{const v={w:m.data.width+2,h:m.data.height+2,x:0,y:0},T=new l.ImagePosition(v,m);this.patterns[n]={bin:v,position:T}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const c=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.Texture(n,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const T in this.patterns)n.push(this.patterns[T].bin);const{w:c,h:m}=l.potpack(n),v=this.atlasImage;v.resize({width:c||1,height:m||1});for(const T in this.patterns){const{bin:I}=this.patterns[T],R=I.x+1,$=I.y+1,X=this.images[T].data,oe=X.width,he=X.height;l.RGBAImage.copy(X,v,{x:0,y:0},{x:R,y:$},{width:oe,height:he}),l.RGBAImage.copy(X,v,{x:0,y:he-1},{x:R,y:$-1},{width:oe,height:1}),l.RGBAImage.copy(X,v,{x:0,y:0},{x:R,y:$+he},{width:oe,height:1}),l.RGBAImage.copy(X,v,{x:oe-1,y:0},{x:R-1,y:$},{width:1,height:he}),l.RGBAImage.copy(X,v,{x:0,y:0},{x:R+oe,y:$},{width:1,height:he})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const c of n){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const m=this.images[c];Ee(m)&&this.updateImage(c,m)}}}const be=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(f,n){return function([c,m,v]){const T=l.degToRad(m+90),I=l.degToRad(v);return{x:c*Math.cos(T)*Math.sin(I),y:c*Math.sin(T)*Math.sin(I),z:c*Math.cos(I),azimuthal:m,polar:v}}(f.expression.evaluate(n))}interpolate(f,n,c){return{x:l.number(f.x,n.x,c),y:l.number(f.y,n.y,c),z:l.number(f.z,n.z,c),azimuthal:l.number(f.azimuthal,n.azimuthal,c),polar:l.number(f.polar,n.polar,c)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),Se="-transition";class ze extends l.Evented{constructor(n){super(),this._transitionable=new l.Transitionable(be),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,c={}){if(!this._validate(l.validateLight,n,c))for(const m in n){const v=n[m];l.endsWith(m,Se)?this._transitionable.setTransition(m.slice(0,-Se.length),v):this._transitionable.setValue(m,v)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,m){return(!m||!1!==m.validate)&&l.emitValidationErrors(this,n.call(l.validateStyle,l.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}const tt=new l.Properties({source:new l.DataConstantProperty(l.spec.terrain.source),exaggeration:new l.DataConstantProperty(l.spec.terrain.exaggeration)}),et="-transition";class Be extends l.Evented{constructor(n,c){super(),this._transitionable=new l.Transitionable(tt),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(n){for(const c in n){const m=n[c];l.endsWith(c,et)?this._transitionable.setTransition(c.slice(0,-et.length),m):this._transitionable.setValue(c,m)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function C(f,n,c,m){const v=l.smoothstep(45,65,c),[T,I]=Ge(f,m),R=l.length(n);let $=1-Math.min(1,Math.exp((R-T)/(I-T)*-6));return $*=$*$,$=Math.min(1,1.00747*$),$*v*f.alpha}function Ge(f,n){const c=.5/Math.tan(.5*n);return[f.range[0]+c,f.range[1]+c]}const _t=new l.Properties({range:new l.DataConstantProperty(l.spec.fog.range),color:new l.DataConstantProperty(l.spec.fog.color),"horizon-blend":new l.DataConstantProperty(l.spec.fog["horizon-blend"])}),ht="-transition";class wt extends l.Evented{constructor(n,c){super(),this._transitionable=new l.Transitionable(_t),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,c={}){if(!this._validate(l.validateFog,n,c))for(const m in n){const v=n[m];l.endsWith(m,ht)?this._transitionable.setTransition(m.slice(0,-ht.length),v):this._transitionable.setValue(m,v)}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return l.smoothstep(45,65,n)*c.a}getOpacityAtLatLng(n,c){return this._transform.projection.supportsFog?function(m,v,T){const I=l.MercatorCoordinate.fromLngLat(v),R=T.elevation?T.elevation.getAtPointOrZero(I):0,$=[I.x,I.y,R];return l.transformMat4($,$,T.mercatorFogMatrix),C(m,$,T.pitch,T._fov)}(this.state,n,c):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Ge(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,m){return(!m||!1!==m.validate)&&l.emitValidationErrors(this,n.call(l.validateStyle,l.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class xt{constructor(n,c){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const m=this.workerPool.acquire(this.id);for(let v=0;v<m.length;v++){const T=new xt.Actor(m[v],c,this.id);T.name=`Worker ${v}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,c,m){l.asyncAll(this.actors,(v,T)=>{v.send(n,c,T)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function gt(f,n,c){return n*(l.EXTENT/(f.tileSize*Math.pow(2,c-f.tileID.overscaledZ)))}xt.Actor=l.Actor;class Bt{constructor(n,c,m){this.context=n;const v=n.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ht={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Gn{constructor(n,c,m,v){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=v,this.context=n;const T=n.gl;this.buffer=T.createBuffer(),n.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,c){for(let m=0;m<this.attributes.length;m++){const v=c.attributes[this.attributes[m].name];void 0!==v&&n.enableVertexAttribArray(v)}}setVertexAttribPointers(n,c,m){for(let v=0;v<this.attributes.length;v++){const T=this.attributes[v],I=c.attributes[T.name];void 0!==I&&n.vertexAttribPointer(I,T.components,n[Ht[T.type]],!1,this.itemSize,T.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class It{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class jt extends It{getDefault(){return l.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ut extends It{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Yt extends It{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class zt extends It{getDefault(){return[!0,!0,!0,!0]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Zt extends It{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class ln extends It{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class xn extends It{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const c=this.current;(n.func!==c.func||n.ref!==c.ref||n.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class an extends It{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Kt extends It{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=n,this.dirty=!1}}class mt extends It{getDefault(){return[0,1]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Wt extends It{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=n,this.dirty=!1}}class On extends It{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class bn extends It{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.BLEND):c.disable(c.BLEND),this.current=n,this.dirty=!1}}class jn extends It{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class li extends It{getDefault(){return l.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class $i extends It{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class rr extends It{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=n,this.dirty=!1}}class Bi extends It{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class _i extends It{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class tr extends It{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class gi extends It{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Ti extends It{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Xt extends It{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Oe extends It{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class ae extends It{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Re extends It{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class lt extends It{getDefault(){return null}set(n){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Le extends It{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Rt extends It{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class me extends It{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class He extends It{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Ft extends It{constructor(n,c){super(n),this.context=n,this.parent=c}getDefault(){return null}}class Qt extends Ft{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Jn extends Ft{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ki extends Jn{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Di{constructor(n,c,m,v){this.context=n,this.width=c,this.height=m;const T=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Qt(n,T),v&&(this.depthAttachment=new Jn(n,T))}destroy(){const n=this.context.gl,c=this.colorAttachment.get();if(c&&n.deleteTexture(c),this.depthAttachment){const m=this.depthAttachment.get();m&&n.deleteRenderbuffer(m)}n.deleteFramebuffer(this.framebuffer)}}class mi{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new jt(this),this.clearDepth=new Ut(this),this.clearStencil=new Yt(this),this.colorMask=new zt(this),this.depthMask=new Zt(this),this.stencilMask=new ln(this),this.stencilFunc=new xn(this),this.stencilOp=new an(this),this.stencilTest=new Kt(this),this.depthRange=new mt(this),this.depthTest=new Wt(this),this.depthFunc=new On(this),this.blend=new bn(this),this.blendFunc=new jn(this),this.blendColor=new li(this),this.blendEquation=new $i(this),this.cullFace=new rr(this),this.cullFaceSide=new Bi(this),this.frontFace=new _i(this),this.program=new tr(this),this.activeTexture=new gi(this),this.viewport=new Ti(this),this.bindFramebuffer=new Xt(this),this.bindRenderbuffer=new Oe(this),this.bindTexture=new ae(this),this.bindVertexBuffer=new Re(this),this.bindElementBuffer=new lt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Le(this),this.pixelStoreUnpack=new Rt(this),this.pixelStoreUnpackPremultiplyAlpha=new me(this),this.pixelStoreUnpackFlipY=new He(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,c){return new Bt(this,n,c)}createVertexBuffer(n,c,m){return new Gn(this,n,c,m)}createRenderbuffer(n,c,m){const v=this.gl,T=v.createRenderbuffer();return this.bindRenderbuffer.set(T),v.renderbufferStorage(v.RENDERBUFFER,n,c,m),this.bindRenderbuffer.set(null),T}createFramebuffer(n,c,m){return new Di(this,n,c,m)}clear({color:n,depth:c,stencil:m}){const v=this.gl;let T=0;n&&(T|=v.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(T|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==m&&(T|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),v.clear(T)}setCullFace(n){!1===n.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){ge(n.blendFunction,l.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ci{constructor(n,c,m,v){this.screenBounds=n,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(T=>v.pointCoordinate3D(T)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(n,c){let m,v;if(n instanceof l.pointGeometry||"number"==typeof n[0]){const T=l.pointGeometry.convert(n);m=[l.pointGeometry.convert(n)],v=c.isPointAboveHorizon(T)}else{const T=l.pointGeometry.convert(n[0]),I=l.pointGeometry.convert(n[1]);m=[T,I],v=l.polygonizeBounds(T,I).every(R=>c.isPointAboveHorizon(R))}return new ci(m,c.getCameraPoint(),v,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(n){return l.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const c=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new l.pointGeometry(1,1)):this.screenBounds[1],v=l.polygonizeBounds(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?v[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(v[3]=this.cameraPoint)),l.bufferConvexPolygon(v,n)}containsTile(n,c,m){const v=n.queryPadding+1,T=n.tileID.wrap,I=m?this._bufferedCameraMercator(v,c).map(Ue=>l.getTilePoint(n.tileTransform,Ue,T)):this._bufferedScreenMercator(v,c).map(Ue=>l.getTilePoint(n.tileTransform,Ue,T)),R=this.screenGeometryMercator.map(Ue=>l.getTileVec3(n.tileTransform,Ue,T)),$=R.map(Ue=>new l.pointGeometry(Ue[0],Ue[1])),X=c.getFreeCameraOptions().position||new l.MercatorCoordinate(0,0,0),oe=l.getTileVec3(n.tileTransform,X,T),he=R.map(Ue=>{const je=l.sub(Ue,Ue,oe);return l.normalize(je,je),new l.Ray(oe,je)}),Me=gt(n,1,c.zoom);if(l.polygonIntersectsBox(I,0,0,l.EXTENT,l.EXTENT))return{queryGeometry:this,tilespaceGeometry:$,tilespaceRays:he,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:($e=l.getBounds(I),$e.min.x=l.clamp($e.min.x,0,l.EXTENT),$e.min.y=l.clamp($e.min.y,0,l.EXTENT),$e.max.x=l.clamp($e.max.x,0,l.EXTENT),$e.max.y=l.clamp($e.max.y,0,l.EXTENT),$e),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:Me};var $e}_bufferedScreenMercator(n,c){const m=xr(n);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{const v=this.bufferedScreenGeometry(n).map(T=>c.pointCoordinate3D(T));return this._screenRaycastCache[m]=v,v}}_bufferedCameraMercator(n,c){const m=xr(n);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{const v=this.bufferedCameraGeometry(n).map(T=>c.pointCoordinate3D(T));return this._cameraRaycastCache[m]=v,v}}}function xr(f){return 100*f|0}function Ii(f,n,c){const m=function(v,T){if(v)return c(v);if(T){const I=l.pick(l.extend(T,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(I.vectorLayers=T.vector_layers,I.vectorLayerIds=I.vectorLayers.map(R=>R.id)),I.tiles=n.canonicalizeTileset(I,f.url),c(null,I)}};return f.url?l.getJSON(n.transformRequest(n.normalizeSourceURL(f.url),l.ResourceType.Source),m):l.exported.frame(()=>m(null,f))}class hr{constructor(n,c,m){this.bounds=l.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=c||0,this.maxzoom=m||24}validateBounds(n){return Array.isArray(n)&&4===n.length?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const c=Math.pow(2,n.z),m=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*c),v=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*c),T=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*c),I=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*c);return n.x>=m&&n.x<T&&n.y>=v&&n.y<I}}class yi extends l.Evented{constructor(n,c,m,v){super(),this.id=n,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},c),l.extend(this,l.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ii(this._options,this.map._requestManager,(n,c)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new l.ErrorEvent(n)):c&&(l.extend(this,c),c.bounds&&(this.tileBounds=new hr(c.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(c.tiles),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,c){const m=l.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);n.request=l.getImage(this.map._requestManager.transformRequest(v,l.ResourceType.Tile),(T,I,R,$)=>{if(delete n.request,n.aborted)n.state="unloaded",c(null);else if(T)n.state="errored",c(T);else if(I){this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:R,expires:$});const X=this.map.painter.context,oe=X.gl;n.texture=this.map.painter.getTileTexture(I.width),n.texture?n.texture.update(I,{useMipmap:!0}):(n.texture=new l.Texture(X,I,oe.RGBA,{useMipmap:!0}),n.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),X.extTextureFilterAnisotropic&&oe.texParameterf(oe.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax)),n.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),c(null)}})}abortTile(n,c){n.request&&(n.request.cancel(),delete n.request),c()}unloadTile(n,c){n.texture&&this.map.painter.saveTileTexture(n.texture),c()}hasTransition(){return!1}}let kr;function gr(f,n,c,m,v,T,I,R){const $=[f,c,v,n,m,T,1,1,1],X=[I,R,1],oe=l.adjoint([],$),[he,Me,$e]=l.transformMat3(X,X,l.transpose(oe,oe));return l.multiply($,[he,0,0,0,Me,0,0,0,$e],$)}class Tr extends l.Evented{constructor(n,c,m,v){super(),this.id=n,this.dispatcher=m,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=c}load(n,c){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(m,v)=>{this._loaded=!0,m?this.fire(new l.ErrorEvent(m)):v&&(this.image=l.exported.getImageData(v),this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}setCoordinates(n){this.coordinates=n,delete this._boundsArray;const c=n.map(l.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let v=1/0,T=1/0,I=-1/0,R=-1/0;for(const he of m)v=Math.min(v,he.x),T=Math.min(T,he.y),I=Math.max(I,he.x),R=Math.max(R,he.y);const $=Math.max(I-v,R-T),X=Math.max(0,Math.floor(-Math.log($)/Math.LN2)),oe=Math.pow(2,X);return new l.CanonicalTileID(X,Math.floor((v+I)/2*oe),Math.floor((T+R)/2*oe))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const n=l.tileTransform(this.tileID,this.map.transform.projection),[c,m,v,T]=this.coordinates.map(I=>{const R=n.projection.project(I[0],I[1]);return l.getTilePoint(n,R)._round()});return this.perspectiveTransform=function(I,R,$,X,oe,he,Me,$e,Ue,je){const at=gr(0,0,I,0,0,R,I,R),Ze=gr($,X,oe,he,Me,$e,Ue,je);return l.multiply(Ze,l.adjoint(at,at),Ze),[Ze[6]/Ze[8]*I/l.EXTENT,Ze[7]/Ze[8]*R/l.EXTENT]}(this.width,this.height,c.x,c.y,m.x,m.y,T.x,T.y,v.x,v.y),this._boundsArray=new l.StructArrayLayout4i8,this._boundsArray.emplaceBack(c.x,c.y,0,0),this._boundsArray.emplaceBack(m.x,m.y,l.EXTENT,0),this._boundsArray.emplaceBack(T.x,T.y,0,l.EXTENT),this._boundsArray.emplaceBack(v.x,v.y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const n=this.map.painter.context,c=n.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,l.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new l.Texture(n,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const m in this.tiles){const v=this.tiles[m];"loaded"!==v.state&&(v.state="loaded",v.texture=this.texture)}}loadTile(n,c){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},c(null)):(n.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ci={vector:class extends l.Evented{constructor(f,n,c,m){if(super(),this.id=f,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(n,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new l.DedupedRequest}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ii(this._options,this.map._requestManager,(f,n)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new l.ErrorEvent(f)):n&&(l.extend(this,n),n.bounds&&(this.tileBounds=new hr(n.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(n.tiles,this.map._requestManager._customAccessToken),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}setSourceProperty(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f();const n=this.map.style._getSourceCaches(this.id);for(const c of n)c.clearTiles();this.load()}setTiles(f){return this.setSourceProperty(()=>{this._options.tiles=f}),this}setUrl(f){return this.setSourceProperty(()=>{this.url=f,this._options.url=f}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(f,n){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(c,l.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,f.actor&&"expired"!==f.state)"loading"===f.state?f.reloadCallback=n:f.request=f.actor.send("reloadTile",m,v.bind(this));else if(f.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",m,v.bind(this),void 0,!0);else{const T=l.loadVectorTile.call({deduped:this._deduped},m,(I,R)=>{I||!R?v.call(this,I):(m.data={cacheControl:R.cacheControl,expires:R.expires,rawData:R.rawData.slice(0)},f.actor&&f.actor.send("loadTile",m,v.bind(this),void 0,!0))},!0);f.request={cancel:T}}function v(T,I){return delete f.request,f.aborted?n(null):T&&404!==T.status?n(T):(I&&I.resourceTiming&&(f.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&f.setExpiryData(I),f.loadVectorData(I,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:yi,"raster-dem":class extends yi{constructor(f,n,c,m){super(f,n,c,m),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(f,n){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(v,T){v&&(f.state="errored",n(v)),T&&(f.dem=T,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",n(null))}f.request=l.getImage(this.map._requestManager.transformRequest(c,l.ResourceType.Tile),function(v,T,I,R){if(delete f.request,f.aborted)f.state="unloaded",n(null);else if(v)f.state="errored",n(v);else if(T){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:I,expires:R});const $=l.window.ImageBitmap&&T instanceof l.window.ImageBitmap&&(null==kr&&(kr=l.window.OffscreenCanvas&&new l.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof l.window.createImageBitmap),kr),X=1-(T.width-l.prevPowerOfTwo(T.width))/2;X<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const oe=$?T:l.exported.getImageData(T,X),he={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:oe,encoding:this.encoding,padding:X};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",he,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const n=f.canonical,c=Math.pow(2,n.z),m=(n.x-1+c)%c,v=0===n.x?f.wrap-1:f.wrap,T=(n.x+1+c)%c,I=n.x+1===c?f.wrap+1:f.wrap,R={};return R[new l.OverscaledTileID(f.overscaledZ,v,n.z,m,n.y).key]={backfilled:!1},R[new l.OverscaledTileID(f.overscaledZ,I,n.z,T,n.y).key]={backfilled:!1},n.y>0&&(R[new l.OverscaledTileID(f.overscaledZ,v,n.z,m,n.y-1).key]={backfilled:!1},R[new l.OverscaledTileID(f.overscaledZ,f.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},R[new l.OverscaledTileID(f.overscaledZ,I,n.z,T,n.y-1).key]={backfilled:!1}),n.y+1<c&&(R[new l.OverscaledTileID(f.overscaledZ,v,n.z,m,n.y+1).key]={backfilled:!1},R[new l.OverscaledTileID(f.overscaledZ,f.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},R[new l.OverscaledTileID(f.overscaledZ,I,n.z,T,n.y+1).key]={backfilled:!1}),R}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends l.Evented{constructor(f,n,c,m){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=n.data,this._options=l.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const v=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*v,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*v,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:l.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*v,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},n),this}getClusterChildren(f,n){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},n),this}getClusterLeaves(f,n,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:n,offset:c},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new l.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=l.extend({},this.workerOptions),n=this._data;"string"==typeof n?(f.request=this.map._requestManager.transformRequest(l.exported.resolveURL(n),l.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new l.ErrorEvent(c));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(v.resourceTiming=m.resourceTiming[this.id]),this.fire(new l.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,n){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(c,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,v)=>(delete f.request,f.unloadVectorData(),f.aborted?n(null):m?n(m):(f.loadVectorData(v,this.map.painter,"reloadTile"===c),n(null))),void 0,"loadTile"===c)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Tr{constructor(f,n,c,m){super(f,n,c,m),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const n of f.urls)this.urls.push(this.map._requestManager.transformRequest(n,l.ResourceType.Source).url);l.getVideo(this.urls,(n,c)=>{this._loaded=!0,n?this.fire(new l.ErrorEvent(n)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const n=this.video.seekable;f<n.start(0)||f>n.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,n=f.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new l.Texture(f,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,l.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2));for(const c in this.tiles){const m=this.tiles[c];"loaded"!==m.state&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Tr,canvas:class extends Tr{constructor(f,n,c,m){super(f,n,c,m),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(T=>"number"!=typeof T))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof l.window.HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof l.window.HTMLCanvasElement?this.options.canvas:l.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,c=n.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,l.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.Texture(n,this.canvas,c.RGBA,{premultiply:!0});for(const m in this.tiles){const v=this.tiles[m];"loaded"!==v.state&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}}},Oi=function(f,n,c,m){const v=new Ci[n.type](f,n,c,m);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],v),v};function K(f,n){const c=l.identity([]);return l.scale(c,c,[.5*f.width,.5*-f.height,1]),l.translate(c,c,[1,-1,0]),l.multiply$1(c,c,f.calculateProjMatrix(n.toUnwrapped()))}function q(f,n,c,m,v,T,I,R=!1){const $=f.tilesIn(m,I,R);$.sort(de);const X=[];for(const he of $)X.push({wrappedTileID:he.tile.tileID.wrapped().key,queryResults:he.tile.queryRenderedFeatures(n,c,f._state,he,v,T,K(f.transform,he.tile.tileID),R)});const oe=function(he){const Me={},$e={};for(const Ue of he){const je=Ue.queryResults,at=Ue.wrappedTileID,Ze=$e[at]=$e[at]||{};for(const ot in je){const ut=je[ot],it=Ze[ot]=Ze[ot]||{},rt=Me[ot]=Me[ot]||[];for(const ft of ut)it[ft.featureIndex]||(it[ft.featureIndex]=!0,rt.push(ft))}}return Me}(X);for(const he in oe)oe[he].forEach(Me=>{const $e=Me.feature,Ue=f.getFeatureState($e.layer["source-layer"],$e.id);$e.source=$e.layer.source,$e.layer["source-layer"]&&($e.sourceLayer=$e.layer["source-layer"]),$e.state=Ue});return oe}function L(f,n){const c=f.getRenderableIds().map(T=>f.getTileByID(T)),m=[],v={};for(let T=0;T<c.length;T++){const I=c[T],R=I.tileID.canonical.key;v[R]||(v[R]=!0,I.querySourceFeatures(m,n))}return m}function de(f,n){const c=f.tileID,m=n.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}function we(){return null!=Bl.workerClass?new Bl.workerClass:new l.window.Worker(Bl.workerUrl)}const Ye="mapboxgl_preloaded_worker_pool";class pt{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<pt.workerCount;)this.workers.push(new we);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ye]}numActive(){return Object.keys(this.active).length}}let Ct;function Je(){return Ct||(Ct=new pt),Ct}function Lt(f,n){const c={};for(const m in f)"ref"!==m&&(c[m]=f[m]);return l.refProperties.forEach(m=>{m in n&&(c[m]=n[m])}),c}function en(f){f=f.slice();const n=Object.create(null);for(let c=0;c<f.length;c++)n[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=Lt(f[c],n[f[c].ref]));return f}pt.workerCount=2;const Gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function At(f,n,c){c.push({command:Gt.addSource,args:[f,n[f]]})}function Pn(f,n,c){n.push({command:Gt.removeSource,args:[f]}),c[f]=!0}function Vn(f,n,c,m){Pn(f,c,m),At(f,n,c)}function Yn(f,n,c){let m;for(m in f[c])if(f[c].hasOwnProperty(m)&&"data"!==m&&!ge(f[c][m],n[c][m]))return!1;for(m in n[c])if(n[c].hasOwnProperty(m)&&"data"!==m&&!ge(f[c][m],n[c][m]))return!1;return!0}function qn(f,n,c,m,v,T){let I;for(I in n=n||{},f=f||{})f.hasOwnProperty(I)&&(ge(f[I],n[I])||c.push({command:T,args:[m,I,n[I],v]}));for(I in n)n.hasOwnProperty(I)&&!f.hasOwnProperty(I)&&(ge(f[I],n[I])||c.push({command:T,args:[m,I,n[I],v]}))}function ni(f){return f.id}function Li(f,n){return f[n.id]=n,f}class Mi{constructor(n,c){this.reset(n,c)}reset(n,c){this.points=n||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(1===this.points.length)return this.points[0];n=l.clamp(n,0,1);let c=1,m=this._distances[c];const v=n*this.paddedLength+this.padding;for(;m<v&&c<this._distances.length;)m=this._distances[++c];const T=c-1,I=this._distances[T],R=m-I,$=R>0?(v-I)/R:0;return this.points[T].mult(1-$).add(this.points[c].mult($))}}class di{constructor(n,c,m){const v=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(n/m),this.yCellCount=Math.ceil(c/m);for(let I=0;I<this.xCellCount*this.yCellCount;I++)v.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=c,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,c,m,v,T){this._forEachCell(c,m,v,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(T)}insertCircle(n,c,m,v){this._forEachCell(c-v,m-v,c+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(c),this.circles.push(m),this.circles.push(v)}_insertBoxCell(n,c,m,v,T,I){this.boxCells[T].push(I)}_insertCircleCell(n,c,m,v,T,I){this.circleCells[T].push(I)}_query(n,c,m,v,T,I){if(m<0||n>this.width||v<0||c>this.height)return!T&&[];const R=[];if(n<=0&&c<=0&&this.width<=m&&this.height<=v){if(T)return!0;for(let $=0;$<this.boxKeys.length;$++)R.push({key:this.boxKeys[$],x1:this.bboxes[4*$],y1:this.bboxes[4*$+1],x2:this.bboxes[4*$+2],y2:this.bboxes[4*$+3]});for(let $=0;$<this.circleKeys.length;$++){const X=this.circles[3*$],oe=this.circles[3*$+1],he=this.circles[3*$+2];R.push({key:this.circleKeys[$],x1:X-he,y1:oe-he,x2:X+he,y2:oe+he})}return I?R.filter(I):R}return this._forEachCell(n,c,m,v,this._queryCell,R,{hitTest:T,seenUids:{box:{},circle:{}}},I),T?R.length>0:R}_queryCircle(n,c,m,v,T){const I=n-m,R=n+m,$=c-m,X=c+m;if(R<0||I>this.width||X<0||$>this.height)return!v&&[];const oe=[];return this._forEachCell(I,$,R,X,this._queryCellCircle,oe,{hitTest:v,circle:{x:n,y:c,radius:m},seenUids:{box:{},circle:{}}},T),v?oe.length>0:oe}query(n,c,m,v,T){return this._query(n,c,m,v,!1,T)}hitTest(n,c,m,v,T){return this._query(n,c,m,v,!0,T)}hitTestCircle(n,c,m,v){return this._queryCircle(n,c,m,!0,v)}_queryCell(n,c,m,v,T,I,R,$){const X=R.seenUids,oe=this.boxCells[T];if(null!==oe){const Me=this.bboxes;for(const $e of oe)if(!X.box[$e]){X.box[$e]=!0;const Ue=4*$e;if(n<=Me[Ue+2]&&c<=Me[Ue+3]&&m>=Me[Ue+0]&&v>=Me[Ue+1]&&(!$||$(this.boxKeys[$e]))){if(R.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[$e],x1:Me[Ue],y1:Me[Ue+1],x2:Me[Ue+2],y2:Me[Ue+3]})}}}const he=this.circleCells[T];if(null!==he){const Me=this.circles;for(const $e of he)if(!X.circle[$e]){X.circle[$e]=!0;const Ue=3*$e;if(this._circleAndRectCollide(Me[Ue],Me[Ue+1],Me[Ue+2],n,c,m,v)&&(!$||$(this.circleKeys[$e]))){if(R.hitTest)return I.push(!0),!0;{const je=Me[Ue],at=Me[Ue+1],Ze=Me[Ue+2];I.push({key:this.circleKeys[$e],x1:je-Ze,y1:at-Ze,x2:je+Ze,y2:at+Ze})}}}}}_queryCellCircle(n,c,m,v,T,I,R,$){const X=R.circle,oe=R.seenUids,he=this.boxCells[T];if(null!==he){const $e=this.bboxes;for(const Ue of he)if(!oe.box[Ue]){oe.box[Ue]=!0;const je=4*Ue;if(this._circleAndRectCollide(X.x,X.y,X.radius,$e[je+0],$e[je+1],$e[je+2],$e[je+3])&&(!$||$(this.boxKeys[Ue])))return I.push(!0),!0}}const Me=this.circleCells[T];if(null!==Me){const $e=this.circles;for(const Ue of Me)if(!oe.circle[Ue]){oe.circle[Ue]=!0;const je=3*Ue;if(this._circlesCollide($e[je],$e[je+1],$e[je+2],X.x,X.y,X.radius)&&(!$||$(this.circleKeys[Ue])))return I.push(!0),!0}}}_forEachCell(n,c,m,v,T,I,R,$){const X=this._convertToXCellCoord(n),oe=this._convertToYCellCoord(c),he=this._convertToXCellCoord(m),Me=this._convertToYCellCoord(v);for(let $e=X;$e<=he;$e++)for(let Ue=oe;Ue<=Me;Ue++)if(T.call(this,n,c,m,v,this.xCellCount*Ue+$e,I,R,$))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,c,m,v,T,I){const R=v-n,$=T-c,X=m+I;return X*X>R*R+$*$}_circleAndRectCollide(n,c,m,v,T,I,R){const $=(I-v)/2,X=Math.abs(n-(v+$));if(X>$+m)return!1;const oe=(R-T)/2,he=Math.abs(c-(T+oe));if(he>oe+m)return!1;if(X<=$||he<=oe)return!0;const Me=X-$,$e=he-oe;return Me*Me+$e*$e<=m*m}}const En=Math.tan(85*Math.PI/180);function ti(f,n,c,m,v,T){let I=l.create();if(c){if("globe"===v.projection.name)I=l.calculateGlobeMatrix(v,v.worldSize/v._projectionScaler,[0,0]),l.multiply$1(I,I,l.globeDenormalizeECEF(l.globeTileBounds(n)));else{const R=ne([],T);I[0]=R[0],I[1]=R[1],I[4]=R[2],I[5]=R[3]}m||l.rotateZ(I,I,v.angle)}else l.multiply$1(I,v.labelPlaneMatrix,f);return I}function Yi(f,n,c,m,v,T){if(c){if("globe"===v.projection.name){const I=ti(f,n,c,m,v,T);return l.invert(I,I),l.multiply$1(I,f,I),I}{const I=l.clone(f),R=l.identity([]);return R[0]=T[0],R[1]=T[1],R[4]=T[2],R[5]=T[3],l.multiply$1(I,I,R),m||l.rotateZ(I,I,-v.angle),I}}return v.glCoordMatrix}function Ni(f,n,c=0){const m=[f.x,f.y,c,1];c?l.transformMat4$1(m,m,n):Cr(m,m,n);const v=m[3];return{point:new l.pointGeometry(m[0]/v,m[1]/v),signedDistanceFromCamera:v}}function pr(f,n){return Math.min(.5+f/n*.5,1.5)}function oi(f,n){const c=f[0]/f[3],m=f[1]/f[3];return c>=-n[0]&&c<=n[0]&&m>=-n[1]&&m<=n[1]}function fr(f,n,c,m,v,T,I,R,$,X){const oe=c.transform,he=m?f.textSizeData:f.iconSizeData,Me=l.evaluateSizeForZoom(he,c.transform.zoom),$e=[256/c.width*2+1,256/c.height*2+1],Ue=m?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Ue.clear();const je=f.lineVertexArray,at=m?f.text.placedSymbolArray:f.icon.placedSymbolArray,Ze=c.transform.width/c.transform.height;let ot=!1;for(let ut=0;ut<at.length;ut++){const it=at.get(ut);if(it.writingMode!==l.WritingMode.vertical||ot||0!==ut&&at.get(ut-1).writingMode===l.WritingMode.horizontal||(ot=!0),it.hidden||it.writingMode===l.WritingMode.vertical&&!ot){Pr(it.numGlyphs,Ue);continue}ot=!1;const rt=new l.pointGeometry(it.tileAnchorX,it.tileAnchorY),ft=$?$(rt):[0,0,0],$t=oe.projection.projectTilePoint(rt.x,rt.y,X.canonical),tn=[$t.x+ft[0],$t.y+ft[1],$t.z+ft[2]],Nn=[...tn,1];if(l.transformMat4$1(Nn,Nn,n),!oi(Nn,$e)){Pr(it.numGlyphs,Ue);continue}const Dn=pr(c.transform.cameraToCenterDistance,Nn[3]),Tn=l.evaluateSizeForFeature(he,Me,it),cn=I?Tn/Dn:Tn*Dn,Jt=Ni(new l.pointGeometry(tn[0],tn[1]),v,tn[2]);if(Jt.signedDistanceFromCamera<=0){Pr(it.numGlyphs,Ue);continue}let yn={};const mn=I?null:$,ui=wo(it,cn,!1,R,n,v,T,f.glyphOffsetArray,je,Ue,Jt.point,rt,yn,Ze,mn,oe.projection,X);ot=ui.useVertical,mn&&ui.needsFlipping&&(yn={}),(ui.notEnoughRoom||ot||ui.needsFlipping&&wo(it,cn,!0,R,n,v,T,f.glyphOffsetArray,je,Ue,Jt.point,rt,yn,Ze,mn,oe.projection,X).notEnoughRoom)&&Pr(it.numGlyphs,Ue)}m?f.text.dynamicLayoutVertexBuffer.updateData(Ue):f.icon.dynamicLayoutVertexBuffer.updateData(Ue)}function or(f,n,c,m,v,T,I,R,$,X,oe,he,Me,$e,Ue){const je=R.glyphStartIndex+R.numGlyphs,at=R.lineStartIndex,Ze=R.lineStartIndex+R.lineLength,ot=n.getoffsetX(R.glyphStartIndex),ut=n.getoffsetX(je-1),it=$r(f*ot,c,m,v,T,I,R.segment,at,Ze,$,X,oe,he,Me,!0,$e,Ue);if(!it)return null;const rt=$r(f*ut,c,m,v,T,I,R.segment,at,Ze,$,X,oe,he,Me,!0,$e,Ue);return rt?{first:it,last:rt}:null}function Sr(f,n,c,m){return f.writingMode===l.WritingMode.horizontal&&Math.abs(c.y-n.y)>Math.abs(c.x-n.x)*m?{useVertical:!0}:f.writingMode===l.WritingMode.vertical?n.y<c.y?{needsFlipping:!0}:null:0!==f.flipState&&function(v,T,I){const R=(T.x-v.x)*I;return 0===R||Math.abs((T.y-v.y)/R)>En}(n,c,m)?1===f.flipState?{needsFlipping:!0}:null:n.x>c.x?{needsFlipping:!0}:null}function wo(f,n,c,m,v,T,I,R,$,X,oe,he,Me,$e,Ue,je,at){const Ze=n/24,ot=f.lineOffsetX*Ze,ut=f.lineOffsetY*Ze;let it;if(f.numGlyphs>1){const rt=f.glyphStartIndex+f.numGlyphs,ft=f.lineStartIndex,$t=f.lineStartIndex+f.lineLength,tn=or(Ze,R,ot,ut,c,oe,he,f,$,T,Me,Ue,!1,je,at);if(!tn)return{notEnoughRoom:!0};const Nn=Ni(tn.first.point,I).point,Dn=Ni(tn.last.point,I).point;if(m&&!c){const Tn=Sr(f,Nn,Dn,$e);if(f.flipState=Tn&&Tn.needsFlipping?1:2,Tn)return Tn}it=[tn.first];for(let Tn=f.glyphStartIndex+1;Tn<rt-1;Tn++)it.push($r(Ze*R.getoffsetX(Tn),ot,ut,c,oe,he,f.segment,ft,$t,$,T,Me,Ue,!1,!1,je,at));it.push(tn.last)}else{if(m&&!c){const ft=Ni(he,v).point,$t=f.lineStartIndex+f.segment+1,tn=new l.pointGeometry($.getx($t),$.gety($t)),Nn=Ni(tn,v),Dn=Sr(f,ft,Nn.signedDistanceFromCamera>0?Nn.point:io(he,tn,ft,1,v,void 0,je,at.canonical),$e);if(f.flipState=Dn&&Dn.needsFlipping?1:2,Dn)return Dn}const rt=$r(Ze*R.getoffsetX(f.glyphStartIndex),ot,ut,c,oe,he,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,$,T,Me,Ue,!1,!1,je,at);if(!rt)return{notEnoughRoom:!0};it=[rt]}for(const rt of it)l.addDynamicAttributes(X,rt.point,rt.angle);return{}}function xi(f,n,c,m,v){const T=m.projectTilePoint(f.x,f.y,n);if(!v)return Ni(T,c,T.z);const I=v(f);return Ni(new l.pointGeometry(T.x+I[0],T.y+I[1]),c,T.z+I[2])}function io(f,n,c,m,v,T,I,R){const $=xi(f.add(f.sub(n)._unit()),R,v,I,T).point,X=c.sub($);return c.add(X._mult(m/X.mag()))}function $r(f,n,c,m,v,T,I,R,$,X,oe,he,Me,$e,Ue,je,at){const Ze=m?f-n:f+n;let ot=Ze>0?1:-1,ut=0;m&&(ot*=-1,ut=Math.PI),ot<0&&(ut+=Math.PI);let it=ot>0?R+I:R+I+1,rt=v,ft=v,$t=0,tn=0;const Nn=Math.abs(Ze),Dn=[],Tn=[];let cn=T;const Jt=()=>{const Bn=it-ot;return 0===$t?T:new l.pointGeometry(X.getx(Bn),X.gety(Bn))},yn=()=>io(Jt(),cn,ft,Nn-$t+1,oe,Me,je,at.canonical);for(;$t+tn<=Nn;){if(it+=ot,it<R||it>=$)return null;if(ft=rt,Dn.push(rt),$e&&Tn.push(cn||Jt()),rt=he[it],void 0===rt){cn=new l.pointGeometry(X.getx(it),X.gety(it));const Bn=xi(cn,at.canonical,oe,je,Me);rt=Bn.signedDistanceFromCamera>0?he[it]=Bn.point:yn()}else cn=null;$t+=tn,tn=ft.dist(rt)}Ue&&Me&&(cn=cn||new l.pointGeometry(X.getx(it),X.gety(it)),he[it]=rt=void 0===he[it]?rt:yn(),tn=ft.dist(rt));const mn=(Nn-$t)/tn,ui=rt.sub(ft),Ei=ui.mult(mn)._add(ft);c&&Ei._add(ui._unit()._perp()._mult(c*ot));const nr=ut+Math.atan2(rt.y-ft.y,rt.x-ft.x);return Dn.push(Ei),$e&&(cn=cn||new l.pointGeometry(X.getx(it),X.gety(it)),Tn.push(function(Bn,vi,qi){const Mr=1-qi;return new l.pointGeometry(Bn.x*Mr+vi.x*qi,Bn.y*Mr+vi.y*qi)}(Tn.length>0?Tn[Tn.length-1]:cn,cn,mn))),{point:Ei,angle:nr,path:Dn,tilePath:Tn}}const jr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Pr(f,n){for(let c=0;c<f;c++){const m=n.length;n.resize(m+4),n.float32.set(jr,3*m)}}function Cr(f,n,c){const m=n[0],v=n[1];return f[0]=c[0]*m+c[4]*v+c[12],f[1]=c[1]*m+c[5]*v+c[13],f[3]=c[3]*m+c[7]*v+c[15],f}const to=100;class Ie{constructor(n,c,m=new di(n.width+200,n.height+200,25),v=new di(n.width+200,n.height+200,25)){this.transform=n,this.grid=m,this.ignoredGrid=v,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+to,this.screenBottomBoundary=n.height+to,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=c}placeCollisionBox(n,c,m,v,T,I,R){let $=c.projectedAnchorX,X=c.projectedAnchorY,oe=c.projectedAnchorZ;const he=c.elevation,Me=c.tileID;if(he&&Me){const it=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),rt=it.upVector(Me.canonical,c.tileAnchorX,c.tileAnchorY),ft=it.upVectorScale(Me.canonical);$+=rt[0]*he*ft,X+=rt[1]*he*ft,oe+=rt[2]*he*ft}const $e=this.projectAndGetPerspectiveRatio(I,$,X,oe,c.tileID),Ue=T*$e.perspectiveRatio,je=(c.x1*n+m.x-c.padding)*Ue+$e.point.x,at=(c.y1*n+m.y-c.padding)*Ue+$e.point.y,Ze=(c.x2*n+m.x+c.padding)*Ue+$e.point.x,ot=(c.y2*n+m.y+c.padding)*Ue+$e.point.y,ut=$e.perspectiveRatio<=.55||$e.aboveHorizon;return!this.isInsideGrid(je,at,Ze,ot)||!v&&this.grid.hitTest(je,at,Ze,ot,R)||ut?{box:[],offscreen:!1}:{box:[je,at,Ze,ot],offscreen:this.isOffscreen(je,at,Ze,ot)}}placeCollisionCircles(n,c,m,v,T,I,R,$,X,oe,he,Me,$e,Ue){const je=[],at=this.transform.elevation,Ze=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),ot=at?at.getAtTileOffsetFunc(Ue,Ze):mn=>[0,0,0],ut=new l.pointGeometry(c.tileAnchorX,c.tileAnchorY),it=this.transform.projection.projectTilePoint(c.tileAnchorX,c.tileAnchorY,Ue.canonical),rt=ot(ut),ft=[it.x+rt[0],it.y+rt[1],it.z+rt[2]],$t=this.projectAndGetPerspectiveRatio(I,ft[0],ft[1],ft[2],Ue),{perspectiveRatio:tn}=$t,Nn=(oe?T/tn:T*tn)/l.ONE_EM,Dn=Ni(new l.pointGeometry(ft[0],ft[1]),R,ft[2]).point,Tn=$t.signedDistanceFromCamera>0?or(Nn,v,c.lineOffsetX*Nn,c.lineOffsetY*Nn,!1,Dn,ut,c,m,R,{},at&&!oe?ot:null,oe&&!!at,this.transform.projection,Ue):null;let cn=!1,Jt=!1,yn=!0;if(Tn&&!$t.aboveHorizon){const mn=.5*Me*tn+$e,ui=new l.pointGeometry(-100,-100),Ei=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),nr=new Mi,Bn=Tn.first,vi=Tn.last;let qi=[];for(let Zi=Bn.path.length-1;Zi>=1;Zi--)qi.push(Bn.path[Zi]);for(let Zi=1;Zi<vi.path.length;Zi++)qi.push(vi.path[Zi]);const Mr=2.5*mn;if($){const Zi=qi.map(at?(Pi,ho)=>{const es=ot(ho<Bn.path.length-1?Bn.tilePath[Bn.path.length-1-ho]:vi.tilePath[ho-Bn.path.length+2]);return Ni(Pi,$,es[2])}:Pi=>Ni(Pi,$));qi=Zi.some(Pi=>Pi.signedDistanceFromCamera<=0)?[]:Zi.map(Pi=>Pi.point)}let Qr=[];if(qi.length>0){const Zi=qi[0].clone(),Pi=qi[0].clone();for(let ho=1;ho<qi.length;ho++)Zi.x=Math.min(Zi.x,qi[ho].x),Zi.y=Math.min(Zi.y,qi[ho].y),Pi.x=Math.max(Pi.x,qi[ho].x),Pi.y=Math.max(Pi.y,qi[ho].y);Qr=Zi.x>=ui.x&&Pi.x<=Ei.x&&Zi.y>=ui.y&&Pi.y<=Ei.y?[qi]:Pi.x<ui.x||Zi.x>Ei.x||Pi.y<ui.y||Zi.y>Ei.y?[]:l.clipLine([qi],ui.x,ui.y,Ei.x,Ei.y)}for(const Zi of Qr){nr.reset(Zi,.25*mn);let Pi=0;Pi=nr.length<=.5*mn?1:Math.ceil(nr.paddedLength/Mr)+1;for(let ho=0;ho<Pi;ho++){const es=ho/Math.max(Pi-1,1),bs=nr.lerp(es),ws=bs.x+to,ya=bs.y+to;je.push(ws,ya,mn,0);const br=ws-mn,Hi=ya-mn,ir=ws+mn,no=ya+mn;if(yn=yn&&this.isOffscreen(br,Hi,ir,no),Jt=Jt||this.isInsideGrid(br,Hi,ir,no),!n&&this.grid.hitTestCircle(ws,ya,mn,he)&&(cn=!0,!X))return{circles:[],offscreen:!1,collisionDetected:cn}}}}return{circles:!X&&cn||!Jt?[]:je,offscreen:yn,collisionDetected:cn}}queryRenderedSymbols(n){if(0===n.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let m=1/0,v=1/0,T=-1/0,I=-1/0;for(const oe of n){const he=new l.pointGeometry(oe.x+to,oe.y+to);m=Math.min(m,he.x),v=Math.min(v,he.y),T=Math.max(T,he.x),I=Math.max(I,he.y),c.push(he)}const R=this.grid.query(m,v,T,I).concat(this.ignoredGrid.query(m,v,T,I)),$={},X={};for(const oe of R){const he=oe.key;if(void 0===$[he.bucketInstanceId]&&($[he.bucketInstanceId]={}),$[he.bucketInstanceId][he.featureIndex])continue;const Me=[new l.pointGeometry(oe.x1,oe.y1),new l.pointGeometry(oe.x2,oe.y1),new l.pointGeometry(oe.x2,oe.y2),new l.pointGeometry(oe.x1,oe.y2)];l.polygonIntersectsPolygon(c,Me)&&($[he.bucketInstanceId][he.featureIndex]=!0,void 0===X[he.bucketInstanceId]&&(X[he.bucketInstanceId]=[]),X[he.bucketInstanceId].push(he.featureIndex))}return X}insertCollisionBox(n,c,m,v,T){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:T},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,c,m,v,T){const I=c?this.ignoredGrid:this.grid,R={bucketInstanceId:m,featureIndex:v,collisionGroupID:T};for(let $=0;$<n.length;$+=4)I.insertCircle(R,n[$],n[$+1],n[$+2])}projectAndGetPerspectiveRatio(n,c,m,v,T){const I=[c,m,v||0,1];let R=!1;if(v||this.transform.pitch>0){l.transformMat4$1(I,I,n);let $=!1;this.fogState&&T&&($=function(X,oe,he,Me,$e,Ue){const je=Ue.calculateFogTileMatrix($e),at=[oe,he,Me];return l.transformMat4(at,at,je),C(X,at,Ue.pitch,Ue._fov)}(this.fogState,c,m,v||0,T.toUnwrapped(),this.transform)>.9),R=I[2]>I[3]||$}else Cr(I,I,n);return{point:new l.pointGeometry((I[0]/I[3]+1)/2*this.transform.width+to,(-I[1]/I[3]+1)/2*this.transform.height+to),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/I[3]*.5,1.5),signedDistanceFromCamera:I[3],aboveHorizon:R}}isOffscreen(n,c,m,v){return m<to||n>=this.screenRightBoundary||v<to||c>this.screenBottomBoundary}isInsideGrid(n,c,m,v){return m>=0&&n<this.gridRightBoundary&&v>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const n=l.identity([]);return l.translate(n,n,[-100,-100,0]),n}}class _e{constructor(n,c,m,v){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?c:-c))):v&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class qe{constructor(n,c,m,v,T,I=!1){this.text=new _e(n?n.text:null,c,m,T),this.icon=new _e(n?n.icon:null,c,v,T),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ct{constructor(n,c,m,v=!1){this.text=n,this.icon=c,this.skipFade=m,this.clipped=v}}class Vt{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class Pt{constructor(n,c,m,v,T){this.bucketInstanceId=n,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=T}}class rn{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const c=++this.maxGroupID;this.collisionGroups[n]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[n]}}function fn(f,n,c,m,v){const{horizontalAlign:T,verticalAlign:I}=l.getAnchorAlignment(f),R=-(T-.5)*n,$=-(I-.5)*c,X=l.evaluateVariableOffset(f,m);return new l.pointGeometry(R+X[0]*v,$+X[1]*v)}function un(f,n,c,m,v){const T=new l.pointGeometry(f,n);return c&&T._rotate(m?v:-v),T}class Cn{constructor(n,c,m,v,T){this.transform=n.clone(),this.collisionIndex=new Ie(this.transform,T),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new rn(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,c,m,v){const T=m.getBucket(c),I=m.latestFeatureIndex;if(!T||!I||c.id!==T.layerIds[0])return;const R=T.layers[0].layout,$=m.collisionBoxArray,X=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),oe=m.tileSize/l.EXTENT,he=m.tileID.toUnwrapped(),Me=this.transform.calculateProjMatrix(he),$e="map"===R.get("text-pitch-alignment"),Ue="map"===R.get("text-rotation-alignment");c.compileFilter();const je=c.dynamicFilter(),at=c.dynamicFilterNeedsFeature(),Ze=this.transform.calculatePixelsToTileUnitsMatrix(m),ot=ti(Me,m.tileID.canonical,$e,Ue,this.transform,Ze);let ut=null;if($e){const ft=Yi(Me,m.tileID.canonical,$e,Ue,this.transform,Ze);ut=l.multiply$1([],this.transform.labelPlaneMatrix,ft)}let it=null;je&&m.latestFeatureIndex&&(it={unwrappedTileID:he,dynamicFilter:je,dynamicFilterNeedsFeature:at,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new Pt(T.bucketInstanceId,I,T.sourceLayerIndex,T.index,m.tileID);const rt={bucket:T,layout:R,posMatrix:Me,textLabelPlaneMatrix:ot,labelToScreenMatrix:ut,clippingData:it,scale:X,textPixelRatio:oe,holdingForFade:m.holdingForFade(),collisionBoxArray:$,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:l.evaluateSizeForZoom(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(v)for(const ft of T.sortKeyRanges){const{sortKey:$t,symbolInstanceStart:tn,symbolInstanceEnd:Nn}=ft;n.push({sortKey:$t,symbolInstanceStart:tn,symbolInstanceEnd:Nn,parameters:rt})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:rt})}attemptAnchorPlacement(n,c,m,v,T,I,R,$,X,oe,he,Me,$e,Ue,je,at,Ze,ot){const ut=[Me.textOffset0,Me.textOffset1],it=fn(n,m,v,ut,T),rt=this.collisionIndex.placeCollisionBox(T,c,un(it.x,it.y,I,R,this.transform.angle),he,$,X,oe.predicate);if((!at||0!==this.collisionIndex.placeCollisionBox(Ue.getSymbolInstanceIconSize(ot,this.transform.zoom,$e),at,un(it.x,it.y,I,R,this.transform.angle),he,$,X,oe.predicate).box.length)&&rt.box.length>0){let ft;return this.prevPlacement&&this.prevPlacement.variableOffsets[Me.crossTileID]&&this.prevPlacement.placements[Me.crossTileID]&&this.prevPlacement.placements[Me.crossTileID].text&&(ft=this.prevPlacement.variableOffsets[Me.crossTileID].anchor),this.variableOffsets[Me.crossTileID]={textOffset:ut,width:m,height:v,anchor:n,textScale:T,prevAnchor:ft},this.markUsedJustification(Ue,n,Me,je),Ue.allowVerticalPlacement&&(this.markUsedOrientation(Ue,je,Me),this.placedOrientations[Me.crossTileID]=je),{shift:it,placedGlyphBoxes:rt}}}placeLayerBucketPart(n,c,m,v){const{bucket:T,layout:I,posMatrix:R,textLabelPlaneMatrix:$,labelToScreenMatrix:X,clippingData:oe,textPixelRatio:he,holdingForFade:Me,collisionBoxArray:$e,partiallyEvaluatedTextSize:Ue,partiallyEvaluatedIconSize:je,collisionGroup:at}=n.parameters,Ze=I.get("text-optional"),ot=I.get("icon-optional"),ut=I.get("text-allow-overlap"),it=I.get("icon-allow-overlap"),rt="map"===I.get("text-rotation-alignment"),ft="map"===I.get("text-pitch-alignment"),$t="none"!==I.get("icon-text-fit"),tn="viewport-y"===I.get("symbol-z-order"),Nn=ut&&(it||!T.hasIconData()||ot),Dn=it&&(ut||!T.hasTextData()||Ze);!T.collisionArrays&&$e&&T.deserializeCollisionBoxes($e),m&&v&&T.updateCollisionDebugBuffers(this.transform.zoom,$e);const Tn=(cn,Jt,yn)=>{if(oe){const br={zoom:this.transform.zoom,pitch:this.transform.pitch};let Hi=null;if(oe.dynamicFilterNeedsFeature){const ir=this.retainedQueryData[T.bucketInstanceId];Hi=oe.featureIndex.loadFeature({featureIndex:cn.featureIndex,bucketIndex:ir.bucketIndex,sourceLayerIndex:ir.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,oe.dynamicFilter)(br,Hi,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new l.pointGeometry(cn.tileAnchorX,cn.tileAnchorY),this.transform.calculateDistanceTileData(oe.unwrappedTileID)))return this.placements[cn.crossTileID]=new ct(!1,!1,!1,!0),void(c[cn.crossTileID]=!0)}if(c[cn.crossTileID])return;if(Me)return void(this.placements[cn.crossTileID]=new ct(!1,!1,!1));let mn=!1,ui=!1,Ei=!0,nr=null,Bn={box:null,offscreen:null},vi={box:null,offscreen:null},qi=null,Mr=null,Qr=null,Zi=0,Pi=0,ho=0;yn.textFeatureIndex?Zi=yn.textFeatureIndex:cn.useRuntimeCollisionCircles&&(Zi=cn.featureIndex),yn.verticalTextFeatureIndex&&(Pi=yn.verticalTextFeatureIndex);const es=br=>{br.tileID=this.retainedQueryData[T.bucketInstanceId].tileID,(this.transform.elevation||br.elevation)&&(br.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[T.bucketInstanceId].tileID,br.tileAnchorX,br.tileAnchorY):0)},bs=yn.textBox;if(bs){es(bs);const br=ir=>{let no=l.WritingMode.horizontal;if(T.allowVerticalPlacement&&!ir&&this.prevPlacement){const Fs=this.prevPlacement.placedOrientations[cn.crossTileID];Fs&&(this.placedOrientations[cn.crossTileID]=Fs,no=Fs,this.markUsedOrientation(T,no,cn))}return no},Hi=(ir,no)=>{if(T.allowVerticalPlacement&&cn.numVerticalGlyphVertices>0&&yn.verticalTextBox){for(const Fs of T.writingModes)if(Fs===l.WritingMode.vertical?(Bn=no(),vi=Bn):Bn=ir(),Bn&&Bn.box&&Bn.box.length)break}else Bn=ir()};if(I.get("text-variable-anchor")){let ir=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[cn.crossTileID]){const Hr=this.prevPlacement.variableOffsets[cn.crossTileID];ir.indexOf(Hr.anchor)>0&&(ir=ir.filter(Hs=>Hs!==Hr.anchor),ir.unshift(Hr.anchor))}const no=(Hr,Hs,rc)=>{const Ts=T.getSymbolInstanceTextSize(Ue,cn,this.transform.zoom,Jt),Oa=(Hr.x2-Hr.x1)*Ts+2*Hr.padding,si=(Hr.y2-Hr.y1)*Ts+2*Hr.padding,bi=$t&&!it?Hs:null;bi&&es(bi);let ss={box:[],offscreen:!1};const ia=ut?2*ir.length:ir.length;for(let ra=0;ra<ia;++ra){const ds=this.attemptAnchorPlacement(ir[ra%ir.length],Hr,Oa,si,Ts,rt,ft,he,R,at,ra>=ir.length,cn,Jt,T,rc,bi,Ue,je);if(ds&&(ss=ds.placedGlyphBoxes,ss&&ss.box&&ss.box.length)){mn=!0,nr=ds.shift;break}}return ss};Hi(()=>no(bs,yn.iconBox,l.WritingMode.horizontal),()=>{const Hr=yn.verticalTextBox;return Hr&&es(Hr),T.allowVerticalPlacement&&!(Bn&&Bn.box&&Bn.box.length)&&cn.numVerticalGlyphVertices>0&&Hr?no(Hr,yn.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),Bn&&(mn=Bn.box,Ei=Bn.offscreen);const Fs=br(Bn&&Bn.box);if(!mn&&this.prevPlacement){const Hr=this.prevPlacement.variableOffsets[cn.crossTileID];Hr&&(this.variableOffsets[cn.crossTileID]=Hr,this.markUsedJustification(T,Hr.anchor,cn,Fs))}}else{const ir=(no,Fs)=>{const Hr=T.getSymbolInstanceTextSize(Ue,cn,this.transform.zoom,Jt),Hs=this.collisionIndex.placeCollisionBox(Hr,no,new l.pointGeometry(0,0),ut,he,R,at.predicate);return Hs&&Hs.box&&Hs.box.length&&(this.markUsedOrientation(T,Fs,cn),this.placedOrientations[cn.crossTileID]=Fs),Hs};Hi(()=>ir(bs,l.WritingMode.horizontal),()=>{const no=yn.verticalTextBox;return T.allowVerticalPlacement&&cn.numVerticalGlyphVertices>0&&no?(es(no),ir(no,l.WritingMode.vertical)):{box:null,offscreen:null}}),br(Bn&&Bn.box&&Bn.box.length)}}if(qi=Bn,mn=qi&&qi.box&&qi.box.length>0,Ei=qi&&qi.offscreen,cn.useRuntimeCollisionCircles){const br=T.text.placedSymbolArray.get(cn.centerJustifiedTextSymbolIndex>=0?cn.centerJustifiedTextSymbolIndex:cn.verticalPlacedTextSymbolIndex),Hi=l.evaluateSizeForFeature(T.textSizeData,Ue,br),ir=I.get("text-padding");Mr=this.collisionIndex.placeCollisionCircles(ut,br,T.lineVertexArray,T.glyphOffsetArray,Hi,R,$,X,m,ft,at.predicate,cn.collisionCircleDiameter*Hi/l.ONE_EM,ir,this.retainedQueryData[T.bucketInstanceId].tileID),mn=ut||Mr.circles.length>0&&!Mr.collisionDetected,Ei=Ei&&Mr.offscreen}if(yn.iconFeatureIndex&&(ho=yn.iconFeatureIndex),yn.iconBox){const br=Hi=>{es(Hi);const ir=$t&&nr?un(nr.x,nr.y,rt,ft,this.transform.angle):new l.pointGeometry(0,0),no=T.getSymbolInstanceIconSize(je,this.transform.zoom,Jt);return this.collisionIndex.placeCollisionBox(no,Hi,ir,it,he,R,at.predicate)};vi&&vi.box&&vi.box.length&&yn.verticalIconBox?(Qr=br(yn.verticalIconBox),ui=Qr.box.length>0):(Qr=br(yn.iconBox),ui=Qr.box.length>0),Ei=Ei&&Qr.offscreen}const ws=Ze||0===cn.numHorizontalGlyphVertices&&0===cn.numVerticalGlyphVertices,ya=ot||0===cn.numIconVertices;if(ws||ya?ya?ws||(ui=ui&&mn):mn=ui&&mn:ui=mn=ui&&mn,mn&&qi&&qi.box&&this.collisionIndex.insertCollisionBox(qi.box,I.get("text-ignore-placement"),T.bucketInstanceId,vi&&vi.box&&Pi?Pi:Zi,at.ID),ui&&Qr&&this.collisionIndex.insertCollisionBox(Qr.box,I.get("icon-ignore-placement"),T.bucketInstanceId,ho,at.ID),Mr&&(mn&&this.collisionIndex.insertCollisionCircles(Mr.circles,I.get("text-ignore-placement"),T.bucketInstanceId,Zi,at.ID),m)){const br=T.bucketInstanceId;let Hi=this.collisionCircleArrays[br];void 0===Hi&&(Hi=this.collisionCircleArrays[br]=new Vt);for(let ir=0;ir<Mr.circles.length;ir+=4)Hi.circles.push(Mr.circles[ir+0]),Hi.circles.push(Mr.circles[ir+1]),Hi.circles.push(Mr.circles[ir+2]),Hi.circles.push(Mr.collisionDetected?1:0)}this.placements[cn.crossTileID]=new ct(mn||Nn,ui||Dn,Ei||T.justReloaded),c[cn.crossTileID]=!0};if(tn){const cn=T.getSortedSymbolIndexes(this.transform.angle);for(let Jt=cn.length-1;Jt>=0;--Jt){const yn=cn[Jt];Tn(T.symbolInstances.get(yn),yn,T.collisionArrays[yn])}}else for(let cn=n.symbolInstanceStart;cn<n.symbolInstanceEnd;cn++)Tn(T.symbolInstances.get(cn),cn,T.collisionArrays[cn]);if(m&&T.bucketInstanceId in this.collisionCircleArrays){const cn=this.collisionCircleArrays[T.bucketInstanceId];l.invert(cn.invProjMatrix,R),cn.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(n,c,m,v){let T;T=v===l.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(c)];const I=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const R of I)R>=0&&(n.text.placedSymbolArray.get(R).crossTileID=T>=0&&R!==T?0:m.crossTileID)}markUsedOrientation(n,c,m){const v=c===l.WritingMode.horizontal||c===l.WritingMode.horizontalOnly?c:0,T=c===l.WritingMode.vertical?c:0,I=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const R of I)n.text.placedSymbolArray.get(R).placedOrientation=v;m.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=T)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const v=c?c.symbolFadeChange(n):1,T=c?c.opacities:{},I=c?c.variableOffsets:{},R=c?c.placedOrientations:{};for(const $ in this.placements){const X=this.placements[$],oe=T[$];oe?(this.opacities[$]=new qe(oe,v,X.text,X.icon,null,X.clipped),m=m||X.text!==oe.text.placed||X.icon!==oe.icon.placed):(this.opacities[$]=new qe(null,v,X.text,X.icon,X.skipFade,X.clipped),m=m||X.text||X.icon)}for(const $ in T){const X=T[$];if(!this.opacities[$]){const oe=new qe(X,v,!1,!1);oe.isHidden()||(this.opacities[$]=oe,m=m||X.text.placed||X.icon.placed)}}for(const $ in I)this.variableOffsets[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.variableOffsets[$]=I[$]);for(const $ in R)this.placedOrientations[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.placedOrientations[$]=R[$]);m?this.lastPlacementChangeTime=n:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:n)}updateLayerOpacities(n,c){const m={};for(const v of c){const T=v.getBucket(n);T&&v.latestFeatureIndex&&n.id===T.layerIds[0]&&this.updateBucketOpacities(T,m,v.collisionBoxArray)}}updateBucketOpacities(n,c,m){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const v=n.layers[0].layout,T=!!n.layers[0].dynamicFilter(),I=new qe(null,0,!1,!1,!0),R=v.get("text-allow-overlap"),$=v.get("icon-allow-overlap"),X=v.get("text-variable-anchor"),oe="map"===v.get("text-rotation-alignment"),he="map"===v.get("text-pitch-alignment"),Me="none"!==v.get("icon-text-fit"),$e=new qe(null,0,R&&($||!n.hasIconData()||v.get("icon-optional")),$&&(R||!n.hasTextData()||v.get("text-optional")),!0);!n.collisionArrays&&m&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(m);const Ue=(at,Ze,ot)=>{for(let ut=0;ut<Ze/4;ut++)at.opacityVertexArray.emplaceBack(ot)};let je=0;for(let at=0;at<n.symbolInstances.length;at++){const Ze=n.symbolInstances.get(at),{numHorizontalGlyphVertices:ot,numVerticalGlyphVertices:ut,crossTileID:it}=Ze;let rt=this.opacities[it];c[it]?rt=I:rt||(rt=$e,this.opacities[it]=rt),c[it]=!0;const ft=ot>0||ut>0,$t=Ze.numIconVertices>0,tn=this.placedOrientations[Ze.crossTileID],Nn=tn===l.WritingMode.vertical,Dn=tn===l.WritingMode.horizontal||tn===l.WritingMode.horizontalOnly;if(!ft&&!$t||rt.isHidden()||je++,ft){const Tn=Ao(rt.text);Ue(n.text,ot,Nn?fo:Tn),Ue(n.text,ut,Dn?fo:Tn);const cn=rt.text.isHidden();[Ze.rightJustifiedTextSymbolIndex,Ze.centerJustifiedTextSymbolIndex,Ze.leftJustifiedTextSymbolIndex].forEach(mn=>{mn>=0&&(n.text.placedSymbolArray.get(mn).hidden=cn||Nn?1:0)}),Ze.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(Ze.verticalPlacedTextSymbolIndex).hidden=cn||Dn?1:0);const Jt=this.variableOffsets[Ze.crossTileID];Jt&&this.markUsedJustification(n,Jt.anchor,Ze,tn);const yn=this.placedOrientations[Ze.crossTileID];yn&&(this.markUsedJustification(n,"left",Ze,yn),this.markUsedOrientation(n,yn,Ze))}if($t){const Tn=Ao(rt.icon);Ze.placedIconSymbolIndex>=0&&(Ue(n.icon,Ze.numIconVertices,Nn?fo:Tn),n.icon.placedSymbolArray.get(Ze.placedIconSymbolIndex).hidden=rt.icon.isHidden()),Ze.verticalPlacedIconSymbolIndex>=0&&(Ue(n.icon,Ze.numVerticalIconVertices,Dn?fo:Tn),n.icon.placedSymbolArray.get(Ze.verticalPlacedIconSymbolIndex).hidden=rt.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Tn=n.collisionArrays[at];if(Tn){let cn=new l.pointGeometry(0,0),Jt=!0;if(Tn.textBox||Tn.verticalTextBox){if(X){const mn=this.variableOffsets[it];mn?(cn=fn(mn.anchor,mn.width,mn.height,mn.textOffset,mn.textScale),oe&&cn._rotate(he?this.transform.angle:-this.transform.angle)):Jt=!1}T&&(Jt=!rt.clipped),Tn.textBox&&Un(n.textCollisionBox.collisionVertexArray,rt.text.placed,!Jt||Nn,cn.x,cn.y),Tn.verticalTextBox&&Un(n.textCollisionBox.collisionVertexArray,rt.text.placed,!Jt||Dn,cn.x,cn.y)}const yn=Jt&&Boolean(!Dn&&Tn.verticalIconBox);Tn.iconBox&&Un(n.iconCollisionBox.collisionVertexArray,rt.icon.placed,yn,Me?cn.x:0,Me?cn.y:0),Tn.verticalIconBox&&Un(n.iconCollisionBox.collisionVertexArray,rt.icon.placed,!yn,Me?cn.x:0,Me?cn.y:0)}}}if(n.fullyClipped=0===je,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const at=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=at.invProjMatrix,n.placementViewportMatrix=at.viewportMatrix,n.collisionCircleArray=at.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return 0===this.fadeDuration?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>n}setStale(){this.stale=!0}}function Un(f,n,c,m,v){f.emplaceBack(n?1:0,c?1:0,m||0,v||0),f.emplaceBack(n?1:0,c?1:0,m||0,v||0),f.emplaceBack(n?1:0,c?1:0,m||0,v||0),f.emplaceBack(n?1:0,c?1:0,m||0,v||0)}const St=Math.pow(2,25),on=Math.pow(2,24),Ri=Math.pow(2,17),Ur=Math.pow(2,16),ji=Math.pow(2,9),_r=Math.pow(2,8),Qi=Math.pow(2,1);function Ao(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const n=f.placed?1:0,c=Math.floor(127*f.opacity);return c*St+n*on+c*Ri+n*Ur+c*ji+n*_r+c*Qi+n}const fo=0;class zn{constructor(n){this._sortAcrossTiles="viewport-y"!==n.layout.get("symbol-z-order")&&void 0!==n.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,c,m,v,T){const I=this._bucketParts;for(;this._currentTileIndex<n.length;)if(c.getBucketParts(I,v,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((R,$)=>R.sortKey-$.sortKey));this._currentPartIndex<I.length;){const R=I[this._currentPartIndex];if(c.placeLayerBucketPart(R,this._seenCrossTileIDs,m,0===R.symbolInstanceStart),this._currentPartIndex++,T())return!0}return!1}}class Gi{constructor(n,c,m,v,T,I,R,$){this.placement=new Cn(n,T,I,R,$),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(n,c,m){const v=l.exported.now(),T=()=>{const I=l.exported.now()-v;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=c[n[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=R)&&(!I.maxzoom||I.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new zn(I)),this._inProgressLayer.continuePlacement(m[I.source],this.placement,this._showCollisionBoxes,I,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Ai=512/l.EXTENT/2;class Lo{constructor(n,c,m){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let v=0;v<c.length;v++){const T=c.get(v),I=T.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:T.crossTileID,coord:this.getScaledCoordinates(T,n)})}}getScaledCoordinates(n,c){const m=Ai/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*l.EXTENT+n.tileAnchorX)*m),y:Math.floor((c.canonical.y*l.EXTENT+n.tileAnchorY)*m)}}findMatches(n,c,m){const v=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let T=0;T<n.length;T++){const I=n.get(T);if(I.crossTileID)continue;const R=this.indexedSymbolInstances[I.key];if(!R)continue;const $=this.getScaledCoordinates(I,c);for(const X of R)if(Math.abs(X.coord.x-$.x)<=v&&Math.abs(X.coord.y-$.y)<=v&&!m[X.crossTileID]){m[X.crossTileID]=!0,I.crossTileID=X.crossTileID;break}}}}class nt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xe{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const c=Math.round((n-this.lng)/360);if(0!==c)for(const m in this.indexes){const v=this.indexes[m],T={};for(const I in v){const R=v[I];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+c),T[R.tileID.key]=R}this.indexes[m]=T}this.lng=n}addBucket(n,c,m){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let T=0;T<c.symbolInstances.length;T++)c.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const v=this.usedCrossTileIDs[n.overscaledZ];for(const T in this.indexes){const I=this.indexes[T];if(Number(T)>n.overscaledZ)for(const R in I){const $=I[R];$.tileID.isChildOf(n)&&$.findMatches(c.symbolInstances,n,v)}else{const R=I[n.scaledTo(Number(T)).key];R&&R.findMatches(c.symbolInstances,n,v)}}for(let T=0;T<c.symbolInstances.length;T++){const I=c.symbolInstances.get(T);I.crossTileID||(I.crossTileID=m.generate(),v[I.crossTileID]=!0)}return void 0===this.indexes[n.overscaledZ]&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Lo(n,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(n,c){for(const m in c.indexedSymbolInstances)for(const v of c.indexedSymbolInstances[m])delete this.usedCrossTileIDs[n][v.crossTileID]}removeStaleBuckets(n){let c=!1;for(const m in this.indexes){const v=this.indexes[m];for(const T in v)n[v[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[T]),delete v[T],c=!0)}return c}}class ke{constructor(){this.layerIndexes={},this.crossTileIDs=new nt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,c,m,v){let T=this.layerIndexes[n.id];void 0===T&&(T=this.layerIndexes[n.id]=new Xe);let I=!1;const R={};"globe"!==v.name&&T.handleWrapJump(m);for(const $ of c){const X=$.getBucket(n);X&&n.id===X.layerIds[0]&&(X.bucketInstanceId||(X.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket($.tileID,X,this.crossTileIDs)&&(I=!0),R[X.bucketInstanceId]=!0)}return T.removeStaleBuckets(R)&&(I=!0),I}pruneUnusedLayers(n){const c={};n.forEach(m=>{c[m]=!0});for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}const Tt=(f,n)=>l.emitValidationErrors(f,n&&n.filter(c=>"source.canvas"!==c.identifier)),nn=l.pick(Gt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ii=l.pick(Gt,["setCenter","setZoom","setBearing","setPitch"]),hi=function(){const f={},n=l.spec.$version;for(const c in l.spec.$root){const m=l.spec.$root[c];if(m.required){let v=null;v="version"===c?n:"array"===m.type?[]:{},null!=v&&(f[c]=v)}}return f}(),ro={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class sr extends l.Evented{constructor(n,c={}){super(),this.map=n,this.dispatcher=new xt(Je(),this),this.imageManager=new We,this.imageManager.setEventedParent(this),this.glyphManager=new l.GlyphManager(n._requestManager,c.localFontFamily?l.LocalGlyphMode.all:c.localIdeographFontFamily?l.LocalGlyphMode.ideographs:l.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new l.LineAtlas(256,512),this.crossTileSymbolIndex=new ke,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const m=this;this._rtlTextPluginCallback=sr.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(T,I)=>{if(l.triggerPluginCompletionEvent(T),I&&I.every(R=>R))for(const R in m._sourceCaches){const $=m._sourceCaches[R],X=$.getSource().type;"vector"!==X&&"geojson"!==X||$.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const T=this.getSource(v.sourceId);if(T&&T.vectorLayerIds)for(const I in this._layers){const R=this._layers[I];R.source===T.id&&this._validateLayer(R)}})}loadURL(n,c={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof c.validate?c.validate:!l.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,c.accessToken);const v=this.map._requestManager.transformRequest(n,l.ResourceType.Style);this._request=l.getJSON(v,(T,I)=>{this._request=null,T?this.fire(new l.ErrorEvent(T)):I&&this._load(I,m)})}loadJSON(n,c={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(n,!1!==c.validate)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(hi,!1)}_updateLayerCount(n,c){const m=c?1:-1;n.is3D()&&(this._num3DLayers+=m),"circle"===n.type&&(this._numCircleLayers+=m),"symbol"===n.type&&(this._numSymbolLayers+=m)}_load(n,c){if(c&&Tt(this,l.validateStyle(n)))return;this._loaded=!0,this.stylesheet=n,this.updateProjection();for(const v in n.sources)this.addSource(v,n.sources[v],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const m=en(this.stylesheet.layers);this._order=m.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of m)v=l.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ze(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&0===this.terrain.drapeRenderMode}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const n=this.map.transform.projection,c=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),m=this.map.transform.projection;if(this._loaded&&(m.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),c){if(m.isReprojectedInTileSpace||n.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(n){this._spriteRequest=function(c,m,v){let T,I,R;const $=l.exported.devicePixelRatio>1?"@2x":"";let X=l.getJSON(m.transformRequest(m.normalizeSpriteURL(c,$,".json"),l.ResourceType.SpriteJSON),(Me,$e)=>{X=null,R||(R=Me,T=$e,he())}),oe=l.getImage(m.transformRequest(m.normalizeSpriteURL(c,$,".png"),l.ResourceType.SpriteImage),(Me,$e)=>{oe=null,R||(R=Me,I=$e,he())});function he(){if(R)v(R);else if(T&&I){const Me=l.exported.getImageData(I),$e={};for(const Ue in T){const{width:je,height:at,x:Ze,y:ot,sdf:ut,pixelRatio:it,stretchX:rt,stretchY:ft,content:$t}=T[Ue],tn=new l.RGBAImage({width:je,height:at});l.RGBAImage.copy(Me,tn,{x:Ze,y:ot},{x:0,y:0},{width:je,height:at}),$e[Ue]={data:tn,pixelRatio:it,sdf:ut,stretchX:rt,stretchY:ft,content:$t}}v(null,$e)}}return{cancel(){X&&(X.cancel(),X=null),oe&&(oe.cancel(),oe=null)}}}(n,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new l.ErrorEvent(c));else if(m)for(const v in m)this.imageManager.addImage(v,m[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(n){const c=this.getSource(n.source);if(!c)return;const m=n.sourceLayer;m&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(m))&&this.fire(new l.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const c=[];for(const m of n){const v=this._layers[m];"custom"!==v.type&&c.push(v.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&ro[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const c=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(v.length||T.length)&&this._updateWorkerLayers(v,T);for(const I in this._updatedSources){const R=this._updatedSources[I];"reload"===R?this._reloadSource(I):"clear"===R&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const m={};for(const v in this._sourceCaches){const T=this._sourceCaches[v];m[v]=T.used,T.used=!1}for(const v of this._order){const T=this._layers[v];if(T.recalculate(n,this._availableImages),!T.isHidden(n.zoom)){const R=this._getLayerSourceCache(T);R&&(R.used=!0)}const I=this.map.painter;if(I){const R=T.getProgramIds();if(!R)continue;const $=T.getProgramConfiguration(n.zoom);for(const X of R)I.useProgram(X,$)}}for(const v in m){const T=this._sourceCaches[v];m[v]!==T.used&&T.getSource().fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Tt(this,l.validateStyle(n)))return!1;(n=l.clone$1(n)).layers=en(n.layers);const c=function(v,T){if(!v)return[{command:Gt.setStyle,args:[T]}];let I=[];try{if(!ge(v.version,T.version))return[{command:Gt.setStyle,args:[T]}];ge(v.center,T.center)||I.push({command:Gt.setCenter,args:[T.center]}),ge(v.zoom,T.zoom)||I.push({command:Gt.setZoom,args:[T.zoom]}),ge(v.bearing,T.bearing)||I.push({command:Gt.setBearing,args:[T.bearing]}),ge(v.pitch,T.pitch)||I.push({command:Gt.setPitch,args:[T.pitch]}),ge(v.sprite,T.sprite)||I.push({command:Gt.setSprite,args:[T.sprite]}),ge(v.glyphs,T.glyphs)||I.push({command:Gt.setGlyphs,args:[T.glyphs]}),ge(v.transition,T.transition)||I.push({command:Gt.setTransition,args:[T.transition]}),ge(v.light,T.light)||I.push({command:Gt.setLight,args:[T.light]}),ge(v.fog,T.fog)||I.push({command:Gt.setFog,args:[T.fog]}),ge(v.projection,T.projection)||I.push({command:Gt.setProjection,args:[T.projection]});const R={},$=[];!function(he,Me,$e,Ue){let je;for(je in Me=Me||{},he=he||{})he.hasOwnProperty(je)&&(Me.hasOwnProperty(je)||Pn(je,$e,Ue));for(je in Me)Me.hasOwnProperty(je)&&(he.hasOwnProperty(je)?ge(he[je],Me[je])||("geojson"===he[je].type&&"geojson"===Me[je].type&&Yn(he,Me,je)?$e.push({command:Gt.setGeoJSONSourceData,args:[je,Me[je].data]}):Vn(je,Me,$e,Ue)):At(je,Me,$e))}(v.sources,T.sources,$,R);const X=[];v.layers&&v.layers.forEach(he=>{R[he.source]?I.push({command:Gt.removeLayer,args:[he.id]}):X.push(he)});let oe=v.terrain;oe&&R[oe.source]&&(I.push({command:Gt.setTerrain,args:[void 0]}),oe=void 0),I=I.concat($),ge(oe,T.terrain)||I.push({command:Gt.setTerrain,args:[T.terrain]}),function(he,Me,$e){Me=Me||[];const Ue=(he=he||[]).map(ni),je=Me.map(ni),at=he.reduce(Li,{}),Ze=Me.reduce(Li,{}),ot=Ue.slice(),ut=Object.create(null);let it,rt,ft,$t,tn,Nn,Dn;for(it=0,rt=0;it<Ue.length;it++)ft=Ue[it],Ze.hasOwnProperty(ft)?rt++:($e.push({command:Gt.removeLayer,args:[ft]}),ot.splice(ot.indexOf(ft,rt),1));for(it=0,rt=0;it<je.length;it++)ft=je[je.length-1-it],ot[ot.length-1-it]!==ft&&(at.hasOwnProperty(ft)?($e.push({command:Gt.removeLayer,args:[ft]}),ot.splice(ot.lastIndexOf(ft,ot.length-rt),1)):rt++,Nn=ot[ot.length-it],$e.push({command:Gt.addLayer,args:[Ze[ft],Nn]}),ot.splice(ot.length-it,0,ft),ut[ft]=!0);for(it=0;it<je.length;it++)if(ft=je[it],$t=at[ft],tn=Ze[ft],!ut[ft]&&!ge($t,tn))if(ge($t.source,tn.source)&&ge($t["source-layer"],tn["source-layer"])&&ge($t.type,tn.type)){for(Dn in qn($t.layout,tn.layout,$e,ft,null,Gt.setLayoutProperty),qn($t.paint,tn.paint,$e,ft,null,Gt.setPaintProperty),ge($t.filter,tn.filter)||$e.push({command:Gt.setFilter,args:[ft,tn.filter]}),ge($t.minzoom,tn.minzoom)&&ge($t.maxzoom,tn.maxzoom)||$e.push({command:Gt.setLayerZoomRange,args:[ft,tn.minzoom,tn.maxzoom]}),$t)$t.hasOwnProperty(Dn)&&"layout"!==Dn&&"paint"!==Dn&&"filter"!==Dn&&"metadata"!==Dn&&"minzoom"!==Dn&&"maxzoom"!==Dn&&(0===Dn.indexOf("paint.")?qn($t[Dn],tn[Dn],$e,ft,Dn.slice(6),Gt.setPaintProperty):ge($t[Dn],tn[Dn])||$e.push({command:Gt.setLayerProperty,args:[ft,Dn,tn[Dn]]}));for(Dn in tn)tn.hasOwnProperty(Dn)&&!$t.hasOwnProperty(Dn)&&"layout"!==Dn&&"paint"!==Dn&&"filter"!==Dn&&"metadata"!==Dn&&"minzoom"!==Dn&&"maxzoom"!==Dn&&(0===Dn.indexOf("paint.")?qn($t[Dn],tn[Dn],$e,ft,Dn.slice(6),Gt.setPaintProperty):ge($t[Dn],tn[Dn])||$e.push({command:Gt.setLayerProperty,args:[ft,Dn,tn[Dn]]}))}else $e.push({command:Gt.removeLayer,args:[ft]}),Nn=ot[ot.lastIndexOf(ft)+1],$e.push({command:Gt.addLayer,args:[tn,Nn]})}(X,T.layers,I)}catch(R){console.warn("Unable to compute style diff:",R),I=[{command:Gt.setStyle,args:[T]}]}return I}(this.serialize(),n).filter(v=>!(v.command in ii));if(0===c.length)return!1;const m=c.filter(v=>!(v.command in nn));if(m.length>0)throw new Error(`Unimplemented: ${m.map(v=>v.command).join(", ")}.`);return c.forEach(v=>{"setTransition"!==v.command&&this[v.command].apply(this,v.args)}),this.stylesheet=n,this.updateProjection(),!0}addImage(n,c){if(this.getImage(n))return this.fire(new l.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(n,c),this._afterImageUpdated(n)}updateImage(n,c){this.imageManager.updateImage(n,c)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new l.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,c,m={}){if(this._checkLoaded(),void 0!==this.getSource(n))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(l.validateStyle.source,`sources.${n}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const v=Oi(n,c,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:v.serialize(),sourceId:n}));const T=I=>{const R=(I?"symbol:":"other:")+n,$=this._sourceCaches[R]=new l.SourceCache(R,v,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[n]=$,$.style=this,$.onAdd(this.map)};T(!1),"vector"!==c.type&&"geojson"!==c.type||T(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const c=this.getSource(n);if(void 0===c)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===n)return this.fire(new l.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new l.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(n);for(const v of m)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,c){this._checkLoaded(),this.getSource(n).setData(c),this._changed=!0}getSource(n){const c=this._getSourceCache(n);return c&&c.getSource()}addLayer(n,c,m={}){this._checkLoaded();const v=n.id;if(this.getLayer(v))return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let T;if("custom"===n.type){if(Tt(this,l.validateCustomStyleLayer(n)))return;T=l.createStyleLayer(n)}else{if("object"==typeof n.source&&(this.addSource(v,n.source),n=l.clone$1(n),n=l.extend(n,{source:v})),this._validate(l.validateStyle.layer,`layers.${v}`,n,{arrayIndex:-1},m))return;T=l.createStyleLayer(n),this._validateLayer(T),T.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}const I=c?this._order.indexOf(c):this._order.length;if(c&&-1===I)return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(I,0,v),this._layerOrderChanged=!0,this._layers[v]=T;const R=this._getLayerSourceCache(T);if(this._removedLayers[v]&&T.source&&R&&"custom"!==T.type){const $=this._removedLayers[v];delete this._removedLayers[v],$.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",R.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,c){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new l.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===c)return;const m=this._order.indexOf(n);this._order.splice(m,1);const v=c?this._order.indexOf(c):this._order.length;c&&-1===v?this.fire(new l.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(v,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const c=this._layers[n];if(!c)return void this.fire(new l.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const m=this._order.indexOf(n);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=c,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const c in this._layers)if(this._layers[c].type===n)return!0;return!1}setLayerZoomRange(n,c,m){this._checkLoaded();const v=this.getLayer(n);v?v.minzoom===c&&v.maxzoom===m||(null!=c&&(v.minzoom=c),null!=m&&(v.maxzoom=m),this._updateLayer(v)):this.fire(new l.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,c,m={}){this._checkLoaded();const v=this.getLayer(n);if(v){if(!ge(v.filter,c))return null==c?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(l.validateStyle.filter,`layers.${v.id}.filter`,c,{layerType:v.type},m)||(v.filter=l.clone$1(c),this._updateLayer(v)))}else this.fire(new l.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){return l.clone$1(this.getLayer(n).filter)}setLayoutProperty(n,c,m,v={}){this._checkLoaded();const T=this.getLayer(n);T?ge(T.getLayoutProperty(c),m)||(T.setLayoutProperty(c,m,v),this._updateLayer(T)):this.fire(new l.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,c){const m=this.getLayer(n);if(m)return m.getLayoutProperty(c);this.fire(new l.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,c,m,v={}){this._checkLoaded();const T=this.getLayer(n);T?ge(T.getPaintProperty(c),m)||(T.setPaintProperty(c,m,v)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new l.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,c){return this.getLayer(n).getPaintProperty(c)}setFeatureState(n,c){this._checkLoaded();const m=n.source,v=n.sourceLayer,T=this.getSource(m);if(void 0===T)return void this.fire(new l.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const I=T.type;if("geojson"===I&&v)return void this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!v)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===n.id&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided.")));const R=this._getSourceCaches(m);for(const $ of R)$.setFeatureState(v,n.id,c)}removeFeatureState(n,c){this._checkLoaded();const m=n.source,v=this.getSource(m);if(void 0===v)return void this.fire(new l.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const T=v.type,I="vector"===T?n.sourceLayer:void 0;if("vector"===T&&!I)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof n.id&&"number"!=typeof n.id)return void this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const R=this._getSourceCaches(m);for(const $ of R)$.removeFeatureState(I,n.id,c)}getFeatureState(n){this._checkLoaded();const c=n.source,m=n.sourceLayer,v=this.getSource(c);if(void 0!==v){if("vector"!==v.type||m)return void 0===n.id&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(m,n.id);this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();n[m.id]||(n[m.id]=m.serialize())}return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(n){this._updatedLayers[n.id]=!0;const c=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[n.source]="reload",c.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const c=I=>"fill-extrusion"===this._layers[I].type,m={},v=[];for(let I=this._order.length-1;I>=0;I--){const R=this._order[I];if(c(R)){m[R]=I;for(const $ of n){const X=$[R];if(X)for(const oe of X)v.push(oe)}}}v.sort((I,R)=>R.intersectionZ-I.intersectionZ);const T=[];for(let I=this._order.length-1;I>=0;I--){const R=this._order[I];if(c(R))for(let $=v.length-1;$>=0;$--){const X=v[$].feature;if(m[X.layer.id]<I)break;T.push(X),v.pop()}else for(const $ of n){const X=$[R];if(X)for(const oe of X)T.push(oe.feature)}}return T}queryRenderedFeatures(n,c,m){c&&c.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const v={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const $ of c.layers){const X=this._layers[$];if(!X)return this.fire(new l.ErrorEvent(new Error(`The layer '${$}' does not exist in the map's style and cannot be queried for features.`))),[];v[X.source]=!0}}const T=[];c.availableImages=this._availableImages;const I=c&&c.layers?c.layers.some($=>{const X=this.getLayer($);return X&&X.is3D()}):this.has3DLayers(),R=ci.createFromScreenPoints(n,m);for(const $ in this._sourceCaches){const X=this._sourceCaches[$].getSource().id;c.layers&&!v[X]||T.push(q(this._sourceCaches[$],this._layers,this._serializedLayers,R,c,m,I,!!this.map._showQueryGeometry))}return this.placement&&T.push(function($,X,oe,he,Me,$e,Ue){const je={},at=$e.queryRenderedSymbols(he),Ze=[];for(const ot of Object.keys(at).map(Number))Ze.push(Ue[ot]);Ze.sort(de);for(const ot of Ze){const ut=ot.featureIndex.lookupSymbolFeatures(at[ot.bucketInstanceId],X,ot.bucketIndex,ot.sourceLayerIndex,Me.filter,Me.layers,Me.availableImages,$);for(const it in ut){const rt=je[it]=je[it]||[],ft=ut[it];ft.sort(($t,tn)=>{const Nn=ot.featureSortOrder;if(Nn){const Dn=Nn.indexOf($t.featureIndex);return Nn.indexOf(tn.featureIndex)-Dn}return tn.featureIndex-$t.featureIndex});for(const $t of ft)rt.push($t)}}for(const ot in je)je[ot].forEach(ut=>{const it=ut.feature,rt=oe($[ot]).getFeatureState(it.layer["source-layer"],it.id);it.source=it.layer.source,it.layer["source-layer"]&&(it.sourceLayer=it.layer["source-layer"]),it.state=rt});return je}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),R.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(n,c){c&&c.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const m=this._getSourceCaches(n);let v=[];for(const T of m)v=v.concat(L(T,c));return v}addSourceType(n,c,m){return sr.getSourceType(n)?m(new Error(`A source type called "${n}" already exists.`)):(sr.setSourceType(n,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:c.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(n,c={}){this._checkLoaded();const m=this.light.getLight();let v=!1;for(const I in n)if(!ge(n[I],m[I])){v=!0;break}if(!v)return;const T={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,c),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,c=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===c){if("object"==typeof n.source){const m="terrain-dem-src";this.addSource(m,n.source),n=l.clone$1(n),n=l.extend(n,{source:m})}if(this._validate(l.validateStyle.terrain,"terrain",n))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(n,c);else{const m=this.terrain,v=m.get();for(const T in n)if(!ge(n[T],v[T])){m.set(n),this.stylesheet.terrain=n;const I={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const c=this.fog=new wt(n,this.map.transform);this.stylesheet.fog=n;const m={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,m=c.get();for(const v in n)if(!ge(n[v],m[v])){c.set(n),this.stylesheet.fog=n;const T={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(T);break}}else this._createFog(n);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(m=>this.isLayerDraped(this._layers[m])),c=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...c)}_createTerrain(n,c){const m=this.terrain=new Be(n,c);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const v={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(v)}_force3DLayerUpdate(){for(const n in this._layers){const c=this._layers[n];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const c=this._layers[n];"symbol"===c.type&&this._updateLayer(c)}}_validate(n,c,m,v,T={}){return(!T||!1!==T.validate)&&Tt(this,n.call(l.validateStyle,l.extend({key:c,style:this.serialize(),value:m,styleSpec:l.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const c=this._getSourceCaches(n);for(const m of c)m.clearTiles()}_reloadSource(n){const c=this._getSourceCaches(n);for(const m of c)m.resume(),m.reload()}_updateSources(n){for(const c in this._sourceCaches)this._sourceCaches[c].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const c=this._sourceCaches[n];c.resume(),c.reload()}}_updatePlacement(n,c,m,v,T=!1){let I=!1,R=!1;const $={};for(const X of this._order){const oe=this._layers[X];if("symbol"!==oe.type)continue;if(!$[oe.source]){const Me=this._getLayerSourceCache(oe);if(!Me)continue;$[oe.source]=Me.getRenderableIds(!0).map($e=>Me.getTileByID($e)).sort(($e,Ue)=>Ue.tileID.overscaledZ-$e.tileID.overscaledZ||($e.tileID.isLessThan(Ue.tileID)?-1:1))}const he=this.crossTileSymbolIndex.addLayer(oe,$[oe.source],n.center.lng,n.projection);I=I||he}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),T=T||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new l.Event("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),n.zoom))&&(this.pauseablePlacement=new Gi(n,this._order,T,c,m,v,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,$),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),R=!0),I&&this.pauseablePlacement.placement.setStale()),R||I)for(const X of this._order){const oe=this._layers[X];"symbol"===oe.type&&this.placement.updateLayerOpacities(oe,$[oe.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,c,m){this.imageManager.getImages(c.icons,m),this._updateTilesForChangedImages();const v=T=>{T&&T.setDependencies(c.tileID.key,c.type,c.icons)};v(this._otherSourceCaches[c.source]),v(this._symbolSourceCaches[c.source])}getGlyphs(n,c,m){this.glyphManager.getGlyphs(c.stacks,m)}getResource(n,c,m){return l.makeRequest(c,m)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return"symbol"===n.type?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const c=[];return this._otherSourceCaches[n]&&c.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&c.push(this._symbolSourceCaches[n]),c}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}sr.getSourceType=function(f){return Ci[f]},sr.setSourceType=function(f,n){Ci[f]=n},sr.registerForPluginStateChange=l.registerForPluginStateChange;var ms="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",gs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Is={},Bo={};Is=ki("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Bo=ki("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const zi=ki("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}\n#ifdef PROJECTION_GLOBE_VIEW\nmat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ls=ms;var Xs={background:ki("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ki("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ki("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ki("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ki("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ki("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ki("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ki("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ki("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ki("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ki("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ki("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ki("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ki("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ki("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ki("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ki("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ki("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ki("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ki("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ki("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ki("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ki("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ki("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:ki("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ki("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",gs),skyboxGradient:ki("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",gs),skyboxCapture:ki("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ki("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:ki("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function ki(f,n,c){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,T=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),I=f.match(v),R=n.match(v),$=ms.match(v);let X=R?R.concat(I):I;c||(Is.staticUniforms&&(X=Is.staticUniforms.concat(X)),Bo.staticUniforms&&(X=Bo.staticUniforms.concat(X))),X&&(X=X.concat($));const oe={};return{fragmentSource:f=f.replace(m,(he,Me,$e,Ue,je)=>(oe[je]=!0,"define"===Me?`\n#ifndef HAS_UNIFORM_u_${je}\nvarying ${$e} ${Ue} ${je};\n#else\nuniform ${$e} ${Ue} u_${je};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${je}\n    ${$e} ${Ue} ${je} = u_${je};\n#endif\n`)),vertexSource:n=n.replace(m,(he,Me,$e,Ue,je)=>{const at="float"===Ue?"vec2":"vec4",Ze=je.match(/color/)?"color":at;return oe[je]?"define"===Me?`\n#ifndef HAS_UNIFORM_u_${je}\nuniform lowp float u_${je}_t;\nattribute ${$e} ${at} a_${je};\nvarying ${$e} ${Ue} ${je};\n#else\nuniform ${$e} ${Ue} u_${je};\n#endif\n`:"vec4"===Ze?`\n#ifndef HAS_UNIFORM_u_${je}\n    ${je} = a_${je};\n#else\n    ${$e} ${Ue} ${je} = u_${je};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${je}\n    ${je} = unpack_mix_${Ze}(a_${je}, u_${je}_t);\n#else\n    ${$e} ${Ue} ${je} = u_${je};\n#endif\n`:"define"===Me?`\n#ifndef HAS_UNIFORM_u_${je}\nuniform lowp float u_${je}_t;\nattribute ${$e} ${at} a_${je};\n#else\nuniform ${$e} ${Ue} u_${je};\n#endif\n`:"vec4"===Ze?`\n#ifndef HAS_UNIFORM_u_${je}\n    ${$e} ${Ue} ${je} = a_${je};\n#else\n    ${$e} ${Ue} ${je} = u_${je};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${je}\n    ${$e} ${Ue} ${je} = unpack_mix_${Ze}(a_${je}, u_${je}_t);\n#else\n    ${$e} ${Ue} ${je} = u_${je};\n#endif\n`}),staticAttributes:T,staticUniforms:X}}class oo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,c,m,v,T,I,R,$){this.context=n;let X=this.boundPaintVertexBuffers.length!==v.length;for(let oe=0;!X&&oe<v.length;oe++)this.boundPaintVertexBuffers[oe]!==v[oe]&&(X=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===m&&!X&&this.boundIndexBuffer===T&&this.boundVertexOffset===I&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===$?(n.bindVertexArrayOES.set(this.vao),R&&R.bind(),T&&T.dynamicDraw&&T.bind(),$&&$.bind()):this.freshBind(c,m,v,T,I,R,$)}freshBind(n,c,m,v,T,I,R){let $;const X=n.numAttributes,oe=this.context,he=oe.gl;if(oe.extVertexArrayObject)this.vao&&this.destroy(),this.vao=oe.extVertexArrayObject.createVertexArrayOES(),oe.bindVertexArrayOES.set(this.vao),$=0,this.boundProgram=n,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=R;else{$=oe.currentNumAttributes||0;for(let Me=X;Me<$;Me++)he.disableVertexAttribArray(Me)}c.enableAttributes(he,n);for(const Me of m)Me.enableAttributes(he,n);I&&I.enableAttributes(he,n),R&&R.enableAttributes(he,n),c.bind(),c.setVertexAttribPointers(he,n,T);for(const Me of m)Me.bind(),Me.setVertexAttribPointers(he,n,T);I&&(I.bind(),I.setVertexAttribPointers(he,n,T)),v&&v.bind(),R&&(R.bind(),R.setVertexAttribPointers(he,n,T)),oe.currentNumAttributes=X}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Jo(f,n){const c=Math.pow(2,n.canonical.z),m=n.canonical.y;return[new l.MercatorCoordinate(0,m/c).toLngLat().lat,new l.MercatorCoordinate(0,(m+1)/c).toLngLat().lat]}function Ms(f,n,c,m,v,T,I){const R=f.context,$=R.gl,X=c.fbo;if(!X)return;f.prepareDrawTile(n);const oe=f.useProgram("hillshade");R.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,X.colorAttachment.get());const he=((je,at,Ze,ot)=>{const ut=Ze.paint.get("hillshade-shadow-color"),it=Ze.paint.get("hillshade-highlight-color"),rt=Ze.paint.get("hillshade-accent-color");let ft=Ze.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Ze.paint.get("hillshade-illumination-anchor")&&(ft-=je.transform.angle);const $t=!je.options.moving;return{u_matrix:ot||je.transform.calculateProjMatrix(at.tileID.toUnwrapped(),$t),u_image:0,u_latrange:Jo(0,at.tileID),u_light:[Ze.paint.get("hillshade-exaggeration"),ft],u_shadow:ut,u_highlight:it,u_accent:rt}})(f,c,m,f.terrain?n.projMatrix:null);f.prepareDrawProgram(R,oe,n.toUnwrapped());const{tileBoundsBuffer:Me,tileBoundsIndexBuffer:$e,tileBoundsSegments:Ue}=f.getTileBoundsBuffers(c);oe.draw(R,$.TRIANGLES,v,T,I,l.CullFaceMode.disabled,he,m.id,Me,$e,Ue)}function Gr(f,n,c){if(!n.needsDEMTextureUpload)return;const m=f.context,v=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||f.getTileTexture(c.stride);const T=c.getPixels();n.demTexture?n.demTexture.update(T,{premultiply:!1}):n.demTexture=new l.Texture(m,T,v.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Vs(f,n,c,m,v,T){const I=f.context,R=I.gl;if(!n.dem)return;const $=n.dem;if(I.activeTexture.set(R.TEXTURE1),Gr(f,n,$),!n.demTexture)return;n.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);const X=$.dim;I.activeTexture.set(R.TEXTURE0);let oe=n.fbo;if(!oe){const Ue=new l.Texture(I,{width:X,height:X,data:null},R.RGBA);Ue.bind(R.LINEAR,R.CLAMP_TO_EDGE),oe=n.fbo=I.createFramebuffer(X,X,!0),oe.colorAttachment.set(Ue.texture)}I.bindFramebuffer.set(oe.framebuffer),I.viewport.set([0,0,X,X]);const{tileBoundsBuffer:he,tileBoundsIndexBuffer:Me,tileBoundsSegments:$e}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(I,R.TRIANGLES,m,v,T,l.CullFaceMode.disabled,((Ue,je)=>{const at=je.stride,Ze=l.create();return l.ortho(Ze,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(Ze,Ze,[0,-l.EXTENT,0]),{u_matrix:Ze,u_image:1,u_dimension:[at,at],u_zoom:Ue.overscaledZ,u_unpack:je.unpackVector}})(n.tileID,$),c.id,he,Me,$e),n.needsHillshadePrepare=!1}const lo=(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_image0:new l.Uniform1i(f,n.u_image0),u_skirt_height:new l.Uniform1f(f,n.u_skirt_height)}),Kr=(f,n)=>({u_matrix:f,u_image0:0,u_skirt_height:n}),As=(f,n,c,m,v)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:n,u_merc_matrix:c,u_zoom_transition:m,u_merc_center:v,u_image0:0});function To(f,n){return null!=f&&null!=n&&!(!f.hasData()||!n.hasData())&&null!=f.demTexture&&null!=n.demTexture&&f.tileID.key!==n.tileID.key}const Co=new class{constructor(){this.operations={}}newMorphing(f,n,c,m,v){if(f in this.operations){const T=this.operations[f];T.to.tileID.key!==c.tileID.key&&(T.queued=c)}else this.operations[f]={startTime:m,phase:0,duration:v,from:n,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const n=this.operations[f];return{from:n.from,to:n.to,phase:n.phase}}update(f){for(const n in this.operations){const c=this.operations[n];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[n];break}}}_nextOp(f,n){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=n,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},No={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function So(f,n){const c=1<<f.z;return!n&&(0===f.x||f.x===c-1)||0===f.y||f.y===c-1}const Xo=f=>({u_matrix:f});function ua(f,n,c,m,v){if(v>0){const T=l.exported.now(),I=(T-f.timeAdded)/v,R=n?(T-n.timeAdded)/v:-1,$=c.getSource(),X=m.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),oe=!n||Math.abs(n.tileID.overscaledZ-X)>Math.abs(f.tileID.overscaledZ-X),he=oe&&f.refreshedUponExpiration?1:l.clamp(oe?I:1-R,0,1);return f.refreshedUponExpiration&&I>=1&&(f.refreshedUponExpiration=!1),n?{opacity:1,mix:1-he}:{opacity:he,mix:0}}return{opacity:1,mix:0}}class ee extends l.SourceCache{constructor(n){const c={type:"raster-dem",maxzoom:n.transform.maxZoom},m=new xt(Je(),null),v=Oi("mock-dem",c,m,n.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,c){n.state="loaded",c(null)}}class Ce extends l.SourceCache{constructor(n){const c=Oi("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new xt(Je(),null),n.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,c,m){if(n.freezeTileCoverage)return;this.transform=n;const v=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,I)=>{if(T[I.key]="",!this._tiles[I.key]){const R=new l.Tile(I,this._source.tileSize*I.overscaleFactor(),n.tileZoom);R.state="loaded",this._tiles[I.key]=R}return T},{});for(const T in this._tiles)T in v||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(n){const c=this.proxyCachedFBO[n];if(void 0!==c){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class te extends l.OverscaledTileID{constructor(n,c,m){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class Ne extends l.Elevation{constructor(n,c){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,v,T]=function($){const X=new l.StructArrayLayout4i8,oe=new l.StructArrayLayout3ui6;X.reserve(17161),oe.reserve(33800);const Me=l.EXTENT/128,$e=l.EXTENT+Me/2,Ue=$e+Me;for(let at=-Me;at<Ue;at+=Me)for(let Ze=-Me;Ze<Ue;Ze+=Me){const ot=Ze<0||Ze>$e||at<0||at>$e?24575:0,ut=l.clamp(Math.round(Ze),0,l.EXTENT),it=l.clamp(Math.round(at),0,l.EXTENT);X.emplaceBack(ut+ot,it,ut,it)}const je=(at,Ze)=>{const ot=131*Ze+at;oe.emplaceBack(ot+1,ot,ot+131),oe.emplaceBack(ot+131,ot+131+1,ot+1)};for(let at=1;at<129;at++)for(let Ze=1;Ze<129;Ze++)je(Ze,at);return[0,129].forEach(at=>{for(let Ze=0;Ze<130;Ze++)je(Ze,at),je(at,Ze)}),[X,oe,32768]}(),I=n.context;this.gridBuffer=I.createVertexBuffer(m,l.boundsAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(v),this.gridSegments=l.SegmentVector.simpleSegment(0,0,m.length,v.length),this.gridNoSkirtSegments=l.SegmentVector.simpleSegment(0,0,m.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ce(c.map),this.orthoMatrix=l.create(),l.ortho(this.orthoMatrix,0,l.EXTENT,0,l.EXTENT,0,1);const R=I.gl;this._overlapStencilMode=new l.StencilMode({func:R.GEQUAL,mask:255},0,255,R.KEEP,R.KEEP,R.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ee(c.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,c,m){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const v=n.terrain.properties;this.sourceCache=0===n.terrain.drapeRenderMode?this._mockSourceCache:n._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const T=()=>{this.sourceCache.used&&l.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(c,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,T(),this._initializing=!0),T(),c.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==n.efficiency&&l.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&"source"===n.dataType?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):"style"===n.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=c.getIds().map($=>{const X=c.getTileByID($).tileID;return X.projMatrix=m.calculateProjMatrix(X.toUnwrapped()),X});(function($,X){const oe=X.transform.pointCoordinate(X.transform.getCameraPoint()),he=new l.pointGeometry(oe.x,oe.y);$.sort((Me,$e)=>{if($e.overscaledZ-Me.overscaledZ)return $e.overscaledZ-Me.overscaledZ;const Ue=new l.pointGeometry(Me.canonical.x+(1<<Me.canonical.z)*Me.wrap,Me.canonical.y),je=new l.pointGeometry($e.canonical.x+(1<<$e.canonical.z)*$e.wrap,$e.canonical.y),at=he.mult(1<<Me.canonical.z);return at.x-=.5,at.y-=.5,at.distSqr(Ue)-at.distSqr(je)})})(v,this.painter),this._previousZoom=m.zoom;const T=this.proxyToSource||{};this.proxyToSource={},v.forEach($=>{this.proxyToSource[$.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const $ in I){const X=I[$];if(!X.used||(X!==this.sourceCache&&this.resetTileLookupCache(X.id),this._setupProxiedCoordsForOrtho(X,n[$],T),X.usedForTerrain))continue;const oe=n[$];X.getSource().reparseOverscaled&&this._assignTerrainTiles(oe)}this.proxiedCoords[c.id]=v.map($=>new te($,$.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1,this._updateTimestamp=l.exported.now();const R={};this._visibleDemTiles=[];for(const $ of this.proxyCoords){const X=this.terrainTileForTile[$.key];if(!X)continue;const oe=X.tileID.key;oe in R||(this._visibleDemTiles.push(X),R[oe]=oe)}}_assignTerrainTiles(n){this._initializing||n.forEach(c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){const n=this.painter.context,c=n.gl;for(const m in this.terrainTileForTile){const v=this.terrainTileForTile[m],T=v.dem;!T||v.demTexture&&!v.needsDEMTextureUpload||(n.activeTexture.set(c.TEXTURE1),Gr(this.painter,v,T))}}_prepareDemTileUniforms(n,c,m,v){if(!c||null==c.demTexture)return!1;const T=n.tileID.canonical,I=Math.pow(2,c.tileID.canonical.z-T.z),R=v||"";return m[`u_dem_tl${R}`]=[T.x*I%1,T.y*I%1],m[`u_dem_scale${R}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,c=n.gl;if(!this._emptyDepthBufferTexture){const m={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new l.Texture(n,m,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const c=this._visibleDemTiles.reduce((m,v)=>{if(!v.dem)return m;const T=v.dem.tree.minimums[0];return T>0&&n++,m+T},0);return n?c/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,c=n.gl;n.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),v={width:1,height:1,data:new Uint8Array(l.DEMData.pack(m,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(v,{premultiply:!1}):T=this._emptyDEMTexture=new l.Texture(n,v,c.RGBA,{premultiply:!1}),T}setupElevationDraw(n,c,m){const v=this.painter.context,T=v.gl,I=(R=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:l.DEMData.getUnpackVector(R),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var R;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();const $=this.painter.transform,X=$.projection.createTileTransform($,$.worldSize),oe=n.tileID.canonical;I.u_tile_tl_up=X.upVector(oe,0,0),I.u_tile_tr_up=X.upVector(oe,l.EXTENT,0),I.u_tile_br_up=X.upVector(oe,l.EXTENT,l.EXTENT),I.u_tile_bl_up=X.upVector(oe,0,l.EXTENT),I.u_tile_up_scale=X.upVectorScale(oe);let he=null,Me=null,$e=1;if(m&&m.morphing&&this._useVertexMorphing){const Ue=m.morphing.srcDemTile,je=m.morphing.dstDemTile;$e=m.morphing.phase,Ue&&je&&(this._prepareDemTileUniforms(n,Ue,I,"_prev")&&(Me=Ue),this._prepareDemTileUniforms(n,je,I)&&(he=je))}if(Me&&he?(v.activeTexture.set(T.TEXTURE2),he.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),v.activeTexture.set(T.TEXTURE4),Me.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),I.u_dem_lerp=$e):(he=this.terrainTileForTile[n.tileID.key],v.activeTexture.set(T.TEXTURE2),(this._prepareDemTileUniforms(n,he,I)?he.demTexture:this.emptyDEMTexture).bind(T.NEAREST,T.CLAMP_TO_EDGE)),v.activeTexture.set(T.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&he){const Ue=(1<<he.tileID.canonical.z)*l.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=Ue}m&&m.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(v,I)}renderToBackBuffer(n){const c=this.painter,m=this.painter.context;0!==n.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),this.renderingToTexture=!1,function(v,T,I,R,$){if("globe"===v.transform.projection.name)!function(X,oe,he,Me,$e){const Ue=X.context,je=Ue.gl;let at,Ze;const ot=X.options.showTerrainWireframe?2:0,ut=(Tn,cn)=>{if(Ze===Tn)return;const Jt=[];cn&&Jt.push(No[ot]),Jt.push(No[Tn]),Jt.push("PROJECTION_GLOBE_VIEW"),at=X.useProgram("globeRaster",null,Jt),Ze=Tn},it=X.colorModeForRenderPass(),rt=new l.DepthMode(je.LEQUAL,l.DepthMode.ReadWrite,X.depthRangeFor3D);Co.update($e);const ft=X.transform,$t=l.calculateGlobeMatrix(ft,ft.worldSize),tn=l.calculateGlobeMercatorMatrix(ft),Nn=[l.mercatorXfromLng(ft.center.lng),l.mercatorYfromLat(ft.center.lat)],Dn=X.globeSharedBuffers;(ot?[!1,!0]:[!1]).forEach(Tn=>{Ze=-1;const cn=Tn?je.LINES:je.TRIANGLES;for(const Jt of Me){const yn=he.getTile(Jt),mn=Math.pow(2,Jt.canonical.z),[ui,Ei]=l.globeBuffersForTileMesh(X,yn,Jt,mn),nr=l.StencilMode.disabled,Bn=oe.prevTerrainTileForTile[Jt.key],vi=oe.terrainTileForTile[Jt.key];To(Bn,vi)&&Co.newMorphing(Jt.key,Bn,vi,$e,250),Ue.activeTexture.set(je.TEXTURE0),yn.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE);const qi=Co.getMorphValuesForProxy(Jt.key),Mr=qi?1:0,Qr={};qi&&l.extend$1(Qr,{morphing:{srcDemTile:qi.from,dstDemTile:qi.to,phase:l.easeCubicInOut(qi.phase)}});const Zi=l.globeMatrixForTile(Jt.canonical,$t),Pi=As(ft.projMatrix,Zi,tn,l.globeToMercatorTransition(ft.zoom),Nn);if(ut(Mr,Tn),oe.setupElevationDraw(yn,at,Qr),X.prepareDrawProgram(Ue,at,Jt.toUnwrapped()),Dn){const[ho,es]=Tn?Dn.getWirefameBuffer(X.context):[Dn.gridIndexBuffer,Dn.gridSegments];at.draw(Ue,cn,rt,nr,it,l.CullFaceMode.backCCW,Pi,"globe_raster",ui,ho,es)}if(!Tn){const ho=[0===Jt.canonical.y?l.globePoleMatrixForTile(Jt.canonical,!1,ft):null,Jt.canonical.y===mn-1?l.globePoleMatrixForTile(Jt.canonical,!0,ft):null];for(const es of ho){if(!es)continue;const bs=As(ft.projMatrix,es,es,0,Nn);Dn&&at.draw(Ue,cn,rt,nr,it,l.CullFaceMode.disabled,bs,"globe_pole_raster",Ei,Dn.poleIndexBuffer,Dn.poleSegments)}}}})}(v,T,I,R,$);else{const X=v.context,oe=X.gl;let he,Me;const $e=v.options.showTerrainWireframe?2:0,Ue=(ut,it)=>{if(Me===ut)return;const rt=[No[ut]];it&&rt.push(No[$e]),he=v.useProgram("terrainRaster",null,rt),Me=ut},je=v.colorModeForRenderPass(),at=new l.DepthMode(oe.LEQUAL,l.DepthMode.ReadWrite,v.depthRangeFor3D);Co.update($);const Ze=v.transform,ot=6*Math.pow(1.5,22-Ze.zoom)*T.exaggeration();($e?[!1,!0]:[!1]).forEach(ut=>{Me=-1;const it=ut?oe.LINES:oe.TRIANGLES,[rt,ft]=ut?T.getWirefameBuffer():[T.gridIndexBuffer,T.gridSegments];for(const $t of R){const tn=I.getTile($t),Nn=l.StencilMode.disabled,Dn=T.prevTerrainTileForTile[$t.key],Tn=T.terrainTileForTile[$t.key];To(Dn,Tn)&&Co.newMorphing($t.key,Dn,Tn,$,250),X.activeTexture.set(oe.TEXTURE0),tn.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE,oe.LINEAR_MIPMAP_NEAREST);const cn=Co.getMorphValuesForProxy($t.key),Jt=cn?1:0;let yn;cn&&(yn={morphing:{srcDemTile:cn.from,dstDemTile:cn.to,phase:l.easeCubicInOut(cn.phase)}});const mn=Kr($t.projMatrix,So($t.canonical,Ze.renderWorldCopies)?ot/10:ot);Ue(Jt,ut),T.setupElevationDraw(tn,he,yn),v.prepareDrawProgram(X,he,$t.toUnwrapped()),he.draw(X,it,at,Nn,je,l.CullFaceMode.backCCW,mn,"terrain_raster",T.gridBuffer,rt,ft)}})}}(c,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,n.splice(0,n.length))}renderBatch(n){if(0===this._drapedRenderBatches.length)return n+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,v=this.proxySourceCache,T=this.proxiedCoords[v.id],I=this._drapedRenderBatches.shift(),R=[],$=c.style.order;let X=0;for(const oe of T){const he=v.getTileByID(oe.proxyTileKey),Me=v.proxyCachedFBO[oe.key]?v.proxyCachedFBO[oe.key][n]:void 0,$e=void 0!==Me?v.renderCache[Me]:this.pool[X++],Ue=void 0!==Me;if(he.texture=$e.tex,Ue&&!$e.dirty){R.push(he.tileID);continue}let je;m.bindFramebuffer.set($e.fb.framebuffer),this.renderedToTile=!1,$e.dirty&&(m.clear({color:l.Color.transparent,stencil:0}),$e.dirty=!1);for(let at=I.start;at<=I.end;++at){const Ze=c.style._layers[$[at]];if(Ze.isHidden(c.transform.zoom))continue;const ot=c.style._getLayerSourceCache(Ze),ut=ot?this.proxyToSource[oe.key][ot.id]:[oe];if(!ut)continue;const it=ut;m.viewport.set([0,0,$e.fb.width,$e.fb.height]),je!==(ot?ot.id:null)&&(this._setupStencil($e,ut,Ze,ot),je=ot?ot.id:null),c.renderLayer(c,ot,Ze,it)}this.renderedToTile?($e.dirty=!0,R.push(he.tileID)):Ue||--X,5===X&&(X=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),I.end+1}postRender(){}renderCacheEfficiency(n){const c=n.order.length;if(0===c)return{efficiency:100};let m,v=0,T=0,I=!1;for(let R=0;R<c;++R){const $=n._layers[n.order[R]];this._style.isLayerDraped($)?(I&&++v,++T):I||(I=!0,m=$.id)}return 0===T?{efficiency:100}:{efficiency:100*(1-v/T),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{n=Math.min(n,c.dem.tree.minimums[0])}),0===n?n:(n-30)*this._exaggeration}raycast(n,c,m){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const I=T.tileID,R=Math.pow(2,I.overscaledZ),{x:$,y:X}=I.canonical,oe=$/R,he=($+1)/R,Me=X/R,$e=(X+1)/R;return{minx:oe,miny:Me,maxx:he,maxy:$e,t:T.dem.tree.raycastRoot(oe,Me,he,$e,n,c,m),tile:T}});v.sort((T,I)=>(null!==T.t?T.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const T of v){if(null==T.t)return null;const I=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,n,c,m);if(null!=I)return I}return null}_createFBO(){const n=this.painter.context,c=n.gl,m=this.drapeBufferSize;n.activeTexture.set(c.TEXTURE0);const v=new l.Texture(n,{width:m[0],height:m[1],data:null},c.RGBA);v.bind(c.LINEAR,c.CLAMP_TO_EDGE);const T=n.createFramebuffer(m[0],m[1],!1);return T.colorAttachment.set(v.texture),T.depthAttachment=new Ki(n,T.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:T,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const c=this._style._layers[n],m=c.isHidden(this.painter.transform.zoom),v=c.getCrossfadeParameters(),T=!!v&&1!==v.t,I=c.hasTransition();return"custom"!==c.type&&!m&&(T||I)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof yi){n=!0;break}if(n)for(let c=0;c<this._style.order.length;++c){const m=this._style._layers[this._style.order[c]],v=m.isHidden(this.painter.transform.zoom),T=this._style._getLayerSourceCache(m);if("raster"!==m.type||v||!T)continue;const I=m.paint.get("raster-fade-duration");for(const R of this.proxyCoords){const $=this.proxyToSource[R.key][T.id];if($)for(const X of $){const oe=ua(T.getTile(X),T.findLoadedParent(X,0),T,this.painter.transform,I);(1!==oe.opacity||0!==oe.mix)&&this._clearRenderCacheForTile(T.id,X)}}}}_setupDrapedRenderBatches(){const n=this._style.order,c=n.length;if(0===c)return;const m=[];let v,T=0,I=this._style._layers[n[T]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++T<c;)I=this._style._layers[n[T]];for(;T<c;++T){const R=this._style._layers[n[T]];R.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(R)?void 0===v&&(v=T):void 0!==v&&(m.push({start:v,end:T-1}),v=void 0))}void 0!==v&&m.push({start:v,end:T-1}),this._drapedRenderBatches=m}_setupRenderCache(n){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const I=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let R=0;R<I.length;++R){const $=Object.values(I[R]);c.renderCachePool.push(...$)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,v=this._tilesDirty;for(let I=m.length-1;I>=0;I--){const R=m[I];if(c.getTileByID(R.key),void 0!==c.proxyCachedFBO[R.key]){const $=n[R.key],X=this.proxyToSource[R.key];let oe=0;for(const he in X){const Me=X[he],$e=$[he];if(!$e||$e.length!==Me.length||Me.some((Ue,je)=>Ue!==$e[je]||v[he]&&v[he].hasOwnProperty(Ue.key))){oe=-1;break}++oe}for(const he in c.proxyCachedFBO[R.key])c.renderCache[c.proxyCachedFBO[R.key][he]].dirty=oe<0||oe!==Object.values($).length}}const T=[...this._drapedRenderBatches];T.sort((I,R)=>R.end-R.start-(I.end-I.start));for(const I of T)for(const R of m){if(c.proxyCachedFBO[R.key])continue;let $=c.renderCachePool.pop();void 0===$&&c.renderCache.length<50&&($=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==$&&(c.proxyCachedFBO[R.key]={},c.proxyCachedFBO[R.key][I.start]=$,c.renderCache[$].dirty=!0)}this._tilesDirty={}}_setupStencil(n,c,m,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,I=T.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let R;if(m.isTileClipped())R=c.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);R=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+R>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=R,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):l.StencilMode.disabled}_renderTileClippingMasks(n,c){const m=this.painter,v=this.painter.context,T=v.gl;m._tileClippingMaskIDs={},v.setColorMode(l.ColorMode.disabled),v.setDepthMode(l.DepthMode.disabled);const I=m.useProgram("clippingMask");for(const R of n){const $=m._tileClippingMaskIDs[R.key]=--c;I.draw(v,T.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:T.ALWAYS,mask:0},$,255,T.KEEP,T.KEEP,T.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,Xo(R.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(n){const c=this.painter.transform;if(n.x<0||n.x>c.width||n.y<0||n.y>c.height)return null;const m=[n.x,n.y,1,1];l.transformMat4$1(m,m,c.pixelMatrixInverse),l.scale$1(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const v=c._camera.position,T=l.mercatorZfromAltitude(1,c.center.lat),I=[v[0],v[1],v[2]/T,0],R=l.subtract([],m.slice(0,3),I);l.normalize(R,R);const $=this.raycast(I,R,this._exaggeration);return null!==$&&$?(l.scaleAndAdd(I,I,R,$),I[3]=I[2],I[2]*=T,I):null}drawDepth(){const n=this.painter,c=n.context,m=this.proxySourceCache,v=Math.ceil(n.width),T=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===T||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const I=c.gl,R=c.createFramebuffer(v,T,!0);c.activeTexture.set(I.TEXTURE0);const $=new l.Texture(c,{width:v,height:T,data:null},I.RGBA);$.bind(I.NEAREST,I.CLAMP_TO_EDGE),R.colorAttachment.set($.texture);const X=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,v,T);R.depthAttachment.set(X),this._depthFBO=R,this._depthTexture=$}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,v,T]),function(I,R,$,X){if("globe"===I.transform.projection.name)return;const oe=I.context,he=oe.gl;oe.clear({depth:1});const Me=I.useProgram("terrainDepth"),$e=new l.DepthMode(he.LESS,l.DepthMode.ReadWrite,I.depthRangeFor3D);for(const Ue of X){const je=$.getTile(Ue),at=Kr(Ue.projMatrix,0);R.setupElevationDraw(je,Me),Me.draw(oe,he.TRIANGLES,$e,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.backCCW,at,"terrain_depth",R.gridBuffer,R.gridIndexBuffer,R.gridNoSkirtSegments)}}(n,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,c,m){if(n.getSource()instanceof Tr)return this._setupProxiedCoordsForImageSource(n,c,m);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const v=this.proxiedCoords[n.id]=[],T=this.proxyCoords;for(let R=0;R<T.length;R++){const $=T[R],X=this._findTileCoveringTileID($,n);if(X){const oe=this._createProxiedId($,X,m[$.key]&&m[$.key][n.id]);v.push(oe),this.proxyToSource[$.key][n.id]=[oe]}}let I=!1;for(let R=0;R<c.length;R++){const $=n.getTile(c[R]);if(!$||!$.hasData())continue;const X=this._findTileCoveringTileID($.tileID,this.proxySourceCache);if(X&&X.tileID.canonical.z!==$.tileID.canonical.z){const oe=this.proxyToSource[X.tileID.key][n.id],he=this._createProxiedId(X.tileID,$,m[X.tileID.key]&&m[X.tileID.key][n.id]);oe?oe.splice(oe.length-1,0,he):this.proxyToSource[X.tileID.key][n.id]=[he],v.push(he),I=!0}}this._sourceTilesOverlap[n.id]=I}_setupProxiedCoordsForImageSource(n,c,m){if(!n.getSource().loaded())return;const v=this.proxiedCoords[n.id]=[],T=this.proxyCoords,I=n.getSource(),R=new l.pointGeometry(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),$=I.coordinates.map(l.MercatorCoordinate.fromLngLat).reduce((oe,he)=>(oe.min.x=Math.min(oe.min.x,he.x-R.x),oe.min.y=Math.min(oe.min.y,he.y-R.y),oe.max.x=Math.max(oe.max.x,he.x-R.x),oe.max.y=Math.max(oe.max.y,he.y-R.y),oe),{min:new l.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new l.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),X=(oe,he)=>{const Me=oe.wrap+oe.canonical.x/(1<<oe.canonical.z),$e=oe.canonical.y/(1<<oe.canonical.z),Ue=l.EXTENT/(1<<oe.canonical.z),je=he.wrap+he.canonical.x/(1<<he.canonical.z),at=he.canonical.y/(1<<he.canonical.z);return Me+Ue<je+$.min.x||Me>je+$.max.x||$e+Ue<at+$.min.y||$e>at+$.max.y};for(let oe=0;oe<T.length;oe++){const he=T[oe];for(let Me=0;Me<c.length;Me++){const $e=n.getTile(c[Me]);if(!$e||!$e.hasData()||X(he,$e.tileID))continue;const Ue=this._createProxiedId(he,$e,m[he.key]&&m[he.key][n.id]),je=this.proxyToSource[he.key][n.id];je?je.push(Ue):this.proxyToSource[he.key][n.id]=[Ue],v.push(Ue)}}}_createProxiedId(n,c,m){let v=this.orthoMatrix;if(m){const T=m.find(I=>I.key===c.tileID.key);if(T)return T}if(c.tileID.key!==n.key){const T=n.canonical.z-c.tileID.canonical.z;let I,R,$;v=l.create();const X=c.tileID.wrap-n.wrap<<n.overscaledZ;T>0?(I=l.EXTENT>>T,R=I*((c.tileID.canonical.x<<T)-n.canonical.x+X),$=I*((c.tileID.canonical.y<<T)-n.canonical.y)):(I=l.EXTENT<<-T,R=l.EXTENT*(c.tileID.canonical.x-(n.canonical.x+X<<-T)),$=l.EXTENT*(c.tileID.canonical.y-(n.canonical.y<<-T))),l.ortho(v,0,I,0,I,0,1),l.translate(v,v,[R,$,0])}return new te(c.tileID,n.key,v)}_findTileCoveringTileID(n,c){let m=c.getTile(n);if(m&&m.hasData())return m;const v=this._findCoveringTileCache[c.id],T=v[n.key];if(m=T?c.getTileByID(T):null,m&&m.hasData()||null===T)return m;let I=m?m.tileID:n,R=I.overscaledZ;const $=c.getSource().minzoom,X=[];if(!T){const he=c.getSource().maxzoom;if(n.canonical.z>=he){const Me=n.canonical.z-he;c.getSource().reparseOverscaled?(R=Math.max(n.canonical.z+2,c.transform.tileZoom),I=new l.OverscaledTileID(R,n.wrap,he,n.canonical.x>>Me,n.canonical.y>>Me)):0!==Me&&(R=he,I=new l.OverscaledTileID(R,n.wrap,he,n.canonical.x>>Me,n.canonical.y>>Me))}I.key!==n.key&&(X.push(I.key),m=c.getTile(I))}const oe=he=>{X.forEach(Me=>{v[Me]=he}),X.length=0};for(R-=1;R>=$&&(!m||!m.hasData());R--){m&&oe(m.tileID.key);const he=I.calculateScaledKey(R);if(m=c.getTileByID(he),m&&m.hasData())break;const Me=v[he];if(null===Me)break;void 0===Me?X.push(he):m=c.getTileByID(Me)}return oe(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(n){this.renderedToTile=!0}_clearRenderCacheForTile(n,c){let m=this._tilesDirty[n];m||(m=this._tilesDirty[n]={}),m[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(c){let m,v,T;const I=new l.StructArrayLayout2ui4,R=131;for(v=1;v<129;v++){for(m=1;m<129;m++)T=v*R+m,I.emplaceBack(T,T+1),I.emplaceBack(T,T+R),I.emplaceBack(T+1,T+R),128===v&&I.emplaceBack(T+R,T+R+1);I.emplaceBack(T+1,T+1+R)}return I}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=l.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Dt(f){const n=[];for(let c=0;c<f.length;c++){if(null===f[c])continue;const m=f[c].split(" ");n.push(m.pop())}return n}class sn{static cacheKey(n,c,m){let v=`${n}${m?m.cacheKey:""}`;for(const T of c)v+=`/${T}`;return v}constructor(n,c,m,v,T,I){const R=n.gl;this.program=R.createProgram();const $=Dt(m.staticAttributes),X=v?v.getBinderAttributes():[],oe=$.concat(X),he=m.staticUniforms?Dt(m.staticUniforms):[],Me=v?v.getBinderUniforms():[],$e=he.concat(Me),Ue=[];for(const rt of $e)Ue.indexOf(rt)<0&&Ue.push(rt);let je=v?v.defines():[];je=je.concat(I.map(rt=>`#define ${rt}`));const at=je.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ls,zi.fragmentSource,Bo.fragmentSource,m.fragmentSource).join("\n"),Ze=je.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ls,zi.vertexSource,Bo.vertexSource,Is.vertexSource,m.vertexSource).join("\n"),ot=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);R.shaderSource(ot,at),R.compileShader(ot),R.attachShader(this.program,ot);const ut=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);R.shaderSource(ut,Ze),R.compileShader(ut),R.attachShader(this.program,ut),this.attributes={};const it={};this.numAttributes=oe.length;for(let rt=0;rt<this.numAttributes;rt++)oe[rt]&&(R.bindAttribLocation(this.program,rt,oe[rt]),this.attributes[oe[rt]]=rt);R.linkProgram(this.program),R.deleteShader(ut),R.deleteShader(ot);for(let rt=0;rt<Ue.length;rt++){const ft=Ue[rt];if(ft&&!it[ft]){const $t=R.getUniformLocation(this.program,ft);$t&&(it[ft]=$t)}}var rt,ft;this.fixedUniforms=T(n,it),this.binderUniforms=v?v.getUniforms(n,it):[],-1!==I.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new l.Uniform1i(rt=n,(ft=it).u_dem),u_dem_prev:new l.Uniform1i(rt,ft.u_dem_prev),u_dem_unpack:new l.Uniform4f(rt,ft.u_dem_unpack),u_dem_tl:new l.Uniform2f(rt,ft.u_dem_tl),u_dem_scale:new l.Uniform1f(rt,ft.u_dem_scale),u_dem_tl_prev:new l.Uniform2f(rt,ft.u_dem_tl_prev),u_dem_scale_prev:new l.Uniform1f(rt,ft.u_dem_scale_prev),u_dem_size:new l.Uniform1f(rt,ft.u_dem_size),u_dem_lerp:new l.Uniform1f(rt,ft.u_dem_lerp),u_exaggeration:new l.Uniform1f(rt,ft.u_exaggeration),u_depth:new l.Uniform1i(rt,ft.u_depth),u_depth_size_inv:new l.Uniform2f(rt,ft.u_depth_size_inv),u_meter_to_dem:new l.Uniform1f(rt,ft.u_meter_to_dem),u_label_plane_matrix_inv:new l.UniformMatrix4f(rt,ft.u_label_plane_matrix_inv),u_tile_tl_up:new l.Uniform3f(rt,ft.u_tile_tl_up),u_tile_tr_up:new l.Uniform3f(rt,ft.u_tile_tr_up),u_tile_br_up:new l.Uniform3f(rt,ft.u_tile_br_up),u_tile_bl_up:new l.Uniform3f(rt,ft.u_tile_bl_up),u_tile_up_scale:new l.Uniform1f(rt,ft.u_tile_up_scale)}),-1!==I.indexOf("FOG")&&(this.fogUniforms=((rt,ft)=>({u_fog_matrix:new l.UniformMatrix4f(rt,ft.u_fog_matrix),u_fog_range:new l.Uniform2f(rt,ft.u_fog_range),u_fog_color:new l.Uniform4f(rt,ft.u_fog_color),u_fog_horizon_blend:new l.Uniform1f(rt,ft.u_fog_horizon_blend),u_fog_temporal_offset:new l.Uniform1f(rt,ft.u_fog_temporal_offset)}))(n,it))}setTerrainUniformValues(n,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in c)m[v].set(c[v])}}setFogUniformValues(n,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in c)m[v].location&&m[v].set(c[v])}}draw(n,c,m,v,T,I,R,$,X,oe,he,Me,$e,Ue,je,at){const Ze=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(m),n.setStencilMode(v),n.setColorMode(T),n.setCullFace(I);for(const ut of Object.keys(this.fixedUniforms))this.fixedUniforms[ut].set(R[ut]);Ue&&Ue.setUniforms(n,this.binderUniforms,Me,{zoom:$e});const ot={[Ze.LINES]:2,[Ze.TRIANGLES]:3,[Ze.LINE_STRIP]:1}[c];for(const ut of he.get()){const it=ut.vaos||(ut.vaos={});(it[$]||(it[$]=new oo)).bind(n,this,X,Ue?Ue.getPaintVertexBuffers():[],oe,ut.vertexOffset,je,at),Ze.drawElements(c,ut.primitiveLength*ot,Ze.UNSIGNED_SHORT,ut.primitiveOffset*ot*2)}}}function Fn(f,n,c){const m=1/gt(c,1,n.transform.tileZoom),v=Math.pow(2,c.tileID.overscaledZ),T=c.tileSize*Math.pow(2,n.transform.tileZoom)/v,I=T*(c.tileID.canonical.x+c.tileID.wrap*v),R=T*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[m,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[I>>16,R>>16],u_pixel_coord_lower:[65535&I,65535&R]}}const Hn=(f,n,c,m)=>{const v=n.style.light,T=v.properties.get("position"),I=[T.x,T.y,T.z],R=l.create$1();"viewport"===v.properties.get("anchor")&&(l.fromRotation(R,-n.transform.angle),l.transformMat3(I,I,R));const $=v.properties.get("color");return{u_matrix:f,u_lightpos:I,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[$.r,$.g,$.b],u_vertical_gradient:+c,u_opacity:m}},Fr=(f,n,c,m,v,T,I)=>l.extend(Hn(f,n,c,m),Fn(T,n,I),{u_height_factor:-Math.pow(2,v.overscaledZ)/I.tileSize/8}),Er=f=>({u_matrix:f}),Fi=(f,n,c,m)=>l.extend(Er(f),Fn(c,n,m)),mr=(f,n)=>({u_matrix:f,u_world:n}),co=(f,n,c,m,v)=>l.extend(Fi(f,n,c,m),{u_world:v}),ie=(f,n,c,m)=>{const v=f.transform;let T;return T="map"===m.paint.get("circle-pitch-alignment")?v.calculatePixelsToTileUnitsMatrix(c):new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]),{u_camera_to_center_distance:v.cameraToCenterDistance,u_matrix:f.translatePosMatrix(n.projMatrix,c,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:l.exported.devicePixelRatio,u_extrude_scale:T}},W=f=>{const n=[];return"map"===f.paint.get("circle-pitch-alignment")&&n.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&n.push("SCALE_WITH_MAP"),n},H=(f,n,c)=>{const m=l.EXTENT/c.tileSize;return{u_matrix:f,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/m,n.pixelsToGLUnits[1]/m]}},Fe=(f,n,c=1)=>({u_matrix:f,u_color:n,u_overlay:0,u_overlay_scale:c}),dn=(f,n,c,m)=>({u_matrix:f,u_extrude_scale:gt(n,1,c),u_intensity:m}),ei=(f,n,c,m,v,T)=>{const I=f.transform,R=I.calculatePixelsToTileUnitsMatrix(n),$={u_matrix:Ko(f,n,c,v),u_pixels_to_tile_units:R,u_device_pixel_ratio:l.exported.devicePixelRatio,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:T,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(zo(c)){const X=Rr(n,f.transform);$.u_texsize=n.lineAtlasTexture.size,$.u_scale=[X,m.fromScale,m.toScale],$.u_mix=m.t}return $},Or=(f,n,c,m,v)=>{const T=f.transform,I=Rr(n,T);return{u_matrix:Ko(f,n,c,v),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:l.exported.devicePixelRatio,u_image:0,u_scale:[I,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Rr(f,n){return 1/gt(f,1,n.tileZoom)}function Ko(f,n,c,m){return f.translatePosMatrix(m||n.tileID.projMatrix,n,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function zo(f){const n=f.paint.get("line-dasharray").value;return n.value||"constant"!==n.kind}const cs=(f,n,c,m,v,T)=>{return{u_matrix:f,u_tl_parent:n,u_scale_parent:c,u_fade_t:m.mix,u_opacity:m.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(R=v.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(I=v.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:$s(v.paint.get("raster-hue-rotate")),u_perspective_transform:T};var I,R};function $s(f){f*=Math.PI/180;const n=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*n-c+1)/3,(Math.sqrt(3)*n-c+1)/3]}const Ui=(f,n,c,m,v,T,I,R,$,X,oe,he,Me,$e)=>{const Ue=v.transform;return{u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Ue.cameraToCenterDistance,u_pitch:Ue.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:Ue.width/Ue.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:I,u_coord_matrix:R,u_is_text:+$,u_pitch_with_map:+m,u_texsize:X,u_tile_id:oe,u_zoom_transition:he,u_inv_rot_matrix:Me,u_merc_center:$e,u_texture:0}},Na=(f,n,c,m,v,T,I,R,$,X,oe,he,Me,$e,Ue)=>{const{cameraToCenterDistance:je,_pitch:at}=v.transform;return l.extend(Ui(f,n,c,m,v,T,I,R,$,X,he,Me,$e,Ue),{u_gamma_scale:m?je*Math.cos(v.terrain?0:at):1,u_device_pixel_ratio:l.exported.devicePixelRatio,u_is_halo:+oe})},za=(f,n,c,m,v,T,I,R,$,X,oe,he,Me,$e)=>l.extend(Na(f,n,c,m,v,T,I,R,!0,$,!0,oe,he,Me,$e),{u_texsize_icon:X,u_texture_icon:1}),yr=(f,n,c)=>({u_matrix:f,u_opacity:n,u_color:c}),js=(f,n,c,m,v,T)=>l.extend(function(I,R,$,X){const oe=$.imageManager.getPattern(I.from.toString()),he=$.imageManager.getPattern(I.to.toString()),{width:Me,height:$e}=$.imageManager.getPixelSize(),Ue=Math.pow(2,X.tileID.overscaledZ),je=X.tileSize*Math.pow(2,$.transform.tileZoom)/Ue,at=je*(X.tileID.canonical.x+X.tileID.wrap*Ue),Ze=je*X.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:oe.tl,u_pattern_br_a:oe.br,u_pattern_tl_b:he.tl,u_pattern_br_b:he.br,u_texsize:[Me,$e],u_mix:R.t,u_pattern_size_a:oe.displaySize,u_pattern_size_b:he.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/gt(X,1,$.transform.tileZoom),u_pixel_coord_upper:[at>>16,Ze>>16],u_pixel_coord_lower:[65535&at,65535&Ze]}}(m,T,c,v),{u_matrix:f,u_opacity:n}),Ea={fillExtrusion:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_lightpos:new l.Uniform3f(f,n.u_lightpos),u_lightintensity:new l.Uniform1f(f,n.u_lightintensity),u_lightcolor:new l.Uniform3f(f,n.u_lightcolor),u_vertical_gradient:new l.Uniform1f(f,n.u_vertical_gradient),u_opacity:new l.Uniform1f(f,n.u_opacity)}),fillExtrusionPattern:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_lightpos:new l.Uniform3f(f,n.u_lightpos),u_lightintensity:new l.Uniform1f(f,n.u_lightintensity),u_lightcolor:new l.Uniform3f(f,n.u_lightcolor),u_vertical_gradient:new l.Uniform1f(f,n.u_vertical_gradient),u_height_factor:new l.Uniform1f(f,n.u_height_factor),u_image:new l.Uniform1i(f,n.u_image),u_texsize:new l.Uniform2f(f,n.u_texsize),u_pixel_coord_upper:new l.Uniform2f(f,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(f,n.u_pixel_coord_lower),u_scale:new l.Uniform3f(f,n.u_scale),u_fade:new l.Uniform1f(f,n.u_fade),u_opacity:new l.Uniform1f(f,n.u_opacity)}),fill:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix)}),fillPattern:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_image:new l.Uniform1i(f,n.u_image),u_texsize:new l.Uniform2f(f,n.u_texsize),u_pixel_coord_upper:new l.Uniform2f(f,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(f,n.u_pixel_coord_lower),u_scale:new l.Uniform3f(f,n.u_scale),u_fade:new l.Uniform1f(f,n.u_fade)}),fillOutline:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_world:new l.Uniform2f(f,n.u_world)}),fillOutlinePattern:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_world:new l.Uniform2f(f,n.u_world),u_image:new l.Uniform1i(f,n.u_image),u_texsize:new l.Uniform2f(f,n.u_texsize),u_pixel_coord_upper:new l.Uniform2f(f,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(f,n.u_pixel_coord_lower),u_scale:new l.Uniform3f(f,n.u_scale),u_fade:new l.Uniform1f(f,n.u_fade)}),circle:(f,n)=>({u_camera_to_center_distance:new l.Uniform1f(f,n.u_camera_to_center_distance),u_extrude_scale:new l.UniformMatrix2f(f,n.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(f,n.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(f,n.u_matrix)}),collisionBox:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_camera_to_center_distance:new l.Uniform1f(f,n.u_camera_to_center_distance),u_extrude_scale:new l.Uniform2f(f,n.u_extrude_scale)}),collisionCircle:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_inv_matrix:new l.UniformMatrix4f(f,n.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(f,n.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(f,n.u_viewport_size)}),debug:(f,n)=>({u_color:new l.UniformColor(f,n.u_color),u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_overlay:new l.Uniform1i(f,n.u_overlay),u_overlay_scale:new l.Uniform1f(f,n.u_overlay_scale)}),clippingMask:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix)}),heatmap:(f,n)=>({u_extrude_scale:new l.Uniform1f(f,n.u_extrude_scale),u_intensity:new l.Uniform1f(f,n.u_intensity),u_matrix:new l.UniformMatrix4f(f,n.u_matrix)}),heatmapTexture:(f,n)=>({u_image:new l.Uniform1i(f,n.u_image),u_color_ramp:new l.Uniform1i(f,n.u_color_ramp),u_opacity:new l.Uniform1f(f,n.u_opacity)}),hillshade:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_image:new l.Uniform1i(f,n.u_image),u_latrange:new l.Uniform2f(f,n.u_latrange),u_light:new l.Uniform2f(f,n.u_light),u_shadow:new l.UniformColor(f,n.u_shadow),u_highlight:new l.UniformColor(f,n.u_highlight),u_accent:new l.UniformColor(f,n.u_accent)}),hillshadePrepare:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_image:new l.Uniform1i(f,n.u_image),u_dimension:new l.Uniform2f(f,n.u_dimension),u_zoom:new l.Uniform1f(f,n.u_zoom),u_unpack:new l.Uniform4f(f,n.u_unpack)}),line:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_pixels_to_tile_units:new l.UniformMatrix2f(f,n.u_pixels_to_tile_units),u_device_pixel_ratio:new l.Uniform1f(f,n.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(f,n.u_units_to_pixels),u_dash_image:new l.Uniform1i(f,n.u_dash_image),u_gradient_image:new l.Uniform1i(f,n.u_gradient_image),u_image_height:new l.Uniform1f(f,n.u_image_height),u_texsize:new l.Uniform2f(f,n.u_texsize),u_scale:new l.Uniform3f(f,n.u_scale),u_mix:new l.Uniform1f(f,n.u_mix),u_alpha_discard_threshold:new l.Uniform1f(f,n.u_alpha_discard_threshold)}),linePattern:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_texsize:new l.Uniform2f(f,n.u_texsize),u_pixels_to_tile_units:new l.UniformMatrix2f(f,n.u_pixels_to_tile_units),u_device_pixel_ratio:new l.Uniform1f(f,n.u_device_pixel_ratio),u_image:new l.Uniform1i(f,n.u_image),u_units_to_pixels:new l.Uniform2f(f,n.u_units_to_pixels),u_scale:new l.Uniform3f(f,n.u_scale),u_fade:new l.Uniform1f(f,n.u_fade),u_alpha_discard_threshold:new l.Uniform1f(f,n.u_alpha_discard_threshold)}),raster:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_tl_parent:new l.Uniform2f(f,n.u_tl_parent),u_scale_parent:new l.Uniform1f(f,n.u_scale_parent),u_fade_t:new l.Uniform1f(f,n.u_fade_t),u_opacity:new l.Uniform1f(f,n.u_opacity),u_image0:new l.Uniform1i(f,n.u_image0),u_image1:new l.Uniform1i(f,n.u_image1),u_brightness_low:new l.Uniform1f(f,n.u_brightness_low),u_brightness_high:new l.Uniform1f(f,n.u_brightness_high),u_saturation_factor:new l.Uniform1f(f,n.u_saturation_factor),u_contrast_factor:new l.Uniform1f(f,n.u_contrast_factor),u_spin_weights:new l.Uniform3f(f,n.u_spin_weights),u_perspective_transform:new l.Uniform2f(f,n.u_perspective_transform)}),symbolIcon:(f,n)=>({u_is_size_zoom_constant:new l.Uniform1i(f,n.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(f,n.u_is_size_feature_constant),u_size_t:new l.Uniform1f(f,n.u_size_t),u_size:new l.Uniform1f(f,n.u_size),u_camera_to_center_distance:new l.Uniform1f(f,n.u_camera_to_center_distance),u_pitch:new l.Uniform1f(f,n.u_pitch),u_rotate_symbol:new l.Uniform1i(f,n.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(f,n.u_aspect_ratio),u_fade_change:new l.Uniform1f(f,n.u_fade_change),u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(f,n.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(f,n.u_coord_matrix),u_is_text:new l.Uniform1i(f,n.u_is_text),u_pitch_with_map:new l.Uniform1i(f,n.u_pitch_with_map),u_texsize:new l.Uniform2f(f,n.u_texsize),u_tile_id:new l.Uniform3f(f,n.u_tile_id),u_zoom_transition:new l.Uniform1f(f,n.u_zoom_transition),u_inv_rot_matrix:new l.UniformMatrix4f(f,n.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(f,n.u_merc_center),u_texture:new l.Uniform1i(f,n.u_texture)}),symbolSDF:(f,n)=>({u_is_size_zoom_constant:new l.Uniform1i(f,n.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(f,n.u_is_size_feature_constant),u_size_t:new l.Uniform1f(f,n.u_size_t),u_size:new l.Uniform1f(f,n.u_size),u_camera_to_center_distance:new l.Uniform1f(f,n.u_camera_to_center_distance),u_pitch:new l.Uniform1f(f,n.u_pitch),u_rotate_symbol:new l.Uniform1i(f,n.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(f,n.u_aspect_ratio),u_fade_change:new l.Uniform1f(f,n.u_fade_change),u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(f,n.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(f,n.u_coord_matrix),u_is_text:new l.Uniform1i(f,n.u_is_text),u_pitch_with_map:new l.Uniform1i(f,n.u_pitch_with_map),u_texsize:new l.Uniform2f(f,n.u_texsize),u_texture:new l.Uniform1i(f,n.u_texture),u_gamma_scale:new l.Uniform1f(f,n.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(f,n.u_device_pixel_ratio),u_tile_id:new l.Uniform3f(f,n.u_tile_id),u_zoom_transition:new l.Uniform1f(f,n.u_zoom_transition),u_inv_rot_matrix:new l.UniformMatrix4f(f,n.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(f,n.u_merc_center),u_is_halo:new l.Uniform1i(f,n.u_is_halo)}),symbolTextAndIcon:(f,n)=>({u_is_size_zoom_constant:new l.Uniform1i(f,n.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(f,n.u_is_size_feature_constant),u_size_t:new l.Uniform1f(f,n.u_size_t),u_size:new l.Uniform1f(f,n.u_size),u_camera_to_center_distance:new l.Uniform1f(f,n.u_camera_to_center_distance),u_pitch:new l.Uniform1f(f,n.u_pitch),u_rotate_symbol:new l.Uniform1i(f,n.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(f,n.u_aspect_ratio),u_fade_change:new l.Uniform1f(f,n.u_fade_change),u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(f,n.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(f,n.u_coord_matrix),u_is_text:new l.Uniform1i(f,n.u_is_text),u_pitch_with_map:new l.Uniform1i(f,n.u_pitch_with_map),u_texsize:new l.Uniform2f(f,n.u_texsize),u_texsize_icon:new l.Uniform2f(f,n.u_texsize_icon),u_texture:new l.Uniform1i(f,n.u_texture),u_texture_icon:new l.Uniform1i(f,n.u_texture_icon),u_gamma_scale:new l.Uniform1f(f,n.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(f,n.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(f,n.u_is_halo)}),background:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_opacity:new l.Uniform1f(f,n.u_opacity),u_color:new l.UniformColor(f,n.u_color)}),backgroundPattern:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_opacity:new l.Uniform1f(f,n.u_opacity),u_image:new l.Uniform1i(f,n.u_image),u_pattern_tl_a:new l.Uniform2f(f,n.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(f,n.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(f,n.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(f,n.u_pattern_br_b),u_texsize:new l.Uniform2f(f,n.u_texsize),u_mix:new l.Uniform1f(f,n.u_mix),u_pattern_size_a:new l.Uniform2f(f,n.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(f,n.u_pattern_size_b),u_scale_a:new l.Uniform1f(f,n.u_scale_a),u_scale_b:new l.Uniform1f(f,n.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(f,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(f,n.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(f,n.u_tile_units_to_pixels)}),terrainRaster:lo,terrainDepth:lo,skybox:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_sun_direction:new l.Uniform3f(f,n.u_sun_direction),u_cubemap:new l.Uniform1i(f,n.u_cubemap),u_opacity:new l.Uniform1f(f,n.u_opacity),u_temporal_offset:new l.Uniform1f(f,n.u_temporal_offset)}),skyboxGradient:(f,n)=>({u_matrix:new l.UniformMatrix4f(f,n.u_matrix),u_color_ramp:new l.Uniform1i(f,n.u_color_ramp),u_center_direction:new l.Uniform3f(f,n.u_center_direction),u_radius:new l.Uniform1f(f,n.u_radius),u_opacity:new l.Uniform1f(f,n.u_opacity),u_temporal_offset:new l.Uniform1f(f,n.u_temporal_offset)}),skyboxCapture:(f,n)=>({u_matrix_3f:new l.UniformMatrix3f(f,n.u_matrix_3f),u_sun_direction:new l.Uniform3f(f,n.u_sun_direction),u_sun_intensity:new l.Uniform1f(f,n.u_sun_intensity),u_color_tint_r:new l.Uniform4f(f,n.u_color_tint_r),u_color_tint_m:new l.Uniform4f(f,n.u_color_tint_m),u_luminance:new l.Uniform1f(f,n.u_luminance)}),globeRaster:(f,n)=>({u_proj_matrix:new l.UniformMatrix4f(f,n.u_proj_matrix),u_globe_matrix:new l.UniformMatrix4f(f,n.u_globe_matrix),u_merc_matrix:new l.UniformMatrix4f(f,n.u_merc_matrix),u_zoom_transition:new l.Uniform1f(f,n.u_zoom_transition),u_merc_center:new l.Uniform2f(f,n.u_merc_center),u_image0:new l.Uniform1i(f,n.u_image0)}),globeAtmosphere:(f,n)=>({u_center:new l.Uniform2f(f,n.u_center),u_radius:new l.Uniform1f(f,n.u_radius),u_screen_size:new l.Uniform2f(f,n.u_screen_size),u_pixel_ratio:new l.Uniform1f(f,n.u_pixel_ratio),u_opacity:new l.Uniform1f(f,n.u_opacity),u_fadeout_range:new l.Uniform1f(f,n.u_fadeout_range),u_start_color:new l.Uniform3f(f,n.u_start_color),u_end_color:new l.Uniform3f(f,n.u_end_color)})};let Ks;function da(f,n,c,m,v,T,I){const R=f.context,$=R.gl,X=f.useProgram("collisionBox"),oe=[];let he=0,Me=0;for(let ut=0;ut<m.length;ut++){const it=m[ut],rt=n.getTile(it),ft=rt.getBucket(c);if(!ft)continue;let $t=it.projMatrix;0===v[0]&&0===v[1]||($t=f.translatePosMatrix(it.projMatrix,rt,v,T));const tn=I?ft.textCollisionBox:ft.iconCollisionBox,Nn=ft.collisionCircleArray;if(Nn.length>0){const Dn=l.create(),Tn=$t;l.mul(Dn,ft.placementInvProjMatrix,f.transform.glCoordMatrix),l.mul(Dn,Dn,ft.placementViewportMatrix),oe.push({circleArray:Nn,circleOffset:Me,transform:Tn,invTransform:Dn}),he+=Nn.length/4,Me=he}tn&&(f.terrain&&f.terrain.setupElevationDraw(rt,X),X.draw(R,$.LINES,l.DepthMode.disabled,l.StencilMode.disabled,f.colorModeForRenderPass(),l.CullFaceMode.disabled,H($t,f.transform,rt),c.id,tn.layoutVertexBuffer,tn.indexBuffer,tn.segments,null,f.transform.zoom,null,tn.collisionVertexBuffer,tn.collisionVertexBufferExt))}if(!I||!oe.length)return;const $e=f.useProgram("collisionCircle"),Ue=new l.StructArrayLayout2f1f2i16;Ue.resize(4*he),Ue._trim();let je=0;for(const ut of oe)for(let it=0;it<ut.circleArray.length/4;it++){const rt=4*it,ft=ut.circleArray[rt+0],$t=ut.circleArray[rt+1],tn=ut.circleArray[rt+2],Nn=ut.circleArray[rt+3];Ue.emplace(je++,ft,$t,tn,Nn,0),Ue.emplace(je++,ft,$t,tn,Nn,1),Ue.emplace(je++,ft,$t,tn,Nn,2),Ue.emplace(je++,ft,$t,tn,Nn,3)}(!Ks||Ks.length<2*he)&&(Ks=function(ut){const it=2*ut,rt=new l.StructArrayLayout3ui6;rt.resize(it),rt._trim();for(let ft=0;ft<it;ft++){const $t=6*ft;rt.uint16[$t+0]=4*ft+0,rt.uint16[$t+1]=4*ft+1,rt.uint16[$t+2]=4*ft+2,rt.uint16[$t+3]=4*ft+2,rt.uint16[$t+4]=4*ft+3,rt.uint16[$t+5]=4*ft+0}return rt}(he));const at=R.createIndexBuffer(Ks,!0),Ze=R.createVertexBuffer(Ue,l.collisionCircleLayout.members,!0);for(const ut of oe){const it={u_matrix:ut.transform,u_inv_matrix:ut.invTransform,u_camera_to_center_distance:(ot=f.transform).cameraToCenterDistance,u_viewport_size:[ot.width,ot.height]};$e.draw(R,$.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,f.colorModeForRenderPass(),l.CullFaceMode.disabled,it,c.id,Ze,at,l.SegmentVector.simpleSegment(0,2*ut.circleOffset,ut.circleArray.length,ut.circleArray.length/2),null,f.transform.zoom,null,null,null)}var ot;Ze.destroy(),at.destroy()}const In=l.identity(new Float32Array(16));function ar(f,n,c,m,v,T){const{horizontalAlign:I,verticalAlign:R}=l.getAnchorAlignment(f),$=-(I-.5)*n,X=-(R-.5)*c,oe=l.evaluateVariableOffset(f,m);return new l.pointGeometry(($/v+oe[0])*T,(X/v+oe[1])*T)}function Gs(f,n,c,m,v,T,I,R,$,X,oe,he){const Me=f.text.placedSymbolArray,$e=f.text.dynamicLayoutVertexArray,Ue=f.icon.dynamicLayoutVertexArray,je={},at=R.projMatrix,Ze=T.elevation,ot=Ze?Ze.getAtTileOffsetFunc(R,he):ut=>[0,0,0];$e.clear();for(let ut=0;ut<Me.length;ut++){const it=Me.get(ut),rt=f.allowVerticalPlacement&&!it.placedOrientation,ft=it.hidden||!it.crossTileID||rt?null:m[it.crossTileID];if(ft){const $t=new l.pointGeometry(it.tileAnchorX,it.tileAnchorY),tn=ot($t),Nn=Ni($t,c?at:I,tn[2]),Dn=pr(T.cameraToCenterDistance,Nn.signedDistanceFromCamera);let Tn=v.evaluateSizeForFeature(f.textSizeData,X,it)*Dn/l.ONE_EM;c&&(Tn*=f.tilePixelRatio/$);const{width:cn,height:Jt,anchor:yn,textOffset:mn,textScale:ui}=ft,Ei=ar(yn,cn,Jt,mn,ui,Tn),nr=c?Ni($t.add(Ei),I,tn[2]).point:Nn.point.add(n?Ei.rotate(-T.angle):Ei),Bn=f.allowVerticalPlacement&&it.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let vi=0;vi<it.numGlyphs;vi++)l.addDynamicAttributes($e,nr,Bn);oe&&it.associatedIconIndex>=0&&(je[it.associatedIconIndex]={shiftedAnchor:nr,angle:Bn})}else Pr(it.numGlyphs,$e)}if(oe){Ue.clear();const ut=f.icon.placedSymbolArray;for(let it=0;it<ut.length;it++){const rt=ut.get(it);if(rt.hidden)Pr(rt.numGlyphs,Ue);else{const ft=je[it];if(ft)for(let $t=0;$t<rt.numGlyphs;$t++)l.addDynamicAttributes(Ue,ft.shiftedAnchor,ft.angle);else Pr(rt.numGlyphs,Ue)}}f.icon.dynamicLayoutVertexBuffer.updateData(Ue)}f.text.dynamicLayoutVertexBuffer.updateData($e)}function Yr(f,n,c){return c.iconsInText&&n?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function us(f,n,c,m,v,T,I,R,$,X,oe,he){const Me=f.context,$e=Me.gl,Ue=f.transform,je=Ue.projection.createTileTransform(Ue,Ue.worldSize),at="map"===R,Ze="map"===$,ot=at&&"point"!==c.layout.get("symbol-placement"),ut=at&&!Ze&&!ot,it=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let rt=!1;const ft=f.depthModeForSublayer(0,l.DepthMode.ReadOnly),$t=[l.mercatorXfromLng(Ue.center.lng),l.mercatorYfromLat(Ue.center.lat)],tn=c.layout.get("text-variable-anchor"),Nn="globe"===Ue.projection.name,Dn=Nn?l.globeToMercatorTransition(Ue.zoom):0,Tn=[],cn=[];f.terrain&&Ze&&cn.push("PITCH_WITH_MAP_TERRAIN"),Nn&&cn.push("PROJECTION_GLOBE_VIEW"),ot&&cn.push("PROJECTED_POS_ON_VIEWPORT");for(const Jt of m){const yn=n.getTile(Jt),mn=yn.getBucket(c);if(!mn||mn.projection!==Ue.projection.name)continue;const ui=v?mn.text:mn.icon;if(!ui||mn.fullyClipped||!ui.segments.get().length)continue;const Ei=ui.programConfigurations.get(c.id),nr=v||mn.sdfIcons,Bn=v?mn.textSizeData:mn.iconSizeData,vi=Ze||0!==Ue.pitch,qi=f.useProgram(Yr(nr,v,mn),Ei,cn),Mr=l.evaluateSizeForZoom(Bn,Ue.zoom),Qr=[Jt.canonical.x,Jt.canonical.y,1<<Jt.canonical.z];let Zi,Pi,ho,es,bs=[0,0],ws=null;if(v){if(Pi=yn.glyphAtlasTexture,ho=$e.LINEAR,Zi=yn.glyphAtlasTexture.size,mn.iconsInText){bs=yn.imageAtlasTexture.size,ws=yn.imageAtlasTexture;const ss="composite"===Bn.kind||"camera"===Bn.kind;es=vi||f.options.rotating||f.options.zooming||ss?$e.LINEAR:$e.NEAREST}}else{const ss=1!==c.layout.get("icon-size").constantOr(0)||mn.iconsNeedLinear;Pi=yn.imageAtlasTexture,ho=nr||f.options.rotating||f.options.zooming||ss||vi?$e.LINEAR:$e.NEAREST,Zi=yn.imageAtlasTexture.size}const ya=f.transform.calculatePixelsToTileUnitsMatrix(yn),br=ti(Jt.projMatrix,yn.tileID.canonical,Ze,at,f.transform,ya),Hi=f.terrain&&Ze&&ot?l.invert(new Float32Array(16),br):In,ir=Yi(Jt.projMatrix,yn.tileID.canonical,Ze,at,f.transform,ya),no=tn&&mn.hasTextData(),Fs="none"!==c.layout.get("icon-text-fit")&&no&&mn.hasIconData();if(ot){const ss=Ue.elevation,ia=ss?ss.getAtTileOffsetFunc(Jt,je):ra=>[0,0,0];fr(mn,Jt.projMatrix,f,v,br,ir,Ze,X,ia,Jt)}const Hr=f.translatePosMatrix(Jt.projMatrix,yn,T,I),Hs=ot||v&&tn||Fs?In:br,rc=f.translatePosMatrix(ir,yn,T,I,!0),Ts=nr&&0!==c.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1);let Oa;const si=je.createInversionMatrix(Jt.toUnwrapped());Oa=nr?mn.iconsInText?za(Bn.kind,Mr,ut,Ze,f,Hr,Hs,rc,Zi,bs,Qr,Dn,si,$t):Na(Bn.kind,Mr,ut,Ze,f,Hr,Hs,rc,v,Zi,!0,Qr,Dn,si,$t):Ui(Bn.kind,Mr,ut,Ze,f,Hr,Hs,rc,v,Zi,Qr,Dn,si,$t);const bi={program:qi,buffers:ui,uniformValues:Oa,atlasTexture:Pi,atlasTextureIcon:ws,atlasInterpolation:ho,atlasInterpolationIcon:es,isSDF:nr,hasHalo:Ts,tile:yn,labelPlaneMatrixInv:Hi};if(it&&mn.canOverlap){rt=!0;const ss=ui.segments.get();for(const ia of ss)Tn.push({segments:new l.SegmentVector([ia]),sortKey:ia.sortKey,state:bi})}else Tn.push({segments:ui.segments,sortKey:0,state:bi})}rt&&Tn.sort((Jt,yn)=>Jt.sortKey-yn.sortKey);for(const Jt of Tn){const yn=Jt.state;if(f.terrain&&f.terrain.setupElevationDraw(yn.tile,yn.program,{useDepthForOcclusion:!Nn,labelPlaneMatrixInv:yn.labelPlaneMatrixInv}),Me.activeTexture.set($e.TEXTURE0),yn.atlasTexture.bind(yn.atlasInterpolation,$e.CLAMP_TO_EDGE),yn.atlasTextureIcon&&(Me.activeTexture.set($e.TEXTURE1),yn.atlasTextureIcon&&yn.atlasTextureIcon.bind(yn.atlasInterpolationIcon,$e.CLAMP_TO_EDGE)),yn.isSDF){const mn=yn.uniformValues;yn.hasHalo&&(mn.u_is_halo=1,Uo(yn.buffers,Jt.segments,c,f,yn.program,ft,oe,he,mn)),mn.u_is_halo=0}Uo(yn.buffers,Jt.segments,c,f,yn.program,ft,oe,he,yn.uniformValues)}}function Uo(f,n,c,m,v,T,I,R,$){const X=m.context;v.draw(X,X.gl.TRIANGLES,T,I,R,l.CullFaceMode.disabled,$,c.id,f.layoutVertexBuffer,f.indexBuffer,n,c.paint,m.transform.zoom,f.programConfigurations.get(c.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function vo(f,n,c,m,v,T,I){const R=f.context.gl,$=c.paint.get("fill-pattern"),X=$&&$.constantOr(1),oe=c.getCrossfadeParameters();let he,Me,$e,Ue,je;I?(Me=X&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",he=R.LINES):(Me=X?"fillPattern":"fill",he=R.TRIANGLES);for(const at of m){const Ze=n.getTile(at);if(X&&!Ze.patternsLoaded())continue;const ot=Ze.getBucket(c);if(!ot)continue;f.prepareDrawTile(at);const ut=ot.programConfigurations.get(c.id),it=f.useProgram(Me,ut);X&&(f.context.activeTexture.set(R.TEXTURE0),Ze.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),ut.updatePaintBuffers(oe));const rt=$.constantOr(null);if(rt&&Ze.imageAtlas){const $t=Ze.imageAtlas,tn=$t.patternPositions[rt.to.toString()],Nn=$t.patternPositions[rt.from.toString()];tn&&Nn&&ut.setConstantPatternPositions(tn,Nn)}const ft=f.translatePosMatrix(at.projMatrix,Ze,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(I){Ue=ot.indexBuffer2,je=ot.segments2;const $t=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[R.drawingBufferWidth,R.drawingBufferHeight];$e="fillOutlinePattern"===Me&&X?co(ft,f,oe,Ze,$t):mr(ft,$t)}else Ue=ot.indexBuffer,je=ot.segments,$e=X?Fi(ft,f,oe,Ze):Er(ft);f.prepareDrawProgram(f.context,it,at.toUnwrapped()),it.draw(f.context,he,v,f.stencilModeForClipping(at),T,l.CullFaceMode.disabled,$e,c.id,ot.layoutVertexBuffer,Ue,je,c.paint,f.transform.zoom,ut)}}function rs(f,n,c,m,v,T,I){const R=f.context,$=R.gl,X=c.paint.get("fill-extrusion-pattern"),oe=X.constantOr(1),he=c.getCrossfadeParameters(),Me=c.paint.get("fill-extrusion-opacity");for(const $e of m){const Ue=n.getTile($e),je=Ue.getBucket(c);if(!je)continue;const at=je.programConfigurations.get(c.id),Ze=f.useProgram(oe?"fillExtrusionPattern":"fillExtrusion",at);if(f.terrain){const ft=f.terrain;if(!je.enableTerrain)continue;if(ft.setupElevationDraw(Ue,Ze,{useMeterToDem:!0}),ha(R,n,$e,je,c,ft),!je.centroidVertexBuffer){const $t=Ze.attributes.a_centroid_pos;void 0!==$t&&$.vertexAttrib2f($t,0,0)}}oe&&(f.context.activeTexture.set($.TEXTURE0),Ue.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),at.updatePaintBuffers(he));const ot=X.constantOr(null);if(ot&&Ue.imageAtlas){const ft=Ue.imageAtlas,$t=ft.patternPositions[ot.to.toString()],tn=ft.patternPositions[ot.from.toString()];$t&&tn&&at.setConstantPatternPositions($t,tn)}const ut=f.translatePosMatrix($e.projMatrix,Ue,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),it=c.paint.get("fill-extrusion-vertical-gradient"),rt=oe?Fr(ut,f,it,Me,$e,he,Ue):Hn(ut,f,it,Me);f.prepareDrawProgram(R,Ze,$e.toUnwrapped()),Ze.draw(R,R.gl.TRIANGLES,v,T,I,l.CullFaceMode.backCCW,rt,c.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,c.paint,f.transform.zoom,at,f.terrain?je.centroidVertexBuffer:null)}}function ha(f,n,c,m,v,T){const I=[Ze=>{let ot=Ze.canonical.x-1,ut=Ze.wrap;return ot<0&&(ot=(1<<Ze.canonical.z)-1,ut--),new l.OverscaledTileID(Ze.overscaledZ,ut,Ze.canonical.z,ot,Ze.canonical.y)},Ze=>{let ot=Ze.canonical.x+1,ut=Ze.wrap;return ot===1<<Ze.canonical.z&&(ot=0,ut++),new l.OverscaledTileID(Ze.overscaledZ,ut,Ze.canonical.z,ot,Ze.canonical.y)},Ze=>new l.OverscaledTileID(Ze.overscaledZ,Ze.wrap,Ze.canonical.z,Ze.canonical.x,(0===Ze.canonical.y?1<<Ze.canonical.z:Ze.canonical.y)-1),Ze=>new l.OverscaledTileID(Ze.overscaledZ,Ze.wrap,Ze.canonical.z,Ze.canonical.x,Ze.canonical.y===(1<<Ze.canonical.z)-1?0:Ze.canonical.y+1)],R=Ze=>{const ot=n.getSource().maxzoom,ut=$t=>{const tn=n.getTileByID($t);if(tn&&tn.hasData())return tn.getBucket(v)};let it,rt,ft;return(Ze.overscaledZ===Ze.canonical.z||Ze.overscaledZ>=ot)&&(it=ut(Ze.key)),Ze.overscaledZ>=ot&&(rt=ut(Ze.calculateScaledKey(Ze.overscaledZ+1))),Ze.overscaledZ>ot&&(ft=ut(Ze.calculateScaledKey(Ze.overscaledZ-1))),it||rt||ft},$=[0,0,0],X=(Ze,ot)=>($[0]=Math.min(Ze.min.y,ot.min.y),$[1]=Math.max(Ze.max.y,ot.max.y),$[2]=l.EXTENT-ot.min.x>Ze.max.x?ot.min.x-l.EXTENT:Ze.max.x,$),oe=(Ze,ot)=>($[0]=Math.min(Ze.min.x,ot.min.x),$[1]=Math.max(Ze.max.x,ot.max.x),$[2]=l.EXTENT-ot.min.y>Ze.max.y?ot.min.y-l.EXTENT:Ze.max.y,$),he=[(Ze,ot)=>X(Ze,ot),(Ze,ot)=>X(ot,Ze),(Ze,ot)=>oe(Ze,ot),(Ze,ot)=>oe(ot,Ze)],Me=new l.pointGeometry(0,0);let $e,Ue,je;const at=(Ze,ot,ut,it,rt)=>{const ft=[[it?ut:Ze,it?Ze:ut,0],[it?ut:ot,it?ot:ut,0]],$t=rt<0?l.EXTENT+rt:rt,tn=[it?$t:(Ze+ot)/2,it?(Ze+ot)/2:$t,0];return 0===ut&&rt<0||0!==ut&&rt>0?T.getForTilePoints(je,[tn],!0,Ue):ft.push(tn),T.getForTilePoints(c,ft,!0,$e),Math.max(ft[0][2],ft[1][2],tn[2])/T.exaggeration()};for(let Ze=0;Ze<4;Ze++){const ot=m.borders[Ze];if(0===ot.length&&(m.borderDone[Ze]=!0),m.borderDone[Ze])continue;const ut=je=I[Ze](c),it=R(ut);if(!(it&&it.enableTerrain&&(Ue=T.findDEMTileFor(ut),Ue&&Ue.dem)))continue;if(!$e){const tn=T.findDEMTileFor(c);if(!tn||!tn.dem)return;$e=tn}const rt=(Ze<2?1:5)-Ze,ft=it.borders[rt];let $t=0;for(let tn=0;tn<ot.length;tn++){const Nn=m.featuresOnBorder[ot[tn]],Dn=Nn.borders[Ze];let Tn;for(;$t<ft.length&&(Tn=it.featuresOnBorder[ft[$t]],!(Tn.borders[rt][1]>Dn[0]+3));)it.borderDone[rt]||it.encodeCentroid(void 0,Tn,!1),$t++;if(Tn&&$t<ft.length){const cn=$t;let Jt=0;for(;!(Tn.borders[rt][0]>Dn[1]-3)&&(Jt++,++$t!==ft.length);)Tn=it.featuresOnBorder[ft[$t]];if(Tn=it.featuresOnBorder[ft[cn]],Nn.intersectsCount()>1||Tn.intersectsCount()>1||1!==Jt){1!==Jt&&($t=cn),m.encodeCentroid(void 0,Nn,!1),it.borderDone[rt]||it.encodeCentroid(void 0,Tn,!1);continue}const yn=he[Ze](Nn,Tn),mn=Ze%2?l.EXTENT-1:0;Me.x=at(yn[0],Math.min(l.EXTENT-1,yn[1]),mn,Ze<2,yn[2]),Me.y=0,m.encodeCentroid(Me,Nn,!1),it.borderDone[rt]||it.encodeCentroid(Me,Tn,!1)}else m.encodeCentroid(void 0,Nn,!1)}m.borderDone[Ze]=m.needsCentroidUpdate=!0,it.borderDone[rt]||(it.borderDone[rt]=it.needsCentroidUpdate=!0)}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(f)}const wc=new l.Color(1,0,0,1),ks=new l.Color(0,1,0,1),Po=new l.Color(0,0,1,1),qs=new l.Color(1,0,1,1),Qo=new l.Color(0,1,1,1);function Dr(f,n,c,m){Zo(f,0,n+c/2,f.transform.width,c,m)}function _s(f,n,c,m){Zo(f,n-c/2,0,c,f.transform.height,m)}function Zo(f,n,c,m,v,T){const I=f.context,R=I.gl;R.enable(R.SCISSOR_TEST),R.scissor(n*l.exported.devicePixelRatio,c*l.exported.devicePixelRatio,m*l.exported.devicePixelRatio,v*l.exported.devicePixelRatio),I.clear({color:T}),R.disable(R.SCISSOR_TEST)}function ys(f,n,c){const m=f.context,v=m.gl,T=c.projMatrix,I=f.useProgram("debug"),R=n.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(R,I);const $=l.DepthMode.disabled,X=l.StencilMode.disabled,oe=f.colorModeForRenderPass();m.activeTexture.set(v.TEXTURE0),f.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),R._makeDebugTileBoundsBuffers(f.context,f.transform.projection);const Me=R._tileDebugBuffer||f.debugBuffer,$e=R._tileDebugIndexBuffer||f.debugIndexBuffer,Ue=R._tileDebugSegments||f.debugSegments;I.draw(m,v.LINE_STRIP,$,X,oe,l.CullFaceMode.disabled,Fe(T,l.Color.red),"$debug",Me,$e,Ue);const je=R.latestRawTileData,at=Math.floor((je&&je.byteLength||0)/1024),Ze=n.getTile(c).tileSize,ot=512/Math.min(Ze,512)*(c.overscaledZ/f.transform.zoom)*.5;let ut=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(ut+=` => ${c.overscaledZ}`),function(it,rt){it.initDebugOverlayCanvas();const ft=it.debugOverlayCanvas,$t=it.context.gl,tn=it.debugOverlayCanvas.getContext("2d");tn.clearRect(0,0,ft.width,ft.height),tn.shadowColor="white",tn.shadowBlur=2,tn.lineWidth=1.5,tn.strokeStyle="white",tn.textBaseline="top",tn.font="bold 36px Open Sans, sans-serif",tn.fillText(rt,5,5),tn.strokeText(rt,5,5),it.debugOverlayTexture.update(ft),it.debugOverlayTexture.bind($t.LINEAR,$t.CLAMP_TO_EDGE)}(f,`${ut} ${at}kb`),I.draw(m,v.TRIANGLES,$,X,l.ColorMode.alphaBlended,l.CullFaceMode.disabled,Fe(T,l.Color.transparent,ot),"$debug",f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}const dl=l.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:pa}=dl;function Vo(f,n,c,m){f.emplaceBack(n,c,m)}class D{constructor(n){this.vertexArray=new l.StructArrayLayout3f12,this.indices=new l.StructArrayLayout3ui6,Vo(this.vertexArray,-1,-1,1),Vo(this.vertexArray,1,-1,1),Vo(this.vertexArray,-1,1,1),Vo(this.vertexArray,1,1,1),Vo(this.vertexArray,-1,-1,-1),Vo(this.vertexArray,1,-1,-1),Vo(this.vertexArray,-1,1,-1),Vo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,pa),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=l.SegmentVector.simpleSegment(0,0,36,12)}}function N(f,n,c,m,v,T){const I=f.gl,R=n.paint.get("sky-atmosphere-color"),$=n.paint.get("sky-atmosphere-halo-color"),X=n.paint.get("sky-atmosphere-sun-intensity"),oe={u_matrix_3f:l.fromMat4([],m),u_sun_direction:v,u_sun_intensity:X,u_color_tint_r:[(Ue=R).r,Ue.g,Ue.b,Ue.a],u_color_tint_m:[(je=$).r,je.g,je.b,je.a],u_luminance:5e-5};var Ue,je;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+T,n.skyboxTexture,0),c.draw(f,I.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.frontCW,oe,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const A={symbol:function(f,n,c,m,v){if("translucent"!==f.renderPass)return;const T=l.StencilMode.disabled,I=f.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(R,$,X,oe,he,Me,$e){const Ue=$.transform,je="map"===he,at="map"===Me,Ze=Ue.projection.createTileTransform(Ue,Ue.worldSize);for(const ot of R){const ut=oe.getTile(ot),it=ut.getBucket(X);if(!it||it.projection!==Ue.projection.name||!it.text||!it.text.segments.get().length)continue;const rt=l.evaluateSizeForZoom(it.textSizeData,Ue.zoom),ft=$.transform.calculatePixelsToTileUnitsMatrix(ut),$t=ti(ot.projMatrix,ut.tileID.canonical,at,je,$.transform,ft),tn="none"!==X.layout.get("icon-text-fit")&&it.hasIconData();if(rt){const Nn=Math.pow(2,Ue.zoom-ut.tileID.overscaledZ);Gs(it,je,at,$e,l.symbolSize,Ue,$t,ot,Nn,rt,tn,Ze)}}}(m,f,c,n,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),v),0!==c.paint.get("icon-opacity").constantOr(1)&&us(f,n,c,m,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),T,I),0!==c.paint.get("text-opacity").constantOr(1)&&us(f,n,c,m,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),T,I),n.map.showCollisionBoxes&&(da(f,n,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),da(f,n,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,n,c,m){if("translucent"!==f.renderPass)return;const v=c.paint.get("circle-opacity"),T=c.paint.get("circle-stroke-width"),I=c.paint.get("circle-stroke-opacity"),R=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===v.constantOr(1)&&(0===T.constantOr(1)||0===I.constantOr(1)))return;const $=f.context,X=$.gl,oe=f.depthModeForSublayer(0,l.DepthMode.ReadOnly),he=l.StencilMode.disabled,Me=f.colorModeForRenderPass(),$e=[];for(let je=0;je<m.length;je++){const at=m[je],Ze=n.getTile(at),ot=Ze.getBucket(c);if(!ot)continue;const ut=ot.programConfigurations.get(c.id),it=W(c),rt={programConfiguration:ut,program:f.useProgram("circle",ut,it),layoutVertexBuffer:ot.layoutVertexBuffer,indexBuffer:ot.indexBuffer,uniformValues:ie(f,at,Ze,c),tile:Ze};if(R){const ft=ot.segments.get();for(const $t of ft)$e.push({segments:new l.SegmentVector([$t]),sortKey:$t.sortKey,state:rt})}else $e.push({segments:ot.segments,sortKey:0,state:rt})}R&&$e.sort((je,at)=>je.sortKey-at.sortKey);const Ue={useDepthForOcclusion:"globe"!==f.transform.projection.name};for(const je of $e){const{programConfiguration:at,program:Ze,layoutVertexBuffer:ot,indexBuffer:ut,uniformValues:it,tile:rt}=je.state,ft=je.segments;f.terrain&&f.terrain.setupElevationDraw(rt,Ze,Ue),f.prepareDrawProgram($,Ze,rt.tileID.toUnwrapped()),Ze.draw($,X.TRIANGLES,oe,he,Me,l.CullFaceMode.disabled,it,c.id,ot,ut,ft,c.paint,f.transform.zoom,at)}},heatmap:function(f,n,c,m){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const v=f.context,T=v.gl,I=l.StencilMode.disabled,R=new l.ColorMode([T.ONE,T.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function($,X,oe){const he=$.gl;$.activeTexture.set(he.TEXTURE1),$.viewport.set([0,0,X.width/4,X.height/4]);let Me=oe.heatmapFbo;if(Me)he.bindTexture(he.TEXTURE_2D,Me.colorAttachment.get()),$.bindFramebuffer.set(Me.framebuffer);else{const $e=he.createTexture();he.bindTexture(he.TEXTURE_2D,$e),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_WRAP_S,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_WRAP_T,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_MIN_FILTER,he.LINEAR),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_MAG_FILTER,he.LINEAR),Me=oe.heatmapFbo=$.createFramebuffer(X.width/4,X.height/4,!1),function(Ue,je,at,Ze){const ot=Ue.gl;ot.texImage2D(ot.TEXTURE_2D,0,ot.RGBA,je.width/4,je.height/4,0,ot.RGBA,Ue.extRenderToTextureHalfFloat?Ue.extTextureHalfFloat.HALF_FLOAT_OES:ot.UNSIGNED_BYTE,null),Ze.colorAttachment.set(at)}($,X,$e,Me)}})(v,f,c),v.clear({color:l.Color.transparent});for(let $=0;$<m.length;$++){const X=m[$];if(n.hasRenderableParent(X))continue;const oe=n.getTile(X),he=oe.getBucket(c);if(!he)continue;const Me=he.programConfigurations.get(c.id),$e=f.useProgram("heatmap",Me),{zoom:Ue}=f.transform;f.terrain&&f.terrain.setupElevationDraw(oe,$e),f.prepareDrawProgram(v,$e,X.toUnwrapped()),$e.draw(v,T.TRIANGLES,l.DepthMode.disabled,I,R,l.CullFaceMode.disabled,dn(X.projMatrix,oe,Ue,c.paint.get("heatmap-intensity")),c.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,c.paint,f.transform.zoom,Me)}v.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(v,T){const I=v.context,R=I.gl,$=T.heatmapFbo;if(!$)return;I.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,$.colorAttachment.get()),I.activeTexture.set(R.TEXTURE1);let X=T.colorRampTexture;X||(X=T.colorRampTexture=new l.Texture(I,T.colorRamp,R.RGBA)),X.bind(R.LINEAR,R.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(I,R.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,v.colorModeForRenderPass(),l.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:T.paint.get("heatmap-opacity")},T.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,T.paint,v.transform.zoom)}(f,c))},line:function(f,n,c,m){if("translucent"!==f.renderPass)return;const v=c.paint.get("line-opacity"),T=c.paint.get("line-width");if(0===v.constantOr(1)||0===T.constantOr(1))return;const I=f.depthModeForSublayer(0,l.DepthMode.ReadOnly),R=f.colorModeForRenderPass(),$=c.paint.get("line-dasharray"),X=$.constantOr(1),oe=c.layout.get("line-cap"),he=c.paint.get("line-pattern"),Me=he.constantOr(1),$e=c.paint.get("line-gradient"),Ue=c.getCrossfadeParameters(),je=Me?"linePattern":"line",at=f.context,Ze=at.gl,ot=(it=>{const rt=[];zo(it)&&rt.push("RENDER_LINE_DASH"),it.paint.get("line-gradient")&&rt.push("RENDER_LINE_GRADIENT");const ft=it.paint.get("line-pattern").constantOr(1),$t=1!==it.paint.get("line-opacity").constantOr(1);return!ft&&$t&&rt.push("RENDER_LINE_ALPHA_DISCARD"),rt})(c);let ut=ot.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(ut=!1);for(const it of m){const rt=n.getTile(it);if(Me&&!rt.patternsLoaded())continue;const ft=rt.getBucket(c);if(!ft)continue;f.prepareDrawTile(it);const $t=ft.programConfigurations.get(c.id),tn=f.useProgram(je,$t,ot),Nn=he.constantOr(null);if(Nn&&rt.imageAtlas){const mn=rt.imageAtlas,ui=mn.patternPositions[Nn.to.toString()],Ei=mn.patternPositions[Nn.from.toString()];ui&&Ei&&$t.setConstantPatternPositions(ui,Ei)}const Dn=$.constantOr(null),Tn=oe.constantOr(null);if(!Me&&Dn&&Tn&&rt.lineAtlas){const mn=rt.lineAtlas,ui=mn.getDash(Dn.to,Tn),Ei=mn.getDash(Dn.from,Tn);ui&&Ei&&$t.setConstantPatternPositions(ui,Ei)}const cn=f.terrain?it.projMatrix:null,Jt=Me?Or(f,rt,c,Ue,cn):ei(f,rt,c,Ue,cn,ft.lineClipsArray.length);if($e){const mn=ft.gradients[c.id];let ui=mn.texture;if(c.gradientVersion!==mn.version){let Ei=256;if(c.stepInterpolant){const nr=n.getSource().maxzoom,Bn=it.canonical.z===nr?Math.ceil(1<<f.transform.maxZoom-it.canonical.z):1;Ei=l.clamp(l.nextPowerOfTwo(ft.maxLineLength/l.EXTENT*1024*Bn),256,at.maxTextureSize)}mn.gradient=l.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Ei,image:mn.gradient||void 0,clips:ft.lineClipsArray}),mn.texture?mn.texture.update(mn.gradient):mn.texture=new l.Texture(at,mn.gradient,Ze.RGBA),mn.version=c.gradientVersion,ui=mn.texture}at.activeTexture.set(Ze.TEXTURE1),ui.bind(c.stepInterpolant?Ze.NEAREST:Ze.LINEAR,Ze.CLAMP_TO_EDGE)}X&&(at.activeTexture.set(Ze.TEXTURE0),rt.lineAtlasTexture.bind(Ze.LINEAR,Ze.REPEAT),$t.updatePaintBuffers(Ue)),Me&&(at.activeTexture.set(Ze.TEXTURE0),rt.imageAtlasTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE),$t.updatePaintBuffers(Ue)),f.prepareDrawProgram(at,tn,it.toUnwrapped());const yn=mn=>{tn.draw(at,Ze.TRIANGLES,I,mn,R,l.CullFaceMode.disabled,Jt,c.id,ft.layoutVertexBuffer,ft.indexBuffer,ft.segments,c.paint,f.transform.zoom,$t,ft.layoutVertexBuffer2)};if(ut){const mn=f.stencilModeForClipping(it).ref;0===mn&&f.terrain&&at.clear({stencil:0});const ui={func:Ze.EQUAL,mask:255};Jt.u_alpha_discard_threshold=.8,yn(new l.StencilMode(ui,mn,255,Ze.KEEP,Ze.KEEP,Ze.INVERT)),Jt.u_alpha_discard_threshold=0,yn(new l.StencilMode(ui,mn,255,Ze.KEEP,Ze.KEEP,Ze.KEEP))}else yn(f.stencilModeForClipping(it))}ut&&(f.resetStencilClippingMasks(),f.terrain&&at.clear({stencil:0}))},fill:function(f,n,c,m){const v=c.paint.get("fill-color"),T=c.paint.get("fill-opacity");if(0===T.constantOr(1))return;const I=f.colorModeForRenderPass(),R=c.paint.get("fill-pattern"),$=f.opaquePassEnabledForLayer()&&!R.constantOr(1)&&1===v.constantOr(l.Color.transparent).a&&1===T.constantOr(0)?"opaque":"translucent";if(f.renderPass===$){const X=f.depthModeForSublayer(1,"opaque"===f.renderPass?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly);vo(f,n,c,m,X,I,!1)}if("translucent"===f.renderPass&&c.paint.get("fill-antialias")){const X=f.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,l.DepthMode.ReadOnly);vo(f,n,c,m,X,I,!0)}},"fill-extrusion":function(f,n,c,m){const v=c.paint.get("fill-extrusion-opacity");if(0!==v&&"translucent"===f.renderPass){const T=new l.DepthMode(f.context.gl.LEQUAL,l.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==v||c.paint.get("fill-extrusion-pattern").constantOr(1))rs(f,n,c,m,T,l.StencilMode.disabled,l.ColorMode.disabled),rs(f,n,c,m,T,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const I=f.colorModeForRenderPass();rs(f,n,c,m,T,l.StencilMode.disabled,I)}}},hillshade:function(f,n,c,m){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const v=f.context,T=f.depthModeForSublayer(0,l.DepthMode.ReadOnly),I=f.colorModeForRenderPass(),R=f.terrain&&f.terrain.renderingToTexture,[$,X]="translucent"!==f.renderPass||R?[{},m]:f.stencilConfigForOverlap(m);for(const oe of X){const he=n.getTile(oe);if(he.needsHillshadePrepare&&"offscreen"===f.renderPass)Vs(f,he,c,T,l.StencilMode.disabled,I);else if("translucent"===f.renderPass){const Me=R&&f.terrain?f.terrain.stencilModeForRTTOverlap(oe):$[oe.overscaledZ];Ms(f,oe,he,c,T,Me,I)}}v.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,n,c,m,v,T){if("translucent"!==f.renderPass||0===c.paint.get("raster-opacity")||!m.length)return;const I=f.context,R=I.gl,$=n.getSource(),X=f.useProgram("raster"),oe=f.colorModeForRenderPass(),he=f.terrain&&f.terrain.renderingToTexture,[Me,$e]=$ instanceof Tr||he?[{},m]:f.stencilConfigForOverlap(m),Ue=$e[$e.length-1].overscaledZ,je=!f.options.moving;for(const at of $e){const Ze=he?l.DepthMode.disabled:f.depthModeForSublayer(at.overscaledZ-Ue,1===c.paint.get("raster-opacity")?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly,R.LESS),ot=at.toUnwrapped(),ut=n.getTile(at);if(he&&(!ut||!ut.hasData()))continue;const it=he?at.projMatrix:f.transform.calculateProjMatrix(ot,je),rt=f.terrain&&he?f.terrain.stencilModeForRTTOverlap(at):Me[at.overscaledZ],ft=T?0:c.paint.get("raster-fade-duration");ut.registerFadeDuration(ft);const $t=n.findLoadedParent(at,0),tn=ua(ut,$t,n,f.transform,ft);let Nn,Dn;f.terrain&&f.terrain.prepareDrawTile(at);const Tn="nearest"===c.paint.get("raster-resampling")?R.NEAREST:R.LINEAR;I.activeTexture.set(R.TEXTURE0),ut.texture.bind(Tn,R.CLAMP_TO_EDGE),I.activeTexture.set(R.TEXTURE1),$t?($t.texture.bind(Tn,R.CLAMP_TO_EDGE),Nn=Math.pow(2,$t.tileID.overscaledZ-ut.tileID.overscaledZ),Dn=[ut.tileID.canonical.x*Nn%1,ut.tileID.canonical.y*Nn%1]):ut.texture.bind(Tn,R.CLAMP_TO_EDGE);const cn=cs(it,Dn||[0,0],Nn||1,tn,c,$ instanceof Tr?$.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(I,X,ot),$ instanceof Tr)X.draw(I,R.TRIANGLES,Ze,l.StencilMode.disabled,oe,l.CullFaceMode.disabled,cn,c.id,$.boundsBuffer,f.quadTriangleIndexBuffer,$.boundsSegments);else{const{tileBoundsBuffer:Jt,tileBoundsIndexBuffer:yn,tileBoundsSegments:mn}=f.getTileBoundsBuffers(ut);X.draw(I,R.TRIANGLES,Ze,rt,oe,l.CullFaceMode.disabled,cn,c.id,Jt,yn,mn)}}f.resetStencilClippingMasks()},background:function(f,n,c,m){const v=c.paint.get("background-color"),T=c.paint.get("background-opacity");if(0===T)return;const I=f.context,R=I.gl,$=f.transform,X=$.tileSize,oe=c.paint.get("background-pattern");if(f.isPatternMissing(oe))return;const he=!oe&&1===v.a&&1===T&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==he)return;const Me=l.StencilMode.disabled,$e=f.depthModeForSublayer(0,"opaque"===he?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly),Ue=f.colorModeForRenderPass(),je=f.useProgram(oe?"backgroundPattern":"background");let at,Ze=m;Ze||(at=f.getBackgroundTiles(),Ze=Object.values(at).map(ut=>ut.tileID)),oe&&(I.activeTexture.set(R.TEXTURE0),f.imageManager.bind(f.context));const ot=c.getCrossfadeParameters();for(const ut of Ze){const it=ut.toUnwrapped(),rt=m?ut.projMatrix:f.transform.calculateProjMatrix(it);f.prepareDrawTile(ut);const ft=n?n.getTile(ut):at?at[ut.key]:new l.Tile(ut,X,$.zoom,f),$t=oe?js(rt,T,f,oe,{tileID:ut,tileSize:X},ot):yr(rt,T,v);f.prepareDrawProgram(I,je,it);const{tileBoundsBuffer:tn,tileBoundsIndexBuffer:Nn,tileBoundsSegments:Dn}=f.getTileBoundsBuffers(ft);je.draw(I,R.TRIANGLES,$e,Me,Ue,l.CullFaceMode.disabled,$t,c.id,tn,Nn,Dn)}},sky:function(f,n,c){const m=f.transform,v="mercator"===m.projection.name||"globe"===m.projection.name?1:l.smoothstep(7,8,m.zoom),T=c.paint.get("sky-opacity")*v;if(0===T)return;const I=f.context,R=c.paint.get("sky-type"),$=new l.DepthMode(I.gl.LEQUAL,l.DepthMode.ReadOnly,[0,1]),X=f.frameCounter/1e3%1;"atmosphere"===R?"offscreen"===f.renderPass?c.needsSkyboxCapture(f)&&(function(oe,he,Me,$e){const Ue=oe.context,je=Ue.gl;let at=he.skyboxFbo;if(!at){at=he.skyboxFbo=Ue.createFramebuffer(32,32,!1),he.skyboxGeometry=new D(Ue),he.skyboxTexture=Ue.gl.createTexture(),je.bindTexture(je.TEXTURE_CUBE_MAP,he.skyboxTexture),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_WRAP_S,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_WRAP_T,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_MIN_FILTER,je.LINEAR),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_MAG_FILTER,je.LINEAR);for(let it=0;it<6;++it)je.texImage2D(je.TEXTURE_CUBE_MAP_POSITIVE_X+it,0,je.RGBA,32,32,0,je.RGBA,je.UNSIGNED_BYTE,null)}Ue.bindFramebuffer.set(at.framebuffer),Ue.viewport.set([0,0,32,32]);const Ze=he.getCenter(oe,!0),ot=oe.useProgram("skyboxCapture"),ut=new Float64Array(16);l.identity(ut),l.rotateY(ut,ut,.5*-Math.PI),N(Ue,he,ot,ut,Ze,0),l.identity(ut),l.rotateY(ut,ut,.5*Math.PI),N(Ue,he,ot,ut,Ze,1),l.identity(ut),l.rotateX(ut,ut,.5*-Math.PI),N(Ue,he,ot,ut,Ze,2),l.identity(ut),l.rotateX(ut,ut,.5*Math.PI),N(Ue,he,ot,ut,Ze,3),l.identity(ut),N(Ue,he,ot,ut,Ze,4),l.identity(ut),l.rotateY(ut,ut,Math.PI),N(Ue,he,ot,ut,Ze,5),Ue.viewport.set([0,0,oe.width,oe.height])}(f,c),c.markSkyboxValid(f)):"sky"===f.renderPass&&function(oe,he,Me,$e,Ue){const je=oe.context,at=je.gl,Ze=oe.transform,ot=oe.useProgram("skybox");je.activeTexture.set(at.TEXTURE0),at.bindTexture(at.TEXTURE_CUBE_MAP,he.skyboxTexture);const ut={u_matrix:Ze.skyboxMatrix,u_sun_direction:he.getCenter(oe,!1),u_cubemap:0,u_opacity:$e,u_temporal_offset:Ue};oe.prepareDrawProgram(je,ot),ot.draw(je,at.TRIANGLES,Me,l.StencilMode.disabled,oe.colorModeForRenderPass(),l.CullFaceMode.backCW,ut,"skybox",he.skyboxGeometry.vertexBuffer,he.skyboxGeometry.indexBuffer,he.skyboxGeometry.segment)}(f,c,$,T,X):"gradient"===R&&"sky"===f.renderPass&&function(oe,he,Me,$e,Ue){const je=oe.context,at=je.gl,Ze=oe.transform,ot=oe.useProgram("skyboxGradient");he.skyboxGeometry||(he.skyboxGeometry=new D(je)),je.activeTexture.set(at.TEXTURE0);let ut=he.colorRampTexture;ut||(ut=he.colorRampTexture=new l.Texture(je,he.colorRamp,at.RGBA)),ut.bind(at.LINEAR,at.CLAMP_TO_EDGE);const it=(rt=Ze.skyboxMatrix,ft=he.getCenter(oe,!1),$t=he.paint.get("sky-gradient-radius"),tn=$e,Nn=Ue,{u_matrix:rt,u_color_ramp:0,u_center_direction:ft,u_radius:l.degToRad($t),u_opacity:tn,u_temporal_offset:Nn});var rt,ft,$t,tn,Nn;oe.prepareDrawProgram(je,ot),ot.draw(je,at.TRIANGLES,Me,l.StencilMode.disabled,oe.colorModeForRenderPass(),l.CullFaceMode.backCW,it,"skyboxGradient",he.skyboxGeometry.vertexBuffer,he.skyboxGeometry.indexBuffer,he.skyboxGeometry.segment)}(f,c,$,T,X)},debug:function(f,n,c){for(let m=0;m<c.length;m++)ys(f,n,c[m])},custom:function(f,n,c){const m=f.context,v=c.implementation;if(f.transform.projection.unsupportedLayers&&f.transform.projection.unsupportedLayers.includes("custom"))l.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===f.renderPass){const T=v.prerender;T&&(f.setCustomLayerDefaults(),m.setColorMode(f.colorModeForRenderPass()),T.call(v,m.gl,f.transform.customLayerMatrix()),m.setDirty(),f.setBaseState())}else if("translucent"===f.renderPass){f.setCustomLayerDefaults(),m.setColorMode(f.colorModeForRenderPass()),m.setStencilMode(l.StencilMode.disabled);const T="3d"===v.renderingMode?new l.DepthMode(f.context.gl.LEQUAL,l.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,l.DepthMode.ReadOnly);m.setDepthMode(T),v.render(m.gl,f.transform.customLayerMatrix()),m.setDirty(),f.setBaseState(),m.bindFramebuffer.set(null)}}};class re{constructor(n,c){this.context=new mi(n),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=l.SourceCache.maxUnderzooming+l.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ke,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,c){const m=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ne(this,n));const v=this._terrain;this.transform.elevation=m?v:null,v.update(n,this.transform,c)}_updateFog(n){const c=n.fog;if(!c||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,v]=c.getFovAdjustedRange(this.transform._fov);if(m>v)return void(this.transform.fogCullDistSq=null);const T=m+.78*(v-m);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,c){if(this.width=n*l.exported.devicePixelRatio,this.height=c*l.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const n=this.context,c=new l.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(l.EXTENT,0),c.emplaceBack(0,l.EXTENT),c.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(c,l.posAttributes.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const m=new l.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(l.EXTENT,0),m.emplaceBack(0,l.EXTENT),m.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=n.createVertexBuffer(m,l.posAttributes.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const v=new l.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(v,l.posAttributes.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const T=new l.StructArrayLayout4i8;T.emplaceBack(0,0,0,0),T.emplaceBack(l.EXTENT,0,l.EXTENT,0),T.emplaceBack(0,l.EXTENT,0,l.EXTENT),T.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(T,l.boundsAttributes.members),this.mercatorBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const I=new l.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(I);const R=new l.StructArrayLayout1ui2;for(const X of[0,1,3,2,0])R.emplaceBack(X);this.debugIndexBuffer=n.createIndexBuffer(R),this.emptyTexture=new l.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA),this.identityMat=l.create();const $=this.context.gl;this.stencilClearMode=new l.StencilMode({func:$.ALWAYS,mask:0},0,255,$.ZERO,$.ZERO,$.ZERO),this.loadTimeStamps.push(l.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,c=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,c.TRIANGLES,l.DepthMode.disabled,this.stencilClearMode,l.ColorMode.disabled,l.CullFaceMode.disabled,Xo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,c,m){if(!c||this.currentStencilSource===c.id||!n.isTileClipped()||!m||0===m.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let R=!1;for(const $ of m)if(void 0===this._tileClippingMaskIDs[$.key]){R=!0;break}if(!R)return}this.currentStencilSource=c.id;const v=this.context,T=v.gl;this.nextStencilID+m.length>256&&this.clearStencil(),v.setColorMode(l.ColorMode.disabled),v.setDepthMode(l.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of m){const $=c.getTile(R),X=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,{tileBoundsBuffer:oe,tileBoundsIndexBuffer:he,tileBoundsSegments:Me}=this.getTileBoundsBuffers($);I.draw(v,T.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:T.ALWAYS,mask:0},X,255,T.KEEP,T.KEEP,T.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,Xo(R.projMatrix),"$clipping",oe,he,Me)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,c=this.context.gl;return new l.StencilMode({func:c.NOTEQUAL,mask:255},n,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const c=this.context.gl;return new l.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(n){const c=this.context.gl,m=n.sort((I,R)=>R.overscaledZ-I.overscaledZ),v=m[m.length-1].overscaledZ,T=m[0].overscaledZ-v+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const I={};for(let R=0;R<T;R++)I[R+v]=new l.StencilMode({func:c.GEQUAL,mask:255},R+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=T,[I,m]}return[{[v]:l.StencilMode.disabled},m]}colorModeForRenderPass(){const n=this.context.gl;if(this._showOverdrawInspector){const c=1/8;return new l.ColorMode([n.CONSTANT_COLOR,n.ONE],new l.Color(c,c,c,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?l.ColorMode.unblended:l.ColorMode.alphaBlended}depthModeForSublayer(n,c,m){if(!this.opaquePassEnabledForLayer())return l.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new l.DepthMode(m||this.context.gl.LEQUAL,c,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,c){this.style=n,this.options=c,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const m=this.style.order,v=this.style._sourceCaches;for(const X in v){const oe=v[X];oe.used&&oe.prepare(this.context)}const T={},I={},R={};for(const X in v){const oe=v[X];T[X]=oe.getVisibleCoordinates(),I[X]=T[X].slice().reverse(),R[X]=oe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let X=0;X<m.length;X++)if(this.style._layers[m[X]].is3D()){this.opaquePassCutoff=X;break}if(this.terrain&&(this.terrain.updateTileBinding(R),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new l.GlobeSharedBuffers(this.context)),!l.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const X of m){const oe=this.style._layers[X],he=n._getLayerSourceCache(oe);if(!oe.hasOffscreenPass()||oe.isHidden(this.transform.zoom))continue;const Me=he?I[he.id]:void 0;("custom"===oe.type||oe.isSky()||Me&&Me.length)&&this.renderLayer(this,he,oe,Me)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let $=l.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&($=this.style.fog.properties.get("color")),this.context.clear({color:c.showOverdrawInspector?l.Color.black:$,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const X=this.style._layers[m[this.currentLayer]],oe=n._getLayerSourceCache(X);if(X.isSky())continue;const he=oe?I[oe.id]:void 0;this._renderTileClippingMasks(X,oe,he),this.renderLayer(this,oe,X,he)}if(this.renderPass="sky",(l.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const X=this.style._layers[m[this.currentLayer]],oe=n._getLayerSourceCache(X);X.isSky()&&this.renderLayer(this,oe,X,oe?I[oe.id]:void 0)}for("globe"===this.transform.projection.name&&function(X){const oe=X.context,he=oe.gl,Me=X.transform,$e=new l.DepthMode(he.LEQUAL,l.DepthMode.ReadOnly,[0,1]),Ue=X.useProgram("globeAtmosphere"),je=Me._camera.getWorldToCamera(Me.worldSize,1),at=Me._camera.getCameraToClipPerspective(Me._fov,Me.width/Me.height,Me._nearZ,Me._farZ),Ze=l.mul([],je,l.calculateGlobeMatrix(Me,Me.worldSize)),ot=l.mul([],Me.labelPlaneMatrix,at),ut=l.transformMat4([],[0,0,0],Ze),it=l.add([],ut,[Me.worldSize/Math.PI/2,0,0]),rt=l.transformMat4([],ut,ot),ft=l.transformMat4([],it,ot),$t=l.length(l.sub([],ft,rt)),tn=1-l.globeToMercatorTransition(Me.zoom),Nn={u_center:rt,u_radius:$t,u_screen_size:[Me.width,Me.height],u_pixel_ratio:l.exported.devicePixelRatio,u_opacity:tn,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};X.prepareDrawProgram(oe,Ue);const Dn=X.globeSharedBuffers;Dn&&Ue.draw(oe,he.TRIANGLES,$e,l.StencilMode.disabled,l.ColorMode.alphaBlended,l.CullFaceMode.backCW,Nn,"skybox",Dn.atmosphereVertexBuffer,Dn.atmosphereIndexBuffer,Dn.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const X=this.style._layers[m[this.currentLayer]],oe=n._getLayerSourceCache(X);if(X.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(X)){if(X.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const he=oe?("symbol"===X.type?R:I)[oe.id]:void 0;this._renderTileClippingMasks(X,oe,oe?T[oe.id]:void 0),this.renderLayer(this,oe,X,he),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let X=null;l.values(this.style._layers).forEach(oe=>{const he=n._getLayerSourceCache(oe);he&&!oe.isHidden(this.transform.zoom)&&(!X||X.getSource().maxzoom<he.getSource().maxzoom)&&(X=he)}),X&&this.options.showTileBoundaries&&A.debug(this,X,X.getVisibleCoordinates())}this.options.showPadding&&function(X){const oe=X.transform.padding;Dr(X,X.transform.height-(oe.top||0),3,wc),Dr(X,oe.bottom||0,3,ks),_s(X,oe.left||0,3,Po),_s(X,X.transform.width-(oe.right||0),3,qs);const he=X.transform.centerPoint;var Me,$e,Ue,je;Zo(Me=X,($e=he.x)-1,(Ue=X.transform.height-he.y)-10,2,20,je=Qo),Zo(Me,$e-10,Ue-1,20,2,je)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(l.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,c,m,v){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||v&&v.length)&&(this.id=m.id,this.gpuTimingStart(m),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(m.type)||A[m.type](n,c,m,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let m=this.gpuTimers[n.id];m||(m=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),m.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,m.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}queryGpuTimers(n){const c={};for(const m in n){const v=n[m],T=this.context.extTimerQuery,I=T.getQueryObjectEXT(v.query,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(v.query),c[m]=I}return c}translatePosMatrix(n,c,m,v,T){if(!m[0]&&!m[1])return n;const I=T?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(I){const X=Math.sin(I),oe=Math.cos(I);m=[m[0]*oe-m[1]*X,m[0]*X+m[1]*oe]}const R=[T?m[0]:gt(c,m[0],this.transform.zoom),T?m[1]:gt(c,m[1],this.transform.zoom),0],$=new Float32Array(16);return l.translate($,n,R),$}saveTileTexture(n){const c=this._tileTextures[n.size[0]];c?c.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const c=this._tileTextures[n];return c&&c.length>0?c.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const c=this.imageManager.getPattern(n.from.toString()),m=this.imageManager.getPattern(n.to.toString());return!c||!m}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),c&&!n&&0!==c.getOpacity(this.transform.pitch)&&m.push("FOG"),n&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(n,c,m){this.cache=this.cache||{};const v=m||[],T=this.currentGlobalDefines().concat(v),I=sn.cacheKey(n,T,c);return this.cache[I]||(this.cache[I]=new sn(this.context,n,Xs[n],c,Ea[n],T)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=l.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(n){this.terrain&&this.terrain.prepareDrawTile(n)}prepareDrawProgram(n,c,m){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const T=v.getOpacity(this.transform.pitch);0!==T&&c.setFogUniformValues(n,((I,R,$,X)=>{const oe=R.properties.get("color"),he=I.frameCounter/1e3%1,Me=[oe.r/oe.a,oe.g/oe.a,oe.b/oe.a,X];return{u_fog_matrix:$?I.transform.calculateFogTileMatrix($):I.identityMat,u_fog_range:R.getFovAdjustedRange(I.transform._fov),u_fog_color:Me,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_temporal_offset:he}})(this,v,m,T))}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,c=n.createTexture();return n.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&0!==n.getOpacity(this.transform.pitch)}getBackgroundTiles(){const n=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const v of m)c[v.key]=n[v.key]||new l.Tile(v,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class De{constructor(n=0,c=0,m=0,v=0){if(isNaN(n)||n<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=c,this.left=m,this.right=v}interpolate(n,c,m){return null!=c.top&&null!=n.top&&(this.top=l.number(n.top,c.top,m)),null!=c.bottom&&null!=n.bottom&&(this.bottom=l.number(n.bottom,c.bottom,m)),null!=c.left&&null!=n.left&&(this.left=l.number(n.left,c.left,m)),null!=c.right&&null!=n.right&&(this.right=l.number(n.right,c.right,m)),this}getCenter(n,c){const m=l.clamp((this.left+n-this.right)/2,0,n),v=l.clamp((this.top+c-this.bottom)/2,0,c);return new l.pointGeometry(m,v)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new De(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function kt(f,n){const c=l.getColumn(f,3);l.fromQuat(f,n),l.setColumn(f,3,c)}function Rn(f,n){l.setColumn(f,3,[n[0],n[1],n[2],1])}function Xn(f,n){const c=l.identity$1([]);return l.rotateZ$1(c,c,-n),l.rotateX$1(c,c,-f),c}function Wi(f,n){const c=[f[0],f[1],0],m=[n[0],n[1],0];if(l.length(c)>=1e-15){const I=l.normalize([],c);l.scale$2(m,I,l.dot(m,I)),n[0]=m[0],n[1]=m[1]}const v=l.cross([],n,f);if(l.len(v)<1e-15)return null;const T=Math.atan2(-v[1],v[0]);return Xn(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),T)}class pi{constructor(n,c){this.position=n,this.orientation=c}get position(){return this._position}set position(n){this._position=this._renderWorldCopies?function(c){if(!c)return;const m=Array.isArray(c)?new l.MercatorCoordinate(c[0],c[1],c[2]):c;return m.x=l.wrap(m.x,0,1),m}(n):n}lookAtPoint(n,c){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(n)):0,v=this.position,T=l.MercatorCoordinate.fromLngLat(n,m),I=[T.x-v.x,T.y-v.y,T.z-v.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Wi(I,c)}setPitchBearing(n,c){this.orientation=Xn(l.degToRad(n),l.degToRad(-c))}}class lr{constructor(n,c){this._transform=l.identity([]),this._orientation=l.identity$1([]),c&&(this._orientation=c,kt(this._transform,this._orientation)),n&&Rn(this._transform,n)}get mercatorPosition(){const n=this.position;return new l.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=l.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){Rn(this._transform,n)}get orientation(){return this._orientation}set orientation(n){this._orientation=n,kt(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,c){this._orientation=Xn(n,c),kt(this._transform,this._orientation)}forward(){const n=l.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=l.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=l.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,c){const m=new Float64Array(16);return l.invert(m,this.getWorldToCamera(n,c)),m}getWorldToCameraPosition(n,c,m){const v=this.position;l.scale$2(v,v,-n);const T=new Float64Array(16);return l.fromScaling(T,[m,m,m]),l.translate(T,T,v),T[10]*=c,T}getWorldToCamera(n,c){const m=new Float64Array(16),v=new Float64Array(4),T=this.position;return l.conjugate(v,this._orientation),l.scale$2(T,T,-n),l.fromQuat(m,v),l.translate(m,m,T),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(n,c,m,v){const T=new Float64Array(16);return l.perspective(T,n,c,m,v),T}getDistanceToElevation(n){const c=0===n?0:l.mercatorZfromAltitude(n,this.position[1]),m=this.forward();return(c-this.position[2])/m[2]}clone(){return new lr([...this.position],[...this.orientation])}}function so(f,n){const c=xo(f),m=function(T,I,R,$,X){const oe=new l.LngLat(R.lng-180*Eo,R.lat),he=new l.LngLat(R.lng+180*Eo,R.lat),Me=T.project(oe.lng,oe.lat),$e=T.project(he.lng,he.lat),Ue=-Math.atan2($e.y-Me.y,$e.x-Me.x),je=l.MercatorCoordinate.fromLngLat(R);je.y=l.clamp(je.y,-.999975,.999975);const at=je.toLngLat(),Ze=T.project(at.lng,at.lat),ot=l.MercatorCoordinate.fromLngLat(at);ot.x+=Eo;const ut=ot.toLngLat(),it=T.project(ut.lng,ut.lat),rt=Ss(it.x-Ze.x,it.y-Ze.y,Ue),ft=l.MercatorCoordinate.fromLngLat(at);ft.y+=Eo;const $t=ft.toLngLat(),tn=T.project($t.lng,$t.lat),Nn=Ss(tn.x-Ze.x,tn.y-Ze.y,Ue),Dn=Math.abs(rt.x)/Math.abs(Nn.y),Tn=l.identity([]);l.rotateZ(Tn,Tn,-Ue*(1-(X?0:$)));const cn=l.identity([]);return l.scale(cn,cn,[1,1-(1-Dn)*$,1]),cn[4]=-Nn.x/Nn.y*$,l.rotateZ(cn,cn,Ue),l.multiply$1(cn,Tn,cn),cn}(f.projection,0,f.center,c,n),v=Lr(f);return l.scale(m,m,[v,v,1]),m}function Lr(f){const n=f.projection,c=xo(f),m=uo(n,f.center),v=uo(n,l.LngLat.convert(n.center));return Math.pow(2,m*c+(1-c)*v)}function xo(f){const n=f.projection.range;if(!n)return 0;const c=Math.max(f.width,f.height),m=Math.log(c/1024)/Math.LN2;return l.smoothstep(n[0]+m,n[1]+m,f.zoom)}const Eo=1/4e4;function uo(f,n){const c=l.clamp(n.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),m=new l.LngLat(n.lng-180*Eo,c),v=new l.LngLat(n.lng+180*Eo,c),T=f.project(m.lng,c),I=f.project(v.lng,c),R=l.MercatorCoordinate.fromLngLat(m),$=l.MercatorCoordinate.fromLngLat(v),X=I.x-T.x,oe=I.y-T.y,he=$.x-R.x,Me=$.y-R.y,$e=Math.sqrt((he*he+Me*Me)/(X*X+oe*oe));return Math.log($e)/Math.LN2}function Ss(f,n,c){const m=Math.cos(c),v=Math.sin(c);return{x:f*m-n*v,y:f*v+n*m}}class Jr{constructor(n,c,m,v,T){this.tileSize=512,this._renderWorldCopies=void 0===T||T,this._minZoom=n||0,this._maxZoom=c||22,this._minPitch=m??0,this._maxPitch=v??60,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new De,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new lr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const n=new Jr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.setProjection(this.getProjection()),n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n.tileSize=this.tileSize,n.setMaxBounds(this.getMaxBounds()),n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._cameraZoom=this._cameraZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,n?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(n){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),n&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return l.pick(this.projection,["name","center","parallels"])}setProjection(n){null==n&&(n={name:"mercator"}),this.projectionOptions=n;const c=this.projection?this.getProjection():void 0;return this.projection=l.getProjection(n),!ge(c,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(n){void 0===n?n=!0:null===n&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return l.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const c=-n*Math.PI/180;var m,v,T,I,R,$,X,oe,he,Me;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(m=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),v=this.rotationMatrix,I=this.angle,R=(T=this.rotationMatrix)[0],$=T[1],X=T[2],oe=T[3],he=Math.sin(I),Me=Math.cos(I),v[0]=R*Me+X*he,v[1]=$*Me+oe*he,v[2]=R*-he+X*Me,v[3]=$*-he+oe*Me)}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const c=l.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(n){const c=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===n?(this._cameraZoom=null,!1):(this._centerAltitude=n,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let v=0,T=0;for(let I=0;I<c.length;I++){const R=new l.pointGeometry(c[I][0]*this.width,m+c[I][1]*(this.height-m)),$=n.pointCoordinate(R);if(!$)continue;const X=1/Math.hypot($[0]-this._camera.position[0],$[1]-this._camera.position[1]);v+=$[3]*X,T+=X}return 0===T?NaN:v/T}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const n=this._cameraZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,v=this._mercatorZfromZoom(n),T=this._mercatorZfromZoom(this._maxZoom),I=Math.max(v-m,T);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let m;m=n.z<this._camera.position[2]?[c.x,c.y,c.z]:[n.x,n.y,n.z];const v=l.length(l.sub([],this._camera.position,m));return l.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let c=!1;if(n.orientation&&!l.exactEquals(n.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(n.orientation)),n.position){const m=[n.position.x,n.position.y,n.position.z];l.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,c=new pi;return c.position=new l.MercatorCoordinate(n[0],n[1],n[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(n){if(!l.length$1(n))return!1;l.normalize$1(n,n);const c=l.transformQuat([],[0,0,-1],n),m=l.transformQuat([],[0,-1,0],n);if(m[2]<0)return!1;const v=Wi(c,m);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(n){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;n[2]=l.clamp(n[2],v/m,v/c),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,c,m){this._unmodified=!1,this._edgeInsets.interpolate(n,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const c=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(n){const c=[new l.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const m=this.pointCoordinate(new l.pointGeometry(0,0)),v=this.pointCoordinate(new l.pointGeometry(this.width,0)),T=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),I=this.pointCoordinate(new l.pointGeometry(0,this.height)),R=Math.floor(Math.min(m.x,v.x,T.x,I.x)),$=Math.floor(Math.max(m.x,v.x,T.x,I.x)),X=1;for(let oe=R-X;oe<=$+X;oe++)0!==oe&&c.push(new l.UnwrappedTileID(oe,n))}return c}coveringTiles(n){let c=this.coveringZoomLevel(n);const m=c,v=this.elevation&&!n.isTerrainDEM,T="mercator"===this.projection.name;if(void 0!==n.minzoom&&c<n.minzoom)return[];void 0!==n.maxzoom&&c>n.maxzoom&&(c=n.maxzoom);const I=this.locationCoordinate(this.center),R=1<<c,$=[R*I.x,R*I.y,0],X=l.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,"globe"!==this.projection.name),oe=this.pointCoordinate(this.getCameraPoint()),he=R*l.mercatorZfromAltitude(1,this.center.lat),Me=this._camera.position[2]/l.mercatorZfromAltitude(1,this.center.lat),$e=[R*oe.x,R*oe.y,Me],Ue=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),je=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,at=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Ze=n.isTerrainDEM?-at:this._elevation?this._elevation.getMinElevationBelowMSL():0,ot=this.projection.isReprojectedInTileSpace?Lr(this):1,ut=Jt=>{const yn=1/4e4,mn=new l.MercatorCoordinate(Jt.x+yn,Jt.y,Jt.z),ui=new l.MercatorCoordinate(Jt.x,Jt.y+yn,Jt.z),Ei=Jt.toLngLat(),nr=mn.toLngLat(),Bn=ui.toLngLat(),vi=this.locationCoordinate(Ei),qi=this.locationCoordinate(nr),Mr=this.locationCoordinate(Bn),Qr=Math.hypot(qi.x-vi.x,qi.y-vi.y),Zi=Math.hypot(Mr.x-vi.x,Mr.y-vi.y);return Math.sqrt(Qr*Zi)*ot/yn},it=Jt=>{const yn=at,mn=Ze;return{aabb:l.tileAABB(this,R,0,0,0,Jt,mn,yn,this.projection),zoom:0,x:0,y:0,minZ:mn,maxZ:yn,wrap:Jt,fullyVisible:!1}},rt=[];let ft=[];const $t=c,tn=n.reparseOverscaled?m:c,Nn=Jt=>Jt*Jt,Dn=Nn((Me-this._centerAltitude)*he),Tn=Jt=>{if(!this._elevation||!Jt.tileID||!T)return;const yn=this._elevation.getMinMaxForTile(Jt.tileID),mn=Jt.aabb;yn?(mn.min[2]=yn.min,mn.max[2]=yn.max,mn.center[2]=(mn.min[2]+mn.max[2])/2):(Jt.shouldSplit=cn(Jt),Jt.shouldSplit||(mn.min[2]=mn.max[2]=mn.center[2]=this._centerAltitude))},cn=Jt=>{if(Jt.zoom<je)return!0;if(Jt.zoom===$t)return!1;if(null!=Jt.shouldSplit)return Jt.shouldSplit;const yn=Jt.aabb.distanceX($e),mn=Jt.aabb.distanceY($e);let ui=Dn;v&&(ui=Nn(Jt.aabb.distanceZ($e)*he));let Ei=1;if(this.projection.isReprojectedInTileSpace&&m<=5){const Bn=Math.pow(2,Jt.zoom),vi=ut(new l.MercatorCoordinate((Jt.x+.5)/Bn,(Jt.y+.5)/Bn));Ei=vi>.85?1:vi}const nr=yn*yn+mn*mn+ui;return nr<Nn((1<<$t-Jt.zoom)*Ue*Ei*((Bn,vi)=>{if(vi*Nn(.707)<Bn)return 1;const qi=Math.sqrt(vi/Bn);return qi/(1.4144271570014144+(Math.pow(1.1,qi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ui,Dn),nr))};if(this.renderWorldCopies)for(let Jt=1;Jt<=3;Jt++)rt.push(it(-Jt)),rt.push(it(Jt));for(rt.push(it(0));rt.length>0;){const Jt=rt.pop(),yn=Jt.x,mn=Jt.y;let ui=Jt.fullyVisible;if(!ui){const Ei=Jt.aabb.intersects(X);if(0===Ei)continue;ui=2===Ei}if(Jt.zoom!==$t&&cn(Jt))for(let Ei=0;Ei<4;Ei++){const nr=(yn<<1)+Ei%2,Bn=(mn<<1)+(Ei>>1),vi={aabb:T?Jt.aabb.quadrant(Ei):l.tileAABB(this,R,Jt.zoom+1,nr,Bn,Jt.wrap,Jt.minZ,Jt.maxZ,this.projection),zoom:Jt.zoom+1,x:nr,y:Bn,wrap:Jt.wrap,fullyVisible:ui,tileID:void 0,shouldSplit:void 0,minZ:Jt.minZ,maxZ:Jt.maxZ};v&&(vi.tileID=new l.OverscaledTileID(Jt.zoom+1===$t?tn:Jt.zoom+1,Jt.wrap,Jt.zoom+1,nr,Bn),Tn(vi)),rt.push(vi)}else{const Ei=Jt.zoom===$t?tn:Jt.zoom;if(n.minzoom&&n.minzoom>Ei)continue;const nr=$[0]-(.5+yn+(Jt.wrap<<Jt.zoom))*(1<<c-Jt.zoom),Bn=$[1]-.5-mn,vi=Jt.tileID?Jt.tileID:new l.OverscaledTileID(Ei,Jt.wrap,Jt.zoom,yn,mn);ft.push({tileID:vi,distanceSq:nr*nr+Bn*Bn})}}if(this.fogCullDistSq){const Jt=this.fogCullDistSq,yn=this.horizonLineFromTop();ft=ft.filter(mn=>{const ui=[0,0,0,1],Ei=[l.EXTENT,l.EXTENT,0,1],nr=this.calculateFogTileMatrix(mn.tileID.toUnwrapped());l.transformMat4$1(ui,ui,nr),l.transformMat4$1(Ei,Ei,nr);const Bn=l.getAABBPointSquareDist(ui,Ei);if(0===Bn)return!0;let vi=!1;const qi=this._elevation;if(qi&&Bn>Jt&&0!==yn){const Mr=this.calculateProjMatrix(mn.tileID.toUnwrapped());let Qr;n.isTerrainDEM||(Qr=qi.getMinMaxForTile(mn.tileID)),Qr||(Qr={min:Ze,max:at});const Zi=l.furthestTileCorner(this.rotation),Pi=[Zi[0]*l.EXTENT,Zi[1]*l.EXTENT,Qr.max];l.transformMat4(Pi,Pi,Mr),vi=(1-Pi[1])*this.height*.5<yn}return Bn<Jt||vi})}return ft.sort((Jt,yn)=>Jt.distanceSq-yn.distanceSq).map(Jt=>Jt.tileID)}resize(n,c){this.width=n,this.height=c,this.pixelsToGLUnits=[2/n,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const c=l.clamp(n.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),m=this.projection.project(n.lng,c);return new l.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,c){const m=this.pointCoordinate(c),v=this.pointCoordinate(this.centerPoint),T=this.locationCoordinate(n);this.setLocation(new l.MercatorCoordinate(T.x-(m.x-v.x),T.y-(m.y-v.y)))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this._coordinatePoint(this.locationCoordinate(n),!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,c){const m=c?l.mercatorZfromAltitude(c,n.lat):void 0,v=this.projection.project(n.lng,n.lat);return new l.MercatorCoordinate(v.x,v.y,m)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,c){const m=c??this._centerAltitude,v=[n.x,n.y,0,1],T=[n.x,n.y,1,1];l.transformMat4$1(v,v,this.pixelMatrixInverse),l.transformMat4$1(T,T,this.pixelMatrixInverse);const I=T[3];l.scale$1(v,v,1/v[3]),l.scale$1(T,T,1/I);const R=v[2],$=T[2];return{p0:v,p1:T,t:R===$?0:(m-R)/($-R)}}screenPointToMercatorRay(n){const c=[n.x,n.y,0,1],m=[n.x,n.y,1,1];return l.transformMat4$1(c,c,this.pixelMatrixInverse),l.transformMat4$1(m,m,this.pixelMatrixInverse),l.scale$1(c,c,1/c[3]),l.scale$1(m,m,1/m[3]),c[2]=l.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,m[2]=l.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,l.scale$1(c,c,1/this.worldSize),l.scale$1(m,m,1/this.worldSize),new l.Ray([c[0],c[1],c[2]],l.normalize([],l.sub([],m,c)))}rayIntersectionCoordinate(n){const{p0:c,p1:m,t:v}=n,T=l.mercatorZfromAltitude(c[2],this._center.lat),I=l.mercatorZfromAltitude(m[2],this._center.lat);return new l.MercatorCoordinate(l.number(c[0],m[0],v)/this.worldSize,l.number(c[1],m[1],v)/this.worldSize,l.number(T,I,v))}pointCoordinate(n,c=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(n.x,n.y,c)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);const c=this.elevation;let m=this.elevation.pointCoordinate(n);if(m)return new l.MercatorCoordinate(m[0],m[1],m[2]);let v=0,T=this.horizonLineFromTop();if(n.y>T)return this.pointCoordinate(n);const I=.02*T,R=n.clone();for(let $=0;$<10&&T-v>I;$++){R.y=l.number(v,T,.66);const X=c.pointCoordinate(R);X?(T=R.y,m=X):v=R.y}return m?new l.MercatorCoordinate(m[0],m[1],m[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){if(this.elevation)return!this.elevation.pointCoordinate(n);{const c=this.horizonLineFromTop();return n.y<c}}_coordinatePoint(n,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,v=[n.x*this.worldSize,n.y*this.worldSize,m+n.toAltitude(),1];return l.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new l.pointGeometry(v[0]/v[3],v[1]/v[3]):new l.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(n,c){const m=new l.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),v=new l.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),T=new l.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),I=new l.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let R=this.pointCoordinate(m,n),$=this.pointCoordinate(v,n);const X=this.pointCoordinate(T,c),oe=this.pointCoordinate(I,c),he=(Me,$e)=>($e.y-Me.y)/($e.x-Me.x);return R.y>1&&$.y>=0?R=new l.MercatorCoordinate((1-oe.y)/he(oe,R)+oe.x,1):R.y<0&&$.y<=1&&(R=new l.MercatorCoordinate(-oe.y/he(oe,R)+oe.x,0)),$.y>1&&R.y>=0?$=new l.MercatorCoordinate((1-X.y)/he(X,$)+X.x,1):$.y<0&&R.y<=1&&($=new l.MercatorCoordinate(-X.y/he(X,$)+X.x,0)),(new l.LngLatBounds).extend(this.coordinateLocation(R)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(oe)).extend(this.coordinateLocation(X))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length)return this._getBounds(0,0);const c=n.visibleDemTiles.reduce((m,v)=>{if(v.dem){const T=v.dem.tree;m.min=Math.min(m.min,T.minimums[0]),m.max=Math.max(m.max,T.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(c.min*n.exaggeration(),c.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return n?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-l.MAX_MERCATOR_LATITUDE,this.maxLat=l.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=l.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=l.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=l.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=l.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,c){return this.projection.createTileTransform(this,c).createTileMatrix(n)}calculateDistanceTileData(n){const c=n.key,m=this._distanceTileDataCache;if(m[c])return m[c];const v=n.canonical,T=1/this.height,I=this.cameraWorldSize/this.zoomScale(v.z),R=(v.x+Math.pow(2,v.z)*n.wrap)*I,$=v.y*I,X=this.point,oe=this.angle,he=Math.sin(-oe),Me=-Math.cos(-oe);return m[c]={bearing:[he,Me],center:[(X.x-R)*T,(X.y-$)*T],scale:I/l.EXTENT*T},m[c]}calculateFogTileMatrix(n){const c=n.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const v=this.calculatePosMatrix(n,this.cameraWorldSize);return l.multiply$1(v,this.worldToFogMatrix,v),m[c]=new Float32Array(v),m[c]}calculateProjMatrix(n,c=!1){const m=n.key,v=c?this._alignedProjMatrixCache:this._projMatrixCache;if(v[m])return v[m];const T=this.calculatePosMatrix(n,this.worldSize);return l.multiply$1(T,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,T),v[m]=new Float32Array(T),v[m]}calculatePixelsToTileUnitsMatrix(n){const c=n.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const v=function(T,I){const{scale:R}=T.tileTransform,$=R*l.EXTENT/(T.tileSize*Math.pow(2,I.zoom-T.tileID.overscaledZ+T.tileID.canonical.z));return X=new Float32Array(4),Me=(oe=I.inverseAdjustmentMatrix)[1],$e=oe[2],Ue=oe[3],at=(he=[$,$])[1],X[0]=oe[0]*(je=he[0]),X[1]=Me*je,X[2]=$e*at,X[3]=Ue*at,X;var X,oe,he,Me,$e,Ue,je,at}(n,this);return m[c]=v,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const c=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),v=this._camera.forward(),T=l.mercatorZfromAltitude(1,this._center.lat);m[2]/=T,v[2]/=T,l.normalize(v,v);const I=n.raycast(m,v,n.exaggeration());if(I){const R=l.scaleAndAdd([],m,v,I),$=new l.MercatorCoordinate(R[0],R[1],l.mercatorZfromAltitude(R[2],l.latFromMercatorY(R[1]))),X=($.z+l.length([$.x-m[0],$.y-m[1],$.z-m[2]*T]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(X),this._centerAltitude=$.toAltitude(),this._center=this.coordinateLocation($),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const c=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),v=n.getAtPointOrZero(new l.MercatorCoordinate(...m)),T=this._minimumHeightOverTerrain()*Math.cos(l.degToRad(this._maxPitch)),I=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*v;if(I<T){const R=this.locationCoordinate(this._center,this._centerAltitude),$=[R.x-m[0],R.y-m[1],R.z-m[2]],X=l.length($);$[2]-=(T-I)/this._projectionScaler;const oe=l.length($);if(0===oe)return;l.scale$2($,$,X/oe*this._projectionScaler),this._camera.position=[R.x-$[0],R.y-$[1],R.z*this._projectionScaler-$[2]],this._camera.orientation=Wi($,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const he=this.center;return he.lat=l.clamp(he.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(he.lng=l.clamp(he.lng,this.minLng,this.maxLng)),this.center=he,void(this._constraining=!1)}const n=this._unmodified,{x:c,y:m}=this.point;let v=0,T=c,I=m;const R=this.width/2,$=this.height/2,X=this.worldMinY*this.scale,oe=this.worldMaxY*this.scale;if(m-$<X&&(I=X+$),m+$>oe&&(I=oe-$),oe-X<this.height&&(v=Math.max(v,this.height/(oe-X)),I=(oe+X)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const he=this.worldMinX*this.scale,Me=this.worldMaxX*this.scale,$e=this.worldSize/2-(he+Me)/2;T=(c+$e+this.worldSize)%this.worldSize-$e,T-R<he&&(T=he+R),T+R>Me&&(T=Me-R),Me-he<this.width&&(v=Math.max(v,this.width/(Me-he)),T=(Me+he)/2)}T===c&&I===m||(this.center=this.unproject(new l.pointGeometry(T,I))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCameraAltitude(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this._fov/2,c=this.centerOffset,m=this.pixelsPerMeter;this._projectionScaler=m/(l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(n)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?m:1),T=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);T[8]=2*-c.x/this.width,T[9]=2*c.y/this.height;let I=l.mul([],T,v);if(this.projection.isReprojectedInTileSpace){const it=this.locationCoordinate(this.center),rt=l.identity([]);l.translate(rt,rt,[it.x*this.worldSize,it.y*this.worldSize,0]),l.multiply$1(rt,rt,so(this)),l.translate(rt,rt,[-it.x*this.worldSize,-it.y*this.worldSize,0]),l.multiply$1(I,I,rt),this.inverseAdjustmentMatrix=function(ft){const $t=so(ft,!0);return ne([],[$t[0],$t[1],$t[4],$t[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=l.scale([],I,[this.worldSize,this.worldSize,this.worldSize/m,1]),this.projMatrix=I,this.invProjMatrix=l.invert(new Float64Array(16),this.projMatrix);const R=new Float32Array(16);l.identity(R),l.scale(R,R,[1,-1,1]),l.rotateX(R,R,this._pitch),l.rotateZ(R,R,this.angle);const $=l.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),X=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-c.x/this.width,$[9]=2*(c.y+X)/this.height,this.skyboxMatrix=l.multiply$1(R,$,R);const oe=this.point,he=oe.x,Me=oe.y,$e=this.width%2/2,Ue=this.height%2/2,je=Math.cos(this.angle),at=Math.sin(this.angle),Ze=he-Math.round(he)+je*$e+at*Ue,ot=Me-Math.round(Me)+je*Ue+at*$e,ut=new Float64Array(I);if(l.translate(ut,ut,[Ze>.5?Ze-1:Ze,ot>.5?ot-1:ot,0]),this.alignedProjMatrix=ut,I=l.create(),l.scale(I,I,[this.width/2,-this.height/2,1]),l.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=l.create(),l.scale(I,I,[1,-1,1]),l.translate(I,I,[-1,-1,0]),l.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=l.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=l.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");this.pixelMatrixInverse=I,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,c=this.cameraPixelsPerMeter,m=this._camera.position,v=1/this.height,T=[n,n,c];l.scale$2(T,T,v),l.scale$2(m,m,-1),l.multiply$2(m,m,T);const I=l.create();l.translate(I,I,m),l.scale(I,I,T),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,c,v)}_computeCameraPosition(n){const c=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),v=this.point,T=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*c-n/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-m[0]*T,v.y/this.worldSize-m[1]*T,n/this.worldSize*this._centerAltitude-m[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=n[2];let v=1;m>0&&(v=Math.min((c-this._camera.position[2])/m,1)),this._camera.position=l.scaleAndAdd([],this._camera.position,n,v),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:v}=this._camera.getPitchBearing(),T=l.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(l.degToRad(this._maxPitch)),R=Math.max((n[2]-T)/Math.cos(m),I),$=this._zoomFromMercatorZ(R);l.scaleAndAdd(n,n,c,R),this._pitch=l.clamp(m,l.degToRad(this.minPitch),l.degToRad(this.maxPitch)),this.angle=l.wrap(v,-Math.PI,Math.PI),this._setZoom(l.clamp($,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new l.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(l.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(n,c){const m=Math.min(n.x,c.x),v=Math.max(n.x,c.x),T=Math.min(n.y,c.y),I=Math.max(n.y,c.y);if(T<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const R=[new l.pointGeometry(m,T),new l.pointGeometry(v,I),new l.pointGeometry(m,I),new l.pointGeometry(v,T)],$=this.renderWorldCopies?-3:0,X=this.renderWorldCopies?4:1;for(const oe of R){const he=this.pointRayIntersection(oe);if(he.t<0)return!0;const Me=this.rayIntersectionCoordinate(he);if(Me.x<$||Me.y<0||Me.x>X||Me.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+l.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new l.pointGeometry(0,0),new l.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,c){const m=l.length(l.sub([],this._camera.position,n)),v=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(v)}getCameraPoint(){const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,n))}}function fa(f,n){let c=!1,m=null;const v=()=>{m=null,c&&(f(),m=setTimeout(v,n),c=!1)};return()=>(c=!0,m||v(),m)}class Tc{constructor(n){this._hashName=n&&encodeURIComponent(n),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=fa(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,l.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return l.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(n){const c=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,v),I=Math.round(c.lng*T)/T,R=Math.round(c.lat*T)/T,$=this._map.getBearing(),X=this._map.getPitch();let oe="";if(oe+=n?`/${I}/${R}/${m}`:`${m}/${R}/${I}`,($||X)&&(oe+="/"+Math.round(10*$)/10),X&&(oe+=`/${Math.round(X)}`),this._hashName){const he=this._hashName;let Me=!1;const $e=l.window.location.hash.slice(1).split("&").map(Ue=>{const je=Ue.split("=")[0];return je===he?(Me=!0,`${je}=${oe}`):Ue}).filter(Ue=>Ue);return Me||$e.push(`${he}=${oe}`),`#${$e.join("&")}`}return`#${oe}`}_getCurrentHash(){const n=l.window.location.hash.replace("#","");if(this._hashName){let c;return n.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._getCurrentHash();if(n.length>=3&&!n.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:c,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=l.window.location.href.replace(/(#.+)?$/,this.getHashString());l.window.history.replaceState(l.window.history.state,null,n)}}const ma={linearity:.3,easing:l.bezier(0,0,.3,1)},hl=l.extend({deceleration:2500,maxSpeed:1400},ma),Yc=l.extend({deceleration:20,maxSpeed:1400},ma),Cc=l.extend({deceleration:1e3,maxSpeed:360},ma),cr=l.extend({deceleration:1e3,maxSpeed:90},ma);class Ua{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,c=l.exported.now();for(;n.length>0&&c-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)c.zoom+=T.zoomDelta||0,c.bearing+=T.bearingDelta||0,c.pitch+=T.pitchDelta||0,T.panDelta&&c.pan._add(T.panDelta),T.around&&(c.around=T.around),T.pinchAround&&(c.pinchAround=T.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(c.pan.mag()){const T=Da(c.pan.mag(),m,l.extend({},hl,n||{}));v.offset=c.pan.mult(T.amount/c.pan.mag()),v.center=this._map.transform.center,ga(v,T)}if(c.zoom){const T=Da(c.zoom,m,Yc);v.zoom=this._map.transform.zoom+T.amount,ga(v,T)}if(c.bearing){const T=Da(c.bearing,m,Cc);v.bearing=this._map.transform.bearing+l.clamp(T.amount,-179,179),ga(v,T)}if(c.pitch){const T=Da(c.pitch,m,cr);v.pitch=this._map.transform.pitch+T.amount,ga(v,T)}if(v.zoom||v.bearing){const T=void 0===c.pinchAround?c.around:c.pinchAround;v.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),l.extend(v,{noMoveStart:!0})}}function ga(f,n){(!f.duration||f.duration<n.duration)&&(f.duration=n.duration,f.easing=n.easing)}function Da(f,n,c){const{maxSpeed:m,linearity:v,deceleration:T}=c,I=l.clamp(f*v/(n/1e3),-m,m),R=Math.abs(I)/(T*v);return{easing:c.easing,duration:1e3*R,amount:I*(R/2)}}class $o extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,m,v={}){const T=Q.mousePos(c.getCanvasContainer(),m),I=c.unproject(T);super(n,l.extend({point:T,lngLat:I,originalEvent:m},v)),this._defaultPrevented=!1,this.target=c}}class tc extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,m){const v="touchend"===n?m.changedTouches:m.touches,T=Q.touchPos(c.getCanvasContainer(),v),I=T.map($=>c.unproject($)),R=T.reduce(($,X,oe,he)=>$.add(X.div(he.length)),new l.pointGeometry(0,0));super(n,{points:T,point:R,lngLats:I,lngLat:c.unproject(R),originalEvent:m}),this._defaultPrevented=!1}}class Qs extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,m){super(n,{originalEvent:m}),this._defaultPrevented=!1}}class Za{constructor(n,c){this._map=n,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new Qs(n.type,this._map,n))}mousedown(n,c){return this._mousedownPos=c,this._firePreventable(new $o(n.type,this._map,n))}mouseup(n){this._map.fire(new $o(n.type,this._map,n))}preclick(n){const c=l.extend({},n);c.type="preclick",this._map.fire(new $o(c.type,this._map,c))}click(n,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(n),this._map.fire(new $o(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new $o(n.type,this._map,n))}mouseover(n){this._map.fire(new $o(n.type,this._map,n))}mouseout(n){this._map.fire(new $o(n.type,this._map,n))}touchstart(n){return this._firePreventable(new tc(n.type,this._map,n))}touchmove(n){this._map.fire(new tc(n.type,this._map,n))}touchend(n){this._map.fire(new tc(n.type,this._map,n))}touchcancel(n){this._map.fire(new tc(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mu{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(n){this._map.fire(new $o(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $o("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new $o(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ec{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,c){this.isEnabled()&&n.shiftKey&&0===n.button&&(Q.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(n,c){if(!this._active)return;const m=c;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=m,this._box||(this._box=Q.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const T=Math.min(v.x,m.x),I=Math.max(v.x,m.x),R=Math.min(v.y,m.y),$=Math.max(v.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${R}px)`,this._box.style.width=I-T+"px",this._box.style.height=$-R+"px")})}mouseupWindow(n,c){if(!this._active||0!==n.button)return;const m=this._startPos,v=c;if(this.reset(),Q.suppressClick(),m.x!==v.x||m.y!==v.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:T=>T.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&27===n.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,c){return this._map.fire(new l.Event(n,{originalEvent:c}))}}function ea(f,n){const c={};for(let m=0;m<f.length;m++)c[f[m].identifier]=n[m];return c}class Va{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=n.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){const T=new l.pointGeometry(0,0);for(const I of v)T._add(I);return T.div(v.length)}(c),this.touches=ea(m,c)))}touchmove(n,c,m){if(this.aborted||!this.centroid)return;const v=ea(m,c);for(const T in this.touches){const I=this.touches[T],R=v[T];(!R||R.dist(I)>30)&&(this.aborted=!0)}}touchend(n,c,m){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class pl{constructor(n){this.singleTap=new Va(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,c,m){this.singleTap.touchstart(n,c,m)}touchmove(n,c,m){this.singleTap.touchmove(n,c,m)}touchend(n,c,m){const v=this.singleTap.touchend(n,c,m);if(v){const T=n.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(v)<30;if(T&&I||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Dc{constructor(){this._zoomIn=new pl({numTouches:1,numTaps:2}),this._zoomOut=new pl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,c,m){this._zoomIn.touchstart(n,c,m),this._zoomOut.touchstart(n,c,m)}touchmove(n,c,m){this._zoomIn.touchmove(n,c,m),this._zoomOut.touchmove(n,c,m)}touchend(n,c,m){const v=this._zoomIn.touchend(n,c,m),T=this._zoomOut.touchend(n,c,m);return v?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(v)},{originalEvent:n})}):T?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(T)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Au={0:1,2:2};class jo{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(n,c){return!1}_move(n,c){return{}}mousedown(n,c){if(this._lastPoint)return;const m=Q.mouseButton(n);this._correctButton(n,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(n,c){const m=this._lastPoint;if(m)if(n.preventDefault(),function(v,T){const I=Au[T];return void 0===v.buttons||(v.buttons&I)!==I}(n,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}mouseupWindow(n){this._lastPoint&&Q.mouseButton(n)===this._eventButton&&(this._moved&&Q.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $a extends jo{mousedown(n,c){super.mousedown(n,c),this._lastPoint&&(this._active=!0)}_correctButton(n,c){return 0===c&&!n.ctrlKey}_move(n,c){return{around:c,panDelta:c.sub(n)}}}class os extends jo{_correctButton(n,c){return 0===c&&n.ctrlKey||2===c}_move(n,c){const m=.8*(c.x-n.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(n){n.preventDefault()}}class Ia extends jo{_correctButton(n,c){return 0===c&&n.ctrlKey||2===c}_move(n,c){const m=-.5*(c.y-n.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(n){n.preventDefault()}}class ja{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),l.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0)}touchstart(n,c,m){return this._calculateTransform(n,c,m)}touchmove(n,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.preventDefault(),this._calculateTransform(n,c,m)}}touchend(n,c,m){this._calculateTransform(n,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,c,m){m.length>0&&(this._active=!0);const v=ea(m,c),T=new l.pointGeometry(0,0),I=new l.pointGeometry(0,0);let R=0;for(const X in v){const oe=v[X],he=this._touches[X];he&&(T._add(oe),I._add(oe.sub(he)),R++,v[X]=oe)}if(this._touches=v,R<this._minTouches||!I.mag())return;const $=I.div(R);return this._sum._add($),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(R),panDelta:$}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Q.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class ta{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(n){}_move(n,c,m){return{}}touchstart(n,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(n,c,m){if(!this._firstTwoTouches)return;n.preventDefault();const[v,T]=this._firstTwoTouches,I=na(m,c,v),R=na(m,c,T);if(!I||!R)return;const $=this._aroundCenter?null:I.add(R).div(2);return this._move([I,R],$,n)}touchend(n,c,m){if(!this._firstTwoTouches)return;const[v,T]=this._firstTwoTouches,I=na(m,c,v),R=na(m,c,T);I&&R||(this._active&&Q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function na(f,n,c){for(let m=0;m<f.length;m++)if(f[m].identifier===c)return n[m]}function Ma(f,n){return Math.log(f/n)/Math.LN2}class Pl extends ta{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,c){const m=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Ma(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ma(this._distance,m),pinchAround:c}}}function _a(f,n){return 180*f.angleWith(n)/Math.PI}class Ga extends ta{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,c){const m=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_a(this._vector,m),pinchAround:c}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const c=25/(Math.PI*this._minDiameter)*360,m=_a(n,this._startVector);return Math.abs(m)<c}}function Aa(f){return Math.abs(f.y)>Math.abs(f.x)}class Ic extends ta{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(n){this._lastPoints=n,Aa(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,c,m){const v=n[0].sub(this._lastPoints[0]),T=n[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&m.touches.length<3)&&(this._valid=this.gestureBeginsVertically(v,T,m.timeStamp),this._valid))return this._lastPoints=n,this._active=!0,{pitchDelta:(v.y+T.y)/2*-.5}}gestureBeginsVertically(n,c,m){if(void 0!==this._valid)return this._valid;const v=n.mag()>=2,T=c.mag()>=2;if(!v&&!T)return;if(!v||!T)return void 0===this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const I=n.y>0==c.y>0;return Aa(n)&&Aa(c)&&I}}const fl={panStep:100,bearingStep:15,pitchStep:10};class Sa{constructor(){const n=fl;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let c=0,m=0,v=0,T=0,I=0;switch(n.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:n.shiftKey?m=-1:(n.preventDefault(),T=-1);break;case 39:n.shiftKey?m=1:(n.preventDefault(),T=1);break;case 38:n.shiftKey?v=1:(n.preventDefault(),I=-1);break;case 40:n.shiftKey?v=-1:(n.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:R=>{const $=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Jc,zoom:c?Math.round($)+c*(n.shiftKey?2:1):$,bearing:R.getBearing()+m*this._bearingStep,pitch:R.getPitch()+v*this._pitchStep,offset:[-T*this._panStep,-I*this._panStep],center:R.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jc(f){return f*(2-f)}const Mc=4.000244140625;class Pa{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=n.deltaMode===l.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const m=l.exported.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==c&&c%Mc==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(v*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),n.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=n,this._delta-=c,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Q.mousePos(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform,c=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(0!==this._delta){const $="wheel"===this._type&&Math.abs(this._delta)>Mc?this._wheelZoomRate:this._defaultZoomRate;let X=2/(1+Math.exp(-Math.abs(this._delta*$)));this._delta<0&&0!==X&&(X=1/X);const oe=c(),he=Math.pow(2,oe),Me="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):he;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(Me*X))),"wheel"===this._type&&(this._startZoom=c(),this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:c(),v=this._startZoom,T=this._easing;let I,R=!1;if("wheel"===this._type&&v&&T){const $=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),X=T($);I=l.number(v,m,X),$<1?this._frameId||(this._frameId=!0):R=!0}else I=m,R=!0;return this._active=!0,R&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!R,zoomDelta:I-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let c=l.ease;if(this._prevEase){const m=this._prevEase,v=(l.exported.now()-m.start)/m.duration,T=m.easing(v+.01)-m.easing(v),I=.27/Math.sqrt(T*T+1e-4)*.01,R=Math.sqrt(.0729-I*I);c=l.bezier(I,R,.25,1)}return this._prevEase={start:l.exported.now(),duration:n,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Q.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(l.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!l.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Ol{constructor(n,c){this._clickZoom=n,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class nc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,c){return n.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(n.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rl{constructor(){this._tap=new pl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(n,c,m){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(n,c,m))}touchmove(n,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=c[0],T=v.y-this._swipePoint.y;return this._swipePoint=v,n.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(n,c,m)}touchend(n,c,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(n,c,m)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qa{constructor(n,c,m){this._el=n,this._mousePan=c,this._touchPan=m}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ic{constructor(n,c,m){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ac{constructor(n,c,m,v){this._el=n,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ml=f=>f.zoom||f.drag||f.pitch||f.rotate;class Sc extends l.Event{}class Ll{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,c){const m=l.sub([],c,n);this.radius=l.length(m[2]<0?l.div([],m,this.constants):[m[0],m[1],0])}projectRay(n){l.div(n,n,this.constants),l.normalize(n,n),l.mul$1(n,n,this.constants);const c=l.scale$2([],n,this.radius);if(c[2]>0){const m=l.scale$2([],[0,0,1],l.dot(c,[0,0,1])),v=l.scale$2([],l.normalize([],[c[0],c[1],0]),this.radius),T=l.add([],c,l.scale$2([],l.sub([],l.add([],v,m),c),2));c[0]=T[0],c[1]=T[1]}return c}}function kl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class gl{constructor(n,c){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ua(n),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ll,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),l.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[l.window.document,"mousemove",{capture:!0}],[l.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[l.window,"blur",void 0]];for(const[v,T,I]of this._listeners)v.addEventListener(T,v===l.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[n,c,m]of this._listeners)n.removeEventListener(c,n===l.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(n){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new Za(c,n));const v=c.boxZoom=new Ec(c,n);this._add("boxZoom",v);const T=new Dc,I=new nc;c.doubleClickZoom=new Ol(I,T),this._add("tapZoom",T),this._add("clickZoom",I);const R=new Rl;this._add("tapDragZoom",R);const $=c.touchPitch=new Ic(c);this._add("touchPitch",$);const X=new os(n),oe=new Ia(n);c.dragRotate=new ic(n,X,oe),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",oe,["mouseRotate"]);const he=new $a(n),Me=new ja(c,n);c.dragPan=new qa(m,he,Me),this._add("mousePan",he),this._add("touchPan",Me,["touchZoom","touchRotate"]);const $e=new Ga,Ue=new Pl;c.touchZoomRotate=new Ac(m,Ue,$e,R),this._add("touchRotate",$e,["touchPan","touchZoom"]),this._add("touchZoom",Ue,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Mu(c));const je=c.scrollZoom=new Pa(c,this);this._add("scrollZoom",je,["mousePan"]);const at=c.keyboard=new Sa;this._add("keyboard",at);for(const Ze of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[Ze]&&c[Ze].enable(n[Ze])}_add(n,c,m){this._handlers.push({handlerName:n,handler:c,allowed:m}),this._handlersById[n]=c}stop(n){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(ml(this._eventsInProgress))||this.isZooming()}_blockedByActive(n,c,m){for(const v in n)if(v!==m&&(!c||c.indexOf(v)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const c=[];for(const m of n)this._el.contains(m.target)&&c.push(m);return c}handleEvent(n,c){this._updatingCamera=!0;const m="renderFrame"===n.type,v=m?void 0:n,T={needsRenderFrame:!1},I={},R={},$=n.touches?this._getMapTouches(n.touches):void 0,X=$?Q.touchPos(this._el,$):m?void 0:Q.mousePos(this._el,n);for(const{handlerName:Me,handler:$e,allowed:Ue}of this._handlers){if(!$e.isEnabled())continue;let je;this._blockedByActive(R,Ue,Me)?$e.reset():$e[c||n.type]&&(je=$e[c||n.type](n,X,$),this.mergeHandlerResult(T,I,je,Me,v),je&&je.needsRenderFrame&&this._triggerRenderFrame()),(je||$e.isActive())&&(R[Me]=$e)}const oe={};for(const Me in this._previousActiveHandlers)R[Me]||(oe[Me]=v);this._previousActiveHandlers=R,(Object.keys(oe).length||kl(T))&&(this._changes.push([T,I,oe]),this._triggerRenderFrame()),(Object.keys(R).length||kl(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:he}=T;he&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],he(this._map))}mergeHandlerResult(n,c,m,v,T){if(!m)return;l.extend(n,m);const I={handlerName:v,originalEvent:m.originalEvent||T};void 0!==m.zoomDelta&&(c.zoom=I),void 0!==m.panDelta&&(c.drag=I),void 0!==m.pitchDelta&&(c.pitch=I),void 0!==m.bearingDelta&&(c.rotate=I)}_applyChanges(){const n={},c={},m={};for(const[v,T,I]of this._changes)v.panDelta&&(n.panDelta=(n.panDelta||new l.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(n.around=v.around),void 0!==v.aroundCoord&&(n.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(n.pinchAround=v.pinchAround),v.noInertia&&(n.noInertia=v.noInertia),l.extend(c,T),l.extend(m,I);this._updateMapTransform(n,c,m),this._changes=[]}_updateMapTransform(n,c,m){const v=this._map,T=v.transform,I=ot=>[ot.x,ot.y,ot.z];if((ot=>{const ut=this._eventsInProgress.drag;return ut&&!this._handlersById[ut.handlerName].isActive()})()&&!kl(n)){const ot=T.zoom;T.cameraElevationReference="sea",T.recenterOnTerrain(),T.cameraElevationReference="ground",ot!==T.zoom&&this._map._update(!0)}if(!kl(n))return this._fireEvents(c,m,!0);let{panDelta:R,zoomDelta:$,bearingDelta:X,pitchDelta:oe,around:he,aroundCoord:Me,pinchAround:$e}=n;void 0!==$e&&(he=$e),(ot=>c.drag&&!this._eventsInProgress.drag)()&&he&&(this._dragOrigin=I(T.pointCoordinate3D(he)),this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",v._stop(!0),he=he||v.transform.centerPoint,X&&(T.bearing+=X),oe&&(T.pitch+=oe),T._updateCameraState();const Ue=[0,0,0];if(R){const ot=T.pointCoordinate(he),ut=T.pointCoordinate(he.sub(R));ot&&ut&&(Ue[0]=ut.x-ot.x,Ue[1]=ut.y-ot.y)}const je=T.zoom,at=[0,0,0];if($){const ot=I(Me||T.pointCoordinate3D(he)),ut={dir:l.normalize([],l.sub([],ot,T._camera.position))};if(ut.dir[2]<0){const it=T.zoomDeltaToMovement(ot,$);l.scale$2(at,ut.dir,it)}}const Ze=l.add(Ue,Ue,at);T._translateCameraConstrained(Ze),$&&Math.abs(T.zoom-je)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(c,m,!0)}_fireEvents(n,c,m){const v=ml(this._eventsInProgress),T=ml(n),I={};for(const oe in n){const{originalEvent:he}=n[oe];this._eventsInProgress[oe]||(I[`${oe}start`]=he),this._eventsInProgress[oe]=n[oe]}!v&&T&&this._fireEvent("movestart",T.originalEvent);for(const oe in I)this._fireEvent(oe,I[oe]);T&&this._fireEvent("move",T.originalEvent);for(const oe in n){const{originalEvent:he}=n[oe];this._fireEvent(oe,he)}const R={};let $;for(const oe in this._eventsInProgress){const{handlerName:he,originalEvent:Me}=this._eventsInProgress[oe];this._handlersById[he].isActive()||(delete this._eventsInProgress[oe],$=c[he]||Me,R[`${oe}end`]=$)}for(const oe in R)this._fireEvent(oe,R[oe]);const X=ml(this._eventsInProgress);if(m&&(v||T)&&!X){this._updatingCamera=!0;const oe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),he=Me=>0!==Me&&-this._bearingSnap<Me&&Me<this._bearingSnap;oe?(he(oe.bearing||this._map.getBearing())&&(oe.bearing=0),this._map.easeTo(oe,{originalEvent:$})):(this._map.fire(new l.Event("moveend",{originalEvent:$})),he(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,c){this._map.fire(new l.Event(n,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new Sc("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Ha="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class _l extends l.Evented{constructor(n,c){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=c.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,c){return this.jumpTo({center:n},c)}panBy(n,c,m){return n=l.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,l.extend({offset:n},c),m)}panTo(n,c,m){return this.easeTo(l.extend({center:n},c),m)}getZoom(){return this.transform.zoom}setZoom(n,c){return this.jumpTo({zoom:n},c),this}zoomTo(n,c,m){return this.easeTo(l.extend({zoom:n},c),m)}zoomIn(n,c){return this.zoomTo(this.getZoom()+1,n,c),this}zoomOut(n,c){return this.zoomTo(this.getZoom()-1,n,c),this}getBearing(){return this.transform.bearing}setBearing(n,c){return this.jumpTo({bearing:n},c),this}getPadding(){return this.transform.padding}setPadding(n,c){return this.jumpTo({padding:n},c),this}rotateTo(n,c,m){return this.easeTo(l.extend({bearing:n},c),m)}resetNorth(n,c){return this.rotateTo(0,l.extend({duration:1e3},n),c),this}resetNorthPitch(n,c){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},n),c),this}snapToNorth(n,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,c):this}getPitch(){return this.transform.pitch}setPitch(n,c){return this.jumpTo({pitch:n},c),this}cameraForBounds(n,c){n=l.LngLatBounds.convert(n);const m=c&&c.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),m,c)}_extendCameraOptions(n){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=l.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const m=n.padding;n.padding={top:m,bottom:m,right:m,left:m}}return n.padding=l.extend(c,n.padding),n}_cameraForBoxAndBearing(n,c,m,v){const T=this._extendCameraOptions(v),I=this.transform,R=I.padding,$=I.project(l.LngLat.convert(n)),X=I.project(l.LngLat.convert(c)),oe=$.rotate(-l.degToRad(m)),he=X.rotate(-l.degToRad(m)),Me=new l.pointGeometry(Math.max(oe.x,he.x),Math.max(oe.y,he.y)),$e=new l.pointGeometry(Math.min(oe.x,he.x),Math.min(oe.y,he.y)),Ue=Me.sub($e),je=(I.width-(R.left+R.right+T.padding.left+T.padding.right))/Ue.x,at=(I.height-(R.top+R.bottom+T.padding.top+T.padding.bottom))/Ue.y;if(at<0||je<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ze=Math.min(I.scaleZoom(I.scale*Math.min(je,at)),T.maxZoom),ot="number"==typeof T.offset.x?new l.pointGeometry(T.offset.x,T.offset.y):l.pointGeometry.convert(T.offset),ut=new l.pointGeometry((T.padding.left-T.padding.right)/2,(T.padding.top-T.padding.bottom)/2).rotate(m*Math.PI/180),it=ot.add(ut).mult(I.scale/I.zoomScale(Ze));return{center:I.unproject($.add(X).div(2).sub(it)),zoom:Ze,bearing:m}}_cameraForBox(n,c,m,v,T){const I=this._extendCameraOptions(T);m=m||0,v=v||0,n=l.LngLat.convert(n),c=l.LngLat.convert(c);const R=this.transform.clone();R.padding=I.padding;const $=this.getFreeCameraOptions(),X=new l.LngLat(.5*(n.lng+c.lng),.5*(n.lat+c.lat)),oe=.5*(m+v);if(R._camera.position[2]<l.mercatorZfromAltitude(oe,X.lat))return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");$.lookAtPoint(X),R.setFreeCameraOptions($);const he=l.MercatorCoordinate.fromLngLat(n),Me=l.MercatorCoordinate.fromLngLat(c),$e=R.pointRayIntersection(R.centerPoint,oe),Ue=[(je=R.rayIntersectionCoordinate($e)).x,je.y,je.z];var je;const at=R.screenPointToMercatorRay(R.centerPoint),Ze="globe"!==R.projection.name;let ot,ut=0;do{const it=Math.floor(R.zoom),rt=1<<it,ft=Math.min(rt*he.x,rt*Me.x),$t=Math.min(rt*he.y,rt*Me.y),tn=Math.max(rt*he.x,rt*Me.x),Nn=Math.max(rt*he.y,rt*Me.y),Dn=new l.Aabb([ft,$t,m],[tn,Nn,v]),Tn=l.Frustum.fromInvProjectionMatrix(R.invProjMatrix,R.worldSize,it,Ze);if(2!==Dn.intersects(Tn)){ot&&(R._camera.position=l.scaleAndAdd([],R._camera.position,at.dir,-ot),R._updateStateFromCamera());break}const cn=l.sub([],R._camera.position,Ue);ot=.5*l.length(cn),R._camera.position=l.scaleAndAdd([],R._camera.position,at.dir,ot);try{R._updateStateFromCamera()}catch{return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ut<10);return{center:R.center,zoom:R.zoom,bearing:R.bearing,pitch:R.pitch}}fitBounds(n,c,m){return this._fitInternal(this.cameraForBounds(n,c),c,m)}_raycastElevationBox(n,c){const m=this.transform.elevation;if(!m)return;const v=new l.pointGeometry(n.x,c.y),T=new l.pointGeometry(c.x,n.y),I=m.pointCoordinate(n);if(!I)return;const R=m.pointCoordinate(c);if(!R)return;const $=m.pointCoordinate(v);if(!$)return;const X=m.pointCoordinate(T);if(!X)return;const oe=new l.MercatorCoordinate(I[0],I[1]).toLngLat(),he=new l.MercatorCoordinate(R[0],R[1]).toLngLat(),Me=new l.MercatorCoordinate($[0],$[1]).toLngLat(),$e=new l.MercatorCoordinate(X[0],X[1]).toLngLat(),Ue=Math.min(oe.lng,Math.min(he.lng,Math.min(Me.lng,$e.lng))),je=Math.min(oe.lat,Math.min(he.lat,Math.min(Me.lat,$e.lat))),at=Math.max(oe.lng,Math.max(he.lng,Math.max(Me.lng,$e.lng))),Ze=Math.max(oe.lat,Math.max(he.lat,Math.max(Me.lat,$e.lat))),ot=Math.min(I[3],Math.min(R[3],Math.min($[3],X[3]))),ut=Math.max(I[3],Math.max(R[3],Math.max($[3],X[3])));return{minLngLat:new l.LngLat(Ue,je),maxLngLat:new l.LngLat(at,Ze),minAltitude:ot,maxAltitude:ut}}fitScreenCoordinates(n,c,m,v,T){let I,R,$,X;const oe=l.pointGeometry.convert(n),he=l.pointGeometry.convert(c),Me=this._raycastElevationBox(oe,he);if(Me)I=Me.minLngLat,R=Me.maxLngLat,$=Me.minAltitude,X=Me.maxAltitude;else{if(this.transform.anyCornerOffEdge(oe,he))return this;I=this.transform.pointLocation(oe),R=this.transform.pointLocation(he)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(n)),this.transform.pointLocation(l.pointGeometry.convert(c)),m,v):this._cameraForBox(I,R,$,X,v),v,T)}_fitInternal(n,c,m){return n?(delete(c=l.extend(n,c)).padding,c.linear?this.easeTo(c,m):this.flyTo(c,m)):this}jumpTo(n,c){this.stop();const m=n.preloadOnly?this.transform.clone():this.transform;let v=!1,T=!1,I=!1;return"zoom"in n&&m.zoom!==+n.zoom&&(v=!0,m.zoom=+n.zoom),void 0!==n.center&&(m.center=l.LngLat.convert(n.center)),"bearing"in n&&m.bearing!==+n.bearing&&(T=!0,m.bearing=+n.bearing),"pitch"in n&&m.pitch!==+n.pitch&&(I=!0,m.pitch=+n.pitch),null==n.padding||m.isPaddingEqual(n.padding)||(m.padding=n.padding),n.preloadOnly?(this._preloadTiles(m),this):(this.fire(new l.Event("movestart",c)).fire(new l.Event("move",c)),v&&this.fire(new l.Event("zoomstart",c)).fire(new l.Event("zoom",c)).fire(new l.Event("zoomend",c)),T&&this.fire(new l.Event("rotatestart",c)).fire(new l.Event("rotate",c)).fire(new l.Event("rotateend",c)),I&&this.fire(new l.Event("pitchstart",c)).fire(new l.Event("pitch",c)).fire(new l.Event("pitchend",c)),this.fire(new l.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||l.warnOnce(Ha),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,c){const m=this.transform;if(!m.projection.supportsFreeCamera)return void l.warnOnce(Ha);this.stop();const v=m.zoom,T=m.pitch,I=m.bearing;m.setFreeCameraOptions(n);const R=v!==m.zoom,$=T!==m.pitch,X=I!==m.bearing;return this.fire(new l.Event("movestart",c)).fire(new l.Event("move",c)),R&&this.fire(new l.Event("zoomstart",c)).fire(new l.Event("zoom",c)).fire(new l.Event("zoomend",c)),X&&this.fire(new l.Event("rotatestart",c)).fire(new l.Event("rotate",c)).fire(new l.Event("rotateend",c)),$&&this.fire(new l.Event("pitchstart",c)).fire(new l.Event("pitch",c)).fire(new l.Event("pitchend",c)),this.fire(new l.Event("moveend",c)),this}easeTo(n,c){this._stop(!1,n.easeId),(!1===(n=l.extend({offset:[0,0],duration:500,easing:l.ease},n)).animate||!n.essential&&l.exported.prefersReducedMotion)&&(n.duration=0);const m=this.transform,v=this.getZoom(),T=this.getBearing(),I=this.getPitch(),R=this.getPadding(),$="zoom"in n?+n.zoom:v,X="bearing"in n?this._normalizeBearing(n.bearing,T):T,oe="pitch"in n?+n.pitch:I,he="padding"in n?n.padding:m.padding,Me=l.pointGeometry.convert(n.offset);let $e=m.centerPoint.add(Me);const Ue="globe"===m.projection.name?m.pointCoordinate($e).toLngLat():m.pointLocation($e),je=l.LngLat.convert(n.center||Ue);this._normalizeCenter(je);const at=m.project(Ue),Ze=m.project(je).sub(at),ot=m.zoomScale($-v);let ut,it;n.around&&(ut=l.LngLat.convert(n.around),it=m.locationPoint(ut));const rt=this._zooming||$!==v,ft=this._rotating||T!==X,$t=this._pitching||oe!==I,tn=!m.isPaddingEqual(he),Nn=Tn=>cn=>{if(rt&&(Tn.zoom=l.number(v,$,cn)),ft&&(Tn.bearing=l.number(T,X,cn)),$t&&(Tn.pitch=l.number(I,oe,cn)),tn&&(Tn.interpolatePadding(R,he,cn),$e=Tn.centerPoint.add(Me)),ut)Tn.setLocationAtPoint(ut,it);else{const Jt=Tn.zoomScale(Tn.zoom-v),yn=$>v?Math.min(2,ot):Math.max(.5,ot),mn=Math.pow(yn,1-cn),ui=Tn.unproject(at.add(Ze.mult(cn*mn)).mult(Jt));Tn.setLocationAtPoint(Tn.renderWorldCopies?ui.wrap():ui,$e)}return n.preloadOnly||this._fireMoveEvents(c),Tn};if(n.preloadOnly){const Tn=this._emulate(Nn,n.duration,m);return this._preloadTiles(Tn),this}const Dn={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=rt,this._rotating=ft,this._pitching=$t,this._padding=tn,this._easeId=n.easeId,this._prepareEase(c,n.noMoveStart,Dn),this._ease(Nn(m),Tn=>{m.recenterOnTerrain(),this._afterEase(c,Tn)},n),this}_prepareEase(n,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||m.moving||this.fire(new l.Event("movestart",n)),this._zooming&&!m.zooming&&this.fire(new l.Event("zoomstart",n)),this._rotating&&!m.rotating&&this.fire(new l.Event("rotatestart",n)),this._pitching&&!m.pitching&&this.fire(new l.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new l.Event("move",n)),this._zooming&&this.fire(new l.Event("zoom",n)),this._rotating&&this.fire(new l.Event("rotate",n)),this._pitching&&this.fire(new l.Event("pitch",n))}_afterEase(n,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId,this.transform.cameraElevationReference="ground";const m=this._zooming,v=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new l.Event("zoomend",n)),v&&this.fire(new l.Event("rotateend",n)),T&&this.fire(new l.Event("pitchend",n)),this.fire(new l.Event("moveend",n))}flyTo(n,c){if(!n.essential&&l.exported.prefersReducedMotion){const Bn=l.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Bn,c)}this.stop(),n=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},n);const m=this.transform,v=this.getZoom(),T=this.getBearing(),I=this.getPitch(),R=this.getPadding(),$="zoom"in n?l.clamp(+n.zoom,m.minZoom,m.maxZoom):v,X="bearing"in n?this._normalizeBearing(n.bearing,T):T,oe="pitch"in n?+n.pitch:I,he="padding"in n?n.padding:m.padding,Me=m.zoomScale($-v),$e=l.pointGeometry.convert(n.offset);let Ue=m.centerPoint.add($e);const je=m.pointLocation(Ue),at=l.LngLat.convert(n.center||je);this._normalizeCenter(at);const Ze=m.project(je),ot=m.project(at).sub(Ze);let ut=n.curve;const it=Math.max(m.width,m.height),rt=it/Me,ft=ot.mag();if("minZoom"in n){const Bn=l.clamp(Math.min(n.minZoom,v,$),m.minZoom,m.maxZoom),vi=it/m.zoomScale(Bn-v);ut=Math.sqrt(vi/ft*2)}const $t=ut*ut;function tn(Bn){const vi=(rt*rt-it*it+(Bn?-1:1)*$t*$t*ft*ft)/(2*(Bn?rt:it)*$t*ft);return Math.log(Math.sqrt(vi*vi+1)-vi)}function Nn(Bn){return(Math.exp(Bn)-Math.exp(-Bn))/2}function Dn(Bn){return(Math.exp(Bn)+Math.exp(-Bn))/2}const Tn=tn(0);let cn=function(Bn){return Dn(Tn)/Dn(Tn+ut*Bn)},Jt=function(Bn){return it*((Dn(Tn)*(Nn(vi=Tn+ut*Bn)/Dn(vi))-Nn(Tn))/$t)/ft;var vi},yn=(tn(1)-Tn)/ut;if(Math.abs(ft)<1e-6||!isFinite(yn)){if(Math.abs(it-rt)<1e-6)return this.easeTo(n,c);const Bn=rt<it?-1:1;yn=Math.abs(Math.log(rt/it))/ut,Jt=function(){return 0},cn=function(vi){return Math.exp(Bn*ut*vi)}}n.duration="duration"in n?+n.duration:1e3*yn/("screenSpeed"in n?+n.screenSpeed/ut:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const mn=T!==X,ui=oe!==I,Ei=!m.isPaddingEqual(he),nr=Bn=>vi=>{const qi=vi*yn,Mr=1/cn(qi);Bn.zoom=1===vi?$:v+Bn.scaleZoom(Mr),mn&&(Bn.bearing=l.number(T,X,vi)),ui&&(Bn.pitch=l.number(I,oe,vi)),Ei&&(Bn.interpolatePadding(R,he,vi),Ue=Bn.centerPoint.add($e));const Qr=1===vi?at:Bn.unproject(Ze.add(ot.mult(Jt(qi))).mult(Mr));return Bn.setLocationAtPoint(Bn.renderWorldCopies?Qr.wrap():Qr,Ue),Bn._updateCenterElevation(),n.preloadOnly||this._fireMoveEvents(c),Bn};if(n.preloadOnly){const Bn=this._emulate(nr,n.duration,m);return this._preloadTiles(Bn),this}return this._zooming=!0,this._rotating=mn,this._pitching=ui,this._padding=Ei,this._prepareEase(c,!1),this._ease(nr(m),()=>this._afterEase(c),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,c)}if(!n){const m=this.handlers;m&&m.stop(!1)}return this}_ease(n,c,m){!1===m.animate||0===m.duration?(n(1),c()):(this._easeStart=l.exported.now(),this._easeOptions=m,this._onEaseFrame=n,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,c){n=l.wrap(n,-180,180);const m=Math.abs(n-c);return Math.abs(n-360-c)<m&&(n-=360),Math.abs(n+360-c)<m&&(n+=360),n}_normalizeCenter(n){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const m=n.lng-c.center.lng;n.lng+=m>180?-360:m<-180?360:0}_emulate(n,c,m){const v=Math.ceil(15*c/1e3),T=[],I=n(m.clone());for(let R=0;R<=v;R++){const $=I(R/v);T.push($.clone())}return T}}class Xc{constructor(n={}){this.options=n,l.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const c=this.options&&this.options.compact;return this._map=n,this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Q.create("button","mapboxgl-ctrl-attrib-button",this._container),Q.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Q.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,c){const m=this._map._getUIString(`AttributionControl.${c}`);n.setAttribute("aria-label",m),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||l.config.ACCESS_TOKEN}];if(n){const m=c.reduce((v,T,I)=>(T.value&&(v+=`${T.key}=${T.value}${I<c.length-1?"&":""}`),v),"?");n.href=`${l.config.FEEDBACK_URL}/${m}${this._map._hash?this._map._hash.getHashString(!0):""}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||"metadata"!==n.sourceDataType&&"visibility"!==n.sourceDataType&&"style"!==n.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const c=this._map.style._sourceCaches;for(const v in c){const T=c[v];if(T.used){const I=T.getSource();I.attribution&&n.indexOf(I.attribution)<0&&n.push(I.attribution)}}n.sort((v,T)=>v.length-T.length),n=n.filter((v,T)=>{for(let I=T+1;I<n.length;I++)if(n[I].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const m=n.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,n.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class z{constructor(){l.bindAll(["_updateLogo"],this),l.bindAll(["_updateCompact"],this)}onAdd(n){this._map=n,this._container=Q.create("div","mapboxgl-ctrl");const c=Q.create("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&"metadata"!==n.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(0===Object.entries(n).length)return!0;for(const c in n){const m=n[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const c=n[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class O{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const c=++this._id;return this._queue.push({callback:n,id:c,cancelled:!1}),c}remove(n){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const v of m)if(v.id===n)return void(v.cancelled=!0)}run(n=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function P(f,n,c){if(f=new l.LngLat(f.lng,f.lat),n){const m=new l.LngLat(f.lng-360,f.lat),v=new l.LngLat(f.lng+360,f.lat),T=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),I=c.locationPoint(f).distSqr(n),R=n.x<0||n.y<0||n.x>c.width||n.y>c.height;c.locationPoint(m).distSqr(n)<I&&(R||Math.abs(m.lng-c.center.lng)<T)?f=m:c.locationPoint(v).distSqr(n)<I&&(R||Math.abs(v.lng-c.center.lng)<T)&&(f=v)}for(;Math.abs(f.lng-c.center.lng)>180;){const m=c.locationPoint(f);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const G={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class le extends l.Evented{constructor(n,c){if(super(),(n instanceof l.window.HTMLElement||c)&&(n=l.extend({element:n},c)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&"auto"!==n.pitchAlignment?n.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),n&&n.element)this._element=n.element,this._offset=l.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=Q.create("div");const v=41,T=27,I=Q.createSVG("svg",{display:"block",height:v*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${v}`},this._element),R=Q.createSVG("radialGradient",{id:"shadowGradient"},Q.createSVG("defs",{},I));Q.createSVG("stop",{offset:"10%","stop-opacity":.4},R),Q.createSVG("stop",{offset:"100%","stop-opacity":.05},R),Q.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),Q.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),Q.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),Q.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=l.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const m=this._element.classList;for(const v in G)m.remove(`mapboxgl-marker-anchor-${v}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=l.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const c=38.1,m=13.5,v=Math.sqrt(Math.pow(m,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-c],"bottom-left":[v,-1*(c-m+v)],"bottom-right":[-v,-1*(c-m+v)],left:[m,-1*(c-m)],right:[-m,-1*(c-m)]}:this._offset}this._popup=n,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const c=n.code,m=n.charCode||n.keyCode;"Space"!==c&&"Enter"!==c&&32!==m&&13!==m||this.togglePopup()}_onMapClick(n){const c=n.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const n=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(n))return void this._clearFadeTimer();const c=this._map.unproject(n);let m=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const T=this._map.getFreeCameraOptions();if(T.position){const I=T.position.toLngLat();m=I.distanceTo(c)<.9*I.distanceTo(this._lngLat)}}const v=(1-this._map._queryFogOpacity(c))*(m?.2:1);this._element.style.opacity=`${v}`,this._popup&&this._popup._setOpacity(`${v}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(n){const c=this._map.transform;return!!n&&n.x>=0&&n.x<c.width&&n.y>=0&&n.y<c.height}_updateDOM(){const n=this._pos||new l.pointGeometry(0,0),c=this._calculatePitch(),m=this._calculateRotation();this._element.style.transform=`${G[this._anchor]} translate(${n.x}px, ${n.y}px) rotateX(${c}deg) rotateZ(${m}deg)`}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(n){l.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=P(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),!0===n?this._updateFrameId=l.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const n=this._map.transform,c=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&c._rotate(n.angle),"map"===this._pitchAlignment&&(c.y*=Math.cos(n._pitch)),c}getOffset(){return this._offset}setOffset(n){return this._offset=l.pointGeometry.convert(n),this._update(),this}_onMove(n){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(n){this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&"auto"!==n?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Pe{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const c=l.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,c,m){this._start=this.getValue(c),this._end=n,this._startTime=c,this._endTime=c+m}}const st={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:yt,HTMLElement:_n,ImageBitmap:fi}=l.window,Zr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Si(f){f.parentNode&&f.parentNode.removeChild(f)}const qr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Br{constructor(n,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new os({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,m&&(this.mousePitch=new Ia({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(n,c){this.mouseRotate.mousedown(n,c),this.mousePitch&&this.mousePitch.mousedown(n,c),Q.disableDrag()}move(n,c){const m=this.map,v=this.mouseRotate.mousemoveWindow(n,c);if(v&&v.bearingDelta&&m.setBearing(m.getBearing()+v.bearingDelta),this.mousePitch){const T=this.mousePitch.mousemoveWindow(n,c);T&&T.pitchDelta&&m.setPitch(m.getPitch()+T.pitchDelta)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Q.enableDrag(),l.window.removeEventListener("mousemove",this.mousemove),l.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(l.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Q.mousePos(this.element,n)),l.window.addEventListener("mousemove",this.mousemove),l.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Q.mousePos(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){1!==n.targetTouches.length?this.reset():(this._startPos=this._lastPos=Q.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){1!==n.targetTouches.length?this.reset():(this._lastPos=Q.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){0===n.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ir={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Do,vs=0,xs=!1;const Wa={maxWidth:100,unit:"metric"};function Kn(f,n,c){const m=c&&c.maxWidth||100,v=f._containerHeight/2,T=f.unproject([0,v]),I=f.unproject([m,v]),R=T.distanceTo(I);if(c&&"imperial"===c.unit){const $=3.2808*R;$>5280?Fl(n,m,$/5280,f._getUIString("ScaleControl.Miles"),f):Fl(n,m,$,f._getUIString("ScaleControl.Feet"),f)}else c&&"nautical"===c.unit?Fl(n,m,R/1852,f._getUIString("ScaleControl.NauticalMiles"),f):R>=1e3?Fl(n,m,R/1e3,f._getUIString("ScaleControl.Kilometers"),f):Fl(n,m,R,f._getUIString("ScaleControl.Meters"),f)}function Fl(f,n,c,m,v){const T=function(R){const $=Math.pow(10,`${Math.floor(R)}`.length-1);let X=R/$;return X=X>=10?10:X>=5?5:X>=3?3:X>=2?2:X>=1?1:function(oe){const he=Math.pow(10,Math.ceil(-Math.log(oe)/Math.LN10));return Math.round(oe*he)/he}(X),$*X}(c),I=T/c;v._requestDomTask(()=>{f.style.width=n*I+"px",f.innerHTML=`${T}&nbsp;${m}`})}const ud={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ya=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Bl={version:l.version,supported:J,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends _l{constructor(f){if(null!=(f=l.extend({},Zr,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Jr(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._renderTaskQueue=new O,this._domRenderTaskQueue=new O,this._controls=[],this._markers=[],this._mapId=l.uniqueId(),this._locale=l.extend({},st,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Pe(0),this._requestManager=new l.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=l.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof _n))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&l.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==l.window&&(l.window.addEventListener("online",this._onWindowOnline,!1),l.window.addEventListener("resize",this._onWindowResize,!1),l.window.addEventListener("orientationchange",this._onWindowResize,!1),l.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new gl(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new Tc("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,l.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new Xc({customAttribution:f.customAttribution})),this._logoControl=new z,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update("style"===n.dataType),this.fire(new l.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new l.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(f,n){if(void 0===n&&(n=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const m=this._controlPositions[n];return-1!==n.indexOf("bottom")?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(f);return n>-1&&this._controls.splice(n,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new l.Event("movestart",f)).fire(new l.Event("move",f)),this.fire(new l.Event("resize",f)),n&&this.fire(new l.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(l.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getProjection(){return this.transform.getProjection()}setProjection(f){return this._lazyInitEmptyStyle(),"string"==typeof f&&(f={name:f}),this._runtimeProjection=f,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(f){return this.transform.locationPoint3D(l.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(l.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(f,n,c){if("mouseenter"===f||"mouseover"===f){let m=!1;const v=I=>{const R=n.filter(X=>this.getLayer(X)),$=R.length?this.queryRenderedFeatures(I.point,{layers:R}):[];$.length?m||(m=!0,c.call(this,new $o(f,this,I.originalEvent,{features:$}))):m=!1},T=()=>{m=!1};return{layers:new Set(n),listener:c,delegates:{mousemove:v,mouseout:T}}}if("mouseleave"===f||"mouseout"===f){let m=!1;const v=I=>{const R=n.filter($=>this.getLayer($));(R.length?this.queryRenderedFeatures(I.point,{layers:R}):[]).length?m=!0:m&&(m=!1,c.call(this,new $o(f,this,I.originalEvent)))},T=I=>{m&&(m=!1,c.call(this,new $o(f,this,I.originalEvent)))};return{layers:new Set(n),listener:c,delegates:{mousemove:v,mouseout:T}}}{const m=v=>{const T=n.filter(R=>this.getLayer(R)),I=T.length?this.queryRenderedFeatures(v.point,{layers:T}):[];I.length&&(v.features=I,c.call(this,v),delete v.features)};return{layers:new Set(n),listener:c,delegates:{[f]:m}}}}on(f,n,c){if(void 0===c)return super.on(f,n);Array.isArray(n)||(n=[n]);const m=this._createDelegatedListener(f,n,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(f,n,c){if(void 0===c)return super.once(f,n);Array.isArray(n)||(n=[n]);const m=this._createDelegatedListener(f,n,c);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(f,n,c){if(void 0===c)return super.off(f,n);n=new Set(Array.isArray(n)?n:[n]);const m=(T,I)=>{if(T.size!==I.size)return!1;for(const R of T)if(!I.has(R))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[f]:void 0;return v&&(T=>{for(let I=0;I<T.length;I++){const R=T[I];if(R.listener===c&&m(R.layers,n)){for(const $ in R.delegates)this.off($,R.delegates[$]);return T.splice(I,1),this}}})(v),this}queryRenderedFeatures(f,n){return this.style?(void 0!==n||void 0===f||f instanceof l.pointGeometry||Array.isArray(f)||(n=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(f,n){return this.style.querySourceFeatures(f,n)}queryTerrainElevation(f,n){const c=this.transform.elevation;return c?(n=l.extend({},{exaggerated:!0},n),c.getAtPoint(l.MercatorCoordinate.fromLngLat(f),null,n.exaggerated)):null}setStyle(f,n){return!1!==(n=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(f,n))}_getUIString(f){const n=this._locale[f];if(null==n)throw new Error(`Missing UI string '${f}'`);return n}_updateStyle(f,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),f&&(this.style=new sr(this,n||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new sr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,n){if("string"==typeof f){const c=this._requestManager.normalizeStyleURL(f),m=this._requestManager.transformRequest(c,l.ResourceType.Style);l.getJSON(m,(v,T)=>{v?this.fire(new l.ErrorEvent(v)):T&&this._updateDiff(T,n)})}else"object"==typeof f&&this._updateDiff(f,n)}_updateDiff(f,n){try{this.style.setState(f)&&this._update(!0)}catch(c){l.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(f,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(f,n){return this._lazyInitEmptyStyle(),this.style.addSource(f,n),this._update(!0)}isSourceLoaded(f){const n=this.style&&this.style._getSourceCaches(f);if(0!==n.length)return n.every(c=>c.loaded());this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${f}'`)))}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const n in f){const c=f[n]._tiles;for(const m in c){const v=c[m];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}addSourceType(f,n,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,n,c)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,n,{pixelRatio:c=1,sdf:m=!1,stretchX:v,stretchY:T,content:I}={}){if(this._lazyInitEmptyStyle(),n instanceof yt||fi&&n instanceof fi){const{width:R,height:$,data:X}=l.exported.getImageData(n);this.style.addImage(f,{data:new l.RGBAImage({width:R,height:$},X),pixelRatio:c,stretchX:v,stretchY:T,content:I,sdf:m,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:R,height:$,data:X}=n,oe=n;this.style.addImage(f,{data:new l.RGBAImage({width:R,height:$},new Uint8Array(X)),pixelRatio:c,stretchX:v,stretchY:T,content:I,sdf:m,version:0,userImage:oe}),oe.onAdd&&oe.onAdd(this,f)}}}updateImage(f,n){const c=this.style.getImage(f);if(!c)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=n instanceof yt||fi&&n instanceof fi?l.exported.getImageData(n):n,{width:v,height:T,data:I}=m;return void 0===v||void 0===T?this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):v!==c.data.width||T!==c.data.height?this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(c.data.replace(I,!(n instanceof yt||fi&&n instanceof fi)),void this.style.updateImage(f,c))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,n){l.getImage(this._requestManager.transformRequest(f,l.ResourceType.Image),(c,m)=>{n(c,m instanceof yt?l.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(f,n){return this._lazyInitEmptyStyle(),this.style.addLayer(f,n),this._update(!0)}moveLayer(f,n){return this.style.moveLayer(f,n),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,n,c){return this.style.setLayerZoomRange(f,n,c),this._update(!0)}setFilter(f,n,c={}){return this.style.setFilter(f,n,c),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,n,c,m={}){return this.style.setPaintProperty(f,n,c,m),this._update(!0)}getPaintProperty(f,n){return this.style.getPaintProperty(f,n)}setLayoutProperty(f,n,c,m={}){return this.style.setLayoutProperty(f,n,c,m),this._update(!0)}getLayoutProperty(f,n){return this.style.getLayoutProperty(f,n)}setLight(f,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){"globe"===this.transform.projection.name&&this.transform.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(l.LngLat.convert(f),this.transform):0}setFeatureState(f,n){return this.style.setFeatureState(f,n),this._update()}removeFeatureState(f,n){return this.style.removeFeatureState(f,n),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let c,m=this._container;for(;m&&!c;){const v=l.window.getComputedStyle(m).transform;v&&"none"!==v&&(c=v.match(/matrix.*\((.+)\)/)[1].split(", ")),m=m.parentElement}c?(this._containerWidth=c[0]&&"0"!==c[0]?Math.abs(f/c[0]):f,this._containerHeight=c[3]&&"0"!==c[3]?Math.abs(n/c[3]):n):(this._containerWidth=f,this._containerHeight=n)}_detectMissingCSS(){"rgb(250, 128, 114)"!==l.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&l.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Q.create("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=Q.create("div","mapboxgl-canvas-container",f);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=Q.create("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=Q.create("div","mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=Q.create("div",`mapboxgl-ctrl-${v}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,n){const c=l.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(n),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${n}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const n=this._markers.indexOf(f);-1!==n&&this._markers.splice(n,1)}_setupPainter(){const f=l.extend({},J.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);n?(l.storeAuthState(n,!0),this.painter=new re(n,this.transform),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),l.exported$1.testSupport(n)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let n;const c=this.painter.context.extTimerQuery,m=l.exported.now();this.listens("gpu-timing-frame")&&(n=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,n));let v=this._updateAverageElevation(m);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjection();let T=!1;const I=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const $=this.transform.zoom,X=this.transform.pitch,oe=l.exported.now();this.style.zoomHistory.update($,oe);const he=new l.EvaluationParameters($,{now:oe,fadeDuration:I,pitch:X,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Me=he.crossFadingFactor();1===Me&&Me===this._crossFadingFactor||(T=!0,this._crossFadingFactor=Me),this.style.update(he)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,I,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:I,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||T)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const $=l.exported.now()-m;c.endQueryEXT(c.TIME_ELAPSED_EXT,n),setTimeout(()=>{const X=c.getQueryObjectEXT(n,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(n),this.fire(new l.Event("gpu-timing-frame",{cpuTime:$,gpuTime:X}))},50)}if(this.listens("gpu-timing-layer")){const $=this.painter.collectGpuTimers();setTimeout(()=>{const X=this.painter.queryGpuTimers($);this.fire(new l.Event("gpu-timing-layer",{layerTimes:X}))},50)}const R=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(R||this._repaint)this.triggerRepaint();else{const $=!this.isMoving()&&this.loaded();if($&&(v=this._updateAverageElevation(m,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),$&&(this.fire(new l.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const X=this._calculateSpeedIndex();this.fire(new l.Event("speedindexcompleted",{speedIndex:X})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const f of this._markers)f._update()}_updateAverageElevation(f,n=!1){const c=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((n||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const m=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();isNaN(v)?v=0:this._averageElevationLastSampledAt=f;const T=Math.abs(m-v);if(T>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(v),c(v);this._averageElevation.easeTo(v,f,300)}else if(T>1e-4)return this._averageElevation.jumpTo(v),c(v)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){l.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===l.AUTH_ERR_MSG||401===f.status)){const n=this.painter.context.gl;l.storeAuthState(n,!1),this._logoControl instanceof z&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new l.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),l.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function v(T){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,T,0);const I=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,I),I}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(v(f),n.canvasCopies.map(v),n.timeStamps)}_canvasPixelComparison(f,n,c){let m=c[1]-c[0];const v=f.length/4;for(let T=0;T<n.length;T++){const I=n[T];let R=0;for(let $=0;$<I.length;$+=4)I[$]===f[$]&&I[$+1]===f[$+1]&&I[$+2]===f[$+2]&&I[$+3]===f[$+3]&&(R+=1);m+=(c[T+2]-c[T+1])*(1-R/v)}return m}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==l.window&&(l.window.removeEventListener("resize",this._onWindowResize,!1),l.window.removeEventListener("orientationchange",this._onWindowResize,!1),l.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),Si(this._canvasContainer),Si(this._controlContainer),Si(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),l.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=l.exported.frame(n=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(n)}))}_preloadTiles(f){const n=this.style&&Object.values(this.style._sourceCaches)||[];return l.asyncAll(n,(c,m)=>c._preloadTiles(f,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,n){l.setCacheLimits(f,n)}get version(){return l.version}},NavigationControl:class{constructor(f){this.options=l.extend({},qr,f),this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),Q.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),Q.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=Q.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const f=this._map.getZoom(),n=f===this._map.getMaxZoom(),c=f===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=f)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Br(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,n){const c=Q.create("button",f,this._container);return c.type="button",c.addEventListener("click",n),c}_setButtonTitle(f,n){const c=this._map._getUIString(`NavigationControl.${n}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends l.Evented{constructor(f){super(),this.options=l.extend({},Ir,f),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=fa(this._updateMarkerRotation,20)}onAdd(f){var n;return this._map=f,this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==Do?n(Do):void 0!==l.window.navigator.permissions?l.window.navigator.permissions.query({name:"geolocation"}).then(c=>{Do="denied"!==c.state,n(Do)}):(Do=!!l.window.navigator.geolocation,n(Do)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(l.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,vs=0,xs=!1}_isOutOfMapMaxBounds(f){const n=this._map.getMaxBounds(),c=f.coords;return n&&(c.longitude<n.getWest()||c.longitude>n.getEast()||c.latitude<n.getSouth()||c.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",f)),this._finish()}}_updateCamera(f){const n=new l.LngLat(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,m=this._map.getBearing(),v=l.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(c),v,{geolocateSource:!0})}_updateMarker(f){if(f){const n=new l.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map._containerHeight/2,n=this._map.unproject([0,f]),c=this._map.unproject([100,f]),m=n.distanceTo(c)/100,v=Math.ceil(2*this._accuracy/m);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&xs)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=Q.create("button","mapboxgl-ctrl-geolocate",this._container),Q.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===f){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q.create("div","mapboxgl-user-location"),this._dotElement.appendChild(Q.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Q.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new le({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Q.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new le({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n.originalEvent&&"resize"===n.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":vs--,xs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),vs++,vs>1?(f={maximumAge:6e5,timeout:0},xs=!0):(f=this.options.positionOptions,xs=!1),this._geolocationWatchID=l.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else l.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{l.window.addEventListener("ondeviceorientationabsolute"in l.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==l.window.DeviceMotionEvent&&"function"==typeof l.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(n=>{"granted"===n&&f()}).catch(console.error):f()}_clearWatch(){l.window.navigator.geolocation.clearWatch(this._geolocationWatchID),l.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),l.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Xc,ScaleControl:class{constructor(f){this.options=l.extend({},Wa,f),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Kn(this._map,this._container,this.options)}onAdd(f){return this._map=f,this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(f){this.options.unit=f,Kn(this._map,this._container,this.options)}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof l.window.HTMLElement?this._container=f.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in l.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in l.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,l.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!l.window.document.fullscreenEnabled&&!l.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Q.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Q.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),l.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(l.window.document.fullscreenElement||l.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?l.window.document.exitFullscreen?l.window.document.exitFullscreen():l.window.document.webkitCancelFullScreen&&l.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends l.Evented{constructor(f){super(),this.options=l.extend(Object.create(ud),f),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=l.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(l.window.document.createTextNode(f))}setHTML(f){const n=l.window.document.createDocumentFragment(),c=l.window.document.createElement("body");let m;for(c.innerHTML=f;m=c.firstChild,m;)n.appendChild(m);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Q.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._container&&this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._container&&this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let n;return this._classList.delete(f)?n=!1:(this._classList.add(f),n=!0),this._container&&this._updateClassList(),n}_createCloseButton(){this.options.closeButton&&(this._closeButton=Q.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(f){this._update(f.point)}_onMouseMove(f){this._update(f.point)}_onDrag(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const n=this._pos,c=this._container.offsetWidth,m=this._container.offsetHeight;let v;return v=n.y+f.bottom.y<m?["top"]:n.y>this._map.transform.height-m?["bottom"]:[],n.x<c/2?v.push("left"):n.x>this._map.transform.width-c/2&&v.push("right"),0===v.length?"bottom":v.join("-")}_updateClassList(){const f=[...this._classList];f.push("mapboxgl-popup"),this._anchor&&f.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&f.push("mapboxgl-popup-track-pointer"),this._container.className=f.join(" ")}_update(f){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=Q.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Q.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=P(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f){const n=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),c=function(T){if(T||(T=new l.pointGeometry(0,0)),"number"==typeof T){const I=Math.round(Math.sqrt(.5*Math.pow(T,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,T),"top-left":new l.pointGeometry(I,I),"top-right":new l.pointGeometry(-I,I),bottom:new l.pointGeometry(0,-T),"bottom-left":new l.pointGeometry(I,-I),"bottom-right":new l.pointGeometry(-I,-I),left:new l.pointGeometry(T,0),right:new l.pointGeometry(-T,0)}}if(T instanceof l.pointGeometry||Array.isArray(T)){const I=l.pointGeometry.convert(T);return{center:I,top:I,"top-left":I,"top-right":I,bottom:I,"bottom-left":I,"bottom-right":I,left:I,right:I}}return{center:l.pointGeometry.convert(T.center||[0,0]),top:l.pointGeometry.convert(T.top||[0,0]),"top-left":l.pointGeometry.convert(T["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(T["top-right"]||[0,0]),bottom:l.pointGeometry.convert(T.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(T["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(T["bottom-right"]||[0,0]),left:l.pointGeometry.convert(T.left||[0,0]),right:l.pointGeometry.convert(T.right||[0,0])}}(this.options.offset),m=this._anchor=this._getAnchor(c),v=n.add(c[m]).round();this._map._requestDomTask(()=>{this._container&&m&&(this._container.style.transform=`${G[m]} translate(${v.x}px,${v.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Ya);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._content&&(this._content.style.opacity=f),this._tip&&(this._tip.style.opacity=f)}},Marker:le,Style:sr,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,FreeCameraOptions:pi,Evented:l.Evented,config:l.config,prewarm:function(){Je().acquire(Ye)},clearPrewarmedResources:function(){const f=Ct;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(Ye),Ct=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return l.config.ACCESS_TOKEN},set accessToken(f){l.config.ACCESS_TOKEN=f},get baseApiUrl(){return l.config.API_URL},set baseApiUrl(f){l.config.API_URL=f},get workerCount(){return pt.workerCount},set workerCount(f){pt.workerCount=f},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){l.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){l.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:l.exported.setNow,restoreNow:l.exported.restoreNow};return Bl}),b}()},591:(An,vt,k)=>{"use strict";k.d(vt,{X:()=>pe});var b=k(8929),d=k(5279);class pe extends b.xQ{constructor(J){super(),this._value=J}get value(){return this.getValue()}_subscribe(J){const j=super._subscribe(J);return j&&!j.closed&&J.next(this._value),j}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new d.N;return this._value}next(J){super.next(this._value=J)}}},2916:(An,vt,k)=>{"use strict";k.d(vt,{y:()=>Y});var b=k(3489),pe=k(7668),l=k(3292),j=k(3821),g=k(5379);var Q=k(2830);let Y=(()=>{class ue{constructor(xe){this._isScalar=!1,xe&&(this._subscribe=xe)}lift(xe){const Ee=new ue;return Ee.source=this,Ee.operator=xe,Ee}subscribe(xe,Ee,We){const{operator:be}=this,Se=function J(ue,ye,xe){if(ue){if(ue instanceof b.L)return ue;if(ue[pe.b])return ue[pe.b]()}return ue||ye||xe?new b.L(ue,ye,xe):new b.L(l.c)}(xe,Ee,We);if(Se.add(be?be.call(Se,this.source):this.source||Q.v.useDeprecatedSynchronousErrorHandling&&!Se.syncErrorThrowable?this._subscribe(Se):this._trySubscribe(Se)),Q.v.useDeprecatedSynchronousErrorHandling&&Se.syncErrorThrowable&&(Se.syncErrorThrowable=!1,Se.syncErrorThrown))throw Se.syncErrorValue;return Se}_trySubscribe(xe){try{return this._subscribe(xe)}catch(Ee){Q.v.useDeprecatedSynchronousErrorHandling&&(xe.syncErrorThrown=!0,xe.syncErrorValue=Ee),function d(ue){for(;ue;){const{closed:ye,destination:xe,isStopped:Ee}=ue;if(ye||Ee)return!1;ue=xe&&xe instanceof b.L?xe:null}return!0}(xe)?xe.error(Ee):console.warn(Ee)}}forEach(xe,Ee){return new(Ee=se(Ee))((We,be)=>{let Se;Se=this.subscribe(ze=>{try{xe(ze)}catch(tt){be(tt),Se&&Se.unsubscribe()}},be,We)})}_subscribe(xe){const{source:Ee}=this;return Ee&&Ee.subscribe(xe)}[j.L](){return this}pipe(...xe){return 0===xe.length?this:function ge(ue){return 0===ue.length?g.y:1===ue.length?ue[0]:function(xe){return ue.reduce((Ee,We)=>We(Ee),xe)}}(xe)(this)}toPromise(xe){return new(xe=se(xe))((Ee,We)=>{let be;this.subscribe(Se=>be=Se,Se=>We(Se),()=>Ee(be))})}}return ue.create=ye=>new ue(ye),ue})();function se(ue){if(ue||(ue=Q.v.Promise||Promise),!ue)throw new Error("no Promise impl found");return ue}},3292:(An,vt,k)=>{"use strict";k.d(vt,{c:()=>pe});var b=k(2830),d=k(2782);const pe={closed:!0,next(l){},error(l){if(b.v.useDeprecatedSynchronousErrorHandling)throw l;(0,d.z)(l)},complete(){}}},8929:(An,vt,k)=>{"use strict";k.d(vt,{Yc:()=>g,xQ:()=>ne});var b=k(2916),d=k(3489),pe=k(2654),l=k(5279),J=k(5283),j=k(7668);class g extends d.L{constructor(Y){super(Y),this.destination=Y}}let ne=(()=>{class Q extends b.y{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[j.b](){return new g(this)}lift(se){const ue=new ge(this,this);return ue.operator=se,ue}next(se){if(this.closed)throw new l.N;if(!this.isStopped){const{observers:ue}=this,ye=ue.length,xe=ue.slice();for(let Ee=0;Ee<ye;Ee++)xe[Ee].next(se)}}error(se){if(this.closed)throw new l.N;this.hasError=!0,this.thrownError=se,this.isStopped=!0;const{observers:ue}=this,ye=ue.length,xe=ue.slice();for(let Ee=0;Ee<ye;Ee++)xe[Ee].error(se);this.observers.length=0}complete(){if(this.closed)throw new l.N;this.isStopped=!0;const{observers:se}=this,ue=se.length,ye=se.slice();for(let xe=0;xe<ue;xe++)ye[xe].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(se){if(this.closed)throw new l.N;return super._trySubscribe(se)}_subscribe(se){if(this.closed)throw new l.N;return this.hasError?(se.error(this.thrownError),pe.w.EMPTY):this.isStopped?(se.complete(),pe.w.EMPTY):(this.observers.push(se),new J.W(this,se))}asObservable(){const se=new b.y;return se.source=this,se}}return Q.create=(Y,se)=>new ge(Y,se),Q})();class ge extends ne{constructor(Y,se){super(),this.destination=Y,this.source=se}next(Y){const{destination:se}=this;se&&se.next&&se.next(Y)}error(Y){const{destination:se}=this;se&&se.error&&this.destination.error(Y)}complete(){const{destination:Y}=this;Y&&Y.complete&&this.destination.complete()}_subscribe(Y){const{source:se}=this;return se?this.source.subscribe(Y):pe.w.EMPTY}}},5283:(An,vt,k)=>{"use strict";k.d(vt,{W:()=>d});var b=k(2654);class d extends b.w{constructor(l,J){super(),this.subject=l,this.subscriber=J,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const l=this.subject,J=l.observers;if(this.subject=null,!J||0===J.length||l.isStopped||l.closed)return;const j=J.indexOf(this.subscriber);-1!==j&&J.splice(j,1)}}},3489:(An,vt,k)=>{"use strict";k.d(vt,{L:()=>g});var b=k(7043),d=k(3292),pe=k(2654),l=k(7668),J=k(2830),j=k(2782);class g extends pe.w{constructor(Q,Y,se){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=d.c;break;case 1:if(!Q){this.destination=d.c;break}if("object"==typeof Q){Q instanceof g?(this.syncErrorThrowable=Q.syncErrorThrowable,this.destination=Q,Q.add(this)):(this.syncErrorThrowable=!0,this.destination=new ne(this,Q));break}default:this.syncErrorThrowable=!0,this.destination=new ne(this,Q,Y,se)}}[l.b](){return this}static create(Q,Y,se){const ue=new g(Q,Y,se);return ue.syncErrorThrowable=!1,ue}next(Q){this.isStopped||this._next(Q)}error(Q){this.isStopped||(this.isStopped=!0,this._error(Q))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(Q){this.destination.next(Q)}_error(Q){this.destination.error(Q),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:Q}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=Q,this}}class ne extends g{constructor(Q,Y,se,ue){super(),this._parentSubscriber=Q;let ye,xe=this;(0,b.m)(Y)?ye=Y:Y&&(ye=Y.next,se=Y.error,ue=Y.complete,Y!==d.c&&(xe=Object.create(Y),(0,b.m)(xe.unsubscribe)&&this.add(xe.unsubscribe.bind(xe)),xe.unsubscribe=this.unsubscribe.bind(this))),this._context=xe,this._next=ye,this._error=se,this._complete=ue}next(Q){if(!this.isStopped&&this._next){const{_parentSubscriber:Y}=this;J.v.useDeprecatedSynchronousErrorHandling&&Y.syncErrorThrowable?this.__tryOrSetError(Y,this._next,Q)&&this.unsubscribe():this.__tryOrUnsub(this._next,Q)}}error(Q){if(!this.isStopped){const{_parentSubscriber:Y}=this,{useDeprecatedSynchronousErrorHandling:se}=J.v;if(this._error)se&&Y.syncErrorThrowable?(this.__tryOrSetError(Y,this._error,Q),this.unsubscribe()):(this.__tryOrUnsub(this._error,Q),this.unsubscribe());else if(Y.syncErrorThrowable)se?(Y.syncErrorValue=Q,Y.syncErrorThrown=!0):(0,j.z)(Q),this.unsubscribe();else{if(this.unsubscribe(),se)throw Q;(0,j.z)(Q)}}}complete(){if(!this.isStopped){const{_parentSubscriber:Q}=this;if(this._complete){const Y=()=>this._complete.call(this._context);J.v.useDeprecatedSynchronousErrorHandling&&Q.syncErrorThrowable?(this.__tryOrSetError(Q,Y),this.unsubscribe()):(this.__tryOrUnsub(Y),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(Q,Y){try{Q.call(this._context,Y)}catch(se){if(this.unsubscribe(),J.v.useDeprecatedSynchronousErrorHandling)throw se;(0,j.z)(se)}}__tryOrSetError(Q,Y,se){if(!J.v.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{Y.call(this._context,se)}catch(ue){return J.v.useDeprecatedSynchronousErrorHandling?(Q.syncErrorValue=ue,Q.syncErrorThrown=!0,!0):((0,j.z)(ue),!0)}return!1}_unsubscribe(){const{_parentSubscriber:Q}=this;this._context=null,this._parentSubscriber=null,Q.unsubscribe()}}},2654:(An,vt,k)=>{"use strict";k.d(vt,{w:()=>j});var b=k(6688),d=k(7830),pe=k(7043);const J=(()=>{function ne(ge){return Error.call(this),this.message=ge?`${ge.length} errors occurred during unsubscription:\n${ge.map((Q,Y)=>`${Y+1}) ${Q.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=ge,this}return ne.prototype=Object.create(Error.prototype),ne})();class j{constructor(ge){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,ge&&(this._ctorUnsubscribe=!0,this._unsubscribe=ge)}unsubscribe(){let ge;if(this.closed)return;let{_parentOrParents:Q,_ctorUnsubscribe:Y,_unsubscribe:se,_subscriptions:ue}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,Q instanceof j)Q.remove(this);else if(null!==Q)for(let ye=0;ye<Q.length;++ye)Q[ye].remove(this);if((0,pe.m)(se)){Y&&(this._unsubscribe=void 0);try{se.call(this)}catch(ye){ge=ye instanceof J?g(ye.errors):[ye]}}if((0,b.k)(ue)){let ye=-1,xe=ue.length;for(;++ye<xe;){const Ee=ue[ye];if((0,d.K)(Ee))try{Ee.unsubscribe()}catch(We){ge=ge||[],We instanceof J?ge=ge.concat(g(We.errors)):ge.push(We)}}}if(ge)throw new J(ge)}add(ge){let Q=ge;if(!ge)return j.EMPTY;switch(typeof ge){case"function":Q=new j(ge);case"object":if(Q===this||Q.closed||"function"!=typeof Q.unsubscribe)return Q;if(this.closed)return Q.unsubscribe(),Q;if(!(Q instanceof j)){const ue=Q;Q=new j,Q._subscriptions=[ue]}break;default:throw new Error("unrecognized teardown "+ge+" added to Subscription.")}let{_parentOrParents:Y}=Q;if(null===Y)Q._parentOrParents=this;else if(Y instanceof j){if(Y===this)return Q;Q._parentOrParents=[Y,this]}else{if(-1!==Y.indexOf(this))return Q;Y.push(this)}const se=this._subscriptions;return null===se?this._subscriptions=[Q]:se.push(Q),Q}remove(ge){const Q=this._subscriptions;if(Q){const Y=Q.indexOf(ge);-1!==Y&&Q.splice(Y,1)}}}var ne;function g(ne){return ne.reduce((ge,Q)=>ge.concat(Q instanceof J?Q.errors:Q),[])}j.EMPTY=((ne=new j).closed=!0,ne)},2830:(An,vt,k)=>{"use strict";k.d(vt,{v:()=>d});let b=!1;const d={Promise:void 0,set useDeprecatedSynchronousErrorHandling(pe){if(pe){const l=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+l.stack)}else b&&console.log("RxJS: Back to a better error behavior. Thank you. <3");b=pe},get useDeprecatedSynchronousErrorHandling(){return b}}},1177:(An,vt,k)=>{"use strict";k.d(vt,{IY:()=>l,Ds:()=>j,ft:()=>ne});var b=k(3489),d=k(2916),pe=k(9249);class l extends b.L{constructor(Q){super(),this.parent=Q}_next(Q){this.parent.notifyNext(Q)}_error(Q){this.parent.notifyError(Q),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class j extends b.L{notifyNext(Q){this.destination.next(Q)}notifyError(Q){this.destination.error(Q)}notifyComplete(){this.destination.complete()}}function ne(ge,Q){if(!Q.closed)return ge instanceof d.y?ge.subscribe(Q):(0,pe.s)(ge)(Q)}},1762:(An,vt,k)=>{"use strict";k.d(vt,{c:()=>J,N:()=>j});var b=k(8929),d=k(2916),pe=k(2654),l=k(4327);class J extends d.y{constructor(Y,se){super(),this.source=Y,this.subjectFactory=se,this._refCount=0,this._isComplete=!1}_subscribe(Y){return this.getSubject().subscribe(Y)}getSubject(){const Y=this._subject;return(!Y||Y.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let Y=this._connection;return Y||(this._isComplete=!1,Y=this._connection=new pe.w,Y.add(this.source.subscribe(new g(this.getSubject(),this))),Y.closed&&(this._connection=null,Y=pe.w.EMPTY)),Y}refCount(){return(0,l.x)()(this)}}const j=(()=>{const Q=J.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:Q._subscribe},_isComplete:{value:Q._isComplete,writable:!0},getSubject:{value:Q.getSubject},connect:{value:Q.connect},refCount:{value:Q.refCount}}})();class g extends b.Yc{constructor(Y,se){super(Y),this.connectable=se}_error(Y){this._unsubscribe(),super._error(Y)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const Y=this.connectable;if(Y){this.connectable=null;const se=Y._connection;Y._refCount=0,Y._subject=null,Y._connection=null,se&&se.unsubscribe()}}}},1221:(An,vt,k)=>{"use strict";k.d(vt,{z:()=>l});var b=k(1086),d=k(9146);function l(...J){return function pe(){return(0,d.J)(1)}()((0,b.of)(...J))}},8514:(An,vt,k)=>{"use strict";k.d(vt,{P:()=>l});var b=k(2916),d=k(5254),pe=k(8896);function l(J){return new b.y(j=>{let g;try{g=J()}catch(ge){return void j.error(ge)}return(g?(0,d.D)(g):(0,pe.c)()).subscribe(j)})}},8896:(An,vt,k)=>{"use strict";k.d(vt,{E:()=>d,c:()=>pe});var b=k(2916);const d=new b.y(J=>J.complete());function pe(J){return J?function l(J){return new b.y(j=>J.schedule(()=>j.complete()))}(J):d}},567:(An,vt,k)=>{"use strict";k.d(vt,{D:()=>j});var b=k(2916),d=k(6688),pe=k(4850),l=k(7830),J=k(5254);function j(...ne){if(1===ne.length){const ge=ne[0];if((0,d.k)(ge))return g(ge,null);if((0,l.K)(ge)&&Object.getPrototypeOf(ge)===Object.prototype){const Q=Object.keys(ge);return g(Q.map(Y=>ge[Y]),Q)}}if("function"==typeof ne[ne.length-1]){const ge=ne.pop();return g(ne=1===ne.length&&(0,d.k)(ne[0])?ne[0]:ne,null).pipe((0,pe.U)(Q=>ge(...Q)))}return g(ne,null)}function g(ne,ge){return new b.y(Q=>{const Y=ne.length;if(0===Y)return void Q.complete();const se=new Array(Y);let ue=0,ye=0;for(let xe=0;xe<Y;xe++){const Ee=(0,J.D)(ne[xe]);let We=!1;Q.add(Ee.subscribe({next:be=>{We||(We=!0,ye++),se[xe]=be},error:be=>Q.error(be),complete:()=>{ue++,(ue===Y||!We)&&(ye===Y&&Q.next(ge?ge.reduce((be,Se,ze)=>(be[Se]=se[ze],be),{}):se),Q.complete())}}))}})}},5254:(An,vt,k)=>{"use strict";k.d(vt,{D:()=>xe});var b=k(2916),d=k(9249),pe=k(2654),l=k(3821),g=k(6454),ne=k(5430),Y=k(8955),se=k(8515);function xe(Ee,We){return We?function ye(Ee,We){if(null!=Ee){if(function Q(Ee){return Ee&&"function"==typeof Ee[l.L]}(Ee))return function J(Ee,We){return new b.y(be=>{const Se=new pe.w;return Se.add(We.schedule(()=>{const ze=Ee[l.L]();Se.add(ze.subscribe({next(tt){Se.add(We.schedule(()=>be.next(tt)))},error(tt){Se.add(We.schedule(()=>be.error(tt)))},complete(){Se.add(We.schedule(()=>be.complete()))}}))})),Se})}(Ee,We);if((0,Y.t)(Ee))return function j(Ee,We){return new b.y(be=>{const Se=new pe.w;return Se.add(We.schedule(()=>Ee.then(ze=>{Se.add(We.schedule(()=>{be.next(ze),Se.add(We.schedule(()=>be.complete()))}))},ze=>{Se.add(We.schedule(()=>be.error(ze)))}))),Se})}(Ee,We);if((0,se.z)(Ee))return(0,g.r)(Ee,We);if(function ue(Ee){return Ee&&"function"==typeof Ee[ne.hZ]}(Ee)||"string"==typeof Ee)return function ge(Ee,We){if(!Ee)throw new Error("Iterable cannot be null");return new b.y(be=>{const Se=new pe.w;let ze;return Se.add(()=>{ze&&"function"==typeof ze.return&&ze.return()}),Se.add(We.schedule(()=>{ze=Ee[ne.hZ](),Se.add(We.schedule(function(){if(be.closed)return;let tt,et;try{const Be=ze.next();tt=Be.value,et=Be.done}catch(Be){return void be.error(Be)}et?be.complete():(be.next(tt),this.schedule())}))})),Se})}(Ee,We)}throw new TypeError((null!==Ee&&typeof Ee||Ee)+" is not observable")}(Ee,We):Ee instanceof b.y?Ee:new b.y((0,d.s)(Ee))}},3009:(An,vt,k)=>{"use strict";k.d(vt,{n:()=>l});var b=k(2916),d=k(3650),pe=k(6454);function l(J,j){return j?(0,pe.r)(J,j):new b.y((0,d.V)(J))}},3753:(An,vt,k)=>{"use strict";k.d(vt,{R:()=>j});var b=k(2916),d=k(6688),pe=k(7043),l=k(4850);function j(Y,se,ue,ye){return(0,pe.m)(ue)&&(ye=ue,ue=void 0),ye?j(Y,se,ue).pipe((0,l.U)(xe=>(0,d.k)(xe)?ye(...xe):ye(xe))):new b.y(xe=>{g(Y,se,function Ee(We){xe.next(arguments.length>1?Array.prototype.slice.call(arguments):We)},xe,ue)})}function g(Y,se,ue,ye,xe){let Ee;if(function Q(Y){return Y&&"function"==typeof Y.addEventListener&&"function"==typeof Y.removeEventListener}(Y)){const We=Y;Y.addEventListener(se,ue,xe),Ee=()=>We.removeEventListener(se,ue,xe)}else if(function ge(Y){return Y&&"function"==typeof Y.on&&"function"==typeof Y.off}(Y)){const We=Y;Y.on(se,ue),Ee=()=>We.off(se,ue)}else if(function ne(Y){return Y&&"function"==typeof Y.addListener&&"function"==typeof Y.removeListener}(Y)){const We=Y;Y.addListener(se,ue),Ee=()=>We.removeListener(se,ue)}else{if(!Y||!Y.length)throw new TypeError("Invalid event target");for(let We=0,be=Y.length;We<be;We++)g(Y[We],se,ue,ye,xe)}ye.add(Ee)}},1086:(An,vt,k)=>{"use strict";k.d(vt,{of:()=>l});var b=k(2866),d=k(3009),pe=k(6454);function l(...J){let j=J[J.length-1];return(0,b.K)(j)?(J.pop(),(0,pe.r)(J,j)):(0,d.n)(J)}},1406:(An,vt,k)=>{"use strict";k.d(vt,{b:()=>d});var b=k(1709);function d(pe,l){return(0,b.zg)(pe,l,1)}},2198:(An,vt,k)=>{"use strict";k.d(vt,{h:()=>d});var b=k(3489);function d(J,j){return function(ne){return ne.lift(new pe(J,j))}}class pe{constructor(j,g){this.predicate=j,this.thisArg=g}call(j,g){return g.subscribe(new l(j,this.predicate,this.thisArg))}}class l extends b.L{constructor(j,g,ne){super(j),this.predicate=g,this.thisArg=ne,this.count=0}_next(j){let g;try{g=this.predicate.call(this.thisArg,j,this.count++)}catch(ne){return void this.destination.error(ne)}g&&this.destination.next(j)}}},4850:(An,vt,k)=>{"use strict";k.d(vt,{U:()=>d});var b=k(3489);function d(J,j){return function(ne){if("function"!=typeof J)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return ne.lift(new pe(J,j))}}class pe{constructor(j,g){this.project=j,this.thisArg=g}call(j,g){return g.subscribe(new l(j,this.project,this.thisArg))}}class l extends b.L{constructor(j,g,ne){super(j),this.project=g,this.count=0,this.thisArg=ne||this}_next(j){let g;try{g=this.project.call(this.thisArg,j,this.count++)}catch(ne){return void this.destination.error(ne)}this.destination.next(g)}}},9146:(An,vt,k)=>{"use strict";k.d(vt,{J:()=>pe});var b=k(1709),d=k(5379);function pe(l=Number.POSITIVE_INFINITY){return(0,b.zg)(d.y,l)}},1709:(An,vt,k)=>{"use strict";k.d(vt,{zg:()=>l});var b=k(4850),d=k(5254),pe=k(1177);function l(ne,ge,Q=Number.POSITIVE_INFINITY){return"function"==typeof ge?Y=>Y.pipe(l((se,ue)=>(0,d.D)(ne(se,ue)).pipe((0,b.U)((ye,xe)=>ge(se,ye,ue,xe))),Q)):("number"==typeof ge&&(Q=ge),Y=>Y.lift(new J(ne,Q)))}class J{constructor(ge,Q=Number.POSITIVE_INFINITY){this.project=ge,this.concurrent=Q}call(ge,Q){return Q.subscribe(new j(ge,this.project,this.concurrent))}}class j extends pe.Ds{constructor(ge,Q,Y=Number.POSITIVE_INFINITY){super(ge),this.project=Q,this.concurrent=Y,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(ge){this.active<this.concurrent?this._tryNext(ge):this.buffer.push(ge)}_tryNext(ge){let Q;const Y=this.index++;try{Q=this.project(ge,Y)}catch(se){return void this.destination.error(se)}this.active++,this._innerSub(Q)}_innerSub(ge){const Q=new pe.IY(this),Y=this.destination;Y.add(Q);const se=(0,pe.ft)(ge,Q);se!==Q&&Y.add(se)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(ge){this.destination.next(ge)}notifyComplete(){const ge=this.buffer;this.active--,ge.length>0?this._next(ge.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}},4327:(An,vt,k)=>{"use strict";k.d(vt,{x:()=>d});var b=k(3489);function d(){return function(j){return j.lift(new pe(j))}}class pe{constructor(j){this.connectable=j}call(j,g){const{connectable:ne}=this;ne._refCount++;const ge=new l(j,ne),Q=g.subscribe(ge);return ge.closed||(ge.connection=ne.connect()),Q}}class l extends b.L{constructor(j,g){super(j),this.connectable=g}_unsubscribe(){const{connectable:j}=this;if(!j)return void(this.connection=null);this.connectable=null;const g=j._refCount;if(g<=0)return void(this.connection=null);if(j._refCount=g-1,g>1)return void(this.connection=null);const{connection:ne}=this,ge=j._connection;this.connection=null,ge&&(!ne||ge===ne)&&ge.unsubscribe()}}},7545:(An,vt,k)=>{"use strict";k.d(vt,{w:()=>l});var b=k(4850),d=k(5254),pe=k(1177);function l(g,ne){return"function"==typeof ne?ge=>ge.pipe(l((Q,Y)=>(0,d.D)(g(Q,Y)).pipe((0,b.U)((se,ue)=>ne(Q,se,Y,ue))))):ge=>ge.lift(new J(g))}class J{constructor(ne){this.project=ne}call(ne,ge){return ge.subscribe(new j(ne,this.project))}}class j extends pe.Ds{constructor(ne,ge){super(ne),this.project=ge,this.index=0}_next(ne){let ge;const Q=this.index++;try{ge=this.project(ne,Q)}catch(Y){return void this.destination.error(Y)}this._innerSub(ge)}_innerSub(ne){const ge=this.innerSubscription;ge&&ge.unsubscribe();const Q=new pe.IY(this),Y=this.destination;Y.add(Q),this.innerSubscription=(0,pe.ft)(ne,Q),this.innerSubscription!==Q&&Y.add(this.innerSubscription)}_complete(){const{innerSubscription:ne}=this;(!ne||ne.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(ne){this.destination.next(ne)}}},2986:(An,vt,k)=>{"use strict";k.d(vt,{q:()=>l});var b=k(3489),d=k(4231),pe=k(8896);function l(g){return ne=>0===g?(0,pe.c)():ne.lift(new J(g))}class J{constructor(ne){if(this.total=ne,this.total<0)throw new d.W}call(ne,ge){return ge.subscribe(new j(ne,this.total))}}class j extends b.L{constructor(ne,ge){super(ne),this.total=ge,this.count=0}_next(ne){const ge=this.total,Q=++this.count;Q<=ge&&(this.destination.next(ne),Q===ge&&(this.destination.complete(),this.unsubscribe()))}}},6454:(An,vt,k)=>{"use strict";k.d(vt,{r:()=>pe});var b=k(2916),d=k(2654);function pe(l,J){return new b.y(j=>{const g=new d.w;let ne=0;return g.add(J.schedule(function(){ne!==l.length?(j.next(l[ne++]),j.closed||g.add(this.schedule())):j.complete()})),g})}},6686:(An,vt,k)=>{"use strict";k.d(vt,{o:()=>pe});var b=k(2654);class d extends b.w{constructor(J,j){super()}schedule(J,j=0){return this}}class pe extends d{constructor(J,j){super(J,j),this.scheduler=J,this.work=j,this.pending=!1}schedule(J,j=0){if(this.closed)return this;this.state=J;const g=this.id,ne=this.scheduler;return null!=g&&(this.id=this.recycleAsyncId(ne,g,j)),this.pending=!0,this.delay=j,this.id=this.id||this.requestAsyncId(ne,this.id,j),this}requestAsyncId(J,j,g=0){return setInterval(J.flush.bind(J,this),g)}recycleAsyncId(J,j,g=0){if(null!==g&&this.delay===g&&!1===this.pending)return j;clearInterval(j)}execute(J,j){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const g=this._execute(J,j);if(g)return g;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(J,j){let ne,g=!1;try{this.work(J)}catch(ge){g=!0,ne=!!ge&&ge||new Error(ge)}if(g)return this.unsubscribe(),ne}_unsubscribe(){const J=this.id,j=this.scheduler,g=j.actions,ne=g.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==ne&&g.splice(ne,1),null!=J&&(this.id=this.recycleAsyncId(j,J,null)),this.delay=null}}},2268:(An,vt,k)=>{"use strict";k.d(vt,{v:()=>d});let b=(()=>{class pe{constructor(J,j=pe.now){this.SchedulerAction=J,this.now=j}schedule(J,j=0,g){return new this.SchedulerAction(this,J).schedule(g,j)}}return pe.now=()=>Date.now(),pe})();class d extends b{constructor(l,J=b.now){super(l,()=>d.delegate&&d.delegate!==this?d.delegate.now():J()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(l,J=0,j){return d.delegate&&d.delegate!==this?d.delegate.schedule(l,J,j):super.schedule(l,J,j)}flush(l){const{actions:J}=this;if(this.active)return void J.push(l);let j;this.active=!0;do{if(j=l.execute(l.state,l.delay))break}while(l=J.shift());if(this.active=!1,j){for(;l=J.shift();)l.unsubscribe();throw j}}}},5430:(An,vt,k)=>{"use strict";k.d(vt,{hZ:()=>d});const d=function b(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},3821:(An,vt,k)=>{"use strict";k.d(vt,{L:()=>b});const b="function"==typeof Symbol&&Symbol.observable||"@@observable"},7668:(An,vt,k)=>{"use strict";k.d(vt,{b:()=>b});const b="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()},4231:(An,vt,k)=>{"use strict";k.d(vt,{W:()=>d});const d=(()=>{function pe(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return pe.prototype=Object.create(Error.prototype),pe})()},5279:(An,vt,k)=>{"use strict";k.d(vt,{N:()=>d});const d=(()=>{function pe(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return pe.prototype=Object.create(Error.prototype),pe})()},2782:(An,vt,k)=>{"use strict";function b(d){setTimeout(()=>{throw d},0)}k.d(vt,{z:()=>b})},5379:(An,vt,k)=>{"use strict";function b(d){return d}k.d(vt,{y:()=>b})},6688:(An,vt,k)=>{"use strict";k.d(vt,{k:()=>b});const b=Array.isArray||(d=>d&&"number"==typeof d.length)},8515:(An,vt,k)=>{"use strict";k.d(vt,{z:()=>b});const b=d=>d&&"number"==typeof d.length&&"function"!=typeof d},7043:(An,vt,k)=>{"use strict";function b(d){return"function"==typeof d}k.d(vt,{m:()=>b})},7830:(An,vt,k)=>{"use strict";function b(d){return null!==d&&"object"==typeof d}k.d(vt,{K:()=>b})},8955:(An,vt,k)=>{"use strict";function b(d){return!!d&&"function"!=typeof d.subscribe&&"function"==typeof d.then}k.d(vt,{t:()=>b})},2866:(An,vt,k)=>{"use strict";function b(d){return d&&"function"==typeof d.schedule}k.d(vt,{K:()=>b})},9249:(An,vt,k)=>{"use strict";k.d(vt,{s:()=>Y});var b=k(3650),d=k(2782),l=k(5430),j=k(3821),ne=k(8515),ge=k(8955),Q=k(7830);const Y=se=>{if(se&&"function"==typeof se[j.L])return(se=>ue=>{const ye=se[j.L]();if("function"!=typeof ye.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return ye.subscribe(ue)})(se);if((0,ne.z)(se))return(0,b.V)(se);if((0,ge.t)(se))return(se=>ue=>(se.then(ye=>{ue.closed||(ue.next(ye),ue.complete())},ye=>ue.error(ye)).then(null,d.z),ue))(se);if(se&&"function"==typeof se[l.hZ])return(se=>ue=>{const ye=se[l.hZ]();for(;;){let xe;try{xe=ye.next()}catch(Ee){return ue.error(Ee),ue}if(xe.done){ue.complete();break}if(ue.next(xe.value),ue.closed)break}return"function"==typeof ye.return&&ue.add(()=>{ye.return&&ye.return()}),ue})(se);{const ye=`You provided ${(0,Q.K)(se)?"an invalid object":`'${se}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(ye)}}},3650:(An,vt,k)=>{"use strict";k.d(vt,{V:()=>b});const b=d=>pe=>{for(let l=0,J=d.length;l<J&&!pe.closed;l++)pe.next(d[l]);pe.complete()}},863:(An,vt,k)=>{var b={"./ion-action-sheet.entry.js":[3648,8592,3648],"./ion-alert.entry.js":[1118,8592,1118],"./ion-app_8.entry.js":[53,8592,53],"./ion-avatar_3.entry.js":[4753,8592,4753],"./ion-back-button.entry.js":[2073,8592,2073],"./ion-backdrop.entry.js":[8939,8939],"./ion-button_2.entry.js":[5652,8592,5652],"./ion-card_5.entry.js":[5929,8592,388],"./ion-checkbox.entry.js":[9922,8592,9922],"./ion-chip.entry.js":[657,8592,657],"./ion-col_3.entry.js":[9824,9824],"./ion-datetime_3.entry.js":[4959,8592,4959],"./ion-fab_3.entry.js":[5836,8592,5836],"./ion-img.entry.js":[1033,1033],"./ion-infinite-scroll_2.entry.js":[8034,8592,8034],"./ion-input.entry.js":[1217,8592,1217],"./ion-item-option_3.entry.js":[2933,8592,2933],"./ion-item_8.entry.js":[4711,8592,4711],"./ion-loading.entry.js":[9434,8592,9434],"./ion-menu_3.entry.js":[8136,8592,8136],"./ion-modal.entry.js":[2349,8592,2349],"./ion-nav_2.entry.js":[5349,8592,5349],"./ion-popover.entry.js":[3804,8592,3804],"./ion-progress-bar.entry.js":[4174,8592,4174],"./ion-radio_2.entry.js":[4432,8592,4432],"./ion-range.entry.js":[3545,8592,1709],"./ion-refresher_2.entry.js":[3326,8592,3326],"./ion-reorder_2.entry.js":[3583,8592,3583],"./ion-ripple-effect.entry.js":[9958,9958],"./ion-route_4.entry.js":[4330,8592,4330],"./ion-searchbar.entry.js":[8628,8592,8628],"./ion-segment_2.entry.js":[9325,8592,9325],"./ion-select_3.entry.js":[2773,8592,2773],"./ion-slide_2.entry.js":[1650,1650],"./ion-spinner.entry.js":[4908,8592,4908],"./ion-split-pane.entry.js":[9536,9536],"./ion-tab-bar_2.entry.js":[438,8592,438],"./ion-tab_2.entry.js":[1536,8592,1536],"./ion-text.entry.js":[4376,8592,4376],"./ion-textarea.entry.js":[6560,8592,6560],"./ion-toast.entry.js":[6120,8592,6120],"./ion-toggle.entry.js":[5168,8592,5168],"./ion-virtual-scroll.entry.js":[2289,2289]};function d(pe){if(!k.o(b,pe))return Promise.resolve().then(()=>{var j=new Error("Cannot find module '"+pe+"'");throw j.code="MODULE_NOT_FOUND",j});var l=b[pe],J=l[0];return Promise.all(l.slice(1).map(k.e)).then(()=>k(J))}d.keys=()=>Object.keys(b),d.id=863,An.exports=d},6099:(An,vt,k)=>{"use strict";function b(pe,l,J,j,g,ne,ge){try{var Q=pe[ne](ge),Y=Q.value}catch(se){return void J(se)}Q.done?l(Y):Promise.resolve(Y).then(j,g)}function d(pe){return function(){var l=this,J=arguments;return new Promise(function(j,g){var ne=pe.apply(l,J);function ge(Y){b(ne,j,g,ge,Q,"next",Y)}function Q(Y){b(ne,j,g,ge,Q,"throw",Y)}ge(void 0)})}}k.d(vt,{Z:()=>d})},6895:(An,vt,k)=>{"use strict";k.d(vt,{mr:()=>Se,ez:()=>Xs,K0:()=>g,uU:()=>nt,JJ:()=>sr,Do:()=>tt,V_:()=>Q,Ye:()=>et,S$:()=>We,sg:()=>Pr,O5:()=>Ie,b0:()=>ze,lw:()=>ne,EM:()=>To,JF:()=>ua,w_:()=>j,bD:()=>ki,q:()=>pe,Mx:()=>xi,HT:()=>J});var b=k(6738);let d=null;function pe(){return d}function J(ee){d||(d=ee)}class j{}const g=new b.OlP("DocumentToken");let ne=(()=>{class ee{historyGo(te){throw new Error("Not implemented")}}return ee.\u0275fac=function(te){return new(te||ee)},ee.\u0275prov=b.Yz7({token:ee,factory:function(){return function ge(){return(0,b.LFG)(Y)}()},providedIn:"platform"}),ee})();const Q=new b.OlP("Location Initialized");let Y=(()=>{class ee extends ne{constructor(te){super(),this._doc=te,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return pe().getBaseHref(this._doc)}onPopState(te){const Ne=pe().getGlobalEventTarget(this._doc,"window");return Ne.addEventListener("popstate",te,!1),()=>Ne.removeEventListener("popstate",te)}onHashChange(te){const Ne=pe().getGlobalEventTarget(this._doc,"window");return Ne.addEventListener("hashchange",te,!1),()=>Ne.removeEventListener("hashchange",te)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(te){this.location.pathname=te}pushState(te,Ne,Dt){se()?this._history.pushState(te,Ne,Dt):this.location.hash=Dt}replaceState(te,Ne,Dt){se()?this._history.replaceState(te,Ne,Dt):this.location.hash=Dt}forward(){this._history.forward()}back(){this._history.back()}historyGo(te=0){this._history.go(te)}getState(){return this._history.state}}return ee.\u0275fac=function(te){return new(te||ee)(b.LFG(g))},ee.\u0275prov=b.Yz7({token:ee,factory:function(){return function ue(){return new Y((0,b.LFG)(g))}()},providedIn:"platform"}),ee})();function se(){return!!window.history.pushState}function ye(ee,Ce){if(0==ee.length)return Ce;if(0==Ce.length)return ee;let te=0;return ee.endsWith("/")&&te++,Ce.startsWith("/")&&te++,2==te?ee+Ce.substring(1):1==te?ee+Ce:ee+"/"+Ce}function xe(ee){const Ce=ee.match(/#|\?|$/),te=Ce&&Ce.index||ee.length;return ee.slice(0,te-("/"===ee[te-1]?1:0))+ee.slice(te)}function Ee(ee){return ee&&"?"!==ee[0]?"?"+ee:ee}let We=(()=>{class ee{historyGo(te){throw new Error("Not implemented")}}return ee.\u0275fac=function(te){return new(te||ee)},ee.\u0275prov=b.Yz7({token:ee,factory:function(){return function be(ee){const Ce=(0,b.LFG)(g).location;return new ze((0,b.LFG)(ne),Ce&&Ce.origin||"")}()},providedIn:"root"}),ee})();const Se=new b.OlP("appBaseHref");let ze=(()=>{class ee extends We{constructor(te,Ne){if(super(),this._platformLocation=te,this._removeListenerFns=[],null==Ne&&(Ne=this._platformLocation.getBaseHrefFromDOM()),null==Ne)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=Ne}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(te){this._removeListenerFns.push(this._platformLocation.onPopState(te),this._platformLocation.onHashChange(te))}getBaseHref(){return this._baseHref}prepareExternalUrl(te){return ye(this._baseHref,te)}path(te=!1){const Ne=this._platformLocation.pathname+Ee(this._platformLocation.search),Dt=this._platformLocation.hash;return Dt&&te?`${Ne}${Dt}`:Ne}pushState(te,Ne,Dt,sn){const Fn=this.prepareExternalUrl(Dt+Ee(sn));this._platformLocation.pushState(te,Ne,Fn)}replaceState(te,Ne,Dt,sn){const Fn=this.prepareExternalUrl(Dt+Ee(sn));this._platformLocation.replaceState(te,Ne,Fn)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(te=0){this._platformLocation.historyGo?.(te)}}return ee.\u0275fac=function(te){return new(te||ee)(b.LFG(ne),b.LFG(Se,8))},ee.\u0275prov=b.Yz7({token:ee,factory:ee.\u0275fac}),ee})(),tt=(()=>{class ee extends We{constructor(te,Ne){super(),this._platformLocation=te,this._baseHref="",this._removeListenerFns=[],null!=Ne&&(this._baseHref=Ne)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(te){this._removeListenerFns.push(this._platformLocation.onPopState(te),this._platformLocation.onHashChange(te))}getBaseHref(){return this._baseHref}path(te=!1){let Ne=this._platformLocation.hash;return null==Ne&&(Ne="#"),Ne.length>0?Ne.substring(1):Ne}prepareExternalUrl(te){const Ne=ye(this._baseHref,te);return Ne.length>0?"#"+Ne:Ne}pushState(te,Ne,Dt,sn){let Fn=this.prepareExternalUrl(Dt+Ee(sn));0==Fn.length&&(Fn=this._platformLocation.pathname),this._platformLocation.pushState(te,Ne,Fn)}replaceState(te,Ne,Dt,sn){let Fn=this.prepareExternalUrl(Dt+Ee(sn));0==Fn.length&&(Fn=this._platformLocation.pathname),this._platformLocation.replaceState(te,Ne,Fn)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(te=0){this._platformLocation.historyGo?.(te)}}return ee.\u0275fac=function(te){return new(te||ee)(b.LFG(ne),b.LFG(Se,8))},ee.\u0275prov=b.Yz7({token:ee,factory:ee.\u0275fac}),ee})(),et=(()=>{class ee{constructor(te,Ne){this._subject=new b.vpe,this._urlChangeListeners=[],this._platformStrategy=te;const Dt=this._platformStrategy.getBaseHref();this._platformLocation=Ne,this._baseHref=xe(Ge(Dt)),this._platformStrategy.onPopState(sn=>{this._subject.emit({url:this.path(!0),pop:!0,state:sn.state,type:sn.type})})}path(te=!1){return this.normalize(this._platformStrategy.path(te))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(te,Ne=""){return this.path()==this.normalize(te+Ee(Ne))}normalize(te){return ee.stripTrailingSlash(function C(ee,Ce){return ee&&Ce.startsWith(ee)?Ce.substring(ee.length):Ce}(this._baseHref,Ge(te)))}prepareExternalUrl(te){return te&&"/"!==te[0]&&(te="/"+te),this._platformStrategy.prepareExternalUrl(te)}go(te,Ne="",Dt=null){this._platformStrategy.pushState(Dt,"",te,Ne),this._notifyUrlChangeListeners(this.prepareExternalUrl(te+Ee(Ne)),Dt)}replaceState(te,Ne="",Dt=null){this._platformStrategy.replaceState(Dt,"",te,Ne),this._notifyUrlChangeListeners(this.prepareExternalUrl(te+Ee(Ne)),Dt)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(te=0){this._platformStrategy.historyGo?.(te)}onUrlChange(te){this._urlChangeListeners.push(te),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(Ne=>{this._notifyUrlChangeListeners(Ne.url,Ne.state)}))}_notifyUrlChangeListeners(te="",Ne){this._urlChangeListeners.forEach(Dt=>Dt(te,Ne))}subscribe(te,Ne,Dt){return this._subject.subscribe({next:te,error:Ne,complete:Dt})}}return ee.normalizeQueryParams=Ee,ee.joinWithSlash=ye,ee.stripTrailingSlash=xe,ee.\u0275fac=function(te){return new(te||ee)(b.LFG(We),b.LFG(ne))},ee.\u0275prov=b.Yz7({token:ee,factory:function(){return function Be(){return new et((0,b.LFG)(We),(0,b.LFG)(ne))}()},providedIn:"root"}),ee})();function Ge(ee){return ee.replace(/\/index.html$/,"")}var ht=(()=>((ht=ht||{})[ht.Decimal=0]="Decimal",ht[ht.Percent=1]="Percent",ht[ht.Currency=2]="Currency",ht[ht.Scientific=3]="Scientific",ht))(),wt=(()=>((wt=wt||{})[wt.Zero=0]="Zero",wt[wt.One=1]="One",wt[wt.Two=2]="Two",wt[wt.Few=3]="Few",wt[wt.Many=4]="Many",wt[wt.Other=5]="Other",wt))(),xt=(()=>((xt=xt||{})[xt.Format=0]="Format",xt[xt.Standalone=1]="Standalone",xt))(),gt=(()=>((gt=gt||{})[gt.Narrow=0]="Narrow",gt[gt.Abbreviated=1]="Abbreviated",gt[gt.Wide=2]="Wide",gt[gt.Short=3]="Short",gt))(),Bt=(()=>((Bt=Bt||{})[Bt.Short=0]="Short",Bt[Bt.Medium=1]="Medium",Bt[Bt.Long=2]="Long",Bt[Bt.Full=3]="Full",Bt))(),Ht=(()=>((Ht=Ht||{})[Ht.Decimal=0]="Decimal",Ht[Ht.Group=1]="Group",Ht[Ht.List=2]="List",Ht[Ht.PercentSign=3]="PercentSign",Ht[Ht.PlusSign=4]="PlusSign",Ht[Ht.MinusSign=5]="MinusSign",Ht[Ht.Exponential=6]="Exponential",Ht[Ht.SuperscriptingExponent=7]="SuperscriptingExponent",Ht[Ht.PerMille=8]="PerMille",Ht[Ht.Infinity=9]="Infinity",Ht[Ht.NaN=10]="NaN",Ht[Ht.TimeSeparator=11]="TimeSeparator",Ht[Ht.CurrencyDecimal=12]="CurrencyDecimal",Ht[Ht.CurrencyGroup=13]="CurrencyGroup",Ht))();function xn(ee,Ce){return gi((0,b.cg1)(ee)[b.wAp.DateFormat],Ce)}function an(ee,Ce){return gi((0,b.cg1)(ee)[b.wAp.TimeFormat],Ce)}function Kt(ee,Ce){return gi((0,b.cg1)(ee)[b.wAp.DateTimeFormat],Ce)}function mt(ee,Ce){const te=(0,b.cg1)(ee),Ne=te[b.wAp.NumberSymbols][Ce];if(void 0===Ne){if(Ce===Ht.CurrencyDecimal)return te[b.wAp.NumberSymbols][Ht.Decimal];if(Ce===Ht.CurrencyGroup)return te[b.wAp.NumberSymbols][Ht.Group]}return Ne}const $i=b.kL8;function rr(ee){if(!ee[b.wAp.ExtraData])throw new Error(`Missing extra locale data for the locale "${ee[b.wAp.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function gi(ee,Ce){for(let te=Ce;te>-1;te--)if(void 0!==ee[te])return ee[te];throw new Error("Locale data API: locale data undefined")}function Ti(ee){const[Ce,te]=ee.split(":");return{hours:+Ce,minutes:+te}}const Re=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,lt={},Le=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Rt=(()=>((Rt=Rt||{})[Rt.Short=0]="Short",Rt[Rt.ShortGMT=1]="ShortGMT",Rt[Rt.Long=2]="Long",Rt[Rt.Extended=3]="Extended",Rt))(),me=(()=>((me=me||{})[me.FullYear=0]="FullYear",me[me.Month=1]="Month",me[me.Date=2]="Date",me[me.Hours=3]="Hours",me[me.Minutes=4]="Minutes",me[me.Seconds=5]="Seconds",me[me.FractionalSeconds=6]="FractionalSeconds",me[me.Day=7]="Day",me))(),He=(()=>((He=He||{})[He.DayPeriods=0]="DayPeriods",He[He.Days=1]="Days",He[He.Months=2]="Months",He[He.Eras=3]="Eras",He))();function Ft(ee,Ce,te,Ne){let Dt=function pt(ee){if(Je(ee))return ee;if("number"==typeof ee&&!isNaN(ee))return new Date(ee);if("string"==typeof ee){if(ee=ee.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(ee)){const[Dt,sn=1,Fn=1]=ee.split("-").map(Hn=>+Hn);return Qt(Dt,sn-1,Fn)}const te=parseFloat(ee);if(!isNaN(ee-te))return new Date(te);let Ne;if(Ne=ee.match(Re))return function Ct(ee){const Ce=new Date(0);let te=0,Ne=0;const Dt=ee[8]?Ce.setUTCFullYear:Ce.setFullYear,sn=ee[8]?Ce.setUTCHours:Ce.setHours;ee[9]&&(te=Number(ee[9]+ee[10]),Ne=Number(ee[9]+ee[11])),Dt.call(Ce,Number(ee[1]),Number(ee[2])-1,Number(ee[3]));const Fn=Number(ee[4]||0)-te,Hn=Number(ee[5]||0)-Ne,Fr=Number(ee[6]||0),Er=Math.floor(1e3*parseFloat("0."+(ee[7]||0)));return sn.call(Ce,Fn,Hn,Fr,Er),Ce}(Ne)}const Ce=new Date(ee);if(!Je(Ce))throw new Error(`Unable to convert "${ee}" into a date`);return Ce}(ee);Ce=Jn(te,Ce)||Ce;let Hn,Fn=[];for(;Ce;){if(Hn=Le.exec(Ce),!Hn){Fn.push(Ce);break}{Fn=Fn.concat(Hn.slice(1));const Fi=Fn.pop();if(!Fi)break;Ce=Fi}}let Fr=Dt.getTimezoneOffset();Ne&&(Fr=de(Ne,Fr),Dt=function Ye(ee,Ce,te){const Ne=te?-1:1,Dt=ee.getTimezoneOffset();return function we(ee,Ce){return(ee=new Date(ee.getTime())).setMinutes(ee.getMinutes()+Ce),ee}(ee,Ne*(de(Ce,Dt)-Dt))}(Dt,Ne,!0));let Er="";return Fn.forEach(Fi=>{const mr=function L(ee){if(q[ee])return q[ee];let Ce;switch(ee){case"G":case"GG":case"GGG":Ce=Ii(He.Eras,gt.Abbreviated);break;case"GGGG":Ce=Ii(He.Eras,gt.Wide);break;case"GGGGG":Ce=Ii(He.Eras,gt.Narrow);break;case"y":Ce=ci(me.FullYear,1,0,!1,!0);break;case"yy":Ce=ci(me.FullYear,2,0,!0,!0);break;case"yyy":Ce=ci(me.FullYear,3,0,!1,!0);break;case"yyyy":Ce=ci(me.FullYear,4,0,!1,!0);break;case"Y":Ce=K(1);break;case"YY":Ce=K(2,!0);break;case"YYY":Ce=K(3);break;case"YYYY":Ce=K(4);break;case"M":case"L":Ce=ci(me.Month,1,1);break;case"MM":case"LL":Ce=ci(me.Month,2,1);break;case"MMM":Ce=Ii(He.Months,gt.Abbreviated);break;case"MMMM":Ce=Ii(He.Months,gt.Wide);break;case"MMMMM":Ce=Ii(He.Months,gt.Narrow);break;case"LLL":Ce=Ii(He.Months,gt.Abbreviated,xt.Standalone);break;case"LLLL":Ce=Ii(He.Months,gt.Wide,xt.Standalone);break;case"LLLLL":Ce=Ii(He.Months,gt.Narrow,xt.Standalone);break;case"w":Ce=Oi(1);break;case"ww":Ce=Oi(2);break;case"W":Ce=Oi(1,!0);break;case"d":Ce=ci(me.Date,1);break;case"dd":Ce=ci(me.Date,2);break;case"c":case"cc":Ce=ci(me.Day,1);break;case"ccc":Ce=Ii(He.Days,gt.Abbreviated,xt.Standalone);break;case"cccc":Ce=Ii(He.Days,gt.Wide,xt.Standalone);break;case"ccccc":Ce=Ii(He.Days,gt.Narrow,xt.Standalone);break;case"cccccc":Ce=Ii(He.Days,gt.Short,xt.Standalone);break;case"E":case"EE":case"EEE":Ce=Ii(He.Days,gt.Abbreviated);break;case"EEEE":Ce=Ii(He.Days,gt.Wide);break;case"EEEEE":Ce=Ii(He.Days,gt.Narrow);break;case"EEEEEE":Ce=Ii(He.Days,gt.Short);break;case"a":case"aa":case"aaa":Ce=Ii(He.DayPeriods,gt.Abbreviated);break;case"aaaa":Ce=Ii(He.DayPeriods,gt.Wide);break;case"aaaaa":Ce=Ii(He.DayPeriods,gt.Narrow);break;case"b":case"bb":case"bbb":Ce=Ii(He.DayPeriods,gt.Abbreviated,xt.Standalone,!0);break;case"bbbb":Ce=Ii(He.DayPeriods,gt.Wide,xt.Standalone,!0);break;case"bbbbb":Ce=Ii(He.DayPeriods,gt.Narrow,xt.Standalone,!0);break;case"B":case"BB":case"BBB":Ce=Ii(He.DayPeriods,gt.Abbreviated,xt.Format,!0);break;case"BBBB":Ce=Ii(He.DayPeriods,gt.Wide,xt.Format,!0);break;case"BBBBB":Ce=Ii(He.DayPeriods,gt.Narrow,xt.Format,!0);break;case"h":Ce=ci(me.Hours,1,-12);break;case"hh":Ce=ci(me.Hours,2,-12);break;case"H":Ce=ci(me.Hours,1);break;case"HH":Ce=ci(me.Hours,2);break;case"m":Ce=ci(me.Minutes,1);break;case"mm":Ce=ci(me.Minutes,2);break;case"s":Ce=ci(me.Seconds,1);break;case"ss":Ce=ci(me.Seconds,2);break;case"S":Ce=ci(me.FractionalSeconds,1);break;case"SS":Ce=ci(me.FractionalSeconds,2);break;case"SSS":Ce=ci(me.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":Ce=yi(Rt.Short);break;case"ZZZZZ":Ce=yi(Rt.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":Ce=yi(Rt.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":Ce=yi(Rt.Long);break;default:return null}return q[ee]=Ce,Ce}(Fi);Er+=mr?mr(Dt,te,Fr):"''"===Fi?"'":Fi.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),Er}function Qt(ee,Ce,te){const Ne=new Date(0);return Ne.setFullYear(ee,Ce,te),Ne.setHours(0,0,0),Ne}function Jn(ee,Ce){const te=function It(ee){return(0,b.cg1)(ee)[b.wAp.LocaleId]}(ee);if(lt[te]=lt[te]||{},lt[te][Ce])return lt[te][Ce];let Ne="";switch(Ce){case"shortDate":Ne=xn(ee,Bt.Short);break;case"mediumDate":Ne=xn(ee,Bt.Medium);break;case"longDate":Ne=xn(ee,Bt.Long);break;case"fullDate":Ne=xn(ee,Bt.Full);break;case"shortTime":Ne=an(ee,Bt.Short);break;case"mediumTime":Ne=an(ee,Bt.Medium);break;case"longTime":Ne=an(ee,Bt.Long);break;case"fullTime":Ne=an(ee,Bt.Full);break;case"short":const Dt=Jn(ee,"shortTime"),sn=Jn(ee,"shortDate");Ne=Ki(Kt(ee,Bt.Short),[Dt,sn]);break;case"medium":const Fn=Jn(ee,"mediumTime"),Hn=Jn(ee,"mediumDate");Ne=Ki(Kt(ee,Bt.Medium),[Fn,Hn]);break;case"long":const Fr=Jn(ee,"longTime"),Er=Jn(ee,"longDate");Ne=Ki(Kt(ee,Bt.Long),[Fr,Er]);break;case"full":const Fi=Jn(ee,"fullTime"),mr=Jn(ee,"fullDate");Ne=Ki(Kt(ee,Bt.Full),[Fi,mr])}return Ne&&(lt[te][Ce]=Ne),Ne}function Ki(ee,Ce){return Ce&&(ee=ee.replace(/\{([^}]+)}/g,function(te,Ne){return null!=Ce&&Ne in Ce?Ce[Ne]:te})),ee}function Di(ee,Ce,te="-",Ne,Dt){let sn="";(ee<0||Dt&&ee<=0)&&(Dt?ee=1-ee:(ee=-ee,sn=te));let Fn=String(ee);for(;Fn.length<Ce;)Fn="0"+Fn;return Ne&&(Fn=Fn.substr(Fn.length-Ce)),sn+Fn}function ci(ee,Ce,te=0,Ne=!1,Dt=!1){return function(sn,Fn){let Hn=function xr(ee,Ce){switch(ee){case me.FullYear:return Ce.getFullYear();case me.Month:return Ce.getMonth();case me.Date:return Ce.getDate();case me.Hours:return Ce.getHours();case me.Minutes:return Ce.getMinutes();case me.Seconds:return Ce.getSeconds();case me.FractionalSeconds:return Ce.getMilliseconds();case me.Day:return Ce.getDay();default:throw new Error(`Unknown DateType value "${ee}".`)}}(ee,sn);if((te>0||Hn>-te)&&(Hn+=te),ee===me.Hours)0===Hn&&-12===te&&(Hn=12);else if(ee===me.FractionalSeconds)return function mi(ee,Ce){return Di(ee,3).substr(0,Ce)}(Hn,Ce);const Fr=mt(Fn,Ht.MinusSign);return Di(Hn,Ce,Fr,Ne,Dt)}}function Ii(ee,Ce,te=xt.Format,Ne=!1){return function(Dt,sn){return function hr(ee,Ce,te,Ne,Dt,sn){switch(te){case He.Months:return function Yt(ee,Ce,te){const Ne=(0,b.cg1)(ee),sn=gi([Ne[b.wAp.MonthsFormat],Ne[b.wAp.MonthsStandalone]],Ce);return gi(sn,te)}(Ce,Dt,Ne)[ee.getMonth()];case He.Days:return function Ut(ee,Ce,te){const Ne=(0,b.cg1)(ee),sn=gi([Ne[b.wAp.DaysFormat],Ne[b.wAp.DaysStandalone]],Ce);return gi(sn,te)}(Ce,Dt,Ne)[ee.getDay()];case He.DayPeriods:const Fn=ee.getHours(),Hn=ee.getMinutes();if(sn){const Er=function Bi(ee){const Ce=(0,b.cg1)(ee);return rr(Ce),(Ce[b.wAp.ExtraData][2]||[]).map(Ne=>"string"==typeof Ne?Ti(Ne):[Ti(Ne[0]),Ti(Ne[1])])}(Ce),Fi=function _i(ee,Ce,te){const Ne=(0,b.cg1)(ee);rr(Ne);const sn=gi([Ne[b.wAp.ExtraData][0],Ne[b.wAp.ExtraData][1]],Ce)||[];return gi(sn,te)||[]}(Ce,Dt,Ne),mr=Er.findIndex(co=>{if(Array.isArray(co)){const[ie,W]=co,H=Fn>=ie.hours&&Hn>=ie.minutes,Fe=Fn<W.hours||Fn===W.hours&&Hn<W.minutes;if(ie.hours<W.hours){if(H&&Fe)return!0}else if(H||Fe)return!0}else if(co.hours===Fn&&co.minutes===Hn)return!0;return!1});if(-1!==mr)return Fi[mr]}return function jt(ee,Ce,te){const Ne=(0,b.cg1)(ee),sn=gi([Ne[b.wAp.DayPeriodsFormat],Ne[b.wAp.DayPeriodsStandalone]],Ce);return gi(sn,te)}(Ce,Dt,Ne)[Fn<12?0:1];case He.Eras:return function zt(ee,Ce){return gi((0,b.cg1)(ee)[b.wAp.Eras],Ce)}(Ce,Ne)[ee.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${te}`)}}(Dt,sn,ee,Ce,te,Ne)}}function yi(ee){return function(Ce,te,Ne){const Dt=-1*Ne,sn=mt(te,Ht.MinusSign),Fn=Dt>0?Math.floor(Dt/60):Math.ceil(Dt/60);switch(ee){case Rt.Short:return(Dt>=0?"+":"")+Di(Fn,2,sn)+Di(Math.abs(Dt%60),2,sn);case Rt.ShortGMT:return"GMT"+(Dt>=0?"+":"")+Di(Fn,1,sn);case Rt.Long:return"GMT"+(Dt>=0?"+":"")+Di(Fn,2,sn)+":"+Di(Math.abs(Dt%60),2,sn);case Rt.Extended:return 0===Ne?"Z":(Dt>=0?"+":"")+Di(Fn,2,sn)+":"+Di(Math.abs(Dt%60),2,sn);default:throw new Error(`Unknown zone width "${ee}"`)}}}function Ci(ee){return Qt(ee.getFullYear(),ee.getMonth(),ee.getDate()+(4-ee.getDay()))}function Oi(ee,Ce=!1){return function(te,Ne){let Dt;if(Ce){const sn=new Date(te.getFullYear(),te.getMonth(),1).getDay()-1,Fn=te.getDate();Dt=1+Math.floor((Fn+sn)/7)}else{const sn=Ci(te),Fn=function Tr(ee){const Ce=Qt(ee,0,1).getDay();return Qt(ee,0,1+(Ce<=4?4:11)-Ce)}(sn.getFullYear()),Hn=sn.getTime()-Fn.getTime();Dt=1+Math.round(Hn/6048e5)}return Di(Dt,ee,mt(Ne,Ht.MinusSign))}}function K(ee,Ce=!1){return function(te,Ne){return Di(Ci(te).getFullYear(),ee,mt(Ne,Ht.MinusSign),Ce)}}const q={};function de(ee,Ce){ee=ee.replace(/:/g,"");const te=Date.parse("Jan 01, 1970 00:00:00 "+ee)/6e4;return isNaN(te)?Ce:te}function Je(ee){return ee instanceof Date&&!isNaN(ee.valueOf())}const Lt=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function oi(ee){const Ce=parseInt(ee);if(isNaN(Ce))throw new Error("Invalid integer literal when parsing "+ee);return Ce}class fr{}let Sr=(()=>{class ee extends fr{constructor(te){super(),this.locale=te}getPluralCategory(te,Ne){switch($i(Ne||this.locale)(te)){case wt.Zero:return"zero";case wt.One:return"one";case wt.Two:return"two";case wt.Few:return"few";case wt.Many:return"many";default:return"other"}}}return ee.\u0275fac=function(te){return new(te||ee)(b.LFG(b.soG))},ee.\u0275prov=b.Yz7({token:ee,factory:ee.\u0275fac}),ee})();function xi(ee,Ce){Ce=encodeURIComponent(Ce);for(const te of ee.split(";")){const Ne=te.indexOf("="),[Dt,sn]=-1==Ne?[te,""]:[te.slice(0,Ne),te.slice(Ne+1)];if(Dt.trim()===Ce)return decodeURIComponent(sn)}return null}class jr{constructor(Ce,te,Ne,Dt){this.$implicit=Ce,this.ngForOf=te,this.index=Ne,this.count=Dt}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Pr=(()=>{class ee{constructor(te,Ne,Dt){this._viewContainer=te,this._template=Ne,this._differs=Dt,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(te){this._ngForOf=te,this._ngForOfDirty=!0}set ngForTrackBy(te){this._trackByFn=te}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(te){te&&(this._template=te)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const te=this._ngForOf;!this._differ&&te&&(this._differ=this._differs.find(te).create(this.ngForTrackBy))}if(this._differ){const te=this._differ.diff(this._ngForOf);te&&this._applyChanges(te)}}_applyChanges(te){const Ne=this._viewContainer;te.forEachOperation((Dt,sn,Fn)=>{if(null==Dt.previousIndex)Ne.createEmbeddedView(this._template,new jr(Dt.item,this._ngForOf,-1,-1),null===Fn?void 0:Fn);else if(null==Fn)Ne.remove(null===sn?void 0:sn);else if(null!==sn){const Hn=Ne.get(sn);Ne.move(Hn,Fn),Cr(Hn,Dt)}});for(let Dt=0,sn=Ne.length;Dt<sn;Dt++){const Hn=Ne.get(Dt).context;Hn.index=Dt,Hn.count=sn,Hn.ngForOf=this._ngForOf}te.forEachIdentityChange(Dt=>{Cr(Ne.get(Dt.currentIndex),Dt)})}static ngTemplateContextGuard(te,Ne){return!0}}return ee.\u0275fac=function(te){return new(te||ee)(b.Y36(b.s_b),b.Y36(b.Rgc),b.Y36(b.ZZ4))},ee.\u0275dir=b.lG2({type:ee,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),ee})();function Cr(ee,Ce){ee.context.$implicit=Ce.item}let Ie=(()=>{class ee{constructor(te,Ne){this._viewContainer=te,this._context=new _e,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=Ne}set ngIf(te){this._context.$implicit=this._context.ngIf=te,this._updateView()}set ngIfThen(te){qe("ngIfThen",te),this._thenTemplateRef=te,this._thenViewRef=null,this._updateView()}set ngIfElse(te){qe("ngIfElse",te),this._elseTemplateRef=te,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(te,Ne){return!0}}return ee.\u0275fac=function(te){return new(te||ee)(b.Y36(b.s_b),b.Y36(b.Rgc))},ee.\u0275dir=b.lG2({type:ee,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),ee})();class _e{constructor(){this.$implicit=null,this.ngIf=null}}function qe(ee,Ce){if(Ce&&!Ce.createEmbeddedView)throw new Error(`${ee} must be a TemplateRef, but received '${(0,b.AaK)(Ce)}'.`)}function Ri(ee,Ce){return new b.vHH(2100,"")}const Lo=new b.OlP("DATE_PIPE_DEFAULT_TIMEZONE");let nt=(()=>{class ee{constructor(te,Ne){this.locale=te,this.defaultTimezone=Ne}transform(te,Ne="mediumDate",Dt,sn){if(null==te||""===te||te!=te)return null;try{return Ft(te,Ne,sn||this.locale,Dt??this.defaultTimezone??void 0)}catch(Fn){throw Ri()}}}return ee.\u0275fac=function(te){return new(te||ee)(b.Y36(b.soG,16),b.Y36(Lo,24))},ee.\u0275pipe=b.Yjl({name:"date",type:ee,pure:!0}),ee})(),sr=(()=>{class ee{constructor(te){this._locale=te}transform(te,Ne,Dt){if(!function Is(ee){return!(null==ee||""===ee||ee!=ee)}(te))return null;Dt=Dt||this._locale;try{return function En(ee,Ce,te){return function Li(ee,Ce,te,Ne,Dt,sn,Fn=!1){let Hn="",Fr=!1;if(isFinite(ee)){let Er=function Ni(ee){let Ne,Dt,sn,Fn,Hn,Ce=Math.abs(ee)+"",te=0;for((Dt=Ce.indexOf("."))>-1&&(Ce=Ce.replace(".","")),(sn=Ce.search(/e/i))>0?(Dt<0&&(Dt=sn),Dt+=+Ce.slice(sn+1),Ce=Ce.substring(0,sn)):Dt<0&&(Dt=Ce.length),sn=0;"0"===Ce.charAt(sn);sn++);if(sn===(Hn=Ce.length))Ne=[0],Dt=1;else{for(Hn--;"0"===Ce.charAt(Hn);)Hn--;for(Dt-=sn,Ne=[],Fn=0;sn<=Hn;sn++,Fn++)Ne[Fn]=Number(Ce.charAt(sn))}return Dt>22&&(Ne=Ne.splice(0,21),te=Dt-1,Dt=1),{digits:Ne,exponent:te,integerLen:Dt}}(ee);Fn&&(Er=function Yi(ee){if(0===ee.digits[0])return ee;const Ce=ee.digits.length-ee.integerLen;return ee.exponent?ee.exponent+=2:(0===Ce?ee.digits.push(0,0):1===Ce&&ee.digits.push(0),ee.integerLen+=2),ee}(Er));let Fi=Ce.minInt,mr=Ce.minFrac,co=Ce.maxFrac;if(sn){const ei=sn.match(Lt);if(null===ei)throw new Error(`${sn} is not a valid digit info`);const Or=ei[1],Rr=ei[3],Ko=ei[5];null!=Or&&(Fi=oi(Or)),null!=Rr&&(mr=oi(Rr)),null!=Ko?co=oi(Ko):null!=Rr&&mr>co&&(co=mr)}!function pr(ee,Ce,te){if(Ce>te)throw new Error(`The minimum number of digits after fraction (${Ce}) is higher than the maximum (${te}).`);let Ne=ee.digits,Dt=Ne.length-ee.integerLen;const sn=Math.min(Math.max(Ce,Dt),te);let Fn=sn+ee.integerLen,Hn=Ne[Fn];if(Fn>0){Ne.splice(Math.max(ee.integerLen,Fn));for(let mr=Fn;mr<Ne.length;mr++)Ne[mr]=0}else{Dt=Math.max(0,Dt),ee.integerLen=1,Ne.length=Math.max(1,Fn=sn+1),Ne[0]=0;for(let mr=1;mr<Fn;mr++)Ne[mr]=0}if(Hn>=5)if(Fn-1<0){for(let mr=0;mr>Fn;mr--)Ne.unshift(0),ee.integerLen++;Ne.unshift(1),ee.integerLen++}else Ne[Fn-1]++;for(;Dt<Math.max(0,sn);Dt++)Ne.push(0);let Fr=0!==sn;const Er=Ce+ee.integerLen,Fi=Ne.reduceRight(function(mr,co,ie,W){return W[ie]=(co+=mr)<10?co:co-10,Fr&&(0===W[ie]&&ie>=Er?W.pop():Fr=!1),co>=10?1:0},0);Fi&&(Ne.unshift(Fi),ee.integerLen++)}(Er,mr,co);let ie=Er.digits,W=Er.integerLen;const H=Er.exponent;let Fe=[];for(Fr=ie.every(ei=>!ei);W<Fi;W++)ie.unshift(0);for(;W<0;W++)ie.unshift(0);W>0?Fe=ie.splice(W,ie.length):(Fe=ie,ie=[0]);const dn=[];for(ie.length>=Ce.lgSize&&dn.unshift(ie.splice(-Ce.lgSize,ie.length).join(""));ie.length>Ce.gSize;)dn.unshift(ie.splice(-Ce.gSize,ie.length).join(""));ie.length&&dn.unshift(ie.join("")),Hn=dn.join(mt(te,Ne)),Fe.length&&(Hn+=mt(te,Dt)+Fe.join("")),H&&(Hn+=mt(te,Ht.Exponential)+"+"+H)}else Hn=mt(te,Ht.Infinity);return Hn=ee<0&&!Fr?Ce.negPre+Hn+Ce.negSuf:Ce.posPre+Hn+Ce.posSuf,Hn}(ee,function ti(ee,Ce="-"){const te={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},Ne=ee.split(";"),Dt=Ne[0],sn=Ne[1],Fn=-1!==Dt.indexOf(".")?Dt.split("."):[Dt.substring(0,Dt.lastIndexOf("0")+1),Dt.substring(Dt.lastIndexOf("0")+1)],Hn=Fn[0],Fr=Fn[1]||"";te.posPre=Hn.substr(0,Hn.indexOf("#"));for(let Fi=0;Fi<Fr.length;Fi++){const mr=Fr.charAt(Fi);"0"===mr?te.minFrac=te.maxFrac=Fi+1:"#"===mr?te.maxFrac=Fi+1:te.posSuf+=mr}const Er=Hn.split(",");if(te.gSize=Er[1]?Er[1].length:0,te.lgSize=Er[2]||Er[1]?(Er[2]||Er[1]).length:0,sn){const Fi=Dt.length-te.posPre.length-te.posSuf.length,mr=sn.indexOf("#");te.negPre=sn.substr(0,mr).replace(/'/g,""),te.negSuf=sn.substr(mr+Fi).replace(/'/g,"")}else te.negPre=Ce+te.posPre,te.negSuf=te.posSuf;return te}(function Wt(ee,Ce){return(0,b.cg1)(ee)[b.wAp.NumberFormats][Ce]}(Ce,ht.Decimal),mt(Ce,Ht.MinusSign)),Ce,Ht.Group,Ht.Decimal,te)}(function Bo(ee){if("string"==typeof ee&&!isNaN(Number(ee)-parseFloat(ee)))return Number(ee);if("number"!=typeof ee)throw new Error(`${ee} is not a number`);return ee}(te),Dt,Ne)}catch(sn){throw Ri()}}}return ee.\u0275fac=function(te){return new(te||ee)(b.Y36(b.soG,16))},ee.\u0275pipe=b.Yjl({name:"number",type:ee,pure:!0}),ee})();let Xs=(()=>{class ee{}return ee.\u0275fac=function(te){return new(te||ee)},ee.\u0275mod=b.oAB({type:ee}),ee.\u0275inj=b.cJS({providers:[{provide:fr,useClass:Sr}]}),ee})();const ki="browser";let To=(()=>{class ee{}return ee.\u0275prov=(0,b.Yz7)({token:ee,providedIn:"root",factory:()=>new Co((0,b.LFG)(g),window)}),ee})();class Co{constructor(Ce,te){this.document=Ce,this.window=te,this.offset=()=>[0,0]}setOffset(Ce){this.offset=Array.isArray(Ce)?()=>Ce:Ce}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(Ce){this.supportsScrolling()&&this.window.scrollTo(Ce[0],Ce[1])}scrollToAnchor(Ce){if(!this.supportsScrolling())return;const te=function So(ee,Ce){const te=ee.getElementById(Ce)||ee.getElementsByName(Ce)[0];if(te)return te;if("function"==typeof ee.createTreeWalker&&ee.body&&(ee.body.createShadowRoot||ee.body.attachShadow)){const Ne=ee.createTreeWalker(ee.body,NodeFilter.SHOW_ELEMENT);let Dt=Ne.currentNode;for(;Dt;){const sn=Dt.shadowRoot;if(sn){const Fn=sn.getElementById(Ce)||sn.querySelector(`[name="${Ce}"]`);if(Fn)return Fn}Dt=Ne.nextNode()}}return null}(this.document,Ce);te&&(this.scrollToElement(te),te.focus())}setHistoryScrollRestoration(Ce){if(this.supportScrollRestoration()){const te=this.window.history;te&&te.scrollRestoration&&(te.scrollRestoration=Ce)}}scrollToElement(Ce){const te=Ce.getBoundingClientRect(),Ne=te.left+this.window.pageXOffset,Dt=te.top+this.window.pageYOffset,sn=this.offset();this.window.scrollTo(Ne-sn[0],Dt-sn[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const Ce=No(this.window.history)||No(Object.getPrototypeOf(this.window.history));return!(!Ce||!Ce.writable&&!Ce.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function No(ee){return Object.getOwnPropertyDescriptor(ee,"scrollRestoration")}class ua{}},529:(An,vt,k)=>{"use strict";k.d(vt,{TP:()=>It,eN:()=>Ht,JF:()=>gi,WM:()=>Q});var b=k(6895),d=k(6738),pe=k(1086),l=k(2916),J=k(1406),j=k(2198),g=k(4850);class ne{}class ge{}class Q{constructor(ae){this.normalizedNames=new Map,this.lazyUpdate=null,ae?this.lazyInit="string"==typeof ae?()=>{this.headers=new Map,ae.split("\n").forEach(Re=>{const lt=Re.indexOf(":");if(lt>0){const Le=Re.slice(0,lt),Rt=Le.toLowerCase(),me=Re.slice(lt+1).trim();this.maybeSetNormalizedName(Le,Rt),this.headers.has(Rt)?this.headers.get(Rt).push(me):this.headers.set(Rt,[me])}})}:()=>{this.headers=new Map,Object.keys(ae).forEach(Re=>{let lt=ae[Re];const Le=Re.toLowerCase();"string"==typeof lt&&(lt=[lt]),lt.length>0&&(this.headers.set(Le,lt),this.maybeSetNormalizedName(Re,Le))})}:this.headers=new Map}has(ae){return this.init(),this.headers.has(ae.toLowerCase())}get(ae){this.init();const Re=this.headers.get(ae.toLowerCase());return Re&&Re.length>0?Re[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(ae){return this.init(),this.headers.get(ae.toLowerCase())||null}append(ae,Re){return this.clone({name:ae,value:Re,op:"a"})}set(ae,Re){return this.clone({name:ae,value:Re,op:"s"})}delete(ae,Re){return this.clone({name:ae,value:Re,op:"d"})}maybeSetNormalizedName(ae,Re){this.normalizedNames.has(Re)||this.normalizedNames.set(Re,ae)}init(){this.lazyInit&&(this.lazyInit instanceof Q?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(ae=>this.applyUpdate(ae)),this.lazyUpdate=null))}copyFrom(ae){ae.init(),Array.from(ae.headers.keys()).forEach(Re=>{this.headers.set(Re,ae.headers.get(Re)),this.normalizedNames.set(Re,ae.normalizedNames.get(Re))})}clone(ae){const Re=new Q;return Re.lazyInit=this.lazyInit&&this.lazyInit instanceof Q?this.lazyInit:this,Re.lazyUpdate=(this.lazyUpdate||[]).concat([ae]),Re}applyUpdate(ae){const Re=ae.name.toLowerCase();switch(ae.op){case"a":case"s":let lt=ae.value;if("string"==typeof lt&&(lt=[lt]),0===lt.length)return;this.maybeSetNormalizedName(ae.name,Re);const Le=("a"===ae.op?this.headers.get(Re):void 0)||[];Le.push(...lt),this.headers.set(Re,Le);break;case"d":const Rt=ae.value;if(Rt){let me=this.headers.get(Re);if(!me)return;me=me.filter(He=>-1===Rt.indexOf(He)),0===me.length?(this.headers.delete(Re),this.normalizedNames.delete(Re)):this.headers.set(Re,me)}else this.headers.delete(Re),this.normalizedNames.delete(Re)}}forEach(ae){this.init(),Array.from(this.normalizedNames.keys()).forEach(Re=>ae(this.normalizedNames.get(Re),this.headers.get(Re)))}}class Y{encodeKey(ae){return xe(ae)}encodeValue(ae){return xe(ae)}decodeKey(ae){return decodeURIComponent(ae)}decodeValue(ae){return decodeURIComponent(ae)}}const ue=/%(\d[a-f0-9])/gi,ye={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function xe(Oe){return encodeURIComponent(Oe).replace(ue,(ae,Re)=>ye[Re]??ae)}function Ee(Oe){return`${Oe}`}class We{constructor(ae={}){if(this.updates=null,this.cloneFrom=null,this.encoder=ae.encoder||new Y,ae.fromString){if(ae.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function se(Oe,ae){const Re=new Map;return Oe.length>0&&Oe.replace(/^\?/,"").split("&").forEach(Le=>{const Rt=Le.indexOf("="),[me,He]=-1==Rt?[ae.decodeKey(Le),""]:[ae.decodeKey(Le.slice(0,Rt)),ae.decodeValue(Le.slice(Rt+1))],Ft=Re.get(me)||[];Ft.push(He),Re.set(me,Ft)}),Re}(ae.fromString,this.encoder)}else ae.fromObject?(this.map=new Map,Object.keys(ae.fromObject).forEach(Re=>{const lt=ae.fromObject[Re];this.map.set(Re,Array.isArray(lt)?lt:[lt])})):this.map=null}has(ae){return this.init(),this.map.has(ae)}get(ae){this.init();const Re=this.map.get(ae);return Re?Re[0]:null}getAll(ae){return this.init(),this.map.get(ae)||null}keys(){return this.init(),Array.from(this.map.keys())}append(ae,Re){return this.clone({param:ae,value:Re,op:"a"})}appendAll(ae){const Re=[];return Object.keys(ae).forEach(lt=>{const Le=ae[lt];Array.isArray(Le)?Le.forEach(Rt=>{Re.push({param:lt,value:Rt,op:"a"})}):Re.push({param:lt,value:Le,op:"a"})}),this.clone(Re)}set(ae,Re){return this.clone({param:ae,value:Re,op:"s"})}delete(ae,Re){return this.clone({param:ae,value:Re,op:"d"})}toString(){return this.init(),this.keys().map(ae=>{const Re=this.encoder.encodeKey(ae);return this.map.get(ae).map(lt=>Re+"="+this.encoder.encodeValue(lt)).join("&")}).filter(ae=>""!==ae).join("&")}clone(ae){const Re=new We({encoder:this.encoder});return Re.cloneFrom=this.cloneFrom||this,Re.updates=(this.updates||[]).concat(ae),Re}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(ae=>this.map.set(ae,this.cloneFrom.map.get(ae))),this.updates.forEach(ae=>{switch(ae.op){case"a":case"s":const Re=("a"===ae.op?this.map.get(ae.param):void 0)||[];Re.push(Ee(ae.value)),this.map.set(ae.param,Re);break;case"d":if(void 0===ae.value){this.map.delete(ae.param);break}{let lt=this.map.get(ae.param)||[];const Le=lt.indexOf(Ee(ae.value));-1!==Le&&lt.splice(Le,1),lt.length>0?this.map.set(ae.param,lt):this.map.delete(ae.param)}}}),this.cloneFrom=this.updates=null)}}class Se{constructor(){this.map=new Map}set(ae,Re){return this.map.set(ae,Re),this}get(ae){return this.map.has(ae)||this.map.set(ae,ae.defaultValue()),this.map.get(ae)}delete(ae){return this.map.delete(ae),this}has(ae){return this.map.has(ae)}keys(){return this.map.keys()}}function tt(Oe){return"undefined"!=typeof ArrayBuffer&&Oe instanceof ArrayBuffer}function et(Oe){return"undefined"!=typeof Blob&&Oe instanceof Blob}function Be(Oe){return"undefined"!=typeof FormData&&Oe instanceof FormData}class Ge{constructor(ae,Re,lt,Le){let Rt;if(this.url=Re,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=ae.toUpperCase(),function ze(Oe){switch(Oe){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||Le?(this.body=void 0!==lt?lt:null,Rt=Le):Rt=lt,Rt&&(this.reportProgress=!!Rt.reportProgress,this.withCredentials=!!Rt.withCredentials,Rt.responseType&&(this.responseType=Rt.responseType),Rt.headers&&(this.headers=Rt.headers),Rt.context&&(this.context=Rt.context),Rt.params&&(this.params=Rt.params)),this.headers||(this.headers=new Q),this.context||(this.context=new Se),this.params){const me=this.params.toString();if(0===me.length)this.urlWithParams=Re;else{const He=Re.indexOf("?");this.urlWithParams=Re+(-1===He?"?":He<Re.length-1?"&":"")+me}}else this.params=new We,this.urlWithParams=Re}serializeBody(){return null===this.body?null:tt(this.body)||et(this.body)||Be(this.body)||function C(Oe){return"undefined"!=typeof URLSearchParams&&Oe instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof We?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Be(this.body)?null:et(this.body)?this.body.type||null:tt(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof We?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(ae={}){const Re=ae.method||this.method,lt=ae.url||this.url,Le=ae.responseType||this.responseType,Rt=void 0!==ae.body?ae.body:this.body,me=void 0!==ae.withCredentials?ae.withCredentials:this.withCredentials,He=void 0!==ae.reportProgress?ae.reportProgress:this.reportProgress;let Ft=ae.headers||this.headers,Qt=ae.params||this.params;const Jn=ae.context??this.context;return void 0!==ae.setHeaders&&(Ft=Object.keys(ae.setHeaders).reduce((Ki,Di)=>Ki.set(Di,ae.setHeaders[Di]),Ft)),ae.setParams&&(Qt=Object.keys(ae.setParams).reduce((Ki,Di)=>Ki.set(Di,ae.setParams[Di]),Qt)),new Ge(Re,lt,Rt,{params:Qt,headers:Ft,context:Jn,reportProgress:He,responseType:Le,withCredentials:me})}}var _t=(()=>((_t=_t||{})[_t.Sent=0]="Sent",_t[_t.UploadProgress=1]="UploadProgress",_t[_t.ResponseHeader=2]="ResponseHeader",_t[_t.DownloadProgress=3]="DownloadProgress",_t[_t.Response=4]="Response",_t[_t.User=5]="User",_t))();class ht{constructor(ae,Re=200,lt="OK"){this.headers=ae.headers||new Q,this.status=void 0!==ae.status?ae.status:Re,this.statusText=ae.statusText||lt,this.url=ae.url||null,this.ok=this.status>=200&&this.status<300}}class wt extends ht{constructor(ae={}){super(ae),this.type=_t.ResponseHeader}clone(ae={}){return new wt({headers:ae.headers||this.headers,status:void 0!==ae.status?ae.status:this.status,statusText:ae.statusText||this.statusText,url:ae.url||this.url||void 0})}}class xt extends ht{constructor(ae={}){super(ae),this.type=_t.Response,this.body=void 0!==ae.body?ae.body:null}clone(ae={}){return new xt({body:void 0!==ae.body?ae.body:this.body,headers:ae.headers||this.headers,status:void 0!==ae.status?ae.status:this.status,statusText:ae.statusText||this.statusText,url:ae.url||this.url||void 0})}}class gt extends ht{constructor(ae){super(ae,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${ae.url||"(unknown url)"}`:`Http failure response for ${ae.url||"(unknown url)"}: ${ae.status} ${ae.statusText}`,this.error=ae.error||null}}function Bt(Oe,ae){return{body:ae,headers:Oe.headers,context:Oe.context,observe:Oe.observe,params:Oe.params,reportProgress:Oe.reportProgress,responseType:Oe.responseType,withCredentials:Oe.withCredentials}}let Ht=(()=>{class Oe{constructor(Re){this.handler=Re}request(Re,lt,Le={}){let Rt;if(Re instanceof Ge)Rt=Re;else{let Ft,Qt;Ft=Le.headers instanceof Q?Le.headers:new Q(Le.headers),Le.params&&(Qt=Le.params instanceof We?Le.params:new We({fromObject:Le.params})),Rt=new Ge(Re,lt,void 0!==Le.body?Le.body:null,{headers:Ft,context:Le.context,params:Qt,reportProgress:Le.reportProgress,responseType:Le.responseType||"json",withCredentials:Le.withCredentials})}const me=(0,pe.of)(Rt).pipe((0,J.b)(Ft=>this.handler.handle(Ft)));if(Re instanceof Ge||"events"===Le.observe)return me;const He=me.pipe((0,j.h)(Ft=>Ft instanceof xt));switch(Le.observe||"body"){case"body":switch(Rt.responseType){case"arraybuffer":return He.pipe((0,g.U)(Ft=>{if(null!==Ft.body&&!(Ft.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return Ft.body}));case"blob":return He.pipe((0,g.U)(Ft=>{if(null!==Ft.body&&!(Ft.body instanceof Blob))throw new Error("Response is not a Blob.");return Ft.body}));case"text":return He.pipe((0,g.U)(Ft=>{if(null!==Ft.body&&"string"!=typeof Ft.body)throw new Error("Response is not a string.");return Ft.body}));default:return He.pipe((0,g.U)(Ft=>Ft.body))}case"response":return He;default:throw new Error(`Unreachable: unhandled observe type ${Le.observe}}`)}}delete(Re,lt={}){return this.request("DELETE",Re,lt)}get(Re,lt={}){return this.request("GET",Re,lt)}head(Re,lt={}){return this.request("HEAD",Re,lt)}jsonp(Re,lt){return this.request("JSONP",Re,{params:(new We).append(lt,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Re,lt={}){return this.request("OPTIONS",Re,lt)}patch(Re,lt,Le={}){return this.request("PATCH",Re,Bt(Le,lt))}post(Re,lt,Le={}){return this.request("POST",Re,Bt(Le,lt))}put(Re,lt,Le={}){return this.request("PUT",Re,Bt(Le,lt))}}return Oe.\u0275fac=function(Re){return new(Re||Oe)(d.LFG(ne))},Oe.\u0275prov=d.Yz7({token:Oe,factory:Oe.\u0275fac}),Oe})();class Gn{constructor(ae,Re){this.next=ae,this.interceptor=Re}handle(ae){return this.interceptor.intercept(ae,this.next)}}const It=new d.OlP("HTTP_INTERCEPTORS");let jt=(()=>{class Oe{intercept(Re,lt){return lt.handle(Re)}}return Oe.\u0275fac=function(Re){return new(Re||Oe)},Oe.\u0275prov=d.Yz7({token:Oe,factory:Oe.\u0275fac}),Oe})();const Kt=/^\)\]\}',?\n/;let Wt=(()=>{class Oe{constructor(Re){this.xhrFactory=Re}handle(Re){if("JSONP"===Re.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new l.y(lt=>{const Le=this.xhrFactory.build();if(Le.open(Re.method,Re.urlWithParams),Re.withCredentials&&(Le.withCredentials=!0),Re.headers.forEach((mi,ci)=>Le.setRequestHeader(mi,ci.join(","))),Re.headers.has("Accept")||Le.setRequestHeader("Accept","application/json, text/plain, */*"),!Re.headers.has("Content-Type")){const mi=Re.detectContentTypeHeader();null!==mi&&Le.setRequestHeader("Content-Type",mi)}if(Re.responseType){const mi=Re.responseType.toLowerCase();Le.responseType="json"!==mi?mi:"text"}const Rt=Re.serializeBody();let me=null;const He=()=>{if(null!==me)return me;const mi=Le.statusText||"OK",ci=new Q(Le.getAllResponseHeaders()),xr=function mt(Oe){return"responseURL"in Oe&&Oe.responseURL?Oe.responseURL:/^X-Request-URL:/m.test(Oe.getAllResponseHeaders())?Oe.getResponseHeader("X-Request-URL"):null}(Le)||Re.url;return me=new wt({headers:ci,status:Le.status,statusText:mi,url:xr}),me},Ft=()=>{let{headers:mi,status:ci,statusText:xr,url:Ii}=He(),hr=null;204!==ci&&(hr=void 0===Le.response?Le.responseText:Le.response),0===ci&&(ci=hr?200:0);let yi=ci>=200&&ci<300;if("json"===Re.responseType&&"string"==typeof hr){const kr=hr;hr=hr.replace(Kt,"");try{hr=""!==hr?JSON.parse(hr):null}catch(gr){hr=kr,yi&&(yi=!1,hr={error:gr,text:hr})}}yi?(lt.next(new xt({body:hr,headers:mi,status:ci,statusText:xr,url:Ii||void 0})),lt.complete()):lt.error(new gt({error:hr,headers:mi,status:ci,statusText:xr,url:Ii||void 0}))},Qt=mi=>{const{url:ci}=He(),xr=new gt({error:mi,status:Le.status||0,statusText:Le.statusText||"Unknown Error",url:ci||void 0});lt.error(xr)};let Jn=!1;const Ki=mi=>{Jn||(lt.next(He()),Jn=!0);let ci={type:_t.DownloadProgress,loaded:mi.loaded};mi.lengthComputable&&(ci.total=mi.total),"text"===Re.responseType&&!!Le.responseText&&(ci.partialText=Le.responseText),lt.next(ci)},Di=mi=>{let ci={type:_t.UploadProgress,loaded:mi.loaded};mi.lengthComputable&&(ci.total=mi.total),lt.next(ci)};return Le.addEventListener("load",Ft),Le.addEventListener("error",Qt),Le.addEventListener("timeout",Qt),Le.addEventListener("abort",Qt),Re.reportProgress&&(Le.addEventListener("progress",Ki),null!==Rt&&Le.upload&&Le.upload.addEventListener("progress",Di)),Le.send(Rt),lt.next({type:_t.Sent}),()=>{Le.removeEventListener("error",Qt),Le.removeEventListener("abort",Qt),Le.removeEventListener("load",Ft),Le.removeEventListener("timeout",Qt),Re.reportProgress&&(Le.removeEventListener("progress",Ki),null!==Rt&&Le.upload&&Le.upload.removeEventListener("progress",Di)),Le.readyState!==Le.DONE&&Le.abort()}})}}return Oe.\u0275fac=function(Re){return new(Re||Oe)(d.LFG(b.JF))},Oe.\u0275prov=d.Yz7({token:Oe,factory:Oe.\u0275fac}),Oe})();const On=new d.OlP("XSRF_COOKIE_NAME"),bn=new d.OlP("XSRF_HEADER_NAME");class jn{}let li=(()=>{class Oe{constructor(Re,lt,Le){this.doc=Re,this.platform=lt,this.cookieName=Le,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Re=this.doc.cookie||"";return Re!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,b.Mx)(Re,this.cookieName),this.lastCookieString=Re),this.lastToken}}return Oe.\u0275fac=function(Re){return new(Re||Oe)(d.LFG(b.K0),d.LFG(d.Lbi),d.LFG(On))},Oe.\u0275prov=d.Yz7({token:Oe,factory:Oe.\u0275fac}),Oe})(),$i=(()=>{class Oe{constructor(Re,lt){this.tokenService=Re,this.headerName=lt}intercept(Re,lt){const Le=Re.url.toLowerCase();if("GET"===Re.method||"HEAD"===Re.method||Le.startsWith("http://")||Le.startsWith("https://"))return lt.handle(Re);const Rt=this.tokenService.getToken();return null!==Rt&&!Re.headers.has(this.headerName)&&(Re=Re.clone({headers:Re.headers.set(this.headerName,Rt)})),lt.handle(Re)}}return Oe.\u0275fac=function(Re){return new(Re||Oe)(d.LFG(jn),d.LFG(bn))},Oe.\u0275prov=d.Yz7({token:Oe,factory:Oe.\u0275fac}),Oe})(),rr=(()=>{class Oe{constructor(Re,lt){this.backend=Re,this.injector=lt,this.chain=null}handle(Re){if(null===this.chain){const lt=this.injector.get(It,[]);this.chain=lt.reduceRight((Le,Rt)=>new Gn(Le,Rt),this.backend)}return this.chain.handle(Re)}}return Oe.\u0275fac=function(Re){return new(Re||Oe)(d.LFG(ge),d.LFG(d.zs3))},Oe.\u0275prov=d.Yz7({token:Oe,factory:Oe.\u0275fac}),Oe})(),tr=(()=>{class Oe{static disable(){return{ngModule:Oe,providers:[{provide:$i,useClass:jt}]}}static withOptions(Re={}){return{ngModule:Oe,providers:[Re.cookieName?{provide:On,useValue:Re.cookieName}:[],Re.headerName?{provide:bn,useValue:Re.headerName}:[]]}}}return Oe.\u0275fac=function(Re){return new(Re||Oe)},Oe.\u0275mod=d.oAB({type:Oe}),Oe.\u0275inj=d.cJS({providers:[$i,{provide:It,useExisting:$i,multi:!0},{provide:jn,useClass:li},{provide:On,useValue:"XSRF-TOKEN"},{provide:bn,useValue:"X-XSRF-TOKEN"}]}),Oe})(),gi=(()=>{class Oe{}return Oe.\u0275fac=function(Re){return new(Re||Oe)},Oe.\u0275mod=d.oAB({type:Oe}),Oe.\u0275inj=d.cJS({providers:[Ht,{provide:ne,useClass:rr},Wt,{provide:ge,useExisting:Wt}],imports:[[tr.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),Oe})()},6738:(An,vt,k)=>{"use strict";k.d(vt,{deG:()=>Do,tb:()=>e0,AFp:()=>Xv,ip1:()=>b_,CZH:()=>_h,hGG:()=>dw,z2F:()=>ef,ahi:()=>Br,sBO:()=>Zb,Sil:()=>T_,_Vd:()=>Hp,aQ5:()=>Kn,EJc:()=>n0,SBq:()=>Wp,qLn:()=>iu,vpe:()=>bc,L6J:()=>vb,tBr:()=>ir,XFs:()=>lt,OlP:()=>Ir,zs3:()=>wa,ZZ4:()=>Vm,aQg:()=>$m,soG:()=>zm,YKP:()=>uv,h0i:()=>fh,PXZ:()=>Lb,R0b:()=>cl,FiY:()=>no,r_U:()=>yb,Lbi:()=>Qv,g9A:()=>Kv,Qsj:()=>f1,FYo:()=>sv,JOm:()=>wl,tp0:()=>Hr,Rgc:()=>Kp,dDg:()=>s0,GfV:()=>av,i9L:()=>ud,s_b:()=>km,ifc:()=>mi,eFA:()=>c0,G48:()=>Ub,Gpc:()=>Se,_c5:()=>rw,VLi:()=>Pb,c2e:()=>t0,zSh:()=>wp,wAp:()=>Ji,vHH:()=>Be,cg1:()=>Kg,kL8:()=>Sy,dqk:()=>yi,sIi:()=>bu,CqO:()=>Du,QGY:()=>Ta,F4k:()=>Hc,RDi:()=>Dt,AaK:()=>Ee,qOj:()=>Ns,TTD:()=>Ms,_Bn:()=>iv,xp6:()=>Jh,uIk:()=>Gc,ekj:()=>qg,Suo:()=>Sv,Xpm:()=>pt,lG2:()=>Vn,Yz7:()=>li,cJS:()=>rr,oAB:()=>Gt,Yjl:()=>Yn,Y36:()=>hs,_UZ:()=>_o,BQk:()=>Ds,ynx:()=>fs,qZA:()=>Yo,TgZ:()=>Wr,EpF:()=>is,n5z:()=>G,LFG:()=>Pi,$8M:()=>Pe,$Z:()=>po,NdJ:()=>Wc,CRH:()=>Pv,oxw:()=>sh,ALo:()=>xv,lcZ:()=>bv,xi3:()=>wv,Hsn:()=>ah,F$t:()=>Up,Q6J:()=>Wo,s9C:()=>sd,DdM:()=>fv,iGM:()=>Mv,MAs:()=>M,CHM:()=>Gs,LSH:()=>Ah,kYT:()=>At,Udp:()=>Gg,YNc:()=>x,_uU:()=>py,Oqu:()=>Wg,hij:()=>Im,AsE:()=>Yg,lnq:()=>Jg,HOy:()=>Xg,Gf:()=>Av});var b=k(2916),d=k(2866),pe=k(9146),l=k(3009),j=k(8929),g=k(2654),ne=k(1762);class Q{constructor(o,a){this.subjectFactory=o,this.selector=a}call(o,a){const{selector:h}=this,y=this.subjectFactory(),w=h(y).subscribe(o);return w.add(a.subscribe(y)),w}}var Y=k(4327);function se(){return new j.xQ}function ye(r){for(let o in r)if(r[o]===ye)return o;throw Error("Could not find renamed property on target object.")}function xe(r,o){for(const a in o)o.hasOwnProperty(a)&&!r.hasOwnProperty(a)&&(r[a]=o[a])}function Ee(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(Ee).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const o=r.toString();if(null==o)return""+o;const a=o.indexOf("\n");return-1===a?o:o.substring(0,a)}function We(r,o){return null==r||""===r?null===o?"":o:null==o||""===o?r:r+" "+o}const be=ye({__forward_ref__:ye});function Se(r){return r.__forward_ref__=Se,r.toString=function(){return Ee(this())},r}function ze(r){return tt(r)?r():r}function tt(r){return"function"==typeof r&&r.hasOwnProperty(be)&&r.__forward_ref__===Se}class Be extends Error{constructor(o,a){super(function C(r,o){return`NG0${Math.abs(r)}${o?": "+o:""}`}(o,a)),this.code=o}}function Ge(r){return"string"==typeof r?r:null==r?"":String(r)}function _t(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():Ge(r)}function gt(r,o){const a=o?` in ${o}`:"";throw new Be(-201,`No provider for ${_t(r)} found${a}`)}function mt(r,o){null==r&&function Wt(r,o,a,h){throw new Error(`ASSERTION ERROR: ${r}`+(null==h?"":` [Expected=> ${a} ${h} ${o} <=Actual]`))}(o,r,null,"!=")}function li(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function rr(r){return{providers:r.providers||[],imports:r.imports||[]}}function Bi(r){return _i(r,Xt)||_i(r,ae)}function _i(r,o){return r.hasOwnProperty(o)?r[o]:null}function Ti(r){return r&&(r.hasOwnProperty(Oe)||r.hasOwnProperty(Re))?r[Oe]:null}const Xt=ye({\u0275prov:ye}),Oe=ye({\u0275inj:ye}),ae=ye({ngInjectableDef:ye}),Re=ye({ngInjectorDef:ye});var lt=(()=>((lt=lt||{})[lt.Default=0]="Default",lt[lt.Host=1]="Host",lt[lt.Self=2]="Self",lt[lt.SkipSelf=4]="SkipSelf",lt[lt.Optional=8]="Optional",lt))();let Le;function me(r){const o=Le;return Le=r,o}function He(r,o,a){const h=Bi(r);return h&&"root"==h.providedIn?void 0===h.value?h.value=h.factory():h.value:a&lt.Optional?null:void 0!==o?o:void gt(Ee(r),"Injector")}function Qt(r){return{toString:r}.toString()}var Jn=(()=>((Jn=Jn||{})[Jn.OnPush=0]="OnPush",Jn[Jn.Default=1]="Default",Jn))(),mi=(()=>{return(r=mi||(mi={}))[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",mi;var r})();const ci="undefined"!=typeof globalThis&&globalThis,xr="undefined"!=typeof window&&window,Ii="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,yi=ci||"undefined"!=typeof global&&global||xr||Ii,Tr={},Ci=[],Oi=ye({\u0275cmp:ye}),K=ye({\u0275dir:ye}),q=ye({\u0275pipe:ye}),L=ye({\u0275mod:ye}),de=ye({\u0275fac:ye}),we=ye({__NG_ELEMENT_ID__:ye});let Ye=0;function pt(r){return Qt(()=>{const a={},h={type:r.type,providersResolver:null,decls:r.decls,vars:r.vars,factory:null,template:r.template||null,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:a,inputs:null,outputs:null,exportAs:r.exportAs||null,onPush:r.changeDetection===Jn.OnPush,directiveDefs:null,pipeDefs:null,selectors:r.selectors||Ci,viewQuery:r.viewQuery||null,features:r.features||null,data:r.data||{},encapsulation:r.encapsulation||mi.Emulated,id:"c",styles:r.styles||Ci,_:null,setInput:null,schemas:r.schemas||null,tView:null},y=r.directives,w=r.features,S=r.pipes;return h.id+=Ye++,h.inputs=Pn(r.inputs,a),h.outputs=Pn(r.outputs),w&&w.forEach(B=>B(h)),h.directiveDefs=y?()=>("function"==typeof y?y():y).map(Je):null,h.pipeDefs=S?()=>("function"==typeof S?S():S).map(Lt):null,h})}function Je(r){return qn(r)||function ni(r){return r[K]||null}(r)}function Lt(r){return function Li(r){return r[q]||null}(r)}const en={};function Gt(r){return Qt(()=>{const o={type:r.type,bootstrap:r.bootstrap||Ci,declarations:r.declarations||Ci,imports:r.imports||Ci,exports:r.exports||Ci,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null};return null!=r.id&&(en[r.id]=r.type),o})}function At(r,o){return Qt(()=>{const a=Mi(r,!0);a.declarations=o.declarations||Ci,a.imports=o.imports||Ci,a.exports=o.exports||Ci})}function Pn(r,o){if(null==r)return Tr;const a={};for(const h in r)if(r.hasOwnProperty(h)){let y=r[h],w=y;Array.isArray(y)&&(w=y[1],y=y[0]),a[y]=h,o&&(o[y]=w)}return a}const Vn=pt;function Yn(r){return{type:r.type,name:r.name,factory:null,pure:!1!==r.pure,onDestroy:r.type.prototype.ngOnDestroy||null}}function qn(r){return r[Oi]||null}function Mi(r,o){const a=r[L]||null;if(!a&&!0===o)throw new Error(`Type ${Ee(r)} does not have '\u0275mod' property.`);return a}function on(r){return Array.isArray(r)&&"object"==typeof r[1]}function Ri(r){return Array.isArray(r)&&!0===r[1]}function Ur(r){return 0!=(8&r.flags)}function ji(r){return 2==(2&r.flags)}function _r(r){return 1==(1&r.flags)}function Qi(r){return null!==r.template}function Ao(r){return 0!=(512&r[2])}function oo(r,o){return r.hasOwnProperty(de)?r[de]:null}class Jo{constructor(o,a,h){this.previousValue=o,this.currentValue=a,this.firstChange=h}isFirstChange(){return this.firstChange}}function Ms(){return Gr}function Gr(r){return r.type.prototype.ngOnChanges&&(r.setInput=lo),Vs}function Vs(){const r=As(this),o=r?.current;if(o){const a=r.previous;if(a===Tr)r.previous=o;else for(let h in o)a[h]=o[h];r.current=null,this.ngOnChanges(o)}}function lo(r,o,a,h){const y=As(r)||function To(r,o){return r[Kr]=o}(r,{previous:Tr,current:null}),w=y.current||(y.current={}),S=y.previous,B=this.declaredInputs[a],Z=S[B];w[B]=new Jo(Z&&Z.currentValue,o,S===Tr),r[h]=o}Ms.ngInherit=!0;const Kr="__ngSimpleChanges__";function As(r){return r[Kr]||null}let Ne;function Dt(r){Ne=r}function Hn(r){return!!r.listen}const Fr={createRenderer:(r,o)=>function sn(){return void 0!==Ne?Ne:"undefined"!=typeof document?document:void 0}()};function Fi(r){for(;Array.isArray(r);)r=r[0];return r}function ie(r,o){return Fi(o[r])}function W(r,o){return Fi(o[r.index])}function Fe(r,o){return r.data[o]}function dn(r,o){return r[o]}function ei(r,o){const a=o[r];return on(a)?a:a[0]}function Or(r){return 4==(4&r[2])}function Rr(r){return 128==(128&r[2])}function zo(r,o){return null==o?null:r[o]}function cs(r){r[18]=0}function $s(r,o){r[5]+=o;let a=r,h=r[3];for(;null!==h&&(1===o&&1===a[5]||-1===o&&0===a[5]);)h[5]+=o,a=h,h=h[3]}const Ui={lFrame:pi(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Ea(){return Ui.bindingsEnabled}function In(){return Ui.lFrame.lView}function ar(){return Ui.lFrame.tView}function Gs(r){return Ui.lFrame.contextLView=r,r[8]}function Yr(){let r=us();for(;null!==r&&64===r.type;)r=r.parent;return r}function us(){return Ui.lFrame.currentTNode}function vo(r,o){const a=Ui.lFrame;a.currentTNode=r,a.isParent=o}function rs(){return Ui.lFrame.isParent}function ha(){Ui.lFrame.isParent=!1}function Po(){return Ui.isInCheckNoChangesMode}function qs(r){Ui.isInCheckNoChangesMode=r}function Qo(){const r=Ui.lFrame;let o=r.bindingRootIndex;return-1===o&&(o=r.bindingRootIndex=r.tView.bindingStartIndex),o}function Dr(){return Ui.lFrame.bindingIndex}function Zo(){return Ui.lFrame.bindingIndex++}function ys(r){const o=Ui.lFrame,a=o.bindingIndex;return o.bindingIndex=o.bindingIndex+r,a}function Vo(r,o){const a=Ui.lFrame;a.bindingIndex=a.bindingRootIndex=r,N(o)}function N(r){Ui.lFrame.currentDirectiveIndex=r}function re(){return Ui.lFrame.currentQueryIndex}function De(r){Ui.lFrame.currentQueryIndex=r}function kt(r){const o=r[1];return 2===o.type?o.declTNode:1===o.type?r[6]:null}function Rn(r,o,a){if(a&lt.SkipSelf){let y=o,w=r;for(;!(y=y.parent,null!==y||a&lt.Host||(y=kt(w),null===y||(w=w[15],10&y.type))););if(null===y)return!1;o=y,r=w}const h=Ui.lFrame=Wi();return h.currentTNode=o,h.lView=r,!0}function Xn(r){const o=Wi(),a=r[1];Ui.lFrame=o,o.currentTNode=a.firstChild,o.lView=r,o.tView=a,o.contextLView=r,o.bindingIndex=a.bindingStartIndex,o.inI18n=!1}function Wi(){const r=Ui.lFrame,o=null===r?null:r.child;return null===o?pi(r):o}function pi(r){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=o),o}function lr(){const r=Ui.lFrame;return Ui.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const so=lr;function Lr(){const r=lr();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function uo(){return Ui.lFrame.selectedIndex}function Ss(r){Ui.lFrame.selectedIndex=r}function Jr(){const r=Ui.lFrame;return Fe(r.tView,r.selectedIndex)}function cr(r,o){for(let a=o.directiveStart,h=o.directiveEnd;a<h;a++){const w=r.data[a].type.prototype,{ngAfterContentInit:S,ngAfterContentChecked:B,ngAfterViewInit:Z,ngAfterViewChecked:fe,ngOnDestroy:Te}=w;S&&(r.contentHooks||(r.contentHooks=[])).push(-a,S),B&&((r.contentHooks||(r.contentHooks=[])).push(a,B),(r.contentCheckHooks||(r.contentCheckHooks=[])).push(a,B)),Z&&(r.viewHooks||(r.viewHooks=[])).push(-a,Z),fe&&((r.viewHooks||(r.viewHooks=[])).push(a,fe),(r.viewCheckHooks||(r.viewCheckHooks=[])).push(a,fe)),null!=Te&&(r.destroyHooks||(r.destroyHooks=[])).push(a,Te)}}function Ua(r,o,a){$o(r,o,3,a)}function ga(r,o,a,h){(3&r[2])===a&&$o(r,o,a,h)}function Da(r,o){let a=r[2];(3&a)===o&&(a&=2047,a+=1,r[2]=a)}function $o(r,o,a,h){const w=h??-1,S=o.length-1;let B=0;for(let Z=void 0!==h?65535&r[18]:0;Z<S;Z++)if("number"==typeof o[Z+1]){if(B=o[Z],null!=h&&B>=h)break}else o[Z]<0&&(r[18]+=65536),(B<w||-1==w)&&(tc(r,a,o,Z),r[18]=(4294901760&r[18])+Z+2),Z++}function tc(r,o,a,h){const y=a[h]<0,w=a[h+1],B=r[y?-a[h]:a[h]];if(y){if(r[2]>>11<r[18]>>16&&(3&r[2])===o){r[2]+=2048;try{w.call(B)}finally{}}}else try{w.call(B)}finally{}}class Za{constructor(o,a,h){this.factory=o,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=h}}function $a(r,o,a){const h=Hn(r);let y=0;for(;y<a.length;){const w=a[y];if("number"==typeof w){if(0!==w)break;y++;const S=a[y++],B=a[y++],Z=a[y++];h?r.setAttribute(o,B,Z,S):o.setAttributeNS(S,B,Z)}else{const S=w,B=a[++y];Ia(S)?h&&r.setProperty(o,S,B):h?r.setAttribute(o,S,B):o.setAttribute(S,B),y++}}return y}function os(r){return 3===r||4===r||6===r}function Ia(r){return 64===r.charCodeAt(0)}function ja(r,o){if(null!==o&&0!==o.length)if(null===r||0===r.length)r=o.slice();else{let a=-1;for(let h=0;h<o.length;h++){const y=o[h];"number"==typeof y?a=y:0===a||ta(r,a,y,null,-1===a||2===a?o[++h]:null)}}return r}function ta(r,o,a,h,y){let w=0,S=r.length;if(-1===o)S=-1;else for(;w<r.length;){const B=r[w++];if("number"==typeof B){if(B===o){S=-1;break}if(B>o){S=w-1;break}}}for(;w<r.length;){const B=r[w];if("number"==typeof B)break;if(B===a){if(null===h)return void(null!==y&&(r[w+1]=y));if(h===r[w+1])return void(r[w+2]=y)}w++,null!==h&&w++,null!==y&&w++}-1!==S&&(r.splice(S,0,o),w=S+1),r.splice(w++,0,a),null!==h&&r.splice(w++,0,h),null!==y&&r.splice(w++,0,y)}function na(r){return-1!==r}function Ma(r){return 32767&r}function _a(r,o){let a=function Pl(r){return r>>16}(r),h=o;for(;a>0;)h=h[15],a--;return h}let Ga=!0;function Aa(r){const o=Ga;return Ga=r,o}let Jc=0;function Pa(r,o){const a=nc(r,o);if(-1!==a)return a;const h=o[1];h.firstCreatePass&&(r.injectorIndex=o.length,Ol(h.data,r),Ol(o,null),Ol(h.blueprint,null));const y=Rl(r,o),w=r.injectorIndex;if(na(y)){const S=Ma(y),B=_a(y,o),Z=B[1].data;for(let fe=0;fe<8;fe++)o[w+fe]=B[S+fe]|Z[S+fe]}return o[w+8]=y,w}function Ol(r,o){r.push(0,0,0,0,0,0,0,0,o)}function nc(r,o){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===o[r.injectorIndex+8]?-1:r.injectorIndex}function Rl(r,o){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let a=0,h=null,y=o;for(;null!==y;){const w=y[1],S=w.type;if(h=2===S?w.declTNode:1===S?y[6]:null,null===h)return-1;if(a++,y=y[15],-1!==h.injectorIndex)return h.injectorIndex|a<<16}return-1}function qa(r,o,a){!function Mc(r,o,a){let h;"string"==typeof a?h=a.charCodeAt(0)||0:a.hasOwnProperty(we)&&(h=a[we]),null==h&&(h=a[we]=Jc++);const y=255&h;o.data[r+(y>>5)]|=1<<y}(r,o,a)}function Ac(r,o,a){if(a&lt.Optional)return r;gt(o,"NodeInjector")}function ml(r,o,a,h){if(a&lt.Optional&&void 0===h&&(h=null),0==(a&(lt.Self|lt.Host))){const y=r[9],w=me(void 0);try{return y?y.get(o,h,a&lt.Optional):He(o,h,a&lt.Optional)}finally{me(w)}}return Ac(h,o,a)}function Sc(r,o,a,h=lt.Default,y){if(null!==r){const w=function Xc(r){if("string"==typeof r)return r.charCodeAt(0)||0;const o=r.hasOwnProperty(we)?r[we]:void 0;return"number"==typeof o?o>=0?255&o:kl:o}(a);if("function"==typeof w){if(!Rn(o,r,h))return h&lt.Host?Ac(y,a,h):ml(o,a,h,y);try{const S=w(h);if(null!=S||h&lt.Optional)return S;gt(a)}finally{so()}}else if("number"==typeof w){let S=null,B=nc(r,o),Z=-1,fe=h&lt.Host?o[16][6]:null;for((-1===B||h&lt.SkipSelf)&&(Z=-1===B?Rl(r,o):o[B+8],-1!==Z&&O(h,!1)?(S=o[1],B=Ma(Z),o=_a(Z,o)):B=-1);-1!==B;){const Te=o[1];if(z(w,B,Te.data)){const Qe=gl(B,o,a,S,h,fe);if(Qe!==Ll)return Qe}Z=o[B+8],-1!==Z&&O(h,o[1].data[B+8]===fe)&&z(w,B,o)?(S=Te,B=Ma(Z),o=_a(Z,o)):B=-1}}}return ml(o,a,h,y)}const Ll={};function kl(){return new P(Yr(),In())}function gl(r,o,a,h,y,w){const S=o[1],B=S.data[r+8],Te=Ha(B,S,a,null==h?ji(B)&&Ga:h!=S&&0!=(3&B.type),y&lt.Host&&w===B);return null!==Te?_l(o,S,Te,B):Ll}function Ha(r,o,a,h,y){const w=r.providerIndexes,S=o.data,B=1048575&w,Z=r.directiveStart,Te=w>>20,Et=y?B+Te:r.directiveEnd;for(let qt=h?B:B+Te;qt<Et;qt++){const wn=S[qt];if(qt<Z&&a===wn||qt>=Z&&wn.type===a)return qt}if(y){const qt=S[Z];if(qt&&Qi(qt)&&qt.type===a)return Z}return null}function _l(r,o,a,h){let y=r[a];const w=o.data;if(function Mu(r){return r instanceof Za}(y)){const S=y;S.resolving&&function ht(r,o){const a=o?`. Dependency path: ${o.join(" > ")} > ${r}`:"";throw new Be(-200,`Circular dependency in DI detected for ${r}${a}`)}(_t(w[a]));const B=Aa(S.canSeeViewProviders);S.resolving=!0;const Z=S.injectImpl?me(S.injectImpl):null;Rn(r,h,lt.Default);try{y=r[a]=S.factory(void 0,w,r,h),o.firstCreatePass&&a>=h.directiveStart&&function Cc(r,o,a){const{ngOnChanges:h,ngOnInit:y,ngDoCheck:w}=o.type.prototype;if(h){const S=Gr(o);(a.preOrderHooks||(a.preOrderHooks=[])).push(r,S),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(r,S)}y&&(a.preOrderHooks||(a.preOrderHooks=[])).push(0-r,y),w&&((a.preOrderHooks||(a.preOrderHooks=[])).push(r,w),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(r,w))}(a,w[a],o)}finally{null!==Z&&me(Z),Aa(B),S.resolving=!1,so()}}return y}function z(r,o,a){return!!(a[o+(r>>5)]&1<<r)}function O(r,o){return!(r&lt.Self||r&lt.Host&&o)}class P{constructor(o,a){this._tNode=o,this._lView=a}get(o,a,h){return Sc(this._tNode,this._lView,o,h,a)}}function G(r){return Qt(()=>{const o=r.prototype.constructor,a=o[de]||le(o),h=Object.prototype;let y=Object.getPrototypeOf(r.prototype).constructor;for(;y&&y!==h;){const w=y[de]||le(y);if(w&&w!==a)return w;y=Object.getPrototypeOf(y)}return w=>new w})}function le(r){return tt(r)?()=>{const o=le(ze(r));return o&&o()}:oo(r)}function Pe(r){return function ic(r,o){if("class"===o)return r.classes;if("style"===o)return r.styles;const a=r.attrs;if(a){const h=a.length;let y=0;for(;y<h;){const w=a[y];if(os(w))break;if(0===w)y+=2;else if("number"==typeof w)for(y++;y<h&&"string"==typeof a[y];)y++;else{if(w===o)return a[y+1];y+=2}}}return null}(Yr(),r)}const yt="__parameters__",_n="__prop__metadata__";function Zr(r){return function(...a){if(r){const h=r(...a);for(const y in h)this[y]=h[y]}}}function Si(r,o,a){return Qt(()=>{const h=Zr(o);function y(...w){if(this instanceof y)return h.apply(this,w),this;const S=new y(...w);return B.annotation=S,B;function B(Z,fe,Te){const Qe=Z.hasOwnProperty(yt)?Z[yt]:Object.defineProperty(Z,yt,{value:[]})[yt];for(;Qe.length<=Te;)Qe.push(null);return(Qe[Te]=Qe[Te]||[]).push(S),Z}}return a&&(y.prototype=Object.create(a.prototype)),y.prototype.ngMetadataName=r,y.annotationCls=y,y})}function qr(r,o,a,h){return Qt(()=>{const y=Zr(o);function w(...S){if(this instanceof w)return y.apply(this,S),this;const B=new w(...S);return function Z(fe,Te){const Qe=fe.constructor,Et=Qe.hasOwnProperty(_n)?Qe[_n]:Object.defineProperty(Qe,_n,{value:{}})[_n];Et[Te]=Et.hasOwnProperty(Te)&&Et[Te]||[],Et[Te].unshift(B),h&&h(fe,Te,...S)}}return a&&(w.prototype=Object.create(a.prototype)),w.prototype.ngMetadataName=r,w.annotationCls=w,w})}const Br=Si("Attribute",r=>({attributeName:r,__NG_ELEMENT_ID__:()=>Pe(r)}));class Ir{constructor(o,a){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof a?this.__NG_ELEMENT_ID__=a:void 0!==a&&(this.\u0275prov=li({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}toString(){return`InjectionToken ${this._desc}`}}const Do=new Ir("AnalyzeForEntryComponents");class xs{}const Kn=qr("ContentChild",(r,o={})=>({selector:r,first:!0,isViewQuery:!1,descendants:!0,...o}),xs),ud=qr("ViewChild",(r,o)=>({selector:r,first:!0,isViewQuery:!0,descendants:!0,...o}),xs);function T(r,o){void 0===o&&(o=r);for(let a=0;a<r.length;a++){let h=r[a];Array.isArray(h)?(o===r&&(o=r.slice(0,a)),T(h,o)):o!==r&&o.push(h)}return o}function I(r,o){r.forEach(a=>Array.isArray(a)?I(a,o):o(a))}function R(r,o,a){o>=r.length?r.push(a):r.splice(o,0,a)}function $(r,o){return o>=r.length-1?r.pop():r.splice(o,1)[0]}function X(r,o){const a=[];for(let h=0;h<r;h++)a.push(o);return a}function at(r,o,a){let h=ot(r,o);return h>=0?r[1|h]=a:(h=~h,function Me(r,o,a,h){let y=r.length;if(y==o)r.push(a,h);else if(1===y)r.push(h,r[0]),r[0]=a;else{for(y--,r.push(r[y-1],r[y]);y>o;)r[y]=r[y-2],y--;r[o]=a,r[o+1]=h}}(r,h,o,a)),h}function Ze(r,o){const a=ot(r,o);if(a>=0)return r[1|a]}function ot(r,o){return function it(r,o,a){let h=0,y=r.length>>a;for(;y!==h;){const w=h+(y-h>>1),S=r[w<<a];if(o===S)return w<<a;S>o?y=w:h=w+1}return~(y<<a)}(r,o,1)}const yn={},mn="__NG_DI_FLAG__",ui="ngTempTokenPath",nr=/\n/gm,vi="__source",qi=ye({provide:String,useValue:ye});let Mr;function Qr(r){const o=Mr;return Mr=r,o}function Zi(r,o=lt.Default){if(void 0===Mr)throw new Be(203,"");return null===Mr?He(r,void 0,o):Mr.get(r,o&lt.Optional?null:void 0,o)}function Pi(r,o=lt.Default){return(function Rt(){return Le}()||Zi)(ze(r),o)}function bs(r){const o=[];for(let a=0;a<r.length;a++){const h=ze(r[a]);if(Array.isArray(h)){if(0===h.length)throw new Be(900,"");let y,w=lt.Default;for(let S=0;S<h.length;S++){const B=h[S],Z=ya(B);"number"==typeof Z?-1===Z?y=B.token:w|=Z:y=B}o.push(Pi(y,w))}else o.push(Pi(h))}return o}function ws(r,o){return r[mn]=o,r.prototype[mn]=o,r}function ya(r){return r[mn]}const ir=ws(Si("Inject",r=>({token:r})),-1),no=ws(Si("Optional"),8),Hr=ws(Si("SkipSelf"),4);class oa{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function yl(r){return r instanceof oa?r.changingThisBreaksApplicationSecurity:r}const uf=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,df=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var mo=(()=>((mo=mo||{})[mo.NONE=0]="NONE",mo[mo.HTML=1]="HTML",mo[mo.STYLE=2]="STYLE",mo[mo.SCRIPT=3]="SCRIPT",mo[mo.URL=4]="URL",mo[mo.RESOURCE_URL=5]="RESOURCE_URL",mo))();function Ah(r){const o=function er(){const r=In();return r&&r[12]}();return o?o.sanitize(mo.URL,r)||"":function Ra(r,o){const a=function md(r){return r instanceof oa&&r.getTypeName()||null}(r);if(null!=a&&a!==o){if("ResourceURL"===a&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${a} (see https://g.co/ng/security#xss)`)}return a===o}(r,"URL")?yl(r):function ku(r){return(r=String(r)).match(uf)||r.match(df)?r:"unsafe:"+r}(Ge(r))}const Sh="__ngContext__";function Ps(r,o){r[Sh]=o}function ac(r){const o=function xl(r){return r[Sh]||null}(r);return o?Array.isArray(o)?o:o.lView:null}function $l(r){return r.ngOriginalError}function Oh(r,...o){r.error(...o)}class iu{constructor(){this._console=console}handleError(o){const a=this._findOriginalError(o),h=function bd(r){return r&&r.ngErrorLogger||Oh}(o);h(this._console,"ERROR",o),a&&h(this._console,"ORIGINAL ERROR",a)}_findOriginalError(o){let a=o&&$l(o);for(;a&&$l(a);)a=$l(a);return a||null}}const xf=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(yi))();function bl(r){return r instanceof Function?r():r}var wl=(()=>((wl=wl||{})[wl.Important=1]="Important",wl[wl.DashCase=2]="DashCase",wl))();function Lh(r,o){return undefined(r,o)}function Rc(r){const o=r[3];return Ri(o)?o[3]:o}function Tl(r){return Tf(r[13])}function Ws(r){return Tf(r[4])}function Tf(r){for(;null!==r&&!Ri(r);)r=r[4];return r}function su(r,o,a,h,y){if(null!=h){let w,S=!1;Ri(h)?w=h:on(h)&&(S=!0,h=h[0]);const B=Fi(h);0===r&&null!==a?null==y?Oo(o,a,B):kc(o,a,B,y||null,!0):1===r&&null!==a?kc(o,a,B,y||null,!0):2===r?function Pf(r,o,a){const h=Fc(r,o);h&&function Sf(r,o,a,h){Hn(r)?r.removeChild(o,a,h):o.removeChild(a)}(r,h,o,a)}(o,B,S):3===r&&o.destroyNode(B),null!=w&&function Od(r,o,a,h,y){const w=a[7];w!==Fi(a)&&su(o,r,h,w,y);for(let B=10;B<a.length;B++){const Z=a[B];Zu(Z[1],Z,r,o,h,w)}}(o,r,w,a,y)}}function Nh(r,o,a){if(Hn(r))return r.createElement(o,a);{const h=null!==a?function te(r){const o=r.toLowerCase();return"svg"===o?"http://www.w3.org/2000/svg":"math"===o?"http://www.w3.org/1998/MathML/":null}(a):null;return null===h?r.createElement(o):r.createElementNS(h,o)}}function If(r,o){const a=r[9],h=a.indexOf(o),y=o[3];1024&o[2]&&(o[2]&=-1025,$s(y,-1)),a.splice(h,1)}function zh(r,o){if(r.length<=10)return;const a=10+o,h=r[a];if(h){const y=h[17];null!==y&&y!==r&&If(y,h),o>0&&(r[a-1][4]=h[4]);const w=$(r,10+o);!function Id(r,o){Zu(r,o,o[11],2,null,null),o[0]=null,o[6]=null}(h[1],h);const S=w[19];null!==S&&S.detachView(w[1]),h[3]=null,h[4]=null,h[2]&=-129}return h}function Mf(r,o){if(!(256&o[2])){const a=o[11];Hn(a)&&a.destroyNode&&Zu(r,o,a,3,null,null),function Nu(r){let o=r[13];if(!o)return Uh(r[1],r);for(;o;){let a=null;if(on(o))a=o[13];else{const h=o[10];h&&(a=h)}if(!a){for(;o&&!o[4]&&o!==r;)on(o)&&Uh(o[1],o),o=o[3];null===o&&(o=r),on(o)&&Uh(o[1],o),a=o&&o[4]}o=a}}(o)}}function Uh(r,o){if(!(256&o[2])){o[2]&=-129,o[2]|=256,function Zh(r,o){let a;if(null!=r&&null!=(a=r.destroyHooks))for(let h=0;h<a.length;h+=2){const y=o[a[h]];if(!(y instanceof Za)){const w=a[h+1];if(Array.isArray(w))for(let S=0;S<w.length;S+=2){const B=y[w[S]],Z=w[S+1];try{Z.call(B)}finally{}}else try{w.call(y)}finally{}}}}(r,o),function dg(r,o){const a=r.cleanup,h=o[7];let y=-1;if(null!==a)for(let w=0;w<a.length-1;w+=2)if("string"==typeof a[w]){const S=a[w+1],B="function"==typeof S?S(o):Fi(o[S]),Z=h[y=a[w+2]],fe=a[w+3];"boolean"==typeof fe?B.removeEventListener(a[w],Z,fe):fe>=0?h[y=fe]():h[y=-fe].unsubscribe(),w+=2}else{const S=h[y=a[w+1]];a[w].call(S)}if(null!==h){for(let w=y+1;w<h.length;w++)h[w]();o[7]=null}}(r,o),1===o[1].type&&Hn(o[11])&&o[11].destroy();const a=o[17];if(null!==a&&Ri(o[3])){a!==o[3]&&If(a,o);const h=o[19];null!==h&&h.detachView(r)}}}function Af(r,o,a){return function Lc(r,o,a){let h=o;for(;null!==h&&40&h.type;)h=(o=h).parent;if(null===h)return a[0];if(2&h.flags){const y=r.data[h.directiveStart].encapsulation;if(y===mi.None||y===mi.Emulated)return null}return W(h,a)}(r,o.parent,a)}function kc(r,o,a,h,y){Hn(r)?r.insertBefore(o,a,h,y):o.insertBefore(a,h,y)}function Oo(r,o,a){Hn(r)?r.appendChild(o,a):o.appendChild(a)}function zu(r,o,a,h,y){null!==h?kc(r,o,a,h,y):Oo(r,o,a)}function Fc(r,o){return Hn(r)?r.parentNode(o):o.parentNode}function au(r,o,a){return $h(r,o,a)}let $h=function Vh(r,o,a){return 40&r.type?W(r,a):null};function lu(r,o,a,h){const y=Af(r,h,o),w=o[11],B=au(h.parent||o[6],h,o);if(null!=y)if(Array.isArray(a))for(let Z=0;Z<a.length;Z++)zu(w,y,a[Z],B,!1);else zu(w,y,a,B,!1)}function Sd(r,o){if(null!==o){const a=o.type;if(3&a)return W(o,r);if(4&a)return Nc(-1,r[o.index]);if(8&a){const h=o.child;if(null!==h)return Sd(r,h);{const y=r[o.index];return Ri(y)?Nc(-1,y):Fi(y)}}if(32&a)return Lh(o,r)()||Fi(r[o.index]);{const h=jh(r,o);return null!==h?Array.isArray(h)?h[0]:Sd(Rc(r[16]),h):Sd(r,o.next)}}return null}function jh(r,o){return null!==o?r[16][6].projection[o.projection]:null}function Nc(r,o){const a=10+r+1;if(a<o.length){const h=o[a],y=h[1].firstChild;if(null!==y)return Sd(h,y)}return o[7]}function Uu(r,o,a,h,y,w,S){for(;null!=a;){const B=h[a.index],Z=a.type;if(S&&0===o&&(B&&Ps(Fi(B),h),a.flags|=4),64!=(64&a.flags))if(8&Z)Uu(r,o,a.child,h,y,w,!1),su(o,r,y,B,w);else if(32&Z){const fe=Lh(a,h);let Te;for(;Te=fe();)su(o,r,y,Te,w);su(o,r,y,B,w)}else 16&Z?Pd(r,o,h,a,y,w):su(o,r,y,B,w);a=S?a.projectionNext:a.next}}function Zu(r,o,a,h,y,w){Uu(a,h,r.firstChild,o,y,w,!1)}function Pd(r,o,a,h,y,w){const S=a[16],Z=S[6].projection[h.projection];if(Array.isArray(Z))for(let fe=0;fe<Z.length;fe++)su(o,r,y,Z[fe],w);else Uu(r,o,Z,S[3],y,w,!0)}function Of(r,o,a){Hn(r)?r.setAttribute(o,"style",a):o.style.cssText=a}function qh(r,o,a){Hn(r)?""===a?r.removeAttribute(o,"class"):r.setAttribute(o,"class",a):o.className=a}function Rf(r,o,a){let h=r.length;for(;;){const y=r.indexOf(o,a);if(-1===y)return y;if(0===y||r.charCodeAt(y-1)<=32){const w=o.length;if(y+w===h||r.charCodeAt(y+w)<=32)return y}a=y+1}}const Hh="ng-template";function cu(r,o,a){let h=0;for(;h<r.length;){let y=r[h++];if(a&&"class"===y){if(y=r[h],-1!==Rf(y.toLowerCase(),o,0))return!0}else if(1===y){for(;h<r.length&&"string"==typeof(y=r[h++]);)if(y.toLowerCase()===o)return!0;return!1}}return!1}function Lf(r){return 4===r.type&&r.value!==Hh}function pg(r,o,a){return o===(4!==r.type||a?r.value:Hh)}function kf(r,o,a){let h=4;const y=r.attrs||[],w=function mg(r){for(let o=0;o<r.length;o++)if(os(r[o]))return o;return r.length}(y);let S=!1;for(let B=0;B<o.length;B++){const Z=o[B];if("number"!=typeof Z){if(!S)if(4&h){if(h=2|1&h,""!==Z&&!pg(r,Z,a)||""===Z&&1===o.length){if(ka(h))return!1;S=!0}}else{const fe=8&h?Z:o[++B];if(8&h&&null!==r.attrs){if(!cu(r.attrs,fe,a)){if(ka(h))return!1;S=!0}continue}const Qe=fg(8&h?"class":Z,y,Lf(r),a);if(-1===Qe){if(ka(h))return!1;S=!0;continue}if(""!==fe){let Et;Et=Qe>w?"":y[Qe+1].toLowerCase();const qt=8&h?Et:null;if(qt&&-1!==Rf(qt,fe,0)||2&h&&fe!==Et){if(ka(h))return!1;S=!0}}}}else{if(!S&&!ka(h)&&!ka(Z))return!1;if(S&&ka(Z))continue;S=!1,h=Z|1&h}}return ka(h)||S}function ka(r){return 0==(1&r)}function fg(r,o,a,h){if(null===o)return-1;let y=0;if(h||!a){let w=!1;for(;y<o.length;){const S=o[y];if(S===r)return y;if(3===S||6===S)w=!0;else{if(1===S||2===S){let B=o[++y];for(;"string"==typeof B;)B=o[++y];continue}if(4===S)break;if(0===S){y+=4;continue}}y+=w?1:2}return-1}return function gg(r,o){let a=r.indexOf(4);if(a>-1)for(a++;a<r.length;){const h=r[a];if("number"==typeof h)return-1;if(h===o)return a;a++}return-1}(o,r)}function Ff(r,o,a=!1){for(let h=0;h<o.length;h++)if(kf(r,o[h],a))return!0;return!1}function Vu(r,o){e:for(let a=0;a<o.length;a++){const h=o[a];if(r.length===h.length){for(let y=0;y<r.length;y++)if(r[y]!==h[y])continue e;return!0}}return!1}function Wh(r,o){return r?":not("+o.trim()+")":o}function Yh(r){let o=r[0],a=1,h=2,y="",w=!1;for(;a<r.length;){let S=r[a];if("string"==typeof S)if(2&h){const B=r[++a];y+="["+S+(B.length>0?'="'+B+'"':"")+"]"}else 8&h?y+="."+S:4&h&&(y+=" "+S);else""!==y&&!ka(S)&&(o+=Wh(w,y),y=""),h=S,w=w||!ka(h);a++}return""!==y&&(o+=Wh(w,y)),o}const Xi={};function Jh(r){Xh(ar(),In(),uo()+r,Po())}function Xh(r,o,a,h){if(!h)if(3==(3&o[2])){const w=r.preOrderCheckHooks;null!==w&&Ua(o,w,a)}else{const w=r.preOrderHooks;null!==w&&ga(o,w,0,a)}Ss(a)}function Rd(r,o){return r<<17|o<<2}function tl(r){return r>>17&32767}function Kh(r){return 2|r}function jl(r){return(131068&r)>>2}function uu(r,o){return-131069&r|o<<2}function Ld(r){return 1|r}function zd(r,o){const a=r.contentQueries;if(null!==a)for(let h=0;h<a.length;h+=2){const y=a[h],w=a[h+1];if(-1!==w){const S=r.data[w];De(y),S.contentQueries(2,o[w],w)}}}function ql(r,o,a,h,y,w,S,B,Z,fe){const Te=o.blueprint.slice();return Te[0]=y,Te[2]=140|h,cs(Te),Te[3]=Te[15]=r,Te[8]=a,Te[10]=S||r&&r[10],Te[11]=B||r&&r[11],Te[12]=Z||r&&r[12]||null,Te[9]=fe||r&&r[9]||null,Te[6]=w,Te[16]=2==o.type?r[16]:Te,Te}function nl(r,o,a,h,y){let w=r.data[o];if(null===w)w=function Gu(r,o,a,h,y){const w=us(),S=rs(),Z=r.data[o]=function Jf(r,o,a,h,y,w){return{type:a,index:h,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:y,attrs:w,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,S?w:w&&w.parent,a,o,h,y);return null===r.firstChild&&(r.firstChild=Z),null!==w&&(S?null==w.child&&null!==Z.parent&&(w.child=Z):null===w.next&&(w.next=Z)),Z}(r,o,a,h,y),function dl(){return Ui.lFrame.inI18n}()&&(w.flags|=64);else if(64&w.type){w.type=a,w.value=h,w.attrs=y;const S=function Uo(){const r=Ui.lFrame,o=r.currentTNode;return r.isParent?o:o.parent}();w.injectorIndex=null===S?-1:S.injectorIndex}return vo(w,!0),w}function Hl(r,o,a,h){if(0===a)return-1;const y=o.length;for(let w=0;w<a;w++)o.push(h),r.blueprint.push(h),r.data.push(null);return y}function qu(r,o,a){Xn(o);try{const h=r.viewQuery;null!==h&&_u(1,h,a);const y=r.template;null!==y&&Yf(r,o,y,1,a),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&zd(r,o),r.staticViewQueries&&_u(2,r.viewQuery,a);const w=r.components;null!==w&&function ba(r,o){for(let a=0;a<o.length;a++)Bg(r,o[a])}(o,w)}catch(h){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),h}finally{o[2]&=-5,Lr()}}function Zc(r,o,a,h){const y=o[2];if(256==(256&y))return;Xn(o);const w=Po();try{cs(o),function _s(r){return Ui.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==a&&Yf(r,o,a,2,h);const S=3==(3&y);if(!w)if(S){const fe=r.preOrderCheckHooks;null!==fe&&Ua(o,fe,null)}else{const fe=r.preOrderHooks;null!==fe&&ga(o,fe,0,null),Da(o,0)}if(function mp(r){for(let o=Tl(r);null!==o;o=Ws(o)){if(!o[2])continue;const a=o[9];for(let h=0;h<a.length;h++){const y=a[h],w=y[3];0==(1024&y[2])&&$s(w,1),y[2]|=1024}}}(o),function qd(r){for(let o=Tl(r);null!==o;o=Ws(o))for(let a=10;a<o.length;a++){const h=o[a],y=h[1];Rr(h)&&Zc(y,h,y.template,h[8])}}(o),null!==r.contentQueries&&zd(r,o),!w)if(S){const fe=r.contentCheckHooks;null!==fe&&Ua(o,fe)}else{const fe=r.contentHooks;null!==fe&&ga(o,fe,1),Da(o,1)}!function ap(r,o){const a=r.hostBindingOpCodes;if(null!==a)try{for(let h=0;h<a.length;h++){const y=a[h];if(y<0)Ss(~y);else{const w=y,S=a[++h],B=a[++h];Vo(S,w),B(2,o[w])}}}finally{Ss(-1)}}(r,o);const B=r.components;null!==B&&function Hf(r,o){for(let a=0;a<o.length;a++)Fg(r,o[a])}(o,B);const Z=r.viewQuery;if(null!==Z&&_u(2,Z,h),!w)if(S){const fe=r.viewCheckHooks;null!==fe&&Ua(o,fe)}else{const fe=r.viewHooks;null!==fe&&ga(o,fe,2),Da(o,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),w||(o[2]&=-73),1024&o[2]&&(o[2]&=-1025,$s(o[3],-1))}finally{Lr()}}function Wf(r,o,a,h){const y=o[10],w=!Po(),S=Or(o);try{w&&!S&&y.begin&&y.begin(),S&&qu(r,o,h),Zc(r,o,a,h)}finally{w&&!S&&y.end&&y.end()}}function Yf(r,o,a,h,y){const w=uo(),S=2&h;try{Ss(-1),S&&o.length>20&&Xh(r,o,20,Po()),a(h,y)}finally{Ss(w)}}function lp(r,o,a){if(Ur(o)){const y=o.directiveEnd;for(let w=o.directiveStart;w<y;w++){const S=r.data[w];S.contentQueries&&S.contentQueries(1,a[w],w)}}}function Ud(r,o,a){!Ea()||(function jd(r,o,a,h){const y=a.directiveStart,w=a.directiveEnd;r.firstCreatePass||Pa(a,o),Ps(h,o);const S=a.initialInputs;for(let B=y;B<w;B++){const Z=r.data[B],fe=Qi(Z);fe&&nm(o,a,Z);const Te=_l(o,r,B,a);Ps(Te,o),null!==S&&Lg(0,B-y,Te,Z,0,S),fe&&(ei(a.index,o)[8]=Te)}}(r,o,a,W(a,o)),128==(128&a.flags)&&function Pg(r,o,a){const h=a.directiveStart,y=a.directiveEnd,S=a.index,B=function D(){return Ui.lFrame.currentDirectiveIndex}();try{Ss(S);for(let Z=h;Z<y;Z++){const fe=r.data[Z],Te=o[Z];N(Z),(null!==fe.hostBindings||0!==fe.hostVars||null!==fe.hostAttrs)&&Qf(fe,Te)}}finally{Ss(-1),N(B)}}(r,o,a))}function Hu(r,o,a=W){const h=o.localNames;if(null!==h){let y=o.index+1;for(let w=0;w<h.length;w+=2){const S=h[w+1],B=-1===S?a(o,r):r[S];r[y++]=B}}}function Zd(r){const o=r.tView;return null===o||o.incompleteFirstPass?r.tView=Wu(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts):o}function Wu(r,o,a,h,y,w,S,B,Z,fe){const Te=20+h,Qe=Te+y,Et=function Dg(r,o){const a=[];for(let h=0;h<o;h++)a.push(h<r?null:Xi);return a}(Te,Qe),qt="function"==typeof fe?fe():fe;return Et[1]={type:r,blueprint:Et,template:a,queries:null,viewQuery:B,declTNode:o,data:Et.slice().fill(null,Te),bindingStartIndex:Te,expandoStartIndex:Qe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof w?w():w,pipeRegistry:"function"==typeof S?S():S,firstChild:null,schemas:Z,consts:qt,incompleteFirstPass:!1}}function dp(r,o,a,h){const y=om(o);null===a?y.push(h):(y.push(a),r.firstCreatePass&&sm(r).push(h,y.length-1))}function hp(r,o,a){for(let h in r)if(r.hasOwnProperty(h)){const y=r[h];(a=null===a?{}:a).hasOwnProperty(h)?a[h].push(o,y):a[h]=[o,y]}return a}function sa(r,o,a,h,y,w,S,B){const Z=W(o,a);let Te,fe=o.inputs;!B&&null!=fe&&(Te=fe[h])?(xp(r,a,Te,h,y),ji(o)&&function Xf(r,o){const a=ei(o,r);16&a[2]||(a[2]|=64)}(a,o.index)):3&o.type&&(h=function Mg(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(h),y=null!=S?S(y,o.value||"",h):y,Hn(w)?w.setProperty(Z,h,y):Ia(h)||(Z.setProperty?Z.setProperty(h,y):Z[h]=y))}function fu(r,o,a,h){let y=!1;if(Ea()){const w=function Og(r,o,a){const h=r.directiveRegistry;let y=null;if(h)for(let w=0;w<h.length;w++){const S=h[w];Ff(a,S.selectors,!1)&&(y||(y=[]),qa(Pa(a,o),r,S.type),Qi(S)?(em(r,a),y.unshift(S)):y.push(S))}return y}(r,o,a),S=null===h?null:{"":-1};if(null!==w){y=!0,Gd(a,r.data.length,w.length);for(let Te=0;Te<w.length;Te++){const Qe=w[Te];Qe.providersResolver&&Qe.providersResolver(Qe)}let B=!1,Z=!1,fe=Hl(r,o,w.length,null);for(let Te=0;Te<w.length;Te++){const Qe=w[Te];a.mergedAttrs=ja(a.mergedAttrs,Qe.hostAttrs),tm(r,a,o,fe,Qe),mu(fe,Qe,S),null!==Qe.contentQueries&&(a.flags|=8),(null!==Qe.hostBindings||null!==Qe.hostAttrs||0!==Qe.hostVars)&&(a.flags|=128);const Et=Qe.type.prototype;!B&&(Et.ngOnChanges||Et.ngOnInit||Et.ngDoCheck)&&((r.preOrderHooks||(r.preOrderHooks=[])).push(a.index),B=!0),!Z&&(Et.ngOnChanges||Et.ngDoCheck)&&((r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(a.index),Z=!0),fe++}!function Ig(r,o){const h=o.directiveEnd,y=r.data,w=o.attrs,S=[];let B=null,Z=null;for(let fe=o.directiveStart;fe<h;fe++){const Te=y[fe],Qe=Te.inputs,Et=null===w||Lf(o)?null:hc(Qe,w);S.push(Et),B=hp(Qe,fe,B),Z=hp(Te.outputs,fe,Z)}null!==B&&(B.hasOwnProperty("class")&&(o.flags|=16),B.hasOwnProperty("style")&&(o.flags|=32)),o.initialInputs=S,o.inputs=B,o.outputs=Z}(r,a)}S&&function Rg(r,o,a){if(o){const h=r.localNames=[];for(let y=0;y<o.length;y+=2){const w=a[o[y+1]];if(null==w)throw new Be(-301,!1);h.push(o[y],w)}}}(a,h,S)}return a.mergedAttrs=ja(a.mergedAttrs,a.attrs),y}function pp(r,o,a,h,y,w){const S=w.hostBindings;if(S){let B=r.hostBindingOpCodes;null===B&&(B=r.hostBindingOpCodes=[]);const Z=~o.index;(function $d(r){let o=r.length;for(;o>0;){const a=r[--o];if("number"==typeof a&&a<0)return a}return 0})(B)!=Z&&B.push(Z),B.push(h,y,S)}}function Qf(r,o){null!==r.hostBindings&&r.hostBindings(1,o)}function em(r,o){o.flags|=2,(r.components||(r.components=[])).push(o.index)}function mu(r,o,a){if(a){if(o.exportAs)for(let h=0;h<o.exportAs.length;h++)a[o.exportAs[h]]=r;Qi(o)&&(a[""]=r)}}function Gd(r,o,a){r.flags|=1,r.directiveStart=o,r.directiveEnd=o+a,r.providerIndexes=o}function tm(r,o,a,h,y){r.data[h]=y;const w=y.factory||(y.factory=oo(y.type)),S=new Za(w,Qi(y),null);r.blueprint[h]=S,a[h]=S,pp(r,o,0,h,Hl(r,a,y.hostVars,Xi),y)}function nm(r,o,a){const h=W(o,r),y=Zd(a),w=r[10],S=gu(r,ql(r,y,null,a.onPush?64:16,h,o,w,w.createRenderer(h,a),null,null));r[o.index]=S}function El(r,o,a,h,y,w){const S=W(r,o);!function Xu(r,o,a,h,y,w,S){if(null==w)Hn(r)?r.removeAttribute(o,y,a):o.removeAttribute(y);else{const B=null==S?Ge(w):S(w,h||"",y);Hn(r)?r.setAttribute(o,y,B,a):a?o.setAttributeNS(a,y,B):o.setAttribute(y,B)}}(o[11],S,w,r.value,a,h,y)}function Lg(r,o,a,h,y,w){const S=w[o];if(null!==S){const B=h.setInput;for(let Z=0;Z<S.length;){const fe=S[Z++],Te=S[Z++],Qe=S[Z++];null!==B?h.setInput(a,Qe,fe,Te):a[Te]=Qe}}}function hc(r,o){let a=null,h=0;for(;h<o.length;){const y=o[h];if(0!==y)if(5!==y){if("number"==typeof y)break;r.hasOwnProperty(y)&&(null===a&&(a=[]),a.push(y,r[y],o[h+1])),h+=2}else h+=2;else h+=4}return a}function fp(r,o,a,h){return new Array(r,!0,!1,o,null,0,h,a,null,null)}function Fg(r,o){const a=ei(o,r);if(Rr(a)){const h=a[1];80&a[2]?Zc(h,a,h.template,a[8]):a[5]>0&&gp(a)}}function gp(r){for(let h=Tl(r);null!==h;h=Ws(h))for(let y=10;y<h.length;y++){const w=h[y];if(1024&w[2]){const S=w[1];Zc(S,w,S.template,w[8])}else w[5]>0&&gp(w)}const a=r[1].components;if(null!==a)for(let h=0;h<a.length;h++){const y=ei(a[h],r);Rr(y)&&y[5]>0&&gp(y)}}function Bg(r,o){const a=ei(o,r),h=a[1];(function Hd(r,o){for(let a=o.length;a<r.blueprint.length;a++)o.push(r.blueprint[a])})(h,a),qu(h,a,a[8])}function gu(r,o){return r[13]?r[14][4]=o:r[13]=o,r[14]=o,o}function _p(r){for(;r;){r[2]|=64;const o=Rc(r);if(Ao(r)&&!o)return r;r=o}return null}function Dl(r,o,a){const h=o[10];h.begin&&h.begin();try{Zc(r,o,r.template,a)}catch(y){throw am(o,y),y}finally{h.end&&h.end()}}function im(r){!function Ku(r){for(let o=0;o<r.components.length;o++){const a=r.components[o],h=ac(a),y=h[1];Wf(y,h,y.template,a)}}(r[8])}function _u(r,o,a){De(0),o(r,a)}const Ng=(()=>Promise.resolve(null))();function om(r){return r[7]||(r[7]=[])}function sm(r){return r.cleanup||(r.cleanup=[])}function am(r,o){const a=r[9],h=a?a.get(iu,null):null;h&&h.handleError(o)}function xp(r,o,a,h,y){for(let w=0;w<a.length;){const S=a[w++],B=a[w++],Z=o[S],fe=r.data[S];null!==fe.setInput?fe.setInput(Z,y,h,B):Z[B]=y}}function Il(r,o,a){const h=ie(o,r);!function Ef(r,o,a){Hn(r)?r.setValue(o,a):o.textContent=a}(r[11],h,a)}function Qu(r,o,a){let h=a?r.styles:null,y=a?r.classes:null,w=0;if(null!==o)for(let S=0;S<o.length;S++){const B=o[S];"number"==typeof B?w=B:1==w?y=We(y,B):2==w&&(h=We(h,B+": "+o[++S]+";"))}a?r.styles=h:r.stylesWithoutHost=h,a?r.classes=y:r.classesWithoutHost=y}const ed=new Ir("INJECTOR",-1);class cm{get(o,a=yn){if(a===yn){const h=new Error(`NullInjectorError: No provider for ${Ee(o)}!`);throw h.name="NullInjectorError",h}return a}}const wp=new Ir("Set Injector scope."),yu={},zg={};let Jd;function td(){return void 0===Jd&&(Jd=new cm),Jd}function Xd(r,o=null,a=null,h){const y=Bs(r,o,a,h);return y._resolveInjectorDefTypes(),y}function Bs(r,o=null,a=null,h){return new nd(r,a,o||td(),h)}class nd{constructor(o,a,h,y=null){this.parent=h,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const w=[];a&&I(a,B=>this.processProvider(B,o,a)),I([o],B=>this.processInjectorType(B,[],w)),this.records.set(ed,fc(void 0,this));const S=this.records.get(wp);this.scope=null!=S?S.value:null,this.source=y||("object"==typeof o?null:Ee(o))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(o=>o.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(o,a=yn,h=lt.Default){this.assertNotDestroyed();const y=Qr(this),w=me(void 0);try{if(!(h&lt.SkipSelf)){let B=this.records.get(o);if(void 0===B){const Z=function pm(r){return"function"==typeof r||"object"==typeof r&&r instanceof Ir}(o)&&Bi(o);B=Z&&this.injectableDefInScope(Z)?fc(pc(o),yu):null,this.records.set(o,B)}if(null!=B)return this.hydrate(o,B)}return(h&lt.Self?td():this.parent).get(o,a=h&lt.Optional&&a===yn?null:a)}catch(S){if("NullInjectorError"===S.name){if((S[ui]=S[ui]||[]).unshift(Ee(o)),y)throw S;return function br(r,o,a,h){const y=r[ui];throw o[vi]&&y.unshift(o[vi]),r.message=function Hi(r,o,a,h=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.substr(2):r;let y=Ee(o);if(Array.isArray(o))y=o.map(Ee).join(" -> ");else if("object"==typeof o){let w=[];for(let S in o)if(o.hasOwnProperty(S)){let B=o[S];w.push(S+":"+("string"==typeof B?JSON.stringify(B):Ee(B)))}y=`{${w.join(", ")}}`}return`${a}${h?"("+h+")":""}[${y}]: ${r.replace(nr,"\n  ")}`}("\n"+r.message,y,a,h),r.ngTokenPath=y,r[ui]=null,r}(S,o,"R3InjectorError",this.source)}throw S}finally{me(w),Qr(y)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(o=>this.get(o))}toString(){const o=[];return this.records.forEach((h,y)=>o.push(Ee(y))),`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Be(205,!1)}processInjectorType(o,a,h){if(!(o=ze(o)))return!1;let y=Ti(o);const w=null==y&&o.ngModule||void 0,S=void 0===w?o:w,B=-1!==h.indexOf(S);if(void 0!==w&&(y=Ti(w)),null==y)return!1;if(null!=y.imports&&!B){let Te;h.push(S);try{I(y.imports,Qe=>{this.processInjectorType(Qe,a,h)&&(void 0===Te&&(Te=[]),Te.push(Qe))})}finally{}if(void 0!==Te)for(let Qe=0;Qe<Te.length;Qe++){const{ngModule:Et,providers:qt}=Te[Qe];I(qt,wn=>this.processProvider(wn,Et,qt||Ci))}}this.injectorDefTypes.add(S);const Z=oo(S)||(()=>new S);this.records.set(S,fc(Z,yu));const fe=y.providers;if(null!=fe&&!B){const Te=o;I(fe,Qe=>this.processProvider(Qe,Te,fe))}return void 0!==w&&void 0!==o.providers}processProvider(o,a,h){let y=Vc(o=ze(o))?o:ze(o&&o.provide);const w=function Cp(r,o,a){return Kd(r)?fc(void 0,r.useValue):fc(il(r),yu)}(o);if(Vc(o)||!0!==o.multi)this.records.get(y);else{let S=this.records.get(y);S||(S=fc(void 0,yu,!0),S.factory=()=>bs(S.multi),this.records.set(y,S)),y=o,S.multi.push(o)}this.records.set(y,w)}hydrate(o,a){return a.value===yu&&(a.value=zg,a.value=a.factory()),"object"==typeof a.value&&a.value&&function hm(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(a.value)&&this.onDestroy.add(a.value),a.value}injectableDefInScope(o){if(!o.providedIn)return!1;const a=ze(o.providedIn);return"string"==typeof a?"any"===a||a===this.scope:this.injectorDefTypes.has(a)}}function pc(r){const o=Bi(r),a=null!==o?o.factory:oo(r);if(null!==a)return a;if(r instanceof Ir)throw new Be(204,!1);if(r instanceof Function)return function Tp(r){const o=r.length;if(o>0)throw X(o,"?"),new Be(204,!1);const a=function tr(r){const o=r&&(r[Xt]||r[ae]);if(o){const a=function gi(r){if(r.hasOwnProperty("name"))return r.name;const o=(""+r).match(/^function\s*([^\s(]+)/);return null===o?"":o[1]}(r);return console.warn(`DEPRECATED: DI is instantiating a token "${a}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${a}" class.`),o}return null}(r);return null!==a?()=>a.factory(r):()=>new r}(r);throw new Be(204,!1)}function il(r,o,a){let h;if(Vc(r)){const y=ze(r);return oo(y)||pc(y)}if(Kd(r))h=()=>ze(r.useValue);else if(function um(r){return!(!r||!r.useFactory)}(r))h=()=>r.useFactory(...bs(r.deps||[]));else if(function rl(r){return!(!r||!r.useExisting)}(r))h=()=>Pi(ze(r.useExisting));else{const y=ze(r&&(r.useClass||r.provide));if(!function dm(r){return!!r.deps}(r))return oo(y)||pc(y);h=()=>new y(...bs(r.deps))}return h}function fc(r,o,a=!1){return{factory:r,value:o,multi:a?[]:void 0}}function Kd(r){return null!==r&&"object"==typeof r&&qi in r}function Vc(r){return"function"==typeof r}let wa=(()=>{class r{static create(a,h){if(Array.isArray(a))return Xd({name:""},h,a,"");{const y=a.name??"";return Xd({name:y},a.parent,a.providers,y)}}}return r.THROW_IF_NOT_FOUND=yn,r.NULL=new cm,r.\u0275prov=li({token:r,providedIn:"any",factory:()=>Pi(ed)}),r.__NG_ELEMENT_ID__=-1,r})();function vm(r,o){cr(ac(r)[1],Yr())}function Ns(r){let o=function nh(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),a=!0;const h=[r];for(;o;){let y;if(Qi(r))y=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new Be(903,"");y=o.\u0275dir}if(y){if(a){h.push(y);const S=r;S.inputs=Op(r.inputs),S.declaredInputs=Op(r.declaredInputs),S.outputs=Op(r.outputs);const B=y.hostBindings;B&&Rp(r,B);const Z=y.viewQuery,fe=y.contentQueries;if(Z&&ih(r,Z),fe&&xm(r,fe),xe(r.inputs,y.inputs),xe(r.declaredInputs,y.declaredInputs),xe(r.outputs,y.outputs),Qi(y)&&y.data.animation){const Te=r.data;Te.animation=(Te.animation||[]).concat(y.data.animation)}}const w=y.features;if(w)for(let S=0;S<w.length;S++){const B=w[S];B&&B.ngInherit&&B(r),B===Ns&&(a=!1)}}o=Object.getPrototypeOf(o)}!function aa(r){let o=0,a=null;for(let h=r.length-1;h>=0;h--){const y=r[h];y.hostVars=o+=y.hostVars,y.hostAttrs=ja(y.hostAttrs,a=ja(a,y.hostAttrs))}}(h)}function Op(r){return r===Tr?{}:r===Ci?[]:r}function ih(r,o){const a=r.viewQuery;r.viewQuery=a?(h,y)=>{o(h,y),a(h,y)}:o}function xm(r,o){const a=r.contentQueries;r.contentQueries=a?(h,y,w)=>{o(h,y,w),a(h,y,w)}:o}function Rp(r,o){const a=r.hostBindings;r.hostBindings=a?(h,y)=>{o(h,y),a(h,y)}:o}let id=null;function gc(){if(!id){const r=yi.Symbol;if(r&&r.iterator)id=r.iterator;else{const o=Object.getOwnPropertyNames(Map.prototype);for(let a=0;a<o.length;++a){const h=o[a];"entries"!==h&&"size"!==h&&Map.prototype[h]===Map.prototype.entries&&(id=h)}}}return id}function bu(r){return!!oh(r)&&(Array.isArray(r)||!(r instanceof Map)&&gc()in r)}function oh(r){return null!==r&&("function"==typeof r||"object"==typeof r)}function al(r,o,a){return r[o]=a}function Ho(r,o,a){return!Object.is(r[o],a)&&(r[o]=a,!0)}function jc(r,o,a,h){const y=Ho(r,o,a);return Ho(r,o+1,h)||y}function Gc(r,o,a,h){const y=In();return Ho(y,Zo(),o)&&(ar(),El(Jr(),y,r,o,a,h)),Gc}function Jl(r,o,a,h){return Ho(r,Zo(),a)?o+Ge(a)+h:Xi}function Tu(r,o,a,h,y,w,S,B){const fe=function _c(r,o,a,h,y){const w=jc(r,o,a,h);return Ho(r,o+2,y)||w}(r,Dr(),a,y,S);return ys(3),fe?o+Ge(a)+h+Ge(y)+w+Ge(S)+B:Xi}function ll(r,o,a,h,y,w,S,B,Z,fe){const Qe=function zs(r,o,a,h,y,w){const S=jc(r,o,a,h);return jc(r,o+2,y,w)||S}(r,Dr(),a,y,S,Z);return ys(4),Qe?o+Ge(a)+h+Ge(y)+w+Ge(S)+B+Ge(Z)+fe:Xi}function x(r,o,a,h,y,w,S,B){const Z=In(),fe=ar(),Te=r+20,Qe=fe.firstCreatePass?function _(r,o,a,h,y,w,S,B,Z){const fe=o.consts,Te=nl(o,r,4,S||null,zo(fe,B));fu(o,a,Te,zo(fe,Z)),cr(o,Te);const Qe=Te.tViews=Wu(2,Te,h,y,w,o.directiveRegistry,o.pipeRegistry,null,o.schemas,fe);return null!==o.queries&&(o.queries.template(o,Te),Qe.queries=o.queries.embeddedTView(Te)),Te}(Te,fe,Z,o,a,h,y,w,S):fe.data[Te];vo(Qe,!1);const Et=Z[11].createComment("");lu(fe,Z,Et,Qe),Ps(Et,Z),gu(Z,Z[Te]=fp(Et,Z,Et,Qe)),_r(Qe)&&Ud(fe,Z,Qe),null!=S&&Hu(Z,Qe,B)}function M(r){return dn(function ks(){return Ui.lFrame.contextLView}(),20+r)}function hs(r,o=lt.Default){const a=In();return null===a?Pi(r,o):Sc(Yr(),a,ze(r),o)}function po(){throw new Error("invalid")}function Wo(r,o,a){const h=In();return Ho(h,Zo(),o)&&sa(ar(),Jr(),h,r,o,h[11],a,!1),Wo}function ca(r,o,a,h,y){const S=y?"class":"style";xp(r,a,o.inputs[S],S,h)}function Wr(r,o,a,h){const y=In(),w=ar(),S=20+r,B=y[11],Z=y[S]=Nh(B,o,function Yc(){return Ui.lFrame.currentNamespace}()),fe=w.firstCreatePass?function ps(r,o,a,h,y,w,S){const B=o.consts,fe=nl(o,r,2,y,zo(B,w));return fu(o,a,fe,zo(B,S)),null!==fe.attrs&&Qu(fe,fe.attrs,!1),null!==fe.mergedAttrs&&Qu(fe,fe.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,fe),fe}(S,w,y,0,o,a,h):w.data[S];vo(fe,!0);const Te=fe.mergedAttrs;null!==Te&&$a(B,Z,Te);const Qe=fe.classes;null!==Qe&&qh(B,Z,Qe);const Et=fe.styles;null!==Et&&Of(B,Z,Et),64!=(64&fe.flags)&&lu(w,y,Z,fe),0===function za(){return Ui.lFrame.elementDepthCount}()&&Ps(Z,y),function yr(){Ui.lFrame.elementDepthCount++}(),_r(fe)&&(Ud(w,y,fe),lp(w,fe,y)),null!==h&&Hu(y,fe)}function Yo(){let r=Yr();rs()?ha():(r=r.parent,vo(r,!1));const o=r;!function js(){Ui.lFrame.elementDepthCount--}();const a=ar();a.firstCreatePass&&(cr(a,r),Ur(r)&&a.queries.elementEnd(r)),null!=o.classesWithoutHost&&function pl(r){return 0!=(16&r.flags)}(o)&&ca(a,o,In(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function Dc(r){return 0!=(32&r.flags)}(o)&&ca(a,o,In(),o.stylesWithoutHost,!1)}function _o(r,o,a,h){Wr(r,o,a,h),Yo()}function fs(r,o,a){const h=In(),y=ar(),w=r+20,S=y.firstCreatePass?function ns(r,o,a,h,y){const w=o.consts,S=zo(w,h),B=nl(o,r,8,"ng-container",S);return null!==S&&Qu(B,S,!0),fu(o,a,B,zo(w,y)),null!==o.queries&&o.queries.elementStart(o,B),B}(w,y,h,o,a):y.data[w];vo(S,!0);const B=h[w]=h[11].createComment("");lu(y,h,B,S),Ps(B,h),_r(S)&&(Ud(y,h,S),lp(y,S,h)),null!=a&&Hu(h,S)}function Ds(){let r=Yr();const o=ar();rs()?ha():(r=r.parent,vo(r,!1)),o.firstCreatePass&&(cr(o,r),Ur(r)&&o.queries.elementEnd(r))}function is(){return In()}function Ta(r){return!!r&&"function"==typeof r.then}function Hc(r){return!!r&&"function"==typeof r.subscribe}const Du=Hc;function Wc(r,o,a,h){const y=In(),w=ar(),S=Yr();return function Np(r,o,a,h,y,w,S,B){const Z=_r(h),Te=r.firstCreatePass&&sm(r),Qe=o[8],Et=om(o);let qt=!0;if(3&h.type||B){const ri=W(h,o),wi=B?B(ri):ri,Sn=Et.length,Vi=B?Vr=>B(Fi(Vr[h.index])):h.index;if(Hn(a)){let Vr=null;if(!B&&Z&&(Vr=function Cm(r,o,a,h){const y=r.cleanup;if(null!=y)for(let w=0;w<y.length-1;w+=2){const S=y[w];if(S===a&&y[w+1]===h){const B=o[7],Z=y[w+2];return B.length>Z?B[Z]:null}"string"==typeof S&&(w+=2)}return null}(r,o,y,h.index)),null!==Vr)(Vr.__ngLastListenerFn__||Vr).__ngNextListenerFn__=w,Vr.__ngLastListenerFn__=w,qt=!1;else{w=od(h,o,Qe,w,!1);const yo=a.listen(wi,y,w);Et.push(w,yo),Te&&Te.push(y,Vi,Sn,Sn+1)}}else w=od(h,o,Qe,w,!0),wi.addEventListener(y,w,S),Et.push(w),Te&&Te.push(y,Vi,Sn,S)}else w=od(h,o,Qe,w,!1);const wn=h.outputs;let Wn;if(qt&&null!==wn&&(Wn=wn[y])){const ri=Wn.length;if(ri)for(let wi=0;wi<ri;wi+=2){const ul=o[Wn[wi]][Wn[wi+1]].subscribe(w),cd=Et.length;Et.push(w,ul),Te&&Te.push(y,h.index,cd,-(cd+1))}}}(w,y,y[11],S,r,o,!!a,h),Wc}function zp(r,o,a,h){try{return!1!==a(h)}catch(y){return am(r,y),!1}}function od(r,o,a,h,y){return function w(S){if(S===Function)return h;const B=2&r.flags?ei(r.index,o):o;0==(32&o[2])&&_p(B);let Z=zp(o,0,h,S),fe=w.__ngNextListenerFn__;for(;fe;)Z=zp(o,0,fe,S)&&Z,fe=fe.__ngNextListenerFn__;return y&&!1===Z&&(S.preventDefault(),S.returnValue=!1),Z}}function sh(r=1){return function xo(r){return(Ui.lFrame.contextLView=function Eo(r,o){for(;r>0;)o=o[15],r--;return o}(r,Ui.lFrame.contextLView))[8]}(r)}function Al(r,o){let a=null;const h=function zc(r){const o=r.attrs;if(null!=o){const a=o.indexOf(5);if(0==(1&a))return o[a+1]}return null}(r);for(let y=0;y<o.length;y++){const w=o[y];if("*"!==w){if(null===h?Ff(r,w,!0):Vu(h,w))return y}else a=y}return a}function Up(r){const o=In()[16][6];if(!o.projection){const h=o.projection=X(r?r.length:1,null),y=h.slice();let w=o.child;for(;null!==w;){const S=r?Al(w,r):0;null!==S&&(y[S]?y[S].projectionNext=w:h[S]=w,y[S]=w),w=w.next}}}function ah(r,o=0,a){const h=In(),y=ar(),w=nl(y,20+r,16,null,a||null);null===w.projection&&(w.projection=o),ha(),64!=(64&w.flags)&&function Gh(r,o,a){Pd(o[11],0,o,a,Af(r,a,o),au(a.parent||o[6],a,o))}(y,h,w)}function sd(r,o,a){return Sl(r,"",o,"",a),sd}function Sl(r,o,a,h,y){const w=In(),S=Jl(w,o,a,h);return S!==Xi&&sa(ar(),Jr(),w,r,S,w[11],y,!1),Sl}function ey(r,o,a,h,y){const w=r[a+1],S=null===o;let B=h?tl(w):jl(w),Z=!1;for(;0!==B&&(!1===Z||S);){const Te=r[B+1];M0(r[B],o)&&(Z=!0,r[B+1]=h?Ld(Te):Kh(Te)),B=h?tl(Te):jl(Te)}Z&&(r[a+1]=h?Kh(w):Ld(w))}function M0(r,o){return null===r||null==o||(Array.isArray(r)?r[1]:r)===o||!(!Array.isArray(r)||"string"!=typeof o)&&ot(r,o)>=0}function Gg(r,o,a){return Kl(r,o,a,!1),Gg}function qg(r,o){return Kl(r,o,null,!0),qg}function Kl(r,o,a,h){const y=In(),w=ar(),S=ys(2);w.firstUpdatePass&&function ly(r,o,a,h){const y=r.data;if(null===y[a+1]){const w=y[uo()],S=function ay(r,o){return o>=r.expandoStartIndex}(r,a);(function hy(r,o){return 0!=(r.flags&(o?16:32))})(w,h)&&null===o&&!S&&(o=!1),o=function B0(r,o,a,h){const y=function A(r){const o=Ui.lFrame.currentDirectiveIndex;return-1===o?null:r[o]}(r);let w=h?o.residualClasses:o.residualStyles;if(null===y)0===(h?o.classBindings:o.styleBindings)&&(a=Vp(a=Hg(null,r,o,a,h),o.attrs,h),w=null);else{const S=o.directiveStylingLast;if(-1===S||r[S]!==y)if(a=Hg(y,r,o,a,h),null===w){let Z=function N0(r,o,a){const h=a?o.classBindings:o.styleBindings;if(0!==jl(h))return r[tl(h)]}(r,o,h);void 0!==Z&&Array.isArray(Z)&&(Z=Hg(null,r,o,Z[1],h),Z=Vp(Z,o.attrs,h),function z0(r,o,a,h){r[tl(a?o.classBindings:o.styleBindings)]=h}(r,o,h,Z))}else w=function U0(r,o,a){let h;const y=o.directiveEnd;for(let w=1+o.directiveStylingLast;w<y;w++)h=Vp(h,r[w].hostAttrs,a);return Vp(h,o.attrs,a)}(r,o,h)}return void 0!==w&&(h?o.residualClasses=w:o.residualStyles=w),a}(y,w,o,h),function D0(r,o,a,h,y,w){let S=w?o.classBindings:o.styleBindings,B=tl(S),Z=jl(S);r[h]=a;let Te,fe=!1;if(Array.isArray(a)){const Qe=a;Te=Qe[1],(null===Te||ot(Qe,Te)>0)&&(fe=!0)}else Te=a;if(y)if(0!==Z){const Et=tl(r[B+1]);r[h+1]=Rd(Et,B),0!==Et&&(r[Et+1]=uu(r[Et+1],h)),r[B+1]=function vg(r,o){return 131071&r|o<<17}(r[B+1],h)}else r[h+1]=Rd(B,0),0!==B&&(r[B+1]=uu(r[B+1],h)),B=h;else r[h+1]=Rd(Z,0),0===B?B=h:r[Z+1]=uu(r[Z+1],h),Z=h;fe&&(r[h+1]=Kh(r[h+1])),ey(r,Te,h,!0),ey(r,Te,h,!1),function I0(r,o,a,h,y){const w=y?r.residualClasses:r.residualStyles;null!=w&&"string"==typeof o&&ot(w,o)>=0&&(a[h+1]=Ld(a[h+1]))}(o,Te,r,h,w),S=Rd(B,Z),w?o.classBindings=S:o.styleBindings=S}(y,w,o,a,S,h)}}(w,r,S,h),o!==Xi&&Ho(y,S,o)&&function uy(r,o,a,h,y,w,S,B){if(!(3&o.type))return;const Z=r.data,fe=Z[B+1];Dm(function zf(r){return 1==(1&r)}(fe)?dy(Z,o,a,y,jl(fe),S):void 0)||(Dm(w)||function Nf(r){return 2==(2&r)}(fe)&&(w=dy(Z,null,a,y,B,S)),function hg(r,o,a,h,y){const w=Hn(r);if(o)y?w?r.addClass(a,h):a.classList.add(h):w?r.removeClass(a,h):a.classList.remove(h);else{let S=-1===h.indexOf("-")?void 0:wl.DashCase;if(null==y)w?r.removeStyle(a,h,S):a.style.removeProperty(h);else{const B="string"==typeof y&&y.endsWith("!important");B&&(y=y.slice(0,-10),S|=wl.Important),w?r.setStyle(a,h,y,S):a.style.setProperty(h,y,B?"important":"")}}}(h,S,ie(uo(),a),y,w))}(w,w.data[uo()],y,y[11],r,y[S+1]=function $0(r,o){return null==r||("string"==typeof o?r+=o:"object"==typeof r&&(r=Ee(yl(r)))),r}(o,a),h,S)}function Hg(r,o,a,h,y){let w=null;const S=a.directiveEnd;let B=a.directiveStylingLast;for(-1===B?B=a.directiveStart:B++;B<S&&(w=o[B],h=Vp(h,w.hostAttrs,y),w!==r);)B++;return null!==r&&(a.directiveStylingLast=B),h}function Vp(r,o,a){const h=a?1:2;let y=-1;if(null!==o)for(let w=0;w<o.length;w++){const S=o[w];"number"==typeof S?y=S:y===h&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),at(r,S,!!a||o[++w]))}return void 0===r?null:r}function dy(r,o,a,h,y,w){const S=null===o;let B;for(;y>0;){const Z=r[y],fe=Array.isArray(Z),Te=fe?Z[1]:Z,Qe=null===Te;let Et=a[y+1];Et===Xi&&(Et=Qe?Ci:void 0);let qt=Qe?Ze(Et,h):Te===h?Et:void 0;if(fe&&!Dm(qt)&&(qt=Ze(Z,h)),Dm(qt)&&(B=qt,S))return B;const wn=r[y+1];y=S?tl(wn):jl(wn)}if(null!==o){let Z=w?o.residualClasses:o.residualStyles;null!=Z&&(B=Ze(Z,h))}return B}function Dm(r){return void 0!==r}function py(r,o=""){const a=In(),h=ar(),y=r+20,w=h.firstCreatePass?nl(h,y,1,o,null):h.data[y],S=a[y]=function Bh(r,o){return Hn(r)?r.createText(o):r.createTextNode(o)}(a[11],o);lu(h,a,S,w),vo(w,!1)}function Wg(r){return Im("",r,""),Wg}function Im(r,o,a){const h=In(),y=Jl(h,r,o,a);return y!==Xi&&Il(h,uo(),y),Im}function Yg(r,o,a,h,y){const w=In(),S=function wu(r,o,a,h,y,w){const B=jc(r,Dr(),a,y);return ys(2),B?o+Ge(a)+h+Ge(y)+w:Xi}(w,r,o,a,h,y);return S!==Xi&&Il(w,uo(),S),Yg}function Jg(r,o,a,h,y,w,S){const B=In(),Z=Tu(B,r,o,a,h,y,w,S);return Z!==Xi&&Il(B,uo(),Z),Jg}function Xg(r,o,a,h,y,w,S,B,Z){const fe=In(),Te=ll(fe,r,o,a,h,y,w,S,B,Z);return Te!==Xi&&Il(fe,uo(),Te),Xg}const ad=void 0;var cx=["en",[["a","p"],["AM","PM"],ad],[["AM","PM"],ad,ad],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],ad,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],ad,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",ad,"{1} 'at' {0}",ad],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function lx(r){const a=Math.floor(Math.abs(r)),h=r.toString().replace(/^[^.]*\.?/,"").length;return 1===a&&0===h?1:5}];let dh={};function Kg(r){const o=function ux(r){return r.toLowerCase().replace(/_/g,"-")}(r);let a=Py(o);if(a)return a;const h=o.split("-")[0];if(a=Py(h),a)return a;if("en"===h)return cx;throw new Error(`Missing locale data for the locale "${r}".`)}function Sy(r){return Kg(r)[Ji.PluralCase]}function Py(r){return r in dh||(dh[r]=yi.ng&&yi.ng.common&&yi.ng.common.locales&&yi.ng.common.locales[r]),dh[r]}var Ji=(()=>((Ji=Ji||{})[Ji.LocaleId=0]="LocaleId",Ji[Ji.DayPeriodsFormat=1]="DayPeriodsFormat",Ji[Ji.DayPeriodsStandalone=2]="DayPeriodsStandalone",Ji[Ji.DaysFormat=3]="DaysFormat",Ji[Ji.DaysStandalone=4]="DaysStandalone",Ji[Ji.MonthsFormat=5]="MonthsFormat",Ji[Ji.MonthsStandalone=6]="MonthsStandalone",Ji[Ji.Eras=7]="Eras",Ji[Ji.FirstDayOfWeek=8]="FirstDayOfWeek",Ji[Ji.WeekendRange=9]="WeekendRange",Ji[Ji.DateFormat=10]="DateFormat",Ji[Ji.TimeFormat=11]="TimeFormat",Ji[Ji.DateTimeFormat=12]="DateTimeFormat",Ji[Ji.NumberSymbols=13]="NumberSymbols",Ji[Ji.NumberFormats=14]="NumberFormats",Ji[Ji.CurrencyCode=15]="CurrencyCode",Ji[Ji.CurrencySymbol=16]="CurrencySymbol",Ji[Ji.CurrencyName=17]="CurrencyName",Ji[Ji.Currencies=18]="Currencies",Ji[Ji.Directionality=19]="Directionality",Ji[Ji.PluralCase=20]="PluralCase",Ji[Ji.ExtraData=21]="ExtraData",Ji))();const Mm="en-US";let Oy=Mm;function t_(r,o,a,h,y){if(r=ze(r),Array.isArray(r))for(let w=0;w<r.length;w++)t_(r[w],o,a,h,y);else{const w=ar(),S=In();let B=Vc(r)?r:ze(r.provide),Z=il(r);const fe=Yr(),Te=1048575&fe.providerIndexes,Qe=fe.directiveStart,Et=fe.providerIndexes>>20;if(Vc(r)||!r.multi){const qt=new Za(Z,y,hs),wn=i_(B,o,y?Te:Te+Et,Qe);-1===wn?(qa(Pa(fe,S),w,B),n_(w,r,o.length),o.push(B),fe.directiveStart++,fe.directiveEnd++,y&&(fe.providerIndexes+=1048576),a.push(qt),S.push(qt)):(a[wn]=qt,S[wn]=qt)}else{const qt=i_(B,o,Te+Et,Qe),wn=i_(B,o,Te,Te+Et),Wn=qt>=0&&a[qt],ri=wn>=0&&a[wn];if(y&&!ri||!y&&!Wn){qa(Pa(fe,S),w,B);const wi=function l1(r,o,a,h,y){const w=new Za(r,a,hs);return w.multi=[],w.index=o,w.componentProviders=0,nv(w,y,h&&!a),w}(y?a1:s1,a.length,y,h,Z);!y&&ri&&(a[wn].providerFactory=wi),n_(w,r,o.length,0),o.push(B),fe.directiveStart++,fe.directiveEnd++,y&&(fe.providerIndexes+=1048576),a.push(wi),S.push(wi)}else n_(w,r,qt>-1?qt:wn,nv(a[y?wn:qt],Z,!y&&h));!y&&h&&ri&&a[wn].componentProviders++}}}function n_(r,o,a,h){const y=Vc(o),w=function Ug(r){return!!r.useClass}(o);if(y||w){const Z=(w?ze(o.useClass):o).prototype.ngOnDestroy;if(Z){const fe=r.destroyHooks||(r.destroyHooks=[]);if(!y&&o.multi){const Te=fe.indexOf(a);-1===Te?fe.push(a,[h,Z]):fe[Te+1].push(h,Z)}else fe.push(a,Z)}}}function nv(r,o,a){return a&&r.componentProviders++,r.multi.push(o)-1}function i_(r,o,a,h){for(let y=a;y<h;y++)if(o[y]===r)return y;return-1}function s1(r,o,a,h){return r_(this.multi,[])}function a1(r,o,a,h){const y=this.multi;let w;if(this.providerFactory){const S=this.providerFactory.componentProviders,B=_l(a,a[1],this.providerFactory.index,h);w=B.slice(0,S),r_(y,w);for(let Z=S;Z<B.length;Z++)w.push(B[Z])}else w=[],r_(y,w);return w}function r_(r,o){for(let a=0;a<r.length;a++)o.push((0,r[a])());return o}function iv(r,o=[]){return a=>{a.providersResolver=(h,y)=>function o1(r,o,a){const h=ar();if(h.firstCreatePass){const y=Qi(r);t_(a,h.data,h.blueprint,y,!0),t_(o,h.data,h.blueprint,y,!1)}}(h,y?y(r):r,o)}}class rv{}class d1{resolveComponentFactory(o){throw function u1(r){const o=Error(`No component factory found for ${Ee(r)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=r,o}(o)}}let Hp=(()=>{class r{}return r.NULL=new d1,r})();function h1(){return ph(Yr(),In())}function ph(r,o){return new Wp(W(r,o))}let Wp=(()=>{class r{constructor(a){this.nativeElement=a}}return r.__NG_ELEMENT_ID__=h1,r})();function p1(r){return r instanceof Wp?r.nativeElement:r}class sv{}let f1=(()=>{class r{}return r.__NG_ELEMENT_ID__=()=>function g1(){const r=In(),a=ei(Yr().index,r);return function m1(r){return r[11]}(on(a)?a:r)}(),r})(),_1=(()=>{class r{}return r.\u0275prov=li({token:r,providedIn:"root",factory:()=>null}),r})();class av{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const y1=new av("13.2.2"),o_={};function Rm(r,o,a,h,y=!1){for(;null!==a;){const w=o[a.index];if(null!==w&&h.push(Fi(w)),Ri(w))for(let B=10;B<w.length;B++){const Z=w[B],fe=Z[1].firstChild;null!==fe&&Rm(Z[1],Z,fe,h)}const S=a.type;if(8&S)Rm(r,o,a.child,h);else if(32&S){const B=Lh(a,o);let Z;for(;Z=B();)h.push(Z)}else if(16&S){const B=jh(o,a);if(Array.isArray(B))h.push(...B);else{const Z=Rc(o[16]);Rm(Z[1],Z,B,h,!0)}}a=y?a.projectionNext:a.next}return h}class Yp{constructor(o,a){this._lView=o,this._cdRefInjectingView=a,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const o=this._lView,a=o[1];return Rm(a,o,a.firstChild,[])}get context(){return this._lView[8]}set context(o){this._lView[8]=o}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[3];if(Ri(o)){const a=o[8],h=a?a.indexOf(this):-1;h>-1&&(zh(o,h),$(a,h))}this._attachedToViewContainer=!1}Mf(this._lView[1],this._lView)}onDestroy(o){dp(this._lView[1],this._lView,null,o)}markForCheck(){_p(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Dl(this._lView[1],this._lView,this.context)}checkNoChanges(){!function vp(r,o,a){qs(!0);try{Dl(r,o,a)}finally{qs(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Be(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function lc(r,o){Zu(r,o,o[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new Be(902,"");this._appRef=o}}class v1 extends Yp{constructor(o){super(o),this._view=o}detectChanges(){im(this._view)}checkNoChanges(){!function rm(r){qs(!0);try{im(r)}finally{qs(!1)}}(this._view)}get context(){return null}}class lv extends Hp{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const a=qn(o);return new s_(a,this.ngModule)}}function cv(r){const o=[];for(let a in r)r.hasOwnProperty(a)&&o.push({propName:r[a],templateName:a});return o}const b1=new Ir("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>xf});class s_ extends rv{constructor(o,a){super(),this.componentDef=o,this.ngModule=a,this.componentType=o.type,this.selector=function _g(r){return r.map(Yh).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!a}get inputs(){return cv(this.componentDef.inputs)}get outputs(){return cv(this.componentDef.outputs)}create(o,a,h,y){const w=(y=y||this.ngModule)?function w1(r,o){return{get:(a,h,y)=>{const w=r.get(a,o_,y);return w!==o_||h===o_?w:o.get(a,h,y)}}}(o,y.injector):o,S=w.get(sv,Fr),B=w.get(_1,null),Z=S.createRenderer(null,this.componentDef),fe=this.componentDef.selectors[0][0]||"div",Te=h?function up(r,o,a){if(Hn(r))return r.selectRootElement(o,a===mi.ShadowDom);let h="string"==typeof o?r.querySelector(o):o;return h.textContent="",h}(Z,h,this.componentDef.encapsulation):Nh(S.createRenderer(null,this.componentDef),fe,function x1(r){const o=r.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(fe)),Qe=this.componentDef.onPush?576:528,Et=function ym(r,o){return{components:[],scheduler:r||xf,clean:Ng,playerHandler:o||null,flags:0}}(),qt=Wu(0,null,null,1,0,null,null,null,null,null),wn=ql(null,qt,Et,Qe,null,null,S,Z,B,w);let Wn,ri;Xn(wn);try{const wi=function th(r,o,a,h,y,w){const S=a[1];a[20]=r;const Z=nl(S,20,2,"#host",null),fe=Z.mergedAttrs=o.hostAttrs;null!==fe&&(Qu(Z,fe,!0),null!==r&&($a(y,r,fe),null!==Z.classes&&qh(y,r,Z.classes),null!==Z.styles&&Of(y,r,Z.styles)));const Te=h.createRenderer(r,o),Qe=ql(a,Zd(o),null,o.onPush?64:16,a[20],Z,h,Te,w||null,null);return S.firstCreatePass&&(qa(Pa(Z,a),S,o.type),em(S,Z),Gd(Z,a.length,1)),gu(a,Qe),a[20]=Qe}(Te,this.componentDef,wn,S,Z);if(Te)if(h)$a(Z,Te,["ng-version",y1.full]);else{const{attrs:Sn,classes:Vi}=function yg(r){const o=[],a=[];let h=1,y=2;for(;h<r.length;){let w=r[h];if("string"==typeof w)2===y?""!==w&&o.push(w,r[++h]):8===y&&a.push(w);else{if(!ka(y))break;y=w}h++}return{attrs:o,classes:a}}(this.componentDef.selectors[0]);Sn&&$a(Z,Te,Sn),Vi&&Vi.length>0&&qh(Z,Te,Vi.join(" "))}if(ri=Fe(qt,20),void 0!==a){const Sn=ri.projection=[];for(let Vi=0;Vi<this.ngContentSelectors.length;Vi++){const Vr=a[Vi];Sn.push(null!=Vr?Array.from(Vr):null)}}Wn=function _m(r,o,a,h,y){const w=a[1],S=function Kf(r,o,a){const h=Yr();r.firstCreatePass&&(a.providersResolver&&a.providersResolver(a),tm(r,h,o,Hl(r,o,1,null),a));const y=_l(o,r,h.directiveStart,h);Ps(y,o);const w=W(h,o);return w&&Ps(w,o),y}(w,a,o);if(h.components.push(S),r[8]=S,y&&y.forEach(Z=>Z(S,o)),o.contentQueries){const Z=Yr();o.contentQueries(1,S,Z.directiveStart)}const B=Yr();return!w.firstCreatePass||null===o.hostBindings&&null===o.hostAttrs||(Ss(B.index),pp(a[1],B,0,B.directiveStart,B.directiveEnd,o),Qf(o,S)),S}(wi,this.componentDef,wn,Et,[vm]),qu(qt,wn,null)}finally{Lr()}return new C1(this.componentType,Wn,ph(ri,wn),wn,ri)}}class C1 extends class c1{}{constructor(o,a,h,y,w){super(),this.location=h,this._rootLView=y,this._tNode=w,this.instance=a,this.hostView=this.changeDetectorRef=new v1(y),this.componentType=o}get injector(){return new P(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}class fh{}class uv{}const mh=new Map;class pv extends fh{constructor(o,a){super(),this._parent=a,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new lv(this);const h=Mi(o);this._bootstrapComponents=bl(h.bootstrap),this._r3Injector=Bs(o,a,[{provide:fh,useValue:this},{provide:Hp,useValue:this.componentFactoryResolver}],Ee(o)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(o)}get(o,a=wa.THROW_IF_NOT_FOUND,h=lt.Default){return o===wa||o===fh||o===ed?this:this._r3Injector.get(o,a,h)}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class a_ extends uv{constructor(o){super(),this.moduleType=o,null!==Mi(o)&&function D1(r){const o=new Set;!function a(h){const y=Mi(h,!0),w=y.id;null!==w&&(function dv(r,o,a){if(o&&o!==a)throw new Error(`Duplicate module registered for ${r} - ${Ee(o)} vs ${Ee(o.name)}`)}(w,mh.get(w),h),mh.set(w,h));const S=bl(y.imports);for(const B of S)o.has(B)||(o.add(B),a(B))}(r)}(o)}create(o){return new pv(this.moduleType,o)}}function fv(r,o,a){const h=Qo()+r,y=In();return y[h]===Xi?al(y,h,a?o.call(a):o()):function rd(r,o){return r[o]}(y,h)}function Jp(r,o){const a=r[o];return a===Xi?void 0:a}function xv(r,o){const a=ar();let h;const y=r+20;a.firstCreatePass?(h=function F1(r,o){if(o)for(let a=o.length-1;a>=0;a--){const h=o[a];if(r===h.name)return h}}(o,a.pipeRegistry),a.data[y]=h,h.onDestroy&&(a.destroyHooks||(a.destroyHooks=[])).push(y,h.onDestroy)):h=a.data[y];const w=h.factory||(h.factory=oo(h.type)),S=me(hs);try{const B=Aa(!1),Z=w();return Aa(B),function E(r,o,a,h){a>=r.data.length&&(r.data[a]=null,r.blueprint[a]=null),o[a]=h}(a,In(),y,Z),Z}finally{me(S)}}function bv(r,o,a){const h=r+20,y=In(),w=dn(y,h);return Xp(y,h)?function mv(r,o,a,h,y,w){const S=o+a;return Ho(r,S,y)?al(r,S+1,w?h.call(w,y):h(y)):Jp(r,S+1)}(y,Qo(),o,w.transform,a,w):w.transform(a)}function wv(r,o,a,h){const y=r+20,w=In(),S=dn(w,y);return Xp(w,y)?function gv(r,o,a,h,y,w,S){const B=o+a;return jc(r,B,y,w)?al(r,B+2,S?h.call(S,y,w):h(y,w)):Jp(r,B+2)}(w,Qo(),o,S.transform,a,h,S):S.transform(a,h)}function Xp(r,o){return r[1].data[o].pure}function l_(r){return o=>{setTimeout(r,void 0,o)}}const bc=class U1 extends j.xQ{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,a,h){let y=o,w=a||(()=>null),S=h;if(o&&"object"==typeof o){const Z=o;y=Z.next?.bind(Z),w=Z.error?.bind(Z),S=Z.complete?.bind(Z)}this.__isAsync&&(w=l_(w),y&&(y=l_(y)),S&&(S=l_(S)));const B=super.subscribe({next:y,error:w,complete:S});return o instanceof g.w&&o.add(B),B}};function Z1(){return this._results[gc()]()}class c_{constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const a=gc(),h=c_.prototype;h[a]||(h[a]=Z1)}get changes(){return this._changes||(this._changes=new bc)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,a){return this._results.reduce(o,a)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,a){const h=this;h.dirty=!1;const y=T(o);(this._changesDetected=!function v(r,o,a){if(r.length!==o.length)return!1;for(let h=0;h<r.length;h++){let y=r[h],w=o[h];if(a&&(y=a(y),w=a(w)),w!==y)return!1}return!0}(h._results,y,a))&&(h._results=y,h.length=y.length,h.last=y[this.length-1],h.first=y[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Kp=(()=>{class r{}return r.__NG_ELEMENT_ID__=j1,r})();const V1=Kp,$1=class extends V1{constructor(o,a,h){super(),this._declarationLView=o,this._declarationTContainer=a,this.elementRef=h}createEmbeddedView(o){const a=this._declarationTContainer.tViews,h=ql(this._declarationLView,a,o,16,null,a.declTNode,null,null,null,null);h[17]=this._declarationLView[this._declarationTContainer.index];const w=this._declarationLView[19];return null!==w&&(h[19]=w.createEmbeddedView(a)),qu(a,h,o),new Yp(h)}};function j1(){return Lm(Yr(),In())}function Lm(r,o){return 4&r.type?new $1(o,r,ph(r,o)):null}let km=(()=>{class r{}return r.__NG_ELEMENT_ID__=G1,r})();function G1(){return Ev(Yr(),In())}const q1=km,Tv=class extends q1{constructor(o,a,h){super(),this._lContainer=o,this._hostTNode=a,this._hostLView=h}get element(){return ph(this._hostTNode,this._hostLView)}get injector(){return new P(this._hostTNode,this._hostLView)}get parentInjector(){const o=Rl(this._hostTNode,this._hostLView);if(na(o)){const a=_a(o,this._hostLView),h=Ma(o);return new P(a[1].data[h+8],a)}return new P(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const a=Cv(this._lContainer);return null!==a&&a[o]||null}get length(){return this._lContainer.length-10}createEmbeddedView(o,a,h){const y=o.createEmbeddedView(a||{});return this.insert(y,h),y}createComponent(o,a,h,y,w){const S=o&&!function c(r){return"function"==typeof r}(o);let B;if(S)B=a;else{const Qe=a||{};B=Qe.index,h=Qe.injector,y=Qe.projectableNodes,w=Qe.ngModuleRef}const Z=S?o:new s_(qn(o)),fe=h||this.parentInjector;if(!w&&null==Z.ngModule&&fe){const Qe=fe.get(fh,null);Qe&&(w=Qe)}const Te=Z.create(fe,y,void 0,w);return this.insert(Te.hostView,B),Te}insert(o,a){const h=o._lView,y=h[1];if(function Ko(r){return Ri(r[3])}(h)){const Te=this.indexOf(o);if(-1!==Te)this.detach(Te);else{const Qe=h[3],Et=new Tv(Qe,Qe[6],Qe[3]);Et.detach(Et.indexOf(o))}}const w=this._adjustIndex(a),S=this._lContainer;!function cg(r,o,a,h){const y=10+h,w=a.length;h>0&&(a[y-1][4]=o),h<w-10?(o[4]=a[y],R(a,10+h,o)):(a.push(o),o[4]=null),o[3]=a;const S=o[17];null!==S&&a!==S&&function ug(r,o){const a=r[9];o[16]!==o[3][3][16]&&(r[2]=!0),null===a?r[9]=[o]:a.push(o)}(S,o);const B=o[19];null!==B&&B.insertView(r),o[2]|=128}(y,h,S,w);const B=Nc(w,S),Z=h[11],fe=Fc(Z,S[7]);return null!==fe&&function Df(r,o,a,h,y,w){h[0]=y,h[6]=o,Zu(r,h,a,1,y,w)}(y,S[6],Z,h,fe,B),o.attachToViewContainerRef(),R(u_(S),w,o),o}move(o,a){return this.insert(o,a)}indexOf(o){const a=Cv(this._lContainer);return null!==a?a.indexOf(o):-1}remove(o){const a=this._adjustIndex(o,-1),h=zh(this._lContainer,a);h&&($(u_(this._lContainer),a),Mf(h[1],h))}detach(o){const a=this._adjustIndex(o,-1),h=zh(this._lContainer,a);return h&&null!=$(u_(this._lContainer),a)?new Yp(h):null}_adjustIndex(o,a=0){return o??this.length+a}};function Cv(r){return r[8]}function u_(r){return r[8]||(r[8]=[])}function Ev(r,o){let a;const h=o[r.index];if(Ri(h))a=h;else{let y;if(8&r.type)y=Fi(h);else{const w=o[11];y=w.createComment("");const S=W(r,o);kc(w,Fc(w,S),y,function Md(r,o){return Hn(r)?r.nextSibling(o):o.nextSibling}(w,S),!1)}o[r.index]=a=fp(h,o,y,r),gu(o,a)}return new Tv(a,r,o)}class d_{constructor(o){this.queryList=o,this.matches=null}clone(){return new d_(this.queryList)}setDirty(){this.queryList.setDirty()}}class h_{constructor(o=[]){this.queries=o}createEmbeddedView(o){const a=o.queries;if(null!==a){const h=null!==o.contentQueries?o.contentQueries[0]:a.length,y=[];for(let w=0;w<h;w++){const S=a.getByIndex(w);y.push(this.queries[S.indexInDeclarationView].clone())}return new h_(y)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let a=0;a<this.queries.length;a++)null!==Lv(o,a).matches&&this.queries[a].setDirty()}}class Dv{constructor(o,a,h=null){this.predicate=o,this.flags=a,this.read=h}}class p_{constructor(o=[]){this.queries=o}elementStart(o,a){for(let h=0;h<this.queries.length;h++)this.queries[h].elementStart(o,a)}elementEnd(o){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(o)}embeddedTView(o){let a=null;for(let h=0;h<this.length;h++){const y=null!==a?a.length:0,w=this.getByIndex(h).embeddedTView(o,y);w&&(w.indexInDeclarationView=h,null!==a?a.push(w):a=[w])}return null!==a?new p_(a):null}template(o,a){for(let h=0;h<this.queries.length;h++)this.queries[h].template(o,a)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class f_{constructor(o,a=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(o,a){this.isApplyingToNode(a)&&this.matchTNode(o,a)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,a){this.elementStart(o,a)}embeddedTView(o,a){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,a),new f_(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const a=this._declarationNodeIndex;let h=o.parent;for(;null!==h&&8&h.type&&h.index!==a;)h=h.parent;return a===(null!==h?h.index:-1)}return this._appliesToNextNode}matchTNode(o,a){const h=this.metadata.predicate;if(Array.isArray(h))for(let y=0;y<h.length;y++){const w=h[y];this.matchTNodeWithReadOption(o,a,Y1(a,w)),this.matchTNodeWithReadOption(o,a,Ha(a,o,w,!1,!1))}else h===Kp?4&a.type&&this.matchTNodeWithReadOption(o,a,-1):this.matchTNodeWithReadOption(o,a,Ha(a,o,h,!1,!1))}matchTNodeWithReadOption(o,a,h){if(null!==h){const y=this.metadata.read;if(null!==y)if(y===Wp||y===km||y===Kp&&4&a.type)this.addMatch(a.index,-2);else{const w=Ha(a,o,y,!1,!1);null!==w&&this.addMatch(a.index,w)}else this.addMatch(a.index,h)}}addMatch(o,a){null===this.matches?this.matches=[o,a]:this.matches.push(o,a)}}function Y1(r,o){const a=r.localNames;if(null!==a)for(let h=0;h<a.length;h+=2)if(a[h]===o)return a[h+1];return null}function X1(r,o,a,h){return-1===a?function J1(r,o){return 11&r.type?ph(r,o):4&r.type?Lm(r,o):null}(o,r):-2===a?function K1(r,o,a){return a===Wp?ph(o,r):a===Kp?Lm(o,r):a===km?Ev(o,r):void 0}(r,o,h):_l(r,r[1],a,o)}function Iv(r,o,a,h){const y=o[19].queries[h];if(null===y.matches){const w=r.data,S=a.matches,B=[];for(let Z=0;Z<S.length;Z+=2){const fe=S[Z];B.push(fe<0?null:X1(o,w[fe],S[Z+1],a.metadata.read))}y.matches=B}return y.matches}function m_(r,o,a,h){const y=r.queries.getByIndex(a),w=y.matches;if(null!==w){const S=Iv(r,o,y,a);for(let B=0;B<w.length;B+=2){const Z=w[B];if(Z>0)h.push(S[B/2]);else{const fe=w[B+1],Te=o[-Z];for(let Qe=10;Qe<Te.length;Qe++){const Et=Te[Qe];Et[17]===Et[3]&&m_(Et[1],Et,fe,h)}if(null!==Te[9]){const Qe=Te[9];for(let Et=0;Et<Qe.length;Et++){const qt=Qe[Et];m_(qt[1],qt,fe,h)}}}}}return h}function Mv(r){const o=In(),a=ar(),h=re();De(h+1);const y=Lv(a,h);if(r.dirty&&Or(o)===(2==(2&y.metadata.flags))){if(null===y.matches)r.reset([]);else{const w=y.crossesNgTemplate?m_(a,o,h,[]):Iv(a,o,y,h);r.reset(w,p1),r.notifyOnChanges()}return!0}return!1}function Av(r,o,a){const h=ar();h.firstCreatePass&&(Rv(h,new Dv(r,o,a),-1),2==(2&o)&&(h.staticViewQueries=!0)),Ov(h,In(),o)}function Sv(r,o,a,h){const y=ar();if(y.firstCreatePass){const w=Yr();Rv(y,new Dv(o,a,h),w.index),function eb(r,o){const a=r.contentQueries||(r.contentQueries=[]);o!==(a.length?a[a.length-1]:-1)&&a.push(r.queries.length-1,o)}(y,r),2==(2&a)&&(y.staticContentQueries=!0)}Ov(y,In(),a)}function Pv(){return function Q1(r,o){return r[19].queries[o].queryList}(In(),re())}function Ov(r,o,a){const h=new c_(4==(4&a));dp(r,o,h,h.destroy),null===o[19]&&(o[19]=new h_),o[19].queries.push(new d_(h))}function Rv(r,o,a){null===r.queries&&(r.queries=new p_),r.queries.track(new f_(o,a))}function Lv(r,o){return r.queries.getByIndex(o)}const yb=qr("Output",r=>({bindingPropertyName:r})),vb=qr("HostListener",(r,o)=>({eventName:r,args:o}));function Nm(...r){}const b_=new Ir("Application Initializer");let _h=(()=>{class r{constructor(a){this.appInits=a,this.resolve=Nm,this.reject=Nm,this.initialized=!1,this.done=!1,this.donePromise=new Promise((h,y)=>{this.resolve=h,this.reject=y})}runInitializers(){if(this.initialized)return;const a=[],h=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let y=0;y<this.appInits.length;y++){const w=this.appInits[y]();if(Ta(w))a.push(w);else if(Du(w)){const S=new Promise((B,Z)=>{w.subscribe({complete:B,error:Z})});a.push(S)}}Promise.all(a).then(()=>{h()}).catch(y=>{this.reject(y)}),0===a.length&&h(),this.initialized=!0}}return r.\u0275fac=function(a){return new(a||r)(Pi(b_,8))},r.\u0275prov=li({token:r,factory:r.\u0275fac}),r})();const Xv=new Ir("AppId"),bb={provide:Xv,useFactory:function xb(){return`${w_()}${w_()}${w_()}`},deps:[]};function w_(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Kv=new Ir("Platform Initializer"),Qv=new Ir("Platform ID"),e0=new Ir("appBootstrapListener");let t0=(()=>{class r{log(a){console.log(a)}warn(a){console.warn(a)}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=li({token:r,factory:r.\u0275fac}),r})();const zm=new Ir("LocaleId"),n0=new Ir("DefaultCurrencyCode");class wb{constructor(o,a){this.ngModuleFactory=o,this.componentFactories=a}}let T_=(()=>{class r{compileModuleSync(a){return new a_(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){const h=this.compileModuleSync(a),w=bl(Mi(a).declarations).reduce((S,B)=>{const Z=qn(B);return Z&&S.push(new s_(Z)),S},[]);return new wb(h,w)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=li({token:r,factory:r.\u0275fac}),r})();const Cb=(()=>Promise.resolve(0))();function C_(r){"undefined"==typeof Zone?Cb.then(()=>{r&&r.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",r)}class cl{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:h=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new bc(!1),this.onMicrotaskEmpty=new bc(!1),this.onStable=new bc(!1),this.onError=new bc(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const y=this;y._nesting=0,y._outer=y._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(y._inner=y._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(y._inner=y._inner.fork(Zone.longStackTraceZoneSpec)),y.shouldCoalesceEventChangeDetection=!h&&a,y.shouldCoalesceRunChangeDetection=h,y.lastRequestAnimationFrameId=-1,y.nativeRequestAnimationFrame=function Eb(){let r=yi.requestAnimationFrame,o=yi.cancelAnimationFrame;if("undefined"!=typeof Zone&&r&&o){const a=r[Zone.__symbol__("OriginalDelegate")];a&&(r=a);const h=o[Zone.__symbol__("OriginalDelegate")];h&&(o=h)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function Mb(r){const o=()=>{!function Ib(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(yi,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,D_(r),r.isCheckStableRunning=!0,E_(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),D_(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(a,h,y,w,S,B)=>{try{return r0(r),a.invokeTask(y,w,S,B)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===w.type||r.shouldCoalesceRunChangeDetection)&&o(),o0(r)}},onInvoke:(a,h,y,w,S,B,Z)=>{try{return r0(r),a.invoke(y,w,S,B,Z)}finally{r.shouldCoalesceRunChangeDetection&&o(),o0(r)}},onHasTask:(a,h,y,w)=>{a.hasTask(y,w),h===y&&("microTask"==w.change?(r._hasPendingMicrotasks=w.microTask,D_(r),E_(r)):"macroTask"==w.change&&(r.hasPendingMacrotasks=w.macroTask))},onHandleError:(a,h,y,w)=>(a.handleError(y,w),r.runOutsideAngular(()=>r.onError.emit(w)),!1)})}(y)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!cl.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(cl.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(o,a,h){return this._inner.run(o,a,h)}runTask(o,a,h,y){const w=this._inner,S=w.scheduleEventTask("NgZoneEvent: "+y,o,Db,Nm,Nm);try{return w.runTask(S,a,h)}finally{w.cancelTask(S)}}runGuarded(o,a,h){return this._inner.runGuarded(o,a,h)}runOutsideAngular(o){return this._outer.run(o)}}const Db={};function E_(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function D_(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function r0(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function o0(r){r._nesting--,E_(r)}class Ab{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new bc,this.onMicrotaskEmpty=new bc,this.onStable=new bc,this.onError=new bc}run(o,a,h){return o.apply(a,h)}runGuarded(o,a,h){return o.apply(a,h)}runOutsideAngular(o){return o()}runTask(o,a,h,y){return o.apply(a,h)}}let s0=(()=>{class r{constructor(a){this._ngZone=a,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),a.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{cl.assertNotInAngularZone(),C_(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())C_(()=>{for(;0!==this._callbacks.length;){let a=this._callbacks.pop();clearTimeout(a.timeoutId),a.doneCb(this._didWork)}this._didWork=!1});else{let a=this.getPendingTasks();this._callbacks=this._callbacks.filter(h=>!h.updateCb||!h.updateCb(a)||(clearTimeout(h.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(a=>({source:a.source,creationLocation:a.creationLocation,data:a.data})):[]}addCallback(a,h,y){let w=-1;h&&h>0&&(w=setTimeout(()=>{this._callbacks=this._callbacks.filter(S=>S.timeoutId!==w),a(this._didWork,this.getPendingTasks())},h)),this._callbacks.push({doneCb:a,timeoutId:w,updateCb:y})}whenStable(a,h,y){if(y&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(a,h,y),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(a,h,y){return[]}}return r.\u0275fac=function(a){return new(a||r)(Pi(cl))},r.\u0275prov=li({token:r,factory:r.\u0275fac}),r})(),a0=(()=>{class r{constructor(){this._applications=new Map,I_.addToWindow(this)}registerApplication(a,h){this._applications.set(a,h)}unregisterApplication(a){this._applications.delete(a)}unregisterAllApplications(){this._applications.clear()}getTestability(a){return this._applications.get(a)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(a,h=!0){return I_.findTestabilityInTree(this,a,h)}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=li({token:r,factory:r.\u0275fac}),r})();class Sb{addToWindow(o){}findTestabilityInTree(o,a,h){return null}}function Pb(r){I_=r}let ec,I_=new Sb;const l0=new Ir("AllowMultipleToken");class Lb{constructor(o,a){this.name=o,this.token=a}}function c0(r,o,a=[]){const h=`Platform: ${o}`,y=new Ir(h);return(w=[])=>{let S=u0();if(!S||S.injector.get(l0,!1))if(r)r(a.concat(w).concat({provide:y,useValue:!0}));else{const B=a.concat(w).concat({provide:y,useValue:!0},{provide:wp,useValue:"platform"});!function kb(r){if(ec&&!ec.destroyed&&!ec.injector.get(l0,!1))throw new Be(400,"");ec=r.get(d0);const o=r.get(Kv,null);o&&o.forEach(a=>a())}(wa.create({providers:B,name:h}))}return function Fb(r){const o=u0();if(!o)throw new Be(401,"");return o}()}}function u0(){return ec&&!ec.destroyed?ec:null}let d0=(()=>{class r{constructor(a){this._injector=a,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(a,h){const B=function Bb(r,o){let a;return a="noop"===r?new Ab:("zone.js"===r?void 0:r)||new cl({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!o?.ngZoneEventCoalescing,shouldCoalesceRunChangeDetection:!!o?.ngZoneRunCoalescing}),a}(h?h.ngZone:void 0,{ngZoneEventCoalescing:h&&h.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:h&&h.ngZoneRunCoalescing||!1}),Z=[{provide:cl,useValue:B}];return B.run(()=>{const fe=wa.create({providers:Z,parent:this.injector,name:a.moduleType.name}),Te=a.create(fe),Qe=Te.injector.get(iu,null);if(!Qe)throw new Be(402,"");return B.runOutsideAngular(()=>{const Et=B.onError.subscribe({next:qt=>{Qe.handleError(qt)}});Te.onDestroy(()=>{M_(this._modules,Te),Et.unsubscribe()})}),function Nb(r,o,a){try{const h=a();return Ta(h)?h.catch(y=>{throw o.runOutsideAngular(()=>r.handleError(y)),y}):h}catch(h){throw o.runOutsideAngular(()=>r.handleError(h)),h}}(Qe,B,()=>{const Et=Te.injector.get(_h);return Et.runInitializers(),Et.donePromise.then(()=>(function fx(r){mt(r,"Expected localeId to be defined"),"string"==typeof r&&(Oy=r.toLowerCase().replace(/_/g,"-"))}(Te.injector.get(zm,Mm)||Mm),this._moduleDoBootstrap(Te),Te))})})}bootstrapModule(a,h=[]){const y=h0({},h);return function Ob(r,o,a){const h=new a_(a);return Promise.resolve(h)}(0,0,a).then(w=>this.bootstrapModuleFactory(w,y))}_moduleDoBootstrap(a){const h=a.injector.get(ef);if(a._bootstrapComponents.length>0)a._bootstrapComponents.forEach(y=>h.bootstrap(y));else{if(!a.instance.ngDoBootstrap)throw new Be(403,"");a.instance.ngDoBootstrap(h)}this._modules.push(a)}onDestroy(a){this._destroyListeners.push(a)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Be(404,"");this._modules.slice().forEach(a=>a.destroy()),this._destroyListeners.forEach(a=>a()),this._destroyed=!0}get destroyed(){return this._destroyed}}return r.\u0275fac=function(a){return new(a||r)(Pi(wa))},r.\u0275prov=li({token:r,factory:r.\u0275fac}),r})();function h0(r,o){return Array.isArray(o)?o.reduce(h0,r):{...r,...o}}let ef=(()=>{class r{constructor(a,h,y,w,S){this._zone=a,this._injector=h,this._exceptionHandler=y,this._componentFactoryResolver=w,this._initStatus=S,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const B=new b.y(fe=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{fe.next(this._stable),fe.complete()})}),Z=new b.y(fe=>{let Te;this._zone.runOutsideAngular(()=>{Te=this._zone.onStable.subscribe(()=>{cl.assertNotInAngularZone(),C_(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,fe.next(!0))})})});const Qe=this._zone.onUnstable.subscribe(()=>{cl.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{fe.next(!1)}))});return()=>{Te.unsubscribe(),Qe.unsubscribe()}});this.isStable=function J(...r){let o=Number.POSITIVE_INFINITY,a=null,h=r[r.length-1];return(0,d.K)(h)?(a=r.pop(),r.length>1&&"number"==typeof r[r.length-1]&&(o=r.pop())):"number"==typeof h&&(o=r.pop()),null===a&&1===r.length&&r[0]instanceof b.y?r[0]:(0,pe.J)(o)((0,l.n)(r,a))}(B,Z.pipe(function ue(){return r=>(0,Y.x)()(function ge(r,o){return function(h){let y;if(y="function"==typeof r?r:function(){return r},"function"==typeof o)return h.lift(new Q(y,o));const w=Object.create(h,ne.N);return w.source=h,w.subjectFactory=y,w}}(se)(r))}()))}bootstrap(a,h){if(!this._initStatus.done)throw new Be(405,"");let y;y=a instanceof rv?a:this._componentFactoryResolver.resolveComponentFactory(a),this.componentTypes.push(y.componentType);const w=function Rb(r){return r.isBoundToModule}(y)?void 0:this._injector.get(fh),B=y.create(wa.NULL,[],h||y.selector,w),Z=B.location.nativeElement,fe=B.injector.get(s0,null),Te=fe&&B.injector.get(a0);return fe&&Te&&Te.registerApplication(Z,fe),B.onDestroy(()=>{this.detachView(B.hostView),M_(this.components,B),Te&&Te.unregisterApplication(Z)}),this._loadComponent(B),B}tick(){if(this._runningTick)throw new Be(101,"");try{this._runningTick=!0;for(let a of this._views)a.detectChanges()}catch(a){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(a))}finally{this._runningTick=!1}}attachView(a){const h=a;this._views.push(h),h.attachToAppRef(this)}detachView(a){const h=a;M_(this._views,h),h.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView),this.tick(),this.components.push(a),this._injector.get(e0,[]).concat(this._bootstrapListeners).forEach(y=>y(a))}ngOnDestroy(){this._views.slice().forEach(a=>a.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return r.\u0275fac=function(a){return new(a||r)(Pi(cl),Pi(wa),Pi(iu),Pi(Hp),Pi(_h))},r.\u0275prov=li({token:r,factory:r.\u0275fac}),r})();function M_(r,o){const a=r.indexOf(o);a>-1&&r.splice(a,1)}let f0=!0;function Ub(){f0=!1}let Zb=(()=>{class r{}return r.__NG_ELEMENT_ID__=Vb,r})();function Vb(r){return function $b(r,o,a){if(ji(r)&&!a){const h=ei(r.index,o);return new Yp(h,h)}return 47&r.type?new Yp(o[16],o):null}(Yr(),In(),16==(16&r))}class v0{constructor(){}supports(o){return bu(o)}create(o){return new Yb(o)}}const Wb=(r,o)=>o;class Yb{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||Wb}forEachItem(o){let a;for(a=this._itHead;null!==a;a=a._next)o(a)}forEachOperation(o){let a=this._itHead,h=this._removalsHead,y=0,w=null;for(;a||h;){const S=!h||a&&a.currentIndex<b0(h,y,w)?a:h,B=b0(S,y,w),Z=S.currentIndex;if(S===h)y--,h=h._nextRemoved;else if(a=a._next,null==S.previousIndex)y++;else{w||(w=[]);const fe=B-y,Te=Z-y;if(fe!=Te){for(let Et=0;Et<fe;Et++){const qt=Et<w.length?w[Et]:w[Et]=0,wn=qt+Et;Te<=wn&&wn<fe&&(w[Et]=qt+1)}w[S.previousIndex]=Te-fe}}B!==Z&&o(S,B,Z)}}forEachPreviousItem(o){let a;for(a=this._previousItHead;null!==a;a=a._nextPrevious)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachMovedItem(o){let a;for(a=this._movesHead;null!==a;a=a._nextMoved)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}forEachIdentityChange(o){let a;for(a=this._identityChangesHead;null!==a;a=a._nextIdentityChange)o(a)}diff(o){if(null==o&&(o=[]),!bu(o))throw new Be(900,"");return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let y,w,S,a=this._itHead,h=!1;if(Array.isArray(o)){this.length=o.length;for(let B=0;B<this.length;B++)w=o[B],S=this._trackByFn(B,w),null!==a&&Object.is(a.trackById,S)?(h&&(a=this._verifyReinsertion(a,w,S,B)),Object.is(a.item,w)||this._addIdentityChange(a,w)):(a=this._mismatch(a,w,S,B),h=!0),a=a._next}else y=0,function Lp(r,o){if(Array.isArray(r))for(let a=0;a<r.length;a++)o(r[a]);else{const a=r[gc()]();let h;for(;!(h=a.next()).done;)o(h.value)}}(o,B=>{S=this._trackByFn(y,B),null!==a&&Object.is(a.trackById,S)?(h&&(a=this._verifyReinsertion(a,B,S,y)),Object.is(a.item,B)||this._addIdentityChange(a,B)):(a=this._mismatch(a,B,S,y),h=!0),a=a._next,y++}),this.length=y;return this._truncate(a),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,a,h,y){let w;return null===o?w=this._itTail:(w=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._reinsertAfter(o,w,y)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(h,y))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._moveAfter(o,w,y)):o=this._addAfter(new Jb(a,h),w,y),o}_verifyReinsertion(o,a,h,y){let w=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null);return null!==w?o=this._reinsertAfter(w,o._prev,y):o.currentIndex!=y&&(o.currentIndex=y,this._addToMoves(o,y)),o}_truncate(o){for(;null!==o;){const a=o._next;this._addToRemovals(this._unlink(o)),o=a}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,a,h){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const y=o._prevRemoved,w=o._nextRemoved;return null===y?this._removalsHead=w:y._nextRemoved=w,null===w?this._removalsTail=y:w._prevRemoved=y,this._insertAfter(o,a,h),this._addToMoves(o,h),o}_moveAfter(o,a,h){return this._unlink(o),this._insertAfter(o,a,h),this._addToMoves(o,h),o}_addAfter(o,a,h){return this._insertAfter(o,a,h),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,a,h){const y=null===a?this._itHead:a._next;return o._next=y,o._prev=a,null===y?this._itTail=o:y._prev=o,null===a?this._itHead=o:a._next=o,null===this._linkedRecords&&(this._linkedRecords=new x0),this._linkedRecords.put(o),o.currentIndex=h,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const a=o._prev,h=o._next;return null===a?this._itHead=h:a._next=h,null===h?this._itTail=a:h._prev=a,o}_addToMoves(o,a){return o.previousIndex===a||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new x0),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,a){return o.item=a,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class Jb{constructor(o,a){this.item=o,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Xb{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,a){let h;for(h=this._head;null!==h;h=h._nextDup)if((null===a||a<=h.currentIndex)&&Object.is(h.trackById,o))return h;return null}remove(o){const a=o._prevDup,h=o._nextDup;return null===a?this._head=h:a._nextDup=h,null===h?this._tail=a:h._prevDup=a,null===this._head}}class x0{constructor(){this.map=new Map}put(o){const a=o.trackById;let h=this.map.get(a);h||(h=new Xb,this.map.set(a,h)),h.add(o)}get(o,a){const y=this.map.get(o);return y?y.get(o,a):null}remove(o){const a=o.trackById;return this.map.get(a).remove(o)&&this.map.delete(a),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function b0(r,o,a){const h=r.previousIndex;if(null===h)return h;let y=0;return a&&h<a.length&&(y=a[h]),h+o+y}class w0{constructor(){}supports(o){return o instanceof Map||oh(o)}create(){return new Kb}}class Kb{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let a;for(a=this._mapHead;null!==a;a=a._next)o(a)}forEachPreviousItem(o){let a;for(a=this._previousMapHead;null!==a;a=a._nextPrevious)o(a)}forEachChangedItem(o){let a;for(a=this._changesHead;null!==a;a=a._nextChanged)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}diff(o){if(o){if(!(o instanceof Map||oh(o)))throw new Be(900,"")}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let a=this._mapHead;if(this._appendAfter=null,this._forEach(o,(h,y)=>{if(a&&a.key===y)this._maybeAddToChanges(a,h),this._appendAfter=a,a=a._next;else{const w=this._getOrCreateRecordForKey(y,h);a=this._insertBeforeOrAppend(a,w)}}),a){a._prev&&(a._prev._next=null),this._removalsHead=a;for(let h=a;null!==h;h=h._nextRemoved)h===this._mapHead&&(this._mapHead=null),this._records.delete(h.key),h._nextRemoved=h._next,h.previousValue=h.currentValue,h.currentValue=null,h._prev=null,h._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,a){if(o){const h=o._prev;return a._next=o,a._prev=h,o._prev=a,h&&(h._next=a),o===this._mapHead&&(this._mapHead=a),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=a,a._prev=this._appendAfter):this._mapHead=a,this._appendAfter=a,null}_getOrCreateRecordForKey(o,a){if(this._records.has(o)){const y=this._records.get(o);this._maybeAddToChanges(y,a);const w=y._prev,S=y._next;return w&&(w._next=S),S&&(S._prev=w),y._next=null,y._prev=null,y}const h=new Qb(o);return this._records.set(o,h),h.currentValue=a,this._addToAdditions(h),h}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,a){Object.is(a,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=a,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,a){o instanceof Map?o.forEach(a):Object.keys(o).forEach(h=>a(o[h],h))}}class Qb{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function T0(){return new Vm([new v0])}let Vm=(()=>{class r{constructor(a){this.factories=a}static create(a,h){if(null!=h){const y=h.factories.slice();a=a.concat(y)}return new r(a)}static extend(a){return{provide:r,useFactory:h=>r.create(a,h||T0()),deps:[[r,new Hr,new no]]}}find(a){const h=this.factories.find(y=>y.supports(a));if(null!=h)return h;throw new Be(901,"")}}return r.\u0275prov=li({token:r,providedIn:"root",factory:T0}),r})();function C0(){return new $m([new w0])}let $m=(()=>{class r{constructor(a){this.factories=a}static create(a,h){if(h){const y=h.factories.slice();a=a.concat(y)}return new r(a)}static extend(a){return{provide:r,useFactory:h=>r.create(a,h||C0()),deps:[[r,new Hr,new no]]}}find(a){const h=this.factories.find(w=>w.supports(a));if(h)return h;throw new Be(901,"")}}return r.\u0275prov=li({token:r,providedIn:"root",factory:C0}),r})();const ew=[new w0],nw=new Vm([new v0]),iw=new $m(ew),rw=c0(null,"core",[{provide:Qv,useValue:"unknown"},{provide:d0,deps:[wa]},{provide:a0,deps:[]},{provide:t0,deps:[]}]),cw=[{provide:ef,useClass:ef,deps:[cl,wa,iu,Hp,_h]},{provide:b1,deps:[cl],useFactory:function uw(r){let o=[];return r.onStable.subscribe(()=>{for(;o.length;)o.pop()()}),function(a){o.push(a)}}},{provide:_h,useClass:_h,deps:[[new no,b_]]},{provide:T_,useClass:T_,deps:[]},bb,{provide:Vm,useFactory:function ow(){return nw},deps:[]},{provide:$m,useFactory:function sw(){return iw},deps:[]},{provide:zm,useFactory:function aw(r){return r||function lw(){return"undefined"!=typeof $localize&&$localize.locale||Mm}()},deps:[[new ir(zm),new no,new Hr]]},{provide:n0,useValue:"USD"}];let dw=(()=>{class r{constructor(a){}}return r.\u0275fac=function(a){return new(a||r)(Pi(ef))},r.\u0275mod=Gt({type:r}),r.\u0275inj=rr({providers:cw}),r})()},4006:(An,vt,k)=>{"use strict";k.d(vt,{Fj:()=>ye,u5:()=>Fr,Fd:()=>Gr,qQ:()=>lo,JU:()=>ne,a5:()=>li,JJ:()=>_i,On:()=>Pt,wV:()=>un});var b=k(6738),d=k(6895),pe=k(5254),l=k(567),J=k(4850);let j=(()=>{class ie{constructor(H,Fe){this._renderer=H,this._elementRef=Fe,this.onChange=dn=>{},this.onTouched=()=>{}}setProperty(H,Fe){this._renderer.setProperty(this._elementRef.nativeElement,H,Fe)}registerOnTouched(H){this.onTouched=H}registerOnChange(H){this.onChange=H}setDisabledState(H){this.setProperty("disabled",H)}}return ie.\u0275fac=function(H){return new(H||ie)(b.Y36(b.Qsj),b.Y36(b.SBq))},ie.\u0275dir=b.lG2({type:ie}),ie})(),g=(()=>{class ie extends j{}return ie.\u0275fac=function(){let W;return function(Fe){return(W||(W=b.n5z(ie)))(Fe||ie)}}(),ie.\u0275dir=b.lG2({type:ie,features:[b.qOj]}),ie})();const ne=new b.OlP("NgValueAccessor"),Y={provide:ne,useExisting:(0,b.Gpc)(()=>ye),multi:!0},ue=new b.OlP("CompositionEventMode");let ye=(()=>{class ie extends j{constructor(H,Fe,dn){super(H,Fe),this._compositionMode=dn,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function se(){const ie=(0,d.q)()?(0,d.q)().getUserAgent():"";return/android (\d+)/.test(ie.toLowerCase())}())}writeValue(H){this.setProperty("value",H??"")}_handleInput(H){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(H)}_compositionStart(){this._composing=!0}_compositionEnd(H){this._composing=!1,this._compositionMode&&this.onChange(H)}}return ie.\u0275fac=function(H){return new(H||ie)(b.Y36(b.Qsj),b.Y36(b.SBq),b.Y36(ue,8))},ie.\u0275dir=b.lG2({type:ie,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(H,Fe){1&H&&b.NdJ("input",function(ei){return Fe._handleInput(ei.target.value)})("blur",function(){return Fe.onTouched()})("compositionstart",function(){return Fe._compositionStart()})("compositionend",function(ei){return Fe._compositionEnd(ei.target.value)})},features:[b._Bn([Y]),b.qOj]}),ie})();function xe(ie){return null==ie||0===ie.length}const We=new b.OlP("NgValidators"),be=new b.OlP("NgAsyncValidators");function xt(ie){return null}function gt(ie){return null!=ie}function Bt(ie){const W=(0,b.QGY)(ie)?(0,pe.D)(ie):ie;return(0,b.CqO)(W),W}function Ht(ie){let W={};return ie.forEach(H=>{W=null!=H?{...W,...H}:W}),0===Object.keys(W).length?null:W}function Gn(ie,W){return W.map(H=>H(ie))}function jt(ie){return ie.map(W=>function It(ie){return!ie.validate}(W)?W:H=>W.validate(H))}function Yt(ie){return null!=ie?function Ut(ie){if(!ie)return null;const W=ie.filter(gt);return 0==W.length?null:function(H){return Ht(Gn(H,W))}}(jt(ie)):null}function Zt(ie){return null!=ie?function zt(ie){if(!ie)return null;const W=ie.filter(gt);return 0==W.length?null:function(H){const Fe=Gn(H,W).map(Bt);return(0,l.D)(Fe).pipe((0,J.U)(Ht))}}(jt(ie)):null}function ln(ie,W){return null===ie?[W]:Array.isArray(ie)?[...ie,W]:[ie,W]}function Kt(ie){return ie?Array.isArray(ie)?ie:[ie]:[]}function mt(ie,W){return Array.isArray(ie)?ie.includes(W):ie===W}function Wt(ie,W){const H=Kt(W);return Kt(ie).forEach(dn=>{mt(H,dn)||H.push(dn)}),H}function On(ie,W){return Kt(W).filter(H=>!mt(ie,H))}class bn{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(W){this._rawValidators=W||[],this._composedValidatorFn=Yt(this._rawValidators)}_setAsyncValidators(W){this._rawAsyncValidators=W||[],this._composedAsyncValidatorFn=Zt(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(W){this._onDestroyCallbacks.push(W)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(W=>W()),this._onDestroyCallbacks=[]}reset(W){this.control&&this.control.reset(W)}hasError(W,H){return!!this.control&&this.control.hasError(W,H)}getError(W,H){return this.control?this.control.getError(W,H):null}}class jn extends bn{get formDirective(){return null}get path(){return null}}class li extends bn{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}let _i=(()=>{class ie extends class $i{constructor(W){this._cd=W}is(W){return"submitted"===W?!!this._cd?.submitted:!!this._cd?.control?.[W]}}{constructor(H){super(H)}}return ie.\u0275fac=function(H){return new(H||ie)(b.Y36(li,2))},ie.\u0275dir=b.lG2({type:ie,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(H,Fe){2&H&&b.ekj("ng-untouched",Fe.is("untouched"))("ng-touched",Fe.is("touched"))("ng-pristine",Fe.is("pristine"))("ng-dirty",Fe.is("dirty"))("ng-valid",Fe.is("valid"))("ng-invalid",Fe.is("invalid"))("ng-pending",Fe.is("pending"))},features:[b.qOj]}),ie})();function ci(ie,W){(function yi(ie,W){const H=function xn(ie){return ie._rawValidators}(ie);null!==W.validator?ie.setValidators(ln(H,W.validator)):"function"==typeof H&&ie.setValidators([H]);const Fe=function an(ie){return ie._rawAsyncValidators}(ie);null!==W.asyncValidator?ie.setAsyncValidators(ln(Fe,W.asyncValidator)):"function"==typeof Fe&&ie.setAsyncValidators([Fe]);const dn=()=>ie.updateValueAndValidity();Ii(W._rawValidators,dn),Ii(W._rawAsyncValidators,dn)})(ie,W),W.valueAccessor.writeValue(ie.value),function gr(ie,W){W.valueAccessor.registerOnChange(H=>{ie._pendingValue=H,ie._pendingChange=!0,ie._pendingDirty=!0,"change"===ie.updateOn&&Ci(ie,W)})}(ie,W),function Oi(ie,W){const H=(Fe,dn)=>{W.valueAccessor.writeValue(Fe),dn&&W.viewToModelUpdate(Fe)};ie.registerOnChange(H),W._registerOnDestroy(()=>{ie._unregisterOnChange(H)})}(ie,W),function Tr(ie,W){W.valueAccessor.registerOnTouched(()=>{ie._pendingTouched=!0,"blur"===ie.updateOn&&ie._pendingChange&&Ci(ie,W),"submit"!==ie.updateOn&&ie.markAsTouched()})}(ie,W),function hr(ie,W){if(W.valueAccessor.setDisabledState){const H=Fe=>{W.valueAccessor.setDisabledState(Fe)};ie.registerOnDisabledChange(H),W._registerOnDestroy(()=>{ie._unregisterOnDisabledChange(H)})}}(ie,W)}function Ii(ie,W){ie.forEach(H=>{H.registerOnValidatorChange&&H.registerOnValidatorChange(W)})}function Ci(ie,W){ie._pendingDirty&&ie.markAsDirty(),ie.setValue(ie._pendingValue,{emitModelToViewChange:!1}),W.viewToModelUpdate(ie._pendingValue),ie._pendingChange=!1}function Je(ie,W){const H=ie.indexOf(W);H>-1&&ie.splice(H,1)}const Gt="VALID",At="INVALID",Pn="PENDING",Vn="DISABLED";function qn(ie){return(di(ie)?ie.validators:ie)||null}function ni(ie){return Array.isArray(ie)?Yt(ie):ie||null}function Li(ie,W){return(di(W)?W.asyncValidators:ie)||null}function Mi(ie){return Array.isArray(ie)?Zt(ie):ie||null}function di(ie){return null!=ie&&!Array.isArray(ie)&&"object"==typeof ie}const ti=ie=>ie instanceof Sr;function Ni(ie){return(ie=>ie instanceof or)(ie)?ie.value:ie.getRawValue()}function pr(ie,W){const H=ti(ie),Fe=ie.controls;if(!(H?Object.keys(Fe):Fe).length)throw new b.vHH(1e3,"");if(!Fe[W])throw new b.vHH(1001,"")}function oi(ie,W){ti(ie),ie._forEachChild((Fe,dn)=>{if(void 0===W[dn])throw new b.vHH(1002,"")})}class fr{constructor(W,H){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=W,this._rawAsyncValidators=H,this._composedValidatorFn=ni(this._rawValidators),this._composedAsyncValidatorFn=Mi(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(W){this._rawValidators=this._composedValidatorFn=W}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(W){this._rawAsyncValidators=this._composedAsyncValidatorFn=W}get parent(){return this._parent}get valid(){return this.status===Gt}get invalid(){return this.status===At}get pending(){return this.status==Pn}get disabled(){return this.status===Vn}get enabled(){return this.status!==Vn}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(W){this._rawValidators=W,this._composedValidatorFn=ni(W)}setAsyncValidators(W){this._rawAsyncValidators=W,this._composedAsyncValidatorFn=Mi(W)}addValidators(W){this.setValidators(Wt(W,this._rawValidators))}addAsyncValidators(W){this.setAsyncValidators(Wt(W,this._rawAsyncValidators))}removeValidators(W){this.setValidators(On(W,this._rawValidators))}removeAsyncValidators(W){this.setAsyncValidators(On(W,this._rawAsyncValidators))}hasValidator(W){return mt(this._rawValidators,W)}hasAsyncValidator(W){return mt(this._rawAsyncValidators,W)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(W={}){this.touched=!0,this._parent&&!W.onlySelf&&this._parent.markAsTouched(W)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(W=>W.markAllAsTouched())}markAsUntouched(W={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(H=>{H.markAsUntouched({onlySelf:!0})}),this._parent&&!W.onlySelf&&this._parent._updateTouched(W)}markAsDirty(W={}){this.pristine=!1,this._parent&&!W.onlySelf&&this._parent.markAsDirty(W)}markAsPristine(W={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(H=>{H.markAsPristine({onlySelf:!0})}),this._parent&&!W.onlySelf&&this._parent._updatePristine(W)}markAsPending(W={}){this.status=Pn,!1!==W.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!W.onlySelf&&this._parent.markAsPending(W)}disable(W={}){const H=this._parentMarkedDirty(W.onlySelf);this.status=Vn,this.errors=null,this._forEachChild(Fe=>{Fe.disable({...W,onlySelf:!0})}),this._updateValue(),!1!==W.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...W,skipPristineCheck:H}),this._onDisabledChange.forEach(Fe=>Fe(!0))}enable(W={}){const H=this._parentMarkedDirty(W.onlySelf);this.status=Gt,this._forEachChild(Fe=>{Fe.enable({...W,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:W.emitEvent}),this._updateAncestors({...W,skipPristineCheck:H}),this._onDisabledChange.forEach(Fe=>Fe(!1))}_updateAncestors(W){this._parent&&!W.onlySelf&&(this._parent.updateValueAndValidity(W),W.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(W){this._parent=W}updateValueAndValidity(W={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Gt||this.status===Pn)&&this._runAsyncValidator(W.emitEvent)),!1!==W.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!W.onlySelf&&this._parent.updateValueAndValidity(W)}_updateTreeValidity(W={emitEvent:!0}){this._forEachChild(H=>H._updateTreeValidity(W)),this.updateValueAndValidity({onlySelf:!0,emitEvent:W.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Vn:Gt}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(W){if(this.asyncValidator){this.status=Pn,this._hasOwnPendingAsyncValidator=!0;const H=Bt(this.asyncValidator(this));this._asyncValidationSubscription=H.subscribe(Fe=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(Fe,{emitEvent:W})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(W,H={}){this.errors=W,this._updateControlsErrors(!1!==H.emitEvent)}get(W){return function Yn(ie,W,H){if(null==W||(Array.isArray(W)||(W=W.split(H)),Array.isArray(W)&&0===W.length))return null;let Fe=ie;return W.forEach(dn=>{Fe=ti(Fe)?Fe.controls.hasOwnProperty(dn)?Fe.controls[dn]:null:(ie=>ie instanceof wo)(Fe)&&Fe.at(dn)||null}),Fe}(this,W,".")}getError(W,H){const Fe=H?this.get(H):this;return Fe&&Fe.errors?Fe.errors[W]:null}hasError(W,H){return!!this.getError(W,H)}get root(){let W=this;for(;W._parent;)W=W._parent;return W}_updateControlsErrors(W){this.status=this._calculateStatus(),W&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(W)}_initObservables(){this.valueChanges=new b.vpe,this.statusChanges=new b.vpe}_calculateStatus(){return this._allControlsDisabled()?Vn:this.errors?At:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Pn)?Pn:this._anyControlsHaveStatus(At)?At:Gt}_anyControlsHaveStatus(W){return this._anyControls(H=>H.status===W)}_anyControlsDirty(){return this._anyControls(W=>W.dirty)}_anyControlsTouched(){return this._anyControls(W=>W.touched)}_updatePristine(W={}){this.pristine=!this._anyControlsDirty(),this._parent&&!W.onlySelf&&this._parent._updatePristine(W)}_updateTouched(W={}){this.touched=this._anyControlsTouched(),this._parent&&!W.onlySelf&&this._parent._updateTouched(W)}_isBoxedValue(W){return"object"==typeof W&&null!==W&&2===Object.keys(W).length&&"value"in W&&"disabled"in W}_registerOnCollectionChange(W){this._onCollectionChange=W}_setUpdateStrategy(W){di(W)&&null!=W.updateOn&&(this._updateOn=W.updateOn)}_parentMarkedDirty(W){return!W&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class or extends fr{constructor(W=null,H,Fe){super(qn(H),Li(Fe,H)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(W),this._setUpdateStrategy(H),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),di(H)&&H.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(W)?W.value:W)}setValue(W,H={}){this.value=this._pendingValue=W,this._onChange.length&&!1!==H.emitModelToViewChange&&this._onChange.forEach(Fe=>Fe(this.value,!1!==H.emitViewToModelChange)),this.updateValueAndValidity(H)}patchValue(W,H={}){this.setValue(W,H)}reset(W=this.defaultValue,H={}){this._applyFormState(W),this.markAsPristine(H),this.markAsUntouched(H),this.setValue(this.value,H),this._pendingChange=!1}_updateValue(){}_anyControls(W){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(W){this._onChange.push(W)}_unregisterOnChange(W){Je(this._onChange,W)}registerOnDisabledChange(W){this._onDisabledChange.push(W)}_unregisterOnDisabledChange(W){Je(this._onDisabledChange,W)}_forEachChild(W){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(W){this._isBoxedValue(W)?(this.value=this._pendingValue=W.value,W.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=W}}class Sr extends fr{constructor(W,H,Fe){super(qn(H),Li(Fe,H)),this.controls=W,this._initObservables(),this._setUpdateStrategy(H),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(W,H){return this.controls[W]?this.controls[W]:(this.controls[W]=H,H.setParent(this),H._registerOnCollectionChange(this._onCollectionChange),H)}addControl(W,H,Fe={}){this.registerControl(W,H),this.updateValueAndValidity({emitEvent:Fe.emitEvent}),this._onCollectionChange()}removeControl(W,H={}){this.controls[W]&&this.controls[W]._registerOnCollectionChange(()=>{}),delete this.controls[W],this.updateValueAndValidity({emitEvent:H.emitEvent}),this._onCollectionChange()}setControl(W,H,Fe={}){this.controls[W]&&this.controls[W]._registerOnCollectionChange(()=>{}),delete this.controls[W],H&&this.registerControl(W,H),this.updateValueAndValidity({emitEvent:Fe.emitEvent}),this._onCollectionChange()}contains(W){return this.controls.hasOwnProperty(W)&&this.controls[W].enabled}setValue(W,H={}){oi(this,W),Object.keys(W).forEach(Fe=>{pr(this,Fe),this.controls[Fe].setValue(W[Fe],{onlySelf:!0,emitEvent:H.emitEvent})}),this.updateValueAndValidity(H)}patchValue(W,H={}){null!=W&&(Object.keys(W).forEach(Fe=>{this.controls[Fe]&&this.controls[Fe].patchValue(W[Fe],{onlySelf:!0,emitEvent:H.emitEvent})}),this.updateValueAndValidity(H))}reset(W={},H={}){this._forEachChild((Fe,dn)=>{Fe.reset(W[dn],{onlySelf:!0,emitEvent:H.emitEvent})}),this._updatePristine(H),this._updateTouched(H),this.updateValueAndValidity(H)}getRawValue(){return this._reduceChildren({},(W,H,Fe)=>(W[Fe]=Ni(H),W))}_syncPendingControls(){let W=this._reduceChildren(!1,(H,Fe)=>!!Fe._syncPendingControls()||H);return W&&this.updateValueAndValidity({onlySelf:!0}),W}_forEachChild(W){Object.keys(this.controls).forEach(H=>{const Fe=this.controls[H];Fe&&W(Fe,H)})}_setUpControls(){this._forEachChild(W=>{W.setParent(this),W._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(W){for(const H of Object.keys(this.controls)){const Fe=this.controls[H];if(this.contains(H)&&W(Fe))return!0}return!1}_reduceValue(){return this._reduceChildren({},(W,H,Fe)=>((H.enabled||this.disabled)&&(W[Fe]=H.value),W))}_reduceChildren(W,H){let Fe=W;return this._forEachChild((dn,ei)=>{Fe=H(Fe,dn,ei)}),Fe}_allControlsDisabled(){for(const W of Object.keys(this.controls))if(this.controls[W].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class wo extends fr{constructor(W,H,Fe){super(qn(H),Li(Fe,H)),this.controls=W,this._initObservables(),this._setUpdateStrategy(H),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(W){return this.controls[W]}push(W,H={}){this.controls.push(W),this._registerControl(W),this.updateValueAndValidity({emitEvent:H.emitEvent}),this._onCollectionChange()}insert(W,H,Fe={}){this.controls.splice(W,0,H),this._registerControl(H),this.updateValueAndValidity({emitEvent:Fe.emitEvent})}removeAt(W,H={}){this.controls[W]&&this.controls[W]._registerOnCollectionChange(()=>{}),this.controls.splice(W,1),this.updateValueAndValidity({emitEvent:H.emitEvent})}setControl(W,H,Fe={}){this.controls[W]&&this.controls[W]._registerOnCollectionChange(()=>{}),this.controls.splice(W,1),H&&(this.controls.splice(W,0,H),this._registerControl(H)),this.updateValueAndValidity({emitEvent:Fe.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(W,H={}){oi(this,W),W.forEach((Fe,dn)=>{pr(this,dn),this.at(dn).setValue(Fe,{onlySelf:!0,emitEvent:H.emitEvent})}),this.updateValueAndValidity(H)}patchValue(W,H={}){null!=W&&(W.forEach((Fe,dn)=>{this.at(dn)&&this.at(dn).patchValue(Fe,{onlySelf:!0,emitEvent:H.emitEvent})}),this.updateValueAndValidity(H))}reset(W=[],H={}){this._forEachChild((Fe,dn)=>{Fe.reset(W[dn],{onlySelf:!0,emitEvent:H.emitEvent})}),this._updatePristine(H),this._updateTouched(H),this.updateValueAndValidity(H)}getRawValue(){return this.controls.map(W=>Ni(W))}clear(W={}){this.controls.length<1||(this._forEachChild(H=>H._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:W.emitEvent}))}_syncPendingControls(){let W=this.controls.reduce((H,Fe)=>!!Fe._syncPendingControls()||H,!1);return W&&this.updateValueAndValidity({onlySelf:!0}),W}_forEachChild(W){this.controls.forEach((H,Fe)=>{W(H,Fe)})}_updateValue(){this.value=this.controls.filter(W=>W.enabled||this.disabled).map(W=>W.value)}_anyControls(W){return this.controls.some(H=>H.enabled&&W(H))}_setUpControls(){this._forEachChild(W=>this._registerControl(W))}_allControlsDisabled(){for(const W of this.controls)if(W.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(W){W.setParent(this),W._registerOnCollectionChange(this._onCollectionChange)}}const ct={provide:li,useExisting:(0,b.Gpc)(()=>Pt)},Vt=(()=>Promise.resolve(null))();let Pt=(()=>{class ie extends li{constructor(H,Fe,dn,ei,Or){super(),this._changeDetectorRef=Or,this.control=new or,this._registered=!1,this.update=new b.vpe,this._parent=H,this._setValidators(Fe),this._setAsyncValidators(dn),this.valueAccessor=function Ct(ie,W){if(!W)return null;let H,Fe,dn;return Array.isArray(W),W.forEach(ei=>{ei.constructor===ye?H=ei:function Ye(ie){return Object.getPrototypeOf(ie.constructor)===g}(ei)?Fe=ei:dn=ei}),dn||Fe||H||null}(0,ei)}ngOnChanges(H){if(this._checkForErrors(),!this._registered||"name"in H){if(this._registered&&(this._checkName(),this.formDirective)){const Fe=H.name.previousValue;this.formDirective.removeControl({name:Fe,path:this._getPath(Fe)})}this._setUpControl()}"isDisabled"in H&&this._updateDisabled(H),function we(ie,W){if(!ie.hasOwnProperty("model"))return!1;const H=ie.model;return!!H.isFirstChange()||!Object.is(W,H.currentValue)}(H,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(H){this.viewModel=H,this.update.emit(H)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){ci(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(H){Vt.then(()=>{this.control.setValue(H,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(H){const Fe=H.isDisabled.currentValue,dn=""===Fe||Fe&&"false"!==Fe;Vt.then(()=>{dn&&!this.control.disabled?this.control.disable():!dn&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(H){return this._parent?function mi(ie,W){return[...W.path,ie]}(H,this._parent):[H]}}return ie.\u0275fac=function(H){return new(H||ie)(b.Y36(jn,9),b.Y36(We,10),b.Y36(be,10),b.Y36(ne,10),b.Y36(b.sBO,8))},ie.\u0275dir=b.lG2({type:ie,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[b._Bn([ct]),b.qOj,b.TTD]}),ie})();const fn={provide:ne,useExisting:(0,b.Gpc)(()=>un),multi:!0};let un=(()=>{class ie extends g{writeValue(H){this.setProperty("value",H??"")}registerOnChange(H){this.onChange=Fe=>{H(""==Fe?null:parseFloat(Fe))}}}return ie.\u0275fac=function(){let W;return function(Fe){return(W||(W=b.n5z(ie)))(Fe||ie)}}(),ie.\u0275dir=b.lG2({type:ie,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(H,Fe){1&H&&b.NdJ("input",function(ei){return Fe.onChange(ei.target.value)})("blur",function(){return Fe.onTouched()})},features:[b._Bn([fn]),b.qOj]}),ie})(),St=(()=>{class ie{}return ie.\u0275fac=function(H){return new(H||ie)},ie.\u0275mod=b.oAB({type:ie}),ie.\u0275inj=b.cJS({}),ie})();function oo(ie){return"number"==typeof ie?ie:parseFloat(ie)}let Jo=(()=>{class ie{constructor(){this._validator=xt}ngOnChanges(H){if(this.inputName in H){const Fe=this.normalizeInput(H[this.inputName].currentValue);this._enabled=this.enabled(Fe),this._validator=this._enabled?this.createValidator(Fe):xt,this._onChange&&this._onChange()}}validate(H){return this._validator(H)}registerOnValidatorChange(H){this._onChange=H}enabled(H){return null!=H}}return ie.\u0275fac=function(H){return new(H||ie)},ie.\u0275dir=b.lG2({type:ie,features:[b.TTD]}),ie})();const Ms={provide:We,useExisting:(0,b.Gpc)(()=>Gr),multi:!0};let Gr=(()=>{class ie extends Jo{constructor(){super(...arguments),this.inputName="max",this.normalizeInput=H=>oo(H),this.createValidator=H=>function et(ie){return W=>{if(xe(W.value)||xe(ie))return null;const H=parseFloat(W.value);return!isNaN(H)&&H>ie?{max:{max:ie,actual:W.value}}:null}}(H)}}return ie.\u0275fac=function(){let W;return function(Fe){return(W||(W=b.n5z(ie)))(Fe||ie)}}(),ie.\u0275dir=b.lG2({type:ie,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(H,Fe){2&H&&b.uIk("max",Fe._enabled?Fe.max:null)},inputs:{max:"max"},features:[b._Bn([Ms]),b.qOj]}),ie})();const Vs={provide:We,useExisting:(0,b.Gpc)(()=>lo),multi:!0};let lo=(()=>{class ie extends Jo{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=H=>oo(H),this.createValidator=H=>function tt(ie){return W=>{if(xe(W.value)||xe(ie))return null;const H=parseFloat(W.value);return!isNaN(H)&&H<ie?{min:{min:ie,actual:W.value}}:null}}(H)}}return ie.\u0275fac=function(){let W;return function(Fe){return(W||(W=b.n5z(ie)))(Fe||ie)}}(),ie.\u0275dir=b.lG2({type:ie,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(H,Fe){2&H&&b.uIk("min",Fe._enabled?Fe.min:null)},inputs:{min:"min"},features:[b._Bn([Vs]),b.qOj]}),ie})(),Hn=(()=>{class ie{}return ie.\u0275fac=function(H){return new(H||ie)},ie.\u0275mod=b.oAB({type:ie}),ie.\u0275inj=b.cJS({imports:[[St]]}),ie})(),Fr=(()=>{class ie{}return ie.\u0275fac=function(H){return new(H||ie)},ie.\u0275mod=b.oAB({type:ie}),ie.\u0275inj=b.cJS({imports:[Hn]}),ie})()},3334:(An,vt,k)=>{"use strict";k.d(vt,{gz:()=>Ai,y6:()=>co,OD:()=>Ft,eC:()=>K,wN:()=>Da,F0:()=>jo,rH:()=>Ia,Bz:()=>Ol,Hx:()=>xi});var b=k(6895),d=k(6738),pe=k(2866),l=k(6688),J=k(3489);class j extends J.L{notifyNext(O,P,G,le,Pe){this.destination.next(P)}notifyError(O,P){this.destination.error(O)}notifyComplete(O){this.destination.complete()}}class g extends J.L{constructor(O,P,G){super(),this.parent=O,this.outerValue=P,this.outerIndex=G,this.index=0}_next(O){this.parent.notifyNext(this.outerValue,O,this.outerIndex,this.index++,this)}_error(O){this.parent.notifyError(O,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}var ne=k(9249),ge=k(2916);function Q(z,O,P,G,le=new g(z,P,G)){if(!le.closed)return O instanceof ge.y?O.subscribe(le):(0,ne.s)(O)(le)}var Y=k(3009);const se={};class ye{constructor(O){this.resultSelector=O}call(O,P){return P.subscribe(new xe(O,this.resultSelector))}}class xe extends j{constructor(O,P){super(O),this.resultSelector=P,this.active=0,this.values=[],this.observables=[]}_next(O){this.values.push(se),this.observables.push(O)}_complete(){const O=this.observables,P=O.length;if(0===P)this.destination.complete();else{this.active=P,this.toRespond=P;for(let G=0;G<P;G++)this.add(Q(this,O[G],void 0,G))}}notifyComplete(O){0==(this.active-=1)&&this.destination.complete()}notifyNext(O,P,G){const le=this.values,st=this.toRespond?le[G]===se?--this.toRespond:this.toRespond:0;le[G]=P,0===st&&(this.resultSelector?this._tryResultSelector(le):this.destination.next(le.slice()))}_tryResultSelector(O){let P;try{P=this.resultSelector.apply(this,O)}catch(G){return void this.destination.error(G)}this.destination.next(P)}}const We=(()=>{function z(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return z.prototype=Object.create(Error.prototype),z})();var be=k(5254),Se=k(1086),ze=k(591),tt=k(1221),et=k(8514),Be=k(8896),C=k(1762),Ge=k(8929);function ht(z,O){let P=!1;return arguments.length>=2&&(P=!0),function(le){return le.lift(new wt(z,O,P))}}class wt{constructor(O,P,G=!1){this.accumulator=O,this.seed=P,this.hasSeed=G}call(O,P){return P.subscribe(new xt(O,this.accumulator,this.seed,this.hasSeed))}}class xt extends J.L{constructor(O,P,G,le){super(O),this.accumulator=P,this._seed=G,this.hasSeed=le,this.index=0}get seed(){return this._seed}set seed(O){this.hasSeed=!0,this._seed=O}_next(O){if(this.hasSeed)return this._tryNext(O);this.seed=O,this.destination.next(O)}_tryNext(O){const P=this.index++;let G;try{G=this.accumulator(this.seed,O,P)}catch(le){this.destination.error(le)}this.seed=G,this.destination.next(G)}}var gt=k(1177);function Bt(z){return function(P){const G=new Ht(z),le=P.lift(G);return G.caught=le}}class Ht{constructor(O){this.selector=O}call(O,P){return P.subscribe(new Gn(O,this.selector,this.caught))}}class Gn extends gt.Ds{constructor(O,P,G){super(O),this.selector=P,this.caught=G}error(O){if(!this.isStopped){let P;try{P=this.selector(O,this.caught)}catch(Pe){return void super.error(Pe)}this._unsubscribeAndRecycle();const G=new gt.IY(this);this.add(G);const le=(0,gt.ft)(P,G);le!==G&&this.add(le)}}}var It=k(2198),jt=k(4231);function Ut(z){return function(P){return 0===z?(0,Be.c)():P.lift(new Yt(z))}}class Yt{constructor(O){if(this.total=O,this.total<0)throw new jt.W}call(O,P){return P.subscribe(new zt(O,this.total))}}class zt extends J.L{constructor(O,P){super(O),this.total=P,this.ring=new Array,this.count=0}_next(O){const P=this.ring,G=this.total,le=this.count++;P.length<G?P.push(O):P[le%G]=O}_complete(){const O=this.destination;let P=this.count;if(P>0){const G=this.count>=this.total?this.total:this.count,le=this.ring;for(let Pe=0;Pe<G;Pe++){const st=P++%G;O.next(le[st])}}O.complete()}}function Zt(z=an){return O=>O.lift(new ln(z))}class ln{constructor(O){this.errorFactory=O}call(O,P){return P.subscribe(new xn(O,this.errorFactory))}}class xn extends J.L{constructor(O,P){super(O),this.errorFactory=P,this.hasValue=!1}_next(O){this.hasValue=!0,this.destination.next(O)}_complete(){if(this.hasValue)return this.destination.complete();{let O;try{O=this.errorFactory()}catch(P){O=P}this.destination.error(O)}}}function an(){return new We}function Kt(z=null){return O=>O.lift(new mt(z))}class mt{constructor(O){this.defaultValue=O}call(O,P){return P.subscribe(new Wt(O,this.defaultValue))}}class Wt extends J.L{constructor(O,P){super(O),this.defaultValue=P,this.isEmpty=!0}_next(O){this.isEmpty=!1,this.destination.next(O)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}var On=k(5379),jn=k(2986);function li(z,O){const P=arguments.length>=2;return G=>G.pipe(z?(0,It.h)((le,Pe)=>z(le,Pe,G)):On.y,(0,jn.q)(1),P?Kt(O):Zt(()=>new We))}function $i(){}var rr=k(7043);function Bi(z,O,P){return function(le){return le.lift(new _i(z,O,P))}}class _i{constructor(O,P,G){this.nextOrObserver=O,this.error=P,this.complete=G}call(O,P){return P.subscribe(new tr(O,this.nextOrObserver,this.error,this.complete))}}class tr extends J.L{constructor(O,P,G,le){super(O),this._tapNext=$i,this._tapError=$i,this._tapComplete=$i,this._tapError=G||$i,this._tapComplete=le||$i,(0,rr.m)(P)?(this._context=this,this._tapNext=P):P&&(this._context=P,this._tapNext=P.next||$i,this._tapError=P.error||$i,this._tapComplete=P.complete||$i)}_next(O){try{this._tapNext.call(this._context,O)}catch(P){return void this.destination.error(P)}this.destination.next(O)}_error(O){try{this._tapError.call(this._context,O)}catch(P){return void this.destination.error(P)}this.destination.error(O)}_complete(){try{this._tapComplete.call(this._context)}catch(O){return void this.destination.error(O)}return this.destination.complete()}}var gi=k(2654);class Xt{constructor(O){this.callback=O}call(O,P){return P.subscribe(new Oe(O,this.callback))}}class Oe extends J.L{constructor(O,P){super(O),this.add(new gi.w(P))}}var ae=k(4850),Re=k(7545),lt=k(1406),Le=k(1709),Rt=k(4327),me=k(9146);class He{constructor(O,P){this.id=O,this.url=P}}class Ft extends He{constructor(O,P,G="imperative",le=null){super(O,P),this.navigationTrigger=G,this.restoredState=le}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Qt extends He{constructor(O,P,G){super(O,P),this.urlAfterRedirects=G}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Jn extends He{constructor(O,P,G){super(O,P),this.reason=G}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Ki extends He{constructor(O,P,G){super(O,P),this.error=G}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Di extends He{constructor(O,P,G,le){super(O,P),this.urlAfterRedirects=G,this.state=le}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class mi extends He{constructor(O,P,G,le){super(O,P),this.urlAfterRedirects=G,this.state=le}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ci extends He{constructor(O,P,G,le,Pe){super(O,P),this.urlAfterRedirects=G,this.state=le,this.shouldActivate=Pe}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class xr extends He{constructor(O,P,G,le){super(O,P),this.urlAfterRedirects=G,this.state=le}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ii extends He{constructor(O,P,G,le){super(O,P),this.urlAfterRedirects=G,this.state=le}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class hr{constructor(O){this.route=O}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class yi{constructor(O){this.route=O}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class kr{constructor(O){this.snapshot=O}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class gr{constructor(O){this.snapshot=O}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Tr{constructor(O){this.snapshot=O}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ci{constructor(O){this.snapshot=O}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Oi{constructor(O,P,G){this.routerEvent=O,this.position=P,this.anchor=G}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const K="primary";class q{constructor(O){this.params=O||{}}has(O){return Object.prototype.hasOwnProperty.call(this.params,O)}get(O){if(this.has(O)){const P=this.params[O];return Array.isArray(P)?P[0]:P}return null}getAll(O){if(this.has(O)){const P=this.params[O];return Array.isArray(P)?P:[P]}return[]}get keys(){return Object.keys(this.params)}}function L(z){return new q(z)}const de="ngNavigationCancelingError";function we(z){const O=Error("NavigationCancelingError: "+z);return O[de]=!0,O}function pt(z,O,P){const G=P.path.split("/");if(G.length>z.length||"full"===P.pathMatch&&(O.hasChildren()||G.length<z.length))return null;const le={};for(let Pe=0;Pe<G.length;Pe++){const st=G[Pe],yt=z[Pe];if(st.startsWith(":"))le[st.substring(1)]=yt;else if(st!==yt.path)return null}return{consumed:z.slice(0,G.length),posParams:le}}function Je(z,O){const P=z?Object.keys(z):void 0,G=O?Object.keys(O):void 0;if(!P||!G||P.length!=G.length)return!1;let le;for(let Pe=0;Pe<P.length;Pe++)if(le=P[Pe],!Lt(z[le],O[le]))return!1;return!0}function Lt(z,O){if(Array.isArray(z)&&Array.isArray(O)){if(z.length!==O.length)return!1;const P=[...z].sort(),G=[...O].sort();return P.every((le,Pe)=>G[Pe]===le)}return z===O}function en(z){return Array.prototype.concat.apply([],z)}function Gt(z){return z.length>0?z[z.length-1]:null}function Pn(z,O){for(const P in z)z.hasOwnProperty(P)&&O(z[P],P)}function Vn(z){return(0,d.CqO)(z)?z:(0,d.QGY)(z)?(0,be.D)(Promise.resolve(z)):(0,Se.of)(z)}const qn={exact:function di(z,O,P){if(!Sr(z.segments,O.segments)||!Ni(z.segments,O.segments,P)||z.numberOfChildren!==O.numberOfChildren)return!1;for(const G in O.children)if(!z.children[G]||!di(z.children[G],O.children[G],P))return!1;return!0},subset:ti},ni={exact:function Mi(z,O){return Je(z,O)},subset:function En(z,O){return Object.keys(O).length<=Object.keys(z).length&&Object.keys(O).every(P=>Lt(z[P],O[P]))},ignored:()=>!0};function Li(z,O,P){return qn[P.paths](z.root,O.root,P.matrixParams)&&ni[P.queryParams](z.queryParams,O.queryParams)&&!("exact"===P.fragment&&z.fragment!==O.fragment)}function ti(z,O,P){return Yi(z,O,O.segments,P)}function Yi(z,O,P,G){if(z.segments.length>P.length){const le=z.segments.slice(0,P.length);return!(!Sr(le,P)||O.hasChildren()||!Ni(le,P,G))}if(z.segments.length===P.length){if(!Sr(z.segments,P)||!Ni(z.segments,P,G))return!1;for(const le in O.children)if(!z.children[le]||!ti(z.children[le],O.children[le],G))return!1;return!0}{const le=P.slice(0,z.segments.length),Pe=P.slice(z.segments.length);return!!(Sr(z.segments,le)&&Ni(z.segments,le,G)&&z.children[K])&&Yi(z.children[K],O,Pe,G)}}function Ni(z,O,P){return O.every((G,le)=>ni[P](z[le].parameters,G.parameters))}class pr{constructor(O,P,G){this.root=O,this.queryParams=P,this.fragment=G}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=L(this.queryParams)),this._queryParamMap}toString(){return $r.serialize(this)}}class oi{constructor(O,P){this.segments=O,this.children=P,this.parent=null,Pn(P,(G,le)=>G.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return jr(this)}}class fr{constructor(O,P){this.path=O,this.parameters=P}get parameterMap(){return this._parameterMap||(this._parameterMap=L(this.parameters)),this._parameterMap}toString(){return Vt(this)}}function Sr(z,O){return z.length===O.length&&z.every((P,G)=>P.path===O[G].path)}class xi{}class io{parse(O){const P=new Ri(O);return new pr(P.parseRootSegment(),P.parseQueryParams(),P.parseFragment())}serialize(O){const P=`/${Pr(O.root,!0)}`,G=function rn(z){const O=Object.keys(z).map(P=>{const G=z[P];return Array.isArray(G)?G.map(le=>`${to(P)}=${to(le)}`).join("&"):`${to(P)}=${to(G)}`}).filter(P=>!!P);return O.length?`?${O.join("&")}`:""}(O.queryParams);return`${P}${G}${"string"==typeof O.fragment?`#${function Ie(z){return encodeURI(z)}(O.fragment)}`:""}`}}const $r=new io;function jr(z){return z.segments.map(O=>Vt(O)).join("/")}function Pr(z,O){if(!z.hasChildren())return jr(z);if(O){const P=z.children[K]?Pr(z.children[K],!1):"",G=[];return Pn(z.children,(le,Pe)=>{Pe!==K&&G.push(`${Pe}:${Pr(le,!1)}`)}),G.length>0?`${P}(${G.join("//")})`:P}{const P=function wo(z,O){let P=[];return Pn(z.children,(G,le)=>{le===K&&(P=P.concat(O(G,le)))}),Pn(z.children,(G,le)=>{le!==K&&(P=P.concat(O(G,le)))}),P}(z,(G,le)=>le===K?[Pr(z.children[K],!1)]:[`${le}:${Pr(G,!1)}`]);return 1===Object.keys(z.children).length&&null!=z.children[K]?`${jr(z)}/${P[0]}`:`${jr(z)}/(${P.join("//")})`}}function Cr(z){return encodeURIComponent(z).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function to(z){return Cr(z).replace(/%3B/gi,";")}function _e(z){return Cr(z).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function qe(z){return decodeURIComponent(z)}function ct(z){return qe(z.replace(/\+/g,"%20"))}function Vt(z){return`${_e(z.path)}${function Pt(z){return Object.keys(z).map(O=>`;${_e(O)}=${_e(z[O])}`).join("")}(z.parameters)}`}const fn=/^[^\/()?;=#]+/;function un(z){const O=z.match(fn);return O?O[0]:""}const Cn=/^[^=?&#]+/,St=/^[^&#]+/;class Ri{constructor(O){this.url=O,this.remaining=O}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new oi([],{}):new oi([],this.parseChildren())}parseQueryParams(){const O={};if(this.consumeOptional("?"))do{this.parseQueryParam(O)}while(this.consumeOptional("&"));return O}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const O=[];for(this.peekStartsWith("(")||O.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),O.push(this.parseSegment());let P={};this.peekStartsWith("/(")&&(this.capture("/"),P=this.parseParens(!0));let G={};return this.peekStartsWith("(")&&(G=this.parseParens(!1)),(O.length>0||Object.keys(P).length>0)&&(G[K]=new oi(O,P)),G}parseSegment(){const O=un(this.remaining);if(""===O&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(O),new fr(qe(O),this.parseMatrixParams())}parseMatrixParams(){const O={};for(;this.consumeOptional(";");)this.parseParam(O);return O}parseParam(O){const P=un(this.remaining);if(!P)return;this.capture(P);let G="";if(this.consumeOptional("=")){const le=un(this.remaining);le&&(G=le,this.capture(G))}O[qe(P)]=qe(G)}parseQueryParam(O){const P=function Un(z){const O=z.match(Cn);return O?O[0]:""}(this.remaining);if(!P)return;this.capture(P);let G="";if(this.consumeOptional("=")){const st=function on(z){const O=z.match(St);return O?O[0]:""}(this.remaining);st&&(G=st,this.capture(G))}const le=ct(P),Pe=ct(G);if(O.hasOwnProperty(le)){let st=O[le];Array.isArray(st)||(st=[st],O[le]=st),st.push(Pe)}else O[le]=Pe}parseParens(O){const P={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const G=un(this.remaining),le=this.remaining[G.length];if("/"!==le&&")"!==le&&";"!==le)throw new Error(`Cannot parse url '${this.url}'`);let Pe;G.indexOf(":")>-1?(Pe=G.substr(0,G.indexOf(":")),this.capture(Pe),this.capture(":")):O&&(Pe=K);const st=this.parseChildren();P[Pe]=1===Object.keys(st).length?st[K]:new oi([],st),this.consumeOptional("//")}return P}peekStartsWith(O){return this.remaining.startsWith(O)}consumeOptional(O){return!!this.peekStartsWith(O)&&(this.remaining=this.remaining.substring(O.length),!0)}capture(O){if(!this.consumeOptional(O))throw new Error(`Expected "${O}".`)}}class Ur{constructor(O){this._root=O}get root(){return this._root.value}parent(O){const P=this.pathFromRoot(O);return P.length>1?P[P.length-2]:null}children(O){const P=ji(O,this._root);return P?P.children.map(G=>G.value):[]}firstChild(O){const P=ji(O,this._root);return P&&P.children.length>0?P.children[0].value:null}siblings(O){const P=_r(O,this._root);return P.length<2?[]:P[P.length-2].children.map(le=>le.value).filter(le=>le!==O)}pathFromRoot(O){return _r(O,this._root).map(P=>P.value)}}function ji(z,O){if(z===O.value)return O;for(const P of O.children){const G=ji(z,P);if(G)return G}return null}function _r(z,O){if(z===O.value)return[O];for(const P of O.children){const G=_r(z,P);if(G.length)return G.unshift(O),G}return[]}class Qi{constructor(O,P){this.value=O,this.children=P}toString(){return`TreeNode(${this.value})`}}function Ao(z){const O={};return z&&z.children.forEach(P=>O[P.value.outlet]=P),O}class fo extends Ur{constructor(O,P){super(O),this.snapshot=P,Tt(this,O)}toString(){return this.snapshot.toString()}}function zn(z,O){const P=function Gi(z,O){const st=new Xe([],{},{},"",{},K,O,null,z.root,-1,{});return new ke("",new Qi(st,[]))}(z,O),G=new ze.X([new fr("",{})]),le=new ze.X({}),Pe=new ze.X({}),st=new ze.X({}),yt=new ze.X(""),_n=new Ai(G,le,st,yt,Pe,K,O,P.root);return _n.snapshot=P.root,new fo(new Qi(_n,[]),P)}class Ai{constructor(O,P,G,le,Pe,st,yt,_n){this.url=O,this.params=P,this.queryParams=G,this.fragment=le,this.data=Pe,this.outlet=st,this.component=yt,this._futureSnapshot=_n}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,ae.U)(O=>L(O)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,ae.U)(O=>L(O)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Lo(z,O="emptyOnly"){const P=z.pathFromRoot;let G=0;if("always"!==O)for(G=P.length-1;G>=1;){const le=P[G],Pe=P[G-1];if(le.routeConfig&&""===le.routeConfig.path)G--;else{if(Pe.component)break;G--}}return function nt(z){return z.reduce((O,P)=>({params:{...O.params,...P.params},data:{...O.data,...P.data},resolve:{...O.resolve,...P._resolvedData}}),{params:{},data:{},resolve:{}})}(P.slice(G))}class Xe{constructor(O,P,G,le,Pe,st,yt,_n,fi,Zr,Si){this.url=O,this.params=P,this.queryParams=G,this.fragment=le,this.data=Pe,this.outlet=st,this.component=yt,this.routeConfig=_n,this._urlSegment=fi,this._lastPathIndex=Zr,this._resolve=Si}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=L(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=L(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(G=>G.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class ke extends Ur{constructor(O,P){super(P),this.url=O,Tt(this,P)}toString(){return nn(this._root)}}function Tt(z,O){O.value._routerState=z,O.children.forEach(P=>Tt(z,P))}function nn(z){const O=z.children.length>0?` { ${z.children.map(nn).join(", ")} } `:"";return`${z.value}${O}`}function ii(z){if(z.snapshot){const O=z.snapshot,P=z._futureSnapshot;z.snapshot=P,Je(O.queryParams,P.queryParams)||z.queryParams.next(P.queryParams),O.fragment!==P.fragment&&z.fragment.next(P.fragment),Je(O.params,P.params)||z.params.next(P.params),function Ct(z,O){if(z.length!==O.length)return!1;for(let P=0;P<z.length;++P)if(!Je(z[P],O[P]))return!1;return!0}(O.url,P.url)||z.url.next(P.url),Je(O.data,P.data)||z.data.next(P.data)}else z.snapshot=z._futureSnapshot,z.data.next(z._futureSnapshot.data)}function hi(z,O){const P=Je(z.params,O.params)&&function or(z,O){return Sr(z,O)&&z.every((P,G)=>Je(P.parameters,O[G].parameters))}(z.url,O.url);return P&&!(!z.parent!=!O.parent)&&(!z.parent||hi(z.parent,O.parent))}function sr(z,O,P){if(P&&z.shouldReuseRoute(O.value,P.value.snapshot)){const G=P.value;G._futureSnapshot=O.value;const le=function ms(z,O,P){return O.children.map(G=>{for(const le of P.children)if(z.shouldReuseRoute(G.value,le.value.snapshot))return sr(z,G,le);return sr(z,G)})}(z,O,P);return new Qi(G,le)}{if(z.shouldAttach(O.value)){const Pe=z.retrieve(O.value);if(null!==Pe){const st=Pe.route;return st.value._futureSnapshot=O.value,st.children=O.children.map(yt=>sr(z,yt)),st}}const G=function gs(z){return new Ai(new ze.X(z.url),new ze.X(z.params),new ze.X(z.queryParams),new ze.X(z.fragment),new ze.X(z.data),z.outlet,z.component,z)}(O.value),le=O.children.map(Pe=>sr(z,Pe));return new Qi(G,le)}}function Bo(z){return"object"==typeof z&&null!=z&&!z.outlets&&!z.segmentPath}function zi(z){return"object"==typeof z&&null!=z&&z.outlets}function Ls(z,O,P,G,le){let Pe={};return G&&Pn(G,(st,yt)=>{Pe[yt]=Array.isArray(st)?st.map(_n=>`${_n}`):`${st}`}),new pr(P.root===z?O:Xs(P.root,z,O),Pe,le)}function Xs(z,O,P){const G={};return Pn(z.children,(le,Pe)=>{G[Pe]=le===O?P:Xs(le,O,P)}),new oi(z.segments,G)}class ki{constructor(O,P,G){if(this.isAbsolute=O,this.numberOfDoubleDots=P,this.commands=G,O&&G.length>0&&Bo(G[0]))throw new Error("Root segment cannot have matrix parameters");const le=G.find(zi);if(le&&le!==Gt(G))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Jo{constructor(O,P,G){this.segmentGroup=O,this.processChildren=P,this.index=G}}function lo(z,O,P){if(z||(z=new oi([],{})),0===z.segments.length&&z.hasChildren())return Kr(z,O,P);const G=function As(z,O,P){let G=0,le=O;const Pe={match:!1,pathIndex:0,commandIndex:0};for(;le<z.segments.length;){if(G>=P.length)return Pe;const st=z.segments[le],yt=P[G];if(zi(yt))break;const _n=`${yt}`,fi=G<P.length-1?P[G+1]:null;if(le>0&&void 0===_n)break;if(_n&&fi&&"object"==typeof fi&&void 0===fi.outlets){if(!So(_n,fi,st))return Pe;G+=2}else{if(!So(_n,{},st))return Pe;G++}le++}return{match:!0,pathIndex:le,commandIndex:G}}(z,O,P),le=P.slice(G.commandIndex);if(G.match&&G.pathIndex<z.segments.length){const Pe=new oi(z.segments.slice(0,G.pathIndex),{});return Pe.children[K]=new oi(z.segments.slice(G.pathIndex),z.children),Kr(Pe,0,le)}return G.match&&0===le.length?new oi(z.segments,{}):G.match&&!z.hasChildren()?To(z,O,P):G.match?Kr(z,0,le):To(z,O,P)}function Kr(z,O,P){if(0===P.length)return new oi(z.segments,{});{const G=function Vs(z){return zi(z[0])?z[0].outlets:{[K]:z}}(P),le={};return Pn(G,(Pe,st)=>{"string"==typeof Pe&&(Pe=[Pe]),null!==Pe&&(le[st]=lo(z.children[st],O,Pe))}),Pn(z.children,(Pe,st)=>{void 0===G[st]&&(le[st]=Pe)}),new oi(z.segments,le)}}function To(z,O,P){const G=z.segments.slice(0,O);let le=0;for(;le<P.length;){const Pe=P[le];if(zi(Pe)){const _n=Co(Pe.outlets);return new oi(G,_n)}if(0===le&&Bo(P[0])){G.push(new fr(z.segments[O].path,No(P[0]))),le++;continue}const st=zi(Pe)?Pe.outlets[K]:`${Pe}`,yt=le<P.length-1?P[le+1]:null;st&&yt&&Bo(yt)?(G.push(new fr(st,No(yt))),le+=2):(G.push(new fr(st,{})),le++)}return new oi(G,{})}function Co(z){const O={};return Pn(z,(P,G)=>{"string"==typeof P&&(P=[P]),null!==P&&(O[G]=To(new oi([],{}),0,P))}),O}function No(z){const O={};return Pn(z,(P,G)=>O[G]=`${P}`),O}function So(z,O,P){return z==P.path&&Je(O,P.parameters)}class ua{constructor(O,P,G,le){this.routeReuseStrategy=O,this.futureState=P,this.currState=G,this.forwardEvent=le}activate(O){const P=this.futureState._root,G=this.currState?this.currState._root:null;this.deactivateChildRoutes(P,G,O),ii(this.futureState.root),this.activateChildRoutes(P,G,O)}deactivateChildRoutes(O,P,G){const le=Ao(P);O.children.forEach(Pe=>{const st=Pe.value.outlet;this.deactivateRoutes(Pe,le[st],G),delete le[st]}),Pn(le,(Pe,st)=>{this.deactivateRouteAndItsChildren(Pe,G)})}deactivateRoutes(O,P,G){const le=O.value,Pe=P?P.value:null;if(le===Pe)if(le.component){const st=G.getContext(le.outlet);st&&this.deactivateChildRoutes(O,P,st.children)}else this.deactivateChildRoutes(O,P,G);else Pe&&this.deactivateRouteAndItsChildren(P,G)}deactivateRouteAndItsChildren(O,P){O.value.component&&this.routeReuseStrategy.shouldDetach(O.value.snapshot)?this.detachAndStoreRouteSubtree(O,P):this.deactivateRouteAndOutlet(O,P)}detachAndStoreRouteSubtree(O,P){const G=P.getContext(O.value.outlet),le=G&&O.value.component?G.children:P,Pe=Ao(O);for(const st of Object.keys(Pe))this.deactivateRouteAndItsChildren(Pe[st],le);if(G&&G.outlet){const st=G.outlet.detach(),yt=G.children.onOutletDeactivated();this.routeReuseStrategy.store(O.value.snapshot,{componentRef:st,route:O,contexts:yt})}}deactivateRouteAndOutlet(O,P){const G=P.getContext(O.value.outlet),le=G&&O.value.component?G.children:P,Pe=Ao(O);for(const st of Object.keys(Pe))this.deactivateRouteAndItsChildren(Pe[st],le);G&&G.outlet&&(G.outlet.deactivate(),G.children.onOutletDeactivated(),G.attachRef=null,G.resolver=null,G.route=null)}activateChildRoutes(O,P,G){const le=Ao(P);O.children.forEach(Pe=>{this.activateRoutes(Pe,le[Pe.value.outlet],G),this.forwardEvent(new Ci(Pe.value.snapshot))}),O.children.length&&this.forwardEvent(new gr(O.value.snapshot))}activateRoutes(O,P,G){const le=O.value,Pe=P?P.value:null;if(ii(le),le===Pe)if(le.component){const st=G.getOrCreateContext(le.outlet);this.activateChildRoutes(O,P,st.children)}else this.activateChildRoutes(O,P,G);else if(le.component){const st=G.getOrCreateContext(le.outlet);if(this.routeReuseStrategy.shouldAttach(le.snapshot)){const yt=this.routeReuseStrategy.retrieve(le.snapshot);this.routeReuseStrategy.store(le.snapshot,null),st.children.onOutletReAttached(yt.contexts),st.attachRef=yt.componentRef,st.route=yt.route.value,st.outlet&&st.outlet.attach(yt.componentRef,yt.route.value),ii(yt.route.value),this.activateChildRoutes(O,null,st.children)}else{const yt=function ee(z){for(let O=z.parent;O;O=O.parent){const P=O.routeConfig;if(P&&P._loadedConfig)return P._loadedConfig;if(P&&P.component)return null}return null}(le.snapshot),_n=yt?yt.module.componentFactoryResolver:null;st.attachRef=null,st.route=le,st.resolver=_n,st.outlet&&st.outlet.activateWith(le,_n),this.activateChildRoutes(O,null,st.children)}}else this.activateChildRoutes(O,null,G)}}class Ce{constructor(O,P){this.routes=O,this.module=P}}function te(z){return"function"==typeof z}function Dt(z){return z instanceof pr}const Er=Symbol("INITIAL_VALUE");function Fi(){return(0,Re.w)(z=>function ue(...z){let O,P;return(0,pe.K)(z[z.length-1])&&(P=z.pop()),"function"==typeof z[z.length-1]&&(O=z.pop()),1===z.length&&(0,l.k)(z[0])&&(z=z[0]),(0,Y.n)(z,P).lift(new ye(O))}(z.map(O=>O.pipe((0,jn.q)(1),function _t(...z){const O=z[z.length-1];return(0,pe.K)(O)?(z.pop(),P=>(0,tt.z)(z,P,O)):P=>(0,tt.z)(z,P)}(Er)))).pipe(ht((O,P)=>{let G=!1;return P.reduce((le,Pe,st)=>le!==Er?le:(Pe===Er&&(G=!0),G||!1!==Pe&&st!==P.length-1&&!Dt(Pe)?le:Pe),O)},Er),(0,It.h)(O=>O!==Er),(0,ae.U)(O=>Dt(O)?O:!0===O),(0,jn.q)(1)))}class mr{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new co,this.attachRef=null}}class co{constructor(){this.contexts=new Map}onChildOutletCreated(O,P){const G=this.getOrCreateContext(O);G.outlet=P,this.contexts.set(O,G)}onChildOutletDestroyed(O){const P=this.getContext(O);P&&(P.outlet=null,P.attachRef=null)}onOutletDeactivated(){const O=this.contexts;return this.contexts=new Map,O}onOutletReAttached(O){this.contexts=O}getOrCreateContext(O){let P=this.getContext(O);return P||(P=new mr,this.contexts.set(O,P)),P}getContext(O){return this.contexts.get(O)||null}}let ie=(()=>{class z{constructor(P,G,le,Pe,st){this.parentContexts=P,this.location=G,this.resolver=le,this.changeDetector=st,this.activated=null,this._activatedRoute=null,this.activateEvents=new d.vpe,this.deactivateEvents=new d.vpe,this.attachEvents=new d.vpe,this.detachEvents=new d.vpe,this.name=Pe||K,P.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const P=this.parentContexts.getContext(this.name);P&&P.route&&(P.attachRef?this.attach(P.attachRef,P.route):this.activateWith(P.route,P.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const P=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(P.instance),P}attach(P,G){this.activated=P,this._activatedRoute=G,this.location.insert(P.hostView),this.attachEvents.emit(P.instance)}deactivate(){if(this.activated){const P=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(P)}}activateWith(P,G){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=P;const st=(G=G||this.resolver).resolveComponentFactory(P._futureSnapshot.routeConfig.component),yt=this.parentContexts.getOrCreateContext(this.name).children,_n=new W(P,yt,this.location.injector);this.activated=this.location.createComponent(st,this.location.length,_n),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return z.\u0275fac=function(P){return new(P||z)(d.Y36(co),d.Y36(d.s_b),d.Y36(d._Vd),d.$8M("name"),d.Y36(d.sBO))},z.\u0275dir=d.lG2({type:z,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),z})();class W{constructor(O,P,G){this.route=O,this.childContexts=P,this.parent=G}get(O,P){return O===Ai?this.route:O===co?this.childContexts:this.parent.get(O,P)}}let H=(()=>{class z{}return z.\u0275fac=function(P){return new(P||z)},z.\u0275cmp=d.Xpm({type:z,selectors:[["ng-component"]],decls:1,vars:0,template:function(P,G){1&P&&d._UZ(0,"router-outlet")},directives:[ie],encapsulation:2}),z})();function Fe(z,O=""){for(let P=0;P<z.length;P++){const G=z[P];dn(G,ei(O,G))}}function dn(z,O){z.children&&Fe(z.children,O)}function ei(z,O){return O?z||O.path?z&&!O.path?`${z}/`:!z&&O.path?O.path:`${z}/${O.path}`:"":z}function Or(z){const O=z.children&&z.children.map(Or),P=O?{...z,children:O}:{...z};return!P.component&&(O||P.loadChildren)&&P.outlet&&P.outlet!==K&&(P.component=H),P}function Rr(z){return z.outlet||K}function Ko(z,O){const P=z.filter(G=>Rr(G)===O);return P.push(...z.filter(G=>Rr(G)!==O)),P}const zo={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function cs(z,O,P){if(""===O.path)return"full"===O.pathMatch&&(z.hasChildren()||P.length>0)?{...zo}:{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const le=(O.matcher||pt)(P,z,O);if(!le)return{...zo};const Pe={};Pn(le.posParams,(yt,_n)=>{Pe[_n]=yt.path});const st=le.consumed.length>0?{...Pe,...le.consumed[le.consumed.length-1].parameters}:Pe;return{matched:!0,consumedSegments:le.consumed,lastChild:le.consumed.length,parameters:st,positionalParamSegments:le.posParams??{}}}function $s(z,O,P,G,le="corrected"){if(P.length>0&&function za(z,O,P){return P.some(G=>js(z,O,G)&&Rr(G)!==K)}(z,P,G)){const st=new oi(O,function Na(z,O,P,G){const le={};le[K]=G,G._sourceSegment=z,G._segmentIndexShift=O.length;for(const Pe of P)if(""===Pe.path&&Rr(Pe)!==K){const st=new oi([],{});st._sourceSegment=z,st._segmentIndexShift=O.length,le[Rr(Pe)]=st}return le}(z,O,G,new oi(P,z.children)));return st._sourceSegment=z,st._segmentIndexShift=O.length,{segmentGroup:st,slicedSegments:[]}}if(0===P.length&&function yr(z,O,P){return P.some(G=>js(z,O,G))}(z,P,G)){const st=new oi(z.segments,function Ui(z,O,P,G,le,Pe){const st={};for(const yt of G)if(js(z,P,yt)&&!le[Rr(yt)]){const _n=new oi([],{});_n._sourceSegment=z,_n._segmentIndexShift="legacy"===Pe?z.segments.length:O.length,st[Rr(yt)]=_n}return{...le,...st}}(z,O,P,G,z.children,le));return st._sourceSegment=z,st._segmentIndexShift=O.length,{segmentGroup:st,slicedSegments:P}}const Pe=new oi(z.segments,z.children);return Pe._sourceSegment=z,Pe._segmentIndexShift=O.length,{segmentGroup:Pe,slicedSegments:P}}function js(z,O,P){return(!(z.hasChildren()||O.length>0)||"full"!==P.pathMatch)&&""===P.path}function Ea(z,O,P,G){return!!(Rr(z)===G||G!==K&&js(O,P,z))&&("**"===z.path||cs(O,z,P).matched)}function Ks(z,O,P){return 0===O.length&&!z.children[P]}class da{constructor(O){this.segmentGroup=O||null}}class In{constructor(O){this.urlTree=O}}function ar(z){return new ge.y(O=>O.error(new da(z)))}function Gs(z){return new ge.y(O=>O.error(new In(z)))}function Yr(z){return new ge.y(O=>O.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${z}'`)))}class vo{constructor(O,P,G,le,Pe){this.configLoader=P,this.urlSerializer=G,this.urlTree=le,this.config=Pe,this.allowRedirects=!0,this.ngModule=O.get(d.h0i)}apply(){const O=$s(this.urlTree.root,[],[],this.config).segmentGroup,P=new oi(O.segments,O.children);return this.expandSegmentGroup(this.ngModule,this.config,P,K).pipe((0,ae.U)(Pe=>this.createUrlTree(ha(Pe),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Bt(Pe=>{if(Pe instanceof In)return this.allowRedirects=!1,this.match(Pe.urlTree);throw Pe instanceof da?this.noMatchError(Pe):Pe}))}match(O){return this.expandSegmentGroup(this.ngModule,this.config,O.root,K).pipe((0,ae.U)(le=>this.createUrlTree(ha(le),O.queryParams,O.fragment))).pipe(Bt(le=>{throw le instanceof da?this.noMatchError(le):le}))}noMatchError(O){return new Error(`Cannot match any routes. URL Segment: '${O.segmentGroup}'`)}createUrlTree(O,P,G){const le=O.segments.length>0?new oi([],{[K]:O}):O;return new pr(le,P,G)}expandSegmentGroup(O,P,G,le){return 0===G.segments.length&&G.hasChildren()?this.expandChildren(O,P,G).pipe((0,ae.U)(Pe=>new oi([],Pe))):this.expandSegment(O,G,P,G.segments,le,!0)}expandChildren(O,P,G){const le=[];for(const Pe of Object.keys(G.children))"primary"===Pe?le.unshift(Pe):le.push(Pe);return(0,be.D)(le).pipe((0,lt.b)(Pe=>{const st=G.children[Pe],yt=Ko(P,Pe);return this.expandSegmentGroup(O,yt,st,Pe).pipe((0,ae.U)(_n=>({segment:_n,outlet:Pe})))}),ht((Pe,st)=>(Pe[st.outlet]=st.segment,Pe),{}),function bn(z,O){const P=arguments.length>=2;return G=>G.pipe(z?(0,It.h)((le,Pe)=>z(le,Pe,G)):On.y,Ut(1),P?Kt(O):Zt(()=>new We))}())}expandSegment(O,P,G,le,Pe,st){return(0,be.D)(G).pipe((0,lt.b)(yt=>this.expandSegmentAgainstRoute(O,P,G,yt,le,Pe,st).pipe(Bt(fi=>{if(fi instanceof da)return(0,Se.of)(null);throw fi}))),li(yt=>!!yt),Bt((yt,_n)=>{if(yt instanceof We||"EmptyError"===yt.name){if(Ks(P,le,Pe))return(0,Se.of)(new oi([],{}));throw new da(P)}throw yt}))}expandSegmentAgainstRoute(O,P,G,le,Pe,st,yt){return Ea(le,P,Pe,st)?void 0===le.redirectTo?this.matchSegmentAgainstRoute(O,P,le,Pe,st):yt&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(O,P,G,le,Pe,st):ar(P):ar(P)}expandSegmentAgainstRouteUsingRedirect(O,P,G,le,Pe,st){return"**"===le.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(O,G,le,st):this.expandRegularSegmentAgainstRouteUsingRedirect(O,P,G,le,Pe,st)}expandWildCardWithParamsAgainstRouteUsingRedirect(O,P,G,le){const Pe=this.applyRedirectCommands([],G.redirectTo,{});return G.redirectTo.startsWith("/")?Gs(Pe):this.lineralizeSegments(G,Pe).pipe((0,Le.zg)(st=>{const yt=new oi(st,{});return this.expandSegment(O,yt,P,st,le,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(O,P,G,le,Pe,st){const{matched:yt,consumedSegments:_n,lastChild:fi,positionalParamSegments:Zr}=cs(P,le,Pe);if(!yt)return ar(P);const Si=this.applyRedirectCommands(_n,le.redirectTo,Zr);return le.redirectTo.startsWith("/")?Gs(Si):this.lineralizeSegments(le,Si).pipe((0,Le.zg)(qr=>this.expandSegment(O,P,G,qr.concat(Pe.slice(fi)),st,!1)))}matchSegmentAgainstRoute(O,P,G,le,Pe){if("**"===G.path)return G.loadChildren?(G._loadedConfig?(0,Se.of)(G._loadedConfig):this.configLoader.load(O.injector,G)).pipe((0,ae.U)(qr=>(G._loadedConfig=qr,new oi(le,{})))):(0,Se.of)(new oi(le,{}));const{matched:st,consumedSegments:yt,lastChild:_n}=cs(P,G,le);if(!st)return ar(P);const fi=le.slice(_n);return this.getChildConfig(O,G,le).pipe((0,Le.zg)(Si=>{const qr=Si.module,Br=Si.routes,{segmentGroup:Ir,slicedSegments:Do}=$s(P,yt,fi,Br),vs=new oi(Ir.segments,Ir.children);if(0===Do.length&&vs.hasChildren())return this.expandChildren(qr,Br,vs).pipe((0,ae.U)(Fl=>new oi(yt,Fl)));if(0===Br.length&&0===Do.length)return(0,Se.of)(new oi(yt,{}));const xs=Rr(G)===Pe;return this.expandSegment(qr,vs,Br,Do,xs?K:Pe,!0).pipe((0,ae.U)(Kn=>new oi(yt.concat(Kn.segments),Kn.children)))}))}getChildConfig(O,P,G){return P.children?(0,Se.of)(new Ce(P.children,O)):P.loadChildren?void 0!==P._loadedConfig?(0,Se.of)(P._loadedConfig):this.runCanLoadGuards(O.injector,P,G).pipe((0,Le.zg)(le=>le?this.configLoader.load(O.injector,P).pipe((0,ae.U)(Pe=>(P._loadedConfig=Pe,Pe))):function us(z){return new ge.y(O=>O.error(we(`Cannot load children because the guard of the route "path: '${z.path}'" returned false`)))}(P))):(0,Se.of)(new Ce([],O))}runCanLoadGuards(O,P,G){const le=P.canLoad;if(!le||0===le.length)return(0,Se.of)(!0);const Pe=le.map(st=>{const yt=O.get(st);let _n;if(function sn(z){return z&&te(z.canLoad)}(yt))_n=yt.canLoad(P,G);else{if(!te(yt))throw new Error("Invalid CanLoad guard");_n=yt(P,G)}return Vn(_n)});return(0,Se.of)(Pe).pipe(Fi(),Bi(st=>{if(!Dt(st))return;const yt=we(`Redirecting to "${this.urlSerializer.serialize(st)}"`);throw yt.url=st,yt}),(0,ae.U)(st=>!0===st))}lineralizeSegments(O,P){let G=[],le=P.root;for(;;){if(G=G.concat(le.segments),0===le.numberOfChildren)return(0,Se.of)(G);if(le.numberOfChildren>1||!le.children[K])return Yr(O.redirectTo);le=le.children[K]}}applyRedirectCommands(O,P,G){return this.applyRedirectCreatreUrlTree(P,this.urlSerializer.parse(P),O,G)}applyRedirectCreatreUrlTree(O,P,G,le){const Pe=this.createSegmentGroup(O,P.root,G,le);return new pr(Pe,this.createQueryParams(P.queryParams,this.urlTree.queryParams),P.fragment)}createQueryParams(O,P){const G={};return Pn(O,(le,Pe)=>{if("string"==typeof le&&le.startsWith(":")){const yt=le.substring(1);G[Pe]=P[yt]}else G[Pe]=le}),G}createSegmentGroup(O,P,G,le){const Pe=this.createSegments(O,P.segments,G,le);let st={};return Pn(P.children,(yt,_n)=>{st[_n]=this.createSegmentGroup(O,yt,G,le)}),new oi(Pe,st)}createSegments(O,P,G,le){return P.map(Pe=>Pe.path.startsWith(":")?this.findPosParam(O,Pe,le):this.findOrReturn(Pe,G))}findPosParam(O,P,G){const le=G[P.path.substring(1)];if(!le)throw new Error(`Cannot redirect to '${O}'. Cannot find '${P.path}'.`);return le}findOrReturn(O,P){let G=0;for(const le of P){if(le.path===O.path)return P.splice(G),le;G++}return O}}function ha(z){const O={};for(const G of Object.keys(z.children)){const Pe=ha(z.children[G]);(Pe.segments.length>0||Pe.hasChildren())&&(O[G]=Pe)}return function rs(z){if(1===z.numberOfChildren&&z.children[K]){const O=z.children[K];return new oi(z.segments.concat(O.segments),O.children)}return z}(new oi(z.segments,O))}class ks{constructor(O){this.path=O,this.route=this.path[this.path.length-1]}}class Po{constructor(O,P){this.component=O,this.route=P}}function qs(z,O,P){const G=z._root;return Zo(G,O?O._root:null,P,[G.value])}function Dr(z,O,P){const G=function _s(z){if(!z)return null;for(let O=z.parent;O;O=O.parent){const P=O.routeConfig;if(P&&P._loadedConfig)return P._loadedConfig}return null}(O);return(G?G.module.injector:P).get(z)}function Zo(z,O,P,G,le={canDeactivateChecks:[],canActivateChecks:[]}){const Pe=Ao(O);return z.children.forEach(st=>{(function ys(z,O,P,G,le={canDeactivateChecks:[],canActivateChecks:[]}){const Pe=z.value,st=O?O.value:null,yt=P?P.getContext(z.value.outlet):null;if(st&&Pe.routeConfig===st.routeConfig){const _n=function dl(z,O,P){if("function"==typeof P)return P(z,O);switch(P){case"pathParamsChange":return!Sr(z.url,O.url);case"pathParamsOrQueryParamsChange":return!Sr(z.url,O.url)||!Je(z.queryParams,O.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!hi(z,O)||!Je(z.queryParams,O.queryParams);default:return!hi(z,O)}}(st,Pe,Pe.routeConfig.runGuardsAndResolvers);_n?le.canActivateChecks.push(new ks(G)):(Pe.data=st.data,Pe._resolvedData=st._resolvedData),Zo(z,O,Pe.component?yt?yt.children:null:P,G,le),_n&&yt&&yt.outlet&&yt.outlet.isActivated&&le.canDeactivateChecks.push(new Po(yt.outlet.component,st))}else st&&pa(O,yt,le),le.canActivateChecks.push(new ks(G)),Zo(z,null,Pe.component?yt?yt.children:null:P,G,le)})(st,Pe[st.value.outlet],P,G.concat([st.value]),le),delete Pe[st.value.outlet]}),Pn(Pe,(st,yt)=>pa(st,P.getContext(yt),le)),le}function pa(z,O,P){const G=Ao(z),le=z.value;Pn(G,(Pe,st)=>{pa(Pe,le.component?O?O.children.getContext(st):null:O,P)}),P.canDeactivateChecks.push(new Po(le.component&&O&&O.outlet&&O.outlet.isActivated?O.outlet.component:null,le))}class Xn{}function Wi(z){return new ge.y(O=>O.error(z))}class lr{constructor(O,P,G,le,Pe,st){this.rootComponentType=O,this.config=P,this.urlTree=G,this.url=le,this.paramsInheritanceStrategy=Pe,this.relativeLinkResolution=st}recognize(){const O=$s(this.urlTree.root,[],[],this.config.filter(st=>void 0===st.redirectTo),this.relativeLinkResolution).segmentGroup,P=this.processSegmentGroup(this.config,O,K);if(null===P)return null;const G=new Xe([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},K,this.rootComponentType,null,this.urlTree.root,-1,{}),le=new Qi(G,P),Pe=new ke(this.url,le);return this.inheritParamsAndData(Pe._root),Pe}inheritParamsAndData(O){const P=O.value,G=Lo(P,this.paramsInheritanceStrategy);P.params=Object.freeze(G.params),P.data=Object.freeze(G.data),O.children.forEach(le=>this.inheritParamsAndData(le))}processSegmentGroup(O,P,G){return 0===P.segments.length&&P.hasChildren()?this.processChildren(O,P):this.processSegment(O,P,P.segments,G)}processChildren(O,P){const G=[];for(const Pe of Object.keys(P.children)){const st=P.children[Pe],yt=Ko(O,Pe),_n=this.processSegmentGroup(yt,st,Pe);if(null===_n)return null;G.push(..._n)}const le=Eo(G);return function so(z){z.sort((O,P)=>O.value.outlet===K?-1:P.value.outlet===K?1:O.value.outlet.localeCompare(P.value.outlet))}(le),le}processSegment(O,P,G,le){for(const Pe of O){const st=this.processSegmentAgainstRoute(Pe,P,G,le);if(null!==st)return st}return Ks(P,G,le)?[]:null}processSegmentAgainstRoute(O,P,G,le){if(O.redirectTo||!Ea(O,P,G,le))return null;let Pe,st=[],yt=[];if("**"===O.path){const Br=G.length>0?Gt(G).parameters:{};Pe=new Xe(G,Br,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,fa(O),Rr(O),O.component,O,Ss(P),Jr(P)+G.length,Tc(O))}else{const Br=cs(P,O,G);if(!Br.matched)return null;st=Br.consumedSegments,yt=G.slice(Br.lastChild),Pe=new Xe(st,Br.parameters,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,fa(O),Rr(O),O.component,O,Ss(P),Jr(P)+st.length,Tc(O))}const _n=function Lr(z){return z.children?z.children:z.loadChildren?z._loadedConfig.routes:[]}(O),{segmentGroup:fi,slicedSegments:Zr}=$s(P,st,yt,_n.filter(Br=>void 0===Br.redirectTo),this.relativeLinkResolution);if(0===Zr.length&&fi.hasChildren()){const Br=this.processChildren(_n,fi);return null===Br?null:[new Qi(Pe,Br)]}if(0===_n.length&&0===Zr.length)return[new Qi(Pe,[])];const Si=Rr(O)===le,qr=this.processSegment(_n,fi,Zr,Si?K:le);return null===qr?null:[new Qi(Pe,qr)]}}function xo(z){const O=z.value.routeConfig;return O&&""===O.path&&void 0===O.redirectTo}function Eo(z){const O=[],P=new Set;for(const G of z){if(!xo(G)){O.push(G);continue}const le=O.find(Pe=>G.value.routeConfig===Pe.value.routeConfig);void 0!==le?(le.children.push(...G.children),P.add(le)):O.push(G)}for(const G of P){const le=Eo(G.children);O.push(new Qi(G.value,le))}return O.filter(G=>!P.has(G))}function Ss(z){let O=z;for(;O._sourceSegment;)O=O._sourceSegment;return O}function Jr(z){let O=z,P=O._segmentIndexShift?O._segmentIndexShift:0;for(;O._sourceSegment;)O=O._sourceSegment,P+=O._segmentIndexShift?O._segmentIndexShift:0;return P-1}function fa(z){return z.data||{}}function Tc(z){return z.resolve||{}}function cr(z){return[...Object.keys(z),...Object.getOwnPropertySymbols(z)]}function ga(z){return(0,Re.w)(O=>{const P=z(O);return P?(0,be.D)(P).pipe((0,ae.U)(()=>O)):(0,Se.of)(O)})}class Da{}class tc extends class $o{shouldDetach(O){return!1}store(O,P){}shouldAttach(O){return!1}retrieve(O){return null}shouldReuseRoute(O,P){return O.routeConfig===P.routeConfig}}{}const Qs=new d.OlP("ROUTES");class Za{constructor(O,P,G,le){this.injector=O,this.compiler=P,this.onLoadStartListener=G,this.onLoadEndListener=le}load(O,P){if(P._loader$)return P._loader$;this.onLoadStartListener&&this.onLoadStartListener(P);const le=this.loadModuleFactory(P.loadChildren).pipe((0,ae.U)(Pe=>{this.onLoadEndListener&&this.onLoadEndListener(P);const st=Pe.create(O);return new Ce(en(st.injector.get(Qs,void 0,d.XFs.Self|d.XFs.Optional)).map(Or),st)}),Bt(Pe=>{throw P._loader$=void 0,Pe}));return P._loader$=new C.c(le,()=>new Ge.xQ).pipe((0,Rt.x)()),P._loader$}loadModuleFactory(O){return Vn(O()).pipe((0,Le.zg)(P=>P instanceof d.YKP?(0,Se.of)(P):(0,be.D)(this.compiler.compileModuleAsync(P))))}}class Ec{shouldProcessUrl(O){return!0}extract(O){return O}merge(O,P){return O}}function ea(z){throw z}function Va(z,O,P){return O.parse("/")}function pl(z,O){return(0,Se.of)(null)}const Dc={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Au={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let jo=(()=>{class z{constructor(P,G,le,Pe,st,yt,_n){this.rootComponentType=P,this.urlSerializer=G,this.rootContexts=le,this.location=Pe,this.config=_n,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Ge.xQ,this.errorHandler=ea,this.malformedUriErrorHandler=Va,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:pl,afterPreactivation:pl},this.urlHandlingStrategy=new Ec,this.routeReuseStrategy=new tc,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=st.get(d.h0i),this.console=st.get(d.c2e);const Si=st.get(d.R0b);this.isNgZoneEnabled=Si instanceof d.R0b&&d.R0b.isInAngularZone(),this.resetConfig(_n),this.currentUrlTree=function Yn(){return new pr(new oi([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Za(st,yt,qr=>this.triggerEvent(new hr(qr)),qr=>this.triggerEvent(new yi(qr))),this.routerState=zn(this.currentUrlTree,this.rootComponentType),this.transitions=new ze.X({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(P){const G=this.events;return P.pipe((0,It.h)(le=>0!==le.id),(0,ae.U)(le=>({...le,extractedUrl:this.urlHandlingStrategy.extract(le.rawUrl)})),(0,Re.w)(le=>{let Pe=!1,st=!1;return(0,Se.of)(le).pipe(Bi(yt=>{this.currentNavigation={id:yt.id,initialUrl:yt.currentRawUrl,extractedUrl:yt.extractedUrl,trigger:yt.source,extras:yt.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,Re.w)(yt=>{const _n=this.browserUrlTree.toString(),fi=!this.navigated||yt.extractedUrl.toString()!==_n||_n!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||fi)&&this.urlHandlingStrategy.shouldProcessUrl(yt.rawUrl))return os(yt.source)&&(this.browserUrlTree=yt.extractedUrl),(0,Se.of)(yt).pipe((0,Re.w)(Si=>{const qr=this.transitions.getValue();return G.next(new Ft(Si.id,this.serializeUrl(Si.extractedUrl),Si.source,Si.restoredState)),qr!==this.transitions.getValue()?Be.E:Promise.resolve(Si)}),function wc(z,O,P,G){return(0,Re.w)(le=>function Uo(z,O,P,G,le){return new vo(z,O,P,G,le).apply()}(z,O,P,le.extractedUrl,G).pipe((0,ae.U)(Pe=>({...le,urlAfterRedirects:Pe}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Bi(Si=>{this.currentNavigation={...this.currentNavigation,finalUrl:Si.urlAfterRedirects}}),function ma(z,O,P,G,le){return(0,Le.zg)(Pe=>function pi(z,O,P,G,le="emptyOnly",Pe="legacy"){try{const st=new lr(z,O,P,G,le,Pe).recognize();return null===st?Wi(new Xn):(0,Se.of)(st)}catch(st){return Wi(st)}}(z,O,Pe.urlAfterRedirects,P(Pe.urlAfterRedirects),G,le).pipe((0,ae.U)(st=>({...Pe,targetSnapshot:st}))))}(this.rootComponentType,this.config,Si=>this.serializeUrl(Si),this.paramsInheritanceStrategy,this.relativeLinkResolution),Bi(Si=>{if("eager"===this.urlUpdateStrategy){if(!Si.extras.skipLocationChange){const Br=this.urlHandlingStrategy.merge(Si.urlAfterRedirects,Si.rawUrl);this.setBrowserUrl(Br,Si)}this.browserUrlTree=Si.urlAfterRedirects}const qr=new Di(Si.id,this.serializeUrl(Si.extractedUrl),this.serializeUrl(Si.urlAfterRedirects),Si.targetSnapshot);G.next(qr)}));if(fi&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:qr,extractedUrl:Br,source:Ir,restoredState:Do,extras:vs}=yt,xs=new Ft(qr,this.serializeUrl(Br),Ir,Do);G.next(xs);const Wa=zn(Br,this.rootComponentType).snapshot;return(0,Se.of)({...yt,targetSnapshot:Wa,urlAfterRedirects:Br,extras:{...vs,skipLocationChange:!1,replaceUrl:!1}})}return this.rawUrlTree=yt.rawUrl,yt.resolve(null),Be.E}),ga(yt=>{const{targetSnapshot:_n,id:fi,extractedUrl:Zr,rawUrl:Si,extras:{skipLocationChange:qr,replaceUrl:Br}}=yt;return this.hooks.beforePreactivation(_n,{navigationId:fi,appliedUrlTree:Zr,rawUrlTree:Si,skipLocationChange:!!qr,replaceUrl:!!Br})}),Bi(yt=>{const _n=new mi(yt.id,this.serializeUrl(yt.extractedUrl),this.serializeUrl(yt.urlAfterRedirects),yt.targetSnapshot);this.triggerEvent(_n)}),(0,ae.U)(yt=>({...yt,guards:qs(yt.targetSnapshot,yt.currentSnapshot,this.rootContexts)})),function Vo(z,O){return(0,Le.zg)(P=>{const{targetSnapshot:G,currentSnapshot:le,guards:{canActivateChecks:Pe,canDeactivateChecks:st}}=P;return 0===st.length&&0===Pe.length?(0,Se.of)({...P,guardsResult:!0}):function D(z,O,P,G){return(0,be.D)(z).pipe((0,Le.zg)(le=>function Rn(z,O,P,G,le){const Pe=O&&O.routeConfig?O.routeConfig.canDeactivate:null;if(!Pe||0===Pe.length)return(0,Se.of)(!0);const st=Pe.map(yt=>{const _n=Dr(yt,O,le);let fi;if(function Fr(z){return z&&te(z.canDeactivate)}(_n))fi=Vn(_n.canDeactivate(z,O,P,G));else{if(!te(_n))throw new Error("Invalid CanDeactivate guard");fi=Vn(_n(z,O,P,G))}return fi.pipe(li())});return(0,Se.of)(st).pipe(Fi())}(le.component,le.route,P,O,G)),li(le=>!0!==le,!0))}(st,G,le,z).pipe((0,Le.zg)(yt=>yt&&function Ne(z){return"boolean"==typeof z}(yt)?function N(z,O,P,G){return(0,be.D)(O).pipe((0,lt.b)(le=>(0,tt.z)(function re(z,O){return null!==z&&O&&O(new kr(z)),(0,Se.of)(!0)}(le.route.parent,G),function A(z,O){return null!==z&&O&&O(new Tr(z)),(0,Se.of)(!0)}(le.route,G),function kt(z,O,P){const G=O[O.length-1],Pe=O.slice(0,O.length-1).reverse().map(st=>function Qo(z){const O=z.routeConfig?z.routeConfig.canActivateChild:null;return O&&0!==O.length?{node:z,guards:O}:null}(st)).filter(st=>null!==st).map(st=>(0,et.P)(()=>{const yt=st.guards.map(_n=>{const fi=Dr(_n,st.node,P);let Zr;if(function Hn(z){return z&&te(z.canActivateChild)}(fi))Zr=Vn(fi.canActivateChild(G,z));else{if(!te(fi))throw new Error("Invalid CanActivateChild guard");Zr=Vn(fi(G,z))}return Zr.pipe(li())});return(0,Se.of)(yt).pipe(Fi())}));return(0,Se.of)(Pe).pipe(Fi())}(z,le.path,P),function De(z,O,P){const G=O.routeConfig?O.routeConfig.canActivate:null;if(!G||0===G.length)return(0,Se.of)(!0);const le=G.map(Pe=>(0,et.P)(()=>{const st=Dr(Pe,O,P);let yt;if(function Fn(z){return z&&te(z.canActivate)}(st))yt=Vn(st.canActivate(O,z));else{if(!te(st))throw new Error("Invalid CanActivate guard");yt=Vn(st(O,z))}return yt.pipe(li())}));return(0,Se.of)(le).pipe(Fi())}(z,le.route,P))),li(le=>!0!==le,!0))}(G,Pe,z,O):(0,Se.of)(yt)),(0,ae.U)(yt=>({...P,guardsResult:yt})))})}(this.ngModule.injector,yt=>this.triggerEvent(yt)),Bi(yt=>{if(Dt(yt.guardsResult)){const fi=we(`Redirecting to "${this.serializeUrl(yt.guardsResult)}"`);throw fi.url=yt.guardsResult,fi}const _n=new ci(yt.id,this.serializeUrl(yt.extractedUrl),this.serializeUrl(yt.urlAfterRedirects),yt.targetSnapshot,!!yt.guardsResult);this.triggerEvent(_n)}),(0,It.h)(yt=>!!yt.guardsResult||(this.restoreHistory(yt),this.cancelNavigationTransition(yt,""),!1)),ga(yt=>{if(yt.guards.canActivateChecks.length)return(0,Se.of)(yt).pipe(Bi(_n=>{const fi=new xr(_n.id,this.serializeUrl(_n.extractedUrl),this.serializeUrl(_n.urlAfterRedirects),_n.targetSnapshot);this.triggerEvent(fi)}),(0,Re.w)(_n=>{let fi=!1;return(0,Se.of)(_n).pipe(function hl(z,O){return(0,Le.zg)(P=>{const{targetSnapshot:G,guards:{canActivateChecks:le}}=P;if(!le.length)return(0,Se.of)(P);let Pe=0;return(0,be.D)(le).pipe((0,lt.b)(st=>function Yc(z,O,P,G){return function Cc(z,O,P,G){const le=cr(z);if(0===le.length)return(0,Se.of)({});const Pe={};return(0,be.D)(le).pipe((0,Le.zg)(st=>function Ua(z,O,P,G){const le=Dr(z,O,G);return Vn(le.resolve?le.resolve(O,P):le(O,P))}(z[st],O,P,G).pipe(Bi(yt=>{Pe[st]=yt}))),Ut(1),(0,Le.zg)(()=>cr(Pe).length===le.length?(0,Se.of)(Pe):Be.E))}(z._resolve,z,O,G).pipe((0,ae.U)(Pe=>(z._resolvedData=Pe,z.data={...z.data,...Lo(z,P).resolve},null)))}(st.route,G,z,O)),Bi(()=>Pe++),Ut(1),(0,Le.zg)(st=>Pe===le.length?(0,Se.of)(P):Be.E))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Bi({next:()=>fi=!0,complete:()=>{fi||(this.restoreHistory(_n),this.cancelNavigationTransition(_n,"At least one route resolver didn't emit any value."))}}))}),Bi(_n=>{const fi=new Ii(_n.id,this.serializeUrl(_n.extractedUrl),this.serializeUrl(_n.urlAfterRedirects),_n.targetSnapshot);this.triggerEvent(fi)}))}),ga(yt=>{const{targetSnapshot:_n,id:fi,extractedUrl:Zr,rawUrl:Si,extras:{skipLocationChange:qr,replaceUrl:Br}}=yt;return this.hooks.afterPreactivation(_n,{navigationId:fi,appliedUrlTree:Zr,rawUrlTree:Si,skipLocationChange:!!qr,replaceUrl:!!Br})}),(0,ae.U)(yt=>{const _n=function ro(z,O,P){const G=sr(z,O._root,P?P._root:void 0);return new fo(G,O)}(this.routeReuseStrategy,yt.targetSnapshot,yt.currentRouterState);return{...yt,targetRouterState:_n}}),Bi(yt=>{this.currentUrlTree=yt.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(yt.urlAfterRedirects,yt.rawUrl),this.routerState=yt.targetRouterState,"deferred"===this.urlUpdateStrategy&&(yt.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,yt),this.browserUrlTree=yt.urlAfterRedirects)}),((z,O,P)=>(0,ae.U)(G=>(new ua(O,G.targetRouterState,G.currentRouterState,P).activate(z),G)))(this.rootContexts,this.routeReuseStrategy,yt=>this.triggerEvent(yt)),Bi({next(){Pe=!0},complete(){Pe=!0}}),function Ti(z){return O=>O.lift(new Xt(z))}(()=>{Pe||st||this.cancelNavigationTransition(le,`Navigation ID ${le.id} is not equal to the current navigation id ${this.navigationId}`),this.currentNavigation?.id===le.id&&(this.currentNavigation=null)}),Bt(yt=>{if(st=!0,function Ye(z){return z&&z[de]}(yt)){const _n=Dt(yt.url);_n||(this.navigated=!0,this.restoreHistory(le,!0));const fi=new Jn(le.id,this.serializeUrl(le.extractedUrl),yt.message);G.next(fi),_n?setTimeout(()=>{const Zr=this.urlHandlingStrategy.merge(yt.url,this.rawUrlTree),Si={skipLocationChange:le.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||os(le.source)};this.scheduleNavigation(Zr,"imperative",null,Si,{resolve:le.resolve,reject:le.reject,promise:le.promise})},0):le.resolve(!1)}else{this.restoreHistory(le,!0);const _n=new Ki(le.id,this.serializeUrl(le.extractedUrl),yt);G.next(_n);try{le.resolve(this.errorHandler(yt))}catch(fi){le.reject(fi)}}return Be.E}))}))}resetRootComponentType(P){this.rootComponentType=P,this.routerState.root.component=this.rootComponentType}setTransition(P){this.transitions.next({...this.transitions.value,...P})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(P=>{const G="popstate"===P.type?"popstate":"hashchange";"popstate"===G&&setTimeout(()=>{const le={replaceUrl:!0},Pe=P.state?.navigationId?P.state:null;if(Pe){const yt={...Pe};delete yt.navigationId,delete yt.\u0275routerPageId,0!==Object.keys(yt).length&&(le.state=yt)}const st=this.parseUrl(P.url);this.scheduleNavigation(st,G,Pe,le)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(P){this.events.next(P)}resetConfig(P){Fe(P),this.config=P.map(Or),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(P,G={}){const{relativeTo:le,queryParams:Pe,fragment:st,queryParamsHandling:yt,preserveFragment:_n}=G,fi=le||this.routerState.root,Zr=_n?this.currentUrlTree.fragment:st;let Si=null;switch(yt){case"merge":Si={...this.currentUrlTree.queryParams,...Pe};break;case"preserve":Si=this.currentUrlTree.queryParams;break;default:Si=Pe||null}return null!==Si&&(Si=this.removeEmptyProps(Si)),function Is(z,O,P,G,le){if(0===P.length)return Ls(O.root,O.root,O,G,le);const Pe=function oo(z){if("string"==typeof z[0]&&1===z.length&&"/"===z[0])return new ki(!0,0,z);let O=0,P=!1;const G=z.reduce((le,Pe,st)=>{if("object"==typeof Pe&&null!=Pe){if(Pe.outlets){const yt={};return Pn(Pe.outlets,(_n,fi)=>{yt[fi]="string"==typeof _n?_n.split("/"):_n}),[...le,{outlets:yt}]}if(Pe.segmentPath)return[...le,Pe.segmentPath]}return"string"!=typeof Pe?[...le,Pe]:0===st?(Pe.split("/").forEach((yt,_n)=>{0==_n&&"."===yt||(0==_n&&""===yt?P=!0:".."===yt?O++:""!=yt&&le.push(yt))}),le):[...le,Pe]},[]);return new ki(P,O,G)}(P);if(Pe.toRoot())return Ls(O.root,new oi([],{}),O,G,le);const st=function Ms(z,O,P){if(z.isAbsolute)return new Jo(O.root,!0,0);if(-1===P.snapshot._lastPathIndex){const Pe=P.snapshot._urlSegment;return new Jo(Pe,Pe===O.root,0)}const G=Bo(z.commands[0])?0:1;return function Gr(z,O,P){let G=z,le=O,Pe=P;for(;Pe>le;){if(Pe-=le,G=G.parent,!G)throw new Error("Invalid number of '../'");le=G.segments.length}return new Jo(G,!1,le-Pe)}(P.snapshot._urlSegment,P.snapshot._lastPathIndex+G,z.numberOfDoubleDots)}(Pe,O,z),yt=st.processChildren?Kr(st.segmentGroup,st.index,Pe.commands):lo(st.segmentGroup,st.index,Pe.commands);return Ls(st.segmentGroup,yt,O,G,le)}(fi,this.currentUrlTree,P,Si,Zr??null)}navigateByUrl(P,G={skipLocationChange:!1}){const le=Dt(P)?P:this.parseUrl(P),Pe=this.urlHandlingStrategy.merge(le,this.rawUrlTree);return this.scheduleNavigation(Pe,"imperative",null,G)}navigate(P,G={skipLocationChange:!1}){return function $a(z){for(let O=0;O<z.length;O++){const P=z[O];if(null==P)throw new Error(`The requested path contains ${P} segment at index ${O}`)}}(P),this.navigateByUrl(this.createUrlTree(P,G),G)}serializeUrl(P){return this.urlSerializer.serialize(P)}parseUrl(P){let G;try{G=this.urlSerializer.parse(P)}catch(le){G=this.malformedUriErrorHandler(le,this.urlSerializer,P)}return G}isActive(P,G){let le;if(le=!0===G?{...Dc}:!1===G?{...Au}:G,Dt(P))return Li(this.currentUrlTree,P,le);const Pe=this.parseUrl(P);return Li(this.currentUrlTree,Pe,le)}removeEmptyProps(P){return Object.keys(P).reduce((G,le)=>{const Pe=P[le];return null!=Pe&&(G[le]=Pe),G},{})}processNavigations(){this.navigations.subscribe(P=>{this.navigated=!0,this.lastSuccessfulId=P.id,this.currentPageId=P.targetPageId,this.events.next(new Qt(P.id,this.serializeUrl(P.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,P.resolve(!0)},P=>{this.console.warn(`Unhandled Navigation Error: ${P}`)})}scheduleNavigation(P,G,le,Pe,st){if(this.disposed)return Promise.resolve(!1);const yt=this.transitions.value,_n=os(G)&&yt&&!os(yt.source),fi=yt.rawUrl.toString()===P.toString();if(_n&&fi&&yt.id===this.currentNavigation?.id)return Promise.resolve(!0);let qr,Br,Ir;st?(qr=st.resolve,Br=st.reject,Ir=st.promise):Ir=new Promise((xs,Wa)=>{qr=xs,Br=Wa});const Do=++this.navigationId;let vs;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(le=this.location.getState()),vs=le&&le.\u0275routerPageId?le.\u0275routerPageId:Pe.replaceUrl||Pe.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):vs=0,this.setTransition({id:Do,targetPageId:vs,source:G,restoredState:le,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:P,extras:Pe,resolve:qr,reject:Br,promise:Ir,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Ir.catch(xs=>Promise.reject(xs))}setBrowserUrl(P,G){const le=this.urlSerializer.serialize(P),Pe={...G.extras.state,...this.generateNgRouterState(G.id,G.targetPageId)};this.location.isCurrentPathEqualTo(le)||G.extras.replaceUrl?this.location.replaceState(le,"",Pe):this.location.go(le,"",Pe)}restoreHistory(P,G=!1){if("computed"===this.canceledNavigationResolution){const le=this.currentPageId-P.targetPageId;"popstate"!==P.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===le?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===le&&(this.resetState(P),this.browserUrlTree=P.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(le)}else"replace"===this.canceledNavigationResolution&&(G&&this.resetState(P),this.resetUrlToCurrentUrlTree())}resetState(P){this.routerState=P.currentRouterState,this.currentUrlTree=P.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,P.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(P,G){const le=new Jn(P.id,this.serializeUrl(P.extractedUrl),G);this.triggerEvent(le),P.resolve(!1)}generateNgRouterState(P,G){return"computed"===this.canceledNavigationResolution?{navigationId:P,\u0275routerPageId:G}:{navigationId:P}}}return z.\u0275fac=function(P){d.$Z()},z.\u0275prov=d.Yz7({token:z,factory:z.\u0275fac}),z})();function os(z){return"imperative"!==z}let Ia=(()=>{class z{constructor(P,G,le,Pe,st){this.router=P,this.route=G,this.tabIndexAttribute=le,this.renderer=Pe,this.el=st,this.commands=null,this.onChanges=new Ge.xQ,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(P){if(null!=this.tabIndexAttribute)return;const G=this.renderer,le=this.el.nativeElement;null!==P?G.setAttribute(le,"tabindex",P):G.removeAttribute(le,"tabindex")}ngOnChanges(P){this.onChanges.next(this)}set routerLink(P){null!=P?(this.commands=Array.isArray(P)?P:[P],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const P={skipLocationChange:ta(this.skipLocationChange),replaceUrl:ta(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,P),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:ta(this.preserveFragment)})}}return z.\u0275fac=function(P){return new(P||z)(d.Y36(jo),d.Y36(Ai),d.$8M("tabindex"),d.Y36(d.Qsj),d.Y36(d.SBq))},z.\u0275dir=d.lG2({type:z,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(P,G){1&P&&d.NdJ("click",function(){return G.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[d.TTD]}),z})();function ta(z){return""===z||!!z}class Pl{}class Ga{preload(O,P){return(0,Se.of)(null)}}let Aa=(()=>{class z{constructor(P,G,le,Pe){this.router=P,this.injector=le,this.preloadingStrategy=Pe,this.loader=new Za(le,G,_n=>P.triggerEvent(new hr(_n)),_n=>P.triggerEvent(new yi(_n)))}setUpPreloading(){this.subscription=this.router.events.pipe((0,It.h)(P=>P instanceof Qt),(0,lt.b)(()=>this.preload())).subscribe(()=>{})}preload(){const P=this.injector.get(d.h0i);return this.processRoutes(P,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(P,G){const le=[];for(const Pe of G)if(Pe.loadChildren&&!Pe.canLoad&&Pe._loadedConfig){const st=Pe._loadedConfig;le.push(this.processRoutes(st.module,st.routes))}else Pe.loadChildren&&!Pe.canLoad?le.push(this.preloadConfig(P,Pe)):Pe.children&&le.push(this.processRoutes(P,Pe.children));return(0,be.D)(le).pipe((0,me.J)(),(0,ae.U)(Pe=>{}))}preloadConfig(P,G){return this.preloadingStrategy.preload(G,()=>(G._loadedConfig?(0,Se.of)(G._loadedConfig):this.loader.load(P.injector,G)).pipe((0,Le.zg)(Pe=>(G._loadedConfig=Pe,this.processRoutes(Pe.module,Pe.routes)))))}}return z.\u0275fac=function(P){return new(P||z)(d.LFG(jo),d.LFG(d.Sil),d.LFG(d.zs3),d.LFG(Pl))},z.\u0275prov=d.Yz7({token:z,factory:z.\u0275fac}),z})(),Ic=(()=>{class z{constructor(P,G,le={}){this.router=P,this.viewportScroller=G,this.options=le,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},le.scrollPositionRestoration=le.scrollPositionRestoration||"disabled",le.anchorScrolling=le.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(P=>{P instanceof Ft?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=P.navigationTrigger,this.restoredId=P.restoredState?P.restoredState.navigationId:0):P instanceof Qt&&(this.lastId=P.id,this.scheduleScrollEvent(P,this.router.parseUrl(P.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(P=>{P instanceof Oi&&(P.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(P.position):P.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(P.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(P,G){this.router.triggerEvent(new Oi(P,"popstate"===this.lastSource?this.store[this.restoredId]:null,G))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return z.\u0275fac=function(P){d.$Z()},z.\u0275prov=d.Yz7({token:z,factory:z.\u0275fac}),z})();const Sa=new d.OlP("ROUTER_CONFIGURATION"),Jc=new d.OlP("ROUTER_FORROOT_GUARD"),Mc=[b.Ye,{provide:xi,useClass:io},{provide:jo,useFactory:function Ac(z,O,P,G,le,Pe,st={},yt,_n){const fi=new jo(null,z,O,P,G,le,en(Pe));return yt&&(fi.urlHandlingStrategy=yt),_n&&(fi.routeReuseStrategy=_n),function ml(z,O){z.errorHandler&&(O.errorHandler=z.errorHandler),z.malformedUriErrorHandler&&(O.malformedUriErrorHandler=z.malformedUriErrorHandler),z.onSameUrlNavigation&&(O.onSameUrlNavigation=z.onSameUrlNavigation),z.paramsInheritanceStrategy&&(O.paramsInheritanceStrategy=z.paramsInheritanceStrategy),z.relativeLinkResolution&&(O.relativeLinkResolution=z.relativeLinkResolution),z.urlUpdateStrategy&&(O.urlUpdateStrategy=z.urlUpdateStrategy),z.canceledNavigationResolution&&(O.canceledNavigationResolution=z.canceledNavigationResolution)}(st,fi),st.enableTracing&&fi.events.subscribe(Zr=>{console.group?.(`Router Event: ${Zr.constructor.name}`),console.log(Zr.toString()),console.log(Zr),console.groupEnd?.()}),fi},deps:[xi,co,b.Ye,d.zs3,d.Sil,Qs,Sa,[class Mu{},new d.FiY],[Da,new d.FiY]]},co,{provide:Ai,useFactory:function Sc(z){return z.routerState.root},deps:[jo]},Aa,Ga,class _a{preload(O,P){return P().pipe(Bt(()=>(0,Se.of)(null)))}},{provide:Sa,useValue:{enableTracing:!1}}];function Pa(){return new d.PXZ("Router",jo)}let Ol=(()=>{class z{constructor(P,G){}static forRoot(P,G){return{ngModule:z,providers:[Mc,ic(P),{provide:Jc,useFactory:qa,deps:[[jo,new d.FiY,new d.tp0]]},{provide:Sa,useValue:G||{}},{provide:b.S$,useFactory:Rl,deps:[b.lw,[new d.tBr(b.mr),new d.FiY],Sa]},{provide:Ic,useFactory:nc,deps:[jo,b.EM,Sa]},{provide:Pl,useExisting:G&&G.preloadingStrategy?G.preloadingStrategy:Ga},{provide:d.PXZ,multi:!0,useFactory:Pa},[Ll,{provide:d.ip1,multi:!0,useFactory:kl,deps:[Ll]},{provide:Ha,useFactory:gl,deps:[Ll]},{provide:d.tb,multi:!0,useExisting:Ha}]]}}static forChild(P){return{ngModule:z,providers:[ic(P)]}}}return z.\u0275fac=function(P){return new(P||z)(d.LFG(Jc,8),d.LFG(jo,8))},z.\u0275mod=d.oAB({type:z}),z.\u0275inj=d.cJS({}),z})();function nc(z,O,P){return P.scrollOffset&&O.setOffset(P.scrollOffset),new Ic(z,O,P)}function Rl(z,O,P={}){return P.useHash?new b.Do(z,O):new b.b0(z,O)}function qa(z){return"guarded"}function ic(z){return[{provide:d.deG,multi:!0,useValue:z},{provide:Qs,multi:!0,useValue:z}]}let Ll=(()=>{class z{constructor(P){this.injector=P,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Ge.xQ}appInitializer(){return this.injector.get(b.V_,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let G=null;const le=new Promise(yt=>G=yt),Pe=this.injector.get(jo),st=this.injector.get(Sa);return"disabled"===st.initialNavigation?(Pe.setUpLocationChangeListener(),G(!0)):"enabled"===st.initialNavigation||"enabledBlocking"===st.initialNavigation?(Pe.hooks.afterPreactivation=()=>this.initNavigation?(0,Se.of)(null):(this.initNavigation=!0,G(!0),this.resultOfPreactivationDone),Pe.initialNavigation()):G(!0),le})}bootstrapListener(P){const G=this.injector.get(Sa),le=this.injector.get(Aa),Pe=this.injector.get(Ic),st=this.injector.get(jo),yt=this.injector.get(d.z2F);P===yt.components[0]&&(("enabledNonBlocking"===G.initialNavigation||void 0===G.initialNavigation)&&st.initialNavigation(),le.setUpPreloading(),Pe.init(),st.resetRootComponentType(yt.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return z.\u0275fac=function(P){return new(P||z)(d.LFG(d.zs3))},z.\u0275prov=d.Yz7({token:z,factory:z.\u0275fac}),z})();function kl(z){return z.appInitializer.bind(z)}function gl(z){return z.bootstrapListener.bind(z)}const Ha=new d.OlP("Router Initializer")},9397:(An,vt,k)=>{"use strict";k.d(vt,{Zw:()=>Ut,aw:()=>Ti,X$:()=>gi,sK:()=>_i});var b=k(6738),d=k(2916);function pe(Xt){return!!Xt&&(Xt instanceof d.y||"function"==typeof Xt.lift&&"function"==typeof Xt.subscribe)}var l=k(1086),J=k(567),j=k(1221),g=k(8514),ne=k(8929),ge=k(6686),Y=k(2268);const ye=new class se extends Y.v{}(class Q extends ge.o{constructor(Oe,ae){super(Oe,ae),this.scheduler=Oe,this.work=ae}schedule(Oe,ae=0){return ae>0?super.schedule(Oe,ae):(this.delay=ae,this.state=Oe,this.scheduler.flush(this),this)}execute(Oe,ae){return ae>0||this.closed?super.execute(Oe,ae):this._execute(Oe,ae)}requestAsyncId(Oe,ae,Re=0){return null!==Re&&Re>0||null===Re&&this.delay>0?super.requestAsyncId(Oe,ae,Re):Oe.flush(this)}});var xe=k(2654),Ee=k(3489),We=k(8896);function Se({error:Xt,subscriber:Oe}){Oe.error(Xt)}class tt{constructor(Oe,ae,Re){this.kind=Oe,this.value=ae,this.error=Re,this.hasValue="N"===Oe}observe(Oe){switch(this.kind){case"N":return Oe.next&&Oe.next(this.value);case"E":return Oe.error&&Oe.error(this.error);case"C":return Oe.complete&&Oe.complete()}}do(Oe,ae,Re){switch(this.kind){case"N":return Oe&&Oe(this.value);case"E":return ae&&ae(this.error);case"C":return Re&&Re()}}accept(Oe,ae,Re){return Oe&&"function"==typeof Oe.next?this.observe(Oe):this.do(Oe,ae,Re)}toObservable(){switch(this.kind){case"N":return(0,l.of)(this.value);case"E":return function be(Xt,Oe){return new d.y(Oe?ae=>Oe.schedule(Se,0,{error:Xt,subscriber:ae}):ae=>ae.error(Xt))}(this.error);case"C":return(0,We.c)()}throw new Error("unexpected notification kind value")}static createNext(Oe){return void 0!==Oe?new tt("N",Oe):tt.undefinedValueNotification}static createError(Oe){return new tt("E",void 0,Oe)}static createComplete(){return tt.completeNotification}}tt.completeNotification=new tt("C"),tt.undefinedValueNotification=new tt("N",void 0);class C extends Ee.L{constructor(Oe,ae,Re=0){super(Oe),this.scheduler=ae,this.delay=Re}static dispatch(Oe){const{notification:ae,destination:Re}=Oe;ae.observe(Re),this.unsubscribe()}scheduleMessage(Oe){this.destination.add(this.scheduler.schedule(C.dispatch,this.delay,new Ge(Oe,this.destination)))}_next(Oe){this.scheduleMessage(tt.createNext(Oe))}_error(Oe){this.scheduleMessage(tt.createError(Oe)),this.unsubscribe()}_complete(){this.scheduleMessage(tt.createComplete()),this.unsubscribe()}}class Ge{constructor(Oe,ae){this.notification=Oe,this.destination=ae}}var _t=k(5279),ht=k(5283);class wt extends ne.xQ{constructor(Oe=Number.POSITIVE_INFINITY,ae=Number.POSITIVE_INFINITY,Re){super(),this.scheduler=Re,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=Oe<1?1:Oe,this._windowTime=ae<1?1:ae,ae===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(Oe){if(!this.isStopped){const ae=this._events;ae.push(Oe),ae.length>this._bufferSize&&ae.shift()}super.next(Oe)}nextTimeWindow(Oe){this.isStopped||(this._events.push(new xt(this._getNow(),Oe)),this._trimBufferThenGetEvents()),super.next(Oe)}_subscribe(Oe){const ae=this._infiniteTimeWindow,Re=ae?this._events:this._trimBufferThenGetEvents(),lt=this.scheduler,Le=Re.length;let Rt;if(this.closed)throw new _t.N;if(this.isStopped||this.hasError?Rt=xe.w.EMPTY:(this.observers.push(Oe),Rt=new ht.W(this,Oe)),lt&&Oe.add(Oe=new C(Oe,lt)),ae)for(let me=0;me<Le&&!Oe.closed;me++)Oe.next(Re[me]);else for(let me=0;me<Le&&!Oe.closed;me++)Oe.next(Re[me].value);return this.hasError?Oe.error(this.thrownError):this.isStopped&&Oe.complete(),Rt}_getNow(){return(this.scheduler||ye).now()}_trimBufferThenGetEvents(){const Oe=this._getNow(),ae=this._bufferSize,Re=this._windowTime,lt=this._events,Le=lt.length;let Rt=0;for(;Rt<Le&&!(Oe-lt[Rt].time<Re);)Rt++;return Le>ae&&(Rt=Math.max(Rt,Le-ae)),Rt>0&&lt.splice(0,Rt),lt}}class xt{constructor(Oe,ae){this.time=Oe,this.value=ae}}function gt(Xt,Oe,ae){let Re;return Re=Xt&&"object"==typeof Xt?Xt:{bufferSize:Xt,windowTime:Oe,refCount:!1,scheduler:ae},lt=>lt.lift(function Bt({bufferSize:Xt=Number.POSITIVE_INFINITY,windowTime:Oe=Number.POSITIVE_INFINITY,refCount:ae,scheduler:Re}){let lt,Rt,Le=0,me=!1,He=!1;return function(Qt){let Jn;Le++,!lt||me?(me=!1,lt=new wt(Xt,Oe,Re),Jn=lt.subscribe(this),Rt=Qt.subscribe({next(Ki){lt.next(Ki)},error(Ki){me=!0,lt.error(Ki)},complete(){He=!0,Rt=void 0,lt.complete()}})):Jn=lt.subscribe(this),this.add(()=>{Le--,Jn.unsubscribe(),Rt&&!He&&ae&&0===Le&&(Rt.unsubscribe(),Rt=void 0,lt=void 0)})}}(Re))}var Ht=k(2986),Gn=k(4850),It=k(1406),jt=k(7545);class Ut{}let Yt=(()=>{class Xt extends Ut{getTranslation(ae){return(0,l.of)({})}}return Xt.\u0275fac=function(){let Oe;return function(Re){return(Oe||(Oe=b.n5z(Xt)))(Re||Xt)}}(),Xt.\u0275prov=b.Yz7({token:Xt,factory:Xt.\u0275fac}),Xt})();class zt{}let Zt=(()=>{class Xt{handle(ae){return ae.key}}return Xt.\u0275fac=function(ae){return new(ae||Xt)},Xt.\u0275prov=b.Yz7({token:Xt,factory:Xt.\u0275fac}),Xt})();function ln(Xt,Oe){if(Xt===Oe)return!0;if(null===Xt||null===Oe)return!1;if(Xt!=Xt&&Oe!=Oe)return!0;let lt,Le,Rt,ae=typeof Xt;if(ae==typeof Oe&&"object"==ae){if(!Array.isArray(Xt)){if(Array.isArray(Oe))return!1;for(Le in Rt=Object.create(null),Xt){if(!ln(Xt[Le],Oe[Le]))return!1;Rt[Le]=!0}for(Le in Oe)if(!(Le in Rt)&&void 0!==Oe[Le])return!1;return!0}if(!Array.isArray(Oe))return!1;if((lt=Xt.length)==Oe.length){for(Le=0;Le<lt;Le++)if(!ln(Xt[Le],Oe[Le]))return!1;return!0}}return!1}function xn(Xt){return null!=Xt}function an(Xt){return Xt&&"object"==typeof Xt&&!Array.isArray(Xt)}function Kt(Xt,Oe){let ae=Object.assign({},Xt);return an(Xt)&&an(Oe)&&Object.keys(Oe).forEach(Re=>{an(Oe[Re])?Re in Xt?ae[Re]=Kt(Xt[Re],Oe[Re]):Object.assign(ae,{[Re]:Oe[Re]}):Object.assign(ae,{[Re]:Oe[Re]})}),ae}class mt{}let Wt=(()=>{class Xt extends mt{constructor(){super(...arguments),this.templateMatcher=/{{\s?([^{}\s]*)\s?}}/g}interpolate(ae,Re){let lt;return lt="string"==typeof ae?this.interpolateString(ae,Re):"function"==typeof ae?this.interpolateFunction(ae,Re):ae,lt}getValue(ae,Re){let lt="string"==typeof Re?Re.split("."):[Re];Re="";do{Re+=lt.shift(),!xn(ae)||!xn(ae[Re])||"object"!=typeof ae[Re]&&lt.length?lt.length?Re+=".":ae=void 0:(ae=ae[Re],Re="")}while(lt.length);return ae}interpolateFunction(ae,Re){return ae(Re)}interpolateString(ae,Re){return Re?ae.replace(this.templateMatcher,(lt,Le)=>{let Rt=this.getValue(Re,Le);return xn(Rt)?Rt:lt}):ae}}return Xt.\u0275fac=function(){let Oe;return function(Re){return(Oe||(Oe=b.n5z(Xt)))(Re||Xt)}}(),Xt.\u0275prov=b.Yz7({token:Xt,factory:Xt.\u0275fac}),Xt})();class On{}let bn=(()=>{class Xt extends On{compile(ae,Re){return ae}compileTranslations(ae,Re){return ae}}return Xt.\u0275fac=function(){let Oe;return function(Re){return(Oe||(Oe=b.n5z(Xt)))(Re||Xt)}}(),Xt.\u0275prov=b.Yz7({token:Xt,factory:Xt.\u0275fac}),Xt})();class jn{constructor(){this.currentLang=this.defaultLang,this.translations={},this.langs=[],this.onTranslationChange=new b.vpe,this.onLangChange=new b.vpe,this.onDefaultLangChange=new b.vpe}}const li=new b.OlP("USE_STORE"),$i=new b.OlP("USE_DEFAULT_LANG"),rr=new b.OlP("DEFAULT_LANGUAGE"),Bi=new b.OlP("USE_EXTEND");let _i=(()=>{class Xt{constructor(ae,Re,lt,Le,Rt,me=!0,He=!1,Ft=!1,Qt){this.store=ae,this.currentLoader=Re,this.compiler=lt,this.parser=Le,this.missingTranslationHandler=Rt,this.useDefaultLang=me,this.isolate=He,this.extend=Ft,this.pending=!1,this._onTranslationChange=new b.vpe,this._onLangChange=new b.vpe,this._onDefaultLangChange=new b.vpe,this._langs=[],this._translations={},this._translationRequests={},Qt&&this.setDefaultLang(Qt)}get onTranslationChange(){return this.isolate?this._onTranslationChange:this.store.onTranslationChange}get onLangChange(){return this.isolate?this._onLangChange:this.store.onLangChange}get onDefaultLangChange(){return this.isolate?this._onDefaultLangChange:this.store.onDefaultLangChange}get defaultLang(){return this.isolate?this._defaultLang:this.store.defaultLang}set defaultLang(ae){this.isolate?this._defaultLang=ae:this.store.defaultLang=ae}get currentLang(){return this.isolate?this._currentLang:this.store.currentLang}set currentLang(ae){this.isolate?this._currentLang=ae:this.store.currentLang=ae}get langs(){return this.isolate?this._langs:this.store.langs}set langs(ae){this.isolate?this._langs=ae:this.store.langs=ae}get translations(){return this.isolate?this._translations:this.store.translations}set translations(ae){this.isolate?this._translations=ae:this.store.translations=ae}setDefaultLang(ae){if(ae===this.defaultLang)return;let Re=this.retrieveTranslations(ae);void 0!==Re?(null==this.defaultLang&&(this.defaultLang=ae),Re.pipe((0,Ht.q)(1)).subscribe(lt=>{this.changeDefaultLang(ae)})):this.changeDefaultLang(ae)}getDefaultLang(){return this.defaultLang}use(ae){if(ae===this.currentLang)return(0,l.of)(this.translations[ae]);let Re=this.retrieveTranslations(ae);return void 0!==Re?(this.currentLang||(this.currentLang=ae),Re.pipe((0,Ht.q)(1)).subscribe(lt=>{this.changeLang(ae)}),Re):(this.changeLang(ae),(0,l.of)(this.translations[ae]))}retrieveTranslations(ae){let Re;return(void 0===this.translations[ae]||this.extend)&&(this._translationRequests[ae]=this._translationRequests[ae]||this.getTranslation(ae),Re=this._translationRequests[ae]),Re}getTranslation(ae){this.pending=!0;const Re=this.currentLoader.getTranslation(ae).pipe(gt(1),(0,Ht.q)(1));return this.loadingTranslations=Re.pipe((0,Gn.U)(lt=>this.compiler.compileTranslations(lt,ae)),gt(1),(0,Ht.q)(1)),this.loadingTranslations.subscribe({next:lt=>{this.translations[ae]=this.extend&&this.translations[ae]?{...lt,...this.translations[ae]}:lt,this.updateLangs(),this.pending=!1},error:lt=>{this.pending=!1}}),Re}setTranslation(ae,Re,lt=!1){Re=this.compiler.compileTranslations(Re,ae),this.translations[ae]=(lt||this.extend)&&this.translations[ae]?Kt(this.translations[ae],Re):Re,this.updateLangs(),this.onTranslationChange.emit({lang:ae,translations:this.translations[ae]})}getLangs(){return this.langs}addLangs(ae){ae.forEach(Re=>{-1===this.langs.indexOf(Re)&&this.langs.push(Re)})}updateLangs(){this.addLangs(Object.keys(this.translations))}getParsedResult(ae,Re,lt){let Le;if(Re instanceof Array){let Rt={},me=!1;for(let He of Re)Rt[He]=this.getParsedResult(ae,He,lt),pe(Rt[He])&&(me=!0);if(me){const He=Re.map(Ft=>pe(Rt[Ft])?Rt[Ft]:(0,l.of)(Rt[Ft]));return(0,J.D)(He).pipe((0,Gn.U)(Ft=>{let Qt={};return Ft.forEach((Jn,Ki)=>{Qt[Re[Ki]]=Jn}),Qt}))}return Rt}if(ae&&(Le=this.parser.interpolate(this.parser.getValue(ae,Re),lt)),void 0===Le&&null!=this.defaultLang&&this.defaultLang!==this.currentLang&&this.useDefaultLang&&(Le=this.parser.interpolate(this.parser.getValue(this.translations[this.defaultLang],Re),lt)),void 0===Le){let Rt={key:Re,translateService:this};void 0!==lt&&(Rt.interpolateParams=lt),Le=this.missingTranslationHandler.handle(Rt)}return void 0!==Le?Le:Re}get(ae,Re){if(!xn(ae)||!ae.length)throw new Error('Parameter "key" required');if(this.pending)return this.loadingTranslations.pipe((0,It.b)(lt=>pe(lt=this.getParsedResult(lt,ae,Re))?lt:(0,l.of)(lt)));{let lt=this.getParsedResult(this.translations[this.currentLang],ae,Re);return pe(lt)?lt:(0,l.of)(lt)}}getStreamOnTranslationChange(ae,Re){if(!xn(ae)||!ae.length)throw new Error('Parameter "key" required');return(0,j.z)((0,g.P)(()=>this.get(ae,Re)),this.onTranslationChange.pipe((0,jt.w)(lt=>{const Le=this.getParsedResult(lt.translations,ae,Re);return"function"==typeof Le.subscribe?Le:(0,l.of)(Le)})))}stream(ae,Re){if(!xn(ae)||!ae.length)throw new Error('Parameter "key" required');return(0,j.z)((0,g.P)(()=>this.get(ae,Re)),this.onLangChange.pipe((0,jt.w)(lt=>{const Le=this.getParsedResult(lt.translations,ae,Re);return pe(Le)?Le:(0,l.of)(Le)})))}instant(ae,Re){if(!xn(ae)||!ae.length)throw new Error('Parameter "key" required');let lt=this.getParsedResult(this.translations[this.currentLang],ae,Re);if(pe(lt)){if(ae instanceof Array){let Le={};return ae.forEach((Rt,me)=>{Le[ae[me]]=ae[me]}),Le}return ae}return lt}set(ae,Re,lt=this.currentLang){this.translations[lt][ae]=this.compiler.compile(Re,lt),this.updateLangs(),this.onTranslationChange.emit({lang:lt,translations:this.translations[lt]})}changeLang(ae){this.currentLang=ae,this.onLangChange.emit({lang:ae,translations:this.translations[ae]}),null==this.defaultLang&&this.changeDefaultLang(ae)}changeDefaultLang(ae){this.defaultLang=ae,this.onDefaultLangChange.emit({lang:ae,translations:this.translations[ae]})}reloadLang(ae){return this.resetLang(ae),this.getTranslation(ae)}resetLang(ae){this._translationRequests[ae]=void 0,this.translations[ae]=void 0}getBrowserLang(){if("undefined"==typeof window||void 0===window.navigator)return;let ae=window.navigator.languages?window.navigator.languages[0]:null;return ae=ae||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,void 0!==ae?(-1!==ae.indexOf("-")&&(ae=ae.split("-")[0]),-1!==ae.indexOf("_")&&(ae=ae.split("_")[0]),ae):void 0}getBrowserCultureLang(){if("undefined"==typeof window||void 0===window.navigator)return;let ae=window.navigator.languages?window.navigator.languages[0]:null;return ae=ae||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,ae}}return Xt.\u0275fac=function(ae){return new(ae||Xt)(b.LFG(jn),b.LFG(Ut),b.LFG(On),b.LFG(mt),b.LFG(zt),b.LFG($i),b.LFG(li),b.LFG(Bi),b.LFG(rr))},Xt.\u0275prov=b.Yz7({token:Xt,factory:Xt.\u0275fac}),Xt})(),gi=(()=>{class Xt{constructor(ae,Re){this.translate=ae,this._ref=Re,this.value="",this.lastKey=null,this.lastParams=[]}updateValue(ae,Re,lt){let Le=Rt=>{this.value=void 0!==Rt?Rt:ae,this.lastKey=ae,this._ref.markForCheck()};if(lt){let Rt=this.translate.getParsedResult(lt,ae,Re);pe(Rt.subscribe)?Rt.subscribe(Le):Le(Rt)}this.translate.get(ae,Re).subscribe(Le)}transform(ae,...Re){if(!ae||!ae.length)return ae;if(ln(ae,this.lastKey)&&ln(Re,this.lastParams))return this.value;let lt;if(xn(Re[0])&&Re.length)if("string"==typeof Re[0]&&Re[0].length){let Le=Re[0].replace(/(\')?([a-zA-Z0-9_]+)(\')?(\s)?:/g,'"$2":').replace(/:(\s)?(\')(.*?)(\')/g,':"$3"');try{lt=JSON.parse(Le)}catch{throw new SyntaxError(`Wrong parameter in TranslatePipe. Expected a valid Object, received: ${Re[0]}`)}}else"object"==typeof Re[0]&&!Array.isArray(Re[0])&&(lt=Re[0]);return this.lastKey=ae,this.lastParams=Re,this.updateValue(ae,lt),this._dispose(),this.onTranslationChange||(this.onTranslationChange=this.translate.onTranslationChange.subscribe(Le=>{this.lastKey&&Le.lang===this.translate.currentLang&&(this.lastKey=null,this.updateValue(ae,lt,Le.translations))})),this.onLangChange||(this.onLangChange=this.translate.onLangChange.subscribe(Le=>{this.lastKey&&(this.lastKey=null,this.updateValue(ae,lt,Le.translations))})),this.onDefaultLangChange||(this.onDefaultLangChange=this.translate.onDefaultLangChange.subscribe(()=>{this.lastKey&&(this.lastKey=null,this.updateValue(ae,lt))})),this.value}_dispose(){void 0!==this.onTranslationChange&&(this.onTranslationChange.unsubscribe(),this.onTranslationChange=void 0),void 0!==this.onLangChange&&(this.onLangChange.unsubscribe(),this.onLangChange=void 0),void 0!==this.onDefaultLangChange&&(this.onDefaultLangChange.unsubscribe(),this.onDefaultLangChange=void 0)}ngOnDestroy(){this._dispose()}}return Xt.\u0275fac=function(ae){return new(ae||Xt)(b.Y36(_i,16),b.Y36(b.sBO,16))},Xt.\u0275pipe=b.Yjl({name:"translate",type:Xt,pure:!1}),Xt.\u0275prov=b.Yz7({token:Xt,factory:Xt.\u0275fac}),Xt})(),Ti=(()=>{class Xt{static forRoot(ae={}){return{ngModule:Xt,providers:[ae.loader||{provide:Ut,useClass:Yt},ae.compiler||{provide:On,useClass:bn},ae.parser||{provide:mt,useClass:Wt},ae.missingTranslationHandler||{provide:zt,useClass:Zt},jn,{provide:li,useValue:ae.isolate},{provide:$i,useValue:ae.useDefaultLang},{provide:Bi,useValue:ae.extend},{provide:rr,useValue:ae.defaultLanguage},_i]}}static forChild(ae={}){return{ngModule:Xt,providers:[ae.loader||{provide:Ut,useClass:Yt},ae.compiler||{provide:On,useClass:bn},ae.parser||{provide:mt,useClass:Wt},ae.missingTranslationHandler||{provide:zt,useClass:Zt},{provide:li,useValue:ae.isolate},{provide:$i,useValue:ae.useDefaultLang},{provide:Bi,useValue:ae.extend},{provide:rr,useValue:ae.defaultLanguage},_i]}}}return Xt.\u0275fac=function(ae){return new(ae||Xt)},Xt.\u0275mod=b.oAB({type:Xt}),Xt.\u0275inj=b.cJS({}),Xt})()}},An=>{An(An.s=3592)}]);