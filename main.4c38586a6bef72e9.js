(self.webpackChunkapp=self.webpackChunkapp||[]).push([[179],{4244:(Ln,At,k)=>{"use strict";k.d(At,{Ar:()=>De,N0:()=>v});var d=k(8274),m=k(6895),ce=k(5577),l=k(2076),ie=k(529);const re=new d.OlP("JWT_OPTIONS");let v=(()=>{class ge{constructor(ue=null){this.tokenGetter=ue&&ue.tokenGetter||function(){}}urlBase64Decode(ue){let se=ue.replace(/-/g,"+").replace(/_/g,"/");switch(se.length%4){case 0:break;case 2:se+="==";break;case 3:se+="=";break;default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(se)}b64decode(ue){let Ie="";if((ue=String(ue).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let Ue,Ne,we=0,ke=0;Ne=ue.charAt(ke++);~Ne&&(Ue=we%4?64*Ue+Ne:Ne,we++%4)?Ie+=String.fromCharCode(255&Ue>>(-2*we&6)):0)Ne="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(Ne);return Ie}b64DecodeUnicode(ue){return decodeURIComponent(Array.prototype.map.call(this.b64decode(ue),se=>"%"+("00"+se.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(ue=this.tokenGetter()){if(!ue||""===ue)return null;const se=ue.split(".");if(3!==se.length)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");const Ie=this.urlBase64Decode(se[1]);if(!Ie)throw new Error("Cannot decode the token.");return JSON.parse(Ie)}getTokenExpirationDate(ue=this.tokenGetter()){let se;if(se=this.decodeToken(ue),!se||!se.hasOwnProperty("exp"))return null;const Ie=new Date(0);return Ie.setUTCSeconds(se.exp),Ie}isTokenExpired(ue=this.tokenGetter(),se){if(!ue||""===ue)return!0;const Ie=this.getTokenExpirationDate(ue);return se=se||0,null!==Ie&&!(Ie.valueOf()>(new Date).valueOf()+1e3*se)}getAuthScheme(ue,se){return"function"==typeof ue?ue(se):ue}}return ge.\u0275fac=function(ue){return new(ue||ge)(d.LFG(re))},ge.\u0275prov=d.Yz7({token:ge,factory:ge.\u0275fac}),ge})(),ne=(()=>{class ge{constructor(ue,se,Ie){this.jwtHelper=se,this.document=Ie,this.standardPorts=["80","443"],this.tokenGetter=ue.tokenGetter,this.headerName=ue.headerName||"Authorization",this.authScheme=ue.authScheme||""===ue.authScheme?ue.authScheme:"Bearer ",this.allowedDomains=ue.allowedDomains||[],this.disallowedRoutes=ue.disallowedRoutes||[],this.throwNoTokenError=ue.throwNoTokenError||!1,this.skipWhenExpired=ue.skipWhenExpired}isAllowedDomain(ue){const se=new URL(ue.url,this.document.location.origin);if(se.host===this.document.location.host)return!0;const Ie=`${se.hostname}${se.port&&!this.standardPorts.includes(se.port)?":"+se.port:""}`;return this.allowedDomains.findIndex(we=>"string"==typeof we?we===Ie:we instanceof RegExp&&we.test(Ie))>-1}isDisallowedRoute(ue){const se=new URL(ue.url,this.document.location.origin);return this.disallowedRoutes.findIndex(Ie=>{if("string"==typeof Ie){const we=new URL(Ie,this.document.location.origin);return we.hostname===se.hostname&&we.pathname===se.pathname}return Ie instanceof RegExp&&Ie.test(ue.url)})>-1}handleInterception(ue,se,Ie){const we=this.jwtHelper.getAuthScheme(this.authScheme,se);let Ue=!1;if(!ue&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");return this.skipWhenExpired&&(Ue=!ue||this.jwtHelper.isTokenExpired(ue)),ue&&Ue&&this.skipWhenExpired?se=se.clone():ue&&(se=se.clone({setHeaders:{[this.headerName]:`${we}${ue}`}})),Ie.handle(se)}intercept(ue,se){if(!this.isAllowedDomain(ue)||this.isDisallowedRoute(ue))return se.handle(ue);const Ie=this.tokenGetter(ue);return Ie instanceof Promise?(0,l.D)(Ie).pipe((0,ce.z)(we=>this.handleInterception(we,ue,se))):this.handleInterception(Ie,ue,se)}}return ge.\u0275fac=function(ue){return new(ue||ge)(d.LFG(re),d.LFG(v),d.LFG(m.K0))},ge.\u0275prov=d.Yz7({token:ge,factory:ge.\u0275fac}),ge})(),De=(()=>{class ge{constructor(ue){if(ue)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(ue){return{ngModule:ge,providers:[{provide:ie.TP,useClass:ne,multi:!0},ue.jwtOptionsProvider||{provide:re,useValue:ue.config},v]}}}return ge.\u0275fac=function(ue){return new(ue||ge)(d.LFG(ge,12))},ge.\u0275mod=d.oAB({type:ge}),ge.\u0275inj=d.cJS({}),ge})()},7423:(Ln,At,k)=>{"use strict";k.d(At,{Uw:()=>Ne,fo:()=>Ie});var d=k(9671);typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"&&global;var ne=(()=>{return(He=ne||(ne={})).Unimplemented="UNIMPLEMENTED",He.Unavailable="UNAVAILABLE",ne;var He})();class De extends Error{constructor(We,Qe){super(We),this.message=We,this.code=Qe}}const X=He=>{var We,Qe,ve,me,Ze;const Pe=He.CapacitorCustomPlatform||null,Ge=He.Capacitor||{},tt=Ge.Plugins=Ge.Plugins||{},ye=He.CapacitorPlatforms,Be=(null===(We=null==ye?void 0:ye.currentPlatform)||void 0===We?void 0:We.getPlatform)||(()=>null!==Pe?Pe.name:(He=>{var We,Qe;return(null==He?void 0:He.androidBridge)?"android":(null===(Qe=null===(We=null==He?void 0:He.webkit)||void 0===We?void 0:We.messageHandlers)||void 0===Qe?void 0:Qe.bridge)?"ios":"web"})(He)),_t=(null===(Qe=null==ye?void 0:ye.currentPlatform)||void 0===Qe?void 0:Qe.isNativePlatform)||(()=>"web"!==Be()),xn=(null===(ve=null==ye?void 0:ye.currentPlatform)||void 0===ve?void 0:ve.isPluginAvailable)||(it=>{const Ot=ht.get(it);return!(!(null==Ot?void 0:Ot.platforms.has(Be()))&&!Nt(it))}),Nt=(null===(me=null==ye?void 0:ye.currentPlatform)||void 0===me?void 0:me.getPluginHeader)||(it=>{var Ot;return null===(Ot=Ge.PluginHeaders)||void 0===Ot?void 0:Ot.find(Qt=>Qt.name===it)}),ht=new Map,_e=(null===(Ze=null==ye?void 0:ye.currentPlatform)||void 0===Ze?void 0:Ze.registerPlugin)||((it,Ot={})=>{const Qt=ht.get(it);if(Qt)return console.warn(`Capacitor plugin "${it}" already registered. Cannot register plugins twice.`),Qt.proxy;const _n=Be(),Tn=Nt(it);let mn;const lt=function(){var di=(0,d.Z)(function*(){return!mn&&_n in Ot?mn=mn="function"==typeof Ot[_n]?yield Ot[_n]():Ot[_n]:null!==Pe&&!mn&&"web"in Ot&&(mn=mn="function"==typeof Ot.web?yield Ot.web():Ot.web),mn});return function(){return di.apply(this,arguments)}}(),En=di=>{let Ai;const Hi=(...ri)=>{const on=lt().then(It=>{const qe=((di,Ai)=>{var Hi,ri;if(!Tn){if(di)return null===(ri=di[Ai])||void 0===ri?void 0:ri.bind(di);throw new De(`"${it}" plugin is not implemented on ${_n}`,ne.Unimplemented)}{const on=null==Tn?void 0:Tn.methods.find(It=>Ai===It.name);if(on)return"promise"===on.rtype?It=>Ge.nativePromise(it,Ai.toString(),It):(It,qe)=>Ge.nativeCallback(it,Ai.toString(),It,qe);if(di)return null===(Hi=di[Ai])||void 0===Hi?void 0:Hi.bind(di)}})(It,di);if(qe){const dt=qe(...ri);return Ai=null==dt?void 0:dt.remove,dt}throw new De(`"${it}.${di}()" is not implemented on ${_n}`,ne.Unimplemented)});return"addListener"===di&&(on.remove=(0,d.Z)(function*(){return Ai()})),on};return Hi.toString=()=>`${di.toString()}() { [capacitor code] }`,Object.defineProperty(Hi,"name",{value:di,writable:!1,configurable:!1}),Hi},yi=En("addListener"),Ui=En("removeListener"),Xi=(di,Ai)=>{const Hi=yi({eventName:di},Ai),ri=function(){var It=(0,d.Z)(function*(){const qe=yield Hi;Ui({eventName:di,callbackId:qe},Ai)});return function(){return It.apply(this,arguments)}}(),on=new Promise(It=>Hi.then(()=>It({remove:ri})));return on.remove=(0,d.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield ri()}),on},mr=new Proxy({},{get(di,Ai){switch(Ai){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return Tn?Xi:yi;case"removeListener":return Ui;default:return En(Ai)}}});return tt[it]=mr,ht.set(it,{name:it,proxy:mr,platforms:new Set([...Object.keys(Ot),...Tn?[_n]:[]])}),mr});return Ge.convertFileSrc||(Ge.convertFileSrc=it=>it),Ge.getPlatform=Be,Ge.handleError=it=>He.console.error(it),Ge.isNativePlatform=_t,Ge.isPluginAvailable=xn,Ge.pluginMethodNoop=(it,Ot,Qt)=>Promise.reject(`${Qt} does not have an implementation of "${Ot}".`),Ge.registerPlugin=_e,Ge.Exception=De,Ge.DEBUG=!!Ge.DEBUG,Ge.isLoggingEnabled=!!Ge.isLoggingEnabled,Ge.platform=Ge.getPlatform(),Ge.isNative=Ge.isNativePlatform(),Ge},se=(He=>He.Capacitor=X(He))(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Ie=se.registerPlugin;class Ne{constructor(We){this.listeners={},this.windowListeners={},We&&(console.warn(`Capacitor WebPlugin "${We.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=We)}addListener(We,Qe){var ve=this;this.listeners[We]||(this.listeners[We]=[]),this.listeners[We].push(Qe);const Ze=this.windowListeners[We];Ze&&!Ze.registered&&this.addWindowListener(Ze);const Pe=function(){var tt=(0,d.Z)(function*(){return ve.removeListener(We,Qe)});return function(){return tt.apply(this,arguments)}}(),Ge=Promise.resolve({remove:Pe});return Object.defineProperty(Ge,"remove",{value:(tt=(0,d.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield Pe()}),function(){return tt.apply(this,arguments)})}),Ge;var tt}removeAllListeners(){var We=this;return(0,d.Z)(function*(){We.listeners={};for(const Qe in We.windowListeners)We.removeWindowListener(We.windowListeners[Qe]);We.windowListeners={}})()}notifyListeners(We,Qe){const ve=this.listeners[We];ve&&ve.forEach(me=>me(Qe))}hasListeners(We){return!!this.listeners[We].length}registerWindowListener(We,Qe){this.windowListeners[Qe]={registered:!1,windowEventName:We,pluginEventName:Qe,handler:ve=>{this.notifyListeners(Qe,ve)}}}unimplemented(We="not implemented"){return new se.Exception(We,ne.Unimplemented)}unavailable(We="not available"){return new se.Exception(We,ne.Unavailable)}removeListener(We,Qe){var ve=this;return(0,d.Z)(function*(){const me=ve.listeners[We];if(!me)return;const Ze=me.indexOf(Qe);ve.listeners[We].splice(Ze,1),ve.listeners[We].length||ve.removeWindowListener(ve.windowListeners[We])})()}addWindowListener(We){window.addEventListener(We.windowEventName,We.handler),We.registered=!0}removeWindowListener(We){!We||(window.removeEventListener(We.windowEventName,We.handler),We.registered=!1)}}},9634:(Ln,At,k)=>{"use strict";k.d(At,{BX:()=>dc,Br:()=>hc,w:()=>Di,dr:()=>pe,BJ:()=>$e,oU:()=>gt,cs:()=>H,yp:()=>Ct,YG:()=>yn,Sm:()=>Cn,PM:()=>oi,FN:()=>Rn,Zi:()=>Hn,wI:()=>qn,W2:()=>ei,IJ:()=>lr,W4:()=>Dn,zq:()=>mi,fr:()=>Wn,jY:()=>Dr,Gu:()=>yr,gu:()=>jn,pK:()=>wr,Ie:()=>ki,Q$:()=>Xe,q_:()=>vt,yh:()=>Gt,z0:()=>et,fG:()=>ct,zc:()=>kt,uN:()=>nn,I_:()=>Bi,nJ:()=>Ki,Wo:()=>zr,jP:()=>br,Nd:()=>os,VI:()=>ss,cJ:()=>Qr,GO:()=>Xo,t9:()=>ko,n0:()=>pt,PQ:()=>fn,jI:()=>Si,g2:()=>Ao,Bs:()=>Ko,wd:()=>as,ho:()=>Cs,sr:()=>ga,Pc:()=>ao,r4:()=>zl,HT:()=>Pn,IN:()=>ro,SH:()=>er,X1:()=>ls,as:()=>xi,t4:()=>Jn,YI:()=>wn,QI:()=>$i,j9:()=>Oi,yF:()=>_s});var d=k(8274),m=k(4006);function v(E,Z,D,j){var Sn,fe=arguments.length,Pt=fe<3?Z:null===j?j=Object.getOwnPropertyDescriptor(Z,D):j;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)Pt=Reflect.decorate(E,Z,D,j);else for(var Yn=E.length-1;Yn>=0;Yn--)(Sn=E[Yn])&&(Pt=(fe<3?Sn(Pt):fe>3?Sn(Z,D,Pt):Sn(Z,D))||Pt);return fe>3&&Pt&&Object.defineProperty(Z,D,Pt),Pt}function ge(E,Z,D,j){return new(D||(D=Promise))(function(Pt,Sn){function Yn(ir){try{pi(j.next(ir))}catch(Cr){Sn(Cr)}}function Li(ir){try{pi(j.throw(ir))}catch(Cr){Sn(Cr)}}function pi(ir){ir.done?Pt(ir.value):function fe(Pt){return Pt instanceof D?Pt:new D(function(Sn){Sn(Pt)})}(ir.value).then(Yn,Li)}pi((j=j.apply(E,Z||[])).next())})}var Be=k(4968),st=k(7579),_t=k(1135),Yt=k(6014),Bt=(k(1815),k(6447),k(3139),k(6254)),Dt=k(3756),ht=k(4318),_e=(k(7726),k(599)),Ot=(k(3509),k(2361)),qt=k(4671),En=k(4482),yi=k(5403);function Xi(E,Z){return E===Z}var mr=k(9300),di=k(3900),Ai=k(6895);const ri=Bt.i,qe=["*"],dn=E=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(E):"function"==typeof requestAnimationFrame?requestAnimationFrame(E):setTimeout(E);let Qn=(()=>{class E{constructor(D,j){this.injector=D,this.el=j,this.onChange=()=>{},this.onTouched=()=>{}}writeValue(D){this.el.nativeElement.value=this.lastValue=D??"",Qi(this.el)}handleChangeEvent(D,j){D===this.el.nativeElement&&(j!==this.lastValue&&(this.lastValue=j,this.onChange(j)),Qi(this.el))}_handleBlurEvent(D){D===this.el.nativeElement&&(this.onTouched(),Qi(this.el))}registerOnChange(D){this.onChange=D}registerOnTouched(D){this.onTouched=D}setDisabledState(D){this.el.nativeElement.disabled=D}ngOnDestroy(){this.statusChanges&&this.statusChanges.unsubscribe()}ngAfterViewInit(){let D;try{D=this.injector.get(m.a5)}catch{}if(!D)return;D.statusChanges&&(this.statusChanges=D.statusChanges.subscribe(()=>Qi(this.el)));const j=D.control;j&&["markAsTouched","markAllAsTouched","markAsUntouched","markAsDirty","markAsPristine"].forEach(Pt=>{if(typeof j[Pt]<"u"){const Sn=j[Pt].bind(j);j[Pt]=(...Yn)=>{Sn(...Yn),Qi(this.el)}}})}}return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.zs3),d.Y36(d.SBq))},E.\u0275dir=d.lG2({type:E,hostBindings:function(D,j){1&D&&d.NdJ("ionBlur",function(Pt){return j._handleBlurEvent(Pt.target)})}}),E})();const Qi=E=>{dn(()=>{const Z=E.nativeElement,D=null!=Z.value&&Z.value.toString().length>0,j=nr(Z);_r(Z,j);const fe=Z.closest("ion-item");fe&&_r(fe,D?[...j,"item-has-value"]:j)})},nr=E=>{const Z=E.classList,D=[];for(let j=0;j<Z.length;j++){const fe=Z.item(j);null!==fe&&wi(fe,"ng-")&&D.push(`ion-${fe.substring(3)}`)}return D},_r=(E,Z)=>{const D=E.classList;D.remove("ion-valid","ion-invalid","ion-touched","ion-untouched","ion-dirty","ion-pristine"),D.add(...Z)},wi=(E,Z)=>E.substring(0,Z.length)===Z;let Di=(()=>{class E extends Qn{constructor(D,j){super(D,j)}writeValue(D){this.el.nativeElement.checked=this.lastValue=D??!1,Qi(this.el)}_handleIonChange(D){this.handleChangeEvent(D,D.checked)}}return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.zs3),d.Y36(d.SBq))},E.\u0275dir=d.lG2({type:E,selectors:[["ion-checkbox"],["ion-toggle"]],hostBindings:function(D,j){1&D&&d.NdJ("ionChange",function(Pt){return j._handleIonChange(Pt.target)})},features:[d._Bn([{provide:m.JU,useExisting:E,multi:!0}]),d.qOj]}),E})(),xi=(()=>{class E extends Qn{constructor(D,j){super(D,j)}_handleIonChange(D){this.handleChangeEvent(D,D.value)}registerOnChange(D){super.registerOnChange(j=>{D(""===j?null:parseFloat(j))})}}return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.zs3),d.Y36(d.SBq))},E.\u0275dir=d.lG2({type:E,selectors:[["ion-input","type","number"]],hostBindings:function(D,j){1&D&&d.NdJ("ionChange",function(Pt){return j._handleIonChange(Pt.target)})},features:[d._Bn([{provide:m.JU,useExisting:E,multi:!0}]),d.qOj]}),E})(),$i=(()=>{class E extends Qn{constructor(D,j){super(D,j)}_handleChangeEvent(D){this.handleChangeEvent(D,D.value)}}return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.zs3),d.Y36(d.SBq))},E.\u0275dir=d.lG2({type:E,selectors:[["ion-range"],["ion-select"],["ion-radio-group"],["ion-segment"],["ion-datetime"]],hostBindings:function(D,j){1&D&&d.NdJ("ionChange",function(Pt){return j._handleChangeEvent(Pt.target)})},features:[d._Bn([{provide:m.JU,useExisting:E,multi:!0}]),d.qOj]}),E})(),Oi=(()=>{class E extends Qn{constructor(D,j){super(D,j)}_handleInputEvent(D){this.handleChangeEvent(D,D.value)}}return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.zs3),d.Y36(d.SBq))},E.\u0275dir=d.lG2({type:E,selectors:[["ion-input",3,"type","number"],["ion-textarea"],["ion-searchbar"]],hostBindings:function(D,j){1&D&&d.NdJ("ionChange",function(Pt){return j._handleInputEvent(Pt.target)})},features:[d._Bn([{provide:m.JU,useExisting:E,multi:!0}]),d.qOj]}),E})();const Wr=(E,Z)=>{const D=E.prototype;Z.forEach(j=>{Object.defineProperty(D,j,{get(){return this.el[j]},set(fe){this.z.runOutsideAngular(()=>this.el[j]=fe)}})})},ar=(E,Z)=>{const D=E.prototype;Z.forEach(j=>{D[j]=function(){const fe=arguments;return this.z.runOutsideAngular(()=>this.el[j].apply(this.el,fe))}})},Ci=(E,Z,D)=>{D.forEach(j=>E[j]=(0,Be.R)(Z,j))};function L(E){return function(D){const{defineCustomElementFn:j,inputs:fe,methods:Pt}=E;return void 0!==j&&j(),fe&&Wr(D,fe),Pt&&ar(D,Pt),D}}let pe=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-app"]],ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0})],E),E})(),$e=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-avatar"]],ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0})],E),E})(),gt=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-back-button"]],inputs:{color:"color",defaultHref:"defaultHref",disabled:"disabled",icon:"icon",mode:"mode",routerAnimation:"routerAnimation",text:"text",type:"type"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["color","defaultHref","disabled","icon","mode","routerAnimation","text","type"]})],E),E})(),Ct=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-badge"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["color","mode"]})],E),E})(),yn=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement,Ci(this,this.el,["ionFocus","ionBlur"])}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-button"]],inputs:{buttonType:"buttonType",color:"color",disabled:"disabled",download:"download",expand:"expand",fill:"fill",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",size:"size",strong:"strong",target:"target",type:"type"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["buttonType","color","disabled","download","expand","fill","href","mode","rel","routerAnimation","routerDirection","shape","size","strong","target","type"]})],E),E})(),Cn=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-buttons"]],inputs:{collapse:"collapse"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["collapse"]})],E),E})(),oi=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-card"]],inputs:{button:"button",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",target:"target",type:"type"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["button","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","target","type"]})],E),E})(),Rn=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-card-content"]],inputs:{mode:"mode"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["mode"]})],E),E})(),Hn=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-card-header"]],inputs:{color:"color",mode:"mode",translucent:"translucent"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["color","mode","translucent"]})],E),E})(),qn=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-col"]],inputs:{offset:"offset",offsetLg:"offsetLg",offsetMd:"offsetMd",offsetSm:"offsetSm",offsetXl:"offsetXl",offsetXs:"offsetXs",pull:"pull",pullLg:"pullLg",pullMd:"pullMd",pullSm:"pullSm",pullXl:"pullXl",pullXs:"pullXs",push:"push",pushLg:"pushLg",pushMd:"pushMd",pushSm:"pushSm",pushXl:"pushXl",pushXs:"pushXs",size:"size",sizeLg:"sizeLg",sizeMd:"sizeMd",sizeSm:"sizeSm",sizeXl:"sizeXl",sizeXs:"sizeXs"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["offset","offsetLg","offsetMd","offsetSm","offsetXl","offsetXs","pull","pullLg","pullMd","pullSm","pullXl","pullXs","push","pushLg","pushMd","pushSm","pushXl","pushXs","size","sizeLg","sizeMd","sizeSm","sizeXl","sizeXs"]})],E),E})(),ei=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement,Ci(this,this.el,["ionScrollStart","ionScroll","ionScrollEnd"])}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-content"]],inputs:{color:"color",forceOverscroll:"forceOverscroll",fullscreen:"fullscreen",scrollEvents:"scrollEvents",scrollX:"scrollX",scrollY:"scrollY"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["color","forceOverscroll","fullscreen","scrollEvents","scrollX","scrollY"],methods:["getScrollElement","scrollToTop","scrollToBottom","scrollByPoint","scrollToPoint"]})],E),E})(),lr=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-fab"]],inputs:{activated:"activated",edge:"edge",horizontal:"horizontal",vertical:"vertical"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["activated","edge","horizontal","vertical"],methods:["close"]})],E),E})(),Dn=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement,Ci(this,this.el,["ionFocus","ionBlur"])}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-fab-button"]],inputs:{activated:"activated",closeIcon:"closeIcon",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",show:"show",size:"size",target:"target",translucent:"translucent",type:"type"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["activated","closeIcon","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","show","size","target","translucent","type"]})],E),E})(),mi=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-fab-list"]],inputs:{activated:"activated",side:"side"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["activated","side"]})],E),E})(),Wn=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-footer"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["collapse","mode","translucent"]})],E),E})(),Dr=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-grid"]],inputs:{fixed:"fixed"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["fixed"]})],E),E})(),yr=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-header"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["collapse","mode","translucent"]})],E),E})(),jn=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-icon"]],inputs:{color:"color",flipRtl:"flipRtl",icon:"icon",ios:"ios",lazy:"lazy",md:"md",mode:"mode",name:"name",sanitize:"sanitize",size:"size",src:"src"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["color","flipRtl","icon","ios","lazy","md","mode","name","sanitize","size","src"]})],E),E})(),wr=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement,Ci(this,this.el,["ionInput","ionChange","ionBlur","ionFocus"])}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-input"]],inputs:{accept:"accept",autocapitalize:"autocapitalize",autocomplete:"autocomplete",autocorrect:"autocorrect",autofocus:"autofocus",clearInput:"clearInput",clearOnEdit:"clearOnEdit",color:"color",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",max:"max",maxlength:"maxlength",min:"min",minlength:"minlength",mode:"mode",multiple:"multiple",name:"name",pattern:"pattern",placeholder:"placeholder",readonly:"readonly",required:"required",size:"size",spellcheck:"spellcheck",step:"step",type:"type",value:"value"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["accept","autocapitalize","autocomplete","autocorrect","autofocus","clearInput","clearOnEdit","color","debounce","disabled","enterkeyhint","inputmode","max","maxlength","min","minlength","mode","multiple","name","pattern","placeholder","readonly","required","size","spellcheck","step","type","value"],methods:["setFocus","getInputElement"]})],E),E})(),ki=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-item"]],inputs:{button:"button",color:"color",counter:"counter",counterFormatter:"counterFormatter",detail:"detail",detailIcon:"detailIcon",disabled:"disabled",download:"download",fill:"fill",href:"href",lines:"lines",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",target:"target",type:"type"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["button","color","counter","counterFormatter","detail","detailIcon","disabled","download","fill","href","lines","mode","rel","routerAnimation","routerDirection","shape","target","type"]})],E),E})(),Xe=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-label"]],inputs:{color:"color",mode:"mode",position:"position"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["color","mode","position"]})],E),E})(),vt=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-list"]],inputs:{inset:"inset",lines:"lines",mode:"mode"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["inset","lines","mode"],methods:["closeSlidingItems"]})],E),E})(),Gt=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-list-header"]],inputs:{color:"color",lines:"lines",mode:"mode"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["color","lines","mode"]})],E),E})(),et=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement,Ci(this,this.el,["ionWillOpen","ionWillClose","ionDidOpen","ionDidClose"])}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-menu"]],inputs:{contentId:"contentId",disabled:"disabled",maxEdgeStart:"maxEdgeStart",menuId:"menuId",side:"side",swipeGesture:"swipeGesture",type:"type"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["contentId","disabled","maxEdgeStart","menuId","side","swipeGesture","type"],methods:["isOpen","isActive","open","close","toggle","setOpen"]})],E),E})(),ct=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-menu-button"]],inputs:{autoHide:"autoHide",color:"color",disabled:"disabled",menu:"menu",mode:"mode",type:"type"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["autoHide","color","disabled","menu","mode","type"]})],E),E})(),kt=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-menu-toggle"]],inputs:{autoHide:"autoHide",menu:"menu"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["autoHide","menu"]})],E),E})(),nn=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-note"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["color","mode"]})],E),E})(),Bi=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement,Ci(this,this.el,["ionChange","ionFocus","ionBlur","ionKnobMoveStart","ionKnobMoveEnd"])}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-range"]],inputs:{color:"color",debounce:"debounce",disabled:"disabled",dualKnobs:"dualKnobs",max:"max",min:"min",mode:"mode",name:"name",pin:"pin",pinFormatter:"pinFormatter",snaps:"snaps",step:"step",ticks:"ticks",value:"value"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["color","debounce","disabled","dualKnobs","max","min","mode","name","pin","pinFormatter","snaps","step","ticks","value"]})],E),E})(),Ki=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement,Ci(this,this.el,["ionRefresh","ionPull","ionStart"])}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-refresher"]],inputs:{closeDuration:"closeDuration",disabled:"disabled",pullFactor:"pullFactor",pullMax:"pullMax",pullMin:"pullMin",snapbackDuration:"snapbackDuration"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["closeDuration","disabled","pullFactor","pullMax","pullMin","snapbackDuration"],methods:["complete","cancel","getProgress"]})],E),E})(),zr=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-refresher-content"]],inputs:{pullingIcon:"pullingIcon",pullingText:"pullingText",refreshingSpinner:"refreshingSpinner",refreshingText:"refreshingText"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["pullingIcon","pullingText","refreshingSpinner","refreshingText"]})],E),E})(),os=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-row"]],ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0})],E),E})(),ss=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement,Ci(this,this.el,["ionInput","ionChange","ionCancel","ionClear","ionBlur","ionFocus"])}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-searchbar"]],inputs:{animated:"animated",autocomplete:"autocomplete",autocorrect:"autocorrect",cancelButtonIcon:"cancelButtonIcon",cancelButtonText:"cancelButtonText",clearIcon:"clearIcon",color:"color",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",mode:"mode",placeholder:"placeholder",searchIcon:"searchIcon",showCancelButton:"showCancelButton",showClearButton:"showClearButton",spellcheck:"spellcheck",type:"type",value:"value"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["animated","autocomplete","autocorrect","cancelButtonIcon","cancelButtonText","clearIcon","color","debounce","disabled","enterkeyhint","inputmode","mode","placeholder","searchIcon","showCancelButton","showClearButton","spellcheck","type","value"],methods:["setFocus","getInputElement"]})],E),E})(),Qr=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement,Ci(this,this.el,["ionChange"])}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-segment"]],inputs:{color:"color",disabled:"disabled",mode:"mode",scrollable:"scrollable",selectOnFocus:"selectOnFocus",swipeGesture:"swipeGesture",value:"value"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["color","disabled","mode","scrollable","selectOnFocus","swipeGesture","value"]})],E),E})(),Xo=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-segment-button"]],inputs:{disabled:"disabled",layout:"layout",mode:"mode",type:"type",value:"value"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["disabled","layout","mode","type","value"]})],E),E})(),ko=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement,Ci(this,this.el,["ionChange","ionCancel","ionDismiss","ionFocus","ionBlur"])}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-select"]],inputs:{cancelText:"cancelText",compareWith:"compareWith",disabled:"disabled",interface:"interface",interfaceOptions:"interfaceOptions",mode:"mode",multiple:"multiple",name:"name",okText:"okText",placeholder:"placeholder",selectedText:"selectedText",value:"value"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["cancelText","compareWith","disabled","interface","interfaceOptions","mode","multiple","name","okText","placeholder","selectedText","value"],methods:["open"]})],E),E})(),pt=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-select-option"]],inputs:{disabled:"disabled",value:"value"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["disabled","value"]})],E),E})(),fn=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-spinner"]],inputs:{color:"color",duration:"duration",name:"name",paused:"paused"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["color","duration","name","paused"]})],E),E})(),Si=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement,Ci(this,this.el,["ionSplitPaneVisible"])}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-split-pane"]],inputs:{contentId:"contentId",disabled:"disabled",when:"when"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["contentId","disabled","when"]})],E),E})(),Ao=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement,Ci(this,this.el,["ionChange","ionInput","ionBlur","ionFocus"])}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-textarea"]],inputs:{autoGrow:"autoGrow",autocapitalize:"autocapitalize",autofocus:"autofocus",clearOnEdit:"clearOnEdit",color:"color",cols:"cols",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",maxlength:"maxlength",minlength:"minlength",mode:"mode",name:"name",placeholder:"placeholder",readonly:"readonly",required:"required",rows:"rows",spellcheck:"spellcheck",value:"value",wrap:"wrap"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["autoGrow","autocapitalize","autofocus","clearOnEdit","color","cols","debounce","disabled","enterkeyhint","inputmode","maxlength","minlength","mode","name","placeholder","readonly","required","rows","spellcheck","value","wrap"],methods:["setFocus","getInputElement"]})],E),E})(),Ko=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-thumbnail"]],ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0})],E),E})(),as=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-title"]],inputs:{color:"color",size:"size"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["color","size"]})],E),E})(),Cs=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement,Ci(this,this.el,["ionChange","ionFocus","ionBlur"])}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-toggle"]],inputs:{checked:"checked",color:"color",disabled:"disabled",mode:"mode",name:"name",value:"value"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["checked","color","disabled","mode","name","value"]})],E),E})(),ga=(()=>{let E=class{constructor(D,j,fe){this.z=fe,D.detach(),this.el=j.nativeElement}};return E.\u0275fac=function(D){return new(D||E)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},E.\u0275cmp=d.Xpm({type:E,selectors:[["ion-toolbar"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:qe,decls:1,vars:0,template:function(D,j){1&D&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),E=v([L({defineCustomElementFn:void 0,inputs:["color","mode"]})],E),E})();class ls{constructor(Z={}){this.data=Z}get(Z){return this.data[Z]}}let So=(()=>{class E{constructor(D,j){this.zone=D,this.appRef=j}create(D,j,fe){return new eo(D,j,fe,this.appRef,this.zone)}}return E.\u0275fac=function(D){return new(D||E)(d.LFG(d.R0b),d.LFG(d.z2F))},E.\u0275prov=d.Yz7({token:E,factory:E.\u0275fac}),E})();class eo{constructor(Z,D,j,fe,Pt){this.resolver=Z,this.injector=D,this.location=j,this.appRef=fe,this.zone=Pt,this.elRefMap=new WeakMap,this.elEventsMap=new WeakMap}attachViewToDom(Z,D,j,fe){return this.zone.run(()=>new Promise(Pt=>{Pt(Co(this.zone,this.resolver,this.injector,this.location,this.appRef,this.elRefMap,this.elEventsMap,Z,D,j,fe))}))}removeViewFromDom(Z,D){return this.zone.run(()=>new Promise(j=>{const fe=this.elRefMap.get(D);if(fe){fe.destroy(),this.elRefMap.delete(D);const Pt=this.elEventsMap.get(D);Pt&&(Pt(),this.elEventsMap.delete(D))}j()}))}}const Co=(E,Z,D,j,fe,Pt,Sn,Yn,Li,pi,ir)=>{const Cr=Z.resolveComponentFactory(Li),Ar=d.zs3.create({providers:Zs(pi),parent:D}),fo=j?j.createComponent(Cr,j.length,Ar):Cr.create(Ar),Lo=fo.instance,Zn=fo.location.nativeElement;if(pi&&Object.assign(Lo,pi),ir)for(const oa of ir)Zn.classList.add(oa);const Qo=yo(E,Lo,Zn);return Yn.appendChild(Zn),j||fe.attachView(fo.hostView),fo.changeDetectorRef.reattach(),Pt.set(Zn,fo),Sn.set(Zn,Qo),Zn},Ls=[ht.L,ht.a,ht.b,ht.c,ht.d],yo=(E,Z,D)=>E.run(()=>{const j=Ls.filter(fe=>"function"==typeof Z[fe]).map(fe=>{const Pt=Sn=>Z[fe](Sn.detail);return D.addEventListener(fe,Pt),()=>D.removeEventListener(fe,Pt)});return()=>j.forEach(fe=>fe())}),vo=new d.OlP("NavParamsToken"),Zs=E=>[{provide:vo,useValue:E},{provide:ls,useFactory:Ts,deps:[vo]}],Ts=E=>new ls(E),ai=(E,Z)=>((E=E.filter(D=>D.stackId!==Z.stackId)).push(Z),E),Po=(E,Z)=>{const D=E.createUrlTree(["."],{relativeTo:Z});return E.serializeUrl(D)},_a=(E,Z)=>{if(!E)return;const D=Ds(Z);for(let j=0;j<D.length;j++){if(j>=E.length)return D[j];if(D[j]!==E[j])return}},Ds=E=>E.split("/").map(Z=>Z.trim()).filter(Z=>""!==Z),Y=E=>{E&&(E.ref.destroy(),E.unlistenEvents())};class Me{constructor(Z,D,j,fe,Pt,Sn){this.containerEl=D,this.router=j,this.navCtrl=fe,this.zone=Pt,this.location=Sn,this.views=[],this.skipTransition=!1,this.nextId=0,this.tabsPrefix=void 0!==Z?Ds(Z):void 0}createView(Z,D){var j;const fe=Po(this.router,D),Pt=null===(j=null==Z?void 0:Z.location)||void 0===j?void 0:j.nativeElement,Sn=yo(this.zone,Z.instance,Pt);return{id:this.nextId++,stackId:_a(this.tabsPrefix,fe),unlistenEvents:Sn,element:Pt,ref:Z,url:fe}}getExistingView(Z){const D=Po(this.router,Z),j=this.views.find(fe=>fe.url===D);return j&&j.ref.changeDetectorRef.reattach(),j}setActive(Z){var D,j;const fe=this.navCtrl.consumeTransition();let{direction:Pt,animation:Sn,animationBuilder:Yn}=fe;const Li=this.activeView,pi=((E,Z)=>!Z||E.stackId!==Z.stackId)(Z,Li);pi&&(Pt="back",Sn=void 0);const ir=this.views.slice();let Cr;const Ar=this.router;Ar.getCurrentNavigation?Cr=Ar.getCurrentNavigation():(null===(D=Ar.navigations)||void 0===D?void 0:D.value)&&(Cr=Ar.navigations.value),(null===(j=null==Cr?void 0:Cr.extras)||void 0===j?void 0:j.replaceUrl)&&this.views.length>0&&this.views.splice(-1,1);const fo=this.views.includes(Z),Lo=this.insertView(Z,Pt);fo||Z.ref.changeDetectorRef.detectChanges();const Zn=Z.animationBuilder;return void 0===Yn&&"back"===Pt&&!pi&&void 0!==Zn&&(Yn=Zn),Li&&(Li.animationBuilder=Yn),this.zone.runOutsideAngular(()=>this.wait(()=>(Li&&Li.ref.changeDetectorRef.detach(),Z.ref.changeDetectorRef.reattach(),this.transition(Z,Li,Sn,this.canGoBack(1),!1,Yn).then(()=>K(Z,Lo,ir,this.location,this.zone)).then(()=>({enteringView:Z,direction:Pt,animation:Sn,tabSwitch:pi})))))}canGoBack(Z,D=this.getActiveStackId()){return this.getStack(D).length>Z}pop(Z,D=this.getActiveStackId()){return this.zone.run(()=>{var j,fe;const Pt=this.getStack(D);if(Pt.length<=Z)return Promise.resolve(!1);const Sn=Pt[Pt.length-Z-1];let Yn=Sn.url;const Li=Sn.savedData;if(Li){const ir=Li.get("primary");(null===(fe=null===(j=null==ir?void 0:ir.route)||void 0===j?void 0:j._routerState)||void 0===fe?void 0:fe.snapshot.url)&&(Yn=ir.route._routerState.snapshot.url)}const{animationBuilder:pi}=this.navCtrl.consumeTransition();return this.navCtrl.navigateBack(Yn,Object.assign(Object.assign({},Sn.savedExtras),{animation:pi})).then(()=>!0)})}startBackTransition(){const Z=this.activeView;if(Z){const D=this.getStack(Z.stackId),j=D[D.length-2],fe=j.animationBuilder;return this.wait(()=>this.transition(j,Z,"back",this.canGoBack(2),!0,fe))}return Promise.resolve()}endBackTransition(Z){Z?(this.skipTransition=!0,this.pop(1)):this.activeView&&Fe(this.activeView,this.views,this.views,this.location,this.zone)}getLastUrl(Z){const D=this.getStack(Z);return D.length>0?D[D.length-1]:void 0}getRootUrl(Z){const D=this.getStack(Z);return D.length>0?D[0]:void 0}getActiveStackId(){return this.activeView?this.activeView.stackId:void 0}hasRunningTask(){return void 0!==this.runningTask}destroy(){this.containerEl=void 0,this.views.forEach(Y),this.activeView=void 0,this.views=[]}getStack(Z){return this.views.filter(D=>D.stackId===Z)}insertView(Z,D){return this.activeView=Z,this.views=((E,Z,D)=>"root"===D?ai(E,Z):"forward"===D?((E,Z)=>(E.indexOf(Z)>=0?E=E.filter(j=>j.stackId!==Z.stackId||j.id<=Z.id):E.push(Z),E))(E,Z):((E,Z)=>E.indexOf(Z)>=0?E.filter(j=>j.stackId!==Z.stackId||j.id<=Z.id):ai(E,Z))(E,Z))(this.views,Z,D),this.views.slice()}transition(Z,D,j,fe,Pt,Sn){if(this.skipTransition)return this.skipTransition=!1,Promise.resolve(!1);if(D===Z)return Promise.resolve(!1);const Yn=Z?Z.element:void 0,Li=D?D.element:void 0,pi=this.containerEl;return Yn&&Yn!==Li&&(Yn.classList.add("ion-page"),Yn.classList.add("ion-page-invisible"),Yn.parentElement!==pi&&pi.appendChild(Yn),pi.commit)?pi.commit(Yn,Li,{deepWait:!0,duration:void 0===j?0:void 0,direction:j,showGoBack:fe,progressAnimation:Pt,animationBuilder:Sn}):Promise.resolve(!1)}wait(Z){return ge(this,void 0,void 0,function*(){void 0!==this.runningTask&&(yield this.runningTask,this.runningTask=void 0);const D=this.runningTask=Z();return D.finally(()=>this.runningTask=void 0),D})}}const K=(E,Z,D,j,fe)=>"function"==typeof requestAnimationFrame?new Promise(Pt=>{requestAnimationFrame(()=>{Fe(E,Z,D,j,fe),Pt()})}):Promise.resolve(),Fe=(E,Z,D,j,fe)=>{fe.run(()=>D.filter(Pt=>!Z.includes(Pt)).forEach(Y)),Z.forEach(Pt=>{const Yn=j.path().split("?")[0].split("#")[0];if(Pt!==E&&Pt.url!==Yn){const Li=Pt.element;Li.setAttribute("aria-hidden","true"),Li.classList.add("ion-page-hidden"),Pt.ref.changeDetectorRef.detach()}})};let wt=(()=>{class E{get(D,j){const fe=kn();return fe?fe.get(D,j):null}getBoolean(D,j){const fe=kn();return!!fe&&fe.getBoolean(D,j)}getNumber(D,j){const fe=kn();return fe?fe.getNumber(D,j):0}}return E.\u0275fac=function(D){return new(D||E)},E.\u0275prov=d.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})();const gn=new d.OlP("USERCONFIG"),kn=()=>{if(typeof window<"u"){const E=window.Ionic;if(null==E?void 0:E.config)return E.config}return null};let Jn=(()=>{class E{constructor(D,j){this.doc=D,this.backButton=new st.x,this.keyboardDidShow=new st.x,this.keyboardDidHide=new st.x,this.pause=new st.x,this.resume=new st.x,this.resize=new st.x,j.run(()=>{var fe;let Pt;this.win=D.defaultView,this.backButton.subscribeWithPriority=function(Sn,Yn){return this.subscribe(Li=>Li.register(Sn,pi=>j.run(()=>Yn(pi))))},cr(this.pause,D,"pause"),cr(this.resume,D,"resume"),cr(this.backButton,D,"ionBackButton"),cr(this.resize,this.win,"resize"),cr(this.keyboardDidShow,this.win,"ionKeyboardDidShow"),cr(this.keyboardDidHide,this.win,"ionKeyboardDidHide"),this._readyPromise=new Promise(Sn=>{Pt=Sn}),(null===(fe=this.win)||void 0===fe?void 0:fe.cordova)?D.addEventListener("deviceready",()=>{Pt("cordova")},{once:!0}):Pt("dom")})}is(D){return(0,Bt.a)(this.win,D)}platforms(){return(0,Bt.g)(this.win)}ready(){return this._readyPromise}get isRTL(){return"rtl"===this.doc.dir}getQueryParam(D){return Mr(this.win.location.href,D)}isLandscape(){return!this.isPortrait()}isPortrait(){var D,j;return null===(j=(D=this.win).matchMedia)||void 0===j?void 0:j.call(D,"(orientation: portrait)").matches}testUserAgent(D){const j=this.win.navigator;return!!((null==j?void 0:j.userAgent)&&j.userAgent.indexOf(D)>=0)}url(){return this.win.location.href}width(){return this.win.innerWidth}height(){return this.win.innerHeight}}return E.\u0275fac=function(D){return new(D||E)(d.LFG(Ai.K0),d.LFG(d.R0b))},E.\u0275prov=d.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})();const Mr=(E,Z)=>{Z=Z.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");const j=new RegExp("[\\?&]"+Z+"=([^&#]*)").exec(E);return j?decodeURIComponent(j[1].replace(/\+/g," ")):null},cr=(E,Z,D)=>{Z&&Z.addEventListener(D,j=>{E.next(null!=j?j.detail:void 0)})};let er=(()=>{class E{constructor(D,j,fe,Pt){this.location=j,this.serializer=fe,this.router=Pt,this.direction=xr,this.animated=fr,this.guessDirection="forward",this.lastNavId=-1,Pt&&Pt.events.subscribe(Sn=>{if(Sn instanceof Yt.OD){const Yn=Sn.restoredState?Sn.restoredState.navigationId:Sn.id;this.guessDirection=Yn<this.lastNavId?"back":"forward",this.guessAnimation=Sn.restoredState?void 0:this.guessDirection,this.lastNavId="forward"===this.guessDirection?Sn.id:Yn}}),D.backButton.subscribeWithPriority(0,Sn=>{this.pop(),Sn()})}navigateForward(D,j={}){return this.setDirection("forward",j.animated,j.animationDirection,j.animation),this.navigate(D,j)}navigateBack(D,j={}){return this.setDirection("back",j.animated,j.animationDirection,j.animation),this.navigate(D,j)}navigateRoot(D,j={}){return this.setDirection("root",j.animated,j.animationDirection,j.animation),this.navigate(D,j)}back(D={animated:!0,animationDirection:"back"}){return this.setDirection("back",D.animated,D.animationDirection,D.animation),this.location.back()}pop(){return ge(this,void 0,void 0,function*(){let D=this.topOutlet;for(;D&&!(yield D.pop());)D=D.parentOutlet})}setDirection(D,j,fe,Pt){this.direction=D,this.animated=Vi(D,j,fe),this.animationBuilder=Pt}setTopOutlet(D){this.topOutlet=D}consumeTransition(){let j,D="root";const fe=this.animationBuilder;return"auto"===this.direction?(D=this.guessDirection,j=this.guessAnimation):(j=this.animated,D=this.direction),this.direction=xr,this.animated=fr,this.animationBuilder=void 0,{direction:D,animation:j,animationBuilder:fe}}navigate(D,j){if(Array.isArray(D))return this.router.navigate(D,j);{const fe=this.serializer.parse(D.toString());return void 0!==j.queryParams&&(fe.queryParams=Object.assign({},j.queryParams)),void 0!==j.fragment&&(fe.fragment=j.fragment),this.router.navigateByUrl(fe,j)}}}return E.\u0275fac=function(D){return new(D||E)(d.LFG(Jn),d.LFG(Ai.Ye),d.LFG(Yt.Hx),d.LFG(Yt.F0,8))},E.\u0275prov=d.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})();const Vi=(E,Z,D)=>{if(!1!==Z){if(void 0!==D)return D;if("forward"===E||"back"===E)return E;if("root"===E&&!0===Z)return"forward"}},xr="auto",fr=void 0;let br=(()=>{class E{constructor(D,j,fe,Pt,Sn,Yn,Li,pi,ir,Cr,Ar,fo,Lo){this.parentContexts=D,this.location=j,this.resolver=fe,this.config=Yn,this.navCtrl=Li,this.parentOutlet=Lo,this.activated=null,this.activatedView=null,this._activatedRoute=null,this.proxyMap=new WeakMap,this.currentActivatedRoute$=new _t.X(null),this.stackEvents=new d.vpe,this.activateEvents=new d.vpe,this.deactivateEvents=new d.vpe,this.nativeEl=ir.nativeElement,this.name=Pt||Yt.eC,this.tabsPrefix="true"===Sn?Po(Cr,fo):void 0,this.stackCtrl=new Me(this.tabsPrefix,this.nativeEl,Cr,Li,Ar,pi),D.onChildOutletCreated(this.name,this)}set animation(D){this.nativeEl.animation=D}set animated(D){this.nativeEl.animated=D}set swipeGesture(D){this._swipeGesture=D,this.nativeEl.swipeHandler=D?{canStart:()=>this.stackCtrl.canGoBack(1)&&!this.stackCtrl.hasRunningTask(),onStart:()=>this.stackCtrl.startBackTransition(),onEnd:j=>this.stackCtrl.endBackTransition(j)}:void 0}ngOnDestroy(){this.stackCtrl.destroy()}getContext(){return this.parentContexts.getContext(this.name)}ngOnInit(){if(!this.activated){const D=this.getContext();(null==D?void 0:D.route)&&this.activateWith(D.route,D.resolver||null)}new Promise(D=>(0,Dt.c)(this.nativeEl,D)).then(()=>{void 0===this._swipeGesture&&(this.swipeGesture=this.config.getBoolean("swipeBackEnabled","ios"===this.nativeEl.mode))})}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){throw new Error("incompatible reuse strategy")}attach(D,j){throw new Error("incompatible reuse strategy")}deactivate(){if(this.activated){if(this.activatedView){const j=this.getContext();this.activatedView.savedData=new Map(j.children.contexts);const fe=this.activatedView.savedData.get("primary");if(fe&&j.route&&(fe.route=Object.assign({},j.route)),this.activatedView.savedExtras={},j.route){const Pt=j.route.snapshot;this.activatedView.savedExtras.queryParams=Pt.queryParams,this.activatedView.savedExtras.fragment=Pt.fragment}}const D=this.component;this.activatedView=null,this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(D)}}activateWith(D,j){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=D;let fe,Pt=this.stackCtrl.getExistingView(D);if(Pt){fe=this.activated=Pt.ref;const Sn=Pt.savedData;Sn&&(this.getContext().children.contexts=Sn),this.updateActivatedRouteProxy(fe.instance,D)}else{const Li=(j=j||this.resolver).resolveComponentFactory(D._futureSnapshot.routeConfig.component),pi=this.parentContexts.getOrCreateContext(this.name).children,ir=new _t.X(null),Cr=this.createActivatedRouteProxy(ir,D),Ar=new ee(Cr,pi,this.location.injector);fe=this.activated=this.location.createComponent(Li,this.location.length,Ar),ir.next(fe.instance),Pt=this.stackCtrl.createView(this.activated,D),this.proxyMap.set(fe.instance,Cr),this.currentActivatedRoute$.next({component:fe.instance,activatedRoute:D})}this.activatedView=Pt,this.stackCtrl.setActive(Pt).then(Sn=>{this.navCtrl.setTopOutlet(this),this.activateEvents.emit(fe.instance),this.stackEvents.emit(Sn)})}canGoBack(D=1,j){return this.stackCtrl.canGoBack(D,j)}pop(D=1,j){return this.stackCtrl.pop(D,j)}getLastUrl(D){const j=this.stackCtrl.getLastUrl(D);return j?j.url:void 0}getLastRouteView(D){return this.stackCtrl.getLastUrl(D)}getRootView(D){return this.stackCtrl.getRootUrl(D)}getActiveStackId(){return this.stackCtrl.getActiveStackId()}createActivatedRouteProxy(D,j){const fe=new Yt.gz;return fe._futureSnapshot=j._futureSnapshot,fe._routerState=j._routerState,fe.snapshot=j.snapshot,fe.outlet=j.outlet,fe.component=j.component,fe._paramMap=this.proxyObservable(D,"paramMap"),fe._queryParamMap=this.proxyObservable(D,"queryParamMap"),fe.url=this.proxyObservable(D,"url"),fe.params=this.proxyObservable(D,"params"),fe.queryParams=this.proxyObservable(D,"queryParams"),fe.fragment=this.proxyObservable(D,"fragment"),fe.data=this.proxyObservable(D,"data"),fe}proxyObservable(D,j){return D.pipe((0,mr.h)(fe=>!!fe),(0,di.w)(fe=>this.currentActivatedRoute$.pipe((0,mr.h)(Pt=>null!==Pt&&Pt.component===fe),(0,di.w)(Pt=>Pt&&Pt.activatedRoute[j]),function Ui(E,Z=qt.y){return E=E??Xi,(0,En.e)((D,j)=>{let fe,Pt=!0;D.subscribe((0,yi.x)(j,Sn=>{const Yn=Z(Sn);(Pt||!E(fe,Yn))&&(Pt=!1,fe=Yn,j.next(Sn))}))})}())))}updateActivatedRouteProxy(D,j){const fe=this.proxyMap.get(D);if(!fe)throw new Error("Could not find activated route proxy for view");fe._futureSnapshot=j._futureSnapshot,fe._routerState=j._routerState,fe.snapshot=j.snapshot,fe.outlet=j.outlet,fe.component=j.component,this.currentActivatedRoute$.next({component:D,activatedRoute:j})}}return E.\u0275fac=function(D){return new(D||E)(d.Y36(Yt.y6),d.Y36(d.s_b),d.Y36(d._Vd),d.$8M("name"),d.$8M("tabs"),d.Y36(wt),d.Y36(er),d.Y36(Ai.Ye),d.Y36(d.SBq),d.Y36(Yt.F0),d.Y36(d.R0b),d.Y36(Yt.gz),d.Y36(E,12))},E.\u0275dir=d.lG2({type:E,selectors:[["ion-router-outlet"]],inputs:{animated:"animated",animation:"animation",swipeGesture:"swipeGesture"},outputs:{stackEvents:"stackEvents",activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),E})();class ee{constructor(Z,D,j){this.route=Z,this.childContexts=D,this.parent=j}get(Z,D){return Z===Yt.gz?this.route:Z===Yt.y6?this.childContexts:this.parent.get(Z,D)}}let H=(()=>{class E{constructor(D,j,fe){this.routerOutlet=D,this.navCtrl=j,this.config=fe}onClick(D){var j;const fe=this.defaultHref||this.config.get("backButtonDefaultHref");(null===(j=this.routerOutlet)||void 0===j?void 0:j.canGoBack())?(this.navCtrl.setDirection("back",void 0,void 0,this.routerAnimation),this.routerOutlet.pop(),D.preventDefault()):null!=fe&&(this.navCtrl.navigateBack(fe,{animation:this.routerAnimation}),D.preventDefault())}}return E.\u0275fac=function(D){return new(D||E)(d.Y36(br,8),d.Y36(er),d.Y36(wt))},E.\u0275dir=d.lG2({type:E,selectors:[["ion-back-button"]],hostBindings:function(D,j){1&D&&d.NdJ("click",function(Pt){return j.onClick(Pt)})},inputs:{defaultHref:"defaultHref",routerAnimation:"routerAnimation"}}),E})(),wn=(()=>{class E{constructor(D,j,fe,Pt,Sn){this.locationStrategy=D,this.navCtrl=j,this.elementRef=fe,this.router=Pt,this.routerLink=Sn,this.routerDirection="forward"}ngOnInit(){this.updateTargetUrlAndHref()}ngOnChanges(){this.updateTargetUrlAndHref()}updateTargetUrlAndHref(){var D;if(null===(D=this.routerLink)||void 0===D?void 0:D.urlTree){const j=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.routerLink.urlTree));this.elementRef.nativeElement.href=j}}onClick(D){this.navCtrl.setDirection(this.routerDirection,void 0,void 0,this.routerAnimation),D.preventDefault()}}return E.\u0275fac=function(D){return new(D||E)(d.Y36(Ai.S$),d.Y36(er),d.Y36(d.SBq),d.Y36(Yt.F0),d.Y36(Yt.rH,8))},E.\u0275dir=d.lG2({type:E,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(D,j){1&D&&d.NdJ("click",function(Pt){return j.onClick(Pt)})},inputs:{routerDirection:"routerDirection",routerAnimation:"routerAnimation"},features:[d.TTD]}),E})();class Is{constructor(Z){this.ctrl=Z}create(Z){return this.ctrl.create(Z||{})}dismiss(Z,D,j){return this.ctrl.dismiss(Z,D,j)}getTop(){return this.ctrl.getTop()}}let dc=(()=>{class E extends Is{constructor(){super(_e.b)}}return E.\u0275fac=function(D){return new(D||E)},E.\u0275prov=d.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})(),hc=(()=>{class E extends Is{constructor(){super(_e.a)}}return E.\u0275fac=function(D){return new(D||E)},E.\u0275prov=d.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})(),Pn=(()=>{class E extends Is{constructor(){super(_e.l)}}return E.\u0275fac=function(D){return new(D||E)},E.\u0275prov=d.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})(),ro=(()=>{class E extends Is{constructor(D,j,fe){super(_e.m),this.angularDelegate=D,this.resolver=j,this.injector=fe}create(D){return super.create(Object.assign(Object.assign({},D),{delegate:this.angularDelegate.create(this.resolver,this.injector)}))}}return E.\u0275fac=function(D){return new(D||E)(d.LFG(So),d.LFG(d._Vd),d.LFG(d.zs3))},E.\u0275prov=d.Yz7({token:E,factory:E.\u0275fac}),E})(),gl=(()=>{class E extends Is{constructor(D,j,fe){super(_e.c),this.angularDelegate=D,this.resolver=j,this.injector=fe}create(D){return super.create(Object.assign(Object.assign({},D),{delegate:this.angularDelegate.create(this.resolver,this.injector)}))}}return E.\u0275fac=function(D){return new(D||E)(d.LFG(So),d.LFG(d._Vd),d.LFG(d.zs3))},E.\u0275prov=d.Yz7({token:E,factory:E.\u0275fac}),E})(),_s=(()=>{class E extends Is{constructor(){super(_e.t)}}return E.\u0275fac=function(D){return new(D||E)},E.\u0275prov=d.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})();class zl{shouldDetach(Z){return!1}shouldAttach(Z){return!1}store(Z,D){}retrieve(Z){return null}shouldReuseRoute(Z,D){if(Z.routeConfig!==D.routeConfig)return!1;const j=Z.params,fe=D.params,Pt=Object.keys(j),Sn=Object.keys(fe);if(Pt.length!==Sn.length)return!1;for(const Yn of Pt)if(fe[Yn]!==j[Yn])return!1;return!0}}const Nl=(E,Z,D)=>()=>{if(Z.defaultView&&typeof window<"u"){(E=>{const Z=window,D=Z.Ionic;D&&D.config&&"Object"!==D.config.constructor.name||(Z.Ionic=Z.Ionic||{},Z.Ionic.config=Object.assign(Object.assign({},Z.Ionic.config),E))})(Object.assign(Object.assign({},E),{_zoneGate:Pt=>D.run(Pt)}));const fe="__zone_symbol__addEventListener"in Z.body?"__zone_symbol__addEventListener":"addEventListener";return function Hi(){var E=[];if(typeof window<"u"){var Z=window;(!Z.customElements||Z.Element&&(!Z.Element.prototype.closest||!Z.Element.prototype.matches||!Z.Element.prototype.remove||!Z.Element.prototype.getRootNode))&&E.push(k.e(6748).then(k.t.bind(k,723,23))),("function"!=typeof Object.assign||!Object.entries||!Array.prototype.find||!Array.prototype.includes||!String.prototype.startsWith||!String.prototype.endsWith||Z.NodeList&&!Z.NodeList.prototype.forEach||!Z.fetch||!function(){try{var j=new URL("b","http://a");return j.pathname="c%20d","http://a/c%20d"===j.href&&j.searchParams}catch{return!1}}()||typeof WeakMap>"u")&&E.push(k.e(2214).then(k.t.bind(k,4144,23)))}return Promise.all(E)}().then(()=>((E,Z)=>typeof window>"u"?Promise.resolve():(0,Ot.p)().then(()=>(ri(),(0,Ot.b)(JSON.parse('[["ion-menu_3",[[33,"ion-menu-button",{"color":[513],"disabled":[4],"menu":[1],"autoHide":[4,"auto-hide"],"type":[1],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]],[33,"ion-menu",{"contentId":[513,"content-id"],"menuId":[513,"menu-id"],"type":[1025],"disabled":[1028],"side":[513],"swipeGesture":[4,"swipe-gesture"],"maxEdgeStart":[2,"max-edge-start"],"isPaneVisible":[32],"isEndSide":[32],"isOpen":[64],"isActive":[64],"open":[64],"close":[64],"toggle":[64],"setOpen":[64]},[[16,"ionSplitPaneVisible","onSplitPaneChanged"],[2,"click","onBackdropClick"],[0,"keydown","onKeydown"]]],[1,"ion-menu-toggle",{"menu":[1],"autoHide":[4,"auto-hide"],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]]]],["ion-fab_3",[[33,"ion-fab-button",{"color":[513],"activated":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1],"show":[4],"translucent":[4],"type":[1],"size":[1],"closeIcon":[1,"close-icon"]}],[1,"ion-fab",{"horizontal":[1],"vertical":[1],"edge":[4],"activated":[1028],"close":[64]}],[1,"ion-fab-list",{"activated":[4],"side":[1]}]]],["ion-refresher_2",[[0,"ion-refresher-content",{"pullingIcon":[1025,"pulling-icon"],"pullingText":[1,"pulling-text"],"refreshingSpinner":[1025,"refreshing-spinner"],"refreshingText":[1,"refreshing-text"]}],[32,"ion-refresher",{"pullMin":[2,"pull-min"],"pullMax":[2,"pull-max"],"closeDuration":[1,"close-duration"],"snapbackDuration":[1,"snapback-duration"],"pullFactor":[2,"pull-factor"],"disabled":[4],"nativeRefresher":[32],"state":[32],"complete":[64],"cancel":[64],"getProgress":[64]}]]],["ion-back-button",[[33,"ion-back-button",{"color":[513],"defaultHref":[1025,"default-href"],"disabled":[516],"icon":[1],"text":[1],"type":[1],"routerAnimation":[16]}]]],["ion-toast",[[33,"ion-toast",{"overlayIndex":[2,"overlay-index"],"color":[513],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"duration":[2],"header":[1],"message":[1],"keyboardClose":[4,"keyboard-close"],"position":[1],"buttons":[16],"translucent":[4],"animated":[4],"icon":[1],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-card_5",[[33,"ion-card",{"color":[513],"button":[4],"type":[1],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}],[32,"ion-card-content"],[33,"ion-card-header",{"color":[513],"translucent":[4]}],[33,"ion-card-subtitle",{"color":[513]}],[33,"ion-card-title",{"color":[513]}]]],["ion-item-option_3",[[33,"ion-item-option",{"color":[513],"disabled":[4],"download":[1],"expandable":[4],"href":[1],"rel":[1],"target":[1],"type":[1]}],[32,"ion-item-options",{"side":[1],"fireSwipeEvent":[64]}],[0,"ion-item-sliding",{"disabled":[4],"state":[32],"getOpenAmount":[64],"getSlidingRatio":[64],"open":[64],"close":[64],"closeOpened":[64]}]]],["ion-accordion_2",[[49,"ion-accordion",{"value":[1],"disabled":[4],"readonly":[4],"toggleIcon":[1,"toggle-icon"],"toggleIconSlot":[1,"toggle-icon-slot"],"state":[32],"isNext":[32],"isPrevious":[32]}],[33,"ion-accordion-group",{"animated":[4],"multiple":[4],"value":[1025],"disabled":[4],"readonly":[4],"expand":[1],"requestAccordionToggle":[64],"getAccordions":[64]},[[0,"keydown","onKeydown"]]]]],["ion-infinite-scroll_2",[[32,"ion-infinite-scroll-content",{"loadingSpinner":[1025,"loading-spinner"],"loadingText":[1,"loading-text"]}],[0,"ion-infinite-scroll",{"threshold":[1],"disabled":[4],"position":[1],"isLoading":[32],"complete":[64]}]]],["ion-reorder_2",[[33,"ion-reorder",null,[[2,"click","onClick"]]],[0,"ion-reorder-group",{"disabled":[4],"state":[32],"complete":[64]}]]],["ion-segment_2",[[33,"ion-segment-button",{"disabled":[4],"layout":[1],"type":[1],"value":[1],"checked":[32]}],[33,"ion-segment",{"color":[513],"disabled":[4],"scrollable":[4],"swipeGesture":[4,"swipe-gesture"],"value":[1025],"selectOnFocus":[4,"select-on-focus"],"activated":[32]},[[0,"keydown","onKeyDown"]]]]],["ion-tab-bar_2",[[33,"ion-tab-button",{"disabled":[4],"download":[1],"href":[1],"rel":[1],"layout":[1025],"selected":[1028],"tab":[1],"target":[1]},[[8,"ionTabBarChanged","onTabBarChanged"]]],[33,"ion-tab-bar",{"color":[513],"selectedTab":[1,"selected-tab"],"translucent":[4],"keyboardVisible":[32]}]]],["ion-chip",[[33,"ion-chip",{"color":[513],"outline":[4],"disabled":[4]}]]],["ion-searchbar",[[34,"ion-searchbar",{"color":[513],"animated":[4],"autocomplete":[1],"autocorrect":[1],"cancelButtonIcon":[1,"cancel-button-icon"],"cancelButtonText":[1,"cancel-button-text"],"clearIcon":[1,"clear-icon"],"debounce":[2],"disabled":[4],"inputmode":[1],"enterkeyhint":[1],"placeholder":[1],"searchIcon":[1,"search-icon"],"showCancelButton":[1,"show-cancel-button"],"showClearButton":[1,"show-clear-button"],"spellcheck":[4],"type":[1],"value":[1025],"focused":[32],"noAnimate":[32],"setFocus":[64],"getInputElement":[64]}]]],["ion-nav_2",[[1,"ion-nav",{"delegate":[16],"swipeGesture":[1028,"swipe-gesture"],"animated":[4],"animation":[16],"rootParams":[16],"root":[1],"push":[64],"insert":[64],"insertPages":[64],"pop":[64],"popTo":[64],"popToRoot":[64],"removeIndex":[64],"setRoot":[64],"setPages":[64],"setRouteId":[64],"getRouteId":[64],"getActive":[64],"getByIndex":[64],"canGoBack":[64],"getPrevious":[64]}],[0,"ion-nav-link",{"component":[1],"componentProps":[16],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}]]],["ion-slide_2",[[0,"ion-slide"],[36,"ion-slides",{"options":[8],"pager":[4],"scrollbar":[4],"update":[64],"updateAutoHeight":[64],"slideTo":[64],"slideNext":[64],"slidePrev":[64],"getActiveIndex":[64],"getPreviousIndex":[64],"length":[64],"isEnd":[64],"isBeginning":[64],"startAutoplay":[64],"stopAutoplay":[64],"lockSwipeToNext":[64],"lockSwipeToPrev":[64],"lockSwipes":[64],"getSwiper":[64]}]]],["ion-tab_2",[[1,"ion-tab",{"active":[1028],"delegate":[16],"tab":[1],"component":[1],"setActive":[64]}],[1,"ion-tabs",{"useRouter":[1028,"use-router"],"selectedTab":[32],"select":[64],"getTab":[64],"getSelected":[64],"setRouteId":[64],"getRouteId":[64]}]]],["ion-input",[[34,"ion-input",{"fireFocusEvents":[4,"fire-focus-events"],"color":[513],"accept":[1],"autocapitalize":[1],"autocomplete":[1],"autocorrect":[1],"autofocus":[4],"clearInput":[4,"clear-input"],"clearOnEdit":[4,"clear-on-edit"],"debounce":[2],"disabled":[4],"enterkeyhint":[1],"inputmode":[1],"max":[8],"maxlength":[2],"min":[8],"minlength":[2],"multiple":[4],"name":[1],"pattern":[1],"placeholder":[1],"readonly":[4],"required":[4],"spellcheck":[4],"step":[1],"size":[2],"type":[1],"value":[1032],"hasFocus":[32],"setFocus":[64],"setBlur":[64],"getInputElement":[64]}]]],["ion-textarea",[[34,"ion-textarea",{"fireFocusEvents":[4,"fire-focus-events"],"color":[513],"autocapitalize":[1],"autofocus":[4],"clearOnEdit":[1028,"clear-on-edit"],"debounce":[2],"disabled":[4],"inputmode":[1],"enterkeyhint":[1],"maxlength":[2],"minlength":[2],"name":[1],"placeholder":[1],"readonly":[4],"required":[4],"spellcheck":[4],"cols":[2],"rows":[2],"wrap":[1],"autoGrow":[4,"auto-grow"],"value":[1025],"hasFocus":[32],"setFocus":[64],"setBlur":[64],"getInputElement":[64]}]]],["ion-backdrop",[[33,"ion-backdrop",{"visible":[4],"tappable":[4],"stopPropagation":[4,"stop-propagation"]},[[2,"click","onMouseDown"]]]]],["ion-loading",[[34,"ion-loading",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"message":[1],"cssClass":[1,"css-class"],"duration":[2],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"spinner":[1025],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-breadcrumb_2",[[33,"ion-breadcrumb",{"collapsed":[4],"last":[4],"showCollapsedIndicator":[4,"show-collapsed-indicator"],"color":[1],"active":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"separator":[4],"target":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}],[33,"ion-breadcrumbs",{"color":[1],"maxItems":[2,"max-items"],"itemsBeforeCollapse":[2,"items-before-collapse"],"itemsAfterCollapse":[2,"items-after-collapse"],"collapsed":[32],"activeChanged":[32]},[[0,"collapsedClick","onCollapsedClick"]]]]],["ion-modal",[[33,"ion-modal",{"hasController":[4,"has-controller"],"overlayIndex":[2,"overlay-index"],"delegate":[16],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"breakpoints":[16],"initialBreakpoint":[2,"initial-breakpoint"],"backdropBreakpoint":[2,"backdrop-breakpoint"],"handle":[4],"component":[1],"componentProps":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"animated":[4],"swipeToClose":[4,"swipe-to-close"],"presentingElement":[16],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"canDismiss":[4,"can-dismiss"],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"setCurrentBreakpoint":[64],"getCurrentBreakpoint":[64]}]]],["ion-route_4",[[0,"ion-route",{"url":[1],"component":[1],"componentProps":[16],"beforeLeave":[16],"beforeEnter":[16]}],[0,"ion-route-redirect",{"from":[1],"to":[1]}],[0,"ion-router",{"root":[1],"useHash":[4,"use-hash"],"canTransition":[64],"push":[64],"back":[64],"printDebug":[64],"navChanged":[64]},[[8,"popstate","onPopState"],[4,"ionBackButton","onBackButton"]]],[1,"ion-router-link",{"color":[513],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}]]],["ion-avatar_3",[[33,"ion-avatar"],[33,"ion-badge",{"color":[513]}],[1,"ion-thumbnail"]]],["ion-col_3",[[1,"ion-col",{"offset":[1],"offsetXs":[1,"offset-xs"],"offsetSm":[1,"offset-sm"],"offsetMd":[1,"offset-md"],"offsetLg":[1,"offset-lg"],"offsetXl":[1,"offset-xl"],"pull":[1],"pullXs":[1,"pull-xs"],"pullSm":[1,"pull-sm"],"pullMd":[1,"pull-md"],"pullLg":[1,"pull-lg"],"pullXl":[1,"pull-xl"],"push":[1],"pushXs":[1,"push-xs"],"pushSm":[1,"push-sm"],"pushMd":[1,"push-md"],"pushLg":[1,"push-lg"],"pushXl":[1,"push-xl"],"size":[1],"sizeXs":[1,"size-xs"],"sizeSm":[1,"size-sm"],"sizeMd":[1,"size-md"],"sizeLg":[1,"size-lg"],"sizeXl":[1,"size-xl"]},[[9,"resize","onResize"]]],[1,"ion-grid",{"fixed":[4]}],[1,"ion-row"]]],["ion-img",[[1,"ion-img",{"alt":[1],"src":[1],"loadSrc":[32],"loadError":[32]}]]],["ion-progress-bar",[[33,"ion-progress-bar",{"type":[1],"reversed":[4],"value":[2],"buffer":[2],"color":[513]}]]],["ion-range",[[33,"ion-range",{"color":[513],"debounce":[2],"name":[1],"dualKnobs":[4,"dual-knobs"],"min":[2],"max":[2],"pin":[4],"pinFormatter":[16],"snaps":[4],"step":[2],"ticks":[4],"disabled":[4],"value":[1026],"ratioA":[32],"ratioB":[32],"pressedKnob":[32]}]]],["ion-split-pane",[[33,"ion-split-pane",{"contentId":[513,"content-id"],"disabled":[4],"when":[8],"visible":[32]}]]],["ion-text",[[1,"ion-text",{"color":[513]}]]],["ion-toggle",[[33,"ion-toggle",{"color":[513],"name":[1],"checked":[1028],"disabled":[4],"value":[1],"activated":[32]}]]],["ion-virtual-scroll",[[0,"ion-virtual-scroll",{"approxItemHeight":[2,"approx-item-height"],"approxHeaderHeight":[2,"approx-header-height"],"approxFooterHeight":[2,"approx-footer-height"],"headerFn":[16],"footerFn":[16],"items":[16],"itemHeight":[16],"headerHeight":[16],"footerHeight":[16],"renderItem":[16],"renderHeader":[16],"renderFooter":[16],"nodeRender":[16],"domRender":[16],"totalHeight":[32],"positionForItem":[64],"checkRange":[64],"checkEnd":[64]},[[9,"resize","onResize"]]]]],["ion-picker-column-internal",[[33,"ion-picker-column-internal",{"items":[16],"value":[1032],"color":[513],"numericInput":[4,"numeric-input"],"isActive":[32],"scrollActiveItemIntoView":[64]}]]],["ion-picker-internal",[[33,"ion-picker-internal"]]],["ion-radio_2",[[33,"ion-radio",{"color":[513],"name":[1],"disabled":[4],"value":[8],"checked":[32],"buttonTabindex":[32],"setFocus":[64],"setButtonTabindex":[64]}],[0,"ion-radio-group",{"allowEmptySelection":[4,"allow-empty-selection"],"name":[1],"value":[1032]},[[4,"keydown","onKeydown"]]]]],["ion-ripple-effect",[[1,"ion-ripple-effect",{"type":[1],"addRipple":[64]}]]],["ion-button_2",[[33,"ion-button",{"color":[513],"buttonType":[1025,"button-type"],"disabled":[516],"expand":[513],"fill":[1537],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"download":[1],"href":[1],"rel":[1],"shape":[513],"size":[513],"strong":[4],"target":[1],"type":[1]}],[1,"ion-icon",{"mode":[1025],"color":[1],"ios":[1],"md":[1],"flipRtl":[4,"flip-rtl"],"name":[513],"src":[1],"icon":[8],"size":[1],"lazy":[4],"sanitize":[4],"svgContent":[32],"isVisible":[32],"ariaLabel":[32]}]]],["ion-datetime_3",[[33,"ion-datetime",{"color":[1],"name":[1],"disabled":[4],"readonly":[4],"isDateEnabled":[16],"min":[1025],"max":[1025],"presentation":[1],"cancelText":[1,"cancel-text"],"doneText":[1,"done-text"],"clearText":[1,"clear-text"],"yearValues":[8,"year-values"],"monthValues":[8,"month-values"],"dayValues":[8,"day-values"],"hourValues":[8,"hour-values"],"minuteValues":[8,"minute-values"],"locale":[1],"firstDayOfWeek":[2,"first-day-of-week"],"value":[1025],"showDefaultTitle":[4,"show-default-title"],"showDefaultButtons":[4,"show-default-buttons"],"showClearButton":[4,"show-clear-button"],"showDefaultTimeLabel":[4,"show-default-time-label"],"hourCycle":[1,"hour-cycle"],"size":[1],"showMonthAndYear":[32],"activeParts":[32],"workingParts":[32],"isPresented":[32],"isTimePopoverOpen":[32],"confirm":[64],"reset":[64],"cancel":[64]}],[34,"ion-picker",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"columns":[16],"cssClass":[1,"css-class"],"duration":[2],"showBackdrop":[4,"show-backdrop"],"backdropDismiss":[4,"backdrop-dismiss"],"animated":[4],"htmlAttributes":[16],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"getColumn":[64]}],[32,"ion-picker-column",{"col":[16]}]]],["ion-action-sheet",[[34,"ion-action-sheet",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"header":[1],"subHeader":[1,"sub-header"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-alert",[[34,"ion-alert",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"header":[1],"subHeader":[1,"sub-header"],"message":[1],"buttons":[16],"inputs":[1040],"backdropDismiss":[4,"backdrop-dismiss"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},[[4,"keydown","onKeydown"]]]]],["ion-popover",[[33,"ion-popover",{"hasController":[4,"has-controller"],"delegate":[16],"overlayIndex":[2,"overlay-index"],"enterAnimation":[16],"leaveAnimation":[16],"component":[1],"componentProps":[16],"keyboardClose":[4,"keyboard-close"],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"event":[8],"showBackdrop":[4,"show-backdrop"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"triggerAction":[1,"trigger-action"],"trigger":[1],"size":[1],"dismissOnSelect":[4,"dismiss-on-select"],"reference":[1],"side":[1],"alignment":[1025],"arrow":[4],"isOpen":[4,"is-open"],"keyboardEvents":[4,"keyboard-events"],"presented":[32],"presentFromTrigger":[64],"present":[64],"dismiss":[64],"getParentPopover":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-checkbox",[[33,"ion-checkbox",{"color":[513],"name":[1],"checked":[1028],"indeterminate":[1028],"disabled":[4],"value":[8]}]]],["ion-select_3",[[33,"ion-select",{"disabled":[4],"cancelText":[1,"cancel-text"],"okText":[1,"ok-text"],"placeholder":[1],"name":[1],"selectedText":[1,"selected-text"],"multiple":[4],"interface":[1],"interfaceOptions":[8,"interface-options"],"compareWith":[1,"compare-with"],"value":[1032],"isExpanded":[32],"open":[64]}],[1,"ion-select-option",{"disabled":[4],"value":[8]}],[34,"ion-select-popover",{"header":[1],"subHeader":[1,"sub-header"],"message":[1],"multiple":[4],"options":[16]},[[0,"ionChange","onSelect"]]]]],["ion-app_8",[[0,"ion-app",{"setFocus":[64]}],[1,"ion-content",{"color":[513],"fullscreen":[4],"forceOverscroll":[1028,"force-overscroll"],"scrollX":[4,"scroll-x"],"scrollY":[4,"scroll-y"],"scrollEvents":[4,"scroll-events"],"getScrollElement":[64],"scrollToTop":[64],"scrollToBottom":[64],"scrollByPoint":[64],"scrollToPoint":[64]},[[8,"appload","onAppLoad"]]],[36,"ion-footer",{"collapse":[1],"translucent":[4]}],[36,"ion-header",{"collapse":[1],"translucent":[4]}],[1,"ion-router-outlet",{"mode":[1025],"delegate":[16],"animated":[4],"animation":[16],"swipeHandler":[16],"commit":[64],"setRouteId":[64],"getRouteId":[64]}],[33,"ion-title",{"color":[513],"size":[1]}],[33,"ion-toolbar",{"color":[513]},[[0,"ionStyle","childrenStyle"]]],[34,"ion-buttons",{"collapse":[4]}]]],["ion-spinner",[[1,"ion-spinner",{"color":[513],"duration":[2],"name":[1],"paused":[4]}]]],["ion-item_8",[[33,"ion-item-divider",{"color":[513],"sticky":[4]}],[32,"ion-item-group"],[1,"ion-skeleton-text",{"animated":[4]}],[32,"ion-list",{"lines":[1],"inset":[4],"closeSlidingItems":[64]}],[33,"ion-list-header",{"color":[513],"lines":[1]}],[49,"ion-item",{"color":[513],"button":[4],"detail":[4],"detailIcon":[1,"detail-icon"],"disabled":[4],"download":[1],"fill":[1],"shape":[1],"href":[1],"rel":[1],"lines":[1],"counter":[4],"routerAnimation":[16],"routerDirection":[1,"router-direction"],"target":[1],"type":[1],"counterFormatter":[16],"multipleInputs":[32],"focusable":[32],"counterString":[32]},[[0,"ionChange","handleIonChange"],[0,"ionColor","labelColorChanged"],[0,"ionStyle","itemStyle"]]],[34,"ion-label",{"color":[513],"position":[1],"noAnimate":[32]}],[33,"ion-note",{"color":[513]}]]]]'),Z))))(0,{exclude:["ion-tabs","ion-tab"],syncQueue:!0,raf:dn,jmp:Pt=>D.runOutsideAngular(Pt),ael(Pt,Sn,Yn,Li){Pt[fe](Sn,Yn,Li)},rel(Pt,Sn,Yn,Li){Pt.removeEventListener(Sn,Yn,Li)}}))}};let ao=(()=>{class E{static forRoot(D){return{ngModule:E,providers:[{provide:gn,useValue:D},{provide:d.ip1,useFactory:Nl,multi:!0,deps:[gn,Ai.K0,d.R0b]}]}}}return E.\u0275fac=function(D){return new(D||E)},E.\u0275mod=d.oAB({type:E}),E.\u0275inj=d.cJS({providers:[So,ro,gl],imports:[[Ai.ez]]}),E})()},9442:(Ln,At,k)=>{"use strict";k.d(At,{c:()=>we});var d=k(3756);let m;const l=Ue=>Ue.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ie=Ue=>{if(void 0===m){const ke=void 0!==Ue.style.webkitAnimationName;m=void 0===Ue.style.animationName&&ke?"-webkit-":""}return m},re=(Ue,Ne,ke)=>{const He=Ne.startsWith("animation")?ie(Ue):"";Ue.style.setProperty(He+Ne,ke)},v=(Ue,Ne)=>{const ke=Ne.startsWith("animation")?ie(Ue):"";Ue.style.removeProperty(ke+Ne)},ge=[],Ie=(Ue=[],Ne)=>{if(void 0!==Ne){const ke=Array.isArray(Ne)?Ne:[Ne];return[...Ue,...ke]}return Ue},we=Ue=>{let Ne,ke,He,We,Qe,ve,tt,Ht,Nt,Bt,Dt,it,Ot,me=[],Ze=[],Pe=[],Ge=!1,ye={},Ae=[],Be=[],st={},_t=0,Yt=!1,xn=!1,ht=!0,Lt=!1,_e=!0,Qt=!1;const _n=Ue,Tn=[],mn=[],lt=[],qt=[],En=[],yi=[],Ui=[],Xi=[],mr=[],di=[],Ai="function"==typeof AnimationEffect||"function"==typeof window.AnimationEffect,Hi="function"==typeof Element&&"function"==typeof Element.prototype.animate&&Ai,on=()=>di,de=(et,ct)=>(((null==ct?void 0:ct.oneTimeCallback)?mn:Tn).push({c:et,o:ct}),Ot),$t=()=>{if(Hi)di.forEach(et=>{et.cancel()}),di.length=0;else{const et=lt.slice();(0,d.r)(()=>{et.forEach(ct=>{v(ct,"animation-name"),v(ct,"animation-duration"),v(ct,"animation-timing-function"),v(ct,"animation-iteration-count"),v(ct,"animation-delay"),v(ct,"animation-play-state"),v(ct,"animation-fill-mode"),v(ct,"animation-direction")})})}},dn=()=>{En.forEach(et=>{(null==et?void 0:et.parentNode)&&et.parentNode.removeChild(et)}),En.length=0},Ci=()=>void 0!==Qe?Qe:tt?tt.getFill():"both",je=()=>void 0!==Nt?Nt:void 0!==ve?ve:tt?tt.getDirection():"normal",L=()=>Yt?"linear":void 0!==He?He:tt?tt.getEasing():"linear",Q=()=>xn?0:void 0!==Bt?Bt:void 0!==ke?ke:tt?tt.getDuration():0,N=()=>void 0!==We?We:tt?tt.getIterations():1,pe=()=>void 0!==Dt?Dt:void 0!==Ne?Ne:tt?tt.getDelay():0,Xt=()=>{0!==_t&&(_t--,0===_t&&((()=>{wr(),Xi.forEach(bn=>bn()),mr.forEach(bn=>bn());const et=ht?1:0,ct=Ae,kt=Be,en=st;lt.forEach(bn=>{const nn=bn.classList;ct.forEach(Nn=>nn.add(Nn)),kt.forEach(Nn=>nn.remove(Nn));for(const Nn in en)en.hasOwnProperty(Nn)&&re(bn,Nn,en[Nn])}),Tn.forEach(bn=>bn.c(et,Ot)),mn.forEach(bn=>bn.c(et,Ot)),mn.length=0,_e=!0,ht&&(Lt=!0),ht=!0})(),tt&&tt.animationFinish()))},qn=(et=!0)=>{dn();const ct=(Ue=>(Ue.forEach(Ne=>{for(const ke in Ne)if(Ne.hasOwnProperty(ke)){const He=Ne[ke];if("easing"===ke)Ne["animation-timing-function"]=He,delete Ne[ke];else{const We=l(ke);We!==ke&&(Ne[We]=He,delete Ne[ke])}}}),Ue))(me);lt.forEach(kt=>{if(ct.length>0){const en=((Ue=[])=>Ue.map(Ne=>{const ke=Ne.offset,He=[];for(const We in Ne)Ne.hasOwnProperty(We)&&"offset"!==We&&He.push(`${We}: ${Ne[We]};`);return`${100*ke}% { ${He.join(" ")} }`}).join(" "))(ct);it=void 0!==Ue?Ue:(Ue=>{let Ne=ge.indexOf(Ue);return Ne<0&&(Ne=ge.push(Ue)-1),`ion-animation-${Ne}`})(en);const bn=((Ue,Ne,ke)=>{const He=(Ue=>{const Ne=Ue.getRootNode();return Ne.head||Ne})(ke),We=ie(ke),Qe=He.querySelector("#"+Ue);if(Qe)return Qe;const ve=(ke.ownerDocument||document).createElement("style");return ve.id=Ue,ve.textContent=`@${We}keyframes ${Ue} { ${Ne} } @${We}keyframes ${Ue}-alt { ${Ne} }`,He.appendChild(ve),ve})(it,en,kt);En.push(bn),re(kt,"animation-duration",`${Q()}ms`),re(kt,"animation-timing-function",L()),re(kt,"animation-delay",`${pe()}ms`),re(kt,"animation-fill-mode",Ci()),re(kt,"animation-direction",je());const nn=N()===1/0?"infinite":N().toString();re(kt,"animation-iteration-count",nn),re(kt,"animation-play-state","paused"),et&&re(kt,"animation-name",`${bn.id}-alt`),(0,d.r)(()=>{re(kt,"animation-name",bn.id||null)})}})},gr=(et=!0)=>{(()=>{yi.forEach(en=>en()),Ui.forEach(en=>en());const et=Ze,ct=Pe,kt=ye;lt.forEach(en=>{const bn=en.classList;et.forEach(nn=>bn.add(nn)),ct.forEach(nn=>bn.remove(nn));for(const nn in kt)kt.hasOwnProperty(nn)&&re(en,nn,kt[nn])})})(),me.length>0&&(Hi?(lt.forEach(et=>{const ct=et.animate(me,{id:_n,delay:pe(),duration:Q(),easing:L(),iterations:N(),fill:Ci(),direction:je()});ct.pause(),di.push(ct)}),di.length>0&&(di[0].onfinish=()=>{Xt()})):qn(et)),Ge=!0},lr=et=>{if(et=Math.min(Math.max(et,0),.9999),Hi)di.forEach(ct=>{ct.currentTime=ct.effect.getComputedTiming().delay+Q()*et,ct.pause()});else{const ct=`-${Q()*et}ms`;lt.forEach(kt=>{me.length>0&&(re(kt,"animation-delay",ct),re(kt,"animation-play-state","paused"))})}},Dn=et=>{di.forEach(ct=>{ct.effect.updateTiming({delay:pe(),duration:Q(),easing:L(),iterations:N(),fill:Ci(),direction:je()})}),void 0!==et&&lr(et)},mi=(et=!0,ct)=>{(0,d.r)(()=>{lt.forEach(kt=>{re(kt,"animation-name",it||null),re(kt,"animation-duration",`${Q()}ms`),re(kt,"animation-timing-function",L()),re(kt,"animation-delay",void 0!==ct?`-${ct*Q()}ms`:`${pe()}ms`),re(kt,"animation-fill-mode",Ci()||null),re(kt,"animation-direction",je()||null);const en=N()===1/0?"infinite":N().toString();re(kt,"animation-iteration-count",en),et&&re(kt,"animation-name",`${it}-alt`),(0,d.r)(()=>{re(kt,"animation-name",it||null)})})})},Wn=(et=!1,ct=!0,kt)=>(et&&qt.forEach(en=>{en.update(et,ct,kt)}),Hi?Dn(kt):mi(ct,kt),Ot),$r=()=>{Ge&&(Hi?di.forEach(et=>{et.pause()}):lt.forEach(et=>{re(et,"animation-play-state","paused")}),Qt=!0)},Ir=()=>{Ht=void 0,Xt()},wr=()=>{Ht&&clearTimeout(Ht)},Yi=et=>new Promise(ct=>{(null==et?void 0:et.sync)&&(xn=!0,de(()=>xn=!1,{oneTimeCallback:!0})),Ge||gr(),Lt&&(Hi?(lr(0),Dn()):mi(),Lt=!1),_e&&(_t=qt.length+1,_e=!1),de(()=>ct(),{oneTimeCallback:!0}),qt.forEach(kt=>{kt.play()}),Hi?(di.forEach(et=>{et.play()}),(0===me.length||0===lt.length)&&Xt()):(()=>{if(wr(),(0,d.r)(()=>{lt.forEach(et=>{me.length>0&&re(et,"animation-play-state","running")})}),0===me.length||0===lt.length)Xt();else{const et=pe()||0,ct=Q()||0,kt=N()||1;isFinite(kt)&&(Ht=setTimeout(Ir,et+ct*kt+100)),((Ue,Ne)=>{let ke;const He={passive:!0},Qe=ve=>{Ue===ve.target&&(ke&&ke(),wr(),(0,d.r)(()=>{lt.forEach(et=>{v(et,"animation-duration"),v(et,"animation-delay"),v(et,"animation-play-state")}),(0,d.r)(Xt)}))};Ue&&(Ue.addEventListener("webkitAnimationEnd",Qe,He),Ue.addEventListener("animationend",Qe,He),ke=()=>{Ue.removeEventListener("webkitAnimationEnd",Qe,He),Ue.removeEventListener("animationend",Qe,He)})})(lt[0])}})(),Qt=!1}),Xe=(et,ct)=>{const kt=me[0];return void 0===kt||void 0!==kt.offset&&0!==kt.offset?me=[{offset:0,[et]:ct},...me]:kt[et]=ct,Ot};return Ot={parentAnimation:tt,elements:lt,childAnimations:qt,id:_n,animationFinish:Xt,from:Xe,to:(et,ct)=>{const kt=me[me.length-1];return void 0===kt||void 0!==kt.offset&&1!==kt.offset?me=[...me,{offset:1,[et]:ct}]:kt[et]=ct,Ot},fromTo:(et,ct,kt)=>Xe(et,ct).to(et,kt),parent:et=>(tt=et,Ot),play:Yi,pause:()=>(qt.forEach(et=>{et.pause()}),$r(),Ot),stop:()=>{qt.forEach(et=>{et.stop()}),Ge&&($t(),Ge=!1),Yt=!1,xn=!1,_e=!0,Nt=void 0,Bt=void 0,Dt=void 0,_t=0,Lt=!1,ht=!0,Qt=!1},destroy:et=>(qt.forEach(ct=>{ct.destroy(et)}),(et=>{$t(),et&&dn()})(et),lt.length=0,qt.length=0,me.length=0,Tn.length=0,mn.length=0,Ge=!1,_e=!0,Ot),keyframes:et=>{const ct=me!==et;return me=et,ct&&(et=>{Hi?on().forEach(ct=>{if(ct.effect.setKeyframes)ct.effect.setKeyframes(et);else{const kt=new KeyframeEffect(ct.effect.target,et,ct.effect.getTiming());ct.effect=kt}}):qn()})(me),Ot},addAnimation:et=>{if(null!=et)if(Array.isArray(et))for(const ct of et)ct.parent(Ot),qt.push(ct);else et.parent(Ot),qt.push(et);return Ot},addElement:et=>{if(null!=et)if(1===et.nodeType)lt.push(et);else if(et.length>=0)for(let ct=0;ct<et.length;ct++)lt.push(et[ct]);else console.error("Invalid addElement value");return Ot},update:Wn,fill:et=>(Qe=et,Wn(!0),Ot),direction:et=>(ve=et,Wn(!0),Ot),iterations:et=>(We=et,Wn(!0),Ot),duration:et=>(!Hi&&0===et&&(et=1),ke=et,Wn(!0),Ot),easing:et=>(He=et,Wn(!0),Ot),delay:et=>(Ne=et,Wn(!0),Ot),getWebAnimations:on,getKeyframes:()=>me,getFill:Ci,getDirection:je,getDelay:pe,getIterations:N,getEasing:L,getDuration:Q,afterAddRead:et=>(Xi.push(et),Ot),afterAddWrite:et=>(mr.push(et),Ot),afterClearStyles:(et=[])=>{for(const ct of et)st[ct]="";return Ot},afterStyles:(et={})=>(st=et,Ot),afterRemoveClass:et=>(Be=Ie(Be,et),Ot),afterAddClass:et=>(Ae=Ie(Ae,et),Ot),beforeAddRead:et=>(yi.push(et),Ot),beforeAddWrite:et=>(Ui.push(et),Ot),beforeClearStyles:(et=[])=>{for(const ct of et)ye[ct]="";return Ot},beforeStyles:(et={})=>(ye=et,Ot),beforeRemoveClass:et=>(Pe=Ie(Pe,et),Ot),beforeAddClass:et=>(Ze=Ie(Ze,et),Ot),onFinish:de,isRunning:()=>0!==_t&&!Qt,progressStart:(et=!1,ct)=>(qt.forEach(kt=>{kt.progressStart(et,ct)}),$r(),Yt=et,Ge||gr(),Wn(!1,!0,ct),Ot),progressStep:et=>(qt.forEach(ct=>{ct.progressStep(et)}),lr(et),Ot),progressEnd:(et,ct,kt)=>(Yt=!1,qt.forEach(en=>{en.progressEnd(et,ct,kt)}),void 0!==kt&&(Bt=kt),Lt=!1,ht=!0,0===et?(Nt="reverse"===je()?"normal":"reverse","reverse"===Nt&&(ht=!1),Hi?(Wn(),lr(1-ct)):(Dt=(1-ct)*Q()*-1,Wn(!1,!1))):1===et&&(Hi?(Wn(),lr(ct)):(Dt=ct*Q()*-1,Wn(!1,!1))),void 0!==et&&(de(()=>{Bt=void 0,Nt=void 0,Dt=void 0},{oneTimeCallback:!0}),tt||Yi()),Ot)}}},3509:(Ln,At,k)=>{"use strict";k.d(At,{G:()=>ie});class m{constructor(v,ne,De,ge,X){this.id=ne,this.name=De,this.disableScroll=X,this.priority=1e6*ge+ne,this.ctrl=v}canStart(){return!!this.ctrl&&this.ctrl.canStart(this.name)}start(){return!!this.ctrl&&this.ctrl.start(this.name,this.id,this.priority)}capture(){if(!this.ctrl)return!1;const v=this.ctrl.capture(this.name,this.id,this.priority);return v&&this.disableScroll&&this.ctrl.disableScroll(this.id),v}release(){this.ctrl&&(this.ctrl.release(this.id),this.disableScroll&&this.ctrl.enableScroll(this.id))}destroy(){this.release(),this.ctrl=void 0}}class ce{constructor(v,ne,De,ge){this.id=ne,this.disable=De,this.disableScroll=ge,this.ctrl=v}block(){if(this.ctrl){if(this.disable)for(const v of this.disable)this.ctrl.disableGesture(v,this.id);this.disableScroll&&this.ctrl.disableScroll(this.id)}}unblock(){if(this.ctrl){if(this.disable)for(const v of this.disable)this.ctrl.enableGesture(v,this.id);this.disableScroll&&this.ctrl.enableScroll(this.id)}}destroy(){this.unblock(),this.ctrl=void 0}}const l="backdrop-no-scroll",ie=new class d{constructor(){this.gestureId=0,this.requestedStart=new Map,this.disabledGestures=new Map,this.disabledScroll=new Set}createGesture(v){return new m(this,this.newID(),v.name,v.priority||0,!!v.disableScroll)}createBlocker(v={}){return new ce(this,this.newID(),v.disable,!!v.disableScroll)}start(v,ne,De){return this.canStart(v)?(this.requestedStart.set(ne,De),!0):(this.requestedStart.delete(ne),!1)}capture(v,ne,De){if(!this.start(v,ne,De))return!1;const ge=this.requestedStart;let X=-1e4;if(ge.forEach(ue=>{X=Math.max(X,ue)}),X===De){this.capturedId=ne,ge.clear();const ue=new CustomEvent("ionGestureCaptured",{detail:{gestureName:v}});return document.dispatchEvent(ue),!0}return ge.delete(ne),!1}release(v){this.requestedStart.delete(v),this.capturedId===v&&(this.capturedId=void 0)}disableGesture(v,ne){let De=this.disabledGestures.get(v);void 0===De&&(De=new Set,this.disabledGestures.set(v,De)),De.add(ne)}enableGesture(v,ne){const De=this.disabledGestures.get(v);void 0!==De&&De.delete(ne)}disableScroll(v){this.disabledScroll.add(v),1===this.disabledScroll.size&&document.body.classList.add(l)}enableScroll(v){this.disabledScroll.delete(v),0===this.disabledScroll.size&&document.body.classList.remove(l)}canStart(v){return!(void 0!==this.capturedId||this.isDisabled(v))}isCaptured(){return void 0!==this.capturedId}isScrollDisabled(){return this.disabledScroll.size>0}isDisabled(v){const ne=this.disabledGestures.get(v);return!!(ne&&ne.size>0)}newID(){return this.gestureId++,this.gestureId}}},7593:(Ln,At,k)=>{"use strict";k.r(At),k.d(At,{MENU_BACK_BUTTON_PRIORITY:()=>ie,OVERLAY_BACK_BUTTON_PRIORITY:()=>l,blockHardwareBackButton:()=>m,startHardwareBackButton:()=>ce});var d=k(9671);const m=()=>{document.addEventListener("backbutton",()=>{})},ce=()=>{const re=document;let v=!1;re.addEventListener("backbutton",()=>{if(v)return;let ne=0,De=[];const ge=new CustomEvent("ionBackButton",{bubbles:!1,detail:{register(se,Ie){De.push({priority:se,handler:Ie,id:ne++})}}});re.dispatchEvent(ge);const X=function(){var se=(0,d.Z)(function*(Ie){try{if(null==Ie?void 0:Ie.handler){const we=Ie.handler(ue);null!=we&&(yield we)}}catch(we){console.error(we)}});return function(we){return se.apply(this,arguments)}}(),ue=()=>{if(De.length>0){let se={priority:Number.MIN_SAFE_INTEGER,handler:()=>{},id:-1};De.forEach(Ie=>{Ie.priority>=se.priority&&(se=Ie)}),v=!0,De=De.filter(Ie=>Ie.id!==se.id),X(se).then(()=>v=!1)}};ue()})},l=100,ie=99},3756:(Ln,At,k)=>{"use strict";k.d(At,{a:()=>v,b:()=>ne,c:()=>ce,d:()=>Ie,e:()=>we,f:()=>se,g:()=>De,h:()=>Qe,i:()=>re,j:()=>l,k:()=>ue,l:()=>Ue,m:()=>X,n:()=>Ne,o:()=>We,p:()=>He,q:()=>ve,r:()=>ge,s:()=>me,t:()=>d,u:()=>ke});const d=(Ze,Pe=0)=>new Promise(Ge=>{m(Ze,Pe,Ge)}),m=(Ze,Pe=0,Ge)=>{let tt,ye;const Ae={passive:!0},st=()=>{tt&&tt()},_t=Yt=>{(void 0===Yt||Ze===Yt.target)&&(st(),Ge(Yt))};return Ze&&(Ze.addEventListener("webkitTransitionEnd",_t,Ae),Ze.addEventListener("transitionend",_t,Ae),ye=setTimeout(_t,Pe+500),tt=()=>{ye&&(clearTimeout(ye),ye=void 0),Ze.removeEventListener("webkitTransitionEnd",_t,Ae),Ze.removeEventListener("transitionend",_t,Ae)}),st},ce=(Ze,Pe)=>{Ze.componentOnReady?Ze.componentOnReady().then(Ge=>Pe(Ge)):ge(()=>Pe(Ze))},l=(Ze,Pe=[])=>{const Ge={};return Pe.forEach(tt=>{Ze.hasAttribute(tt)&&(null!==Ze.getAttribute(tt)&&(Ge[tt]=Ze.getAttribute(tt)),Ze.removeAttribute(tt))}),Ge},ie=["role","aria-activedescendant","aria-atomic","aria-autocomplete","aria-braillelabel","aria-brailleroledescription","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colindextext","aria-colspan","aria-controls","aria-current","aria-describedby","aria-description","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowindextext","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext"],re=Ze=>l(Ze,ie),v=(Ze,Pe,Ge,tt)=>{var ye;if(typeof window<"u"){const Ae=window,Be=null===(ye=null==Ae?void 0:Ae.Ionic)||void 0===ye?void 0:ye.config;if(Be){const st=Be.get("_ael");if(st)return st(Ze,Pe,Ge,tt);if(Be._ael)return Be._ael(Ze,Pe,Ge,tt)}}return Ze.addEventListener(Pe,Ge,tt)},ne=(Ze,Pe,Ge,tt)=>{var ye;if(typeof window<"u"){const Ae=window,Be=null===(ye=null==Ae?void 0:Ae.Ionic)||void 0===ye?void 0:ye.config;if(Be){const st=Be.get("_rel");if(st)return st(Ze,Pe,Ge,tt);if(Be._rel)return Be._rel(Ze,Pe,Ge,tt)}}return Ze.removeEventListener(Pe,Ge,tt)},De=(Ze,Pe=Ze)=>Ze.shadowRoot||Pe,ge=Ze=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(Ze):"function"==typeof requestAnimationFrame?requestAnimationFrame(Ze):setTimeout(Ze),X=Ze=>!!Ze.shadowRoot&&!!Ze.attachShadow,ue=Ze=>{const Pe=Ze.closest("ion-item");return Pe?Pe.querySelector("ion-label"):null},se=Ze=>{if(Ze.focus(),Ze.classList.contains("ion-focusable")){const Pe=Ze.closest("ion-app");Pe&&Pe.setFocus([Ze])}},Ie=(Ze,Pe)=>{let Ge;const tt=Ze.getAttribute("aria-labelledby"),ye=Ze.id;let Ae=null!==tt&&""!==tt.trim()?tt:Pe+"-lbl",Be=null!==tt&&""!==tt.trim()?document.getElementById(tt):ue(Ze);return Be?(null===tt&&(Be.id=Ae),Ge=Be.textContent,Be.setAttribute("aria-hidden","true")):""!==ye.trim()&&(Be=document.querySelector(`label[for="${ye}"]`),Be&&(""!==Be.id?Ae=Be.id:Be.id=Ae=`${ye}-lbl`,Ge=Be.textContent)),{label:Be,labelId:Ae,labelText:Ge}},we=(Ze,Pe,Ge,tt,ye)=>{if(Ze||X(Pe)){let Ae=Pe.querySelector("input.aux-input");Ae||(Ae=Pe.ownerDocument.createElement("input"),Ae.type="hidden",Ae.classList.add("aux-input"),Pe.appendChild(Ae)),Ae.disabled=ye,Ae.name=Ge,Ae.value=tt||""}},Ue=(Ze,Pe,Ge)=>Math.max(Ze,Math.min(Pe,Ge)),Ne=(Ze,Pe)=>{if(!Ze){const Ge="ASSERT: "+Pe;throw console.error(Ge),new Error(Ge)}},ke=Ze=>Ze.timeStamp||Date.now(),He=Ze=>{if(Ze){const Pe=Ze.changedTouches;if(Pe&&Pe.length>0){const Ge=Pe[0];return{x:Ge.clientX,y:Ge.clientY}}if(void 0!==Ze.pageX)return{x:Ze.pageX,y:Ze.pageY}}return{x:0,y:0}},We=Ze=>{const Pe="rtl"===document.dir;switch(Ze){case"start":return Pe;case"end":return!Pe;default:throw new Error(`"${Ze}" is not a valid value for [side]. Use "start" or "end" instead.`)}},Qe=(Ze,Pe)=>{const Ge=Ze._original||Ze;return{_original:Ze,emit:ve(Ge.emit.bind(Ge),Pe)}},ve=(Ze,Pe=0)=>{let Ge;return(...tt)=>{clearTimeout(Ge),Ge=setTimeout(Ze,Pe,...tt)}},me=(Ze,Pe)=>{if(Ze??(Ze={}),Pe??(Pe={}),Ze===Pe)return!0;const Ge=Object.keys(Ze);if(Ge.length!==Object.keys(Pe).length)return!1;for(const tt of Ge)if(!(tt in Pe)||Ze[tt]!==Pe[tt])return!1;return!0}},4318:(Ln,At,k)=>{"use strict";k.d(At,{L:()=>l,a:()=>ie,b:()=>re,c:()=>v,d:()=>ne,e:()=>Pe,g:()=>ye,l:()=>me,s:()=>Ge,t:()=>X});var d=k(9671),m=k(2361),ce=k(3756);const l="ionViewWillEnter",ie="ionViewDidEnter",re="ionViewWillLeave",v="ionViewDidLeave",ne="ionViewWillUnload",X=Ae=>new Promise((Be,st)=>{(0,m.c)(()=>{ue(Ae),se(Ae).then(_t=>{_t.animation&&_t.animation.destroy(),Ie(Ae),Be(_t)},_t=>{Ie(Ae),st(_t)})})}),ue=Ae=>{const Be=Ae.enteringEl,st=Ae.leavingEl;tt(Be,st,Ae.direction),Ae.showGoBack?Be.classList.add("can-go-back"):Be.classList.remove("can-go-back"),Ge(Be,!1),Be.style.setProperty("pointer-events","none"),st&&(Ge(st,!1),st.style.setProperty("pointer-events","none"))},se=function(){var Ae=(0,d.Z)(function*(Be){const st=yield we(Be);return st&&m.B.isBrowser?Ue(st,Be):Ne(Be)});return function(st){return Ae.apply(this,arguments)}}(),Ie=Ae=>{const Be=Ae.enteringEl,st=Ae.leavingEl;Be.classList.remove("ion-page-invisible"),Be.style.removeProperty("pointer-events"),void 0!==st&&(st.classList.remove("ion-page-invisible"),st.style.removeProperty("pointer-events"))},we=function(){var Ae=(0,d.Z)(function*(Be){return Be.leavingEl&&Be.animated&&0!==Be.duration?Be.animationBuilder?Be.animationBuilder:"ios"===Be.mode?(yield Promise.resolve().then(k.bind(k,1815))).iosTransitionAnimation:(yield Promise.resolve().then(k.bind(k,6447))).mdTransitionAnimation:void 0});return function(st){return Ae.apply(this,arguments)}}(),Ue=function(){var Ae=(0,d.Z)(function*(Be,st){yield ke(st,!0);const _t=Be(st.baseEl,st);Qe(st.enteringEl,st.leavingEl);const Yt=yield We(_t,st);return st.progressCallback&&st.progressCallback(void 0),Yt&&ve(st.enteringEl,st.leavingEl),{hasCompleted:Yt,animation:_t}});return function(st,_t){return Ae.apply(this,arguments)}}(),Ne=function(){var Ae=(0,d.Z)(function*(Be){const st=Be.enteringEl,_t=Be.leavingEl;return yield ke(Be,!1),Qe(st,_t),ve(st,_t),{hasCompleted:!0}});return function(st){return Ae.apply(this,arguments)}}(),ke=function(){var Ae=(0,d.Z)(function*(Be,st){const Yt=(void 0!==Be.deepWait?Be.deepWait:st)?[Pe(Be.enteringEl),Pe(Be.leavingEl)]:[Ze(Be.enteringEl),Ze(Be.leavingEl)];yield Promise.all(Yt),yield He(Be.viewIsReady,Be.enteringEl)});return function(st,_t){return Ae.apply(this,arguments)}}(),He=function(){var Ae=(0,d.Z)(function*(Be,st){Be&&(yield Be(st))});return function(st,_t){return Ae.apply(this,arguments)}}(),We=(Ae,Be)=>{const st=Be.progressCallback,_t=new Promise(Yt=>{Ae.onFinish(xn=>Yt(1===xn))});return st?(Ae.progressStart(!0),st(Ae)):Ae.play(),_t},Qe=(Ae,Be)=>{me(Be,re),me(Ae,l)},ve=(Ae,Be)=>{me(Ae,ie),me(Be,v)},me=(Ae,Be)=>{if(Ae){const st=new CustomEvent(Be,{bubbles:!1,cancelable:!1});Ae.dispatchEvent(st)}},Ze=Ae=>Ae?new Promise(Be=>(0,ce.c)(Ae,Be)):Promise.resolve(),Pe=function(){var Ae=(0,d.Z)(function*(Be){const st=Be;if(st){if(null!=st.componentOnReady){if(null!=(yield st.componentOnReady()))return}else if(null!=st.__registerHost)return void(yield new Promise(Yt=>(0,ce.r)(Yt)));yield Promise.all(Array.from(st.children).map(Pe))}});return function(st){return Ae.apply(this,arguments)}}(),Ge=(Ae,Be)=>{Be?(Ae.setAttribute("aria-hidden","true"),Ae.classList.add("ion-page-hidden")):(Ae.hidden=!1,Ae.removeAttribute("aria-hidden"),Ae.classList.remove("ion-page-hidden"))},tt=(Ae,Be,st)=>{void 0!==Ae&&(Ae.style.zIndex="back"===st?"99":"101"),void 0!==Be&&(Be.style.zIndex="100")},ye=Ae=>Ae.classList.contains("ion-page")?Ae:Ae.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")||Ae},3139:(Ln,At,k)=>{"use strict";k.r(At),k.d(At,{GESTURE_CONTROLLER:()=>d.G,createGesture:()=>De});var d=k(3509);const m=(se,Ie,we,Ue)=>{const Ne=ce(se)?{capture:!!Ue.capture,passive:!!Ue.passive}:!!Ue.capture;let ke,He;return se.__zone_symbol__addEventListener?(ke="__zone_symbol__addEventListener",He="__zone_symbol__removeEventListener"):(ke="addEventListener",He="removeEventListener"),se[ke](Ie,we,Ne),()=>{se[He](Ie,we,Ne)}},ce=se=>{if(void 0===l)try{const Ie=Object.defineProperty({},"passive",{get:()=>{l=!0}});se.addEventListener("optsTest",()=>{},Ie)}catch{l=!1}return!!l};let l;const v=se=>se instanceof Document?se:se.ownerDocument,De=se=>{let Ie=!1,we=!1,Ue=!0,Ne=!1;const ke=Object.assign({disableScroll:!1,direction:"x",gesturePriority:0,passive:!0,maxAngle:40,threshold:10},se),He=ke.canStart,We=ke.onWillStart,Qe=ke.onStart,ve=ke.onEnd,me=ke.notCaptured,Ze=ke.onMove,Pe=ke.threshold,Ge=ke.passive,tt=ke.blurOnStart,ye={type:"pan",startX:0,startY:0,startTime:0,currentX:0,currentY:0,velocityX:0,velocityY:0,deltaX:0,deltaY:0,currentTime:0,event:void 0,data:void 0},Ae=((se,Ie,we)=>{const Ue=we*(Math.PI/180),Ne="x"===se,ke=Math.cos(Ue),He=Ie*Ie;let We=0,Qe=0,ve=!1,me=0;return{start(Ze,Pe){We=Ze,Qe=Pe,me=0,ve=!0},detect(Ze,Pe){if(!ve)return!1;const Ge=Ze-We,tt=Pe-Qe,ye=Ge*Ge+tt*tt;if(ye<He)return!1;const Ae=Math.sqrt(ye),Be=(Ne?Ge:tt)/Ae;return me=Be>ke?1:Be<-ke?-1:0,ve=!1,!0},isGesture:()=>0!==me,getDirection:()=>me}})(ke.direction,ke.threshold,ke.maxAngle),Be=d.G.createGesture({name:se.gestureName,priority:se.gesturePriority,disableScroll:se.disableScroll}),Yt=()=>{!Ie||(Ne=!1,Ze&&Ze(ye))},xn=()=>!(Be&&!Be.capture()||(Ie=!0,Ue=!1,ye.startX=ye.currentX,ye.startY=ye.currentY,ye.startTime=ye.currentTime,We?We(ye).then(Nt):Nt(),0)),Nt=()=>{tt&&(()=>{if(typeof document<"u"){const _e=document.activeElement;(null==_e?void 0:_e.blur)&&_e.blur()}})(),Qe&&Qe(ye),Ue=!0},Bt=()=>{Ie=!1,we=!1,Ne=!1,Ue=!0,Be.release()},Dt=_e=>{const it=Ie,Ot=Ue;if(Bt(),Ot){if(ge(ye,_e),it)return void(ve&&ve(ye));me&&me(ye)}},ht=((se,Ie,we,Ue,Ne)=>{let ke,He,We,Qe,ve,me,Ze,Pe=0;const Ge=Ht=>{Pe=Date.now()+2e3,Ie(Ht)&&(!He&&we&&(He=m(se,"touchmove",we,Ne)),We||(We=m(Ht.target,"touchend",ye,Ne)),Qe||(Qe=m(Ht.target,"touchcancel",ye,Ne)))},tt=Ht=>{Pe>Date.now()||!Ie(Ht)||(!me&&we&&(me=m(v(se),"mousemove",we,Ne)),Ze||(Ze=m(v(se),"mouseup",Ae,Ne)))},ye=Ht=>{Be(),Ue&&Ue(Ht)},Ae=Ht=>{st(),Ue&&Ue(Ht)},Be=()=>{He&&He(),We&&We(),Qe&&Qe(),He=We=Qe=void 0},st=()=>{me&&me(),Ze&&Ze(),me=Ze=void 0},_t=()=>{Be(),st()},Yt=(Ht=!0)=>{Ht?(ke||(ke=m(se,"touchstart",Ge,Ne)),ve||(ve=m(se,"mousedown",tt,Ne))):(ke&&ke(),ve&&ve(),ke=ve=void 0,_t())};return{enable:Yt,stop:_t,destroy:()=>{Yt(!1),Ue=we=Ie=void 0}}})(ke.el,_e=>{const it=ue(_e);return!(we||!Ue||(X(_e,ye),ye.startX=ye.currentX,ye.startY=ye.currentY,ye.startTime=ye.currentTime=it,ye.velocityX=ye.velocityY=ye.deltaX=ye.deltaY=0,ye.event=_e,He&&!1===He(ye))||(Be.release(),!Be.start()))&&(we=!0,0===Pe?xn():(Ae.start(ye.startX,ye.startY),!0))},_e=>{Ie?!Ne&&Ue&&(Ne=!0,ge(ye,_e),requestAnimationFrame(Yt)):(ge(ye,_e),Ae.detect(ye.currentX,ye.currentY)&&(!Ae.isGesture()||!xn())&&Lt())},Dt,{capture:!1,passive:Ge}),Lt=()=>{Bt(),ht.stop(),me&&me(ye)};return{enable(_e=!0){_e||(Ie&&Dt(void 0),Bt()),ht.enable(_e)},destroy(){Be.destroy(),ht.destroy()}}},ge=(se,Ie)=>{if(!Ie)return;const we=se.currentX,Ue=se.currentY,Ne=se.currentTime;X(Ie,se);const ke=se.currentX,He=se.currentY,Qe=(se.currentTime=ue(Ie))-Ne;if(Qe>0&&Qe<100){const me=(He-Ue)/Qe;se.velocityX=(ke-we)/Qe*.7+.3*se.velocityX,se.velocityY=.7*me+.3*se.velocityY}se.deltaX=ke-se.startX,se.deltaY=He-se.startY,se.event=Ie},X=(se,Ie)=>{let we=0,Ue=0;if(se){const Ne=se.changedTouches;if(Ne&&Ne.length>0){const ke=Ne[0];we=ke.clientX,Ue=ke.clientY}else void 0!==se.pageX&&(we=se.pageX,Ue=se.pageY)}Ie.currentX=we,Ie.currentY=Ue},ue=se=>se.timeStamp||Date.now()},2361:(Ln,At,k)=>{"use strict";k.d(At,{B:()=>Yi,H:()=>qt,a:()=>Lt,b:()=>vi,c:()=>Lr,e:()=>xi,f:()=>Kr,g:()=>_e,h:()=>mn,i:()=>Di,j:()=>L,k:()=>Xt,p:()=>Ue,r:()=>gr,s:()=>Ie});var d=k(9671);let ce,l,ie,re=!1,v=!1,ne=!1,De=!1,ge=!1;const X=typeof window<"u"?window:{},ue=X.document||{head:{}},se={$flags$:0,$resourcesUrl$:"",jmp:Ee=>Ee(),raf:Ee=>requestAnimationFrame(Ee),ael:(Ee,Xe,vt,Gt)=>Ee.addEventListener(Xe,vt,Gt),rel:(Ee,Xe,vt,Gt)=>Ee.removeEventListener(Xe,vt,Gt),ce:(Ee,Xe)=>new CustomEvent(Ee,Xe)},Ie=Ee=>{Object.assign(se,Ee)},Ue=Ee=>Promise.resolve(Ee),Ne=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replace}catch{}return!1})(),ke=(Ee,Xe,vt,Gt)=>{vt&&vt.map(([et,ct,kt])=>{const en=We(Ee,et),bn=He(Xe,kt),nn=Qe(et);se.ael(en,ct,bn,nn),(Xe.$rmListeners$=Xe.$rmListeners$||[]).push(()=>se.rel(en,ct,bn,nn))})},He=(Ee,Xe)=>vt=>{try{256&Ee.$flags$?Ee.$lazyInstance$[Xe](vt):(Ee.$queuedListeners$=Ee.$queuedListeners$||[]).push([Xe,vt])}catch(Gt){mi(Gt)}},We=(Ee,Xe)=>4&Xe?ue:8&Xe?X:16&Xe?ue.body:Ee,Qe=Ee=>0!=(2&Ee),Ge="s-id",tt="sty-id",Be="http://www.w3.org/1999/xlink",Yt=new WeakMap,xn=(Ee,Xe,vt)=>{let Gt=yr.get(Ee);Ne&&vt?(Gt=Gt||new CSSStyleSheet,Gt.replace(Xe)):Gt=Xe,yr.set(Ee,Gt)},Ht=(Ee,Xe,vt,Gt)=>{let et=Bt(Xe,vt),ct=yr.get(et);if(Ee=11===Ee.nodeType?Ee:ue,ct)if("string"==typeof ct){let en,kt=Yt.get(Ee=Ee.head||Ee);kt||Yt.set(Ee,kt=new Set),kt.has(et)||(Ee.host&&(en=Ee.querySelector(`[${tt}="${et}"]`))?en.innerHTML=ct:(en=ue.createElement("style"),en.innerHTML=ct,Ee.insertBefore(en,Ee.querySelector("link"))),kt&&kt.add(et))}else Ee.adoptedStyleSheets.includes(ct)||(Ee.adoptedStyleSheets=[...Ee.adoptedStyleSheets,ct]);return et},Bt=(Ee,Xe)=>"sc-"+(Xe&&32&Ee.$flags$?Ee.$tagName$+"-"+Xe:Ee.$tagName$),Dt=Ee=>Ee.replace(/\/\*!@([^\/]+)\*\/[^\{]+\{/g,"$1{"),Lt=Ee=>jn.push(Ee),_e=Ee=>ei(Ee).$modeName$,it={},Tn=Ee=>"object"==(Ee=typeof Ee)||"function"===Ee,mn=(Ee,Xe,...vt)=>{let Gt=null,et=null,ct=null,kt=!1,en=!1,bn=[];const nn=hi=>{for(let bi=0;bi<hi.length;bi++)Gt=hi[bi],Array.isArray(Gt)?nn(Gt):null!=Gt&&"boolean"!=typeof Gt&&((kt="function"!=typeof Ee&&!Tn(Gt))&&(Gt=String(Gt)),kt&&en?bn[bn.length-1].$text$+=Gt:bn.push(kt?lt(null,Gt):Gt),en=kt)};if(nn(vt),Xe){Xe.key&&(et=Xe.key),Xe.name&&(ct=Xe.name);{const hi=Xe.className||Xe.class;hi&&(Xe.class="object"!=typeof hi?hi:Object.keys(hi).filter(bi=>hi[bi]).join(" "))}}if("function"==typeof Ee)return Ee(null===Xe?{}:Xe,bn,yi);const Nn=lt(Ee,null);return Nn.$attrs$=Xe,bn.length>0&&(Nn.$children$=bn),Nn.$key$=et,Nn.$name$=ct,Nn},lt=(Ee,Xe)=>({$flags$:0,$tag$:Ee,$text$:Xe,$elm$:null,$children$:null,$attrs$:null,$key$:null,$name$:null}),qt={},yi={forEach:(Ee,Xe)=>Ee.map(Ui).forEach(Xe),map:(Ee,Xe)=>Ee.map(Ui).map(Xe).map(Xi)},Ui=Ee=>({vattrs:Ee.$attrs$,vchildren:Ee.$children$,vkey:Ee.$key$,vname:Ee.$name$,vtag:Ee.$tag$,vtext:Ee.$text$}),Xi=Ee=>{if("function"==typeof Ee.vtag){const vt=Object.assign({},Ee.vattrs);return Ee.vkey&&(vt.key=Ee.vkey),Ee.vname&&(vt.name=Ee.vname),mn(Ee.vtag,vt,...Ee.vchildren||[])}const Xe=lt(Ee.vtag,Ee.vtext);return Xe.$attrs$=Ee.vattrs,Xe.$children$=Ee.vchildren,Xe.$key$=Ee.vkey,Xe.$name$=Ee.vname,Xe},mr=(Ee,Xe,vt,Gt,et,ct)=>{if(vt!==Gt){let kt=Dn(Ee,Xe),en=Xe.toLowerCase();if("class"===Xe){const bn=Ee.classList,nn=Ai(vt),Nn=Ai(Gt);bn.remove(...nn.filter(hi=>hi&&!Nn.includes(hi))),bn.add(...Nn.filter(hi=>hi&&!nn.includes(hi)))}else if("style"===Xe){for(const bn in vt)(!Gt||null==Gt[bn])&&(bn.includes("-")?Ee.style.removeProperty(bn):Ee.style[bn]="");for(const bn in Gt)(!vt||Gt[bn]!==vt[bn])&&(bn.includes("-")?Ee.style.setProperty(bn,Gt[bn]):Ee.style[bn]=Gt[bn])}else if("key"!==Xe)if("ref"===Xe)Gt&&Gt(Ee);else if(kt||"o"!==Xe[0]||"n"!==Xe[1]){const bn=Tn(Gt);if((kt||bn&&null!==Gt)&&!et)try{if(Ee.tagName.includes("-"))Ee[Xe]=Gt;else{let Nn=Gt??"";"list"===Xe?kt=!1:(null==vt||Ee[Xe]!=Nn)&&(Ee[Xe]=Nn)}}catch{}let nn=!1;en!==(en=en.replace(/^xlink\:?/,""))&&(Xe=en,nn=!0),null==Gt||!1===Gt?(!1!==Gt||""===Ee.getAttribute(Xe))&&(nn?Ee.removeAttributeNS(Be,Xe):Ee.removeAttribute(Xe)):(!kt||4&ct||et)&&!bn&&(Gt=!0===Gt?"":Gt,nn?Ee.setAttributeNS(Be,Xe,Gt):Ee.setAttribute(Xe,Gt))}else Xe="-"===Xe[2]?Xe.slice(3):Dn(X,en)?en.slice(2):en[2]+Xe.slice(3),vt&&se.rel(Ee,Xe,vt,!1),Gt&&se.ael(Ee,Xe,Gt,!1)}},di=/\s/,Ai=Ee=>Ee?Ee.split(di):[],Hi=(Ee,Xe,vt,Gt)=>{const et=11===Xe.$elm$.nodeType&&Xe.$elm$.host?Xe.$elm$.host:Xe.$elm$,ct=Ee&&Ee.$attrs$||it,kt=Xe.$attrs$||it;for(Gt in ct)Gt in kt||mr(et,Gt,ct[Gt],void 0,vt,Xe.$flags$);for(Gt in kt)mr(et,Gt,ct[Gt],kt[Gt],vt,Xe.$flags$)},ri=(Ee,Xe,vt,Gt)=>{let kt,en,bn,et=Xe.$children$[vt],ct=0;if(re||(ne=!0,"slot"===et.$tag$&&(ce&&Gt.classList.add(ce+"-s"),et.$flags$|=et.$children$?2:1)),null!==et.$text$)kt=et.$elm$=ue.createTextNode(et.$text$);else if(1&et.$flags$)kt=et.$elm$=ue.createTextNode("");else{if(De||(De="svg"===et.$tag$),kt=et.$elm$=ue.createElementNS(De?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",2&et.$flags$?"slot-fb":et.$tag$),De&&"foreignObject"===et.$tag$&&(De=!1),Hi(null,et,De),(Ee=>null!=Ee)(ce)&&kt["s-si"]!==ce&&kt.classList.add(kt["s-si"]=ce),et.$children$)for(ct=0;ct<et.$children$.length;++ct)en=ri(Ee,et,ct,kt),en&&kt.appendChild(en);"svg"===et.$tag$?De=!1:"foreignObject"===kt.tagName&&(De=!0)}return kt["s-hn"]=ie,3&et.$flags$&&(kt["s-sr"]=!0,kt["s-cr"]=l,kt["s-sn"]=et.$name$||"",bn=Ee&&Ee.$children$&&Ee.$children$[vt],bn&&bn.$tag$===et.$tag$&&Ee.$elm$&&on(Ee.$elm$,!1)),kt},on=(Ee,Xe)=>{se.$flags$|=1;const vt=Ee.childNodes;for(let Gt=vt.length-1;Gt>=0;Gt--){const et=vt[Gt];et["s-hn"]!==ie&&et["s-ol"]&&(Je(et).insertBefore(et,de(et)),et["s-ol"].remove(),et["s-ol"]=void 0,ne=!0),Xe&&on(et,Xe)}se.$flags$&=-2},It=(Ee,Xe,vt,Gt,et,ct)=>{let en,kt=Ee["s-cr"]&&Ee["s-cr"].parentNode||Ee;for(kt.shadowRoot&&kt.tagName===ie&&(kt=kt.shadowRoot);et<=ct;++et)Gt[et]&&(en=ri(null,vt,et,Ee),en&&(Gt[et].$elm$=en,kt.insertBefore(en,de(Xe))))},qe=(Ee,Xe,vt,Gt,et)=>{for(;Xe<=vt;++Xe)(Gt=Ee[Xe])&&(et=Gt.$elm$,_r(Gt),v=!0,et["s-ol"]?et["s-ol"].remove():on(et,!0),et.remove())},Wt=(Ee,Xe)=>Ee.$tag$===Xe.$tag$&&("slot"===Ee.$tag$?Ee.$name$===Xe.$name$:Ee.$key$===Xe.$key$),de=Ee=>Ee&&Ee["s-ol"]||Ee,Je=Ee=>(Ee["s-ol"]?Ee["s-ol"]:Ee).parentNode,$t=(Ee,Xe)=>{const vt=Xe.$elm$=Ee.$elm$,Gt=Ee.$children$,et=Xe.$children$,ct=Xe.$tag$,kt=Xe.$text$;let en;null===kt?(De="svg"===ct||"foreignObject"!==ct&&De,"slot"===ct||Hi(Ee,Xe,De),null!==Gt&&null!==et?((Ee,Xe,vt,Gt)=>{let Ki,zr,et=0,ct=0,kt=0,en=0,bn=Xe.length-1,nn=Xe[0],Nn=Xe[bn],hi=Gt.length-1,bi=Gt[0],Bi=Gt[hi];for(;et<=bn&&ct<=hi;)if(null==nn)nn=Xe[++et];else if(null==Nn)Nn=Xe[--bn];else if(null==bi)bi=Gt[++ct];else if(null==Bi)Bi=Gt[--hi];else if(Wt(nn,bi))$t(nn,bi),nn=Xe[++et],bi=Gt[++ct];else if(Wt(Nn,Bi))$t(Nn,Bi),Nn=Xe[--bn],Bi=Gt[--hi];else if(Wt(nn,Bi))("slot"===nn.$tag$||"slot"===Bi.$tag$)&&on(nn.$elm$.parentNode,!1),$t(nn,Bi),Ee.insertBefore(nn.$elm$,Nn.$elm$.nextSibling),nn=Xe[++et],Bi=Gt[--hi];else if(Wt(Nn,bi))("slot"===nn.$tag$||"slot"===Bi.$tag$)&&on(Nn.$elm$.parentNode,!1),$t(Nn,bi),Ee.insertBefore(Nn.$elm$,nn.$elm$),Nn=Xe[--bn],bi=Gt[++ct];else{for(kt=-1,en=et;en<=bn;++en)if(Xe[en]&&null!==Xe[en].$key$&&Xe[en].$key$===bi.$key$){kt=en;break}kt>=0?(zr=Xe[kt],zr.$tag$!==bi.$tag$?Ki=ri(Xe&&Xe[ct],vt,kt,Ee):($t(zr,bi),Xe[kt]=void 0,Ki=zr.$elm$),bi=Gt[++ct]):(Ki=ri(Xe&&Xe[ct],vt,ct,Ee),bi=Gt[++ct]),Ki&&Je(nn.$elm$).insertBefore(Ki,de(nn.$elm$))}et>bn?It(Ee,null==Gt[hi+1]?null:Gt[hi+1].$elm$,vt,Gt,ct,hi):ct>hi&&qe(Xe,et,bn)})(vt,Gt,Xe,et):null!==et?(null!==Ee.$text$&&(vt.textContent=""),It(vt,null,Xe,et,0,et.length-1)):null!==Gt&&qe(Gt,0,Gt.length-1),De&&"svg"===ct&&(De=!1)):(en=vt["s-cr"])?en.parentNode.textContent=kt:Ee.$text$!==kt&&(vt.data=kt)},dn=Ee=>{let vt,Gt,et,ct,kt,en,Xe=Ee.childNodes;for(Gt=0,et=Xe.length;Gt<et;Gt++)if(vt=Xe[Gt],1===vt.nodeType){if(vt["s-sr"])for(kt=vt["s-sn"],vt.hidden=!1,ct=0;ct<et;ct++)if(en=Xe[ct].nodeType,Xe[ct]["s-hn"]!==vt["s-hn"]||""!==kt){if(1===en&&kt===Xe[ct].getAttribute("slot")){vt.hidden=!0;break}}else if(1===en||3===en&&""!==Xe[ct].textContent.trim()){vt.hidden=!0;break}dn(vt)}},Qn=[],Qi=Ee=>{let Xe,vt,Gt,et,ct,kt,en=0,bn=Ee.childNodes,nn=bn.length;for(;en<nn;en++){if(Xe=bn[en],Xe["s-sr"]&&(vt=Xe["s-cr"])&&vt.parentNode)for(Gt=vt.parentNode.childNodes,et=Xe["s-sn"],kt=Gt.length-1;kt>=0;kt--)vt=Gt[kt],!vt["s-cn"]&&!vt["s-nr"]&&vt["s-hn"]!==Xe["s-hn"]&&(nr(vt,et)?(ct=Qn.find(Nn=>Nn.$nodeToRelocate$===vt),v=!0,vt["s-sn"]=vt["s-sn"]||et,ct?ct.$slotRefNode$=Xe:Qn.push({$slotRefNode$:Xe,$nodeToRelocate$:vt}),vt["s-sr"]&&Qn.map(Nn=>{nr(Nn.$nodeToRelocate$,vt["s-sn"])&&(ct=Qn.find(hi=>hi.$nodeToRelocate$===vt),ct&&!Nn.$slotRefNode$&&(Nn.$slotRefNode$=ct.$slotRefNode$))})):Qn.some(Nn=>Nn.$nodeToRelocate$===vt)||Qn.push({$nodeToRelocate$:vt}));1===Xe.nodeType&&Qi(Xe)}},nr=(Ee,Xe)=>1===Ee.nodeType?null===Ee.getAttribute("slot")&&""===Xe||Ee.getAttribute("slot")===Xe:Ee["s-sn"]===Xe||""===Xe,_r=Ee=>{Ee.$attrs$&&Ee.$attrs$.ref&&Ee.$attrs$.ref(null),Ee.$children$&&Ee.$children$.map(_r)},Di=Ee=>ei(Ee).$hostElement$,xi=(Ee,Xe,vt)=>{const Gt=Di(Ee);return{emit:et=>Xr(Gt,Xe,{bubbles:!!(4&vt),composed:!!(2&vt),cancelable:!!(1&vt),detail:et})}},Xr=(Ee,Xe,vt)=>{const Gt=se.ce(Xe,vt);return Ee.dispatchEvent(Gt),Gt},$i=(Ee,Xe)=>{Xe&&!Ee.$onRenderResolve$&&Xe["s-p"]&&Xe["s-p"].push(new Promise(vt=>Ee.$onRenderResolve$=vt))},Oi=(Ee,Xe)=>{if(Ee.$flags$|=16,!(4&Ee.$flags$))return $i(Ee,Ee.$ancestorComponent$),Lr(()=>Wr(Ee,Xe));Ee.$flags$|=512},Wr=(Ee,Xe)=>{const Gt=Ee.$lazyInstance$;let et;return Xe&&(Ee.$flags$|=256,Ee.$queuedListeners$&&(Ee.$queuedListeners$.map(([ct,kt])=>N(Gt,ct,kt)),Ee.$queuedListeners$=null),et=N(Gt,"componentWillLoad")),et=pe(et,()=>N(Gt,"componentWillRender")),pe(et,()=>ar(Ee,Gt,Xe))},ar=function(){var Ee=(0,d.Z)(function*(Xe,vt,Gt){const et=Xe.$hostElement$,kt=et["s-rc"];Gt&&(Ee=>{const Xe=Ee.$cmpMeta$,vt=Ee.$hostElement$,Gt=Xe.$flags$,ct=Ht(vt.shadowRoot?vt.shadowRoot:vt.getRootNode(),Xe,Ee.$modeName$);10&Gt&&(vt["s-sc"]=ct,vt.classList.add(ct+"-h"),2&Gt&&vt.classList.add(ct+"-s"))})(Xe);Ci(Xe,vt),kt&&(kt.map(bn=>bn()),et["s-rc"]=void 0);{const bn=et["s-p"],nn=()=>je(Xe);0===bn.length?nn():(Promise.all(bn).then(nn),Xe.$flags$|=4,bn.length=0)}});return function(vt,Gt,et){return Ee.apply(this,arguments)}}(),Ci=(Ee,Xe,vt)=>{try{Xe=Xe.render&&Xe.render(),Ee.$flags$&=-17,Ee.$flags$|=2,((Ee,Xe)=>{const vt=Ee.$hostElement$,Gt=Ee.$cmpMeta$,et=Ee.$vnode$||lt(null,null),ct=(Ee=>Ee&&Ee.$tag$===qt)(Xe)?Xe:mn(null,null,Xe);if(ie=vt.tagName,Gt.$attrsToReflect$&&(ct.$attrs$=ct.$attrs$||{},Gt.$attrsToReflect$.map(([kt,en])=>ct.$attrs$[en]=vt[kt])),ct.$tag$=null,ct.$flags$|=4,Ee.$vnode$=ct,ct.$elm$=et.$elm$=vt.shadowRoot||vt,ce=vt["s-sc"],l=vt["s-cr"],re=0!=(1&Gt.$flags$),v=!1,$t(et,ct),se.$flags$|=1,ne){Qi(ct.$elm$);let kt,en,bn,nn,Nn,hi,bi=0;for(;bi<Qn.length;bi++)kt=Qn[bi],en=kt.$nodeToRelocate$,en["s-ol"]||(bn=ue.createTextNode(""),bn["s-nr"]=en,en.parentNode.insertBefore(en["s-ol"]=bn,en));for(bi=0;bi<Qn.length;bi++)if(kt=Qn[bi],en=kt.$nodeToRelocate$,kt.$slotRefNode$){for(nn=kt.$slotRefNode$.parentNode,Nn=kt.$slotRefNode$.nextSibling,bn=en["s-ol"];bn=bn.previousSibling;)if(hi=bn["s-nr"],hi&&hi["s-sn"]===en["s-sn"]&&nn===hi.parentNode&&(hi=hi.nextSibling,!hi||!hi["s-nr"])){Nn=hi;break}(!Nn&&nn!==en.parentNode||en.nextSibling!==Nn)&&en!==Nn&&(!en["s-hn"]&&en["s-ol"]&&(en["s-hn"]=en["s-ol"].parentNode.nodeName),nn.insertBefore(en,Nn))}else 1===en.nodeType&&(en.hidden=!0)}v&&dn(ct.$elm$),se.$flags$&=-2,Qn.length=0})(Ee,Xe)}catch(Gt){mi(Gt,Ee.$hostElement$)}return null},je=Ee=>{const vt=Ee.$hostElement$,et=Ee.$lazyInstance$,ct=Ee.$ancestorComponent$;N(et,"componentDidRender"),64&Ee.$flags$?N(et,"componentDidUpdate"):(Ee.$flags$|=64,$e(vt),N(et,"componentDidLoad"),Ee.$onReadyResolve$(vt),ct||Q()),Ee.$onInstanceResolve$(vt),Ee.$onRenderResolve$&&(Ee.$onRenderResolve$(),Ee.$onRenderResolve$=void 0),512&Ee.$flags$&&Br(()=>Oi(Ee,!1)),Ee.$flags$&=-517},L=Ee=>{{const Xe=ei(Ee),vt=Xe.$hostElement$.isConnected;return vt&&2==(18&Xe.$flags$)&&Oi(Xe,!1),vt}},Q=Ee=>{$e(ue.documentElement),Br(()=>Xr(X,"appload",{detail:{namespace:"ionic"}}))},N=(Ee,Xe,vt)=>{if(Ee&&Ee[Xe])try{return Ee[Xe](vt)}catch(Gt){mi(Gt)}},pe=(Ee,Xe)=>Ee&&Ee.then?Ee.then(Xe):Xe(),$e=Ee=>Ee.classList.add("hydrated"),Tt=(Ee,Xe,vt,Gt,et,ct,kt)=>{let en,bn,nn,Nn;if(1===ct.nodeType){for(en=ct.getAttribute("c-id"),en&&(bn=en.split("."),(bn[0]===kt||"0"===bn[0])&&(nn={$flags$:0,$hostId$:bn[0],$nodeId$:bn[1],$depth$:bn[2],$index$:bn[3],$tag$:ct.tagName.toLowerCase(),$elm$:ct,$attrs$:null,$children$:null,$key$:null,$name$:null,$text$:null},Xe.push(nn),ct.removeAttribute("c-id"),Ee.$children$||(Ee.$children$=[]),Ee.$children$[nn.$index$]=nn,Ee=nn,Gt&&"0"===nn.$depth$&&(Gt[nn.$index$]=nn.$elm$))),Nn=ct.childNodes.length-1;Nn>=0;Nn--)Tt(Ee,Xe,vt,Gt,et,ct.childNodes[Nn],kt);if(ct.shadowRoot)for(Nn=ct.shadowRoot.childNodes.length-1;Nn>=0;Nn--)Tt(Ee,Xe,vt,Gt,et,ct.shadowRoot.childNodes[Nn],kt)}else if(8===ct.nodeType)bn=ct.nodeValue.split("."),(bn[1]===kt||"0"===bn[1])&&(en=bn[0],nn={$flags$:0,$hostId$:bn[1],$nodeId$:bn[2],$depth$:bn[3],$index$:bn[4],$elm$:ct,$attrs$:null,$children$:null,$key$:null,$name$:null,$tag$:null,$text$:null},"t"===en?(nn.$elm$=ct.nextSibling,nn.$elm$&&3===nn.$elm$.nodeType&&(nn.$text$=nn.$elm$.textContent,Xe.push(nn),ct.remove(),Ee.$children$||(Ee.$children$=[]),Ee.$children$[nn.$index$]=nn,Gt&&"0"===nn.$depth$&&(Gt[nn.$index$]=nn.$elm$))):nn.$hostId$===kt&&("s"===en?(nn.$tag$="slot",ct["s-sn"]=bn[5]?nn.$name$=bn[5]:"",ct["s-sr"]=!0,Gt&&(nn.$elm$=ue.createElement(nn.$tag$),nn.$name$&&nn.$elm$.setAttribute("name",nn.$name$),ct.parentNode.insertBefore(nn.$elm$,ct),ct.remove(),"0"===nn.$depth$&&(Gt[nn.$index$]=nn.$elm$)),vt.push(nn),Ee.$children$||(Ee.$children$=[]),Ee.$children$[nn.$index$]=nn):"r"===en&&(Gt?ct.remove():(et["s-cr"]=ct,ct["s-cn"]=!0))));else if(Ee&&"style"===Ee.$tag$){const hi=lt(null,ct.textContent);hi.$elm$=ct,hi.$index$="0",Ee.$children$=[hi]}},Ct=(Ee,Xe)=>{if(1===Ee.nodeType){let vt=0;for(;vt<Ee.childNodes.length;vt++)Ct(Ee.childNodes[vt],Xe);if(Ee.shadowRoot)for(vt=0;vt<Ee.shadowRoot.childNodes.length;vt++)Ct(Ee.shadowRoot.childNodes[vt],Xe)}else if(8===Ee.nodeType){const vt=Ee.nodeValue.split(".");"o"===vt[0]&&(Xe.set(vt[1]+"."+vt[2],Ee),Ee.nodeValue="",Ee["s-en"]=vt[3])}},Cn=(Ee,Xe,vt)=>{if(Xe.$members$){Ee.watchers&&(Xe.$watchers$=Ee.watchers);const Gt=Object.entries(Xe.$members$),et=Ee.prototype;if(Gt.map(([ct,[kt]])=>{31&kt||2&vt&&32&kt?Object.defineProperty(et,ct,{get(){return((Ee,Xe)=>ei(this).$instanceValues$.get(Xe))(0,ct)},set(en){((Ee,Xe,vt,Gt)=>{const et=ei(Ee),ct=et.$hostElement$,kt=et.$instanceValues$.get(Xe),en=et.$flags$,bn=et.$lazyInstance$;vt=((Ee,Xe)=>null==Ee||Tn(Ee)?Ee:4&Xe?"false"!==Ee&&(""===Ee||!!Ee):2&Xe?parseFloat(Ee):1&Xe?String(Ee):Ee)(vt,Gt.$members$[Xe][0]);const nn=Number.isNaN(kt)&&Number.isNaN(vt);if((!(8&en)||void 0===kt)&&vt!==kt&&!nn&&(et.$instanceValues$.set(Xe,vt),bn)){if(Gt.$watchers$&&128&en){const hi=Gt.$watchers$[Xe];hi&&hi.map(bi=>{try{bn[bi](vt,kt,Xe)}catch(Bi){mi(Bi,ct)}})}2==(18&en)&&Oi(et,!1)}})(this,ct,en,Xe)},configurable:!0,enumerable:!0}):1&vt&&64&kt&&Object.defineProperty(et,ct,{value(...en){const bn=ei(this);return bn.$onInstancePromise$.then(()=>bn.$lazyInstance$[ct](...en))}})}),1&vt){const ct=new Map;et.attributeChangedCallback=function(kt,en,bn){se.jmp(()=>{const nn=ct.get(kt);if(this.hasOwnProperty(nn))bn=this[nn],delete this[nn];else if(et.hasOwnProperty(nn)&&"number"==typeof this[nn]&&this[nn]==bn)return;this[nn]=(null!==bn||"boolean"!=typeof this[nn])&&bn})},Ee.observedAttributes=Gt.filter(([kt,en])=>15&en[0]).map(([kt,en])=>{const bn=en[1]||kt;return ct.set(bn,kt),512&en[0]&&Xe.$attrsToReflect$.push([kt,bn]),bn})}}return Ee},oi=function(){var Ee=(0,d.Z)(function*(Xe,vt,Gt,et,ct){if(0==(32&vt.$flags$)){{if(vt.$flags$|=32,(ct=Dr(Gt)).then){const nn=()=>{};ct=yield ct,nn()}ct.isProxied||(Gt.$watchers$=ct.watchers,Cn(ct,Gt,2),ct.isProxied=!0);const bn=()=>{};vt.$flags$|=8;try{new ct(vt)}catch(nn){mi(nn)}vt.$flags$&=-9,vt.$flags$|=128,bn(),Rn(vt.$lazyInstance$)}if(ct.style){let bn=ct.style;"string"!=typeof bn&&(bn=bn[vt.$modeName$=(Ee=>jn.map(Xe=>Xe(Ee)).find(Xe=>!!Xe))(Xe)]);const nn=Bt(Gt,vt.$modeName$);if(!yr.has(nn)){const Nn=()=>{};xn(nn,bn,!!(1&Gt.$flags$)),Nn()}}}const kt=vt.$ancestorComponent$,en=()=>Oi(vt,!0);kt&&kt["s-rc"]?kt["s-rc"].push(en):en()});return function(vt,Gt,et,ct,kt){return Ee.apply(this,arguments)}}(),Rn=Ee=>{N(Ee,"connectedCallback")},Xn=Ee=>{const Xe=Ee["s-cr"]=ue.createComment("");Xe["s-cn"]=!0,Ee.insertBefore(Xe,Ee.firstChild)},vi=(Ee,Xe={})=>{const Gt=[],et=Xe.exclude||[],ct=X.customElements,kt=ue.head,en=kt.querySelector("meta[charset]"),bn=ue.createElement("style"),nn=[],Nn=ue.querySelectorAll(`[${tt}]`);let hi,bi=!0,Bi=0;for(Object.assign(se,Xe),se.$resourcesUrl$=new URL(Xe.resourcesUrl||"./",ue.baseURI).href,se.$flags$|=2;Bi<Nn.length;Bi++)xn(Nn[Bi].getAttribute(tt),Dt(Nn[Bi].innerHTML),!0);Ee.map(Ki=>{Ki[1].map(zr=>{const Nr={$flags$:zr[0],$tagName$:zr[1],$members$:zr[2],$listeners$:zr[3]};Nr.$members$=zr[2],Nr.$listeners$=zr[3],Nr.$attrsToReflect$=[],Nr.$watchers$={};const Jo=Nr.$tagName$,ho=class extends HTMLElement{constructor(os){super(os),lr(os=this,Nr),1&Nr.$flags$&&os.attachShadow({mode:"open",delegatesFocus:!!(16&Nr.$flags$)})}connectedCallback(){hi&&(clearTimeout(hi),hi=null),bi?nn.push(this):se.jmp(()=>(Ee=>{if(0==(1&se.$flags$)){const Xe=ei(Ee),vt=Xe.$cmpMeta$,Gt=()=>{};if(1&Xe.$flags$)ke(Ee,Xe,vt.$listeners$),Rn(Xe.$lazyInstance$);else{let et;if(Xe.$flags$|=1,et=Ee.getAttribute(Ge),et){if(1&vt.$flags$){const ct=Ht(Ee.shadowRoot,vt,Ee.getAttribute("s-mode"));Ee.classList.remove(ct+"-h",ct+"-s")}((Ee,Xe,vt,Gt)=>{const ct=Ee.shadowRoot,kt=[],bn=ct?[]:null,nn=Gt.$vnode$=lt(Xe,null);se.$orgLocNodes$||Ct(ue.body,se.$orgLocNodes$=new Map),Ee[Ge]=vt,Ee.removeAttribute(Ge),Tt(nn,kt,[],bn,Ee,Ee,vt),kt.map(Nn=>{const hi=Nn.$hostId$+"."+Nn.$nodeId$,bi=se.$orgLocNodes$.get(hi),Bi=Nn.$elm$;bi&&""===bi["s-en"]&&bi.parentNode.insertBefore(Bi,bi.nextSibling),ct||(Bi["s-hn"]=Xe,bi&&(Bi["s-ol"]=bi,Bi["s-ol"]["s-nr"]=Bi)),se.$orgLocNodes$.delete(hi)}),ct&&bn.map(Nn=>{Nn&&ct.appendChild(Nn)})})(Ee,vt.$tagName$,et,Xe)}et||12&vt.$flags$&&Xn(Ee);{let ct=Ee;for(;ct=ct.parentNode||ct.host;)if(1===ct.nodeType&&ct.hasAttribute("s-id")&&ct["s-p"]||ct["s-p"]){$i(Xe,Xe.$ancestorComponent$=ct);break}}vt.$members$&&Object.entries(vt.$members$).map(([ct,[kt]])=>{if(31&kt&&Ee.hasOwnProperty(ct)){const en=Ee[ct];delete Ee[ct],Ee[ct]=en}}),Br(()=>oi(Ee,Xe,vt))}Gt()}})(this))}disconnectedCallback(){se.jmp(()=>(Ee=>{if(0==(1&se.$flags$)){const Xe=ei(this),vt=Xe.$lazyInstance$;Xe.$rmListeners$&&(Xe.$rmListeners$.map(Gt=>Gt()),Xe.$rmListeners$=void 0),N(vt,"disconnectedCallback")}})())}componentOnReady(){return ei(this).$onReadyPromise$}};Nr.$lazyBundleId$=Ki[0],!et.includes(Jo)&&!ct.get(Jo)&&(Gt.push(Jo),ct.define(Jo,Cn(ho,Nr,1)))})}),bn.innerHTML=Gt+"{visibility:hidden}.hydrated{visibility:inherit}",bn.setAttribute("data-styles",""),kt.insertBefore(bn,en?en.nextSibling:kt.firstChild),bi=!1,nn.length?nn.map(Ki=>Ki.connectedCallback()):se.jmp(()=>hi=setTimeout(Q,30))},Xt=Ee=>{const Xe=new URL(Ee,se.$resourcesUrl$);return Xe.origin!==X.location.origin?Xe.href:Xe.pathname},qn=new WeakMap,ei=Ee=>qn.get(Ee),gr=(Ee,Xe)=>qn.set(Xe.$lazyInstance$=Ee,Xe),lr=(Ee,Xe)=>{const vt={$flags$:0,$hostElement$:Ee,$cmpMeta$:Xe,$instanceValues$:new Map};return vt.$onInstancePromise$=new Promise(Gt=>vt.$onInstanceResolve$=Gt),vt.$onReadyPromise$=new Promise(Gt=>vt.$onReadyResolve$=Gt),Ee["s-p"]=[],Ee["s-rc"]=[],ke(Ee,vt,Xe.$listeners$),qn.set(Ee,vt)},Dn=(Ee,Xe)=>Xe in Ee,mi=(Ee,Xe)=>(0,console.error)(Ee,Xe),Wn=new Map,Dr=(Ee,Xe,vt)=>{const Gt=Ee.$tagName$.replace(/-/g,"_"),et=Ee.$lazyBundleId$,ct=Wn.get(et);return ct?ct[Gt]:k(863)(`./${et}.entry.js`).then(kt=>(Wn.set(et,kt),kt[Gt]),mi)},yr=new Map,jn=[],$r=[],jr=[],Ir=(Ee,Xe)=>vt=>{Ee.push(vt),ge||(ge=!0,Xe&&4&se.$flags$?Br(ki):se.raf(ki))},wr=Ee=>{for(let Xe=0;Xe<Ee.length;Xe++)try{Ee[Xe](performance.now())}catch(vt){mi(vt)}Ee.length=0},ki=()=>{wr($r),wr(jr),(ge=$r.length>0)&&se.raf(ki)},Br=Ee=>Ue().then(Ee),Kr=Ir($r,!1),Lr=Ir(jr,!0),Yi={isDev:!1,isBrowser:!0,isServer:!1,isTesting:!1}},7726:(Ln,At,k)=>{"use strict";k.d(At,{m:()=>X});var d=k(9671),m=k(7593),ce=k(3756),l=k(6254),ie=k(9442);const re=ue=>(0,ie.c)().duration(ue?400:300),v=ue=>{let se,Ie;const we=ue.width+8,Ue=(0,ie.c)(),Ne=(0,ie.c)();ue.isEndSide?(se=we+"px",Ie="0px"):(se=-we+"px",Ie="0px"),Ue.addElement(ue.menuInnerEl).fromTo("transform",`translateX(${se})`,`translateX(${Ie})`);const He="ios"===(0,l.b)(ue),We=He?.2:.25;return Ne.addElement(ue.backdropEl).fromTo("opacity",.01,We),re(He).addAnimation([Ue,Ne])},ne=ue=>{let se,Ie;const we=(0,l.b)(ue),Ue=ue.width;ue.isEndSide?(se=-Ue+"px",Ie=Ue+"px"):(se=Ue+"px",Ie=-Ue+"px");const Ne=(0,ie.c)().addElement(ue.menuInnerEl).fromTo("transform",`translateX(${Ie})`,"translateX(0px)"),ke=(0,ie.c)().addElement(ue.contentEl).fromTo("transform","translateX(0px)",`translateX(${se})`),He=(0,ie.c)().addElement(ue.backdropEl).fromTo("opacity",.01,.32);return re("ios"===we).addAnimation([Ne,ke,He])},De=ue=>{const se=(0,l.b)(ue),Ie=ue.width*(ue.isEndSide?-1:1)+"px",we=(0,ie.c)().addElement(ue.contentEl).fromTo("transform","translateX(0px)",`translateX(${Ie})`);return re("ios"===se).addAnimation(we)},X=(()=>{const ue=new Map,se=[],Ie=function(){var Nt=(0,d.Z)(function*(Bt){const Dt=yield Qe(Bt);return!!Dt&&Dt.open()});return function(Dt){return Nt.apply(this,arguments)}}(),we=function(){var Nt=(0,d.Z)(function*(Bt){const Dt=yield void 0!==Bt?Qe(Bt):ve();return void 0!==Dt&&Dt.close()});return function(Dt){return Nt.apply(this,arguments)}}(),Ue=function(){var Nt=(0,d.Z)(function*(Bt){const Dt=yield Qe(Bt);return!!Dt&&Dt.toggle()});return function(Dt){return Nt.apply(this,arguments)}}(),Ne=function(){var Nt=(0,d.Z)(function*(Bt,Dt){const ht=yield Qe(Dt);return ht&&(ht.disabled=!Bt),ht});return function(Dt,ht){return Nt.apply(this,arguments)}}(),ke=function(){var Nt=(0,d.Z)(function*(Bt,Dt){const ht=yield Qe(Dt);return ht&&(ht.swipeGesture=Bt),ht});return function(Dt,ht){return Nt.apply(this,arguments)}}(),He=function(){var Nt=(0,d.Z)(function*(Bt){if(null!=Bt){const Dt=yield Qe(Bt);return void 0!==Dt&&Dt.isOpen()}return void 0!==(yield ve())});return function(Dt){return Nt.apply(this,arguments)}}(),We=function(){var Nt=(0,d.Z)(function*(Bt){const Dt=yield Qe(Bt);return!!Dt&&!Dt.disabled});return function(Dt){return Nt.apply(this,arguments)}}(),Qe=function(){var Nt=(0,d.Z)(function*(Bt){return yield Ht(),"start"===Bt||"end"===Bt?xn(Lt=>Lt.side===Bt&&!Lt.disabled)||xn(Lt=>Lt.side===Bt):null!=Bt?xn(ht=>ht.menuId===Bt):xn(ht=>!ht.disabled)||(se.length>0?se[0].el:void 0)});return function(Dt){return Nt.apply(this,arguments)}}(),ve=function(){var Nt=(0,d.Z)(function*(){return yield Ht(),st()});return function(){return Nt.apply(this,arguments)}}(),me=function(){var Nt=(0,d.Z)(function*(){return yield Ht(),_t()});return function(){return Nt.apply(this,arguments)}}(),Ze=function(){var Nt=(0,d.Z)(function*(){return yield Ht(),Yt()});return function(){return Nt.apply(this,arguments)}}(),Pe=(Nt,Bt)=>{ue.set(Nt,Bt)},ye=Nt=>{const Bt=Nt.side;se.filter(Dt=>Dt.side===Bt&&Dt!==Nt).forEach(Dt=>Dt.disabled=!0)},Ae=function(){var Nt=(0,d.Z)(function*(Bt,Dt,ht){if(Yt())return!1;if(Dt){const Lt=yield ve();Lt&&Bt.el!==Lt&&(yield Lt.setOpen(!1,!1))}return Bt._setOpen(Dt,ht)});return function(Dt,ht,Lt){return Nt.apply(this,arguments)}}(),st=()=>xn(Nt=>Nt._isOpen),_t=()=>se.map(Nt=>Nt.el),Yt=()=>se.some(Nt=>Nt.isAnimating),xn=Nt=>{const Bt=se.find(Nt);if(void 0!==Bt)return Bt.el},Ht=()=>Promise.all(Array.from(document.querySelectorAll("ion-menu")).map(Nt=>new Promise(Bt=>(0,ce.c)(Nt,Bt))));return Pe("reveal",De),Pe("push",ne),Pe("overlay",v),typeof document<"u"&&document.addEventListener("ionBackButton",Nt=>{const Bt=st();Bt&&Nt.detail.register(m.MENU_BACK_BUTTON_PRIORITY,()=>Bt.close())}),{registerAnimation:Pe,get:Qe,getMenus:me,getOpen:ve,isEnabled:We,swipeGesture:ke,isAnimating:Ze,isOpen:He,enable:Ne,toggle:Ue,close:we,open:Ie,_getOpenSync:st,_createAnimation:(Nt,Bt)=>{const Dt=ue.get(Nt);if(!Dt)throw new Error("animation not registered");return Dt(Bt)},_register:Nt=>{se.indexOf(Nt)<0&&(Nt.disabled||ye(Nt),se.push(Nt))},_unregister:Nt=>{const Bt=se.indexOf(Nt);Bt>-1&&se.splice(Bt,1)},_setOpen:Ae,_setActiveMenu:ye}})()},6254:(Ln,At,k)=>{"use strict";k.d(At,{a:()=>X,b:()=>Yt,c:()=>ce,g:()=>ge,i:()=>xn});var d=k(2361);class m{constructor(){this.m=new Map}reset(Nt){this.m=new Map(Object.entries(Nt))}get(Nt,Bt){const Dt=this.m.get(Nt);return void 0!==Dt?Dt:Bt}getBoolean(Nt,Bt=!1){const Dt=this.m.get(Nt);return void 0===Dt?Bt:"string"==typeof Dt?"true"===Dt:!!Dt}getNumber(Nt,Bt){const Dt=parseFloat(this.m.get(Nt));return isNaN(Dt)?void 0!==Bt?Bt:NaN:Dt}set(Nt,Bt){this.m.set(Nt,Bt)}}const ce=new m,De="ionic-persist-config",ge=Ht=>ue(Ht),X=(Ht,Nt)=>("string"==typeof Ht&&(Nt=Ht,Ht=void 0),ge(Ht).includes(Nt)),ue=(Ht=window)=>{if(typeof Ht>"u")return[];Ht.Ionic=Ht.Ionic||{};let Nt=Ht.Ionic.platforms;return null==Nt&&(Nt=Ht.Ionic.platforms=se(Ht),Nt.forEach(Bt=>Ht.document.documentElement.classList.add(`plt-${Bt}`))),Nt},se=Ht=>{const Nt=ce.get("platform");return Object.keys(st).filter(Bt=>{const Dt=null==Nt?void 0:Nt[Bt];return"function"==typeof Dt?Dt(Ht):st[Bt](Ht)})},we=Ht=>!!(Ae(Ht,/iPad/i)||Ae(Ht,/Macintosh/i)&&ve(Ht)),ke=Ht=>Ae(Ht,/android|sink/i),ve=Ht=>Be(Ht,"(any-pointer:coarse)"),Ze=Ht=>Pe(Ht)||Ge(Ht),Pe=Ht=>!!(Ht.cordova||Ht.phonegap||Ht.PhoneGap),Ge=Ht=>{const Nt=Ht.Capacitor;return!!(null==Nt?void 0:Nt.isNative)},Ae=(Ht,Nt)=>Nt.test(Ht.navigator.userAgent),Be=(Ht,Nt)=>{var Bt;return null===(Bt=Ht.matchMedia)||void 0===Bt?void 0:Bt.call(Ht,Nt).matches},st={ipad:we,iphone:Ht=>Ae(Ht,/iPhone/i),ios:Ht=>Ae(Ht,/iPhone|iPod/i)||we(Ht),android:ke,phablet:Ht=>{const Nt=Ht.innerWidth,Bt=Ht.innerHeight,Dt=Math.min(Nt,Bt),ht=Math.max(Nt,Bt);return Dt>390&&Dt<520&&ht>620&&ht<800},tablet:Ht=>{const Nt=Ht.innerWidth,Bt=Ht.innerHeight,Dt=Math.min(Nt,Bt),ht=Math.max(Nt,Bt);return we(Ht)||(Ht=>ke(Ht)&&!Ae(Ht,/mobile/i))(Ht)||Dt>460&&Dt<820&&ht>780&&ht<1400},cordova:Pe,capacitor:Ge,electron:Ht=>Ae(Ht,/electron/i),pwa:Ht=>{var Nt;return!(!(null===(Nt=Ht.matchMedia)||void 0===Nt?void 0:Nt.call(Ht,"(display-mode: standalone)").matches)&&!Ht.navigator.standalone)},mobile:ve,mobileweb:Ht=>ve(Ht)&&!Ze(Ht),desktop:Ht=>!ve(Ht),hybrid:Ze};let _t;const Yt=Ht=>Ht&&(0,d.g)(Ht)||_t,xn=(Ht={})=>{if(typeof window>"u")return;const Nt=window.document,Bt=window,Dt=Bt.Ionic=Bt.Ionic||{},ht={};Ht._ael&&(ht.ael=Ht._ael),Ht._rel&&(ht.rel=Ht._rel),Ht._ce&&(ht.ce=Ht._ce),(0,d.s)(ht);const Lt=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},(Ht=>{try{const Nt=Ht.sessionStorage.getItem(De);return null!==Nt?JSON.parse(Nt):{}}catch{return{}}})(Bt)),{persistConfig:!1}),Dt.config),(Ht=>{const Nt={};return Ht.location.search.slice(1).split("&").map(Bt=>Bt.split("=")).map(([Bt,Dt])=>[decodeURIComponent(Bt),decodeURIComponent(Dt)]).filter(([Bt])=>((Ht,Nt)=>Ht.substr(0,Nt.length)===Nt)(Bt,"ionic:")).map(([Bt,Dt])=>[Bt.slice("ionic:".length),Dt]).forEach(([Bt,Dt])=>{Nt[Bt]=Dt}),Nt})(Bt)),Ht);ce.reset(Lt),ce.getBoolean("persistConfig")&&((Ht,Nt)=>{try{Ht.sessionStorage.setItem(De,JSON.stringify(Nt))}catch{return}})(Bt,Lt),ue(Bt),Dt.config=ce,Dt.mode=_t=ce.get("mode",Nt.documentElement.getAttribute("mode")||(X(Bt,"ios")?"ios":"md")),ce.set("mode",_t),Nt.documentElement.setAttribute("mode",_t),Nt.documentElement.classList.add(_t),ce.getBoolean("_testing")&&ce.set("animated",!1);const _e=Ot=>{var Qt;return null===(Qt=Ot.tagName)||void 0===Qt?void 0:Qt.startsWith("ION-")},it=Ot=>["ios","md"].includes(Ot);(0,d.a)(Ot=>{for(;Ot;){const Qt=Ot.mode||Ot.getAttribute("mode");if(Qt){if(it(Qt))return Qt;_e(Ot)&&console.warn('Invalid ionic mode: "'+Qt+'", expected: "ios" or "md"')}Ot=Ot.parentElement}return _t})}},1815:(Ln,At,k)=>{"use strict";k.r(At),k.d(At,{iosTransitionAnimation:()=>ue,shadow:()=>re});var d=k(9442),m=k(4318);k(2361);const ie=se=>document.querySelector(`${se}.ion-cloned-element`),re=se=>se.shadowRoot||se,v=se=>{const Ie="ION-TABS"===se.tagName?se:se.querySelector("ion-tabs"),we="ion-content ion-header:not(.header-collapse-condense-inactive) ion-title.title-large";if(null!=Ie){const Ue=Ie.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");return null!=Ue?Ue.querySelector(we):null}return se.querySelector(we)},ne=(se,Ie)=>{const we="ION-TABS"===se.tagName?se:se.querySelector("ion-tabs");let Ue=[];if(null!=we){const Ne=we.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");null!=Ne&&(Ue=Ne.querySelectorAll("ion-buttons"))}else Ue=se.querySelectorAll("ion-buttons");for(const Ne of Ue){const ke=Ne.closest("ion-header"),He=ke&&!ke.classList.contains("header-collapse-condense-inactive"),We=Ne.querySelector("ion-back-button"),Qe=Ne.classList.contains("buttons-collapse"),ve="start"===Ne.slot||""===Ne.slot;if(null!==We&&ve&&(Qe&&He&&Ie||!Qe))return We}return null},ge=(se,Ie,we,Ue,Ne,ke)=>{const He=Ie?`calc(100% - ${ke.right+4}px)`:ke.left-4+"px",We=Ie?"7px":"-7px",Qe=Ie?"-4px":"4px",ve=Ie?"-4px":"4px",me=Ie?"right":"left",Ze=Ie?"left":"right",tt=we?[{offset:0,opacity:1,transform:`translate3d(${Qe}, ${ke.top-46}px, 0) scale(1)`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${We}, ${Ne.top-40}px, 0) scale(2.1)`}]:[{offset:0,opacity:0,transform:`translate3d(${We}, ${Ne.top-40}px, 0) scale(2.1)`},{offset:1,opacity:1,transform:`translate3d(${Qe}, ${ke.top-46}px, 0) scale(1)`}],Be=we?[{offset:0,opacity:1,transform:`translate3d(${ve}, ${ke.top-46}px, 0) scale(1)`},{offset:.2,opacity:0,transform:`translate3d(${ve}, ${ke.top-41}px, 0) scale(0.6)`},{offset:1,opacity:0,transform:`translate3d(${ve}, ${ke.top-41}px, 0) scale(0.6)`}]:[{offset:0,opacity:0,transform:`translate3d(${ve}, ${ke.top-41}px, 0) scale(0.6)`},{offset:1,opacity:1,transform:`translate3d(${ve}, ${ke.top-46}px, 0) scale(1)`}],st=(0,d.c)(),_t=(0,d.c)(),Yt=ie("ion-back-button"),xn=re(Yt).querySelector(".button-text"),Ht=re(Yt).querySelector("ion-icon");Yt.text=Ue.text,Yt.mode=Ue.mode,Yt.icon=Ue.icon,Yt.color=Ue.color,Yt.disabled=Ue.disabled,Yt.style.setProperty("display","block"),Yt.style.setProperty("position","fixed"),_t.addElement(Ht),st.addElement(xn),st.beforeStyles({"transform-origin":`${me} center`}).beforeAddWrite(()=>{Ue.style.setProperty("display","none"),Yt.style.setProperty(me,He)}).afterAddWrite(()=>{Ue.style.setProperty("display",""),Yt.style.setProperty("display","none"),Yt.style.removeProperty(me)}).keyframes(tt),_t.beforeStyles({"transform-origin":`${Ze} center`}).keyframes(Be),se.addAnimation([st,_t])},X=(se,Ie,we,Ue,Ne,ke)=>{const He=Ie?`calc(100% - ${Ne.right}px)`:`${Ne.left}px`,We=Ie?"-18px":"18px",Qe=Ie?"right":"left",Ze=we?[{offset:0,opacity:0,transform:`translate3d(${We}, ${ke.top-4}px, 0) scale(0.49)`},{offset:.1,opacity:0},{offset:1,opacity:1,transform:`translate3d(0, ${Ne.top-2}px, 0) scale(1)`}]:[{offset:0,opacity:.99,transform:`translate3d(0, ${Ne.top-2}px, 0) scale(1)`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${We}, ${ke.top-4}px, 0) scale(0.5)`}],Pe=ie("ion-title"),Ge=(0,d.c)();Pe.innerText=Ue.innerText,Pe.size=Ue.size,Pe.color=Ue.color,Ge.addElement(Pe),Ge.beforeStyles({"transform-origin":`${Qe} center`,height:"46px",display:"",position:"relative",[Qe]:He}).beforeAddWrite(()=>{Ue.style.setProperty("display","none")}).afterAddWrite(()=>{Ue.style.setProperty("display",""),Pe.style.setProperty("display","none")}).keyframes(Ze),se.addAnimation(Ge)},ue=(se,Ie)=>{try{const we="cubic-bezier(0.32,0.72,0,1)",Ue="opacity",Ne="transform",ke="0%",We="rtl"===se.ownerDocument.dir,Qe=We?"-99.5%":"99.5%",ve=We?"33%":"-33%",me=Ie.enteringEl,Ze=Ie.leavingEl,Pe="back"===Ie.direction,Ge=me.querySelector(":scope > ion-content"),tt=me.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *"),ye=me.querySelectorAll(":scope > ion-header > ion-toolbar"),Ae=(0,d.c)(),Be=(0,d.c)();if(Ae.addElement(me).duration(Ie.duration||540).easing(Ie.easing||we).fill("both").beforeRemoveClass("ion-page-invisible"),Ze&&se){const xn=(0,d.c)();xn.addElement(se),Ae.addAnimation(xn)}if(Ge||0!==ye.length||0!==tt.length?(Be.addElement(Ge),Be.addElement(tt)):Be.addElement(me.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),Ae.addAnimation(Be),Pe?Be.beforeClearStyles([Ue]).fromTo("transform",`translateX(${ve})`,`translateX(${ke})`).fromTo(Ue,.8,1):Be.beforeClearStyles([Ue]).fromTo("transform",`translateX(${Qe})`,`translateX(${ke})`),Ge){const xn=re(Ge).querySelector(".transition-effect");if(xn){const Ht=xn.querySelector(".transition-cover"),Nt=xn.querySelector(".transition-shadow"),Bt=(0,d.c)(),Dt=(0,d.c)(),ht=(0,d.c)();Bt.addElement(xn).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),Dt.addElement(Ht).beforeClearStyles([Ue]).fromTo(Ue,0,.1),ht.addElement(Nt).beforeClearStyles([Ue]).fromTo(Ue,.03,.7),Bt.addAnimation([Dt,ht]),Be.addAnimation([Bt])}}const st=me.querySelector("ion-header.header-collapse-condense"),{forward:_t,backward:Yt}=((se,Ie,we,Ue,Ne)=>{const ke=ne(Ue,we),He=v(Ne),We=v(Ue),Qe=ne(Ne,we),ve=null!==ke&&null!==He&&!we,me=null!==We&&null!==Qe&&we;if(ve){const Ze=He.getBoundingClientRect(),Pe=ke.getBoundingClientRect();X(se,Ie,we,He,Ze,Pe),ge(se,Ie,we,ke,Ze,Pe)}else if(me){const Ze=We.getBoundingClientRect(),Pe=Qe.getBoundingClientRect();X(se,Ie,we,We,Ze,Pe),ge(se,Ie,we,Qe,Ze,Pe)}return{forward:ve,backward:me}})(Ae,We,Pe,me,Ze);if(ye.forEach(xn=>{const Ht=(0,d.c)();Ht.addElement(xn),Ae.addAnimation(Ht);const Nt=(0,d.c)();Nt.addElement(xn.querySelector("ion-title"));const Bt=(0,d.c)(),Dt=Array.from(xn.querySelectorAll("ion-buttons,[menuToggle]")),ht=xn.closest("ion-header"),Lt=null==ht?void 0:ht.classList.contains("header-collapse-condense-inactive");let _e;_e=Dt.filter(Pe?Tn=>{const mn=Tn.classList.contains("buttons-collapse");return mn&&!Lt||!mn}:Tn=>!Tn.classList.contains("buttons-collapse")),Bt.addElement(_e);const it=(0,d.c)();it.addElement(xn.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])"));const Ot=(0,d.c)();Ot.addElement(re(xn).querySelector(".toolbar-background"));const Qt=(0,d.c)(),_n=xn.querySelector("ion-back-button");if(_n&&Qt.addElement(_n),Ht.addAnimation([Nt,Bt,it,Ot,Qt]),Bt.fromTo(Ue,.01,1),it.fromTo(Ue,.01,1),Pe)Lt||Nt.fromTo("transform",`translateX(${ve})`,`translateX(${ke})`).fromTo(Ue,.01,1),it.fromTo("transform",`translateX(${ve})`,`translateX(${ke})`),Qt.fromTo(Ue,.01,1);else if(st||Nt.fromTo("transform",`translateX(${Qe})`,`translateX(${ke})`).fromTo(Ue,.01,1),it.fromTo("transform",`translateX(${Qe})`,`translateX(${ke})`),Ot.beforeClearStyles([Ue,"transform"]),(null==ht?void 0:ht.translucent)?Ot.fromTo("transform",We?"translateX(-100%)":"translateX(100%)","translateX(0px)"):Ot.fromTo(Ue,.01,"var(--opacity)"),_t||Qt.fromTo(Ue,.01,1),_n&&!_t){const mn=(0,d.c)();mn.addElement(re(_n).querySelector(".button-text")).fromTo("transform",We?"translateX(-100px)":"translateX(100px)","translateX(0px)"),Ht.addAnimation(mn)}}),Ze){const xn=(0,d.c)(),Ht=Ze.querySelector(":scope > ion-content"),Nt=Ze.querySelectorAll(":scope > ion-header > ion-toolbar"),Bt=Ze.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *");if(Ht||0!==Nt.length||0!==Bt.length?(xn.addElement(Ht),xn.addElement(Bt)):xn.addElement(Ze.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),Ae.addAnimation(xn),Pe){xn.beforeClearStyles([Ue]).fromTo("transform",`translateX(${ke})`,We?"translateX(-100%)":"translateX(100%)");const Dt=(0,m.g)(Ze);Ae.afterAddWrite(()=>{"normal"===Ae.getDirection()&&Dt.style.setProperty("display","none")})}else xn.fromTo("transform",`translateX(${ke})`,`translateX(${ve})`).fromTo(Ue,1,.8);if(Ht){const Dt=re(Ht).querySelector(".transition-effect");if(Dt){const ht=Dt.querySelector(".transition-cover"),Lt=Dt.querySelector(".transition-shadow"),_e=(0,d.c)(),it=(0,d.c)(),Ot=(0,d.c)();_e.addElement(Dt).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),it.addElement(ht).beforeClearStyles([Ue]).fromTo(Ue,.1,0),Ot.addElement(Lt).beforeClearStyles([Ue]).fromTo(Ue,.7,.03),_e.addAnimation([it,Ot]),xn.addAnimation([_e])}}Nt.forEach(Dt=>{const ht=(0,d.c)();ht.addElement(Dt);const Lt=(0,d.c)();Lt.addElement(Dt.querySelector("ion-title"));const _e=(0,d.c)(),it=Dt.querySelectorAll("ion-buttons,[menuToggle]"),Ot=Dt.closest("ion-header"),Qt=null==Ot?void 0:Ot.classList.contains("header-collapse-condense-inactive"),_n=Array.from(it).filter(yi=>{const Ui=yi.classList.contains("buttons-collapse");return Ui&&!Qt||!Ui});_e.addElement(_n);const Tn=(0,d.c)(),mn=Dt.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])");mn.length>0&&Tn.addElement(mn);const lt=(0,d.c)();lt.addElement(re(Dt).querySelector(".toolbar-background"));const qt=(0,d.c)(),En=Dt.querySelector("ion-back-button");if(En&&qt.addElement(En),ht.addAnimation([Lt,_e,Tn,qt,lt]),Ae.addAnimation(ht),qt.fromTo(Ue,.99,0),_e.fromTo(Ue,.99,0),Tn.fromTo(Ue,.99,0),Pe){if(Qt||Lt.fromTo("transform",`translateX(${ke})`,We?"translateX(-100%)":"translateX(100%)").fromTo(Ue,.99,0),Tn.fromTo("transform",`translateX(${ke})`,We?"translateX(-100%)":"translateX(100%)"),lt.beforeClearStyles([Ue,"transform"]),(null==Ot?void 0:Ot.translucent)?lt.fromTo("transform","translateX(0px)",We?"translateX(-100%)":"translateX(100%)"):lt.fromTo(Ue,"var(--opacity)",0),En&&!Yt){const Ui=(0,d.c)();Ui.addElement(re(En).querySelector(".button-text")).fromTo("transform",`translateX(${ke})`,`translateX(${(We?-124:124)+"px"})`),ht.addAnimation(Ui)}}else Qt||Lt.fromTo("transform",`translateX(${ke})`,`translateX(${ve})`).fromTo(Ue,.99,0).afterClearStyles([Ne,Ue]),Tn.fromTo("transform",`translateX(${ke})`,`translateX(${ve})`).afterClearStyles([Ne,Ue]),qt.afterClearStyles([Ue]),Lt.afterClearStyles([Ue]),_e.afterClearStyles([Ue])})}return Ae}catch(we){throw we}}},6447:(Ln,At,k)=>{"use strict";k.r(At),k.d(At,{mdTransitionAnimation:()=>l});var d=k(9442),m=k(4318);k(2361);const l=(ie,re)=>{const De="back"===re.direction,X=re.leavingEl,ue=(0,m.g)(re.enteringEl),se=ue.querySelector("ion-toolbar"),Ie=(0,d.c)();if(Ie.addElement(ue).fill("both").beforeRemoveClass("ion-page-invisible"),De?Ie.duration(re.duration||200).easing("cubic-bezier(0.47,0,0.745,0.715)"):Ie.duration(re.duration||280).easing("cubic-bezier(0.36,0.66,0.04,1)").fromTo("transform","translateY(40px)","translateY(0px)").fromTo("opacity",.01,1),se){const we=(0,d.c)();we.addElement(se),Ie.addAnimation(we)}if(X&&De){Ie.duration(re.duration||200).easing("cubic-bezier(0.47,0,0.745,0.715)");const we=(0,d.c)();we.addElement((0,m.g)(X)).onFinish(Ue=>{1===Ue&&we.elements.length>0&&we.elements[0].style.setProperty("display","none")}).fromTo("transform","translateY(0px)","translateY(40px)").fromTo("opacity",1,0),Ie.addAnimation(we)}return Ie}},599:(Ln,At,k)=>{"use strict";k.d(At,{B:()=>Dt,a:()=>ne,b:()=>De,c:()=>se,d:()=>ye,e:()=>we,f:()=>Be,g:()=>Yt,h:()=>re,i:()=>Ht,j:()=>He,k:()=>Ge,l:()=>ge,m:()=>X,s:()=>Bt,t:()=>Ie});var d=k(9671),m=k(6254),ce=k(7593),l=k(3756);let ie=0;const re=new WeakMap,v=ht=>({create:Lt=>Ue(ht,Lt),dismiss:(Lt,_e,it)=>Ze(document,Lt,_e,ht,it),getTop:()=>(0,d.Z)(function*(){return Ge(document,ht)})()}),ne=v("ion-alert"),De=v("ion-action-sheet"),ge=v("ion-loading"),X=v("ion-modal"),se=v("ion-popover"),Ie=v("ion-toast"),we=ht=>{typeof document<"u"&&me(document);const Lt=ie++;ht.overlayIndex=Lt,ht.hasAttribute("id")||(ht.id=`ion-overlay-${Lt}`)},Ue=(ht,Lt)=>typeof window<"u"&&typeof window.customElements<"u"?window.customElements.whenDefined(ht).then(()=>{const _e=document.createElement(ht);return _e.classList.add("overlay-hidden"),Object.assign(_e,Object.assign(Object.assign({},Lt),{hasController:!0})),st(document).appendChild(_e),new Promise(it=>(0,l.c)(_e,it))}):Promise.resolve(),Ne='[tabindex]:not([tabindex^="-"]), input:not([type=hidden]):not([tabindex^="-"]), textarea:not([tabindex^="-"]), button:not([tabindex^="-"]), select:not([tabindex^="-"]), .ion-focusable:not([tabindex^="-"])',ke="input:not([type=hidden]), textarea, button, select",He=(ht,Lt)=>{let _e=ht.querySelector(Ne);const it=null==_e?void 0:_e.shadowRoot;it&&(_e=it.querySelector(ke)||_e),_e?(0,l.f)(_e):Lt.focus()},Qe=(ht,Lt)=>{const _e=Array.from(ht.querySelectorAll(Ne));let it=_e.length>0?_e[_e.length-1]:null;const Ot=null==it?void 0:it.shadowRoot;Ot&&(it=Ot.querySelector(ke)||it),it?it.focus():Lt.focus()},me=ht=>{0===ie&&(ie=1,ht.addEventListener("focus",Lt=>{((ht,Lt)=>{const _e=Ge(Lt,"ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker,ion-popover"),it=ht.target;_e&&it&&!_e.classList.contains("ion-disable-focus-trap")&&(_e.shadowRoot?(()=>{if(_e.contains(it))_e.lastFocus=it;else{const _n=_e.lastFocus;He(_e,_e),_n===Lt.activeElement&&Qe(_e,_e),_e.lastFocus=Lt.activeElement}})():(()=>{if(_e===it)_e.lastFocus=void 0;else{const _n=(0,l.g)(_e);if(!_n.contains(it))return;const Tn=_n.querySelector(".ion-overlay-wrapper");if(!Tn)return;if(Tn.contains(it))_e.lastFocus=it;else{const mn=_e.lastFocus;He(Tn,_e),mn===Lt.activeElement&&Qe(Tn,_e),_e.lastFocus=Lt.activeElement}}})())})(Lt,ht)},!0),ht.addEventListener("ionBackButton",Lt=>{const _e=Ge(ht);(null==_e?void 0:_e.backdropDismiss)&&Lt.detail.register(ce.OVERLAY_BACK_BUTTON_PRIORITY,()=>_e.dismiss(void 0,Dt))}),ht.addEventListener("keyup",Lt=>{if("Escape"===Lt.key){const _e=Ge(ht);(null==_e?void 0:_e.backdropDismiss)&&_e.dismiss(void 0,Dt)}}))},Ze=(ht,Lt,_e,it,Ot)=>{const Qt=Ge(ht,it,Ot);return Qt?Qt.dismiss(Lt,_e):Promise.reject("overlay does not exist")},Ge=(ht,Lt,_e)=>{const it=((ht,Lt)=>(void 0===Lt&&(Lt="ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker,ion-popover,ion-toast"),Array.from(ht.querySelectorAll(Lt)).filter(_e=>_e.overlayIndex>0)))(ht,Lt).filter(Ot=>!(ht=>ht.classList.contains("overlay-hidden"))(Ot));return void 0===_e?it[it.length-1]:it.find(Ot=>Ot.id===_e)},tt=(ht=!1)=>{const _e=st(document).querySelector("ion-router-outlet, ion-nav, #ion-view-container-root");!_e||(ht?_e.setAttribute("aria-hidden","true"):_e.removeAttribute("aria-hidden"))},ye=function(){var ht=(0,d.Z)(function*(Lt,_e,it,Ot,Qt){var _n,Tn;if(Lt.presented)return;tt(!0),Lt.presented=!0,Lt.willPresent.emit(),null===(_n=Lt.willPresentShorthand)||void 0===_n||_n.emit();const mn=(0,m.b)(Lt),lt=Lt.enterAnimation?Lt.enterAnimation:m.c.get(_e,"ios"===mn?it:Ot);(yield _t(Lt,lt,Lt.el,Qt))&&(Lt.didPresent.emit(),null===(Tn=Lt.didPresentShorthand)||void 0===Tn||Tn.emit()),"ION-TOAST"!==Lt.el.tagName&&Ae(Lt.el),Lt.keyboardClose&&Lt.el.focus()});return function(_e,it,Ot,Qt,_n){return ht.apply(this,arguments)}}(),Ae=function(){var ht=(0,d.Z)(function*(Lt){let _e=document.activeElement;if(!_e)return;const it=null==_e?void 0:_e.shadowRoot;it&&(_e=it.querySelector(ke)||_e),yield Lt.onDidDismiss(),_e.focus()});return function(_e){return ht.apply(this,arguments)}}(),Be=function(){var ht=(0,d.Z)(function*(Lt,_e,it,Ot,Qt,_n,Tn){var mn,lt;if(!Lt.presented)return!1;tt(!1),Lt.presented=!1;try{Lt.el.style.setProperty("pointer-events","none"),Lt.willDismiss.emit({data:_e,role:it}),null===(mn=Lt.willDismissShorthand)||void 0===mn||mn.emit({data:_e,role:it});const qt=(0,m.b)(Lt),En=Lt.leaveAnimation?Lt.leaveAnimation:m.c.get(Ot,"ios"===qt?Qt:_n);"gesture"!==it&&(yield _t(Lt,En,Lt.el,Tn)),Lt.didDismiss.emit({data:_e,role:it}),null===(lt=Lt.didDismissShorthand)||void 0===lt||lt.emit({data:_e,role:it}),re.delete(Lt),Lt.el.classList.add("overlay-hidden"),Lt.el.style.removeProperty("pointer-events")}catch(qt){console.error(qt)}return Lt.el.remove(),!0});return function(_e,it,Ot,Qt,_n,Tn,mn){return ht.apply(this,arguments)}}(),st=ht=>ht.querySelector("ion-app")||ht.body,_t=function(){var ht=(0,d.Z)(function*(Lt,_e,it,Ot){it.classList.remove("overlay-hidden");const _n=_e(Lt.el,Ot);(!Lt.animated||!m.c.getBoolean("animated",!0))&&_n.duration(0),Lt.keyboardClose&&_n.beforeAddWrite(()=>{const mn=it.ownerDocument.activeElement;(null==mn?void 0:mn.matches("input,ion-input, ion-textarea"))&&mn.blur()});const Tn=re.get(Lt)||[];return re.set(Lt,[...Tn,_n]),yield _n.play(),!0});return function(_e,it,Ot,Qt){return ht.apply(this,arguments)}}(),Yt=(ht,Lt)=>{let _e;const it=new Promise(Ot=>_e=Ot);return xn(ht,Lt,Ot=>{_e(Ot.detail)}),it},xn=(ht,Lt,_e)=>{const it=Ot=>{(0,l.b)(ht,Lt,it),_e(Ot)};(0,l.a)(ht,Lt,it)},Ht=ht=>"cancel"===ht||ht===Dt,Nt=ht=>ht(),Bt=(ht,Lt)=>{if("function"==typeof ht)return m.c.get("_zoneGate",Nt)(()=>{try{return ht(Lt)}catch(it){throw it}})},Dt="backdrop"},1099:(Ln,At,k)=>{"use strict";k.d(At,{B:()=>ue});var d=k(8274),m=k(6579),ce=k(9634),l=k(6895);function ie(se,Ie){if(1&se&&(d.TgZ(0,"ion-badge",7),d._uU(1),d.qZA()),2&se){const we=d.oxw().$implicit;d.xp6(1),d.hij("",we.Quantity," x")}}function re(se,Ie){if(1&se&&(d.TgZ(0,"strong"),d._uU(1),d.qZA()),2&se){const we=d.oxw().$implicit;d.xp6(1),d.hij("",we.PowerKW," kW ")}}function v(se,Ie){if(1&se&&(d.TgZ(0,"div"),d._uU(1),d.qZA()),2&se){const we=d.oxw().$implicit;d.xp6(1),d.hij("",null==we.CurrentType?null:we.CurrentType.Title," ")}}function ne(se,Ie){if(1&se&&(d.TgZ(0,"span"),d._uU(1),d.qZA()),2&se){const we=d.oxw().$implicit;d.xp6(1),d.hij("",we.Amps,"A ")}}function De(se,Ie){if(1&se&&(d.TgZ(0,"span"),d._uU(1),d.qZA()),2&se){const we=d.oxw().$implicit;d.xp6(1),d.hij("",we.Voltage,"V ")}}function ge(se,Ie){if(1&se){const we=d.EpF();d.TgZ(0,"ion-col")(1,"ion-button",8),d.NdJ("click",function(){d.CHM(we);const Ne=d.oxw().$implicit;return d.oxw().editConnection(Ne)}),d._UZ(2,"ion-icon",9),d.qZA(),d._UZ(3,"br"),d.TgZ(4,"ion-button",10),d.NdJ("click",function(){d.CHM(we);const Ne=d.oxw().$implicit;return d.oxw().deleteConnection(Ne)}),d._UZ(5,"ion-icon",11),d.qZA()()}}function X(se,Ie){if(1&se&&(d.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-row")(3,"ion-col",1),d._UZ(4,"img",2),d.YNc(5,ie,2,1,"ion-badge",3),d.TgZ(6,"div",4),d._uU(7),d.qZA()(),d.TgZ(8,"ion-col")(9,"ion-row")(10,"ion-col")(11,"ion-note")(12,"div")(13,"strong",5),d._uU(14),d.qZA()(),d.YNc(15,re,2,1,"strong",6),d.YNc(16,v,2,1,"div",6),d.qZA(),d.TgZ(17,"ion-note"),d.YNc(18,ne,2,1,"span",6),d.YNc(19,De,2,1,"span",6),d.qZA()()(),d.TgZ(20,"ion-row")(21,"ion-col",4),d._uU(22),d.qZA(),d.TgZ(23,"ion-col",4),d._uU(24),d.qZA()()(),d.YNc(25,ge,6,0,"ion-col",6),d.qZA()()()),2&se){const we=Ie.$implicit,Ue=d.oxw();d.xp6(4),d.Q6J("src",Ue.getConnectorTypeIcon(we.ConnectionTypeID),d.LSH),d.xp6(1),d.Q6J("ngIf",we.Quantity),d.xp6(2),d.Oqu(null==we.StatusType?null:we.StatusType.Title),d.xp6(6),d.s9C("title",null==we.ConnectionType?null:we.ConnectionType.FormalName),d.xp6(1),d.hij("",null==we.ConnectionType?null:we.ConnectionType.Title," "),d.xp6(1),d.Q6J("ngIf",we.PowerKW),d.xp6(1),d.Q6J("ngIf",we.CurrentTypeID),d.xp6(2),d.Q6J("ngIf",we.Amps),d.xp6(1),d.Q6J("ngIf",we.Voltage),d.xp6(3),d.Oqu(we.Reference),d.xp6(2),d.Oqu(we.Comments),d.xp6(1),d.Q6J("ngIf",Ue.enableEdit)}}let ue=(()=>{class se{constructor(){this.enableEdit=!1,this.onEdit=new d.vpe,this.onDelete=new d.vpe}ngOnInit(){}editConnection(we){this.onEdit.emit(we)}deleteConnection(we){this.onDelete.emit(we)}getConnectorTypeIcon(we){return m.c.getIconForConnector(we)}}return se.\u0275fac=function(we){return new(we||se)},se.\u0275cmp=d.Xpm({type:se,selectors:[["app-equipment-details"]],inputs:{item:"item",enableEdit:"enableEdit"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],["size","3"],[2,"max-width","64px",3,"src"],["color","primary",4,"ngIf"],[1,"info"],[3,"title"],[4,"ngIf"],["color","primary"],["size","small","color","secondary",3,"click"],["name","create","slot","icon-only"],["size","small","color","danger",3,"click"],["name","trash","slot","icon-only"]],template:function(we,Ue){1&we&&(d.TgZ(0,"ion-grid"),d.YNc(1,X,26,12,"ion-row",0),d.qZA()),2&we&&(d.xp6(1),d.Q6J("ngForOf",Ue.item.Connections))},directives:[ce.jY,l.sg,ce.Nd,ce.wI,l.O5,ce.yp,ce.uN,ce.YG,ce.gu],styles:[""]}),se})()},2428:(Ln,At,k)=>{"use strict";k.d(At,{v:()=>ue});var d=k(9671),m=k(7689),ce=k(8274),l=k(553),ie=k(9634),re=k(529),v=k(6260),ne=k(6895);function De(se,Ie){1&se&&(ce.TgZ(0,"div"),ce._UZ(1,"ion-spinner"),ce.qZA())}function ge(se,Ie){if(1&se){const we=ce.EpF();ce.TgZ(0,"ion-item",5),ce.NdJ("click",function(){const ke=ce.CHM(we).$implicit;return ce.oxw(2).placeSelected(ke)}),ce.TgZ(1,"ion-avatar",6),ce._UZ(2,"ion-icon",7),ce.qZA(),ce.TgZ(3,"ion-label")(4,"p"),ce._uU(5),ce.qZA()()()}if(2&se){const we=Ie.$implicit;ce.xp6(5),ce.Oqu(we.Address)}}function X(se,Ie){if(1&se&&(ce.TgZ(0,"div",1),ce.YNc(1,De,2,0,"div",2),ce.TgZ(2,"ion-list"),ce.YNc(3,ge,6,1,"ion-item",3),ce.TgZ(4,"ion-item")(5,"p",4),ce._uU(6),ce.qZA()()()()),2&se){const we=ce.oxw();ce.xp6(1),ce.Q6J("ngIf",we.searchInProgress),ce.xp6(2),ce.Q6J("ngForOf",we.placeList),ce.xp6(3),ce.hij(" ",we.placeAttribution," ")}}let ue=(()=>{class se{constructor(we,Ue,Ne,ke,He){this.logging=we,this.changeDetector=Ue,this.platform=Ne,this.http=ke,this.events=He,this.searchInProgress=!1,this.placeSearchActive=!1,this.placeAttribution="",this.placeChanged=new ce.vpe,this.searchKeyword="",this.searchInProgress=!1,this.mapService=new l.k(He,we,ke)}ngOnInit(){var we=this;return(0,d.Z)(function*(){yield we.platform.ready(),we.mapService.initAPI()})()}onSearchFocus(){this.placeSearchFocused=!0}onSearchBlur(){this.placeSearchFocused=!1}onSearchCancel(){}getPlacesAutoComplete(we,Ue){var Ne=this;return(0,d.Z)(function*(){Ne.placeSearchType=Ue;let ke=we.target.value;if(ke&&ke.length>3){Ne.logging.log("Starting place lookup for:"+ke),Ne.placeSearchActive=!0,Ne.searchInProgress=!0,Ne.searchInProgress=!1,Ne.placeSearchActive=!0;try{Ne.placeList=yield Ne.mapService.placeSearch(ke),Ne.placeList&&Ne.placeList.length>0&&(Ne.placeAttribution=Ne.placeList[0].Attribution)}catch{}Ne.searchInProgress=!1,Ne.placeSearchActive=!0}else Ne.searchInProgress=!1,Ne.placeSearchActive=!1})()}placeSelected(we){this.logging.log("Looking up place details:"+we.Title+"::"+we.ReferenceID),this.selectedPlace=we,this.placeChanged.emit(we),this.placeSearchActive=!1}}return se.\u0275fac=function(we){return new(we||se)(ce.Y36(m.z),ce.Y36(ce.sBO),ce.Y36(ie.t4),ce.Y36(re.eN),ce.Y36(v.z))},se.\u0275cmp=ce.Xpm({type:se,selectors:[["place-search"]],inputs:{searchKeyword:"searchKeyword"},outputs:{selectedPlace:"selectedPlace",placeChanged:"placeChanged"},decls:1,vars:1,consts:[["class","place-search",4,"ngIf"],[1,"place-search"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],[1,"place-attribution"],[3,"click"],["item-left",""],["name","locate"]],template:function(we,Ue){1&we&&ce.YNc(0,X,7,3,"div",0),2&we&&ce.Q6J("ngIf",Ue.placeSearchActive)},directives:[ne.O5,ie.PQ,ie.q_,ne.sg,ie.Ie,ie.BJ,ie.gu,ie.Q$],styles:[".place-search[_ngcontent-%COMP%]{position:absolute;z-index:1000}.place-attribution[_ngcontent-%COMP%]{font-size:9px;color:#dcdcdc;max-width:100%}"]}),se})()},6585:(Ln,At,k)=>{"use strict";k.d(At,{o:()=>ne});var d=k(8274),m=k(6579),ce=k(9634),l=k(6895);function ie(De,ge){if(1&De){const X=d.EpF();d.TgZ(0,"ion-button",5),d.NdJ("click",function(){d.CHM(X);const se=d.oxw().$implicit;return d.oxw().onCopyCommand(se)}),d._uU(1,"Copy"),d.qZA()}}function re(De,ge){if(1&De){const X=d.EpF();d.TgZ(0,"ion-button",5),d.NdJ("click",function(){d.CHM(X);const se=d.oxw().$implicit;return d.oxw().onEditCommand(se)}),d._uU(1,"Edit"),d.qZA()}}function v(De,ge){if(1&De&&(d.TgZ(0,"ion-item",1)(1,"ion-grid")(2,"ion-row")(3,"ion-col"),d._uU(4),d.qZA()(),d.TgZ(5,"ion-row")(6,"ion-col",2)(7,"p"),d._UZ(8,"img",3),d.qZA(),d.TgZ(9,"ion-note"),d._uU(10),d.qZA(),d.YNc(11,ie,2,0,"ion-button",4),d.YNc(12,re,2,0,"ion-button",4),d.qZA(),d.TgZ(13,"ion-col")(14,"ion-row")(15,"ion-col")(16,"p"),d._uU(17),d.qZA(),d.TgZ(18,"ion-note"),d._uU(19),d.qZA()()(),d.TgZ(20,"ion-row")(21,"ion-col"),d._uU(22),d.qZA(),d.TgZ(23,"ion-col"),d._uU(24),d.qZA()()()()()()),2&De){const X=ge.$implicit,ue=d.oxw();d.xp6(4),d.hij(" ",X.AddressInfo.Title," "),d.xp6(4),d.Q6J("src",ue.getIconForPOI(X),d.LSH),d.xp6(2),d.hij(" ",ue.getFormattedDistance(X)," "),d.xp6(1),d.Q6J("ngIf",ue.enableCopyOption),d.xp6(1),d.Q6J("ngIf",ue.enableEditOption),d.xp6(5),d.hij(" ",ue.getFormattedAddress(X)," "),d.xp6(2),d.hij(" ",ue.getFormattedConnectorList(X)," "),d.xp6(3),d.hij(" ",null==X.UsageType?null:X.UsageType.Title," "),d.xp6(2),d.hij(" ",null==X.OperatorInfo?null:X.OperatorInfo.Title," ")}}let ne=(()=>{class De{constructor(){this.enableCopyOption=!1,this.enableEditOption=!1,this.poiList=[],this.onCopy=new d.vpe,this.onEdit=new d.vpe}ngOnInit(){}onCopyCommand(X){this.onCopy.emit(X)}onEditCommand(X){this.onEdit.emit(X)}getFormattedAddress(X){let ue="";return ue+=X.AddressInfo.Title!=X.AddressInfo.AddressLine1?X.AddressInfo.Title:X.AddressInfo.Town,ue}getFormattedConnectorList(X){if(!X.Connections)return;let ue=[];for(let se of X.Connections)null!=se.ConnectionType&&(ue.find(Ie=>Ie==se.ConnectionType.Title)||ue.push(se.ConnectionType.Title));return ue.join(", ")}getIconForPOI(X){return m.c.getIconForPOI(X)}getFormattedDistance(X){return m.c.getFormattedDistance(X)}}return De.\u0275fac=function(X){return new(X||De)},De.\u0275cmp=d.Xpm({type:De,selectors:[["app-poi-list"]],inputs:{enableCopyOption:"enableCopyOption",enableEditOption:"enableEditOption",poiList:"poiList"},outputs:{onCopy:"onCopy",onEdit:"onEdit"},decls:2,vars:1,consts:[["style","max-width:400px;",4,"ngFor","ngForOf"],[2,"max-width","400px"],["size","3"],[2,"width","24px",3,"src"],["size","small",3,"click",4,"ngIf"],["size","small",3,"click"]],template:function(X,ue){1&X&&(d.TgZ(0,"ion-list"),d.YNc(1,v,25,9,"ion-item",0),d.qZA()),2&X&&(d.xp6(1),d.Q6J("ngForOf",ue.poiList))},directives:[ce.q_,l.sg,ce.Ie,ce.jY,ce.Nd,ce.wI,ce.uN,l.O5,ce.YG],styles:[""]}),De})()},8936:(Ln,At,k)=>{"use strict";k.d(At,{e:()=>re});var d=k(6895),m=k(9634),ce=k(4006),l=k(4463),ie=k(8274);let re=(()=>{class v{}return v.\u0275fac=function(De){return new(De||v)},v.\u0275mod=ie.oAB({type:v}),v.\u0275inj=ie.cJS({providers:[d.JJ],imports:[[d.ez,m.Pc,ce.u5,l.aw]]}),v})()},2951:(Ln,At,k)=>{"use strict";k.d(At,{X:()=>m});var d=k(2340);class m{constructor(){this.baseURL="https://map.openchargemap.io",this.loginProviderRedirectBaseURL="https://openchargemap.org/site/loginprovider/?_mode=silent&_forceLogin=true&_redirectURL=",this.loginProviderRedirectURL=this.loginProviderRedirectBaseURL+this.baseURL,this.enableLiveMapQuerying=!0,this.googleMapsAPIKey=d.N.googleMapsKey,this.enableStaticMaps=d.N.enableStaticMaps}}},6579:(Ln,At,k)=>{"use strict";k.d(At,{c:()=>m});var d=k(2340);let m=(()=>{class ce{static isFeatureEnabled(ie){return!!d.N.enabledFeatures.find(re=>re===ie)}static getClientHeight(){const ie=document.body,re=document.documentElement;return Math.max(ie.scrollHeight,ie.offsetHeight,re.clientHeight,re.scrollHeight,re.offsetHeight)}static getClientWidth(){const ie=document.body,re=document.documentElement;return Math.max(ie.scrollWidth,ie.offsetWidth,re.clientWidth,re.scrollWidth,re.offsetWidth)}static getMaxLevelOfPOI(ie){let re=0;if(null!=ie.Connections)for(let v=0;v<ie.Connections.length;v++)null!=ie.Connections[v].Level&&ie.Connections[v].Level.ID>re&&(re=ie.Connections[v].Level.ID);return 4===re&&(re=2),re>4&&(re=3),re}static getIconForPOI(ie){let v="assets/images/icons/map/level"+ce.getMaxLevelOfPOI(ie);return null!=ie.UsageType&&ie.UsageType.Title.indexOf("Private")>-1?v+="_private":v+=null!=ie.StatusType&&!0!==ie.StatusType.IsOperational?"_nonoperational":"_operational",v+="_icon.png",v}static getColorForPOI(ie){const re=ce.getMaxLevelOfPOI(ie);let v="#c0c0c0";return null!=ie.UsageType&&ie.UsageType.Title.indexOf("Private")>-1?v="#FF0000":null!=ie.StatusType&&!0!==ie.StatusType.IsOperational?v="#a0a0a0":2==re?v="#72EB0D":3==re&&(v="#EB800D"),v}static getIconForConnector(ie){let re="assets/images/icons/connectors/";return re+=1===ie?"Type1_J1772.svg":2===ie?"Chademo_type4.svg":25===ie?"Type2_socket.svg":32===ie?"Type1_CCS.svg":33===ie?"Type2_CCS.svg":1036===ie?"Type2_tethered.svg":28===ie?"schuko.svg":"Unknown.svg",re}static getFormattedDistance(ie){return ie&&ie.AddressInfo&&ie.AddressInfo.Distance?ie.AddressInfo.Distance.toFixed(1)+" "+(1===ie.AddressInfo.DistanceUnit?"km":"miles"):""}static fixJSONDate(ie){if(null==ie)return null;if(0==ie.indexOf("/")){let v=/Date\(([^)]+)\)/.exec(ie);ie=new Date(parseFloat(v[1]))}else ie=new Date(ie);return ie}static formatMapLinkFromPosition(ie,re,v,ne,De){return'<a href="https://maps.google.com/maps?saddr='+re+","+v+"&daddr="+ie.AddressInfo.Latitude+","+ie.AddressInfo.Longitude+'">Map ('+Math.ceil(ne)+" "+De+")</a>"}static formatSystemWebLink(ie,re){return"<a href='#' onclick=\"window.open('"+ie+"', '_system');return false;\">"+re+"</a>"}static formatMapLink(ie,re,v){return v?device&&"WinCE"==device.platform?this.formatSystemWebLink("maps:"+ie.AddressInfo.Latitude+","+ie.AddressInfo.Longitude,re):device&&"iOS"===device.platform?this.formatSystemWebLink("https://maps.apple.com/?q="+ie.AddressInfo.Latitude+","+ie.AddressInfo.Longitude,re):this.formatSystemWebLink("https://maps.google.com/maps?q="+ie.AddressInfo.Latitude+","+ie.AddressInfo.Longitude,re):'<a target="_blank"  href="https://maps.google.com/maps?q='+ie.AddressInfo.Latitude+","+ie.AddressInfo.Longitude+'">'+re+"</a>"}static formatURL(ie,re=null){return null==ie||""==ie?"":(-1==ie.indexOf("http")&&(ie="https://"+ie),'<a target="_blank" href="'+ie+'">'+(re??ie)+"</a>")}static formatString(ie){return null==ie?"":ie.toString()}static formatTextField(ie,re=null,v=!1,ne=!1,De=null){if(null==ie||""==ie||null==ie)return"";let ge=(null!=re?"<strong class='ocm-label' "+(null!=De?"data-localize='"+De+"' ":"")+">"+re+"</strong>: ":"")+(v?"<br/>":"")+ie.toString().replace("\n","<br/>")+"<br/>";return 1==ne&&(ge="<p>"+ge+"</p>"),ge}static formatEmailAddress(ie){return null!=ie&&null!=ie&&""!=ie?"<i class='fa fa-envelope fa-fw'></i> <a href=\"mailto:"+ie+'">'+ie+"</a><br/>":""}static formatPhone(ie,re=null){return null!=ie&&null!=ie&&""!=ie?(null==re?re="<i class='fa fa-phone fa-fw '></i> ":re+=": ",re+'<a href="tel:'+ie+'">'+ie+"</a><br/>"):""}static formatPOIDetails(ie,re){let ne=new Date;null==re&&(re=!1);let De=this.formatPOIAddress(ie,!1),ge="";ge+=this.formatPhone(ie.AddressInfo.ContactTelephone1),ge+=this.formatPhone(ie.AddressInfo.ContactTelephone2),ge+=this.formatEmailAddress(ie.AddressInfo.ContactEmail);let X="";if(null!=ie.AddressInfo.Distance){let Ne="https://maps.google.com/maps?saddr=&daddr="+ie.AddressInfo.Latitude+","+ie.AddressInfo.Longitude;X+="<strong id='addr_distance'><span data-localize='details.approxDistance'>Distance</span>: "+ie.AddressInfo.Distance.toFixed(1)+" "+(2==ie.AddressInfo.DistanceUnit?"Miles":"KM")+"</strong>",X+="<p>"+this.formatSystemWebLink(Ne,"Get Directions")+"</p>"}if(null!=ie.AddressInfo.RelatedURL&&""!=ie.AddressInfo.RelatedURL){let Ne=ie.AddressInfo.RelatedURL;Ne=Ne.replace(/.*?:\/\//g,""),Ne.length>40&&(Ne=Ne.substr(0,40)+".."),ge+="<i class='fa fa-fw fa-external-link'></i>  "+this.formatSystemWebLink(ie.AddressInfo.RelatedURL,"<span data-localize='details.addressRelatedURL'>"+Ne+"</span>")}ge+="</p>";const ue=this.formatTextField(ie.GeneralComments,null,!1,!0)+this.formatTextField(ie.AddressInfo.AccessComments,"Access",!0,!0,"details.accessComments");let se="";null!=ie.NumberOfPoints&&(se+=this.formatTextField(ie.NumberOfPoints,"Bays",!1,!0,"details.numberOfPoints")),null!=ie.UsageType&&(se+=this.formatTextField(ie.UsageType.Title,"Usage",!1,!0,"details.usageType")),null!=ie.UsageCost&&(se+=this.formatTextField(ie.UsageCost,"Usage Cost",!1,!0,"details.usageCost")),null!=ie.OperatorInfo&&1!=ie.OperatorInfo.ID&&(se+=this.formatTextField(ie.OperatorInfo.Title,"Operator",!1,!0,"details.operatorTitle"),null!=ie.OperatorInfo.WebsiteURL&&(se+=this.formatTextField(this.formatURL(ie.OperatorInfo.WebsiteURL),"Operator Website",!0,!0,"details.operatorWebsite")));let Ie="";if(null!=ie.StatusType&&(Ie+=this.formatTextField(ie.StatusType.Title,"Status",!1,!0,"details.operationalStatus"),null!=ie.DateLastStatusUpdate&&(Ie+=this.formatTextField(Math.round((ne-this.fixJSONDate(ie.DateLastStatusUpdate))/864e5)+" days ago","Last Updated",!1,!0,"details.lastUpdated"))),null!=ie.Connections&&ie.Connections.length>0){Ie+="<table class='table table-striped'>",Ie+="<tr><th data-localize='details.equipment.connectionType'>Connection</th><th data-localize='details.equipment.powerLevel'>Power Level</th><th data-localize='details.operationalStatus'>Status</th></tr>";for(let Ne=0;Ne<ie.Connections.length;Ne++){let ke=ie.Connections[Ne];""==ke.Amps&&(ke.Amps=null),""==ke.Voltage&&(ke.Voltage=null),""==ke.Quantity&&(ke.Quantity=null),""==ke.PowerKW&&(ke.PowerKW=null),Ie+="<tr><td>"+(null!=ke.ConnectionType?ke.ConnectionType.Title:"")+"</td><td>"+(null!=ke.Level?"<strong>"+ke.Level.Title+"</strong><br/>":"")+(null!=ke.Amps?this.formatString(ke.Amps)+"A/ ":"")+(null!=ke.Voltage?this.formatString(ke.Voltage)+"V/ ":"")+(null!=ke.PowerKW?this.formatString(ke.PowerKW)+"kW <br/>":"")+(null!=ke.CurrentType?ke.CurrentType.Title:"")+"<br/>"+(null!=ke.Quantity?this.formatString(ke.Quantity):"1")+" Present</td><td>"+(null!=ke.StatusType?ke.StatusType.Title:"-")+"</td></tr>"}Ie+="</table>"}let we="";return we+=this.formatTextField("<a target='_blank' href='https://openchargemap.org/site/poi/details/"+ie.ID+"'>OCM-"+ie.ID+"</a>","OpenChargeMap Ref",!1,!0,"details.refNumber"),null!=ie.DataProvider&&(we+=this.formatTextField(ie.DataProvider.Title,"Data Provider",!1,!0,"details.dataProviderTitle"),null!=ie.DataProvider.WebsiteURL&&(we+=this.formatTextField(this.formatURL(ie.DataProvider.WebsiteURL),"Website",!1,!0,"details.dataProviderWebsite")),we+=this.formatTextField(ie.AddressInfo.Latitude,"Latitude",!1,!0,null),we+=this.formatTextField(ie.AddressInfo.Longitude,"Longitude",!1,!0,null)),{address:De,drivingInfo:X,contactInfo:ge,additionalInfo:ue+se+Ie,advancedInfo:we}}static debounce(ie,re,v){let ne;return function(){let De=this,ge=arguments,X=function(){ne=null,v||ie.apply(De,ge)},ue=v&&!ne;clearTimeout(ne),ne=setTimeout(X,re),ue&&ie.apply(De,ge)}}static getRandomInt(ie){return Math.floor(Math.random()*Math.floor(ie))}}return ce.formatPOIAddress=function(l,ie=!0){let re="";return re=ie?""+this.formatTextField(l.AddressInfo.AddressLine1)+this.formatTextField(l.AddressInfo.AddressLine2)+this.formatTextField(l.AddressInfo.Town)+this.formatTextField(l.AddressInfo.StateOrProvince)+this.formatTextField(l.AddressInfo.Postcode)+(null!=l.AddressInfo.Country?this.formatTextField(l.AddressInfo.Country.Title):""):this.formatStringArray([l.AddressInfo.AddressLine1,l.AddressInfo.AddressLine2,l.AddressInfo.Town,l.AddressInfo.StateOrProvince,l.AddressInfo.Postcode,null!=l.AddressInfo.Country?l.AddressInfo.Country.Title:""]),re},ce.formatStringArray=function(l,ie=", "){if(null==l)return"";let re="";for(let v=0;v<l.length;v++)null!=l[v]&&""!=l[v].trim()&&(re+=v==l.length-1?l[v]:l[v]+ie);return re},ce})()},4120:(Ln,At,k)=>{"use strict";k.d(At,{LL:()=>ce,jR:()=>m,wC:()=>d});class d{constructor(ie=null,re=null){this.latitude=ie,this.longitude=re}}class m{constructor(ie=null,re=null){this.coords=new d,this.coords.latitude=ie,this.coords.longitude=re}static fromPosition(ie){return new m(ie.coords.latitude,ie.coords.longitude)}}class ce{constructor(ie,re){this.northEast=ie,this.southWest=re}}},129:(Ln,At,k)=>{"use strict";k.d(At,{Qp:()=>ce,fw:()=>re,JJ:()=>ne,eN:()=>v,vw:()=>ie,kA:()=>l});class d{constructor(ge,X){this.itemType=ge,this.itemId=d.getNewItemId(),this.version=1,this.schemaVersion=X,this.syncTimeStamp=d.getNewSyncTimeStamp()}static getNewSyncTimeStamp(){return Date.now().toString()}static getNewItemId(){return"_syncitem_"+Date.now().toString()}}class m{constructor(ge,X){this._sync=new d(ge,X)}}class ce extends m{}class l extends m{constructor(){super("waypoint",1)}}class ie extends m{constructor(){super("journey_stage",1),this.WayPoints=[]}}class re extends m{constructor(){super("journey",1),this.ID=""+Date.now(),this.Stages=[]}}class v{}class ne{}},8016:(Ln,At,k)=>{"use strict";k.d(At,{b:()=>d});class d{constructor(){this.poiIdList=null,this.countryCode=null,this.latitude=null,this.longitude=null,this.locationTitle=null,this.distance=null,this.distanceUnit=null,this.connectionTypeIdList=null,this.operatorIdList=null,this.levelIdList=null,this.countryIdList=null,this.usageTypeIdList=null,this.statusTypeIdList=null,this.minPowerKW=null,this.maxPowerKW=null,this.submissionStatusTypeIdList=null,this.maxResults=500,this.additionalParams=null,this.includeComments=!1,this.compact=!0,this.enableCaching=!0,this.levelOfDetail=1,this.polyline=null,this.boundingbox=null}}},4209:(Ln,At,k)=>{"use strict";k.d(At,{n:()=>d});class d{}},7627:(Ln,At,k)=>{"use strict";k.d(At,{N:()=>m,U:()=>d});const d=650;class m{constructor(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MaxPowerKW=null,this.MinPowerKW=null,this.HasActiveFilters=!1,this.FilterOptionsByCountryId=null,this.UseDistanceInKM=!0,this.MapType="ROADMAP",this.EnableAdvancedEditorFeatures=!1}LoadSettings(){}SaveSettings(){}ClearActiveFilters(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MinPowerKW=null,this.MaxPowerKW=null}CheckForActiveFilters(){return this.HasActiveFilters=this.OperatorList.length>0||this.ConnectionTypeList.length>0||this.CountryList.length>0||this.UsageTypeList.length>0||this.StatusTypeList.length>0||this.MinPowerKW>0||this.MaxPowerKW>0||null!=this.MaxPowerKW&&this.MaxPowerKW<d,this.HasActiveFilters}}},8649:(Ln,At,k)=>{"use strict";k.d(At,{q:()=>d});var d=(()=>{return(m=d||(d={}))[m.POI=0]="POI",m[m.Comment=1]="Comment",m[m.Media=2]="Media",d;var m})()},534:(Ln,At,k)=>{"use strict";k.r(At),k.d(At,{AboutPageModule:()=>ge});var d=k(6895),m=k(4006),ce=k(9634),l=k(6014),ie=k(388),re=k(8274);const v=[{path:"",component:ie.t}];let ne=(()=>{class X{}return X.\u0275fac=function(se){return new(se||X)},X.\u0275mod=re.oAB({type:X}),X.\u0275inj=re.cJS({imports:[[l.Bz.forChild(v)],l.Bz]}),X})();var De=k(4463);let ge=(()=>{class X{}return X.\u0275fac=function(se){return new(se||X)},X.\u0275mod=re.oAB({type:X}),X.\u0275inj=re.cJS({imports:[[d.ez,m.u5,ce.Pc,De.aw,ne]]}),X})()},388:(Ln,At,k)=>{"use strict";k.d(At,{t:()=>ie});var d=k(2340),m=k(8274),ce=k(9634),l=k(4463);let ie=(()=>{class re{constructor(ne){this.modalController=ne}get appVersion(){return d.N.version}get apiUrl(){return d.N.apiBase}ngOnInit(){}close(){this.modalController.dismiss()}}return re.\u0275fac=function(ne){return new(ne||re)(m.Y36(ce.IN))},re.\u0275cmp=m.Xpm({type:re,selectors:[["app-about"]],decls:49,vars:5,consts:[[1,"ion-padding"],["size","2"],["src","assets/images/icons/branding/AppIcon_128x128.png",2,"padding-top","2em"],["href","https://openchargemap.org"],["href","https://community.openchargemap.org"],["href","https://github.com/openchargemap/ocm-system/issues"],["href","https://webprofusion.com"],["href","https://opencollective.com/openchargemap"],["slot","end"],[3,"click"],["name","close","slot","start"]],template:function(ne,De){1&ne&&(m.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),m._uU(3),m.ALo(4,"translate"),m.qZA()()(),m.TgZ(5,"ion-content",0)(6,"ion-grid")(7,"ion-row")(8,"ion-col",1),m._UZ(9,"img",2),m.qZA(),m.TgZ(10,"ion-col")(11,"h1"),m._uU(12,"Open Charge Map"),m.qZA(),m.TgZ(13,"h2"),m._uU(14,"The global public registry of Electric Vehicle charging locations"),m.qZA(),m.TgZ(15,"p"),m._uU(16,"Web: "),m.TgZ(17,"a",3),m._uU(18,"https://openchargemap.org"),m.qZA()()()()(),m.TgZ(19,"p"),m._uU(20,"Community Discussions: "),m.TgZ(21,"a",4),m._uU(22,"https://community.openchargemap.org"),m.qZA()(),m.TgZ(23,"p"),m._uU(24,"App or System Bugs and feature suggestions: "),m.TgZ(25,"a",5),m._uU(26,"GitHub"),m.qZA()(),m.TgZ(27,"p"),m._uU(28,"App development by Webprofusion Pty Ltd ("),m.TgZ(29,"a",6),m._uU(30,"https://webprofusion.com"),m.qZA(),m._uU(31,")"),m.qZA(),m.TgZ(32,"h3"),m._uU(33,"Funding"),m.qZA(),m.TgZ(34,"p"),m._uU(35,"Our software is developed and hosted by volunteers, our data is crowdsourced by you. To help further development please encourage your organisation to sponsor us: "),m.TgZ(36,"a",7),m._uU(37,"Open Collective"),m.qZA()(),m.TgZ(38,"ion-note")(39,"p"),m._uU(40),m.qZA(),m.TgZ(41,"p"),m._uU(42),m.qZA()()(),m.TgZ(43,"ion-footer")(44,"ion-toolbar")(45,"ion-buttons",8)(46,"ion-button",9),m.NdJ("click",function(){return De.close()}),m._UZ(47,"ion-icon",10),m._uU(48," Close "),m.qZA()()()()),2&ne&&(m.xp6(3),m.Oqu(m.lcZ(4,3,"ocm.general.about")),m.xp6(37),m.hij("App Version: ",De.appVersion,""),m.xp6(2),m.hij("API: ",De.apiUrl,""))},directives:[ce.Gu,ce.sr,ce.wd,ce.W2,ce.jY,ce.Nd,ce.wI,ce.uN,ce.fr,ce.Sm,ce.YG,ce.gu],pipes:[l.X$],styles:[""]}),re})()},5476:(Ln,At,k)=>{"use strict";k.r(At),k.d(At,{JourneysModule:()=>De});var d=k(9741),m=k(8936),ce=k(4463),l=k(6895),ie=k(4006),re=k(9634),v=k(6014),ne=k(8274);let De=(()=>{class ge{}return ge.\u0275fac=function(ue){return new(ue||ge)},ge.\u0275mod=ne.oAB({type:ge}),ge.\u0275inj=ne.cJS({imports:[[l.ez,ie.u5,re.Pc,ce.aw,m.e,v.Bz.forChild([{path:"",component:d.g}])]]}),ge})()},9741:(Ln,At,k)=>{"use strict";k.d(At,{g:()=>We});var d=k(3912),m=k(7814),ce=k(3855),l=k(4120),ie=k(3399),re=k(8274),v=k(9634),ne=k(6895);function De(Qe,ve){1&Qe&&(re.TgZ(0,"p"),re._uU(1," You have no journeys yet. Start by browsing to a charging location, then add it as Favourite to start a new Journey. "),re.qZA())}function ge(Qe,ve){if(1&Qe&&(re.TgZ(0,"p"),re._uU(1),re.qZA()),2&Qe){const me=re.oxw(2).$implicit;re.xp6(1),re.hij(" ",me.Poi.AddressInfo.AddressLine1,"")}}function X(Qe,ve){if(1&Qe&&(re.TgZ(0,"p"),re._uU(1),re.qZA()),2&Qe){const me=re.oxw(2).$implicit;re.xp6(1),re.hij(" ",me.Poi.AddressInfo.AddressLine2,"")}}function ue(Qe,ve){if(1&Qe&&(re.TgZ(0,"p"),re._uU(1),re.qZA()),2&Qe){const me=re.oxw(2).$implicit;re.xp6(1),re.hij(" ",me.Poi.AddressInfo.Town,"")}}function se(Qe,ve){if(1&Qe&&(re.TgZ(0,"p"),re._uU(1),re.qZA()),2&Qe){const me=re.oxw(2).$implicit;re.xp6(1),re.hij(" ",me.Poi.AddressInfo.StateOrProvince,"")}}function Ie(Qe,ve){if(1&Qe&&(re.TgZ(0,"p"),re._uU(1),re.qZA()),2&Qe){const me=re.oxw(2).$implicit;re.xp6(1),re.hij(" ",me.Poi.AddressInfo.Postcode,"")}}function we(Qe,ve){if(1&Qe){const me=re.EpF();re.TgZ(0,"div")(1,"div",18),re.NdJ("click",function(){re.CHM(me);const Pe=re.oxw().$implicit;return re.oxw(4).viewPOIDetails(Pe.Poi)}),re.YNc(2,ge,2,1,"p",4),re.YNc(3,X,2,1,"p",4),re.YNc(4,ue,2,1,"p",4),re.YNc(5,se,2,1,"p",4),re.YNc(6,Ie,2,1,"p",4),re.qZA(),re.TgZ(7,"ion-button",19),re.NdJ("click",function(){re.CHM(me);const Pe=re.oxw().$implicit;return re.oxw(4).launchNavigation(Pe.Poi)}),re._UZ(8,"ion-icon",20),re._uU(9," Navigate "),re.qZA()()}if(2&Qe){const me=re.oxw().$implicit;re.xp6(2),re.Q6J("ngIf",me.Poi.AddressInfo.AddressLine1),re.xp6(1),re.Q6J("ngIf",me.Poi.AddressInfo.AddressLine2),re.xp6(1),re.Q6J("ngIf",me.Poi.AddressInfo.Town),re.xp6(1),re.Q6J("ngIf",me.Poi.AddressInfo.StateOrProvince),re.xp6(1),re.Q6J("ngIf",me.Poi.AddressInfo.Postcode)}}function Ue(Qe,ve){if(1&Qe&&(re.TgZ(0,"div",17),re.YNc(1,we,10,5,"div",4),re.qZA()),2&Qe){const me=ve.$implicit;re.xp6(1),re.Q6J("ngIf",me.Poi)}}function Ne(Qe,ve){if(1&Qe&&(re.TgZ(0,"ion-item")(1,"h2"),re._uU(2),re.qZA(),re.TgZ(3,"ion-thumbnail",0),re._UZ(4,"ion-icon",15),re.qZA(),re.TgZ(5,"p"),re._uU(6),re.qZA(),re.YNc(7,Ue,2,1,"div",16),re.qZA()),2&Qe){const me=ve.$implicit;re.xp6(2),re.Oqu(me.Title),re.xp6(4),re.Oqu(me.Notes),re.xp6(1),re.Q6J("ngForOf",me.PoiList)}}function ke(Qe,ve){if(1&Qe&&(re.TgZ(0,"ion-list")(1,"ion-list-header",11),re._uU(2),re._UZ(3,"ion-icon",12),re._uU(4," -- "),re._UZ(5,"ion-icon",13),re._uU(6," -- "),re._UZ(7,"ion-icon",14),re._uU(8," -- "),re.qZA(),re.YNc(9,Ne,8,3,"ion-item",5),re.qZA()),2&Qe){const me=ve.$implicit;re.xp6(2),re.hij(" ",me.Title," "),re.xp6(7),re.Q6J("ngForOf",me.WayPoints)}}function He(Qe,ve){if(1&Qe){const me=re.EpF();re.TgZ(0,"ion-card")(1,"ion-card-content")(2,"ion-toolbar",8)(3,"ion-title"),re._uU(4),re.qZA(),re.TgZ(5,"ion-buttons",9)(6,"ion-button",1),re.NdJ("click",function(){const Ge=re.CHM(me).$implicit;return re.oxw().deleteJourney(Ge.ID)}),re._UZ(7,"ion-icon",10),re.qZA()()(),re.TgZ(8,"p"),re._uU(9),re.qZA(),re.YNc(10,ke,10,2,"ion-list",5),re.qZA()()}if(2&Qe){const me=ve.$implicit;re.xp6(4),re.hij(" ",me.Title,""),re.xp6(5),re.Oqu(me.Notes),re.xp6(1),re.Q6J("ngForOf",me.Stages)}}let We=(()=>{class Qe{constructor(me,Ze,Pe,Ge,tt){this.appManager=me,this.journeyManager=Ze,this.api=Pe,this.modalController=Ge,this.alertController=tt}dismiss(){this.modalController.dismiss()}discoverImages(){this.journeyManager.journeys.forEach(me=>{me.Stages.forEach(Ze=>{Ze.WayPoints.forEach(Pe=>{null!=Pe.PoiList&&Pe.PoiList.forEach(Ge=>{Ge.Poi&&this.api.getPanoramioLocationPhotos(new l.wC(Ge.Poi.AddressInfo.Latitude,Ge.Poi.AddressInfo.Longitude)).then(tt=>{Ge.Photos=tt})})})})})}getJson(me){return JSON.stringify(me,null,4)}viewPOIDetails(me){this.modalController.create({component:ie.H,componentProps:{item:me}}).then(Ze=>Ze.present())}get staticMapSize(){return"60x60"}getStaticMapURL(me){return"https://maps.googleapis.com/maps/api/staticmap?center="+me.AddressInfo.Latitude+","+me.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+me.AddressInfo.Latitude+","+me.AddressInfo.Longitude}deleteJourney(me){this.alertController.create({header:"Delete this Journey?",message:"Are you sure you want to delete this Journey?",buttons:[{text:"No",handler:()=>{}},{text:"Delete",handler:()=>{this.journeyManager.deleteJourney(me)}}]}).then(Ze=>Ze.present())}launchNavigation(me){let Ze="https://maps.google.com/?q="+me.AddressInfo.Latitude+","+me.AddressInfo.Longitude;this.appManager.platform.is("ios")&&(Ze="https://maps.apple.com?q="+me.AddressInfo.Latitude+","+me.AddressInfo.Longitude),window.open(Ze,"_system")}}return Qe.\u0275fac=function(me){return new(me||Qe)(re.Y36(ce.c),re.Y36(d.i),re.Y36(m.l),re.Y36(v.IN),re.Y36(v.Br))},Qe.\u0275cmp=re.Xpm({type:Qe,selectors:[["ng-component"]],decls:18,vars:2,consts:[["slot","start"],[3,"click"],[1,"journeys-page"],[1,"ion-padding"],[4,"ngIf"],[4,"ngFor","ngForOf"],["slot","end"],["name","close","slot","start"],["primary",""],["slot","primary"],["name","close","slot","icon-only"],[2,"font-size","1.5rem"],["name","car"],["name","time"],["name","flash"],["name","caret-down",2,"font-size","4rem"],["style","text-align:right;width:100%;",4,"ngFor","ngForOf"],[2,"text-align","right","width","100%"],["tappable","",3,"click"],["clear","","item-right","",3,"click"],["name","navigate","slot","start"]],template:function(me,Ze){1&me&&(re.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-back-button",1),re.NdJ("click",function(){return Ze.dismiss()}),re.qZA()(),re.TgZ(4,"ion-title"),re._uU(5," Journeys "),re.qZA()()(),re.TgZ(6,"ion-content",2)(7,"div",3)(8,"p"),re._uU(9," You can create and plan journeys to group your favourite charging routes together. "),re.qZA(),re.YNc(10,De,2,0,"p",4),re.qZA(),re.YNc(11,He,11,3,"ion-card",5),re.qZA(),re.TgZ(12,"ion-footer")(13,"ion-toolbar")(14,"ion-buttons",6)(15,"ion-button",1),re.NdJ("click",function(){return Ze.dismiss()}),re._UZ(16,"ion-icon",7),re._uU(17," Close "),re.qZA()()()()),2&me&&(re.xp6(10),re.Q6J("ngIf",null==Ze.journeyManager.journeys||0==Ze.journeyManager.journeys.length),re.xp6(1),re.Q6J("ngForOf",Ze.journeyManager.journeys))},directives:[v.Gu,v.sr,v.Sm,v.oU,v.cs,v.wd,v.W2,ne.O5,ne.sg,v.PM,v.FN,v.YG,v.gu,v.q_,v.yh,v.Ie,v.Bs,v.fr],encapsulation:2}),Qe})()},5005:(Ln,At,k)=>{"use strict";k.r(At),k.d(At,{LayerEditorPageModule:()=>ge});var d=k(6895),m=k(4006),ce=k(9634),l=k(6014),ie=k(6588),re=k(8274);const v=[{path:"",component:ie.A}];let ne=(()=>{class X{}return X.\u0275fac=function(se){return new(se||X)},X.\u0275mod=re.oAB({type:X}),X.\u0275inj=re.cJS({imports:[[l.Bz.forChild(v)],l.Bz]}),X})();var De=k(8936);let ge=(()=>{class X{}return X.\u0275fac=function(se){return new(se||X)},X.\u0275mod=re.oAB({type:X}),X.\u0275inj=re.cJS({imports:[[d.ez,m.u5,ce.Pc,ne,De.e]]}),X})()},6588:(Ln,At,k)=>{"use strict";k.d(At,{A:()=>ne});var d=k(9671),m=k(6799),ce=k(8274),l=k(9634),ie=k(6895),re=k(6585);function v(De,ge){if(1&De&&(ce.TgZ(0,"div"),ce._uU(1),ce._UZ(2,"app-poi-list",10),ce.qZA()),2&De){const X=ce.oxw();ce.xp6(1),ce.hij(" Items Parsed: ",X.fileData.length," "),ce.xp6(1),ce.Q6J("poiList",X.fileData)}}let ne=(()=>{class De{constructor(X,ue){this.modalController=X,this.refData=ue}ngOnInit(){}previewFile(){var X=this;return(0,d.Z)(function*(){yield X.loadFile(!1)})()}cancel(){var X=this;return(0,d.Z)(function*(){yield X.modalController.dismiss(X.fileData)})()}loadFile(X=!0){var ue=this;return(0,d.Z)(function*(){const se=new FileReader;se.onload=()=>{let we=JSON.parse(se.result);for(let Ue of we)Ue.ID="imp_"+Ue.ID;ue.fileData=ue.refData.hydrateCompactPOIList(we),X&&ue.modalController.dismiss(ue.fileData)},se.onerror=()=>{},se.readAsText(document.getElementById("file-upload").files[0])})()}add(){var X=this;return(0,d.Z)(function*(){X.modalController.dismiss(X.fileData)})()}}return De.\u0275fac=function(X){return new(X||De)(ce.Y36(l.IN),ce.Y36(m.W))},De.\u0275cmp=ce.Xpm({type:De,selectors:[["app-layer-editor"]],decls:27,vars:1,consts:[[1,"ion-padding"],[1,"upload"],["name","file","aria-label","file","slot","start"],["type","file","required","","id","file-upload",3,"change"],[4,"ngIf"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","checkmark-circle-outline","slot","end"],[3,"poiList"]],template:function(X,ue){1&X&&(ce.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),ce._uU(3," Edit Layer "),ce.qZA()()(),ce.TgZ(4,"ion-content",0)(5,"p"),ce._uU(6,"POI layers are used to preview data from other Open Data sources. "),ce.qZA(),ce.TgZ(7,"p"),ce._uU(8,"Select a POI layer JSON file: "),ce.qZA(),ce.TgZ(9,"div")(10,"label",1)(11,"ion-button"),ce._UZ(12,"ion-icon",2),ce.TgZ(13,"ion-label"),ce._uU(14,"Choose File.."),ce.qZA()(),ce.TgZ(15,"input",3),ce.NdJ("change",function(){return ue.previewFile()}),ce.qZA()()(),ce.YNc(16,v,3,2,"div",4),ce.qZA(),ce.TgZ(17,"ion-footer")(18,"ion-toolbar")(19,"ion-buttons",5)(20,"ion-button",6),ce.NdJ("click",function(){return ue.cancel()}),ce._UZ(21,"ion-icon",7),ce._uU(22," Cancel "),ce.qZA()(),ce.TgZ(23,"ion-buttons",8)(24,"ion-button",6),ce.NdJ("click",function(){return ue.add()}),ce._uU(25," Add "),ce._UZ(26,"ion-icon",9),ce.qZA()()()()),2&X&&(ce.xp6(16),ce.Q6J("ngIf",ue.fileData&&ue.fileData.length>0))},directives:[l.Gu,l.sr,l.wd,l.W2,l.YG,l.gu,l.Q$,ie.O5,re.o,l.fr,l.Sm],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]}),De})()},3399:(Ln,At,k)=>{"use strict";k.d(At,{H:()=>je});var d=k(3855),m=k(8274),ce=k(9634),l=k(9671),ie=k(3912),re=k(129),v=k(4006),ne=k(6895);function De(L,Q){if(1&L&&(m.TgZ(0,"ion-select-option",13),m._uU(1),m.qZA()),2&L){const N=Q.$implicit;m.Q6J("value",N.ID),m.xp6(1),m.Oqu(N.Title)}}function ge(L,Q){if(1&L&&(m.TgZ(0,"ion-select-option",16),m._uU(1),m.qZA()),2&L){const N=Q.$implicit;m.Q6J("value",Q.index),m.xp6(1),m.Oqu(N.Title)}}function X(L,Q){if(1&L){const N=m.EpF();m.TgZ(0,"ion-item")(1,"ion-label",2),m._uU(2,"Journey Stage"),m.qZA(),m.TgZ(3,"ion-select",3),m.NdJ("ngModelChange",function($e){return m.CHM(N),m.oxw().selectedStageIndex=$e}),m.TgZ(4,"ion-select-option",14),m._uU(5,"Create a Journey Stage"),m.qZA(),m.YNc(6,ge,2,2,"ion-select-option",15),m.qZA()()}if(2&L){const N=m.oxw();m.xp6(3),m.Q6J("ngModel",N.selectedStageIndex),m.xp6(3),m.Q6J("ngForOf",N.journeyManager.getJourneyStages(N.selectedJourneyID))}}function ue(L,Q){if(1&L){const N=m.EpF();m.TgZ(0,"ion-item")(1,"ion-label",2),m._uU(2,"New Journey Name"),m.qZA(),m.TgZ(3,"ion-input",7),m.NdJ("ngModelChange",function($e){return m.CHM(N),m.oxw().newJourneyName=$e}),m.qZA()()}if(2&L){const N=m.oxw();m.xp6(3),m.Q6J("ngModel",N.newJourneyName)}}let se=(()=>{class L{constructor(N,pe,$e,gt){this.appManager=N,this.navParams=pe,this.journeyManager=$e,this.modalController=gt,this.poi=this.navParams.get("poi"),this.waypoint=new re.kA,this.waypoint.Title=this.poi.AddressInfo.Title,this.waypoint.PoiIDs=[this.poi.ID],this.waypoint.PoiList=[];const Tt=new re.Qp("charging",1);Tt.Poi=this.poi,Tt.PoiID=this.poi.ID,this.waypoint.PoiList.push(Tt),this.newJourneyName="Trip to "+this.poi.AddressInfo.Title}cancel(){this.modalController.dismiss()}add(){if(null!=this.selectedJourneyID&&""!==this.selectedJourneyID)this.journeyManager.addJourneyWaypoint(this.selectedJourneyID,this.selectedStageIndex,this.waypoint);else{const N=new re.fw;N.ID=Date.now().toString(),""===this.newJourneyName&&(this.newJourneyName="New Journey"),N.Title=this.newJourneyName,this.journeyManager.addJourney(N,this.waypoint)}this.journeyManager.saveJourneys(),this.modalController.dismiss()}}return L.\u0275fac=function(N){return new(N||L)(m.Y36(d.c),m.Y36(ce.X1),m.Y36(ie.i),m.Y36(ce.IN))},L.\u0275cmp=m.Xpm({type:L,selectors:[["ng-component"]],decls:39,vars:8,consts:[[1,"journeys-page","ion-padding"],[1,"banner"],["position","stacked"],[3,"ngModel","ngModelChange"],["value","","checked",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","text",3,"ngModel","ngModelChange"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","add","slot","end"],[3,"value"],["value",""],["checked","",3,"value",4,"ngFor","ngForOf"],["checked","",3,"value"]],template:function(N,pe){1&N&&(m.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),m._uU(3," Edit Favourite "),m.qZA()()(),m.TgZ(4,"ion-content",0)(5,"div",1)(6,"h1"),m._uU(7),m.qZA(),m.TgZ(8,"p"),m._uU(9),m.qZA()(),m.TgZ(10,"p"),m._uU(11," Add Charging Location as a Journey Waypoint "),m.qZA(),m.TgZ(12,"ion-item")(13,"ion-label",2),m._uU(14,"Add to a Journey"),m.qZA(),m.TgZ(15,"ion-select",3),m.NdJ("ngModelChange",function(gt){return pe.selectedJourneyID=gt}),m.TgZ(16,"ion-select-option",4),m._uU(17,"Create a New Journey"),m.qZA(),m.YNc(18,De,2,2,"ion-select-option",5),m.qZA()(),m.YNc(19,X,7,2,"ion-item",6),m.YNc(20,ue,4,1,"ion-item",6),m.TgZ(21,"ion-item")(22,"ion-label",2),m._uU(23,"Name for this step of your journey"),m.qZA(),m.TgZ(24,"ion-input",7),m.NdJ("ngModelChange",function(gt){return pe.waypoint.Title=gt}),m.qZA()(),m.TgZ(25,"ion-item")(26,"ion-label",2),m._uU(27,"Other Notes"),m.qZA(),m.TgZ(28,"ion-textarea",3),m.NdJ("ngModelChange",function(gt){return pe.waypoint.Notes=gt}),m.qZA()()(),m.TgZ(29,"ion-footer")(30,"ion-toolbar")(31,"ion-buttons",8)(32,"ion-button",9),m.NdJ("click",function(){return pe.cancel()}),m._UZ(33,"ion-icon",10),m._uU(34," Cancel "),m.qZA()(),m.TgZ(35,"ion-buttons",11)(36,"ion-button",9),m.NdJ("click",function(){return pe.add()}),m._uU(37," Add "),m._UZ(38,"ion-icon",12),m.qZA()()()()),2&N&&(m.xp6(7),m.Oqu(pe.poi.AddressInfo.Title),m.xp6(2),m.Oqu(pe.poi.AddressInfo.AddressLine1),m.xp6(6),m.Q6J("ngModel",pe.selectedJourneyID),m.xp6(3),m.Q6J("ngForOf",pe.journeyManager.journeys),m.xp6(1),m.Q6J("ngIf",pe.selectedJourneyID),m.xp6(1),m.Q6J("ngIf",!pe.selectedJourneyID),m.xp6(4),m.Q6J("ngModel",pe.waypoint.Title),m.xp6(4),m.Q6J("ngModel",pe.waypoint.Notes))},directives:[ce.Gu,ce.sr,ce.wd,ce.W2,ce.Ie,ce.Q$,ce.t9,ce.QI,v.JJ,v.On,ce.n0,ne.sg,ne.O5,ce.pK,ce.j9,ce.g2,ce.fr,ce.Sm,ce.YG,ce.gu],encapsulation:2}),L})();var Ie=k(7689);function we(L,Q){if(1&L){const N=m.EpF();m.TgZ(0,"ion-card")(1,"ion-toolbar")(2,"ion-title",14),m._uU(3,"Preview"),m.qZA(),m.TgZ(4,"ion-buttons",15)(5,"ion-button",4),m.NdJ("click",function(){return m.CHM(N),m.oxw().rotateImage()}),m._UZ(6,"ion-icon",16),m.TgZ(7,"ion-label"),m._uU(8,"Rotate"),m.qZA()()()(),m.TgZ(9,"ion-card-content")(10,"ion-list")(11,"ion-item")(12,"ion-label",17),m._uU(13,"Comment"),m.qZA(),m.TgZ(14,"ion-input",18),m.NdJ("ngModelChange",function($e){return m.CHM(N),m.oxw().comment=$e}),m.qZA()()(),m._UZ(15,"img",19),m.qZA()()}if(2&L){const N=m.oxw();m.xp6(14),m.Q6J("ngModel",N.comment)}}let Ue=(()=>{class L{constructor(N,pe,$e,gt,Tt){this.navParams=N,this.appManager=pe,this.nav=$e,this.modalController=gt,this.logging=Tt,this.processingQuality=.8,this.targetWidth=1024,this.targetHeight=800,this.mode=pe.platformMode,this.chargePointId=this.navParams.get("id"),this.poi=this.navParams.get("poi"),this.comment=""}processNativeImageSource(N){let pe=N;const $e=document.getElementById("img-upload-canvas"),gt=$e.getContext("2d"),Tt=new Image;Tt.onload=()=>{this.logging.log("img load:"+Tt.width),$e.width=Tt.width,$e.height=Tt.height,gt.fillStyle="rgb(0,0,0)",gt.fillRect(0,0,$e.width,$e.height),gt.drawImage(Tt,0,0,$e.width,$e.height),this.imgData=$e.toDataURL("image/png"),this.processImage()},Tt.src=pe}loadCameraOrLibraryImage(N=!1){this.logging.log("PWA mode: fetching image");const pe=new FileReader;pe.onload=()=>{this.imgData=pe.result,this.processImage()},pe.onerror=()=>{},pe.readAsDataURL(document.getElementById("img-upload-media").files[0])}isBrowserMode(){return this.appManager.isPlatform("desktop")||this.appManager.isPlatform("hybrid")}processImage(){if(null!=this.imgData){const pe=document.getElementById("img-upload-canvas"),$e=pe.getContext("2d"),gt=new Image;gt.onload=()=>{pe.width=gt.width,pe.height=gt.height,$e.fillStyle="rgb(0,0,0)",$e.fillRect(0,0,pe.width,pe.height),$e.drawImage(gt,0,0,pe.width,pe.height),this.refreshImageFromCanvas()},gt.src=this.imgData}else this.logging.log("processImage: nothing to process.")}refreshImageFromCanvas(){const N=document.getElementById("img-upload-canvas");this.imgData=N.toDataURL("image/jpeg",.8),document.getElementById("preview").src=this.imgData}rotateImage(){const N=document.getElementById("img-upload-canvas");let pe=new Image;pe.src=N.toDataURL(),pe.onload=()=>{let $e=N.height,gt=N.width;N.width=$e,N.height=gt,$e=N.height,gt=N.width;const Tt=N.getContext("2d");Tt.save(),Tt.translate(gt,$e/gt),Tt.rotate(Math.PI/2),Tt.drawImage(pe,0,0),Tt.restore(),pe=null,this.refreshImageFromCanvas()}}performUpload(){var N=this;return(0,l.Z)(function*(){if(!N.imgData)return void(yield N.appManager.showToastNotification("Select an image to upload."));const pe={chargePointID:N.chargePointId,comment:N.comment,imageDataBase64:N.imgData};yield N.appManager.showLoadingProgress("Uploading photo..");try{yield N.appManager.submitMediaItem(pe),N.appManager.dismissLoadingProgress().then(()=>{N.appManager.showToastNotification("Upload completed"),N.modalController.dismiss()}),N.appManager.analytics.appEvent("MediaUpload","Completed")}catch{yield N.appManager.dismissLoadingProgress(),yield N.appManager.showToastNotification("Upload failed, please try again."),N.appManager.analytics.appEvent("MediaUpload","Failed")}})()}cancel(){var N=this;return(0,l.Z)(function*(){yield N.modalController.dismiss()})()}}return L.\u0275fac=function(N){return new(N||L)(m.Y36(ce.X1),m.Y36(d.c),m.Y36(ce.SH),m.Y36(ce.IN),m.Y36(Ie.z))},L.\u0275cmp=m.Xpm({type:L,selectors:[["ng-component"]],decls:32,vars:3,consts:[[1,"media-upload"],[1,"ion-padding"],[1,"banner"],[1,"upload"],[3,"click"],["name","camera","aria-label","camera","slot","start"],["type","file","required","","id","img-upload-media",3,"change"],["inputFile",""],["id","img-upload-canvas",2,"display","none","width","500","height","500","border","1px solid red"],[4,"ngIf"],["slot","secondary"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],["slot","start"],["slot","end"],["name","refresh","slot","start"],["position","floating"],["type","text","placeholder","(optional comment)",3,"ngModel","ngModelChange"],["id","preview",2,"max-width","500px"]],template:function(N,pe){if(1&N){const $e=m.EpF();m.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),m._uU(3," Share Photo "),m.qZA()()(),m.TgZ(4,"ion-content",0)(5,"div",1)(6,"div",2)(7,"h1"),m._uU(8),m.qZA(),m.TgZ(9,"p"),m._uU(10),m.qZA()(),m.TgZ(11,"p"),m._uU(12,"You can upload a photo from your device or take a new photo: "),m.qZA(),m.TgZ(13,"div",3)(14,"ion-button",4),m.NdJ("click",function(){return m.CHM($e),m.MAs(19).click()}),m._UZ(15,"ion-icon",5),m.TgZ(16,"ion-label"),m._uU(17,"Choose Photo.."),m.qZA()(),m.TgZ(18,"input",6,7),m.NdJ("change",function(){return pe.loadCameraOrLibraryImage()}),m.qZA()(),m._UZ(20,"canvas",8),m.YNc(21,we,16,1,"ion-card",9),m.qZA()(),m.TgZ(22,"ion-footer")(23,"ion-toolbar")(24,"ion-buttons",10)(25,"ion-button",4),m.NdJ("click",function(){return pe.cancel()}),m._UZ(26,"ion-icon",11),m._uU(27," Cancel "),m.qZA()(),m.TgZ(28,"ion-buttons",12)(29,"ion-button",4),m.NdJ("click",function(){return pe.performUpload()}),m._uU(30," Upload "),m._UZ(31,"ion-icon",13),m.qZA()()()()}2&N&&(m.xp6(8),m.Oqu(pe.poi.AddressInfo.Title),m.xp6(2),m.Oqu(pe.poi.AddressInfo.AddressLine1),m.xp6(11),m.Q6J("ngIf",null!=pe.imgData))},directives:[ce.Gu,ce.sr,ce.wd,ce.W2,ce.YG,ce.gu,ce.Q$,ne.O5,ce.PM,ce.Sm,ce.FN,ce.q_,ce.Ie,ce.pK,ce.j9,v.JJ,v.On,ce.fr],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]}),L})();var Ne=k(6014);function ke(L,Q){if(1&L&&(m.TgZ(0,"ion-select-option",19),m._uU(1),m.qZA()),2&L){const N=Q.$implicit;m.Q6J("value",N.ID),m.xp6(1),m.Oqu(N.Title)}}function He(L,Q){if(1&L&&(m.TgZ(0,"ion-select-option",19),m._uU(1),m.qZA()),2&L){const N=Q.$implicit;m.Q6J("value",N.ID),m.xp6(1),m.Oqu(N.Title)}}let We=(()=>{class L{constructor(N,pe,$e,gt,Tt,Ct,Et,ln){this.navParams=N,this.appManager=pe,this.nav=$e,this.zone=gt,this.loadingController=Tt,this.modalController=Ct,this.logging=Et,this.router=ln,this.commentModel={ChargePointID:this.navParams.get("id"),Comment:"",CheckinStatusTypeID:10,CommentTypeID:10,Rating:null},this.poi=this.navParams.get("poi"),this.commentTypes=pe.referenceDataManager.getCommentTypes(!0,!0),this.checkinTypes=pe.referenceDataManager.getCheckinStatusTypes(!0,!0)}onPageWillEnter(){}cancel(){this.modalController.dismiss()}add(){var N=this;return(0,l.Z)(function*(){const pe=yield N.loadingController.create({message:"Sending .."});yield pe.present(),(yield N.appManager.submitComment(N.commentModel).catch(gt=>{N.appManager.showToastNotification("There was a problem submitting your comment."),N.loadingController.dismiss(),N.appManager.analytics.appEvent("Comment","Failed")}))&&(N.logging.log("Comment submitted"),yield pe.dismiss(),yield N.modalController.dismiss(),N.appManager.analytics.appEvent("Comment","Submitted"))})()}}return L.\u0275fac=function(N){return new(N||L)(m.Y36(ce.X1),m.Y36(d.c),m.Y36(ce.SH),m.Y36(m.R0b),m.Y36(ce.HT),m.Y36(ce.IN),m.Y36(Ie.z),m.Y36(Ne.F0))},L.\u0275cmp=m.Xpm({type:L,selectors:[["ng-component"]],decls:53,vars:8,consts:[["color","primary"],[1,"comment-page","ion-padding"],[1,"banner"],[1,"ion-padding"],["position","stacked"],[3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","(optional comment)",3,"ngModel","ngModelChange"],["value","5"],["value","4"],["value","3"],["value","2"],["value","1"],["value",""],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],[3,"value"]],template:function(N,pe){1&N&&(m.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),m._uU(3," Add Comment "),m.qZA()()(),m.TgZ(4,"ion-content",1)(5,"div",2)(6,"h1"),m._uU(7),m.qZA(),m.TgZ(8,"p"),m._uU(9),m.qZA()(),m.TgZ(10,"p",3),m._uU(11,"Recent Check-ins are a big help to other drivers when planning their journey. Tell everyone what you thought about this charging location. "),m.qZA(),m.TgZ(12,"ion-list")(13,"ion-item")(14,"ion-label",4),m._uU(15,"Comment Type"),m.qZA(),m.TgZ(16,"ion-select",5),m.NdJ("ngModelChange",function(gt){return pe.commentModel.CommentTypeID=gt}),m.YNc(17,ke,2,2,"ion-select-option",6),m.qZA()(),m.TgZ(18,"ion-item")(19,"ion-label",4),m._uU(20,"What Did You Think?"),m.qZA(),m.TgZ(21,"ion-input",7),m.NdJ("ngModelChange",function(gt){return pe.commentModel.Comment=gt}),m.qZA()(),m.TgZ(22,"ion-item")(23,"ion-label",4),m._uU(24,"Did You Successfully Charge?"),m.qZA(),m.TgZ(25,"ion-select",5),m.NdJ("ngModelChange",function(gt){return pe.commentModel.CheckinStatusTypeID=gt}),m.YNc(26,He,2,2,"ion-select-option",6),m.qZA()(),m.TgZ(27,"ion-item")(28,"ion-label",4),m._uU(29,"Your Rating"),m.qZA(),m.TgZ(30,"ion-select",5),m.NdJ("ngModelChange",function(gt){return pe.commentModel.Rating=gt}),m.TgZ(31,"ion-select-option",8),m._uU(32,"5 - Excellent"),m.qZA(),m.TgZ(33,"ion-select-option",9),m._uU(34,"4 - Good"),m.qZA(),m.TgZ(35,"ion-select-option",10),m._uU(36,"3 - Average"),m.qZA(),m.TgZ(37,"ion-select-option",11),m._uU(38,"2 - Not Good"),m.qZA(),m.TgZ(39,"ion-select-option",12),m._uU(40,"1 - Bad"),m.qZA(),m.TgZ(41,"ion-select-option",13),m._uU(42,"Not Rated"),m.qZA()()()()(),m.TgZ(43,"ion-footer")(44,"ion-toolbar")(45,"ion-buttons",14)(46,"ion-button",15),m.NdJ("click",function(){return pe.cancel()}),m._UZ(47,"ion-icon",16),m._uU(48," Cancel "),m.qZA()(),m.TgZ(49,"ion-buttons",17)(50,"ion-button",15),m.NdJ("click",function(){return pe.add()}),m._uU(51," Submit "),m._UZ(52,"ion-icon",18),m.qZA()()()()),2&N&&(m.xp6(7),m.Oqu(pe.poi.AddressInfo.Title),m.xp6(2),m.Oqu(pe.poi.AddressInfo.AddressLine1),m.xp6(7),m.Q6J("ngModel",pe.commentModel.CommentTypeID),m.xp6(1),m.Q6J("ngForOf",pe.commentTypes),m.xp6(4),m.Q6J("ngModel",pe.commentModel.Comment),m.xp6(4),m.Q6J("ngModel",pe.commentModel.CheckinStatusTypeID),m.xp6(1),m.Q6J("ngForOf",pe.checkinTypes),m.xp6(4),m.Q6J("ngModel",pe.commentModel.Rating))},directives:[ce.Gu,ce.sr,ce.wd,ce.W2,ce.q_,ce.Ie,ce.Q$,ce.t9,ce.QI,v.JJ,v.On,ne.sg,ce.n0,ce.pK,ce.j9,ce.fr,ce.Sm,ce.YG,ce.gu],encapsulation:2}),L})();var Qe=k(2951),ve=k(9698),me=k(9492),Ze=k(4508),Pe=k(6579),Ge=k(4463),tt=k(1099);function ye(L,Q){if(1&L&&(m.TgZ(0,"div")(1,"small"),m._uU(2),m.qZA()()),2&L){const N=m.oxw(2);m.xp6(2),m.Oqu(N.connectionSummary)}}function Ae(L,Q){if(1&L&&(m.TgZ(0,"div")(1,"small"),m._uU(2),m.qZA()()),2&L){const N=m.oxw(2);m.xp6(2),m.Oqu(N.poi.OperatorInfo.Title)}}function Be(L,Q){if(1&L){const N=m.EpF();m.ynx(0),m.TgZ(1,"ion-button",28),m.NdJ("click",function(){return m.CHM(N),m.oxw(2).addFavourite()}),m._UZ(2,"ion-icon",29),m.TgZ(3,"ion-label"),m._uU(4,"Favourite"),m.qZA()(),m.TgZ(5,"ion-button",13),m.NdJ("click",function(){return m.CHM(N),m.oxw(2).edit()}),m._UZ(6,"ion-icon",30),m.TgZ(7,"ion-label"),m._uU(8,"Edit"),m.qZA()(),m.BQk()}}function st(L,Q){if(1&L){const N=m.EpF();m.ynx(0),m.TgZ(1,"ion-button",31),m.NdJ("click",function(){return m.CHM(N),m.oxw(2).launchNavigation()}),m._UZ(2,"ion-icon",32),m.TgZ(3,"ion-label"),m._uU(4,"Navigate"),m.qZA()(),m.BQk()}}function _t(L,Q){if(1&L){const N=m.EpF();m.ynx(0),m.TgZ(1,"ion-button",33),m.NdJ("click",function(){return m.CHM(N),m.oxw(2).addComment()}),m._UZ(2,"ion-icon",34),m.TgZ(3,"ion-label"),m._uU(4,"Add Comment"),m.qZA()(),m.BQk()}}function Yt(L,Q){if(1&L){const N=m.EpF();m.ynx(0),m.TgZ(1,"ion-button",35),m.NdJ("click",function(){return m.CHM(N),m.oxw(2).addMedia()}),m._UZ(2,"ion-icon",36),m.TgZ(3,"ion-label"),m._uU(4," Add Photo"),m.qZA()(),m.BQk()}}function xn(L,Q){if(1&L&&(m.TgZ(0,"div"),m._uU(1),m.qZA()),2&L){const N=m.oxw(4);m.xp6(1),m.hij(" ",N.poi.AddressInfo.AddressLine1,"")}}function Ht(L,Q){if(1&L&&(m.TgZ(0,"div"),m._uU(1),m.qZA()),2&L){const N=m.oxw(4);m.xp6(1),m.hij(" ",N.poi.AddressInfo.AddressLine2,"")}}function Nt(L,Q){if(1&L&&(m.TgZ(0,"div"),m._uU(1),m.qZA()),2&L){const N=m.oxw(4);m.xp6(1),m.hij(" ",N.poi.AddressInfo.Town,"")}}function Bt(L,Q){if(1&L&&(m.TgZ(0,"div"),m._uU(1),m.qZA()),2&L){const N=m.oxw(4);m.xp6(1),m.hij(" ",N.poi.AddressInfo.StateOrProvince,"")}}function Dt(L,Q){if(1&L&&(m.TgZ(0,"div"),m._uU(1),m.qZA()),2&L){const N=m.oxw(4);m.xp6(1),m.hij(" ",N.poi.AddressInfo.Postcode,"")}}function ht(L,Q){if(1&L&&(m.TgZ(0,"div"),m._uU(1),m.qZA()),2&L){const N=m.oxw(4);m.xp6(1),m.hij(" ",N.poi.AddressInfo.Country.Title,"")}}function Lt(L,Q){if(1&L&&(m.TgZ(0,"p"),m._uU(1),m.qZA()),2&L){const N=m.oxw(4);m.xp6(1),m.hij(" ",N.poi.AddressInfo.AccessComments," ")}}function _e(L,Q){if(1&L&&(m.TgZ(0,"p"),m._UZ(1,"ion-icon",48),m.TgZ(2,"span",45),m._uU(3),m.qZA()()),2&L){const N=m.oxw(4);m.xp6(3),m.Oqu(N.poi.AddressInfo.ContactTelephone1)}}function it(L,Q){if(1&L&&(m.TgZ(0,"p"),m._UZ(1,"ion-icon",48),m.TgZ(2,"span",45),m._uU(3),m.qZA()()),2&L){const N=m.oxw(4);m.xp6(3),m.Oqu(N.poi.AddressInfo.ContactTelephone2)}}function Ot(L,Q){if(1&L&&(m.TgZ(0,"p"),m._UZ(1,"ion-icon",49),m.TgZ(2,"span",45),m._uU(3),m.qZA()()),2&L){const N=m.oxw(4);m.xp6(3),m.Oqu(N.poi.AddressInfo.ContactEmail)}}function Qt(L,Q){if(1&L&&(m.TgZ(0,"p"),m._UZ(1,"ion-icon",50),m.TgZ(2,"span",45)(3,"a",51),m._uU(4),m.qZA()()()),2&L){const N=m.oxw(4);m.xp6(3),m.s9C("href",N.poi.AddressInfo.RelatedURL,m.LSH),m.xp6(1),m.Oqu(N.poi.AddressInfo.RelatedURL)}}function _n(L,Q){if(1&L&&(m.TgZ(0,"ion-card")(1,"ion-card-header"),m._UZ(2,"ion-icon",43),m._uU(3),m.ALo(4,"translate"),m.qZA(),m.TgZ(5,"ion-card-content")(6,"ion-grid")(7,"ion-row")(8,"ion-col")(9,"ion-label",44),m._uU(10),m.ALo(11,"translate"),m.qZA(),m.TgZ(12,"div",45),m.YNc(13,xn,2,1,"div",0),m.YNc(14,Ht,2,1,"div",0),m.YNc(15,Nt,2,1,"div",0),m.YNc(16,Bt,2,1,"div",0),m.YNc(17,Dt,2,1,"div",0),m.YNc(18,ht,2,1,"div",0),m.qZA()(),m.TgZ(19,"ion-col"),m.YNc(20,Lt,2,1,"p",0),m.YNc(21,_e,4,1,"p",0),m.YNc(22,it,4,1,"p",0),m.YNc(23,Ot,4,1,"p",0),m.YNc(24,Qt,5,2,"p",0),m.qZA()(),m.TgZ(25,"ion-row")(26,"ion-col"),m._UZ(27,"ion-icon",46),m.TgZ(28,"ion-label",47),m._uU(29),m.ALo(30,"number"),m.ALo(31,"number"),m.qZA()()()()()()),2&L){const N=m.oxw(3);m.xp6(3),m.hij(" ",m.lcZ(4,15,"ocm.details.location.sectionTitle")," "),m.xp6(7),m.hij(" ",m.lcZ(11,17,"ocm.details.location.address"),""),m.xp6(3),m.Q6J("ngIf",N.poi.AddressInfo.AddressLine1),m.xp6(1),m.Q6J("ngIf",N.poi.AddressInfo.AddressLine2),m.xp6(1),m.Q6J("ngIf",N.poi.AddressInfo.Town),m.xp6(1),m.Q6J("ngIf",N.poi.AddressInfo.StateOrProvince),m.xp6(1),m.Q6J("ngIf",N.poi.AddressInfo.Postcode),m.xp6(1),m.Q6J("ngIf",N.poi.AddressInfo.Country),m.xp6(2),m.Q6J("ngIf",N.poi.AddressInfo.AccessComments),m.xp6(1),m.Q6J("ngIf",N.poi.AddressInfo.ContactTelephone1),m.xp6(1),m.Q6J("ngIf",N.poi.AddressInfo.ContactTelephone2),m.xp6(1),m.Q6J("ngIf",N.poi.AddressInfo.ContactEmail),m.xp6(1),m.Q6J("ngIf",N.poi.AddressInfo.RelatedURL),m.xp6(5),m.AsE(" ",m.xi3(30,19,N.poi.AddressInfo.Latitude,"1.1-13")," , ",m.xi3(31,22,N.poi.AddressInfo.Longitude,"1.1-13")," ")}}function Tn(L,Q){if(1&L&&(m.TgZ(0,"p")(1,"span",44),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.TgZ(4,"span",45),m._uU(5),m.qZA()()),2&L){const N=m.oxw(3);m.xp6(2),m.hij("",m.lcZ(3,2,"ocm.details.numberOfPoints"),":"),m.xp6(3),m.Oqu(N.poi.NumberOfPoints)}}function mn(L,Q){if(1&L&&(m.TgZ(0,"p")(1,"span",44),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.TgZ(4,"span",45),m._uU(5),m.qZA()()),2&L){const N=m.oxw(3);m.xp6(2),m.hij("",m.lcZ(3,2,"ocm.details.operationalStatus"),":"),m.xp6(3),m.hij(" ",N.poi.StatusType.Title," ")}}function lt(L,Q){if(1&L&&(m.TgZ(0,"p")(1,"span",44),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.TgZ(4,"span",45),m._uU(5),m.qZA()()),2&L){const N=m.oxw(3);m.xp6(2),m.hij("",m.lcZ(3,2,"ocm.details.usageType"),":"),m.xp6(3),m.Oqu(N.poi.UsageType.Title)}}function qt(L,Q){if(1&L&&(m.TgZ(0,"p")(1,"span",44),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.TgZ(4,"span",45),m._uU(5),m.qZA()()),2&L){const N=m.oxw(3);m.xp6(2),m.hij("",m.lcZ(3,2,"ocm.details.usageCost"),":"),m.xp6(3),m.hij(" ",N.poi.UsageCost,"")}}function En(L,Q){if(1&L&&(m.TgZ(0,"p"),m._UZ(1,"br"),m._uU(2),m.ALo(3,"translate"),m._UZ(4,"br"),m.TgZ(5,"span",45),m._uU(6),m.qZA()()),2&L){const N=m.oxw(3);m.xp6(2),m.hij("",m.lcZ(3,2,"ocm.details.generalComments"),": "),m.xp6(4),m.Oqu(N.poi.GeneralComments)}}function yi(L,Q){if(1&L&&(m.TgZ(0,"p"),m._UZ(1,"ion-icon",54),m._uU(2),m.qZA()),2&L){const N=m.oxw(4);m.xp6(2),m.hij(" ",N.poi.OperatorInfo.WebsiteURL," ")}}function Ui(L,Q){if(1&L&&(m.TgZ(0,"p"),m._UZ(1,"ion-icon",49),m._uU(2),m.qZA()),2&L){const N=m.oxw(4);m.xp6(2),m.hij(" ",N.poi.OperatorInfo.ContactEmail," ")}}function Xi(L,Q){if(1&L&&(m.TgZ(0,"p"),m._UZ(1,"ion-icon",49),m._uU(2),m.qZA()),2&L){const N=m.oxw(4);m.xp6(2),m.hij(" ",N.poi.OperatorInfo.FaultReportEmail," ")}}function mr(L,Q){if(1&L&&(m.TgZ(0,"ion-card")(1,"ion-card-header"),m._UZ(2,"ion-icon",52),m._uU(3),m.ALo(4,"translate"),m.qZA(),m.TgZ(5,"ion-card-content")(6,"div",45)(7,"p",53),m._uU(8),m.qZA(),m.YNc(9,yi,3,1,"p",0),m.YNc(10,Ui,3,1,"p",0),m.YNc(11,Xi,3,1,"p",0),m.qZA()()()),2&L){const N=m.oxw(3);m.xp6(3),m.hij(" ",m.lcZ(4,5,"ocm.details.operator.sectionTitle")," "),m.xp6(5),m.hij(" ",N.poi.OperatorInfo.Title," "),m.xp6(1),m.Q6J("ngIf",N.poi.OperatorInfo.WebsiteURL),m.xp6(1),m.Q6J("ngIf",null!=N.poi.OperatorInfo.ContactEmail),m.xp6(1),m.Q6J("ngIf",null!=N.poi.OperatorInfo.FaultReportEmail&&N.poi.OperatorInfo.FaultReportEmail!=N.poi.OperatorInfo.ContactEmail)}}function di(L,Q){if(1&L){const N=m.EpF();m.TgZ(0,"a",56),m.NdJ("click",function(){m.CHM(N);const $e=m.oxw(4);return $e.launchURL($e.poi.DataProvider.WebsiteURL)}),m._uU(1),m.qZA()}if(2&L){const N=m.oxw(4);m.xp6(1),m.Oqu(N.poi.DataProvider.WebsiteURL)}}function Ai(L,Q){if(1&L&&(m.TgZ(0,"div",45)(1,"h3"),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.TgZ(4,"p"),m._uU(5),m.qZA(),m.YNc(6,di,2,1,"a",55),m.TgZ(7,"p"),m._uU(8),m.qZA()()),2&L){const N=m.oxw(3);m.xp6(2),m.hij(" ",m.lcZ(3,4,"ocm.details.dataProvider.sectionTitle")," "),m.xp6(3),m.Oqu(null==N.poi.DataProvider?null:N.poi.DataProvider.Title),m.xp6(1),m.Q6J("ngIf",N.poi.DataProvider.WebsiteURL),m.xp6(2),m.Oqu(null==N.poi.DataProvider?null:N.poi.DataProvider.License)}}function Hi(L,Q){if(1&L&&(m.TgZ(0,"div",37),m.YNc(1,_n,32,25,"ion-card",0),m.TgZ(2,"ion-card")(3,"ion-card-header"),m._UZ(4,"ion-icon",38),m._uU(5),m.ALo(6,"translate"),m.qZA(),m.TgZ(7,"ion-card-content"),m.YNc(8,Tn,6,4,"p",0),m._UZ(9,"app-equipment-details",39),m.qZA()(),m.TgZ(10,"ion-card")(11,"ion-card-header"),m._UZ(12,"ion-icon",40),m._uU(13," Usage Restrictions "),m.qZA(),m.TgZ(14,"ion-card-content"),m.YNc(15,mn,6,4,"p",0),m.YNc(16,lt,6,4,"p",0),m.YNc(17,qt,6,4,"p",0),m.YNc(18,En,7,4,"p",0),m.qZA()(),m.YNc(19,mr,12,7,"ion-card",0),m.TgZ(20,"ion-card")(21,"ion-card-header"),m._UZ(22,"ion-icon",41),m._uU(23),m.ALo(24,"translate"),m.qZA(),m.TgZ(25,"ion-card-content"),m.YNc(26,Ai,9,6,"div",42),m.qZA()()()),2&L){const N=m.oxw(2);m.xp6(1),m.Q6J("ngIf",N.poi.AddressInfo),m.xp6(4),m.hij(" ",m.lcZ(6,11,"ocm.details.equipment.sectionTitle")," "),m.xp6(3),m.Q6J("ngIf",null!=N.poi.NumberOfPoints),m.xp6(1),m.Q6J("item",N.poi),m.xp6(6),m.Q6J("ngIf",null!=N.poi.StatusType),m.xp6(1),m.Q6J("ngIf",null!=N.poi.UsageType),m.xp6(1),m.Q6J("ngIf",null!=N.poi.UsageCost),m.xp6(1),m.Q6J("ngIf",null!=N.poi.GeneralComments),m.xp6(1),m.Q6J("ngIf",N.poi.OperatorInfo),m.xp6(4),m.hij(" ",m.lcZ(24,13,"ocm.details.advancedDetails")," "),m.xp6(3),m.Q6J("ngIf",N.poi.DataProvider)}}function ri(L,Q){if(1&L&&m._UZ(0,"img",60),2&L){const N=m.oxw().$implicit;m.s9C("src",null==N.User?null:N.User.ProfileImageURL,m.LSH)}}function on(L,Q){if(1&L&&(m.TgZ(0,"span"),m._uU(1),m.qZA()),2&L){const N=m.oxw().$implicit;m.xp6(1),m.Oqu(N.User.Username)}}function It(L,Q){if(1&L&&(m.TgZ(0,"span"),m._uU(1),m.qZA()),2&L){const N=m.oxw().$implicit;m.xp6(1),m.Oqu(N.Username)}}function qe(L,Q){if(1&L&&(m.TgZ(0,"p",45),m._uU(1),m.qZA()),2&L){const N=m.oxw().$implicit;m.xp6(1),m.hij(" ",null==N.CommentType?null:N.CommentType.Title," ")}}function dt(L,Q){if(1&L&&(m.TgZ(0,"p")(1,"span",44),m._uU(2,"Rating:"),m.qZA(),m.TgZ(3,"span",45),m._uU(4),m.qZA()()),2&L){const N=m.oxw().$implicit;m.xp6(4),m.hij("",N.Rating," out of 5")}}function Wt(L,Q){1&L&&(m.ynx(0),m._UZ(1,"ion-icon",61),m.BQk())}function de(L,Q){1&L&&(m.ynx(0),m._UZ(1,"ion-icon",62),m.BQk())}function Je(L,Q){if(1&L&&(m.TgZ(0,"p"),m.YNc(1,Wt,2,0,"ng-container",0),m.YNc(2,de,2,0,"ng-container",0),m._uU(3),m.qZA()),2&L){const N=m.oxw().$implicit;m.xp6(1),m.Q6J("ngIf",!0===N.CheckinStatusType.IsPositive),m.xp6(1),m.Q6J("ngIf",!1===N.CheckinStatusType.IsPositive),m.xp6(1),m.hij(" ",N.CheckinStatusType.Title," ")}}function $t(L,Q){if(1&L&&(m.TgZ(0,"ion-card")(1,"ion-item")(2,"ion-avatar",19),m.YNc(3,ri,1,1,"img",59),m.qZA(),m.TgZ(4,"ion-label"),m.YNc(5,on,2,1,"span",0),m.YNc(6,It,2,1,"span",0),m.qZA(),m.TgZ(7,"ion-label",20),m._uU(8),m.ALo(9,"date"),m.qZA()(),m.TgZ(10,"ion-card-content")(11,"p"),m._uU(12),m.qZA(),m.YNc(13,qe,2,1,"p",42),m.YNc(14,dt,5,1,"p",0),m.YNc(15,Je,4,3,"p",0),m.qZA()()),2&L){const N=Q.$implicit;m.xp6(3),m.Q6J("ngIf",N.User&&N.User.ProfileImageURL),m.xp6(2),m.Q6J("ngIf",N.User),m.xp6(1),m.Q6J("ngIf",!N.User),m.xp6(2),m.hij(" ",m.lcZ(9,8,N.DateCreated)," "),m.xp6(4),m.Oqu(N.Comment),m.xp6(1),m.Q6J("ngIf",10!=N.CommentTypeID),m.xp6(1),m.Q6J("ngIf",N.Rating),m.xp6(1),m.Q6J("ngIf",N.CheckinStatusType)}}function dn(L,Q){if(1&L&&(m.ynx(0),m.YNc(1,$t,16,10,"ion-card",58),m.BQk()),2&L){const N=m.oxw(3);m.xp6(1),m.Q6J("ngForOf",N.poi.UserComments)}}function Qn(L,Q){1&L&&(m.TgZ(0,"p",21),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&L&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"ocm.details.commentsAndRatings.zeroComments")," "))}function Qi(L,Q){if(1&L&&(m.TgZ(0,"div"),m.YNc(1,dn,2,1,"ng-container",0),m.YNc(2,Qn,3,3,"p",57),m.qZA()),2&L){const N=m.oxw(2);m.xp6(1),m.Q6J("ngIf",1==N.poi._hasComments),m.xp6(1),m.Q6J("ngIf",0==N.poi._hasComments)}}function nr(L,Q){if(1&L&&m._UZ(0,"img",60),2&L){const N=m.oxw().$implicit;m.s9C("src",null==N.User?null:N.User.ProfileImageURL,m.LSH)}}function _r(L,Q){if(1&L&&(m.TgZ(0,"span"),m._uU(1),m.qZA()),2&L){const N=m.oxw().$implicit;m.xp6(1),m.Oqu(N.User.Username)}}function wi(L,Q){if(1&L&&(m.TgZ(0,"span"),m._uU(1),m.qZA()),2&L){const N=m.oxw().$implicit;m.xp6(1),m.Oqu(N.Username)}}function Di(L,Q){if(1&L&&(m.TgZ(0,"ion-card"),m._UZ(1,"img",60),m.TgZ(2,"ion-item")(3,"ion-avatar",19),m.YNc(4,nr,1,1,"img",59),m.qZA(),m.TgZ(5,"ion-label"),m.YNc(6,_r,2,1,"span",0),m.YNc(7,wi,2,1,"span",0),m.qZA(),m.TgZ(8,"ion-label",20),m._uU(9),m.ALo(10,"date"),m.qZA()(),m.TgZ(11,"ion-card-content")(12,"p"),m._uU(13),m.qZA()()()),2&L){const N=Q.$implicit;m.xp6(1),m.s9C("src",N.ItemMediumURL,m.LSH),m.xp6(3),m.Q6J("ngIf",N.User&&N.User.ProfileImageURL),m.xp6(2),m.Q6J("ngIf",N.User),m.xp6(1),m.Q6J("ngIf",!N.User),m.xp6(2),m.hij(" ",m.lcZ(10,6,N.DateCreated)," "),m.xp6(4),m.Oqu(N.Comment)}}function xi(L,Q){if(1&L&&(m.TgZ(0,"div"),m.YNc(1,Di,14,8,"ion-card",58),m.qZA()),2&L){const N=m.oxw(3);m.xp6(1),m.Q6J("ngForOf",N.poi.MediaItems)}}function Xr(L,Q){1&L&&(m.TgZ(0,"div",21)(1,"p",63),m._uU(2),m.ALo(3,"translate"),m.qZA()()),2&L&&(m.xp6(2),m.hij(" ",m.lcZ(3,1,"ocm.details.mediaItems.addPrompt"),""))}function $i(L,Q){if(1&L&&(m.TgZ(0,"div"),m.YNc(1,xi,2,1,"div",0),m.YNc(2,Xr,4,3,"div",57),m.qZA()),2&L){const N=m.oxw(2);m.xp6(1),m.Q6J("ngIf",N.poi._hasPhotos),m.xp6(1),m.Q6J("ngIf",!N.poi._hasPhotos)}}function Oi(L,Q){if(1&L&&(m.TgZ(0,"p",64),m._uU(1),m.qZA()),2&L){const N=m.oxw(2);m.xp6(1),m.hij(" ",N.json,"")}}function Wr(L,Q){if(1&L){const N=m.EpF();m.TgZ(0,"div")(1,"div",1)(2,"div",2)(3,"h2"),m._uU(4),m.qZA(),m.TgZ(5,"div")(6,"small"),m._uU(7),m.qZA()(),m.YNc(8,ye,3,1,"div",0),m.YNc(9,Ae,3,1,"div",0),m.TgZ(10,"ion-badge",3),m._uU(11),m.ALo(12,"number"),m.qZA()(),m.TgZ(13,"ion-fab",4)(14,"ion-fab-button"),m._UZ(15,"ion-icon",5),m.qZA(),m.TgZ(16,"ion-fab-list",6)(17,"ion-fab-button",7),m.NdJ("click",function(){return m.CHM(N),m.oxw().addComment()}),m._UZ(18,"ion-icon",8),m.qZA(),m.TgZ(19,"ion-fab-button",9),m.NdJ("click",function(){return m.CHM(N),m.oxw().addMedia()}),m._UZ(20,"ion-icon",10),m.qZA(),m.TgZ(21,"ion-fab-button",11),m.NdJ("click",function(){return m.CHM(N),m.oxw().addFavourite()}),m._UZ(22,"ion-icon",12),m.qZA(),m.TgZ(23,"ion-fab-button",13),m.NdJ("click",function(){return m.CHM(N),m.oxw().edit()}),m._UZ(24,"ion-icon",14),m.qZA(),m.TgZ(25,"ion-fab-button",15),m.NdJ("click",function(){return m.CHM(N),m.oxw().refresh()}),m._UZ(26,"ion-icon",16),m.qZA()()()(),m.TgZ(27,"ion-refresher",17),m.NdJ("ionRefresh",function($e){return m.CHM(N),m.oxw().refresh($e)}),m._UZ(28,"ion-refresher-content",18),m.qZA(),m.TgZ(29,"ion-toolbar")(30,"ion-buttons",19),m.YNc(31,Be,9,0,"ng-container",0),m.qZA(),m.TgZ(32,"ion-buttons",20),m.YNc(33,st,5,0,"ng-container",0),m.YNc(34,_t,5,0,"ng-container",0),m.YNc(35,Yt,5,0,"ng-container",0),m.qZA()(),m.TgZ(36,"div",21)(37,"ion-segment",22),m.NdJ("ngModelChange",function($e){return m.CHM(N),m.oxw().selectedTab=$e}),m.TgZ(38,"ion-segment-button",23)(39,"ion-label"),m._uU(40," Details "),m.qZA()(),m.TgZ(41,"ion-segment-button",24)(42,"ion-label"),m._uU(43),m.qZA()(),m.TgZ(44,"ion-segment-button",25)(45,"ion-label"),m._uU(46),m.qZA()()()(),m.YNc(47,Hi,27,15,"div",26),m.YNc(48,Qi,3,2,"div",0),m.YNc(49,$i,3,2,"div",0),m.YNc(50,Oi,2,1,"p",27),m.qZA()}if(2&L){const N=m.oxw();m.xp6(1),m.Udp("background-image",N.backdropImage?"url("+N.backdropImage+")":""),m.xp6(3),m.hij(" ",N.poi.AddressInfo.Title," "),m.xp6(3),m.hij("OCM-",N.poi.ID,""),m.xp6(1),m.Q6J("ngIf",N.connectionSummary),m.xp6(1),m.Q6J("ngIf",N.poi.OperatorInfo),m.xp6(2),m.Oqu(m.xi3(12,18,N.avgRating,"1.1-1")),m.xp6(20),m.Q6J("ngIf","location"==N.selectedTab),m.xp6(2),m.Q6J("ngIf","location"==N.selectedTab),m.xp6(1),m.Q6J("ngIf","comments"==N.selectedTab),m.xp6(1),m.Q6J("ngIf","media"==N.selectedTab),m.xp6(2),m.Q6J("ngModel",N.selectedTab),m.xp6(6),m.hij("Comments (",N.poi.UserComments?N.poi.UserComments.length:0,")"),m.xp6(3),m.hij(" Photos (",N.poi.MediaItems?N.poi.MediaItems.length:0,")"),m.xp6(1),m.Q6J("ngIf","location"==N.selectedTab),m.xp6(1),m.Q6J("ngIf","comments"==N.selectedTab),m.xp6(1),m.Q6J("ngIf","media"==N.selectedTab),m.xp6(1),m.Q6J("ngIf",1==N.appManager.isDebugMode)}}function ar(L,Q){1&L&&(m.TgZ(0,"div")(1,"h2"),m._uU(2,"POI Not Found"),m.qZA(),m.TgZ(3,"p"),m._uU(4,"The POI details could not be loaded."),m.qZA()())}let Ci=(()=>{class L{constructor(N,pe,$e,gt,Tt,Ct,Et,ln){this.appManager=N,this.nav=pe,this.translate=$e,this.logging=gt,this.modalController=Tt,this.actionSheetController=Ct,this.poiManager=Et,this.router=ln,this.hasNavBar=!1}ngOnChanges(N){if(this.logging.log("In ngOnChanges of POI Details"),null!=this.poi&&null!=this.poi.AddressInfo){if(this.selectedTab="location",null!=this.poi.MediaItems&&this.poi.MediaItems.length>0){this.poi._hasPhotos=!0;for(let pe of this.poi.MediaItems)pe.ItemMediumURL=pe.ItemThumbnailURL.replace(".thmb.",".medi.");this.backdropImage=this.poi.MediaItems[this.poi.MediaItems.length-1].ItemThumbnailURL.replace(".thmb.",".medi.")}else this.poi._hasPhotos=!1,this.backdropImage=null;if(null!=this.poi.UserComments&&this.poi.UserComments.length>0){this.poi._hasComments=!0;try{let pe=this.poi.UserComments.filter($e=>$e.Rating>0);if(pe.length>0){let $e=0;for(let gt of pe)$e+=gt.Rating;this.avgRating=$e/pe.length}else this.avgRating=null}catch{}}else this.poi._hasComments=!1;if(this.poi.Connections&&this.poi.Connections.length>0){let pe="";for(let $e of this.poi.Connections)-1==pe.indexOf($e.ConnectionType.Title)&&(pe+=(""!=pe?", ":"")+$e.ConnectionType.Title);this.connectionSummary=pe}}}ngOnInit(){this.logging.log("In ngInit of POI Details")}get staticMapURL(){return"https://maps.googleapis.com/maps/api/staticmap?key="+(new Qe.X).googleMapsAPIKey+"&center="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude}get staticMapSize(){return 0===this.appManager.clientWidth?"240x100":this.appManager.clientWidth>=800?"640x100":this.appManager.clientWidth>=400?"400x100":"240x100"}continueAddComment(){var N=this;return(0,l.Z)(function*(){const pe=yield N.modalController.create({component:We,componentProps:{id:N.poi.ID,poi:N.poi}});setTimeout(()=>{N.refresh()},1e3),yield pe.present()})()}addComment(){var N=this;return(0,l.Z)(function*(){if(N.appManager.isUserAuthenticated(!0))yield N.continueAddComment();else{const pe=yield N.modalController.create({component:me.F});pe.onDidDismiss().then((0,l.Z)(function*(){N.appManager.isUserAuthenticated(!0)&&(yield N.continueAddComment())})),yield pe.present()}})()}continueAddMedia(){var N=this;return(0,l.Z)(function*(){const pe=yield N.modalController.create({component:Ue,componentProps:{id:N.poi.ID,poi:N.poi}});pe.onDidDismiss().then(()=>{setTimeout(()=>{N.refresh()},1e3)}),yield pe.present()})()}addMedia(){var N=this;return(0,l.Z)(function*(){if(N.appManager.isUserAuthenticated(!0))yield N.continueAddMedia();else{const pe=yield N.modalController.create({component:me.F});pe.onDidDismiss().then((0,l.Z)(function*(){N.appManager.isUserAuthenticated(!0)&&(yield N.continueAddMedia())})),yield pe.present()}})()}addFavourite(){var N=this;return(0,l.Z)(function*(){yield(yield N.actionSheetController.create({header:"Add Favourite",buttons:[{text:"Add to Journey",handler:()=>{N.modalController.create({component:se,componentProps:{poi:N.poi}}).then($e=>$e.present())}},{text:"Cancel",role:"cancel",handler:()=>{}}]})).present()})()}launchNavigation(){this.appManager.isPlatform("ios")?this.appManager.launchWebPage("https://maps.apple.com/?ll="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude):this.appManager.launchWebPage("https://maps.google.com/?q="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude)}launchURL(N){this.appManager.launchWebPage(N)}continueEdit(){var N=this;return(0,l.Z)(function*(){const pe=yield N.modalController.create({component:Ze.Y,componentProps:{id:N.poi.ID}});return pe.onDidDismiss().then($e=>{N.refresh()}),yield pe.present()})()}edit(){var N=this;return(0,l.Z)(function*(){if(Pe.c.isFeatureEnabled("EDIT_POI"))if(N.appManager.isUserAuthenticated(!0))yield N.continueEdit();else{const pe=yield N.modalController.create({component:me.F});pe.onDidDismiss().then((0,l.Z)(function*(){N.appManager.isUserAuthenticated(!0)&&(yield N.continueEdit())})),yield pe.present()}else N.appManager.launchOCMWebPage("/poi/edit/"+N.poi.ID)})()}refresh(N=null){this.poi&&this.poiManager.getPOIById(this.poi.ID,!0,!0).then(pe=>{pe&&(this.poi=pe,this.ngOnChanges(null)),N&&N.target.complete()})}}return L.\u0275fac=function(N){return new(N||L)(m.Y36(d.c),m.Y36(ce.SH),m.Y36(Ge.sK),m.Y36(Ie.z),m.Y36(ce.IN),m.Y36(ce.BX),m.Y36(ve.R),m.Y36(Ne.F0))},L.\u0275cmp=m.Xpm({type:L,selectors:[["poi-details"]],inputs:{poi:"poi"},features:[m.TTD],decls:2,vars:2,consts:[[4,"ngIf"],[1,"banner"],[1,"banner-content"],["color","primary","title","Average User Rating"],["vertical","top","horizontal","end","slot","fixed"],["name","add"],["side","bottom"],["title","Add a comment or charging check-in",3,"click"],["name","chatbubbles"],["title","Add a Photo",3,"click"],["name","camera"],["title","Add to Favourites",3,"click"],["name","star"],["title","Submit an Edit",3,"click"],["name","create"],["title","Refresh",3,"click"],["name","refresh"],["slot","fixed",3,"ionRefresh"],["pullingIcon","caret-down","pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refreshing..."],["slot","start"],["slot","end"],[1,"ion-padding"],[3,"ngModel","ngModelChange"],["value","location","selected",""],["value","comments"],["value","media"],["class","address-details",4,"ngIf"],["style","white-space: pre-wrap;",4,"ngIf"],["size","small","title","Add to Favourites",3,"click"],["name","star","slot","start"],["name","create","slot","start"],[3,"click"],["name","navigate","slot","start"],["size","small","title","Add a comment or charging check-in",3,"click"],["name","chatbubbles","slot","start"],["size","small","title","Add a Photo",3,"click"],["name","camera","slot","start"],[1,"address-details"],["name","battery-charging"],[3,"item"],["name","book"],["name","information-circle"],["class","details",4,"ngIf"],["name","map"],[1,"label"],[1,"details"],["name","pin"],[1,"details-minor"],["name","call"],["name","mail"],["name","globe"],["target","_system",3,"href"],["name","help-circle"],[1,"ion-padding-left"],["name","link"],["href","javascript:void(0)",3,"click",4,"ngIf"],["href","javascript:void(0)",3,"click"],["class","ion-padding",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"src",4,"ngIf"],[3,"src"],["name","checkmark-circle","color","success",2,"font-size","2em"],["name","close-circle","color","danger"],[1,"subtle"],[2,"white-space","pre-wrap"]],template:function(N,pe){1&N&&(m.YNc(0,Wr,51,21,"div",0),m.YNc(1,ar,5,0,"div",0)),2&N&&(m.Q6J("ngIf",null!=pe.poi&&null!=pe.poi.AddressInfo),m.xp6(1),m.Q6J("ngIf",null==pe.poi||null==pe.poi.AddressInfo))},directives:[ne.O5,ce.yp,ce.IJ,ce.W4,ce.gu,ce.zq,ce.nJ,ce.Wo,ce.sr,ce.Sm,ce.YG,ce.Q$,ce.cJ,ce.QI,v.JJ,v.On,ce.GO,ce.PM,ce.Zi,ce.FN,ce.jY,ce.Nd,ce.wI,tt.B,ne.sg,ce.Ie,ce.BJ],pipes:[ne.JJ,Ge.X$,ne.uU],styles:[".banner[_ngcontent-%COMP%]{background-color:#4f712f;color:#ffffffec;padding:1em;text-shadow:#000 1px 1px 1px;min-height:180px;background-size:cover}.banner[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.banner-content[_ngcontent-%COMP%]{padding-right:48px}h3[_ngcontent-%COMP%]{font-weight:700}.label[_ngcontent-%COMP%]{color:#000;font-weight:700;font-size:12px}.details[_ngcontent-%COMP%]{color:#707d61;margin-left:1em;font-size:12px}.details-minor[_ngcontent-%COMP%]{color:#707d61;font-size:12px}p[_ngcontent-%COMP%]{display:block;padding:4px}ion-card-header[_ngcontent-%COMP%]{font-weight:700;padding-bottom:0}ion-card-content[_ngcontent-%COMP%]{padding-top:4px}"]}),L})(),je=(()=>{class L{constructor(N,pe,$e){this.modalController=N,this.navParams=pe,this.appManager=$e,this.hasNavbar=!1,this.poi=this.navParams.get("item"),this.appManager.analytics.viewEvent("POIDetails")}close(){this.modalController.dismiss()}}return L.\u0275fac=function(N){return new(N||L)(m.Y36(ce.IN),m.Y36(ce.X1),m.Y36(d.c))},L.\u0275cmp=m.Xpm({type:L,selectors:[["ng-component"]],decls:11,vars:3,consts:[["color","primary"],["slot","start"],[3,"click"],["name","close","slot","icon-only"],[1,"poi-details"],[3,"poi"]],template:function(N,pe){1&N&&(m.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),m._uU(3),m.TgZ(4,"small"),m._uU(5),m.qZA()(),m.TgZ(6,"ion-buttons",1)(7,"ion-button",2),m.NdJ("click",function(){return pe.close()}),m._UZ(8,"ion-icon",3),m.qZA()()()(),m.TgZ(9,"ion-content",4),m._UZ(10,"poi-details",5),m.qZA()),2&N&&(m.xp6(3),m.hij(" ",pe.poi.AddressInfo.Title," "),m.xp6(2),m.hij("OCM-",pe.poi.ID,""),m.xp6(5),m.Q6J("poi",pe.poi))},directives:[ce.Gu,ce.sr,ce.wd,ce.Sm,ce.YG,ce.gu,ce.W2,Ci],styles:['.left-col[_ngcontent-%COMP%]{float:left;width:50%;overflow:auto}.right-col[_ngcontent-%COMP%]{float:right;width:50%;overflow:auto}.row[_ngcontent-%COMP%]:after{content:"";display:table;clear:both;overflow:auto}.row[_ngcontent-%COMP%]{margin-bottom:1em}.subtle[_ngcontent-%COMP%]{color:silver}@media screen and (max-width: 768px){.left-col[_ngcontent-%COMP%]{float:none;width:100%}.right-col[_ngcontent-%COMP%]{margin-top:1em;float:none;width:100%}}.address-details[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:200px;width:auto}ion-label[_ngcontent-%COMP%]{overflow:inherit}ion-title[_ngcontent-%COMP%] > small[_ngcontent-%COMP%]{color:#ffffffbf}']}),L})()},1948:(Ln,At,k)=>{"use strict";k.r(At),k.d(At,{PoiEditorPageModule:()=>ge});var d=k(6895),m=k(4006),ce=k(6014),l=k(9634),ie=k(4508),re=k(4463),v=k(8936),ne=k(8274);const De=[{path:"",component:ie.Y}];let ge=(()=>{class X{}return X.\u0275fac=function(se){return new(se||X)},X.\u0275mod=ne.oAB({type:X}),X.\u0275inj=ne.cJS({imports:[[d.ez,m.u5,l.Pc,re.aw,v.e,ce.Bz.forChild(De)]]}),X})()},4508:(Ln,At,k)=>{"use strict";k.d(At,{Y:()=>qe});var d=k(9671),m=k(3855),ce=k(8016),l=k(6579),ie=k(9698),re=k(4781),v=k(8274),ne=k(4120),De=k(5906),ge=k(553),X=k(7689),ue=k(6260),se=k(529),Ie=k(6895),we=k(9634);function Ue(dt,Wt){if(1&dt){const de=v.EpF();v.ynx(0),v.TgZ(1,"ion-note")(2,"p"),v._uU(3," The closest address to this position is: "),v.qZA(),v.TgZ(4,"p")(5,"strong"),v._uU(6),v.qZA(),v._UZ(7,"br"),v._uU(8),v._UZ(9,"br"),v.TgZ(10,"ion-button",3),v.NdJ("click",function(){return v.CHM(de),v.oxw().useAddressSelection()}),v._uU(11,"Use this address below "),v._UZ(12,"ion-icon",4),v.qZA()()(),v.BQk()}if(2&dt){const de=v.oxw();v.xp6(6),v.Oqu(de.suggestedAddress.AddressLine1),v.xp6(2),v.HOy(" ",de.suggestedAddress.AddressLine2," ",de.suggestedAddress.Town," ",de.suggestedAddress.StateOrProvince," ",de.suggestedAddress.Postcode," ")}}let Ne=(()=>{class dt{constructor(de,Je,$t,dn,Qn){this.mapping=de,this.events=Je,this.logging=$t,this.http=dn,this.appManager=Qn,this.latitudeChange=new v.vpe,this.longitudeChange=new v.vpe,this.suggestedAddress=null,this.suggestedAddressChange=new v.vpe,this.onUseSuggestedAddress=new v.vpe,this.suggestedAddressAttribution=null,this.suggestedAddressAttributionChange=new v.vpe,this.isMapInitialised=!1}ngOnInit(){this.mapService=new ge.k(this.events,this.logging,this.http),this.mapService.initAPI(),this.mapOptions=new De._,this.mapOptions.mapType=this.appManager.searchSettings.MapType,this.mapOptions.onMapMoveCompleted=()=>{let de;de=this.mapService.getMapCenter(),de.subscribe(Je=>{Je&&(this.latitude=Je.coords.latitude,this.longitude=Je.coords.longitude,this.latitudeChange.emit(this.latitude),this.longitudeChange.emit(this.longitude),this.getAddressForCurrentLatLng())})}}ngAfterContentInit(){this.focusMap()}ngOnDestroy(){this.mapService.disposeMap()}focusMap(){0==this.isMapInitialised&&this.mapService&&0!=this.latitude&&0!=this.longitude&&(this.isMapInitialised=!0,this.mapService.initMap("editor-map",this.mapOptions,null),this.mapService.setMapCenter(new ne.jR(this.latitude,this.longitude)),this.originalMarkerPos=new ne.wC(this.latitude,this.longitude))}ngOnChanges(de){this.focusMap()}getAddressForCurrentLatLng(){var de=this;return(0,d.Z)(function*(){de.latitude&&de.longitude&&de.appManager.api.fetchReverseGeocodeResult(de.latitude,de.longitude).then(Je=>{Je.AddressInfo&&(de.suggestedAddress=Je.AddressInfo)})})()}useAddressSelection(){this.onUseSuggestedAddress.emit({suggestedAddress:this.suggestedAddress,attribution:this.suggestedAddressAttribution}),this.suggestedAddress=null,this.suggestedAddressAttribution=null}}return dt.\u0275fac=function(de){return new(de||dt)(v.Y36(re.v),v.Y36(ue.z),v.Y36(X.z),v.Y36(se.eN),v.Y36(m.c))},dt.\u0275cmp=v.Xpm({type:dt,selectors:[["app-poi-location-editor"]],inputs:{latitude:"latitude",longitude:"longitude"},outputs:{latitudeChange:"latitudeChange",longitudeChange:"longitudeChange",suggestedAddressChange:"suggestedAddressChange",onUseSuggestedAddress:"onUseSuggestedAddress",suggestedAddressAttributionChange:"suggestedAddressAttributionChange"},features:[v.TTD],decls:4,vars:1,consts:[[1,"instruction"],["id","editor-map"],[4,"ngIf"],["size","small",3,"click"],["slot","end","name","copy"]],template:function(de,Je){1&de&&(v.TgZ(0,"p",0),v._uU(1,"Drag the map to center the marker on the charging location:"),v.qZA(),v._UZ(2,"div",1),v.YNc(3,Ue,13,5,"ng-container",2)),2&de&&(v.xp6(3),v.Q6J("ngIf",Je.suggestedAddress))},directives:[Ie.O5,we.uN,we.YG,we.gu],styles:["#editor-map[_ngcontent-%COMP%]{border:1px solid gainsboro;background-color:gray;width:100%;height:128px}"]}),dt})();var ke=k(6799),He=k(4006);function We(dt,Wt){if(1&dt&&(v.TgZ(0,"ion-select-option",14),v._uU(1),v.qZA()),2&dt){const de=Wt.$implicit;v.Q6J("value",de.ID),v.xp6(1),v.Oqu(de.Title)}}function Qe(dt,Wt){if(1&dt&&(v.TgZ(0,"ion-select-option",14),v._uU(1),v.qZA()),2&dt){const de=Wt.$implicit;v.Q6J("value",de.ID),v.xp6(1),v.Oqu(de.Title)}}function ve(dt,Wt){if(1&dt&&(v.TgZ(0,"ion-select-option",14),v._uU(1),v.qZA()),2&dt){const de=Wt.$implicit;v.Q6J("value",de.ID),v.xp6(1),v.Oqu(de.Title)}}let me=(()=>{class dt{constructor(de,Je){this.modalController=de,this.referenceDataManager=Je,this.useFilteredConnectionTypes=!0,this.useFilteredOperators=!0}get isAddMode(){return!(null!=this.conn&&this.conn.ID>0)}get connectionTypes(){return this.referenceDataManager.getConnectionTypes(this.useFilteredConnectionTypes)}get currentTypes(){return this.referenceDataManager.getOutputCurrentTypes()}get statusTypes(){return this.referenceDataManager.getStatusTypes().filter(de=>1==de.IsUserSelectable)}ngOnInit(){}save(){this.modalController.dismiss({item:this.conn})}cancel(){this.modalController.dismiss()}}return dt.\u0275fac=function(de){return new(de||dt)(v.Y36(we.IN),v.Y36(ke.W))},dt.\u0275cmp=v.Xpm({type:dt,selectors:[["app-poi-equipment-editor"]],decls:60,vars:13,consts:[[1,"ion-padding"],["position","floating"],[3,"ngModel","ngModelChange"],["value","0"],[3,"value",4,"ngFor","ngForOf"],["type","number",3,"ngModel","ngModelChange"],["type","text","placeholder","(optional) other comments",3,"ngModel","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],["slot","start"],[3,"click"],["name","close","slot","start"],["slot","end"],["color","success",3,"click"],["name","send","slot","end"],[3,"value"]],template:function(de,Je){1&de&&(v.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),v._uU(3),v.qZA()()(),v.TgZ(4,"ion-content",0)(5,"p"),v._uU(6,"Please provide as much information as you can about the equipment. If you don't know then leave the field blank. At a minimum you should include the Connection Type and approximate Power kW (max)."),v.qZA(),v.TgZ(7,"ion-item")(8,"ion-label",1),v._uU(9,"Connection Type"),v.qZA(),v.TgZ(10,"ion-select",2),v.NdJ("ngModelChange",function(dn){return Je.conn.ConnectionTypeID=dn}),v.TgZ(11,"ion-select-option",3),v._uU(12,"Unknown"),v.qZA(),v.YNc(13,We,2,2,"ion-select-option",4),v.qZA()(),v.TgZ(14,"ion-item")(15,"ion-label",1),v._uU(16,"Supply Type"),v.qZA(),v.TgZ(17,"ion-select",2),v.NdJ("ngModelChange",function(dn){return Je.conn.CurrentTypeID=dn}),v.TgZ(18,"ion-select-option",3),v._uU(19,"Unknown"),v.qZA(),v.YNc(20,Qe,2,2,"ion-select-option",4),v.qZA()(),v.TgZ(21,"ion-item")(22,"ion-label",1),v._uU(23,"Power (kW)"),v.qZA(),v.TgZ(24,"ion-input",5),v.NdJ("ngModelChange",function(dn){return Je.conn.PowerKW=dn}),v.qZA()(),v.TgZ(25,"ion-item")(26,"ion-label",1),v._uU(27,"Amps"),v.qZA(),v.TgZ(28,"ion-input",5),v.NdJ("ngModelChange",function(dn){return Je.conn.Amps=dn}),v.qZA()(),v.TgZ(29,"ion-item")(30,"ion-label",1),v._uU(31,"Voltage"),v.qZA(),v.TgZ(32,"ion-input",5),v.NdJ("ngModelChange",function(dn){return Je.conn.Voltage=dn}),v.qZA()(),v.TgZ(33,"ion-item")(34,"ion-label",1),v._uU(35,"Status"),v.qZA(),v.TgZ(36,"ion-select",2),v.NdJ("ngModelChange",function(dn){return Je.conn.StatusTypeID=dn}),v.YNc(37,ve,2,2,"ion-select-option",4),v.qZA()(),v.TgZ(38,"ion-item")(39,"ion-label",1),v._uU(40,"Quantity Available"),v.qZA(),v.TgZ(41,"ion-input",5),v.NdJ("ngModelChange",function(dn){return Je.conn.Quantity=dn}),v.qZA()(),v.TgZ(42,"ion-item")(43,"ion-label",1),v._uU(44,"Comment"),v.qZA(),v.TgZ(45,"ion-input",6),v.NdJ("ngModelChange",function(dn){return Je.conn.Comments=dn}),v.qZA()(),v.TgZ(46,"ion-item")(47,"ion-label",1),v._uU(48,"Operators Reference"),v.qZA(),v.TgZ(49,"ion-input",7),v.NdJ("ngModelChange",function(dn){return Je.conn.Reference=dn}),v.qZA()()(),v.TgZ(50,"ion-footer")(51,"ion-toolbar")(52,"ion-buttons",8)(53,"ion-button",9),v.NdJ("click",function(){return Je.cancel()}),v._UZ(54,"ion-icon",10),v._uU(55," Cancel "),v.qZA()(),v.TgZ(56,"ion-buttons",11)(57,"ion-button",12),v.NdJ("click",function(){return Je.save()}),v._uU(58," OK "),v._UZ(59,"ion-icon",13),v.qZA()()()()),2&de&&(v.xp6(3),v.Oqu(Je.isAddMode?"Add Equipment":"Edit Equipment"),v.xp6(7),v.Q6J("ngModel",Je.conn.ConnectionTypeID),v.xp6(3),v.Q6J("ngForOf",Je.connectionTypes),v.xp6(4),v.Q6J("ngModel",Je.conn.CurrentTypeID),v.xp6(3),v.Q6J("ngForOf",Je.currentTypes),v.xp6(4),v.Q6J("ngModel",Je.conn.PowerKW),v.xp6(4),v.Q6J("ngModel",Je.conn.Amps),v.xp6(4),v.Q6J("ngModel",Je.conn.Voltage),v.xp6(4),v.Q6J("ngModel",Je.conn.StatusTypeID),v.xp6(1),v.Q6J("ngForOf",Je.statusTypes),v.xp6(4),v.Q6J("ngModel",Je.conn.Quantity),v.xp6(4),v.Q6J("ngModel",Je.conn.Comments),v.xp6(4),v.Q6J("ngModel",Je.conn.Reference))},directives:[we.Gu,we.sr,we.wd,we.W2,we.Ie,we.Q$,we.t9,we.QI,He.JJ,He.On,we.n0,Ie.sg,we.pK,we.as,we.j9,we.fr,we.Sm,we.YG,we.gu],styles:[""]}),dt})();var Ze=(()=>{return(dt=Ze||(Ze={}))[dt.Unknown=0]="Unknown",dt[dt.CurrentlyAvailable=10]="CurrentlyAvailable",dt[dt.CurrentlyInUse=20]="CurrentlyInUse",dt[dt.TemporarilyUnavailable=30]="TemporarilyUnavailable",dt[dt.Operational=50]="Operational",dt[dt.PartlyOperational=75]="PartlyOperational",dt[dt.NotOperational=100]="NotOperational",dt[dt.PlannedForFutureDate=150]="PlannedForFutureDate",dt[dt.RemovedDecomissioned=200]="RemovedDecomissioned",Ze;var dt})(),Pe=(()=>{return(dt=Pe||(Pe={}))[dt.UnknownOperator=1]="UnknownOperator",dt[dt.SiteOwner=45]="SiteOwner",Pe;var dt})(),ye=k(6585);function Ae(dt,Wt){if(1&dt&&(v.TgZ(0,"ion-select-option",5),v._uU(1),v.qZA()),2&dt){const de=Wt.$implicit;v.Q6J("value",de.ID),v.xp6(1),v.Oqu(de.Title)}}function Be(dt,Wt){1&dt&&(v.TgZ(0,"ion-select-option",6),v._uU(1,"Other..."),v.qZA())}function st(dt,Wt){if(1&dt){const de=v.EpF();v.TgZ(0,"ion-item")(1,"ion-label",1),v._uU(2,"Network Operator"),v.qZA(),v.TgZ(3,"ion-select",2),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw().operatorId=$t})("ionChange",function(){return v.CHM(de),v.oxw().onOperatorChange()}),v.YNc(4,Ae,2,2,"ion-select-option",3),v.YNc(5,Be,2,0,"ion-select-option",4),v.qZA()()}if(2&dt){const de=v.oxw();v.xp6(3),v.Q6J("ngModel",de.operatorId),v.xp6(1),v.Q6J("ngForOf",de.operators),v.xp6(1),v.Q6J("ngIf",de.useFilteredOperators)}}function _t(dt,Wt){if(1&dt){const de=v.EpF();v.TgZ(0,"ion-item")(1,"ion-label"),v._uU(2,"Network Operator"),v.qZA(),v.TgZ(3,"ion-searchbar",7),v.NdJ("ionCancel",function(){return v.CHM(de),v.oxw().cancelOperatorLookup()})("ngModelChange",function($t){return v.CHM(de),v.oxw().operatorSearchKeyword=$t})("ionChange",function($t){return v.CHM(de),v.oxw().searchOperators($t)}),v.qZA()()}if(2&dt){const de=v.oxw();v.xp6(3),v.Q6J("ngModel",de.operatorSearchKeyword)}}function Yt(dt,Wt){if(1&dt){const de=v.EpF();v.TgZ(0,"ion-item",9),v.NdJ("click",function(){const dn=v.CHM(de).$implicit;return v.oxw(2).onOperatorChange(dn)}),v.TgZ(1,"ion-avatar",10),v._UZ(2,"ion-icon",11),v.qZA(),v.TgZ(3,"ion-label")(4,"p"),v._uU(5),v.qZA(),v.TgZ(6,"p"),v._uU(7),v.qZA()()()}if(2&dt){const de=Wt.$implicit;v.xp6(5),v.Oqu(de.Title),v.xp6(2),v.Oqu(de.WebsiteURL)}}function xn(dt,Wt){if(1&dt&&(v.ynx(0),v.TgZ(1,"ion-list"),v.YNc(2,Yt,8,2,"ion-item",8),v.qZA(),v.BQk()),2&dt){const de=v.oxw();v.xp6(2),v.Q6J("ngForOf",de.operatorSearchResults)}}function Ht(dt,Wt){if(1&dt){const de=v.EpF();v.ynx(0),v.TgZ(1,"ion-item")(2,"ion-avatar",10),v._UZ(3,"ion-icon",12),v.qZA(),v.TgZ(4,"ion-label")(5,"p"),v._uU(6),v.qZA(),v.TgZ(7,"p"),v._uU(8),v.qZA(),v.TgZ(9,"ion-button",9),v.NdJ("click",function(){return v.CHM(de),v.oxw().selectedOperator=null}),v._uU(10,"Change"),v.qZA()()(),v.BQk()}if(2&dt){const de=v.oxw();v.xp6(6),v.Oqu(de.selectedOperator.Title),v.xp6(2),v.Oqu(de.selectedOperator.WebsiteURL)}}let Nt=(()=>{class dt{constructor(de){this.referenceDataManager=de,this.operatorId=null,this.useFilteredOperators=null,this.operatorChanged=new v.vpe,this.operatorCache=[],this.operatorSearchResults=[],this.operatorSearchKeyword="",this.selectedOperator=null}get operators(){return this.referenceDataManager.getNetworkOperators(this.useFilteredOperators)}ngOnInit(){this.operatorCache=this.referenceDataManager.getNetworkOperators(!1),null!=this.operatorId&&(this.selectedOperator=this.operatorCache.find(de=>de.ID==this.operatorId))}searchOperators(){this.operatorSearchResults=[],0!=this.operatorSearchKeyword.length&&(this.operatorSearchResults=this.operatorCache?this.operatorCache.filter(de=>de.Title.toLowerCase().startsWith(this.operatorSearchKeyword.toLowerCase())||de.Title.toLowerCase().startsWith("("+this.operatorSearchKeyword.toLowerCase())).slice(0,10):[])}onOperatorChange(de=null){var Je=this;return(0,d.Z)(function*(){null==de&&Je.operatorId&&(de=Je.operatorCache.find($t=>$t.ID==Je.operatorId)),null!=de&&(Je.operatorSearchResults=[],Je.selectedOperator=de,Je.operatorId=de.ID),Je.operatorId?Je.operatorChanged.emit(Je.selectedOperator):Je.useFilteredOperators=!1})()}cancelOperatorLookup(){this.selectedOperator=null}}return dt.\u0275fac=function(de){return new(de||dt)(v.Y36(ke.W))},dt.\u0275cmp=v.Xpm({type:dt,selectors:[["app-operator-lookup"]],inputs:{operatorId:"operatorId",useFilteredOperators:"useFilteredOperators"},outputs:{operatorChanged:"operatorChanged"},decls:4,vars:4,consts:[[4,"ngIf"],["position","floating"],[3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["value","",4,"ngIf"],[3,"value"],["value",""],["placeholder","Search by network name (in any country)","showCancelButton","focus","autocomplete","on",3,"ngModel","ionCancel","ngModelChange","ionChange"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["item-left",""],["name","card"],["name","locate"]],template:function(de,Je){1&de&&(v.YNc(0,st,6,3,"ion-item",0),v.YNc(1,_t,4,1,"ion-item",0),v.YNc(2,xn,3,1,"ng-container",0),v.YNc(3,Ht,11,2,"ng-container",0)),2&de&&(v.Q6J("ngIf",Je.useFilteredOperators&&!Je.selectedOperator),v.xp6(1),v.Q6J("ngIf",!Je.useFilteredOperators&&!Je.selectedOperator),v.xp6(1),v.Q6J("ngIf",Je.operatorSearchResults.length>0),v.xp6(1),v.Q6J("ngIf",null!=Je.selectedOperator))},directives:[Ie.O5,we.Ie,we.Q$,we.t9,we.QI,He.JJ,He.On,Ie.sg,we.n0,we.VI,we.j9,we.q_,we.BJ,we.gu,we.YG],styles:[""]}),dt})();var Bt=k(1099);function Dt(dt,Wt){1&dt&&v._UZ(0,"ion-icon",13)}function ht(dt,Wt){1&dt&&v._UZ(0,"ion-icon",13)}function Lt(dt,Wt){1&dt&&v._UZ(0,"ion-icon",13)}function _e(dt,Wt){if(1&dt&&(v.TgZ(0,"ion-select-option",27),v._uU(1),v.qZA()),2&dt){const de=Wt.$implicit;v.Q6J("value",de.ID),v.xp6(1),v.Oqu(de.Title)}}function it(dt,Wt){if(1&dt){const de=v.EpF();v.ynx(0),v.TgZ(1,"app-poi-location-editor",14,15),v.NdJ("latitudeChange",function($t){return v.CHM(de),v.oxw(2).item.AddressInfo.Latitude=$t})("longitudeChange",function($t){return v.CHM(de),v.oxw(2).item.AddressInfo.Longitude=$t})("onUseSuggestedAddress",function($t){return v.CHM(de),v.oxw(2).useSuggestedAddress($t)}),v.qZA(),v.TgZ(3,"ion-list")(4,"ion-item")(5,"ion-label",16),v._uU(6,"Location Name"),v.qZA(),v.TgZ(7,"ion-input",17),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw(2).item.AddressInfo.Title=$t}),v.qZA()(),v.TgZ(8,"ion-item")(9,"ion-label",16),v._uU(10,"Address Line 1"),v.qZA(),v.TgZ(11,"ion-input",18),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw(2).item.AddressInfo.AddressLine1=$t}),v.qZA()(),v.TgZ(12,"ion-item")(13,"ion-label",16),v._uU(14,"Address Line 2"),v.qZA(),v.TgZ(15,"ion-input",19),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw(2).item.AddressInfo.AddressLine2=$t}),v.qZA()(),v.TgZ(16,"ion-item")(17,"ion-label",16),v._uU(18,"Town"),v.qZA(),v.TgZ(19,"ion-input",20),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw(2).item.AddressInfo.Town=$t}),v.qZA()(),v.TgZ(20,"ion-item")(21,"ion-label",16),v._uU(22,"State or Province"),v.qZA(),v.TgZ(23,"ion-input",21),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw(2).item.AddressInfo.StateOrProvince=$t}),v.qZA()(),v.TgZ(24,"ion-item")(25,"ion-label",16),v._uU(26,"Postal Code"),v.qZA(),v.TgZ(27,"ion-input",22),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw(2).item.AddressInfo.Postcode=$t}),v.qZA()(),v.TgZ(28,"ion-item")(29,"ion-label",16),v._uU(30,"Country"),v.qZA(),v.TgZ(31,"ion-select",23),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw(2).item.AddressInfo.CountryID=$t})("ionChange",function(){return v.CHM(de),v.oxw(2).onCountryChange()}),v.YNc(32,_e,2,2,"ion-select-option",24),v.qZA()(),v.TgZ(33,"ion-item")(34,"ion-label",16),v._uU(35,"Latitude"),v.qZA(),v.TgZ(36,"ion-input",25),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw(2).item.AddressInfo.Latitude=$t}),v.qZA()(),v.TgZ(37,"ion-item")(38,"ion-label",16),v._uU(39,"Longitude"),v.qZA(),v.TgZ(40,"ion-input",26),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw(2).item.AddressInfo.Longitude=$t}),v.qZA()()(),v.BQk()}if(2&dt){const de=v.oxw(2);v.xp6(1),v.Q6J("latitude",de.item.AddressInfo.Latitude)("longitude",de.item.AddressInfo.Longitude),v.xp6(6),v.Q6J("ngModel",de.item.AddressInfo.Title),v.xp6(4),v.Q6J("ngModel",de.item.AddressInfo.AddressLine1),v.xp6(4),v.Q6J("ngModel",de.item.AddressInfo.AddressLine2),v.xp6(4),v.Q6J("ngModel",de.item.AddressInfo.Town),v.xp6(4),v.Q6J("ngModel",de.item.AddressInfo.StateOrProvince),v.xp6(4),v.Q6J("ngModel",de.item.AddressInfo.Postcode),v.xp6(4),v.Q6J("ngModel",de.item.AddressInfo.CountryID),v.xp6(1),v.Q6J("ngForOf",de.countries),v.xp6(4),v.Q6J("ngModel",de.item.AddressInfo.Latitude),v.xp6(4),v.Q6J("ngModel",de.item.AddressInfo.Longitude)}}function Ot(dt,Wt){if(1&dt){const de=v.EpF();v.ynx(0),v.TgZ(1,"h3"),v._uU(2,"Locations Nearby"),v.qZA(),v.TgZ(3,"p")(4,"strong"),v._uU(5,"The following locations already exist nearby."),v.qZA()(),v.TgZ(6,"div",28)(7,"p"),v._uU(8,"Ensure you are not adding a duplicate site unless it is for different equipment from another network operator."),v.qZA(),v.TgZ(9,"p"),v._uU(10,"You can edit any of these listings if required instead:"),v.qZA()(),v.TgZ(11,"app-poi-list",29),v.NdJ("onEdit",function($t){return v.CHM(de),v.oxw(2).editPOI($t)}),v.qZA(),v.BQk()}if(2&dt){const de=v.oxw(2);v.xp6(11),v.Q6J("poiList",de.nearbySites)("enableEditOption",!0)}}function Qt(dt,Wt){if(1&dt&&(v.ynx(0),v.YNc(1,it,41,12,"ng-container",9),v.YNc(2,Ot,12,2,"ng-container",9),v.BQk()),2&dt){const de=v.oxw();v.xp6(1),v.Q6J("ngIf","location"==de.step),v.xp6(1),v.Q6J("ngIf","poi-nearby"==de.step)}}function _n(dt,Wt){if(1&dt){const de=v.EpF();v.ynx(0),v.TgZ(1,"p"),v._uU(2,"Copied the equipment configuration from:"),v.qZA(),v.TgZ(3,"ion-item")(4,"ion-label"),v._uU(5),v._UZ(6,"br"),v._uU(7),v._UZ(8,"br"),v._uU(9),v._UZ(10,"br"),v._uU(11),v._UZ(12,"br"),v._uU(13),v.qZA(),v.TgZ(14,"ion-button",31),v.NdJ("click",function(){return v.CHM(de),v.oxw(5).changeTemplatePOI()}),v._uU(15,"Change.."),v.qZA()(),v.BQk()}if(2&dt){const de=v.oxw(5);v.xp6(5),v.hij(" ",de.selectedTemplatePOI.AddressInfo.Title," "),v.xp6(2),v.hij(" ",de.selectedTemplatePOI.AddressInfo.AddressLine1," "),v.xp6(2),v.hij(" ",null==de.selectedTemplatePOI.Connections[0].ConnectionType?null:de.selectedTemplatePOI.Connections[0].ConnectionType.Title," "),v.xp6(2),v.hij(" ",de.selectedTemplatePOI.Connections[0].PowerKW," "),v.xp6(2),v.hij(" ",de.selectedTemplatePOI.DateCreated," ")}}function Tn(dt,Wt){if(1&dt){const de=v.EpF();v.ynx(0),v.TgZ(1,"h4"),v._uU(2,"Similar Sites"),v.qZA(),v.TgZ(3,"app-poi-list",32),v.NdJ("onCopy",function($t){return v.CHM(de),v.oxw(6).useTemplatePOI($t)}),v.qZA(),v.BQk()}if(2&dt){const de=v.oxw(6);v.xp6(3),v.Q6J("enableCopyOption",!0)("poiList",de.templateSites)}}function mn(dt,Wt){1&dt&&(v.ynx(0),v.TgZ(1,"p"),v._uU(2," There are no suggested sites to copy for this network operator. "),v.qZA(),v.BQk())}function lt(dt,Wt){if(1&dt&&(v.ynx(0),v.YNc(1,Tn,4,2,"ng-container",9),v.YNc(2,mn,3,0,"ng-container",9),v.BQk()),2&dt){const de=v.oxw(5);v.xp6(1),v.Q6J("ngIf",de.templateSites.length>0),v.xp6(1),v.Q6J("ngIf",0==de.templateSites.length)}}function qt(dt,Wt){if(1&dt&&(v.ynx(0),v.YNc(1,_n,16,5,"ng-container",9),v.YNc(2,lt,3,2,"ng-container",9),v.BQk()),2&dt){const de=v.oxw(4);v.xp6(1),v.Q6J("ngIf",de.selectedTemplatePOI),v.xp6(1),v.Q6J("ngIf",!de.selectedTemplatePOI)}}function En(dt,Wt){if(1&dt){const de=v.EpF();v.ynx(0),v.TgZ(1,"p",28),v._uU(2,"You can copy the equipment settings from other sites operated by the same network operator or choose 'Next' to skip this step: "),v.qZA(),v.TgZ(3,"app-operator-lookup",30),v.NdJ("operatorChanged",function($t){return v.CHM(de),v.oxw(3).onOperatorChange($t)}),v.qZA(),v.YNc(4,qt,3,2,"ng-container",9),v.BQk()}if(2&dt){const de=v.oxw(3);v.xp6(3),v.Q6J("operatorId",de.item.OperatorID),v.xp6(1),v.Q6J("ngIf",de.item.AddressInfo.CountryID&&de.item.OperatorID)}}function yi(dt,Wt){if(1&dt&&(v.ynx(0),v.YNc(1,En,5,2,"ng-container",9),v.BQk()),2&dt){const de=v.oxw(2);v.xp6(1),v.Q6J("ngIf",!de.skipPOICopy)}}function Ui(dt,Wt){if(1&dt){const de=v.EpF();v.ynx(0),v.TgZ(1,"app-operator-lookup",33),v.NdJ("operatorChanged",function($t){return v.CHM(de),v.oxw(2).onOperatorChange($t)}),v.qZA(),v.TgZ(2,"ion-item")(3,"ion-label",16),v._uU(4,"Number of Stations or Parking Bays"),v.qZA(),v.TgZ(5,"ion-input",21),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw(2).item.NumberOfPoints=$t}),v.qZA()(),v.TgZ(6,"h4"),v._uU(7,"Equipment"),v.qZA(),v.TgZ(8,"ion-button",34),v.NdJ("click",function(){return v.CHM(de),v.oxw(2).addConnection()}),v._UZ(9,"ion-icon",35),v.qZA(),v.TgZ(10,"app-equipment-details",36),v.NdJ("onEdit",function($t){return v.CHM(de),v.oxw(2).editConnection($t)})("onDelete",function($t){return v.CHM(de),v.oxw(2).deleteConnection($t)}),v.qZA(),v.BQk()}if(2&dt){const de=v.oxw(2);v.xp6(1),v.Q6J("operatorId",de.item.OperatorID)("useFilteredOperators",!1),v.xp6(4),v.Q6J("ngModel",de.item.NumberOfPoints),v.xp6(5),v.Q6J("item",de.item)("enableEdit",!0)}}function Xi(dt,Wt){if(1&dt&&(v.ynx(0),v.YNc(1,yi,2,1,"ng-container",9),v.YNc(2,Ui,11,5,"ng-container",9),v.BQk()),2&dt){const de=v.oxw();v.xp6(1),v.Q6J("ngIf","copy-equipment"==de.step),v.xp6(1),v.Q6J("ngIf","edit-equipment"==de.step)}}function mr(dt,Wt){if(1&dt&&(v.TgZ(0,"p",43)(1,"strong"),v._uU(2,"Your changes cannot be saved until the following issues are resolved:"),v.qZA(),v.TgZ(3,"ion-label",44),v._uU(4),v.qZA()()),2&dt){const de=v.oxw(2);v.xp6(4),v.hij(" ",de.validationMsg,"")}}function di(dt,Wt){if(1&dt&&(v.TgZ(0,"ion-select-option",27),v._uU(1),v.qZA()),2&dt){const de=Wt.$implicit;v.Q6J("value",de.ID),v.xp6(1),v.Oqu(de.Title)}}function Ai(dt,Wt){if(1&dt&&(v.TgZ(0,"ion-select-option",27),v._uU(1),v.qZA()),2&dt){const de=Wt.$implicit;v.Q6J("value",de.ID),v.xp6(1),v.Oqu(de.Title)}}function Hi(dt,Wt){if(1&dt){const de=v.EpF();v.ynx(0),v.YNc(1,mr,5,1,"p",37),v.TgZ(2,"p"),v._uU(3,"Please provide any other facts related to this site. Additional comments (your charging experiences etc) can be added as check-in comments once the site is listed."),v.qZA(),v.TgZ(4,"ion-item")(5,"ion-label",16),v._uU(6,"Operational Status (All Equipment))"),v.qZA(),v.TgZ(7,"ion-select",38),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw().item.StatusTypeID=$t}),v.YNc(8,di,2,2,"ion-select-option",24),v.qZA()(),v.TgZ(9,"ion-item")(10,"ion-label",16),v._uU(11,"Usage Type"),v.qZA(),v.TgZ(12,"ion-select",38),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw().item.UsageTypeID=$t}),v.YNc(13,Ai,2,2,"ion-select-option",24),v.qZA()(),v.TgZ(14,"ion-item")(15,"ion-label",16),v._uU(16,"Usage Cost"),v.qZA(),v.TgZ(17,"ion-input",21),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw().item.UsageCost=$t}),v.qZA()(),v.TgZ(18,"ion-item")(19,"ion-label",16),v._uU(20,"General Comments"),v.qZA(),v.TgZ(21,"ion-input",39),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw().item.GeneralComments=$t}),v.qZA()(),v.TgZ(22,"ion-item")(23,"ion-label",16),v._uU(24,"Main Telephone Number "),v.qZA(),v.TgZ(25,"ion-input",40),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw().item.AddressInfo.ContactTelephone1=$t}),v.qZA()(),v.TgZ(26,"ion-item")(27,"ion-label",16),v._uU(28,"Other Telephone Number "),v.qZA(),v.TgZ(29,"ion-input",40),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw().item.AddressInfo.ContactTelephone2=$t}),v.qZA()(),v.TgZ(30,"ion-item")(31,"ion-label",16),v._uU(32,"Access Comments"),v.qZA(),v.TgZ(33,"ion-input",41),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw().item.AddressInfo.AccessComments=$t}),v.qZA()(),v.TgZ(34,"ion-item")(35,"ion-label",16),v._uU(36,"Related Website"),v.qZA(),v.TgZ(37,"ion-input",42),v.NdJ("ngModelChange",function($t){return v.CHM(de),v.oxw().item.AddressInfo.RelatedURL=$t}),v.qZA()(),v.BQk()}if(2&dt){const de=v.oxw();v.xp6(1),v.Q6J("ngIf",de.validationMsg),v.xp6(6),v.Q6J("ngModel",de.item.StatusTypeID),v.xp6(1),v.Q6J("ngForOf",de.statusTypes),v.xp6(4),v.Q6J("ngModel",de.item.UsageTypeID),v.xp6(1),v.Q6J("ngForOf",de.usageTypes),v.xp6(4),v.Q6J("ngModel",de.item.UsageCost),v.xp6(4),v.Q6J("ngModel",de.item.GeneralComments),v.xp6(4),v.Q6J("ngModel",de.item.AddressInfo.ContactTelephone1),v.xp6(4),v.Q6J("ngModel",de.item.AddressInfo.ContactTelephone2),v.xp6(4),v.Q6J("ngModel",de.item.AddressInfo.AccessComments),v.xp6(4),v.Q6J("ngModel",de.item.AddressInfo.RelatedURL)}}function ri(dt,Wt){if(1&dt){const de=v.EpF();v.TgZ(0,"ion-button",1),v.NdJ("click",function(){return v.CHM(de),v.oxw().previous()}),v._uU(1," Previous "),v._UZ(2,"ion-icon",45),v.qZA()}}function on(dt,Wt){if(1&dt){const de=v.EpF();v.TgZ(0,"ion-button",1),v.NdJ("click",function(){return v.CHM(de),v.oxw().next()}),v._uU(1," Next "),v._UZ(2,"ion-icon",46),v.qZA()}}function It(dt,Wt){if(1&dt){const de=v.EpF();v.TgZ(0,"ion-button",47),v.NdJ("click",function(){return v.CHM(de),v.oxw().save()}),v._uU(1," Submit "),v._UZ(2,"ion-icon",48),v.qZA()}}let qe=(()=>{class dt{constructor(de,Je,$t,dn,Qn,Qi){this.appManager=de,this.modalController=Je,this.poiManager=$t,this.mapping=dn,this.loadingController=Qn,this.alertController=Qi,this.useFilteredConnectionTypes=!0,this.templateSites=[],this.nearbySites=[],this.selectedTemplatePOI=null,this.suggestedAddress=null,this.suggestedAddressAttribution=null,this.isNonDuplicateConfirmed=!1,this.skipPOICopy=!1,this.validationMsg=null,this.initNewItem()}get countries(){return this.appManager.referenceDataManager.getCountries()}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes()}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes().filter(de=>1==de.IsUserSelectable)}get isAddMode(){return this.item.ID<=0}initNewItem(){this.item={ID:-1,DataProviderID:1,DataProvidersReference:null,OperatorsReference:null,OperatorID:1,UsageCost:null,UsageTypeID:4,NumberOfPoints:1,GeneralComments:null,DatePlanned:null,StatusTypeID:50,SubmissionStatusTypeID:null,Connections:[],MetadataValues:[],AddressInfo:{ID:-1,CountryID:18,Title:"",AddressLine1:"",Latitude:0,Longitude:0}},this.step="location",this.selectedTab="location"}get isReadyToSubmit(){return this.validate().isValid&&"info"==this.step}ngOnInit(){}presentLoadingUI(){var de=this;return(0,d.Z)(function*(){de.loading=yield de.loadingController.create({message:"Please Wait.."}),yield de.loading.present()})()}dismissLoadingUI(){var de=this;return(0,d.Z)(function*(){de.loading&&(yield de.loading.dismiss())})()}ionViewDidEnter(){if(null!=this.id)this.editExistingPOI(this.id);else{let de=localStorage.getItem("_editor-operatorid");de&&(this.item.OperatorID=parseInt(de,10)),this.startPos?(this.item.AddressInfo.Latitude=this.startPos.latitude,this.item.AddressInfo.Longitude=this.startPos.longitude):this.mapping&&this.mapping.getMapCenter().subscribe(Je=>{Je&&(this.item.AddressInfo.Latitude=Je.coords.latitude,this.item.AddressInfo.Longitude=Je.coords.longitude)})}this.refreshFilteredReferenceData()}previous(){var de=this;return(0,d.Z)(function*(){switch(de.step){case"info":de.step="edit-equipment";break;case"edit-equipment":de.step=de.isAddMode?"copy-equipment":"location";break;case"copy-equipment":case"poi-nearby":de.step="location"}yield de.initCurrentStep(!1)})()}next(){var de=this;return(0,d.Z)(function*(){if("poi-nearby"==de.step&&de.nearbySites.length>0&&!de.isNonDuplicateConfirmed)return void(yield de.alertController.create({header:"Confirm",message:"Please confirm you are not adding a duplicate site.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:dn=>{}},{text:"Confirm",handler:()=>{de.isNonDuplicateConfirmed=!0,de.next()}}]})).present();const Je=de.validate(de.step);if(Je.isValid){switch(de.step){case"location":de.step=de.isAddMode?"poi-nearby":"edit-equipment";break;case"poi-nearby":de.step=de.isAddMode?"copy-equipment":"edit-equipment";break;case"copy-equipment":de.step="edit-equipment";break;case"edit-equipment":de.step="info"}yield de.initCurrentStep(!0)}else(yield de.alertController.create({message:Je.msg})).present()})()}initCurrentStep(de){var Je=this;return(0,d.Z)(function*(){"poi-nearby"==Je.step?(Je.selectedTab="location",0==(yield Je.refreshNearbySites())&&(de?yield Je.next():yield Je.previous())):"location"==Je.step?Je.selectedTab="location":"copy-equipment"==Je.step?(Je.selectedTab="equipment",yield Je.refreshTemplateSites()):"edit-equipment"==Je.step?Je.selectedTab="equipment":"info"==Je.step&&(Je.selectedTab="info")})()}onCountryChange(){var de=this;return(0,d.Z)(function*(){de.refreshFilteredReferenceData()})()}onOperatorChange(de=null){var Je=this;return(0,d.Z)(function*(){null!=de&&Je.item.OperatorID!=de.ID&&(Je.item.OperatorID=de.ID,localStorage.setItem("_editor-operatorid",Je.item.OperatorID.toString()),yield Je.refreshTemplateSites())})()}useSuggestedAddress(de=null){de&&(this.suggestedAddress=de.suggestedAddress,this.suggestedAddressAttribution=de.suggestedAddressAttribution),Object.assign(this.item.AddressInfo,this.suggestedAddress),this.suggestedAddressAttribution&&(this.item.MetadataValues.find(Je=>4==Je.MetadataFieldID)||this.item.MetadataValues.push({ID:-1,MetadataFieldID:4,ItemValue:this.suggestedAddressAttribution,MetadataFieldOptionID:null,MetadataFieldOption:null}))}editConnection(de){var Je=this;return(0,d.Z)(function*(){const $t=Je.item.Connections.find(Qi=>Qi.ID==de.ID),dn=Object.assign({},$t),Qn=yield Je.modalController.create({component:me,componentProps:{conn:dn}});return Qn.onWillDismiss().then(Qi=>{Qi&&Qi.data&&Qi.data.item&&Je.updateConnection(Qi.data.item)}),yield Qn.present()})()}deleteConnection(de){var Je=this;return(0,d.Z)(function*(){const $t=Je.item.Connections.find(Qn=>Qn.ID==de.ID);(yield Je.alertController.create({header:"Confirm Delete",message:"Are you sure you want to delete this connection information?",buttons:[{text:"No",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Yes",handler:()=>{Je.item.Connections=Je.item.Connections.filter(Qn=>Qn.ID!=$t.ID),Je.appManager.referenceDataManager.hydrateCompactPOI(Je.item,!0)}}]})).present()})()}addConnection(){var de=this;return(0,d.Z)(function*(){const Je={ID:-l.c.getRandomInt(1e4),ConnectionTypeID:null,StatusTypeID:50,PowerKW:null,Quantity:1},$t=yield de.modalController.create({component:me,componentProps:{conn:Je}});return $t.onWillDismiss().then(dn=>{dn&&dn.data&&dn.data.item&&de.updateConnection(dn.data.item)}),yield $t.present()})()}refreshFilteredReferenceData(){this.appManager.referenceDataManager.refreshFilteredReferenceData(this.appManager.api,{CountryIds:[this.item.AddressInfo.CountryID]})}updateConnection(de){if(de){let Je=this.item.Connections.find($t=>$t.ID==de.ID);Je?Object.assign(Je,de):this.item.Connections.push(de)}this.appManager.referenceDataManager.hydrateCompactPOI(this.item,!0)}validate(de="all"){let Je=null;return("all"==de||"location"==de)&&((!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(Je="Location is required"),""==this.item.AddressInfo.Title&&(Je="A location title is required"),!this.item.AddressInfo.AddressLine1&&!this.item.AddressInfo.AddressLine2&&(Je="An approximate address is required."),this.item.AddressInfo.CountryID||(Je="A country selection is required"),(!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(Je="A location latitude and longitude is required")),("all"==de||"poi-nearby"==de)&&this.nearbySites.length>0&&!this.isNonDuplicateConfirmed&&(Je="Please confirm that the site is not a duplicate"),("all"==de||"equipment"==de)&&(this.item.OperatorID||(Je="Please confirm the charging network or equipment operator."),0==this.item.Connections.length&&(Je="Equipment information is required")),Je?(this.validationMsg=Je,{isValid:!1,msg:Je}):(this.validationMsg=null,{isValid:!0,msg:null})}save(){var de=this;return(0,d.Z)(function*(){let Je=de.validate();if(Je.isValid){yield de.presentLoadingUI();try{yield de.appManager.submitPOI(de.item),yield de.dismissLoadingUI(),de.appManager.showToastNotification("You submission will be reviewed (if required) and published shortly."),de.modalController.dismiss()}catch($t){yield de.dismissLoadingUI(),$t.error&&alert("Sorry, your submission could not be completed at this time. Please try again later.")}}else alert(Je.msg)})()}cancel(){var de=this;return(0,d.Z)(function*(){de.modalController.dismiss()})()}refreshTemplateSites(){var de=this;return(0,d.Z)(function*(){if(de.item.AddressInfo.CountryID&&de.item.OperatorID){yield de.presentLoadingUI(),de.templateSites=[];let Je=new ce.b;Je.countryIdList=[de.item.AddressInfo.CountryID],Je.minPowerKW=1,Je.operatorIdList=[de.item.OperatorID],Je.maxResults=10;let $t=yield de.poiManager.fetchPOIList(Je);$t.sort((dn,Qn)=>new Date(dn.DateCreated).getTime()-new Date(Qn.DateCreated).getTime()),de.templateSites=$t,de.dismissLoadingUI()}})()}refreshNearbySites(){var de=this;return(0,d.Z)(function*(){if(de.item.AddressInfo.Latitude&&de.item.AddressInfo.Longitude){yield de.presentLoadingUI(),de.nearbySites=[];let Je=new ce.b;Je.latitude=de.item.AddressInfo.Latitude,Je.longitude=de.item.AddressInfo.Longitude,Je.distance=5,Je.distanceUnit="km",Je.maxResults=10;let $t=yield de.poiManager.fetchPOIList(Je);return $t.sort((dn,Qn)=>dn.Distance-Qn.Distance),de.nearbySites=$t,de.dismissLoadingUI(),$t.length}return 0})()}confirmNonDuplicate(){this.isNonDuplicateConfirmed=!0,this.next()}changeTemplatePOI(){this.selectedTemplatePOI=null}editPOI(de){this.editExistingPOI(de.ID)}editExistingPOI(de){var Je=this;return(0,d.Z)(function*(){Je.skipPOICopy=!0,Je.isNonDuplicateConfirmed=!0,yield Je.presentLoadingUI(),Je.poiManager.getPOIById(de,!0,!0).then($t=>{Je.item=Object.assign({},$t),null==Je.item.OperatorID&&(Je.item.OperatorID=Pe.UnknownOperator),Je.refreshFilteredReferenceData(),Je.dismissLoadingUI()})})()}useTemplatePOI(de){this.selectedTemplatePOI=de,Object.assign(this.item.Connections,de.Connections);for(let Je of this.item.Connections)Je.ID=-l.c.getRandomInt(1e4),Je.Reference=null,Je.Comments=null,Je.StatusTypeID=Ze.Operational;this.item.UsageCost=de.UsageCost,this.item.UsageTypeID=de.UsageTypeID,this.appManager.referenceDataManager.hydrateCompactPOI(this.item)}skipCopyingPOI(){this.skipPOICopy=!0}}return dt.\u0275fac=function(de){return new(de||dt)(v.Y36(m.c),v.Y36(we.IN),v.Y36(ie.R),v.Y36(re.v),v.Y36(we.HT),v.Y36(we.Br))},dt.\u0275cmp=v.Xpm({type:dt,selectors:[["app-poi-editor"]],viewQuery:function(de,Je){if(1&de&&v.Gf(Ne,5),2&de){let $t;v.iGM($t=v.CRH())&&(Je.editorMap=$t.first)}},decls:33,vars:14,consts:[["slot","end"],[3,"click"],["name","close","slot","start"],[1,"ion-padding"],[3,"ngModel"],["value","location","layout","icon-start",3,"disabled"],["name","caret-forward",4,"ngIf"],["value","equipment","layout","icon-start",3,"disabled"],["value","info","layout","icon-start",3,"disabled"],[4,"ngIf"],["slot","start"],[3,"click",4,"ngIf"],["color","success",3,"click",4,"ngIf"],["name","caret-forward"],[3,"latitude","longitude","latitudeChange","longitudeChange","onUseSuggestedAddress"],["editorMap",""],["position","floating"],["type","text","autocapitalize","words","placeholder","A title for this location",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","The nearest street address",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Optional",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Town or City",3,"ngModel","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Optional Postal Code",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["type","number","placeholder","Latitude (if entering manually)",3,"ngModel","ngModelChange"],["type","number","placeholder","Longitude (if entering manually)",3,"ngModel","ngModelChange"],[3,"value"],[1,"instruction"],[3,"poiList","enableEditOption","onEdit"],[3,"operatorId","operatorChanged"],["slot","start","size","small",3,"click"],[3,"enableCopyOption","poiList","onCopy"],[3,"operatorId","useFilteredOperators","operatorChanged"],["size","small",3,"click"],["name","add","slot","icon-only"],[3,"item","enableEdit","onEdit","onDelete"],["color","warning",4,"ngIf"],[3,"ngModel","ngModelChange"],["type","text","autocapitalize","sentences",3,"ngModel","ngModelChange"],["type","tel","placeholder","",3,"ngModel","ngModelChange"],["type","text","autocapitalize","sentences","placeholder","Instructions for access or tips for finding charging location",3,"ngModel","ngModelChange"],["type","url","placeholder","Website related to this site",3,"ngModel","ngModelChange"],["color","warning"],["color","danger"],["name","caret-back","slot","start"],["name","caret-forward","slot","end"],["color","success",3,"click"],["name","send","slot","end"]],template:function(de,Je){1&de&&(v.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),v._uU(3),v.qZA(),v.TgZ(4,"ion-buttons",0)(5,"ion-button",1),v.NdJ("click",function(){return Je.cancel()}),v._UZ(6,"ion-icon",2),v._uU(7," Cancel "),v.qZA()()()(),v.TgZ(8,"ion-content",3),v.ynx(9),v.TgZ(10,"ion-segment",4)(11,"ion-segment-button",5),v.YNc(12,Dt,1,0,"ion-icon",6),v.TgZ(13,"ion-label"),v._uU(14,"Location"),v.qZA()(),v.TgZ(15,"ion-segment-button",7),v.YNc(16,ht,1,0,"ion-icon",6),v.TgZ(17,"ion-label"),v._uU(18,"Equipment"),v.qZA()(),v.TgZ(19,"ion-segment-button",8),v.YNc(20,Lt,1,0,"ion-icon",6),v.TgZ(21,"ion-label"),v._uU(22,"Info"),v.qZA()()(),v.YNc(23,Qt,3,2,"ng-container",9),v.YNc(24,Xi,3,2,"ng-container",9),v.YNc(25,Hi,38,11,"ng-container",9),v.BQk(),v.qZA(),v.TgZ(26,"ion-footer")(27,"ion-toolbar")(28,"ion-buttons",10),v.YNc(29,ri,3,0,"ion-button",11),v.qZA(),v.TgZ(30,"ion-buttons",0),v.YNc(31,on,3,0,"ion-button",11),v.YNc(32,It,3,0,"ion-button",12),v.qZA()()()),2&de&&(v.xp6(3),v.Oqu(Je.isAddMode?"Add Location":"Edit Location"),v.xp6(7),v.Q6J("ngModel",Je.selectedTab),v.xp6(1),v.Q6J("disabled",!0),v.xp6(1),v.Q6J("ngIf","location"==Je.selectedTab),v.xp6(3),v.Q6J("disabled",!0),v.xp6(1),v.Q6J("ngIf","equipment"==Je.selectedTab),v.xp6(3),v.Q6J("disabled",!0),v.xp6(1),v.Q6J("ngIf","info"==Je.selectedTab),v.xp6(3),v.Q6J("ngIf","location"==Je.selectedTab),v.xp6(1),v.Q6J("ngIf","equipment"==Je.selectedTab),v.xp6(1),v.Q6J("ngIf","info"==Je.selectedTab),v.xp6(4),v.Q6J("ngIf","location"!=Je.step),v.xp6(2),v.Q6J("ngIf",!Je.isReadyToSubmit&&"info"!=Je.step),v.xp6(1),v.Q6J("ngIf",Je.isReadyToSubmit))},directives:[we.Gu,we.sr,we.wd,we.Sm,we.YG,we.gu,we.W2,we.cJ,we.QI,He.JJ,He.On,we.GO,Ie.O5,we.Q$,Ne,we.q_,we.Ie,we.pK,we.j9,we.t9,Ie.sg,we.n0,we.as,ye.o,Nt,Bt.B,we.fr],styles:['ul.breadcrumb[_ngcontent-%COMP%]{display:inline-flex;margin:0;padding:0}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-flex;margin-right:6px;color:var(--ion-color-light-shade);font-size:10px}ul.breadcrumb[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{color:var(--ion-color-dark-shade)}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:">";padding-right:4px}']}),dt})()},6763:(Ln,At,k)=>{"use strict";k.d(At,{u:()=>Ze});var d=k(8274),m=k(9634),ce=k(4120),l=k(3912),ie=k(7689),re=k(129),v=k(529);let ne=(()=>{class Pe{constructor(tt,ye){this.http=tt,this.journeyManager=ye}getDirections(tt,ye){return new Promise((Ae,Be)=>{(new google.maps.DirectionsService).route({origin:tt,destination:ye,travelMode:google.maps.TravelMode.DRIVING},(_t,Yt)=>{Yt===google.maps.DirectionsStatus.OK?Ae(_t):Be(Yt)})})}analyseRoutes(tt,ye){const Ae=new Array;return tt.routes.forEach(Be=>{const st=new re.JJ;st.Title=""+Ae.length+1,st.JourneyRouteLegs=new Array,st.TotalDistanceKM=0,st.TotalDurationMinutes=0,st.TotalEnergykWh=0,Be.legs.forEach(_t=>{const Yt=_t.duration.value,xn=_t.distance.value/1e3,Ht=this.journeyManager.calculateEnergyConsumptionkWh(xn,0,null,ye),Nt=new re.eN;Nt.DistanceKM=xn,Nt.DurationMinutes=Yt/60,Nt.EnergyConsumptionkWh=Ht,st.JourneyRouteLegs.push(Nt),st.TotalDistanceKM+=Nt.DistanceKM,st.TotalDurationMinutes+=Nt.DurationMinutes,st.TotalEnergykWh=Nt.EnergyConsumptionkWh}),Ae.push(st)}),Ae}}return Pe.\u0275fac=function(tt){return new(tt||Pe)(d.LFG(v.eN),d.LFG(l.i))},Pe.\u0275prov=d.Yz7({token:Pe,factory:Pe.\u0275fac,providedIn:"root"}),Pe})();var De=k(4781),ge=k(6895),X=k(4006),ue=k(2428);function se(Pe,Ge){if(1&Pe){const tt=d.EpF();d.TgZ(0,"ion-item"),d._UZ(1,"ion-icon",12),d.TgZ(2,"ion-searchbar",13),d.NdJ("ngModelChange",function(Ae){return d.CHM(tt),d.oxw().routeStart=Ae})("ionInput",function(Ae){return d.CHM(tt),d.oxw(),d.MAs(18).getPlacesAutoComplete(Ae,"routeStart")})("ionCancel",function(Ae){return d.CHM(tt),d.oxw().onPlaceSearchCancel(Ae)}),d.qZA()()}if(2&Pe){const tt=d.oxw();d.xp6(2),d.Q6J("ngModel",tt.routeStart)("debounce",500)}}function Ie(Pe,Ge){if(1&Pe){const tt=d.EpF();d.TgZ(0,"ion-item",14),d.NdJ("click",function(){return d.CHM(tt),d.oxw().clearRouteStart()}),d._UZ(1,"ion-icon",12),d.TgZ(2,"h2"),d._uU(3),d.qZA()()}if(2&Pe){d.oxw();const tt=d.MAs(18);d.xp6(3),d.Oqu(null==tt.selectedPlace?null:tt.selectedPlace.name)}}function we(Pe,Ge){if(1&Pe){const tt=d.EpF();d.TgZ(0,"ion-item"),d._UZ(1,"ion-icon",15),d.TgZ(2,"ion-searchbar",16),d.NdJ("ngModelChange",function(Ae){return d.CHM(tt),d.oxw().routeDestination=Ae})("ionInput",function(Ae){return d.CHM(tt),d.oxw(),d.MAs(20).getPlacesAutoComplete(Ae,"routeDestination")})("ionCancel",function(Ae){return d.CHM(tt),d.oxw().onPlaceSearchCancel(Ae)}),d.qZA()()}if(2&Pe){const tt=d.oxw();d.xp6(2),d.Q6J("ngModel",tt.routeDestination)("debounce",500)}}function Ue(Pe,Ge){if(1&Pe){const tt=d.EpF();d.TgZ(0,"ion-item",14),d.NdJ("click",function(){return d.CHM(tt),d.oxw().clearRouteDestination()}),d._UZ(1,"ion-icon",15),d.TgZ(2,"h2"),d._uU(3),d.qZA()()}if(2&Pe){d.oxw();const tt=d.MAs(20);d.xp6(3),d.Oqu(null==tt.selectedPlace?null:tt.selectedPlace.name)}}function Ne(Pe,Ge){if(1&Pe){const tt=d.EpF();d.TgZ(0,"ion-button",14),d.NdJ("click",function(){return d.CHM(tt),d.oxw().clearRoute()}),d._UZ(1,"ion-icon",17),d._uU(2," Clear Route "),d.qZA()}}function ke(Pe,Ge){if(1&Pe){const tt=d.EpF();d.TgZ(0,"ion-button",14),d.NdJ("click",function(){return d.CHM(tt),d.oxw().showSettings()}),d._uU(1," Show Settings "),d._UZ(2,"ion-icon",18),d.qZA()}}function He(Pe,Ge){if(1&Pe){const tt=d.EpF();d.TgZ(0,"ion-button",14),d.NdJ("click",function(){return d.CHM(tt),d.oxw().hideSettings()}),d._uU(1," Hide Settings "),d._UZ(2,"ion-icon",18),d.qZA()}}function We(Pe,Ge){1&Pe&&(d.TgZ(0,"p",19),d._UZ(1,"ion-spinner",19),d._uU(2," Calculating Route.. "),d.qZA())}function Qe(Pe,Ge){if(1&Pe&&(d.TgZ(0,"ion-list")(1,"ion-list-header"),d._uU(2),d.ALo(3,"number"),d.ALo(4,"number"),d.qZA()()),2&Pe){const tt=d.oxw();d.xp6(2),d.lnq(" Total Distance ",d.xi3(3,3,tt.selectedJourneyRoute.TotalDistanceKM,"1.0-2")," km, ",tt.formatDuration(tt.selectedJourneyRoute.TotalDurationMinutes),", ",d.xi3(4,6,tt.selectedJourneyRoute.TotalEnergykWh,"1.0-2")," kWh ")}}function ve(Pe,Ge){if(1&Pe){const tt=d.EpF();d.TgZ(0,"div")(1,"ion-list")(2,"ion-list-header"),d._UZ(3,"ion-icon",20),d._uU(4," Route Settings "),d.qZA(),d.TgZ(5,"ion-item")(6,"ion-label",21),d._uU(7),d.qZA(),d.TgZ(8,"ion-range",22),d.NdJ("ngModelChange",function(Ae){return d.CHM(tt),d.oxw().routeSearchDistance=Ae}),d._UZ(9,"ion-icon",23)(10,"ion-icon",24),d.qZA()(),d.TgZ(11,"ion-item")(12,"ion-label",21),d._uU(13,"Energy Efficiency (kWh Per km)"),d.qZA(),d.TgZ(14,"ion-input",25),d.NdJ("ngModelChange",function(Ae){return d.CHM(tt),d.oxw().kWhPerKM=Ae}),d.qZA()()()()}if(2&Pe){const tt=d.oxw();d.xp6(7),d.hij("Search Distance (",tt.routeSearchDistance,")"),d.xp6(1),d.Q6J("ngModel",tt.routeSearchDistance),d.xp6(6),d.Q6J("ngModel",tt.kWhPerKM)}}let me=(()=>{class Pe{constructor(tt,ye,Ae,Be,st,_t){this.mapping=tt,this.logging=ye,this.directions=Ae,this.journeyManager=Be,this.changeDetector=st,this.numberPipe=_t,this.routeSearchDistance=5,this.routeCalcInProgress=!1,this.advancedSettingsMode=!1,this.routeStart="",this.routeDestination="",this.kWhPerKM=.212}get isRouteSet(){return null!=this.routeStartPlace&&null!=this.routeDestinationPlace}showSettings(){this.advancedSettingsMode=!0}hideSettings(){this.advancedSettingsMode=!1}routeStartSelected(tt){this.routeStartPlace=tt,this.calculateRoute(),this.changeDetector.detectChanges()}routeDestinationSelected(tt){this.routeDestinationPlace=tt,this.calculateRoute(),this.changeDetector.detectChanges()}clearRouteStart(){this.routeStartPlace=null,this.changeDetector.detectChanges()}clearRouteDestination(){this.routeDestinationPlace=null,this.changeDetector.detectChanges()}clearRoute(){this.routeStartPlace=null,this.routeDestinationPlace=null,this.journeyManager.setRoutePolyline(null),this.mapping.clearPolyline()}formatDuration(tt){if(tt<=60)return this.numberPipe.transform(tt,"1.0-2")+" mins";{const ye=Math.round(tt/60),Ae=Math.floor(tt-60*ye);return ye+" hours "+(Ae>0?Ae+" mins":"")}}calculateRoute(){null!=this.routeStartPlace&&null!=this.routeDestinationPlace&&(this.logging.log("Fetching route directions.."),this.routeCalcInProgress=!0,this.directions.getDirections(this.routeStartPlace.Location.latitude+","+this.routeStartPlace.Location.longitude,this.routeDestinationPlace.Location.latitude+","+this.routeDestinationPlace.Location.longitude).then(tt=>{if(null!=tt.routes&&tt.routes.length>0){this.logging.log("Got route directions, analysing.."),this.routePolyline=tt.routes[0].overview_polyline;const ye=tt.routes[0].bounds.getSouthWest(),Ae=tt.routes[0].bounds.getNorthEast(),Be=new ce.wC(Ae.lat(),Ae.lng()),st=new ce.wC(ye.lat(),ye.lng()),_t=new ce.LL(Be,st);this.journeyRoutes=this.directions.analyseRoutes(tt,this.kWhPerKM),this.journeyRoutes.length>0&&(this.selectedJourneyRoute=this.journeyRoutes[0]),this.journeyManager.setRoutePolyline(this.routePolyline),this.mapping.renderPolyline(this.routePolyline),this.mapping.moveToMapBounds(_t)}else this.logging.log("No route returned..");this.routeCalcInProgress=!1}))}}return Pe.\u0275fac=function(tt){return new(tt||Pe)(d.Y36(De.v),d.Y36(ie.z),d.Y36(ne),d.Y36(l.i),d.Y36(d.sBO),d.Y36(ge.JJ))},Pe.\u0275cmp=d.Xpm({type:Pe,selectors:[["route-planner"]],decls:24,vars:10,consts:[[1,"route"],[1,"route-places"],["name","map","slot","start"],[4,"ngIf"],[3,"click",4,"ngIf"],["primary",""],["slot","secondary"],["slot","primary"],[3,"placeChanged"],["placeSearchRouteStart",""],["placeSearchRouteDestination",""],["class","ion-padding",4,"ngIf"],["name","ionic","item-left",""],["placeholder","Starting Point",3,"ngModel","debounce","ngModelChange","ionInput","ionCancel"],[3,"click"],["name","pin","item-left",""],["placeholder","Destination",3,"ngModel","debounce","ngModelChange","ionInput","ionCancel"],["name","close","slot","start"],["name","cog","slot","end"],[1,"ion-padding"],["name","cog"],["position","stacked"],["min","1","max","200","step","5","snaps","true","pin","true","light","",3,"ngModel","ngModelChange"],["slot","start","small","","name","map"],["slot","end","large","","name","map"],["type","number","min","0.1","max","1",3,"ngModel","ngModelChange"]],template:function(tt,ye){1&tt&&(d.TgZ(0,"div",0)(1,"div",1)(2,"ion-list")(3,"ion-list-header"),d._UZ(4,"ion-icon",2),d.TgZ(5,"ion-label"),d._uU(6,"Plan Your Journey"),d.qZA()(),d.YNc(7,se,3,2,"ion-item",3),d.YNc(8,Ie,4,1,"ion-item",4),d.YNc(9,we,3,2,"ion-item",3),d.YNc(10,Ue,4,1,"ion-item",4),d.qZA(),d.TgZ(11,"ion-toolbar",5)(12,"ion-buttons",6),d.YNc(13,Ne,3,0,"ion-button",4),d.qZA(),d.TgZ(14,"ion-buttons",7),d.YNc(15,ke,3,0,"ion-button",4),d.YNc(16,He,3,0,"ion-button",4),d.qZA()()(),d.TgZ(17,"place-search",8,9),d.NdJ("placeChanged",function(Be){return ye.routeStartSelected(Be)}),d.qZA(),d.TgZ(19,"place-search",8,10),d.NdJ("placeChanged",function(Be){return ye.routeDestinationSelected(Be)}),d.qZA(),d.YNc(21,We,3,0,"p",11),d.YNc(22,Qe,5,9,"ion-list",3),d.YNc(23,ve,15,3,"div",3),d.qZA()),2&tt&&(d.xp6(7),d.Q6J("ngIf",null==ye.routeStartPlace),d.xp6(1),d.Q6J("ngIf",null!=ye.routeStartPlace),d.xp6(1),d.Q6J("ngIf",null==ye.routeDestinationPlace),d.xp6(1),d.Q6J("ngIf",null!=ye.routeDestinationPlace),d.xp6(3),d.Q6J("ngIf",ye.isRouteSet),d.xp6(2),d.Q6J("ngIf",!ye.advancedSettingsMode),d.xp6(1),d.Q6J("ngIf",ye.advancedSettingsMode),d.xp6(5),d.Q6J("ngIf",ye.routeCalcInProgress),d.xp6(1),d.Q6J("ngIf",null!=ye.selectedJourneyRoute),d.xp6(1),d.Q6J("ngIf",ye.advancedSettingsMode))},directives:[m.q_,m.yh,m.gu,m.Q$,ge.O5,m.Ie,m.VI,m.j9,X.JJ,X.On,m.sr,m.Sm,m.YG,ue.v,m.PQ,m.I_,m.QI,m.pK,m.as],pipes:[ge.JJ],encapsulation:2}),Pe})(),Ze=(()=>{class Pe{constructor(tt){this.modalController=tt,this.hasNavbar=!1}close(){this.modalController.dismiss()}}return Pe.\u0275fac=function(tt){return new(tt||Pe)(d.Y36(m.IN))},Pe.\u0275cmp=d.Xpm({type:Pe,selectors:[["ng-component"]],decls:10,vars:0,consts:[["slot","end"],[3,"click"],["name","close","slot","end"],[1,"route-planner","ion-padding"]],template:function(tt,ye){1&tt&&(d.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),d._uU(3," Route Planner "),d.qZA(),d.TgZ(4,"ion-buttons",0)(5,"ion-button",1),d.NdJ("click",function(){return ye.close()}),d._UZ(6,"ion-icon",2),d._uU(7," Close "),d.qZA()()()(),d.TgZ(8,"ion-content",3),d._UZ(9,"route-planner"),d.qZA())},directives:[m.Gu,m.sr,m.wd,m.Sm,m.YG,m.gu,m.W2,me],encapsulation:2}),Pe})()},3548:(Ln,At,k)=>{"use strict";k.r(At),k.d(At,{SearchPageModule:()=>_n});var d=k(8936),m=k(4463),ce=k(6895),l=k(4006),ie=k(9634),re=k(6014),v=k(9671),ne=k(2340),De=k(2951),ge=k(6314),X=k(6763),ue=k(3399),se=k(4120),Ie=k(8016),we=k(6579),Ue=k(7689),Ne=k(3912),ke=k(4781),He=k(9698),We=k(3855),Qe=k(2428),ve=k(4968),me=k(727);class Ze extends me.w0{constructor(mn,lt){super()}schedule(mn,lt=0){return this}}const Pe={setInterval(Tn,mn,...lt){const{delegate:qt}=Pe;return(null==qt?void 0:qt.setInterval)?qt.setInterval(Tn,mn,...lt):setInterval(Tn,mn,...lt)},clearInterval(Tn){const{delegate:mn}=Pe;return((null==mn?void 0:mn.clearInterval)||clearInterval)(Tn)},delegate:void 0};var Ge=k(8737),ye=k(6063);class Ae{constructor(mn,lt=Ae.now){this.schedulerActionCtor=mn,this.now=lt}schedule(mn,lt=0,qt){return new this.schedulerActionCtor(this,mn).schedule(qt,lt)}}Ae.now=ye.l.now;const st=new class Be extends Ae{constructor(mn,lt=Ae.now){super(mn,lt),this.actions=[],this._active=!1,this._scheduled=void 0}flush(mn){const{actions:lt}=this;if(this._active)return void lt.push(mn);let qt;this._active=!0;do{if(qt=mn.execute(mn.state,mn.delay))break}while(mn=lt.shift());if(this._active=!1,qt){for(;mn=lt.shift();)mn.unsubscribe();throw qt}}}(class tt extends Ze{constructor(mn,lt){super(mn,lt),this.scheduler=mn,this.work=lt,this.pending=!1}schedule(mn,lt=0){if(this.closed)return this;this.state=mn;const qt=this.id,En=this.scheduler;return null!=qt&&(this.id=this.recycleAsyncId(En,qt,lt)),this.pending=!0,this.delay=lt,this.id=this.id||this.requestAsyncId(En,this.id,lt),this}requestAsyncId(mn,lt,qt=0){return Pe.setInterval(mn.flush.bind(mn,this),qt)}recycleAsyncId(mn,lt,qt=0){if(null!=qt&&this.delay===qt&&!1===this.pending)return lt;Pe.clearInterval(lt)}execute(mn,lt){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const qt=this._execute(mn,lt);if(qt)return qt;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(mn,lt){let En,qt=!1;try{this.work(mn)}catch(yi){qt=!0,En=yi||new Error("Scheduled action threw falsy error")}if(qt)return this.unsubscribe(),En}unsubscribe(){if(!this.closed){const{id:mn,scheduler:lt}=this,{actions:qt}=lt;this.work=this.state=this.scheduler=null,this.pending=!1,(0,Ge.P)(qt,this),null!=mn&&(this.id=this.recycleAsyncId(lt,mn,null)),this.delay=null,super.unsubscribe()}}});var Yt=k(4482),xn=k(5403);const Bt=(0,k(7423).fo)("Geolocation",{web:()=>k.e(4561).then(k.bind(k,4561)).then(Tn=>new Tn.GeolocationWeb)});var Dt=k(8274),ht=k(6260);function Lt(Tn,mn){1&Tn&&Dt._UZ(0,"ion-icon",13)}function _e(Tn,mn){1&Tn&&Dt._UZ(0,"ion-spinner")}function it(Tn,mn){if(1&Tn){const lt=Dt.EpF();Dt.TgZ(0,"ion-button",3),Dt.NdJ("click",function(){return Dt.CHM(lt),Dt.oxw().openSideView()}),Dt._UZ(1,"ion-icon",14),Dt.qZA()}}function Ot(Tn,mn){1&Tn&&(Dt.ynx(0),Dt.TgZ(1,"div",15)(2,"p"),Dt._uU(3,"There was a problem communicating with Open Charge Map. Please check your data connection."),Dt.qZA()(),Dt.BQk())}let Qt=(()=>{class Tn{constructor(lt,qt,En,yi,Ui,Xi,mr,di,Ai,Hi,ri,on){this.appManager=lt,this.nav=qt,this.events=En,this.translate=yi,this.platform=Ui,this.poiManager=Xi,this.mapping=mr,this.journeyManager=di,this.zone=Ai,this.modalController=Hi,this.alertController=ri,this.logging=on,this.mapDisplayed=!1,this.initialResultsShown=!1,this.searchOnDemand=!1,this.poiViewMode="modal",this.sideViewAvailable=!1,this.routePlanningMode=!0,this.searchKeyword="",this.appConfig=new De.X,this.defaultMapZoom=15,this.defaultStartPos=new se.wC(37.415328,-122.076575),this._watchId=null,this.mapCanvasID="map-canvas",this.mapping.setMapType(lt.searchSettings.MapType),this.mapping.setMapAPI(ne.N.defaultMapProvider),(0,ve.R)(window,"resize").pipe(function Ht(Tn,mn=st){return(0,Yt.e)((lt,qt)=>{let En=null,yi=null,Ui=null;const Xi=()=>{if(En){En.unsubscribe(),En=null;const di=yi;yi=null,qt.next(di)}};function mr(){const di=Ui+Tn,Ai=mn.now();if(Ai<di)return En=this.schedule(void 0,di-Ai),void qt.add(En);Xi()}lt.subscribe((0,xn.x)(qt,di=>{yi=di,Ui=mn.now(),En||(En=mn.schedule(mr,Tn),qt.add(En))},()=>{Xi(),qt.complete()},void 0,()=>{yi=En=null}))})}(500)).subscribe(qe=>{let dt={width:we.c.getClientHeight(),height:we.c.getClientWidth()};this.events.publish("ocm:window:resized",[dt])})}ionViewDidEnter(){this.logging.log("Entered search page.",Ue.i.VERBOSE),this.mapping.focusMap(),this.mapping.updateMapSize()}ionViewWillLeave(){this.logging.log("Leaving search page.",Ue.i.VERBOSE),this.mapping.unfocusMap()}getPreferredMapHeight(lt){return null==lt&&(lt=we.c.getClientHeight()),lt-56}enforceMapHeight(lt){this.logging.log("Would resize map:"+lt.width+" "+lt.height,Ue.i.VERBOSE),this.checkViewportMode();const qt=this.getPreferredMapHeight(lt[0]);document.getElementById(this.mapCanvasID).offsetHeight!==qt&&(document.getElementById(this.mapCanvasID).style.height=qt+"px"),this.mapping&&(this.logging.log("Map height:"+qt,Ue.i.VERBOSE),this.mapping.updateMapSize())}checkViewportMode(){}initialiseMapping(){var lt=this;return(0,v.Z)(function*(){yield lt.platform.ready(),lt.debouncedRefreshMapResults=we.c.debounce(lt.refreshMapResults,1e3,!1),lt.events.subscribe("ocm:mapping:ready",(0,v.Z)(function*(){if(lt.logging.log("init map: mapping ready"),lt.mapping&&lt.mapping.updateMapSize(),!lt.initialResultsShown)if(lt.appManager.searchSettings.StartSearchPosition)lt.searchOnDemand=!0,lt.mapping.updateMapCentrePos(lt.appManager.searchSettings.StartSearchPosition.latitude,lt.appManager.searchSettings.StartSearchPosition.longitude,!0,lt.defaultMapZoom);else{let qt=localStorage.getItem("_locationEnabled");1==lt.appManager.isEmbeddedMode&&"true"!=qt?yield(yield lt.alertController.create({header:"Search using your location?",message:"Select OK to continue.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:(yi=(0,v.Z)(function*(Ui){yield lt.useFallbackPosition()}),function(Xi){return yi.apply(this,arguments)})},{text:"OK",handler:function(){var yi=(0,v.Z)(function*(){yield lt.locateUser()});return function(){return yi.apply(this,arguments)}}()}]})).present():(yield lt.locateUser(),lt.mapping&&lt.mapping.updateMapSize())}var yi})),lt.events.subscribe("ocm:mapping:zoom",()=>{lt.debouncedRefreshMapResults()}),lt.events.subscribe("ocm:mapping:dragend",()=>{lt.debouncedRefreshMapResults()}),lt.events.subscribe("ocm:poiList:updated",qt=>{lt.showPOIListOnMap(qt)}),lt.events.subscribe("ocm:poiList:cleared",()=>{lt.mapping.clearMarkers(),setTimeout(()=>{lt.debouncedRefreshMapResults()},500)}),lt.events.subscribe("ocm:window:resized",qt=>{null!=qt&&qt.length>0&&lt.enforceMapHeight(qt[0])}),lt.events.subscribe("ocm:poi:selected",qt=>{if(qt.poi)lt.viewPOIDetails(qt,qt.poi);else{let En=lt.getPOIByID(qt.poiId);lt.viewPOIDetails(qt,En)}}),lt.checkViewportMode(),lt.mapping.initMap(lt.mapCanvasID)})()}ngAfterViewInit(){var lt=this;return(0,v.Z)(function*(){yield lt.initialiseMapping()})()}ngOnInit(){var lt=this;return(0,v.Z)(function*(){lt.logging.log("Refreshing reference data ..",Ue.i.VERBOSE),(yield lt.appManager.referenceDataManager.refreshReferenceData(lt.appManager.api))||(lt.appManager.isOffline=!0)})()}showPOIListOnMap(lt){const qt=this.getPreferredMapHeight(null);this.mapping.refreshMapView(qt,this.poiManager.poiList,null),this.mapDisplayed||(this.mapDisplayed=!0)}getIconForPOI(lt){return we.c.getIconForPOI(lt)}getPOIByID(lt){const qt=this.poiManager.poiList;for(let En=0;En<qt.length;En++)if(qt[En].ID===lt)return qt[En];return null}refreshMapResults(){var lt=this;return(0,v.Z)(function*(){if(!lt.searchOnDemand)return void lt.logging.log("Skipping refresh, search on demand disabled..",Ue.i.VERBOSE);lt.logging.log("Refreshing Results..",Ue.i.VERBOSE);const qt=new Ie.b;let En=null;if(lt.appManager.searchSettings.StartSearchPosition&&(En=new se.jR(lt.appManager.searchSettings.StartSearchPosition.latitude,lt.appManager.searchSettings.StartSearchPosition.longitude),lt.appManager.searchSettings.StartSearchPosition=null),En&&0==En.coords.latitude&&0==En.coords.longitude)return void lt.logging.log("Map center is zero. No query will be performed",Ue.i.WARNING);if(null!=En)qt.latitude=En.coords.latitude,qt.longitude=En.coords.longitude,qt.distance=25,qt.boundingbox=null,lt.appManager.searchSettings.LastSearchPosition=new se.wC(En.coords.latitude,En.coords.longitude);else{qt.latitude=null,qt.longitude=null;let Ui=yield lt.mapping.getMapBounds().toPromise();qt.boundingbox="("+Ui[0].latitude+","+Ui[0].longitude+"),("+Ui[1].latitude+","+Ui[1].longitude+")",lt.logging.log(JSON.stringify(Ui),Ue.i.VERBOSE)}qt.includeComments=!0,qt.enableCaching=!0,null!=lt.appManager.searchSettings&&(null!=lt.appManager.searchSettings.ConnectionTypeList&&(qt.connectionTypeIdList=lt.appManager.searchSettings.ConnectionTypeList),null!=lt.appManager.searchSettings.UsageTypeList&&(qt.usageTypeIdList=lt.appManager.searchSettings.UsageTypeList),null!=lt.appManager.searchSettings.StatusTypeList&&(qt.statusTypeIdList=lt.appManager.searchSettings.StatusTypeList),null!=lt.appManager.searchSettings.OperatorList&&(qt.operatorIdList=lt.appManager.searchSettings.OperatorList),null!=lt.appManager.searchSettings.MinPowerKW&&lt.appManager.searchSettings.MinPowerKW>0&&(qt.minPowerKW=lt.appManager.searchSettings.MinPowerKW),null!=lt.appManager.searchSettings.MaxPowerKW&&lt.appManager.searchSettings.MaxPowerKW>0&&(qt.maxPowerKW=lt.appManager.searchSettings.MaxPowerKW),null!=lt.journeyManager.getRoutePolyline()&&(qt.polyline=lt.journeyManager.getRoutePolyline(),qt.boundingbox=null,qt.levelOfDetail=null,qt.latitude=null,qt.longitude=null)),lt.appManager.isRequestInProgress=!0;let yi=yield lt.poiManager.refreshPOIList(qt);lt.appManager.isRequestInProgress=!1,lt.initialResultsShown=!0,yi>=qt.maxResults&&lt.appManager.showToastNotification("A maximum of "+yi+" results are returned per search. Zoom in for details.")})()}viewPOIDetails(lt,qt){this.logging.log("Viewing/fetching ["+this.poiViewMode+"] POI Details "+lt.poiId),null!=qt?(this.mapping.unfocusMap(),this.modalController.create({component:ue.H,componentProps:{item:qt}}).then(En=>{En.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),En.present()})):this.poiManager.getPOIById(lt.poiId,!0).then(En=>{this.logging.log("Got POI Details "+En.ID),"modal"===this.poiViewMode&&(this.searchOnDemand=!1,this.modalController.create({component:ue.H,componentProps:{item:En}}).then(yi=>{yi.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),yi.present()}),this.mapping.unfocusMap()),"side"===this.poiViewMode&&(this.selectedPOI=En)},En=>{this.appManager.showToastNotification("POI Details not available")})}closePOIDetails(){this.selectedPOI=null}openRoutePlannerModal(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:X.u}).then(lt=>{lt.onDidDismiss().then(qt=>{this.logging.log("Dismissing Route Planner Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),lt.present()})}openSearchOptions(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:ge.N}).then(lt=>{lt.onDidDismiss().then(qt=>{this.mapping.focusMap(),this.searchOnDemand=!0}),lt.present()})}openSideView(){this.poiViewMode="side",this.mapping.updateMapSize()}closeSideView(){this.poiViewMode="modal",this.mapping.updateMapSize()}planRoute(){this.routePlanningMode=!0}search(lt){this.placeSearchMapPOI.getPlacesAutoComplete(lt,"poiSearch")}useFallbackPosition(){let lt=this.defaultStartPos;null!=this.appManager.searchSettings.LastSearchPosition&&(lt=this.appManager.searchSettings.LastSearchPosition),this.appManager.searchSettings.StartSearchPosition=lt,this.appManager.searchSettings.LastSearchPosition=null,this.searchOnDemand=!0,this.mapping.updateMapCentrePos(lt.latitude,lt.longitude,!0,this.defaultMapZoom)}getPosition(lt={}){var qt=this;return(0,v.Z)(function*(){return new Promise((En,yi)=>{qt._watchId=Bt.watchPosition(lt,(Ui,Xi)=>{Bt.clearWatch({id:qt._watchId}),Xi?yi(Xi):En(Ui)})})})()}locateUser(){var lt=this;return(0,v.Z)(function*(){lt.useFallbackPosition();try{lt.logging.log("Attempting to locate user..");const qt=yield lt.getPosition({timeout:1e4});if(!qt)throw"Failed to get user location.";return lt.logging.log("Got user location."),lt.appManager.searchSettings.StartSearchPosition=new se.wC(qt.coords.latitude,qt.coords.longitude),lt.searchOnDemand=!0,lt.mapping.updateMapCentrePos(qt.coords.latitude,qt.coords.longitude,!0,lt.defaultMapZoom),localStorage.setItem("_locationEnabled","true"),!0}catch(qt){return lt.logging.log("Failed to get user location. Searching using default or last position."+qt),lt.appManager.showToastNotification("Your location could not be determined."),lt.useFallbackPosition(),!1}})()}placeSelected(lt){this.searchKeyword=lt.Address,this.logging.log("Got place details:"+lt.Address),this.mapping.focusMap(),this.mapping.updateMapCentrePos(lt.Location.latitude,lt.Location.longitude,!0),this.debouncedRefreshMapResults()}}return Tn.\u0275fac=function(lt){return new(lt||Tn)(Dt.Y36(We.c),Dt.Y36(ie.SH),Dt.Y36(ht.z),Dt.Y36(m.sK),Dt.Y36(ie.t4),Dt.Y36(He.R),Dt.Y36(ke.v),Dt.Y36(Ne.i),Dt.Y36(Dt.R0b),Dt.Y36(ie.IN),Dt.Y36(ie.Br),Dt.Y36(Ue.z))},Tn.\u0275cmp=Dt.Xpm({type:Tn,selectors:[["ng-component"]],viewQuery:function(lt,qt){if(1&lt&&Dt.Gf(Qe.v,7),2&lt){let En;Dt.iGM(En=Dt.CRH())&&(qt.placeSearchMapPOI=En.first)}},decls:18,vars:10,consts:[["slot","start"],["autocapitalize","on","autocomplete","on",3,"ngModel","placeholder","debounce","ngModelChange","ionInput"],["slot","end"],[3,"click"],["name","locate","slot","start",4,"ngIf"],[4,"ngIf"],[3,"color","click"],["name","options","slot","end"],[3,"click",4,"ngIf"],[1,"search-page"],[3,"placeChanged"],["placeSearchMapPOI",""],["id","map-canvas",2,"height","100%","width","100%","min-height","300px"],["name","locate","slot","start"],["name","car","title","Route","slot","end"],[2,"position","absolute"]],template:function(lt,qt){1&lt&&(Dt.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),Dt._UZ(3,"ion-menu-button"),Dt.qZA(),Dt.TgZ(4,"ion-searchbar",1),Dt.NdJ("ngModelChange",function(yi){return qt.searchKeyword=yi})("ionInput",function(yi){return qt.search(yi)}),Dt.ALo(5,"translate"),Dt.qZA(),Dt.TgZ(6,"ion-buttons",2)(7,"ion-button",3),Dt.NdJ("click",function(){return qt.locateUser()}),Dt.YNc(8,Lt,1,0,"ion-icon",4),Dt.YNc(9,_e,1,0,"ion-spinner",5),Dt.qZA(),Dt.TgZ(10,"ion-button",6),Dt.NdJ("click",function(){return qt.openSearchOptions()}),Dt._UZ(11,"ion-icon",7),Dt.qZA(),Dt.YNc(12,it,2,0,"ion-button",8),Dt.qZA()()(),Dt.TgZ(13,"ion-content",9)(14,"place-search",10,11),Dt.NdJ("placeChanged",function(yi){return qt.placeSelected(yi)}),Dt.qZA(),Dt.YNc(16,Ot,4,0,"ng-container",5),Dt._UZ(17,"div",12),Dt.qZA()),2&lt&&(Dt.xp6(4),Dt.Q6J("ngModel",qt.searchKeyword)("placeholder",Dt.lcZ(5,8,"ocm.search.performSearch"))("debounce",500),Dt.xp6(4),Dt.Q6J("ngIf",!qt.appManager.isRequestInProgress),Dt.xp6(1),Dt.Q6J("ngIf",qt.appManager.isRequestInProgress),Dt.xp6(1),Dt.Q6J("color",qt.appManager.searchSettings.HasActiveFilters?"danger":"default"),Dt.xp6(2),Dt.Q6J("ngIf",1==qt.sideViewAvailable&&"modal"==qt.poiViewMode),Dt.xp6(4),Dt.Q6J("ngIf",qt.appManager.isOffline))},directives:[ie.Gu,ie.sr,ie.Sm,ie.fG,ie.VI,ie.j9,l.JJ,l.On,ie.YG,ce.O5,ie.gu,ie.PQ,ie.W2,Qe.v],pipes:[m.X$],styles:[".search-page[_ngcontent-%COMP%]   #map-canvas[_ngcontent-%COMP%]{width:100%;height:98%}.search-page[_ngcontent-%COMP%]   #place-search[_ngcontent-%COMP%]{min-height:300px;background-color:#f0f0f0;position:absolute;z-index:100;width:100%}.search-page[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]{flex:.4}.search-page[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%], .search-page[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%], .search-page[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding:0}.search-page[_ngcontent-%COMP%]   scroll-content[_ngcontent-%COMP%]{overflow-y:hidden}.search-page[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]{padding-left:2em}.search-page[_ngcontent-%COMP%]   .sideview[_ngcontent-%COMP%]{background:#eeeeee;background:linear-gradient(to bottom,#eeeeee 0%,white 100%)}"]}),Tn})(),_n=(()=>{class Tn{}return Tn.\u0275fac=function(lt){return new(lt||Tn)},Tn.\u0275mod=Dt.oAB({type:Tn}),Tn.\u0275inj=Dt.cJS({imports:[[ce.ez,l.u5,ie.Pc,m.aw,d.e,re.Bz.forChild([{path:"",component:Qt}])]]}),Tn})()},6314:(Ln,At,k)=>{"use strict";k.d(At,{N:()=>ve});var d=k(9671),m=k(9698),ce=k(3855),l=k(7627),ie=k(6579),re=k(4781),v=k(8274),ne=k(9634),De=k(6260),ge=k(6895),X=k(4006),ue=k(4463);let se=(()=>{class me extends ue.X${constructor(Pe,Ge){super(Pe,Ge)}transform(Pe,...Ge){let tt=super.transform(Pe,...Ge);return tt==Pe?null!=Ge&&Ge[0].default?Ge[0].default:Ge[0].Title?Ge[0].Title:tt:tt}}return me.\u0275fac=function(Pe){return new(Pe||me)(v.Y36(ue.sK,16),v.Y36(v.sBO,16))},me.\u0275pipe=v.Yjl({name:"nullableTranslate",type:me,pure:!0}),me.\u0275prov=v.Yz7({token:me,factory:me.\u0275fac}),me})();function Ie(me,Ze){if(1&me){const Pe=v.EpF();v.TgZ(0,"p",21),v._UZ(1,"ion-icon",22),v._uU(2," One or more filters are currently being applied. "),v.TgZ(3,"ion-button",23),v.NdJ("click",function(){return v.CHM(Pe),v.oxw().clearFilters()}),v._UZ(4,"ion-icon",24),v.TgZ(5,"ion-label"),v._uU(6,"Clear"),v.qZA()()()}}function we(me,Ze){if(1&me&&(v.TgZ(0,"ion-select-option",26),v._uU(1),v.qZA()),2&me){const Pe=Ze.$implicit;v.Q6J("value",Pe.ID),v.xp6(1),v.Oqu(Pe.Title)}}function Ue(me,Ze){if(1&me){const Pe=v.EpF();v.TgZ(0,"ion-item")(1,"ion-label"),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"ion-select",14),v.NdJ("ngModelChange",function(tt){return v.CHM(Pe),v.oxw().searchSettings.FilterOptionsByCountryId=tt})("ionChange",function(){return v.CHM(Pe),v.oxw().onCountryChange()}),v.TgZ(5,"ion-select",25),v._uU(6,"(All Countries)"),v.qZA(),v.YNc(7,we,2,2,"ion-select-option",4),v.qZA()()}if(2&me){const Pe=v.oxw();v.xp6(2),v.Oqu(v.lcZ(3,3,"ocm.search.countries")),v.xp6(2),v.Q6J("ngModel",Pe.searchSettings.FilterOptionsByCountryId),v.xp6(3),v.Q6J("ngForOf",Pe.countries)}}function Ne(me,Ze){if(1&me&&(v.TgZ(0,"ion-select-option",26),v._uU(1),v.ALo(2,"nullableTranslate"),v.qZA()),2&me){const Pe=Ze.$implicit;v.Q6J("value",Pe.ID),v.xp6(1),v.Oqu(v.xi3(2,2,"ocm.reference.operatorInfo.value_"+Pe.ID,Pe))}}function ke(me,Ze){if(1&me&&(v.TgZ(0,"ion-select-option",26),v._uU(1),v.ALo(2,"nullableTranslate"),v.qZA()),2&me){const Pe=Ze.$implicit;v.Q6J("value",Pe.ID),v.xp6(1),v.Oqu(v.xi3(2,2,"ocm.reference.usageType.value_"+Pe.ID,Pe))}}function He(me,Ze){if(1&me&&(v.TgZ(0,"ion-select-option",26),v._uU(1),v.ALo(2,"nullableTranslate"),v.qZA()),2&me){const Pe=Ze.$implicit;v.Q6J("value",Pe.ID),v.xp6(1),v.Oqu(v.xi3(2,2,"ocm.reference.statusType.value_"+Pe.ID,Pe))}}function We(me,Ze){if(1&me&&(v.TgZ(0,"ion-select-option",26),v._uU(1),v.ALo(2,"nullableTranslate"),v.qZA()),2&me){const Pe=Ze.$implicit;v.Q6J("value",Pe.ID),v.xp6(1),v.Oqu(v.xi3(2,2,"ocm.reference.connectionType.value_"+Pe.ID,Pe))}}function Qe(me,Ze){if(1&me&&(v.TgZ(0,"ion-select-option",26),v._uU(1),v.qZA()),2&me){const Pe=Ze.$implicit;v.Q6J("value",Pe.code),v.xp6(1),v.Oqu(Pe.title)}}let ve=(()=>{class me{constructor(Pe,Ge,tt,ye,Ae){this.appManager=Pe,this.poiManager=Ge,this.mapping=tt,this.modalController=ye,this.events=Ae,this.maxPower=l.U,this.powerRange={lower:0,upper:this.maxPower},this._languages=[],this.searchSettings=Pe.searchSettings}ngOnInit(){var Pe=this;return(0,d.Z)(function*(){null!=Pe.searchSettings.MinPowerKW&&(Pe.powerRange.lower=Pe.searchSettings.MinPowerKW),null!=Pe.searchSettings.MaxPowerKW&&(Pe.powerRange.upper=Pe.searchSettings.MaxPowerKW),0==Pe.powerRange.upper&&(Pe.powerRange.upper=Pe.maxPower),Pe.appManager.analytics.viewEvent("Settings"),Pe.useFilteredOptions&&(yield Pe.onCountryChange())})()}get useFilteredOptions(){return this.searchSettings.FilterOptionsByCountryId>0}clearFilters(){this.searchSettings.ClearActiveFilters(),this.powerRange={lower:0,upper:this.maxPower},this.searchSettings.CheckForActiveFilters()}get operators(){return this.appManager.referenceDataManager.getNetworkOperators(this.useFilteredOptions)}get connectionTypes(){return this.appManager.referenceDataManager.getConnectionTypes(this.useFilteredOptions)}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes(this.useFilteredOptions)}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes(this.useFilteredOptions)}get countries(){return this.appManager.referenceDataManager.getCountries(this.useFilteredOptions)}get isCountryFilterFeatureEnabled(){return ie.c.isFeatureEnabled("FILTER_OPTIONS_BY_COUNTRY")}get languages(){return this._languages.length>0||(this._languages=this.appManager.getLanguages()),this._languages}ionViewWillLeave(){null!=this.searchSettings.Language&&this.appManager.setLanguage(this.searchSettings.Language),this.searchSettings.MinPowerKW=this.powerRange.lower,this.searchSettings.MaxPowerKW=this.powerRange.upper,1==this.searchSettings.MinPowerKW&&(this.searchSettings.MinPowerKW=null),this.searchSettings.MaxPowerKW==this.maxPower&&(this.searchSettings.MaxPowerKW=null),this.appManager.searchSettings=this.searchSettings,this.appManager.saveSearchSettings(),this.events.publish("ocm:poiList:cleared")}onLanguageChange(){null!=this.searchSettings.Language&&""!=this.searchSettings.Language&&this.appManager.setLanguage(this.searchSettings.Language)}onCountryChange(){var Pe=this;return(0,d.Z)(function*(){Pe.appManager.referenceDataManager.refreshFilteredReferenceData(Pe.appManager.api,{CountryIds:[Pe.searchSettings.FilterOptionsByCountryId]})})()}onMapTypeChange(){var Pe=this;return(0,d.Z)(function*(){Pe.mapping.setMapType(Pe.searchSettings.MapType)})()}close(){this.modalController.dismiss()}}return me.\u0275fac=function(Pe){return new(Pe||me)(v.Y36(ce.c),v.Y36(m.R),v.Y36(re.v),v.Y36(ne.IN),v.Y36(De.z))},me.\u0275cmp=v.Xpm({type:me,selectors:[["ng-component"]],decls:77,vars:38,consts:[[1,"settings-page","ion-padding"],["danger","",4,"ngIf"],[4,"ngIf"],["multiple","true","cancelText","Cancel","okText","OK",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["lines","none"],["dualKnobs","true","min","0","max","650","pin","true",3,"ngModel","ngModelChange"],["slot","start","size","small","name","flash"],["slot","end","name","flash"],["slot","start",2,"padding-top","0"],["type","number","min","0",2,"width","3em","border","none",3,"ngModel","max","ngModelChange"],["slot","end",2,"padding-top","0"],["type","number",2,"width","3em","border","none",3,"ngModel","max","min","ngModelChange"],["multiple","false",3,"ngModel","ngModelChange","ionChange"],["multiple","false","cancelText","Cancel","okText","OK",3,"ngModel","ngModelChange","ionChange"],["value","ROADMAP"],["value","SATELLITE"],[3,"ngModel","ngModelChange"],["slot","end"],[3,"click"],["name","close","slot","start"],["danger",""],["name","alert"],["size","small","color","light",3,"click"],["slot","start","name","close"],["value",""],[3,"value"]],template:function(Pe,Ge){1&Pe&&(v.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),v._uU(3),v.ALo(4,"translate"),v.qZA()()(),v.TgZ(5,"ion-content",0)(6,"h2"),v._uU(7,"Search Filters"),v.qZA(),v.TgZ(8,"p"),v._uU(9,"Note: Filters will remove usable charging locations from your search results if we do not have complete data (i.e Operator or Power Levels)."),v.qZA(),v.YNc(10,Ie,7,0,"p",1),v.TgZ(11,"ion-list"),v.YNc(12,Ue,8,5,"ion-item",2),v.TgZ(13,"ion-item")(14,"ion-label"),v._uU(15),v.ALo(16,"translate"),v.qZA(),v.TgZ(17,"ion-select",3),v.NdJ("ngModelChange",function(ye){return Ge.searchSettings.OperatorList=ye}),v.YNc(18,Ne,3,5,"ion-select-option",4),v.qZA()(),v.TgZ(19,"ion-item")(20,"ion-label"),v._uU(21),v.ALo(22,"translate"),v.qZA(),v.TgZ(23,"ion-select",3),v.NdJ("ngModelChange",function(ye){return Ge.searchSettings.UsageTypeList=ye}),v.YNc(24,ke,3,5,"ion-select-option",4),v.qZA()(),v.TgZ(25,"ion-item")(26,"ion-label"),v._uU(27),v.ALo(28,"translate"),v.qZA(),v.TgZ(29,"ion-select",3),v.NdJ("ngModelChange",function(ye){return Ge.searchSettings.StatusTypeList=ye}),v.YNc(30,He,3,5,"ion-select-option",4),v.qZA()(),v.TgZ(31,"ion-item")(32,"ion-label"),v._uU(33),v.ALo(34,"translate"),v.qZA(),v.TgZ(35,"ion-select",3),v.NdJ("ngModelChange",function(ye){return Ge.searchSettings.ConnectionTypeList=ye}),v.YNc(36,We,3,5,"ion-select-option",4),v.qZA()(),v.TgZ(37,"ion-item",5)(38,"ion-range",6),v.NdJ("ngModelChange",function(ye){return Ge.powerRange=ye}),v.TgZ(39,"ion-icon",7),v._uU(40,"0"),v.qZA(),v._UZ(41,"ion-icon",8),v.qZA()(),v.TgZ(42,"ion-item",5)(43,"ion-note",9),v._uU(44,"Min. Power (kW)"),v._UZ(45,"br"),v.TgZ(46,"input",10),v.NdJ("ngModelChange",function(ye){return Ge.powerRange.lower=ye}),v.qZA()(),v.TgZ(47,"ion-note",11),v._uU(48,"Max. Power (kW)"),v._UZ(49,"br"),v.TgZ(50,"input",12),v.NdJ("ngModelChange",function(ye){return Ge.powerRange.upper=ye}),v.qZA()()()(),v.TgZ(51,"h2"),v._uU(52," General Settings "),v.qZA(),v.TgZ(53,"ion-item")(54,"ion-label"),v._uU(55,"Language"),v.qZA(),v.TgZ(56,"ion-select",13),v.NdJ("ngModelChange",function(ye){return Ge.searchSettings.Language=ye})("ionChange",function(){return Ge.onLanguageChange()}),v.YNc(57,Qe,2,2,"ion-select-option",4),v.qZA()(),v.TgZ(58,"ion-item")(59,"ion-label"),v._uU(60),v.ALo(61,"translate"),v.qZA(),v.TgZ(62,"ion-select",14),v.NdJ("ngModelChange",function(ye){return Ge.searchSettings.MapType=ye})("ionChange",function(){return Ge.onMapTypeChange()}),v.TgZ(63,"ion-select-option",15),v._uU(64,"Road Map"),v.qZA(),v.TgZ(65,"ion-select-option",16),v._uU(66,"Satellite"),v.qZA()()(),v.TgZ(67,"ion-item")(68,"ion-label"),v._uU(69,"Enable Advanced Editor Options"),v.qZA(),v.TgZ(70,"ion-toggle",17),v.NdJ("ngModelChange",function(ye){return Ge.searchSettings.EnableAdvancedEditorFeatures=ye}),v.qZA()()(),v.TgZ(71,"ion-footer")(72,"ion-toolbar")(73,"ion-buttons",18)(74,"ion-button",19),v.NdJ("click",function(){return Ge.close()}),v._UZ(75,"ion-icon",20),v._uU(76," Close "),v.qZA()()()()),2&Pe&&(v.xp6(3),v.hij(" ",v.lcZ(4,26,"ocm.general.settings")," "),v.xp6(7),v.Q6J("ngIf",1==Ge.searchSettings.HasActiveFilters),v.xp6(2),v.Q6J("ngIf",Ge.isCountryFilterFeatureEnabled),v.xp6(3),v.Oqu(v.lcZ(16,28,"ocm.search.networkOperators")),v.xp6(2),v.Q6J("ngModel",Ge.searchSettings.OperatorList),v.xp6(1),v.Q6J("ngForOf",Ge.operators),v.xp6(3),v.Oqu(v.lcZ(22,30,"ocm.search.usageTypes")),v.xp6(2),v.Q6J("ngModel",Ge.searchSettings.UsageTypeList),v.xp6(1),v.Q6J("ngForOf",Ge.usageTypes),v.xp6(3),v.Oqu(v.lcZ(28,32,"ocm.search.operationalStatusTypes")),v.xp6(2),v.Q6J("ngModel",Ge.searchSettings.StatusTypeList),v.xp6(1),v.Q6J("ngForOf",Ge.statusTypes),v.xp6(3),v.Oqu(v.lcZ(34,34,"ocm.search.connectionTypes")),v.xp6(2),v.Q6J("ngModel",Ge.searchSettings.ConnectionTypeList),v.xp6(1),v.Q6J("ngForOf",Ge.connectionTypes),v.xp6(2),v.Q6J("ngModel",Ge.powerRange),v.xp6(8),v.Q6J("ngModel",Ge.powerRange.lower)("max",Ge.powerRange.upper),v.xp6(4),v.Q6J("ngModel",Ge.powerRange.upper)("max",Ge.maxPower)("min",Ge.powerRange.lower),v.xp6(6),v.Q6J("ngModel",Ge.searchSettings.Language),v.xp6(1),v.Q6J("ngForOf",Ge.languages),v.xp6(3),v.Oqu(v.lcZ(61,36,"ocm.details.location.map")),v.xp6(2),v.Q6J("ngModel",Ge.searchSettings.MapType),v.xp6(8),v.Q6J("ngModel",Ge.searchSettings.EnableAdvancedEditorFeatures))},directives:[ne.Gu,ne.sr,ne.wd,ne.W2,ge.O5,ne.gu,ne.YG,ne.Q$,ne.q_,ne.Ie,ne.t9,ne.QI,X.JJ,X.On,ge.sg,ne.n0,ne.I_,ne.uN,X.qQ,X.wV,X.Fd,X.Fj,ne.ho,ne.w,ne.fr,ne.Sm],pipes:[ue.X$,se],encapsulation:2}),me})()},6779:(Ln,At,k)=>{"use strict";k.r(At),k.d(At,{SignInModule:()=>De});var d=k(9492),m=k(8936),ce=k(4463),l=k(6895),ie=k(4006),re=k(9634),v=k(6014),ne=k(8274);let De=(()=>{class ge{}return ge.\u0275fac=function(ue){return new(ue||ge)},ge.\u0275mod=ne.oAB({type:ge}),ge.\u0275inj=ne.cJS({imports:[[l.ez,ie.u5,re.Pc,ce.aw,m.e,v.Bz.forChild([{path:"",component:d.F}])]]}),ge})()},9492:(Ln,At,k)=>{"use strict";k.d(At,{F:()=>ge});var d=k(9671),m=k(7689),ce=k(3855),l=k(8274),ie=k(9634),re=k(4463),v=k(6014),ne=k(6895),De=k(4006);let ge=(()=>{class X{constructor(se,Ie,we,Ue,Ne,ke,He,We){this.appManager=se,this.modalController=Ie,this.translate=we,this.alertController=Ue,this.loadingController=Ne,this.logging=ke,this.router=He,this.location=We,this.email=""}cancelSignIn(){this.modalController.dismiss()}performSignIn(){var se=this;return(0,d.Z)(function*(){const Ie=yield se.loadingController.create({message:"Signing In.."});yield Ie.present();let we=!1;try{yield se.appManager.api.performSignIn(se.email,se.password),Ie.dismiss(),localStorage.setItem("authResponse",JSON.stringify(se.appManager.api.authResponse)),se.appManager.isUserAuthenticated(!0),se.modalController.dismiss(),se.appManager.analytics.appEvent("Profile","SignedIn")}catch(Ue){we=!0,Ie.dismiss(),yield(yield se.alertController.create({header:"Open Charge Map",subHeader:"Email or Password not recognised",buttons:["Ok"]})).present(),se.logging.log("Error logging in:"+Ue)}})()}}return X.\u0275fac=function(se){return new(se||X)(l.Y36(ce.c),l.Y36(ie.IN),l.Y36(re.sK),l.Y36(ie.Br),l.Y36(ie.HT),l.Y36(m.z),l.Y36(v.F0),l.Y36(ne.Ye))},X.\u0275cmp=l.Xpm({type:X,selectors:[["ng-component"]],decls:37,vars:8,consts:[[1,"signin-page","ion-padding"],["item-left",""],["src","assets/images/icons/branding/AppIcon_128x128.png"],[1,"ion-padding"],["position","floating"],["type","text",3,"ngModel","ngModelChange"],["type","password",3,"ngModel","ngModelChange"],[3,"click"],["slot","secondary"],["name","close","slot","start"],["slot","primary"],["type","submit","color","primary",3,"click"],["name","log-in","slot","start"]],template:function(se,Ie){1&se&&(l.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),l._uU(3),l.ALo(4,"translate"),l.qZA()()(),l.TgZ(5,"ion-content",0)(6,"ion-avatar",1),l._UZ(7,"img",2),l.qZA(),l.TgZ(8,"p",3),l._uU(9," Sign in using your Open Charge Map account. "),l.qZA(),l.TgZ(10,"ion-list")(11,"ion-item")(12,"ion-label",4),l._uU(13,"Email"),l.qZA(),l.TgZ(14,"ion-input",5),l.NdJ("ngModelChange",function(Ue){return Ie.email=Ue}),l.qZA()(),l.TgZ(15,"ion-item")(16,"ion-label",4),l._uU(17,"Password"),l.qZA(),l.TgZ(18,"ion-input",6),l.NdJ("ngModelChange",function(Ue){return Ie.password=Ue}),l.qZA()()(),l.TgZ(19,"p"),l._uU(20,"or "),l.TgZ(21,"a",7),l.NdJ("click",function(){return Ie.appManager.launchWebPage("https://openchargemap.org/site/loginprovider/register")}),l._uU(22,"Register as New User"),l.qZA(),l._uU(23," or "),l.TgZ(24,"a",7),l.NdJ("click",function(){return Ie.appManager.launchWebPage("https://openchargemap.org/site/loginprovider/passwordreset")}),l._uU(25,"Reset your password"),l.qZA()()(),l.TgZ(26,"ion-footer")(27,"ion-toolbar")(28,"ion-buttons",8)(29,"ion-button",7),l.NdJ("click",function(){return Ie.cancelSignIn()}),l._UZ(30,"ion-icon",9),l._uU(31," Cancel"),l.qZA()(),l.TgZ(32,"ion-buttons",10)(33,"ion-button",11),l.NdJ("click",function(){return Ie.performSignIn()}),l._UZ(34,"ion-icon",12),l._uU(35),l.ALo(36,"translate"),l.qZA()()()()),2&se&&(l.xp6(3),l.hij(" ",l.lcZ(4,4,"ocm.general.signIn")," "),l.xp6(11),l.Q6J("ngModel",Ie.email),l.xp6(4),l.Q6J("ngModel",Ie.password),l.xp6(17),l.hij(" ",l.lcZ(36,6,"ocm.general.signIn"),""))},directives:[ie.Gu,ie.sr,ie.wd,ie.W2,ie.BJ,ie.q_,ie.Ie,ie.Q$,ie.pK,ie.j9,De.JJ,De.On,ie.fr,ie.Sm,ie.YG,ie.gu],pipes:[re.X$],encapsulation:2}),X})()},7814:(Ln,At,k)=>{"use strict";k.d(At,{l:()=>ne});var d=k(9671),m=k(7689),ce=k(6799),l=k(8649),ie=k(529),re=k(2340),v=k(8274);let ne=(()=>{class De{constructor(X,ue,se){this.http=X,this.refData=ue,this.logging=se,this.serviceBase="https://api.openchargemap.io",this.serviceBaseURL=this.serviceBase+"/v3",this.hasAuthorizationError=!1,this.ATTRIBUTION_METADATAFIELDID=4,this.clientName="ocm.api.default",this.allowMirror=!1,this.lastPOIApiCallURL="",this.serviceBaseURL=re.N.apiBase+"/v3"}getNumberListString(X){let ue="";for(let se=0;se<X.length;se++)ue+=X[se],se<X.length&&(ue+=",");return ue}fetchPOIListByParam(X){var ue=this;return(0,d.Z)(function*(){const se=ue.serviceBaseURL+"/poi/?client="+ue.clientName+(ue.allowMirror?" &allowmirror=true":"")+"&verbose=false&output=json";X.compact=!0;let Ie="";null!=X.countryCode&&(Ie+="&countrycode="+X.countryCode),null!=X.latitude&&(Ie+="&latitude="+X.latitude),null!=X.longitude&&(Ie+="&longitude="+X.longitude),null!=X.distance&&(Ie+="&distance="+X.distance),null!=X.distanceUnit&&(Ie+="&distanceunit="+X.distanceUnit),null!=X.includeComments&&(Ie+="&includecomments="+X.includeComments),null!=X.maxResults&&(Ie+="&maxresults="+X.maxResults),null!=X.countryIdList&&(Ie+="&countryid="+ue.getNumberListString(X.countryIdList)),null!=X.levelIdList&&(Ie+="&levelid="+ue.getNumberListString(X.levelIdList)),null!=X.connectionTypeIdList&&X.connectionTypeIdList.length>0&&(Ie+="&connectiontypeid="+ue.getNumberListString(X.connectionTypeIdList)),null!=X.operatorIdList&&X.operatorIdList.length>0&&(Ie+="&operatorid="+ue.getNumberListString(X.operatorIdList)),null!=X.usageTypeIdList&&X.usageTypeIdList.length>0&&(Ie+="&usagetypeid="+ue.getNumberListString(X.usageTypeIdList)),null!=X.statusTypeIdList&&X.statusTypeIdList.length>0&&(Ie+="&statustypeid="+ue.getNumberListString(X.statusTypeIdList)),null!=X.locationTitle&&(Ie+="&locationtitle="+X.locationTitle),null!=X.minPowerKW&&X.minPowerKW>0&&(Ie+="&minpowerkw="+X.minPowerKW),null!=X.maxPowerKW&&X.maxPowerKW>0&&(Ie+="&maxpowerkw="+X.maxPowerKW),null!=X.submissionStatusTypeIdList&&(Ie+="&submissionstatustypeid="+ue.getNumberListString(X.submissionStatusTypeIdList)),null!=X.poiIdList&&X.poiIdList.length>0&&(Ie+="&chargepointid="+ue.getNumberListString(X.poiIdList)),0==X.enableCaching&&(Ie+="&enablecaching=false"),null!=X.compact&&(Ie+="&compact="+X.compact),X.levelOfDetail>1&&(Ie+="&levelofdetail="+X.levelOfDetail),null!=X.polyline&&(Ie+="&polyline="+X.polyline),null!=X.boundingbox&&(Ie+="&boundingbox="+X.boundingbox),null!=X.additionalParams&&(Ie+="&"+X.additionalParams);const we=se+Ie;if(ue.lastPOIApiCallURL===we&&0!=X.enableCaching)return ue.logging.log("Skipped API call due to same query being repeated."),[];ue.lastPOIApiCallURL=we,ue.logging.log("API Call:"+we,m.i.VERBOSE);try{let Ue=yield ue.http.get(we,ue.getHttpRequestOptions()).toPromise();return ue.refData.hydrateCompactPOIList(Ue)}catch(Ue){const Ne=Ue.message||"Could not fetch POI list from server.";throw ue.logging.log("API Client: "+JSON.stringify(Ue),m.i.ERROR),Ne}})()}getHttpRequestOptions(X=!0){let ue=new ie.WM;return X&&(ue=ue.append("Content-Type","application/json")),this.authResponse&&this.authResponse.Data&&this.authResponse.Data.access_token&&(ue=ue.append("Authorization","Bearer "+this.authResponse.Data.access_token)),ue=ue.append("X-API-Key",re.N.apiKey),{headers:ue}}fetchCoreReferenceData(X){let ue=this.serviceBaseURL+"/referencedata/?client="+this.clientName+"&output=json"+(this.allowMirror?"&allowmirror=true":"")+"&verbose=false&compact=true";return null!=X&&null!=X.CountryIds&&(ue+="&countryid="+this.getNumberListString(X.CountryIds)),this.logging.log("API Call:"+ue,m.i.VERBOSE),this.http.get(ue,this.getHttpRequestOptions())}performSignIn(X,ue){return this.http.post(this.serviceBaseURL+"/profile/authenticate/",JSON.stringify({emailaddress:X,password:ue}),this.getHttpRequestOptions()).toPromise().then(we=>(this.authResponse=we,this.authResponse))}performSubmission(X,ue){return X===l.q.POI?this.submitPOI(ue):X===l.q.Comment?this.submitUserComment(ue):X===l.q.Media?this.submitMediaItem(ue):void 0}submitUserComment(X){const ue=JSON.stringify(X);return this.logging.log("[api] Submitting user comment"),this.http.post(this.serviceBaseURL+"/comment/",ue,this.getHttpRequestOptions()).toPromise()}submitMediaItem(X){const ue=JSON.stringify(X);return this.http.post(this.serviceBaseURL+"/mediaitem/",ue,this.getHttpRequestOptions()).toPromise()}submitPOI(X){const ue=JSON.stringify(X);return this.http.post(this.serviceBaseURL+"/poi/",ue,this.getHttpRequestOptions()).toPromise()}getPanoramioLocationPhotos(X){return new Promise(ue=>{const Ie="https://www.panoramio.com/map/get_panoramas.php?set=public&from=0&to=2&minx="+(X.longitude-.001)+"&miny="+(X.latitude-.001)+"&maxx="+(X.longitude+.001)+"maxy="+(X.latitude+.001)+"&size=medium&mapfilter=true&callback=?";return console.log(Ie),this.http.get(Ie).toPromise()})}fetchReverseGeocodeResult(X,ue){return this.http.get(this.serviceBaseURL+"/geocode/?client="+this.clientName+"&output=json&camelcase=false&latitude="+X+"&longitude="+ue,this.getHttpRequestOptions()).toPromise()}isLocalStorageAvailable(){return typeof window.localStorage<"u"}setCachedDataObject(X,ue){this.isLocalStorageAvailable()&&(typeof ue>"u"&&(ue=null),null===ue?localStorage.removeItem(X):localStorage.setItem(X,JSON.stringify(ue)))}getCachedDataObject(X){if(this.isLocalStorageAvailable()){const ue=localStorage.getItem(X);if(null!=ue&&ue.length>0)return JSON.parse(ue)}return null}}return De.\u0275fac=function(X){return new(X||De)(v.LFG(ie.eN),v.LFG(ce.W),v.LFG(m.z))},De.\u0275prov=v.Yz7({token:De,factory:De.\u0275fac,providedIn:"root"}),De})()},56:(Ln,At,k)=>{"use strict";k.d(At,{c:()=>ie});var d=k(9671),m=k(7689),ce=k(8274),l=k(9634);let ie=(()=>{class re{constructor(ne,De){this.logger=ne,this.platform=De,this.isCordova=!1,this.ga=null,this.isCordova=!(!De.is("cordova")&&!De.is("capacitor"))}init(ne){var De=this;return(0,d.Z)(function*(){De.isCordova&&De.ga?yield De.ga.startTrackerWithId(ne):De.logger.log("Could not initialise analytics")})()}setAppVersion(ne){var De=this;return(0,d.Z)(function*(){if(De.isCordova&&De.ga)return De.ga.setAppVersion(ne);De.logger.log(ne)})()}appEvent(ne,De){var ge=this;return(0,d.Z)(function*(){if(ge.isCordova&&ge.ga)return ge.ga.trackEvent(ne,De);ge.logger.log(De)})()}viewEvent(ne){var De=this;return(0,d.Z)(function*(){if(De.isCordova&&De.ga)return De.ga.trackView(ne);De.logger.log(ne)})()}}return re.\u0275fac=function(ne){return new(ne||re)(ce.LFG(m.z),ce.LFG(l.t4))},re.\u0275prov=ce.Yz7({token:re,factory:re.\u0275fac,providedIn:"root"}),re})()},3855:(Ln,At,k)=>{"use strict";k.d(At,{c:()=>He});var d=k(9671),m=k(7689),ce=k(7814),l=k(7627),ie=k(4120),re=k(8649),v=k(6799),ne=k(3912),De=k(56),ge=k(2340),X=k(8274),ue=k(529),se=k(6260);class Ie{constructor(Qe,ve){this.SubmissionType=Qe,this.Data=ve,this.DateQueued=new Date,this.IsSubmitted=!1,this.IsInProgress=!1,this.IsCancelled=!1,this.IsFailure=!1,this.Attempts=0,this.ID=new Date+"_"+100*Math.random()}}let we=(()=>{class We{constructor(ve){this.events=ve,this.isQueueProcessing=!1}setAppManager(ve){this.appManager=ve}add(ve,me){let Ze=this.getQueueItems();Ze.push(new Ie(ve,me)),this.saveQueueItems(Ze)}update(ve){let me=this.getQueueItems(),Ze=new Array;return me.forEach(Pe=>{Ze.push(Pe.ID==ve.ID?ve:Pe)}),Ze}processNextQueueItem(){let ve=this.getNextQueueItem();null!=ve&&null!=this.appManager&&this.appManager.api.performSubmission(ve.SubmissionType,ve.Data).then(()=>{ve.IsSubmitted=!0,ve.Attempts++,this.update(ve),this.clear()})}getNextQueueItem(){let ve=this.getQueueItems(),me=null;return ve.forEach(Ze=>{null==me&&!Ze.IsCancelled&&!Ze.IsInProgress&&!Ze.IsSubmitted&&(me=Ze)}),me}hasPendingItems(){let ve=!1;return this.getQueueItems().forEach(Ze=>{!Ze.IsFailure&&!Ze.IsCancelled&&!Ze.IsSubmitted&&(ve=!0)}),ve}isCompleted(){let ve=this.getQueueItems(),me=!0;return ve.forEach(Ze=>{(Ze.IsInProgress||Ze.IsFailure)&&(me=!1)}),me}clear(ve=!1){let me=this.getQueueItems(),Ze=new Array;ve||me.forEach(Pe=>{(Pe.IsInProgress||Pe.IsFailure)&&Ze.push(Pe)}),this.saveQueueItems(Ze)}saveQueueItems(ve){localStorage.setItem("submissionQueue",JSON.stringify(ve))}getQueueItems(){let ve=localStorage.getItem("submissionQueue");return null!=ve?JSON.parse(ve):new Array}}return We.\u0275fac=function(ve){return new(ve||We)(X.LFG(se.z))},We.\u0275prov=X.Yz7({token:We,factory:We.\u0275fac,providedIn:"root"}),We})();var Ue=k(9634),Ne=k(4463),ke=k(4244);let He=(()=>{class We{constructor(ve,me,Ze,Pe,Ge,tt,ye,Ae,Be,st,_t,Yt,xn){this.http=ve,this.events=me,this.api=Ze,this.submissionQueue=Pe,this.platform=Ge,this.referenceDataManager=tt,this.journeyManager=ye,this.translateService=Ae,this.toastController=Be,this.loadingController=st,this.jwtHelper=_t,this.logging=Yt,this.analytics=xn,this.isRequestInProgress=!1,this.title="Open Charge Map",this._isUserAuthenticated=null,this.isEmbeddedMode=!1,this.isOffline=!1,this.api.clientName="ocm.app.ionic."+ge.N.version,this.isDebugMode=!1,this.enableSubmissionQueue=!1,this.submissionQueue.setAppManager(this),this.platformMode=Ge.is("cordova")?"cordova":"web",this.initAppManager(),this.searchSettings=new l.N,this.loadSearchSettings(),this.applyURLQueryStringOptions(),this.searchSettings.CheckForActiveFilters(),this.journeyManager.loadJourneys()}loadSearchSettings(){if(null!=localStorage.getItem("searchSettings")){this.searchSettings=new l.N;try{let ve=JSON.parse(localStorage.getItem("searchSettings"));Object.assign(this.searchSettings,ve)}catch{}}}savePushRegistration(ve){localStorage.setItem("_pushToken",ve.toString())}getPushRegistration(){localStorage.getItem("_pushToken")}getQueryVariable(ve){let Ze=window.location.search.substring(1).split("&");for(let Pe=0;Pe<Ze.length;Pe++){let Ge=Ze[Pe].split("=");if(decodeURIComponent(Ge[0])==ve)return Ge[1].split(",").map(Ae=>decodeURIComponent(Ae))}return null}applyURLQueryStringOptions(){if(this.getQueryVariable("mode")&&"embedded"==this.getQueryVariable("mode")[0]&&(this.isEmbeddedMode=!0),this.getQueryVariable("operatorid")){let ve=this.getQueryVariable("operatorid");for(let me of ve)this.searchSettings.OperatorList.unshift(parseInt(me,10))}if(this.getQueryVariable("latitude")&&this.getQueryVariable("longitude")){let ve=this.getQueryVariable("latitude")[0],me=this.getQueryVariable("longitude")[0];this.searchSettings.StartSearchPosition=new ie.wC(parseFloat(ve),parseFloat(me))}this.getQueryVariable("title")&&(this.title=this.getQueryVariable("title")[0]),this.getQueryVariable("languagecode")&&this.setLanguage(this.getQueryVariable("languagecode")[0])}saveSearchSettings(){this.searchSettings.CheckForActiveFilters(),localStorage.setItem("searchSettings",JSON.stringify(this.searchSettings))}getLanguages(){return[{code:"ar",title:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629 / Arabic"},{code:"bg",title:"Bulgarian / \u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438"},{code:"cs",title:"Czech / \u010ce\u0161tina"},{code:"de",title:"German / Deutsch"},{code:"el",title:"Greek / \u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ae"},{code:"en",title:"English"},{code:"es",title:"Spanish / Espa\xf1ol"},{code:"et",title:"Estonian / Eesti"},{code:"fi",title:"Finnish / Suomi"},{code:"fr",title:"French / Fran\xe7ais"},{code:"fy",title:"West Frisian / Frysk"},{code:"hu",title:"Hungarian / Magyar"},{code:"it",title:"Italian / Italiano"},{code:"ja",title:"Japanese / \u65e5\u672c\u8a9e"},{code:"lt",title:"Lithuanian / Lietuvi\u0173"},{code:"nl",title:"Dutch / Nederlands"},{code:"pt",title:"Portuguese / portugu\xeas"},{code:"ru",title:"Russian / P\u0443\u0441\u0441\u043a\u0438\u0439"},{code:"sk",title:"Slovak / Sloven\u010dina"},{code:"tr",title:"Turkish / T\xfcrk\xe7e"},{code:"zh",title:"Chinese / \u4e2d\u56fd\u7684"}]}setLanguage(ve){(null==ve||""==ve)&&(ve="en"),this.logging.log("Changing language: "+ve),this.translateService.use(ve)}initAppManager(){this.initAuthFromStorage(),this.isUserAuthenticated(!0)&&this.enableSubmissionQueue&&null!=this.submissionQueue&&this.submissionQueue.hasPendingItems()&&this.submissionQueue.processNextQueueItem()}initAuthFromStorage(){let ve=localStorage.getItem("authResponse");if(null!=ve){let me=JSON.parse(ve);null!=me.Data&&null!=me.Data.access_token&&(this.jwtHelper.decodeToken(me.Data.access_token),this.jwtHelper.isTokenExpired(me.Data.access_token)?localStorage.removeItem("authResponse"):(this.api.authResponse=me,this.logging.log("User has valid auth token in local storage",m.i.VERBOSE)))}}isUserAuthenticated(ve=!1){return!1===ve&&null!=this._isUserAuthenticated||(this._isUserAuthenticated=!1,null!=this.api.authResponse&&(this.jwtHelper.isTokenExpired(this.api.authResponse.Data.access_token)||(this._isUserAuthenticated=!0))),this._isUserAuthenticated}getCurrentAuthToken(){return null!=this.api.authResponse?this.api.authResponse.Data.access_token:null}getUserProfile(){return null!=this.api.authResponse?this.api.authResponse.Data.UserProfile:null}signOutCurrentUser(){localStorage.removeItem("authResponse"),this.api.authResponse=null,this._isUserAuthenticated=!1}submitComment(ve){if(!this.enableSubmissionQueue)return this.api.performSubmission(re.q.Comment,ve);this.submissionQueue.add(re.q.Comment,ve),this.submissionQueue.processNextQueueItem()}submitMediaItem(ve){if(!this.enableSubmissionQueue)return this.api.performSubmission(re.q.Media,ve);this.submissionQueue.add(re.q.Media,ve),this.submissionQueue.processNextQueueItem()}submitPOI(ve){if(!this.enableSubmissionQueue)return this.api.performSubmission(re.q.POI,ve);this.submissionQueue.add(re.q.POI,ve),this.submissionQueue.processNextQueueItem()}showToastNotification(ve){var me=this;return(0,d.Z)(function*(){yield(yield me.toastController.create({message:ve,duration:3e3})).present()})()}showLoadingProgress(ve){var me=this;return(0,d.Z)(function*(){yield(yield me.loadingController.create({message:ve})).present()})()}dismissLoadingProgress(){var ve=this;return(0,d.Z)(function*(){return ve.loadingController.dismiss()})()}launchOCMWebPage(ve){this.isUserAuthenticated(!0)&&(-1===ve.indexOf("?")&&(ve+="?"),ve+="&auth="+this.getCurrentAuthToken()),ve="https://openchargemap.org/site"+ve,window.open(ve,"_system")}launchWebPage(ve){window.open(ve,"_system")}isPlatform(ve){return this.platform.is(ve)}}return We.\u0275fac=function(ve){return new(ve||We)(X.LFG(ue.eN),X.LFG(se.z),X.LFG(ce.l),X.LFG(we),X.LFG(Ue.t4),X.LFG(v.W),X.LFG(ne.i),X.LFG(Ne.sK),X.LFG(Ue.yF),X.LFG(Ue.HT),X.LFG(ke.N0),X.LFG(m.z),X.LFG(De.c))},We.\u0275prov=X.Yz7({token:We,factory:We.\u0275fac,providedIn:"root"}),We})()},6260:(Ln,At,k)=>{"use strict";k.d(At,{z:()=>m});var d=k(8274);let m=(()=>{class ce{constructor(){this.c=new Map}subscribe(ie,...re){let v=this.c.get(ie);v||this.c.set(ie,v=[]),v.push(...re)}unsubscribe(ie,re){if(!re)return this.c.delete(ie);const v=this.c.get(ie);if(!v)return!1;const ne=v.indexOf(re);return!(ne<0||(v.splice(ne,1),0===v.length&&this.c.delete(ie),0))}publish(ie,...re){const v=this.c.get(ie);return v?v.map(ne=>{try{return ne(...re)}catch(De){return console.error(De),null}}):null}}return ce.\u0275fac=function(ie){return new(ie||ce)},ce.\u0275prov=d.Yz7({token:ce,factory:ce.\u0275fac,providedIn:"root"}),ce})()},3912:(Ln,At,k)=>{"use strict";k.d(At,{i:()=>ne});var d=k(7689),m=k(7814),ce=k(9698),l=k(8016),ie=k(129),re=k(4120),v=k(8274);let ne=(()=>{class De{constructor(X,ue,se){this.api=X,this.poiManager=ue,this.logging=se,this.journeys=[],this.favourites=[]}loadJourneys(){let X=localStorage.getItem("journeys");if(null!=X&&(this.journeys=JSON.parse(X)),null!=this.journeys)for(let ue of this.journeys)this.fetchAllJourneyPOIDetails(ue)}fetchAllJourneyPOIDetails(X){this.logging.log("Journeys - fetching poi details for Journey "+X.Title);let ue=new l.b;ue.poiIdList=[];for(let se of X.Stages)for(let Ie of se.WayPoints)for(let we of Ie.PoiIDs)ue.poiIdList.push(we);this.api.fetchPOIListByParam(ue).then(se=>{for(let Ie of se)this.updateStoredPOI(Ie)})}updateStoredPOI(X){if(this.journeys.forEach(ue=>{ue.Stages.forEach(se=>{se.WayPoints.forEach(Ie=>{Ie.PoiIDs.forEach(we=>{if(we==X.ID)if(null==Ie.PoiList){Ie.PoiList=[];let Ue=new ie.Qp("charging",1);Ue.Poi=X,Ue.PoiID=X.ID,Ie.PoiList.push(Ue)}else for(let Ue of Ie.PoiList)Ue.PoiID==X.ID&&(Ue.Poi=X)})})})}),null!=this.favourites)for(let ue of this.favourites)"charging"==ue.Type&&ue.PoiID==X.ID&&(ue.Poi=X)}saveJourneys(){let X=JSON.parse(JSON.stringify(this.journeys));for(let se of X)for(const Ie of se.Stages)for(let we of Ie.WayPoints)for(let Ue of we.PoiList)Ue.Poi=null,Ue.Photos=null;const ue=JSON.stringify(X);localStorage.setItem("journeys",ue)}addJourney(X,ue){let se=new ie.vw;se.Title="Stage 1",null!=ue&&se.WayPoints.push(ue),X.Stages.push(se),this.journeys.push(X)}deleteJourney(X){this.journeys=this.journeys.filter(ue=>ue.ID!=X),this.saveJourneys()}getJourney(X){let ue=this.journeys.filter(se=>se.ID==X);return ue.length>0?ue[0]:null}getJourneyStages(X){return this.getJourney(X).Stages}addJourneyWaypoint(X,ue,se){let Ie=this.getJourney(X);if(null==ue){let we=new ie.vw;we.Title="Stage "+(Ie.Stages.length+1),we.WayPoints.push(se),Ie.Stages.push(we)}else{let we=Ie.Stages[ue];null==we.WayPoints&&(we.WayPoints=[]),we.WayPoints.push(se)}}addJourneyStage(X,ue){return this.getJourney(X).Stages.push(ue)-1}setupTestJourneys(){this.journeys=[];let X=new ie.fw;X.Title="New York to Brooklyn",X.Notes="A little jaunt to Brooklyn",X.Stages=[];let ue=new ie.vw,se=new ie.kA;se.Notes="Starting point",se.Position=new re.wC(40,1.2),se.Title="Start",ue.WayPoints.push(se);let Ie=new ie.kA;Ie.Notes="Middle point",Ie.Position=new re.wC(40,1.33),Ie.Title="Middle",ue.WayPoints.push(Ie);let we=new ie.kA;we.Notes="End point",we.Position=new re.wC(40,1.33),we.Title="End",ue.WayPoints.push(we),X.Stages.push(ue),this.journeys.push(X);let Ue=new ie.fw;Ue.Title="Aberdeen to London",Ue.Notes="Roadtrip",Ue.Stages=[],this.journeys.push(Ue)}calculateEnergyConsumptionkWh(X,ue,se=0,Ie){return X*Ie}setRoutePolyline(X){this.routePolyline=X}getRoutePolyline(){return this.routePolyline}}return De.\u0275fac=function(X){return new(X||De)(v.LFG(m.l),v.LFG(ce.R),v.LFG(d.z))},De.\u0275prov=v.Yz7({token:De,factory:De.\u0275fac,providedIn:"root"}),De})()},7689:(Ln,At,k)=>{"use strict";k.d(At,{i:()=>ce,z:()=>l});var d=k(2340),m=k(8274),ce=(()=>{return(ie=ce||(ce={}))[ie.VERBOSE=0]="VERBOSE",ie[ie.INFO=1]="INFO",ie[ie.WARNING=2]="WARNING",ie[ie.ERROR=3]="ERROR",ce;var ie})();let l=(()=>{class ie{constructor(){this.logLevel=ce.VERBOSE,d.N.production&&(this.logLevel=ce.INFO)}log(v,ne=ce.VERBOSE){console&&console.log&&ne>=this.logLevel&&console.log("["+ce[ne]+"] {"+(new Date).toLocaleTimeString()+"} "+v)}}return ie.\u0275fac=function(v){return new(v||ie)},ie.\u0275prov=m.Yz7({token:ie,factory:ie.\u0275fac,providedIn:"root"}),ie})()},9698:(Ln,At,k)=>{"use strict";k.d(At,{R:()=>v});var d=k(9671),m=k(7689),ce=k(7814),l=k(56),ie=k(8274),re=k(6260);let v=(()=>{class ne{constructor(ge,X,ue,se){this.api=ge,this.events=X,this.logging=ue,this.analytics=se,this.isRequestInProgress=!1}refreshPOIList(ge){var X=this;return(0,d.Z)(function*(){try{return X.poiList=yield X.fetchPOIList(ge),X.events.publish("ocm:poiList:updated"),X.analytics.appEvent("Search","Fetched Results"),X.poiList.length}catch{return 0}})()}fetchPOIList(ge){var X=this;return(0,d.Z)(function*(){X.isRequestInProgress=!0;try{let ue=yield X.api.fetchPOIListByParam(ge);return X.isRequestInProgress=!1,ue&&ue.length&&X.logging.log("fetched POI list ["+ue.length+"]"),ue}catch{return X.isRequestInProgress=!1,[]}})()}clearResults(){this.poiList=[],this.events.publish("ocm:poiList:cleared"),this.logging.log("clearing results after settings change",m.i.VERBOSE)}getPOIById(ge,X=!1,ue=!1){var se=this;return(0,d.Z)(function*(){if(!ue&&null!=se.poiList){const Ue=se.poiList.find(Ne=>Ne.ID==ge);if(Ue)return Ue}const Ie={poiIdList:[ge],enableCaching:!ue,includeComments:!0},we=yield se.api.fetchPOIListByParam(Ie);return we&&we.length>0?(se.poiList&&we[0].ID==ge&&(se.poiList=se.poiList.filter(Ue=>Ue.ID!=ge),se.poiList.push(we[0]),se.logging.log("POI refreshed in cache "+ge)),we[0]):null})()}}return ne.\u0275fac=function(ge){return new(ge||ne)(ie.LFG(ce.l),ie.LFG(re.z),ie.LFG(m.z),ie.LFG(l.c))},ne.\u0275prov=ie.Yz7({token:ne,factory:ne.\u0275fac,providedIn:"root"}),ne})()},6799:(Ln,At,k)=>{"use strict";k.d(At,{W:()=>ie});var d=k(9671),m=k(7689),ce=k(8274),l=k(529);let ie=(()=>{class re{constructor(ne,De){this.http=ne,this.logging=De,this.loadCachedRefData()}refreshReferenceData(ne){var De=this;return(0,d.Z)(function*(){try{const ge=yield ne.fetchCoreReferenceData(null).toPromise();return De.setCoreReferenceData(ge),De.setFilteredReferenceData(ge),De.logging.log("Got refreshed core ref data.",m.i.VERBOSE),De.sortCoreReferenceData(),De.cacheCurrentRefData(),!0}catch(ge){return De.logging.log("Error fetching core ref data:"+ge),!1}})()}refreshFilteredReferenceData(ne,De){ne.fetchCoreReferenceData(De).subscribe(ge=>{this.setFilteredReferenceData(ge),this.sortCoreReferenceData(),this.logging.log("Got refreshed filtered reference data.",m.i.VERBOSE)},ge=>{this.logging.log("Error fetching filtered reference data:"+ge)})}setCoreReferenceData(ne){this.referenceData=ne}setFilteredReferenceData(ne){this.filteredReferenceData=ne}referenceDataLoaded(){return null!=this.referenceData}getCountries(ne=!1){return 1==ne?this.filteredReferenceData.Countries:this.referenceData.Countries}getCountryByID(ne){return this.getRefDataByID(this.referenceData.Countries,ne)}getConnectionTypes(ne=!1){return 1==ne?this.filteredReferenceData.ConnectionTypes:this.referenceData.ConnectionTypes}getConnectionTypeByID(ne){return this.getRefDataByID(this.referenceData.ConnectionTypes,ne)}getUsageTypes(ne=!1){return 1==ne?this.filteredReferenceData.UsageTypes:this.referenceData.UsageTypes.filter(De=>De.ID>0)}getUsageTypeByID(ne){return this.getRefDataByID(this.referenceData.UsageTypes,ne)}getStatusTypes(ne=!1){return 1==ne?this.filteredReferenceData.StatusTypes:this.referenceData.StatusTypes.filter(De=>De.ID>0)}getStatusTypeByID(ne){return this.getRefDataByID(this.referenceData.StatusTypes,ne)}getNetworkOperators(ne=!1){return 1==ne?this.filteredReferenceData.Operators:this.referenceData.Operators}getNetworkOperatorByID(ne){return this.getRefDataByID(this.referenceData.Operators,ne)}getDataProviders(ne=!1){return 1==ne?this.filteredReferenceData.DataProviders:this.referenceData.DataProviders}getDataProviderByID(ne){return this.getRefDataByID(this.referenceData.DataProviders,ne)}getCheckinStatusTypes(ne=!1,De=!0){let ge=null;return ge=1==ne?this.filteredReferenceData.CheckinStatusTypes:this.referenceData.CheckinStatusTypes,De&&(ge=ge.filter(X=>!1===X.IsAutomatedCheckin)),ge}getCheckinStatusTypeByID(ne){return this.getRefDataByID(this.referenceData.CheckinStatusTypes,ne)}getCommentTypes(ne=!1,De=!0){let ge;return ge=1==ne?this.filteredReferenceData.UserCommentTypes:this.referenceData.UserCommentTypes,De&&(ge=ge.filter(X=>100!==X.ID&&110!==X.ID)),ge}getCommentTypeByID(ne){return this.getRefDataByID(this.referenceData.UserCommentTypes,ne)}getSubmissionStatusTypes(ne=!1){return 1==ne?this.filteredReferenceData.SubmissionStatusTypes:this.referenceData.SubmissionStatusTypes}getSubmissionStatusTypesByID(ne){return this.getRefDataByID(this.referenceData.SubmissionStatusTypes,ne)}getChargingLevelTypes(ne=!1){return 1==ne?this.filteredReferenceData.ChargerTypes:this.referenceData.ChargerTypes}getChargingLevelTypeByID(ne){return this.getRefDataByID(this.referenceData.ChargerTypes,ne)}getOutputCurrentTypes(ne=!1){return ne?this.referenceData.CurrentTypes:this.filteredReferenceData.CurrentTypes}getOutputCurrentTypeByID(ne){return this.getRefDataByID(this.referenceData.CurrentTypes,ne)}loadCachedRefData(){const ne=localStorage.getItem("referenceData");if(null==ne)this.http.get("./assets/data/CoreReferenceData.json").subscribe(De=>{this.logging.log("Using bundled reference data as cached ref data."),this.setCoreReferenceData(De),this.setFilteredReferenceData(De)});else{let De=JSON.parse(ne);this.setCoreReferenceData(De)}this.setFilteredReferenceData(this.referenceData)}cacheCurrentRefData(){null!=this.referenceData&&(this.referenceData.CacheDate=new Date,localStorage.setItem("referenceData",JSON.stringify(this.referenceData)))}getRefDataByID(ne,De){if(""!==De&&(De=parseInt(De,10)),null!=ne)for(let ge=0;ge<ne.length;ge++)if(ne[ge].ID===De)return ne[ge];return null}sortCoreReferenceData(){this.sortReferenceData(this.referenceData.ConnectionTypes),this.sortReferenceData(this.referenceData.Countries),this.sortReferenceData(this.referenceData.Operators),this.sortReferenceData(this.referenceData.DataProviders),this.sortReferenceData(this.referenceData.UsageTypes),this.sortReferenceData(this.referenceData.StatusTypes),this.sortReferenceData(this.referenceData.CheckinStatusTypes),this.sortReferenceData(this.referenceData.SubmissionStatusTypes),this.filteredReferenceData&&(this.sortReferenceData(this.filteredReferenceData.ConnectionTypes),this.sortReferenceData(this.filteredReferenceData.Operators))}sortReferenceData(ne){ne.sort(this.sortListByTitle)}sortListByTitle(ne,De){return ne.Title<De.Title?-1:ne.Title>De.Title?1:0}getMetadataValueByMetadataFieldID(ne,De){if(""!==De&&(De=parseInt(De,10)),null!=ne)for(let ge=0;ge<ne.length;ge++)if(ne[ge].ID===De)return ne[ge];return null}hydrateCompactPOI(ne,De=!1){const ge=this;if(null!=ne.DataProviderID&&(De||null==ne.DataProvider)&&(ne.DataProvider=ge.getDataProviderByID(ne.DataProviderID)),null!=ne.OperatorID&&(De||null==ne.OperatorInfo)&&(ne.OperatorInfo=ge.getNetworkOperatorByID(ne.OperatorID)),null!=ne.UsageTypeID&&(De||null==ne.UsageType)&&(ne.UsageType=ge.getUsageTypeByID(ne.UsageTypeID)),null!=ne.AddressInfo.CountryID&&(De||null==ne.AddressInfo.Country)&&(ne.AddressInfo.Country=ge.getCountryByID(ne.AddressInfo.CountryID)),null!=ne.StatusTypeID&&(De||null==ne.StatusType)&&(ne.StatusType=ge.getStatusTypeByID(ne.StatusTypeID)),null!=ne.SubmissionStatusTypeID&&(De||null==ne.SubmissionStatusType)&&(ne.SubmissionStatusType=ge.getSubmissionStatusTypesByID(ne.SubmissionStatusTypeID)),null!=ne.Connections)for(let X=0;X<ne.Connections.length;X++){const ue=ne.Connections[X];null!=ue.ConnectionTypeID&&(De||null==ue.ConnectionType)&&(ue.ConnectionType=ge.getConnectionTypeByID(ue.ConnectionTypeID)),null!=ue.LevelID&&(De||null==ue.Level)&&(ue.Level=ge.getChargingLevelTypeByID(ue.LevelID)),null!=ue.CurrentTypeID&&(De||null==ue.CurrentType)&&(ue.CurrentType=ge.getOutputCurrentTypeByID(ue.CurrentTypeID)),null!=ue.StatusTypeID&&(De||null==ue.StatusType)&&(ue.StatusType=ge.getStatusTypeByID(ue.StatusTypeID)),ne.Connections[X]=ue}if(null!=ne.UserComments)for(let X=0;X<ne.UserComments.length;X++){const ue=ne.UserComments[X];null!=ue.CommentTypeID&&(De||null==ue.CommentType)&&(ue.CommentType=ge.getCommentTypeByID(ue.CommentTypeID)),null!=ue.CheckinStatusTypeID&&(De||null==ue.CheckinStatusType)&&(ue.CheckinStatusType=ge.getCheckinStatusTypeByID(ue.CheckinStatusTypeID)),ne.UserComments[X]=ue}return ne}hydrateCompactPOIList(ne){for(let De=0;De<ne.length;De++)ne[De]=this.hydrateCompactPOI(ne[De]);return ne}}return re.\u0275fac=function(ne){return new(ne||re)(ce.LFG(l.eN),ce.LFG(m.z))},re.\u0275prov=ce.Yz7({token:re,factory:re.\u0275fac,providedIn:"root"}),re})()},4781:(Ln,At,k)=>{"use strict";k.d(At,{v:()=>Ue});var d=k(553),m=k(5906),ce=k(6579),l=k(7689),ie=k(9671),re=k(8306),v=k(4120),ne=k(2340),De=k(4209);class ge{constructor(ke,He){this.events=ke,this.logging=He,this.events=ke,this.mapAPIType=m.b.MAPKIT_JS,this.mapReady=!1,this.markerList=new Map,this.mapkitUtils=new X}initAPI(){mapkit&&mapkit.init({authorizationCallback:function(ke){ke(ne.N.mapKitToken)}})}disposeMap(){}initMap(ke,He,We){this.mapCanvasID=ke;let Qe=!0;if(Qe=!(typeof mapkit>"u"),!Qe)return this.logging.log("Call to initMap before API is ready:"+m.b[this.mapAPIType],l.i.ERROR),this.mapReady=!1,!1;this.initAPI(),null==this.map&&(document.getElementById(ke),this.map=new mapkit.Map(ke),this.map.annotationForCluster=function(me){"poi"===me.clusteringIdentifier&&(me.title="Charging Location",me.subtitle=me.memberAnnotations.reduce((Ze,Pe)=>Ze+Pe.population,0))},this.mapReady=!0,mapkit.addEventListener("configuration-change",me=>{this.events.publish("ocm:mapping:ready")}),this.map.addEventListener("scroll-end",me=>{this.events.publish("ocm:mapping:dragend")}),this.map.addEventListener("zoom-end",me=>{this.events.publish("ocm:mapping:zoom")}))}clearMarkers(){null!=this.markerList&&this.markerList.forEach((ke,He)=>{try{this.map.removeAnnotation(He)}catch{}}),this.markerList=new Map}showPOIListOnMap(ke,He){let me=0,Pe=0==this.markerList.size;if(null!=ke){let tt=[];for(let ye=0;ye<ke.length;ye++)if(null!=ke[ye].AddressInfo&&null!=ke[ye].AddressInfo.Latitude&&null!=ke[ye].AddressInfo.Longitude){let Ae=ke[ye],Be=!0;if(null!=this.markerList&&this.markerList.has(Ae.ID)&&(Be=!1),Be){let st=null;st=ce.c.getIconForPOI(Ae);let Ht="OCM-"+Ae.ID+": "+Ae.AddressInfo.Title+":";null!=Ae.UsageType&&(Ht+=" "+Ae.UsageType.Title),null!=Ae.StatusType&&(Ht+=" "+Ae.StatusType.Title);const Nt=new mapkit.Coordinate(Ae.AddressInfo.Latitude,Ae.AddressInfo.Longitude);let Bt=new mapkit.ImageAnnotation(Nt,{title:Ht,size:{width:34,height:50},url:{1:st},clusteringIdentifier:"poi"});Bt.poi=Ae,Bt.addEventListener("select",Dt=>{const ht=Dt.target.poi;this.events.publish("ocm:poi:selected",{poi:ht,poiId:ht.ID})}),this.markerList.set(Ae.ID,Bt),tt.push(Bt),me++}}tt.length>0&&(this.map.addAnnotations(tt),Pe&&this.map.showItems(tt,{animate:!0,padding:new mapkit.Padding(60,25,60,25)})),this.logging.log(me+" new map markers added out of a total "+this.markerList.size)}}refreshMapLayout(){null!=this.map&&setTimeout(()=>{this.logging.log("MapKit: refreshMapLayout",l.i.VERBOSE)},200)}setMapCenter(ke,He){this.map&&(this.map.setCenterAnimated(new mapkit.Coordinate(ke.coords.latitude,ke.coords.longitude),!1),He&&this.setMapZoom(He))}getMapCenter(){return new re.y(He=>{if(null!=this.map){let We=this.map.center;null!=We&&(He.next(new v.jR(We.latitude,We.longitude)),He.complete())}})}setMapZoom(ke){const He=Math.min(ke,28),We=this.mapkitUtils.deltaFromZoomLevel(this.map,this.map.center,Math.round(He)),Qe=new mapkit.CoordinateSpan(111*We.latitudeDelta,111*We.longitudeDelta),ve=new mapkit.CoordinateRegion(this.map.center,Qe);this.map.setRegionAnimated(ve)}getMapZoom(){return new re.y(He=>{this.logging.log("MapKit: getMapZoom not supported",l.i.VERBOSE),He.next(this.map._impl.zoomLevel),He.complete()})}setMapType(ke){this.logging.log("MapKit: skipped setting Map Type :"+ke)}getMapBounds(){return new re.y(He=>{let We=new Array,Qe=this.map.region.toBoundingRegion();We.push(new v.wC(Qe.southLatitude,Qe.westLongitude)),We.push(new v.wC(Qe.northLatitude,Qe.eastLongitude)),He.next(We),He.complete()})}moveToMapBounds(ke){this.logging.log("MapKit: map bounds not implemented")}renderMap(ke,He,We){return document.getElementById(this.mapCanvasID).style.height=He+"px",this.mapReady&&this.showPOIListOnMap(ke,We),!0}renderPolyline(ke){this.clearPolyline()}clearPolyline(){null!=this.polylinePath&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(ke){return(0,ie.Z)(function*(){let He=new mapkit.Search({getsUserLocation:!0});return new Promise(function(){var We=(0,ie.Z)(function*(Qe,ve){let me=[];He.search(ke,function(){var Ze=(0,ie.Z)(function*(Pe,Ge){Pe&&ve(Pe),me=[],Ge.places.map(tt=>{let ye=new De.n;ye.Title=tt.name,ye.Address=tt.formattedAddress,ye.Type="place",ye.Location=new v.wC(tt.coordinate.latitude,tt.coordinate.longitude),me.push(ye)}),Qe(me)});return function(Pe,Ge){return Ze.apply(this,arguments)}}())});return function(Qe,ve){return We.apply(this,arguments)}}())})()}addPOILayer(ke){this.logging.log("Add POI Layer not implemented in this provider.")}}class X{constructor(){this.mercatorRadius=85445659.44705395,this.mercatorOffset=268435456}longitudeToPixelSpaceX(ke){return Math.round(this.mercatorOffset+this.mercatorRadius*ke*Math.PI/180)}latitudeToPixelSpaceY(ke){return Math.round(this.mercatorOffset-this.mercatorRadius*Math.log((1+Math.sin(ke*Math.PI/180))/(1-Math.sin(ke*Math.PI/180)))/2)}pixelSpaceXToLongitude(ke){return(Math.round(ke)-this.mercatorOffset)/this.mercatorRadius*180/Math.PI}pixelSpaceYToLatitude(ke){return 180*(Math.PI/2-2*Math.atan(Math.exp((Math.round(ke)-this.mercatorOffset)/this.mercatorRadius)))/Math.PI}deltaFromZoomLevel(ke,He,We){let Qe=this.longitudeToPixelSpaceX(He.longitude),ve=this.latitudeToPixelSpaceY(He.latitude),Ze=Math.pow(2,20-We),Pe=ke.visibleMapRect.size,Ge=Pe.width*Ze,tt=Pe.height*Ze,ye=Qe-Ge/2,Ae=ve-tt/2,Be=this.pixelSpaceXToLongitude(ye),_t=this.pixelSpaceXToLongitude(ye+Ge)-Be,Yt=this.pixelSpaceYToLatitude(Ae);return{latitudeDelta:-1*(this.pixelSpaceYToLatitude(Ae+tt)-Yt),longitudeDelta:_t}}}var ue=k(8274),se=k(6260),Ie=k(529);let we=(()=>{class Ne extends d.k{constructor(He,We,Qe){super(He,We,Qe),this.mapAPIType=m.b.MAPTILER,this.mapTileSet="https://maps.tilehosting.com/styles/streets/style.json?key=Gs9z7krALe3CGI60d5cL"}initAPI(){}}return Ne.\u0275fac=function(He){return new(He||Ne)(ue.LFG(se.z),ue.LFG(l.z),ue.LFG(Ie.eN))},Ne.\u0275prov=ue.Yz7({token:Ne,factory:Ne.\u0275fac}),Ne})(),Ue=(()=>{class Ne{constructor(He,We,Qe){this.logging=We,this.http=Qe,this.isFocused=!1,this.events=He,this.mapOptions=new m._,this.mapAPIReady=!1,this.mapsInitialised=!1,this.setMapAPI(this.mapOptions.mapAPI);let ve=this;this.debouncedMapPositionUpdate=ce.c.debounce(()=>{this.logging.log("signaling map position change:"),ve.mapProvider.mapReady&&ve.getMapCenter().subscribe(me=>{null!=me?(this.logging.log("Map centre/zoom changed, updating search position:"+me),this.updateMapCentrePos(me.coords.latitude,me.coords.longitude,!1)):this.logging.log("Map centre/zoom changed - map not ready to change centre pos:")})},300,!1)}setParentAppContext(He){this.parentAppContext=He}setMapAPI(He){this.mapOptions.mapAPI=He,this.mapOptions.mapAPI==m.b.MAPBOX&&(this.mapProvider=new d.k(this.events,this.logging,this.http)),this.mapOptions.mapAPI==m.b.MAPKIT_JS&&(this.mapProvider=new ge(this.events,this.logging)),this.mapOptions.mapAPI==m.b.MAPTILER&&(this.mapProvider=new we(this.events,this.logging,this.http))}isMapReady(){return null!=this.mapProvider&&this.mapProvider.mapReady}externalAPILoaded(He){this.mapAPIReady=!0,this.logging.log("Mapping API Loaded: "+m.b[He])}initMap(He){if(!this.isMapReady())if(null!=this.mapProvider)this.mapsInitialised&&this.logging.log("initMap: Map provider already initialised"),this.logging.log("Mapping Manager: Init "+m.b[this.mapProvider.mapAPIType]),this.mapProvider.initMap(He,this.mapOptions,this);else{if(this.mapsInitialised)return void this.logging.log("initMap: map already initialised");this.logging.log("initMap: "+this.mapOptions.mapAPI)}}mapManipulationPerformed(He){this.logging.log("map manipulated:"+He),("drag"==He||"zoom"==He)&&this.debouncedMapPositionUpdate()}updateMapSize(){this.mapProvider&&this.mapProvider.refreshMapLayout()}updateMapCentrePos(He,We,Qe,ve){Qe&&null!=this.mapProvider&&this.mapProvider.setMapCenter(new v.jR(He,We),ve),this.mapOptions.mapCentre=new v.jR(He,We)}moveToMapBounds(He){this.mapProvider.moveToMapBounds(He)}refreshMapView(He,We,Qe){return null!=this.mapProvider?(this.logging.log("Mapping Manager: renderMap "+m.b[this.mapProvider.mapAPIType]),this.isMapReady()?this.mapProvider.renderMap(We,He,this.parentAppContext):this.logging.log("refreshMapView: map provider not initialised..")):this.logging.log("Unsupported Map API: refreshMapView",l.i.ERROR),!0}setMapType(He){this.mapOptions.mapType!=He&&(this.mapOptions.mapType=He,this.isMapReady()&&null!=this.mapProvider?(this.logging.log("Changing map type:"+He),this.mapProvider.setMapType(He)):this.logging.log("Map type set, maps not initialised yet."))}unfocusMap(){this.logging.log("[mapping] Unfocus Map."),this.isFocused=!1,this.mapProvider.unfocusMap()}focusMap(){this.logging.log("[mapping] Focus Map."),this.isFocused=!0,this.mapProvider.focusMap()}getMapBounds(){return this.mapProvider.getMapBounds()}getMapZoom(){return this.mapProvider.getMapZoom()}setMapZoom(He){this.mapProvider.setMapZoom(He)}getMapCenter(){return this.mapProvider.getMapCenter()}showPOIOnStaticMap(He,We,Qe=!1,ve=!1,me=200,Ze=200){let Pe=document.getElementById(He);if(null!=Pe){let tt=We.AddressInfo.Latitude,ye=We.AddressInfo.Longitude;me>640&&(me=640),Ze>640&&(Ze=640);let Ae=me,Be=Ze,st="https://maps.googleapis.com/maps/api/staticmap?center="+tt+","+ye+"&zoom=14&size="+Ae+"x"+Be+"&maptype=roadmap&markers=color:blue%7Clabel:A%7C"+tt+","+ye+"&sensor=false",_t="";_t+=1==Qe?"<div>"+ce.c.formatMapLink(We,'<div><img width="'+Ae+'" height="'+Be+'" src="'+st+'" /></div>',ve)+"</div>":'<div><img width="'+Ae+'" height="'+Be+'" src="'+st+'" /></div>',Pe.innerHTML=_t}}renderPolyline(He){this.mapProvider.renderPolyline(He)}clearPolyline(){this.mapProvider.clearPolyline()}clearMarkers(){this.logging.log("mapping: clearing markers"),this.mapProvider.clearMarkers()}addPOILayer(He){this.mapProvider.addPOILayer(He)}}return Ne.\u0275fac=function(He){return new(He||Ne)(ue.LFG(se.z),ue.LFG(l.z),ue.LFG(Ie.eN))},Ne.\u0275prov=ue.Yz7({token:Ne,factory:Ne.\u0275fac,providedIn:"root"}),Ne})()},5906:(Ln,At,k)=>{"use strict";k.d(At,{_:()=>ce,b:()=>m});var d=k(2340),m=(()=>{return(l=m||(m={}))[l.GOOGLE_WEB=1]="GOOGLE_WEB",l[l.GOOGLE_NATIVE=2]="GOOGLE_NATIVE",l[l.LEAFLET=3]="LEAFLET",l[l.MAPBOX=4]="MAPBOX",l[l.MAPKIT_JS=5]="MAPKIT_JS",l[l.MAPTILER=6]="MAPTILER",m;var l})();class ce{constructor(){this.enableClustering=!1,this.resultBatchID=-1,this.useMarkerIcons=!0,this.useMarkerAnimation=!0,this.enableTrackingMapCentre=!1,this.enableSearchByWatchingLocation=!1,this.mapCentre=null,this.mapAPI=d.N.defaultMapProvider,this.mapType="ROADMAP",this.searchDistanceKM=1e5,this.mapMoveQueryRefreshMS=300,this.enableSearchRadiusIndicator=!1,this.minZoomLevel=2}}},553:(Ln,At,k)=>{"use strict";k.d(At,{k:()=>we});var d=k(9671),m=k(6579),ce=k(5906),l=k(8306),ie=k(4120),re=k(7689),v=k(9898),De=k(2340),ge=k(4209),X=k(8274),ue=k(6260),se=k(529);let we=(()=>{class Ue{constructor(ke,He,We){this.events=ke,this.logging=He,this.http=We,this._isMapAnimating=!1,this.events=ke,this.mapAPIType=ce.b.MAPBOX,this.mapReady=!1,this.markerList=new Map}initAPI(){v&&(v.accessToken=De.N.mapBoxToken)}disposeMap(){this.map&&(this.logging.log("Disposing map",re.i.INFO),this.map.remove())}getCurrentMapTileSet(ke){return"SATELLITE"==ke?"mapbox://styles/mapbox/satellite-streets-v11?optimize=true":"mapbox://styles/mapbox/streets-v11?optimize=true"}flyAroundPoint(ke){if(this._isMapAnimating){this.map.rotateTo(ke/100%360,{duration:0});const He=this;requestAnimationFrame(function(We){He.flyAroundPoint(We)})}}initMap(ke,He,We){this.mapCanvasID=ke;let Qe=!0;if(Qe=!(typeof v>"u"),!Qe)return this.logging.log("Call to initMap before API is ready:"+ce.b[this.mapAPIType],re.i.ERROR),this.mapReady=!1,!1;if(null==this.map){let Pe=function(tt){return tt*(2-tt)};document.getElementById(ke),this.initAPI(),this.map=new v.Map({container:ke,style:this.getCurrentMapTileSet(He.mapType),zoom:15,attributionControl:!1}),this.map.addControl(new v.AttributionControl({compact:!0,customAttribution:["Open Charge Map Contributors"]})),this.map.addControl(new v.NavigationControl),this.mapReady=!0,this.map.getCanvas().focus();let me=100,Ze=25;this.map.getCanvas().addEventListener("keydown",tt=>{tt.preventDefault(),38===tt.which?this.map.panBy([0,-me],{easing:Pe}):40===tt.which?this.map.panBy([0,me],{easing:Pe}):37===tt.which?this.map.easeTo({bearing:this.map.getBearing()-Ze,easing:Pe}):39===tt.which?this.map.easeTo({bearing:this.map.getBearing()+Ze,easing:Pe}):32===tt.which&&(this._isMapAnimating?this._isMapAnimating=!1:(this._isMapAnimating=!0,this.flyAroundPoint(0)))},!0),this.map.on("load",()=>{this.events.publish("ocm:mapping:ready")});let Ge=m.c.debounce(()=>{this.getMapCenter().subscribe(tt=>{this.searchMarker.setLngLat(new v.LngLat(tt.coords.longitude,tt.coords.latitude))})},500,!1);this.map.on("move",()=>{this.searchMarker&&Ge()}),this.map.on("moveend",()=>{this.events.publish("ocm:mapping:dragend"),He.onMapMoveCompleted&&He.onMapMoveCompleted()}),this.map.on("zoomend",()=>{this.events.publish("ocm:mapping:zoom")})}}clearMarkers(){null!=this.markerList&&this.markerList.forEach((ke,He)=>{ke.remove()}),this.markerList=new Map}showPOIListOnMap(ke,He,We=!0){let ve=this.map,me=new v.LngLatBounds,Ze=0;if(ve.getZoom(),null!=ke){for(let Ae=0;Ae<ke.length;Ae++)if(null!=ke[Ae].AddressInfo&&null!=ke[Ae].AddressInfo.Latitude&&null!=ke[Ae].AddressInfo.Longitude){let Be=ke[Ae],st=!0;if(null!=this.markerList&&this.markerList.has(Be.ID)){st=!1;let _t=this.markerList.get(Be.ID);_t&&_t.poi&&_t.poi.DateLastStatusUpdate!=Be.DateLastStatusUpdate&&(_t.remove(),st=!0)}if(st){let _t=null,Yt=null;We?(_t=document.createElement("img"),_t.src=m.c.getIconForPOI(Be),_t.width=34,_t.height=50):(_t=null,Yt=m.c.getColorForPOI(Be));let Ht=(We?"OCM-":"EXT-")+Be.ID+": "+Be.AddressInfo.Title+":";null!=Be.UsageType&&(Ht+=" "+Be.UsageType.Title),null!=Be.StatusType&&(Ht+=" "+Be.StatusType.Title);let Nt=new v.Marker({element:_t,color:Yt}).setLngLat([Be.AddressInfo.Longitude,Be.AddressInfo.Latitude]).addTo(ve);Nt.poi=Be;let Bt=Nt.getElement();Bt.poi=Be,Bt.addEventListener("click",Dt=>{const ht=Dt.currentTarget.poi;this.events.publish("ocm:poi:selected",{poiId:ht.ID,poi:ht})}),me.extend(Nt.getLngLat()),this.markerList.set(Be.ID,Nt),Ze++}}this.logging.log(Ze+" new map markers added out of a total "+this.markerList.size)}if(null!=ke&&ke.length>0)if(null==He||He.appConfig.enableLiveMapQuerying)null==ve.getCenter()&&ve.setCenter(me.getCenter());else{this.logging.log("Fitting to marker bounds:"+me),ve.setCenter(me.getCenter()),this.logging.log("zoom before fit bounds:"+ve.getZoom()),ve.fitBounds(me);let ye=ve.getZoom();ve.setZoom(ye<6?6:ye)}}refreshMapLayout(){null!=this.map&&setTimeout(()=>{this.logging.log("MapBoxGL: refreshMapLayout",re.i.VERBOSE),this.map.resize()},200)}setMapCenter(ke){this.mapReady&&(this.map.setCenter(new v.LngLat(ke.coords.longitude,ke.coords.latitude)),this.searchMarker||(this.searchMarker=new v.Marker({color:"#99ccff",anchor:"top"}).setLngLat(new v.LngLat(ke.coords.longitude,ke.coords.latitude)).addTo(this.map),this.searchMarker.getElement().addEventListener("click",()=>{let He=this.searchMarker.getLngLat();this.events.publish("ocm:mapping:addpoi",new ie.wC(He.lat,He.lng))})))}getMapCenter(){return new l.y(He=>{if(null!=this.map){let We=this.map.getCenter();null!=We&&(He.next(new ie.jR(We.lat,We.lng)),He.complete())}})}setMapZoom(ke){this.map.setZoom(ke)}getMapZoom(){return new l.y(He=>{let We=this.map.getZoom();He.next(We),He.complete()})}setMapType(ke){this.map.setStyle(this.getCurrentMapTileSet(ke))}getMapBounds(){return new l.y(He=>{let We=new Array,Qe=this.map.getBounds();We.push(new ie.wC(Qe.getSouthWest().lat,Qe.getSouthWest().lng)),We.push(new ie.wC(Qe.getNorthEast().lat,Qe.getNorthEast().lng)),He.next(We),He.complete()})}moveToMapBounds(ke){this.map.fitBounds(new v.LngLatBounds(new v.LngLat(ke.southWest.longitude,ke.southWest.latitude),new v.LngLat(ke.northEast.longitude,ke.northEast.latitude)))}renderMap(ke,He,We){return document.getElementById(this.mapCanvasID).style.height=He+"px",this.mapReady&&this.showPOIListOnMap(ke,We),!0}renderPolyline(ke){this.clearPolyline()}clearPolyline(){null!=this.polylinePath&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(ke,He,We){var Qe=this;return(0,d.Z)(function*(){let ve=`https://api.mapbox.com/geocoding/v5/mapbox.places/${ke||We+","+He}.json?access_token=${De.N.mapBoxToken}`;return new Promise(function(){var me=(0,d.Z)(function*(Ze,Pe){Qe.http.get(ve).toPromise().then(Ge=>{let tt=[];tt=[],Ge.features&&Ge.features.map(ye=>{let Ae=new ge.n;Ae.Title=ye.place_name,Ae.Address=ye.place_name,Ae.Type="place",Ae.Location=new ie.wC(ye.center[1],ye.center[0]),Ae.Attribution=Ge.attribution,tt.push(Ae)}),Ze(tt)})});return function(Ze,Pe){return me.apply(this,arguments)}}())})()}addPOILayer(ke){this.logging.log("Add POI Layer not implemented in this provider."),this.showPOIListOnMap(ke,null,!1)}}return Ue.\u0275fac=function(ke){return new(ke||Ue)(X.LFG(ue.z),X.LFG(re.z),X.LFG(se.eN))},Ue.\u0275prov=X.Yz7({token:Ue,factory:Ue.\u0275fac}),Ue})()},2340:(Ln,At,k)=>{"use strict";k.d(At,{N:()=>d});const d={name:"prod",version:"8.2.0",production:!0,analyticsId:"",googleMapsKey:"",mapBoxToken:"pk.eyJ1Ijoid2VicHJvZnVzaW9uIiwiYSI6ImNrdHZlc2N5dTI5Zjcydm8zYWFwc2JnbTMifQ.M7b5SOzbPcg_8XAHCOeP0w",mapKitToken:"",enableStaticMaps:!1,defaultMapProvider:4,apiBase:"https://api.openchargemap.io",apiKey:"9bb03e5b-0fb2-4916-9b2b-26c6bd27a56a",enabledFeatures:["MAP","ADD_COMMENT","ADD_PHOTO","FAVOURITES","FILTER_OPTIONS_BY_COUNTRY","ADD_POI","EDIT_POI","LAYERS"]}},3592:(Ln,At,k)=>{"use strict";var d=k(6895),m=k(8274);class ce extends d.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class l extends ce{static makeCurrent(){(0,d.HT)(new l)}onAndCancel(xt,Le,Ft){return xt.addEventListener(Le,Ft,!1),()=>{xt.removeEventListener(Le,Ft,!1)}}dispatchEvent(xt,Le){xt.dispatchEvent(Le)}remove(xt){xt.parentNode&&xt.parentNode.removeChild(xt)}createElement(xt,Le){return(Le=Le||this.getDefaultDocument()).createElement(xt)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(xt){return xt.nodeType===Node.ELEMENT_NODE}isShadowRoot(xt){return xt instanceof DocumentFragment}getGlobalEventTarget(xt,Le){return"window"===Le?window:"document"===Le?xt:"body"===Le?xt.body:null}getBaseHref(xt){const Le=function re(){return ie=ie||document.querySelector("base"),ie?ie.getAttribute("href"):null}();return null==Le?null:function ne(pt){v=v||document.createElement("a"),v.setAttribute("href",pt);const xt=v.pathname;return"/"===xt.charAt(0)?xt:`/${xt}`}(Le)}resetBaseElement(){ie=null}getUserAgent(){return window.navigator.userAgent}getCookie(xt){return(0,d.Mx)(document.cookie,xt)}}let v,ie=null;const De=new m.OlP("TRANSITION_ID"),X=[{provide:m.ip1,useFactory:function ge(pt,xt,Le){return()=>{Le.get(m.CZH).donePromise.then(()=>{const Ft=(0,d.q)(),fn=xt.querySelectorAll(`style[ng-transition="${pt}"]`);for(let Si=0;Si<fn.length;Si++)Ft.remove(fn[Si])})}},deps:[De,d.K0,m.zs3],multi:!0}];class ue{static init(){(0,m.VLi)(new ue)}addToWindow(xt){m.dqk.getAngularTestability=(Ft,fn=!0)=>{const Si=xt.findTestabilityInTree(Ft,fn);if(null==Si)throw new Error("Could not find testability for element.");return Si},m.dqk.getAllAngularTestabilities=()=>xt.getAllTestabilities(),m.dqk.getAllAngularRootElements=()=>xt.getAllRootElements(),m.dqk.frameworkStabilizers||(m.dqk.frameworkStabilizers=[]),m.dqk.frameworkStabilizers.push(Ft=>{const fn=m.dqk.getAllAngularTestabilities();let Si=fn.length,Ji=!1;const Zr=function(po){Ji=Ji||po,Si--,0==Si&&Ft(Ji)};fn.forEach(function(po){po.whenStable(Zr)})})}findTestabilityInTree(xt,Le,Ft){return null==Le?null:xt.getTestability(Le)??(Ft?(0,d.q)().isShadowRoot(Le)?this.findTestabilityInTree(xt,Le.host,!0):this.findTestabilityInTree(xt,Le.parentElement,!0):null)}}let se=(()=>{class pt{build(){return new XMLHttpRequest}}return pt.\u0275fac=function(Le){return new(Le||pt)},pt.\u0275prov=m.Yz7({token:pt,factory:pt.\u0275fac}),pt})();const Ie=new m.OlP("EventManagerPlugins");let we=(()=>{class pt{constructor(Le,Ft){this._zone=Ft,this._eventNameToPlugin=new Map,Le.forEach(fn=>fn.manager=this),this._plugins=Le.slice().reverse()}addEventListener(Le,Ft,fn){return this._findPluginFor(Ft).addEventListener(Le,Ft,fn)}addGlobalEventListener(Le,Ft,fn){return this._findPluginFor(Ft).addGlobalEventListener(Le,Ft,fn)}getZone(){return this._zone}_findPluginFor(Le){const Ft=this._eventNameToPlugin.get(Le);if(Ft)return Ft;const fn=this._plugins;for(let Si=0;Si<fn.length;Si++){const Ji=fn[Si];if(Ji.supports(Le))return this._eventNameToPlugin.set(Le,Ji),Ji}throw new Error(`No event manager plugin found for event ${Le}`)}}return pt.\u0275fac=function(Le){return new(Le||pt)(m.LFG(Ie),m.LFG(m.R0b))},pt.\u0275prov=m.Yz7({token:pt,factory:pt.\u0275fac}),pt})();class Ue{constructor(xt){this._doc=xt}addGlobalEventListener(xt,Le,Ft){const fn=(0,d.q)().getGlobalEventTarget(this._doc,xt);if(!fn)throw new Error(`Unsupported event target ${fn} for event ${Le}`);return this.addEventListener(fn,Le,Ft)}}let Ne=(()=>{class pt{constructor(){this._stylesSet=new Set}addStyles(Le){const Ft=new Set;Le.forEach(fn=>{this._stylesSet.has(fn)||(this._stylesSet.add(fn),Ft.add(fn))}),this.onStylesAdded(Ft)}onStylesAdded(Le){}getAllStyles(){return Array.from(this._stylesSet)}}return pt.\u0275fac=function(Le){return new(Le||pt)},pt.\u0275prov=m.Yz7({token:pt,factory:pt.\u0275fac}),pt})(),ke=(()=>{class pt extends Ne{constructor(Le){super(),this._doc=Le,this._hostNodes=new Map,this._hostNodes.set(Le.head,[])}_addStylesToHost(Le,Ft,fn){Le.forEach(Si=>{const Ji=this._doc.createElement("style");Ji.textContent=Si,fn.push(Ft.appendChild(Ji))})}addHost(Le){const Ft=[];this._addStylesToHost(this._stylesSet,Le,Ft),this._hostNodes.set(Le,Ft)}removeHost(Le){const Ft=this._hostNodes.get(Le);Ft&&Ft.forEach(He),this._hostNodes.delete(Le)}onStylesAdded(Le){this._hostNodes.forEach((Ft,fn)=>{this._addStylesToHost(Le,fn,Ft)})}ngOnDestroy(){this._hostNodes.forEach(Le=>Le.forEach(He))}}return pt.\u0275fac=function(Le){return new(Le||pt)(m.LFG(d.K0))},pt.\u0275prov=m.Yz7({token:pt,factory:pt.\u0275fac}),pt})();function He(pt){(0,d.q)().remove(pt)}const We={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Qe=/%COMP%/g;function ye(pt,xt,Le){for(let Ft=0;Ft<xt.length;Ft++){let fn=xt[Ft];Array.isArray(fn)?ye(pt,fn,Le):(fn=fn.replace(Qe,pt),Le.push(fn))}return Le}function Ae(pt){return xt=>{if("__ngUnwrap__"===xt)return pt;!1===pt(xt)&&(xt.preventDefault(),xt.returnValue=!1)}}let st=(()=>{class pt{constructor(Le,Ft,fn){this.eventManager=Le,this.sharedStylesHost=Ft,this.appId=fn,this.rendererByCompId=new Map,this.defaultRenderer=new _t(Le)}createRenderer(Le,Ft){if(!Le||!Ft)return this.defaultRenderer;switch(Ft.encapsulation){case m.ifc.Emulated:{let fn=this.rendererByCompId.get(Ft.id);return fn||(fn=new Ht(this.eventManager,this.sharedStylesHost,Ft,this.appId),this.rendererByCompId.set(Ft.id,fn)),fn.applyToHost(Le),fn}case 1:case m.ifc.ShadowDom:return new Nt(this.eventManager,this.sharedStylesHost,Le,Ft);default:if(!this.rendererByCompId.has(Ft.id)){const fn=ye(Ft.id,Ft.styles,[]);this.sharedStylesHost.addStyles(fn),this.rendererByCompId.set(Ft.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return pt.\u0275fac=function(Le){return new(Le||pt)(m.LFG(we),m.LFG(ke),m.LFG(m.AFp))},pt.\u0275prov=m.Yz7({token:pt,factory:pt.\u0275fac}),pt})();class _t{constructor(xt){this.eventManager=xt,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(xt,Le){return Le?document.createElementNS(We[Le]||Le,xt):document.createElement(xt)}createComment(xt){return document.createComment(xt)}createText(xt){return document.createTextNode(xt)}appendChild(xt,Le){xt.appendChild(Le)}insertBefore(xt,Le,Ft){xt&&xt.insertBefore(Le,Ft)}removeChild(xt,Le){xt&&xt.removeChild(Le)}selectRootElement(xt,Le){let Ft="string"==typeof xt?document.querySelector(xt):xt;if(!Ft)throw new Error(`The selector "${xt}" did not match any elements`);return Le||(Ft.textContent=""),Ft}parentNode(xt){return xt.parentNode}nextSibling(xt){return xt.nextSibling}setAttribute(xt,Le,Ft,fn){if(fn){Le=fn+":"+Le;const Si=We[fn];Si?xt.setAttributeNS(Si,Le,Ft):xt.setAttribute(Le,Ft)}else xt.setAttribute(Le,Ft)}removeAttribute(xt,Le,Ft){if(Ft){const fn=We[Ft];fn?xt.removeAttributeNS(fn,Le):xt.removeAttribute(`${Ft}:${Le}`)}else xt.removeAttribute(Le)}addClass(xt,Le){xt.classList.add(Le)}removeClass(xt,Le){xt.classList.remove(Le)}setStyle(xt,Le,Ft,fn){fn&(m.JOm.DashCase|m.JOm.Important)?xt.style.setProperty(Le,Ft,fn&m.JOm.Important?"important":""):xt.style[Le]=Ft}removeStyle(xt,Le,Ft){Ft&m.JOm.DashCase?xt.style.removeProperty(Le):xt.style[Le]=""}setProperty(xt,Le,Ft){xt[Le]=Ft}setValue(xt,Le){xt.nodeValue=Le}listen(xt,Le,Ft){return"string"==typeof xt?this.eventManager.addGlobalEventListener(xt,Le,Ae(Ft)):this.eventManager.addEventListener(xt,Le,Ae(Ft))}}class Ht extends _t{constructor(xt,Le,Ft,fn){super(xt),this.component=Ft;const Si=ye(fn+"-"+Ft.id,Ft.styles,[]);Le.addStyles(Si),this.contentAttr=function Ge(pt){return"_ngcontent-%COMP%".replace(Qe,pt)}(fn+"-"+Ft.id),this.hostAttr=function tt(pt){return"_nghost-%COMP%".replace(Qe,pt)}(fn+"-"+Ft.id)}applyToHost(xt){super.setAttribute(xt,this.hostAttr,"")}createElement(xt,Le){const Ft=super.createElement(xt,Le);return super.setAttribute(Ft,this.contentAttr,""),Ft}}class Nt extends _t{constructor(xt,Le,Ft,fn){super(xt),this.sharedStylesHost=Le,this.hostEl=Ft,this.shadowRoot=Ft.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const Si=ye(fn.id,fn.styles,[]);for(let Ji=0;Ji<Si.length;Ji++){const Zr=document.createElement("style");Zr.textContent=Si[Ji],this.shadowRoot.appendChild(Zr)}}nodeOrShadowRoot(xt){return xt===this.hostEl?this.shadowRoot:xt}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(xt,Le){return super.appendChild(this.nodeOrShadowRoot(xt),Le)}insertBefore(xt,Le,Ft){return super.insertBefore(this.nodeOrShadowRoot(xt),Le,Ft)}removeChild(xt,Le){return super.removeChild(this.nodeOrShadowRoot(xt),Le)}parentNode(xt){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(xt)))}}let Bt=(()=>{class pt extends Ue{constructor(Le){super(Le)}supports(Le){return!0}addEventListener(Le,Ft,fn){return Le.addEventListener(Ft,fn,!1),()=>this.removeEventListener(Le,Ft,fn)}removeEventListener(Le,Ft,fn){return Le.removeEventListener(Ft,fn)}}return pt.\u0275fac=function(Le){return new(Le||pt)(m.LFG(d.K0))},pt.\u0275prov=m.Yz7({token:pt,factory:pt.\u0275fac}),pt})();const Dt=["alt","control","meta","shift"],Lt={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},_e={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},it={alt:pt=>pt.altKey,control:pt=>pt.ctrlKey,meta:pt=>pt.metaKey,shift:pt=>pt.shiftKey};let Ot=(()=>{class pt extends Ue{constructor(Le){super(Le)}supports(Le){return null!=pt.parseEventName(Le)}addEventListener(Le,Ft,fn){const Si=pt.parseEventName(Ft),Ji=pt.eventCallback(Si.fullKey,fn,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,d.q)().onAndCancel(Le,Si.domEventName,Ji))}static parseEventName(Le){const Ft=Le.toLowerCase().split("."),fn=Ft.shift();if(0===Ft.length||"keydown"!==fn&&"keyup"!==fn)return null;const Si=pt._normalizeKey(Ft.pop());let Ji="";if(Dt.forEach(po=>{const Ao=Ft.indexOf(po);Ao>-1&&(Ft.splice(Ao,1),Ji+=po+".")}),Ji+=Si,0!=Ft.length||0===Si.length)return null;const Zr={};return Zr.domEventName=fn,Zr.fullKey=Ji,Zr}static getEventFullKey(Le){let Ft="",fn=function Qt(pt){let xt=pt.key;if(null==xt){if(xt=pt.keyIdentifier,null==xt)return"Unidentified";xt.startsWith("U+")&&(xt=String.fromCharCode(parseInt(xt.substring(2),16)),3===pt.location&&_e.hasOwnProperty(xt)&&(xt=_e[xt]))}return Lt[xt]||xt}(Le);return fn=fn.toLowerCase()," "===fn?fn="space":"."===fn&&(fn="dot"),Dt.forEach(Si=>{Si!=fn&&it[Si](Le)&&(Ft+=Si+".")}),Ft+=fn,Ft}static eventCallback(Le,Ft,fn){return Si=>{pt.getEventFullKey(Si)===Le&&fn.runGuarded(()=>Ft(Si))}}static _normalizeKey(Le){return"esc"===Le?"escape":Le}}return pt.\u0275fac=function(Le){return new(Le||pt)(m.LFG(d.K0))},pt.\u0275prov=m.Yz7({token:pt,factory:pt.\u0275fac}),pt})();const qt=(0,m.eFA)(m._c5,"browser",[{provide:m.Lbi,useValue:d.bD},{provide:m.g9A,useValue:function _n(){l.makeCurrent(),ue.init()},multi:!0},{provide:d.K0,useFactory:function mn(){return(0,m.RDi)(document),document},deps:[]}]),En=[{provide:m.zSh,useValue:"root"},{provide:m.qLn,useFactory:function Tn(){return new m.qLn},deps:[]},{provide:Ie,useClass:Bt,multi:!0,deps:[d.K0,m.R0b,m.Lbi]},{provide:Ie,useClass:Ot,multi:!0,deps:[d.K0]},{provide:st,useClass:st,deps:[we,ke,m.AFp]},{provide:m.FYo,useExisting:st},{provide:Ne,useExisting:ke},{provide:ke,useClass:ke,deps:[d.K0]},{provide:m.dDg,useClass:m.dDg,deps:[m.R0b]},{provide:we,useClass:we,deps:[Ie,m.R0b]},{provide:d.JF,useClass:se,deps:[]}];let yi=(()=>{class pt{constructor(Le){if(Le)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(Le){return{ngModule:pt,providers:[{provide:m.AFp,useValue:Le.appId},{provide:De,useExisting:m.AFp},X]}}}return pt.\u0275fac=function(Le){return new(Le||pt)(m.LFG(pt,12))},pt.\u0275mod=m.oAB({type:pt}),pt.\u0275inj=m.cJS({providers:En,imports:[d.ez,m.hGG]}),pt})();typeof window<"u"&&window;var gt=k(8936),Tt=k(4463),Ct=k(4006),Et=k(9634);let ln=(()=>{class pt{}return pt.\u0275fac=function(Le){return new(Le||pt)},pt.\u0275mod=m.oAB({type:pt}),pt.\u0275inj=m.cJS({imports:[[d.ez,Ct.u5,Et.Pc,Tt.aw,gt.e]]}),pt})(),yn=(()=>{class pt{}return pt.\u0275fac=function(Le){return new(Le||pt)},pt.\u0275mod=m.oAB({type:pt}),pt.\u0275inj=m.cJS({imports:[[d.ez,Ct.u5,Et.Pc,Tt.aw,gt.e]]}),pt})(),Cn=(()=>{class pt{}return pt.\u0275fac=function(Le){return new(Le||pt)},pt.\u0275mod=m.oAB({type:pt}),pt.\u0275inj=m.cJS({imports:[[d.ez,Ct.u5,Et.Pc,Tt.aw,gt.e]]}),pt})();var oi=k(3548),Rn=k(529),Hn=k(6014),Xn=k(4244);class Ut{constructor(xt,Le="/assets/i18n/",Ft=".json"){this.http=xt,this.prefix=Le,this.suffix=Ft}getTranslation(xt){return this.http.get(`${this.prefix}${xt}${this.suffix}`)}}var vi=k(9671),Xt=k(4781),qn=k(6763),ei=k(9492),gr=k(9741),lr=k(3855);function Dn(pt,xt){if(1&pt){const Le=m.EpF();m.TgZ(0,"div"),m._uU(1," You are not signed in. "),m.TgZ(2,"button",5),m.NdJ("click",function(){return m.CHM(Le),m.oxw().showSignInModal()}),m._uU(3),m.ALo(4,"translate"),m.qZA()()}2&pt&&(m.xp6(3),m.Oqu(m.lcZ(4,1,"ocm.general.signIn")))}function mi(pt,xt){if(1&pt&&(m.TgZ(0,"div")(1,"ion-card")(2,"ion-item")(3,"ion-avatar",6),m._UZ(4,"img",7),m.qZA(),m.TgZ(5,"h2"),m._uU(6),m.qZA()(),m.TgZ(7,"ion-card-content")(8,"p"),m._uU(9),m.qZA(),m.TgZ(10,"p"),m._uU(11),m.qZA()(),m.TgZ(12,"ion-item")(13,"ion-note",8),m._UZ(14,"ion-icon",9),m._uU(15),m.qZA()()()()),2&pt){const Le=m.oxw();m.xp6(4),m.s9C("src",Le.userProfile.ProfileImageURL,m.LSH),m.xp6(2),m.Oqu(Le.userProfile.Username),m.xp6(3),m.hij(" ",Le.userProfile.Profile,""),m.xp6(2),m.hij(" Date Joined: ",Le.userProfile.DateCreated," "),m.xp6(4),m.hij(" ",Le.userProfile.ReputationPoints," Contributor Points ")}}let Wn=(()=>{class pt{constructor(Le,Ft,fn,Si){this.appManager=Le,this.nav=Ft,this.translate=fn,this.modalController=Si}ionViewDidEnter(){this.userProfile=this.appManager.getUserProfile(),null!=this.userProfile&&this.appManager.isUserAuthenticated(!0)?this.refreshProfileView():this.showSignInModal(),this.appManager.analytics.viewEvent("Profile")}refreshProfileView(){this.userProfile=this.appManager.getUserProfile()}showSignInModal(){this.modalController.create({component:ei.F,componentProps:{Profile:this.userProfile}}).then(Le=>{Le.onDidDismiss().then(()=>{this.refreshProfileView()}),Le.present()})}close(){this.modalController.dismiss()}}return pt.\u0275fac=function(Le){return new(Le||pt)(m.Y36(lr.c),m.Y36(Et.SH),m.Y36(Tt.sK),m.Y36(Et.IN))},pt.\u0275cmp=m.Xpm({type:pt,selectors:[["ng-component"]],decls:14,vars:5,consts:[[1,"profile-page","ion-padding"],[4,"ngIf"],["slot","end"],[3,"click"],["name","close","slot","start"],["ion-button","",3,"click"],["slot","start"],[3,"src"],["item-left",""],["name","star"]],template:function(Le,Ft){1&Le&&(m.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),m._uU(3),m.ALo(4,"translate"),m.qZA()()(),m.TgZ(5,"ion-content",0),m.YNc(6,Dn,5,3,"div",1),m.YNc(7,mi,16,5,"div",1),m.qZA(),m.TgZ(8,"ion-footer")(9,"ion-toolbar")(10,"ion-buttons",2)(11,"ion-button",3),m.NdJ("click",function(){return Ft.close()}),m._UZ(12,"ion-icon",4),m._uU(13," Close "),m.qZA()()()()),2&Le&&(m.xp6(3),m.hij(" ",m.lcZ(4,3,"ocm.navigation.profile.sectionTitle")," "),m.xp6(3),m.Q6J("ngIf",null==Ft.userProfile),m.xp6(1),m.Q6J("ngIf",null!=Ft.userProfile))},directives:[Et.Gu,Et.sr,Et.wd,Et.W2,d.O5,Et.PM,Et.Ie,Et.BJ,Et.FN,Et.uN,Et.gu,Et.fr,Et.Sm,Et.YG],pipes:[Tt.X$],encapsulation:2}),pt})();var Dr=k(7689),yr=k(2340),jn=k(4508),$r=k(56),jr=k(6579),Ir=k(388),wr=k(6588),ki=k(7423);const Br=(0,ki.fo)("PushNotifications",{}),Kr=(0,ki.fo)("StatusBar"),Lr=(0,ki.fo)("SplashScreen",{web:()=>k.e(2680).then(k.bind(k,2680)).then(pt=>new pt.SplashScreenWeb)}),Yi=(0,ki.fo)("App",{web:()=>k.e(4477).then(k.bind(k,4477)).then(pt=>new pt.AppWeb)});var Ee=k(6260);function Xe(pt,xt){if(1&pt){const Le=m.EpF();m.TgZ(0,"ion-item",9),m.NdJ("click",function(){return m.CHM(Le),m.oxw().openRoutePlannerModal()}),m._UZ(1,"ion-icon",12),m.TgZ(2,"ion-label"),m._uU(3," Route Planner "),m.qZA()()}}function vt(pt,xt){if(1&pt){const Le=m.EpF();m.TgZ(0,"ion-item",9),m.NdJ("click",function(){return m.CHM(Le),m.oxw().add()}),m._UZ(1,"ion-icon",13),m.TgZ(2,"ion-label"),m._uU(3),m.ALo(4,"translate"),m.qZA()()}2&pt&&(m.xp6(3),m.hij(" ",m.lcZ(4,1,"ocm.general.addLocation")," "))}function Gt(pt,xt){if(1&pt){const Le=m.EpF();m.TgZ(0,"ion-item",9),m.NdJ("click",function(){return m.CHM(Le),m.oxw().journeys()}),m._UZ(1,"ion-icon",12),m.TgZ(2,"ion-label"),m._uU(3," Journeys "),m.qZA()()}}function et(pt,xt){if(1&pt){const Le=m.EpF();m.TgZ(0,"ion-item",9),m.NdJ("click",function(){return m.CHM(Le),m.oxw().addLayer()}),m._UZ(1,"ion-icon",14),m.TgZ(2,"ion-label"),m._uU(3," Add Layer "),m.qZA()()}}function ct(pt,xt){if(1&pt){const Le=m.EpF();m.ynx(0),m.TgZ(1,"ion-item",9),m.NdJ("click",function(){return m.CHM(Le),m.oxw().signIn()}),m._UZ(2,"ion-icon",15),m.TgZ(3,"ion-label"),m._uU(4),m.ALo(5,"translate"),m.qZA()(),m.BQk()}2&pt&&(m.xp6(4),m.hij(" ",m.lcZ(5,1,"ocm.general.signIn")," "))}function kt(pt,xt){if(1&pt){const Le=m.EpF();m.ynx(0),m.TgZ(1,"ion-item",9),m.NdJ("click",function(){return m.CHM(Le),m.oxw().profile()}),m._UZ(2,"ion-icon",15),m.TgZ(3,"ion-label"),m._uU(4),m.ALo(5,"translate"),m.qZA()(),m.TgZ(6,"ion-item",9),m.NdJ("click",function(){return m.CHM(Le),m.oxw().signOut()}),m._UZ(7,"ion-icon",16),m.TgZ(8,"ion-label"),m._uU(9),m.ALo(10,"translate"),m._UZ(11,"br"),m.TgZ(12,"small",17),m._uU(13),m.qZA()()(),m.BQk()}if(2&pt){const Le=m.oxw();m.xp6(4),m.hij(" ",m.lcZ(5,3,"ocm.navigation.profile.sectionTitle")," "),m.xp6(5),m.hij(" ",m.lcZ(10,5,"ocm.general.signOut")," "),m.xp6(4),m.hij(" ",Le.getUserName(),"")}}const en=function(){return["/search"]};let bn=(()=>{class pt{constructor(Le,Ft,fn,Si,Ji,Zr,po,Ao){this.platform=Le,this.translate=Ft,this.mapping=fn,this.modalController=Si,this.appManager=Ji,this.logger=Zr,this.analytics=po,this.events=Ao,this.logger.log("Environment: "+yr.N.name),this.initializeApp(),this.enabledFeatures=yr.N.enabledFeatures,1!=Ji.searchSettings.EnableAdvancedEditorFeatures&&(this.enabledFeatures=this.enabledFeatures.filter(Ko=>"LAYERS"!=Ko))}configurePushNotifications(){Br.register(),Br.addListener("registration",Le=>{this.logger.log("Push registration success, token: "+Le.value),this.appManager.savePushRegistration(Le.value)}),Br.addListener("registrationError",Le=>{this.logger.log("Error on registration: "+JSON.stringify(Le))}),Br.addListener("pushNotificationReceived",Le=>{this.logger.log("Push received: "+JSON.stringify(Le),Dr.i.INFO)}),Br.addListener("pushNotificationActionPerformed",Le=>{this.logger.log("Push action performed: "+JSON.stringify(Le))})}isUserAuthenticated(){return this.appManager.isUserAuthenticated()}getUserName(){let Le=this.appManager.getUserProfile();return Le?Le.EmailAddress?Le.EmailAddress:Le.Username:"Not Signed In"}initializeApp(){var Le=this;this.platform.ready().then(()=>{this.platform.is("capacitor")&&(Kr.show(),Lr.hide()),this.translate.addLangs(this.appManager.getLanguages().map(Ft=>Ft.code)),this.translate.setDefaultLang("en"),null!=this.appManager.searchSettings.Language?this.translate.use(this.appManager.searchSettings.Language):this.translate.currentLang||this.translate.use("en"),this.translate.get("ocm.search.performSearch").toPromise().then(Ft=>{}),this.analytics.init(yr.N.analyticsId).then(()=>{this.analytics.setAppVersion(yr.N.version),this.analytics.appEvent("Startup","App Loaded")}).catch(Ft=>this.logger.log("Error starting analytics")),this.events.subscribe("ocm:mapping:addpoi",function(){var Ft=(0,vi.Z)(function*(fn){jr.c.isFeatureEnabled("ADD_POI")&&Le.add(fn)});return function(fn){return Ft.apply(this,arguments)}}()),(this.platform.is("ios")||this.platform.is("android"))&&(this.configurePushNotifications(),this.checkForAppOpenUrl())})}checkForAppOpenUrl(){return(0,vi.Z)(function*(){Yi.addListener("appUrlOpen",Ft=>{alert("App (re)opened with URL: "+Ft.url)});let Le=yield Yi.getLaunchUrl();Le&&Le.url&&alert("App opened with URL: "+Le.url)})()}openRoutePlannerModal(){var Le=this;return(0,vi.Z)(function*(){Le.mapping.unfocusMap();const Ft=yield Le.modalController.create({component:qn.u});Ft.onDidDismiss().then(fn=>{Le.mapping.focusMap()}),yield Ft.present()})()}continueAdd(Le){var Ft=this;return(0,vi.Z)(function*(){const fn=yield Ft.modalController.create({component:jn.Y,componentProps:{startPos:Le}});fn.onDidDismiss().then(Si=>{Ft.mapping.focusMap()}),yield fn.present()})()}add(Le){var Ft=this;return(0,vi.Z)(function*(){if(Ft.mapping.unfocusMap(),!Ft.appManager.isUserAuthenticated(!0)){const fn=yield Ft.modalController.create({component:ei.F});return fn.onDidDismiss().then(function(){var Si=(0,vi.Z)(function*(Ji){Ft.mapping.focusMap(),Ft.appManager.isUserAuthenticated(!0)&&(yield Ft.continueAdd(Le))});return function(Ji){return Si.apply(this,arguments)}}()),yield fn.present()}yield Ft.continueAdd(Le)})()}signIn(){var Le=this;return(0,vi.Z)(function*(){Le.mapping.unfocusMap();const Ft=yield Le.modalController.create({component:ei.F});return Ft.onDidDismiss().then(fn=>{Le.mapping.focusMap(),Le.appManager.isUserAuthenticated(!0)}),yield Ft.present()})()}signOut(){var Le=this;return(0,vi.Z)(function*(){Le.appManager.signOutCurrentUser()})()}profile(){var Le=this;return(0,vi.Z)(function*(){Le.mapping.unfocusMap();const Ft=yield Le.modalController.create({component:Wn});Ft.onDidDismiss().then(fn=>{Le.mapping.focusMap()}),yield Ft.present()})()}journeys(){var Le=this;return(0,vi.Z)(function*(){Le.mapping.unfocusMap();const Ft=yield Le.modalController.create({component:gr.g});Ft.onDidDismiss().then(fn=>{Le.mapping.focusMap()}),yield Ft.present()})()}addLayer(){var Le=this;return(0,vi.Z)(function*(){const Ft=yield Le.modalController.create({component:wr.A});yield Ft.present();const{data:fn}=yield Ft.onWillDismiss();fn&&Le.mapping.addPOILayer(fn)})()}about(){var Le=this;return(0,vi.Z)(function*(){Le.mapping.unfocusMap();const Ft=yield Le.modalController.create({component:Ir.t});Ft.onDidDismiss().then(fn=>{Le.mapping.focusMap()}),yield Ft.present()})()}}return pt.\u0275fac=function(Le){return new(Le||pt)(m.Y36(Et.t4),m.Y36(Tt.sK),m.Y36(Xt.v),m.Y36(Et.IN),m.Y36(lr.c),m.Y36(Dr.z),m.Y36($r.c),m.Y36(Ee.z))},pt.\u0275cmp=m.Xpm({type:pt,selectors:[["app-root"]],decls:29,vars:17,consts:[["contentId","main-content",3,"disabled"],["contentId","main-content","swipeGesture","false"],["slot","start"],["src","assets/images/icons/branding/AppIcon_128x128.png"],["auto-hide","false"],[3,"routerDirection","routerLink"],["slot","start","name","home"],[3,"click",4,"ngIf"],[4,"ngIf"],[3,"click"],["slot","start","name","information-circle-outline"],["id","main-content"],["slot","start","name","map"],["slot","start","name","add-circle-outline"],["slot","start","name","albums"],["slot","start","name","person"],["slot","start","name","log-out"],[2,"color","#c0c0c0"]],template:function(Le,Ft){1&Le&&(m.TgZ(0,"ion-app")(1,"ion-split-pane",0)(2,"ion-menu",1)(3,"ion-header")(4,"ion-toolbar")(5,"ion-thumbnail",2),m._UZ(6,"img",3),m.qZA(),m.TgZ(7,"ion-title"),m._uU(8),m.qZA()()(),m.TgZ(9,"ion-content")(10,"ion-list")(11,"ion-menu-toggle",4)(12,"ion-item",5),m._UZ(13,"ion-icon",6),m.TgZ(14,"ion-label"),m._uU(15),m.ALo(16,"translate"),m.qZA()(),m.YNc(17,Xe,4,0,"ion-item",7),m.YNc(18,vt,5,3,"ion-item",7),m.YNc(19,Gt,4,0,"ion-item",7),m.YNc(20,et,4,0,"ion-item",7),m.YNc(21,ct,6,3,"ng-container",8),m.YNc(22,kt,14,7,"ng-container",8),m.TgZ(23,"ion-item",9),m.NdJ("click",function(){return Ft.about()}),m._UZ(24,"ion-icon",10),m.TgZ(25,"ion-label"),m._uU(26),m.ALo(27,"translate"),m.qZA()()()()()(),m._UZ(28,"ion-router-outlet",11),m.qZA()()),2&Le&&(m.xp6(1),m.Q6J("disabled",!0),m.xp6(7),m.Oqu(Ft.appManager.title),m.xp6(4),m.Q6J("routerDirection","root")("routerLink",m.DdM(16,en)),m.xp6(3),m.hij(" ",m.lcZ(16,12,"ocm.search.sectionTitle")," "),m.xp6(2),m.Q6J("ngIf",Ft.enabledFeatures.includes("ROUTE_PLANNER")),m.xp6(1),m.Q6J("ngIf",Ft.enabledFeatures.includes("ADD_POI")),m.xp6(1),m.Q6J("ngIf",Ft.enabledFeatures.includes("FAVOURITES")),m.xp6(1),m.Q6J("ngIf",Ft.enabledFeatures.includes("LAYERS")),m.xp6(1),m.Q6J("ngIf",!Ft.isUserAuthenticated()),m.xp6(1),m.Q6J("ngIf",Ft.isUserAuthenticated()),m.xp6(4),m.hij(" ",m.lcZ(27,14,"ocm.general.about")," "))},directives:[Et.dr,Et.jI,Et.z0,Et.Gu,Et.sr,Et.Bs,Et.wd,Et.W2,Et.q_,Et.zc,Et.Ie,Et.YI,Hn.rH,Et.gu,Et.Q$,d.O5,Et.jP],pipes:[Tt.X$],encapsulation:2}),pt})();const nn=[{path:"",redirectTo:"search",pathMatch:"full"},{path:"search",loadChildren:()=>Promise.resolve().then(k.bind(k,3548)).then(pt=>pt.SearchPageModule)},{path:"journeys",loadChildren:()=>Promise.resolve().then(k.bind(k,5476)).then(pt=>pt.JourneysModule)},{path:"signin",loadChildren:()=>Promise.resolve().then(k.bind(k,6779)).then(pt=>pt.SignInModule)},{path:"poi-editor/:id",loadChildren:()=>Promise.resolve().then(k.bind(k,1948)).then(pt=>pt.PoiEditorPageModule)},{path:"about",loadChildren:()=>Promise.resolve().then(k.bind(k,534)).then(pt=>pt.AboutPageModule)},{path:"layer-editor",loadChildren:()=>Promise.resolve().then(k.bind(k,5005)).then(pt=>pt.LayerEditorPageModule)}];let Nn=(()=>{class pt{}return pt.\u0275fac=function(Le){return new(Le||pt)},pt.\u0275mod=m.oAB({type:pt}),pt.\u0275inj=m.cJS({imports:[[Hn.Bz.forRoot(nn,{useHash:!0})],Hn.Bz]}),pt})(),hi=(()=>{class pt{}return pt.\u0275fac=function(Le){return new(Le||pt)},pt.\u0275mod=m.oAB({type:pt}),pt.\u0275inj=m.cJS({imports:[[d.ez,Ct.u5,Et.Pc,Tt.aw,gt.e]]}),pt})();var bi=k(6779);let Bi=(()=>{class pt{}return pt.\u0275fac=function(Le){return new(Le||pt)},pt.\u0275mod=m.oAB({type:pt}),pt.\u0275inj=m.cJS({imports:[[d.ez,Ct.u5,Et.Pc,Tt.aw,gt.e,Hn.Bz.forChild([{path:"",component:Wn}])]]}),pt})();var Ki=k(6314);let zr=(()=>{class pt{}return pt.\u0275fac=function(Le){return new(Le||pt)},pt.\u0275mod=m.oAB({type:pt}),pt.\u0275inj=m.cJS({imports:[[d.ez,Ct.u5,Et.Pc,Tt.aw,gt.e,Hn.Bz.forChild([{path:"",component:Ki.N}])]]}),pt})();var Nr=k(5476),Jo=k(1948),ho=k(534),os=k(5005);function ss(){return localStorage.getItem("access_token")}function Qr(pt){return new Ut(pt,"/assets/i18n/",".json")}let ko=(()=>{class pt{}return pt.\u0275fac=function(Le){return new(Le||pt)},pt.\u0275mod=m.oAB({type:pt,bootstrap:[bn]}),pt.\u0275inj=m.cJS({providers:[{provide:Hn.wN,useClass:Et.r4}],imports:[[yi,Rn.JF,Tt.aw.forRoot({loader:{provide:Tt.Zw,useFactory:Qr,deps:[Rn.eN]}}),Et.Pc.forRoot(),Nn,Xn.Ar.forRoot({config:{tokenGetter:ss}}),oi.SearchPageModule,hi,Nr.JourneysModule,bi.SignInModule,Cn,ln,yn,Jo.PoiEditorPageModule,Bi,zr,ho.AboutPageModule,os.LayerEditorPageModule]]}),pt})();yr.N.production&&(0,m.G48)(),qt().bootstrapModule(ko).catch(pt=>console.log(pt))},9898:function(Ln){Ln.exports=function(){"use strict";var At,k,d;function m(l,ie){if(At)if(k){var re="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+At+")(sharedChunk); ("+k+")(sharedChunk); self.onerror = null;",v={};At(v),d=ie(v),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([re],{type:"text/javascript"})))}else k=ie;else At=ie}return m(0,function(l){var re=v;function v(n,e,i,s){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=s,this.p2x=i,this.p2y=s}v.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},v.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},v.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},v.prototype.solveCurveX=function(n,e){var i,s,u,f,_;for(void 0===e&&(e=1e-6),u=n,_=0;_<8;_++){if(f=this.sampleCurveX(u)-n,Math.abs(f)<e)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=f/x}if((u=n)<(i=0))return i;if(u>(s=1))return s;for(;i<s;){if(f=this.sampleCurveX(u),Math.abs(f-n)<e)return u;n>f?i=u:s=u,u=.5*(s-i)+i}return u},v.prototype.solve=function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))};var ne=De;function De(n,e){this.x=n,this.y=e}De.prototype={clone:function(){return new De(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),i=Math.sin(n),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround:function(n,e){var i=Math.cos(n),s=Math.sin(n),u=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},De.convert=function(n){return n instanceof De?n:Array.isArray(n)?new De(n[0],n[1]):n};var ge=typeof self<"u"?self:{};const X=Math.PI/180,ue=180/Math.PI;function se(n){return n*X}function Ie(n){return n*ue}const we=[[0,0],[1,0],[1,1],[0,1]];function Ue(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function Ne(n,e,i,s){const u=new re(n,e,i,s);return function(f){return u.solve(f)}}const ke=Ne(.25,.1,.25,1);function He(n,e,i){return Math.min(i,Math.max(e,n))}function We(n,e,i){return(i=He((i-n)/(e-n),0,1))*i*(3-2*i)}function Qe(n,e,i){const s=i-e,u=((n-e)%s+s)%s+e;return u===e?i:u}function ve(n,e,i){if(!n.length)return i(null,[]);let s=n.length;const u=new Array(n.length);let f=null;n.forEach((_,x)=>{e(_,(T,M)=>{T&&(f=T),u[x]=M,0==--s&&i(f,u)})})}function me(n){const e=[];for(const i in n)e.push(n[i]);return e}function Ze(n,...e){for(const i of e)for(const s in i)n[s]=i[s];return n}let Pe=1;function Ge(){return Pe++}function tt(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function ye(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Ae(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Be(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function st(n,e){return-1!==n.indexOf(e,n.length-e.length)}function _t(n,e,i){const s={};for(const u in n)s[u]=e.call(i||this,n[u],u,n);return s}function Yt(n,e,i){const s={};for(const u in n)e.call(i||this,n[u],u,n)&&(s[u]=n[u]);return s}function xn(n){return Array.isArray(n)?n.map(xn):"object"==typeof n&&n?_t(n,xn):n}const Ht={};function Nt(n){Ht[n]||(typeof console<"u"&&console.warn(n),Ht[n]=!0)}function Bt(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function Dt(n){let e=0;for(let i,s,u=0,f=n.length,_=f-1;u<f;_=u++)i=n[u],s=n[_],e+=(s.x-i.x)*(i.y+s.y);return e}function ht(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Lt(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,u,f)=>{const _=u||f;return e[s]=!_||_.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let _e,it,Ot,Qt,_n=null;function Tn(n){if(null==_n){const e=n.navigator?n.navigator.userAgent:null;_n=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return _n}function mn(n){try{const e=ge[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const lt={now:()=>void 0!==Ot?Ot:ge.performance.now(),setNow(n){Ot=n},restoreNow(){Ot=void 0},frame(n){const e=ge.requestAnimationFrame(n);return{cancel:()=>ge.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:s}=n;Qt||(Qt=ge.document.createElement("canvas"));const u=Qt.getContext("2d");if(!u)throw new Error("failed to create canvas 2d context");return(i>Qt.width||s>Qt.height)&&(Qt.width=i,Qt.height=s),u.clearRect(-e,-e,i+2*e,s+2*e),u.drawImage(n,0,0,i,s),u.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:n=>(_e||(_e=ge.document.createElement("a")),_e.href=n,_e.href),get devicePixelRatio(){return ge.devicePixelRatio},get prefersReducedMotion(){return!!ge.matchMedia&&(null==it&&(it=ge.matchMedia("(prefers-reduced-motion: reduce)")),it.matches)}};let qt;const En={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==qt){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{qt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch{qt=n}}return qt},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},yi={supported:!1,testSupport:function(n){!mr&&Xi&&(di?Ai(n):Ui=n)}};let Ui,Xi,mr=!1,di=!1;function Ai(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Xi),n.isContextLost())return;yi.supported=!0}catch{}n.deleteTexture(e),mr=!0}ge.document&&(Xi=ge.document.createElement("img"),Xi.onload=function(){Ui&&Ai(Ui),Ui=null,di=!0},Xi.onerror=function(){mr=!0,Ui=null},Xi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Hi="01",ri="NO_ACCESS_TOKEN";function on(n){return 0===n.indexOf("mapbox:")}function It(n){return En.API_URL_REGEX.test(n)}const qe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function dt(n){const e=n.match(qe);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Wt(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}function de(n){if(!n)return null;const e=n.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(ge.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Je{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=de(En.ACCESS_TOKEN);let s="";return s=i&&i.u?ge.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(Number("0x"+f)))):En.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=mn("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const u=ge.localStorage.getItem(i);u&&(this.eventData=JSON.parse(u));const f=ge.localStorage.getItem(s);f&&(this.anonId=f)}catch{Nt("Unable to read from LocalStorage")}}saveEventData(){const e=mn("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{ge.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&ge.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Nt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,s,u){if(!En.EVENTS_URL)return;const f=dt(En.EVENTS_URL);f.params.push(`access_token=${u||En.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.8.2",skuId:Hi,userId:this.anonId},x=i?Ze(_,i):_,T={url:Wt(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=$e(T,M=>{this.pendingRequest=null,s(M),this.saveEventData(),this.processRequests(u)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const $t=new class extends Je{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){En.EVENTS_URL&&En.ACCESS_TOKEN&&Array.isArray(n)&&n.some(i=>on(i)||It(i))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=de(En.ACCESS_TOKEN),i=e?e.u:En.ACCESS_TOKEN;let s=i!==this.eventData.tokenU;Ae(this.anonId)||(this.anonId=tt(),s=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),_=new Date(u),x=(u-this.eventData.lastSuccess)/864e5;s=s||x>=1||x<-1||f.getDate()!==_.getDate()}else s=!0;s?this.postEvent(u,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=i)},n):this.processRequests()}},dn=$t.postTurnstileEvent.bind($t),Qn=new class extends Je{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,i,s){this.skuToken=e,this.errorCb=s,En.EVENTS_URL&&(i||En.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(ri)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Ae(this.anonId)||(this.anonId=tt()),this.postEvent(i,{skuToken:this.skuToken},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n))}},Qi=Qn.postMapLoadEvent.bind(Qn),nr=new class extends Je{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,i,s){if(!En.API_URL||!En.SESSION_PATH)return;const u=dt(En.API_URL+En.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${s||En.ACCESS_TOKEN||""}`);const f={url:Wt(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=gt(f,_=>{this.pendingRequest=null,i(_),this.saveEventData(),this.processRequests(s)})}getSessionAPI(n,e,i,s){this.skuToken=e,this.errorCb=s,En.SESSION_PATH&&En.API_URL&&(i||En.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(ri)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n)}},_r=nr.getSessionAPI.bind(nr),wi=new Set,Di="mapbox-tiles";let xi,Xr,$i=500,Oi=50;function Wr(){ge.caches&&!xi&&(xi=ge.caches.open(Di))}function ar(n){const e=n.indexOf("?");return e<0?n:n.slice(0,e)}let Ci=1/0;const je={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(je);class L extends Error{constructor(e,i,s){401===i&&It(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Q=ht()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ge.location.protocol?ge.parent:ge).location.href,N=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(Q())&&!/^\w+:/.test(i))){if(ge.fetch&&ge.Request&&ge.AbortController&&ge.Request.prototype.hasOwnProperty("signal"))return function(s,u){const f=new ge.AbortController,_=new ge.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Q(),signal:f.signal});let x=!1,T=!1;const M=(R=_.url).indexOf("sku=")>0&&It(R);var R;"json"===s.type&&_.headers.set("Accept","application/json");const B=(te,he,Ce)=>{if(T)return;if(te&&"SecurityError"!==te.message&&Nt(te),he&&Ce)return V(he);const ze=Date.now();ge.fetch(_).then(Ke=>{if(Ke.ok){const yt=M?Ke.clone():null;return V(Ke,yt,ze)}return u(new L(Ke.statusText,Ke.status,s.url))}).catch(Ke=>{20!==Ke.code&&u(new Error(Ke.message))})},V=(te,he,Ce)=>{("arrayBuffer"===s.type?te.arrayBuffer():"json"===s.type?te.json():te.text()).then(ze=>{T||(he&&Ce&&function(Ke,yt,St){if(Wr(),!xi)return;const zt={status:yt.status,statusText:yt.statusText,headers:new ge.Headers};yt.headers.forEach((sn,an)=>zt.headers.set(an,sn));const Vt=Lt(yt.headers.get("Cache-Control")||"");if(Vt["no-store"])return;Vt["max-age"]&&zt.headers.set("Expires",new Date(St+1e3*Vt["max-age"]).toUTCString());const jt=zt.headers.get("Expires");jt&&(new Date(jt).getTime()-St<42e4||function(sn,an){if(void 0===Xr)try{new Response(new ReadableStream),Xr=!0}catch{Xr=!1}Xr?an(sn.body):sn.blob().then(an)}(yt,sn=>{const an=new ge.Response(sn,zt);Wr(),xi&&xi.then(In=>In.put(ar(Ke.url),an)).catch(In=>Nt(In.message))}))}(_,he,Ce),x=!0,u(null,ze,te.headers.get("Cache-Control"),te.headers.get("Expires")))}).catch(ze=>{T||u(new Error(ze.message))})};return M?function(te,he){if(Wr(),!xi)return he(null);const Ce=ar(te.url);xi.then(ze=>{ze.match(Ce).then(Ke=>{const yt=function(St){if(!St)return!1;const zt=new Date(St.headers.get("Expires")||0),Vt=Lt(St.headers.get("Cache-Control")||"");return zt>Date.now()&&!Vt["no-cache"]}(Ke);ze.delete(Ce),yt&&ze.put(Ce,Ke.clone()),he(null,Ke,yt)}).catch(he)}).catch(he)}(_,B):B(null,null),{cancel:()=>{T=!0,x||f.abort()}}}(n,e);if(ht()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(s,u){const f=new ge.XMLHttpRequest;f.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(f.responseType="arraybuffer");for(const _ in s.headers)f.setRequestHeader(_,s.headers[_]);return"json"===s.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===s.credentials,f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let _=f.response;if("json"===s.type)try{_=JSON.parse(f.response)}catch(x){return u(x)}u(null,_,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new L(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}}(n,e)},pe=function(n,e){return N(Ze(n,{type:"arrayBuffer"}),e)},$e=function(n,e){return N(Ze(n,{method:"POST"}),e)},gt=function(n,e){return N(Ze(n,{method:"GET"}),e)};function Tt(n){const e=ge.document.createElement("a");return e.href=n,e.protocol===ge.document.location.protocol&&e.host===ge.document.location.host}const Ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Et,ln;Et=[],ln=0;const yn=function(n,e){if(yi.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),ln>=En.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Et.push(f),f}ln++;let i=!1;const s=()=>{if(!i)for(i=!0,ln--;Et.length&&ln<En.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Et.shift(),{requestParameters:_,callback:x,cancelled:T}=f;T||(f.cancel=yn(_,x).cancel)}},u=pe(n,(f,_,x,T)=>{s(),f?e(f):_&&(ge.createImageBitmap?function(M,R){const B=new ge.Blob([new Uint8Array(M)],{type:"image/png"});ge.createImageBitmap(B).then(V=>{R(null,V)}).catch(V=>{R(new Error(`Could not load image because of ${V.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(M,R)=>e(M,R,x,T)):function(M,R){const B=new ge.Image,V=ge.URL;B.onload=()=>{R(null,B),V.revokeObjectURL(B.src),B.onload=null,ge.requestAnimationFrame(()=>{B.src=Ct})},B.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const te=new ge.Blob([new Uint8Array(M)],{type:"image/png"});B.src=M.byteLength?V.createObjectURL(te):Ct}(_,(M,R)=>e(M,R,x,T)))});return{cancel:()=>{u.cancel(),s()}}};function Cn(n,e,i){i[n]&&-1!==i[n].indexOf(e)||(i[n]=i[n]||[],i[n].push(e))}function oi(n,e,i){if(i&&i[n]){const s=i[n].indexOf(e);-1!==s&&i[n].splice(s,1)}}class Rn{constructor(e,i={}){Ze(this,i),this.type=e}}class Hn extends Rn{constructor(e,i={}){super("error",Ze({error:e},i))}}class Xn{on(e,i){return this._listeners=this._listeners||{},Cn(e,i,this._listeners),this}off(e,i){return oi(e,i,this._listeners),oi(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Cn(e,i,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,i){"string"==typeof e&&(e=new Rn(e,i||{}));const s=e.type;if(this.listens(s)){e.target=this;const u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const x of u)x.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const x of f)oi(s,x,this._oneTimeListeners),x.call(this,e);const _=this._eventedParent;_&&(Ze(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof Hn&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Ut=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function vi(n,...e){for(const i of e)for(const s in i)n[s]=i[s];return n}function Xt(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function qn(n){if(Array.isArray(n))return n.map(qn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=qn(n[i]);return e}return Xt(n)}class ei extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class gr{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,u]of i)this.bindings[s]=u}concat(e){return new gr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const lr={kind:"null"},Dn={kind:"number"},mi={kind:"string"},Wn={kind:"boolean"},Dr={kind:"color"},yr={kind:"object"},jn={kind:"value"},$r={kind:"collator"},jr={kind:"formatted"},Ir={kind:"resolvedImage"};function wr(n,e){return{kind:"array",itemType:n,N:e}}function ki(n){if("array"===n.kind){const e=ki(n.itemType);return"number"==typeof n.N?`array<${e}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${e}>`}return n.kind}const Br=[lr,Dn,mi,Wn,Dr,jr,yr,wr(jn),Ir];function Kr(n,e){if("error"===e.kind)return null;if("array"===n.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Kr(n.itemType,e.itemType))&&("number"!=typeof n.N||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if("value"===n.kind)for(const i of Br)if(!Kr(i,e))return null}return`Expected ${ki(n)} but found ${ki(e)} instead.`}function Lr(n,e){return e.some(i=>i.kind===n.kind)}function Yi(n,e){return e.some(i=>"null"===i?null===n:"array"===i?Array.isArray(n):"object"===i?n&&!Array.isArray(n)&&"object"==typeof n:i===typeof n)}function Ee(n){var e={exports:{}};return n(e,e.exports),e.exports}var Xe=Ee(function(n,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(x){return(x=Math.round(x))<0?0:x>255?255:x}function u(x){return s("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function f(x){return(T="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:T>1?1:T;var T}function _(x,T,M){return M<0?M+=1:M>1&&(M-=1),6*M<1?x+(T-x)*M*6:2*M<1?T:3*M<2?x+(T-x)*(2/3-M)*6:x}try{e.parseCSSColor=function(x){var T,M=x.replace(/ /g,"").toLowerCase();if(M in i)return i[M].slice();if("#"===M[0])return 4===M.length?(T=parseInt(M.substr(1),16))>=0&&T<=4095?[(3840&T)>>4|(3840&T)>>8,240&T|(240&T)>>4,15&T|(15&T)<<4,1]:null:7===M.length&&(T=parseInt(M.substr(1),16))>=0&&T<=16777215?[(16711680&T)>>16,(65280&T)>>8,255&T,1]:null;var R=M.indexOf("("),B=M.indexOf(")");if(-1!==R&&B+1===M.length){var V=M.substr(0,R),te=M.substr(R+1,B-(R+1)).split(","),he=1;switch(V){case"rgba":if(4!==te.length)return null;he=f(te.pop());case"rgb":return 3!==te.length?null:[u(te[0]),u(te[1]),u(te[2]),he];case"hsla":if(4!==te.length)return null;he=f(te.pop());case"hsl":if(3!==te.length)return null;var Ce=(parseFloat(te[0])%360+360)%360/360,ze=f(te[1]),Ke=f(te[2]),yt=Ke<=.5?Ke*(ze+1):Ke+ze-Ke*ze,St=2*Ke-yt;return[s(255*_(St,yt,Ce+1/3)),s(255*_(St,yt,Ce)),s(255*_(St,yt,Ce-1/3)),he];default:return null}}return null}}catch{}});class vt{constructor(e,i,s,u=1){this.r=e,this.g=i,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof vt)return e;if("string"!=typeof e)return;const i=Xe.parseCSSColor(e);return i?new vt(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,s,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(s)},${u})`}toArray(){const{r:e,g:i,b:s,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*i/u,255*s/u,u]}}vt.black=new vt(0,0,0,1),vt.white=new vt(1,1,1,1),vt.transparent=new vt(0,0,0,0),vt.red=new vt(1,0,0,1),vt.blue=new vt(0,0,1,1);class Gt{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class et{constructor(e,i,s,u,f){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=u,this.textColor=f}}class ct{constructor(e){this.sections=e}static fromString(e){return new ct([new et(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof ct?e:ct.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(s)}return e}}class kt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new kt({name:e,available:!1}):null}serialize(){return["image",this.name]}}function en(n,e,i,s){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[n,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[n,e,i,s]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function bn(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof vt||n instanceof Gt||n instanceof ct||n instanceof kt)return!0;if(Array.isArray(n)){for(const e of n)if(!bn(e))return!1;return!0}if("object"==typeof n){for(const e in n)if(!bn(n[e]))return!1;return!0}return!1}function nn(n){if(null===n)return lr;if("string"==typeof n)return mi;if("boolean"==typeof n)return Wn;if("number"==typeof n)return Dn;if(n instanceof vt)return Dr;if(n instanceof Gt)return $r;if(n instanceof ct)return jr;if(n instanceof kt)return Ir;if(Array.isArray(n)){const e=n.length;let i;for(const s of n){const u=nn(s);if(i){if(i===u)continue;i=jn;break}i=u}return wr(i||jn,e)}return yr}function Nn(n){const e=typeof n;return null===n?"":"string"===e||"number"===e||"boolean"===e?String(n):n instanceof vt||n instanceof ct||n instanceof kt?n.toString():JSON.stringify(n)}class hi{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(2!==e.length)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!bn(e[1]))return i.error("invalid value");const s=e[1];let u=nn(s);const f=i.expectedType;return"array"!==u.kind||0!==u.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(u=f),new hi(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof vt?["rgba"].concat(this.value.toArray()):this.value instanceof ct?this.value.serialize():this.value}}class bi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Bi={string:mi,number:Dn,boolean:Wn,object:yr};class Ki{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,u=1;const f=e[0];if("array"===f){let x,T;if(e.length>2){const M=e[1];if("string"!=typeof M||!(M in Bi)||"object"===M)return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=Bi[M],u++}else x=jn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);T=e[2],u++}s=wr(x,T)}else s=Bi[f];const _=[];for(;u<e.length;u++){const x=i.parse(e[u],u,jn);if(!x)return null;_.push(x)}return new Ki(s,_)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!Kr(this.type,nn(s)))return s;if(i===this.args.length-1)throw new bi(`Expected value to be of type ${ki(this.type)}, but found ${ki(nn(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){i.push(s.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(s=>s.serialize()))}}class zr{constructor(e){this.type=jr,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return i.error("First argument must be an image or text section.");const u=[];let f=!1;for(let _=1;_<=e.length-1;++_){const x=e[_];if(f&&"object"==typeof x&&!Array.isArray(x)){f=!1;let T=null;if(x["font-scale"]&&(T=i.parse(x["font-scale"],1,Dn),!T))return null;let M=null;if(x["text-font"]&&(M=i.parse(x["text-font"],1,wr(mi)),!M))return null;let R=null;if(x["text-color"]&&(R=i.parse(x["text-color"],1,Dr),!R))return null;const B=u[u.length-1];B.scale=T,B.font=M,B.textColor=R}else{const T=i.parse(e[_],1,jn);if(!T)return null;const M=T.type.kind;if("string"!==M&&"value"!==M&&"null"!==M&&"resolvedImage"!==M)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:T,scale:null,font:null,textColor:null})}}return new zr(u)}evaluate(e){return new ct(this.sections.map(i=>{const s=i.content.evaluate(e);return nn(s)===Ir?new et("",s,null,null,null):new et(Nn(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class Nr{constructor(e){this.type=Ir,this.input=e}static parse(e,i){if(2!==e.length)return i.error("Expected two arguments.");const s=i.parse(e[1],1,mi);return s?new Nr(s):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),s=kt.fromString(i);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(i)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Jo={"to-boolean":Wn,"to-color":Dr,"to-number":Dn,"to-string":mi};class ho{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return i.error("Expected one argument.");const u=Jo[s],f=[];for(let _=1;_<e.length;_++){const x=i.parse(e[_],_,jn);if(!x)return null;f.push(x)}return new ho(u,f)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let i,s;for(const u of this.args){if(i=u.evaluate(e),s=null,i instanceof vt)return i;if("string"==typeof i){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:en(i[0],i[1],i[2],i[3]),!s))return new vt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new bi(s||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(const s of this.args){if(i=s.evaluate(e),null===i)return 0;const u=Number(i);if(!isNaN(u))return u}throw new bi(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?ct.fromString(Nn(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?kt.fromString(Nn(this.args[0].evaluate(e))):Nn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new zr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Nr(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const os=["Unknown","Point","LineString","Polygon"];class ss{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?os[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(u*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=vt.parse(e)),i}}class Qr{constructor(e,i,s,u){this.name=e,this.type=i,this._evaluate=s,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],u=Qr.definitions[s];if(!u)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=_.filter(([M])=>!Array.isArray(M)||M.length===e.length-1);let T=null;for(const[M,R]of x){T=new vo(i.registry,i.path,null,i.scope);const B=[];let V=!1;for(let te=1;te<e.length;te++){const he=e[te],Ce=Array.isArray(M)?M[te-1]:M.type,ze=T.parse(he,1+B.length,Ce);if(!ze){V=!0;break}B.push(ze)}if(!V)if(Array.isArray(M)&&M.length!==B.length)T.error(`Expected ${M.length} arguments, but found ${B.length} instead.`);else{for(let te=0;te<B.length;te++){const he=Array.isArray(M)?M[te]:M.type,Ce=B[te];T.concat(te+1).checkSubtype(he,Ce.type)}if(0===T.errors.length)return new Qr(s,f,R,B)}}if(1===x.length)i.errors.push(...T.errors);else{const M=(x.length?x:_).map(([B])=>{return V=B,Array.isArray(V)?`(${V.map(ki).join(", ")})`:`(${ki(V.type)}...)`;var V}).join(" | "),R=[];for(let B=1;B<e.length;B++){const V=i.parse(e[B],1+R.length);if(!V)return null;R.push(ki(V.type))}i.error(`Expected arguments of type ${M}, but found (${R.join(", ")}) instead.`)}return null}static register(e,i){Qr.definitions=i;for(const s in i)e[s]=Qr}}class Xo{constructor(e,i,s){this.type=$r,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(2!==e.length)return i.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return i.error("Collator options argument must be an object.");const u=i.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Wn);if(!u)return null;const f=i.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Wn);if(!f)return null;let _=null;return s.locale&&(_=i.parse(s.locale,1,mi),!_)?null:new Xo(u,f,_)}evaluate(e){return new Gt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const ko=8192;function pt(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function xt(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Le(n,e){const i=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*ko),Math.round(s*u*ko)]}function Ft(n,e,i){const s=n[0]-e[0],u=n[1]-e[1],f=n[0]-i[0],_=n[1]-i[1];return s*_-f*u==0&&s*f<=0&&u*_<=0}function fn(n,e){let i=!1;for(let _=0,x=e.length;_<x;_++){const T=e[_];for(let M=0,R=T.length;M<R-1;M++){if(Ft(n,T[M],T[M+1]))return!1;(u=T[M])[1]>(s=n)[1]!=(f=T[M+1])[1]>s[1]&&s[0]<(f[0]-u[0])*(s[1]-u[1])/(f[1]-u[1])+u[0]&&(i=!i)}}var s,u,f;return i}function Si(n,e){for(let i=0;i<e.length;i++)if(fn(n,e[i]))return!0;return!1}function Ji(n,e,i,s){const u=s[0]-i[0],f=s[1]-i[1],_=(n[0]-i[0])*f-u*(n[1]-i[1]),x=(e[0]-i[0])*f-u*(e[1]-i[1]);return _>0&&x<0||_<0&&x>0}function Zr(n,e,i){for(const M of i)for(let R=0;R<M.length-1;++R)if((x=[(_=M[R+1])[0]-(f=M[R])[0],_[1]-f[1]])[0]*(T=[(u=e)[0]-(s=n)[0],u[1]-s[1]])[1]-x[1]*T[0]!=0&&Ji(s,u,f,_)&&Ji(f,_,s,u))return!0;var s,u,f,_,x,T;return!1}function po(n,e){for(let i=0;i<n.length;++i)if(!fn(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Zr(n[i],n[i+1],e))return!1;return!0}function Ao(n,e){for(let i=0;i<e.length;i++)if(po(n,e[i]))return!0;return!1}function Ko(n,e,i){const s=[];for(let u=0;u<n.length;u++){const f=[];for(let _=0;_<n[u].length;_++){const x=Le(n[u][_],i);pt(e,x),f.push(x)}s.push(f)}return s}function as(n,e,i){const s=[];for(let u=0;u<n.length;u++){const f=Ko(n[u],e,i);s.push(f)}return s}function Cs(n,e,i,s){if(n[0]<i[0]||n[0]>i[2]){const u=.5*s;let f=n[0]-i[0]>u?-s:i[0]-n[0]>u?s:0;0===f&&(f=n[0]-i[2]>u?-s:i[2]-n[0]>u?s:0),n[0]+=f}pt(e,n)}function ga(n,e,i,s){const u=Math.pow(2,s.z)*ko,f=[s.x*ko,s.y*ko],_=[];if(!n)return _;for(const x of n)for(const T of x){const M=[T.x+f[0],T.y+f[1]];Cs(M,e,i,u),_.push(M)}return _}function ls(n,e,i,s){const u=Math.pow(2,s.z)*ko,f=[s.x*ko,s.y*ko],_=[];if(!n)return _;for(const T of n){const M=[];for(const R of T){const B=[R.x+f[0],R.y+f[1]];pt(e,B),M.push(B)}_.push(M)}if(e[2]-e[0]<=u/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const T of _)for(const M of T)Cs(M,e,i,u)}var x;return _}class So{constructor(e,i){this.type=Wn,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(bn(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let u=0;u<s.features.length;++u){const f=s.features[u].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new So(s,s.features[u].geometry)}else if("Feature"===s.type){const u=s.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new So(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new So(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(i,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if(!_)return!1;if("Polygon"===s.type){const x=Ko(s.coordinates,f,_),T=ga(i.geometry(),u,f,_);if(!xt(u,f))return!1;for(const M of T)if(!fn(M,x))return!1}if("MultiPolygon"===s.type){const x=as(s.coordinates,f,_),T=ga(i.geometry(),u,f,_);if(!xt(u,f))return!1;for(const M of T)if(!Si(M,x))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(i,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if(!_)return!1;if("Polygon"===s.type){const x=Ko(s.coordinates,f,_),T=ls(i.geometry(),u,f,_);if(!xt(u,f))return!1;for(const M of T)if(!po(M,x))return!1}if("MultiPolygon"===s.type){const x=as(s.coordinates,f,_),T=ls(i.geometry(),u,f,_);if(!xt(u,f))return!1;for(const M of T)if(!Ao(M,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function eo(n){if(n instanceof Qr&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof So)return!1;let e=!0;return n.eachChild(i=>{e&&!eo(i)&&(e=!1)}),e}function Co(n){if(n instanceof Qr&&"feature-state"===n.name)return!1;let e=!0;return n.eachChild(i=>{e&&!Co(i)&&(e=!1)}),e}function Ls(n,e){if(n instanceof Qr&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(s=>{i&&!Ls(s,e)&&(i=!1)}),i}class yo{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(2!==e.length||"string"!=typeof e[1])return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new yo(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class vo{constructor(e,i=[],s,u=new gr,f=[]){this.registry=e,this.path=i,this.key=i.map(_=>`[${_}]`).join(""),this.scope=u,this.errors=f,this.expectedType=s}parse(e,i,s,u,f={}){return i?this.concat(i,s,u)._parse(e,f):this._parse(e,f)}_parse(e,i){function s(u,f,_){return"assert"===_?new Ki(f,[u]):"coerce"===_?new ho(f,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let _=f.parse(e,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,T=_.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==T.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(x,T))return null}else _=s(_,x,i.typeAnnotation||"coerce");else _=s(_,x,i.typeAnnotation||"assert")}if(!(_ instanceof hi)&&"resolvedImage"!==_.type.kind&&Zs(_)){const x=new ss;try{_=new hi(_.type,_.evaluate(x))}catch(T){return this.error(T.message),null}}return _}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s){const u="number"==typeof e?this.path.concat(e):this.path,f=s?this.scope.concat(s):this.scope;return new vo(this.registry,u,i||null,f,this.errors)}error(e,...i){const s=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new ei(s,e))}checkSubtype(e,i){const s=Kr(e,i);return s&&this.error(s),s}}function Zs(n){if(n instanceof yo)return Zs(n.boundExpression);if(n instanceof Qr&&"error"===n.name||n instanceof Xo||n instanceof So)return!1;const e=n instanceof ho||n instanceof Ki;let i=!0;return n.eachChild(s=>{i=e?i&&Zs(s):i&&s instanceof hi}),!!i&&eo(n)&&Ls(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ts(n,e){const i=n.length-1;let s,u,f=0,_=i,x=0;for(;f<=_;)if(x=Math.floor((f+_)/2),s=n[x],u=n[x+1],s<=e){if(x===i||e<u)return x;f=x+1}else{if(!(s>e))throw new bi("Input is not a number.");_=x-1}return 0}class Es{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,f]of s)this.labels.push(u),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,Dn);if(!s)return null;const u=[];let f=null;i.expectedType&&"value"!==i.expectedType.kind&&(f=i.expectedType);for(let _=1;_<e.length;_+=2){const x=1===_?-1/0:e[_],T=e[_+1],M=_,R=_+1;if("number"!=typeof x)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(u.length&&u[u.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const B=i.parse(T,R,f);if(!B)return null;f=f||B.type,u.push([x,B])}return new Es(f,s,u)}evaluate(e){const i=this.labels,s=this.outputs;if(1===i.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return s[0].evaluate(e);const f=i.length;return u>=i[f-1]?s[f-1].evaluate(e):s[Ts(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}function ai(n,e,i){return n*(1-i)+e*i}var to=Object.freeze({__proto__:null,number:ai,color:function(n,e,i){return new vt(ai(n.r,e.r,i),ai(n.g,e.g,i),ai(n.b,e.b,i),ai(n.a,e.a,i))},array:function(n,e,i){return n.map((s,u)=>ai(s,e[u],i))}});const ms=4/29,_a=6/29,Ds=3*_a*_a,Y=Math.PI/180,Me=180/Math.PI;function K(n){return n>.008856451679035631?Math.pow(n,1/3):n/Ds+ms}function Fe(n){return n>_a?n*n*n:Ds*(n-ms)}function wt(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function gn(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function kn(n){const e=gn(n.r),i=gn(n.g),s=gn(n.b),u=K((.4124564*e+.3575761*i+.1804375*s)/.95047),f=K((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-K((.0193339*e+.119192*i+.9503041*s)/1.08883)),alpha:n.a}}function Jn(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,s=isNaN(n.b)?e:e-n.b/200;return e=1*Fe(e),i=.95047*Fe(i),s=1.08883*Fe(s),new vt(wt(3.2404542*i-1.5371385*e-.4985314*s),wt(-.969266*i+1.8760108*e+.041556*s),wt(.0556434*i-.2040259*e+1.0572252*s),n.alpha)}function Mr(n,e,i){const s=e-n;return n+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const cr={forward:kn,reverse:Jn,interpolate:function(n,e,i){return{l:ai(n.l,e.l,i),a:ai(n.a,e.a,i),b:ai(n.b,e.b,i),alpha:ai(n.alpha,e.alpha,i)}}},er={forward:function(n){const{l:e,a:i,b:s}=kn(n),u=Math.atan2(s,i)*Me;return{h:u<0?u+360:u,c:Math.sqrt(i*i+s*s),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Y,i=n.c;return Jn({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:Mr(n.h,e.h,i),c:ai(n.c,e.c,i),l:ai(n.l,e.l,i),alpha:ai(n.alpha,e.alpha,i)}}};var Vi=Object.freeze({__proto__:null,lab:cr,hcl:er});class xr{constructor(e,i,s,u,f){this.type=e,this.operator=i,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[_,x]of f)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(e,i,s,u){let f=0;if("exponential"===e.name)f=fr(i,e.base,s,u);else if("linear"===e.name)f=fr(i,1,s,u);else if("cubic-bezier"===e.name){const _=e.controlPoints;f=new re(_[0],_[1],_[2],_[3]).solve(fr(i,1,s,u))}return f}static parse(e,i){let[s,u,f,..._]=e;if(!Array.isArray(u)||0===u.length)return i.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const M=u[1];if("number"!=typeof M)return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:M}}else{if("cubic-bezier"!==u[0])return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const M=u.slice(1);if(4!==M.length||M.some(R=>"number"!=typeof R||R<0||R>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:M}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Dn),!f)return null;const x=[];let T=null;"interpolate-hcl"===s||"interpolate-lab"===s?T=Dr:i.expectedType&&"value"!==i.expectedType.kind&&(T=i.expectedType);for(let M=0;M<_.length;M+=2){const R=_[M],B=_[M+1],V=M+3,te=M+4;if("number"!=typeof R)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(x.length&&x[x.length-1][0]>=R)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const he=i.parse(B,te,T);if(!he)return null;T=T||he.type,x.push([R,he])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new xr(T,s,u,f,x):i.error(`Type ${ki(T)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(1===i.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return s[0].evaluate(e);const f=i.length;if(u>=i[f-1])return s[f-1].evaluate(e);const _=Ts(i,u),x=xr.interpolationFactor(this.interpolation,u,i[_],i[_+1]),T=s[_].evaluate(e),M=s[_+1].evaluate(e);return"interpolate"===this.operator?to[this.type.kind.toLowerCase()](T,M,x):"interpolate-hcl"===this.operator?er.reverse(er.interpolate(er.forward(T),er.forward(M),x)):cr.reverse(cr.interpolate(cr.forward(T),cr.forward(M),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function fr(n,e,i,s){const u=s-i,f=n-i;return 0===u?0:1===e?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}class br{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const u=i.expectedType;u&&"value"!==u.kind&&(s=u);const f=[];for(const x of e.slice(1)){const T=i.parse(x,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!T)return null;s=s||T.type,f.push(T)}const _=u&&f.some(x=>Kr(u,x.type));return new br(_?jn:s,f)}evaluate(e){let i,s=null,u=0;for(const f of this.args){if(u++,s=f.evaluate(e),s&&s instanceof kt&&!s.available&&(i||(i=s),s=null,u===this.args.length))return i;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class ee{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let f=1;f<e.length-1;f+=2){const _=e[f];if("string"!=typeof _)return i.error(`Expected string, but found ${typeof _} instead.`,f);if(/[^a-zA-Z0-9_]/.test(_))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const x=i.parse(e[f+1],f+1);if(!x)return null;s.push([_,x])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return u?new ee(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class W{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Dn),u=i.parse(e[2],2,wr(i.expectedType||jn));return s&&u?new W(u.type.itemType,s,u):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new bi(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new bi(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new bi(`Array index must be an integer, but found ${i} instead.`);return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class H{constructor(e,i){this.type=Wn,this.needle=e,this.haystack=i}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,jn),u=i.parse(e[2],2,jn);return s&&u?Lr(s.type,[Wn,mi,Dn,lr,jn])?new H(s,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ki(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!Yi(i,["boolean","string","number","null"]))throw new bi(`Expected first argument to be of type boolean, string, number or null, but found ${ki(nn(i))} instead.`);if(!Yi(s,["string","array"]))throw new bi(`Expected second argument to be of type array or string, but found ${ki(nn(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Re{constructor(e,i,s){this.type=Dn,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,jn),u=i.parse(e[2],2,jn);if(!s||!u)return null;if(!Lr(s.type,[Wn,mi,Dn,lr,jn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ki(s.type)} instead`);if(4===e.length){const f=i.parse(e[3],3,Dn);return f?new Re(s,u,f):null}return new Re(s,u)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Yi(i,["boolean","string","number","null"]))throw new bi(`Expected first argument to be of type boolean, string, number or null, but found ${ki(nn(i))} instead.`);if(!Yi(s,["string","array"]))throw new bi(`Expected second argument to be of type array or string, but found ${ki(nn(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return s.indexOf(i,u)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class wn{constructor(e,i,s,u,f,_){this.inputType=e,this.type=i,this.input=s,this.cases=u,this.outputs=f,this.otherwise=_}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,u;i.expectedType&&"value"!==i.expectedType.kind&&(u=i.expectedType);const f={},_=[];for(let M=2;M<e.length-1;M+=2){let R=e[M];const B=e[M+1];Array.isArray(R)||(R=[R]);const V=i.concat(M);if(0===R.length)return V.error("Expected at least one branch label.");for(const he of R){if("number"!=typeof he&&"string"!=typeof he)return V.error("Branch labels must be numbers or strings.");if("number"==typeof he&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof he&&Math.floor(he)!==he)return V.error("Numeric branch labels must be integer values.");if(s){if(V.checkSubtype(s,nn(he)))return null}else s=nn(he);if(void 0!==f[String(he)])return V.error("Branch labels must be unique.");f[String(he)]=_.length}const te=i.parse(B,M,u);if(!te)return null;u=u||te.type,_.push(te)}const x=i.parse(e[1],1,jn);if(!x)return null;const T=i.parse(e[e.length-1],e.length-1,u);return T?"value"!==x.type.kind&&i.concat(1).checkSubtype(s,x.type)?null:new wn(s,u,x,f,_,T):null}evaluate(e){const i=this.input.evaluate(e);return(nn(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],u={};for(const _ of i){const x=u[this.cases[_]];void 0===x?(u[this.cases[_]]=s.length,s.push([this.cases[_],[_]])):s[x][1].push(_)}const f=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,x]of s)e.push(1===x.length?f(x[0]):x.map(f)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class Ii{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&"value"!==i.expectedType.kind&&(s=i.expectedType);const u=[];for(let _=1;_<e.length-1;_+=2){const x=i.parse(e[_],_,Wn);if(!x)return null;const T=i.parse(e[_+1],_+1,s);if(!T)return null;u.push([x,T]),s=s||T.type}const f=i.parse(e[e.length-1],e.length-1,s);return f?new Ii(s,u,f):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Rr{constructor(e,i,s,u){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,jn),u=i.parse(e[2],2,Dn);if(!s||!u)return null;if(!Lr(s.type,[wr(jn),mi,jn]))return i.error(`Expected first argument to be of type array or string, but found ${ki(s.type)} instead`);if(4===e.length){const f=i.parse(e[3],3,Dn);return f?new Rr(s.type,s,u,f):null}return new Rr(s.type,s,u)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Yi(i,["string","array"]))throw new bi(`Expected first argument to be of type array or string, but found ${ki(nn(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(s,u)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Ri(n,e){return"=="===n||"!="===n?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Rs(n,e,i,s){return 0===s.compare(e,i)}function ks(n,e,i){const s="=="!==n&&"!="!==n;return class I0{constructor(f,_,x){this.type=Wn,this.lhs=f,this.rhs=_,this.collator=x,this.hasUntypedArgument="value"===f.type.kind||"value"===_.type.kind}static parse(f,_){if(3!==f.length&&4!==f.length)return _.error("Expected two or three arguments.");const x=f[0];let T=_.parse(f[1],1,jn);if(!T)return null;if(!Ri(x,T.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${ki(T.type)}'.`);let M=_.parse(f[2],2,jn);if(!M)return null;if(!Ri(x,M.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${ki(M.type)}'.`);if(T.type.kind!==M.type.kind&&"value"!==T.type.kind&&"value"!==M.type.kind)return _.error(`Cannot compare types '${ki(T.type)}' and '${ki(M.type)}'.`);s&&("value"===T.type.kind&&"value"!==M.type.kind?T=new Ki(M.type,[T]):"value"!==T.type.kind&&"value"===M.type.kind&&(M=new Ki(T.type,[M])));let R=null;if(4===f.length){if("string"!==T.type.kind&&"string"!==M.type.kind&&"value"!==T.type.kind&&"value"!==M.type.kind)return _.error("Cannot use collator to compare non-string types.");if(R=_.parse(f[3],3,$r),!R)return null}return new I0(T,M,R)}evaluate(f){const _=this.lhs.evaluate(f),x=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const T=nn(_),M=nn(x);if(T.kind!==M.kind||"string"!==T.kind&&"number"!==T.kind)throw new bi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${T.kind}, ${M.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const T=nn(_),M=nn(x);if("string"!==T.kind||"string"!==M.kind)return e(f,_,x)}return this.collator?i(f,_,x,this.collator.evaluate(f)):e(f,_,x)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[n];return this.eachChild(_=>{f.push(_.serialize())}),f}}}const fl=ks("==",function(n,e,i){return e===i},Rs),uc=ks("!=",function(n,e,i){return e!==i},function(n,e,i,s){return!Rs(0,e,i,s)}),ml=ks("<",function(n,e,i){return e<i},function(n,e,i,s){return s.compare(e,i)<0}),Is=ks(">",function(n,e,i){return e>i},function(n,e,i,s){return s.compare(e,i)>0}),dc=ks("<=",function(n,e,i){return e<=i},function(n,e,i,s){return s.compare(e,i)<=0}),hc=ks(">=",function(n,e,i){return e>=i},function(n,e,i,s){return s.compare(e,i)>=0});class Pn{constructor(e,i,s,u,f){this.type=mi,this.number=e,this.locale=i,this.currency=s,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(e,i){if(3!==e.length)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Dn);if(!s)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=i.parse(u.locale,1,mi),!f))return null;let _=null;if(u.currency&&(_=i.parse(u.currency,1,mi),!_))return null;let x=null;if(u["min-fraction-digits"]&&(x=i.parse(u["min-fraction-digits"],1,Dn),!x))return null;let T=null;return u["max-fraction-digits"]&&(T=i.parse(u["max-fraction-digits"],1,Dn),!T)?null:new Pn(s,f,_,x,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ur{constructor(e){this.type=Dn,this.input=e}static parse(e,i){if(2!==e.length)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?i.error(`Expected argument of type string or array, but found ${ki(s.type)} instead.`):new ur(s):null}evaluate(e){const i=this.input.evaluate(e);if("string"==typeof i||Array.isArray(i))return i.length;throw new bi(`Expected value to be of type string or array, but found ${ki(nn(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const gs={"==":fl,"!=":uc,">":Is,"<":ml,">=":hc,"<=":dc,array:Ki,at:W,boolean:Ki,case:Ii,coalesce:br,collator:Xo,format:zr,image:Nr,in:H,"index-of":Re,interpolate:xr,"interpolate-hcl":xr,"interpolate-lab":xr,length:ur,let:ee,literal:hi,match:wn,number:Ki,"number-format":Pn,object:Ki,slice:Rr,step:Es,string:Ki,"to-boolean":ho,"to-color":ho,"to-number":ho,"to-string":ho,var:yo,within:So};function ro(n,[e,i,s,u]){e=e.evaluate(n),i=i.evaluate(n),s=s.evaluate(n);const f=u?u.evaluate(n):1,_=en(e,i,s,f);if(_)throw new bi(_);return new vt(e/255*f,i/255*f,s/255*f,f)}function gl(n,e){return n in e}function _s(n,e){const i=e[n];return void 0===i?null:i}function Oo(n){return{type:n}}function Ha(n){return{result:"success",value:n}}function Hs(n){return{result:"error",value:n}}function qa(n){return"data-driven"===n["property-type"]||"cross-faded-data-driven"===n["property-type"]}function zl(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Nl(n){return!!n.expression&&n.expression.interpolated}function dr(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}function ao(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function E(n){return n}function Z(n,e){const i="color"===e.type,s=n.stops&&"object"==typeof n.stops[0][0],u=s||!(s||void 0!==n.property),f=n.type||(Nl(e)?"exponential":"interval");if(i&&((n=vi({},n)).stops&&(n.stops=n.stops.map(M=>[M[0],vt.parse(M[1])])),n.default=vt.parse(n.default?n.default:e.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!Vi[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let _,x,T;if("exponential"===f)_=Pt;else if("interval"===f)_=fe;else if("categorical"===f){_=j,x=Object.create(null);for(const M of n.stops)x[M[0]]=M[1];T=typeof n.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);_=Sn}if(s){const M={},R=[];for(let te=0;te<n.stops.length;te++){const he=n.stops[te],Ce=he[0].zoom;void 0===M[Ce]&&(M[Ce]={zoom:Ce,type:n.type,property:n.property,default:n.default,stops:[]},R.push(Ce)),M[Ce].stops.push([he[0].value,he[1]])}const B=[];for(const te of R)B.push([M[te].zoom,Z(M[te],e)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:xr.interpolationFactor.bind(void 0,V),zoomStops:B.map(te=>te[0]),evaluate:({zoom:te},he)=>Pt({stops:B,base:n.base},e,te).evaluate(te,he)}}if(u){const M="exponential"===f?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:xr.interpolationFactor.bind(void 0,M),zoomStops:n.stops.map(R=>R[0]),evaluate:({zoom:R})=>_(n,e,R,x,T)}}return{kind:"source",evaluate(M,R){const B=R&&R.properties?R.properties[n.property]:void 0;return void 0===B?D(n.default,e.default):_(n,e,B,x,T)}}}function D(n,e,i){return void 0!==n?n:void 0!==e?e:void 0!==i?i:void 0}function j(n,e,i,s,u){return D(typeof i===u?s[i]:void 0,n.default,e.default)}function fe(n,e,i){if("number"!==dr(i))return D(n.default,e.default);const s=n.stops.length;if(1===s||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[s-1][0])return n.stops[s-1][1];const u=Ts(n.stops.map(f=>f[0]),i);return n.stops[u][1]}function Pt(n,e,i){const s=void 0!==n.base?n.base:1;if("number"!==dr(i))return D(n.default,e.default);const u=n.stops.length;if(1===u||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[u-1][0])return n.stops[u-1][1];const f=Ts(n.stops.map(R=>R[0]),i),_=function(R,B,V,te){const he=te-V,Ce=R-V;return 0===he?0:1===B?Ce/he:(Math.pow(B,Ce)-1)/(Math.pow(B,he)-1)}(i,s,n.stops[f][0],n.stops[f+1][0]),x=n.stops[f][1],T=n.stops[f+1][1];let M=to[e.type]||E;if(n.colorSpace&&"rgb"!==n.colorSpace){const R=Vi[n.colorSpace];M=(B,V)=>R.reverse(R.interpolate(R.forward(B),R.forward(V),_))}return"function"==typeof x.evaluate?{evaluate(...R){const B=x.evaluate.apply(void 0,R),V=T.evaluate.apply(void 0,R);if(void 0!==B&&void 0!==V)return M(B,V,_)}}:M(x,T,_)}function Sn(n,e,i){return"color"===e.type?i=vt.parse(i):"formatted"===e.type?i=ct.fromString(i.toString()):"resolvedImage"===e.type?i=kt.fromString(i.toString()):dr(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),D(i,n.default,e.default)}Qr.register(gs,{error:[{kind:"error"},[mi],(n,[e])=>{throw new bi(e.evaluate(n))}],typeof:[mi,[jn],(n,[e])=>ki(nn(e.evaluate(n)))],"to-rgba":[wr(Dn,4),[Dr],(n,[e])=>e.evaluate(n).toArray()],rgb:[Dr,[Dn,Dn,Dn],ro],rgba:[Dr,[Dn,Dn,Dn,Dn],ro],has:{type:Wn,overloads:[[[mi],(n,[e])=>gl(e.evaluate(n),n.properties())],[[mi,yr],(n,[e,i])=>gl(e.evaluate(n),i.evaluate(n))]]},get:{type:jn,overloads:[[[mi],(n,[e])=>_s(e.evaluate(n),n.properties())],[[mi,yr],(n,[e,i])=>_s(e.evaluate(n),i.evaluate(n))]]},"feature-state":[jn,[mi],(n,[e])=>_s(e.evaluate(n),n.featureState||{})],properties:[yr,[],n=>n.properties()],"geometry-type":[mi,[],n=>n.geometryType()],id:[jn,[],n=>n.id()],zoom:[Dn,[],n=>n.globals.zoom],pitch:[Dn,[],n=>n.globals.pitch||0],"distance-from-center":[Dn,[],n=>n.distanceFromCenter()],"heatmap-density":[Dn,[],n=>n.globals.heatmapDensity||0],"line-progress":[Dn,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[Dn,[],n=>n.globals.skyRadialProgress||0],accumulated:[jn,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[Dn,Oo(Dn),(n,e)=>{let i=0;for(const s of e)i+=s.evaluate(n);return i}],"*":[Dn,Oo(Dn),(n,e)=>{let i=1;for(const s of e)i*=s.evaluate(n);return i}],"-":{type:Dn,overloads:[[[Dn,Dn],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Dn],(n,[e])=>-e.evaluate(n)]]},"/":[Dn,[Dn,Dn],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Dn,[Dn,Dn],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Dn,[],()=>Math.LN2],pi:[Dn,[],()=>Math.PI],e:[Dn,[],()=>Math.E],"^":[Dn,[Dn,Dn],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Dn,[Dn],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Dn,[Dn],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Dn,[Dn],(n,[e])=>Math.log(e.evaluate(n))],log2:[Dn,[Dn],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Dn,[Dn],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Dn,[Dn],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Dn,[Dn],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Dn,[Dn],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Dn,[Dn],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Dn,[Dn],(n,[e])=>Math.atan(e.evaluate(n))],min:[Dn,Oo(Dn),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[Dn,Oo(Dn),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[Dn,[Dn],(n,[e])=>Math.abs(e.evaluate(n))],round:[Dn,[Dn],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Dn,[Dn],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Dn,[Dn],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Wn,[mi,jn],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Wn,[jn],(n,[e])=>n.id()===e.value],"filter-type-==":[Wn,[mi],(n,[e])=>n.geometryType()===e.value],"filter-<":[Wn,[mi,jn],(n,[e,i])=>{const s=n.properties()[e.value],u=i.value;return typeof s==typeof u&&s<u}],"filter-id-<":[Wn,[jn],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[Wn,[mi,jn],(n,[e,i])=>{const s=n.properties()[e.value],u=i.value;return typeof s==typeof u&&s>u}],"filter-id->":[Wn,[jn],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[Wn,[mi,jn],(n,[e,i])=>{const s=n.properties()[e.value],u=i.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[Wn,[jn],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[Wn,[mi,jn],(n,[e,i])=>{const s=n.properties()[e.value],u=i.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[Wn,[jn],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[Wn,[jn],(n,[e])=>e.value in n.properties()],"filter-has-id":[Wn,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[Wn,[wr(mi)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Wn,[wr(jn)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Wn,[mi,wr(jn)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Wn,[mi,wr(jn)],(n,[e,i])=>function(s,u,f,_){for(;f<=_;){const x=f+_>>1;if(u[x]===s)return!0;u[x]>s?_=x-1:f=x+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Wn,overloads:[[[Wn,Wn],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[Oo(Wn),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Wn,overloads:[[[Wn,Wn],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[Oo(Wn),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Wn,[Wn],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Wn,[mi],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[mi,[mi],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[mi,[mi],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[mi,Oo(jn),(n,e)=>e.map(i=>Nn(i.evaluate(n))).join("")],"resolved-locale":[mi,[$r],(n,[e])=>e.evaluate(n).resolvedLocale()]});class Yn{constructor(e,i){var s;this.expression=e,this._warningHistory={},this._evaluator=new ss,this._defaultValue=i?"color"===(s=i).type&&ao(s.default)?new vt(0,0,0,0):"color"===s.type?vt.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(e,i,s,u,f,_,x,T){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,u,f,_,x,T){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=T||null;try{const M=this.expression.evaluate(this._evaluator);if(null==M||"number"==typeof M&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new bi(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function Li(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in gs}function pi(n,e){const i=new vo(gs,[],e?function(u){const f={color:Dr,string:mi,number:Dn,enum:mi,boolean:Wn,formatted:jr,resolvedImage:Ir};return"array"===u.type?wr(f[u.value]||jn,u.length):f[u.type]}(e):void 0),s=i.parse(n,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?Ha(new Yn(s,e)):Hs(i.errors)}class ir{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent="constant"!==e&&!Co(i.expression)}evaluateWithoutErrorHandling(e,i,s,u,f,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,u,f,_)}evaluate(e,i,s,u,f,_){return this._styleExpression.evaluate(e,i,s,u,f,_)}}class Cr{constructor(e,i,s,u){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent="camera"!==e&&!Co(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,s,u,f,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,u,f,_)}evaluate(e,i,s,u,f,_){return this._styleExpression.evaluate(e,i,s,u,f,_)}interpolationFactor(e,i,s){return this.interpolationType?xr.interpolationFactor(this.interpolationType,e,i,s):0}}function Ar(n,e){if("error"===(n=pi(n,e)).result)return n;const i=n.value.expression,s=eo(i);if(!s&&!qa(e))return Hs([new ei("","data expressions not supported")]);const u=Ls(i,["zoom","pitch","distance-from-center"]);if(!u&&!zl(e))return Hs([new ei("","zoom expressions not supported")]);const f=Lo(i);return f||u?f instanceof ei?Hs([f]):f instanceof xr&&!Nl(e)?Hs([new ei("",'"interpolate" expressions cannot be used with this property')]):Ha(f?new Cr(s?"camera":"composite",n.value,f.labels,f instanceof xr?f.interpolation:void 0):new ir(s?"constant":"source",n.value)):Hs([new ei("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class fo{constructor(e,i){this._parameters=e,this._specification=i,vi(this,Z(this._parameters,this._specification))}static deserialize(e){return new fo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Lo(n){let e=null;if(n instanceof ee)e=Lo(n.result);else if(n instanceof br){for(const i of n.args)if(e=Lo(i),e)break}else(n instanceof Es||n instanceof xr)&&n.input instanceof Qr&&"zoom"===n.input.name&&(e=n);return e instanceof ei||n.eachChild(i=>{const s=Lo(i);s instanceof ei?e=s:!e&&s?e=new ei("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new ei("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Zn{constructor(e,i,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),null!=i&&i.__line__&&(this.line=i.__line__)}}function Qo(n){const e=n.key,i=n.value,s=n.valueSpec||{},u=n.objectElementValidators||{},f=n.style,_=n.styleSpec;let x=[];const T=dr(i);if("object"!==T)return[new Zn(e,i,`object expected, ${T} found`)];for(const M in i){const R=M.split(".")[0],B=s[R]||s["*"];let V;u[R]?V=u[R]:s[R]?V=bo:u["*"]?V=u["*"]:s["*"]&&(V=bo),V?x=x.concat(V({key:(e&&`${e}.`)+M,value:i[M],valueSpec:B,style:f,styleSpec:_,object:i,objectKey:M},i)):x.push(new Zn(e,i[M],`unknown property "${M}"`))}for(const M in s)u[M]||s[M].required&&void 0===s[M].default&&void 0===i[M]&&x.push(new Zn(e,i,`missing required property "${M}"`));return x}function oa(n){const e=n.value,i=n.valueSpec,s=n.style,u=n.styleSpec,f=n.key,_=n.arrayElementValidator||bo;if("array"!==dr(e))return[new Zn(f,e,`array expected, ${dr(e)} found`)];if(i.length&&e.length!==i.length)return[new Zn(f,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Zn(f,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let x={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};u.$version<7&&(x.function=i.function),"object"===dr(i.value)&&(x=i.value);let T=[];for(let M=0;M<e.length;M++)T=T.concat(_({array:e,arrayIndex:M,value:e[M],valueSpec:x,style:s,styleSpec:u,key:`${f}[${M}]`}));return T}function pc(n){const e=n.key,i=n.value,s=n.valueSpec;let u=dr(i);if("number"===u&&i!=i&&(u="NaN"),"number"!==u)return[new Zn(e,i,`number expected, ${u} found`)];if("minimum"in s){let f=s.minimum;if("array"===dr(s.minimum)&&(f=s.minimum[n.arrayIndex]),i<f)return[new Zn(e,i,`${i} is less than the minimum value ${f}`)]}if("maximum"in s){let f=s.maximum;if("array"===dr(s.maximum)&&(f=s.maximum[n.arrayIndex]),i>f)return[new Zn(e,i,`${i} is greater than the maximum value ${f}`)]}return[]}function Ea(n){const e=n.valueSpec,i=Xt(n.value.type);let s,u,f,_={};const x="categorical"!==i&&void 0===n.value.property,T=!x,M="array"===dr(n.value.stops)&&"array"===dr(n.value.stops[0])&&"object"===dr(n.value.stops[0][0]),R=Qo({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(te){if("identity"===i)return[new Zn(te.key,te.value,'identity function may not have a "stops" property')];let he=[];const Ce=te.value;return he=he.concat(oa({key:te.key,value:Ce,valueSpec:te.valueSpec,style:te.style,styleSpec:te.styleSpec,arrayElementValidator:B})),"array"===dr(Ce)&&0===Ce.length&&he.push(new Zn(te.key,Ce,"array must have at least one stop")),he},default:function(te){return bo({key:te.key,value:te.value,valueSpec:e,style:te.style,styleSpec:te.styleSpec})}}});return"identity"===i&&x&&R.push(new Zn(n.key,n.value,'missing required property "property"')),"identity"===i||n.value.stops||R.push(new Zn(n.key,n.value,'missing required property "stops"')),"exponential"===i&&n.valueSpec.expression&&!Nl(n.valueSpec)&&R.push(new Zn(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(T&&!qa(n.valueSpec)?R.push(new Zn(n.key,n.value,"property functions not supported")):x&&!zl(n.valueSpec)&&R.push(new Zn(n.key,n.value,"zoom functions not supported"))),"categorical"!==i&&!M||void 0!==n.value.property||R.push(new Zn(n.key,n.value,'"property" property is required')),R;function B(te){let he=[];const Ce=te.value,ze=te.key;if("array"!==dr(Ce))return[new Zn(ze,Ce,`array expected, ${dr(Ce)} found`)];if(2!==Ce.length)return[new Zn(ze,Ce,`array length 2 expected, length ${Ce.length} found`)];if(M){if("object"!==dr(Ce[0]))return[new Zn(ze,Ce,`object expected, ${dr(Ce[0])} found`)];if(void 0===Ce[0].zoom)return[new Zn(ze,Ce,"object stop key must have zoom")];if(void 0===Ce[0].value)return[new Zn(ze,Ce,"object stop key must have value")];const Ke=Xt(Ce[0].zoom);if("number"!=typeof Ke)return[new Zn(ze,Ce[0].zoom,"stop zoom values must be numbers")];if(f&&f>Ke)return[new Zn(ze,Ce[0].zoom,"stop zoom values must appear in ascending order")];Ke!==f&&(f=Ke,u=void 0,_={}),he=he.concat(Qo({key:`${ze}[0]`,value:Ce[0],valueSpec:{zoom:{}},style:te.style,styleSpec:te.styleSpec,objectElementValidators:{zoom:pc,value:V}}))}else he=he.concat(V({key:`${ze}[0]`,value:Ce[0],valueSpec:{},style:te.style,styleSpec:te.styleSpec},Ce));return Li(qn(Ce[1]))?he.concat([new Zn(`${ze}[1]`,Ce[1],"expressions are not allowed in function stops.")]):he.concat(bo({key:`${ze}[1]`,value:Ce[1],valueSpec:e,style:te.style,styleSpec:te.styleSpec}))}function V(te,he){const Ce=dr(te.value),ze=Xt(te.value),Ke=null!==te.value?te.value:he;if(s){if(Ce!==s)return[new Zn(te.key,Ke,`${Ce} stop domain type must match previous stop domain type ${s}`)]}else s=Ce;if("number"!==Ce&&"string"!==Ce&&"boolean"!==Ce&&"number"!=typeof ze&&"string"!=typeof ze&&"boolean"!=typeof ze)return[new Zn(te.key,Ke,"stop domain value must be a number, string, or boolean")];if("number"!==Ce&&"categorical"!==i){let yt=`number expected, ${Ce} found`;return qa(e)&&void 0===i&&(yt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Zn(te.key,Ke,yt)]}return"categorical"!==i||"number"!==Ce||"number"==typeof ze&&isFinite(ze)&&Math.floor(ze)===ze?"categorical"!==i&&"number"===Ce&&"number"==typeof ze&&"number"==typeof u&&void 0!==u&&ze<u?[new Zn(te.key,Ke,"stop domain values must appear in ascending order")]:(u=ze,"categorical"===i&&ze in _?[new Zn(te.key,Ke,"stop domain values must be unique")]:(_[ze]=!0,[])):[new Zn(te.key,Ke,`integer expected, found ${String(ze)}`)]}}function Da(n){const e=("property"===n.expressionContext?Ar:pi)(qn(n.value),n.valueSpec);if("error"===e.result)return e.value.map(s=>new Zn(`${n.key}${s.key}`,n.value,s.message));const i=e.value.expression||e.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!i.outputDefined())return[new Zn(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!Co(i))return[new Zn(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return sa(i,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!Ls(i,["zoom","feature-state"]))return[new Zn(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!eo(i))return[new Zn(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function sa(n,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)i.delete(u);if(0===i.size)return[];const s=[];return n instanceof Qr&&i.has(n.name)?[new Zn(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(u=>{s.push(...sa(u,e))}),s)}function Do(n){const e=n.key,i=n.value,s=n.valueSpec,u=[];return Array.isArray(s.values)?-1===s.values.indexOf(Xt(i))&&u.push(new Zn(e,i,`expected one of [${s.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(s.values).indexOf(Xt(i))&&u.push(new Zn(e,i,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function Fo(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Fo(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function kr(n,e="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Fo(n)||(n=va(n));const i=n;let s=!0;try{s=function(M){if(!ya(M))return M;let R=qn(M);return Zc(R),R=fc(R),R}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const u=Ut[`filter_${e}`],f=pi(s,u);let _=null;if("error"===f.result)throw new Error(f.value.map(M=>`${M.key}: ${M.message}`).join(", "));_=(M,R,B)=>f.value.evaluate(M,R,{},B);let x=null,T=null;if(s!==i){const M=pi(i,u);if("error"===M.result)throw new Error(M.value.map(R=>`${R.key}: ${R.message}`).join(", "));x=(R,B,V,te,he)=>M.value.evaluate(R,B,{},V,void 0,void 0,te,he),T=!eo(M.value.expression)}return _=_,{filter:_,dynamicFilter:x||void 0,needGeometry:Vl(s),needFeature:!!T}}function fc(n){if(!Array.isArray(n))return n;const e=function(i){if(Gc.has(i[0]))for(let s=1;s<i.length;s++)if(ya(i[s]))return!0;return i}(n);return!0===e?e:e.map(i=>fc(i))}function Zc(n){let e=!1;const i=[];if("case"===n[0]){for(let s=1;s<n.length-1;s+=2)e=e||ya(n[s]),i.push(n[s+1]);i.push(n[n.length-1])}else if("match"===n[0]){e=e||ya(n[1]);for(let s=2;s<n.length-1;s+=2)i.push(n[s+1]);i.push(n[n.length-1])}else if("step"===n[0]){e=e||ya(n[1]);for(let s=1;s<n.length-1;s+=2)i.push(n[s+1])}e&&(n.length=0,n.push("any",...i));for(let s=1;s<n.length;s++)Zc(n[s])}function ya(n){if(!Array.isArray(n))return!1;if("pitch"===(e=n[0])||"distance-from-center"===e)return!0;var e;for(let i=1;i<n.length;i++)if(ya(n[i]))return!0;return!1}const Gc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ul(n,e){return n<e?-1:n>e?1:0}function Vl(n){if(!Array.isArray(n))return!1;if("within"===n[0])return!0;for(let e=1;e<n.length;e++)if(Vl(n[e]))return!0;return!1}function va(n){if(!n)return!0;const e=n[0];return n.length<=1?"any"!==e:"=="===e?xo(n[1],n[2],"=="):"!="===e?aa(xo(n[1],n[2],"==")):"<"===e||">"===e||"<="===e||">="===e?xo(n[1],n[2],e):"any"===e?(i=n.slice(1),["any"].concat(i.map(va))):"all"===e?["all"].concat(n.slice(1).map(va)):"none"===e?["all"].concat(n.slice(1).map(va).map(aa)):"in"===e?Wa(n[1],n.slice(2)):"!in"===e?aa(Wa(n[1],n.slice(2))):"has"===e?Ya(n[1]):"!has"===e?aa(Ya(n[1])):"within"!==e||n;var i}function xo(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Wa(n,e){if(0===e.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Ul)]]:["filter-in-small",n,["literal",e]]}}function Ya(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function aa(n){return["!",n]}function qs(n){return Fo(qn(n.value))?Da(vi({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):es(n)}function es(n){const e=n.value,i=n.key;if("array"!==dr(e))return[new Zn(i,e,`array expected, ${dr(e)} found`)];const s=n.styleSpec;let u,f=[];if(e.length<1)return[new Zn(i,e,"filter array must have at least 1 element")];switch(f=f.concat(Do({key:`${i}[0]`,value:e[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),Xt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Xt(e[1])&&f.push(new Zn(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&f.push(new Zn(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=dr(e[1]),"string"!==u&&f.push(new Zn(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let _=2;_<e.length;_++)u=dr(e[_]),"$type"===Xt(e[1])?f=f.concat(Do({key:`${i}[${_}]`,value:e[_],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&f.push(new Zn(`${i}[${_}]`,e[_],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)f=f.concat(es({key:`${i}[${_}]`,value:e[_],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=dr(e[1]),2!==e.length?f.push(new Zn(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&f.push(new Zn(`${i}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=dr(e[1]),2!==e.length?f.push(new Zn(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&f.push(new Zn(`${i}[1]`,e[1],`object expected, ${u} found`))}return f}function Ia(n,e){const i=n.key,s=n.style,u=n.styleSpec,f=n.value,_=n.objectKey,x=u[`${e}_${n.layerType}`];if(!x)return[];const T=_.match(/^(.*)-transition$/);if("paint"===e&&T&&x[T[1]]&&x[T[1]].transition)return bo({key:i,value:f,valueSpec:u.transition,style:s,styleSpec:u});const M=n.valueSpec||x[_];if(!M)return[new Zn(i,f,`unknown property "${_}"`)];let R;if("string"===dr(f)&&qa(M)&&!M.tokens&&(R=/^{([^}]+)}$/.exec(f)))return[new Zn(i,f,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const B=[];return"symbol"===n.layerType&&("text-field"===_&&s&&!s.glyphs&&B.push(new Zn(i,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&ao(qn(f))&&"identity"===Xt(f.type)&&B.push(new Zn(i,f,'"text-font" does not support identity functions'))),B.concat(bo({key:n.key,value:f,valueSpec:M,style:s,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:_}))}function $l(n){return Ia(n,"paint")}function jl(n){return Ia(n,"layout")}function Ja(n){let e=[];const i=n.value,s=n.key,u=n.style,f=n.styleSpec;i.type||i.ref||e.push(new Zn(s,i,'either "type" or "ref" is required'));let _=Xt(i.type);const x=Xt(i.ref);if(i.id){const T=Xt(i.id);for(let M=0;M<n.arrayIndex;M++){const R=u.layers[M];Xt(R.id)===T&&e.push(new Zn(s,i.id,`duplicate layer id "${i.id}", previously used at line ${R.id.__line__}`))}}if("ref"in i){let T;["type","source","source-layer","filter","layout"].forEach(M=>{M in i&&e.push(new Zn(s,i[M],`"${M}" is prohibited for ref layers`))}),u.layers.forEach(M=>{Xt(M.id)===x&&(T=M)}),T?T.ref?e.push(new Zn(s,i.ref,"ref cannot reference another ref layer")):_=Xt(T.type):"string"==typeof x&&e.push(new Zn(s,i.ref,`ref layer "${x}" not found`))}else if("background"!==_&&"sky"!==_)if(i.source){const T=u.sources&&u.sources[i.source],M=T&&Xt(T.type);T?"vector"===M&&"raster"===_?e.push(new Zn(s,i.source,`layer "${i.id}" requires a raster source`)):"raster"===M&&"raster"!==_?e.push(new Zn(s,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==M||i["source-layer"]?"raster-dem"===M&&"hillshade"!==_?e.push(new Zn(s,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!i.paint||!i.paint["line-gradient"]||"geojson"===M&&T.lineMetrics||e.push(new Zn(s,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Zn(s,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Zn(s,i.source,`source "${i.source}" not found`))}else e.push(new Zn(s,i,'missing required property "source"'));return e=e.concat(Qo({key:s,value:i,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>bo({key:`${s}.type`,value:i.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,object:i,objectKey:"type"}),filter:T=>qs(vi({layerType:_},T)),layout:T=>Qo({layer:i,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":M=>jl(vi({layerType:_},M))}}),paint:T=>Qo({layer:i,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":M=>$l(vi({layerType:_},M))}})}})),e}function Ms(n){const e=n.value,i=n.key,s=dr(e);return"string"!==s?[new Zn(i,e,`string expected, ${s} found`)]:[]}const mc={promoteId:function({key:n,value:e}){if("string"===dr(e))return Ms({key:n,value:e});{const i=[];for(const s in e)i.push(...Ms({key:`${n}.${s}`,value:e[s]}));return i}}};function Zl(n){const e=n.value,i=n.key,s=n.styleSpec,u=n.style;if(!e.type)return[new Zn(i,e,'"type" is required')];const f=Xt(e.type);let _;switch(f){case"vector":case"raster":case"raster-dem":return _=Qo({key:i,value:e,valueSpec:s[`source_${f.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:mc}),_;case"geojson":if(_=Qo({key:i,value:e,valueSpec:s.source_geojson,style:u,styleSpec:s,objectElementValidators:mc}),e.cluster)for(const x in e.clusterProperties){const[T,M]=e.clusterProperties[x],R="string"==typeof T?[T,["accumulated"],["get",x]]:T;_.push(...Da({key:`${i}.${x}.map`,value:M,expressionContext:"cluster-map"})),_.push(...Da({key:`${i}.${x}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return _;case"video":return Qo({key:i,value:e,valueSpec:s.source_video,style:u,styleSpec:s});case"image":return Qo({key:i,value:e,valueSpec:s.source_image,style:u,styleSpec:s});case"canvas":return[new Zn(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Do({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:s})}}function Md(n){const e=n.value,i=n.styleSpec,s=i.light,u=n.style;let f=[];const _=dr(e);if(void 0===e)return f;if("object"!==_)return f=f.concat([new Zn("light",e,`object expected, ${_} found`)]),f;for(const x in e){const T=x.match(/^(.*)-transition$/);f=f.concat(T&&s[T[1]]&&s[T[1]].transition?bo({key:x,value:e[x],valueSpec:i.transition,style:u,styleSpec:i}):s[x]?bo({key:x,value:e[x],valueSpec:s[x],style:u,styleSpec:i}):[new Zn(x,e[x],`unknown property "${x}"`)])}return f}function Ma(n){const e=n.value,i=n.key,s=n.style,u=n.styleSpec,f=u.terrain;let _=[];const x=dr(e);if(void 0===e)return _;if("object"!==x)return _=_.concat([new Zn("terrain",e,`object expected, ${x} found`)]),_;for(const T in e){const M=T.match(/^(.*)-transition$/);_=_.concat(M&&f[M[1]]&&f[M[1]].transition?bo({key:T,value:e[T],valueSpec:u.transition,style:s,styleSpec:u}):f[T]?bo({key:T,value:e[T],valueSpec:f[T],style:s,styleSpec:u}):[new Zn(T,e[T],`unknown property "${T}"`)])}if(e.source){const T=s.sources&&s.sources[e.source],M=T&&Xt(T.type);T?"raster-dem"!==M&&_.push(new Zn(i,e.source,`terrain cannot be used with a source of type ${String(M)}, it only be used with a "raster-dem" source type`)):_.push(new Zn(i,e.source,`source "${e.source}" not found`))}else _.push(new Zn(i,e,'terrain is missing required property "source"'));return _}function Xa(n){const e=n.value,i=n.style,s=n.styleSpec,u=s.fog;let f=[];const _=dr(e);if(void 0===e)return f;if("object"!==_)return f=f.concat([new Zn("fog",e,`object expected, ${_} found`)]),f;for(const x in e){const T=x.match(/^(.*)-transition$/);f=f.concat(T&&u[T[1]]&&u[T[1]].transition?bo({key:x,value:e[x],valueSpec:s.transition,style:i,styleSpec:s}):u[x]?bo({key:x,value:e[x],valueSpec:u[x],style:i,styleSpec:s}):[new Zn(x,e[x],`unknown property "${x}"`)])}return f}const Ka={"*":()=>[],array:oa,boolean:function(n){const e=n.value,i=n.key,s=dr(e);return"boolean"!==s?[new Zn(i,e,`boolean expected, ${s} found`)]:[]},number:pc,color:function(n){const e=n.key,i=n.value,s=dr(i);return"string"!==s?[new Zn(e,i,`color expected, ${s} found`)]:null===Xe.parseCSSColor(i)?[new Zn(e,i,`color expected, "${i}" found`)]:[]},enum:Do,filter:qs,function:Ea,layer:Ja,object:Qo,source:Zl,light:Md,terrain:Ma,fog:Xa,string:Ms,formatted:function(n){return 0===Ms(n).length?[]:Da(n)},resolvedImage:function(n){return 0===Ms(n).length?[]:Da(n)},projection:function(n){const e=n.value,i=n.styleSpec,s=i.projection,u=n.style;let f=[];const _=dr(e);if("object"===_)for(const x in e)f=f.concat(bo({key:x,value:e[x],valueSpec:s[x],style:u,styleSpec:i}));else"string"!==_&&(f=f.concat([new Zn("projection",e,`object or string expected, ${_} found`)]));return f}};function bo(n){const e=n.value,i=n.valueSpec,s=n.styleSpec;return i.expression&&ao(Xt(e))?Ea(n):i.expression&&Li(qn(e))?Da(n):i.type&&Ka[i.type]?Ka[i.type](n):Qo(vi({},n,{valueSpec:i.type?s[i.type]:i}))}function $o(n){const e=n.value,i=n.key,s=Ms(n);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new Zn(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new Zn(i,e,'"glyphs" url must include a "{range}" token'))),s}function Qa(n,e=Ut){return Ws(bo({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:$o,"*":()=>[]}}))}const Hc=n=>Ws($l(n)),el=n=>Ws(jl(n));function Ws(n){return n.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Aa(n,e){let i=!1;if(e&&e.length)for(const s of e)n.fire(new Hn(new Error(s.message))),i=!0;return i}var Ys=ys;function ys(n,e,i){var s=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var u=new Int32Array(this.arrayBuffer);n=u[0],this.d=(e=u[1])+2*(i=u[2]);for(var f=0;f<this.d*this.d;f++){var _=u[3+f],x=u[3+f+1];s.push(_===x?null:u.subarray(_,x))}var T=u[3+s.length+1];this.keys=u.subarray(u[3+s.length],T),this.bboxes=u.subarray(T),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var M=0;M<this.d*this.d;M++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=i,this.scale=e/n,this.uid=0;var R=i/e*n;this.min=-R,this.max=n+R}ys.prototype.insert=function(n,e,i,s,u){this._forEachCell(e,i,s,u,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(u)},ys.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ys.prototype._insertCell=function(n,e,i,s,u,f){this.cells[u].push(f)},ys.prototype.query=function(n,e,i,s,u){var f=this.min,_=this.max;if(n<=f&&e<=f&&_<=i&&_<=s&&!u)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(n,e,i,s,this._queryCell,x,{},u),x},ys.prototype._queryCell=function(n,e,i,s,u,f,_,x){var T=this.cells[u];if(null!==T)for(var M=this.keys,R=this.bboxes,B=0;B<T.length;B++){var V=T[B];if(void 0===_[V]){var te=4*V;(x?x(R[te+0],R[te+1],R[te+2],R[te+3]):n<=R[te+2]&&e<=R[te+3]&&i>=R[te+0]&&s>=R[te+1])?(_[V]=!0,f.push(M[V])):_[V]=!1}}},ys.prototype._forEachCell=function(n,e,i,s,u,f,_,x){for(var T=this._convertToCellCoord(n),M=this._convertToCellCoord(e),R=this._convertToCellCoord(i),B=this._convertToCellCoord(s),V=T;V<=R;V++)for(var te=M;te<=B;te++){var he=this.d*te+V;if((!x||x(this._convertFromCellCoord(V),this._convertFromCellCoord(te),this._convertFromCellCoord(V+1),this._convertFromCellCoord(te+1)))&&u.call(this,n,e,i,s,he,f,_,x))return}},ys.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},ys.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},ys.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=3+this.cells.length+1+1,i=0,s=0;s<this.cells.length;s++)i+=this.cells[s].length;var u=new Int32Array(e+i+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,_=0;_<n.length;_++){var x=n[_];u[3+_]=f,u.set(x,f),f+=x.length}return u[3+n.length]=f,u.set(this.keys,f),u[3+n.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};const Sa={};function ti(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),Sa[e]={klass:n,omit:i.omit||[]}}ti(Object,"Object"),Ys.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.push(i),{buffer:i}},Ys.deserialize=function(n){return new Ys(n.buffer)},Object.defineProperty(Ys,"name",{value:"Grid"}),ti(Ys,"Grid"),ti(vt,"Color"),ti(Error,"Error"),ti(L,"AJAXError"),ti(kt,"ResolvedImage"),ti(fo,"StylePropertyFunction"),ti(Yn,"StyleExpression",{omit:["_evaluator"]}),ti(Cr,"ZoomDependentExpression"),ti(ir,"ZoomConstantExpression"),ti(Qr,"CompoundExpression",{omit:["_evaluate"]});for(const n in gs)Sa[gs[n]._classRegistryKey]||ti(gs[n],`Expression${n}`);function gc(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function _l(n){return ge.ImageBitmap&&n instanceof ge.ImageBitmap}function yl(n,e){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(gc(n)||_l(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const i=n;return e&&e.push(i.buffer),i}if(n instanceof ge.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const s of n)i.push(yl(s,e));return i}if("object"==typeof n){const i=n.constructor,s=i._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const u=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const f in n)n.hasOwnProperty(f)&&(Sa[s].omit.indexOf(f)>=0||(u[f]=yl(n[f],e)));n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof n)}function la(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||gc(n)||_l(n)||ArrayBuffer.isView(n)||n instanceof ge.ImageData)return n;if(Array.isArray(n))return n.map(la);if("object"==typeof n){const e=n.$name||"Object",{klass:i}=Sa[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const s=Object.create(i.prototype);for(const u of Object.keys(n))"$name"!==u&&(s[u]=la(n[u]));return s}throw new Error("can't deserialize object of type "+typeof n)}class z{constructor(){this.first=!0}update(e,i){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const O=n=>n>=1536&&n<=1791,P=n=>n>=1872&&n<=1919,G=n=>n>=2208&&n<=2303,oe=n=>n>=11904&&n<=12031,Se=n=>n>=12032&&n<=12255,ft=n=>n>=12272&&n<=12287,Mt=n=>n>=12288&&n<=12351,cn=n=>n>=12352&&n<=12447,ni=n=>n>=12448&&n<=12543,or=n=>n>=12544&&n<=12591,Mi=n=>n>=12704&&n<=12735,Tr=n=>n>=12736&&n<=12783,Ur=n=>n>=12784&&n<=12799,Pa=n=>n>=12800&&n<=13055,Oa=n=>n>=13056&&n<=13311,ca=n=>n>=13312&&n<=19903,vl=n=>n>=19968&&n<=40959,xa=n=>n>=40960&&n<=42127,Gl=n=>n>=42128&&n<=42191,xl=n=>n>=44032&&n<=55215,ba=n=>n>=63744&&n<=64255,tl=n=>n>=64336&&n<=65023,Au=n=>n>=65040&&n<=65055,nl=n=>n>=65072&&n<=65103,bl=n=>n>=65104&&n<=65135,Su=n=>n>=65136&&n<=65279,Pu=n=>n>=65280&&n<=65519;function lo(n){for(const e of n)if(Ou(e.charCodeAt(0)))return!0;return!1}function Ad(n){for(const e of n)if(!Ah(e.charCodeAt(0)))return!1;return!0}function Ah(n){return!(O(n)||P(n)||G(n)||tl(n)||Su(n))}function Ou(n){return!(746!==n&&747!==n&&(n<4352||!(Mi(n)||or(n)||nl(n)&&!(n>=65097&&n<=65103)||ba(n)||Oa(n)||oe(n)||Tr(n)||!(!Mt(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||ca(n)||vl(n)||Pa(n)||(e=n,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(n)||(e=>e>=55216&&e<=55295)(n)||(e=>e>=4352&&e<=4607)(n)||xl(n)||cn(n)||ft(n)||(e=>e>=12688&&e<=12703)(n)||Se(n)||Ur(n)||ni(n)&&12540!==n||!(!Pu(n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!bl(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(e=>e>=5120&&e<=5759)(n)||(e=>e>=6320&&e<=6399)(n)||Au(n)||(e=>e>=19904&&e<=19967)(n)||xa(n)||Gl(n))));var e}function Lu(n){return!(Ou(n)||(e=n,(i=e)>=128&&i<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(i=>i>=8192&&i<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&9251!==e||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Mt(e)||ni(e)||(i=>i>=57344&&i<=63743)(e)||nl(e)||bl(e)||Pu(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,i}function Ru(n){return n>=1424&&n<=2303||tl(n)||Su(n)}function Qp(n,e){return!(!e&&Ru(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(i=n,i>=6016&&i<=6143));var i}function ef(n){for(const e of n)if(Ru(e.charCodeAt(0)))return!0;return!1}const wl="deferred",qc="loading",Io="loaded";let _c=null,jo="unavailable",Js=null;const yc=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(jo="error"),_c&&_c(n)};function Zo(){Xs.fire(new Rn("pluginStateChange",{pluginStatus:jo,pluginURL:Js}))}const Xs=new Xn,vc=function(){return jo},La=function(){if(jo!==wl||!Js)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");jo=qc,Zo(),Js&&pe({url:Js},n=>{n?yc(n):(jo=Io,Zo())})},cs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>jo===Io||null!=cs.applyArabicShaping,isLoading:()=>jo===qc,setState(n){jo=n.pluginStatus,Js=n.pluginURL},isParsed:()=>null!=cs.applyArabicShaping&&null!=cs.processBidirectionalText&&null!=cs.processStyledBidirectionalText,getPluginURL:()=>Js};class Gr{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new z,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,s){for(const u of i)if(!Qp(u.charCodeAt(0),s))return!1;return!0}(e,cs.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*i}}}class xc{constructor(e,i){this.property=e,this.value=i,this.expression=function(s,u){if(ao(s))return new fo(s,u);if(Li(s)){const f=Ar(s,u);if("error"===f.result)throw new Error(f.value.map(_=>`${_.key}: ${_.message}`).join(", "));return f.value}{let f=s;return"string"==typeof s&&"color"===u.type&&(f=vt.parse(s)),{kind:"constant",evaluate:()=>f}}}(void 0===i?e.specification.default:i,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,i,s){return this.property.possiblyEvaluate(this,e,i,s)}}class Hl{constructor(e){this.property=e,this.value=new xc(e,void 0)}transitioned(e,i){return new t(this.property,this.value,i,Ze({},e.transition,this.transition),e.now)}untransitioned(){return new t(this.property,this.value,null,{},0)}}class p{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return xn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Hl(this._values[e].property)),this._values[e].value=new xc(this._values[e].property,null===i?void 0:xn(i))}getTransition(e){return xn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Hl(this._values[e].property)),this._values[e].transition=xn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);void 0!==s&&(e[i]=s);const u=this.getTransition(i);void 0!==u&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const s=new c(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,i._values[u]);return s}untransitioned(){const e=new c(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class t{constructor(e,i,s,u,f){const _=u.delay||0,x=u.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+_,this.end=this.begin+x,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const u=e.now||0,f=this.value.possiblyEvaluate(e,i,s),_=this.prior;if(_){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return _.possiblyEvaluate(e,i,s);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,i,s),f,Ue(x))}}return f}}class c{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const u=new C(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class g{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return xn(this._values[e].value)}setValue(e,i){this._values[e]=new xc(this._values[e].property,null===i?void 0:xn(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);void 0!==s&&(e[i]=s)}return e}possiblyEvaluate(e,i,s){const u=new C(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,s);return u}}class b{constructor(e,i,s){this.property=e,this.value=i,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,i,s,u){return this.property.evaluate(this.value,this.parameters,e,i,s,u)}}class C{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class I{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const u=to[this.specification.type];return u?u(e,i,s):e}}class S{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,u){return new b(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(i,null,{},s,u)}:e.expression,i)}interpolate(e,i,s){if("constant"!==e.value.kind||"constant"!==i.value.kind)return e;if(void 0===e.value.value||void 0===i.value.value)return new b(this,{kind:"constant",value:void 0},e.parameters);const u=to[this.specification.type];return u?new b(this,{kind:"constant",value:u(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,u,f,_){return"constant"===e.kind?e.value:e.evaluate(i,s,u,f,_)}}class U extends S{possiblyEvaluate(e,i,s,u){if(void 0===e.value)return new b(this,{kind:"constant",value:void 0},i);if("constant"===e.expression.kind){const f=e.expression.evaluate(i,null,{},s,u),_="resolvedImage"===e.property.specification.type&&"string"!=typeof f?f.name:f,x=this._calculate(_,_,_,i);return new b(this,{kind:"constant",value:x},i)}if("camera"===e.expression.kind){const f=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new b(this,{kind:"constant",value:f},i)}return new b(this,e.expression,i)}evaluate(e,i,s,u,f,_){if("source"===e.kind){const x=e.evaluate(i,s,u,f,_);return this._calculate(x,x,x,i)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},s,u),e.evaluate({zoom:Math.floor(i.zoom)},s,u),e.evaluate({zoom:Math.floor(i.zoom)+1},s,u),i):e.value}_calculate(e,i,s,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i,other:s}:{from:s,to:i,other:e}}interpolate(e){return e}}class q{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,u){if(void 0!==e.value){if("constant"===e.expression.kind){const f=e.expression.evaluate(i,null,{},s,u);return this._calculate(f,f,f,i)}return this._calculate(e.expression.evaluate(new Gr(Math.floor(i.zoom-1),i)),e.expression.evaluate(new Gr(Math.floor(i.zoom),i)),e.expression.evaluate(new Gr(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,s,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:s,to:i}}interpolate(e){return e}}class J{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,u){return!!e.expression.evaluate(i,null,{},s,u)}interpolate(){return!1}}class ae{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const s=e[i];s.specification.overridable&&this.overridableProperties.push(i);const u=this.defaultPropertyValues[i]=new xc(s,void 0),f=this.defaultTransitionablePropertyValues[i]=new Hl(s);this.defaultTransitioningPropertyValues[i]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=u.possiblyEvaluate({})}}}function Te(n,e){return 256*(n=He(Math.floor(n),0,255))+He(Math.floor(e),0,255)}ti(S,"DataDrivenProperty"),ti(I,"DataConstantProperty"),ti(U,"CrossFadedDataDrivenProperty"),ti(q,"CrossFadedProperty"),ti(J,"ColorRampProperty");const Ve={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Oe{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xe{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function at(n,e=1){let i=0,s=0;return{members:n.map(u=>{const f=Ve[u.type].BYTES_PER_ELEMENT,_=i=Ye(i,Math.max(e,f)),x=u.components||1;return s=Math.max(s,f),i+=f*x,{name:u.name,type:u.type,components:x,offset:_}}),size:Ye(i,Math.max(s,e)),alignment:e}}function Ye(n,e){return Math.ceil(n/e)*e}class rt extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=s,e}}rt.prototype.bytesPerElement=4,ti(rt,"StructArrayLayout2i4");class ot extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=s,this.int16[f+2]=u,e}}ot.prototype.bytesPerElement=6,ti(ot,"StructArrayLayout3i6");class mt extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,u)}emplace(e,i,s,u,f){const _=4*e;return this.int16[_+0]=i,this.int16[_+1]=s,this.int16[_+2]=u,this.int16[_+3]=f,e}}mt.prototype.bytesPerElement=8,ti(mt,"StructArrayLayout4i8");class nt extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,s,u,f,_,x)}emplace(e,i,s,u,f,_,x,T){const M=6*e,R=12*e,B=3*e;return this.int16[M+0]=i,this.int16[M+1]=s,this.uint8[R+4]=u,this.uint8[R+5]=f,this.uint8[R+6]=_,this.uint8[R+7]=x,this.float32[B+2]=T,e}}nt.prototype.bytesPerElement=12,ti(nt,"StructArrayLayout2i4ub1f12");class bt extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,u)}emplace(e,i,s,u,f){const _=4*e;return this.float32[_+0]=i,this.float32[_+1]=s,this.float32[_+2]=u,this.float32[_+3]=f,e}}bt.prototype.bytesPerElement=16,ti(bt,"StructArrayLayout4f16");class Jt extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,_,x,T,M,R){const B=this.length;return this.resize(B+1),this.emplace(B,e,i,s,u,f,_,x,T,M,R)}emplace(e,i,s,u,f,_,x,T,M,R,B){const V=10*e;return this.uint16[V+0]=i,this.uint16[V+1]=s,this.uint16[V+2]=u,this.uint16[V+3]=f,this.uint16[V+4]=_,this.uint16[V+5]=x,this.uint16[V+6]=T,this.uint16[V+7]=M,this.uint16[V+8]=R,this.uint16[V+9]=B,e}}Jt.prototype.bytesPerElement=20,ti(Jt,"StructArrayLayout10ui20");class rn extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,_,x,T){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,s,u,f,_,x,T)}emplace(e,i,s,u,f,_,x,T,M){const R=8*e;return this.uint16[R+0]=i,this.uint16[R+1]=s,this.uint16[R+2]=u,this.uint16[R+3]=f,this.uint16[R+4]=_,this.uint16[R+5]=x,this.uint16[R+6]=T,this.uint16[R+7]=M,e}}rn.prototype.bytesPerElement=16,ti(rn,"StructArrayLayout8ui16");class hn extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,u,f,_)}emplace(e,i,s,u,f,_,x){const T=6*e;return this.int16[T+0]=i,this.int16[T+1]=s,this.int16[T+2]=u,this.int16[T+3]=f,this.int16[T+4]=_,this.int16[T+5]=x,e}}hn.prototype.bytesPerElement=12,ti(hn,"StructArrayLayout6i12");class un extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,_,x,T,M,R,B,V,te,he,Ce,ze){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,e,i,s,u,f,_,x,T,M,R,B,V,te,he,Ce,ze)}emplace(e,i,s,u,f,_,x,T,M,R,B,V,te,he,Ce,ze,Ke){const yt=16*e;return this.int16[yt+0]=i,this.int16[yt+1]=s,this.int16[yt+2]=u,this.int16[yt+3]=f,this.uint16[yt+4]=_,this.uint16[yt+5]=x,this.uint16[yt+6]=T,this.uint16[yt+7]=M,this.int16[yt+8]=R,this.int16[yt+9]=B,this.int16[yt+10]=V,this.int16[yt+11]=te,this.int16[yt+12]=he,this.int16[yt+13]=Ce,this.int16[yt+14]=ze,this.int16[yt+15]=Ke,e}}un.prototype.bytesPerElement=32,ti(un,"StructArrayLayout4i4ui4i4i32");class Un extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=s,this.float32[f+2]=u,e}}Un.prototype.bytesPerElement=12,ti(Un,"StructArrayLayout3f12");class Zt extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Zt.prototype.bytesPerElement=4,ti(Zt,"StructArrayLayout1ul4");class Vn extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,_,x,T,M,R,B,V,te){const he=this.length;return this.resize(he+1),this.emplace(he,e,i,s,u,f,_,x,T,M,R,B,V,te)}emplace(e,i,s,u,f,_,x,T,M,R,B,V,te,he){const Ce=20*e,ze=10*e;return this.int16[Ce+0]=i,this.int16[Ce+1]=s,this.int16[Ce+2]=u,this.int16[Ce+3]=f,this.int16[Ce+4]=_,this.float32[ze+3]=x,this.float32[ze+4]=T,this.float32[ze+5]=M,this.float32[ze+6]=R,this.int16[Ce+14]=B,this.uint32[ze+8]=V,this.uint16[Ce+18]=te,this.uint16[Ce+19]=he,e}}Vn.prototype.bytesPerElement=40,ti(Vn,"StructArrayLayout5i4f1i1ul2ui40");class Bn extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,s,u,f,_,x)}emplace(e,i,s,u,f,_,x,T){const M=8*e;return this.int16[M+0]=i,this.int16[M+1]=s,this.int16[M+2]=u,this.int16[M+4]=f,this.int16[M+5]=_,this.int16[M+6]=x,this.int16[M+7]=T,e}}Bn.prototype.bytesPerElement=16,ti(Bn,"StructArrayLayout3i2i2i16");class li extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,s,u,f)}emplace(e,i,s,u,f,_){const x=4*e,T=8*e;return this.float32[x+0]=i,this.float32[x+1]=s,this.float32[x+2]=u,this.int16[T+6]=f,this.int16[T+7]=_,e}}li.prototype.bytesPerElement=16,ti(li,"StructArrayLayout2f1f2i16");class pn extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,u)}emplace(e,i,s,u,f){const _=12*e,x=3*e;return this.uint8[_+0]=i,this.uint8[_+1]=s,this.float32[x+1]=u,this.float32[x+2]=f,e}}pn.prototype.bytesPerElement=12,ti(pn,"StructArrayLayout2ub2f12");class ci extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=s,this.uint16[f+2]=u,e}}ci.prototype.bytesPerElement=6,ti(ci,"StructArrayLayout3ui6");class Ti extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,_,x,T,M,R,B,V,te,he,Ce,ze,Ke,yt,St,zt,Vt){const jt=this.length;return this.resize(jt+1),this.emplace(jt,e,i,s,u,f,_,x,T,M,R,B,V,te,he,Ce,ze,Ke,yt,St,zt,Vt)}emplace(e,i,s,u,f,_,x,T,M,R,B,V,te,he,Ce,ze,Ke,yt,St,zt,Vt,jt){const sn=30*e,an=15*e,In=60*e;return this.int16[sn+0]=i,this.int16[sn+1]=s,this.int16[sn+2]=u,this.float32[an+2]=f,this.float32[an+3]=_,this.uint16[sn+8]=x,this.uint16[sn+9]=T,this.uint32[an+5]=M,this.uint32[an+6]=R,this.uint32[an+7]=B,this.uint16[sn+16]=V,this.uint16[sn+17]=te,this.uint16[sn+18]=he,this.float32[an+10]=Ce,this.float32[an+11]=ze,this.uint8[In+48]=Ke,this.uint8[In+49]=yt,this.uint8[In+50]=St,this.uint32[an+13]=zt,this.int16[sn+28]=Vt,this.uint8[In+58]=jt,e}}Ti.prototype.bytesPerElement=60,ti(Ti,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ui extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,_,x,T,M,R,B,V,te,he,Ce,ze,Ke,yt,St,zt,Vt,jt,sn,an,In,An,tn,vn,On,Gn){const zn=this.length;return this.resize(zn+1),this.emplace(zn,e,i,s,u,f,_,x,T,M,R,B,V,te,he,Ce,ze,Ke,yt,St,zt,Vt,jt,sn,an,In,An,tn,vn,On,Gn)}emplace(e,i,s,u,f,_,x,T,M,R,B,V,te,he,Ce,ze,Ke,yt,St,zt,Vt,jt,sn,an,In,An,tn,vn,On,Gn,zn){const $n=38*e,zi=19*e;return this.int16[$n+0]=i,this.int16[$n+1]=s,this.int16[$n+2]=u,this.float32[zi+2]=f,this.float32[zi+3]=_,this.int16[$n+8]=x,this.int16[$n+9]=T,this.int16[$n+10]=M,this.int16[$n+11]=R,this.int16[$n+12]=B,this.int16[$n+13]=V,this.uint16[$n+14]=te,this.uint16[$n+15]=he,this.uint16[$n+16]=Ce,this.uint16[$n+17]=ze,this.uint16[$n+18]=Ke,this.uint16[$n+19]=yt,this.uint16[$n+20]=St,this.uint16[$n+21]=zt,this.uint16[$n+22]=Vt,this.uint16[$n+23]=jt,this.uint16[$n+24]=sn,this.uint16[$n+25]=an,this.uint16[$n+26]=In,this.uint16[$n+27]=An,this.uint16[$n+28]=tn,this.uint32[zi+15]=vn,this.float32[zi+16]=On,this.float32[zi+17]=Gn,this.float32[zi+18]=zn,e}}ui.prototype.bytesPerElement=76,ti(ui,"StructArrayLayout3i2f6i15ui1ul3f76");class si extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}si.prototype.bytesPerElement=4,ti(si,"StructArrayLayout1f4");class Ei extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,s,u,f,_,x)}emplace(e,i,s,u,f,_,x,T){const M=7*e;return this.float32[M+0]=i,this.float32[M+1]=s,this.float32[M+2]=u,this.float32[M+3]=f,this.float32[M+4]=_,this.float32[M+5]=x,this.float32[M+6]=T,e}}Ei.prototype.bytesPerElement=28,ti(Ei,"StructArrayLayout7f28");class qi extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,s,u,f)}emplace(e,i,s,u,f,_){const x=5*e;return this.float32[x+0]=i,this.float32[x+1]=s,this.float32[x+2]=u,this.float32[x+3]=f,this.float32[x+4]=_,e}}qi.prototype.bytesPerElement=20,ti(qi,"StructArrayLayout5f20");class _i extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,u)}emplace(e,i,s,u,f){const _=6*e;return this.uint32[3*e+0]=i,this.uint16[_+2]=s,this.uint16[_+3]=u,this.uint16[_+4]=f,e}}_i.prototype.bytesPerElement=12,ti(_i,"StructArrayLayout1ul3ui12");class Fi extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=s,e}}Fi.prototype.bytesPerElement=4,ti(Fi,"StructArrayLayout2ui4");class hr extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}hr.prototype.bytesPerElement=2,ti(hr,"StructArrayLayout1ui2");class no extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=s,e}}no.prototype.bytesPerElement=8,ti(no,"StructArrayLayout2f8");class Bo extends xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,f,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,s,u,f,_,x)}emplace(e,i,s,u,f,_,x,T){const M=8*e,R=4*e;return this.int16[M+0]=i,this.int16[M+1]=s,this.int16[M+2]=u,this.int16[M+3]=f,this.int16[M+4]=_,this.int16[M+5]=x,this.float32[R+3]=T,e}}Bo.prototype.bytesPerElement=16,ti(Bo,"StructArrayLayout6i1f16");class ts extends Oe{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ts.prototype.size=12;class Fs extends hn{get(e){return new ts(this,e)}}ti(Fs,"FillExtrusionExtArray");class ua extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ua.prototype.size=40;class As extends Vn{get(e){return new ua(this,e)}}ti(As,"CollisionBoxArray");class Ks extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ks.prototype.size=60;class Ra extends Ti{get(e){return new Ks(this,e)}}ti(Ra,"PlacedSymbolArray");class wo extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}wo.prototype.size=76;class mo extends ui{get(e){return new wo(this,e)}}ti(mo,"SymbolInstanceArray");class Er extends si{getoffsetX(e){return this.float32[1*e+0]}}ti(Er,"GlyphOffsetArray");class Ro extends ot{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ti(Ro,"SymbolLineVertexArray");class Bs extends Oe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Bs.prototype.size=12;class co extends _i{get(e){return new Bs(this,e)}}ti(co,"FeatureIndexArray");class Qs extends Oe{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Qs.prototype.size=4;class il extends Fi{get(e){return new Qs(this,e)}}ti(il,"FillExtrusionCentroidArray");class vs extends Oe{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}vs.prototype.size=16;class ea extends Bo{get(e){return new vs(this,e)}}ti(ea,"CircleGlobeExtArray");const Sd=at([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),ku=at([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var bc=Ee(function(n){n.exports=function(e,i){var s,u,f,_,x,T,M,R;for(u=e.length-(s=3&e.length),f=i,x=3432918353,T=461845907,R=0;R<u;)M=255&e.charCodeAt(R)|(255&e.charCodeAt(++R))<<8|(255&e.charCodeAt(++R))<<16|(255&e.charCodeAt(++R))<<24,++R,f=27492+(65535&(_=5*(65535&(f=(f^=M=(65535&(M=(M=(65535&M)*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(M=0,s){case 3:M^=(255&e.charCodeAt(R+2))<<16;case 2:M^=(255&e.charCodeAt(R+1))<<8;case 1:f^=M=(65535&(M=(M=(65535&(M^=255&e.charCodeAt(R)))*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295}return f^=e.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),Wc=Ee(function(n){n.exports=function(e,i){for(var s,u=e.length,f=i^u,_=0;u>=4;)s=1540483477*(65535&(s=255&e.charCodeAt(_)|(255&e.charCodeAt(++_))<<8|(255&e.charCodeAt(++_))<<16|(255&e.charCodeAt(++_))<<24))+((1540483477*(s>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),u-=4,++_;switch(u){case 3:f^=(255&e.charCodeAt(_+2))<<16;case 2:f^=(255&e.charCodeAt(_+1))<<8;case 1:f=1540483477*(65535&(f^=255&e.charCodeAt(_)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),wa=bc,Yc=Wc;wa.murmur3=bc,wa.murmur2=Yc;class Fu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,s,u){this.ids.push(Sh(e)),this.positions.push(i,s,u)}getPositions(e){const i=Sh(e);let s=0,u=this.ids.length-1;for(;s<u;){const _=s+u>>1;this.ids[_]>=i?u=_:s=_+1}const f=[];for(;this.ids[s]===i;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(e,i){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Pd(s,u,0,s.length-1),i&&i.push(s.buffer,u.buffer),{ids:s,positions:u}}static deserialize(e){const i=new Fu;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Sh(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:wa(String(n))}function Pd(n,e,i,s){for(;i<s;){const u=n[i+s>>1];let f=i-1,_=s+1;for(;;){do{f++}while(n[f]<u);do{_--}while(n[_]>u);if(f>=_)break;Od(n,f,_),Od(e,3*f,3*_),Od(e,3*f+1,3*_+1),Od(e,3*f+2,3*_+2)}_-i<s-_?(Pd(n,e,i,_),i=_+1):(Pd(n,e,_+1,s),s=_)}}function Od(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}ti(Fu,"FeaturePositionMap");class Cl{constructor(e,i){this.gl=e.gl,this.location=i}}class Ld extends Cl{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class tf extends Cl{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class nf extends Cl{constructor(e,i){super(e,i),this.current=vt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ql=new Float32Array(16),Bu=new Float32Array(9),Xm=new Float32Array(4);function rf(n){return[Te(255*n.r,255*n.g),Te(255*n.b,255*n.a)]}class Rd{constructor(e,i,s){this.value=e,this.uniformNames=i.map(u=>`u_${u}`),this.type=s}setUniform(e,i,s){e.set(s.constantOr(this.value))}getBinding(e,i,s){return"color"===this.type?new nf(e,i):new Ld(e,i)}}class zu{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=i.tl.concat(i.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,i,s,u){const f="u_pattern_to"===u||"u_dash_to"===u?this.patternTo:"u_pattern_from"===u||"u_dash_from"===u?this.patternFrom:"u_pixel_ratio_to"===u?this.pixelRatioTo:"u_pixel_ratio_from"===u?this.pixelRatioFrom:null;f&&e.set(f)}getBinding(e,i,s){return"u_pattern_from"===s||"u_pattern_to"===s||"u_dash_from"===s||"u_dash_to"===s?new tf(e,i):new Ld(e,i)}}class Wl{constructor(e,i,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,s,u,f,_){const x=this.paintVertexArray.length,T=this.expression.evaluate(new Gr(0),i,{},f,u,_);this.paintVertexArray.resize(e),this._setPaintValue(x,e,T)}updatePaintArray(e,i,s,u,f){const _=this.expression.evaluate({zoom:0},s,u,void 0,f);this._setPaintValue(e,i,_)}_setPaintValue(e,i,s){if("color"===this.type){const u=rf(s);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class rl{constructor(e,i,s,u,f,_){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=s,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,i,s,u,f,_){const x=this.expression.evaluate(new Gr(this.zoom),i,{},f,u,_),T=this.expression.evaluate(new Gr(this.zoom+1),i,{},f,u,_),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,x,T)}updatePaintArray(e,i,s,u,f){const _=this.expression.evaluate({zoom:this.zoom},s,u,void 0,f),x=this.expression.evaluate({zoom:this.zoom+1},s,u,void 0,f);this._setPaintValue(e,i,_,x)}_setPaintValue(e,i,s,u){if("color"===this.type){const f=rf(s),_=rf(u);for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,f[0],f[1],_[0],_[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const s=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,u=He(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,i,s){return new Ld(e,i)}}class Tl{constructor(e,i,s,u,f,_,x){this.expression=e,this.type=s,this.useIntegerZoom=u,this.zoom=f,this.layerId=x,this.paintVertexAttributes=("array"===s?ku:Sd).members;for(let T=0;T<i.length;++T);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,i,s){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,u,f,_){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],_)}_setPaintValues(e,i,s,u){if(!u||!s)return;const{min:f,mid:_,max:x}=s,T=u[f],M=u[_],R=u[x];if(T&&M&&R)for(let B=e;B<i;B++)this._setPaintValue(this.zoomInPaintVertexArray,B,M,T),this._setPaintValue(this.zoomOutPaintVertexArray,B,M,R)}_setPaintValue(e,i,s,u){e.emplace(i,s.tl[0],s.tl[1],s.br[0],s.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],s.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Yl{constructor(e,i,s=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!s(f))continue;const _=e.paint.get(f);if(!(_ instanceof b&&qa(_.property.specification)))continue;const x=Qm(f,e.type),T=_.value,M=_.property.specification.type,R=_.property.useIntegerZoom,B=_.property.specification["property-type"],V="cross-faded"===B||"cross-faded-data-driven"===B,te="line-dasharray"===String(f)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==T.kind||te)if("source"===T.kind||te||V){const he=Nu(f,M,"source");this.binders[f]=V?new Tl(T,x,M,R,i,he,e.id):new Wl(T,x,M,he),u.push(`/a_${f}`)}else{const he=Nu(f,M,"composite");this.binders[f]=new rl(T,x,M,R,i,he),u.push(`/z_${f}`)}else this.binders[f]=V?new zu(T.value,x):new Rd(T.value,x,M),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Wl||i instanceof rl?i.maxValue:0}populatePaintArrays(e,i,s,u,f,_){for(const x in this.binders){const T=this.binders[x];(T instanceof Wl||T instanceof rl||T instanceof Tl)&&T.populatePaintArray(e,i,s,u,f,_)}}setConstantPatternPositions(e,i){for(const s in this.binders){const u=this.binders[s];u instanceof zu&&u.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,s,u,f,_){let x=!1;for(const T in e){const M=i.getPositions(T);for(const R of M){const B=s.feature(R.index);for(const V in this.binders){const te=this.binders[V];if((te instanceof Wl||te instanceof rl||te instanceof Tl)&&!0===te.expression.isStateDependent){const he=u.paint.get(V);te.expression=he.value,te.updatePaintArray(R.start,R.end,B,e[T],f,_),x=!0}}}}return x}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof Rd||s instanceof zu)&&e.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Wl||s instanceof rl||s instanceof Tl)for(let u=0;u<s.paintVertexAttributes.length;u++)e.push(s.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Rd||s instanceof zu||s instanceof rl)for(const u of s.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const s=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Rd||f instanceof zu||f instanceof rl)for(const _ of f.uniformNames)if(i[_]){const x=f.getBinding(e,i[_],_);s.push({name:_,property:u,binding:x})}}return s}setUniforms(e,i,s,u){for(const{name:f,property:_,binding:x}of i)this.binders[_].setUniform(x,u,s.get(_),f)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const s=this.binders[i];if(e&&s instanceof Tl){const u=2===e.fromScale?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(s instanceof Wl||s instanceof rl)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof Wl||s instanceof rl||s instanceof Tl)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Wl||i instanceof rl||i instanceof Tl)&&i.destroy()}}}class wc{constructor(e,i,s=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Yl(u,i,s);this.needsUpload=!1,this._featureMap=new Fu,this._bufferOffset=0}populatePaintArrays(e,i,s,u,f,_,x){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,i,u,f,_,x);void 0!==i.id&&this._featureMap.add(i.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,u,f){for(const _ of s)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,i,_,u,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Km={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Qm(n,e){return Km[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const J_={"line-pattern":{source:Jt,composite:Jt},"fill-pattern":{source:Jt,composite:Jt},"fill-extrusion-pattern":{source:Jt,composite:Jt},"line-dasharray":{source:rn,composite:rn}},eg={color:{source:no,composite:bt},number:{source:si,composite:no}};function Nu(n,e,i){const s=J_[n];return s&&s[i]||eg[e][i]}ti(Rd,"ConstantBinder"),ti(zu,"CrossFadedConstantBinder"),ti(Wl,"SourceExpressionBinder"),ti(Tl,"CrossFadedCompositeBinder"),ti(rl,"CompositeExpressionBinder"),ti(Yl,"ProgramConfiguration",{omit:["_buffers"]}),ti(wc,"ProgramConfigurationSet");const Uu="-transition";class Go extends Xn{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new g(i.layout)),i.paint)){this._transitionablePaint=new p(i.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new C(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,s={}){null!=i&&this._validate(el,`layers.${this.id}.layout.${e}`,e,i,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return st(e,Uu)?this._transitionablePaint.getTransition(e.slice(0,-Uu.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,s={}){if(null!=i&&this._validate(Hc,`layers.${this.id}.paint.${e}`,e,i,s))return!1;if(st(e,Uu))return this._transitionablePaint.setTransition(e.slice(0,-Uu.length),i||void 0),!1;{const u=this._transitionablePaint._values[e],f="cross-faded-data-driven"===u.property.specification["property-type"],_=u.value.isDataDriven(),x=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||_||f||this._handleOverridablePaintPropertyUpdate(e,x,T)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Yt(e,(i,s)=>!(void 0===i||"layout"===s&&!Object.keys(i).length||"paint"===s&&!Object.keys(i).length))}_validate(e,i,s,u,f={}){return(!f||!1!==f.validate)&&Aa(this,e.call(Qa,{key:i,layerType:this.type,objectKey:s,value:u,styleSpec:Ut,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof b&&qa(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=kr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Vu=at([{name:"a_pos",components:2,type:"Int16"}],4),of=at([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class go{constructor(e=[]){this.segments=e}prepareSegment(e,i,s,u){let f=this.segments[this.segments.length-1];return e>go.MAX_VERTEX_ARRAY_LENGTH&&Nt(`Max vertices per segment is ${go.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>go.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:i.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==u&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,u){return new go([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}go.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ti(go,"SegmentVector");var Zi=8192;class Cc{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Vr?new Vr(e.lng,e.lat):Vr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Vr?new Vr(e.lng,e.lat):Vr.convert(e),this}extend(e){const i=this._sw,s=this._ne;let u,f;if(e instanceof Vr)u=e,f=e;else{if(!(e instanceof Cc))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Cc.convert(e)):this.extend(Vr.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return i||s?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new Vr(u.lng,u.lat),this._ne=new Vr(f.lng,f.lat)),this}getCenter(){return new Vr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Vr(this.getWest(),this.getNorth())}getSouthEast(){return new Vr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=Vr.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){return!e||e instanceof Cc?e:new Cc(e)}}const sf=6371008.8;class Vr{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Vr(Qe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,u=e.lat*i,f=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return sf*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new Cc(new Vr(this.lng-s,this.lat-i),new Vr(this.lng+s,this.lat+i))}static convert(e){if(e instanceof Vr)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Vr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Vr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const kd=2*Math.PI*sf;function $u(n){return kd*Math.cos(n*Math.PI/180)}function Tc(n){return(180+n)/360}function ju(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Zu(n,e){return n/$u(e)}function da(n){return 360*n-180}function us(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function af(n,e){return n*$u(us(e))}const ol=85.051129;class Fd{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=Vr.convert(e);return new Fd(Tc(s.lng),ju(s.lat),Zu(i,s.lat))}toLngLat(){return new Vr(da(this.x),us(this.y))}toAltitude(){return af(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/kd*(e=us(this.y),1/Math.cos(e*Math.PI/180));var e}}function Bd(n,e,i,s,u,f,_,x,T){const M=(e+s)/2,R=(i+u)/2,B=new ne(M,R);x(B),function(V,te,he,Ce,ze,Ke){const yt=he-ze,St=Ce-Ke;return Math.abs((Ce-te)*yt-(he-V)*St)/Math.hypot(yt,St)}(B.x,B.y,f.x,f.y,_.x,_.y)>=T?(Bd(n,e,i,M,R,f,B,x,T),Bd(n,M,R,s,u,B,_,x,T)):n.push(_)}function zd(n,e,i){let s=n[0],u=s.x,f=s.y;e(s);const _=[s];for(let x=1;x<n.length;x++){const T=n[x],{x:M,y:R}=T;e(T),Bd(_,u,f,M,R,s,T,e,i),u=M,f=R,s=T}return _}const Ph=Math.pow(2,14)-1,Nd=-Ph-1;function tg(n,e){const i=Math.round(n.x*e),s=Math.round(n.y*e);return n.x=He(i,Nd,Ph),n.y=He(s,Nd,Ph),(i<n.x||i>n.x+1||s<n.y||s>n.y+1)&&Nt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function oo(n,e,i){const s=n.loadGeometry(),u=n.extent,f=Zi/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:x,x:T,y:M,projection:R}=i,B=V=>{const te=da((e.x+V.x/u)/_),he=us((e.y+V.y/u)/_),Ce=R.project(te,he);V.x=(Ce.x*x-T)*u,V.y=(Ce.y*x-M)*u};for(let V=0;V<s.length;V++)if(1!==n.type)s[V]=zd(s[V],B,1);else{const te=[];for(const he of s[V])he.x<0||he.x>=u||he.y<0||he.y>=u||(B(he),te.push(he));s[V]=te}}for(const _ of s)for(const x of _)tg(x,f);return s}function Ec(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?oo(n):[]}}function Ud(n,e,i,s,u){n.emplaceBack(2*e+(s+1)/2,2*i+(u+1)/2)}function Jc(n,e,i,s){n.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2],s)}class Vd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new rt,this.indexArray=new ci,this.segments=new go,this.programConfigurations=new wc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,u){const f=this.layers[0],_=[];let x=null;"circle"===f.type&&(x=f.layout.get("circle-sort-key"));for(const{feature:M,id:R,index:B,sourceLayerIndex:V}of e){const te=this.layers[0]._featureFilter.needGeometry,he=Ec(M,te);if(!this.layers[0]._featureFilter.filter(new Gr(this.zoom),he,s))continue;const Ce=x?x.evaluate(he,{},s):void 0,ze={id:R,properties:M.properties,type:M.type,sourceLayerIndex:V,index:B,geometry:te?he.geometry:oo(M,s,u),patterns:{},sortKey:Ce};_.push(ze)}x&&_.sort((M,R)=>M.sortKey-R.sortKey);let T=null;"globe"===u.projection.name&&(this.globeExtVertexArray=new ea,T=u.projection);for(const M of _){const{geometry:R,index:B,sourceLayerIndex:V}=M,te=e[B].feature;this.addFeature(M,R,B,i.availableImages,s,T),i.featureIndex.insert(te,R,B,V,this.index)}}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,of.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,s,u,f,_){for(const x of i)for(const T of x){const M=T.x,R=T.y;if(M<0||M>=Zi||R<0||R>=Zi)continue;if(_){const te=_.projectTilePoint(M,R,f),he=_.upVector(f,M,R),Ce=us((R/Zi+f.y)/(1<<f.z)),ze=_.pixelsPerMeter(Ce,1)/Zu(1,Ce),Ke=this.globeExtVertexArray;Jc(Ke,te,he,ze),Jc(Ke,te,he,ze),Jc(Ke,te,he,ze),Jc(Ke,te,he,ze)}const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),V=B.vertexLength;Ud(this.layoutVertexArray,M,R,-1,-1),Ud(this.layoutVertexArray,M,R,1,-1),Ud(this.layoutVertexArray,M,R,1,1),Ud(this.layoutVertexArray,M,R,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+3,V+2),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,f)}}function lf(n,e){for(let i=0;i<n.length;i++)if(Jl(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Jl(n,e[i]))return!0;return!!Oh(n,e)}function ng(n,e,i){return!!Jl(n,e)||!!uf(e,n,i)}function cf(n,e){if(1===n.length)return Ss(e,n[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let u=0;u<s.length;u++)if(Jl(n,s[u]))return!0}for(let i=0;i<n.length;i++)if(Ss(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Oh(n,e[i]))return!0;return!1}function ig(n,e,i){if(n.length>1){if(Oh(n,e))return!0;for(let s=0;s<e.length;s++)if(uf(e[s],n,i))return!0}for(let s=0;s<n.length;s++)if(uf(n[s],e,i))return!0;return!1}function Oh(n,e){if(0===n.length||0===e.length)return!1;for(let i=0;i<n.length-1;i++){const s=n[i],u=n[i+1];for(let f=0;f<e.length-1;f++)if(X_(s,u,e[f],e[f+1]))return!0}return!1}function X_(n,e,i,s){return Bt(n,i,s)!==Bt(e,i,s)&&Bt(n,e,i)!==Bt(n,e,s)}function uf(n,e,i){const s=i*i;if(1===e.length)return n.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(Xc(n,e[u-1],e[u])<s)return!0;return!1}function Xc(n,e,i){const s=e.distSqr(i);if(0===s)return n.distSqr(e);const u=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/s;return n.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function Ss(n,e){let i,s,u,f=!1;for(let _=0;_<n.length;_++){i=n[_];for(let x=0,T=i.length-1;x<i.length;T=x++)s=i[x],u=i[T],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(f=!f)}return f}function Jl(n,e){let i=!1;for(let s=0,u=n.length-1;s<n.length;u=s++){const f=n[s],_=n[u];f.y>e.y!=_.y>e.y&&e.x<(_.x-f.x)*(e.y-f.y)/(_.y-f.y)+f.x&&(i=!i)}return i}function Lh(n,e,i,s,u){for(const _ of n)if(e<=_.x&&i<=_.y&&s>=_.x&&u>=_.y)return!0;const f=[new ne(e,i),new ne(e,u),new ne(s,u),new ne(s,i)];if(n.length>2)for(const _ of f)if(Jl(n,_))return!0;for(let _=0;_<n.length-1;_++)if(df(n[_],n[_+1],f))return!0;return!1}function df(n,e,i){const s=i[0],u=i[2];if(n.x<s.x&&e.x<s.x||n.x>u.x&&e.x>u.x||n.y<s.y&&e.y<s.y||n.y>u.y&&e.y>u.y)return!1;const f=Bt(n,e,i[0]);return f!==Bt(n,e,i[1])||f!==Bt(n,e,i[2])||f!==Bt(n,e,i[3])}function zo(n,e,i){const s=e.paint.get(n).value;return"constant"===s.kind?s.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Xl(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function $d(n,e,i,s,u){if(!e[0]&&!e[1])return n;const f=ne.convert(e)._mult(u);"viewport"===i&&f._rotate(-s);const _=[];for(let x=0;x<n.length;x++)_.push(n[x].sub(f));return _}function hf(n,e,i,s){const u=ne.convert(n)._mult(s);return"viewport"===e&&u._rotate(-i),u}ti(Vd,"CircleBucket",{omit:["layers"]});const rg=new ae({"circle-sort-key":new S(Ut.layout_circle["circle-sort-key"])});var pf={paint:new ae({"circle-radius":new S(Ut.paint_circle["circle-radius"]),"circle-color":new S(Ut.paint_circle["circle-color"]),"circle-blur":new S(Ut.paint_circle["circle-blur"]),"circle-opacity":new S(Ut.paint_circle["circle-opacity"]),"circle-translate":new I(Ut.paint_circle["circle-translate"]),"circle-translate-anchor":new I(Ut.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new I(Ut.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new I(Ut.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new S(Ut.paint_circle["circle-stroke-width"]),"circle-stroke-color":new S(Ut.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new S(Ut.paint_circle["circle-stroke-opacity"])}),layout:rg},Rh=1e-6,zs=typeof Float32Array<"u"?Float32Array:Array;function ff(){var n=new zs(9);return zs!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function ka(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function kh(n,e,i){var s=e[0],u=e[1],f=e[2],_=e[3],x=e[4],T=e[5],M=e[6],R=e[7],B=e[8],V=e[9],te=e[10],he=e[11],Ce=e[12],ze=e[13],Ke=e[14],yt=e[15],St=i[0],zt=i[1],Vt=i[2],jt=i[3];return n[0]=St*s+zt*x+Vt*B+jt*Ce,n[1]=St*u+zt*T+Vt*V+jt*ze,n[2]=St*f+zt*M+Vt*te+jt*Ke,n[3]=St*_+zt*R+Vt*he+jt*yt,n[4]=(St=i[4])*s+(zt=i[5])*x+(Vt=i[6])*B+(jt=i[7])*Ce,n[5]=St*u+zt*T+Vt*V+jt*ze,n[6]=St*f+zt*M+Vt*te+jt*Ke,n[7]=St*_+zt*R+Vt*he+jt*yt,n[8]=(St=i[8])*s+(zt=i[9])*x+(Vt=i[10])*B+(jt=i[11])*Ce,n[9]=St*u+zt*T+Vt*V+jt*ze,n[10]=St*f+zt*M+Vt*te+jt*Ke,n[11]=St*_+zt*R+Vt*he+jt*yt,n[12]=(St=i[12])*s+(zt=i[13])*x+(Vt=i[14])*B+(jt=i[15])*Ce,n[13]=St*u+zt*T+Vt*V+jt*ze,n[14]=St*f+zt*M+Vt*te+jt*Ke,n[15]=St*_+zt*R+Vt*he+jt*yt,n}function Dc(n,e,i){var s,u,f,_,x,T,M,R,B,V,te,he,Ce=i[0],ze=i[1],Ke=i[2];return e===n?(n[12]=e[0]*Ce+e[4]*ze+e[8]*Ke+e[12],n[13]=e[1]*Ce+e[5]*ze+e[9]*Ke+e[13],n[14]=e[2]*Ce+e[6]*ze+e[10]*Ke+e[14],n[15]=e[3]*Ce+e[7]*ze+e[11]*Ke+e[15]):(u=e[1],f=e[2],_=e[3],x=e[4],T=e[5],M=e[6],R=e[7],B=e[8],V=e[9],te=e[10],he=e[11],n[0]=s=e[0],n[1]=u,n[2]=f,n[3]=_,n[4]=x,n[5]=T,n[6]=M,n[7]=R,n[8]=B,n[9]=V,n[10]=te,n[11]=he,n[12]=s*Ce+x*ze+B*Ke+e[12],n[13]=u*Ce+T*ze+V*Ke+e[13],n[14]=f*Ce+M*ze+te*Ke+e[14],n[15]=_*Ce+R*ze+he*Ke+e[15]),n}function sl(n,e,i){var s=i[0],u=i[1],f=i[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Fh(n,e,i){var s=Math.sin(i),u=Math.cos(i),f=e[4],_=e[5],x=e[6],T=e[7],M=e[8],R=e[9],B=e[10],V=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*u+M*s,n[5]=_*u+R*s,n[6]=x*u+B*s,n[7]=T*u+V*s,n[8]=M*u-f*s,n[9]=R*u-_*s,n[10]=B*u-x*s,n[11]=V*u-T*s,n}function Bh(n,e,i){var s=Math.sin(i),u=Math.cos(i),f=e[0],_=e[1],x=e[2],T=e[3],M=e[8],R=e[9],B=e[10],V=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u-M*s,n[1]=_*u-R*s,n[2]=x*u-B*s,n[3]=T*u-V*s,n[8]=f*s+M*u,n[9]=_*s+R*u,n[10]=x*s+B*u,n[11]=T*s+V*u,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var zh=kh;function Nh(){var n=new zs(3);return zs!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function mf(n){var e=new zs(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Gu(n){return Math.hypot(n[0],n[1],n[2])}function Hu(n,e,i){var s=new zs(3);return s[0]=n,s[1]=e,s[2]=i,s}function gf(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function _f(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function yf(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function Uh(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function jd(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function qu(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Vh(n,e,i,s){return n[0]=e[0]+i[0]*s,n[1]=e[1]+i[1]*s,n[2]=e[2]+i[2]*s,n}function Wu(n,e){var i=e[0],s=e[1],u=e[2],f=i*i+s*s+u*u;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n}function Yu(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function vf(n,e,i){var s=e[0],u=e[1],f=e[2],_=i[0],x=i[1],T=i[2];return n[0]=u*T-f*x,n[1]=f*_-s*T,n[2]=s*x-u*_,n}function Ic(n,e,i){var s=e[0],u=e[1],f=e[2],_=i[3]*s+i[7]*u+i[11]*f+i[15];return n[0]=(i[0]*s+i[4]*u+i[8]*f+i[12])/(_=_||1),n[1]=(i[1]*s+i[5]*u+i[9]*f+i[13])/_,n[2]=(i[2]*s+i[6]*u+i[10]*f+i[14])/_,n}function xf(n,e,i){var s=i[0],u=i[1],f=i[2],_=e[0],x=e[1],T=e[2],M=u*T-f*x,R=f*_-s*T,B=s*x-u*_,V=u*B-f*R,te=f*M-s*B,he=s*R-u*M,Ce=2*i[3];return R*=Ce,B*=Ce,te*=2,he*=2,n[0]=_+(M*=Ce)+(V*=2),n[1]=x+R+te,n[2]=T+B+he,n}var Ju,Fa=_f,al=yf,K_=Gu;function Xu(n,e,i){var s=e[0],u=e[1],f=e[2],_=e[3];return n[0]=i[0]*s+i[4]*u+i[8]*f+i[12]*_,n[1]=i[1]*s+i[5]*u+i[9]*f+i[13]*_,n[2]=i[2]*s+i[6]*u+i[10]*f+i[14]*_,n[3]=i[3]*s+i[7]*u+i[11]*f+i[15]*_,n}function $h(){var n=new zs(4);return zs!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function og(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Ba(n,e,i){i*=.5;var s=e[0],u=e[1],f=e[2],_=e[3],x=Math.sin(i),T=Math.cos(i);return n[0]=s*T+_*x,n[1]=u*T+f*x,n[2]=f*T-u*x,n[3]=_*T-s*x,n}Nh(),Ju=new zs(4),zs!=Float32Array&&(Ju[0]=0,Ju[1]=0,Ju[2]=0,Ju[3]=0),Nh(),Hu(1,0,0),Hu(0,1,0),$h(),$h(),ff();class Ku{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,s,u){const f=Math.pow(2,s),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const M=Xu([],T,e),R=1/M[3]/i*f;return(B=M)[0]=(V=M)[0]*(te=[R,R,u?1/M[3]:R,R])[0],B[1]=V[1]*te[1],B[2]=V[2]*te[2],B[3]=V[3]*te[3],B;var B,V,te}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const M=Wu([],vf([],Fa([],_[T[0]],_[T[1]]),Fa([],_[T[2]],_[T[1]]))),R=-Yu(M,_[T[1]]);return M.concat(R)});return new Ku(_,x)}}class Ns{constructor(e,i){this.min=e,this.max=i,this.center=qu([],gf([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=mf(this.min),u=mf(this.max);for(let f=0;f<i.length;f++)s[f]=i[f]?this.min[f]:this.center[f],u[f]=i[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new Ns(s,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let s=!0;for(let u=0;u<e.planes.length;u++){const f=e.planes[u];let _=0;for(let x=0;x<i.length;x++)_+=Yu(f,i[x])+f[3]>=0;if(0===_)return 0;_!==i.length&&(s=!1)}if(s)return 2;for(let u=0;u<3;u++){let f=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let x=0;x<e.points.length;x++){const T=e.points[x][u]-this.min[u];f=Math.min(f,T),_=Math.max(_,T)}if(_<0||f>this.max[u]-this.min[u])return 0}return 1}}function bf(n,e,i,s,u,f,_,x,T){if(f&&n.queryGeometry.isAboveHorizon)return!1;f&&(T*=n.pixelToTileUnitsFactor);for(const M of e)for(const R of M){const B=R.add(x),V=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(B.x,B.y,!0):0,te=f?B:wf(B,V,s),he=f?n.tilespaceRays.map(ze=>Tf(ze,V)):n.queryGeometry.screenGeometry,Ce=Xu([],[R.x,R.y,V,1],s);if(!_&&f?T*=Ce[3]/i.cameraToCenterDistance:_&&!f&&(T*=i.cameraToCenterDistance/Ce[3]),ng(he,te,T))return!0}return!1}function wf(n,e,i){const s=Xu([],[n.x,n.y,e,1],i);return new ne(s[0]/s[3],s[1]/s[3])}const Kc=Hu(0,0,0),Cf=Hu(0,0,1);function Tf(n,e){const i=Nh();return Kc[2]=e,n.intersectsPlane(Kc,Cf,i),new ne(i[0],i[1])}class Zd extends Vd{}function Gd(n,{width:e,height:i},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*s);return n.width=e,n.height=i,n.data=u,n}function jh(n,e,i){const{width:s,height:u}=e;s===n.width&&u===n.height||(Ef(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,s),height:Math.min(n.height,u)},i),n.width=s,n.height=u,n.data=e.data)}function Ef(n,e,i,s,u,f){if(0===u.width||0===u.height)return e;if(u.width>n.width||u.height>n.height||i.x>n.width-u.width||i.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const _=n.data,x=e.data;for(let T=0;T<u.height;T++){const M=((i.y+T)*n.width+i.x)*f,R=((s.y+T)*e.width+s.x)*f;for(let B=0;B<u.width*f;B++)x[R+B]=_[M+B]}return e}ti(Zd,"HeatmapBucket",{omit:["layers"]});class ta{constructor(e,i){Gd(this,e,1,i)}resize(e){jh(this,new ta(e),1)}clone(){return new ta({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,u,f){Ef(e,i,s,u,f,1)}}class Ps{constructor(e,i){Gd(this,e,4,i)}resize(e){jh(this,new Ps(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ps({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,u,f){Ef(e,i,s,u,f,4)}}ti(ta,"AlphaImage"),ti(Ps,"RGBAImage");var Df={paint:new ae({"heatmap-radius":new S(Ut.paint_heatmap["heatmap-radius"]),"heatmap-weight":new S(Ut.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new I(Ut.paint_heatmap["heatmap-intensity"]),"heatmap-color":new J(Ut.paint_heatmap["heatmap-color"]),"heatmap-opacity":new I(Ut.paint_heatmap["heatmap-opacity"])})};function Zh(n){const e={},i=n.resolution||256,s=n.clips?n.clips.length:1,u=n.image||new Ps({width:i,height:s}),f=(_,x,T)=>{e[n.evaluationKey]=T;const M=n.expression.evaluate(e);u.data[_+x+0]=Math.floor(255*M.r/M.a),u.data[_+x+1]=Math.floor(255*M.g/M.a),u.data[_+x+2]=Math.floor(255*M.b/M.a),u.data[_+x+3]=Math.floor(255*M.a)};if(n.clips)for(let _=0,x=0;_<s;++_,x+=4*i)for(let T=0,M=0;T<i;T++,M+=4){const R=T/(i-1),{start:B,end:V}=n.clips[_];f(x,M,B*(1-R)+V*R)}else for(let _=0,x=0;_<i;_++,x+=4)f(0,x,_/(i-1));return u}var Gh={paint:new ae({"hillshade-illumination-direction":new I(Ut.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new I(Ut.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new I(Ut.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new I(Ut.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new I(Ut.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new I(Ut.paint_hillshade["hillshade-accent-color"])})};const sg=at([{name:"a_pos",components:2,type:"Int16"}],4),{members:ag}=sg;var Hd=qd,lg=qd;function qd(n,e,i){i=i||2;var s,u,f,_,x,T,M,R=e&&e.length,B=R?e[0]*i:n.length,V=If(n,0,B,i,!0),te=[];if(!V||V.next===V.prev)return te;if(R&&(V=function(Ce,ze,Ke,yt){var St,zt,Vt,jt=[];for(St=0,zt=ze.length;St<zt;St++)(Vt=If(Ce,ze[St]*yt,St<zt-1?ze[St+1]*yt:Ce.length,yt,!1))===Vt.next&&(Vt.steiner=!0),jt.push(Pf(Vt));for(jt.sort(Af),St=0;St<jt.length;St++)Ke=El(Ke=Sf(jt[St],Ke),Ke.next);return Ke}(n,e,V,i)),n.length>80*i){s=f=n[0],u=_=n[1];for(var he=i;he<B;he+=i)(x=n[he])<s&&(s=x),(T=n[he+1])<u&&(u=T),x>f&&(f=x),T>_&&(_=T);M=0!==(M=Math.max(f-s,_-u))?1/M:0}return Mc(V,te,i,s,u,M),te}function If(n,e,i,s,u){var f,_;if(u===Jd(n,e,i,s)>0)for(f=e;f<i;f+=s)_=nd(f,n[f],n[f+1],_);else for(f=i-s;f>=e;f-=s)_=nd(f,n[f],n[f+1],_);return _&&Qu(_,_.next)&&(nu(_),_=_.next),_}function El(n,e){if(!n)return n;e||(e=n);var i,s=n;do{if(i=!1,s.steiner||!Qu(s,s.next)&&0!==Mo(s.prev,s,s.next))s=s.next;else{if(nu(s),(s=e=s.prev)===s.next)break;i=!0}}while(i||s!==e);return e}function Mc(n,e,i,s,u,f,_){if(n){!_&&f&&function(R,B,V,te){var he=R;do{null===he.z&&(he.z=Wd(he.x,he.y,B,V,te)),he.prevZ=he.prev,he.nextZ=he.next,he=he.next}while(he!==R);he.prevZ.nextZ=null,he.prevZ=null,function(Ce){var ze,Ke,yt,St,zt,Vt,jt,sn,an=1;do{for(Ke=Ce,Ce=null,zt=null,Vt=0;Ke;){for(Vt++,yt=Ke,jt=0,ze=0;ze<an&&(jt++,yt=yt.nextZ);ze++);for(sn=an;jt>0||sn>0&&yt;)0!==jt&&(0===sn||!yt||Ke.z<=yt.z)?(St=Ke,Ke=Ke.nextZ,jt--):(St=yt,yt=yt.nextZ,sn--),zt?zt.nextZ=St:Ce=St,St.prevZ=zt,zt=St;Ke=yt}zt.nextZ=null,an*=2}while(Vt>1)}(he)}(n,s,u,f);for(var x,T,M=n;n.prev!==n.next;)if(x=n.prev,T=n.next,f?Hh(n,s,u,f):Mf(n))e.push(x.i/i),e.push(n.i/i),e.push(T.i/i),nu(n),n=T.next,M=T.next;else if((n=T)===M){_?1===_?Mc(n=cg(El(n),e,i),e,i,s,u,f,2):2===_&&ug(n,e,i,s,u,f):Mc(El(n),e,i,s,u,f,1);break}}}function Mf(n){var e=n.prev,i=n,s=n.next;if(Mo(e,i,s)>=0)return!1;for(var u=n.next.next;u!==n.prev;){if(Qc(e.x,e.y,i.x,i.y,s.x,s.y,u.x,u.y)&&Mo(u.prev,u,u.next)>=0)return!1;u=u.next}return!0}function Hh(n,e,i,s){var u=n.prev,f=n,_=n.next;if(Mo(u,f,_)>=0)return!1;for(var x=u.x>f.x?u.x>_.x?u.x:_.x:f.x>_.x?f.x:_.x,T=u.y>f.y?u.y>_.y?u.y:_.y:f.y>_.y?f.y:_.y,M=Wd(u.x<f.x?u.x<_.x?u.x:_.x:f.x<_.x?f.x:_.x,u.y<f.y?u.y<_.y?u.y:_.y:f.y<_.y?f.y:_.y,e,i,s),R=Wd(x,T,e,i,s),B=n.prevZ,V=n.nextZ;B&&B.z>=M&&V&&V.z<=R;){if(B!==n.prev&&B!==n.next&&Qc(u.x,u.y,f.x,f.y,_.x,_.y,B.x,B.y)&&Mo(B.prev,B,B.next)>=0||(B=B.prevZ,V!==n.prev&&V!==n.next&&Qc(u.x,u.y,f.x,f.y,_.x,_.y,V.x,V.y)&&Mo(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;B&&B.z>=M;){if(B!==n.prev&&B!==n.next&&Qc(u.x,u.y,f.x,f.y,_.x,_.y,B.x,B.y)&&Mo(B.prev,B,B.next)>=0)return!1;B=B.prevZ}for(;V&&V.z<=R;){if(V!==n.prev&&V!==n.next&&Qc(u.x,u.y,f.x,f.y,_.x,_.y,V.x,V.y)&&Mo(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function cg(n,e,i){var s=n;do{var u=s.prev,f=s.next.next;!Qu(u,f)&&qh(u,s,s.next,f)&&tu(u,f)&&tu(f,u)&&(e.push(u.i/i),e.push(s.i/i),e.push(f.i/i),nu(s),nu(s.next),s=n=f),s=s.next}while(s!==n);return El(s)}function ug(n,e,i,s,u,f){var _=n;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&Yd(_,x)){var T=td(_,x);return _=El(_,_.next),T=El(T,T.next),Mc(_,e,i,s,u,f),void Mc(T,e,i,s,u,f)}x=x.next}_=_.next}while(_!==n)}function Af(n,e){return n.x-e.x}function Sf(n,e){var i=function(f,_){var x,T=_,M=f.x,R=f.y,B=-1/0;do{if(R<=T.y&&R>=T.next.y&&T.next.y!==T.y){var V=T.x+(R-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(V<=M&&V>B){if(B=V,V===M){if(R===T.y)return T;if(R===T.next.y)return T.next}x=T.x<T.next.x?T:T.next}}T=T.next}while(T!==_);if(!x)return null;if(M===B)return x;var te,he=x,Ce=x.x,ze=x.y,Ke=1/0;T=x;do{M>=T.x&&T.x>=Ce&&M!==T.x&&Qc(R<ze?M:B,R,Ce,ze,R<ze?B:M,R,T.x,T.y)&&(te=Math.abs(R-T.y)/(M-T.x),tu(T,f)&&(te<Ke||te===Ke&&(T.x>x.x||T.x===x.x&&Ac(x,T)))&&(x=T,Ke=te)),T=T.next}while(T!==he);return x}(n,e);if(!i)return e;var s=td(i,n),u=El(i,i.next);return El(s,s.next),e===i?u:e}function Ac(n,e){return Mo(n.prev,n,e.prev)<0&&Mo(e.next,n,n.next)<0}function Wd(n,e,i,s,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-i)*u)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*u)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Pf(n){var e=n,i=n;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==n);return i}function Qc(n,e,i,s,u,f,_,x){return(u-_)*(e-x)-(n-_)*(f-x)>=0&&(n-_)*(s-x)-(i-_)*(e-x)>=0&&(i-_)*(f-x)-(u-_)*(s-x)>=0}function Yd(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,s){var u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==s.i&&u.next.i!==s.i&&qh(u,u.next,i,s))return!0;u=u.next}while(u!==i);return!1}(n,e)&&(tu(n,e)&&tu(e,n)&&function(i,s){var u=i,f=!1,_=(i.x+s.x)/2,x=(i.y+s.y)/2;do{u.y>x!=u.next.y>x&&u.next.y!==u.y&&_<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next}while(u!==i);return f}(n,e)&&(Mo(n.prev,n,e.prev)||Mo(n,e.prev,e))||Qu(n,e)&&Mo(n.prev,n,n.next)>0&&Mo(e.prev,e,e.next)>0)}function Mo(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Qu(n,e){return n.x===e.x&&n.y===e.y}function qh(n,e,i,s){var u=eu(Mo(n,e,i)),f=eu(Mo(n,e,s)),_=eu(Mo(i,s,n)),x=eu(Mo(i,s,e));return u!==f&&_!==x||!(0!==u||!ed(n,i,e))||!(0!==f||!ed(n,s,e))||!(0!==_||!ed(i,n,s))||!(0!==x||!ed(i,e,s))}function ed(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function eu(n){return n>0?1:n<0?-1:0}function tu(n,e){return Mo(n.prev,n,n.next)<0?Mo(n,e,n.next)>=0&&Mo(n,n.prev,e)>=0:Mo(n,e,n.prev)<0||Mo(n,n.next,e)<0}function td(n,e){var i=new id(n.i,n.x,n.y),s=new id(e.i,e.x,e.y),u=n.next,f=e.prev;return n.next=e,e.prev=n,i.next=u,u.prev=i,s.next=i,i.prev=s,f.next=s,s.prev=f,s}function nd(n,e,i,s){var u=new id(n,e,i);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function nu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function id(n,e,i){this.i=n,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Jd(n,e,i,s){for(var u=0,f=e,_=i-s;f<i;f+=s)u+=(n[_]-n[f])*(n[f+1]+n[_+1]),_=f;return u}function Wh(n,e,i,s,u){iu(n,e,i||0,s||n.length-1,u||Of)}function iu(n,e,i,s,u){for(;s>i;){if(s-i>600){var f=s-i+1,_=e-i+1,x=Math.log(f),T=.5*Math.exp(2*x/3),M=.5*Math.sqrt(x*T*(f-T)/f)*(_-f/2<0?-1:1);iu(n,e,Math.max(i,Math.floor(e-_*T/f+M)),Math.min(s,Math.floor(e+(f-_)*T/f+M)),u)}var R=n[e],B=i,V=s;for(rd(n,i,e),u(n[s],R)>0&&rd(n,i,s);B<V;){for(rd(n,B,V),B++,V--;u(n[B],R)<0;)B++;for(;u(n[V],R)>0;)V--}0===u(n[i],R)?rd(n,i,V):rd(n,++V,s),V<=e&&(i=V+1),e<=V&&(s=V-1)}}function rd(n,e,i){var s=n[e];n[e]=n[i],n[i]=s}function Of(n,e){return n<e?-1:n>e?1:0}function Yh(n,e){const i=n.length;if(i<=1)return[n];const s=[];let u,f;for(let _=0;_<i;_++){const x=Dt(n[_]);0!==x&&(n[_].area=Math.abs(x),void 0===f&&(f=x<0),f===x<0?(u&&s.push(u),u=[n[_]]):u.push(n[_]))}if(u&&s.push(u),e>1)for(let _=0;_<s.length;_++)s[_].length<=e||(Wh(s[_],e,1,s[_].length-1,dg),s[_]=s[_].slice(0,e));return s}function dg(n,e){return e.area-n.area}function Xd(n,e,i){const s=i.patternDependencies;let u=!1;for(const f of e){const _=f.paint.get(`${n}-pattern`);_.isConstant()||(u=!0);const x=_.constantOr(null);x&&(u=!0,s[x.to]=!0,s[x.from]=!0)}return u}function od(n,e,i,s,u){const f=u.patternDependencies;for(const _ of e){const x=_.paint.get(`${n}-pattern`).value;if("constant"!==x.kind){let T=x.evaluate({zoom:s-1},i,{},u.availableImages),M=x.evaluate({zoom:s},i,{},u.availableImages),R=x.evaluate({zoom:s+1},i,{},u.availableImages);T=T&&T.name?T.name:T,M=M&&M.name?M.name:M,R=R&&R.name?R.name:R,f[T]=!0,f[M]=!0,f[R]=!0,i.patterns[_.id]={min:T,mid:M,max:R}}}return i}qd.deviation=function(n,e,i,s){var u=e&&e.length,f=Math.abs(Jd(n,0,u?e[0]*i:n.length,i));if(u)for(var _=0,x=e.length;_<x;_++)f-=Math.abs(Jd(n,e[_]*i,_<x-1?e[_+1]*i:n.length,i));var T=0;for(_=0;_<s.length;_+=3){var M=s[_]*i,R=s[_+1]*i,B=s[_+2]*i;T+=Math.abs((n[M]-n[B])*(n[R+1]-n[M+1])-(n[M]-n[R])*(n[B+1]-n[M+1]))}return 0===f&&0===T?0:Math.abs((T-f)/f)},qd.flatten=function(n){for(var e=n[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,u=0;u<n.length;u++){for(var f=0;f<n[u].length;f++)for(var _=0;_<e;_++)i.vertices.push(n[u][f][_]);u>0&&i.holes.push(s+=n[u-1].length)}return i},Hd.default=lg;class sd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rt,this.indexArray=new ci,this.indexArray2=new Fi,this.programConfigurations=new wc(e.layers,e.zoom),this.segments=new go,this.segments2=new go,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,s,u){this.hasPattern=Xd("fill",this.layers,i);const f=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:T,index:M,sourceLayerIndex:R}of e){const B=this.layers[0]._featureFilter.needGeometry,V=Ec(x,B);if(!this.layers[0]._featureFilter.filter(new Gr(this.zoom),V,s))continue;const te=f?f.evaluate(V,{},s,i.availableImages):void 0,he={id:T,properties:x.properties,type:x.type,sourceLayerIndex:R,index:M,geometry:B?V.geometry:oo(x,s,u),patterns:{},sortKey:te};_.push(he)}f&&_.sort((x,T)=>x.sortKey-T.sortKey);for(const x of _){const{geometry:T,index:M,sourceLayerIndex:R}=x;if(this.hasPattern){const B=od("fill",this.layers,x,this.zoom,i);this.patternFeatures.push(B)}else this.addFeature(x,T,M,s,{},i.availableImages);i.featureIndex.insert(e[M].feature,T,M,R,this.index)}}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}addFeatures(e,i,s,u,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,i,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ag),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,s,u,f,_=[]){for(const x of Yh(i,500)){let T=0;for(const he of x)T+=he.length;const M=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),R=M.vertexLength,B=[],V=[];for(const he of x){if(0===he.length)continue;he!==x[0]&&V.push(B.length/2);const Ce=this.segments2.prepareSegment(he.length,this.layoutVertexArray,this.indexArray2),ze=Ce.vertexLength;this.layoutVertexArray.emplaceBack(he[0].x,he[0].y),this.indexArray2.emplaceBack(ze+he.length-1,ze),B.push(he[0].x),B.push(he[0].y);for(let Ke=1;Ke<he.length;Ke++)this.layoutVertexArray.emplaceBack(he[Ke].x,he[Ke].y),this.indexArray2.emplaceBack(ze+Ke-1,ze+Ke),B.push(he[Ke].x),B.push(he[Ke].y);Ce.vertexLength+=he.length,Ce.primitiveLength+=he.length}const te=Hd(B,V);for(let he=0;he<te.length;he+=3)this.indexArray.emplaceBack(R+te[he],R+te[he+1],R+te[he+2]);M.vertexLength+=T,M.primitiveLength+=te.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,_,u)}}ti(sd,"FillBucket",{omit:["layers","patternFeatures"]});const Q_=new ae({"fill-sort-key":new S(Ut.layout_fill["fill-sort-key"])});var Lf={paint:new ae({"fill-antialias":new I(Ut.paint_fill["fill-antialias"]),"fill-opacity":new S(Ut.paint_fill["fill-opacity"]),"fill-color":new S(Ut.paint_fill["fill-color"]),"fill-outline-color":new S(Ut.paint_fill["fill-outline-color"]),"fill-translate":new I(Ut.paint_fill["fill-translate"]),"fill-translate-anchor":new I(Ut.paint_fill["fill-translate-anchor"]),"fill-pattern":new U(Ut.paint_fill["fill-pattern"])}),layout:Q_};const hg=at([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Rf=at([{name:"a_centroid_pos",components:2,type:"Uint16"}]),pg=at([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:fg}=hg;var Ca=ru;function ru(n,e,i,s,u){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=s,this._values=u,n.readFields(kf,this,e)}function kf(n,e,i){1==n?e.id=i.readVarint():2==n?function(s,u){for(var f=s.readVarint()+s.pos;s.pos<f;){var _=u._keys[s.readVarint()],x=u._values[s.readVarint()];u.properties[_]=x}}(i,e):3==n?e.type=i.readVarint():4==n&&(e._geometry=i.pos)}function mg(n){for(var e,i,s=0,u=0,f=n.length,_=f-1;u<f;_=u++)s+=((i=n[_]).x-(e=n[u]).x)*(e.y+i.y);return s}ru.types=["Unknown","Point","LineString","Polygon"],ru.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,i=n.readVarint()+n.pos,s=1,u=0,f=0,_=0,x=[];n.pos<i;){if(u<=0){var T=n.readVarint();s=7&T,u=T>>3}if(u--,1===s||2===s)f+=n.readSVarint(),_+=n.readSVarint(),1===s&&(e&&x.push(e),e=[]),e.push(new ne(f,_));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&x.push(e),x},ru.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,i=1,s=0,u=0,f=0,_=1/0,x=-1/0,T=1/0,M=-1/0;n.pos<e;){if(s<=0){var R=n.readVarint();i=7&R,s=R>>3}if(s--,1===i||2===i)(u+=n.readSVarint())<_&&(_=u),u>x&&(x=u),(f+=n.readSVarint())<T&&(T=f),f>M&&(M=f);else if(7!==i)throw new Error("unknown command "+i)}return[_,T,x,M]},ru.prototype.toGeoJSON=function(n,e,i){var s,u,f=this.extent*Math.pow(2,i),_=this.extent*n,x=this.extent*e,T=this.loadGeometry(),M=ru.types[this.type];function R(te){for(var he=0;he<te.length;he++){var Ce=te[he];te[he]=[360*(Ce.x+_)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ce.y+x)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(s=0;s<T.length;s++)B[s]=T[s][0];R(T=B);break;case 2:for(s=0;s<T.length;s++)R(T[s]);break;case 3:for(T=function(te){var he=te.length;if(he<=1)return[te];for(var Ce,ze,Ke=[],yt=0;yt<he;yt++){var St=mg(te[yt]);0!==St&&(void 0===ze&&(ze=St<0),ze===St<0?(Ce&&Ke.push(Ce),Ce=[te[yt]]):Ce.push(te[yt]))}return Ce&&Ke.push(Ce),Ke}(T),s=0;s<T.length;s++)for(u=0;u<T[s].length;u++)R(T[s][u])}1===T.length?T=T[0]:M="Multi"+M;var V={type:"Feature",geometry:{type:M,coordinates:T},properties:this.properties};return"id"in this&&(V.id=this.id),V};var Ff=Bf;function Bf(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(gg,this,e),this.length=this._features.length}function gg(n,e,i){15===n?e.version=i.readVarint():1===n?e.name=i.readString():5===n?e.extent=i.readVarint():2===n?e._features.push(i.pos):3===n?e._keys.push(i.readString()):4===n&&e._values.push(function(s){for(var u=null,f=s.readVarint()+s.pos;s.pos<f;){var _=s.readVarint()>>3;u=1===_?s.readString():2===_?s.readFloat():3===_?s.readDouble():4===_?s.readVarint64():5===_?s.readVarint():6===_?s.readSVarint():7===_?s.readBoolean():null}return u}(i))}function zf(n,e,i){if(3===n){var s=new Ff(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}Bf.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new Ca(this._pbf,e,this.extent,this._keys,this._values)};var Sc={VectorTile:function(n,e){this.layers=n.readFields(zf,{},e)},VectorTileFeature:Ca,VectorTileLayer:Ff};function Kd(n,e,i,s){const u=[],f=0===s?(_,x,T,M,R,B)=>{_.push(new ne(B,T+(B-x)/(M-x)*(R-T)))}:(_,x,T,M,R,B)=>{_.push(new ne(x+(B-T)/(R-T)*(M-x),B))};for(const _ of n){const x=[];for(const T of _){if(T.length<=2)continue;const M=[];for(let V=0;V<T.length-1;V++){const te=T[V].x,he=T[V].y,Ce=T[V+1].x,ze=T[V+1].y,Ke=0===s?te:he,yt=0===s?Ce:ze;Ke<e?yt>e&&f(M,te,he,Ce,ze,e):Ke>i?yt<i&&f(M,te,he,Ce,ze,i):M.push(T[V]),yt<e&&Ke>=e&&f(M,te,he,Ce,ze,e),yt>i&&Ke<=i&&f(M,te,he,Ce,ze,i)}let R=T[T.length-1];const B=0===s?R.x:R.y;B>=e&&B<=i&&M.push(R),M.length&&(R=M[M.length-1],M[0].x===R.x&&M[0].y===R.y||M.push(M[0]),x.push(M))}x.length&&u.push(x)}return u}const _g=Sc.VectorTileFeature.types,rr=Math.pow(2,13);function ou(n,e,i,s,u,f,_,x){n.emplaceBack((e<<1)+_,(i<<1)+f,(Math.floor(s*rr)<<1)+u,Math.round(x))}function su(n,e,i){n.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class Jh{constructor(){this.acc=new ne(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ne(e.x,e.y),this.max=new ne(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,u=this.max;e.x<s.x?s.x=e.x:e.x>u.x&&(u.x=e.x),e.y<s.y?s.y=e.y:e.y>u.y&&(u.y=e.y),((0===e.x||e.x===Zi)&&e.x===i.x)!=((0===e.y||e.y===Zi)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,ai(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Zi!=e.x>Zi&&this.addBorderIntersection(1,ai(i.y,e.y,(Zi-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,ai(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Zi!=e.y>Zi&&this.addBorderIntersection(3,ai(i.x,e.x,(Zi-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((i,s)=>i+s.edges,0);return 0!==e?this.acc.div(e)._round():new ne(0,0)}span(){return new ne(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class Kl{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new mt,this.centroidVertexArray=new il,this.indexArray=new ci,this.programConfigurations=new wc(e.layers,e.zoom),this.segments=new go,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,s,u){this.features=[],this.hasPattern=Xd("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const _=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*_/(_*_+1)/Zi/(1<<f.z)}(s);for(const{feature:f,id:_,index:x,sourceLayerIndex:T}of e){const M=this.layers[0]._featureFilter.needGeometry,R=Ec(f,M);if(!this.layers[0]._featureFilter.filter(new Gr(this.zoom),R,s))continue;const B={id:_,sourceLayerIndex:T,index:x,geometry:M?R.geometry:oo(f,s,u),properties:f.properties,type:f.type,patterns:{}},V=this.layoutVertexArray.length;this.hasPattern?this.features.push(od("fill-extrusion",this.layers,B,this.zoom,i)):this.addFeature(B,B.geometry,x,s,{},i.availableImages,u),i.featureIndex.insert(f,B.geometry,x,T,this.index,V)}this.sortBorders()}addFeatures(e,i,s,u,f){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,i,s,u,f)}this.sortBorders()}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fg),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,pg.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Rf.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,u,f,_,x){const T=[new ne(0,0),new ne(Zi,Zi)],M=x.projection,R="globe"===M.name,B=this.enableTerrain&&!R?new Jh:null;R&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Fs);const V=Yh(i,500);for(let Ce=V.length-1;Ce>=0;Ce--){const ze=V[Ce];(0===ze.length||(te=ze[0]).every(Ke=>Ke.x<=0)||te.every(Ke=>Ke.x>=Zi)||te.every(Ke=>Ke.y<=0)||te.every(Ke=>Ke.y>=Zi))&&V.splice(Ce,1)}var te;let he;if(R){const ze=1<<u.z,Ke=da(u.x/ze),yt=da((u.x+1)/ze),St=us(u.y/ze),zt=us((u.y+1)/ze);he=function(Vt,jt,sn,an,In=0,An){const tn=[];if(!Vt.length||!sn||!an)return tn;const vn=(Ni,Gi)=>{for(const gi of Ni)tn.push({polygon:gi,bounds:Gi})},On=Math.ceil(Math.log2(sn)),Gn=Math.ceil(Math.log2(an)),zn=On-Gn,$n=[];for(let Ni=0;Ni<Math.abs(zn);Ni++)$n.push(zn>0?0:1);for(let Ni=0;Ni<Math.min(On,Gn);Ni++)$n.push(0),$n.push(1);let zi=Vt;if(zi=Kd(zi,jt[0].y-In,jt[1].y+In,1),zi=Kd(zi,jt[0].x-In,jt[1].x+In,0),!zi.length)return tn;const tr=[];for($n.length?tr.push({polygons:zi,bounds:jt,depth:0}):vn(zi,jt);tr.length;){const Ni=tr.pop(),Gi=Ni.depth,gi=$n[Gi],ii=Ni.bounds[0],sr=Ni.bounds[1],Sr=0===gi?ii.x:ii.y,_o=0===gi?sr.x:sr.y,Hr=An?An(gi,Sr,_o):.5*(Sr+_o),To=Kd(Ni.polygons,Sr-In,Hr+In,gi),vr=Kd(Ni.polygons,Hr-In,_o+In,gi);if(To.length){const pr=[ii,new ne(0===gi?Hr:sr.x,1===gi?Hr:sr.y)];$n.length>Gi+1?tr.push({polygons:To,bounds:pr,depth:Gi+1}):vn(To,pr)}if(vr.length){const pr=[new ne(0===gi?Hr:ii.x,1===gi?Hr:ii.y),sr];$n.length>Gi+1?tr.push({polygons:vr,bounds:pr,depth:Gi+1}):vn(vr,pr)}}return tn}(V,T,Math.ceil((yt-Ke)/11.25),Math.ceil((St-zt)/11.25),1,(Vt,jt,sn)=>{if(0===Vt)return.5*(jt+sn);{const an=us((u.y+jt/Zi)/ze);return(ju(.5*(us((u.y+sn/Zi)/ze)+an))*ze-u.y)*Zi}})}else{he=[];for(const Ce of V)he.push({polygon:Ce,bounds:T})}for(const Ce of he){const ze=Ce.polygon;let Ke=0,yt=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let sn=0;sn<ze.length;sn++){const an=ze[sn];if(0===an.length)continue;Ke+=an.length;let In=0;B&&B.startRing(an[0]);for(let An=0;An<an.length;An++){const tn=an[An];if(An>=1){const vn=an[An-1];if(!za(tn,vn,Ce.bounds)){B&&B.append(tn,vn),yt.vertexLength+4>go.MAX_VERTEX_ARRAY_LENGTH&&(yt=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const On=tn.sub(vn)._perp(),Gn=On.x/(Math.abs(On.x)+Math.abs(On.y)),zn=On.y>0?1:0,$n=vn.dist(tn);In+$n>32768&&(In=0),ou(this.layoutVertexArray,tn.x,tn.y,Gn,zn,0,0,In),ou(this.layoutVertexArray,tn.x,tn.y,Gn,zn,0,1,In),In+=$n,ou(this.layoutVertexArray,vn.x,vn.y,Gn,zn,0,0,In),ou(this.layoutVertexArray,vn.x,vn.y,Gn,zn,0,1,In);const zi=yt.vertexLength;if(this.indexArray.emplaceBack(zi,zi+2,zi+1),this.indexArray.emplaceBack(zi+1,zi+2,zi+3),yt.vertexLength+=4,yt.primitiveLength+=2,R){const tr=this.layoutVertexExtArray,Ni=M.projectTilePoint(tn.x,tn.y,u),Gi=M.projectTilePoint(vn.x,vn.y,u),gi=M.upVector(u,tn.x,tn.y),ii=M.upVector(u,vn.x,vn.y);su(tr,Ni,gi),su(tr,Ni,gi),su(tr,Gi,ii),su(tr,Gi,ii)}}}}}if(yt.vertexLength+Ke>go.MAX_VERTEX_ARRAY_LENGTH&&(yt=this.segments.prepareSegment(Ke,this.layoutVertexArray,this.indexArray)),"Polygon"!==_g[e.type])continue;const St=[],zt=[],Vt=yt.vertexLength;for(let sn=0;sn<ze.length;sn++){const an=ze[sn];if(0!==an.length){an!==ze[0]&&zt.push(St.length/2);for(let In=0;In<an.length;In++){const An=an[In];ou(this.layoutVertexArray,An.x,An.y,0,0,1,1,0),St.push(An.x),St.push(An.y),B&&B.currentPolyCount.top++,R&&su(this.layoutVertexExtArray,M.projectTilePoint(An.x,An.y,u),M.upVector(u,An.x,An.y))}}}const jt=Hd(St,zt);for(let sn=0;sn<jt.length;sn+=3)this.indexArray.emplaceBack(Vt+jt[sn],Vt+jt[sn+2],Vt+jt[sn+1]);yt.primitiveLength+=jt.length/3,yt.vertexLength+=Ke}if(B&&B.polyCount.length>0){if(B.borders){B.vertexArrayOffset=this.centroidVertexArray.length;const Ce=B.borders,ze=this.featuresOnBorder.push(B)-1;for(let Ke=0;Ke<4;Ke++)Ce[Ke][0]!==Number.MAX_VALUE&&this.borders[Ke].push(ze)}this.encodeCentroid(B.borders?void 0:B.centroid(),B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,_,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,i,s=!0){let u,f;if(e)if(0!==e.y){const x=i.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(x.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else u=Math.ceil(7*(e.x+450)),f=0;else u=0,f=+s;let _=s?this.centroidVertexArray.length:i.vertexArrayOffset;for(const x of i.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let T=0;T<2*x.edges;T++)this.centroidVertexArray.emplace(_++,0,f),this.centroidVertexArray.emplace(_++,u,f);for(let T=0;T<x.top;T++)this.centroidVertexArray.emplace(_++,u,f)}}}function za(n,e,i){return n.x===e.x&&(n.x<i[0].x||n.x>i[1].x)||n.y===e.y&&(n.y<i[0].y||n.y>i[1].y)}ti(Kl,"FillExtrusionBucket",{omit:["layers","features"]}),ti(Jh,"PartMetadata");var Nf={paint:new ae({"fill-extrusion-opacity":new I(Ut["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new S(Ut["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new I(Ut["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new I(Ut["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new U(Ut["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new S(Ut["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new S(Ut["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new I(Ut["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function ad(n,e){return n.x*e.x+n.y*e.y}function Qd(n,e){if(1===n.length){let i=0;const s=e[i++];let u;for(;!u||s.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const f=e[i],_=n[0],x=u.sub(s),T=f.sub(s),M=_.sub(s),R=ad(x,x),B=ad(x,T),V=ad(T,T),te=ad(M,x),he=ad(M,T),Ce=R*V-B*B,ze=(V*te-B*he)/Ce,Ke=(R*he-B*te)/Ce,yt=s.z*(1-ze-Ke)+u.z*ze+f.z*Ke;if(isFinite(yt))return yt}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function ll(n){const e=new ne(n[0],n[1]);return e.z=n[2],e}function Xh(n,e,i,s,u,f,_,x){const T=_*u.getElevationAt(n,e,!0,!0),M=0!==f[0],R=M?0===f[1]?_*(f[0]/7-450):_*function(B,V,te){const he=Math.floor(V[0]/8),Ce=Math.floor(V[1]/8),ze=10*(V[0]-8*he),Ke=10*(V[1]-8*Ce),yt=B.getElevationAt(he,Ce,!0,!0),St=B.getMeterToDEM(te),zt=Math.floor(.5*(ze*St-1)),Vt=Math.floor(.5*(Ke*St-1)),jt=B.tileCoordToPixel(he,Ce),sn=2*zt+1,an=2*Vt+1,In=(tr=sn,Ni=an,[(zn=B).getElevationAtPixel($n=jt.x-zt,zi=jt.y-Vt,!0),zn.getElevationAtPixel($n+Ni,zi,!0),zn.getElevationAtPixel($n,zi+Ni,!0),zn.getElevationAtPixel($n+tr,zi+Ni,!0)]),An=Math.abs(In[0]-In[1]),tn=Math.abs(In[2]-In[3]),vn=Math.abs(In[0]-In[2])+Math.abs(In[1]-In[3]),On=Math.min(.25,.5*St*(An+tn)/sn),Gn=Math.min(.25,.5*St*vn/an);var zn,$n,zi,tr,Ni;return yt+Math.max(On*ze,Gn*Ke)}(u,f,x):T;return{base:T+(0===i)?-1:i,top:M?Math.max(R+s,T+i+2):T+s}}const Uf=at([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Kh}=Uf,ey=at([{name:"a_packed",components:3,type:"Float32"}]),{members:Vf}=ey,ty=Sc.VectorTileFeature.types,eh=Math.cos(Math.PI/180*37.5);class Pc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new nt,this.layoutVertexArray2=new Un,this.indexArray=new ci,this.programConfigurations=new wc(e.layers,e.zoom),this.segments=new go,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,u){this.hasPattern=Xd("line",this.layers,i);const f=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:R,id:B,index:V,sourceLayerIndex:te}of e){const he=this.layers[0]._featureFilter.needGeometry,Ce=Ec(R,he);if(!this.layers[0]._featureFilter.filter(new Gr(this.zoom),Ce,s))continue;const ze=f?f.evaluate(Ce,{},s):void 0,Ke={id:B,properties:R.properties,type:R.type,sourceLayerIndex:te,index:V,geometry:he?Ce.geometry:oo(R,s,u),patterns:{},sortKey:ze};_.push(Ke)}f&&_.sort((R,B)=>R.sortKey-B.sortKey);const{lineAtlas:x,featureIndex:T}=i,M=this.addConstantDashes(x);for(const R of _){const{geometry:B,index:V,sourceLayerIndex:te}=R;if(M&&this.addFeatureDashes(R,x),this.hasPattern){const he=od("line",this.layers,R,this.zoom,i);this.patternFeatures.push(he)}else this.addFeature(R,B,V,s,x.positions,i.availableImages);T.insert(e[V].feature,B,V,te,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==f.kind)i=!0;else{const _=f.value,x=u.value;if(!x)continue;e.addDash(x.from,_),e.addDash(x.to,_),x.other&&e.addDash(x.other,_)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,_=u.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===_.kind)continue;let x,T,M,R,B,V;if("constant"===f.kind){const ze=f.value;if(!ze)continue;x=ze.other||ze.to,T=ze.to,M=ze.from}else x=f.evaluate({zoom:s-1},e),T=f.evaluate({zoom:s},e),M=f.evaluate({zoom:s+1},e);"constant"===_.kind?R=B=V=_.value:(R=_.evaluate({zoom:s-1},e),B=_.evaluate({zoom:s},e),V=_.evaluate({zoom:s+1},e)),i.addDash(x,R),i.addDash(T,B),i.addDash(M,V);const te=i.getKey(x,R),he=i.getKey(T,B),Ce=i.getKey(M,V);e.patterns[u.id]={min:te,mid:he,max:Ce}}}update(e,i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,u)}addFeatures(e,i,s,u,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,i,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Vf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,s,u,f,_){const x=this.layers[0].layout,T=x.get("line-join").evaluate(e,{}),M=x.get("line-cap").evaluate(e,{}),R=x.get("line-miter-limit"),B=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const V of i)this.addLine(V,e,T,M,R,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,_,u)}addLine(e,i,s,u,f,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ke=0;Ke<e.length-1;Ke++)this.totalDistance+=e[Ke].dist(e[Ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===ty[i.type];let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let M=0;for(;M<T-1&&e[M].equals(e[M+1]);)M++;if(T<(x?3:2))return;"bevel"===s&&(f=1.05);const R=this.overscaling<=16?122880/(512*this.overscaling):0,B=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let V,te,he,Ce,ze;this.e1=this.e2=-1,x&&(V=e[T-2],ze=e[M].sub(V)._unit()._perp());for(let Ke=M;Ke<T;Ke++){if(he=Ke===T-1?x?e[M+1]:void 0:e[Ke+1],he&&e[Ke].equals(he))continue;ze&&(Ce=ze),V&&(te=V),V=e[Ke],ze=he?he.sub(V)._unit()._perp():Ce,Ce=Ce||ze;let yt=Ce.add(ze);0===yt.x&&0===yt.y||yt._unit();const St=Ce.x*ze.x+Ce.y*ze.y,zt=yt.x*ze.x+yt.y*ze.y,Vt=0!==zt?1/zt:1/0,jt=2*Math.sqrt(2-2*zt),sn=zt<eh&&te&&he,an=Ce.x*ze.y-Ce.y*ze.x>0;if(sn&&Ke>M){const tn=V.dist(te);if(tn>2*R){const vn=V.sub(V.sub(te)._mult(R/tn)._round());this.updateDistance(te,vn),this.addCurrentVertex(vn,Ce,0,0,B),te=vn}}const In=te&&he;let An=In?s:x?"butt":u;if(In&&"round"===An&&(Vt<_?An="miter":Vt<=2&&(An="fakeround")),"miter"===An&&Vt>f&&(An="bevel"),"bevel"===An&&(Vt>2&&(An="flipbevel"),Vt<f&&(An="miter")),te&&this.updateDistance(te,V),"miter"===An)yt._mult(Vt),this.addCurrentVertex(V,yt,0,0,B);else if("flipbevel"===An){if(Vt>100)yt=ze.mult(-1);else{const tn=Vt*Ce.add(ze).mag()/Ce.sub(ze).mag();yt._perp()._mult(tn*(an?-1:1))}this.addCurrentVertex(V,yt,0,0,B),this.addCurrentVertex(V,yt.mult(-1),0,0,B)}else if("bevel"===An||"fakeround"===An){const tn=-Math.sqrt(Vt*Vt-1),vn=an?tn:0,On=an?0:tn;if(te&&this.addCurrentVertex(V,Ce,vn,On,B),"fakeround"===An){const Gn=Math.round(180*jt/Math.PI/20);for(let zn=1;zn<Gn;zn++){let $n=zn/Gn;if(.5!==$n){const tr=$n-.5;$n+=$n*tr*($n-1)*((1.0904+St*(St*(3.55645-1.43519*St)-3.2452))*tr*tr+(.848013+St*(.215638*St-1.06021)))}const zi=ze.sub(Ce)._mult($n)._add(Ce)._unit()._mult(an?-1:1);this.addHalfVertex(V,zi.x,zi.y,!1,an,0,B)}}he&&this.addCurrentVertex(V,ze,-vn,-On,B)}else if("butt"===An)this.addCurrentVertex(V,yt,0,0,B);else if("square"===An){const tn=te?1:-1;te||this.addCurrentVertex(V,yt,tn,tn,B),this.addCurrentVertex(V,yt,0,0,B),te&&this.addCurrentVertex(V,yt,tn,tn,B)}else"round"===An&&(te&&(this.addCurrentVertex(V,Ce,0,0,B),this.addCurrentVertex(V,Ce,1,1,B,!0)),he&&(this.addCurrentVertex(V,ze,-1,-1,B,!0),this.addCurrentVertex(V,ze,0,0,B)));if(sn&&Ke<T-1){const tn=V.dist(he);if(tn>2*R){const vn=V.add(he.sub(V)._mult(R/tn)._round());this.updateDistance(V,vn),this.addCurrentVertex(vn,ze,0,0,B),V=vn}}}}addCurrentVertex(e,i,s,u,f,_=!1){const x=i.y*u-i.x,T=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*s,i.y-i.x*s,_,!1,s,f),this.addHalfVertex(e,x,T,_,!0,-u,f)}addHalfVertex({x:e,y:i},s,u,f,_,x,T){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const M=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),T.primitiveLength++),_?this.e2=M:this.e1=M}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}ti(Pc,"LineBucket",{omit:["layers","patternFeatures"]});const Qh=new ae({"line-cap":new S(Ut.layout_line["line-cap"]),"line-join":new S(Ut.layout_line["line-join"]),"line-miter-limit":new I(Ut.layout_line["line-miter-limit"]),"line-round-limit":new I(Ut.layout_line["line-round-limit"]),"line-sort-key":new S(Ut.layout_line["line-sort-key"])});var th={paint:new ae({"line-opacity":new S(Ut.paint_line["line-opacity"]),"line-color":new S(Ut.paint_line["line-color"]),"line-translate":new I(Ut.paint_line["line-translate"]),"line-translate-anchor":new I(Ut.paint_line["line-translate-anchor"]),"line-width":new S(Ut.paint_line["line-width"]),"line-gap-width":new S(Ut.paint_line["line-gap-width"]),"line-offset":new S(Ut.paint_line["line-offset"]),"line-blur":new S(Ut.paint_line["line-blur"]),"line-dasharray":new U(Ut.paint_line["line-dasharray"]),"line-pattern":new U(Ut.paint_line["line-pattern"]),"line-gradient":new J(Ut.paint_line["line-gradient"])}),layout:Qh};const nh=new class extends S{possiblyEvaluate(n,e){return e=new Gr(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,i,s){return e=Ze({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,i,s)}}(th.paint.properties["line-width"].specification);function yg(n,e){return e>0?e+2*n:n}nh.useIntegerZoom=!0;const vg=at([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),xg=at([{name:"a_projected_pos",components:3,type:"Float32"}],4);at([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const bg=at([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),wg=at([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);at([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ep=at([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ny=at([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);at([{name:"triangle",components:3,type:"Uint16"}]),at([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),at([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),at([{type:"Float32",name:"offsetX"}]),at([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Dl=128;function ih(n,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Gr(n+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:u}=i;let f=0;for(;f<s.length&&s[f]<=n;)f++;f=Math.max(0,f-1);let _=f;for(;_<s.length&&s[_]<n+1;)_++;_=Math.min(s.length-1,_);const x=s[f],T=s[_];return"composite"===i.kind?{kind:"composite",minZoom:x,maxZoom:T,interpolationType:u}:{kind:"camera",minZoom:x,maxZoom:T,minSize:i.evaluate(new Gr(x)),maxSize:i.evaluate(new Gr(T)),interpolationType:u}}}function ld(n,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:u}){return"source"===n.kind?s/Dl:"composite"===n.kind?ai(s/Dl,u/Dl,i):e}function au(n,e){let i=0,s=0;if("constant"===n.kind)s=n.layoutSize;else if("source"!==n.kind){const{interpolationType:u,minZoom:f,maxZoom:_}=n,x=u?He(xr.interpolationFactor(u,e,f,_),0,1):0;"camera"===n.kind?s=ai(n.minSize,n.maxSize,x):i=x}return{uSizeT:i,uSize:s}}var tp=Object.freeze({__proto__:null,getSizeData:ih,evaluateSizeForFeature:ld,evaluateSizeForZoom:au,SIZE_PACK_FACTOR:Dl});function iy(n,e,i){return n.sections.forEach(s=>{s.text=function(u,f,_){const x=f.layout.get("text-transform").evaluate(_,{});return"uppercase"===x?u=u.toLocaleUpperCase():"lowercase"===x&&(u=u.toLocaleLowerCase()),cs.applyArabicShaping&&(u=cs.applyArabicShaping(u)),u}(s.text,e,i)}),n}const rh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function ry(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function oy(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}var Cg=function(n,e,i,s,u){var f,_,x=8*u-s-1,T=(1<<x)-1,M=T>>1,R=-7,B=i?u-1:0,V=i?-1:1,te=n[e+B];for(B+=V,f=te&(1<<-R)-1,te>>=-R,R+=x;R>0;f=256*f+n[e+B],B+=V,R-=8);for(_=f&(1<<-R)-1,f>>=-R,R+=s;R>0;_=256*_+n[e+B],B+=V,R-=8);if(0===f)f=1-M;else{if(f===T)return _?NaN:1/0*(te?-1:1);_+=Math.pow(2,s),f-=M}return(te?-1:1)*_*Math.pow(2,f-s)},Tg=function(n,e,i,s,u,f){var _,x,T,M=8*f-u-1,R=(1<<M)-1,B=R>>1,V=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,te=s?0:f-1,he=s?1:-1,Ce=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,_=R):(_=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-_))<1&&(_--,T*=2),(e+=_+B>=1?V/T:V*Math.pow(2,1-B))*T>=2&&(_++,T/=2),_+B>=R?(x=0,_=R):_+B>=1?(x=(e*T-1)*Math.pow(2,u),_+=B):(x=e*Math.pow(2,B-1)*Math.pow(2,u),_=0));u>=8;n[i+te]=255&x,te+=he,x/=256,u-=8);for(_=_<<u|x,M+=u;M>0;n[i+te]=255&_,te+=he,_/=256,M-=8);n[i+te-he]|=128*Ce},oh=Yr;function Yr(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Yr.Varint=0,Yr.Fixed64=1,Yr.Bytes=2,Yr.Fixed32=5;var $f=4294967296,Eg=1/$f,Il=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Na(n){return n.type===Yr.Bytes?n.readVarint()+n.pos:n.pos+1}function np(n,e,i){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(var u=i.pos-1;u>=n;u--)i.buf[u+s]=i.buf[u]}function ip(n,e){for(var i=0;i<n.length;i++)e.writeVarint(n[i])}function jf(n,e){for(var i=0;i<n.length;i++)e.writeSVarint(n[i])}function rp(n,e){for(var i=0;i<n.length;i++)e.writeFloat(n[i])}function Dg(n,e){for(var i=0;i<n.length;i++)e.writeDouble(n[i])}function Ql(n,e){for(var i=0;i<n.length;i++)e.writeBoolean(n[i])}function Zf(n,e){for(var i=0;i<n.length;i++)e.writeFixed32(n[i])}function Ig(n,e){for(var i=0;i<n.length;i++)e.writeSFixed32(n[i])}function op(n,e){for(var i=0;i<n.length;i++)e.writeFixed64(n[i])}function Mg(n,e){for(var i=0;i<n.length;i++)e.writeSFixed64(n[i])}function cd(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function cu(n,e,i){n[i]=e,n[i+1]=e>>>8,n[i+2]=e>>>16,n[i+3]=e>>>24}function Gf(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function ud(n,e,i){e.glyphs=[],1===n&&i.readMessage(uu,e)}function uu(n,e,i){if(3===n){const{id:s,bitmap:u,width:f,height:_,left:x,top:T,advance:M}=i.readMessage(sp,{});e.glyphs.push({id:s,bitmap:new ta({width:f+6,height:_+6},u),metrics:{width:f,height:_,left:x,top:T,advance:M}})}else 4===n?e.ascender=i.readSVarint():5===n&&(e.descender=i.readSVarint())}function sp(n,e,i){1===n?e.id=i.readVarint():2===n?e.bitmap=i.readBytes():3===n?e.width=i.readVarint():4===n?e.height=i.readVarint():5===n?e.left=i.readSVarint():6===n?e.top=i.readSVarint():7===n&&(e.advance=i.readVarint())}function ec(n){let e=0,i=0;for(const _ of n)e+=_.w*_.h,i=Math.max(i,_.w);n.sort((_,x)=>x.h-_.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,f=0;for(const _ of n)for(let x=s.length-1;x>=0;x--){const T=s[x];if(!(_.w>T.w||_.h>T.h)){if(_.x=T.x,_.y=T.y,f=Math.max(f,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===T.w&&_.h===T.h){const M=s.pop();x<s.length&&(s[x]=M)}else _.h===T.h?(T.x+=_.w,T.w-=_.w):_.w===T.w?(T.y+=_.h,T.h-=_.h):(s.push({x:T.x+_.w,y:T.y,w:T.w-_.w,h:_.h}),T.y+=_.h,T.h-=_.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}Yr.prototype={destroy:function(){this.buf=null},readFields:function(n,e,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),u=s>>3,f=this.pos;this.type=7&s,n(u,e,this),this.pos===f&&this.skip(s)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=cd(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Gf(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=cd(this.buf,this.pos)+cd(this.buf,this.pos+4)*$f;return this.pos+=8,n},readSFixed64:function(){var n=cd(this.buf,this.pos)+Gf(this.buf,this.pos+4)*$f;return this.pos+=8,n},readFloat:function(){var n=Cg(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Cg(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,i,s=this.buf;return e=127&(i=s[this.pos++]),i<128?e:(e|=(127&(i=s[this.pos++]))<<7,i<128?e:(e|=(127&(i=s[this.pos++]))<<14,i<128?e:(e|=(127&(i=s[this.pos++]))<<21,i<128?e:function(u,f,_){var x,T,M=_.buf;if(x=(112&(T=M[_.pos++]))>>4,T<128||(x|=(127&(T=M[_.pos++]))<<3,T<128)||(x|=(127&(T=M[_.pos++]))<<10,T<128)||(x|=(127&(T=M[_.pos++]))<<17,T<128)||(x|=(127&(T=M[_.pos++]))<<24,T<128)||(x|=(1&(T=M[_.pos++]))<<31,T<128))return function lu(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}(u,x,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=s[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&Il?Il.decode(this.buf.subarray(e,n)):function(i,s,u){for(var f="",_=s;_<u;){var x,T,M,R=i[_],B=null,V=R>239?4:R>223?3:R>191?2:1;if(_+V>u)break;1===V?R<128&&(B=R):2===V?128==(192&(x=i[_+1]))&&(B=(31&R)<<6|63&x)<=127&&(B=null):3===V?(T=i[_+2],128==(192&(x=i[_+1]))&&128==(192&T)&&((B=(15&R)<<12|(63&x)<<6|63&T)<=2047||B>=55296&&B<=57343)&&(B=null)):4===V&&(T=i[_+2],M=i[_+3],128==(192&(x=i[_+1]))&&128==(192&T)&&128==(192&M)&&((B=(15&R)<<18|(63&x)<<12|(63&T)<<6|63&M)<=65535||B>=1114112)&&(B=null)),null===B?(B=65533,V=1):B>65535&&(B-=65536,f+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),f+=String.fromCharCode(B),_+=V}return f}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==Yr.Bytes)return n.push(this.readVarint(e));var i=Na(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==Yr.Bytes)return n.push(this.readSVarint());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Yr.Bytes)return n.push(this.readBoolean());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Yr.Bytes)return n.push(this.readFloat());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Yr.Bytes)return n.push(this.readDouble());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Yr.Bytes)return n.push(this.readFixed32());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Yr.Bytes)return n.push(this.readSFixed32());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Yr.Bytes)return n.push(this.readFixed64());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Yr.Bytes)return n.push(this.readSFixed64());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===Yr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Yr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Yr.Fixed32)this.pos+=4;else{if(e!==Yr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),cu(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),cu(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),cu(this.buf,-1&n,this.pos),cu(this.buf,Math.floor(n*Eg),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),cu(this.buf,-1&n,this.pos),cu(this.buf,Math.floor(n*Eg),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,i){var s,u,f,x;if(e>=0?(s=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),f=s,(x=i).buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,x.buf[x.pos]=127&(f>>>=7),function(f,_){var x=(7&f)<<4;_.buf[_.pos++]|=x|((f>>>=3)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f)))))}(u,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(s,u,f){for(var _,x,T=0;T<u.length;T++){if((_=u.charCodeAt(T))>55295&&_<57344){if(!x){_>56319||T+1===u.length?(s[f++]=239,s[f++]=191,s[f++]=189):x=_;continue}if(_<56320){s[f++]=239,s[f++]=191,s[f++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(s[f++]=239,s[f++]=191,s[f++]=189,x=null);_<128?s[f++]=_:(_<2048?s[f++]=_>>6|192:(_<65536?s[f++]=_>>12|224:(s[f++]=_>>18|240,s[f++]=_>>12&63|128),s[f++]=_>>6&63|128),s[f++]=63&_|128)}return f}(this.buf,n,this.pos);var i=this.pos-e;i>=128&&np(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),Tg(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Tg(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,e){this.pos++;var i=this.pos;n(e,this);var s=this.pos-i;s>=128&&np(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(n,e,i){this.writeTag(n,Yr.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,ip,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,jf,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,Ql,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,rp,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,Dg,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,Zf,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,Ig,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,op,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,Mg,e)},writeBytesField:function(n,e){this.writeTag(n,Yr.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,Yr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,Yr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,Yr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,Yr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,Yr.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,Yr.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,Yr.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,Yr.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,Yr.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,Boolean(e))}};class Oc{constructor(e,{pixelRatio:i,version:s,stretchX:u,stretchY:f,content:_}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=f,this.content=_,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Lc{constructor(e,i){const s={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,s,f),this.addImages(i,u,f);const{w:_,h:x}=ec(f),T=new Ps({width:_||1,height:x||1});for(const M in e){const R=e[M],B=s[M].paddedRect;Ps.copy(R.data,T,{x:0,y:0},{x:B.x+1,y:B.y+1},R.data)}for(const M in i){const R=i[M],B=u[M].paddedRect,V=B.x+1,te=B.y+1,he=R.data.width,Ce=R.data.height;Ps.copy(R.data,T,{x:0,y:0},{x:V,y:te},R.data),Ps.copy(R.data,T,{x:0,y:Ce-1},{x:V,y:te-1},{width:he,height:1}),Ps.copy(R.data,T,{x:0,y:0},{x:V,y:te+Ce},{width:he,height:1}),Ps.copy(R.data,T,{x:he-1,y:0},{x:V-1,y:te},{width:1,height:Ce}),Ps.copy(R.data,T,{x:0,y:0},{x:V+he,y:te},{width:1,height:Ce})}this.image=T,this.iconPositions=s,this.patternPositions=u}addImages(e,i,s){for(const u in e){const f=e[u],_={x:0,y:0,w:f.data.width+2,h:f.data.height+2};s.push(_),i[u]=new Oc(_,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),i),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),i)}patchUpdatedImage(e,i,s){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,f]=e.tl;s.update(i.data,void 0,{x:u,y:f})}}ti(Oc,"ImagePosition"),ti(Lc,"ImageAtlas");const ha={horizontal:1,vertical:2,horizontalOnly:3};class du{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const s=new du;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new du;return i.imageName=e,i}}class Rc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const s=new Rc;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?s.addImageSection(f):s.addTextSection(f,i)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,s){let u="";for(let f=0;f<i.length;f++){const _=i.charCodeAt(f+1)||null,x=i.charCodeAt(f-1)||null;u+=!s&&(_&&Lu(_)&&!rh[i[f+1]]||x&&Lu(x)&&!rh[i[f-1]])||!rh[i[f]]?i[f]:rh[i[f]]}return u}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&hu[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&hu[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new Rc;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(du.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e){const i=e.image?e.image.name:"";if(0===i.length)return void Nt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(du.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Nt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function dd(n,e,i,s,u,f,_,x,T,M,R,B,V,te,he,Ce){const ze=Rc.fromFeature(n,u);let Ke;B===ha.vertical&&ze.verticalizePunctuation(V);const{processBidirectionalText:yt,processStyledBidirectionalText:St}=cs;if(yt&&1===ze.sections.length){Ke=[];const jt=yt(ze.toString(),sh(ze,M,f,e,s,te,he));for(const sn of jt){const an=new Rc;an.text=sn,an.sections=ze.sections;for(let In=0;In<sn.length;In++)an.sectionIndex.push(0);Ke.push(an)}}else if(St){Ke=[];const jt=St(ze.text,ze.sectionIndex,sh(ze,M,f,e,s,te,he));for(const sn of jt){const an=new Rc;an.text=sn[0],an.sectionIndex=sn[1],an.sections=ze.sections,Ke.push(an)}}else Ke=function(jt,sn){const an=[],In=jt.text;let An=0;for(const tn of sn)an.push(jt.substring(An,tn)),An=tn;return An<In.length&&an.push(jt.substring(An,In.length)),an}(ze,sh(ze,M,f,e,s,te,he));const zt=[],Vt={positionedLines:zt,text:ze.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:B,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(jt,sn,an,In,An,tn,vn,On,Gn,zn,$n,zi){let tr=0,Ni=0,Gi=0;const gi="right"===On?1:"left"===On?0:.5;let ii=!1;for(const vr of An){const pr=vr.getSections();for(const Pr of pr){if(Pr.imageName)continue;const io=sn[Pr.fontStack];if(io&&(ii=void 0!==io.ascender&&void 0!==io.descender,!ii))break}if(!ii)break}let sr=0;for(const vr of An){vr.trim();const pr=vr.getMaxScale(),Pr=24*(pr-1),io={positionedGlyphs:[],lineOffset:0};jt.positionedLines[sr]=io;const uo=io.positionedGlyphs;let Uo=0;if(!vr.length()){Ni+=tn,++sr;continue}let Ho=0,xs=0;for(let Fr=0;Fr<vr.length();Fr++){const bs=vr.getSection(Fr),Os=vr.getSectionIndex(Fr),qo=vr.getCharCode(Fr);let Vo=bs.scale,Jr=null,qr=null,$s=null,ws=24,Eo=0;const ps=!(Gn===ha.horizontal||!$n&&!Ou(qo)||$n&&(hu[qo]||(Sr=qo,O(Sr)||P(Sr)||G(Sr)||tl(Sr)||Su(Sr))));if(bs.imageName){const fs=In[bs.imageName];if(!fs)continue;$s=bs.imageName,jt.iconsInText=jt.iconsInText||!0,qr=fs.paddedRect;const Wo=fs.displaySize;Vo=24*Vo/zi,Jr={width:Wo[0],height:Wo[1],left:1,top:-3,advance:ps?Wo[1]:Wo[0],localGlyph:!1},Eo=ii?-Jr.height*Vo:24*pr-17-Wo[1]*Vo,ws=Jr.advance;const fa=(ps?Wo[0]:Wo[1])*Vo-24*pr;fa>0&&fa>Uo&&(Uo=fa)}else{const fs=an[bs.fontStack];if(!fs)continue;fs[qo]&&(qr=fs[qo]);const Wo=sn[bs.fontStack];if(!Wo)continue;const fa=Wo.glyphs[qo];if(!fa)continue;if(Jr=fa.metrics,ws=8203!==qo?24:0,ii){const Ll=void 0!==Wo.ascender?Math.abs(Wo.ascender):0,$c=void 0!==Wo.descender?Math.abs(Wo.descender):0,jc=(Ll+$c)*Vo;Ho<jc&&(Ho=jc,xs=(Ll-$c)/2*Vo),Eo=-Ll*Vo}else Eo=24*(pr-Vo)-17}ps?(jt.verticalizable=!0,uo.push({glyph:qo,imageName:$s,x:tr,y:Ni+Eo,vertical:ps,scale:Vo,localGlyph:Jr.localGlyph,fontStack:bs.fontStack,sectionIndex:Os,metrics:Jr,rect:qr}),tr+=ws*Vo+zn):(uo.push({glyph:qo,imageName:$s,x:tr,y:Ni+Eo,vertical:ps,scale:Vo,localGlyph:Jr.localGlyph,fontStack:bs.fontStack,sectionIndex:Os,metrics:Jr,rect:qr}),tr+=Jr.advance*Vo+zn)}0!==uo.length&&(Gi=Math.max(tr-zn,Gi),ii?cp(uo,gi,Uo,xs,tn*pr/2):cp(uo,gi,Uo,0,tn/2)),tr=0;const hs=tn*pr+Uo;io.lineOffset=Math.max(Uo,Pr),Ni+=hs,++sr}var Sr;const _o=Ni,{horizontalAlign:Hr,verticalAlign:To}=lp(vn);(function(vr,pr,Pr,io,uo,Uo){const Ho=(pr-Pr)*uo,xs=-Uo*io;for(const hs of vr)for(const Fr of hs.positionedGlyphs)Fr.x+=Ho,Fr.y+=xs})(jt.positionedLines,gi,Hr,To,Gi,_o),jt.top+=-To*_o,jt.bottom=jt.top+_o,jt.left+=-Hr*Gi,jt.right=jt.left+Gi,jt.hasBaseline=ii}(Vt,e,i,s,Ke,_,x,T,B,M,V,Ce),!function(jt){for(const sn of jt)if(0!==sn.positionedGlyphs.length)return!1;return!0}(zt)&&Vt}const hu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Hf={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hd(n,e,i,s,u,f){if(e.imageName){const _=s[e.imageName];return _?_.displaySize[0]*e.scale*24/f+u:0}{const _=i[e.fontStack],x=_&&_.glyphs[n];return x?x.metrics.advance*e.scale+u:0}}function qf(n,e,i,s){const u=Math.pow(n-e,2);return s?n<e?u/2:2*u:u+Math.abs(i)*i}function Wf(n,e,i){let s=0;return 10===n&&(s-=1e4),i&&(s+=150),40!==n&&65288!==n||(s+=50),41!==e&&65289!==e||(s+=50),s}function Ag(n,e,i,s,u,f){let _=null,x=qf(e,i,u,f);for(const T of s){const M=qf(e-T.x,i,u,f)+T.badness;M<=x&&(_=T,x=M)}return{index:n,x:e,priorBreak:_,badness:x}}function ap(n){return n?ap(n.priorBreak).concat(n.index):[]}function sh(n,e,i,s,u,f,_){if("point"!==f)return[];if(!n)return[];const x=[],T=function(V,te,he,Ce,ze,Ke){let yt=0;for(let St=0;St<V.length();St++){const zt=V.getSection(St);yt+=hd(V.getCharCode(St),zt,Ce,ze,te,Ke)}return yt/Math.max(1,Math.ceil(yt/he))}(n,e,i,s,u,_),M=n.text.indexOf("\u200b")>=0;let R=0;for(let V=0;V<n.length();V++){const te=n.getSection(V),he=n.getCharCode(V);if(hu[he]||(R+=hd(he,te,s,u,e,_)),V<n.length()-1){const Ce=!((B=he)<11904||!(Mi(B)||or(B)||nl(B)||ba(B)||Oa(B)||oe(B)||Tr(B)||Mt(B)||ca(B)||vl(B)||Pa(B)||Pu(B)||cn(B)||ft(B)||Se(B)||Ur(B)||ni(B)||Au(B)||Gl(B)||xa(B)));(Hf[he]||Ce||te.imageName)&&x.push(Ag(V+1,R,T,x,Wf(he,n.getCharCode(V+1),Ce&&M),!1))}}var B;return ap(Ag(n.length(),R,T,x,0,!0))}function lp(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function cp(n,e,i,s,u){if(!(e||i||s||u))return;const f=n.length-1,_=n[f],x=(_.x+_.metrics.advance*_.scale)*e;for(let T=0;T<=f;T++)n[T].x-=x,n[T].y+=i+s+u}function Sg(n,e,i){const{horizontalAlign:s,verticalAlign:u}=lp(i),f=e[0]-n.displaySize[0]*s,_=e[1]-n.displaySize[1]*u;return{image:n,top:_,bottom:_+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function Yf(n,e,i,s,u,f){const _=n.image;let x;if(_.content){const ze=_.content,Ke=_.pixelRatio||1;x=[ze[0]/Ke,ze[1]/Ke,_.displaySize[0]-ze[2]/Ke,_.displaySize[1]-ze[3]/Ke]}const T=e.left*f,M=e.right*f;let R,B,V,te;"width"===i||"both"===i?(te=u[0]+T-s[3],B=u[0]+M+s[1]):(te=u[0]+(T+M-_.displaySize[0])/2,B=te+_.displaySize[0]);const he=e.top*f,Ce=e.bottom*f;return"height"===i||"both"===i?(R=u[1]+he-s[0],V=u[1]+Ce+s[2]):(R=u[1]+(he+Ce-_.displaySize[1])/2,V=R+_.displaySize[1]),{image:_,top:R,right:B,bottom:V,left:te,collisionPadding:x}}class No extends ne{constructor(e,i,s,u,f){super(e,i),this.angle=u,this.z=s,void 0!==f&&(this.segment=f)}clone(){return new No(this.x,this.y,this.z,this.angle,this.segment)}}function Jf(n,e,i,s,u){if(void 0===e.segment)return!0;let f=e,_=e.segment+1,x=0;for(;x>-i/2;){if(_--,_<0)return!1;x-=n[_].dist(f),f=n[_]}x+=n[_].dist(n[_+1]),_++;const T=[];let M=0;for(;x<i/2;){const R=n[_],B=n[_+1];if(!B)return!1;let V=n[_-1].angleTo(R)-R.angleTo(B);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:x,angleDelta:V}),M+=V;x-T[0].distance>s;)M-=T.shift().angleDelta;if(M>u)return!1;_++,x+=R.dist(B)}return!0}function Xf(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function Pg(n,e,i){return n?.6*e*i:0}function Og(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function Kf(n,e,i,s,u,f){const _=Pg(i,u,f),x=Og(i,s)*f;let T=0;const M=Xf(n)/2;for(let R=0;R<n.length-1;R++){const B=n[R],V=n[R+1],te=B.dist(V);if(T+te>M){const he=(M-T)/te,Ce=ai(B.x,V.x,he),ze=ai(B.y,V.y,he),Ke=new No(Ce,ze,0,V.angleTo(B),R);return!_||Jf(n,Ke,x,_,e)?Ke:void 0}T+=te}}function sy(n,e,i,s,u,f,_,x,T){const M=Pg(s,f,_),R=Og(s,u),B=R*_,V=0===n[0].x||n[0].x===T||0===n[0].y||n[0].y===T;return e-B<e/4&&(e=B+e/4),Qf(n,V?e/2*x%e:(R/2+2*f)*_*x%e,e,M,i,B,V,!1,T)}function Qf(n,e,i,s,u,f,_,x,T){const M=f/2,R=Xf(n);let B=0,V=e-i,te=[];for(let he=0;he<n.length-1;he++){const Ce=n[he],ze=n[he+1],Ke=Ce.dist(ze),yt=ze.angleTo(Ce);for(;V+i<B+Ke;){V+=i;const St=(V-B)/Ke,zt=ai(Ce.x,ze.x,St),Vt=ai(Ce.y,ze.y,St);if(zt>=0&&zt<T&&Vt>=0&&Vt<T&&V-M>=0&&V+M<=R){const jt=new No(zt,Vt,0,yt,he);jt._round(),s&&!Jf(n,jt,f,s,u)||te.push(jt)}}B+=Ke}return x||te.length||_||(te=Qf(n,B/2,i,s,u,f,_,!0,T)),te}function ah(n,e,i,s,u){const f=[];for(let _=0;_<n.length;_++){const x=n[_];let T;for(let M=0;M<x.length-1;M++){let R=x[M],B=x[M+1];R.x<e&&B.x<e||(R.x<e?R=new ne(e,R.y+(e-R.x)/(B.x-R.x)*(B.y-R.y))._round():B.x<e&&(B=new ne(e,R.y+(e-R.x)/(B.x-R.x)*(B.y-R.y))._round()),R.y<i&&B.y<i||(R.y<i?R=new ne(R.x+(i-R.y)/(B.y-R.y)*(B.x-R.x),i)._round():B.y<i&&(B=new ne(R.x+(i-R.y)/(B.y-R.y)*(B.x-R.x),i)._round()),R.x>=s&&B.x>=s||(R.x>=s?R=new ne(s,R.y+(s-R.x)/(B.x-R.x)*(B.y-R.y))._round():B.x>=s&&(B=new ne(s,R.y+(s-R.x)/(B.x-R.x)*(B.y-R.y))._round()),R.y>=u&&B.y>=u||(R.y>=u?R=new ne(R.x+(u-R.y)/(B.y-R.y)*(B.x-R.x),u)._round():B.y>=u&&(B=new ne(R.x+(u-R.y)/(B.y-R.y)*(B.x-R.x),u)._round()),T&&R.equals(T[T.length-1])||(T=[R],f.push(T)),T.push(B)))))}}return f}ti(No,"Anchor");const pu=1e20;function em(n,e,i,s,u,f,_,x,T){for(let M=e;M<e+s;M++)tm(n,i*f+M,f,u,_,x,T);for(let M=i;M<i+u;M++)tm(n,M*f+e,1,s,_,x,T)}function tm(n,e,i,s,u,f,_){f[0]=0,_[0]=-pu,_[1]=pu,u[0]=n[e];for(let x=1,T=0,M=0;x<s;x++){u[x]=n[e+x*i];const R=x*x;do{const B=f[T];M=(u[x]-u[B]+R-B*B)/(x-B)/2}while(M<=_[T]&&--T>-1);T++,f[T]=x,_[T]=M,_[T+1]=pu}for(let x=0,T=0;x<s;x++){for(;_[T+1]<x;)T++;const M=f[T],R=x-M;n[e+x*i]=u[M]+R*R}}const up={none:0,ideographs:1,all:2};class kc{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const s=[];for(const u in e)for(const f of e[u])s.push({stack:u,id:f});ve(s,({stack:u,id:f},_)=>{let x=this.entries[u];x||(x=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=x.glyphs[f];if(void 0!==T)return void _(null,{stack:u,id:f,glyph:T});if(T=this._tinySDF(x,u,f),T)return x.glyphs[f]=T,void _(null,{stack:u,id:f,glyph:T});const M=Math.floor(f/256);if(256*M>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[M])return void _(null,{stack:u,id:f,glyph:T});let R=x.requests[M];R||(R=x.requests[M]=[],kc.loadGlyphRange(u,M,this.url,this.requestManager,(B,V)=>{if(V){x.ascender=V.ascender,x.descender=V.descender;for(const te in V.glyphs)this._doesCharSupportLocalGlyph(+te)||(x.glyphs[+te]=V.glyphs[+te]);x.ranges[M]=!0}for(const te of R)te(B,V);delete x.requests[M]})),R.push((B,V)=>{B?_(B):V&&_(null,{stack:u,id:f,glyph:V.glyphs[f]||null})})},(u,f)=>{if(u)i(u);else if(f){const _={};for(const{stack:x,id:T,glyph:M}of f)void 0===_[x]&&(_[x]={}),void 0===_[x].glyphs&&(_[x].glyphs={}),_[x].glyphs[T]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;i(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==up.none&&(this.localGlyphMode===up.all?!!this.localFontFamily:!!this.localFontFamily&&(vl(e)||xl(e)||cn(e)||ni(e)||Mt(e)))}_tinySDF(e,i,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let f=e.tinySDF;if(!f){let Ce="400";/bold/i.test(i)?Ce="900":/medium/i.test(i)?Ce="500":/light/i.test(i)&&(Ce="200"),f=e.tinySDF=new kc.TinySDF({fontFamily:u,fontWeight:Ce,fontSize:48,buffer:6,radius:16}),f.fontWeight=Ce}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const _=String.fromCharCode(s),{data:x,width:T,height:M,glyphWidth:R,glyphHeight:B,glyphLeft:V,glyphTop:te,glyphAdvance:he}=f.draw(_);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new ta({width:T,height:M},x),metrics:{width:R/2,height:B/2,left:V/2,top:te/2-27,advance:he/2,localGlyph:!0}}}}function nm(n,e,i,s){const u=[],f=n.image,_=f.pixelRatio,x=f.paddedRect.w-2,T=f.paddedRect.h-2,M=n.right-n.left,R=n.bottom-n.top,B=f.stretchX||[[0,x]],V=f.stretchY||[[0,T]],te=(tn,vn)=>tn+vn[1]-vn[0],he=B.reduce(te,0),Ce=V.reduce(te,0),ze=x-he,Ke=T-Ce;let yt=0,St=he,zt=0,Vt=Ce,jt=0,sn=ze,an=0,In=Ke;if(f.content&&s){const tn=f.content;yt=pd(B,0,tn[0]),zt=pd(V,0,tn[1]),St=pd(B,tn[0],tn[2]),Vt=pd(V,tn[1],tn[3]),jt=tn[0]-yt,an=tn[1]-zt,sn=tn[2]-tn[0]-St,In=tn[3]-tn[1]-Vt}const An=(tn,vn,On,Gn)=>{const zn=lh(tn.stretch-yt,St,M,n.left),$n=fd(tn.fixed-jt,sn,tn.stretch,he),zi=lh(vn.stretch-zt,Vt,R,n.top),tr=fd(vn.fixed-an,In,vn.stretch,Ce),Ni=lh(On.stretch-yt,St,M,n.left),Gi=fd(On.fixed-jt,sn,On.stretch,he),gi=lh(Gn.stretch-zt,Vt,R,n.top),ii=fd(Gn.fixed-an,In,Gn.stretch,Ce),sr=new ne(zn,zi),Sr=new ne(Ni,zi),_o=new ne(Ni,gi),Hr=new ne(zn,gi),To=new ne($n/_,tr/_),vr=new ne(Gi/_,ii/_),pr=e*Math.PI/180;if(pr){const uo=Math.sin(pr),Uo=Math.cos(pr),Ho=[Uo,-uo,uo,Uo];sr._matMult(Ho),Sr._matMult(Ho),Hr._matMult(Ho),_o._matMult(Ho)}const Pr=tn.stretch+tn.fixed,io=vn.stretch+vn.fixed;return{tl:sr,tr:Sr,bl:Hr,br:_o,tex:{x:f.paddedRect.x+1+Pr,y:f.paddedRect.y+1+io,w:On.stretch+On.fixed-Pr,h:Gn.stretch+Gn.fixed-io},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:To,pixelOffsetBR:vr,minFontScaleX:sn/_/M,minFontScaleY:In/_/R,isSDF:i}};if(s&&(f.stretchX||f.stretchY)){const tn=im(B,ze,he),vn=im(V,Ke,Ce);for(let On=0;On<tn.length-1;On++){const Gn=tn[On],zn=tn[On+1];for(let $n=0;$n<vn.length-1;$n++)u.push(An(Gn,vn[$n],zn,vn[$n+1]))}}else u.push(An({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:T+1}));return u}function pd(n,e,i){let s=0;for(const u of n)s+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return s}function im(n,e,i){const s=[{fixed:-1,stretch:0}];for(const[u,f]of n){const _=s[s.length-1];s.push({fixed:u-_.stretch,stretch:_.stretch}),s.push({fixed:u-_.stretch,stretch:_.stretch+(f-u)})}return s.push({fixed:e+1,stretch:i}),s}function lh(n,e,i,s){return n/e*i+s}function fd(n,e,i,s){return n-e*i/s}function rm(n,e,i,s){const u=e+n.positionedLines[s].lineOffset;return 0===s?i+u/2:i+(u+(e+n.positionedLines[s-1].lineOffset))/2}kc.loadGlyphRange=function(n,e,i,s,u){const f=256*e,_=f+255,x=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${f}-${_}`),je.Glyphs);pe(x,(T,M)=>{if(T)u(T);else if(M){const R={},B=new oh(M).readFields(ud,{});for(const V of B.glyphs)R[V.id]=V;u(null,{glyphs:R,ascender:B.ascender,descender:B.descender})}})},kc.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:_="normal"}){this.buffer=e,this.cutoff=s,this.radius=i;const x=this.size=n+4*e,T=this._createCanvas(x),M=this.ctx=T.getContext("2d",{willReadFrequently:!0});M.font=`${_} ${f} ${n}px ${u}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(n),_=Math.floor(i),x=Math.min(this.size-this.buffer,Math.ceil(f-u)),T=Math.min(this.size-this.buffer,Math.ceil(i)+Math.ceil(s)),M=x+2*this.buffer,R=T+2*this.buffer,B=M*R,V=new Uint8ClampedArray(B),te={data:V,width:M,height:R,glyphWidth:x,glyphHeight:T,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(0===x||0===T)return te;const{ctx:he,buffer:Ce,gridInner:ze,gridOuter:Ke}=this;he.clearRect(Ce,Ce,x,T),he.fillText(n,Ce,Ce+_+1);const yt=he.getImageData(Ce,Ce,x,T);Ke.fill(pu,0,B),ze.fill(0,0,B);for(let St=0;St<T;St++)for(let zt=0;zt<x;zt++){const Vt=yt.data[4*(St*x+zt)+3]/255;if(0===Vt)continue;const jt=(St+Ce)*M+zt+Ce;if(1===Vt)Ke[jt]=0,ze[jt]=pu;else{const sn=.5-Vt;Ke[jt]=sn>0?sn*sn:0,ze[jt]=sn<0?sn*sn:0}}em(Ke,0,0,M,R,M,this.f,this.v,this.z),em(ze,Ce,Ce,x,T,M,this.f,this.v,this.z);for(let St=0;St<B;St++){const zt=Math.sqrt(Ke[St])-Math.sqrt(ze[St]);V[St]=Math.round(255-255*(zt/this.radius+this.cutoff))}return te}};class Lg{constructor(e=[],i=cl){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,u=i[e];for(;e>0;){const f=e-1>>1,_=i[f];if(s(u,_)>=0)break;i[e]=_,e=f}i[e]=u}_down(e){const{data:i,compare:s}=this,u=this.length>>1,f=i[e];for(;e<u;){let _=1+(e<<1),x=i[_];const T=_+1;if(T<this.length&&s(i[T],x)<0&&(_=T,x=i[T]),s(x,f)>=0)break;i[e]=x,e=_}i[e]=f}}function cl(n,e){return n<e?-1:n>e?1:0}function dp(n,e=1,i=!1){let s=1/0,u=1/0,f=-1/0,_=-1/0;const x=n[0];for(let te=0;te<x.length;te++){const he=x[te];(!te||he.x<s)&&(s=he.x),(!te||he.y<u)&&(u=he.y),(!te||he.x>f)&&(f=he.x),(!te||he.y>_)&&(_=he.y)}const T=Math.min(f-s,_-u);let M=T/2;const R=new Lg([],Rg);if(0===T)return new ne(s,u);for(let te=s;te<f;te+=T)for(let he=u;he<_;he+=T)R.push(new fu(te+M,he+M,M,n));let B=function(te){let he=0,Ce=0,ze=0;const Ke=te[0];for(let yt=0,St=Ke.length,zt=St-1;yt<St;zt=yt++){const Vt=Ke[yt],jt=Ke[zt],sn=Vt.x*jt.y-jt.x*Vt.y;Ce+=(Vt.x+jt.x)*sn,ze+=(Vt.y+jt.y)*sn,he+=3*sn}return new fu(Ce/he,ze/he,0,te)}(n),V=R.length;for(;R.length;){const te=R.pop();(te.d>B.d||!B.d)&&(B=te,i&&console.log("found best %d after %d probes",Math.round(1e4*te.d)/1e4,V)),te.max-B.d<=e||(M=te.h/2,R.push(new fu(te.p.x-M,te.p.y-M,M,n)),R.push(new fu(te.p.x+M,te.p.y-M,M,n)),R.push(new fu(te.p.x-M,te.p.y+M,M,n)),R.push(new fu(te.p.x+M,te.p.y+M,M,n)),V+=4)}return i&&(console.log(`num probes: ${V}`),console.log(`best distance: ${B.d}`)),B.p}function Rg(n,e){return e.max-n.max}function fu(n,e,i,s){this.p=new ne(n,e),this.h=i,this.d=function(u,f){let _=!1,x=1/0;for(let T=0;T<f.length;T++){const M=f[T];for(let R=0,B=M.length,V=B-1;R<B;V=R++){const te=M[R],he=M[V];te.y>u.y!=he.y>u.y&&u.x<(he.x-te.x)*(u.y-te.y)/(he.y-te.y)+te.x&&(_=!_),x=Math.min(x,Xc(u,te,he))}}return(_?1:-1)*Math.sqrt(x)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const om=Number.POSITIVE_INFINITY,sm=Math.sqrt(2);function am(n,e){return e[1]!==om?function(i,s,u){let f=0,_=0;switch(s=Math.abs(s),u=Math.abs(u),i){case"top-right":case"top-left":case"top":_=u-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-u}switch(i){case"top-right":case"bottom-right":case"right":f=-s;break;case"top-left":case"bottom-left":case"left":f=s}return[f,_]}(n,e[0],e[1]):function(i,s){let u=0,f=0;s<0&&(s=0);const _=s/sm;switch(i){case"top-right":case"top-left":f=_-7;break;case"bottom-right":case"bottom-left":f=7-_;break;case"bottom":f=7-s;break;case"top":f=s-7}switch(i){case"top-right":case"bottom-right":u=-_;break;case"top-left":case"bottom-left":u=_;break;case"left":u=s;break;case"right":u=-s}return[u,f]}(n,e[0])}function kg(n,e,i,s,u,f,_,x,T,M){n.createArrays(),n.tilePixelRatio=Zi/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const R=n.layers[0].layout,B=n.layers[0]._unevaluatedLayout._values,V={};if("composite"===n.textSizeData.kind){const{minZoom:Ce,maxZoom:ze}=n.textSizeData;V.compositeTextSizes=[B["text-size"].possiblyEvaluate(new Gr(Ce),x),B["text-size"].possiblyEvaluate(new Gr(ze),x)]}if("composite"===n.iconSizeData.kind){const{minZoom:Ce,maxZoom:ze}=n.iconSizeData;V.compositeIconSizes=[B["icon-size"].possiblyEvaluate(new Gr(Ce),x),B["icon-size"].possiblyEvaluate(new Gr(ze),x)]}V.layoutTextSize=B["text-size"].possiblyEvaluate(new Gr(T+1),x),V.layoutIconSize=B["icon-size"].possiblyEvaluate(new Gr(T+1),x),V.textMaxSize=B["text-size"].possiblyEvaluate(new Gr(18),x);const te="map"===R.get("text-rotation-alignment")&&"point"!==R.get("symbol-placement"),he=R.get("text-size");for(const Ce of n.features){const ze=R.get("text-font").evaluate(Ce,{},x).join(","),Ke=he.evaluate(Ce,{},x),yt=V.layoutTextSize.evaluate(Ce,{},x),St=(V.layoutIconSize.evaluate(Ce,{},x),{horizontal:{},vertical:void 0}),zt=Ce.text;let Vt,jt=[0,0];if(zt){const In=zt.toString(),An=24*R.get("text-letter-spacing").evaluate(Ce,{},x),tn=24*R.get("text-line-height").evaluate(Ce,{},x),vn=Ad(In)?An:0,On=R.get("text-anchor").evaluate(Ce,{},x),Gn=R.get("text-variable-anchor");if(!Gn){const Gi=R.get("text-radial-offset").evaluate(Ce,{},x);jt=Gi?am(On,[24*Gi,om]):R.get("text-offset").evaluate(Ce,{},x).map(gi=>24*gi)}let zn=te?"center":R.get("text-justify").evaluate(Ce,{},x);const $n=R.get("symbol-placement"),zi="point"===$n,tr="point"===$n?24*R.get("text-max-width").evaluate(Ce,{},x):0,Ni=Gi=>{n.allowVerticalPlacement&&lo(In)&&(St.vertical=dd(zt,e,i,u,ze,tr,tn,On,Gi,vn,jt,ha.vertical,!0,$n,yt,Ke))};if(!te&&Gn){const Gi="auto"===zn?Gn.map(ii=>hp(ii)):[zn];let gi=!1;for(let ii=0;ii<Gi.length;ii++){const sr=Gi[ii];if(!St.horizontal[sr])if(gi)St.horizontal[sr]=St.horizontal[0];else{const Sr=dd(zt,e,i,u,ze,tr,tn,"center",sr,vn,jt,ha.horizontal,!1,$n,yt,Ke);Sr&&(St.horizontal[sr]=Sr,gi=1===Sr.positionedLines.length)}}Ni("left")}else{if("auto"===zn&&(zn=hp(On)),zi||R.get("text-writing-mode").indexOf("horizontal")>=0||!lo(In)){const Gi=dd(zt,e,i,u,ze,tr,tn,On,zn,vn,jt,ha.horizontal,!1,$n,yt,Ke);Gi&&(St.horizontal[zn]=Gi)}Ni("point"===$n?"left":zn)}}let sn=!1;if(Ce.icon&&Ce.icon.name){const In=s[Ce.icon.name];In&&(Vt=Sg(u[Ce.icon.name],R.get("icon-offset").evaluate(Ce,{},x),R.get("icon-anchor").evaluate(Ce,{},x)),sn=In.sdf,void 0===n.sdfIcons?n.sdfIcons=In.sdf:n.sdfIcons!==In.sdf&&Nt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(In.pixelRatio!==n.pixelRatio||0!==R.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const an=md(St.horizontal)||St.vertical;n.iconsInText||(n.iconsInText=!!an&&an.iconsInText),(an||Vt)&&pp(n,Ce,St,Vt,s,V,yt,0,jt,sn,_,x,M)}f&&n.generateCollisionDebugBuffers(T,n.collisionBoxArray)}function hp(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function pp(n,e,i,s,u,f,_,x,T,M,R,B,V){let te=f.textMaxSize.evaluate(e,{},B);void 0===te&&(te=_);const he=n.layers[0].layout,Ce=he.get("icon-offset").evaluate(e,{},B),ze=md(i.horizontal)||i.vertical,Ke=_/24,yt=n.tilePixelRatio*te/24,St=(tn=n.overscaling,n.zoom>18&&tn>2&&(tn>>=1),Math.max(Zi/(512*tn),1)*he.get("symbol-spacing")),zt=he.get("text-padding")*n.tilePixelRatio,Vt=he.get("icon-padding")*n.tilePixelRatio,jt=se(he.get("text-max-angle")),sn="map"===he.get("text-rotation-alignment")&&"point"!==he.get("symbol-placement"),an="map"===he.get("icon-rotation-alignment")&&"point"!==he.get("symbol-placement"),In=he.get("symbol-placement"),An=St/2;var tn;const vn=he.get("icon-text-fit");let On;s&&"none"!==vn&&(n.allowVerticalPlacement&&i.vertical&&(On=Yf(s,i.vertical,vn,he.get("icon-text-fit-padding"),Ce,Ke)),ze&&(s=Yf(s,ze,vn,he.get("icon-text-fit-padding"),Ce,Ke)));const Gn=(zn,$n,zi)=>{if($n.x<0||$n.x>=Zi||$n.y<0||$n.y>=Zi)return;const{x:tr,y:Ni,z:Gi}=V.projectTilePoint($n.x,$n.y,zi),gi=new No(tr,Ni,Gi,0,void 0);!function(ii,sr,Sr,_o,Hr,To,vr,pr,Pr,io,uo,Uo,Ho,xs,hs,Fr,bs,Os,qo,Vo,Jr,qr,$s,ws,Eo){const ps=ii.addToLineVertexArray(sr,_o);let fs,Wo,fa,Ll,$c,jc,Lp,Rp=0,kp=0,Fp=0,Bp=0,vh=-1,xh=-1;const Za={};let Wg=wa(""),zp=0,Np=0;if(void 0===Pr._unevaluatedLayout.getValue("text-radial-offset")?[zp,Np]=Pr.layout.get("text-offset").evaluate(Jr,{},Eo).map(js=>24*js):(zp=24*Pr.layout.get("text-radial-offset").evaluate(Jr,{},Eo),Np=om),ii.allowVerticalPlacement&&Hr.vertical){const js=Hr.vertical;if(hs)jc=fp(js),pr&&(Lp=fp(pr));else{const ra=Pr.layout.get("text-rotate").evaluate(Jr,{},Eo)+90;fa=mu(io,Sr,sr,uo,Uo,Ho,js,xs,ra,Fr),pr&&(Ll=mu(io,Sr,sr,uo,Uo,Ho,pr,Os,ra))}}if(To){const js=Pr.layout.get("icon-rotate").evaluate(Jr,{},Eo),ra="none"!==Pr.layout.get("icon-text-fit"),Td=nm(To,js,$s,ra),bh=pr?nm(pr,js,$s,ra):void 0;Wo=mu(io,Sr,sr,uo,Uo,Ho,To,Os,js),Rp=4*Td.length;const Rm=ii.iconSizeData;let sc=null;"source"===Rm.kind?(sc=[Dl*Pr.layout.get("icon-size").evaluate(Jr,{},Eo)],sc[0]>tc&&Nt(`${ii.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Rm.kind&&(sc=[Dl*qr.compositeIconSizes[0].evaluate(Jr,{},Eo),Dl*qr.compositeIconSizes[1].evaluate(Jr,{},Eo)],(sc[0]>tc||sc[1]>tc)&&Nt(`${ii.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ii.addSymbols(ii.icon,Td,sc,Vo,qo,Jr,!1,Sr,sr,ps.lineStartIndex,ps.lineLength,-1,ws,Eo),vh=ii.icon.placedSymbolArray.length-1,bh&&(kp=4*bh.length,ii.addSymbols(ii.icon,bh,sc,Vo,qo,Jr,ha.vertical,Sr,sr,ps.lineStartIndex,ps.lineLength,-1,ws,Eo),xh=ii.icon.placedSymbolArray.length-1)}for(const js in Hr.horizontal){const ra=Hr.horizontal[js];fs||(Wg=wa(ra.text),hs?$c=fp(ra):fs=mu(io,Sr,sr,uo,Uo,Ho,ra,xs,Pr.layout.get("text-rotate").evaluate(Jr,{},Eo),Fr));const Td=1===ra.positionedLines.length;if(Fp+=lm(ii,Sr,sr,ra,vr,Pr,hs,Jr,Fr,ps,Hr.vertical?ha.horizontal:ha.horizontalOnly,Td?Object.keys(Hr.horizontal):[js],Za,vh,qr,ws,Eo),Td)break}Hr.vertical&&(Bp+=lm(ii,Sr,sr,Hr.vertical,vr,Pr,hs,Jr,Fr,ps,ha.vertical,["vertical"],Za,xh,qr,ws,Eo));let Rl=-1;const Up=(js,ra)=>js?Math.max(js,ra):ra;Rl=Up($c,Rl),Rl=Up(jc,Rl),Rl=Up(Lp,Rl);const rs=Rl>-1?1:0;ii.glyphOffsetArray.length>=Ml.MAX_GLYPHS&&Nt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Jr.sortKey&&ii.addToSortKeyRanges(ii.symbolInstances.length,Jr.sortKey),ii.symbolInstances.emplaceBack(Sr.x,Sr.y,Sr.z,sr.x,sr.y,Za.right>=0?Za.right:-1,Za.center>=0?Za.center:-1,Za.left>=0?Za.left:-1,Za.vertical>=0?Za.vertical:-1,vh,xh,Wg,void 0!==fs?fs:ii.collisionBoxArray.length,void 0!==fs?fs+1:ii.collisionBoxArray.length,void 0!==fa?fa:ii.collisionBoxArray.length,void 0!==fa?fa+1:ii.collisionBoxArray.length,void 0!==Wo?Wo:ii.collisionBoxArray.length,void 0!==Wo?Wo+1:ii.collisionBoxArray.length,Ll||ii.collisionBoxArray.length,Ll?Ll+1:ii.collisionBoxArray.length,uo,Fp,Bp,Rp,kp,rs,0,zp,Np,Rl)}(n,$n,gi,zn,i,s,u,On,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,zt,sn,T,0,Vt,an,Ce,e,f,M,R,B)};if("line"===In)for(const zn of ah(e.geometry,0,0,Zi,Zi)){const $n=sy(zn,St,jt,i.vertical||ze,s,24,yt,n.overscaling,Zi);for(const zi of $n){const tr=ze;tr&&mp(n,tr.text,An,zi)||Gn(zn,zi,B)}}else if("line-center"===In){for(const zn of e.geometry)if(zn.length>1){const $n=Kf(zn,jt,i.vertical||ze,s,24,yt);$n&&Gn(zn,$n,B)}}else if("Polygon"===e.type)for(const zn of Yh(e.geometry,0)){const $n=dp(zn,16);Gn(zn[0],new No($n.x,$n.y,0,0,void 0),B)}else if("LineString"===e.type)for(const zn of e.geometry)Gn(zn,new No(zn[0].x,zn[0].y,0,0,void 0),B);else if("Point"===e.type)for(const zn of e.geometry)for(const $n of zn)Gn([$n],new No($n.x,$n.y,0,0,void 0),B)}const tc=32640;function lm(n,e,i,s,u,f,_,x,T,M,R,B,V,te,he,Ce,ze){const Ke=function(zt,Vt,jt,sn,an,In,An,tn){const vn=[];if(0===Vt.positionedLines.length)return vn;const On=sn.layout.get("text-rotate").evaluate(In,{})*Math.PI/180,Gn=function(Ni){const Gi=Ni[0],gi=Ni[1],ii=Gi*gi;return ii>0?[Gi,-gi]:ii<0?[-Gi,gi]:0===Gi?[gi,Gi]:[gi,-Gi]}(jt);let zn=Math.abs(Vt.top-Vt.bottom);for(const Ni of Vt.positionedLines)zn-=Ni.lineOffset;const $n=Vt.positionedLines.length,zi=zn/$n;let tr=Vt.top-jt[1];for(let Ni=0;Ni<$n;++Ni){const Gi=Vt.positionedLines[Ni];tr=rm(Vt,zi,tr,Ni);for(const gi of Gi.positionedGlyphs){if(!gi.rect)continue;const ii=gi.rect||{};let sr=4,Sr=!0,_o=1,Hr=0;if(gi.imageName){const qr=An[gi.imageName];if(!qr)continue;if(qr.sdf){Nt("SDF images are not supported in formatted text and will be ignored.");continue}Sr=!1,_o=qr.pixelRatio,sr=1/_o}const To=(an||tn)&&gi.vertical,vr=gi.metrics.advance*gi.scale/2,pr=gi.metrics,Pr=gi.rect;if(null===Pr)continue;tn&&Vt.verticalizable&&(Hr=gi.imageName?vr-gi.metrics.width*gi.scale/2:0);const io=an?[gi.x+vr,gi.y]:[0,0];let uo=[0,0],Uo=[0,0],Ho=!1;an||(To?(Uo=[gi.x+vr+Gn[0],gi.y+Gn[1]-Hr],Ho=!0):uo=[gi.x+vr+jt[0],gi.y+jt[1]-Hr]);const xs=Pr.w*gi.scale/(_o*(gi.localGlyph?2:1)),hs=Pr.h*gi.scale/(_o*(gi.localGlyph?2:1));let Fr,bs,Os,qo;if(To){const qr=gi.y-tr,$s=new ne(-vr,vr-qr),ws=-Math.PI/2,Eo=new ne(...Uo);Fr=new ne(-vr+uo[0],uo[1]),Fr._rotateAround(ws,$s)._add(Eo),Fr.x+=-qr+vr,Fr.y-=(pr.left-sr)*gi.scale;const ps=gi.imageName?pr.advance*gi.scale:24*gi.scale,fs=String.fromCharCode(gi.glyph);ry(fs)?Fr.x+=(1-sr)*gi.scale:oy(fs)?Fr.x+=ps-pr.height*gi.scale+(-sr-1)*gi.scale:Fr.x+=gi.imageName||pr.width+2*sr===Pr.w&&pr.height+2*sr===Pr.h?(ps-hs)/2:(ps-(pr.height+2*sr)*gi.scale)/2,bs=new ne(Fr.x,Fr.y-xs),Os=new ne(Fr.x+hs,Fr.y),qo=new ne(Fr.x+hs,Fr.y-xs)}else{const qr=(pr.left-sr)*gi.scale-vr+uo[0],$s=(-pr.top-sr)*gi.scale+uo[1],ws=qr+xs,Eo=$s+hs;Fr=new ne(qr,$s),bs=new ne(ws,$s),Os=new ne(qr,Eo),qo=new ne(ws,Eo)}if(On){let qr;qr=an?new ne(0,0):Ho?new ne(Gn[0],Gn[1]):new ne(jt[0],jt[1]),Fr._rotateAround(On,qr),bs._rotateAround(On,qr),Os._rotateAround(On,qr),qo._rotateAround(On,qr)}const Vo=new ne(0,0),Jr=new ne(0,0);vn.push({tl:Fr,tr:bs,bl:Os,br:qo,tex:ii,writingMode:Vt.writingMode,glyphOffset:io,sectionIndex:gi.sectionIndex,isSDF:Sr,pixelOffsetTL:Vo,pixelOffsetBR:Jr,minFontScaleX:0,minFontScaleY:0})}}return vn}(0,s,T,f,_,x,u,n.allowVerticalPlacement),yt=n.textSizeData;let St=null;"source"===yt.kind?(St=[Dl*f.layout.get("text-size").evaluate(x,{},ze)],St[0]>tc&&Nt(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===yt.kind&&(St=[Dl*he.compositeTextSizes[0].evaluate(x,{},ze),Dl*he.compositeTextSizes[1].evaluate(x,{},ze)],(St[0]>tc||St[1]>tc)&&Nt(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,Ke,St,T,_,x,R,e,i,M.lineStartIndex,M.lineLength,te,Ce,ze);for(const zt of B)V[zt]=n.text.placedSymbolArray.length-1;return 4*Ke.length}function md(n){for(const e in n)return n[e];return null}function mu(n,e,i,s,u,f,_,x,T,M){let R=_.top,B=_.bottom,V=_.left,te=_.right;const he=_.collisionPadding;if(he&&(V-=he[0],R-=he[1],te+=he[2],B+=he[3]),T){const Ce=new ne(V,R),ze=new ne(te,R),Ke=new ne(V,B),yt=new ne(te,B),St=se(T);let zt=new ne(0,0);M&&(zt=new ne(M[0],M[1])),Ce._rotateAround(St,zt),ze._rotateAround(St,zt),Ke._rotateAround(St,zt),yt._rotateAround(St,zt),V=Math.min(Ce.x,ze.x,Ke.x,yt.x),te=Math.max(Ce.x,ze.x,Ke.x,yt.x),R=Math.min(Ce.y,ze.y,Ke.y,yt.y),B=Math.max(Ce.y,ze.y,Ke.y,yt.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,V,R,te,B,x,s,u,f),n.length-1}function fp(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function mp(n,e,i,s){const u=n.compareText;if(e in u){const f=u[e];for(let _=f.length-1;_>=0;_--)if(s.dist(f[_])<i)return!0}else u[e]=[];return u[e].push(s),!1}const gp=Sc.VectorTileFeature.types,cm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _p(n,e,i,s,u,f,_,x,T,M,R,B,V,te,he,Ce){const ze=R?Math.min(tc,Math.round(R[0])):0,Ke=R?Math.min(tc,Math.round(R[1])):0;n.emplaceBack(e,i,Math.round(32*_),Math.round(32*x),T,M,(ze<<1)+(B?1:0),Ke,16*V,16*te,256*he,256*Ce,s,u,f,0)}function um(n,e,i){n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i)}function yp(n){for(const e of n.sections)if(ef(e.text))return!0;return!1}class dm{constructor(e){this.layoutVertexArray=new un,this.indexArray=new ci,this.programConfigurations=e,this.segments=new go,this.dynamicLayoutVertexArray=new Un,this.opacityVertexArray=new Zt,this.placedSymbolArray=new Ra}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,i,s,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,xg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,cm,!0),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ti(dm,"SymbolBuffers");class vp{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new go,this.collisionVertexArray=new pn,this.collisionVertexArrayExt=new Un}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,bg.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,wg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ti(vp,"CollisionBuffers");class Ml{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ka([]),this.placementViewportMatrix=ka([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ih(this.zoom,i["text-size"]),this.iconSizeData=ih(this.zoom,i["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(_=>ha[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new dm(new wc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new dm(new wc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Er,this.lineVertexArray=new Ro,this.symbolInstances=new mo}calculateGlyphDependencies(e,i,s,u,f){for(let _=0;_<e.length;_++)if(i[e.charCodeAt(_)]=!0,u&&f){const x=rh[e.charAt(_)];x&&(i[x.charCodeAt(0)]=!0)}}populate(e,i,s,u){const f=this.layers[0],_=f.layout,x=_.get("text-font"),T=_.get("text-field"),M=_.get("icon-image"),R=("constant"!==T.value.kind||T.value.value instanceof ct&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),B="constant"!==M.value.kind||!!M.value.value||Object.keys(M.parameters).length>0,V=_.get("symbol-sort-key");if(this.features=[],!R&&!B)return;const te=i.iconDependencies,he=i.glyphDependencies,Ce=i.availableImages,ze=new Gr(this.zoom);for(const{feature:Ke,id:yt,index:St,sourceLayerIndex:zt}of e){const Vt=f._featureFilter.needGeometry,jt=Ec(Ke,Vt);if(!f._featureFilter.filter(ze,jt,s))continue;let sn,an;if(Vt||(jt.geometry=oo(Ke,s,u)),R){const An=f.getValueAndResolveTokens("text-field",jt,s,Ce),tn=ct.factory(An);yp(tn)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===vc()||this.hasRTLText&&cs.isParsed())&&(sn=iy(tn,f,jt))}if(B){const An=f.getValueAndResolveTokens("icon-image",jt,s,Ce);an=An instanceof kt?An:kt.fromString(An)}if(!sn&&!an)continue;const In=this.sortFeaturesByKey?V.evaluate(jt,{},s):void 0;if(this.features.push({id:yt,text:sn,icon:an,index:St,sourceLayerIndex:zt,geometry:jt.geometry,properties:Ke.properties,type:gp[Ke.type],sortKey:In}),an&&(te[an.name]=!0),sn){const An=x.evaluate(jt,{},s).join(","),tn="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ha.vertical)>=0;for(const vn of sn.sections)if(vn.image)te[vn.image.name]=!0;else{const On=lo(sn.toString()),Gn=vn.fontStack||An,zn=he[Gn]=he[Gn]||{};this.calculateGlyphDependencies(vn.text,zn,tn,this.allowVerticalPlacement,On)}}}"line"===_.get("symbol-placement")&&(this.features=function(Ke){const yt={},St={},zt=[];let Vt=0;function jt(An){zt.push(Ke[An]),Vt++}function sn(An,tn,vn){const On=St[An];return delete St[An],St[tn]=On,zt[On].geometry[0].pop(),zt[On].geometry[0]=zt[On].geometry[0].concat(vn[0]),On}function an(An,tn,vn){const On=yt[tn];return delete yt[tn],yt[An]=On,zt[On].geometry[0].shift(),zt[On].geometry[0]=vn[0].concat(zt[On].geometry[0]),On}function In(An,tn,vn){const On=vn?tn[0][tn[0].length-1]:tn[0][0];return`${An}:${On.x}:${On.y}`}for(let An=0;An<Ke.length;An++){const tn=Ke[An],vn=tn.geometry,On=tn.text?tn.text.toString():null;if(!On){jt(An);continue}const Gn=In(On,vn),zn=In(On,vn,!0);if(Gn in St&&zn in yt&&St[Gn]!==yt[zn]){const $n=an(Gn,zn,vn),zi=sn(Gn,zn,zt[$n].geometry);delete yt[Gn],delete St[zn],St[In(On,zt[zi].geometry,!0)]=zi,zt[$n].geometry=null}else Gn in St?sn(Gn,zn,vn):zn in yt?an(Gn,zn,vn):(jt(An),yt[Gn]=Vt-1,St[zn]=Vt-1)}return zt.filter(An=>An.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ke,yt)=>Ke.sortKey-yt.sortKey)}update(e,i,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,s,u),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,s,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length,u=e.segment;if(void 0!==u){let f=e.dist(i[u+1]),_=e.dist(i[u]);const x={};for(let T=u+1;T<i.length;T++)x[T]={x:i[T].x,y:i[T].y,tileUnitDistanceFromAnchor:f},T<i.length-1&&(f+=i[T+1].dist(i[T]));for(let T=u||0;T>=0;T--)x[T]={x:i[T].x,y:i[T].y,tileUnitDistanceFromAnchor:_},T>0&&(_+=i[T-1].dist(i[T]));for(let T=0;T<i.length;T++){const M=x[T];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,u,f,_,x,T,M,R,B,V,te,he){const Ce=e.indexArray,ze=e.layoutVertexArray,Ke=e.segments.prepareSegment(4*i.length,ze,Ce,this.canOverlap?_.sortKey:void 0),yt=this.glyphOffsetArray.length,St=Ke.vertexLength,zt=this.allowVerticalPlacement&&x===ha.vertical?Math.PI/2:0,Vt=_.text&&_.text.sections;for(let jt=0;jt<i.length;jt++){const{tl:sn,tr:an,bl:In,br:An,tex:tn,pixelOffsetTL:vn,pixelOffsetBR:On,minFontScaleX:Gn,minFontScaleY:zn,glyphOffset:$n,isSDF:zi,sectionIndex:tr}=i[jt],Ni=Ke.vertexLength,Gi=$n[1];_p(ze,T.x,T.y,T.z,M.x,M.y,sn.x,Gi+sn.y,tn.x,tn.y,s,zi,vn.x,vn.y,Gn,zn),_p(ze,T.x,T.y,T.z,M.x,M.y,an.x,Gi+an.y,tn.x+tn.w,tn.y,s,zi,On.x,vn.y,Gn,zn),_p(ze,T.x,T.y,T.z,M.x,M.y,In.x,Gi+In.y,tn.x,tn.y+tn.h,s,zi,vn.x,On.y,Gn,zn),_p(ze,T.x,T.y,T.z,M.x,M.y,An.x,Gi+An.y,tn.x+tn.w,tn.y+tn.h,s,zi,On.x,On.y,Gn,zn),um(e.dynamicLayoutVertexArray,T,zt),Ce.emplaceBack(Ni,Ni+1,Ni+2),Ce.emplaceBack(Ni+1,Ni+2,Ni+3),Ke.vertexLength+=4,Ke.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($n[0]),jt!==i.length-1&&tr===i[jt+1].sectionIndex||e.programConfigurations.populatePaintArrays(ze.length,_,_.index,{},te,he,Vt&&Vt[tr])}e.placedSymbolArray.emplaceBack(T.x,T.y,T.z,M.x,M.y,yt,this.glyphOffsetArray.length-yt,St,R,B,M.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],x,0,!1,0,V,0)}_commitLayoutVertex(e,i,s,u,f,_,x){e.emplaceBack(i,s,u,f,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,s,u,f,_,x){const T=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),M=T.vertexLength,R=x.tileAnchorX,B=x.tileAnchorY;for(let te=0;te<4;te++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,u,f,_,R,B,new ne(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,_,R,B,new ne(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,_,R,B,new ne(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,f,_,R,B,new ne(e.x1,e.y2)),T.vertexLength+=4;const V=s.indexArray;V.emplaceBack(M,M+1),V.emplaceBack(M+1,M+2),V.emplaceBack(M+2,M+3),V.emplaceBack(M+3,M),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,u,f,_){for(let x=u;x<f;x++){const T=s.get(x),M=this.getSymbolInstanceTextSize(e,_,i,x);this._addCollisionDebugVertices(T,M,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,i,s,u,f,_){for(let x=u;x<f;x++){const T=s.get(x),M=this.getSymbolInstanceIconSize(e,i,x);this._addCollisionDebugVertices(T,M,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vp(Bn,ep.members,Fi),this.iconCollisionBox=new vp(Bn,ep.members,Fi);const s=au(this.iconSizeData,e),u=au(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,i,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(u,e,i,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(s,e,i,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(s,e,i,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,i,s,u){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),_=ld(this.textSizeData,e,f)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,i,s){const u=this.icon.placedSymbolArray.get(s),f=ld(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,s){e.emplaceBack(i,-s,-s),e.emplaceBack(i,s,-s),e.emplaceBack(i,s,s),e.emplaceBack(i,-s,s)}_updateTextDebugCollisionBoxes(e,i,s,u,f,_){for(let x=u;x<f;x++){const T=s.get(x),M=this.getSymbolInstanceTextSize(e,_,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,T.padding)}}_updateIconDebugCollisionBoxes(e,i,s,u,f){for(let _=u;_<f;_++){const x=s.get(_),T=this.getSymbolInstanceIconSize(e,i,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,x.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=au(this.iconSizeData,e),u=au(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,i,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(u,e,i,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(s,e,i,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(s,e,i,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,u,f,_,x,T,M){const R={};for(let B=i;B<s;B++){const V=e.get(B);R.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,padding:V.padding,projectedAnchorX:V.projectedAnchorX,projectedAnchorY:V.projectedAnchorY,projectedAnchorZ:V.projectedAnchorZ,tileAnchorX:V.tileAnchorX,tileAnchorY:V.tileAnchorY},R.textFeatureIndex=V.featureIndex;break}for(let B=u;B<f;B++){const V=e.get(B);R.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,padding:V.padding,projectedAnchorX:V.projectedAnchorX,projectedAnchorY:V.projectedAnchorY,projectedAnchorZ:V.projectedAnchorZ,tileAnchorX:V.tileAnchorX,tileAnchorY:V.tileAnchorY},R.verticalTextFeatureIndex=V.featureIndex;break}for(let B=_;B<x;B++){const V=e.get(B);R.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,padding:V.padding,projectedAnchorX:V.projectedAnchorX,projectedAnchorY:V.projectedAnchorY,projectedAnchorZ:V.projectedAnchorZ,tileAnchorX:V.tileAnchorX,tileAnchorY:V.tileAnchorY},R.iconFeatureIndex=V.featureIndex;break}for(let B=T;B<M;B++){const V=e.get(B);R.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,padding:V.padding,projectedAnchorX:V.projectedAnchorX,projectedAnchorY:V.projectedAnchorY,projectedAnchorZ:V.projectedAnchorZ,tileAnchorX:V.tileAnchorX,tileAnchorY:V.tileAnchorY},R.verticalIconFeatureIndex=V.featureIndex;break}return R}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),u=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),u=[],f=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const T=this.symbolInstances.get(x);u.push(0|Math.round(i*T.tileAnchorX+s*T.tileAnchorY)),f.push(T.featureIndex)}return _.sort((x,T)=>u[x]-u[T]||f[T]-f[x]),_}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((u,f,_)=>{u>=0&&_.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ti(Ml,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ml.MAX_GLYPHS=65535,Ml.addDynamicAttributes=um;const hm=new ae({"symbol-placement":new I(Ut.layout_symbol["symbol-placement"]),"symbol-spacing":new I(Ut.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new I(Ut.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new S(Ut.layout_symbol["symbol-sort-key"]),"symbol-z-order":new I(Ut.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new I(Ut.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new I(Ut.layout_symbol["icon-ignore-placement"]),"icon-optional":new I(Ut.layout_symbol["icon-optional"]),"icon-rotation-alignment":new I(Ut.layout_symbol["icon-rotation-alignment"]),"icon-size":new S(Ut.layout_symbol["icon-size"]),"icon-text-fit":new I(Ut.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new I(Ut.layout_symbol["icon-text-fit-padding"]),"icon-image":new S(Ut.layout_symbol["icon-image"]),"icon-rotate":new S(Ut.layout_symbol["icon-rotate"]),"icon-padding":new I(Ut.layout_symbol["icon-padding"]),"icon-keep-upright":new I(Ut.layout_symbol["icon-keep-upright"]),"icon-offset":new S(Ut.layout_symbol["icon-offset"]),"icon-anchor":new S(Ut.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new I(Ut.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new I(Ut.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new I(Ut.layout_symbol["text-rotation-alignment"]),"text-field":new S(Ut.layout_symbol["text-field"]),"text-font":new S(Ut.layout_symbol["text-font"]),"text-size":new S(Ut.layout_symbol["text-size"]),"text-max-width":new S(Ut.layout_symbol["text-max-width"]),"text-line-height":new S(Ut.layout_symbol["text-line-height"]),"text-letter-spacing":new S(Ut.layout_symbol["text-letter-spacing"]),"text-justify":new S(Ut.layout_symbol["text-justify"]),"text-radial-offset":new S(Ut.layout_symbol["text-radial-offset"]),"text-variable-anchor":new I(Ut.layout_symbol["text-variable-anchor"]),"text-anchor":new S(Ut.layout_symbol["text-anchor"]),"text-max-angle":new I(Ut.layout_symbol["text-max-angle"]),"text-writing-mode":new I(Ut.layout_symbol["text-writing-mode"]),"text-rotate":new S(Ut.layout_symbol["text-rotate"]),"text-padding":new I(Ut.layout_symbol["text-padding"]),"text-keep-upright":new I(Ut.layout_symbol["text-keep-upright"]),"text-transform":new S(Ut.layout_symbol["text-transform"]),"text-offset":new S(Ut.layout_symbol["text-offset"]),"text-allow-overlap":new I(Ut.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new I(Ut.layout_symbol["text-ignore-placement"]),"text-optional":new I(Ut.layout_symbol["text-optional"])});var ch={paint:new ae({"icon-opacity":new S(Ut.paint_symbol["icon-opacity"]),"icon-color":new S(Ut.paint_symbol["icon-color"]),"icon-halo-color":new S(Ut.paint_symbol["icon-halo-color"]),"icon-halo-width":new S(Ut.paint_symbol["icon-halo-width"]),"icon-halo-blur":new S(Ut.paint_symbol["icon-halo-blur"]),"icon-translate":new I(Ut.paint_symbol["icon-translate"]),"icon-translate-anchor":new I(Ut.paint_symbol["icon-translate-anchor"]),"text-opacity":new S(Ut.paint_symbol["text-opacity"]),"text-color":new S(Ut.paint_symbol["text-color"],{runtimeType:Dr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new S(Ut.paint_symbol["text-halo-color"]),"text-halo-width":new S(Ut.paint_symbol["text-halo-width"]),"text-halo-blur":new S(Ut.paint_symbol["text-halo-blur"]),"text-translate":new I(Ut.paint_symbol["text-translate"]),"text-translate-anchor":new I(Ut.paint_symbol["text-translate-anchor"])}),layout:hm};class xp{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:lr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ti(xp,"FormatSectionOverride",{omit:["defaultValue"]});class gd extends Go{constructor(e){super(e,ch)}recalculate(e,i){super.recalculate(e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const f of s)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,s,u){const f=this.layout.get(e).evaluate(i,{},s,u),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||Li(_.value)||!f?f:(x=i.properties,f.replace(/{([^{}]+)}/g,(M,R)=>R in x?String(x[R]):""));var x}createBucket(e){return new Ml(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of ch.paint.overridableProperties){if(!gd.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new xp(i),u=new Yn(s,i.property.specification);let f=null;f="constant"===i.value.kind||"source"===i.value.kind?new ir("source",u):new Cr("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new b(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&gd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),u=ch.paint.properties[i];let f=!1;const _=x=>{for(const T of x)if(u.overrides&&u.overrides.hasOverride(T))return void(f=!0)};if("constant"===s.value.kind&&s.value.value instanceof ct)_(s.value.value.sections);else if("source"===s.value.kind){const x=M=>{f||(M instanceof hi&&nn(M.value)===jr?_(M.value.sections):M instanceof zr?_(M.sections):M.eachChild(x))},T=s.value;T._styleExpression&&x(T._styleExpression.expression)}return f}getProgramConfiguration(e){return new Yl(this,e)}}var Al={paint:new ae({"background-color":new I(Ut.paint_background["background-color"]),"background-pattern":new q(Ut.paint_background["background-pattern"]),"background-opacity":new I(Ut.paint_background["background-opacity"])})},uh={paint:new ae({"raster-opacity":new I(Ut.paint_raster["raster-opacity"]),"raster-hue-rotate":new I(Ut.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new I(Ut.paint_raster["raster-brightness-min"]),"raster-brightness-max":new I(Ut.paint_raster["raster-brightness-max"]),"raster-saturation":new I(Ut.paint_raster["raster-saturation"]),"raster-contrast":new I(Ut.paint_raster["raster-contrast"]),"raster-resampling":new I(Ut.paint_raster["raster-resampling"]),"raster-fade-duration":new I(Ut.paint_raster["raster-fade-duration"])})};class Fg extends Go{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Bg={paint:new ae({"sky-type":new I(Ut.paint_sky["sky-type"]),"sky-atmosphere-sun":new I(Ut.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new I(Ut.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new I(Ut.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new I(Ut.paint_sky["sky-gradient-radius"]),"sky-gradient":new J(Ut.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new I(Ut.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new I(Ut.paint_sky["sky-atmosphere-color"]),"sky-opacity":new I(Ut.paint_sky["sky-opacity"])})};function pm(n,e,i){const s=[0,0,1],u=og([]);return function(f,_,x){x*=.5;var T=_[0],M=_[1],R=_[2],B=_[3],V=Math.sin(x),te=Math.cos(x);f[0]=T*te-R*V,f[1]=M*te+B*V,f[2]=R*te+T*V,f[3]=B*te-M*V}(u,u,i?-se(n)+Math.PI:se(n)),Ba(u,u,-se(e)),xf(s,s,u),Wu(s,s)}const bp={circle:class extends Go{constructor(n){super(n,pf)}createBucket(n){return new Vd(n)}queryRadius(n){const e=n;return zo("circle-radius",this,e)+zo("circle-stroke-width",this,e)+Xl(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,s,u,f,_,x){const T=hf(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return bf(n,s,f,_,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,M)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new Yl(this,n)}},heatmap:class extends Go{createBucket(n){return new Zd(n)}constructor(n){super(n,Df),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Zh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return zo("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,s,u,f,_,x){const T=this.paint.get("heatmap-radius").evaluate(e,i);return bf(n,s,f,_,x,!0,!0,new ne(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new Yl(this,n)}},hillshade:class extends Go{constructor(n){super(n,Gh)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Go{constructor(n){super(n,Lf)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(n){return new Yl(this,n)}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new sd(n)}queryRadius(){return Xl(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,s,u,f){return!n.queryGeometry.isAboveHorizon&&cf($d(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Go{constructor(n){super(n,Nf)}createBucket(n){return new Kl(n)}queryRadius(){return Xl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new Yl(this,n)}queryIntersectsFeature(n,e,i,s,u,f,_,x,T){const M=hf(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(e,i),B=this.paint.get("fill-extrusion-base").evaluate(e,i),V=[0,0],te=x&&f.elevation,he=f.elevation?f.elevation.exaggeration():1,Ce=n.tile.getBucket(this);if(te&&Ce instanceof Kl){const yt=Ce.centroidVertexArray,St=T+1;if(St<yt.length){const zt=yt.get(St);V[0]=zt.a_centroid_pos0,V[1]=zt.a_centroid_pos1}}if(0===V[0]&&1===V[1])return!1;const ze=(yt=s,St=B,zt=R,Vt=M,jt=_,(sn=te?x:null)?function(tn,vn,On,Gn,zn,$n,zi,tr,Ni){const Gi=[],gi=[],ii=[0,0,0,1];for(const sr of tn){const Sr=[],_o=[];for(const Hr of sr){const To=Hr.x+Gn.x,vr=Hr.y+Gn.y,pr=Xh(To,vr,vn,On,$n,zi,tr,Ni);ii[0]=To,ii[1]=vr,ii[2]=pr.base,ii[3]=1,Xu(ii,ii,zn),ii[3]=Math.max(ii[3],1e-5);const Pr=ll([ii[0]/ii[3],ii[1]/ii[3],ii[2]/ii[3]]);ii[0]=To,ii[1]=vr,ii[2]=pr.top,ii[3]=1,Xu(ii,ii,zn),ii[3]=Math.max(ii[3],1e-5);const io=ll([ii[0]/ii[3],ii[1]/ii[3],ii[2]/ii[3]]);Sr.push(Pr),_o.push(io)}Gi.push(Sr),gi.push(_o)}return[Gi,gi]}(yt,St,zt,Vt,jt,sn,V,he,f.center.lat):function(tn,vn,On,Gn,zn){const $n=[],zi=[],tr=zn[8]*vn,Ni=zn[9]*vn,Gi=zn[10]*vn,gi=zn[11]*vn,ii=zn[8]*On,sr=zn[9]*On,Sr=zn[10]*On,_o=zn[11]*On;for(const Hr of tn){const To=[],vr=[];for(const pr of Hr){const Pr=pr.x+Gn.x,io=pr.y+Gn.y,uo=zn[0]*Pr+zn[4]*io+zn[12],Uo=zn[1]*Pr+zn[5]*io+zn[13],Ho=zn[2]*Pr+zn[6]*io+zn[14],xs=zn[3]*Pr+zn[7]*io+zn[15],hs=uo+tr,Fr=Uo+Ni,bs=Ho+Gi,Os=Math.max(xs+gi,1e-5),qo=uo+ii,Vo=Uo+sr,Jr=Ho+Sr,qr=Math.max(xs+_o,1e-5),$s=new ne(hs/Os,Fr/Os);$s.z=bs/Os,To.push($s);const ws=new ne(qo/qr,Vo/qr);ws.z=Jr/qr,vr.push(ws)}$n.push(To),zi.push(vr)}return[$n,zi]}(yt,St,zt,Vt,jt)),Ke=n.queryGeometry;var yt,St,zt,Vt,jt,sn;return function(yt,St,zt){let Vt=1/0;cf(zt,St)&&(Vt=Qd(zt,St[0]));for(let jt=0;jt<St.length;jt++){const sn=St[jt],an=yt[jt];for(let In=0;In<sn.length-1;In++){const An=sn[In],tn=[An,sn[In+1],an[In+1],an[In],An];lf(zt,tn)&&(Vt=Math.min(Vt,Qd(zt,tn)))}}return Vt!==1/0&&Vt}(ze[0],ze[1],Ke.isPointQuery()?Ke.screenBounds:Ke.screenGeometry)}},line:class extends Go{constructor(n){super(n,th),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Es,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=nh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Pc(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new Yl(this,n)}queryRadius(n){const e=n,i=yg(zo("line-width",this,e),zo("line-gap-width",this,e)),s=zo("line-offset",this,e);return i/2+Math.abs(s)+Xl(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,s,u,f){if(n.queryGeometry.isAboveHorizon)return!1;const _=$d(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),x=n.pixelToTileUnitsFactor/2*yg(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),T=this.paint.get("line-offset").evaluate(e,i);return T&&(s=function(M,R){const B=[],V=new ne(0,0);for(let te=0;te<M.length;te++){const he=M[te],Ce=[];for(let ze=0;ze<he.length;ze++){const Ke=he[ze-1],yt=he[ze],St=he[ze+1],zt=0===ze?V:yt.sub(Ke)._unit()._perp(),Vt=ze===he.length-1?V:St.sub(yt)._unit()._perp(),jt=zt._add(Vt)._unit();jt._mult(1/(jt.x*Vt.x+jt.y*Vt.y)),Ce.push(jt._mult(R)._add(yt))}B.push(Ce)}return B}(s,T*n.pixelToTileUnitsFactor)),function(M,R,B){for(let V=0;V<R.length;V++){const te=R[V];if(M.length>=3)for(let he=0;he<te.length;he++)if(Jl(M,te[he]))return!0;if(ig(M,te,B))return!0}return!1}(_,s,x)}isTileClipped(){return!0}},symbol:gd,background:class extends Go{constructor(n){super(n,Al)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Go{constructor(n){super(n,uh)}getProgramIds(){return["raster"]}},sky:class extends Go{constructor(n){super(n,Bg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Zh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),u=!s,f=n.style.light,_=f.properties.get("position");return u&&"viewport"===f.properties.get("anchor")&&Nt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?pm(_.azimuthal,90-_.polar,e):pm(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return pm(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}}};class gu{constructor(e,i,s,u){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,s){const{width:u,height:f}=e,{context:_}=this,{gl:x}=_,{HTMLImageElement:T,HTMLCanvasElement:M,HTMLVideoElement:R,ImageData:B,ImageBitmap:V}=ge;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||!1!==i.premultiply)),s||this.size&&this.size[0]===u&&this.size[1]===f){const{x:te,y:he}=s||{x:0,y:0};e instanceof T||e instanceof M||e instanceof R||e instanceof B||V&&e instanceof V?x.texSubImage2D(x.TEXTURE_2D,0,te,he,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,te,he,u,f,x.RGBA,x.UNSIGNED_BYTE,e.data)}else this.size=[u,f],e instanceof T||e instanceof M||e instanceof R||e instanceof B||V&&e instanceof V?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,f,0,this.format,x.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,i){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class _d{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new ta({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=ye(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const u=[];let f=e.length%2==1?-e[e.length-1]*s:0,_=e[0]*s,x=!0;u.push({left:f,right:_,isDash:x,zeroLength:0===e[0]});let T=e[0];for(let M=1;M<e.length;M++){x=!x;const R=e[M];f=T*s,T+=R,_=T*s,u.push({left:f,right:_,isDash:x,zeroLength:0===R})}return u}addRoundDash(e,i,s){const u=i/2;for(let f=-s;f<=s;f++){const _=this.width*(this.nextRow+s+f);let x=0,T=e[x];for(let M=0;M<this.width;M++){M/T.right>1&&(T=e[++x]);const R=Math.abs(M-T.left),B=Math.abs(M-T.right),V=Math.min(R,B);let te;const he=f/s*(u+1);if(T.isDash){const Ce=u-Math.abs(he);te=Math.sqrt(V*V+Ce*Ce)}else te=u-Math.sqrt(V*V+he*he);this.image.data[_+M]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(e,i){for(let T=e.length-1;T>=0;--T){const M=e[T],R=e[T+1];M.zeroLength?e.splice(T,1):R&&R.isDash===M.isDash&&(R.left=M.left,e.splice(T,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const f=this.width*this.nextRow;let _=0,x=e[_];for(let T=0;T<this.width;T++){T/x.right>1&&(x=e[++_]);const M=Math.abs(T-x.left),R=Math.abs(T-x.right),B=Math.min(M,R);this.image.data[f+T]=Math.max(0,Math.min(255,(x.isDash?B:-B)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const u="round"===i,f=u?7:0,_=2*f+1;if(this.nextRow+_>this.height)return Nt("LineAtlas out of space"),null;0===e.length&&e.push(1);let x=0;for(let R=0;R<e.length;R++)e[R]<0&&(Nt("Negative value is found in line dasharray, replacing values with 0"),e[R]=0),x+=e[R];if(0!==x){const R=this.width/x,B=this.getDashRanges(e,this.width,R);u?this.addRoundDash(B,R,f):this.addRegularDash(B,"square"===i?.5*R:0)}const T=this.nextRow+f;this.nextRow+=_;const M={tl:[T,f],br:[x,0]};return this.positions[s]=M,M}}ti(_d,"LineAtlas");class yd{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const zg=ge.performance;function dh(n){const e=n?n.url.toString():void 0;return zg.getEntriesByName(e)}class fm{constructor(){this.tasks={},this.taskQueue=[],Be(["process"],this),this.invoker=new yd(this.process),this.nextId=0}add(e,i){const s=this.nextId++,u=function({type:f,isSymbolTile:_,zoom:x}){return x=x||0,"message"===f?0:"maybePrepare"!==f||_?"parseTile"!==f||_?"parseTile"===f&&_?300-x:"maybePrepare"===f&&_?400-x:500:200-x:100-x}(i);if(0===u){ht();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:i,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){ht();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<i&&(i=f.priority,e=u)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}const mm=at([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),gm=at([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:_m}=mm,hh=at([{name:"a_pos_3",components:3,type:"Int16"}]);var vd=at([{name:"a_pos",type:"Int16",components:2}]);const _u=Zi/Math.PI/2,Us=-_u,ns=_u,ym=[new Ns([Us,Us,Us],[ns,ns,ns]),new Ns([Us,Us,Us],[0,0,ns]),new Ns([0,Us,Us],[ns,0,ns]),new Ns([Us,0,Us],[0,ns,ns]),new Ns([0,0,Us],[ns,ns,ns])];class Ng{constructor(e,i,s){this.a=Fa([],e,s),this.b=Fa([],i,s),this.center=s;const u=Wu([],this.a),f=Wu([],this.b);this.angle=Math.acos(Yu(u,f))}}function wp(n,e){if(0===n.angle)return null;let i;return i=0===n.a[e]?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(s,u,f,_){const x=Math.sin(f);return s*(Math.sin((1-_)*f)/x)+u*(Math.sin(_*f)/x)}(n.a[e],n.b[e],n.angle,He(i,0,1))+n.center[e]}function ul(n){if(n.z<=1)return ym[n.z+2*n.y+n.x];const[e,i]=Cp(n),s=[Sl(e[0],e[1]),Sl(e[0],i[1]),Sl(i[0],e[1]),Sl(i[0],i[1])],u=[ns,ns,ns],f=[Us,Us,Us];for(const _ of s)u[0]=Math.min(u[0],_[0]),u[1]=Math.min(u[1],_[1]),u[2]=Math.min(u[2],_[2]),f[0]=Math.max(f[0],_[0]),f[1]=Math.max(f[1],_[1]),f[2]=Math.max(f[2],_[2]);return new Ns(u,f)}function Cp(n){const e=1<<n.z,i=n.x/e,s=(n.x+1)/e,u=(n.y+1)/e;return[[us(n.y/e),da(i)],[us(u),da(s)]]}function vm(n,e,i,s=_u){return i=se(i),[n*Math.sin(i)*s,-e*s,n*Math.cos(i)*s]}function Sl(n,e,i){return vm(Math.cos(se(n)),Math.sin(se(n)),e,i)}function Ua(n,e,i){const s=Math.pow(2,i.z),u=(n/Zi+i.x)/s;return Sl(us((e/Zi+i.y)/s),da(u))}function xd(n){return 16383/Math.max(...Fa([],n.max,n.min))}function Tp(n){const e=ka(new Float64Array(16)),i=xd(n);var s,u;return sl(e,e,[i,i,i]),Dc(e,e,((s=[])[0]=-(u=n.min)[0],s[1]=-u[1],s[2]=-u[2],s)),e}function Ep(n,e,i,s,u){const f=function(T){const M=Zi/(2*Math.PI);return T/(2*Math.PI)/M}(i),_=[n,e,-i/(2*Math.PI)],x=ka(new Float64Array(16));return Dc(x,x,_),sl(x,x,[f,f,f]),Fh(x,x,se(-u)),Bh(x,x,se(-s)),x}function Dp(n){const{x:e,y:i}=n.point,{lng:s,lat:u}=n._center;return Ep(e,i,n.worldSize,s,u)}const Ip=se(85),Vg=Math.cos(Ip),$g=Math.sin(Ip);function xm(n,e,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[n*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class ph{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=yu(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const s=(_=this.y,x=this.z,T=xm(256*(f=this.x),256*(_=Math.pow(2,x)-_-1),x),M=xm(256*(f+1),256*(_+1),x),T[0]+","+T[1]+","+M[0]+","+M[1]),u=function(f,_,x){let T,M="";for(let R=f;R>0;R--)T=1<<R-1,M+=(_&T?1:0)+(x&T?2:0);return M}(this.z,this.x,this.y);var f,_,x,T,M;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Mp{constructor(e,i){this.wrap=e,this.canonical=i,this.key=yu(e,i.z,i.z,i.x,i.y)}}class Vs{constructor(e,i,s,u,f){this.overscaledZ=e,this.wrap=i,this.canonical=new ph(s,+u,+f),this.key=0===i&&e===s?this.canonical.key:yu(i,e,s,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Vs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vs(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return yu(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return yu(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Vs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new Vs(i,this.wrap,i,s,u),new Vs(i,this.wrap,i,s+1,u),new Vs(i,this.wrap,i,s,u+1),new Vs(i,this.wrap,i,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Vs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Vs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Mp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function yu(n,e,i,s,u){const f=1<<Math.min(i,22);let _=f*(u%f)+s%f;return n&&i<22&&(_+=f*f*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*_+i)+(e-i)}function Fc(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),s=n.x*i,u=(n.x+1)*i,f=n.y*i,_=(n.y+1)*i,x=da(s),T=da(u),M=us(f),R=us(_),B=e.project(x,M),V=e.project(T,M),te=e.project(T,R),he=e.project(x,R);let Ce=Math.min(B.x,V.x,te.x,he.x),ze=Math.min(B.y,V.y,te.y,he.y),Ke=Math.max(B.x,V.x,te.x,he.x),yt=Math.max(B.y,V.y,te.y,he.y);const St=i/16;function zt(jt,sn,an,In,An,tn){const vn=(an+An)/2,On=(In+tn)/2,Gn=e.project(da(vn),us(On)),zn=Math.max(0,Ce-Gn.x,ze-Gn.y,Gn.x-Ke,Gn.y-yt);Ce=Math.min(Ce,Gn.x),Ke=Math.max(Ke,Gn.x),ze=Math.min(ze,Gn.y),yt=Math.max(yt,Gn.y),zn>St&&(zt(jt,Gn,an,In,vn,On),zt(Gn,sn,vn,On,An,tn))}zt(B,V,s,f,u,f),zt(V,te,u,f,u,_),zt(te,he,u,_,s,_),zt(he,B,s,_,s,f),Ce-=St,ze-=St,Ke+=St,yt+=St;const Vt=1/Math.max(Ke-Ce,yt-ze);return{scale:Vt,x:Ce*Vt,y:ze*Vt,x2:Ke*Vt,y2:yt*Vt,projection:e}}ti(ph,"CanonicalTileID"),ti(Vs,"OverscaledTileID",{omit:["projMatrix"]});class bm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const ay=["tile","layer","source","sourceLayer","state"];class jg{constructor(e,i,s,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=u,this.properties=e.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const i of ay)void 0!==this[i]&&(e[i]=this[i]);return e}}const Pl=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,i=0,s=0,u=0,f=0,_=0,x=0;for(1&e?u=f=_=32:i=s=x=32;(e>>=1)>1;){const M=i+u>>1,R=s+f>>1;1&e?(u=i,f=s,i=_,s=x):(i=u,s=f,u=_,f=x),_=M,x=R}const T=4*n;Pl[T+0]=i,Pl[T+1]=s,Pl[T+2]=u,Pl[T+3]=f}const Va=new Uint16Array(2178),Bc=new Uint8Array(1089),ia=new Uint16Array(1089);function Zg(n){return 0===n?-.03125:32===n?.03125:0}var Gg=at([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Ap={type:2,extent:Zi,loadGeometry:()=>[[new ne(0,0),new ne(8193,0),new ne(8193,8193),new ne(0,8193),new ne(0,0)]]};class fh{constructor(e,i,s,u,f){this.tileID=e,this.uid=Ge(),this.uses=0,this.tileSize=i,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<lt.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Fc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const _={};if(!f)return _;for(const x of u){const T=x.layerIds.map(M=>f.getLayer(M)).filter(Boolean);if(0!==T.length){x.layers=T,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(M=>T.filter(R=>R.id===M)[0]));for(const M of T)_[M.id]=x}}return _}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof Ml){if(this.hasSymbolBuckets=!0,!s)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof Ml&&f.hasRTLText){this.hasRTLText=!0,cs.isLoading()||cs.isLoaded()||"deferred"!==vc()||La();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(u).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new As}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const u=this.buckets[s];u.uploadPending()&&u.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new gu(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new gu(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new gu(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,s,u,f,_,x,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:x,transform:_,params:f,tileTransform:this.tileTransform},e,i,s):{}}querySourceFeatures(e,i){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const u=s.loadVTLayers(),f=i?i.sourceLayer:"",_=u._geojsonTileLayer||u[f];if(!_)return;const x=kr(i&&i.filter),{z:T,x:M,y:R}=this.tileID.canonical,B={z:T,x:M,y:R};for(let V=0;V<_.length;V++){const te=_.feature(V);if(x.needGeometry){const ze=Ec(te,!0);if(!x.filter(new Gr(this.tileID.overscaledZ),ze,this.tileID.canonical))continue}else if(!x.filter(new Gr(this.tileID.overscaledZ),te))continue;const he=s.getId(te,f),Ce=new jg(te,T,M,R,he);Ce.tile=B,e.push(Ce)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const s=Lt(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let u=!1;if(this.expirationTime>s)u=!1;else if(i)if(this.expirationTime<i)u=!0;else{const f=this.expirationTime-i;f?this.expirationTime=s+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!i)return;const s=this.latestFeatureIndex.loadVTLayers(),u=i.style.listImages();for(const f in this.buckets){if(!i.style.hasLayer(f))continue;const _=this.buckets[f],x=_.layers[0].sourceLayer||"_geojsonTileLayer",T=s[x],M=e[x];if(!T||!M||0===Object.keys(M).length)continue;if(_.update(M,T,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof Pc||_ instanceof sd){const B=i.style._getSourceCache(_.layers[0].source);i._terrain&&i._terrain.enabled&&B&&_.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(B.id,this.tileID)}const R=i&&i.style&&i.style.getLayer(f);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<lt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=lt.now()+e}setTexture(e,i){const s=i.context,u=s.gl;this.texture=i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new gu(s,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),s.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax))}setDependencies(e,i){const s={};for(const u of i)s[u]=!0;this.dependencies[e]=s}hasDependency(e,i){for(const s of e){const u=this.dependencies[s];if(u)for(const f of i)if(u[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const s=oo(Ap,this.tileID.canonical,this.tileTransform)[0],u=new rt,f=new hr;for(let _=0;_<s.length;_++){const{x,y:T}=s[_];u.emplaceBack(x,T),f.emplaceBack(_)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,vd.members),this._tileDebugSegments=go.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const s=oo(Ap,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const _=function(x,T){const M=Fc(x,T),R=Math.pow(2,x.z);for(let ze=0;ze<33;ze++)for(let Ke=0;Ke<33;Ke++){const yt=da((x.x+(Ke+Zg(Ke))/32)/R),St=us((x.y+(ze+Zg(ze))/32)/R),zt=T.project(yt,St),Vt=33*ze+Ke;Va[2*Vt+0]=Math.round((zt.x*M.scale-M.x)*Zi),Va[2*Vt+1]=Math.round((zt.y*M.scale-M.y)*Zi)}Bc.fill(0),ia.fill(0);for(let ze=2045;ze>=0;ze--){const Ke=4*ze,yt=Pl[Ke+0],St=Pl[Ke+1],zt=Pl[Ke+2],Vt=Pl[Ke+3],jt=yt+zt>>1,sn=St+Vt>>1,an=jt+sn-St,In=sn+yt-jt,An=33*St+yt,tn=33*Vt+zt,vn=33*sn+jt,On=Math.hypot((Va[2*An+0]+Va[2*tn+0])/2-Va[2*vn+0],(Va[2*An+1]+Va[2*tn+1])/2-Va[2*vn+1])>=16;if(Bc[vn]=Bc[vn]||(On?1:0),ze<1022){const Gn=33*(St+In>>1)+(yt+an>>1),zn=33*(Vt+In>>1)+(zt+an>>1);Bc[vn]=Bc[vn]||Bc[Gn]||Bc[zn]}}const B=new mt,V=new ci;let te=0;function he(ze,Ke){const yt=33*Ke+ze;return 0===ia[yt]&&(B.emplaceBack(Va[2*yt+0],Va[2*yt+1],ze*Zi/32,Ke*Zi/32),ia[yt]=++te),ia[yt]-1}function Ce(ze,Ke,yt,St,zt,Vt){const jt=ze+yt>>1,sn=Ke+St>>1;if(Math.abs(ze-zt)+Math.abs(Ke-Vt)>1&&Bc[33*sn+jt])Ce(zt,Vt,ze,Ke,jt,sn),Ce(yt,St,zt,Vt,jt,sn);else{const an=he(ze,Ke),In=he(yt,St),An=he(zt,Vt);V.emplaceBack(an,In,An)}}return Ce(0,0,32,32,32,0),Ce(32,32,0,0,0,32),{vertices:B,indices:V}}(this.tileID.canonical,i);u=_.vertices,f=_.indices}else{u=new mt,f=new ci;for(const{x,y:T}of s)u.emplaceBack(x,T,0,0);const _=Hd(u.int16,void 0,4);for(let x=0;x<_.length;x+=3)f.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,Gg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=go.simpleSegment(0,0,u.length,f.length)}_makeGlobeTileDebugBuffers(e,i){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!i||"globe"!==i.name)return;const s=this.tileID.canonical,u=Tp(ul(s));this._makeGlobeTileDebugBorderBuffer(e,s,u),this._makeGlobeTileDebugTextBuffer(e,s,u)}_makeGlobeTileDebugBorderBuffer(e,i,s){const u=new rt,f=new hr,_=new ot,x=(M,R,B,V,te)=>{const he=(B-M)/(te-1),Ce=(V-R)/(te-1),ze=u.length;for(let Ke=0;Ke<te;Ke++){const yt=M+Ke*he,St=R+Ke*Ce;u.emplaceBack(yt,St);const zt=Ua(yt,St,i),Vt=Ic(zt,zt,s);_.emplaceBack(Vt[0],Vt[1],Vt[2]),f.emplaceBack(ze+Ke)}},T=Zi;x(0,0,T,0,16),x(T,0,T,T,16),x(T,T,0,T,16),x(0,T,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,vd.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(_,hh.members),this._tileDebugSegments=go.simpleSegment(0,0,u.length,f.length)}_makeGlobeTileDebugTextBuffer(e,i,s){const u=new rt,f=new ci,_=new ot,x=25;f.reserve(32),u.reserve(x),_.reserve(x);const T=(M,R)=>x*M+R;for(let M=0;M<x;M++){const R=2048*M;for(let B=0;B<x;B++){const V=2048*B;u.emplaceBack(V,R);const te=Ua(V,R,i),he=Ic(te,te,s);_.emplaceBack(he[0],he[1],he[2])}}for(let M=0;M<4;M++)for(let R=0;R<4;R++){const B=T(M,R),V=T(M,R+1),te=T(M+1,R),he=T(M+1,R+1);f.emplaceBack(B,V,te),f.emplaceBack(te,V,he)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(f),this._tileDebugTextBuffer=e.createVertexBuffer(u,vd.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(_,hh.members),this._tileDebugTextSegments=go.simpleSegment(0,0,x,32)}}class wm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,s){const u=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Ze(this.stateChanges[e][u],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const f in this.state[e][u])s[f]||(this.deletedStates[e][u][f]=null)}else for(const f in s)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][f]&&delete this.deletedStates[e][u][f]}removeFeatureState(e,i,s){if(null===this.deletedStates[e])return;const u=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==i)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][s]=null);else if(void 0!==i)if(this.stateChanges[e]&&this.stateChanges[e][u])for(s in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][s]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,i){const s=String(i),u=Ze({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const f=this.deletedStates[e][i];if(null===f)return{};for(const _ in f)delete u[_]}return u}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const s={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const _ in this.stateChanges[u])this.state[u][_]||(this.state[u][_]={}),Ze(this.state[u][_],this.stateChanges[u][_]),f[_]=this.state[u][_];s[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(null===this.deletedStates[u])for(const _ in this.state[u])f[_]={},this.state[u][_]={};else for(const _ in this.deletedStates[u]){if(null===this.deletedStates[u][_])this.state[u][_]={};else for(const x of Object.keys(this.deletedStates[u][_]))delete this.state[u][_][x];f[_]=this.state[u][_]}s[u]=s[u]||{},Ze(s[u],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const u in e)e[u].setFeatureState(s,i)}}class Cm{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Hg(n,e,i,s){let u=0,f=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(s[_])<1e-15){if(i[_]<n[_]||i[_]>e[_])return null}else{const x=1/s[_];let T=(n[_]-i[_])*x,M=(e[_]-i[_])*x;if(T>M){const R=T;T=M,M=R}if(T>u&&(u=T),M<f&&(f=M),u>f)return null}return u}function Sp(n,e,i,s,u,f,_,x,T,M,R){const B=s-n,V=u-e,te=f-i,he=_-n,Ce=x-e,ze=T-i,Ke=R[1]*ze-R[2]*Ce,yt=R[2]*he-R[0]*ze,St=R[0]*Ce-R[1]*he,zt=B*Ke+V*yt+te*St;if(Math.abs(zt)<1e-15)return null;const Vt=1/zt,jt=M[0]-n,sn=M[1]-e,an=M[2]-i,In=(jt*Ke+sn*yt+an*St)*Vt;if(In<0||In>1)return null;const An=sn*te-an*V,tn=an*B-jt*te,vn=jt*V-sn*B,On=(R[0]*An+R[1]*tn+R[2]*vn)*Vt;return On<0||In+On>1?null:(he*An+Ce*tn+ze*vn)*Vt}function mh(n,e,i){return(n-e)/(i-e)}function Tm(n,e,i,s,u,f,_,x,T){const M=1<<i,R=f-s,B=_-u,V=(n+1)/M*R+s,te=(e+0)/M*B+u,he=(e+1)/M*B+u;x[0]=(n+0)/M*R+s,x[1]=te,T[0]=V,T[1]=he}class gh{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const _=Math.ceil(Math.log2(f.dim/8)),x=[];let T=Math.ceil(Math.pow(2,_));const M=1/T,R=(te,he,Ce,ze,Ke)=>{const yt=ze?1:0,St=(te+1)*Ce-yt,zt=he*Ce,Vt=(he+1)*Ce-yt;Ke[0]=te*Ce,Ke[1]=zt,Ke[2]=St,Ke[3]=Vt};let B=new Cm(T);const V=[];for(let te=0;te<T*T;te++){R(te%T,Math.floor(te/T),M,!1,V);const he=nc(V[0],V[1],f),Ce=nc(V[2],V[1],f),ze=nc(V[2],V[3],f),Ke=nc(V[0],V[3],f);B.minimums.push(Math.min(he,Ce,ze,Ke)),B.maximums.push(Math.max(he,Ce,ze,Ke)),B.leaves.push(1)}for(x.push(B),T/=2;T>=1;T/=2){const te=x[x.length-1];B=new Cm(T);for(let he=0;he<T*T;he++){R(he%T,Math.floor(he/T),2,!0,V);const Ce=te.getElevation(V[0],V[1]),ze=te.getElevation(V[2],V[1]),Ke=te.getElevation(V[2],V[3]),yt=te.getElevation(V[0],V[3]),St=te.isLeaf(V[0],V[1]),zt=te.isLeaf(V[2],V[1]),Vt=te.isLeaf(V[2],V[3]),jt=te.isLeaf(V[0],V[3]),sn=Math.min(Ce.min,ze.min,Ke.min,yt.min),an=Math.max(Ce.max,ze.max,Ke.max,yt.max),In=St&&zt&&Vt&&jt;B.maximums.push(an),B.minimums.push(sn),B.leaves.push(an-sn<=5&&In?1:0)}x.push(B)}return x}(this.dem),s=i.length-1,u=i[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,u,f,_,x=1){return Hg([e,i,-100],[s,u,this.maximums[0]*x],f,_)}raycast(e,i,s,u,f,_,x=1){if(!this.nodeCount)return null;const T=this.raycastRoot(e,i,s,u,f,_,x);if(null==T)return null;const M=[],R=[],B=[],V=[],te=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;te.length>0;){const{idx:he,t:Ce,nodex:ze,nodey:Ke,depth:yt}=te.pop();if(this.leaves[he]){Tm(ze,Ke,yt,e,i,s,u,B,V);const zt=1<<yt,Vt=(ze+0)/zt,jt=(ze+1)/zt,sn=(Ke+0)/zt,an=(Ke+1)/zt,In=nc(Vt,sn,this.dem)*x,An=nc(jt,sn,this.dem)*x,tn=nc(jt,an,this.dem)*x,vn=nc(Vt,an,this.dem)*x,On=Sp(B[0],B[1],In,V[0],B[1],An,V[0],V[1],tn,f,_),Gn=Sp(V[0],V[1],tn,B[0],V[1],vn,B[0],B[1],In,f,_),zn=Math.min(null!==On?On:Number.MAX_VALUE,null!==Gn?Gn:Number.MAX_VALUE);if(zn!==Number.MAX_VALUE)return zn;{const $n=Vh([],f,_,Ce);if(Em(In,An,vn,tn,mh($n[0],B[0],V[0]),mh($n[1],B[1],V[1]))>=$n[2])return Ce}continue}let St=0;for(let zt=0;zt<this._siblingOffset.length;zt++){Tm((ze<<1)+this._siblingOffset[zt][0],(Ke<<1)+this._siblingOffset[zt][1],yt+1,e,i,s,u,B,V),B[2]=-100,V[2]=this.maximums[this.childOffsets[he]+zt]*x;const Vt=Hg(B,V,f,_);if(null!=Vt){const jt=Vt;M[zt]=jt;let sn=!1;for(let an=0;an<St&&!sn;an++)jt>=M[R[an]]&&(R.splice(an,0,zt),sn=!0);sn||(R[St]=zt),St++}}for(let zt=0;zt<St;zt++){const Vt=R[zt];te.push({idx:this.childOffsets[he]+Vt,t:M[Vt],nodex:(ze<<1)+this._siblingOffset[Vt][0],nodey:(Ke<<1)+this._siblingOffset[Vt][1],depth:yt+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,u,f){if(1===e[u].isLeaf(i,s))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const _=u-1,x=e[_];let T=0,M=0;for(let R=0;R<this._siblingOffset.length;R++){const B=2*i+this._siblingOffset[R][0],V=2*s+this._siblingOffset[R][1],te=x.getElevation(B,V),he=x.isLeaf(B,V),Ce=this._addNode(te.min,te.max,he);he&&(T|=1<<R),M||(M=Ce)}for(let R=0;R<this._siblingOffset.length;R++)T&1<<R||this._construct(e,2*i+this._siblingOffset[R][0],2*s+this._siblingOffset[R][1],_,M+R)}}function Em(n,e,i,s,u,f){return ai(ai(n,i,f),ai(e,s,f),u)}function nc(n,e,i){const s=i.dim,u=He(n*s-.5,0,s-1),f=He(e*s-.5,0,s-1),_=Math.floor(u),x=Math.floor(f),T=Math.min(_+1,s-1),M=Math.min(x+1,s-1);return Em(i.get(_,x),i.get(T,x),i.get(_,M),i.get(T,M),u-_,f-x)}const Dm={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class _h{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,u=!1,f=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return Nt(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const _=this.dim=i.height-2,x=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=s||"mapbox",this.borderReady=u,!u){for(let T=0;T<_;T++)x[this._idx(-1,T)]=x[this._idx(0,T)],x[this._idx(_,T)]=x[this._idx(_-1,T)],x[this._idx(T,-1)]=x[this._idx(T,0)],x[this._idx(T,_)]=x[this._idx(T,_-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(_,-1)]=x[this._idx(_-1,0)],x[this._idx(-1,_)]=x[this._idx(0,_-1)],x[this._idx(_,_)]=x[this._idx(_-1,_-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new gh(this)}get(e,i,s=!1){s&&(e=He(e,-1,this.dim),i=He(i,-1,this.dim));const u=4*this._idx(e,i);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return Dm[e]}get unpackVector(){return Dm[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,s){return(256*e*256+256*i+s)/10-1e4}_unpackTerrarium(e,i,s){return 256*e+i+s/256-32768}static pack(e,i){const s=[0,0,0,0],u=_h.getUnpackVector(i);let f=Math.floor((e+u[3])/u[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new Ps({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,f=i*this.dim+this.dim,_=s*this.dim,x=s*this.dim+this.dim;switch(i){case-1:u=f-1;break;case 1:f=u+1}switch(s){case-1:_=x-1;break;case 1:x=_+1}const T=-i*this.dim,M=-s*this.dim;for(let R=_;R<x;R++)for(let B=u;B<f;B++){const V=4*this._idx(B,R),te=4*this._idx(B+T,R+M);this.pixels[V+0]=e.pixels[te+0],this.pixels[V+1]=e.pixels[te+1],this.pixels[V+2]=e.pixels[te+2],this.pixels[V+3]=e.pixels[te+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ti(_h,"DEMData"),ti(gh,"DemMinMaxQuadTree",{omit:["dem"]});class qg{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,s){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const f={value:i,timeout:void 0};if(void 0!==s&&(f.timeout=setTimeout(()=>{this.remove(e,f)},s)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const s=e.wrapped().key,u=void 0===i?0:this.data[s].indexOf(i),f=this.data[s][u];return this.data[s].splice(u,1),f.timeout&&clearTimeout(f.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(f.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const s in this.data)for(const u of this.data[s])e(u.value)||i.push(u);for(const s of i)this.remove(s.value.tileID,s)}}class vu{constructor(e,i,s){this.func=e,this.mask=i,this.range=s}}vu.ReadOnly=!1,vu.ReadWrite=!0,vu.disabled=new vu(519,vu.ReadOnly,[0,1]);class ic{constructor(e,i,s,u,f,_){this.test=e,this.ref=i,this.mask=s,this.fail=u,this.depthFail=f,this.pass=_}}ic.disabled=new ic({func:519,mask:0},0,0,7680,7680,7680);class hl{constructor(e,i,s){this.blendFunction=e,this.blendColor=i,this.mask=s}}hl.Replace=[1,0],hl.disabled=new hl(hl.Replace,vt.transparent,[!1,!1,!1,!1]),hl.unblended=new hl(hl.Replace,vt.transparent,[!0,!0,!0,!0]),hl.alphaBlended=new hl([1,771],vt.transparent,[!0,!0,!0,!0]);class $a{constructor(e,i,s){this.enable=e,this.mode=i,this.frontFace=s}}$a.disabled=new $a(!1,1029,2305),$a.backCCW=new $a(!0,1029,2305),$a.backCW=new $a(!0,1029,2304),$a.frontCW=new $a(!0,1028,2304),$a.frontCCW=new $a(!0,1028,2305);class Ol extends Xn{constructor(e,i,s){super(),this.id=e,this._onlySymbols=s,i.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new qg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new wm,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const i in this._tiles){const s=this._tiles[i];this._source.prepareTile(s)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,s.tileID),s.upload(e),s.prepare(this.map.style.imageManager)}else for(const i in this._tiles){const s=this._tiles[i];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return me(this._tiles).map(e=>e.tileID).sort(ja).map(e=>e.key)}getRenderableIds(e){const i=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&i.push(this._tiles[s]);return e?i.sort((s,u)=>{const f=s.tileID,_=u.tileID,x=new ne(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),T=new ne(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-_.overscaledZ||T.y-x.y||T.x-x.x}).map(s=>s.tileID.key):i.map(s=>s.tileID).sort(ja).map(s=>s.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=i),this._loadTile(s,this._tileLoaded.bind(this,s,e,i)))}_tileLoaded(e,i,s,u){if(u)if(e.state="errored",404!==u.status)this._source.fire(new Hn(u,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=lt.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Rn("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let u=0;u<i.length;u++){const f=i[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const _=this.getTileByID(f);s(e,_),s(_,e)}}function s(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let _=f.tileID.canonical.x-u.tileID.canonical.x;const x=f.tileID.canonical.y-u.tileID.canonical.y,T=Math.pow(2,u.tileID.canonical.z),M=f.tileID.key;0===_&&0===x||Math.abs(x)>1||(Math.abs(_)>1&&(1===Math.abs(_+T)?_+=T:1===Math.abs(_-T)&&(_-=T)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,_,x),u.neighboringTiles&&u.neighboringTiles[M]&&(u.neighboringTiles[M].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,s,u){for(const f in this._tiles){let _=this._tiles[f];if(u[f]||!_.hasData()||_.tileID.overscaledZ<=i||_.tileID.overscaledZ>s)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>i+1;){const M=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[M.key],_&&_.hasData()&&(x=M)}let T=x;for(;T.overscaledZ>i;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){u[x.key]=x;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=i?s:null}for(let s=e.overscaledZ-1;s>=i;s--){const u=e.scaledTo(s),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const s=Math.ceil(e.width/i)+1,u=Math.ceil(e.height/i)+1,f=Math.floor(s*u*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,f):f,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(e){const i=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,i){const s={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+i),s[f.tileID.key]=f}this._tiles=s;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,i,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let u;this.updateCacheSize(e,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Vs(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(u=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(x=>this._source.hasTile(x)))):u=[];const f=this._updateRetainedTiles(u);if(bu(this._source.type)&&0!==u.length){const x={},T={},M=Object.keys(f);for(const B of M){const V=f[B],te=this._tiles[B];if(!te||te.fadeEndTime&&te.fadeEndTime<=lt.now())continue;const he=this.findLoadedParent(V,Math.max(V.overscaledZ-Ol.maxOverzooming,this._source.minzoom));he&&(this._addTile(he.tileID),x[he.tileID.key]=he.tileID),T[B]=V}const R=u[u.length-1].overscaledZ;for(const B in this._tiles){const V=this._tiles[B];if(f[B]||!V.hasData())continue;let te=V.tileID;for(;te.overscaledZ>R;){te=te.scaledTo(te.overscaledZ-1);const he=this._tiles[te.key];if(he&&he.hasData()&&T[te.key]){f[B]=V.tileID;break}}}for(const B in x)f[B]||(this._coveredTiles[B]=!0,f[B]=x[B])}for(const x in f)this._tiles[x].clearFadeHold();const _=function(x,T){const M=[];for(const R in x)R in T||M.push(R);return M}(this._tiles,f);for(const x of _){const T=this._tiles[x];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(0===e.length)return i;const s={},u=e.reduce((M,R)=>Math.min(M,R.overscaledZ),1/0),f=e[0].overscaledZ,_=Math.max(f-Ol.maxOverzooming,this._source.minzoom),x=Math.max(f+Ol.maxUnderzooming,this._source.minzoom),T={};for(const M of e){const R=this._addTile(M);i[M.key]=M,R.hasData()||u<this._source.maxzoom&&(T[M.key]=M)}this._retainLoadedChildren(T,u,x,i);for(const M of e){let R=this._tiles[M.key];if(R.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const V=M.children(this._source.maxzoom)[0],te=this.getTile(V);if(te&&te.hasData()){i[V.key]=V;continue}}else{const V=M.children(this._source.maxzoom);if(i[V[0].key]&&i[V[1].key]&&i[V[2].key]&&i[V[3].key])continue}let B=R.wasRequested();for(let V=M.overscaledZ-1;V>=_;--V){const te=M.scaledTo(V);if(s[te.key]||(s[te.key]=!0,R=this.getTile(te),!R&&B&&(R=this._addTile(te)),R&&(i[te.key]=te,B=R.wasRequested(),R.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let s,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){s=this._loadedParentTiles[u.key];break}i.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(s=this._getLoadedTile(f),s)break;u=f}for(const f of i)this._loadedParentTiles[f]=s}}_addTile(e){let i=this._tiles[e.key];if(i)return this._source.prepareTile&&this._source.prepareTile(i),i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const s=Boolean(i);if(!s){const u=this.map?this.map.painter:null;i=new fh(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._source.prepareTile&&this._source.prepareTile(i)||this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,s||this._source.fire(new Rn("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=i.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&"reloading"!==i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,s){const u=[],f=this.transform;if(!f)return u;for(const _ in this._tiles){const x=this._tiles[_];if(s&&x.clearQueryDebugViz(),x.holdingForFade())continue;const T=e.containsTile(x,f,i);T&&u.push(T)}return u}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of i)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(bu(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=lt.now())return!0}return!1}setFeatureState(e,i,s){this._state.updateState(e=e||"_geojsonTileLayer",i,s)}removeFeatureState(e,i,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,s)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,s){const u=this._tiles[e];u&&u.setDependencies(i,s)}reloadTilesForDependencies(e,i){for(const s in this._tiles)this._tiles[s].hasDependency(e,i)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,i))}_preloadTiles(e,i){const s=new Map,u=Array.isArray(e)?e:[e],f=this.map.painter.terrain,_=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const x of u){const T=x.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const M of T)s.set(M.key,M);this.usedForTerrain&&x.updateElevation(!1)}ve(Array.from(s.values()),(x,T)=>{const M=new fh(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(M,R=>{"raster-dem"===this._source.type&&M.dem&&this._backfillDEM(M),T(R,M)})},i)}}function ja(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||s-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function bu(n){return"raster"===n||"image"===n||"video"===n}Ol.maxOverzooming=10,Ol.maxUnderzooming=3;class is{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const u=s||e.findDEMTileFor(i);if(!u||!u.dem)return;const f=u.dem,_=u.tileID,x=1<<i.canonical.z-_.canonical.z;return new is(u,u.tileSize/Zi/x,[(i.canonical.x/x-_.canonical.x)*f.dim,(i.canonical.y/x-_.canonical.y)*f.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(s);return new ne(u,f)}getElevationAt(e,i,s,u){const f=e*this._scale+this._offset[0],_=i*this._scale+this._offset[1],x=Math.floor(f),T=Math.floor(_),M=this._dem;return u=!!u,s?ai(ai(M.get(x,T,u),M.get(x,T+1,u),_-T),ai(M.get(x+1,T,u),M.get(x+1,T+1,u),_-T),f-x):M.get(x,T,u)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Zu(1,e)*this._dem.stride}}class rc{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ys(Zi,16,0),this.featureIndexArray=new co,this.promoteId=i}insert(e,i,s,u,f,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,f,_);const T=this.grid;for(let M=0;M<i.length;M++){const R=i[M],B=[1/0,1/0,-1/0,-1/0];for(let V=0;V<R.length;V++){const te=R[V];B[0]=Math.min(B[0],te.x),B[1]=Math.min(B[1],te.y),B[2]=Math.max(B[2],te.x),B[3]=Math.max(B[3],te.y)}B[0]<Zi&&B[1]<Zi&&B[2]>=0&&B[3]>=0&&T.insert(x,B[0],B[1],B[2],B[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Sc.VectorTile(new oh(this.rawTileData)).layers,this.sourceLayerCoder=new bm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,s,u){this.loadVTLayers();const f=e.params||{},_=kr(f.filter),x=e.tileResult,T=e.transform,M=x.bufferedTilespaceBounds,R=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(he,Ce,ze,Ke)=>Lh(x.bufferedTilespaceGeometry,he,Ce,ze,Ke));R.sort(Ta);let B=null;T.elevation&&R.length>0&&(B=is.create(T.elevation,this.tileID));const V={};let te;for(let he=0;he<R.length;he++){const Ce=R[he];if(Ce===te)continue;te=Ce;const ze=this.featureIndexArray.get(Ce);let Ke=null;this.loadMatchingFeature(V,ze,_,f.layers,f.availableImages,i,s,u,(yt,St,zt,Vt=0)=>(Ke||(Ke=oo(yt,this.tileID.canonical,e.tileTransform)),St.queryIntersectsFeature(x,yt,zt,Ke,this.z,e.transform,e.pixelPosMatrix,B,Vt)))}return V}loadMatchingFeature(e,i,s,u,f,_,x,T,M){const{featureIndex:R,bucketIndex:B,sourceLayerIndex:V,layoutVertexArrayOffset:te}=i,he=this.bucketLayerIDs[B];if(u&&!function(yt,St){for(let zt=0;zt<yt.length;zt++)if(St.indexOf(yt[zt])>=0)return!0;return!1}(u,he))return;const Ce=this.sourceLayerCoder.decode(V),ze=this.vtLayers[Ce].feature(R);if(s.needGeometry){const yt=Ec(ze,!0);if(!s.filter(new Gr(this.tileID.overscaledZ),yt,this.tileID.canonical))return}else if(!s.filter(new Gr(this.tileID.overscaledZ),ze))return;const Ke=this.getId(ze,Ce);for(let yt=0;yt<he.length;yt++){const St=he[yt];if(u&&u.indexOf(St)<0)continue;const zt=_[St];if(!zt)continue;let Vt={};void 0!==Ke&&T&&(Vt=T.getState(zt.sourceLayer||"_geojsonTileLayer",Ke));const jt=Ze({},x[St]);jt.paint=bd(jt.paint,zt.paint,ze,Vt,f),jt.layout=bd(jt.layout,zt.layout,ze,Vt,f);const sn=!M||M(ze,zt,Vt,te);if(!sn)continue;const an=new jg(ze,this.z,this.x,this.y,Ke);an.layer=jt;let In=e[St];void 0===In&&(In=e[St]=[]),In.push({featureIndex:R,feature:an,intersectionZ:sn})}}lookupSymbolFeatures(e,i,s,u,f,_,x,T){const M={};this.loadVTLayers();const R=kr(f);for(const B of e)this.loadMatchingFeature(M,{bucketIndex:s,sourceLayerIndex:u,featureIndex:B,layoutVertexArrayOffset:0},R,_,x,T,i);return M}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),f=this.vtFeatures[u];if(f[i])return f[i];const _=this.vtLayers[u].feature(i);return f[i]=_,_}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;return this.promoteId&&(s=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[i]],"boolean"==typeof s&&(s=Number(s))),s}}function bd(n,e,i,s,u){return _t(n,(f,_)=>{const x=e instanceof C?e.get(_):null;return x&&x.evaluate?x.evaluate(i,s,u):x})}function Ta(n,e){return e-n}ti(rc,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class yh{constructor(e){const i={},s=[];for(const x in e){const T=e[x],M=i[x]={};for(const R in T.glyphs){const B=T.glyphs[+R];if(!B||0===B.bitmap.width||0===B.bitmap.height)continue;const V=B.metrics.localGlyph?2:1,te={x:0,y:0,w:B.bitmap.width+2*V,h:B.bitmap.height+2*V};s.push(te),M[R]=te}}const{w:u,h:f}=ec(s),_=new ta({width:u||1,height:f||1});for(const x in e){const T=e[x];for(const M in T.glyphs){const R=T.glyphs[+M];if(!R||0===R.bitmap.width||0===R.bitmap.height)continue;const B=i[x][M],V=R.metrics.localGlyph?2:1;ta.copy(R.bitmap,_,{x:0,y:0},{x:B.x+V,y:B.y+V},R.bitmap)}}this.image=_,this.positions=i}}ti(yh,"GlyphAtlas");class wu{constructor(e){this.tileID=new Vs(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Fc(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,s,u,f){this.status="parsing",this.data=e,this.collisionBoxArray=new As;const _=new bm(Object.keys(e.layers).sort()),x=new rc(this.tileID,this.promoteId);x.bucketLayerIDs=[];const T={},M=new _d(256,256),R={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:M,availableImages:s},B=i.familiesBySource[this.source];for(const Vt in B){const jt=e.layers[Vt];if(!jt)continue;let sn=!1,an=!1;for(const tn of B[Vt])"symbol"===tn[0].type?sn=!0:an=!0;if(!0===this.isSymbolTile&&!sn||!1===this.isSymbolTile&&!an)continue;1===jt.version&&Nt(`Vector tile source "${this.source}" layer "${Vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const In=_.encode(Vt),An=[];for(let tn=0;tn<jt.length;tn++){const vn=jt.feature(tn),On=x.getId(vn,Vt);An.push({feature:vn,id:On,index:tn,sourceLayerIndex:In})}for(const tn of B[Vt]){const vn=tn[0];void 0!==this.isSymbolTile&&"symbol"===vn.type!==this.isSymbolTile||vn.minzoom&&this.zoom<Math.floor(vn.minzoom)||vn.maxzoom&&this.zoom>=vn.maxzoom||"none"!==vn.visibility&&(oc(tn,this.zoom,s),(T[vn.id]=vn.createBucket({index:x.bucketLayerIDs.length,layers:tn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:In,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:s})).populate(An,R,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(tn.map(On=>On.id)))}}let V,te,he,Ce;M.trim();const ze={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ke=_t(R.glyphDependencies,Vt=>Object.keys(Vt).map(Number));Object.keys(Ke).length?u.send("getGlyphs",{uid:this.uid,stacks:Ke},(Vt,jt)=>{V||(V=Vt,te=jt,zt.call(this))},void 0,!1,ze):te={};const yt=Object.keys(R.iconDependencies);yt.length?u.send("getImages",{icons:yt,source:this.source,tileID:this.tileID,type:"icons"},(Vt,jt)=>{V||(V=Vt,he=jt,zt.call(this))},void 0,!1,ze):he={};const St=Object.keys(R.patternDependencies);function zt(){if(V)return f(V);if(te&&he&&Ce){const Vt=new yh(te),jt=new Lc(he,Ce);for(const sn in T){const an=T[sn];an instanceof Ml?(oc(an.layers,this.zoom,s),kg(an,te,Vt.positions,he,jt.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):an.hasPattern&&(an instanceof Pc||an instanceof sd||an instanceof Kl)&&(oc(an.layers,this.zoom,s),an.addFeatures(R,this.tileID.canonical,jt.patternPositions,s,this.tileTransform))}this.status="done",f(null,{buckets:me(T).filter(sn=>!sn.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Vt.image,lineAtlas:M,imageAtlas:jt,glyphMap:this.returnDependencies?te:null,iconMap:this.returnDependencies?he:null,glyphPositions:this.returnDependencies?Vt.positions:null})}}St.length?u.send("getImages",{icons:St,source:this.source,tileID:this.tileID,type:"patterns"},(Vt,jt)=>{V||(V=Vt,Ce=jt,zt.call(this))},void 0,!1,ze):Ce={},zt.call(this)}}function oc(n,e,i){const s=new Gr(e);for(const u of n)u.recalculate(s,i)}class Nc{constructor(e){this.entries={},this.scheduler=e}request(e,i,s,u){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[_,x]=f.result;return this.scheduler?this.scheduler.add(()=>{u(_,x)},i):u(_,x),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=s((_,x)=>{f.result=[_,x];for(const T of f.callbacks)this.scheduler?this.scheduler.add(()=>{T(_,x)},i):T(_,x);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(_=>_!==u),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function Uc(n,e,i){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},u=>{const f=pe(n.request,(_,x,T,M)=>{_?u(_):x&&u(null,{vectorTile:i?void 0:new Sc.VectorTile(new oh(x)),rawData:x,cacheControl:T,expires:M})});return()=>{f.cancel(),u()}},e)}const Cu=ka(new Float32Array(16));class pa{constructor(e){this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Vr(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i){return e._coordinatePoint(e.locationCoordinate(i),!1)}pixelsPerMeter(e,i){return Zu(1,e)*i}farthestPixelDistance(e){return function(i,s){const u=i.fovAboveCenter,f=i.elevation?i.elevation.getMinElevationBelowMSL()*s:0,_=(i._camera.position[2]*i.worldSize-f)/Math.cos(i._pitch),x=Math.sin(u)*_/Math.sin(Math.max(Math.PI/2-i._pitch-u,.01)),T=Math.sin(i._pitch)*x+_;return Math.min(1.01*T,_*(1/i._horizonShift))}(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,u){const f=e.horizonLineFromTop(!1),_=new ne(i,Math.max(f,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,u))}createInversionMatrix(e,i){return Cu}createTileMatrix(e,i,s){let u,f,_;const x=s.canonical,T=ka(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=Fc(x,this);u=1,f=M.x+s.wrap*M.scale,_=M.y,sl(T,T,[u/M.scale,u/M.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(x.z),f=(x.x+Math.pow(2,x.z)*s.wrap)*u,_=x.y*u;return Dc(T,T,[f,_,0]),sl(T,T,[u/Zi,u/Zi,1]),T}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1,metersToLabelSpace:1}}}class Tu extends pa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Tc(e),y:ju(i),z:0}}unproject(e,i){const s=da(e),u=us(i);return new Vr(s,u)}}class Eu extends pa{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(se(i));this.n=(u+Math.sin(se(s)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c:u,r0:f}=this,_=se(e-this.center[0]),x=se(i),T=Math.sqrt(u-2*s*Math.sin(x))/s;return{x:T*Math.sin(_*s),y:T*Math.cos(_*s)-f,z:0}}unproject(e,i){const{n:s,c:u,r0:f}=this,_=f+i;let x=Math.atan2(e,Math.abs(_))*Math.sign(_);_*s<0&&(x-=Math.PI*Math.sign(e)*Math.sign(_));const T=se(this.center[0])*s;x=Qe(x,-Math.PI-T,Math.PI-T);const M=Ie(x/s)+this.center[0],R=Math.asin(He((u-(e*e+_*_)*s*s)/(2*s),-1,1)),B=He(Ie(R),-85.051129,ol);return new Vr(M,B)}}const pl=1.340264,Du=-.081106,Iu=893e-6,Mu=.003796,wd=Math.sqrt(3)/2;class Im extends pa{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(wd*Math.sin(i)),u=s*s,f=u*u*u;return{x:.5*(e*Math.cos(s)/(wd*(pl+3*Du*u+f*(7*Iu+9*Mu*u)))/Math.PI+.5),y:1-.5*(s*(pl+Du*u+f*(Iu+Mu*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,u=s*s,f=u*u*u;for(let R,B,V,te=0;te<12&&(B=s*(pl+Du*u+f*(Iu+Mu*u))-i,V=pl+3*Du*u+f*(7*Iu+9*Mu*u),R=B/V,s=He(s-R,-Math.PI/3,Math.PI/3),u=s*s,f=u*u*u,!(Math.abs(R)<1e-12));++te);const _=wd*e*(pl+3*Du*u+f*(7*Iu+9*Mu*u))/Math.cos(s),x=Math.asin(Math.sin(s)/wd),T=He(180*_/Math.PI,-180,180),M=He(180*x/Math.PI,-85.051129,ol);return new Vr(T,M)}}class Mm extends pa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),u=He(360*(.5-i),-85.051129,ol);return new Vr(s,u)}}const Vc=Math.PI/2;function Cd(n){return Math.tan((Vc+n)/2)}class Am extends pa{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30],u=se(i),f=se(s),_=Math.cos(u);this.n=u===f?Math.sin(u):Math.log(_/Math.cos(f))/Math.log(Cd(f)/Cd(u)),this.f=_*Math.pow(Cd(u),this.n)/this.n}project(e,i){i=se(i),e=se(e-this.center[0]);const s=1e-6,{n:u,f}=this;f>0?i<-Vc+s&&(i=-Vc+s):i>Vc-s&&(i=Vc-s);const _=f/Math.pow(Cd(i),u),x=_*Math.sin(u*e),T=f-_*Math.cos(u*e);return{x:.5*(x/Math.PI+.5),y:1-.5*(T/Math.PI+.5),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,i=(2*(1-i)-.5)*Math.PI;const{n:s,f:u}=this,f=u-i,_=Math.sign(f),x=Math.sign(s)*Math.sqrt(e*e+f*f);let T=Math.atan2(e,Math.abs(f))*_;f*s<0&&(T-=Math.PI*Math.sign(e)*_);const M=He(Ie(T/s)+this.center[0],-180,180),R=He(Ie(2*Math.atan(Math.pow(u/x,1/s))-Vc),-85.051129,ol);return new Vr(M,R)}}const Sm=se(ol);class Pm extends pa{project(e,i){const s=(i=se(i))*i,u=s*s;return{x:.5*((e=se(e))*(.8707-.131979*s+u*(u*(.003971*s-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+u*(.028874*s-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,u=25,f=0,_=s*s;do{_=s*s;const M=_*_;f=(s*(1.007226+_*(.015085+M*(.028874*_-.044475-.005916*M)))-i)/(1.007226+_*(.045255+M*(.259866*_-.311325-.005916*11*M))),s=He(s-f,-Sm,Sm)}while(Math.abs(f)>1e-6&&--u>0);_=s*s;const x=He(Ie(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),T=Ie(s);return new Vr(x,T)}}const Om=se(ol);class Lm extends pa{project(e,i){i=se(i),e=se(e);const s=Math.cos(i),u=2/Math.PI,f=Math.acos(s*Math.cos(e/2)),_=Math.sin(f)/f,x=.5*(e*u+2*s*Math.sin(e/2)/_)||0,T=.5*(i+Math.sin(i)/_)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,f=25;const _=1e-6;let x=0,T=0;do{const M=Math.cos(u),R=Math.sin(u),B=2*R*M,V=R*R,te=M*M,he=Math.cos(s/2),Ce=Math.sin(s/2),ze=2*he*Ce,Ke=Ce*Ce,yt=1-te*he*he,St=yt?1/yt:0,zt=yt?Math.acos(M*he)*Math.sqrt(1/yt):0,Vt=.5*(2*zt*M*Ce+2*s/Math.PI)-e,jt=.5*(zt*R+u)-i,sn=.5*St*(te*Ke+zt*M*he*V)+1/Math.PI,an=St*(ze*B/4-zt*R*Ce),In=.125*St*(B*Ce-zt*R*te*ze),An=.5*St*(V*he+zt*Ke*M)+.5,tn=an*In-An*sn;x=(jt*an-Vt*An)/tn,T=(Vt*In-jt*sn)/tn,s=He(s-x,-Math.PI,Math.PI),u=He(u-T,-Om,Om)}while((Math.abs(x)>_||Math.abs(T)>_)&&--f>0);return new Vr(Ie(s),Ie(u))}}class Op extends pa{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(se(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:u}=this;return{x:se(e)*u*s+.5,y:-Math.sin(se(i))/u*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:u}=this,f=-(i-.5)/s,_=He(Ie((e-.5)/s)/u,-180,180),x=Math.asin(He(f*u,-1,1)),T=He(Ie(x),-85.051129,ol);return new Vr(_,T)}}l.ARRAY_TYPE=zs,l.AUTH_ERR_MSG=ri,l.Aabb=Ns,l.Actor=class{constructor(n,e,i){this.target=n,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Be(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ht()?n:ge,this.scheduler=new fm}send(n,e,i,s,u=!1,f){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=f,this.callbacks[_]=i);const x=Tn(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:n,hasCallback:!!i,targetMapId:s,mustQueue:u,sourceMapId:this.mapId,data:yl(e,x)},x),{cancel:()=>{i&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(n){const e=n.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[i];delete this.cancelCallbacks[i],s&&s.cancel()}else if(e.mustQueue||ht()){const s=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),s&&s.metadata||{type:"message"})}else this.processTask(i,e)}processTask(n,e){if("<response>"===e.type){const i=this.callbacks[n];delete this.callbacks[n],i&&(e.error?i(la(e.error)):i(null,la(e.data)))}else{const i=Tn(this.globalScope)?void 0:[],s=e.hasCallback?(f,_)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:f?yl(f):null,data:yl(_,i)},i)}:f=>{},u=la(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,s);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],u.source)[f[1]](u,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.CanonicalTileID=ph,l.Color=vt,l.ColorMode=hl,l.CullFaceMode=$a,l.DEMData=_h,l.DataConstantProperty=I,l.DedupedRequest=Nc,l.DepthMode=vu,l.EXTENT=Zi,l.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,u=Math.floor(n.x),f=Math.floor((n.x-u)*s),_=Math.floor(n.y*s),x=this.findDEMTileFor(new Vs(i,u,i,f,_));return!(!x||!x.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){null==e&&(e=null);const s=this._source();if(!s||n.y<0||n.y>1)return e;const u=s.getSource().maxzoom,f=1<<u,_=Math.floor(n.x),x=n.x-_,T=new Vs(u,_,u,Math.floor(x*f),Math.floor(n.y*f)),M=this.findDEMTileFor(T);if(!M||!M.dem)return e;const R=M.dem,B=1<<M.tileID.canonical.z,V=(x*B-M.tileID.canonical.x)*R.dim,te=(n.y*B-M.tileID.canonical.y)*R.dim,he=Math.floor(V),Ce=Math.floor(te);return(i?this.exaggeration():1)*ai(ai(R.get(he,Ce),R.get(he,Ce+1),te-Ce),ai(R.get(he+1,Ce),R.get(he+1,Ce+1),te-Ce),V-he)}getAtTileOffset(n,e,i){const s=1<<n.canonical.z;return this.getAtPointOrZero(new Fd(n.wrap+(n.canonical.x+e/Zi)/s,(n.canonical.y+i/Zi)/s))}getAtTileOffsetFunc(n,e,i,s){return u=>{const f=this.getAtTileOffset(n,u.x,u.y),_=s.upVector(n.canonical,u.x,u.y);return qu(_,_,f*s.upVectorScale(n.canonical,e,i).metersToTile),_}}getForTilePoints(n,e,i,s){const u=is.create(this,n,s);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(n){const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,u=1<<n.canonical.z-s.canonical.z;let f=n.canonical.x/u-s.canonical.x,_=n.canonical.y/u-s.canonical.y,x=0;for(let T=0;T<n.canonical.z-s.canonical.z&&!i.leaves[x];T++){f*=2,_*=2;const M=2*Math.floor(_)+Math.floor(f);x=i.childOffsets[x]+M,f%=1,_%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},l.ErrorEvent=Hn,l.EvaluationParameters=Gr,l.Event=Rn,l.Evented=Xn,l.FillExtrusionBucket=Kl,l.Frustum=Ku,l.GLOBE_RADIUS=_u,l.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n),this._createAtmosphere(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(n){const e=new rt,i=new ci,s=65;for(let u=0;u<s;u++)for(let f=0;f<s;f++)e.emplaceBack(f,u);for(let u=0;u<64;u++)for(let f=0;f<64;f++){const _=u*s+f;i.emplaceBack(_+1,_,_+s),i.emplaceBack(_+s,_+s+1,_+1)}this._gridBuffer=n.createVertexBuffer(e,vd.members),this._gridIndexBuffer=n.createIndexBuffer(i,!0),this._gridSegments=go.simpleSegment(0,0,4225,8192)}_createPoles(n){const e=new ci;for(let u=0;u<=64;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new Ei,s=new Ei;this._poleSegments=[];for(let u=0,f=0;u<5;u++){const _=1<<u,x=512*_/Math.PI/2,T=360/_;i.emplaceBack(0,-x,0,0,0,.5,0),s.emplaceBack(0,-x,0,0,0,.5,1);for(let M=0;M<=64;M++){const R=M/64,B=ai(0,T,R),[V,te,he]=vm(Vg,$g,B,x);i.emplaceBack(V,te,he,0,0,R,0),s.emplaceBack(V,te,he,0,0,R,1)}this._poleSegments.push(go.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,_m,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(s,_m,!1)}_createAtmosphere(n){const e=new qi;e.emplaceBack(-1,1,1,0,0),e.emplaceBack(1,1,1,1,0),e.emplaceBack(1,-1,1,1,1),e.emplaceBack(-1,-1,1,0,1);const i=new ci;i.emplaceBack(0,1,2),i.emplaceBack(2,3,0),this.atmosphereVertexBuffer=n.createVertexBuffer(e,gm.members),this.atmosphereIndexBuffer=n.createIndexBuffer(i),this.atmosphereSegments=go.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n){if(!this._wireframeSegments){const e=new Fi,i=64,s=i+1;for(let u=0;u<i;u++)for(let f=0;f<i;f++){const _=u*s+f;e.emplaceBack(_,_+1),e.emplaceBack(_,_+s),e.emplaceBack(_,_+s+1)}this._wireframeIndexBuffer=n.createIndexBuffer(e),this._wireframeSegments=go.simpleSegment(0,0,i*i,e.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},l.GlyphManager=kc,l.ImagePosition=Oc,l.LineAtlas=_d,l.LngLat=Vr,l.LngLatBounds=Cc,l.LocalGlyphMode=up,l.MAX_MERCATOR_LATITUDE=ol,l.MercatorCoordinate=Fd,l.ONE_EM=24,l.OverscaledTileID=Vs,l.Properties=ae,l.RGBAImage=Ps,l.Ray=class{constructor(n,e){this.pos=n,this.dir=e}intersectsPlane(n,e,i){const s=Yu(e,this.dir);if(Math.abs(s)<1e-6)return!1;const u=((n[0]-this.pos[0])*e[0]+(n[1]-this.pos[1])*e[1]+(n[2]-this.pos[2])*e[2])/s;return i[0]=this.pos[0]+this.dir[0]*u,i[1]=this.pos[1]+this.dir[1]*u,i[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(n,e,i){if(he=(V=this.pos)[0],Ce=V[1],ze=V[2],Ke=(te=n)[0],yt=te[1],St=te[2],Math.abs(he-Ke)<=Rh*Math.max(1,Math.abs(he),Math.abs(Ke))&&Math.abs(Ce-yt)<=Rh*Math.max(1,Math.abs(Ce),Math.abs(yt))&&Math.abs(ze-St)<=Rh*Math.max(1,Math.abs(ze),Math.abs(St))||0===e)return i[0]=i[1]=i[2]=0,!1;var V,te,he,Ce,ze,Ke,yt,St;const[s,u,f]=this.dir,_=this.pos[0]-n[0],x=this.pos[1]-n[1],T=this.pos[2]-n[2],M=s*s+u*u+f*f,R=2*(_*s+x*u+T*f),B=R*R-4*M*(_*_+x*x+T*T-e*e);if(B<0){const V=Math.max(-R/2,0),te=_+s*V,he=x+u*V,Ce=T+f*V,ze=Math.hypot(te,he,Ce);return i[0]=te*e/ze,i[1]=he*e/ze,i[2]=Ce*e/ze,!1}{const V=(-R-Math.sqrt(B))/(2*M);if(V<0){const te=Math.hypot(_,x,T);return i[0]=_*e/te,i[1]=x*e/te,i[2]=T*e/te,!1}return i[0]=_+s*V,i[1]=x+u*V,i[2]=T+f*V,!0}}},l.RequestManager=class{constructor(n,e,i){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Hi,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!on(n))return n;const i=dt(n);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!on(n))return n;const i=dt(n);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(n,e){if(!on(n))return n;const i=dt(n);return i.path=`/v4/${i.authority}.json`,i.params.push("secure"),this._makeAPIURL(i,this._customAccessToken||e)}normalizeSpriteURL(n,e,i,s){const u=dt(n);return on(n)?(u.path=`/styles/v1${u.path}/sprite${e}${i}`,this._makeAPIURL(u,this._customAccessToken||s)):(u.path+=`${e}${i}`,Wt(u))}normalizeTileURL(n,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!on(n))return n;const s=dt(n);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==s.authority&&512===i?"@2x":""}${yi.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${En.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${En.TILE_URL_VERSION}${s.path}`);const u=this._customAccessToken||function(f){for(const _ of f){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(s.params)||En.ACCESS_TOKEN;return En.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,u)}canonicalizeTileURL(n,e){const i=dt(n);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return n;let s="mapbox://";i.path.match(/^\/raster\/v1\//)?s+=`raster/${i.path.replace(`/${En.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${i.path.replace(`/${En.TILE_URL_VERSION}/`,"")}`;let u=i.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(s+=`?${u.join("&")}`),s}canonicalizeTileset(n,e){const i=!!e&&on(e),s=[];for(const u of n.tiles||[])It(u)?s.push(this.canonicalizeTileURL(u,i)):s.push(u);return s}_makeAPIURL(n,e){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",s=dt(En.API_URL);if(n.protocol=s.protocol,n.authority=s.authority,"http"===n.protocol){const u=n.params.indexOf("secure");u>=0&&n.params.splice(u,1)}if("/"!==s.path&&(n.path=`${s.path}${n.path}`),!En.REQUIRE_ACCESS_TOKEN)return Wt(n);if(e=e||En.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return n.params=n.params.filter(u=>-1===u.indexOf("access_token")),n.params.push(`access_token=${e||""}`),Wt(n)}},l.ResourceType=je,l.SegmentVector=go,l.SourceCache=Ol,l.StencilMode=ic,l.StructArrayLayout1ui2=hr,l.StructArrayLayout2f1f2i16=li,l.StructArrayLayout2i4=rt,l.StructArrayLayout2ui4=Fi,l.StructArrayLayout3f12=Un,l.StructArrayLayout3ui6=ci,l.StructArrayLayout4i8=mt,l.Texture=gu,l.Tile=fh,l.Transitionable=p,l.Uniform1f=Ld,l.Uniform1i=class extends Cl{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},l.Uniform2f=class extends Cl{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},l.Uniform3f=class extends Cl{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},l.Uniform4f=tf,l.UniformColor=nf,l.UniformMatrix2f=class extends Cl{constructor(n,e){super(n,e),this.current=Xm}set(n){for(let e=0;e<4;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},l.UniformMatrix3f=class extends Cl{constructor(n,e){super(n,e),this.current=Bu}set(n){for(let e=0;e<9;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},l.UniformMatrix4f=class extends Cl{constructor(n,e){super(n,e),this.current=ql}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},l.UnwrappedTileID=Mp,l.ValidationError=Zn,l.VectorTileWorkerSource=class extends Xn{constructor(n,e,i,s,u){super(),this.actor=n,this.layerIndex=e,this.availableImages=i,this.loadVectorData=u||Uc,this.loading={},this.loaded={},this.deduped=new Nc(n.scheduler),this.isSpriteLoaded=s,this.scheduler=n.scheduler}loadTile(n,e){const i=n.uid,s=n&&n.request,u=s&&s.collectResourceTiming,f=this.loading[i]=new wu(n);f.abort=this.loadVectorData(n,(_,x)=>{const T=!this.loading[i];if(delete this.loading[i],T||_||!x)return f.status="done",T||(this.loaded[i]=f),e(_);const M=x.rawData,R={};x.expires&&(R.expires=x.expires),x.cacheControl&&(R.cacheControl=x.cacheControl),f.vectorTile=x.vectorTile||new Sc.VectorTile(new oh(M));const B=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(V,te)=>{if(V||!te)return e(V);const he={};if(u){const Ce=dh(s);Ce.length>0&&(he.resourceTiming=JSON.parse(JSON.stringify(Ce)))}e(null,Ze({rawTileData:M.slice(0)},te,R,he))})};this.isSpriteLoaded?B():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(B,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):B()}),this.loaded=this.loaded||{},this.loaded[i]=f})}reloadTile(n,e){const i=this.loaded,s=n.uid,u=this;if(i&&i[s]){const f=i[s];f.showCollisionBoxes=n.showCollisionBoxes,f.enableTerrain=!!n.enableTerrain,f.projection=n.projection,f.tileTransform=Fc(n.tileID.canonical,n.projection);const _=(x,T)=>{const M=f.reloadCallback;M&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,M)),e(x,T)};"parsing"===f.status?f.reloadCallback=_:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(n,e){const i=n.uid,s=this.loading[i];s&&(s.abort&&s.abort(),delete this.loading[i]),e()}removeTile(n,e){const i=this.loaded,s=n.uid;i&&i[s]&&delete i[s],e()}},l.WritingMode=ha,l.ZoomHistory=z,l.add=gf,l.addDynamicAttributes=um,l.adjoint=function(n,e){var i=e[0],s=e[1],u=e[2],f=e[3],_=e[4],x=e[5],T=e[6],M=e[7],R=e[8];return n[0]=_*R-x*M,n[1]=u*M-s*R,n[2]=s*x-u*_,n[3]=x*T-f*R,n[4]=i*R-u*T,n[5]=u*f-i*x,n[6]=f*M-_*T,n[7]=s*T-i*M,n[8]=i*_-s*f,n},l.asyncAll=ve,l.bezier=Ne,l.bindAll=Be,l.boundsAttributes=Gg,l.bufferConvexPolygon=function(n,e){const i=[];for(let s=0;s<n.length;s++){const u=Qe(s-1,-1,n.length-1),f=Qe(s+1,-1,n.length-1),_=n[s],x=n[f],T=n[u].sub(_).unit(),M=x.sub(_).unit(),R=M.angleWithSep(T.x,T.y),B=T.add(M).unit().mult(-1*e/Math.sin(R/2));i.push(_.add(B))}return i},l.cacheEntryPossiblyAdded=function(n){Ci++,Ci>Oi&&(n.getActor().send("enforceCacheSizeLimit",$i),Ci=0)},l.calculateGlobeLabelMatrix=function(n,e){const{lng:i,lat:s}=n._center,u=Ep(0,0,n.worldSize/n._projectionScaler,i,s);return kh(u,u,function(f){const _=ka(new Float64Array(16)),x=1/xd(f);return Dc(_,_,f.min),sl(_,_,[x,x,x]),_}(ul(e)))},l.calculateGlobeMatrix=Dp,l.calculateGlobeMercatorMatrix=function(n){const e=n.worldSize,i=n.point,s=Zu(1,n.center.lat)*e,u=n.pixelsPerMeter,f=e/(s/n.pixelsPerMeter),_=ka(new Float64Array(16));return Dc(_,_,[i.x,i.y,0]),sl(_,_,[f,f,u]),Float32Array.from(_)},l.circumferenceAtLatitude=$u,l.clamp=He,l.clearTileCache=function(n){const e=ge.caches.delete(Di);n&&e.catch(n).then(()=>n())},l.clipLine=ah,l.clone=function(n){var e=new zs(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},l.clone$1=xn,l.collisionCircleLayout=ny,l.config=En,l.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},l.create=function(){var n=new zs(16);return zs!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},l.create$1=ff,l.createExpression=pi,l.createLayout=at,l.createStyleLayer=function(n){return"custom"===n.type?new Fg(n):new bp[n.type](n)},l.cross=vf,l.degToRad=se,l.div=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},l.dot=Yu,l.earthRadius=sf,l.ease=ke,l.easeCubicInOut=Ue,l.emitValidationErrors=Aa,l.endsWith=st,l.enforceCacheSizeLimit=function(n){Wr(),xi&&xi.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-n;s++)e.delete(i[s])})})},l.evaluateSizeForFeature=ld,l.evaluateSizeForZoom=au,l.evaluateVariableOffset=am,l.evented=Xs,l.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},l.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},l.exported=lt,l.exported$1=yi,l.extend=Ze,l.extend$1=vi,l.filterObject=Yt,l.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},l.fromQuat=function(n,e){var i=e[0],s=e[1],u=e[2],f=e[3],_=i+i,x=s+s,T=u+u,M=i*_,R=s*_,B=s*x,V=u*_,te=u*x,he=u*T,Ce=f*_,ze=f*x,Ke=f*T;return n[0]=1-B-he,n[1]=R+Ke,n[2]=V-ze,n[3]=0,n[4]=R-Ke,n[5]=1-M-he,n[6]=te+Ce,n[7]=0,n[8]=V+ze,n[9]=te-Ce,n[10]=1-M-B,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},l.fromRotation=function(n,e){var i=Math.sin(e),s=Math.cos(e);return n[0]=s,n[1]=i,n[2]=0,n[3]=-i,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},l.fromScaling=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},l.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return we[e]},l.getAABBPointSquareDist=function(n,e,i){let s=0;for(let u=0;u<2;++u){const f=i?i[u]:0;n[u]>f&&(s+=(n[u]-f)*(n[u]-f)),e[u]<f&&(s+=(f-e[u])*(f-e[u]))}return s},l.getAnchorAlignment=lp,l.getAnchorJustification=hp,l.getBounds=function(n){let e=1/0,i=1/0,s=-1/0,u=-1/0;for(const f of n)e=Math.min(e,f.x),i=Math.min(i,f.y),s=Math.max(s,f.x),u=Math.max(u,f.y);return{min:new ne(e,i),max:new ne(s,u)}},l.getColumn=function(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]},l.getGridMatrix=function(n,e){const[i,s]=e,u=.015625;return[0,(s[1]-i[1])*u,1<<n.z,(s[0]-i[0])*u,0,n.y,i[0],i[1],u]},l.getImage=yn,l.getJSON=function(n,e){return N(Ze(n,{type:"json"}),e)},l.getMapSessionAPI=_r,l.getPerformanceMeasurement=dh,l.getProjection=function(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new Tu(n);case"equirectangular":return new Mm(n);case"naturalEarth":return new Pm(n);case"equalEarth":return new Im(n);case"winkelTripel":return new Lm(n);case"albers":return i?new Op(n):new Eu(n);case"lambertConformalConic":return i?new Op(n):new Am(n)}throw new Error(`Invalid projection name: ${n.name}`)},l.getRTLTextPluginStatus=vc,l.getReferrer=Q,l.getTilePoint=function(n,{x:e,y:i},s=0){return new ne(((e-s)*n.scale-n.x)*Zi,(i*n.scale-n.y)*Zi)},l.getTileVec3=function(n,e,i=0){return Hu(((e.x-i)*n.scale-n.x)*Zi,(e.y*n.scale-n.y)*Zi,af(e.z,e.y))},l.getVideo=function(n,e){const i=ge.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<n.length;s++){const u=ge.document.createElement("source");Tt(n[s])||(i.crossOrigin="Anonymous"),u.src=n[s],i.appendChild(u)}return{cancel:()=>{}}},l.globeECEFOrigin=function(n,e){const i=[0,0,0];return Ic(i,i,Tp(ul(e.canonical))),Ic(i,i,n),i},l.globePixelsToTileUnits=function(n,e){return Zi/(512*Math.pow(2,n))*xd(ul(e))},l.globePoleMatrixForTile=function(n,e,i){const s=ka(new Float64Array(16)),u=1<<n,f=360*(e/u-.5),_=i.point,x=i.worldSize/(i.tileSize*u);return Dc(s,s,[_.x,_.y,-i.worldSize/Math.PI/2]),sl(s,s,[x,x,x]),Fh(s,s,se(-i._center.lat)),Bh(s,s,se(-i._center.lng+f)),Float32Array.from(s)},l.globeTileLatLngCorners=Cp,l.globeToMercatorTransition=function(n){return We(5,6,n)},l.identity=ka,l.identity$1=og,l.invert=function(n,e){var i=e[0],s=e[1],u=e[2],f=e[3],_=e[4],x=e[5],T=e[6],M=e[7],R=e[8],B=e[9],V=e[10],te=e[11],he=e[12],Ce=e[13],ze=e[14],Ke=e[15],yt=i*x-s*_,St=i*T-u*_,zt=i*M-f*_,Vt=s*T-u*x,jt=s*M-f*x,sn=u*M-f*T,an=R*Ce-B*he,In=R*ze-V*he,An=R*Ke-te*he,tn=B*ze-V*Ce,vn=B*Ke-te*Ce,On=V*Ke-te*ze,Gn=yt*On-St*vn+zt*tn+Vt*An-jt*In+sn*an;return Gn?(n[0]=(x*On-T*vn+M*tn)*(Gn=1/Gn),n[1]=(u*vn-s*On-f*tn)*Gn,n[2]=(Ce*sn-ze*jt+Ke*Vt)*Gn,n[3]=(V*jt-B*sn-te*Vt)*Gn,n[4]=(T*An-_*On-M*In)*Gn,n[5]=(i*On-u*An+f*In)*Gn,n[6]=(ze*zt-he*sn-Ke*St)*Gn,n[7]=(R*sn-V*zt+te*St)*Gn,n[8]=(_*vn-x*An+M*an)*Gn,n[9]=(s*An-i*vn-f*an)*Gn,n[10]=(he*jt-Ce*zt+Ke*yt)*Gn,n[11]=(B*zt-R*jt-te*yt)*Gn,n[12]=(x*In-_*tn-T*an)*Gn,n[13]=(i*tn-s*In+u*an)*Gn,n[14]=(Ce*St-he*Vt-ze*yt)*Gn,n[15]=(R*Vt-B*St+V*yt)*Gn,n):null},l.isMapAuthenticated=function(n){return wi.has(n)},l.isMapboxURL=on,l.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!Tn(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},l.latFromMercatorY=us,l.len=K_,l.length=Gu,l.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},l.loadVectorTile=Uc,l.makeRequest=N,l.mercatorXfromLng=Tc,l.mercatorYfromLat=ju,l.mercatorZfromAltitude=Zu,l.mul=zh,l.mul$1=al,l.multiply=function(n,e,i){var s=e[0],u=e[1],f=e[2],_=e[3],x=e[4],T=e[5],M=e[6],R=e[7],B=e[8],V=i[0],te=i[1],he=i[2],Ce=i[3],ze=i[4],Ke=i[5],yt=i[6],St=i[7],zt=i[8];return n[0]=V*s+te*_+he*M,n[1]=V*u+te*x+he*R,n[2]=V*f+te*T+he*B,n[3]=Ce*s+ze*_+Ke*M,n[4]=Ce*u+ze*x+Ke*R,n[5]=Ce*f+ze*T+Ke*B,n[6]=yt*s+St*_+zt*M,n[7]=yt*u+St*x+zt*R,n[8]=yt*f+St*T+zt*B,n},l.multiply$1=kh,l.multiply$2=yf,l.nextPowerOfTwo=ye,l.normalize=Wu,l.normalize$1=function(n,e){var i=e[0],s=e[1],u=e[2],f=e[3],_=i*i+s*s+u*u+f*f;return _>0&&(_=1/Math.sqrt(_)),n[0]=i*_,n[1]=s*_,n[2]=u*_,n[3]=f*_,n},l.number=ai,l.ortho=function(n,e,i,s,u,f,_){var x=1/(e-i),T=1/(s-u),M=1/(f-_);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*T,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*M,n[11]=0,n[12]=(e+i)*x,n[13]=(u+s)*T,n[14]=(_+f)*M,n[15]=1,n},l.pbf=oh,l.perspective=function(n,e,i,s,u){var f,_=1/Math.tan(e/2);return n[0]=_/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=_,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=u&&u!==1/0?(n[10]=(u+s)*(f=1/(s-u)),n[14]=2*u*s*f):(n[10]=-1,n[14]=-2*s),n},l.pick=function(n,e){const i={};for(let s=0;s<e.length;s++){const u=e[s];u in n&&(i[u]=n[u])}return i},l.plugin=cs,l.pointGeometry=ne,l.polygonIntersectsBox=Lh,l.polygonIntersectsPolygon=lf,l.polygonizeBounds=function(n,e,i=0,s=!0){const u=new ne(i,i),f=n.sub(u),_=e.add(u),x=[f,new ne(_.x,f.y),_,new ne(f.x,_.y)];return s&&x.push(f),x},l.posAttributes=vd,l.postMapLoadEvent=Qi,l.postTurnstileEvent=dn,l.potpack=ec,l.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},l.radToDeg=Ie,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.registerForPluginStateChange=function(n){return n({pluginStatus:jo,pluginURL:Js}),Xs.on("pluginStateChange",n),n},l.removeAuthState=function(n){wi.delete(n)},l.renderColorRamp=Zh,l.rotateX=Fh,l.rotateX$1=Ba,l.rotateY=Bh,l.rotateZ=function(n,e,i){var s=Math.sin(i),u=Math.cos(i),f=e[0],_=e[1],x=e[2],T=e[3],M=e[4],R=e[5],B=e[6],V=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u+M*s,n[1]=_*u+R*s,n[2]=x*u+B*s,n[3]=T*u+V*s,n[4]=M*u-f*s,n[5]=R*u-_*s,n[6]=B*u-x*s,n[7]=V*u-T*s,n},l.rotateZ$1=function(n,e,i){i*=.5;var s=e[0],u=e[1],f=e[2],_=e[3],x=Math.sin(i),T=Math.cos(i);return n[0]=s*T+u*x,n[1]=u*T-s*x,n[2]=f*T+_*x,n[3]=_*T-f*x,n},l.scale=sl,l.scale$1=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n},l.scale$2=qu,l.scaleAndAdd=Vh,l.setCacheLimits=function(n,e){$i=n,Oi=e},l.setColumn=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},l.setRTLTextPlugin=function(n,e,i=!1){if(jo===wl||jo===qc||jo===Io)throw new Error("setRTLTextPlugin cannot be called multiple times.");Js=lt.resolveURL(n),jo=wl,_c=e,Zo(),i||La()},l.smoothstep=We,l.spec=Ut,l.storeAuthState=function(n,e){e?wi.add(n):wi.delete(n)},l.sub=Fa,l.subtract=_f,l.symbolSize=tp,l.tileAABB=function(n,e,i,s,u,f,_,x,T){if("globe"===T.name)return function Ug(n,e,i){const s=e/n.worldSize,u=(vn,On)=>{qu(vn,vn,s),qu(On,On,s)},f=Number.MAX_VALUE,_=[-f,-f,-f],x=[f,f,f],T=Dp(n);if(i.z<=1){const vn=ul(i).getCorners();for(let On=0;On<vn.length;On++)Ic(vn[On],vn[On],T),Uh(x,x,vn[On]),jd(_,_,vn[On]);return u(x,_),new Ns(x,_)}const[M,R]=Cp(i),B=new Cc;B.setSouthWest([M[1],R[0]]),B.setNorthEast([R[1],M[0]]);const V=[Sl(B.getSouth(),B.getWest()),Sl(B.getSouth(),B.getEast()),Sl(B.getNorth(),B.getEast()),Sl(B.getNorth(),B.getWest())];for(let vn=0;vn<V.length;vn++)Ic(V[vn],V[vn],T),Uh(x,x,V[vn]),jd(_,_,V[vn]);if(B.contains(n.center))return _[2]=0,u(x,_),new Ns(x,_);const te=[T[12],T[13],T[14]],he=n.center.lng,Ce=He(n.center.lat,-85.051129,ol),ze=[Tc(he),ju(Ce)],Ke=B.getCenter().lng,yt=He(B.getCenter().lat,-85.051129,ol),St=[Tc(Ke),ju(yt)];let zt=new Array(3),Vt=0;const jt=ze[0]-St[0],sn=ze[1]-St[1];if(Math.abs(jt)>Math.abs(sn))Vt=jt>=0?1:3,zt=te;else{Vt=sn>=0?0:2;const vn=[T[4],T[5],T[6]];let On;On=sn>=0?-Math.sin(se(B.getSouth()))*_u:-Math.sin(se(B.getNorth()))*_u,zt=Vh(zt,te,vn,On)}const an=V[Vt],In=V[(Vt+1)%4],An=new Ng(an,In,zt),tn=[wp(An,0)||an[0],wp(An,1)||an[1],wp(An,2)||an[2]];return x[2]=Math.min(an[2],In[2]),Uh(x,x,tn),jd(_,_,tn),u(x,_),new Ns(x,_)}(n,e,new ph(i,s,u));const M=Fc({z:i,x:s,y:u},T);return new Ns([(f+M.x/M.scale)*e,e*(M.y/M.scale),_],[(f+M.x2/M.scale)*e,e*(M.y2/M.scale),x])},l.tileTransform=Fc,l.transformMat3=function(n,e,i){var s=e[0],u=e[1],f=e[2];return n[0]=s*i[0]+u*i[3]+f*i[6],n[1]=s*i[1]+u*i[4]+f*i[7],n[2]=s*i[2]+u*i[5]+f*i[8],n},l.transformMat4=Ic,l.transformMat4$1=Xu,l.transformQuat=xf,l.translate=Dc,l.transpose=function(n,e){if(n===e){var i=e[1],s=e[2],u=e[5];n[1]=e[3],n[2]=e[6],n[3]=i,n[5]=e[7],n[6]=s,n[7]=u}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},l.triggerPluginCompletionEvent=yc,l.uniqueId=Ge,l.validateCustomStyleLayer=function(n){const e=[],i=n.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===n.render&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&"2d"!==n.renderingMode&&"3d"!==n.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},l.validateFilter=n=>Ws(qs(n)),l.validateFog=n=>Ws(Xa(n)),l.validateLayer=n=>Ws(Ja(n)),l.validateLight=n=>Ws(Md(n)),l.validateSource=n=>Ws(Zl(n)),l.validateStyle=Qa,l.validateTerrain=n=>Ws(Ma(n)),l.values=me,l.vectorTile=Sc,l.version="2.8.2",l.warnOnce=Nt,l.window=ge,l.wrap=Qe}),m(0,function(l){function ie(je){if("number"==typeof je||"boolean"==typeof je||"string"==typeof je||null==je)return JSON.stringify(je);if(Array.isArray(je)){let Q="[";for(const N of je)Q+=`${ie(N)},`;return`${Q}]`}let L="{";for(const Q of Object.keys(je).sort())L+=`${Q}:${ie(je[Q])},`;return`${L}}`}function re(je){let L="";for(const Q of l.refProperties)L+=`/${ie(je[Q])}`;return L}class v{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,Q){for(const pe of L)this._layerConfigs[pe.id]=pe,(this._layers[pe.id]=l.createStyleLayer(pe)).compileFilter(),this.keyCache[pe.id]&&delete this.keyCache[pe.id];for(const pe of Q)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const N=function(pe,$e){const gt={};for(let Ct=0;Ct<pe.length;Ct++){const Et=$e&&$e[pe[Ct].id]||re(pe[Ct]);$e&&($e[pe[Ct].id]=Et);let ln=gt[Et];ln||(ln=gt[Et]=[]),ln.push(pe[Ct])}const Tt=[];for(const Ct in gt)Tt.push(gt[Ct]);return Tt}(l.values(this._layerConfigs),this.keyCache);for(const pe of N){const $e=pe.map(yn=>this._layers[yn.id]),gt=$e[0];if("none"===gt.visibility)continue;const Tt=gt.source||"";let Ct=this.familiesBySource[Tt];Ct||(Ct=this.familiesBySource[Tt]={});const Et=gt.sourceLayer||"_geojsonTileLayer";let ln=Ct[Et];ln||(ln=Ct[Et]=[]),ln.push($e)}}}class ne{loadTile(L,Q){const{uid:N,encoding:pe,rawImageData:$e,padding:gt,buildQuadTree:Tt}=L,Ct=l.window.ImageBitmap&&$e instanceof l.window.ImageBitmap?this.getImageData($e,gt):$e;Q(null,new l.DEMData(N,Ct,pe,gt<1,Tt))}getImageData(L,Q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(L.width,L.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=L.width,this.offscreenCanvas.height=L.height,this.offscreenCanvasContext.drawImage(L,0,0,L.width,L.height);const N=this.offscreenCanvasContext.getImageData(-Q,-Q,L.width+2*Q,L.height+2*Q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),N}}var De=function je(L,Q){var N,pe=L&&L.type;if("FeatureCollection"===pe)for(N=0;N<L.features.length;N++)je(L.features[N],Q);else if("GeometryCollection"===pe)for(N=0;N<L.geometries.length;N++)je(L.geometries[N],Q);else if("Feature"===pe)je(L.geometry,Q);else if("Polygon"===pe)ge(L.coordinates,Q);else if("MultiPolygon"===pe)for(N=0;N<L.coordinates.length;N++)ge(L.coordinates[N],Q);return L};function ge(je,L){if(0!==je.length){X(je[0],L);for(var Q=1;Q<je.length;Q++)X(je[Q],!L)}}function X(je,L){for(var Q=0,N=0,pe=0,$e=je.length,gt=$e-1;pe<$e;gt=pe++){var Tt=(je[pe][0]-je[gt][0])*(je[gt][1]+je[pe][1]),Ct=Q+Tt;N+=Math.abs(Q)>=Math.abs(Tt)?Q-Ct+Tt:Tt-Ct+Q,Q=Ct}Q+N>=0!=!!L&&je.reverse()}const ue=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class se{constructor(L){this._feature=L,this.extent=l.EXTENT,this.type=L.type,this.properties=L.tags,"id"in L&&!isNaN(L.id)&&(this.id=parseInt(L.id,10))}loadGeometry(){if(1===this._feature.type){const L=[];for(const Q of this._feature.geometry)L.push([new l.pointGeometry(Q[0],Q[1])]);return L}{const L=[];for(const Q of this._feature.geometry){const N=[];for(const pe of Q)N.push(new l.pointGeometry(pe[0],pe[1]));L.push(N)}return L}}toGeoJSON(L,Q,N){return ue.call(this,L,Q,N)}}class Ie{constructor(L){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=L.length,this._features=L}feature(L){return new se(this._features[L])}}var we=l.vectorTile.VectorTileFeature,Ue=Ne;function Ne(je,L){this.options=L||{},this.features=je,this.length=je.length}function ke(je,L){this.id="number"==typeof je.id?je.id:void 0,this.type=je.type,this.rawGeometry=1===je.type?[je.geometry]:je.geometry,this.properties=je.tags,this.extent=L||4096}Ne.prototype.feature=function(je){return new ke(this.features[je],this.options.extent)},ke.prototype.loadGeometry=function(){var je=this.rawGeometry;this.geometry=[];for(var L=0;L<je.length;L++){for(var Q=je[L],N=[],pe=0;pe<Q.length;pe++)N.push(new l.pointGeometry(Q[pe][0],Q[pe][1]));this.geometry.push(N)}return this.geometry},ke.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var je=this.geometry,L=1/0,Q=-1/0,N=1/0,pe=-1/0,$e=0;$e<je.length;$e++)for(var gt=je[$e],Tt=0;Tt<gt.length;Tt++){var Ct=gt[Tt];L=Math.min(L,Ct.x),Q=Math.max(Q,Ct.x),N=Math.min(N,Ct.y),pe=Math.max(pe,Ct.y)}return[L,N,Q,pe]},ke.prototype.toGeoJSON=we.prototype.toGeoJSON;var He=Qe,We=Ue;function Qe(je){var L=new l.pbf;return function(Q,N){for(var pe in Q.layers)N.writeMessage(3,ve,Q.layers[pe])}(je,L),L.finish()}function ve(je,L){var Q;L.writeVarintField(15,je.version||1),L.writeStringField(1,je.name||""),L.writeVarintField(5,je.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(Q=0;Q<je.length;Q++)N.feature=je.feature(Q),L.writeMessage(2,me,N);var pe=N.keys;for(Q=0;Q<pe.length;Q++)L.writeStringField(3,pe[Q]);var $e=N.values;for(Q=0;Q<$e.length;Q++)L.writeMessage(4,ye,$e[Q])}function me(je,L){var Q=je.feature;void 0!==Q.id&&L.writeVarintField(1,Q.id),L.writeMessage(2,Ze,je),L.writeVarintField(3,Q.type),L.writeMessage(4,tt,Q)}function Ze(je,L){var Q=je.feature,N=je.keys,pe=je.values,$e=je.keycache,gt=je.valuecache;for(var Tt in Q.properties){var Ct=Q.properties[Tt],Et=$e[Tt];if(null!==Ct){void 0===Et&&(N.push(Tt),$e[Tt]=Et=N.length-1),L.writeVarint(Et);var ln=typeof Ct;"string"!==ln&&"boolean"!==ln&&"number"!==ln&&(Ct=JSON.stringify(Ct));var yn=ln+":"+Ct,Cn=gt[yn];void 0===Cn&&(pe.push(Ct),gt[yn]=Cn=pe.length-1),L.writeVarint(Cn)}}}function Pe(je,L){return(L<<3)+(7&je)}function Ge(je){return je<<1^je>>31}function tt(je,L){for(var Q=je.loadGeometry(),N=je.type,pe=0,$e=0,gt=Q.length,Tt=0;Tt<gt;Tt++){var Ct=Q[Tt],Et=1;1===N&&(Et=Ct.length),L.writeVarint(Pe(1,Et));for(var ln=3===N?Ct.length-1:Ct.length,yn=0;yn<ln;yn++){1===yn&&1!==N&&L.writeVarint(Pe(2,ln-1));var Cn=Ct[yn].x-pe,oi=Ct[yn].y-$e;L.writeVarint(Ge(Cn)),L.writeVarint(Ge(oi)),pe+=Cn,$e+=oi}3===N&&L.writeVarint(Pe(7,1))}}function ye(je,L){var Q=typeof je;"string"===Q?L.writeStringField(1,je):"boolean"===Q?L.writeBooleanField(7,je):"number"===Q&&(je%1!=0?L.writeDoubleField(3,je):je<0?L.writeSVarintField(6,je):L.writeVarintField(5,je))}function Ae(je,L,Q,N,pe,$e){if(pe-N<=Q)return;const gt=N+pe>>1;Be(je,L,gt,N,pe,$e%2),Ae(je,L,Q,N,gt-1,$e+1),Ae(je,L,Q,gt+1,pe,$e+1)}function Be(je,L,Q,N,pe,$e){for(;pe>N;){if(pe-N>600){const Et=pe-N+1,ln=Q-N+1,yn=Math.log(Et),Cn=.5*Math.exp(2*yn/3),oi=.5*Math.sqrt(yn*Cn*(Et-Cn)/Et)*(ln-Et/2<0?-1:1);Be(je,L,Q,Math.max(N,Math.floor(Q-ln*Cn/Et+oi)),Math.min(pe,Math.floor(Q+(Et-ln)*Cn/Et+oi)),$e)}const gt=L[2*Q+$e];let Tt=N,Ct=pe;for(st(je,L,N,Q),L[2*pe+$e]>gt&&st(je,L,N,pe);Tt<Ct;){for(st(je,L,Tt,Ct),Tt++,Ct--;L[2*Tt+$e]<gt;)Tt++;for(;L[2*Ct+$e]>gt;)Ct--}L[2*N+$e]===gt?st(je,L,N,Ct):(Ct++,st(je,L,Ct,pe)),Ct<=Q&&(N=Ct+1),Q<=Ct&&(pe=Ct-1)}}function st(je,L,Q,N){_t(je,Q,N),_t(L,2*Q,2*N),_t(L,2*Q+1,2*N+1)}function _t(je,L,Q){const N=je[L];je[L]=je[Q],je[Q]=N}function Yt(je,L,Q,N){const pe=je-Q,$e=L-N;return pe*pe+$e*$e}He.fromVectorTileJs=Qe,He.fromGeojsonVt=function(je,L){L=L||{};var Q={};for(var N in je)Q[N]=new Ue(je[N].features,L),Q[N].name=N,Q[N].version=L.version,Q[N].extent=L.extent;return Qe({layers:Q})},He.GeoJSONWrapper=We;const xn=je=>je[0],Ht=je=>je[1];class Nt{constructor(L,Q=xn,N=Ht,pe=64,$e=Float64Array){this.nodeSize=pe,this.points=L;const gt=L.length<65536?Uint16Array:Uint32Array,Tt=this.ids=new gt(L.length),Ct=this.coords=new $e(2*L.length);for(let Et=0;Et<L.length;Et++)Tt[Et]=Et,Ct[2*Et]=Q(L[Et]),Ct[2*Et+1]=N(L[Et]);Ae(Tt,Ct,pe,0,Tt.length-1,0)}range(L,Q,N,pe){return function($e,gt,Tt,Ct,Et,ln,yn){const Cn=[0,$e.length-1,0],oi=[];let Rn,Hn;for(;Cn.length;){const Xn=Cn.pop(),Ut=Cn.pop(),vi=Cn.pop();if(Ut-vi<=yn){for(let ei=vi;ei<=Ut;ei++)Rn=gt[2*ei],Hn=gt[2*ei+1],Rn>=Tt&&Rn<=Et&&Hn>=Ct&&Hn<=ln&&oi.push($e[ei]);continue}const Xt=Math.floor((vi+Ut)/2);Rn=gt[2*Xt],Hn=gt[2*Xt+1],Rn>=Tt&&Rn<=Et&&Hn>=Ct&&Hn<=ln&&oi.push($e[Xt]);const qn=(Xn+1)%2;(0===Xn?Tt<=Rn:Ct<=Hn)&&(Cn.push(vi),Cn.push(Xt-1),Cn.push(qn)),(0===Xn?Et>=Rn:ln>=Hn)&&(Cn.push(Xt+1),Cn.push(Ut),Cn.push(qn))}return oi}(this.ids,this.coords,L,Q,N,pe,this.nodeSize)}within(L,Q,N){return function(pe,$e,gt,Tt,Ct,Et){const ln=[0,pe.length-1,0],yn=[],Cn=Ct*Ct;for(;ln.length;){const oi=ln.pop(),Rn=ln.pop(),Hn=ln.pop();if(Rn-Hn<=Et){for(let qn=Hn;qn<=Rn;qn++)Yt($e[2*qn],$e[2*qn+1],gt,Tt)<=Cn&&yn.push(pe[qn]);continue}const Xn=Math.floor((Hn+Rn)/2),Ut=$e[2*Xn],vi=$e[2*Xn+1];Yt(Ut,vi,gt,Tt)<=Cn&&yn.push(pe[Xn]);const Xt=(oi+1)%2;(0===oi?gt-Ct<=Ut:Tt-Ct<=vi)&&(ln.push(Hn),ln.push(Xn-1),ln.push(Xt)),(0===oi?gt+Ct>=Ut:Tt+Ct>=vi)&&(ln.push(Xn+1),ln.push(Rn),ln.push(Xt))}return yn}(this.ids,this.coords,L,Q,N,this.nodeSize)}}const Bt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:je=>je},Dt=Math.fround||(ht=new Float32Array(1),je=>(ht[0]=+je,ht[0]));var ht;class Lt{constructor(L){this.options=lt(Object.create(Bt),L),this.trees=new Array(this.options.maxZoom+1)}load(L){const{log:Q,minZoom:N,maxZoom:pe,nodeSize:$e}=this.options;Q&&console.time("total time");const gt=`prepare ${L.length} points`;Q&&console.time(gt),this.points=L;let Tt=[];for(let Ct=0;Ct<L.length;Ct++)L[Ct].geometry&&Tt.push(it(L[Ct],Ct));this.trees[pe+1]=new Nt(Tt,qt,En,$e,Float32Array),Q&&console.timeEnd(gt);for(let Ct=pe;Ct>=N;Ct--){const Et=+Date.now();Tt=this._cluster(Tt,Ct),this.trees[Ct]=new Nt(Tt,qt,En,$e,Float32Array),Q&&console.log("z%d: %d clusters in %dms",Ct,Tt.length,+Date.now()-Et)}return Q&&console.timeEnd("total time"),this}getClusters(L,Q){let N=((L[0]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,L[1]));let $e=180===L[2]?180:((L[2]+180)%360+360)%360-180;const gt=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)N=-180,$e=180;else if(N>$e){const ln=this.getClusters([N,pe,180,gt],Q),yn=this.getClusters([-180,pe,$e,gt],Q);return ln.concat(yn)}const Tt=this.trees[this._limitZoom(Q)],Ct=Tt.range(_n(N),Tn(gt),_n($e),Tn(pe)),Et=[];for(const ln of Ct){const yn=Tt.points[ln];Et.push(yn.numPoints?Ot(yn):this.points[yn.index])}return Et}getChildren(L){const Q=this._getOriginId(L),N=this._getOriginZoom(L),pe="No cluster with the specified id.",$e=this.trees[N];if(!$e)throw new Error(pe);const gt=$e.points[Q];if(!gt)throw new Error(pe);const Tt=this.options.radius/(this.options.extent*Math.pow(2,N-1)),Ct=$e.within(gt.x,gt.y,Tt),Et=[];for(const ln of Ct){const yn=$e.points[ln];yn.parentId===L&&Et.push(yn.numPoints?Ot(yn):this.points[yn.index])}if(0===Et.length)throw new Error(pe);return Et}getLeaves(L,Q,N){const pe=[];return this._appendLeaves(pe,L,Q=Q||10,N=N||0,0),pe}getTile(L,Q,N){const pe=this.trees[this._limitZoom(L)],$e=Math.pow(2,L),{extent:gt,radius:Tt}=this.options,Ct=Tt/gt,Et=(N-Ct)/$e,ln=(N+1+Ct)/$e,yn={features:[]};return this._addTileFeatures(pe.range((Q-Ct)/$e,Et,(Q+1+Ct)/$e,ln),pe.points,Q,N,$e,yn),0===Q&&this._addTileFeatures(pe.range(1-Ct/$e,Et,1,ln),pe.points,$e,N,$e,yn),Q===$e-1&&this._addTileFeatures(pe.range(0,Et,Ct/$e,ln),pe.points,-1,N,$e,yn),yn.features.length?yn:null}getClusterExpansionZoom(L){let Q=this._getOriginZoom(L)-1;for(;Q<=this.options.maxZoom;){const N=this.getChildren(L);if(Q++,1!==N.length)break;L=N[0].properties.cluster_id}return Q}_appendLeaves(L,Q,N,pe,$e){const gt=this.getChildren(Q);for(const Tt of gt){const Ct=Tt.properties;if(Ct&&Ct.cluster?$e+Ct.point_count<=pe?$e+=Ct.point_count:$e=this._appendLeaves(L,Ct.cluster_id,N,pe,$e):$e<pe?$e++:L.push(Tt),L.length===N)break}return $e}_addTileFeatures(L,Q,N,pe,$e,gt){for(const Tt of L){const Ct=Q[Tt],Et=Ct.numPoints;let ln,yn,Cn;if(Et)ln=Qt(Ct),yn=Ct.x,Cn=Ct.y;else{const Hn=this.points[Ct.index];ln=Hn.properties,yn=_n(Hn.geometry.coordinates[0]),Cn=Tn(Hn.geometry.coordinates[1])}const oi={type:1,geometry:[[Math.round(this.options.extent*(yn*$e-N)),Math.round(this.options.extent*(Cn*$e-pe))]],tags:ln};let Rn;Et?Rn=Ct.id:this.options.generateId?Rn=Ct.index:this.points[Ct.index].id&&(Rn=this.points[Ct.index].id),void 0!==Rn&&(oi.id=Rn),gt.features.push(oi)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(+L,this.options.maxZoom+1))}_cluster(L,Q){const N=[],{radius:pe,extent:$e,reduce:gt,minPoints:Tt}=this.options,Ct=pe/($e*Math.pow(2,Q));for(let Et=0;Et<L.length;Et++){const ln=L[Et];if(ln.zoom<=Q)continue;ln.zoom=Q;const yn=this.trees[Q+1],Cn=yn.within(ln.x,ln.y,Ct),oi=ln.numPoints||1;let Rn=oi;for(const Hn of Cn){const Xn=yn.points[Hn];Xn.zoom>Q&&(Rn+=Xn.numPoints||1)}if(Rn>oi&&Rn>=Tt){let Hn=ln.x*oi,Xn=ln.y*oi,Ut=gt&&oi>1?this._map(ln,!0):null;const vi=(Et<<5)+(Q+1)+this.points.length;for(const Xt of Cn){const qn=yn.points[Xt];if(qn.zoom<=Q)continue;qn.zoom=Q;const ei=qn.numPoints||1;Hn+=qn.x*ei,Xn+=qn.y*ei,qn.parentId=vi,gt&&(Ut||(Ut=this._map(ln,!0)),gt(Ut,this._map(qn)))}ln.parentId=vi,N.push(_e(Hn/Rn,Xn/Rn,vi,Rn,Ut))}else if(N.push(ln),Rn>1)for(const Hn of Cn){const Xn=yn.points[Hn];Xn.zoom<=Q||(Xn.zoom=Q,N.push(Xn))}}return N}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,Q){if(L.numPoints)return Q?lt({},L.properties):L.properties;const N=this.points[L.index].properties,pe=this.options.map(N);return Q&&pe===N?lt({},pe):pe}}function _e(je,L,Q,N,pe){return{x:Dt(je),y:Dt(L),zoom:1/0,id:Q,parentId:-1,numPoints:N,properties:pe}}function it(je,L){const[Q,N]=je.geometry.coordinates;return{x:Dt(_n(Q)),y:Dt(Tn(N)),zoom:1/0,index:L,parentId:-1}}function Ot(je){return{type:"Feature",id:je.id,properties:Qt(je),geometry:{type:"Point",coordinates:[(L=je.x,360*(L-.5)),mn(je.y)]}};var L}function Qt(je){const L=je.numPoints,Q=L>=1e4?`${Math.round(L/1e3)}k`:L>=1e3?Math.round(L/100)/10+"k":L;return lt(lt({},je.properties),{cluster:!0,cluster_id:je.id,point_count:L,point_count_abbreviated:Q})}function _n(je){return je/360+.5}function Tn(je){const L=Math.sin(je*Math.PI/180),Q=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return Q<0?0:Q>1?1:Q}function mn(je){const L=(180-360*je)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function lt(je,L){for(const Q in L)je[Q]=L[Q];return je}function qt(je){return je.x}function En(je){return je.y}function yi(je,L,Q,N){for(var pe,$e=N,gt=Q-L>>1,Tt=Q-L,Ct=je[L],Et=je[L+1],ln=je[Q],yn=je[Q+1],Cn=L+3;Cn<Q;Cn+=3){var oi=Ui(je[Cn],je[Cn+1],Ct,Et,ln,yn);if(oi>$e)pe=Cn,$e=oi;else if(oi===$e){var Rn=Math.abs(Cn-gt);Rn<Tt&&(pe=Cn,Tt=Rn)}}$e>N&&(pe-L>3&&yi(je,L,pe,N),je[pe+2]=$e,Q-pe>3&&yi(je,pe,Q,N))}function Ui(je,L,Q,N,pe,$e){var gt=pe-Q,Tt=$e-N;if(0!==gt||0!==Tt){var Ct=((je-Q)*gt+(L-N)*Tt)/(gt*gt+Tt*Tt);Ct>1?(Q=pe,N=$e):Ct>0&&(Q+=gt*Ct,N+=Tt*Ct)}return(gt=je-Q)*gt+(Tt=L-N)*Tt}function Xi(je,L,Q,N){var pe={id:void 0===je?null:je,type:L,geometry:Q,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function($e){var gt=$e.geometry,Tt=$e.type;if("Point"===Tt||"MultiPoint"===Tt||"LineString"===Tt)mr($e,gt);else if("Polygon"===Tt||"MultiLineString"===Tt)for(var Ct=0;Ct<gt.length;Ct++)mr($e,gt[Ct]);else if("MultiPolygon"===Tt)for(Ct=0;Ct<gt.length;Ct++)for(var Et=0;Et<gt[Ct].length;Et++)mr($e,gt[Ct][Et])}(pe),pe}function mr(je,L){for(var Q=0;Q<L.length;Q+=3)je.minX=Math.min(je.minX,L[Q]),je.minY=Math.min(je.minY,L[Q+1]),je.maxX=Math.max(je.maxX,L[Q]),je.maxY=Math.max(je.maxY,L[Q+1])}function di(je,L,Q,N){if(L.geometry){var pe=L.geometry.coordinates,$e=L.geometry.type,gt=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2),Tt=[],Ct=L.id;if(Q.promoteId?Ct=L.properties[Q.promoteId]:Q.generateId&&(Ct=N||0),"Point"===$e)Ai(pe,Tt);else if("MultiPoint"===$e)for(var Et=0;Et<pe.length;Et++)Ai(pe[Et],Tt);else if("LineString"===$e)Hi(pe,Tt,gt,!1);else if("MultiLineString"===$e){if(Q.lineMetrics){for(Et=0;Et<pe.length;Et++)Hi(pe[Et],Tt=[],gt,!1),je.push(Xi(Ct,"LineString",Tt,L.properties));return}ri(pe,Tt,gt,!1)}else if("Polygon"===$e)ri(pe,Tt,gt,!0);else{if("MultiPolygon"!==$e){if("GeometryCollection"===$e){for(Et=0;Et<L.geometry.geometries.length;Et++)di(je,{id:Ct,geometry:L.geometry.geometries[Et],properties:L.properties},Q,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Et=0;Et<pe.length;Et++){var ln=[];ri(pe[Et],ln,gt,!0),Tt.push(ln)}}je.push(Xi(Ct,$e,Tt,L.properties))}}function Ai(je,L){L.push(on(je[0])),L.push(It(je[1])),L.push(0)}function Hi(je,L,Q,N){for(var pe,$e,gt=0,Tt=0;Tt<je.length;Tt++){var Ct=on(je[Tt][0]),Et=It(je[Tt][1]);L.push(Ct),L.push(Et),L.push(0),Tt>0&&(gt+=N?(pe*Et-Ct*$e)/2:Math.sqrt(Math.pow(Ct-pe,2)+Math.pow(Et-$e,2))),pe=Ct,$e=Et}var ln=L.length-3;L[2]=1,yi(L,0,ln,Q),L[ln+2]=1,L.size=Math.abs(gt),L.start=0,L.end=L.size}function ri(je,L,Q,N){for(var pe=0;pe<je.length;pe++){var $e=[];Hi(je[pe],$e,Q,N),L.push($e)}}function on(je){return je/360+.5}function It(je){var L=Math.sin(je*Math.PI/180),Q=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return Q<0?0:Q>1?1:Q}function qe(je,L,Q,N,pe,$e,gt,Tt){if(N/=L,$e>=(Q/=L)&&gt<N)return je;if(gt<Q||$e>=N)return null;for(var Ct=[],Et=0;Et<je.length;Et++){var ln=je[Et],yn=ln.geometry,Cn=ln.type,oi=0===pe?ln.minX:ln.minY,Rn=0===pe?ln.maxX:ln.maxY;if(oi>=Q&&Rn<N)Ct.push(ln);else if(!(Rn<Q||oi>=N)){var Hn=[];if("Point"===Cn||"MultiPoint"===Cn)dt(yn,Hn,Q,N,pe);else if("LineString"===Cn)Wt(yn,Hn,Q,N,pe,!1,Tt.lineMetrics);else if("MultiLineString"===Cn)Je(yn,Hn,Q,N,pe,!1);else if("Polygon"===Cn)Je(yn,Hn,Q,N,pe,!0);else if("MultiPolygon"===Cn)for(var Xn=0;Xn<yn.length;Xn++){var Ut=[];Je(yn[Xn],Ut,Q,N,pe,!0),Ut.length&&Hn.push(Ut)}if(Hn.length){if(Tt.lineMetrics&&"LineString"===Cn){for(Xn=0;Xn<Hn.length;Xn++)Ct.push(Xi(ln.id,Cn,Hn[Xn],ln.tags));continue}"LineString"!==Cn&&"MultiLineString"!==Cn||(1===Hn.length?(Cn="LineString",Hn=Hn[0]):Cn="MultiLineString"),"Point"!==Cn&&"MultiPoint"!==Cn||(Cn=3===Hn.length?"Point":"MultiPoint"),Ct.push(Xi(ln.id,Cn,Hn,ln.tags))}}}return Ct.length?Ct:null}function dt(je,L,Q,N,pe){for(var $e=0;$e<je.length;$e+=3){var gt=je[$e+pe];gt>=Q&&gt<=N&&(L.push(je[$e]),L.push(je[$e+1]),L.push(je[$e+2]))}}function Wt(je,L,Q,N,pe,$e,gt){for(var Tt,Ct,Et=de(je),ln=0===pe?dn:Qn,yn=je.start,Cn=0;Cn<je.length-3;Cn+=3){var oi=je[Cn],Rn=je[Cn+1],Hn=je[Cn+2],Xn=je[Cn+3],Ut=je[Cn+4],vi=0===pe?oi:Rn,Xt=0===pe?Xn:Ut,qn=!1;gt&&(Tt=Math.sqrt(Math.pow(oi-Xn,2)+Math.pow(Rn-Ut,2))),vi<Q?Xt>Q&&(Ct=ln(Et,oi,Rn,Xn,Ut,Q),gt&&(Et.start=yn+Tt*Ct)):vi>N?Xt<N&&(Ct=ln(Et,oi,Rn,Xn,Ut,N),gt&&(Et.start=yn+Tt*Ct)):$t(Et,oi,Rn,Hn),Xt<Q&&vi>=Q&&(Ct=ln(Et,oi,Rn,Xn,Ut,Q),qn=!0),Xt>N&&vi<=N&&(Ct=ln(Et,oi,Rn,Xn,Ut,N),qn=!0),!$e&&qn&&(gt&&(Et.end=yn+Tt*Ct),L.push(Et),Et=de(je)),gt&&(yn+=Tt)}var ei=je.length-3;oi=je[ei],Rn=je[ei+1],Hn=je[ei+2],(vi=0===pe?oi:Rn)>=Q&&vi<=N&&$t(Et,oi,Rn,Hn),ei=Et.length-3,$e&&ei>=3&&(Et[ei]!==Et[0]||Et[ei+1]!==Et[1])&&$t(Et,Et[0],Et[1],Et[2]),Et.length&&L.push(Et)}function de(je){var L=[];return L.size=je.size,L.start=je.start,L.end=je.end,L}function Je(je,L,Q,N,pe,$e){for(var gt=0;gt<je.length;gt++)Wt(je[gt],L,Q,N,pe,$e,!1)}function $t(je,L,Q,N){je.push(L),je.push(Q),je.push(N)}function dn(je,L,Q,N,pe,$e){var gt=($e-L)/(N-L);return je.push($e),je.push(Q+(pe-Q)*gt),je.push(1),gt}function Qn(je,L,Q,N,pe,$e){var gt=($e-Q)/(pe-Q);return je.push(L+(N-L)*gt),je.push($e),je.push(1),gt}function Qi(je,L){for(var Q=[],N=0;N<je.length;N++){var pe,$e=je[N],gt=$e.type;if("Point"===gt||"MultiPoint"===gt||"LineString"===gt)pe=nr($e.geometry,L);else if("MultiLineString"===gt||"Polygon"===gt){pe=[];for(var Tt=0;Tt<$e.geometry.length;Tt++)pe.push(nr($e.geometry[Tt],L))}else if("MultiPolygon"===gt)for(pe=[],Tt=0;Tt<$e.geometry.length;Tt++){for(var Ct=[],Et=0;Et<$e.geometry[Tt].length;Et++)Ct.push(nr($e.geometry[Tt][Et],L));pe.push(Ct)}Q.push(Xi($e.id,gt,pe,$e.tags))}return Q}function nr(je,L){var Q=[];Q.size=je.size,void 0!==je.start&&(Q.start=je.start,Q.end=je.end);for(var N=0;N<je.length;N+=3)Q.push(je[N]+L,je[N+1],je[N+2]);return Q}function _r(je,L){if(je.transformed)return je;var Q,N,pe,$e=1<<je.z,gt=je.x,Tt=je.y;for(Q=0;Q<je.features.length;Q++){var Ct=je.features[Q],Et=Ct.geometry,ln=Ct.type;if(Ct.geometry=[],1===ln)for(N=0;N<Et.length;N+=2)Ct.geometry.push(wi(Et[N],Et[N+1],L,$e,gt,Tt));else for(N=0;N<Et.length;N++){var yn=[];for(pe=0;pe<Et[N].length;pe+=2)yn.push(wi(Et[N][pe],Et[N][pe+1],L,$e,gt,Tt));Ct.geometry.push(yn)}}return je.transformed=!0,je}function wi(je,L,Q,N,pe,$e){return[Math.round(Q*(je*N-pe)),Math.round(Q*(L*N-$e))]}function Di(je,L,Q,N,pe){for(var $e=L===pe.maxZoom?0:pe.tolerance/((1<<L)*pe.extent),gt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Q,y:N,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Tt=0;Tt<je.length;Tt++){gt.numFeatures++,xi(gt,je[Tt],$e,pe);var Ct=je[Tt].minX,Et=je[Tt].minY,ln=je[Tt].maxX,yn=je[Tt].maxY;Ct<gt.minX&&(gt.minX=Ct),Et<gt.minY&&(gt.minY=Et),ln>gt.maxX&&(gt.maxX=ln),yn>gt.maxY&&(gt.maxY=yn)}return gt}function xi(je,L,Q,N){var pe=L.geometry,$e=L.type,gt=[];if("Point"===$e||"MultiPoint"===$e)for(var Tt=0;Tt<pe.length;Tt+=3)gt.push(pe[Tt]),gt.push(pe[Tt+1]),je.numPoints++,je.numSimplified++;else if("LineString"===$e)Xr(gt,pe,je,Q,!1,!1);else if("MultiLineString"===$e||"Polygon"===$e)for(Tt=0;Tt<pe.length;Tt++)Xr(gt,pe[Tt],je,Q,"Polygon"===$e,0===Tt);else if("MultiPolygon"===$e)for(var Ct=0;Ct<pe.length;Ct++){var Et=pe[Ct];for(Tt=0;Tt<Et.length;Tt++)Xr(gt,Et[Tt],je,Q,!0,0===Tt)}if(gt.length){var ln=L.tags||null;if("LineString"===$e&&N.lineMetrics){for(var yn in ln={},L.tags)ln[yn]=L.tags[yn];ln.mapbox_clip_start=pe.start/pe.size,ln.mapbox_clip_end=pe.end/pe.size}var Cn={geometry:gt,type:"Polygon"===$e||"MultiPolygon"===$e?3:"LineString"===$e||"MultiLineString"===$e?2:1,tags:ln};null!==L.id&&(Cn.id=L.id),je.features.push(Cn)}}function Xr(je,L,Q,N,pe,$e){var gt=N*N;if(N>0&&L.size<(pe?gt:N))Q.numPoints+=L.length/3;else{for(var Tt=[],Ct=0;Ct<L.length;Ct+=3)(0===N||L[Ct+2]>gt)&&(Q.numSimplified++,Tt.push(L[Ct]),Tt.push(L[Ct+1])),Q.numPoints++;pe&&function(Et,ln){for(var yn=0,Cn=0,oi=Et.length,Rn=oi-2;Cn<oi;Rn=Cn,Cn+=2)yn+=(Et[Cn]-Et[Rn])*(Et[Cn+1]+Et[Rn+1]);if(yn>0===ln)for(Cn=0,oi=Et.length;Cn<oi/2;Cn+=2){var Hn=Et[Cn],Xn=Et[Cn+1];Et[Cn]=Et[oi-2-Cn],Et[Cn+1]=Et[oi-1-Cn],Et[oi-2-Cn]=Hn,Et[oi-1-Cn]=Xn}}(Tt,$e),je.push(Tt)}}function $i(je,L){var Q=(L=this.options=function(pe,$e){for(var gt in $e)pe[gt]=$e[gt];return pe}(Object.create(this.options),L)).debug;if(Q&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");var pe,$e,gt,Tt,Ct,Et,N=function(pe,$e){var gt=[];if("FeatureCollection"===pe.type)for(var Tt=0;Tt<pe.features.length;Tt++)di(gt,pe.features[Tt],$e,Tt);else di(gt,"Feature"===pe.type?pe:{geometry:pe},$e);return gt}(je,L);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(pe=N,$e=L,gt=$e.buffer/$e.extent,Tt=pe,Ct=qe(pe,1,-1-gt,gt,0,-1,2,$e),Et=qe(pe,1,1-gt,2+gt,0,-1,2,$e),(Ct||Et)&&(Tt=qe(pe,1,-gt,1+gt,0,-1,2,$e)||[],Ct&&(Tt=Qi(Ct,1).concat(Tt)),Et&&(Tt=Tt.concat(Qi(Et,-1)))),N=Tt).length&&this.splitTile(N,0,0,0),Q&&(N.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Oi(je,L,Q){return 32*((1<<je)*Q+L)+je}function Wr(je,L){const Q=je.tileID.canonical;if(!this._geoJSONIndex)return L(null,null);const N=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!N)return L(null,null);const pe=new Ie(N.features);let $e=He(pe);0===$e.byteOffset&&$e.byteLength===$e.buffer.byteLength||($e=new Uint8Array($e)),L(null,{vectorTile:pe,rawData:$e.buffer})}$i.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},$i.prototype.splitTile=function(je,L,Q,N,pe,$e,gt){for(var Tt=[je,L,Q,N],Ct=this.options,Et=Ct.debug;Tt.length;){N=Tt.pop(),Q=Tt.pop(),L=Tt.pop(),je=Tt.pop();var ln=1<<L,yn=Oi(L,Q,N),Cn=this.tiles[yn];if(!Cn&&(Et>1&&console.time("creation"),Cn=this.tiles[yn]=Di(je,L,Q,N,Ct),this.tileCoords.push({z:L,x:Q,y:N}),Et)){Et>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,Q,N,Cn.numFeatures,Cn.numPoints,Cn.numSimplified),console.timeEnd("creation"));var oi="z"+L;this.stats[oi]=(this.stats[oi]||0)+1,this.total++}if(Cn.source=je,pe){if(L===Ct.maxZoom||L===pe)continue;var Rn=1<<pe-L;if(Q!==Math.floor($e/Rn)||N!==Math.floor(gt/Rn))continue}else if(L===Ct.indexMaxZoom||Cn.numPoints<=Ct.indexMaxPoints)continue;if(Cn.source=null,0!==je.length){Et>1&&console.time("clipping");var Hn,Xn,Ut,vi,Xt,qn,ei=.5*Ct.buffer/Ct.extent,gr=.5-ei,lr=.5+ei,Dn=1+ei;Hn=Xn=Ut=vi=null,Xt=qe(je,ln,Q-ei,Q+lr,0,Cn.minX,Cn.maxX,Ct),qn=qe(je,ln,Q+gr,Q+Dn,0,Cn.minX,Cn.maxX,Ct),je=null,Xt&&(Hn=qe(Xt,ln,N-ei,N+lr,1,Cn.minY,Cn.maxY,Ct),Xn=qe(Xt,ln,N+gr,N+Dn,1,Cn.minY,Cn.maxY,Ct),Xt=null),qn&&(Ut=qe(qn,ln,N-ei,N+lr,1,Cn.minY,Cn.maxY,Ct),vi=qe(qn,ln,N+gr,N+Dn,1,Cn.minY,Cn.maxY,Ct),qn=null),Et>1&&console.timeEnd("clipping"),Tt.push(Hn||[],L+1,2*Q,2*N),Tt.push(Xn||[],L+1,2*Q,2*N+1),Tt.push(Ut||[],L+1,2*Q+1,2*N),Tt.push(vi||[],L+1,2*Q+1,2*N+1)}}},$i.prototype.getTile=function(je,L,Q){var N=this.options,pe=N.extent,$e=N.debug;if(je<0||je>24)return null;var gt=1<<je,Tt=Oi(je,L=(L%gt+gt)%gt,Q);if(this.tiles[Tt])return _r(this.tiles[Tt],pe);$e>1&&console.log("drilling down to z%d-%d-%d",je,L,Q);for(var Ct,Et=je,ln=L,yn=Q;!Ct&&Et>0;)Et--,ln=Math.floor(ln/2),yn=Math.floor(yn/2),Ct=this.tiles[Oi(Et,ln,yn)];return Ct&&Ct.source?($e>1&&console.log("found parent tile z%d-%d-%d",Et,ln,yn),$e>1&&console.time("drilling down"),this.splitTile(Ct.source,Et,ln,yn,je,L,Q),$e>1&&console.timeEnd("drilling down"),this.tiles[Tt]?_r(this.tiles[Tt],pe):null):null};class ar extends l.VectorTileWorkerSource{constructor(L,Q,N,pe,$e){super(L,Q,N,pe,Wr),$e&&(this.loadGeoJSON=$e)}loadData(L,Q){const N=L&&L.request,pe=N&&N.collectResourceTiming;this.loadGeoJSON(L,($e,gt)=>{if($e||!gt)return Q($e);if("object"!=typeof gt)return Q(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{De(gt,!0);try{if(L.filter){const Ct=l.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ct.result)throw new Error(Ct.value.map(ln=>`${ln.key}: ${ln.message}`).join(", "));const Et=gt.features.filter(ln=>Ct.value.evaluate({zoom:0},ln));gt={type:"FeatureCollection",features:Et}}this._geoJSONIndex=L.cluster?new Lt(function({superclusterOptions:Ct,clusterProperties:Et}){if(!Et||!Ct)return Ct;const ln={},yn={},Cn={accumulated:null,zoom:0},oi={properties:null},Rn=Object.keys(Et);for(const Hn of Rn){const[Xn,Ut]=Et[Hn],vi=l.createExpression(Ut),Xt=l.createExpression("string"==typeof Xn?[Xn,["accumulated"],["get",Hn]]:Xn);ln[Hn]=vi.value,yn[Hn]=Xt.value}return Ct.map=Hn=>{oi.properties=Hn;const Xn={};for(const Ut of Rn)Xn[Ut]=ln[Ut].evaluate(Cn,oi);return Xn},Ct.reduce=(Hn,Xn)=>{oi.properties=Xn;for(const Ut of Rn)Cn.accumulated=Hn[Ut],Hn[Ut]=yn[Ut].evaluate(Cn,oi)},Ct}(L)).load(gt.features):new $i(Ct=gt,L.geojsonVtOptions)}catch(Ct){return Q(Ct)}this.loaded={};const Tt={};if(pe){const Ct=l.getPerformanceMeasurement(N);Ct&&(Tt.resourceTiming={},Tt.resourceTiming[L.source]=JSON.parse(JSON.stringify(Ct)))}Q(null,Tt)}var Ct})}reloadTile(L,Q){const N=this.loaded;return N&&N[L.uid]?super.reloadTile(L,Q):this.loadTile(L,Q)}loadGeoJSON(L,Q){if(L.request)l.getJSON(L.request,Q);else{if("string"!=typeof L.data)return Q(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));try{return Q(null,JSON.parse(L.data))}catch{return Q(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(L,Q){try{Q(null,this._geoJSONIndex.getClusterExpansionZoom(L.clusterId))}catch(N){Q(N)}}getClusterChildren(L,Q){try{Q(null,this._geoJSONIndex.getChildren(L.clusterId))}catch(N){Q(N)}}getClusterLeaves(L,Q){try{Q(null,this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset))}catch(N){Q(N)}}}class Ci{constructor(L){this.self=L,this.actor=new l.Actor(L,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=l.getProjection({name:"mercator"}),this.workerSourceTypes={vector:l.VectorTileWorkerSource,geojson:ar},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Q,N)=>{if(this.workerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.workerSourceTypes[Q]=N},this.self.registerRTLTextPlugin=Q=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=Q.applyArabicShaping,l.plugin.processBidirectionalText=Q.processBidirectionalText,l.plugin.processStyledBidirectionalText=Q.processStyledBidirectionalText}}clearCaches(L,Q,N){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L],N()}checkIfReady(L,Q,N){N()}setReferrer(L,Q){this.referrer=Q}spriteLoaded(L,Q){this.isSpriteLoaded[L]=Q;for(const N in this.workerSources[L]){const pe=this.workerSources[L][N];for(const $e in pe)pe[$e]instanceof l.VectorTileWorkerSource&&(pe[$e].isSpriteLoaded=Q,pe[$e].fire(new l.Event("isSpriteLoaded")))}}setImages(L,Q,N){this.availableImages[L]=Q;for(const pe in this.workerSources[L]){const $e=this.workerSources[L][pe];for(const gt in $e)$e[gt].availableImages=Q}N()}enableTerrain(L,Q,N){this.terrain=Q,N()}setProjection(L,Q){this.projections[L]=l.getProjection(Q)}setLayers(L,Q,N){this.getLayerIndex(L).replace(Q),N()}updateLayers(L,Q,N){this.getLayerIndex(L).update(Q.layers,Q.removedIds),N()}loadTile(L,Q,N){const pe=this.enableTerrain?l.extend({enableTerrain:this.terrain},Q):Q;pe.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,Q.type,Q.source).loadTile(pe,N)}loadDEMTile(L,Q,N){const pe=this.enableTerrain?l.extend({buildQuadTree:this.terrain},Q):Q;this.getDEMWorkerSource(L,Q.source).loadTile(pe,N)}reloadTile(L,Q,N){const pe=this.enableTerrain?l.extend({enableTerrain:this.terrain},Q):Q;pe.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,Q.type,Q.source).reloadTile(pe,N)}abortTile(L,Q,N){this.getWorkerSource(L,Q.type,Q.source).abortTile(Q,N)}removeTile(L,Q,N){this.getWorkerSource(L,Q.type,Q.source).removeTile(Q,N)}removeSource(L,Q,N){if(!this.workerSources[L]||!this.workerSources[L][Q.type]||!this.workerSources[L][Q.type][Q.source])return;const pe=this.workerSources[L][Q.type][Q.source];delete this.workerSources[L][Q.type][Q.source],void 0!==pe.removeSource?pe.removeSource(Q,N):N()}loadWorkerSource(L,Q,N){try{this.self.importScripts(Q.url),N()}catch(pe){N(pe.toString())}}syncRTLPluginState(L,Q,N){try{l.plugin.setState(Q);const pe=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&null!=pe){this.self.importScripts(pe);const $e=l.plugin.isParsed();N($e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${pe}`),$e)}}catch(pe){N(pe.toString())}}getAvailableImages(L){let Q=this.availableImages[L];return Q||(Q=[]),Q}getLayerIndex(L){let Q=this.layerIndexes[L];return Q||(Q=this.layerIndexes[L]=new v),Q}getWorkerSource(L,Q,N){return this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][Q]||(this.workerSources[L][Q]={}),this.workerSources[L][Q][N]||(this.workerSources[L][Q][N]=new this.workerSourceTypes[Q]({send:(pe,$e,gt,Tt,Ct,Et)=>{this.actor.send(pe,$e,gt,L,Ct,Et)},scheduler:this.actor.scheduler},this.getLayerIndex(L),this.getAvailableImages(L),this.isSpriteLoaded[L])),this.workerSources[L][Q][N]}getDEMWorkerSource(L,Q){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][Q]||(this.demWorkerSources[L][Q]=new ne),this.demWorkerSources[L][Q]}enforceCacheSizeLimit(L,Q){l.enforceCacheSizeLimit(Q)}getWorkerPerformanceMetrics(L,Q,N){N(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ci(self)),Ci}),m(0,function(l){var ie=re;function re(p){return t=p,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,b,C=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(C);try{b=new Worker(I),g=!0}catch{g=!1}return b&&b.terminate(),URL.revokeObjectURL(I),g}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var g=document.createElement("canvas");g.width=g.height=1;var b=g.getContext("2d");if(!b)return!1;var C=b.getImageData(0,0,1,1);return C&&C.width===g.width}()||(void 0===v[c=t&&t.failIfMajorPerformanceCaveat]&&(v[c]=function(g){var b,I,S,U,C=(I=g,S=document.createElement("canvas"),(U=Object.create(re.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,S.getContext("webgl",U)||S.getContext("experimental-webgl",U));if(!C)return!1;try{b=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!b||C.isContextLost())&&(C.shaderSource(b,"void main() {}"),C.compileShader(b),!0===C.getShaderParameter(b,C.COMPILE_STATUS))}(c)),!v[c]||document.documentMode));var t,c}var v={};function ne(p,t){if(Array.isArray(p)){if(!Array.isArray(t)||p.length!==t.length)return!1;for(let c=0;c<p.length;c++)if(!ne(p[c],t[c]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==t){if("object"!=typeof t||Object.keys(p).length!==Object.keys(t).length)return!1;for(const c in p)if(!ne(p[c],t[c]))return!1;return!0}return p===t}function De(p,t,c){const g=l.window.document.createElement(p);return void 0!==t&&(g.className=t),c&&c.appendChild(g),g}function ge(p,t,c){const g=l.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const b of Object.keys(t))g.setAttributeNS(null,b,t[b]);return c&&c.appendChild(g),g}re.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const X=l.window.document&&l.window.document.documentElement.style,ue=X&&void 0!==X.userSelect?"userSelect":"WebkitUserSelect";let se;function Ie(){X&&ue&&(se=X[ue],X[ue]="none")}function we(){X&&ue&&(X[ue]=se)}function Ue(p){p.preventDefault(),p.stopPropagation(),l.window.removeEventListener("click",Ue,!0)}function Ne(){l.window.addEventListener("click",Ue,!0),l.window.setTimeout(()=>{l.window.removeEventListener("click",Ue,!0)},0)}function ke(p,t){const c=p.getBoundingClientRect();return Qe(p,c,t)}function He(p,t){const c=p.getBoundingClientRect(),g=[];for(let b=0;b<t.length;b++)g.push(Qe(p,c,t[b]));return g}function We(p){return void 0!==l.window.InstallTrigger&&2===p.button&&p.ctrlKey&&l.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function Qe(p,t,c){const g=p.offsetWidth===t.width?1:p.offsetWidth/t.width;return new l.pointGeometry((c.clientX-t.left)*g,(c.clientY-t.top)*g)}function ve(p,t){var c=t[0],g=t[1],b=t[2],C=t[3],I=c*C-b*g;return I?(p[0]=C*(I=1/I),p[1]=-g*I,p[2]=-b*I,p[3]=c*I,p):null}function me(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ze extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:c,callback:g}of this.requestors)this._notify(c,g);this.requestors=[]}}hasImage(t){return!!this.getImage(t)}getImage(t){return this.images[t]}addImage(t,c){this._validate(t,c)&&(this.images[t]=c)}_validate(t,c){let g=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),g=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),g=!1),this._validateContent(c.content,c)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),g=!1),g}_validateStretch(t,c){if(!t)return!0;let g=0;for(const b of t){if(b[0]<g||b[1]<b[0]||c<b[1])return!1;g=b[1]}return!0}_validateContent(t,c){return!(t&&(4!==t.length||t[0]<0||c.data.width<t[0]||t[1]<0||c.data.height<t[1]||t[2]<0||c.data.width<t[2]||t[3]<0||c.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,c){c.version=this.images[t].version+1,this.images[t]=c,this.updatedImages[t]=!0}removeImage(t){const c=this.images[t];delete this.images[t],delete this.patterns[t],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,c){let g=!0;if(!this.isLoaded())for(const b of t)this.images[b]||(g=!1);this.isLoaded()||g?this._notify(t,c):this.requestors.push({ids:t,callback:c})}_notify(t,c){const g={};for(const b of t){this.images[b]||this.fire(new l.Event("styleimagemissing",{id:b}));const C=this.images[b];C?g[b]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:Boolean(C.userImage&&C.userImage.render)}:l.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,g)}getPixelSize(){const{width:t,height:c}=this.atlasImage;return{width:t,height:c}}getPattern(t){const c=this.patterns[t],g=this.getImage(t);if(!g)return null;if(c&&c.position.version===g.version)return c.position;if(c)c.position.version=g.version;else{const b={w:g.data.width+2,h:g.data.height+2,x:0,y:0},C=new l.ImagePosition(b,g);this.patterns[t]={bin:b,position:C}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const c=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.Texture(t,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const C in this.patterns)t.push(this.patterns[C].bin);const{w:c,h:g}=l.potpack(t),b=this.atlasImage;b.resize({width:c||1,height:g||1});for(const C in this.patterns){const{bin:I}=this.patterns[C],S=I.x+1,U=I.y+1,q=this.images[C].data,J=q.width,ae=q.height;l.RGBAImage.copy(q,b,{x:0,y:0},{x:S,y:U},{width:J,height:ae}),l.RGBAImage.copy(q,b,{x:0,y:ae-1},{x:S,y:U-1},{width:J,height:1}),l.RGBAImage.copy(q,b,{x:0,y:0},{x:S,y:U+ae},{width:J,height:1}),l.RGBAImage.copy(q,b,{x:J-1,y:0},{x:S-1,y:U},{width:1,height:ae}),l.RGBAImage.copy(q,b,{x:0,y:0},{x:S+J,y:U},{width:1,height:ae})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const c of t){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const g=this.images[c];me(g)&&this.updateImage(c,g)}}}const Pe=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(p,t){return function([c,g,b]){const C=l.degToRad(g+90),I=l.degToRad(b);return{x:c*Math.cos(C)*Math.sin(I),y:c*Math.sin(C)*Math.sin(I),z:c*Math.cos(I),azimuthal:g,polar:b}}(p.expression.evaluate(t))}interpolate(p,t,c){return{x:l.number(p.x,t.x,c),y:l.number(p.y,t.y,c),z:l.number(p.z,t.z,c),azimuthal:l.number(p.azimuthal,t.azimuthal,c),polar:l.number(p.polar,t.polar,c)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),Ge="-transition";class tt extends l.Evented{constructor(t){super(),this._transitionable=new l.Transitionable(Pe),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,c={}){if(!this._validate(l.validateLight,t,c))for(const g in t){const b=t[g];l.endsWith(g,Ge)?this._transitionable.setTransition(g.slice(0,-Ge.length),b):this._transitionable.setValue(g,b)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,c,g){return(!g||!1!==g.validate)&&l.emitValidationErrors(this,t.call(l.validateStyle,l.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}const ye=new l.Properties({source:new l.DataConstantProperty(l.spec.terrain.source),exaggeration:new l.DataConstantProperty(l.spec.terrain.exaggeration)}),Ae="-transition";class Be extends l.Evented{constructor(t,c){super(),this._transitionable=new l.Transitionable(ye),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(t){for(const c in t){const g=t[c];l.endsWith(c,Ae)?this._transitionable.setTransition(c.slice(0,-Ae.length),g):this._transitionable.setValue(c,g)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function st(p,t,c,g){const b=l.smoothstep(45,65,c),[C,I]=_t(p,g),S=l.length(t);let U=1-Math.min(1,Math.exp((S-C)/(I-C)*-6));return U*=U*U,U=Math.min(1,1.00747*U),U*b*p.alpha}function _t(p,t){const c=.5/Math.tan(.5*t);return[p.range[0]+c,p.range[1]+c]}const Yt=new l.Properties({range:new l.DataConstantProperty(l.spec.fog.range),color:new l.DataConstantProperty(l.spec.fog.color),"horizon-blend":new l.DataConstantProperty(l.spec.fog["horizon-blend"])}),xn="-transition";class Ht extends l.Evented{constructor(t,c){super(),this._transitionable=new l.Transitionable(Yt),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,c={}){if(!this._validate(l.validateFog,t,c))for(const g in t){const b=t[g];l.endsWith(g,xn)?this._transitionable.setTransition(g.slice(0,-xn.length),b):this._transitionable.setValue(g,b)}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return l.smoothstep(45,65,t)*c.a}getOpacityAtLatLng(t,c){return this._transform.projection.supportsFog?function(g,b,C){const I=l.MercatorCoordinate.fromLngLat(b),S=C.elevation?C.elevation.getAtPointOrZero(I):0,U=[I.x,I.y,S];return l.transformMat4(U,U,C.mercatorFogMatrix),st(g,U,C.pitch,C._fov)}(this.state,t,c):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?_t(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,c,g){return(!g||!1!==g.validate)&&l.emitValidationErrors(this,t.call(l.validateStyle,l.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class Nt{constructor(t,c){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const g=this.workerPool.acquire(this.id);for(let b=0;b<g.length;b++){const C=new Nt.Actor(g[b],c,this.id);C.name=`Worker ${b}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,c,g){l.asyncAll(this.actors,(b,C)=>{b.send(t,c,C)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Bt(p,t,c){return t*(l.EXTENT/(p.tileSize*Math.pow(2,c-p.tileID.overscaledZ)))}Nt.Actor=l.Actor;class Dt{constructor(t,c,g,b){this.screenBounds=t,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(C=>b.pointCoordinate3D(C)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,c){let g,b;if(t instanceof l.pointGeometry||"number"==typeof t[0]){const C=l.pointGeometry.convert(t);g=[l.pointGeometry.convert(t)],b=c.isPointAboveHorizon(C)}else{const C=l.pointGeometry.convert(t[0]),I=l.pointGeometry.convert(t[1]);g=[C,I],b=l.polygonizeBounds(C,I).every(S=>c.isPointAboveHorizon(S))}return new Dt(g,c.getCameraPoint(),b,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return l.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const c=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new l.pointGeometry(1,1)):this.screenBounds[1],b=l.polygonizeBounds(c,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<g.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?b[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(b[3]=this.cameraPoint)),l.bufferConvexPolygon(b,t)}containsTile(t,c,g){const b=t.queryPadding+1,C=t.tileID.wrap,I=g?this._bufferedCameraMercator(b,c).map(Oe=>l.getTilePoint(t.tileTransform,Oe,C)):this._bufferedScreenMercator(b,c).map(Oe=>l.getTilePoint(t.tileTransform,Oe,C)),S=this.screenGeometryMercator.map(Oe=>l.getTileVec3(t.tileTransform,Oe,C)),U=S.map(Oe=>new l.pointGeometry(Oe[0],Oe[1])),q=c.getFreeCameraOptions().position||new l.MercatorCoordinate(0,0,0),J=l.getTileVec3(t.tileTransform,q,C),ae=S.map(Oe=>{const xe=l.sub(Oe,Oe,J);return l.normalize(xe,xe),new l.Ray(J,xe)}),Te=Bt(t,1,c.zoom);if(l.polygonIntersectsBox(I,0,0,l.EXTENT,l.EXTENT))return{queryGeometry:this,tilespaceGeometry:U,tilespaceRays:ae,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(Ve=l.getBounds(I),Ve.min.x=l.clamp(Ve.min.x,0,l.EXTENT),Ve.min.y=l.clamp(Ve.min.y,0,l.EXTENT),Ve.max.x=l.clamp(Ve.max.x,0,l.EXTENT),Ve.max.y=l.clamp(Ve.max.y,0,l.EXTENT),Ve),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Te};var Ve}_bufferedScreenMercator(t,c){const g=ht(t);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{const b=this.bufferedScreenGeometry(t).map(C=>c.pointCoordinate3D(C));return this._screenRaycastCache[g]=b,b}}_bufferedCameraMercator(t,c){const g=ht(t);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{const b=this.bufferedCameraGeometry(t).map(C=>c.pointCoordinate3D(C));return this._cameraRaycastCache[g]=b,b}}}function ht(p){return 100*p|0}function Lt(p,t,c){const g=function(b,C){if(b)return c(b);if(C){const I=l.pick(l.extend(C,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(I.vectorLayers=C.vector_layers,I.vectorLayerIds=I.vectorLayers.map(S=>S.id)),I.tiles=t.canonicalizeTileset(I,p.url),c(null,I)}};return p.url?l.getJSON(t.transformRequest(t.normalizeSourceURL(p.url),l.ResourceType.Source),g):l.exported.frame(()=>g(null,p))}class _e{constructor(t,c,g){this.bounds=l.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=c||0,this.maxzoom=g||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const c=Math.pow(2,t.z),g=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*c),b=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*c),C=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*c),I=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*c);return t.x>=g&&t.x<C&&t.y>=b&&t.y<I}}class it{constructor(t,c,g){this.context=t;const b=t.gl;this.buffer=b.createBuffer(),this.dynamicDraw=Boolean(g),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ot={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Qt{constructor(t,c,g,b){this.length=c.length,this.attributes=g,this.itemSize=c.bytesPerElement,this.dynamicDraw=b,this.context=t;const C=t.gl;this.buffer=C.createBuffer(),t.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,c){for(let g=0;g<this.attributes.length;g++){const b=c.attributes[this.attributes[g].name];void 0!==b&&t.enableVertexAttribArray(b)}}setVertexAttribPointers(t,c,g){for(let b=0;b<this.attributes.length;b++){const C=this.attributes[b],I=c.attributes[C.name];void 0!==I&&t.vertexAttribPointer(I,C.components,t[Ot[C.type]],!1,this.itemSize,C.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class _n{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Tn extends _n{getDefault(){return l.Color.transparent}set(t){const c=this.current;(t.r!==c.r||t.g!==c.g||t.b!==c.b||t.a!==c.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class mn extends _n{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class lt extends _n{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class qt extends _n{getDefault(){return[!0,!0,!0,!0]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||t[2]!==c[2]||t[3]!==c[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class En extends _n{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class yi extends _n{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ui extends _n{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const c=this.current;(t.func!==c.func||t.ref!==c.ref||t.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Xi extends _n{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||t[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class mr extends _n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;t?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=t,this.dirty=!1}}class di extends _n{getDefault(){return[0,1]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ai extends _n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;t?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=t,this.dirty=!1}}class Hi extends _n{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ri extends _n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;t?c.enable(c.BLEND):c.disable(c.BLEND),this.current=t,this.dirty=!1}}class on extends _n{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class It extends _n{getDefault(){return l.Color.transparent}set(t){const c=this.current;(t.r!==c.r||t.g!==c.g||t.b!==c.b||t.a!==c.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class qe extends _n{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class dt extends _n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;t?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=t,this.dirty=!1}}class Wt extends _n{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class de extends _n{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Je extends _n{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class $t extends _n{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class dn extends _n{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||t[2]!==c[2]||t[3]!==c[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Qn extends _n{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Qi extends _n{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class nr extends _n{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class _r extends _n{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class wi extends _n{getDefault(){return null}set(t){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Di extends _n{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class xi extends _n{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Xr extends _n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class $i extends _n{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Oi extends _n{constructor(t,c){super(t),this.context=t,this.parent=c}getDefault(){return null}}class Wr extends Oi{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ar extends Oi{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ci extends ar{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class je{constructor(t,c,g,b){this.context=t,this.width=c,this.height=g;const C=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new Wr(t,C),b&&(this.depthAttachment=new ar(t,C))}destroy(){const t=this.context.gl,c=this.colorAttachment.get();if(c&&t.deleteTexture(c),this.depthAttachment){const g=this.depthAttachment.get();g&&t.deleteRenderbuffer(g)}t.deleteFramebuffer(this.framebuffer)}}class L{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Tn(this),this.clearDepth=new mn(this),this.clearStencil=new lt(this),this.colorMask=new qt(this),this.depthMask=new En(this),this.stencilMask=new yi(this),this.stencilFunc=new Ui(this),this.stencilOp=new Xi(this),this.stencilTest=new mr(this),this.depthRange=new di(this),this.depthTest=new Ai(this),this.depthFunc=new Hi(this),this.blend=new ri(this),this.blendFunc=new on(this),this.blendColor=new It(this),this.blendEquation=new qe(this),this.cullFace=new dt(this),this.cullFaceSide=new Wt(this),this.frontFace=new de(this),this.program=new Je(this),this.activeTexture=new $t(this),this.viewport=new dn(this),this.bindFramebuffer=new Qn(this),this.bindRenderbuffer=new Qi(this),this.bindTexture=new nr(this),this.bindVertexBuffer=new _r(this),this.bindElementBuffer=new wi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Di(this),this.pixelStoreUnpack=new xi(this),this.pixelStoreUnpackPremultiplyAlpha=new Xr(this),this.pixelStoreUnpackFlipY=new $i(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,c){return new it(this,t,c)}createVertexBuffer(t,c,g){return new Qt(this,t,c,g)}createRenderbuffer(t,c,g){const b=this.gl,C=b.createRenderbuffer();return this.bindRenderbuffer.set(C),b.renderbufferStorage(b.RENDERBUFFER,t,c,g),this.bindRenderbuffer.set(null),C}createFramebuffer(t,c,g){return new je(this,t,c,g)}clear({color:t,depth:c,stencil:g}){const b=this.gl;let C=0;t&&(C|=b.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(C|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==g&&(C|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),b.clear(C)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){ne(t.blendFunction,l.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Q extends l.Evented{constructor(t,c,g,b){super(),this.id=t,this.dispatcher=g,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},c),l.extend(this,l.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lt(this._options,this.map._requestManager,(t,c)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new l.ErrorEvent(t)):c&&(l.extend(this,c),c.bounds&&(this.tileBounds=new _e(c.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(c.tiles),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,c){const g=l.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);t.request=l.getImage(this.map._requestManager.transformRequest(b,l.ResourceType.Tile),(C,I,S,U)=>(delete t.request,t.aborted?(t.state="unloaded",c(null)):C?(t.state="errored",c(C)):I?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:U}),t.setTexture(I,this.map.painter),t.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(t,c,g){t.setTexture(c,g)}static unloadTileData(t,c){t.texture&&c.saveTileTexture(t.texture)}abortTile(t,c){t.request&&(t.request.cancel(),delete t.request),c()}unloadTile(t,c){t.texture&&this.map.painter.saveTileTexture(t.texture),c()}hasTransition(){return!1}}let N;function pe(p,t,c,g,b,C,I,S){const U=[p,c,b,t,g,C,1,1,1],q=[I,S,1],J=l.adjoint([],U),[ae,Te,Ve]=l.transformMat3(q,q,l.transpose(J,J));return l.multiply(U,[ae,0,0,0,Te,0,0,0,Ve],U)}class $e extends l.Evented{constructor(t,c,g,b){super(),this.id=t,this.dispatcher=g,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=c}load(t){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(c,g)=>{if(this._loaded=!0,c)this.fire(new l.ErrorEvent(c));else if(g){const{HTMLImageElement:b}=l.window;this.image=g instanceof b?l.exported.getImageData(g):g,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const c=t.map(l.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let b=1/0,C=1/0,I=-1/0,S=-1/0;for(const ae of g)b=Math.min(b,ae.x),C=Math.min(C,ae.y),I=Math.max(I,ae.x),S=Math.max(S,ae.y);const U=Math.max(I-b,S-C),q=Math.max(0,Math.floor(-Math.log(U)/Math.LN2)),J=Math.pow(2,q);return new l.CanonicalTileID(q,Math.floor((b+I)/2*J),Math.floor((C+S)/2*J))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const U in this.tiles){const q=this.tiles[U];"loaded"!==q.state&&(q.state="loaded",q.texture=this.texture)}if(this._boundsArray)return;const c=l.tileTransform(this.tileID,this.map.transform.projection),[g,b,C,I]=this.coordinates.map(U=>{const q=c.projection.project(U[0],U[1]);return l.getTilePoint(c,q)._round()});this.perspectiveTransform=function(U,q,J,ae,Te,Ve,Oe,xe,at,Ye){const rt=pe(0,0,U,0,0,q,U,q),ot=pe(J,ae,Te,Ve,Oe,xe,at,Ye);return l.multiply(ot,l.adjoint(rt,rt),ot),[ot[6]/ot[8]*U/l.EXTENT,ot[7]/ot[8]*q/l.EXTENT]}(this.width,this.height,g.x,g.y,b.x,b.y,I.x,I.y,C.x,C.y);const S=this._boundsArray=new l.StructArrayLayout4i8;S.emplaceBack(g.x,g.y,0,0),S.emplaceBack(b.x,b.y,l.EXTENT,0),S.emplaceBack(I.x,I.y,0,l.EXTENT),S.emplaceBack(C.x,C.y,l.EXTENT,l.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(S,l.boundsAttributes.members),this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,c=t.gl;this.texture?this.texture.update(this.image):(this.texture=new l.Texture(t,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._prepareData(t)}loadTile(t,c){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},c(null)):(t.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const gt={vector:class extends l.Evented{constructor(p,t,c,g){if(super(),this.id=p,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(t,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new l.DedupedRequest}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lt(this._options,this.map._requestManager,(p,t)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new l.ErrorEvent(p)):t&&(l.extend(this,t),t.bounds&&(this.tileBounds=new _e(t.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(t.tiles,this.map._requestManager._customAccessToken),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p();const t=this.map.style._getSourceCaches(this.id);for(const c of t)c.clearTiles();this.load()}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(p,t){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(c,l.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,p.actor&&"expired"!==p.state)"loading"===p.state?p.reloadCallback=t:p.request=p.actor.send("reloadTile",g,b.bind(this));else if(p.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",g,b.bind(this),void 0,!0);else{const C=l.loadVectorTile.call({deduped:this._deduped},g,(I,S)=>{I||!S?b.call(this,I):(g.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},p.actor&&p.actor.send("loadTile",g,b.bind(this),void 0,!0))},!0);p.request={cancel:C}}function b(C,I){return delete p.request,p.aborted?t(null):C&&404!==C.status?t(C):(I&&I.resourceTiming&&(p.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&p.setExpiryData(I),p.loadVectorData(I,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Q,"raster-dem":class extends Q{constructor(p,t,c,g){super(p,t,c,g),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(p,t){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(b,C){b&&(p.state="errored",t(b)),C&&(p.dem=C,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",t(null))}p.request=l.getImage(this.map._requestManager.transformRequest(c,l.ResourceType.Tile),function(b,C,I,S){if(delete p.request,p.aborted)p.state="unloaded",t(null);else if(b)p.state="errored",t(b);else if(C){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:I,expires:S});const U=l.window.ImageBitmap&&C instanceof l.window.ImageBitmap&&(null==N&&(N=l.window.OffscreenCanvas&&new l.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof l.window.createImageBitmap),N),q=1-(C.width-l.prevPowerOfTwo(C.width))/2;q<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const J=U?C:l.exported.getImageData(C,q),ae={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:J,encoding:this.encoding,padding:q};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",ae,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const t=p.canonical,c=Math.pow(2,t.z),g=(t.x-1+c)%c,b=0===t.x?p.wrap-1:p.wrap,C=(t.x+1+c)%c,I=t.x+1===c?p.wrap+1:p.wrap,S={};return S[new l.OverscaledTileID(p.overscaledZ,b,t.z,g,t.y).key]={backfilled:!1},S[new l.OverscaledTileID(p.overscaledZ,I,t.z,C,t.y).key]={backfilled:!1},t.y>0&&(S[new l.OverscaledTileID(p.overscaledZ,b,t.z,g,t.y-1).key]={backfilled:!1},S[new l.OverscaledTileID(p.overscaledZ,p.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},S[new l.OverscaledTileID(p.overscaledZ,I,t.z,C,t.y-1).key]={backfilled:!1}),t.y+1<c&&(S[new l.OverscaledTileID(p.overscaledZ,b,t.z,g,t.y+1).key]={backfilled:!1},S[new l.OverscaledTileID(p.overscaledZ,p.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},S[new l.OverscaledTileID(p.overscaledZ,I,t.z,C,t.y+1).key]={backfilled:!1}),S}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends l.Evented{constructor(p,t,c,g){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(g),this._data=t.data,this._options=l.extend({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const b=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*b,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*b,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:l.EXTENT,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*b,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},t),this}getClusterChildren(p,t){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},t),this}getClusterLeaves(p,t,c,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:t,offset:c},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new l.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=l.extend({},this.workerOptions),t=this._data;"string"==typeof t?(p.request=this.map._requestManager.transformRequest(l.exported.resolveURL(t),l.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(c,g)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new l.ErrorEvent(c));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(b.resourceTiming=g.resourceTiming[this.id]),this.fire(new l.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,t){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(c,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,b)=>(delete p.request,p.unloadVectorData(),p.aborted?t(null):g?t(g):(p.loadVectorData(b,this.map.painter,"reloadTile"===c),t(null))),void 0,"loadTile"===c)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends $e{constructor(p,t,c,g){super(p,t,c,g),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const t of p.urls)this.urls.push(this.map._requestManager.transformRequest(t,l.ResourceType.Source).url);l.getVideo(this.urls,(t,c)=>{this._loaded=!0,t?this.fire(new l.ErrorEvent(t)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const t=this.video.seekable;p<t.start(0)||p>t.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,t=p.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new l.Texture(p,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:$e,canvas:class extends $e{constructor(p,t,c,g){super(p,t,c,g),t.coordinates?Array.isArray(t.coordinates)&&4===t.coordinates.length&&!t.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(C=>"number"!=typeof C))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),t.animate&&"boolean"!=typeof t.animate&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),t.canvas?"string"==typeof t.canvas||t.canvas instanceof l.window.HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=t,this.animate=void 0===t.animate||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof l.window.HTMLCanvasElement?this.options.canvas:l.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const t=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.Texture(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends l.Evented{constructor(p,t,c,g){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=t,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new l.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new l.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new _e(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.coveringTiles=this._coveringTiles.bind(this),l.extend(this,l.pick(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return l.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:t,y:c,z:g}=p.canonical;return this._implementation.hasTile({x:t,y:c,z:g})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,t){const{x:c,y:g,z:b}=p.tileID.canonical,C=new l.window.AbortController,I=this._implementation.loadTile({x:c,y:g,z:b},{signal:C.signal});if(!I)return this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",t(null);I.cancel=()=>C.abort(),p.request=I.then(function(S){return delete p.request,p.aborted?(p.state="unloaded",t(null)):S?(U=S)instanceof l.window.ImageData||U instanceof l.window.ImageBitmap||U instanceof l.window.HTMLCanvasElement?(this.loadTileData(p,S),p.state="loaded",void t(null)):(p.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",t(null));var U}.bind(this)).catch(S=>{20!==S.code&&(p.state="errored",t(S))})}loadTileData(p,t){Q.loadTileData(p,t,this._map.painter)}unloadTileData(p){Q.unloadTileData(p,this._map.painter)}prepareTile(p){if(!this._implementation.prepareTile)return null;const{x:t,y:c,z:g}=p.tileID.canonical,b=this._implementation.prepareTile({x:t,y:c,z:g});return b?(this.loadTileData(p,b),p.state="loaded",b):null}unloadTile(p,t){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:c,y:g,z:b}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:g,z:b})}t()}abortTile(p,t){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_update(){this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Tt=function(p,t,c,g){const b=new gt[t.type](p,t,c,g);if(b.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${b.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],b),b};function Ct(p,t){const c=l.identity([]);return l.scale(c,c,[.5*p.width,.5*-p.height,1]),l.translate(c,c,[1,-1,0]),l.multiply$1(c,c,p.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(c)}function Et(p,t,c,g,b,C,I,S=!1){const U=p.tilesIn(g,I,S);U.sort(yn);const q=[];for(const ae of U)q.push({wrappedTileID:ae.tile.tileID.wrapped().key,queryResults:ae.tile.queryRenderedFeatures(t,c,p._state,ae,b,C,Ct(p.transform,ae.tile.tileID),S)});const J=function(ae){const Te={},Ve={};for(const Oe of ae){const xe=Oe.queryResults,at=Oe.wrappedTileID,Ye=Ve[at]=Ve[at]||{};for(const rt in xe){const ot=xe[rt],mt=Ye[rt]=Ye[rt]||{},nt=Te[rt]=Te[rt]||[];for(const bt of ot)mt[bt.featureIndex]||(mt[bt.featureIndex]=!0,nt.push(bt))}}return Te}(q);for(const ae in J)J[ae].forEach(Te=>{const Ve=Te.feature,Oe=Ve.layer;Oe&&"background"!==Oe.type&&"sky"!==Oe.type&&(Ve.source=Oe.source,Oe["source-layer"]&&(Ve.sourceLayer=Oe["source-layer"]),Ve.state=void 0!==Ve.id?p.getFeatureState(Oe["source-layer"],Ve.id):{})});return J}function ln(p,t){const c=p.getRenderableIds().map(C=>p.getTileByID(C)),g=[],b={};for(let C=0;C<c.length;C++){const I=c[C],S=I.tileID.canonical.key;b[S]||(b[S]=!0,I.querySourceFeatures(g,t))}return g}function yn(p,t){const c=p.tileID,g=t.tileID;return c.overscaledZ-g.overscaledZ||c.canonical.y-g.canonical.y||c.wrap-g.wrap||c.canonical.x-g.canonical.x}function Cn(){return null!=Hl.workerClass?new Hl.workerClass:new l.window.Worker(Hl.workerUrl)}const oi="mapboxgl_preloaded_worker_pool";class Rn{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Rn.workerCount;)this.workers.push(new Cn);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[oi]}numActive(){return Object.keys(this.active).length}}let Hn;function Xn(){return Hn||(Hn=new Rn),Hn}function Ut(p,t){const c={};for(const g in p)"ref"!==g&&(c[g]=p[g]);return l.refProperties.forEach(g=>{g in t&&(c[g]=t[g])}),c}function vi(p){p=p.slice();const t=Object.create(null);for(let c=0;c<p.length;c++)t[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=Ut(p[c],t[p[c].ref]));return p}Rn.workerCount=2;const Xt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function qn(p,t,c){c.push({command:Xt.addSource,args:[p,t[p]]})}function ei(p,t,c){t.push({command:Xt.removeSource,args:[p]}),c[p]=!0}function gr(p,t,c,g){ei(p,c,g),qn(p,t,c)}function lr(p,t,c){let g;for(g in p[c])if(p[c].hasOwnProperty(g)&&"data"!==g&&!ne(p[c][g],t[c][g]))return!1;for(g in t[c])if(t[c].hasOwnProperty(g)&&"data"!==g&&!ne(p[c][g],t[c][g]))return!1;return!0}function Dn(p,t,c,g,b,C){let I;for(I in t=t||{},p=p||{})p.hasOwnProperty(I)&&(ne(p[I],t[I])||c.push({command:C,args:[g,I,t[I],b]}));for(I in t)t.hasOwnProperty(I)&&!p.hasOwnProperty(I)&&(ne(p[I],t[I])||c.push({command:C,args:[g,I,t[I],b]}))}function mi(p){return p.id}function Wn(p,t){return p[t.id]=t,p}class Dr{constructor(t,c){this.reset(t,c)}reset(t,c){this.points=t||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=l.clamp(t,0,1);let c=1,g=this._distances[c];const b=t*this.paddedLength+this.padding;for(;g<b&&c<this._distances.length;)g=this._distances[++c];const C=c-1,I=this._distances[C],S=g-I,U=S>0?(b-I)/S:0;return this.points[C].mult(1-U).add(this.points[c].mult(U))}}class yr{constructor(t,c,g){const b=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(t/g),this.yCellCount=Math.ceil(c/g);for(let I=0;I<this.xCellCount*this.yCellCount;I++)b.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=c,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,c,g,b,C){this._forEachCell(c,g,b,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(c),this.bboxes.push(g),this.bboxes.push(b),this.bboxes.push(C)}insertCircle(t,c,g,b){this._forEachCell(c-b,g-b,c+b,g+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(c),this.circles.push(g),this.circles.push(b)}_insertBoxCell(t,c,g,b,C,I){this.boxCells[C].push(I)}_insertCircleCell(t,c,g,b,C,I){this.circleCells[C].push(I)}_query(t,c,g,b,C,I){if(g<0||t>this.width||b<0||c>this.height)return!C&&[];const S=[];if(t<=0&&c<=0&&this.width<=g&&this.height<=b){if(C)return!0;for(let U=0;U<this.boxKeys.length;U++)S.push({key:this.boxKeys[U],x1:this.bboxes[4*U],y1:this.bboxes[4*U+1],x2:this.bboxes[4*U+2],y2:this.bboxes[4*U+3]});for(let U=0;U<this.circleKeys.length;U++){const q=this.circles[3*U],J=this.circles[3*U+1],ae=this.circles[3*U+2];S.push({key:this.circleKeys[U],x1:q-ae,y1:J-ae,x2:q+ae,y2:J+ae})}return I?S.filter(I):S}return this._forEachCell(t,c,g,b,this._queryCell,S,{hitTest:C,seenUids:{box:{},circle:{}}},I),C?S.length>0:S}_queryCircle(t,c,g,b,C){const I=t-g,S=t+g,U=c-g,q=c+g;if(S<0||I>this.width||q<0||U>this.height)return!b&&[];const J=[];return this._forEachCell(I,U,S,q,this._queryCellCircle,J,{hitTest:b,circle:{x:t,y:c,radius:g},seenUids:{box:{},circle:{}}},C),b?J.length>0:J}query(t,c,g,b,C){return this._query(t,c,g,b,!1,C)}hitTest(t,c,g,b,C){return this._query(t,c,g,b,!0,C)}hitTestCircle(t,c,g,b){return this._queryCircle(t,c,g,!0,b)}_queryCell(t,c,g,b,C,I,S,U){const q=S.seenUids,J=this.boxCells[C];if(null!==J){const Te=this.bboxes;for(const Ve of J)if(!q.box[Ve]){q.box[Ve]=!0;const Oe=4*Ve;if(t<=Te[Oe+2]&&c<=Te[Oe+3]&&g>=Te[Oe+0]&&b>=Te[Oe+1]&&(!U||U(this.boxKeys[Ve]))){if(S.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[Ve],x1:Te[Oe],y1:Te[Oe+1],x2:Te[Oe+2],y2:Te[Oe+3]})}}}const ae=this.circleCells[C];if(null!==ae){const Te=this.circles;for(const Ve of ae)if(!q.circle[Ve]){q.circle[Ve]=!0;const Oe=3*Ve;if(this._circleAndRectCollide(Te[Oe],Te[Oe+1],Te[Oe+2],t,c,g,b)&&(!U||U(this.circleKeys[Ve]))){if(S.hitTest)return I.push(!0),!0;{const xe=Te[Oe],at=Te[Oe+1],Ye=Te[Oe+2];I.push({key:this.circleKeys[Ve],x1:xe-Ye,y1:at-Ye,x2:xe+Ye,y2:at+Ye})}}}}}_queryCellCircle(t,c,g,b,C,I,S,U){const q=S.circle,J=S.seenUids,ae=this.boxCells[C];if(null!==ae){const Ve=this.bboxes;for(const Oe of ae)if(!J.box[Oe]){J.box[Oe]=!0;const xe=4*Oe;if(this._circleAndRectCollide(q.x,q.y,q.radius,Ve[xe+0],Ve[xe+1],Ve[xe+2],Ve[xe+3])&&(!U||U(this.boxKeys[Oe])))return I.push(!0),!0}}const Te=this.circleCells[C];if(null!==Te){const Ve=this.circles;for(const Oe of Te)if(!J.circle[Oe]){J.circle[Oe]=!0;const xe=3*Oe;if(this._circlesCollide(Ve[xe],Ve[xe+1],Ve[xe+2],q.x,q.y,q.radius)&&(!U||U(this.circleKeys[Oe])))return I.push(!0),!0}}}_forEachCell(t,c,g,b,C,I,S,U){const q=this._convertToXCellCoord(t),J=this._convertToYCellCoord(c),ae=this._convertToXCellCoord(g),Te=this._convertToYCellCoord(b);for(let Ve=q;Ve<=ae;Ve++)for(let Oe=J;Oe<=Te;Oe++)if(C.call(this,t,c,g,b,this.xCellCount*Oe+Ve,I,S,U))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,c,g,b,C,I){const S=b-t,U=C-c,q=g+I;return q*q>S*S+U*U}_circleAndRectCollide(t,c,g,b,C,I,S){const U=(I-b)/2,q=Math.abs(t-(b+U));if(q>U+g)return!1;const J=(S-C)/2,ae=Math.abs(c-(C+J));if(ae>J+g)return!1;if(q<=U||ae<=J)return!0;const Te=q-U,Ve=ae-J;return Te*Te+Ve*Ve<=g*g}}const jn=Math.tan(85*Math.PI/180);function $r(p,t,c,g,b,C){const I=l.create();if(c){if("globe"===b.projection.name)l.multiply$1(I,I,l.calculateGlobeLabelMatrix(b,t));else{const S=ve([],C);I[0]=S[0],I[1]=S[1],I[4]=S[2],I[5]=S[3]}g||l.rotateZ(I,I,b.angle)}else l.multiply$1(I,b.labelPlaneMatrix,p);return I}function jr(p,t,c,g,b,C){if(c){if("globe"===b.projection.name){const I=$r(p,t,c,g,b,C);return l.invert(I,I),l.multiply$1(I,p,I),I}{const I=l.clone(p),S=l.identity([]);return S[0]=C[0],S[1]=C[1],S[4]=C[2],S[5]=C[3],l.multiply$1(I,I,S),g||l.rotateZ(I,I,-b.angle),I}}return b.glCoordMatrix}function Ir(p,t,c=0){const g=[p.x,p.y,c,1];c?l.transformMat4$1(g,g,t):kt(g,g,t);const b=g[3];return{point:new l.pointGeometry(g[0]/b,g[1]/b),signedDistanceFromCamera:b}}function wr(p,t){const c=[p[0],p[1],p[2],1];l.transformMat4$1(c,c,t);const g=c[3];return{point:new l.pointGeometry(c[0]/g,c[1]/g),signedDistanceFromCamera:g}}function ki(p,t){return Math.min(.5+p/t*.5,1.5)}function Br(p,t){const c=p[0]/p[3],g=p[1]/p[3];return c>=-t[0]&&c<=t[0]&&g>=-t[1]&&g<=t[1]}function Kr(p,t,c,g,b,C,I,S,U,q){const J=c.transform,ae=g?p.textSizeData:p.iconSizeData,Te=l.evaluateSizeForZoom(ae,c.transform.zoom),Ve=[256/c.width*2+1,256/c.height*2+1],Oe=g?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;Oe.clear();const xe=p.lineVertexArray,at=g?p.text.placedSymbolArray:p.icon.placedSymbolArray,Ye=c.transform.width/c.transform.height;let rt=!1;for(let ot=0;ot<at.length;ot++){const mt=at.get(ot);if(mt.writingMode!==l.WritingMode.vertical||rt||0!==ot&&at.get(ot-1).writingMode===l.WritingMode.horizontal||(rt=!0),(mt.hidden||mt.writingMode===l.WritingMode.vertical)&&!rt){ct(mt.numGlyphs,Oe);continue}rt=!1;const nt=new l.pointGeometry(mt.tileAnchorX,mt.tileAnchorY),bt=U?U(nt):[0,0,0],Jt=J.projection.projectTilePoint(nt.x,nt.y,q.canonical),rn=[Jt.x+bt[0],Jt.y+bt[1],Jt.z+bt[2]],hn=[...rn,1];if(l.transformMat4$1(hn,hn,t),!Br(hn,Ve)){ct(mt.numGlyphs,Oe);continue}const un=ki(c.transform.cameraToCenterDistance,hn[3]),Un=l.evaluateSizeForFeature(ae,Te,mt),Zt=I?Un/un:Un*un,Vn=Ir(new l.pointGeometry(rn[0],rn[1]),b,rn[2]);if(Vn.signedDistanceFromCamera<=0){ct(mt.numGlyphs,Oe);continue}let Bn={};const li=I?null:U,pn=Ee(mt,Zt,!1,S,t,b,C,p.glyphOffsetArray,xe,Oe,Vn.point,nt,Bn,Ye,li,J.projection,q);rt=pn.useVertical,li&&pn.needsFlipping&&(Bn={}),(pn.notEnoughRoom||rt||pn.needsFlipping&&Ee(mt,Zt,!0,S,t,b,C,p.glyphOffsetArray,xe,Oe,Vn.point,nt,Bn,Ye,li,J.projection,q).notEnoughRoom)&&ct(mt.numGlyphs,Oe)}g?p.text.dynamicLayoutVertexBuffer.updateData(Oe):p.icon.dynamicLayoutVertexBuffer.updateData(Oe)}function Lr(p,t,c,g,b,C,I,S,U,q,J,ae,Te,Ve,Oe){const xe=S.glyphStartIndex+S.numGlyphs,at=S.lineStartIndex,Ye=S.lineStartIndex+S.lineLength,rt=t.getoffsetX(S.glyphStartIndex),ot=t.getoffsetX(xe-1),mt=Gt(p*rt,c,g,b,C,I,S.segment,at,Ye,U,q,J,ae,Te,!0,Ve,Oe);if(!mt)return null;const nt=Gt(p*ot,c,g,b,C,I,S.segment,at,Ye,U,q,J,ae,Te,!0,Ve,Oe);return nt?{first:mt,last:nt}:null}function Yi(p,t,c,g){return p.writingMode===l.WritingMode.horizontal&&Math.abs(c.y-t.y)>Math.abs(c.x-t.x)*g?{useVertical:!0}:p.writingMode===l.WritingMode.vertical?t.y<c.y?{needsFlipping:!0}:null:0!==p.flipState&&function(b,C,I){const S=(C.x-b.x)*I;return 0===S||Math.abs((C.y-b.y)/S)>jn}(t,c,g)?1===p.flipState?{needsFlipping:!0}:null:t.x>c.x?{needsFlipping:!0}:null}function Ee(p,t,c,g,b,C,I,S,U,q,J,ae,Te,Ve,Oe,xe,at){const Ye=t/24,rt=p.lineOffsetX*Ye,ot=p.lineOffsetY*Ye;let mt;if(p.numGlyphs>1){const nt=p.glyphStartIndex+p.numGlyphs,bt=p.lineStartIndex,Jt=p.lineStartIndex+p.lineLength,rn=Lr(Ye,S,rt,ot,c,J,ae,p,U,C,Te,Oe,!1,xe,at);if(!rn)return{notEnoughRoom:!0};const hn=Ir(rn.first.point,I).point,un=Ir(rn.last.point,I).point;if(g&&!c){const Un=Yi(p,hn,un,Ve);if(p.flipState=Un&&Un.needsFlipping?1:2,Un)return Un}mt=[rn.first];for(let Un=p.glyphStartIndex+1;Un<nt-1;Un++)mt.push(Gt(Ye*S.getoffsetX(Un),rt,ot,c,J,ae,p.segment,bt,Jt,U,C,Te,Oe,!1,!1,xe,at));mt.push(rn.last)}else{if(g&&!c){const bt=Ir(ae,b).point,Jt=p.lineStartIndex+p.segment+1,rn=new l.pointGeometry(U.getx(Jt),U.gety(Jt)),hn=Ir(rn,b),un=Yi(p,bt,hn.signedDistanceFromCamera>0?hn.point:vt(ae,rn,bt,1,b,void 0,xe,at.canonical),Ve);if(p.flipState=un&&un.needsFlipping?1:2,un)return un}const nt=Gt(Ye*S.getoffsetX(p.glyphStartIndex),rt,ot,c,J,ae,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,U,C,Te,Oe,!1,!1,xe,at);if(!nt)return{notEnoughRoom:!0};mt=[nt]}for(const nt of mt)l.addDynamicAttributes(q,nt.point,nt.angle);return{}}function Xe(p,t,c,g,b){const C=g.projectTilePoint(p.x,p.y,t);if(!b)return Ir(C,c,C.z);const I=b(p);return Ir(new l.pointGeometry(C.x+I[0],C.y+I[1]),c,C.z+I[2])}function vt(p,t,c,g,b,C,I,S){const U=Xe(p.add(p.sub(t)._unit()),S,b,I,C).point,q=c.sub(U);return c.add(q._mult(g/q.mag()))}function Gt(p,t,c,g,b,C,I,S,U,q,J,ae,Te,Ve,Oe,xe,at){const Ye=g?p-t:p+t;let rt=Ye>0?1:-1,ot=0;g&&(rt*=-1,ot=Math.PI),rt<0&&(ot+=Math.PI);let mt=rt>0?S+I:S+I+1,nt=b,bt=b,Jt=0,rn=0;const hn=Math.abs(Ye),un=[],Un=[];let Zt=C;const Vn=()=>{const ui=mt-rt;return 0===Jt?C:new l.pointGeometry(q.getx(ui),q.gety(ui))},Bn=()=>vt(Vn(),Zt,bt,hn-Jt+1,J,Te,xe,at.canonical);for(;Jt+rn<=hn;){if(mt+=rt,mt<S||mt>=U)return null;if(bt=nt,un.push(nt),Ve&&Un.push(Zt||Vn()),nt=ae[mt],void 0===nt){Zt=new l.pointGeometry(q.getx(mt),q.gety(mt));const ui=Xe(Zt,at.canonical,J,xe,Te);nt=ui.signedDistanceFromCamera>0?ae[mt]=ui.point:Bn()}else Zt=null;Jt+=rn,rn=bt.dist(nt)}Oe&&Te&&(Zt=Zt||new l.pointGeometry(q.getx(mt),q.gety(mt)),ae[mt]=nt=void 0===ae[mt]?nt:Bn(),rn=bt.dist(nt));const li=(hn-Jt)/rn,pn=nt.sub(bt),ci=pn.mult(li)._add(bt);c&&ci._add(pn._unit()._perp()._mult(c*rt));const Ti=ot+Math.atan2(nt.y-bt.y,nt.x-bt.x);return un.push(ci),Ve&&(Zt=Zt||new l.pointGeometry(q.getx(mt),q.gety(mt)),Un.push(function(ui,si,Ei){const qi=1-Ei;return new l.pointGeometry(ui.x*qi+si.x*Ei,ui.y*qi+si.y*Ei)}(Un.length>0?Un[Un.length-1]:Zt,Zt,li))),{point:ci,angle:Ti,path:un,tilePath:Un}}const et=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ct(p,t){for(let c=0;c<p;c++){const g=t.length;t.resize(g+4),t.float32.set(et,3*g)}}function kt(p,t,c){const g=t[0],b=t[1];return p[0]=c[0]*g+c[4]*b+c[12],p[1]=c[1]*g+c[5]*b+c[13],p[3]=c[3]*g+c[7]*b+c[15],p}const en=100;class bn{constructor(t,c,g=new yr(t.width+200,t.height+200,25),b=new yr(t.width+200,t.height+200,25)){this.transform=t,this.grid=g,this.ignoredGrid=b,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+en,this.screenBottomBoundary=t.height+en,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=c}placeCollisionBox(t,c,g,b,C,I,S){let U=c.projectedAnchorX,q=c.projectedAnchorY,J=c.projectedAnchorZ;const ae=c.elevation,Te=c.tileID;if(ae&&Te){const mt=this.transform.projection.upVector(Te.canonical,c.tileAnchorX,c.tileAnchorY),nt=this.transform.projection.upVectorScale(Te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;U+=mt[0]*ae*nt,q+=mt[1]*ae*nt,J+=mt[2]*ae*nt}const Ve=this.projectAndGetPerspectiveRatio(I,[U,q,J],c.tileID,"globe"===this.transform.projection.name||!!ae||this.transform.pitch>0),Oe=C*Ve.perspectiveRatio,xe=(c.x1*t+g.x-c.padding)*Oe+Ve.point.x,at=(c.y1*t+g.y-c.padding)*Oe+Ve.point.y,Ye=(c.x2*t+g.x+c.padding)*Oe+Ve.point.x,rt=(c.y2*t+g.y+c.padding)*Oe+Ve.point.y,ot=Ve.perspectiveRatio<=.55||Ve.occluded;return!this.isInsideGrid(xe,at,Ye,rt)||!b&&this.grid.hitTest(xe,at,Ye,rt,S)||ot?{box:[],offscreen:!1,occluded:Ve.occluded}:{box:[xe,at,Ye,rt],offscreen:this.isOffscreen(xe,at,Ye,rt),occluded:!1}}placeCollisionCircles(t,c,g,b,C,I,S,U,q,J,ae,Te,Ve,Oe){const xe=[],at=this.transform.elevation,Ye=at?at.getAtTileOffsetFunc(Oe,this.transform.center.lat,this.transform.worldSize,this.transform.projection):Bn=>[0,0,0],rt=new l.pointGeometry(c.tileAnchorX,c.tileAnchorY),ot=this.transform.projection.projectTilePoint(c.tileAnchorX,c.tileAnchorY,Oe.canonical),mt=Ye(rt),nt=[ot.x+mt[0],ot.y+mt[1],ot.z+mt[2]],bt=this.projectAndGetPerspectiveRatio(I,[nt[0],nt[1],nt[2]],Oe,"globe"===this.transform.projection.name||!!at||this.transform.pitch>0),{perspectiveRatio:Jt}=bt,rn=(J?C/Jt:C*Jt)/l.ONE_EM,hn=Ir(new l.pointGeometry(nt[0],nt[1]),S,nt[2]).point,un=bt.signedDistanceFromCamera>0?Lr(rn,b,c.lineOffsetX*rn,c.lineOffsetY*rn,!1,hn,rt,c,g,S,{},at&&!J?Ye:null,J&&!!at,this.transform.projection,Oe):null;let Un=!1,Zt=!1,Vn=!0;if(un&&!bt.occluded){const Bn=.5*Te*Jt+Ve,li=new l.pointGeometry(-100,-100),pn=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ci=new Dr,Ti=un.first,ui=un.last;let si=[];for(let _i=Ti.path.length-1;_i>=1;_i--)si.push(Ti.path[_i]);for(let _i=1;_i<ui.path.length;_i++)si.push(ui.path[_i]);const Ei=2.5*Bn;if(U){const _i=si.map(at?(Fi,hr)=>{const no=Ye(hr<Ti.path.length-1?Ti.tilePath[Ti.path.length-1-hr]:ui.tilePath[hr-Ti.path.length+2]);return Ir(Fi,U,no[2])}:Fi=>Ir(Fi,U));si=_i.some(Fi=>Fi.signedDistanceFromCamera<=0)?[]:_i.map(Fi=>Fi.point)}let qi=[];if(si.length>0){const _i=si[0].clone(),Fi=si[0].clone();for(let hr=1;hr<si.length;hr++)_i.x=Math.min(_i.x,si[hr].x),_i.y=Math.min(_i.y,si[hr].y),Fi.x=Math.max(Fi.x,si[hr].x),Fi.y=Math.max(Fi.y,si[hr].y);qi=_i.x>=li.x&&Fi.x<=pn.x&&_i.y>=li.y&&Fi.y<=pn.y?[si]:Fi.x<li.x||_i.x>pn.x||Fi.y<li.y||_i.y>pn.y?[]:l.clipLine([si],li.x,li.y,pn.x,pn.y)}for(const _i of qi){ci.reset(_i,.25*Bn);let Fi=0;Fi=ci.length<=.5*Bn?1:Math.ceil(ci.paddedLength/Ei)+1;for(let hr=0;hr<Fi;hr++){const no=hr/Math.max(Fi-1,1),Bo=ci.lerp(no),ts=Bo.x+en,Fs=Bo.y+en;xe.push(ts,Fs,Bn,0);const ua=ts-Bn,As=Fs-Bn,Ks=ts+Bn,Ra=Fs+Bn;if(Vn=Vn&&this.isOffscreen(ua,As,Ks,Ra),Zt=Zt||this.isInsideGrid(ua,As,Ks,Ra),!t&&this.grid.hitTestCircle(ts,Fs,Bn,ae)&&(Un=!0,!q))return{circles:[],offscreen:!1,collisionDetected:Un,occluded:!1}}}}return{circles:!q&&Un||!Zt?[]:xe,offscreen:Vn,collisionDetected:Un,occluded:bt.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let g=1/0,b=1/0,C=-1/0,I=-1/0;for(const J of t){const ae=new l.pointGeometry(J.x+en,J.y+en);g=Math.min(g,ae.x),b=Math.min(b,ae.y),C=Math.max(C,ae.x),I=Math.max(I,ae.y),c.push(ae)}const S=this.grid.query(g,b,C,I).concat(this.ignoredGrid.query(g,b,C,I)),U={},q={};for(const J of S){const ae=J.key;if(void 0===U[ae.bucketInstanceId]&&(U[ae.bucketInstanceId]={}),U[ae.bucketInstanceId][ae.featureIndex])continue;const Te=[new l.pointGeometry(J.x1,J.y1),new l.pointGeometry(J.x2,J.y1),new l.pointGeometry(J.x2,J.y2),new l.pointGeometry(J.x1,J.y2)];l.polygonIntersectsPolygon(c,Te)&&(U[ae.bucketInstanceId][ae.featureIndex]=!0,void 0===q[ae.bucketInstanceId]&&(q[ae.bucketInstanceId]=[]),q[ae.bucketInstanceId].push(ae.featureIndex))}return q}insertCollisionBox(t,c,g,b,C){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:b,collisionGroupID:C},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,c,g,b,C){const I=c?this.ignoredGrid:this.grid,S={bucketInstanceId:g,featureIndex:b,collisionGroupID:C};for(let U=0;U<t.length;U+=4)I.insertCircle(S,t[U],t[U+1],t[U+2])}projectAndGetPerspectiveRatio(t,c,g,b){const C=[c[0],c[1],c[2],1];let I=!1;return c[2]||this.transform.pitch>0?(l.transformMat4$1(C,C,t),this.fogState&&g&&(I=function(S,U,q,J,ae,Te){const Ve=Te.calculateFogTileMatrix(ae),Oe=[U,q,J];return l.transformMat4(Oe,Oe,Ve),st(S,Oe,Te.pitch,Te._fov)}(this.fogState,c[0],c[1],c[2],g.toUnwrapped(),this.transform)>.9)):kt(C,C,t),{point:new l.pointGeometry((C[0]/C[3]+1)/2*this.transform.width+en,(-C[1]/C[3]+1)/2*this.transform.height+en),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/C[3]*.5,1.5),signedDistanceFromCamera:C[3],occluded:b&&C[2]>C[3]||I}}isOffscreen(t,c,g,b){return g<en||t>=this.screenRightBoundary||b<en||c>this.screenBottomBoundary}isInsideGrid(t,c,g,b){return g>=0&&t<this.gridRightBoundary&&b>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const t=l.identity([]);return l.translate(t,t,[-100,-100,0]),t}}class nn{constructor(t,c,g,b){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?c:-c))):b&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class Nn{constructor(t,c,g,b,C,I=!1){this.text=new nn(t?t.text:null,c,g,C),this.icon=new nn(t?t.icon:null,c,b,C),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class hi{constructor(t,c,g,b=!1){this.text=t,this.icon=c,this.skipFade=g,this.clipped=b}}class bi{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class Bi{constructor(t,c,g,b,C){this.bucketInstanceId=t,this.featureIndex=c,this.sourceLayerIndex=g,this.bucketIndex=b,this.tileID=C}}class Ki{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const c=++this.maxGroupID;this.collisionGroups[t]={ID:c,predicate:g=>g.collisionGroupID===c}}return this.collisionGroups[t]}}function zr(p,t,c,g,b){const{horizontalAlign:C,verticalAlign:I}=l.getAnchorAlignment(p),S=-(C-.5)*t,U=-(I-.5)*c,q=l.evaluateVariableOffset(p,g);return new l.pointGeometry(S+q[0]*b,U+q[1]*b)}function Nr(p,t,c,g,b){const C=new l.pointGeometry(p,t);return c&&C._rotate(g?b:-b),C}class Jo{constructor(t,c,g,b,C){this.transform=t.clone(),this.collisionIndex=new bn(this.transform,C),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Ki(g),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,c,g,b){const C=g.getBucket(c),I=g.latestFeatureIndex;if(!C||!I||c.id!==C.layerIds[0])return;const S=C.layers[0].layout,U=g.collisionBoxArray,q=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),J=g.tileSize/l.EXTENT,ae=g.tileID.toUnwrapped(),Te=this.transform.calculateProjMatrix(ae),Ve="map"===S.get("text-pitch-alignment"),Oe="map"===S.get("text-rotation-alignment");c.compileFilter();const xe=c.dynamicFilter(),at=c.dynamicFilterNeedsFeature(),Ye=this.transform.calculatePixelsToTileUnitsMatrix(g),rt=$r(Te,g.tileID.canonical,Ve,Oe,this.transform,Ye);let ot=null;if(Ve){const bt=jr(Te,g.tileID.canonical,Ve,Oe,this.transform,Ye);ot=l.multiply$1([],this.transform.labelPlaneMatrix,bt)}let mt=null;xe&&g.latestFeatureIndex&&(mt={unwrappedTileID:ae,dynamicFilter:xe,dynamicFilterNeedsFeature:at,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new Bi(C.bucketInstanceId,I,C.sourceLayerIndex,C.index,g.tileID);const nt={bucket:C,layout:S,posMatrix:Te,textLabelPlaneMatrix:rt,labelToScreenMatrix:ot,clippingData:mt,scale:q,textPixelRatio:J,holdingForFade:g.holdingForFade(),collisionBoxArray:U,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:l.evaluateSizeForZoom(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(b)for(const bt of C.sortKeyRanges){const{sortKey:Jt,symbolInstanceStart:rn,symbolInstanceEnd:hn}=bt;t.push({sortKey:Jt,symbolInstanceStart:rn,symbolInstanceEnd:hn,parameters:nt})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:nt})}attemptAnchorPlacement(t,c,g,b,C,I,S,U,q,J,ae,Te,Ve,Oe,xe,at,Ye,rt){const ot=[Te.textOffset0,Te.textOffset1],mt=zr(t,g,b,ot,C),nt=this.collisionIndex.placeCollisionBox(C,c,Nr(mt.x,mt.y,I,S,this.transform.angle),ae,U,q,J.predicate);if((!at||0!==this.collisionIndex.placeCollisionBox(Oe.getSymbolInstanceIconSize(rt,this.transform.zoom,Ve),at,Nr(mt.x,mt.y,I,S,this.transform.angle),ae,U,q,J.predicate).box.length)&&nt.box.length>0){let bt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Te.crossTileID]&&this.prevPlacement.placements[Te.crossTileID]&&this.prevPlacement.placements[Te.crossTileID].text&&(bt=this.prevPlacement.variableOffsets[Te.crossTileID].anchor),this.variableOffsets[Te.crossTileID]={textOffset:ot,width:g,height:b,anchor:t,textScale:C,prevAnchor:bt},this.markUsedJustification(Oe,t,Te,xe),Oe.allowVerticalPlacement&&(this.markUsedOrientation(Oe,xe,Te),this.placedOrientations[Te.crossTileID]=xe),{shift:mt,placedGlyphBoxes:nt}}}placeLayerBucketPart(t,c,g,b){const{bucket:C,layout:I,posMatrix:S,textLabelPlaneMatrix:U,labelToScreenMatrix:q,clippingData:J,textPixelRatio:ae,holdingForFade:Te,collisionBoxArray:Ve,partiallyEvaluatedTextSize:Oe,partiallyEvaluatedIconSize:xe,collisionGroup:at}=t.parameters,Ye=I.get("text-optional"),rt=I.get("icon-optional"),ot=I.get("text-allow-overlap"),mt=I.get("icon-allow-overlap"),nt="map"===I.get("text-rotation-alignment"),bt="map"===I.get("text-pitch-alignment"),Jt="none"!==I.get("icon-text-fit"),rn="viewport-y"===I.get("symbol-z-order");let hn=ot&&(mt||!C.hasIconData()||rt),un=mt&&(ot||!C.hasTextData()||Ye);!C.collisionArrays&&Ve&&C.deserializeCollisionBoxes(Ve),g&&b&&C.updateCollisionDebugBuffers(this.transform.zoom,Ve);const Un=(Zt,Vn,Bn)=>{if(J){const wo={zoom:this.transform.zoom,pitch:this.transform.pitch};let mo=null;if(J.dynamicFilterNeedsFeature){const Er=this.retainedQueryData[C.bucketInstanceId];mo=J.featureIndex.loadFeature({featureIndex:Zt.featureIndex,bucketIndex:Er.bucketIndex,sourceLayerIndex:Er.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,J.dynamicFilter)(wo,mo,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new l.pointGeometry(Zt.tileAnchorX,Zt.tileAnchorY),this.transform.calculateDistanceTileData(J.unwrappedTileID)))return this.placements[Zt.crossTileID]=new hi(!1,!1,!1,!0),void(c[Zt.crossTileID]=!0)}if(c[Zt.crossTileID])return;if(Te)return void(this.placements[Zt.crossTileID]=new hi(!1,!1,!1));let li=!1,pn=!1,ci=!0,Ti=!1,ui=!1,si=null,Ei={box:null,offscreen:null,occluded:null},qi={box:null,offscreen:null,occluded:null},_i=null,Fi=null,hr=null,no=0,Bo=0,ts=0;Bn.textFeatureIndex?no=Bn.textFeatureIndex:Zt.useRuntimeCollisionCircles&&(no=Zt.featureIndex),Bn.verticalTextFeatureIndex&&(Bo=Bn.verticalTextFeatureIndex);const Fs=wo=>{wo.tileID=this.retainedQueryData[C.bucketInstanceId].tileID,(this.transform.elevation||wo.elevation)&&(wo.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[C.bucketInstanceId].tileID,wo.tileAnchorX,wo.tileAnchorY):0)},ua=Bn.textBox;if(ua){Fs(ua);const wo=Er=>{let Ro=l.WritingMode.horizontal;if(C.allowVerticalPlacement&&!Er&&this.prevPlacement){const Bs=this.prevPlacement.placedOrientations[Zt.crossTileID];Bs&&(this.placedOrientations[Zt.crossTileID]=Bs,Ro=Bs,this.markUsedOrientation(C,Ro,Zt))}return Ro},mo=(Er,Ro)=>{if(C.allowVerticalPlacement&&Zt.numVerticalGlyphVertices>0&&Bn.verticalTextBox){for(const Bs of C.writingModes)if(Bs===l.WritingMode.vertical?(Ei=Ro(),qi=Ei):Ei=Er(),Ei&&Ei.box&&Ei.box.length)break}else Ei=Er()};if(I.get("text-variable-anchor")){let Er=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Zt.crossTileID]){const co=this.prevPlacement.variableOffsets[Zt.crossTileID];Er.indexOf(co.anchor)>0&&(Er=Er.filter(Qs=>Qs!==co.anchor),Er.unshift(co.anchor))}const Ro=(co,Qs,il)=>{const vs=C.getSymbolInstanceTextSize(Oe,Zt,this.transform.zoom,Vn),ea=(co.x2-co.x1)*vs+2*co.padding,Sd=(co.y2-co.y1)*vs+2*co.padding,ku=Jt&&!mt?Qs:null;ku&&Fs(ku);let bc={box:[],offscreen:!1,occluded:!1};const Wc=ot?2*Er.length:Er.length;for(let wa=0;wa<Wc;++wa){const Yc=this.attemptAnchorPlacement(Er[wa%Er.length],co,ea,Sd,vs,nt,bt,ae,S,at,wa>=Er.length,Zt,Vn,C,il,ku,Oe,xe);if(Yc&&(bc=Yc.placedGlyphBoxes,bc&&bc.box&&bc.box.length)){li=!0,si=Yc.shift;break}}return bc};mo(()=>Ro(ua,Bn.iconBox,l.WritingMode.horizontal),()=>{const co=Bn.verticalTextBox;return co&&Fs(co),C.allowVerticalPlacement&&!(Ei&&Ei.box&&Ei.box.length)&&Zt.numVerticalGlyphVertices>0&&co?Ro(co,Bn.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Ei&&(li=Ei.box,ci=Ei.offscreen,Ti=Ei.occluded);const Bs=wo(Ei&&Ei.box);if(!li&&this.prevPlacement){const co=this.prevPlacement.variableOffsets[Zt.crossTileID];co&&(this.variableOffsets[Zt.crossTileID]=co,this.markUsedJustification(C,co.anchor,Zt,Bs))}}else{const Er=(Ro,Bs)=>{const co=C.getSymbolInstanceTextSize(Oe,Zt,this.transform.zoom,Vn),Qs=this.collisionIndex.placeCollisionBox(co,Ro,new l.pointGeometry(0,0),ot,ae,S,at.predicate);return Qs&&Qs.box&&Qs.box.length&&(this.markUsedOrientation(C,Bs,Zt),this.placedOrientations[Zt.crossTileID]=Bs),Qs};mo(()=>Er(ua,l.WritingMode.horizontal),()=>{const Ro=Bn.verticalTextBox;return C.allowVerticalPlacement&&Zt.numVerticalGlyphVertices>0&&Ro?(Fs(Ro),Er(Ro,l.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),wo(Ei&&Ei.box&&Ei.box.length)}}if(_i=Ei,li=_i&&_i.box&&_i.box.length>0,ci=_i&&_i.offscreen,Ti=_i&&_i.occluded,Zt.useRuntimeCollisionCircles){const wo=C.text.placedSymbolArray.get(Zt.centerJustifiedTextSymbolIndex>=0?Zt.centerJustifiedTextSymbolIndex:Zt.verticalPlacedTextSymbolIndex),mo=l.evaluateSizeForFeature(C.textSizeData,Oe,wo),Er=I.get("text-padding");Fi=this.collisionIndex.placeCollisionCircles(ot,wo,C.lineVertexArray,C.glyphOffsetArray,mo,S,U,q,g,bt,at.predicate,Zt.collisionCircleDiameter*mo/l.ONE_EM,Er,this.retainedQueryData[C.bucketInstanceId].tileID),li=ot||Fi.circles.length>0&&!Fi.collisionDetected,ci=ci&&Fi.offscreen,Ti=Fi.occluded}if(Bn.iconFeatureIndex&&(ts=Bn.iconFeatureIndex),Bn.iconBox){const wo=mo=>{Fs(mo);const Er=Jt&&si?Nr(si.x,si.y,nt,bt,this.transform.angle):new l.pointGeometry(0,0),Ro=C.getSymbolInstanceIconSize(xe,this.transform.zoom,Vn);return this.collisionIndex.placeCollisionBox(Ro,mo,Er,mt,ae,S,at.predicate)};qi&&qi.box&&qi.box.length&&Bn.verticalIconBox?(hr=wo(Bn.verticalIconBox),pn=hr.box.length>0):(hr=wo(Bn.iconBox),pn=hr.box.length>0),ci=ci&&hr.offscreen,ui=hr.occluded}const As=Ye||0===Zt.numHorizontalGlyphVertices&&0===Zt.numVerticalGlyphVertices,Ks=rt||0===Zt.numIconVertices;if(As||Ks?Ks?As||(pn=pn&&li):li=pn&&li:pn=li=pn&&li,li&&_i&&_i.box&&this.collisionIndex.insertCollisionBox(_i.box,I.get("text-ignore-placement"),C.bucketInstanceId,qi&&qi.box&&Bo?Bo:no,at.ID),pn&&hr&&this.collisionIndex.insertCollisionBox(hr.box,I.get("icon-ignore-placement"),C.bucketInstanceId,ts,at.ID),Fi&&(li&&this.collisionIndex.insertCollisionCircles(Fi.circles,I.get("text-ignore-placement"),C.bucketInstanceId,no,at.ID),g)){const wo=C.bucketInstanceId;let mo=this.collisionCircleArrays[wo];void 0===mo&&(mo=this.collisionCircleArrays[wo]=new bi);for(let Er=0;Er<Fi.circles.length;Er+=4)mo.circles.push(Fi.circles[Er+0]),mo.circles.push(Fi.circles[Er+1]),mo.circles.push(Fi.circles[Er+2]),mo.circles.push(Fi.collisionDetected?1:0)}const Ra="globe"!==this.transform.projection.name;hn=hn&&(Ra||!Ti),un=un&&(Ra||!ui),this.placements[Zt.crossTileID]=new hi(li||hn,pn||un,ci||C.justReloaded),c[Zt.crossTileID]=!0};if(rn){const Zt=C.getSortedSymbolIndexes(this.transform.angle);for(let Vn=Zt.length-1;Vn>=0;--Vn){const Bn=Zt[Vn];Un(C.symbolInstances.get(Bn),Bn,C.collisionArrays[Bn])}}else for(let Zt=t.symbolInstanceStart;Zt<t.symbolInstanceEnd;Zt++)Un(C.symbolInstances.get(Zt),Zt,C.collisionArrays[Zt]);if(g&&C.bucketInstanceId in this.collisionCircleArrays){const Zt=this.collisionCircleArrays[C.bucketInstanceId];l.invert(Zt.invProjMatrix,S),Zt.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(t,c,g,b){let C;C=b===l.WritingMode.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(c)];const I=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const S of I)S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=C>=0&&S!==C?0:g.crossTileID)}markUsedOrientation(t,c,g){const b=c===l.WritingMode.horizontal||c===l.WritingMode.horizontalOnly?c:0,C=c===l.WritingMode.vertical?c:0,I=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const S of I)t.text.placedSymbolArray.get(S).placedOrientation=b;g.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=C)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let g=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const b=c?c.symbolFadeChange(t):1,C=c?c.opacities:{},I=c?c.variableOffsets:{},S=c?c.placedOrientations:{};for(const U in this.placements){const q=this.placements[U],J=C[U];J?(this.opacities[U]=new Nn(J,b,q.text,q.icon,null,q.clipped),g=g||q.text!==J.text.placed||q.icon!==J.icon.placed):(this.opacities[U]=new Nn(null,b,q.text,q.icon,q.skipFade,q.clipped),g=g||q.text||q.icon)}for(const U in C){const q=C[U];if(!this.opacities[U]){const J=new Nn(q,b,!1,!1);J.isHidden()||(this.opacities[U]=J,g=g||q.text.placed||q.icon.placed)}}for(const U in I)this.variableOffsets[U]||!this.opacities[U]||this.opacities[U].isHidden()||(this.variableOffsets[U]=I[U]);for(const U in S)this.placedOrientations[U]||!this.opacities[U]||this.opacities[U].isHidden()||(this.placedOrientations[U]=S[U]);g?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:t)}updateLayerOpacities(t,c){const g={};for(const b of c){const C=b.getBucket(t);C&&b.latestFeatureIndex&&t.id===C.layerIds[0]&&this.updateBucketOpacities(C,g,b.collisionBoxArray)}}updateBucketOpacities(t,c,g){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const b=t.layers[0].layout,C=!!t.layers[0].dynamicFilter(),I=new Nn(null,0,!1,!1,!0),S=b.get("text-allow-overlap"),U=b.get("icon-allow-overlap"),q=b.get("text-variable-anchor"),J="map"===b.get("text-rotation-alignment"),ae="map"===b.get("text-pitch-alignment"),Te="none"!==b.get("icon-text-fit"),Ve=new Nn(null,0,S&&(U||!t.hasIconData()||b.get("icon-optional")),U&&(S||!t.hasTextData()||b.get("text-optional")),!0);!t.collisionArrays&&g&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(g);const Oe=(at,Ye,rt)=>{for(let ot=0;ot<Ye/4;ot++)at.opacityVertexArray.emplaceBack(rt)};let xe=0;for(let at=0;at<t.symbolInstances.length;at++){const Ye=t.symbolInstances.get(at),{numHorizontalGlyphVertices:rt,numVerticalGlyphVertices:ot,crossTileID:mt}=Ye;let nt=this.opacities[mt];c[mt]?nt=I:nt||(nt=Ve,this.opacities[mt]=nt),c[mt]=!0;const bt=rt>0||ot>0,Jt=Ye.numIconVertices>0,rn=this.placedOrientations[Ye.crossTileID],hn=rn===l.WritingMode.vertical,un=rn===l.WritingMode.horizontal||rn===l.WritingMode.horizontalOnly;if(!bt&&!Jt||nt.isHidden()||xe++,bt){const Un=Le(nt.text);Oe(t.text,rt,hn?Ft:Un),Oe(t.text,ot,un?Ft:Un);const Zt=nt.text.isHidden();[Ye.rightJustifiedTextSymbolIndex,Ye.centerJustifiedTextSymbolIndex,Ye.leftJustifiedTextSymbolIndex].forEach(li=>{li>=0&&(t.text.placedSymbolArray.get(li).hidden=Zt||hn?1:0)}),Ye.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Ye.verticalPlacedTextSymbolIndex).hidden=Zt||un?1:0);const Vn=this.variableOffsets[Ye.crossTileID];Vn&&this.markUsedJustification(t,Vn.anchor,Ye,rn);const Bn=this.placedOrientations[Ye.crossTileID];Bn&&(this.markUsedJustification(t,"left",Ye,Bn),this.markUsedOrientation(t,Bn,Ye))}if(Jt){const Un=Le(nt.icon);Ye.placedIconSymbolIndex>=0&&(Oe(t.icon,Ye.numIconVertices,hn?Ft:Un),t.icon.placedSymbolArray.get(Ye.placedIconSymbolIndex).hidden=nt.icon.isHidden()),Ye.verticalPlacedIconSymbolIndex>=0&&(Oe(t.icon,Ye.numVerticalIconVertices,un?Ft:Un),t.icon.placedSymbolArray.get(Ye.verticalPlacedIconSymbolIndex).hidden=nt.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Un=t.collisionArrays[at];if(Un){let Zt=new l.pointGeometry(0,0),Vn=!0;if(Un.textBox||Un.verticalTextBox){if(q){const li=this.variableOffsets[mt];li?(Zt=zr(li.anchor,li.width,li.height,li.textOffset,li.textScale),J&&Zt._rotate(ae?this.transform.angle:-this.transform.angle)):Vn=!1}C&&(Vn=!nt.clipped),Un.textBox&&ho(t.textCollisionBox.collisionVertexArray,nt.text.placed,!Vn||hn,Zt.x,Zt.y),Un.verticalTextBox&&ho(t.textCollisionBox.collisionVertexArray,nt.text.placed,!Vn||un,Zt.x,Zt.y)}const Bn=Vn&&Boolean(!un&&Un.verticalIconBox);Un.iconBox&&ho(t.iconCollisionBox.collisionVertexArray,nt.icon.placed,Bn,Te?Zt.x:0,Te?Zt.y:0),Un.verticalIconBox&&ho(t.iconCollisionBox.collisionVertexArray,nt.icon.placed,!Bn,Te?Zt.x:0,Te?Zt.y:0)}}}if(t.fullyClipped=0===xe,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const at=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=at.invProjMatrix,t.placementViewportMatrix=at.viewportMatrix,t.collisionCircleArray=at.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,c){const g=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*g>t}setStale(){this.stale=!0}}function ho(p,t,c,g,b){p.emplaceBack(t?1:0,c?1:0,g||0,b||0),p.emplaceBack(t?1:0,c?1:0,g||0,b||0),p.emplaceBack(t?1:0,c?1:0,g||0,b||0),p.emplaceBack(t?1:0,c?1:0,g||0,b||0)}const os=Math.pow(2,25),ss=Math.pow(2,24),Qr=Math.pow(2,17),Xo=Math.pow(2,16),ko=Math.pow(2,9),pt=Math.pow(2,8),xt=Math.pow(2,1);function Le(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const t=p.placed?1:0,c=Math.floor(127*p.opacity);return c*os+t*ss+c*Qr+t*Xo+c*ko+t*pt+c*xt+t}const Ft=0;class fn{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,c,g,b,C){const I=this._bucketParts;for(;this._currentTileIndex<t.length;)if(c.getBucketParts(I,b,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((S,U)=>S.sortKey-U.sortKey));this._currentPartIndex<I.length;){const S=I[this._currentPartIndex];if(c.placeLayerBucketPart(S,this._seenCrossTileIDs,g,0===S.symbolInstanceStart),this._currentPartIndex++,C())return!0}return!1}}class Si{constructor(t,c,g,b,C,I,S,U){this.placement=new Jo(t,C,I,S,U),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(t,c,g){const b=l.exported.now(),C=()=>{const I=l.exported.now()-b;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=c[t[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=S)&&(!I.maxzoom||I.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new fn(I)),this._inProgressLayer.continuePlacement(g[I.source],this.placement,this._showCollisionBoxes,I,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ji=512/l.EXTENT/2;class Zr{constructor(t,c,g){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(let b=0;b<c.length;b++){const C=c.get(b),I=C.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:C.crossTileID,coord:this.getScaledCoordinates(C,t)})}}getScaledCoordinates(t,c){const g=Ji/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*l.EXTENT+t.tileAnchorX)*g),y:Math.floor((c.canonical.y*l.EXTENT+t.tileAnchorY)*g)}}findMatches(t,c,g){const b=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let C=0;C<t.length;C++){const I=t.get(C);if(I.crossTileID)continue;const S=this.indexedSymbolInstances[I.key];if(!S)continue;const U=this.getScaledCoordinates(I,c);for(const q of S)if(Math.abs(q.coord.x-U.x)<=b&&Math.abs(q.coord.y-U.y)<=b&&!g[q.crossTileID]){g[q.crossTileID]=!0,I.crossTileID=q.crossTileID;break}}}}class po{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ao{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const c=Math.round((t-this.lng)/360);if(0!==c)for(const g in this.indexes){const b=this.indexes[g],C={};for(const I in b){const S=b[I];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),C[S.tileID.key]=S}this.indexes[g]=C}this.lng=t}addBucket(t,c,g){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let C=0;C<c.symbolInstances.length;C++)c.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const b=this.usedCrossTileIDs[t.overscaledZ];for(const C in this.indexes){const I=this.indexes[C];if(Number(C)>t.overscaledZ)for(const S in I){const U=I[S];U.tileID.isChildOf(t)&&U.findMatches(c.symbolInstances,t,b)}else{const S=I[t.scaledTo(Number(C)).key];S&&S.findMatches(c.symbolInstances,t,b)}}for(let C=0;C<c.symbolInstances.length;C++){const I=c.symbolInstances.get(C);I.crossTileID||(I.crossTileID=g.generate(),b[I.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Zr(t,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(t,c){for(const g in c.indexedSymbolInstances)for(const b of c.indexedSymbolInstances[g])delete this.usedCrossTileIDs[t][b.crossTileID]}removeStaleBuckets(t){let c=!1;for(const g in this.indexes){const b=this.indexes[g];for(const C in b)t[b[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,b[C]),delete b[C],c=!0)}return c}}class Ko{constructor(){this.layerIndexes={},this.crossTileIDs=new po,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,c,g,b){let C=this.layerIndexes[t.id];void 0===C&&(C=this.layerIndexes[t.id]=new Ao);let I=!1;const S={};"globe"!==b.name&&C.handleWrapJump(g);for(const U of c){const q=U.getBucket(t);q&&t.id===q.layerIds[0]&&(q.bucketInstanceId||(q.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(U.tileID,q,this.crossTileIDs)&&(I=!0),S[q.bucketInstanceId]=!0)}return C.removeStaleBuckets(S)&&(I=!0),I}pruneUnusedLayers(t){const c={};t.forEach(g=>{c[g]=!0});for(const g in this.layerIndexes)c[g]||delete this.layerIndexes[g]}}const as=(p,t)=>l.emitValidationErrors(p,t&&t.filter(c=>"source.canvas"!==c.identifier)),Cs=l.pick(Xt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ga=l.pick(Xt,["setCenter","setZoom","setBearing","setPitch"]),ls={version:8,layers:[],sources:{}},So={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class eo extends l.Evented{constructor(t,c={}){super(),this.map=t,this.dispatcher=new Nt(Xn(),this),this.imageManager=new Ze,this.imageManager.setEventedParent(this),this.glyphManager=new l.GlyphManager(t._requestManager,c.localFontFamily?l.LocalGlyphMode.all:c.localIdeographFontFamily?l.LocalGlyphMode.ideographs:l.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new l.LineAtlas(256,512),this.crossTileSymbolIndex=new Ko,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const g=this;this._rtlTextPluginCallback=eo.registerForPluginStateChange(b=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(C,I)=>{if(l.triggerPluginCompletionEvent(C),I&&I.every(S=>S))for(const S in g._sourceCaches){const U=g._sourceCaches[S],q=U.getSource().type;"vector"!==q&&"geojson"!==q||U.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const C=this.getSource(b.sourceId);if(C&&C.vectorLayerIds)for(const I in this._layers){const S=this._layers[I];S.source===C.id&&this._validateLayer(S)}})}loadURL(t,c={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const g="boolean"==typeof c.validate?c.validate:!l.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,c.accessToken);const b=this.map._requestManager.transformRequest(t,l.ResourceType.Style);this._request=l.getJSON(b,(C,I)=>{this._request=null,C?this.fire(new l.ErrorEvent(C)):I&&this._load(I,g)})}loadJSON(t,c={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(t,!1!==c.validate)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(ls,!1)}_updateLayerCount(t,c){const g=c?1:-1;t.is3D()&&(this._num3DLayers+=g),"circle"===t.type&&(this._numCircleLayers+=g),"symbol"===t.type&&(this._numSymbolLayers+=g)}_load(t,c){if(c&&as(this,l.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t,this._updateMapProjection();for(const b in t.sources)this.addSource(b,t.sources[b],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const g=vi(this.stylesheet.layers);this._order=g.map(b=>b.id),this._layers={},this._serializedLayers={};for(let b of g)b=l.createStyleLayer(b),b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new tt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(t){this._spriteRequest=function(c,g,b){let C,I,S;const U=l.exported.devicePixelRatio>1?"@2x":"";let q=l.getJSON(g.transformRequest(g.normalizeSpriteURL(c,U,".json"),l.ResourceType.SpriteJSON),(Te,Ve)=>{q=null,S||(S=Te,C=Ve,ae())}),J=l.getImage(g.transformRequest(g.normalizeSpriteURL(c,U,".png"),l.ResourceType.SpriteImage),(Te,Ve)=>{J=null,S||(S=Te,I=Ve,ae())});function ae(){if(S)b(S);else if(C&&I){const Te=l.exported.getImageData(I),Ve={};for(const Oe in C){const{width:xe,height:at,x:Ye,y:rt,sdf:ot,pixelRatio:mt,stretchX:nt,stretchY:bt,content:Jt}=C[Oe],rn=new l.RGBAImage({width:xe,height:at});l.RGBAImage.copy(Te,rn,{x:Ye,y:rt},{x:0,y:0},{width:xe,height:at}),Ve[Oe]={data:rn,pixelRatio:mt,sdf:ot,stretchX:nt,stretchY:bt,content:Jt}}b(null,Ve)}}return{cancel(){q&&(q.cancel(),q=null),J&&(J.cancel(),J=null)}}}(t,this.map._requestManager,(c,g)=>{if(this._spriteRequest=null,c)this.fire(new l.ErrorEvent(c));else if(g)for(const b in g)this.imageManager.addImage(b,g[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(t){const c=this.getSource(t.source);if(!c)return;const g=t.sourceLayer;g&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(g))&&this.fire(new l.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${c.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const c=[];for(const g of t){const b=this._layers[g];"custom"!==b.type&&c.push(b.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&So[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const c=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(b.length||C.length)&&this._updateWorkerLayers(b,C);for(const I in this._updatedSources){const S=this._updatedSources[I];"reload"===S?this._reloadSource(I):"clear"===S&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const g={};for(const b in this._sourceCaches){const C=this._sourceCaches[b];g[b]=C.used,C.used=!1}for(const b of this._order){const C=this._layers[b];if(C.recalculate(t,this._availableImages),!C.isHidden(t.zoom)){const S=this._getLayerSourceCache(C);S&&(S.used=!0)}const I=this.map.painter;if(I){const S=C.getProgramIds();if(!S)continue;const U=C.getProgramConfiguration(t.zoom);for(const q of S)I.useProgram(q,U)}}for(const b in g){const C=this._sourceCaches[b];g[b]!==C.used&&C.getSource().fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),as(this,l.validateStyle(t)))return!1;(t=l.clone$1(t)).layers=vi(t.layers);const c=function(b,C){if(!b)return[{command:Xt.setStyle,args:[C]}];let I=[];try{if(!ne(b.version,C.version))return[{command:Xt.setStyle,args:[C]}];ne(b.center,C.center)||I.push({command:Xt.setCenter,args:[C.center]}),ne(b.zoom,C.zoom)||I.push({command:Xt.setZoom,args:[C.zoom]}),ne(b.bearing,C.bearing)||I.push({command:Xt.setBearing,args:[C.bearing]}),ne(b.pitch,C.pitch)||I.push({command:Xt.setPitch,args:[C.pitch]}),ne(b.sprite,C.sprite)||I.push({command:Xt.setSprite,args:[C.sprite]}),ne(b.glyphs,C.glyphs)||I.push({command:Xt.setGlyphs,args:[C.glyphs]}),ne(b.transition,C.transition)||I.push({command:Xt.setTransition,args:[C.transition]}),ne(b.light,C.light)||I.push({command:Xt.setLight,args:[C.light]}),ne(b.fog,C.fog)||I.push({command:Xt.setFog,args:[C.fog]}),ne(b.projection,C.projection)||I.push({command:Xt.setProjection,args:[C.projection]});const S={},U=[];!function(ae,Te,Ve,Oe){let xe;for(xe in Te=Te||{},ae=ae||{})ae.hasOwnProperty(xe)&&(Te.hasOwnProperty(xe)||ei(xe,Ve,Oe));for(xe in Te)Te.hasOwnProperty(xe)&&(ae.hasOwnProperty(xe)?ne(ae[xe],Te[xe])||("geojson"===ae[xe].type&&"geojson"===Te[xe].type&&lr(ae,Te,xe)?Ve.push({command:Xt.setGeoJSONSourceData,args:[xe,Te[xe].data]}):gr(xe,Te,Ve,Oe)):qn(xe,Te,Ve))}(b.sources,C.sources,U,S);const q=[];b.layers&&b.layers.forEach(ae=>{ae.source&&S[ae.source]?I.push({command:Xt.removeLayer,args:[ae.id]}):q.push(ae)});let J=b.terrain;J&&S[J.source]&&(I.push({command:Xt.setTerrain,args:[void 0]}),J=void 0),I=I.concat(U),ne(J,C.terrain)||I.push({command:Xt.setTerrain,args:[C.terrain]}),function(ae,Te,Ve){Te=Te||[];const Oe=(ae=ae||[]).map(mi),xe=Te.map(mi),at=ae.reduce(Wn,{}),Ye=Te.reduce(Wn,{}),rt=Oe.slice(),ot=Object.create(null);let mt,nt,bt,Jt,rn,hn,un;for(mt=0,nt=0;mt<Oe.length;mt++)bt=Oe[mt],Ye.hasOwnProperty(bt)?nt++:(Ve.push({command:Xt.removeLayer,args:[bt]}),rt.splice(rt.indexOf(bt,nt),1));for(mt=0,nt=0;mt<xe.length;mt++)bt=xe[xe.length-1-mt],rt[rt.length-1-mt]!==bt&&(at.hasOwnProperty(bt)?(Ve.push({command:Xt.removeLayer,args:[bt]}),rt.splice(rt.lastIndexOf(bt,rt.length-nt),1)):nt++,hn=rt[rt.length-mt],Ve.push({command:Xt.addLayer,args:[Ye[bt],hn]}),rt.splice(rt.length-mt,0,bt),ot[bt]=!0);for(mt=0;mt<xe.length;mt++)if(bt=xe[mt],Jt=at[bt],rn=Ye[bt],!ot[bt]&&!ne(Jt,rn))if(ne(Jt.source,rn.source)&&ne(Jt["source-layer"],rn["source-layer"])&&ne(Jt.type,rn.type)){for(un in Dn(Jt.layout,rn.layout,Ve,bt,null,Xt.setLayoutProperty),Dn(Jt.paint,rn.paint,Ve,bt,null,Xt.setPaintProperty),ne(Jt.filter,rn.filter)||Ve.push({command:Xt.setFilter,args:[bt,rn.filter]}),ne(Jt.minzoom,rn.minzoom)&&ne(Jt.maxzoom,rn.maxzoom)||Ve.push({command:Xt.setLayerZoomRange,args:[bt,rn.minzoom,rn.maxzoom]}),Jt)Jt.hasOwnProperty(un)&&"layout"!==un&&"paint"!==un&&"filter"!==un&&"metadata"!==un&&"minzoom"!==un&&"maxzoom"!==un&&(0===un.indexOf("paint.")?Dn(Jt[un],rn[un],Ve,bt,un.slice(6),Xt.setPaintProperty):ne(Jt[un],rn[un])||Ve.push({command:Xt.setLayerProperty,args:[bt,un,rn[un]]}));for(un in rn)rn.hasOwnProperty(un)&&!Jt.hasOwnProperty(un)&&"layout"!==un&&"paint"!==un&&"filter"!==un&&"metadata"!==un&&"minzoom"!==un&&"maxzoom"!==un&&(0===un.indexOf("paint.")?Dn(Jt[un],rn[un],Ve,bt,un.slice(6),Xt.setPaintProperty):ne(Jt[un],rn[un])||Ve.push({command:Xt.setLayerProperty,args:[bt,un,rn[un]]}))}else Ve.push({command:Xt.removeLayer,args:[bt]}),hn=rt[rt.lastIndexOf(bt)+1],Ve.push({command:Xt.addLayer,args:[rn,hn]})}(q,C.layers,I)}catch(S){console.warn("Unable to compute style diff:",S),I=[{command:Xt.setStyle,args:[C]}]}return I}(this.serialize(),t).filter(b=>!(b.command in ga));if(0===c.length)return!1;const g=c.filter(b=>!(b.command in Cs));if(g.length>0)throw new Error(`Unimplemented: ${g.map(b=>b.command).join(", ")}.`);return c.forEach(b=>{"setTransition"!==b.command&&this[b.command].apply(this,b.args)}),this.stylesheet=t,this._updateMapProjection(),!0}addImage(t,c){return this.getImage(t)?this.fire(new l.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,c),this._afterImageUpdated(t),this)}updateImage(t,c){this.imageManager.updateImage(t,c)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new l.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,c,g={}){if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(l.validateSource,`sources.${t}`,c,null,g))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const b=Tt(t,c,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:b.serialize(),sourceId:t}));const C=I=>{const S=(I?"symbol:":"other:")+t,U=this._sourceCaches[S]=new l.SourceCache(S,b,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[t]=U,U.style=this,U.onAdd(this.map)};C(!1),"vector"!==c.type&&"geojson"!==c.type||C(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const c=this.getSource(t);if(!c)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===t)return this.fire(new l.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new l.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(t);for(const b of g)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(t,c){this._checkLoaded(),this.getSource(t).setData(c),this._changed=!0}getSource(t){const c=this._getSourceCache(t);return c&&c.getSource()}addLayer(t,c,g={}){this._checkLoaded();const b=t.id;if(this.getLayer(b))return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let C;if("custom"===t.type){if(as(this,l.validateCustomStyleLayer(t)))return;C=l.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(b,t.source),t=l.clone$1(t),t=l.extend(t,{source:b})),this._validate(l.validateLayer,`layers.${b}`,t,{arrayIndex:-1},g))return;C=l.createStyleLayer(t),this._validateLayer(C),C.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}const I=c?this._order.indexOf(c):this._order.length;if(c&&-1===I)return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(I,0,b),this._layerOrderChanged=!0,this._layers[b]=C;const S=this._getLayerSourceCache(C);if(this._removedLayers[b]&&C.source&&S&&"custom"!==C.type){const U=this._removedLayers[b];delete this._removedLayers[b],U.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",S.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,c){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===c)return;const g=this._order.indexOf(t);this._order.splice(g,1);const b=c?this._order.indexOf(c):this._order.length;c&&-1===b?this.fire(new l.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(b,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const c=this._layers[t];if(!c)return void this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const g=this._order.indexOf(t);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=c,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const c in this._layers)if(this._layers[c].type===t)return!0;return!1}setLayerZoomRange(t,c,g){this._checkLoaded();const b=this.getLayer(t);b?b.minzoom===c&&b.maxzoom===g||(null!=c&&(b.minzoom=c),null!=g&&(b.maxzoom=g),this._updateLayer(b)):this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,c,g={}){this._checkLoaded();const b=this.getLayer(t);if(b){if(!ne(b.filter,c))return null==c?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(l.validateFilter,`layers.${b.id}.filter`,c,{layerType:b.type},g)||(b.filter=l.clone$1(c),this._updateLayer(b)))}else this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const c=this.getLayer(t);return c&&l.clone$1(c.filter)}setLayoutProperty(t,c,g,b={}){this._checkLoaded();const C=this.getLayer(t);C?ne(C.getLayoutProperty(c),g)||(C.setLayoutProperty(c,g,b),this._updateLayer(C)):this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,c){const g=this.getLayer(t);if(g)return g.getLayoutProperty(c);this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,c,g,b={}){this._checkLoaded();const C=this.getLayer(t);C?ne(C.getPaintProperty(c),g)||(C.setPaintProperty(c,g,b)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,c){const g=this.getLayer(t);return g&&g.getPaintProperty(c)}setFeatureState(t,c){this._checkLoaded();const g=t.source,b=t.sourceLayer,C=this.getSource(g);if(!C)return void this.fire(new l.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const I=C.type;if("geojson"===I&&b)return void this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!b)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(g);for(const U of S)U.setFeatureState(b,t.id,c)}removeFeatureState(t,c){this._checkLoaded();const g=t.source,b=this.getSource(g);if(!b)return void this.fire(new l.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const C=b.type,I="vector"===C?t.sourceLayer:void 0;if("vector"===C&&!I)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(g);for(const U of S)U.removeFeatureState(I,t.id,c)}getFeatureState(t){this._checkLoaded();const c=t.source,g=t.sourceLayer,b=this.getSource(c);if(b){if("vector"!==b.type||g)return void 0===t.id&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(g,t.id);this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const c in this._sourceCaches){const g=this._sourceCaches[c].getSource();t[g.id]||(t[g.id]=g.serialize())}return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(t){this._updatedLayers[t.id]=!0;const c=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[t.source]="reload",c.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const c=I=>"fill-extrusion"===this._layers[I].type,g={},b=[];for(let I=this._order.length-1;I>=0;I--){const S=this._order[I];if(c(S)){g[S]=I;for(const U of t){const q=U[S];if(q)for(const J of q)b.push(J)}}}b.sort((I,S)=>S.intersectionZ-I.intersectionZ);const C=[];for(let I=this._order.length-1;I>=0;I--){const S=this._order[I];if(c(S))for(let U=b.length-1;U>=0;U--){const q=b[U].feature;if(g[q.layer.id]<I)break;C.push(q),b.pop()}else for(const U of t){const q=U[S];if(q)for(const J of q)C.push(J.feature)}}return C}queryRenderedFeatures(t,c,g){c&&c.filter&&this._validate(l.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const b={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const U of c.layers){const q=this._layers[U];if(!q)return this.fire(new l.ErrorEvent(new Error(`The layer '${U}' does not exist in the map's style and cannot be queried for features.`))),[];b[q.source]=!0}}const C=[];c.availableImages=this._availableImages;const I=c&&c.layers?c.layers.some(U=>{const q=this.getLayer(U);return q&&q.is3D()}):this.has3DLayers(),S=Dt.createFromScreenPoints(t,g);for(const U in this._sourceCaches){const q=this._sourceCaches[U].getSource().id;c.layers&&!b[q]||C.push(Et(this._sourceCaches[U],this._layers,this._serializedLayers,S,c,g,I,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(U,q,J,ae,Te,Ve,Oe){const xe={},at=Ve.queryRenderedSymbols(ae),Ye=[];for(const rt of Object.keys(at).map(Number))Ye.push(Oe[rt]);Ye.sort(yn);for(const rt of Ye){const ot=rt.featureIndex.lookupSymbolFeatures(at[rt.bucketInstanceId],q,rt.bucketIndex,rt.sourceLayerIndex,Te.filter,Te.layers,Te.availableImages,U);for(const mt in ot){const nt=xe[mt]=xe[mt]||[],bt=ot[mt];bt.sort((Jt,rn)=>{const hn=rt.featureSortOrder;if(hn){const un=hn.indexOf(Jt.featureIndex);return hn.indexOf(rn.featureIndex)-un}return rn.featureIndex-Jt.featureIndex});for(const Jt of bt)nt.push(Jt)}}for(const rt in xe)xe[rt].forEach(ot=>{const mt=ot.feature,nt=J(U[rt]).getFeatureState(mt.layer["source-layer"],mt.id);mt.source=mt.layer.source,mt.layer["source-layer"]&&(mt.sourceLayer=mt.layer["source-layer"]),mt.state=nt});return xe}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(t,c){c&&c.filter&&this._validate(l.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const g=this._getSourceCaches(t);let b=[];for(const C of g)b=b.concat(ln(C,c));return b}addSourceType(t,c,g){return eo.getSourceType(t)?g(new Error(`A source type called "${t}" already exists.`)):(eo.setSourceType(t,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:c.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(t,c={}){this._checkLoaded();const g=this.light.getLight();let b=!1;for(const I in t)if(!ne(t[I],g[I])){b=!0;break}if(!b)return;const C={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,c),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,c=1){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===c){if("object"==typeof t.source){const g="terrain-dem-src";this.addSource(g,t.source),t=l.clone$1(t),t=l.extend(t,{source:g})}if(this._validate(l.validateTerrain,"terrain",t))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(t,c);else{const g=this.terrain,b=g.get();for(const C in t)if(!ne(t[C],b[C])){g.set(t),this.stylesheet.terrain=t;const I={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};g.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const c=this.fog=new Ht(t,this.map.transform);this.stylesheet.fog=t;const g={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(g)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,g=c.get();for(const b in t)if(!ne(t[b],g[b])){c.set(t),this.stylesheet.fog=t;const C={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(C);break}}else this._createFog(t);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(g=>this.isLayerDraped(this._layers[g])),c=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...c)}_createTerrain(t,c){const g=this.terrain=new Be(t,c);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const b={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};g.updateTransitions(b)}_force3DLayerUpdate(){for(const t in this._layers){const c=this._layers[t];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const c=this._layers[t];"symbol"===c.type&&this._updateLayer(c)}}_validate(t,c,g,b,C={}){return(!C||!1!==C.validate)&&as(this,t.call(l.validateStyle,l.extend({key:c,style:this.serialize(),value:g,styleSpec:l.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const c=this._getSourceCaches(t);for(const g of c)g.clearTiles()}_reloadSource(t){const c=this._getSourceCaches(t);for(const g of c)g.resume(),g.reload()}_updateSources(t){for(const c in this._sourceCaches)this._sourceCaches[c].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const c=this._sourceCaches[t];c.resume(),c.reload()}}_updatePlacement(t,c,g,b,C=!1){let I=!1,S=!1;const U={};for(const q of this._order){const J=this._layers[q];if("symbol"!==J.type)continue;if(!U[J.source]){const Te=this._getLayerSourceCache(J);if(!Te)continue;U[J.source]=Te.getRenderableIds(!0).map(Ve=>Te.getTileByID(Ve)).sort((Ve,Oe)=>Oe.tileID.overscaledZ-Ve.tileID.overscaledZ||(Ve.tileID.isLessThan(Oe.tileID)?-1:1))}const ae=this.crossTileSymbolIndex.addLayer(J,U[J.source],t.center.lng,t.projection);I=I||ae}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),C=C||this._layerOrderChanged||0===g,this._layerOrderChanged&&this.fire(new l.Event("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),t.zoom))&&(this.pauseablePlacement=new Si(t,this._order,C,c,g,b,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,U),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),S=!0),I&&this.pauseablePlacement.placement.setStale()),S||I)for(const q of this._order){const J=this._layers[q];"symbol"===J.type&&this.placement.updateLayerOpacities(J,U[J.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,c,g){this.imageManager.getImages(c.icons,g),this._updateTilesForChangedImages();const b=C=>{C&&C.setDependencies(c.tileID.key,c.type,c.icons)};b(this._otherSourceCaches[c.source]),b(this._symbolSourceCaches[c.source])}getGlyphs(t,c,g){this.glyphManager.getGlyphs(c.stacks,g)}getResource(t,c,g){return l.makeRequest(c,g)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const c=[];return this._otherSourceCaches[t]&&c.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&c.push(this._symbolSourceCaches[t]),c}_isSourceCacheLoaded(t){const c=this._getSourceCaches(t);return 0===c.length?(this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):c.every(g=>g.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}eo.getSourceType=function(p){return gt[p]},eo.setSourceType=function(p,t){gt[p]=t},eo.registerForPluginStateChange=l.registerForPluginStateChange;var Co="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Ls="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let yo={},vo={};yo=ai("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),vo=ai("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Zs=ai("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ts=Co;var Es={background:ai("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ai("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ai("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ai("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ai("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ai("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ai("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ai("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ai("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ai("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ai("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ai("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ai("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ai("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ai("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ai("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ai("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ai("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ai("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ai("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ai("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ai("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ai("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:ai("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ai("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ls),skyboxGradient:ai("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ls),skyboxCapture:ai("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ai("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:ai("uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)\ndiscard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function ai(p,t,c){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,b=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,C=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),I=p.match(b),S=t.match(b),U=Co.match(b);let q=S?S.concat(I):I;c||(yo.staticUniforms&&(q=yo.staticUniforms.concat(q)),vo.staticUniforms&&(q=vo.staticUniforms.concat(q))),q&&(q=q.concat(U));const J={};return{fragmentSource:p=p.replace(g,(ae,Te,Ve,Oe,xe)=>(J[xe]=!0,"define"===Te?`\n#ifndef HAS_UNIFORM_u_${xe}\nvarying ${Ve} ${Oe} ${xe};\n#else\nuniform ${Ve} ${Oe} u_${xe};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${xe}\n    ${Ve} ${Oe} ${xe} = u_${xe};\n#endif\n`)),vertexSource:t=t.replace(g,(ae,Te,Ve,Oe,xe)=>{const at="float"===Oe?"vec2":"vec4",Ye=xe.match(/color/)?"color":at;return J[xe]?"define"===Te?`\n#ifndef HAS_UNIFORM_u_${xe}\nuniform lowp float u_${xe}_t;\nattribute ${Ve} ${at} a_${xe};\nvarying ${Ve} ${Oe} ${xe};\n#else\nuniform ${Ve} ${Oe} u_${xe};\n#endif\n`:"vec4"===Ye?`\n#ifndef HAS_UNIFORM_u_${xe}\n    ${xe} = a_${xe};\n#else\n    ${Ve} ${Oe} ${xe} = u_${xe};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${xe}\n    ${xe} = unpack_mix_${Ye}(a_${xe}, u_${xe}_t);\n#else\n    ${Ve} ${Oe} ${xe} = u_${xe};\n#endif\n`:"define"===Te?`\n#ifndef HAS_UNIFORM_u_${xe}\nuniform lowp float u_${xe}_t;\nattribute ${Ve} ${at} a_${xe};\n#else\nuniform ${Ve} ${Oe} u_${xe};\n#endif\n`:"vec4"===Ye?`\n#ifndef HAS_UNIFORM_u_${xe}\n    ${Ve} ${Oe} ${xe} = a_${xe};\n#else\n    ${Ve} ${Oe} ${xe} = u_${xe};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${xe}\n    ${Ve} ${Oe} ${xe} = unpack_mix_${Ye}(a_${xe}, u_${xe}_t);\n#else\n    ${Ve} ${Oe} ${xe} = u_${xe};\n#endif\n`}),staticAttributes:C,staticUniforms:q}}class to{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,c,g,b,C,I,S,U){this.context=t;let q=this.boundPaintVertexBuffers.length!==b.length;for(let J=0;!q&&J<b.length;J++)this.boundPaintVertexBuffers[J]!==b[J]&&(q=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===g&&!q&&this.boundIndexBuffer===C&&this.boundVertexOffset===I&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===U?(t.bindVertexArrayOES.set(this.vao),S&&S.bind(),C&&C.dynamicDraw&&C.bind(),U&&U.bind()):this.freshBind(c,g,b,C,I,S,U)}freshBind(t,c,g,b,C,I,S){let U;const q=t.numAttributes,J=this.context,ae=J.gl;if(J.extVertexArrayObject)this.vao&&this.destroy(),this.vao=J.extVertexArrayObject.createVertexArrayOES(),J.bindVertexArrayOES.set(this.vao),U=0,this.boundProgram=t,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=b,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=S;else{U=J.currentNumAttributes||0;for(let Te=q;Te<U;Te++)ae.disableVertexAttribArray(Te)}c.enableAttributes(ae,t);for(const Te of g)Te.enableAttributes(ae,t);I&&I.enableAttributes(ae,t),S&&S.enableAttributes(ae,t),c.bind(),c.setVertexAttribPointers(ae,t,C);for(const Te of g)Te.bind(),Te.setVertexAttribPointers(ae,t,C);I&&(I.bind(),I.setVertexAttribPointers(ae,t,C)),b&&b.bind(),S&&(S.bind(),S.setVertexAttribPointers(ae,t,C)),J.currentNumAttributes=q}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Gs(p,t){const c=Math.pow(2,t.canonical.z),g=t.canonical.y;return[new l.MercatorCoordinate(0,g/c).toLngLat().lat,new l.MercatorCoordinate(0,(g+1)/c).toLngLat().lat]}function Po(p,t,c,g,b,C,I){const S=p.context,U=S.gl,q=c.fbo;if(!q)return;p.prepareDrawTile();const J=p.useProgram("hillshade");S.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,q.colorAttachment.get());const ae=((xe,at,Ye,rt)=>{const ot=Ye.paint.get("hillshade-shadow-color"),mt=Ye.paint.get("hillshade-highlight-color"),nt=Ye.paint.get("hillshade-accent-color");let bt=Ye.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Ye.paint.get("hillshade-illumination-anchor")&&(bt-=xe.transform.angle);const Jt=!xe.options.moving;return{u_matrix:rt||xe.transform.calculateProjMatrix(at.tileID.toUnwrapped(),Jt),u_image:0,u_latrange:Gs(0,at.tileID),u_light:[Ye.paint.get("hillshade-exaggeration"),bt],u_shadow:ot,u_highlight:mt,u_accent:nt}})(p,c,g,p.terrain?t.projMatrix:null);p.prepareDrawProgram(S,J,t.toUnwrapped());const{tileBoundsBuffer:Te,tileBoundsIndexBuffer:Ve,tileBoundsSegments:Oe}=p.getTileBoundsBuffers(c);J.draw(S,U.TRIANGLES,b,C,I,l.CullFaceMode.disabled,ae,g.id,Te,Ve,Oe)}function ms(p,t,c){if(!t.needsDEMTextureUpload)return;const g=p.context,b=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(c.stride);const C=c.getPixels();t.demTexture?t.demTexture.update(C,{premultiply:!1}):t.demTexture=new l.Texture(g,C,b.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function _a(p,t,c,g,b,C){const I=p.context,S=I.gl;if(!t.dem)return;const U=t.dem;if(I.activeTexture.set(S.TEXTURE1),ms(p,t,U),!t.demTexture)return;t.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const q=U.dim;I.activeTexture.set(S.TEXTURE0);let J=t.fbo;if(!J){const Oe=new l.Texture(I,{width:q,height:q,data:null},S.RGBA);Oe.bind(S.LINEAR,S.CLAMP_TO_EDGE),J=t.fbo=I.createFramebuffer(q,q,!0),J.colorAttachment.set(Oe.texture)}I.bindFramebuffer.set(J.framebuffer),I.viewport.set([0,0,q,q]);const{tileBoundsBuffer:ae,tileBoundsIndexBuffer:Te,tileBoundsSegments:Ve}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(I,S.TRIANGLES,g,b,C,l.CullFaceMode.disabled,((Oe,xe)=>{const at=xe.stride,Ye=l.create();return l.ortho(Ye,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(Ye,Ye,[0,-l.EXTENT,0]),{u_matrix:Ye,u_image:1,u_dimension:[at,at],u_zoom:Oe.overscaledZ,u_unpack:xe.unpackVector}})(t.tileID,U),c.id,ae,Te,Ve),t.needsHillshadePrepare=!1}const Ds=(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_image0:new l.Uniform1i(p,t.u_image0),u_skirt_height:new l.Uniform1f(p,t.u_skirt_height)}),Y=(p,t)=>({u_matrix:p,u_image0:0,u_skirt_height:t}),Me=(p,t,c,g,b,C)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:t,u_merc_matrix:c,u_zoom_transition:g,u_merc_center:b,u_image0:0,u_grid_matrix:C?Float32Array.from(C):new Float32Array(9)});function K(p,t){return null!=p&&null!=t&&!(!p.hasData()||!t.hasData())&&null!=p.demTexture&&null!=t.demTexture&&p.tileID.key!==t.tileID.key}const Fe=new class{constructor(){this.operations={}}newMorphing(p,t,c,g,b){if(p in this.operations){const C=this.operations[p];C.to.tileID.key!==c.tileID.key&&(C.queued=c)}else this.operations[p]={startTime:g,phase:0,duration:b,from:t,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const t=this.operations[p];return{from:t.from,to:t.to,phase:t.phase}}update(p){for(const t in this.operations){const c=this.operations[t];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[t];break}}}_nextOp(p,t){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=t,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},wt={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function gn(p,t){const c=1<<p.z;return!t&&(0===p.x||p.x===c-1)||0===p.y||p.y===c-1}const kn=p=>({u_matrix:p});function Jn(p,t,c,g,b){if(b>0){const C=l.exported.now(),I=(C-p.timeAdded)/b,S=t?(C-t.timeAdded)/b:-1,U=c.getSource(),q=g.coveringZoomLevel({tileSize:U.tileSize,roundZoom:U.roundZoom}),J=!t||Math.abs(t.tileID.overscaledZ-q)>Math.abs(p.tileID.overscaledZ-q),ae=J&&p.refreshedUponExpiration?1:l.clamp(J?I:1-S,0,1);return p.refreshedUponExpiration&&I>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-ae}:{opacity:ae,mix:0}}return{opacity:1,mix:0}}const Mr=2*l.mercatorZfromAltitude(1,0)*l.GLOBE_RADIUS*Math.PI;class cr extends l.SourceCache{constructor(t){const c={type:"raster-dem",maxzoom:t.transform.maxZoom},g=new Nt(Xn(),null),b=Tt("mock-dem",c,g,t.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,c){t.state="loaded",c(null)}}class er extends l.SourceCache{constructor(t){const c=Tt("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Nt(Xn(),null),t.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,c,g){if(t.freezeTileCoverage)return;this.transform=t;const b=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,I)=>{if(C[I.key]="",!this._tiles[I.key]){const S=new l.Tile(I,this._source.tileSize*I.overscaleFactor(),t.tileZoom);S.state="loaded",this._tiles[I.key]=S}return C},{});for(const C in this._tiles)C in b||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(t){const c=this.proxyCachedFBO[t];if(void 0!==c){const g=Object.values(c);this.renderCachePool.push(...g),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Vi extends l.OverscaledTileID{constructor(t,c,g){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=c,this.projMatrix=g}}class xr extends l.Elevation{constructor(t,c){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,b,C]=function(U){const q=new l.StructArrayLayout4i8,J=new l.StructArrayLayout3ui6;q.reserve(17161),J.reserve(33800);const Te=l.EXTENT/128,Ve=l.EXTENT+Te/2,Oe=Ve+Te;for(let at=-Te;at<Oe;at+=Te)for(let Ye=-Te;Ye<Oe;Ye+=Te){const rt=Ye<0||Ye>Ve||at<0||at>Ve?24575:0,ot=l.clamp(Math.round(Ye),0,l.EXTENT),mt=l.clamp(Math.round(at),0,l.EXTENT);q.emplaceBack(ot+rt,mt,ot,mt)}const xe=(at,Ye)=>{const rt=131*Ye+at;J.emplaceBack(rt+1,rt,rt+131),J.emplaceBack(rt+131,rt+131+1,rt+1)};for(let at=1;at<129;at++)for(let Ye=1;Ye<129;Ye++)xe(Ye,at);return[0,129].forEach(at=>{for(let Ye=0;Ye<130;Ye++)xe(Ye,at),xe(at,Ye)}),[q,J,32768]}(),I=t.context;this.gridBuffer=I.createVertexBuffer(g,l.boundsAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(b),this.gridSegments=l.SegmentVector.simpleSegment(0,0,g.length,b.length),this.gridNoSkirtSegments=l.SegmentVector.simpleSegment(0,0,g.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new er(c.map),this.orthoMatrix=l.create(),l.ortho(this.orthoMatrix,0,l.EXTENT,0,l.EXTENT,0,1);const S=I.gl;this._overlapStencilMode=new l.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new cr(c.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,c,g){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const b=t.terrain.properties;this.sourceCache=0===t.terrain.drapeRenderMode?this._mockSourceCache:t._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const C=()=>{this.sourceCache.used&&l.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(c,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,C(),this._initializing=!0),C(),c.updateElevation(!g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&l.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=0===g._centerAltitude&&-1===this.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(g.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=c.getIds().map(U=>{const q=c.getTileByID(U).tileID;return q.projMatrix=g.calculateProjMatrix(q.toUnwrapped()),q});(function(U,q){const J=q.transform.pointCoordinate(q.transform.getCameraPoint()),ae=new l.pointGeometry(J.x,J.y);U.sort((Te,Ve)=>{if(Ve.overscaledZ-Te.overscaledZ)return Ve.overscaledZ-Te.overscaledZ;const Oe=new l.pointGeometry(Te.canonical.x+(1<<Te.canonical.z)*Te.wrap,Te.canonical.y),xe=new l.pointGeometry(Ve.canonical.x+(1<<Ve.canonical.z)*Ve.wrap,Ve.canonical.y),at=ae.mult(1<<Te.canonical.z);return at.x-=.5,at.y-=.5,at.distSqr(Oe)-at.distSqr(xe)})})(b,this.painter),this._previousZoom=g.zoom;const C=this.proxyToSource||{};this.proxyToSource={},b.forEach(U=>{this.proxyToSource[U.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const U in I){const q=I[U];if(!q.used||(q!==this.sourceCache&&this.resetTileLookupCache(q.id),this._setupProxiedCoordsForOrtho(q,t[U],C),q.usedForTerrain))continue;const J=t[U];q.getSource().reparseOverscaled&&this._assignTerrainTiles(J)}this.proxiedCoords[c.id]=b.map(U=>new Vi(U,U.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1,this._updateTimestamp=l.exported.now();const S={};this._visibleDemTiles=[];for(const U of this.proxyCoords){const q=this.terrainTileForTile[U.key];if(!q)continue;const J=q.tileID.key;J in S||(this._visibleDemTiles.push(q),S[J]=J)}}_assignTerrainTiles(t){this._initializing||t.forEach(c=>{if(this.terrainTileForTile[c.key])return;const g=this._findTileCoveringTileID(c,this.sourceCache);g&&(this.terrainTileForTile[c.key]=g)})}_prepareDEMTextures(){const t=this.painter.context,c=t.gl;for(const g in this.terrainTileForTile){const b=this.terrainTileForTile[g],C=b.dem;!C||b.demTexture&&!b.needsDEMTextureUpload||(t.activeTexture.set(c.TEXTURE1),ms(this.painter,b,C))}}_prepareDemTileUniforms(t,c,g,b){if(!c||null==c.demTexture)return!1;const C=t.tileID.canonical,I=Math.pow(2,c.tileID.canonical.z-C.z),S=b||"";return g[`u_dem_tl${S}`]=[C.x*I%1,C.y*I%1],g[`u_dem_scale${S}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,c=t.gl;if(!this._emptyDepthBufferTexture){const g=new l.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new l.Texture(t,g,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const c=this._visibleDemTiles.reduce((g,b)=>{if(!b.dem)return g;const C=b.dem.tree.minimums[0];return C>0&&t++,g+C},0);return t?c/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,c=t.gl;t.activeTexture.set(c.TEXTURE2);const g=this._getLoadedAreaMinimum(),b=new l.RGBAImage({width:1,height:1},new Uint8Array(l.DEMData.pack(g,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(b,{premultiply:!1}):C=this._emptyDEMTexture=new l.Texture(t,b,c.RGBA,{premultiply:!1}),C}setupElevationDraw(t,c,g){const b=this.painter.context,C=b.gl,I=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:l.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var S;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();const U=this.painter.transform,q=U.projection,J=t.tileID.canonical;I.u_tile_tl_up=q.upVector(J,0,0),I.u_tile_tr_up=q.upVector(J,l.EXTENT,0),I.u_tile_br_up=q.upVector(J,l.EXTENT,l.EXTENT),I.u_tile_bl_up=q.upVector(J,0,l.EXTENT),I.u_tile_up_scale=g&&g.useDenormalizedUpVectorScale?Mr:q.upVectorScale(J,U.center.lat,U.worldSize).metersToTile;let ae=null,Te=null,Ve=1;if(g&&g.morphing&&this._useVertexMorphing){const Oe=g.morphing.srcDemTile,xe=g.morphing.dstDemTile;Ve=g.morphing.phase,Oe&&xe&&(this._prepareDemTileUniforms(t,Oe,I,"_prev")&&(Te=Oe),this._prepareDemTileUniforms(t,xe,I)&&(ae=xe))}if(Te&&ae?(b.activeTexture.set(C.TEXTURE2),ae.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),b.activeTexture.set(C.TEXTURE4),Te.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),I.u_dem_lerp=Ve):(ae=this.terrainTileForTile[t.tileID.key],b.activeTexture.set(C.TEXTURE2),(this._prepareDemTileUniforms(t,ae,I)?ae.demTexture:this.emptyDEMTexture).bind(C.NEAREST,C.CLAMP_TO_EDGE)),b.activeTexture.set(C.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&ae){const Oe=(1<<ae.tileID.canonical.z)*l.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=Oe}g&&g.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),c.setTerrainUniformValues(b,I)}renderToBackBuffer(t){const c=this.painter,g=this.painter.context;0!==t.length&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),this.renderingToTexture=!1,function(b,C,I,S,U){if("globe"===b.transform.projection.name)!function(q,J,ae,Te,Ve){const Oe=q.context,xe=Oe.gl;let at,Ye;const rt=q.options.showTerrainWireframe?2:0,ot=(un,Un)=>{if(Ye===un)return;const Zt=[wt[un],"PROJECTION_GLOBE_VIEW"];Un&&Zt.push(wt[rt]),at=q.useProgram("globeRaster",null,Zt),Ye=un},mt=q.colorModeForRenderPass(),nt=new l.DepthMode(xe.LEQUAL,l.DepthMode.ReadWrite,q.depthRangeFor3D);Fe.update(Ve);const bt=q.transform,Jt=l.calculateGlobeMercatorMatrix(bt),rn=[l.mercatorXfromLng(bt.center.lng),l.mercatorYfromLat(bt.center.lat)],hn=q.globeSharedBuffers;if((rt?[!1,!0]:[!1]).forEach(un=>{Ye=-1;const Un=un?xe.LINES:xe.TRIANGLES;for(const Zt of Te){const Vn=ae.getTile(Zt),Bn=l.StencilMode.disabled,li=J.prevTerrainTileForTile[Zt.key],pn=J.terrainTileForTile[Zt.key];K(li,pn)&&Fe.newMorphing(Zt.key,li,pn,Ve,250),Oe.activeTexture.set(xe.TEXTURE0),Vn.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE);const ci=Fe.getMorphValuesForProxy(Zt.key),Ti=ci?1:0,ui={useDenormalizedUpVectorScale:!0};ci&&l.extend$1(ui,{morphing:{srcDemTile:ci.from,dstDemTile:ci.to,phase:l.easeCubicInOut(ci.phase)}});const si=Float32Array.from(bt.globeMatrix),Ei=l.globeTileLatLngCorners(Zt.canonical),qi=l.getGridMatrix(Zt.canonical,Ei),_i=Me(bt.projMatrix,si,Jt,l.globeToMercatorTransition(bt.zoom),rn,qi);if(ot(Ti,un),J.setupElevationDraw(Vn,at,ui),q.prepareDrawProgram(Oe,at,Zt.toUnwrapped()),hn){const[Fi,hr,no]=un?hn.getWirefameBuffers(q.context):hn.getGridBuffers();at.draw(Oe,Un,nt,Bn,mt,l.CullFaceMode.backCCW,_i,"globe_raster",Fi,hr,no)}}}),hn){at=q.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const un of Te){const{x:Un,y:Zt,z:Vn}=un.canonical,Bn=0===Zt,li=Zt===(1<<Vn)-1,[pn,ci,Ti,ui]=hn.getPoleBuffers(Vn);if(ui&&(Bn||li)){const si=ae.getTile(un);Oe.activeTexture.set(xe.TEXTURE0),si.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE);let Ei=l.globePoleMatrixForTile(Vn,Un,bt);const qi=(_i,Fi)=>_i.draw(Oe,xe.TRIANGLES,nt,l.StencilMode.disabled,mt,l.CullFaceMode.disabled,Me(bt.projMatrix,Ei,Ei,0,rn),"globe_pole_raster",Fi,Ti,ui);J.setupElevationDraw(si,at,{}),q.prepareDrawProgram(Oe,at,un.toUnwrapped()),Bn&&qi(at,pn),li&&(Ei=l.scale(l.create(),Ei,[1,-1,1]),qi(at,ci))}}}}(b,C,I,S,U);else{const q=b.context,J=q.gl;let ae,Te;const Ve=b.options.showTerrainWireframe?2:0,Oe=(ot,mt)=>{if(Te===ot)return;const nt=[wt[ot]];mt&&nt.push(wt[Ve]),ae=b.useProgram("terrainRaster",null,nt),Te=ot},xe=b.colorModeForRenderPass(),at=new l.DepthMode(J.LEQUAL,l.DepthMode.ReadWrite,b.depthRangeFor3D);Fe.update(U);const Ye=b.transform,rt=6*Math.pow(1.5,22-Ye.zoom)*C.exaggeration();(Ve?[!1,!0]:[!1]).forEach(ot=>{Te=-1;const mt=ot?J.LINES:J.TRIANGLES,[nt,bt]=ot?C.getWirefameBuffer():[C.gridIndexBuffer,C.gridSegments];for(const Jt of S){const rn=I.getTile(Jt),hn=l.StencilMode.disabled,un=C.prevTerrainTileForTile[Jt.key],Un=C.terrainTileForTile[Jt.key];K(un,Un)&&Fe.newMorphing(Jt.key,un,Un,U,250),q.activeTexture.set(J.TEXTURE0),rn.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST);const Zt=Fe.getMorphValuesForProxy(Jt.key),Vn=Zt?1:0;let Bn;Zt&&(Bn={morphing:{srcDemTile:Zt.from,dstDemTile:Zt.to,phase:l.easeCubicInOut(Zt.phase)}});const li=Y(Jt.projMatrix,gn(Jt.canonical,Ye.renderWorldCopies)?rt/10:rt);Oe(Vn,ot),C.setupElevationDraw(rn,ae,Bn),b.prepareDrawProgram(q,ae,Jt.toUnwrapped()),ae.draw(q,mt,at,hn,xe,l.CullFaceMode.backCCW,li,"terrain_raster",C.gridBuffer,nt,bt)}})}}(c,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const c=this.painter,g=this.painter.context,b=this.proxySourceCache,C=this.proxiedCoords[b.id],I=this._drapedRenderBatches.shift(),S=[],U=c.style.order;let q=0;for(const J of C){const ae=b.getTileByID(J.proxyTileKey),Te=b.proxyCachedFBO[J.key]?b.proxyCachedFBO[J.key][t]:void 0,Ve=void 0!==Te?b.renderCache[Te]:this.pool[q++],Oe=void 0!==Te;if(ae.texture=Ve.tex,Oe&&!Ve.dirty){S.push(ae.tileID);continue}let xe;g.bindFramebuffer.set(Ve.fb.framebuffer),this.renderedToTile=!1,Ve.dirty&&(g.clear({color:l.Color.transparent,stencil:0}),Ve.dirty=!1);for(let at=I.start;at<=I.end;++at){const Ye=c.style._layers[U[at]];if(Ye.isHidden(c.transform.zoom))continue;const rt=c.style._getLayerSourceCache(Ye),ot=rt?this.proxyToSource[J.key][rt.id]:[J];if(!ot)continue;const mt=ot;g.viewport.set([0,0,Ve.fb.width,Ve.fb.height]),xe!==(rt?rt.id:null)&&(this._setupStencil(Ve,ot,Ye,rt),xe=rt?rt.id:null),c.renderLayer(c,rt,Ye,mt)}this.renderedToTile?(Ve.dirty=!0,S.push(ae.tileID)):Oe||--q,5===q&&(q=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),I.end+1}postRender(){}renderCacheEfficiency(t){const c=t.order.length;if(0===c)return{efficiency:100};let g,b=0,C=0,I=!1;for(let S=0;S<c;++S){const U=t._layers[t.order[S]];this._style.isLayerDraped(U)?(I&&++b,++C):I||(I=!0,g=U.id)}return 0===C?{efficiency:100}:{efficiency:100*(1-b/C),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{t=Math.min(t,c.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,c,g){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const I=C.tileID,S=Math.pow(2,I.overscaledZ),{x:U,y:q}=I.canonical,J=U/S,ae=(U+1)/S,Te=q/S,Ve=(q+1)/S;return{minx:J,miny:Te,maxx:ae,maxy:Ve,t:C.dem.tree.raycastRoot(J,Te,ae,Ve,t,c,g),tile:C}});b.sort((C,I)=>(null!==C.t?C.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const C of b){if(null==C.t)return null;const I=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,t,c,g);if(null!=I)return I}return null}_createFBO(){const t=this.painter.context,c=t.gl,g=this.drapeBufferSize;t.activeTexture.set(c.TEXTURE0);const b=new l.Texture(t,{width:g[0],height:g[1],data:null},c.RGBA);b.bind(c.LINEAR,c.CLAMP_TO_EDGE);const C=t.createFramebuffer(g[0],g[1],!1);return C.colorAttachment.set(b.texture),C.depthAttachment=new Ci(t,C.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:C,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const c=this._style._layers[t],g=c.isHidden(this.painter.transform.zoom),b=c.getCrossfadeParameters(),C=!!b&&1!==b.t,I=c.hasTransition();return"custom"!==c.type&&!g&&(C||I)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof Q){t=!0;break}if(t)for(let c=0;c<this._style.order.length;++c){const g=this._style._layers[this._style.order[c]],b=g.isHidden(this.painter.transform.zoom),C=this._style._getLayerSourceCache(g);if("raster"!==g.type||b||!C)continue;const I=g.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const U=this.proxyToSource[S.key][C.id];if(U)for(const q of U){const J=Jn(C.getTile(q),C.findLoadedParent(q,0),C,this.painter.transform,I);(1!==J.opacity||0!==J.mix)&&this._clearRenderCacheForTile(C.id,q)}}}}_setupDrapedRenderBatches(){const t=this._style.order,c=t.length;if(0===c)return;const g=[];let b,C=0,I=this._style._layers[t[C]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++C<c;)I=this._style._layers[t[C]];for(;C<c;++C){const S=this._style._layers[t[C]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?void 0===b&&(b=C):void 0!==b&&(g.push({start:b,end:C-1}),b=void 0))}void 0!==b&&g.push({start:b,end:C-1}),this._drapedRenderBatches=g}_setupRenderCache(t){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const I=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let S=0;S<I.length;++S){const U=Object.values(I[S]);c.renderCachePool.push(...U)}}return}this._clearRasterFadeFromRenderCache();const g=this.proxyCoords,b=this._tilesDirty;for(let I=g.length-1;I>=0;I--){const S=g[I];if(c.getTileByID(S.key),void 0!==c.proxyCachedFBO[S.key]){const U=t[S.key],q=this.proxyToSource[S.key];let J=0;for(const ae in q){const Te=q[ae],Ve=U[ae];if(!Ve||Ve.length!==Te.length||Te.some((Oe,xe)=>Oe!==Ve[xe]||b[ae]&&b[ae].hasOwnProperty(Oe.key))){J=-1;break}++J}for(const ae in c.proxyCachedFBO[S.key])c.renderCache[c.proxyCachedFBO[S.key][ae]].dirty=J<0||J!==Object.values(U).length}}const C=[...this._drapedRenderBatches];C.sort((I,S)=>S.end-S.start-(I.end-I.start));for(const I of C)for(const S of g){if(c.proxyCachedFBO[S.key])continue;let U=c.renderCachePool.pop();void 0===U&&c.renderCache.length<50&&(U=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==U&&(c.proxyCachedFBO[S.key]={},c.proxyCachedFBO[S.key][I.start]=U,c.renderCache[U].dirty=!0)}this._tilesDirty={}}_setupStencil(t,c,g,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,I=C.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let S;if(g.isTileClipped())S=c.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(t.key)||0),this._overlapStencilMode):l.StencilMode.disabled}_renderTileClippingMasks(t,c){const g=this.painter,b=this.painter.context,C=b.gl;g._tileClippingMaskIDs.clear(),b.setColorMode(l.ColorMode.disabled),b.setDepthMode(l.DepthMode.disabled);const I=g.useProgram("clippingMask");for(const S of t){const U=--c;g._tileClippingMaskIDs.set(S.key,U),I.draw(b,C.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:C.ALWAYS,mask:0},U,255,C.KEEP,C.KEEP,C.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,kn(S.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(t){const c=this.painter.transform;if(t.x<0||t.x>c.width||t.y<0||t.y>c.height)return null;const g=[t.x,t.y,1,1];l.transformMat4$1(g,g,c.pixelMatrixInverse),l.scale$1(g,g,1/g[3]),g[0]/=c.worldSize,g[1]/=c.worldSize;const b=c._camera.position,C=l.mercatorZfromAltitude(1,c.center.lat),I=[b[0],b[1],b[2]/C,0],S=l.subtract([],g.slice(0,3),I);l.normalize(S,S);const U=this.raycast(I,S,this._exaggeration);return null!==U&&U?(l.scaleAndAdd(I,I,S,U),I[3]=I[2],I[2]*=C,I):null}drawDepth(){const t=this.painter,c=t.context,g=this.proxySourceCache,b=Math.ceil(t.width),C=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===C||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=c.gl,S=c.createFramebuffer(b,C,!0);c.activeTexture.set(I.TEXTURE0);const U=new l.Texture(c,{width:b,height:C,data:null},I.RGBA);U.bind(I.NEAREST,I.CLAMP_TO_EDGE),S.colorAttachment.set(U.texture);const q=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,b,C);S.depthAttachment.set(q),this._depthFBO=S,this._depthTexture=U}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,b,C]),function(I,S,U,q){if("globe"===I.transform.projection.name)return;const J=I.context,ae=J.gl;J.clear({depth:1});const Te=I.useProgram("terrainDepth"),Ve=new l.DepthMode(ae.LESS,l.DepthMode.ReadWrite,I.depthRangeFor3D);for(const Oe of q){const xe=U.getTile(Oe),at=Y(Oe.projMatrix,0);S.setupElevationDraw(xe,Te),Te.draw(J,ae.TRIANGLES,Ve,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.backCCW,at,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(t,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,c,g){if(t.getSource()instanceof $e)return this._setupProxiedCoordsForImageSource(t,c,g);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const b=this.proxiedCoords[t.id]=[],C=this.proxyCoords;for(let S=0;S<C.length;S++){const U=C[S],q=this._findTileCoveringTileID(U,t);if(q){const J=this._createProxiedId(U,q,g[U.key]&&g[U.key][t.id]);b.push(J),this.proxyToSource[U.key][t.id]=[J]}}let I=!1;for(let S=0;S<c.length;S++){const U=t.getTile(c[S]);if(!U||!U.hasData())continue;const q=this._findTileCoveringTileID(U.tileID,this.proxySourceCache);if(q&&q.tileID.canonical.z!==U.tileID.canonical.z){const J=this.proxyToSource[q.tileID.key][t.id],ae=this._createProxiedId(q.tileID,U,g[q.tileID.key]&&g[q.tileID.key][t.id]);J?J.splice(J.length-1,0,ae):this.proxyToSource[q.tileID.key][t.id]=[ae],b.push(ae),I=!0}}this._sourceTilesOverlap[t.id]=I}_setupProxiedCoordsForImageSource(t,c,g){if(!t.getSource().loaded())return;const b=this.proxiedCoords[t.id]=[],C=this.proxyCoords,I=t.getSource(),S=new l.pointGeometry(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),U=I.coordinates.map(l.MercatorCoordinate.fromLngLat).reduce((J,ae)=>(J.min.x=Math.min(J.min.x,ae.x-S.x),J.min.y=Math.min(J.min.y,ae.y-S.y),J.max.x=Math.max(J.max.x,ae.x-S.x),J.max.y=Math.max(J.max.y,ae.y-S.y),J),{min:new l.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new l.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),q=(J,ae)=>{const Te=J.wrap+J.canonical.x/(1<<J.canonical.z),Ve=J.canonical.y/(1<<J.canonical.z),Oe=l.EXTENT/(1<<J.canonical.z),xe=ae.wrap+ae.canonical.x/(1<<ae.canonical.z),at=ae.canonical.y/(1<<ae.canonical.z);return Te+Oe<xe+U.min.x||Te>xe+U.max.x||Ve+Oe<at+U.min.y||Ve>at+U.max.y};for(let J=0;J<C.length;J++){const ae=C[J];for(let Te=0;Te<c.length;Te++){const Ve=t.getTile(c[Te]);if(!Ve||!Ve.hasData()||q(ae,Ve.tileID))continue;const Oe=this._createProxiedId(ae,Ve,g[ae.key]&&g[ae.key][t.id]),xe=this.proxyToSource[ae.key][t.id];xe?xe.push(Oe):this.proxyToSource[ae.key][t.id]=[Oe],b.push(Oe)}}}_createProxiedId(t,c,g){let b=this.orthoMatrix;if(g){const C=g.find(I=>I.key===c.tileID.key);if(C)return C}if(c.tileID.key!==t.key){const C=t.canonical.z-c.tileID.canonical.z;let I,S,U;b=l.create();const q=c.tileID.wrap-t.wrap<<t.overscaledZ;C>0?(I=l.EXTENT>>C,S=I*((c.tileID.canonical.x<<C)-t.canonical.x+q),U=I*((c.tileID.canonical.y<<C)-t.canonical.y)):(I=l.EXTENT<<-C,S=l.EXTENT*(c.tileID.canonical.x-(t.canonical.x+q<<-C)),U=l.EXTENT*(c.tileID.canonical.y-(t.canonical.y<<-C))),l.ortho(b,0,I,0,I,0,1),l.translate(b,b,[S,U,0])}return new Vi(c.tileID,t.key,b)}_findTileCoveringTileID(t,c){let g=c.getTile(t);if(g&&g.hasData())return g;const b=this._findCoveringTileCache[c.id],C=b[t.key];if(g=C?c.getTileByID(C):null,g&&g.hasData()||null===C)return g;let I=g?g.tileID:t,S=I.overscaledZ;const U=c.getSource().minzoom,q=[];if(!C){const ae=c.getSource().maxzoom;if(t.canonical.z>=ae){const Te=t.canonical.z-ae;c.getSource().reparseOverscaled?(S=Math.max(t.canonical.z+2,c.transform.tileZoom),I=new l.OverscaledTileID(S,t.wrap,ae,t.canonical.x>>Te,t.canonical.y>>Te)):0!==Te&&(S=ae,I=new l.OverscaledTileID(S,t.wrap,ae,t.canonical.x>>Te,t.canonical.y>>Te))}I.key!==t.key&&(q.push(I.key),g=c.getTile(I))}const J=ae=>{q.forEach(Te=>{b[Te]=ae}),q.length=0};for(S-=1;S>=U&&(!g||!g.hasData());S--){g&&J(g.tileID.key);const ae=I.calculateScaledKey(S);if(g=c.getTileByID(ae),g&&g.hasData())break;const Te=b[ae];if(null===Te)break;void 0===Te?q.push(ae):g=c.getTileByID(Te)}return J(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,c){let g=this._tilesDirty[t];g||(g=this._tilesDirty[t]={}),g[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(c){let g=0;const b=new l.StructArrayLayout2ui4,C=131;for(let I=1;I<129;I++){for(let S=1;S<129;S++)g=I*C+S,b.emplaceBack(g,g+1),b.emplaceBack(g,g+C),b.emplaceBack(g+1,g+C),128===I&&b.emplaceBack(g+C,g+C+1);b.emplaceBack(g+1,g+1+C)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=l.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function fr(p){const t=[];for(let c=0;c<p.length;c++){if(null===p[c])continue;const g=p[c].split(" ");t.push(g.pop())}return t}class br{static cacheKey(t,c,g){let b=`${t}${g?g.cacheKey:""}`;for(const C of c)b+=`/${C}`;return b}constructor(t,c,g,b,C,I){const S=t.gl;this.program=S.createProgram();const U=fr(g.staticAttributes),q=b?b.getBinderAttributes():[],J=U.concat(q),ae=g.staticUniforms?fr(g.staticUniforms):[],Te=b?b.getBinderUniforms():[],Ve=ae.concat(Te),Oe=[];for(const nt of Ve)Oe.indexOf(nt)<0&&Oe.push(nt);let xe=b?b.defines():[];xe=xe.concat(I.map(nt=>`#define ${nt}`));const at=xe.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ts,Zs.fragmentSource,vo.fragmentSource,g.fragmentSource).join("\n"),Ye=xe.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ts,Zs.vertexSource,vo.vertexSource,yo.vertexSource,g.vertexSource).join("\n"),rt=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(rt,at),S.compileShader(rt),S.attachShader(this.program,rt);const ot=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(ot,Ye),S.compileShader(ot),S.attachShader(this.program,ot),this.attributes={};const mt={};this.numAttributes=J.length;for(let nt=0;nt<this.numAttributes;nt++)J[nt]&&(S.bindAttribLocation(this.program,nt,J[nt]),this.attributes[J[nt]]=nt);S.linkProgram(this.program),S.deleteShader(ot),S.deleteShader(rt);for(let nt=0;nt<Oe.length;nt++){const bt=Oe[nt];if(bt&&!mt[bt]){const Jt=S.getUniformLocation(this.program,bt);Jt&&(mt[bt]=Jt)}}var nt,bt;this.fixedUniforms=C(t,mt),this.binderUniforms=b?b.getUniforms(t,mt):[],-1!==I.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new l.Uniform1i(nt=t,(bt=mt).u_dem),u_dem_prev:new l.Uniform1i(nt,bt.u_dem_prev),u_dem_unpack:new l.Uniform4f(nt,bt.u_dem_unpack),u_dem_tl:new l.Uniform2f(nt,bt.u_dem_tl),u_dem_scale:new l.Uniform1f(nt,bt.u_dem_scale),u_dem_tl_prev:new l.Uniform2f(nt,bt.u_dem_tl_prev),u_dem_scale_prev:new l.Uniform1f(nt,bt.u_dem_scale_prev),u_dem_size:new l.Uniform1f(nt,bt.u_dem_size),u_dem_lerp:new l.Uniform1f(nt,bt.u_dem_lerp),u_exaggeration:new l.Uniform1f(nt,bt.u_exaggeration),u_depth:new l.Uniform1i(nt,bt.u_depth),u_depth_size_inv:new l.Uniform2f(nt,bt.u_depth_size_inv),u_meter_to_dem:new l.Uniform1f(nt,bt.u_meter_to_dem),u_label_plane_matrix_inv:new l.UniformMatrix4f(nt,bt.u_label_plane_matrix_inv),u_tile_tl_up:new l.Uniform3f(nt,bt.u_tile_tl_up),u_tile_tr_up:new l.Uniform3f(nt,bt.u_tile_tr_up),u_tile_br_up:new l.Uniform3f(nt,bt.u_tile_br_up),u_tile_bl_up:new l.Uniform3f(nt,bt.u_tile_bl_up),u_tile_up_scale:new l.Uniform1f(nt,bt.u_tile_up_scale)}),-1!==I.indexOf("FOG")&&(this.fogUniforms=((nt,bt)=>({u_fog_matrix:new l.UniformMatrix4f(nt,bt.u_fog_matrix),u_fog_range:new l.Uniform2f(nt,bt.u_fog_range),u_fog_color:new l.Uniform4f(nt,bt.u_fog_color),u_fog_horizon_blend:new l.Uniform1f(nt,bt.u_fog_horizon_blend),u_fog_temporal_offset:new l.Uniform1f(nt,bt.u_fog_temporal_offset)}))(t,mt))}setTerrainUniformValues(t,c){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const b in c)g[b].set(c[b])}}setFogUniformValues(t,c){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const b in c)g[b].location&&g[b].set(c[b])}}draw(t,c,g,b,C,I,S,U,q,J,ae,Te,Ve,Oe,xe,at){const Ye=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(g),t.setStencilMode(b),t.setColorMode(C),t.setCullFace(I);for(const ot of Object.keys(this.fixedUniforms))this.fixedUniforms[ot].set(S[ot]);Oe&&Oe.setUniforms(t,this.binderUniforms,Te,{zoom:Ve});const rt={[Ye.LINES]:2,[Ye.TRIANGLES]:3,[Ye.LINE_STRIP]:1}[c];for(const ot of ae.get()){const mt=ot.vaos||(ot.vaos={});(mt[U]||(mt[U]=new to)).bind(t,this,q,Oe?Oe.getPaintVertexBuffers():[],J,ot.vertexOffset,xe,at),Ye.drawElements(c,ot.primitiveLength*rt,Ye.UNSIGNED_SHORT,ot.primitiveOffset*rt*2)}}}function ee(p,t,c){const g=1/Bt(c,1,t.transform.tileZoom),b=Math.pow(2,c.tileID.overscaledZ),C=c.tileSize*Math.pow(2,t.transform.tileZoom)/b,I=C*(c.tileID.canonical.x+c.tileID.wrap*b),S=C*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[g,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[I>>16,S>>16],u_pixel_coord_lower:[65535&I,65535&S]}}const W=l.create(),H=(p,t,c,g,b,C,I,S,U)=>{const q=t.style.light,J=q.properties.get("position"),ae=[J.x,J.y,J.z],Te=l.create$1();"viewport"===q.properties.get("anchor")&&(l.fromRotation(Te,-t.transform.angle),l.transformMat3(ae,ae,Te));const Ve=q.properties.get("color"),Oe=t.transform,xe={u_matrix:p,u_lightpos:ae,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[Ve.r,Ve.g,Ve.b],u_vertical_gradient:+c,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:W,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===Oe.projection.name&&(xe.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],xe.u_zoom_transition=I,xe.u_inv_rot_matrix=U,xe.u_merc_center=S,xe.u_up_dir=Oe.projection.upVector(new l.CanonicalTileID(0,0,0),S[0]*l.EXTENT,S[1]*l.EXTENT),xe.u_height_lift=C),xe},Re=(p,t,c,g,b,C,I,S,U,q,J)=>{const ae=H(p,t,c,g,b,S,U,q,J),Te={u_height_factor:-Math.pow(2,b.overscaledZ)/I.tileSize/8};return l.extend(ae,ee(C,t,I),Te)},wn=p=>({u_matrix:p}),Ii=(p,t,c,g)=>l.extend(wn(p),ee(c,t,g)),Rr=(p,t)=>({u_matrix:p,u_world:t}),Ri=(p,t,c,g,b)=>l.extend(Ii(p,t,c,g),{u_world:b}),Rs=l.create(),ks=(p,t,c,g,b,C)=>{const I=p.transform,S="globe"===I.projection.name;let U;if("map"===C.paint.get("circle-pitch-alignment"))if(S){const J=l.globePixelsToTileUnits(I.zoom,t.canonical);U=Float32Array.from([J,0,0,J])}else U=I.calculatePixelsToTileUnitsMatrix(c);else U=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const q={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:p.translatePosMatrix(t.projMatrix,c,C.paint.get("circle-translate"),C.paint.get("circle-translate-anchor")),u_device_pixel_ratio:l.exported.devicePixelRatio,u_extrude_scale:U,u_inv_rot_matrix:Rs,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return S&&(q.u_inv_rot_matrix=g,q.u_merc_center=b,q.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],q.u_zoom_transition=l.globeToMercatorTransition(I.zoom),q.u_up_dir=I.projection.upVector(t.canonical,b[0],b[1])),q},fl=p=>{const t=[];return"map"===p.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},uc=(p,t,c)=>{const g=l.EXTENT/c.tileSize;return{u_matrix:p,u_camera_to_center_distance:t.cameraToCenterDistance,u_extrude_scale:[t.pixelsToGLUnits[0]/g,t.pixelsToGLUnits[1]/g]}},ml=(p,t,c=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:c}),Is=l.create(),dc=(p,t,c,g,b,C,I)=>{const S=p.transform,U="globe"===S.projection.name,q=U?l.globePixelsToTileUnits(S.zoom,t.canonical):Bt(c,1,C),J={u_matrix:t.projMatrix,u_extrude_scale:q,u_intensity:I,u_inv_rot_matrix:Is,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return U&&(J.u_inv_rot_matrix=g,J.u_merc_center=b,J.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],J.u_zoom_transition=l.globeToMercatorTransition(S.zoom),J.u_up_dir=S.projection.upVector(t.canonical,b[0],b[1])),J},hc=(p,t,c,g,b,C,I)=>{const S=p.transform,U=S.calculatePixelsToTileUnitsMatrix(t),q={u_matrix:gs(p,t,c,b),u_pixels_to_tile_units:U,u_device_pixel_ratio:I,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:C,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(ro(c)){const J=ur(t,p.transform);q.u_texsize=t.lineAtlasTexture.size,q.u_scale=[J,g.fromScale,g.toScale],q.u_mix=g.t}return q},Pn=(p,t,c,g,b,C)=>{const I=p.transform,S=ur(t,I);return{u_matrix:gs(p,t,c,b),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:C,u_image:0,u_scale:[S,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ur(p,t){return 1/Bt(p,1,t.tileZoom)}function gs(p,t,c,g){return p.translatePosMatrix(g||t.tileID.projMatrix,t,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function ro(p){const t=p.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const gl=(p,t,c,g,b,C)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:c,u_fade_t:g.mix,u_opacity:g.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(S=b.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(I=b.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:_s(b.paint.get("raster-hue-rotate")),u_perspective_transform:C};var I,S};function _s(p){p*=Math.PI/180;const t=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*t-c+1)/3,(Math.sqrt(3)*t-c+1)/3]}const Oo=l.create(),Ha=(p,t,c,g,b,C,I,S,U,q,J,ae,Te,Ve)=>{const Oe=b.transform,xe={u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Oe.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:Oe.width/Oe.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:I,u_coord_matrix:S,u_is_text:+U,u_pitch_with_map:+g,u_texsize:q,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Oo,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Oo};return"globe"===Oe.projection.name&&(xe.u_tile_id=[J.canonical.x,J.canonical.y,1<<J.canonical.z],xe.u_zoom_transition=ae,xe.u_inv_rot_matrix=Ve,xe.u_merc_center=Te,xe.u_camera_forward=Oe._camera.forward(),xe.u_ecef_origin=l.globeECEFOrigin(Oe.globeMatrix,J.toUnwrapped()),xe.u_tile_matrix=Float32Array.from(Oe.globeMatrix)),xe},Hs=(p,t,c,g,b,C,I,S,U,q,J,ae,Te,Ve,Oe)=>{const{cameraToCenterDistance:xe,_pitch:at}=b.transform;return l.extend(Ha(p,t,c,g,b,C,I,S,U,q,ae,Te,Ve,Oe),{u_gamma_scale:g?xe*Math.cos(b.terrain?0:at):1,u_device_pixel_ratio:l.exported.devicePixelRatio,u_is_halo:+J})},qa=(p,t,c,g,b,C,I,S,U,q,J,ae,Te,Ve)=>l.extend(Hs(p,t,c,g,b,C,I,S,!0,U,!0,J,ae,Te,Ve),{u_texsize_icon:q,u_texture_icon:1}),zl=(p,t,c)=>({u_matrix:p,u_opacity:t,u_color:c}),Nl=(p,t,c,g,b,C)=>l.extend(function(I,S,U,q){const J=U.imageManager.getPattern(I.from.toString()),ae=U.imageManager.getPattern(I.to.toString()),{width:Te,height:Ve}=U.imageManager.getPixelSize(),Oe=Math.pow(2,q.tileID.overscaledZ),xe=q.tileSize*Math.pow(2,U.transform.tileZoom)/Oe,at=xe*(q.tileID.canonical.x+q.tileID.wrap*Oe),Ye=xe*q.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:J.tl,u_pattern_br_a:J.br,u_pattern_tl_b:ae.tl,u_pattern_br_b:ae.br,u_texsize:[Te,Ve],u_mix:S.t,u_pattern_size_a:J.displaySize,u_pattern_size_b:ae.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/Bt(q,1,U.transform.tileZoom),u_pixel_coord_upper:[at>>16,Ye>>16],u_pixel_coord_lower:[65535&at,65535&Ye]}}(g,C,c,b),{u_matrix:p,u_opacity:t}),dr={fillExtrusion:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_lightpos:new l.Uniform3f(p,t.u_lightpos),u_lightintensity:new l.Uniform1f(p,t.u_lightintensity),u_lightcolor:new l.Uniform3f(p,t.u_lightcolor),u_vertical_gradient:new l.Uniform1f(p,t.u_vertical_gradient),u_opacity:new l.Uniform1f(p,t.u_opacity),u_tile_id:new l.Uniform3f(p,t.u_tile_id),u_zoom_transition:new l.Uniform1f(p,t.u_zoom_transition),u_inv_rot_matrix:new l.UniformMatrix4f(p,t.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(p,t.u_merc_center),u_up_dir:new l.Uniform3f(p,t.u_up_dir),u_height_lift:new l.Uniform1f(p,t.u_height_lift)}),fillExtrusionPattern:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_lightpos:new l.Uniform3f(p,t.u_lightpos),u_lightintensity:new l.Uniform1f(p,t.u_lightintensity),u_lightcolor:new l.Uniform3f(p,t.u_lightcolor),u_vertical_gradient:new l.Uniform1f(p,t.u_vertical_gradient),u_height_factor:new l.Uniform1f(p,t.u_height_factor),u_tile_id:new l.Uniform3f(p,t.u_tile_id),u_zoom_transition:new l.Uniform1f(p,t.u_zoom_transition),u_inv_rot_matrix:new l.UniformMatrix4f(p,t.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(p,t.u_merc_center),u_up_dir:new l.Uniform3f(p,t.u_up_dir),u_height_lift:new l.Uniform1f(p,t.u_height_lift),u_image:new l.Uniform1i(p,t.u_image),u_texsize:new l.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(p,t.u_scale),u_fade:new l.Uniform1f(p,t.u_fade),u_opacity:new l.Uniform1f(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_image:new l.Uniform1i(p,t.u_image),u_texsize:new l.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(p,t.u_scale),u_fade:new l.Uniform1f(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_world:new l.Uniform2f(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_world:new l.Uniform2f(p,t.u_world),u_image:new l.Uniform1i(p,t.u_image),u_texsize:new l.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(p,t.u_scale),u_fade:new l.Uniform1f(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new l.Uniform1f(p,t.u_camera_to_center_distance),u_extrude_scale:new l.UniformMatrix2f(p,t.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(p,t.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_inv_rot_matrix:new l.UniformMatrix4f(p,t.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(p,t.u_merc_center),u_tile_id:new l.Uniform3f(p,t.u_tile_id),u_zoom_transition:new l.Uniform1f(p,t.u_zoom_transition),u_up_dir:new l.Uniform3f(p,t.u_up_dir)}),collisionBox:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_camera_to_center_distance:new l.Uniform1f(p,t.u_camera_to_center_distance),u_extrude_scale:new l.Uniform2f(p,t.u_extrude_scale)}),collisionCircle:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_inv_matrix:new l.UniformMatrix4f(p,t.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(p,t.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new l.UniformColor(p,t.u_color),u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_overlay:new l.Uniform1i(p,t.u_overlay),u_overlay_scale:new l.Uniform1f(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new l.Uniform1f(p,t.u_extrude_scale),u_intensity:new l.Uniform1f(p,t.u_intensity),u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_inv_rot_matrix:new l.UniformMatrix4f(p,t.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(p,t.u_merc_center),u_tile_id:new l.Uniform3f(p,t.u_tile_id),u_zoom_transition:new l.Uniform1f(p,t.u_zoom_transition),u_up_dir:new l.Uniform3f(p,t.u_up_dir)}),heatmapTexture:(p,t)=>({u_image:new l.Uniform1i(p,t.u_image),u_color_ramp:new l.Uniform1i(p,t.u_color_ramp),u_opacity:new l.Uniform1f(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_image:new l.Uniform1i(p,t.u_image),u_latrange:new l.Uniform2f(p,t.u_latrange),u_light:new l.Uniform2f(p,t.u_light),u_shadow:new l.UniformColor(p,t.u_shadow),u_highlight:new l.UniformColor(p,t.u_highlight),u_accent:new l.UniformColor(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_image:new l.Uniform1i(p,t.u_image),u_dimension:new l.Uniform2f(p,t.u_dimension),u_zoom:new l.Uniform1f(p,t.u_zoom),u_unpack:new l.Uniform4f(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_pixels_to_tile_units:new l.UniformMatrix2f(p,t.u_pixels_to_tile_units),u_device_pixel_ratio:new l.Uniform1f(p,t.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(p,t.u_units_to_pixels),u_dash_image:new l.Uniform1i(p,t.u_dash_image),u_gradient_image:new l.Uniform1i(p,t.u_gradient_image),u_image_height:new l.Uniform1f(p,t.u_image_height),u_texsize:new l.Uniform2f(p,t.u_texsize),u_scale:new l.Uniform3f(p,t.u_scale),u_mix:new l.Uniform1f(p,t.u_mix),u_alpha_discard_threshold:new l.Uniform1f(p,t.u_alpha_discard_threshold)}),linePattern:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_texsize:new l.Uniform2f(p,t.u_texsize),u_pixels_to_tile_units:new l.UniformMatrix2f(p,t.u_pixels_to_tile_units),u_device_pixel_ratio:new l.Uniform1f(p,t.u_device_pixel_ratio),u_image:new l.Uniform1i(p,t.u_image),u_units_to_pixels:new l.Uniform2f(p,t.u_units_to_pixels),u_scale:new l.Uniform3f(p,t.u_scale),u_fade:new l.Uniform1f(p,t.u_fade),u_alpha_discard_threshold:new l.Uniform1f(p,t.u_alpha_discard_threshold)}),raster:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_tl_parent:new l.Uniform2f(p,t.u_tl_parent),u_scale_parent:new l.Uniform1f(p,t.u_scale_parent),u_fade_t:new l.Uniform1f(p,t.u_fade_t),u_opacity:new l.Uniform1f(p,t.u_opacity),u_image0:new l.Uniform1i(p,t.u_image0),u_image1:new l.Uniform1i(p,t.u_image1),u_brightness_low:new l.Uniform1f(p,t.u_brightness_low),u_brightness_high:new l.Uniform1f(p,t.u_brightness_high),u_saturation_factor:new l.Uniform1f(p,t.u_saturation_factor),u_contrast_factor:new l.Uniform1f(p,t.u_contrast_factor),u_spin_weights:new l.Uniform3f(p,t.u_spin_weights),u_perspective_transform:new l.Uniform2f(p,t.u_perspective_transform)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new l.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(p,t.u_size_t),u_size:new l.Uniform1f(p,t.u_size),u_camera_to_center_distance:new l.Uniform1f(p,t.u_camera_to_center_distance),u_rotate_symbol:new l.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(p,t.u_fade_change),u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new l.Uniform1i(p,t.u_is_text),u_pitch_with_map:new l.Uniform1i(p,t.u_pitch_with_map),u_texsize:new l.Uniform2f(p,t.u_texsize),u_tile_id:new l.Uniform3f(p,t.u_tile_id),u_zoom_transition:new l.Uniform1f(p,t.u_zoom_transition),u_inv_rot_matrix:new l.UniformMatrix4f(p,t.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(p,t.u_merc_center),u_camera_forward:new l.Uniform3f(p,t.u_camera_forward),u_tile_matrix:new l.UniformMatrix4f(p,t.u_tile_matrix),u_ecef_origin:new l.Uniform3f(p,t.u_ecef_origin),u_texture:new l.Uniform1i(p,t.u_texture)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new l.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(p,t.u_size_t),u_size:new l.Uniform1f(p,t.u_size),u_camera_to_center_distance:new l.Uniform1f(p,t.u_camera_to_center_distance),u_rotate_symbol:new l.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(p,t.u_fade_change),u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new l.Uniform1i(p,t.u_is_text),u_pitch_with_map:new l.Uniform1i(p,t.u_pitch_with_map),u_texsize:new l.Uniform2f(p,t.u_texsize),u_texture:new l.Uniform1i(p,t.u_texture),u_gamma_scale:new l.Uniform1f(p,t.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(p,t.u_device_pixel_ratio),u_tile_id:new l.Uniform3f(p,t.u_tile_id),u_zoom_transition:new l.Uniform1f(p,t.u_zoom_transition),u_inv_rot_matrix:new l.UniformMatrix4f(p,t.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(p,t.u_merc_center),u_camera_forward:new l.Uniform3f(p,t.u_camera_forward),u_tile_matrix:new l.UniformMatrix4f(p,t.u_tile_matrix),u_ecef_origin:new l.Uniform3f(p,t.u_ecef_origin),u_is_halo:new l.Uniform1i(p,t.u_is_halo)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new l.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(p,t.u_size_t),u_size:new l.Uniform1f(p,t.u_size),u_camera_to_center_distance:new l.Uniform1f(p,t.u_camera_to_center_distance),u_rotate_symbol:new l.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(p,t.u_fade_change),u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new l.Uniform1i(p,t.u_is_text),u_pitch_with_map:new l.Uniform1i(p,t.u_pitch_with_map),u_texsize:new l.Uniform2f(p,t.u_texsize),u_texsize_icon:new l.Uniform2f(p,t.u_texsize_icon),u_texture:new l.Uniform1i(p,t.u_texture),u_texture_icon:new l.Uniform1i(p,t.u_texture_icon),u_gamma_scale:new l.Uniform1f(p,t.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(p,t.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(p,t.u_is_halo)}),background:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_opacity:new l.Uniform1f(p,t.u_opacity),u_color:new l.UniformColor(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_opacity:new l.Uniform1f(p,t.u_opacity),u_image:new l.Uniform1i(p,t.u_image),u_pattern_tl_a:new l.Uniform2f(p,t.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(p,t.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(p,t.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(p,t.u_pattern_br_b),u_texsize:new l.Uniform2f(p,t.u_texsize),u_mix:new l.Uniform1f(p,t.u_mix),u_pattern_size_a:new l.Uniform2f(p,t.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(p,t.u_pattern_size_b),u_scale_a:new l.Uniform1f(p,t.u_scale_a),u_scale_b:new l.Uniform1f(p,t.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(p,t.u_tile_units_to_pixels)}),terrainRaster:Ds,terrainDepth:Ds,skybox:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_sun_direction:new l.Uniform3f(p,t.u_sun_direction),u_cubemap:new l.Uniform1i(p,t.u_cubemap),u_opacity:new l.Uniform1f(p,t.u_opacity),u_temporal_offset:new l.Uniform1f(p,t.u_temporal_offset)}),skyboxGradient:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_color_ramp:new l.Uniform1i(p,t.u_color_ramp),u_center_direction:new l.Uniform3f(p,t.u_center_direction),u_radius:new l.Uniform1f(p,t.u_radius),u_opacity:new l.Uniform1f(p,t.u_opacity),u_temporal_offset:new l.Uniform1f(p,t.u_temporal_offset)}),skyboxCapture:(p,t)=>({u_matrix_3f:new l.UniformMatrix3f(p,t.u_matrix_3f),u_sun_direction:new l.Uniform3f(p,t.u_sun_direction),u_sun_intensity:new l.Uniform1f(p,t.u_sun_intensity),u_color_tint_r:new l.Uniform4f(p,t.u_color_tint_r),u_color_tint_m:new l.Uniform4f(p,t.u_color_tint_m),u_luminance:new l.Uniform1f(p,t.u_luminance)}),globeRaster:(p,t)=>({u_proj_matrix:new l.UniformMatrix4f(p,t.u_proj_matrix),u_globe_matrix:new l.UniformMatrix4f(p,t.u_globe_matrix),u_merc_matrix:new l.UniformMatrix4f(p,t.u_merc_matrix),u_zoom_transition:new l.Uniform1f(p,t.u_zoom_transition),u_merc_center:new l.Uniform2f(p,t.u_merc_center),u_image0:new l.Uniform1i(p,t.u_image0),u_grid_matrix:new l.UniformMatrix3f(p,t.u_grid_matrix)}),globeAtmosphere:(p,t)=>({u_frustum_tl:new l.Uniform3f(p,t.u_frustum_tl),u_frustum_tr:new l.Uniform3f(p,t.u_frustum_tr),u_frustum_br:new l.Uniform3f(p,t.u_frustum_br),u_frustum_bl:new l.Uniform3f(p,t.u_frustum_bl),u_globe_pos:new l.Uniform3f(p,t.u_globe_pos),u_globe_radius:new l.Uniform1f(p,t.u_globe_radius),u_opacity:new l.Uniform1f(p,t.u_opacity),u_fadeout_range:new l.Uniform1f(p,t.u_fadeout_range),u_start_color:new l.Uniform3f(p,t.u_start_color),u_end_color:new l.Uniform3f(p,t.u_end_color)})};let ao;function E(p,t,c,g,b,C,I){const S=p.context,U=S.gl,q=p.useProgram("collisionBox"),J=[];let ae=0,Te=0;for(let ot=0;ot<g.length;ot++){const mt=g[ot],nt=t.getTile(mt),bt=nt.getBucket(c);if(!bt)continue;let Jt=mt.projMatrix;0===b[0]&&0===b[1]||(Jt=p.translatePosMatrix(mt.projMatrix,nt,b,C));const rn=I?bt.textCollisionBox:bt.iconCollisionBox,hn=bt.collisionCircleArray;if(hn.length>0){const un=l.create(),Un=Jt;l.mul(un,bt.placementInvProjMatrix,p.transform.glCoordMatrix),l.mul(un,un,bt.placementViewportMatrix),J.push({circleArray:hn,circleOffset:Te,transform:Un,invTransform:un}),ae+=hn.length/4,Te=ae}rn&&(p.terrain&&p.terrain.setupElevationDraw(nt,q),q.draw(S,U.LINES,l.DepthMode.disabled,l.StencilMode.disabled,p.colorModeForRenderPass(),l.CullFaceMode.disabled,uc(Jt,p.transform,nt),c.id,rn.layoutVertexBuffer,rn.indexBuffer,rn.segments,null,p.transform.zoom,null,rn.collisionVertexBuffer,rn.collisionVertexBufferExt))}if(!I||!J.length)return;const Ve=p.useProgram("collisionCircle"),Oe=new l.StructArrayLayout2f1f2i16;Oe.resize(4*ae),Oe._trim();let xe=0;for(const ot of J)for(let mt=0;mt<ot.circleArray.length/4;mt++){const nt=4*mt,bt=ot.circleArray[nt+0],Jt=ot.circleArray[nt+1],rn=ot.circleArray[nt+2],hn=ot.circleArray[nt+3];Oe.emplace(xe++,bt,Jt,rn,hn,0),Oe.emplace(xe++,bt,Jt,rn,hn,1),Oe.emplace(xe++,bt,Jt,rn,hn,2),Oe.emplace(xe++,bt,Jt,rn,hn,3)}(!ao||ao.length<2*ae)&&(ao=function(ot){const mt=2*ot,nt=new l.StructArrayLayout3ui6;nt.resize(mt),nt._trim();for(let bt=0;bt<mt;bt++){const Jt=6*bt;nt.uint16[Jt+0]=4*bt+0,nt.uint16[Jt+1]=4*bt+1,nt.uint16[Jt+2]=4*bt+2,nt.uint16[Jt+3]=4*bt+2,nt.uint16[Jt+4]=4*bt+3,nt.uint16[Jt+5]=4*bt+0}return nt}(ae));const at=S.createIndexBuffer(ao,!0),Ye=S.createVertexBuffer(Oe,l.collisionCircleLayout.members,!0);for(const ot of J){const mt={u_matrix:ot.transform,u_inv_matrix:ot.invTransform,u_camera_to_center_distance:(rt=p.transform).cameraToCenterDistance,u_viewport_size:[rt.width,rt.height]};Ve.draw(S,U.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,p.colorModeForRenderPass(),l.CullFaceMode.disabled,mt,c.id,Ye,at,l.SegmentVector.simpleSegment(0,2*ot.circleOffset,ot.circleArray.length,ot.circleArray.length/2),null,p.transform.zoom,null,null,null)}var rt;Ye.destroy(),at.destroy()}const Z=l.create();function D(p,t,c,g,b,C){const{horizontalAlign:I,verticalAlign:S}=l.getAnchorAlignment(p),U=-(I-.5)*t,q=-(S-.5)*c,J=l.evaluateVariableOffset(p,g);return new l.pointGeometry((U/b+J[0])*C,(q/b+J[1])*C)}function j(p,t,c,g,b,C,I,S,U,q,J,ae){const Te=p.text.placedSymbolArray,Ve=p.text.dynamicLayoutVertexArray,Oe=p.icon.dynamicLayoutVertexArray,xe={},at=S.projMatrix,Ye=C.elevation,rt=ae.upVectorScale(S.canonical,C.center.lat,C.worldSize);Ve.clear();for(let ot=0;ot<Te.length;ot++){const mt=Te.get(ot),nt=p.allowVerticalPlacement&&!mt.placedOrientation,bt=mt.hidden||!mt.crossTileID||nt?null:g[mt.crossTileID];if(bt){const Jt=new l.pointGeometry(mt.tileAnchorX,mt.tileAnchorY),rn=ae.upVector(S.canonical,Jt.x,Jt.y),hn=Ye?Ye.getAtTileOffset(S,Jt.x,Jt.y):0,un=wr([mt.projectedAnchorX+hn*rn[0]*rt.metersToTile,mt.projectedAnchorY+hn*rn[1]*rt.metersToTile,mt.projectedAnchorZ+hn*rn[2]*rt.metersToTile],c?at:I),Un=ki(C.cameraToCenterDistance,un.signedDistanceFromCamera);let Zt=b.evaluateSizeForFeature(p.textSizeData,q,mt)*Un/l.ONE_EM;c&&(Zt*=p.tilePixelRatio/U);const{width:Vn,height:Bn,anchor:li,textOffset:pn,textScale:ci}=bt,Ti=D(li,Vn,Bn,pn,ci,Zt),ui=c?Ir(Jt.add(Ti),I,hn*rt.metersToLabelSpace).point:un.point.add(t?Ti.rotate(-C.angle):Ti),si=p.allowVerticalPlacement&&mt.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let Ei=0;Ei<mt.numGlyphs;Ei++)l.addDynamicAttributes(Ve,ui,si);J&&mt.associatedIconIndex>=0&&(xe[mt.associatedIconIndex]={shiftedAnchor:ui,angle:si})}else ct(mt.numGlyphs,Ve)}if(J){Oe.clear();const ot=p.icon.placedSymbolArray;for(let mt=0;mt<ot.length;mt++){const nt=ot.get(mt);if(nt.hidden)ct(nt.numGlyphs,Oe);else{const bt=xe[mt];if(bt)for(let Jt=0;Jt<nt.numGlyphs;Jt++)l.addDynamicAttributes(Oe,bt.shiftedAnchor,bt.angle);else ct(nt.numGlyphs,Oe)}}p.icon.dynamicLayoutVertexBuffer.updateData(Oe)}p.text.dynamicLayoutVertexBuffer.updateData(Ve)}function fe(p,t,c){return c.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Pt(p,t,c,g,b,C,I,S,U,q,J,ae){const Te=p.context,Ve=Te.gl,Oe=p.transform,xe="map"===S,at="map"===U,Ye=xe&&"point"!==c.layout.get("symbol-placement"),rt=xe&&!at&&!Ye,ot=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let mt=!1;const nt=p.depthModeForSublayer(0,l.DepthMode.ReadOnly),bt=[l.mercatorXfromLng(Oe.center.lng),l.mercatorYfromLat(Oe.center.lat)],Jt=c.layout.get("text-variable-anchor"),rn="globe"===Oe.projection.name,hn=rn?l.globeToMercatorTransition(Oe.zoom):0,un=[],Un=[];p.terrain&&at&&Un.push("PITCH_WITH_MAP_TERRAIN"),rn&&Un.push("PROJECTION_GLOBE_VIEW");for(const Zt of g){const Vn=t.getTile(Zt),Bn=Vn.getBucket(c);if(!Bn||Bn.projection!==Oe.projection.name)continue;const li=b?Bn.text:Bn.icon;if(!li||Bn.fullyClipped||!li.segments.get().length)continue;const pn=li.programConfigurations.get(c.id),ci=b||Bn.sdfIcons,Ti=b?Bn.textSizeData:Bn.iconSizeData,ui=at||0!==Oe.pitch,si=l.evaluateSizeForZoom(Ti,Oe.zoom);let Ei,qi,_i,Fi,hr=[0,0],no=null;if(b){if(qi=Vn.glyphAtlasTexture,_i=Ve.LINEAR,Ei=Vn.glyphAtlasTexture.size,Bn.iconsInText){hr=Vn.imageAtlasTexture.size,no=Vn.imageAtlasTexture;const vs="composite"===Ti.kind||"camera"===Ti.kind;Fi=ui||p.options.rotating||p.options.zooming||vs?Ve.LINEAR:Ve.NEAREST}}else{const vs=1!==c.layout.get("icon-size").constantOr(0)||Bn.iconsNeedLinear;qi=Vn.imageAtlasTexture,_i=ci||p.options.rotating||p.options.zooming||vs||ui?Ve.LINEAR:Ve.NEAREST,Ei=Vn.imageAtlasTexture.size}const Bo=p.transform.calculatePixelsToTileUnitsMatrix(Vn),ts=$r(Zt.projMatrix,Vn.tileID.canonical,at,xe,p.transform,Bo),Fs=p.terrain&&at&&Ye?l.invert(l.create(),ts):Z,ua=jr(Zt.projMatrix,Vn.tileID.canonical,at,xe,p.transform,Bo),As=Jt&&Bn.hasTextData(),Ks="none"!==c.layout.get("icon-text-fit")&&As&&Bn.hasIconData();if(Ye){const vs=Oe.elevation,ea=vs?vs.getAtTileOffsetFunc(Zt,Oe.center.lat,Oe.worldSize,Oe.projection):Sd=>[0,0,0];Kr(Bn,Zt.projMatrix,p,b,ts,ua,at,q,ea,Zt)}const Ra=Ye||b&&Jt||Ks,wo=p.translatePosMatrix(Zt.projMatrix,Vn,C,I),mo=Ra?Z:ts,Er=p.translatePosMatrix(ua,Vn,C,I,!0),Ro=Oe.projection.createInversionMatrix(Oe,Zt.canonical),Bs=Ra?Un.concat(["PROJECTED_POS_ON_VIEWPORT"]):Un,co=ci&&0!==c.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1);let Qs;Qs=ci?Bn.iconsInText?qa(Ti.kind,si,rt,at,p,wo,mo,Er,Ei,hr,Zt,hn,bt,Ro):Hs(Ti.kind,si,rt,at,p,wo,mo,Er,b,Ei,!0,Zt,hn,bt,Ro):Ha(Ti.kind,si,rt,at,p,wo,mo,Er,b,Ei,Zt,hn,bt,Ro);const il={program:p.useProgram(fe(ci,b,Bn),pn,Bs),buffers:li,uniformValues:Qs,atlasTexture:qi,atlasTextureIcon:no,atlasInterpolation:_i,atlasInterpolationIcon:Fi,isSDF:ci,hasHalo:co,tile:Vn,labelPlaneMatrixInv:Fs};if(ot&&Bn.canOverlap){mt=!0;const vs=li.segments.get();for(const ea of vs)un.push({segments:new l.SegmentVector([ea]),sortKey:ea.sortKey,state:il})}else un.push({segments:li.segments,sortKey:0,state:il})}mt&&un.sort((Zt,Vn)=>Zt.sortKey-Vn.sortKey);for(const Zt of un){const Vn=Zt.state;if(p.terrain&&p.terrain.setupElevationDraw(Vn.tile,Vn.program,{useDepthForOcclusion:!rn,labelPlaneMatrixInv:Vn.labelPlaneMatrixInv}),Te.activeTexture.set(Ve.TEXTURE0),Vn.atlasTexture.bind(Vn.atlasInterpolation,Ve.CLAMP_TO_EDGE),Vn.atlasTextureIcon&&(Te.activeTexture.set(Ve.TEXTURE1),Vn.atlasTextureIcon&&Vn.atlasTextureIcon.bind(Vn.atlasInterpolationIcon,Ve.CLAMP_TO_EDGE)),Vn.isSDF){const Bn=Vn.uniformValues;Vn.hasHalo&&(Bn.u_is_halo=1,Sn(Vn.buffers,Zt.segments,c,p,Vn.program,nt,J,ae,Bn)),Bn.u_is_halo=0}Sn(Vn.buffers,Zt.segments,c,p,Vn.program,nt,J,ae,Vn.uniformValues)}}function Sn(p,t,c,g,b,C,I,S,U){const q=g.context;b.draw(q,q.gl.TRIANGLES,C,I,S,l.CullFaceMode.disabled,U,c.id,p.layoutVertexBuffer,p.indexBuffer,t,c.paint,g.transform.zoom,p.programConfigurations.get(c.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Yn(p,t,c,g,b,C,I){const S=p.context.gl,U=c.paint.get("fill-pattern"),q=U&&U.constantOr(1),J=c.getCrossfadeParameters();let ae,Te,Ve,Oe,xe;I?(Te=q&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ae=S.LINES):(Te=q?"fillPattern":"fill",ae=S.TRIANGLES);for(const at of g){const Ye=t.getTile(at);if(q&&!Ye.patternsLoaded())continue;const rt=Ye.getBucket(c);if(!rt)continue;p.prepareDrawTile();const ot=rt.programConfigurations.get(c.id),mt=p.useProgram(Te,ot);q&&(p.context.activeTexture.set(S.TEXTURE0),Ye.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ot.updatePaintBuffers(J));const nt=U.constantOr(null);if(nt&&Ye.imageAtlas){const Jt=Ye.imageAtlas,rn=Jt.patternPositions[nt.to.toString()],hn=Jt.patternPositions[nt.from.toString()];rn&&hn&&ot.setConstantPatternPositions(rn,hn)}const bt=p.translatePosMatrix(at.projMatrix,Ye,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(I){Oe=rt.indexBuffer2,xe=rt.segments2;const Jt=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];Ve="fillOutlinePattern"===Te&&q?Ri(bt,p,J,Ye,Jt):Rr(bt,Jt)}else Oe=rt.indexBuffer,xe=rt.segments,Ve=q?Ii(bt,p,J,Ye):wn(bt);p.prepareDrawProgram(p.context,mt,at.toUnwrapped()),mt.draw(p.context,ae,b,p.stencilModeForClipping(at),C,l.CullFaceMode.disabled,Ve,c.id,rt.layoutVertexBuffer,Oe,xe,c.paint,p.transform.zoom,ot)}}function Li(p,t,c,g,b,C,I){const S=p.context,U=S.gl,q=p.transform,J=c.paint.get("fill-extrusion-pattern"),ae=J.constantOr(1),Te=c.getCrossfadeParameters(),Ve=c.paint.get("fill-extrusion-opacity"),Oe=function(ot){if("globe"!==ot.projection.name)return 0;const mt=Math.PI/32,nt=Math.tan(mt),bt=l.earthRadius;return bt*Math.sqrt(1+2*nt*nt)-bt}(q),xe="globe"===q.projection.name,at=xe?l.globeToMercatorTransition(q.zoom):0,Ye=[l.mercatorXfromLng(q.center.lng),l.mercatorYfromLat(q.center.lat)],rt=[];xe&&rt.push("PROJECTION_GLOBE_VIEW");for(const ot of g){const mt=t.getTile(ot),nt=mt.getBucket(c);if(!nt||nt.projection!==q.projection.name)continue;const bt=nt.programConfigurations.get(c.id),Jt=p.useProgram(ae?"fillExtrusionPattern":"fillExtrusion",bt,rt);if(p.terrain){const Vn=p.terrain;if(p.style.terrainSetForDrapingOnly())Vn.setupElevationDraw(mt,Jt,{useMeterToDem:!0});else{if(!nt.enableTerrain)continue;if(Vn.setupElevationDraw(mt,Jt,{useMeterToDem:!0}),pi(S,t,ot,nt,c,Vn),!nt.centroidVertexBuffer){const Bn=Jt.attributes.a_centroid_pos;void 0!==Bn&&U.vertexAttrib2f(Bn,0,0)}}}ae&&(p.context.activeTexture.set(U.TEXTURE0),mt.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),bt.updatePaintBuffers(Te));const rn=J.constantOr(null);if(rn&&mt.imageAtlas){const Vn=mt.imageAtlas,Bn=Vn.patternPositions[rn.to.toString()],li=Vn.patternPositions[rn.from.toString()];Bn&&li&&bt.setConstantPatternPositions(Bn,li)}const hn=p.translatePosMatrix(ot.projMatrix,mt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),un=q.projection.createInversionMatrix(q,ot.canonical),Un=c.paint.get("fill-extrusion-vertical-gradient"),Zt=ae?Re(hn,p,Un,Ve,ot,Te,mt,Oe,at,Ye,un):H(hn,p,Un,Ve,ot,Oe,at,Ye,un);p.prepareDrawProgram(S,Jt,ot.toUnwrapped()),Jt.draw(S,S.gl.TRIANGLES,b,C,I,l.CullFaceMode.backCCW,Zt,c.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,c.paint,p.transform.zoom,bt,p.terrain?nt.centroidVertexBuffer:null,xe?nt.layoutVertexExtBuffer:null)}}function pi(p,t,c,g,b,C){const I=[Ye=>{let rt=Ye.canonical.x-1,ot=Ye.wrap;return rt<0&&(rt=(1<<Ye.canonical.z)-1,ot--),new l.OverscaledTileID(Ye.overscaledZ,ot,Ye.canonical.z,rt,Ye.canonical.y)},Ye=>{let rt=Ye.canonical.x+1,ot=Ye.wrap;return rt===1<<Ye.canonical.z&&(rt=0,ot++),new l.OverscaledTileID(Ye.overscaledZ,ot,Ye.canonical.z,rt,Ye.canonical.y)},Ye=>new l.OverscaledTileID(Ye.overscaledZ,Ye.wrap,Ye.canonical.z,Ye.canonical.x,(0===Ye.canonical.y?1<<Ye.canonical.z:Ye.canonical.y)-1),Ye=>new l.OverscaledTileID(Ye.overscaledZ,Ye.wrap,Ye.canonical.z,Ye.canonical.x,Ye.canonical.y===(1<<Ye.canonical.z)-1?0:Ye.canonical.y+1)],S=Ye=>{const rt=t.getSource().minzoom,ot=nt=>{const bt=t.getTileByID(nt);if(bt&&bt.hasData())return bt.getBucket(b)},mt=[0,-1,1];for(const nt of mt){if(Ye.overscaledZ+nt<rt)continue;const bt=ot(Ye.calculateScaledKey(Ye.overscaledZ+nt));if(bt)return bt}},U=[0,0,0],q=(Ye,rt)=>(U[0]=Math.min(Ye.min.y,rt.min.y),U[1]=Math.max(Ye.max.y,rt.max.y),U[2]=l.EXTENT-rt.min.x>Ye.max.x?rt.min.x-l.EXTENT:Ye.max.x,U),J=(Ye,rt)=>(U[0]=Math.min(Ye.min.x,rt.min.x),U[1]=Math.max(Ye.max.x,rt.max.x),U[2]=l.EXTENT-rt.min.y>Ye.max.y?rt.min.y-l.EXTENT:Ye.max.y,U),ae=[(Ye,rt)=>q(Ye,rt),(Ye,rt)=>q(rt,Ye),(Ye,rt)=>J(Ye,rt),(Ye,rt)=>J(rt,Ye)],Te=new l.pointGeometry(0,0);let Ve,Oe,xe;const at=(Ye,rt,ot,mt,nt)=>{const bt=[[mt?ot:Ye,mt?Ye:ot,0],[mt?ot:rt,mt?rt:ot,0]],Jt=nt<0?l.EXTENT+nt:nt,rn=[mt?Jt:(Ye+rt)/2,mt?(Ye+rt)/2:Jt,0];return 0===ot&&nt<0||0!==ot&&nt>0?C.getForTilePoints(xe,[rn],!0,Oe):bt.push(rn),C.getForTilePoints(c,bt,!0,Ve),Math.max(bt[0][2],bt[1][2],rn[2])/C.exaggeration()};for(let Ye=0;Ye<4;Ye++){const rt=(Ye<2?1:5)-Ye,ot=g.borders[Ye];if(0===ot.length)continue;const mt=xe=I[Ye](c),nt=S(mt);if(!(nt&&nt instanceof l.FillExtrusionBucket&&nt.enableTerrain)||g.borderDoneWithNeighborZ[Ye]===nt.canonical.z&&nt.borderDoneWithNeighborZ[rt]===g.canonical.z||(Oe=C.findDEMTileFor(mt),!Oe||!Oe.dem))continue;if(!Ve){const hn=C.findDEMTileFor(c);if(!hn||!hn.dem)return;Ve=hn}const bt=nt.borders[rt];let Jt=0;const rn=nt.borderDoneWithNeighborZ[rt]!==g.canonical.z;if(g.canonical.z===nt.canonical.z){for(let hn=0;hn<ot.length;hn++){const un=g.featuresOnBorder[ot[hn]],Un=un.borders[Ye];let Zt;for(;Jt<bt.length&&(Zt=nt.featuresOnBorder[bt[Jt]],!(Zt.borders[rt][1]>Un[0]+3));)rn&&nt.encodeCentroid(void 0,Zt,!1),Jt++;if(Zt&&Jt<bt.length){const Vn=Jt;let Bn=0;for(;!(Zt.borders[rt][0]>Un[1]-3)&&(Bn++,++Jt!==bt.length);)Zt=nt.featuresOnBorder[bt[Jt]];if(Zt=nt.featuresOnBorder[bt[Vn]],un.intersectsCount()>1||Zt.intersectsCount()>1||1!==Bn){1!==Bn&&(Jt=Vn),g.encodeCentroid(void 0,un,!1),rn&&nt.encodeCentroid(void 0,Zt,!1);continue}const li=ae[Ye](un,Zt),pn=Ye%2?l.EXTENT-1:0;Te.x=at(li[0],Math.min(l.EXTENT-1,li[1]),pn,Ye<2,li[2]),Te.y=0,g.encodeCentroid(Te,un,!1),rn&&nt.encodeCentroid(Te,Zt,!1)}else g.encodeCentroid(void 0,un,!1)}g.borderDoneWithNeighborZ[Ye]=nt.canonical.z,g.needsCentroidUpdate=!0,rn&&(nt.borderDoneWithNeighborZ[rt]=g.canonical.z,nt.needsCentroidUpdate=!0)}else{for(const hn of ot)g.encodeCentroid(void 0,g.featuresOnBorder[hn],!1);if(rn){for(const hn of bt)nt.encodeCentroid(void 0,nt.featuresOnBorder[hn],!1);nt.borderDoneWithNeighborZ[rt]=g.canonical.z,nt.needsCentroidUpdate=!0}g.borderDoneWithNeighborZ[Ye]=nt.canonical.z,g.needsCentroidUpdate=!0}}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&0!==g.centroidVertexArray.length)&&g.uploadCentroid(p)}const ir=new l.Color(1,0,0,1),Cr=new l.Color(0,1,0,1),Ar=new l.Color(0,0,1,1),fo=new l.Color(1,0,1,1),Lo=new l.Color(0,1,1,1);function Zn(p,t,c,g){oa(p,0,t+c/2,p.transform.width,c,g)}function Qo(p,t,c,g){oa(p,t-c/2,0,c,p.transform.height,g)}function oa(p,t,c,g,b,C){const I=p.context,S=I.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*l.exported.devicePixelRatio,c*l.exported.devicePixelRatio,g*l.exported.devicePixelRatio,b*l.exported.devicePixelRatio),I.clear({color:C}),S.disable(S.SCISSOR_TEST)}function pc(p,t,c){const g=p.context,b=g.gl,C="globe"===p.transform.projection.name,I=c.projMatrix,S=p.useProgram("debug",null,C?["PROJECTION_GLOBE_VIEW"]:null),U=t.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(U,S);const q=l.DepthMode.disabled,J=l.StencilMode.disabled,ae=p.colorModeForRenderPass();g.activeTexture.set(b.TEXTURE0),p.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),C?U._makeGlobeTileDebugBuffers(p.context,p.transform.projection):U._makeDebugTileBoundsBuffers(p.context,p.transform.projection);const Ve=U._tileDebugBuffer||p.debugBuffer,Oe=U._tileDebugIndexBuffer||p.debugIndexBuffer,xe=U._tileDebugSegments||p.debugSegments;S.draw(g,b.LINE_STRIP,q,J,ae,l.CullFaceMode.disabled,ml(I,l.Color.red),"$debug",Ve,Oe,xe,null,null,null,U._globeTileDebugBorderBuffer);const at=U.latestRawTileData,Ye=Math.floor((at&&at.byteLength||0)/1024),rt=t.getTile(c).tileSize,ot=512/Math.min(rt,512)*(c.overscaledZ/p.transform.zoom)*.5;let mt=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(mt+=` => ${c.overscaledZ}`),function(rn,hn){rn.initDebugOverlayCanvas();const un=rn.debugOverlayCanvas,Un=rn.context.gl,Zt=rn.debugOverlayCanvas.getContext("2d");Zt.clearRect(0,0,un.width,un.height),Zt.shadowColor="white",Zt.shadowBlur=2,Zt.lineWidth=1.5,Zt.strokeStyle="white",Zt.textBaseline="top",Zt.font="bold 36px Open Sans, sans-serif",Zt.fillText(hn,5,5),Zt.strokeText(hn,5,5),rn.debugOverlayTexture.update(un),rn.debugOverlayTexture.bind(Un.LINEAR,Un.CLAMP_TO_EDGE)}(p,`${mt} ${Ye}kb`);const nt=U._tileDebugTextBuffer||p.debugBuffer,bt=U._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Jt=U._tileDebugTextSegments||p.debugSegments;S.draw(g,b.TRIANGLES,q,J,l.ColorMode.alphaBlended,l.CullFaceMode.disabled,ml(I,l.Color.transparent,ot),"$debug",nt,bt,Jt,null,null,null,U._globeTileDebugTextBuffer)}const Ea=l.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Da}=Ea;function sa(p,t,c,g){p.emplaceBack(t,c,g)}class Do{constructor(t){this.vertexArray=new l.StructArrayLayout3f12,this.indices=new l.StructArrayLayout3ui6,sa(this.vertexArray,-1,-1,1),sa(this.vertexArray,1,-1,1),sa(this.vertexArray,-1,1,1),sa(this.vertexArray,1,1,1),sa(this.vertexArray,-1,-1,-1),sa(this.vertexArray,1,-1,-1),sa(this.vertexArray,-1,1,-1),sa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Da),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=l.SegmentVector.simpleSegment(0,0,36,12)}}function Fo(p,t,c,g,b,C){const I=p.gl,S=t.paint.get("sky-atmosphere-color"),U=t.paint.get("sky-atmosphere-halo-color"),q=t.paint.get("sky-atmosphere-sun-intensity"),J={u_matrix_3f:l.fromMat4(l.create$1(),g),u_sun_direction:b,u_sun_intensity:q,u_color_tint_r:[(Oe=S).r,Oe.g,Oe.b,Oe.a],u_color_tint_m:[(xe=U).r,xe.g,xe.b,xe.a],u_luminance:5e-5};var Oe,xe;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+C,t.skyboxTexture,0),c.draw(p,I.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.frontCW,J,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}function kr(p,t){return l.transformMat4(p,p,t)}const fc={symbol:function(p,t,c,g,b){if("translucent"!==p.renderPass)return;const C=l.StencilMode.disabled,I=p.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(S,U,q,J,ae,Te,Ve){const Oe=U.transform,xe="map"===ae,at="map"===Te;for(const Ye of S){const rt=J.getTile(Ye),ot=rt.getBucket(q);if(!ot||ot.projection!==Oe.projection.name||!ot.text||!ot.text.segments.get().length)continue;const mt=l.evaluateSizeForZoom(ot.textSizeData,Oe.zoom),nt=U.transform.calculatePixelsToTileUnitsMatrix(rt),bt=$r(Ye.projMatrix,rt.tileID.canonical,at,xe,U.transform,nt),Jt="none"!==q.layout.get("icon-text-fit")&&ot.hasIconData();if(mt){const rn=Math.pow(2,Oe.zoom-rt.tileID.overscaledZ);j(ot,xe,at,Ve,l.symbolSize,Oe,bt,Ye,rn,mt,Jt,Oe.projection)}}}(g,p,c,t,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),b),0!==c.paint.get("icon-opacity").constantOr(1)&&Pt(p,t,c,g,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),C,I),0!==c.paint.get("text-opacity").constantOr(1)&&Pt(p,t,c,g,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),C,I),t.map.showCollisionBoxes&&(E(p,t,c,g,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),E(p,t,c,g,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,t,c,g){if("translucent"!==p.renderPass)return;const b=c.paint.get("circle-opacity"),C=c.paint.get("circle-stroke-width"),I=c.paint.get("circle-stroke-opacity"),S=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===b.constantOr(1)&&(0===C.constantOr(1)||0===I.constantOr(1)))return;const U=p.context,q=U.gl,J=p.transform,ae=p.depthModeForSublayer(0,l.DepthMode.ReadOnly),Te=l.StencilMode.disabled,Ve=p.colorModeForRenderPass(),Oe="globe"===J.projection.name,xe=[l.mercatorXfromLng(J.center.lng),l.mercatorYfromLat(J.center.lat)],at=[];for(let rt=0;rt<g.length;rt++){const ot=g[rt],mt=t.getTile(ot),nt=mt.getBucket(c);if(!nt)continue;const bt=nt.programConfigurations.get(c.id),Jt=fl(c);Oe&&Jt.push("PROJECTION_GLOBE_VIEW");const rn=p.useProgram("circle",bt,Jt),hn=nt.layoutVertexBuffer,un=nt.globeExtVertexBuffer,Un=nt.indexBuffer,Zt=J.projection.createInversionMatrix(J,ot.canonical),Vn={programConfiguration:bt,program:rn,layoutVertexBuffer:hn,globeExtVertexBuffer:un,indexBuffer:Un,uniformValues:ks(p,ot,mt,Zt,xe,c),tile:mt};if(S){const Bn=nt.segments.get();for(const li of Bn)at.push({segments:new l.SegmentVector([li]),sortKey:li.sortKey,state:Vn})}else at.push({segments:nt.segments,sortKey:0,state:Vn})}S&&at.sort((rt,ot)=>rt.sortKey-ot.sortKey);const Ye={useDepthForOcclusion:!Oe};for(const rt of at){const{programConfiguration:ot,program:mt,layoutVertexBuffer:nt,globeExtVertexBuffer:bt,indexBuffer:Jt,uniformValues:rn,tile:hn}=rt.state,un=rt.segments;p.terrain&&p.terrain.setupElevationDraw(hn,mt,Ye),p.prepareDrawProgram(U,mt,hn.tileID.toUnwrapped()),mt.draw(U,q.TRIANGLES,ae,Te,Ve,l.CullFaceMode.disabled,rn,c.id,nt,Jt,un,c.paint,J.zoom,ot,Oe?bt:null)}},heatmap:function(p,t,c,g){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const b=p.context,C=b.gl,I=l.StencilMode.disabled,S=new l.ColorMode([C.ONE,C.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(Te,Ve,Oe){const xe=Te.gl;Te.activeTexture.set(xe.TEXTURE1),Te.viewport.set([0,0,Ve.width/4,Ve.height/4]);let at=Oe.heatmapFbo;if(at)xe.bindTexture(xe.TEXTURE_2D,at.colorAttachment.get()),Te.bindFramebuffer.set(at.framebuffer);else{const Ye=xe.createTexture();xe.bindTexture(xe.TEXTURE_2D,Ye),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MAG_FILTER,xe.LINEAR),at=Oe.heatmapFbo=Te.createFramebuffer(Ve.width/4,Ve.height/4,!1),function(rt,ot,mt,nt){const bt=rt.gl;bt.texImage2D(bt.TEXTURE_2D,0,bt.RGBA,ot.width/4,ot.height/4,0,bt.RGBA,rt.extRenderToTextureHalfFloat?rt.extTextureHalfFloat.HALF_FLOAT_OES:bt.UNSIGNED_BYTE,null),nt.colorAttachment.set(mt)}(Te,Ve,Ye,at)}})(b,p,c),b.clear({color:l.Color.transparent});const U=p.transform,q="globe"===U.projection.name,J=q?["PROJECTION_GLOBE_VIEW"]:null,ae=[l.mercatorXfromLng(U.center.lng),l.mercatorYfromLat(U.center.lat)];for(let Te=0;Te<g.length;Te++){const Ve=g[Te];if(t.hasRenderableParent(Ve))continue;const Oe=t.getTile(Ve),xe=Oe.getBucket(c);if(!xe)continue;const at=xe.programConfigurations.get(c.id),Ye=p.useProgram("heatmap",at,J),{zoom:rt}=p.transform;p.terrain&&p.terrain.setupElevationDraw(Oe,Ye),p.prepareDrawProgram(b,Ye,Ve.toUnwrapped());const ot=U.projection.createInversionMatrix(U,Ve.canonical);Ye.draw(b,C.TRIANGLES,l.DepthMode.disabled,I,S,l.CullFaceMode.disabled,dc(p,Ve,Oe,ot,ae,rt,c.paint.get("heatmap-intensity")),c.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,c.paint,p.transform.zoom,at,q?xe.globeExtVertexBuffer:null)}b.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(b,C){const I=b.context,S=I.gl,U=C.heatmapFbo;if(!U)return;I.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,U.colorAttachment.get()),I.activeTexture.set(S.TEXTURE1);let q=C.colorRampTexture;q||(q=C.colorRampTexture=new l.Texture(I,C.colorRamp,S.RGBA)),q.bind(S.LINEAR,S.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(I,S.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,b.colorModeForRenderPass(),l.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")},C.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,C.paint,b.transform.zoom)}(p,c))},line:function(p,t,c,g){if("translucent"!==p.renderPass)return;const b=c.paint.get("line-opacity"),C=c.paint.get("line-width");if(0===b.constantOr(1)||0===C.constantOr(1))return;const I=p.depthModeForSublayer(0,l.DepthMode.ReadOnly),S=p.colorModeForRenderPass(),U=p.terrain&&p.terrain.renderingToTexture?1:l.exported.devicePixelRatio,q=c.paint.get("line-dasharray"),J=q.constantOr(1),ae=c.layout.get("line-cap"),Te=c.paint.get("line-pattern"),Ve=Te.constantOr(1),Oe=c.paint.get("line-gradient"),xe=c.getCrossfadeParameters(),at=Ve?"linePattern":"line",Ye=p.context,rt=Ye.gl,ot=(nt=>{const bt=[];ro(nt)&&bt.push("RENDER_LINE_DASH"),nt.paint.get("line-gradient")&&bt.push("RENDER_LINE_GRADIENT");const Jt=nt.paint.get("line-pattern").constantOr(1),rn=1!==nt.paint.get("line-opacity").constantOr(1);return!Jt&&rn&&bt.push("RENDER_LINE_ALPHA_DISCARD"),bt})(c);let mt=ot.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(mt=!1);for(const nt of g){const bt=t.getTile(nt);if(Ve&&!bt.patternsLoaded())continue;const Jt=bt.getBucket(c);if(!Jt)continue;p.prepareDrawTile();const rn=Jt.programConfigurations.get(c.id),hn=p.useProgram(at,rn,ot),un=Te.constantOr(null);if(un&&bt.imageAtlas){const pn=bt.imageAtlas,ci=pn.patternPositions[un.to.toString()],Ti=pn.patternPositions[un.from.toString()];ci&&Ti&&rn.setConstantPatternPositions(ci,Ti)}const Un=q.constantOr(null),Zt=ae.constantOr(null);if(!Ve&&Un&&Zt&&bt.lineAtlas){const pn=bt.lineAtlas,ci=pn.getDash(Un.to,Zt),Ti=pn.getDash(Un.from,Zt);ci&&Ti&&rn.setConstantPatternPositions(ci,Ti)}const Vn=p.terrain?nt.projMatrix:null,Bn=Ve?Pn(p,bt,c,xe,Vn,U):hc(p,bt,c,xe,Vn,Jt.lineClipsArray.length,U);if(Oe){const pn=Jt.gradients[c.id];let ci=pn.texture;if(c.gradientVersion!==pn.version){let Ti=256;if(c.stepInterpolant){const ui=t.getSource().maxzoom,si=nt.canonical.z===ui?Math.ceil(1<<p.transform.maxZoom-nt.canonical.z):1;Ti=l.clamp(l.nextPowerOfTwo(Jt.maxLineLength/l.EXTENT*1024*si),256,Ye.maxTextureSize)}pn.gradient=l.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Ti,image:pn.gradient||void 0,clips:Jt.lineClipsArray}),pn.texture?pn.texture.update(pn.gradient):pn.texture=new l.Texture(Ye,pn.gradient,rt.RGBA),pn.version=c.gradientVersion,ci=pn.texture}Ye.activeTexture.set(rt.TEXTURE1),ci.bind(c.stepInterpolant?rt.NEAREST:rt.LINEAR,rt.CLAMP_TO_EDGE)}J&&(Ye.activeTexture.set(rt.TEXTURE0),bt.lineAtlasTexture.bind(rt.LINEAR,rt.REPEAT),rn.updatePaintBuffers(xe)),Ve&&(Ye.activeTexture.set(rt.TEXTURE0),bt.imageAtlasTexture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE),rn.updatePaintBuffers(xe)),p.prepareDrawProgram(Ye,hn,nt.toUnwrapped());const li=pn=>{hn.draw(Ye,rt.TRIANGLES,I,pn,S,l.CullFaceMode.disabled,Bn,c.id,Jt.layoutVertexBuffer,Jt.indexBuffer,Jt.segments,c.paint,p.transform.zoom,rn,Jt.layoutVertexBuffer2)};if(mt){const pn=p.stencilModeForClipping(nt).ref;0===pn&&p.terrain&&Ye.clear({stencil:0});const ci={func:rt.EQUAL,mask:255};Bn.u_alpha_discard_threshold=.8,li(new l.StencilMode(ci,pn,255,rt.KEEP,rt.KEEP,rt.INVERT)),Bn.u_alpha_discard_threshold=0,li(new l.StencilMode(ci,pn,255,rt.KEEP,rt.KEEP,rt.KEEP))}else li(p.stencilModeForClipping(nt))}mt&&(p.resetStencilClippingMasks(),p.terrain&&Ye.clear({stencil:0}))},fill:function(p,t,c,g){const b=c.paint.get("fill-color"),C=c.paint.get("fill-opacity");if(0===C.constantOr(1))return;const I=p.colorModeForRenderPass(),S=c.paint.get("fill-pattern"),U=p.opaquePassEnabledForLayer()&&!S.constantOr(1)&&1===b.constantOr(l.Color.transparent).a&&1===C.constantOr(0)?"opaque":"translucent";if(p.renderPass===U){const q=p.depthModeForSublayer(1,"opaque"===p.renderPass?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly);Yn(p,t,c,g,q,I,!1)}if("translucent"===p.renderPass&&c.paint.get("fill-antialias")){const q=p.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,l.DepthMode.ReadOnly);Yn(p,t,c,g,q,I,!0)}},"fill-extrusion":function(p,t,c,g){const b=c.paint.get("fill-extrusion-opacity");if(0!==b&&"translucent"===p.renderPass){const C=new l.DepthMode(p.context.gl.LEQUAL,l.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==b||c.paint.get("fill-extrusion-pattern").constantOr(1))Li(p,t,c,g,C,l.StencilMode.disabled,l.ColorMode.disabled),Li(p,t,c,g,C,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const I=p.colorModeForRenderPass();Li(p,t,c,g,C,l.StencilMode.disabled,I)}}},hillshade:function(p,t,c,g){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const b=p.context,C=p.depthModeForSublayer(0,l.DepthMode.ReadOnly),I=p.colorModeForRenderPass(),S=p.terrain&&p.terrain.renderingToTexture,[U,q]="translucent"!==p.renderPass||S?[{},g]:p.stencilConfigForOverlap(g);for(const J of q){const ae=t.getTile(J);if(ae.needsHillshadePrepare&&"offscreen"===p.renderPass)_a(p,ae,c,C,l.StencilMode.disabled,I);else if("translucent"===p.renderPass){const Te=S&&p.terrain?p.terrain.stencilModeForRTTOverlap(J):U[J.overscaledZ];Po(p,J,ae,c,C,Te,I)}}b.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,t,c,g,b,C){if("translucent"!==p.renderPass||0===c.paint.get("raster-opacity")||!g.length)return;const I=p.context,S=I.gl,U=t.getSource(),q=p.useProgram("raster"),J=p.colorModeForRenderPass(),ae=p.terrain&&p.terrain.renderingToTexture,[Te,Ve]=U instanceof $e||ae?[{},g]:p.stencilConfigForOverlap(g),Oe=Ve[Ve.length-1].overscaledZ,xe=!p.options.moving;for(const at of Ve){const Ye=ae?l.DepthMode.disabled:p.depthModeForSublayer(at.overscaledZ-Oe,1===c.paint.get("raster-opacity")?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly,S.LESS),rt=at.toUnwrapped(),ot=t.getTile(at);if(ae&&(!ot||!ot.hasData()))continue;const mt=ae?at.projMatrix:p.transform.calculateProjMatrix(rt,xe),nt=p.terrain&&ae?p.terrain.stencilModeForRTTOverlap(at):Te[at.overscaledZ],bt=C?0:c.paint.get("raster-fade-duration");ot.registerFadeDuration(bt);const Jt=t.findLoadedParent(at,0),rn=Jn(ot,Jt,t,p.transform,bt);let hn,un;p.terrain&&p.terrain.prepareDrawTile();const Un="nearest"===c.paint.get("raster-resampling")?S.NEAREST:S.LINEAR;I.activeTexture.set(S.TEXTURE0),ot.texture.bind(Un,S.CLAMP_TO_EDGE),I.activeTexture.set(S.TEXTURE1),Jt?(Jt.texture.bind(Un,S.CLAMP_TO_EDGE),hn=Math.pow(2,Jt.tileID.overscaledZ-ot.tileID.overscaledZ),un=[ot.tileID.canonical.x*hn%1,ot.tileID.canonical.y*hn%1]):ot.texture.bind(Un,S.CLAMP_TO_EDGE);const Zt=gl(mt,un||[0,0],hn||1,rn,c,U instanceof $e?U.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(I,q,rt),U instanceof $e)U.boundsBuffer&&U.boundsSegments&&q.draw(I,S.TRIANGLES,Ye,l.StencilMode.disabled,J,l.CullFaceMode.disabled,Zt,c.id,U.boundsBuffer,p.quadTriangleIndexBuffer,U.boundsSegments);else{const{tileBoundsBuffer:Vn,tileBoundsIndexBuffer:Bn,tileBoundsSegments:li}=p.getTileBoundsBuffers(ot);q.draw(I,S.TRIANGLES,Ye,nt,J,l.CullFaceMode.disabled,Zt,c.id,Vn,Bn,li)}}p.resetStencilClippingMasks()},background:function(p,t,c,g){const b=c.paint.get("background-color"),C=c.paint.get("background-opacity");if(0===C)return;const I=p.context,S=I.gl,U=p.transform,q=U.tileSize,J=c.paint.get("background-pattern");if(p.isPatternMissing(J))return;const ae=!J&&1===b.a&&1===C&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==ae)return;const Te=l.StencilMode.disabled,Ve=p.depthModeForSublayer(0,"opaque"===ae?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly),Oe=p.colorModeForRenderPass(),xe=p.useProgram(J?"backgroundPattern":"background");let at,Ye=g;Ye||(at=p.getBackgroundTiles(),Ye=Object.values(at).map(ot=>ot.tileID)),J&&(I.activeTexture.set(S.TEXTURE0),p.imageManager.bind(p.context));const rt=c.getCrossfadeParameters();for(const ot of Ye){const mt=ot.toUnwrapped(),nt=g?ot.projMatrix:p.transform.calculateProjMatrix(mt);p.prepareDrawTile();const bt=t?t.getTile(ot):at?at[ot.key]:new l.Tile(ot,q,U.zoom,p),Jt=J?Nl(nt,C,p,J,{tileID:ot,tileSize:q},rt):zl(nt,C,b);p.prepareDrawProgram(I,xe,mt);const{tileBoundsBuffer:rn,tileBoundsIndexBuffer:hn,tileBoundsSegments:un}=p.getTileBoundsBuffers(bt);xe.draw(I,S.TRIANGLES,Ve,Te,Oe,l.CullFaceMode.disabled,Jt,c.id,rn,hn,un)}},sky:function(p,t,c){const g=p.transform,b="mercator"===g.projection.name||"globe"===g.projection.name?1:l.smoothstep(7,8,g.zoom),C=c.paint.get("sky-opacity")*b;if(0===C)return;const I=p.context,S=c.paint.get("sky-type"),U=new l.DepthMode(I.gl.LEQUAL,l.DepthMode.ReadOnly,[0,1]),q=p.frameCounter/1e3%1;"atmosphere"===S?"offscreen"===p.renderPass?c.needsSkyboxCapture(p)&&(function(J,ae,Te,Ve){const Oe=J.context,xe=Oe.gl;let at=ae.skyboxFbo;if(!at){at=ae.skyboxFbo=Oe.createFramebuffer(32,32,!1),ae.skyboxGeometry=new Do(Oe),ae.skyboxTexture=Oe.gl.createTexture(),xe.bindTexture(xe.TEXTURE_CUBE_MAP,ae.skyboxTexture),xe.texParameteri(xe.TEXTURE_CUBE_MAP,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_CUBE_MAP,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_CUBE_MAP,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_CUBE_MAP,xe.TEXTURE_MAG_FILTER,xe.LINEAR);for(let mt=0;mt<6;++mt)xe.texImage2D(xe.TEXTURE_CUBE_MAP_POSITIVE_X+mt,0,xe.RGBA,32,32,0,xe.RGBA,xe.UNSIGNED_BYTE,null)}Oe.bindFramebuffer.set(at.framebuffer),Oe.viewport.set([0,0,32,32]);const Ye=ae.getCenter(J,!0),rt=J.useProgram("skyboxCapture"),ot=new Float64Array(16);l.identity(ot),l.rotateY(ot,ot,.5*-Math.PI),Fo(Oe,ae,rt,ot,Ye,0),l.identity(ot),l.rotateY(ot,ot,.5*Math.PI),Fo(Oe,ae,rt,ot,Ye,1),l.identity(ot),l.rotateX(ot,ot,.5*-Math.PI),Fo(Oe,ae,rt,ot,Ye,2),l.identity(ot),l.rotateX(ot,ot,.5*Math.PI),Fo(Oe,ae,rt,ot,Ye,3),l.identity(ot),Fo(Oe,ae,rt,ot,Ye,4),l.identity(ot),l.rotateY(ot,ot,Math.PI),Fo(Oe,ae,rt,ot,Ye,5),Oe.viewport.set([0,0,J.width,J.height])}(p,c),c.markSkyboxValid(p)):"sky"===p.renderPass&&function(J,ae,Te,Ve,Oe){const xe=J.context,at=xe.gl,Ye=J.transform,rt=J.useProgram("skybox");xe.activeTexture.set(at.TEXTURE0),at.bindTexture(at.TEXTURE_CUBE_MAP,ae.skyboxTexture);const ot={u_matrix:Ye.skyboxMatrix,u_sun_direction:ae.getCenter(J,!1),u_cubemap:0,u_opacity:Ve,u_temporal_offset:Oe};J.prepareDrawProgram(xe,rt),rt.draw(xe,at.TRIANGLES,Te,l.StencilMode.disabled,J.colorModeForRenderPass(),l.CullFaceMode.backCW,ot,"skybox",ae.skyboxGeometry.vertexBuffer,ae.skyboxGeometry.indexBuffer,ae.skyboxGeometry.segment)}(p,c,U,C,q):"gradient"===S&&"sky"===p.renderPass&&function(J,ae,Te,Ve,Oe){const xe=J.context,at=xe.gl,Ye=J.transform,rt=J.useProgram("skyboxGradient");ae.skyboxGeometry||(ae.skyboxGeometry=new Do(xe)),xe.activeTexture.set(at.TEXTURE0);let ot=ae.colorRampTexture;ot||(ot=ae.colorRampTexture=new l.Texture(xe,ae.colorRamp,at.RGBA)),ot.bind(at.LINEAR,at.CLAMP_TO_EDGE);const mt=(nt=Ye.skyboxMatrix,bt=ae.getCenter(J,!1),Jt=ae.paint.get("sky-gradient-radius"),rn=Ve,hn=Oe,{u_matrix:nt,u_color_ramp:0,u_center_direction:bt,u_radius:l.degToRad(Jt),u_opacity:rn,u_temporal_offset:hn});var nt,bt,Jt,rn,hn;J.prepareDrawProgram(xe,rt),rt.draw(xe,at.TRIANGLES,Te,l.StencilMode.disabled,J.colorModeForRenderPass(),l.CullFaceMode.backCW,mt,"skyboxGradient",ae.skyboxGeometry.vertexBuffer,ae.skyboxGeometry.indexBuffer,ae.skyboxGeometry.segment)}(p,c,U,C,q)},debug:function(p,t,c){for(let g=0;g<c.length;g++)pc(p,t,c[g])},custom:function(p,t,c){const g=p.context,b=c.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))l.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===p.renderPass){const C=b.prerender;C&&(p.setCustomLayerDefaults(),g.setColorMode(p.colorModeForRenderPass()),C.call(b,g.gl,p.transform.customLayerMatrix()),g.setDirty(),p.setBaseState())}else if("translucent"===p.renderPass){p.setCustomLayerDefaults(),g.setColorMode(p.colorModeForRenderPass()),g.setStencilMode(l.StencilMode.disabled);const C="3d"===b.renderingMode?new l.DepthMode(p.context.gl.LEQUAL,l.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,l.DepthMode.ReadOnly);g.setDepthMode(C),b.render(g.gl,p.transform.customLayerMatrix()),g.setDirty(),p.setBaseState(),g.bindFramebuffer.set(null)}}};class Zc{constructor(t,c){this.context=new L(t),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=l.SourceCache.maxUnderzooming+l.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ko,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(t,c){const g=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new xr(this,t));const b=this._terrain;this.transform.elevation=g?b:null,b.update(t,this.transform,c)}_updateFog(t){const c=t.fog;if(!c||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,b]=c.getFovAdjustedRange(this.transform._fov);if(g>b)return void(this.transform.fogCullDistSq=null);const C=g+.78*(b-g);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,c){if(this.width=t*l.exported.devicePixelRatio,this.height=c*l.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const t=this.context,c=new l.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(l.EXTENT,0),c.emplaceBack(0,l.EXTENT),c.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(c,l.posAttributes.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const g=new l.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(l.EXTENT,0),g.emplaceBack(0,l.EXTENT),g.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=t.createVertexBuffer(g,l.posAttributes.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const b=new l.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(b,l.posAttributes.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const C=new l.StructArrayLayout4i8;C.emplaceBack(0,0,0,0),C.emplaceBack(l.EXTENT,0,l.EXTENT,0),C.emplaceBack(0,l.EXTENT,0,l.EXTENT),C.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(C,l.boundsAttributes.members),this.mercatorBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const I=new l.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(I);const S=new l.StructArrayLayout1ui2;for(const q of[0,1,3,2,0])S.emplaceBack(q);this.debugIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new l.Texture(t,new l.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=l.create();const U=this.context.gl;this.stencilClearMode=new l.StencilMode({func:U.ALWAYS,mask:0},0,255,U.ZERO,U.ZERO,U.ZERO),this.loadTimeStamps.push(l.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,c=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(t,c.TRIANGLES,l.DepthMode.disabled,this.stencilClearMode,l.ColorMode.disabled,l.CullFaceMode.disabled,kn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(t,c,g){if(!c||this.currentStencilSource===c.id||!t.isTileClipped()||!g||0===g.length)return;const b=[];let C=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const J of g)if(this._tileClippingMaskIDs.has(J.key)||(C=!0),this._skippedStencilTileIDs.has(J.key)){if(!c.getTile(J).getBucket(t))continue;this._skippedStencilTileIDs.delete(J.key),b.push(J)}if(!C&&0===b.length)return}const I=this.context,S=I.gl;I.setColorMode(l.ColorMode.disabled),I.setDepthMode(l.DepthMode.disabled);const U=this.useProgram("clippingMask"),q=J=>{const ae=c.getTile(J),{tileBoundsBuffer:Te,tileBoundsIndexBuffer:Ve,tileBoundsSegments:Oe}=this.getTileBoundsBuffers(ae);U.draw(I,S.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:S.GREATER,mask:255},this._tileClippingMaskIDs.get(J.key)||0,255,S.KEEP,S.KEEP,S.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,kn(J.projMatrix),"$clipping",Te,Ve,Oe)};if(!C&&b.length>0)for(const J of b)q(J);else{(0===this._tileClippingMaskIDs.size||this.nextStencilID+g.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const J of g)this._tileClippingMaskIDs.set(J.key,this.nextStencilID++),c.getTile(J).getBucket(t)?q(J):this._skippedStencilTileIDs.add(J.key)}0===this._skippedStencilTileIDs.size&&(this.currentStencilSource=c.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,c=this.context.gl;return new l.StencilMode({func:c.NOTEQUAL,mask:255},t,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const c=this.context.gl;return new l.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs.get(t.key)||0,0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(t){const c=this.context.gl,g=t.sort((I,S)=>S.overscaledZ-I.overscaledZ),b=g[g.length-1].overscaledZ,C=g[0].overscaledZ-b+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const I={};for(let S=0;S<C;S++)I[S+b]=new l.StencilMode({func:c.GEQUAL,mask:255},S+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=C,[I,g]}return[{[b]:l.StencilMode.disabled},g]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new l.ColorMode([t.CONSTANT_COLOR,t.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?l.ColorMode.unblended:l.ColorMode.alphaBlended}depthModeForSublayer(t,c,g){if(!this.opaquePassEnabledForLayer())return l.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new l.DepthMode(g||this.context.gl.LEQUAL,c,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,c){this.style=t,this.options=c,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const g=this.style.order,b=this.style._sourceCaches;for(const q in b){const J=b[q];J.used&&J.prepare(this.context)}const C={},I={},S={};for(const q in b){const J=b[q];C[q]=J.getVisibleCoordinates(),I[q]=C[q].slice().reverse(),S[q]=J.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let q=0;q<g.length;q++)if(this.style._layers[g[q]].is3D()){this.opaquePassCutoff=q;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new l.GlobeSharedBuffers(this.context)),!l.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const q of g){const J=this.style._layers[q],ae=t._getLayerSourceCache(J);if(!J.hasOffscreenPass()||J.isHidden(this.transform.zoom))continue;const Te=ae?I[ae.id]:void 0;("custom"===J.type||J.isSky()||Te&&Te.length)&&this.renderLayer(this,ae,J,Te)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let U=l.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(U=this.style.fog.properties.get("color")),this.context.clear({color:c.showOverdrawInspector?l.Color.black:U,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const q=this.style._layers[g[this.currentLayer]],J=t._getLayerSourceCache(q);if(q.isSky())continue;const ae=J?I[J.id]:void 0;this._renderTileClippingMasks(q,J,ae),this.renderLayer(this,J,q,ae)}if(this.renderPass="sky",(l.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const q=this.style._layers[g[this.currentLayer]],J=t._getLayerSourceCache(q);q.isSky()&&this.renderLayer(this,J,q,J?I[J.id]:void 0)}for("globe"===this.transform.projection.name&&function(q){const J=q.context,ae=J.gl,Te=q.transform,Ve=new l.DepthMode(ae.LEQUAL,l.DepthMode.ReadOnly,[0,1]),Oe=q.useProgram("globeAtmosphere"),xe=Te.centerOffset,at=Te._camera.getCameraToClipPerspective(Te._fov,Te.width/Te.height,Te._nearZ,Te._farZ);at[8]=2*-xe.x/Te.width,at[9]=2*xe.y/Te.height;const Ye=l.invert([],at),rt=l.mul([],Ye,Te.projMatrix),ot={u_frustum_tl:kr([-1,1,1],Ye),u_frustum_tr:kr([1,1,1],Ye),u_frustum_br:kr([1,-1,1],Ye),u_frustum_bl:kr([-1,-1,1],Ye),u_globe_pos:kr([Te.globeMatrix[12],Te.globeMatrix[13],Te.globeMatrix[14]],rt),u_globe_radius:Te.worldSize/2/Math.PI-1,u_opacity:1-l.globeToMercatorTransition(Te.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};q.prepareDrawProgram(J,Oe);const mt=q.globeSharedBuffers;mt&&Oe.draw(J,ae.TRIANGLES,Ve,l.StencilMode.disabled,l.ColorMode.alphaBlended,l.CullFaceMode.backCW,ot,"skybox",mt.atmosphereVertexBuffer,mt.atmosphereIndexBuffer,mt.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const q=this.style._layers[g[this.currentLayer]],J=t._getLayerSourceCache(q);if(q.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(q)){if(q.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const ae=J?("symbol"===q.type?S:I)[J.id]:void 0;this._renderTileClippingMasks(q,J,J?C[J.id]:void 0),this.renderLayer(this,J,q,ae),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let q=null;l.values(this.style._layers).forEach(J=>{const ae=t._getLayerSourceCache(J);ae&&!J.isHidden(this.transform.zoom)&&(!q||q.getSource().maxzoom<ae.getSource().maxzoom)&&(q=ae)}),q&&this.options.showTileBoundaries&&fc.debug(this,q,q.getVisibleCoordinates())}this.options.showPadding&&function(q){const J=q.transform.padding;Zn(q,q.transform.height-(J.top||0),3,ir),Zn(q,J.bottom||0,3,Cr),Qo(q,J.left||0,3,Ar),Qo(q,q.transform.width-(J.right||0),3,fo);const ae=q.transform.centerPoint;var Te,Ve,Oe,xe;oa(Te=q,(Ve=ae.x)-1,(Oe=q.transform.height-ae.y)-10,2,20,xe=Lo),oa(Te,Ve-10,Oe-1,20,2,xe)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(l.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,c,g,b){g.isHidden(this.transform.zoom)||("background"===g.type||"sky"===g.type||"custom"===g.type||b&&b.length)&&(this.id=g.id,this.gpuTimingStart(g),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(g.type)||fc[g.type](t,c,g,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let g=this.gpuTimers[t.id];g||(g=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),g.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,g.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const c={};for(const g in t){const b=t[g],C=this.context.extTimerQuery,I=C.getQueryObjectEXT(b.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(b.query),c[g]=I}return c}translatePosMatrix(t,c,g,b,C){if(!g[0]&&!g[1])return t;const I=C?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(I){const q=Math.sin(I),J=Math.cos(I);g=[g[0]*J-g[1]*q,g[0]*q+g[1]*J]}const S=[C?g[0]:Bt(c,g[0],this.transform.zoom),C?g[1]:Bt(c,g[1],this.transform.zoom),0],U=new Float32Array(16);return l.translate(U,t,S),U}saveTileTexture(t){const c=this._tileTextures[t.size[0]];c?c.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const c=this._tileTextures[t];return c&&c.length>0?c.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const c=this.imageManager.getPattern(t.from.toString()),g=this.imageManager.getPattern(t.to.toString());return!c||!g}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,g=[];return this.terrain&&!this.terrain.renderingToTexture&&g.push("TERRAIN"),c&&!t&&0!==c.getOpacity(this.transform.pitch)&&g.push("FOG"),t&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(t,c,g){this.cache=this.cache||{};const b=g||[],C=this.currentGlobalDefines().concat(b),I=br.cacheKey(t,C,c);return this.cache[I]||(this.cache[I]=new br(this.context,t,Es[t],c,dr[t],C)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=l.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,c,g){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const C=b.getOpacity(this.transform.pitch);0!==C&&c.setFogUniformValues(t,((I,S,U,q)=>{const J=S.properties.get("color"),ae=I.frameCounter/1e3%1,Te=[J.r/J.a,J.g/J.a,J.b/J.a,q];return{u_fog_matrix:U?I.transform.calculateFogTileMatrix(U):I.identityMat,u_fog_range:S.getFovAdjustedRange(I.transform._fov),u_fog_color:Te,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:ae}})(this,b,g,C))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,c=t.createTexture();return t.bindTexture(t.TEXTURE_2D,c),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,c=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const b of g)c[b.key]=t[b.key]||new l.Tile(b,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class ya{constructor(t=0,c=0,g=0,b=0){if(isNaN(t)||t<0||isNaN(c)||c<0||isNaN(g)||g<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=c,this.left=g,this.right=b}interpolate(t,c,g){return null!=c.top&&null!=t.top&&(this.top=l.number(t.top,c.top,g)),null!=c.bottom&&null!=t.bottom&&(this.bottom=l.number(t.bottom,c.bottom,g)),null!=c.left&&null!=t.left&&(this.left=l.number(t.left,c.left,g)),null!=c.right&&null!=t.right&&(this.right=l.number(t.right,c.right,g)),this}getCenter(t,c){const g=l.clamp((this.left+t-this.right)/2,0,t),b=l.clamp((this.top+c-this.bottom)/2,0,c);return new l.pointGeometry(g,b)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ya(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Gc(p,t){const c=l.getColumn(p,3);l.fromQuat(p,t),l.setColumn(p,3,c)}function Ul(p,t){const c=l.identity$1([]);return l.rotateZ$1(c,c,-t),l.rotateX$1(c,c,-p),c}function Vl(p,t){const c=[p[0],p[1],0],g=[t[0],t[1],0];if(l.length(c)>=1e-15){const I=l.normalize([],c);l.scale$2(g,I,l.dot(g,I)),t[0]=g[0],t[1]=g[1]}const b=l.cross([],t,p);if(l.len(b)<1e-15)return null;const C=Math.atan2(-b[1],b[0]);return Ul(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),C)}class va{constructor(t,c){this.position=t,this.orientation=c}get position(){return this._position}set position(t){if(t){const c=t instanceof l.MercatorCoordinate?t:new l.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(c.x=l.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(t,c){if(this.orientation=null,!this.position)return;const g=this._elevation?this._elevation.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(t)):0,b=this.position,C=l.MercatorCoordinate.fromLngLat(t,g),I=[C.x-b.x,C.y-b.y,C.z-b.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Vl(I,c)}setPitchBearing(t,c){this.orientation=Ul(l.degToRad(t),l.degToRad(-c))}}class xo{constructor(t,c){this._transform=l.identity([]),this.orientation=c,this.position=t}get mercatorPosition(){const t=this.position;return new l.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=l.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var c;t&&l.setColumn(this._transform,3,[(c=t)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||l.identity$1([]),t&&Gc(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,c){this._orientation=Ul(t,c),Gc(this._transform,this._orientation)}forward(){const t=l.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=l.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=l.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,c){const g=new Float64Array(16);return l.invert(g,this.getWorldToCamera(t,c)),g}getWorldToCameraPosition(t,c,g){const b=this.position;l.scale$2(b,b,-t);const C=new Float64Array(16);return l.fromScaling(C,[g,g,g]),l.translate(C,C,b),C[10]*=c,C}getWorldToCamera(t,c){const g=new Float64Array(16),b=new Float64Array(4),C=this.position;return l.conjugate(b,this._orientation),l.scale$2(C,C,-t),l.fromQuat(g,b),l.translate(g,g,C),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=c,g[9]*=c,g[10]*=c,g[11]*=c,g}getCameraToClipPerspective(t,c,g,b){const C=new Float64Array(16);return l.perspective(C,t,c,g,b),C}getDistanceToElevation(t){const c=0===t?0:l.mercatorZfromAltitude(t,this.position[1]),g=this.forward();return(c-this.position[2])/g[2]}clone(){return new xo([...this.position],[...this.orientation])}}function Wa(p,t){const c=aa(p),g=function(C,I,S,U,q){const J=new l.LngLat(S.lng-180*qs,S.lat),ae=new l.LngLat(S.lng+180*qs,S.lat),Te=C.project(J.lng,J.lat),Ve=C.project(ae.lng,ae.lat),Oe=-Math.atan2(Ve.y-Te.y,Ve.x-Te.x),xe=l.MercatorCoordinate.fromLngLat(S);xe.y=l.clamp(xe.y,-.999975,.999975);const at=xe.toLngLat(),Ye=C.project(at.lng,at.lat),rt=l.MercatorCoordinate.fromLngLat(at);rt.x+=qs;const ot=rt.toLngLat(),mt=C.project(ot.lng,ot.lat),nt=Ia(mt.x-Ye.x,mt.y-Ye.y,Oe),bt=l.MercatorCoordinate.fromLngLat(at);bt.y+=qs;const Jt=bt.toLngLat(),rn=C.project(Jt.lng,Jt.lat),hn=Ia(rn.x-Ye.x,rn.y-Ye.y,Oe),un=Math.abs(nt.x)/Math.abs(hn.y),Un=l.identity([]);l.rotateZ(Un,Un,-Oe*(1-(q?0:U)));const Zt=l.identity([]);return l.scale(Zt,Zt,[1,1-(1-un)*U,1]),Zt[4]=-hn.x/hn.y*U,l.rotateZ(Zt,Zt,Oe),l.multiply$1(Zt,Un,Zt),Zt}(p.projection,0,p.center,c,t),b=Ya(p);return l.scale(g,g,[b,b,1]),g}function Ya(p){const t=p.projection,c=aa(p),g=es(t,p.center),b=es(t,l.LngLat.convert(t.center));return Math.pow(2,g*c+(1-c)*b)}function aa(p){const t=p.projection.range;if(!t)return 0;const c=Math.max(p.width,p.height),g=Math.log(c/1024)/Math.LN2;return l.smoothstep(t[0]+g,t[1]+g,p.zoom)}const qs=1/4e4;function es(p,t){const c=l.clamp(t.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),g=new l.LngLat(t.lng-180*qs,c),b=new l.LngLat(t.lng+180*qs,c),C=p.project(g.lng,c),I=p.project(b.lng,c),S=l.MercatorCoordinate.fromLngLat(g),U=l.MercatorCoordinate.fromLngLat(b),q=I.x-C.x,J=I.y-C.y,ae=U.x-S.x,Te=U.y-S.y,Ve=Math.sqrt((ae*ae+Te*Te)/(q*q+J*J));return Math.log(Ve)/Math.LN2}function Ia(p,t,c){const g=Math.cos(c),b=Math.sin(c);return{x:p*g-t*b,y:p*b+t*g}}class $l{constructor(t,c,g,b,C,I,S){this.tileSize=512,this._renderWorldCopies=void 0===C||C,this._minZoom=t||0,this._maxZoom=c||22,this._minPitch=g??0,this._maxPitch=b??60,this.setProjection(I),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ya,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new xo,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const t=new $l(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(t){const c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||c)&&this._updateCameraOnTerrain(),(t||c)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return l.pick(this.projection,["name","center","parallels"])}setProjection(t){null==t&&(t={name:"mercator"}),this.projectionOptions=t;const c=this.projection?this.getProjection():void 0;this.projection=l.getProjection(t);const g=this.getProjection();return ne(c,g)?null:(this._calcMatrices(),g)}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return l.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const c=-t*Math.PI/180;var g,b,C,I,S,U,q,J,ae,Te;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(g=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),b=this.rotationMatrix,I=this.angle,S=(C=this.rotationMatrix)[0],U=C[1],q=C[2],J=C[3],ae=Math.sin(I),Te=Math.cos(I),b[0]=S*Te+q*ae,b[1]=U*Te+J*ae,b[2]=S*-ae+q*Te,b[3]=U*-ae+J*Te)}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const c=l.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const c=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const t=this._elevation;this._centerAltitude=t.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=t.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let b=0,C=0;for(let I=0;I<c.length;I++){const S=new l.pointGeometry(c[I][0]*this.width,g+c[I][1]*(this.height-g)),U=t.pointCoordinate(S);if(!U)continue;const q=1/Math.hypot(U[0]-this._camera.position[0],U[1]-this._camera.position[1]);b+=U[3]*q,C+=q}return 0===C?NaN:b/C}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*c,b=this._mercatorZfromZoom(t),C=this._mercatorZfromZoom(this._maxZoom),I=Math.max(b-g,C);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let g;g=t.z<this._camera.position[2]?[c.x,c.y,c.z]:[t.x,t.y,t.z];const b=l.length(l.sub([],this._camera.position,g));return l.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let c=!1;if(t.orientation&&!l.exactEquals(t.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(t.orientation)),t.position){const g=[t.position.x,t.position.y,t.position.z];l.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,c=new va;return c.position=new l.MercatorCoordinate(t[0],t[1],t[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(t){if(!l.length$1(t))return!1;l.normalize$1(t,t);const c=l.transformQuat([],[0,0,-1],t),g=l.transformQuat([],[0,-1,0],t);if(g[2]<0)return!1;const b=Vl(c,g);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(t){const c=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;t[2]=l.clamp(t[2],b/g,b/c),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,c,g){this._unmodified=!1,this._edgeInsets.interpolate(t,c,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const c=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(t){const c=[new l.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const g=this.pointCoordinate(new l.pointGeometry(0,0)),b=this.pointCoordinate(new l.pointGeometry(this.width,0)),C=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),I=this.pointCoordinate(new l.pointGeometry(0,this.height)),S=Math.floor(Math.min(g.x,b.x,C.x,I.x)),U=Math.floor(Math.max(g.x,b.x,C.x,I.x)),q=1;for(let J=S-q;J<=U+q;J++)0!==J&&c.push(new l.UnwrappedTileID(J,t))}return c}coveringTiles(t){let c=this.coveringZoomLevel(t);const g=c,b=this.elevation&&!t.isTerrainDEM,C="mercator"===this.projection.name;if(void 0!==t.minzoom&&c<t.minzoom)return[];void 0!==t.maxzoom&&c>t.maxzoom&&(c=t.maxzoom);const I=this.locationCoordinate(this.center),S=this.center.lat,U=1<<c,q=[U*I.x,U*I.y,0],J="globe"===this.projection.name,ae=!J,Te=l.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,ae),Ve=J?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Oe=U*l.mercatorZfromAltitude(1,this.center.lat),xe=this._camera.position[2]/l.mercatorZfromAltitude(1,this.center.lat),at=[U*Ve.x,U*Ve.y,xe*(ae?1:Oe)],Ye=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),rt=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,ot=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,mt=t.isTerrainDEM?-ot:this._elevation?this._elevation.getMinElevationBelowMSL():0,nt=this.projection.isReprojectedInTileSpace?Ya(this):1,bt=pn=>{const Ti=new l.MercatorCoordinate(pn.x+25e-6,pn.y,pn.z),ui=new l.MercatorCoordinate(pn.x,pn.y+25e-6,pn.z),si=pn.toLngLat(),Ei=Ti.toLngLat(),qi=ui.toLngLat(),_i=this.locationCoordinate(si),Fi=this.locationCoordinate(Ei),hr=this.locationCoordinate(qi),no=Math.hypot(Fi.x-_i.x,Fi.y-_i.y),Bo=Math.hypot(hr.x-_i.x,hr.y-_i.y);return Math.sqrt(no*Bo)*nt/25e-6},Jt=pn=>{const ci=ot,Ti=mt;return{aabb:l.tileAABB(this,U,0,0,0,pn,Ti,ci,this.projection),zoom:0,x:0,y:0,minZ:Ti,maxZ:ci,wrap:pn,fullyVisible:!1}},rn=[];let hn=[];const un=c,Un=t.reparseOverscaled?g:c,Zt=pn=>pn*pn,Vn=Zt((xe-this._centerAltitude)*Oe),Bn=pn=>{if(!this._elevation||!pn.tileID||!C)return;const ci=this._elevation.getMinMaxForTile(pn.tileID),Ti=pn.aabb;ci?(Ti.min[2]=ci.min,Ti.max[2]=ci.max,Ti.center[2]=(Ti.min[2]+Ti.max[2])/2):(pn.shouldSplit=li(pn),pn.shouldSplit||(Ti.min[2]=Ti.max[2]=Ti.center[2]=this._centerAltitude))},li=pn=>{if(pn.zoom<rt)return!0;if(pn.zoom===un)return!1;if(null!=pn.shouldSplit)return pn.shouldSplit;const ci=pn.aabb.distanceX(at),Ti=pn.aabb.distanceY(at);let ui=Vn,si=1;if(J){ui=Zt(pn.aabb.distanceZ(at));const qi=Math.pow(2,pn.zoom),_i=l.latFromMercatorY((pn.y+1)/qi),Fi=l.latFromMercatorY(pn.y/qi),hr=Math.min(Math.max(S,_i),Fi),no=l.circumferenceAtLatitude(hr)/l.circumferenceAtLatitude(S);si=Math.min(no,1)}else if(b&&(ui=Zt(pn.aabb.distanceZ(at)*Oe)),this.projection.isReprojectedInTileSpace&&g<=5){const qi=Math.pow(2,pn.zoom),_i=bt(new l.MercatorCoordinate((pn.x+.5)/qi,(pn.y+.5)/qi));si=_i>.85?1:_i}const Ei=ci*ci+Ti*Ti+ui;return Ei<Zt((1<<un-pn.zoom)*Ye*si*((qi,_i)=>{if(_i*Zt(.707)<qi)return 1;const Fi=Math.sqrt(_i/qi);return Fi/(1.4144271570014144+(Math.pow(1.1,Fi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ui,Vn),Ei))};if(this.renderWorldCopies)for(let pn=1;pn<=3;pn++)rn.push(Jt(-pn)),rn.push(Jt(pn));for(rn.push(Jt(0));rn.length>0;){const pn=rn.pop(),ci=pn.x,Ti=pn.y;let ui=pn.fullyVisible;if(!ui){const si=pn.aabb.intersects(Te);if(0===si)continue;ui=2===si}if(pn.zoom!==un&&li(pn))for(let si=0;si<4;si++){const Ei=(ci<<1)+si%2,qi=(Ti<<1)+(si>>1),_i={aabb:C?pn.aabb.quadrant(si):l.tileAABB(this,U,pn.zoom+1,Ei,qi,pn.wrap,pn.minZ,pn.maxZ,this.projection),zoom:pn.zoom+1,x:Ei,y:qi,wrap:pn.wrap,fullyVisible:ui,tileID:void 0,shouldSplit:void 0,minZ:pn.minZ,maxZ:pn.maxZ};b&&!J&&(_i.tileID=new l.OverscaledTileID(pn.zoom+1===un?Un:pn.zoom+1,pn.wrap,pn.zoom+1,Ei,qi),Bn(_i)),rn.push(_i)}else{const si=pn.zoom===un?Un:pn.zoom;if(t.minzoom&&t.minzoom>si)continue;const Ei=q[0]-(.5+ci+(pn.wrap<<pn.zoom))*(1<<c-pn.zoom),qi=q[1]-.5-Ti,_i=pn.tileID?pn.tileID:new l.OverscaledTileID(si,pn.wrap,pn.zoom,ci,Ti);hn.push({tileID:_i,distanceSq:Ei*Ei+qi*qi})}}if(this.fogCullDistSq){const pn=this.fogCullDistSq,ci=this.horizonLineFromTop();hn=hn.filter(Ti=>{const ui=[0,0,0,1],si=[l.EXTENT,l.EXTENT,0,1],Ei=this.calculateFogTileMatrix(Ti.tileID.toUnwrapped());l.transformMat4$1(ui,ui,Ei),l.transformMat4$1(si,si,Ei);const qi=l.getAABBPointSquareDist(ui,si);if(0===qi)return!0;let _i=!1;const Fi=this._elevation;if(Fi&&qi>pn&&0!==ci){const hr=this.calculateProjMatrix(Ti.tileID.toUnwrapped());let no;t.isTerrainDEM||(no=Fi.getMinMaxForTile(Ti.tileID)),no||(no={min:mt,max:ot});const Bo=l.furthestTileCorner(this.rotation),ts=[Bo[0]*l.EXTENT,Bo[1]*l.EXTENT,no.max];l.transformMat4(ts,ts,hr),_i=(1-ts[1])*this.height*.5<ci}return qi<pn||_i})}return hn.sort((pn,ci)=>pn.distanceSq-ci.distanceSq).map(pn=>pn.tileID)}resize(t,c){this.width=t,this.height=c,this.pixelsToGLUnits=[2/t,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const c=l.clamp(t.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),g=this.projection.project(t.lng,c);return new l.pointGeometry(g.x*this.worldSize,g.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,c){let g,b;const C=this.centerPoint;if("globe"===this.projection.name){const S=this.worldSize;g=(c.x-C.x)/S,b=(c.y-C.y)/S}else{const S=this.pointCoordinate(c),U=this.pointCoordinate(C);g=S.x-U.x,b=S.y-U.y}const I=this.locationCoordinate(t);this.setLocation(new l.MercatorCoordinate(I.x-g,I.y-b))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,c){const g=c?l.mercatorZfromAltitude(c,t.lat):void 0,b=this.projection.project(t.lng,t.lat);return new l.MercatorCoordinate(b.x,b.y,g)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,c){const g=c??this._centerAltitude,b=[t.x,t.y,0,1],C=[t.x,t.y,1,1];l.transformMat4$1(b,b,this.pixelMatrixInverse),l.transformMat4$1(C,C,this.pixelMatrixInverse);const I=C[3];l.scale$1(b,b,1/b[3]),l.scale$1(C,C,1/I);const S=b[2],U=C[2];return{p0:b,p1:C,t:S===U?0:(g-S)/(U-S)}}screenPointToMercatorRay(t){const c=[t.x,t.y,0,1],g=[t.x,t.y,1,1];return l.transformMat4$1(c,c,this.pixelMatrixInverse),l.transformMat4$1(g,g,this.pixelMatrixInverse),l.scale$1(c,c,1/c[3]),l.scale$1(g,g,1/g[3]),c[2]=l.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,g[2]=l.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,l.scale$1(c,c,1/this.worldSize),l.scale$1(g,g,1/this.worldSize),new l.Ray([c[0],c[1],c[2]],l.normalize([],l.sub([],g,c)))}rayIntersectionCoordinate(t){const{p0:c,p1:g,t:b}=t,C=l.mercatorZfromAltitude(c[2],this._center.lat),I=l.mercatorZfromAltitude(g[2],this._center.lat);return new l.MercatorCoordinate(l.number(c[0],g[0],b)/this.worldSize,l.number(c[1],g[1],b)/this.worldSize,l.number(C,I,b))}pointCoordinate(t,c=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,c)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const c=this.elevation;let g=this.elevation.pointCoordinate(t);if(g)return new l.MercatorCoordinate(g[0],g[1],g[2]);let b=0,C=this.horizonLineFromTop();if(t.y>C)return this.pointCoordinate(t);const I=.02*C,S=t.clone();for(let U=0;U<10&&C-b>I;U++){S.y=l.number(b,C,.66);const q=c.pointCoordinate(S);q?(C=S.y,g=q):b=S.y}return g?new l.MercatorCoordinate(g[0],g[1],g[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const c=this.horizonLineFromTop();return t.y<c}}_coordinatePoint(t,c){const g=c&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,b=[t.x*this.worldSize,t.y*this.worldSize,g+t.toAltitude(),1];return l.transformMat4$1(b,b,this.pixelMatrix),b[3]>0?new l.pointGeometry(b[0]/b[3],b[1]/b[3]):new l.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,c){const g=new l.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),b=new l.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),C=new l.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),I=new l.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let S=this.pointCoordinate(g,t),U=this.pointCoordinate(b,t);const q=this.pointCoordinate(C,c),J=this.pointCoordinate(I,c),ae=(Te,Ve)=>(Ve.y-Te.y)/(Ve.x-Te.x);return S.y>1&&U.y>=0?S=new l.MercatorCoordinate((1-J.y)/ae(J,S)+J.x,1):S.y<0&&U.y<=1&&(S=new l.MercatorCoordinate(-J.y/ae(J,S)+J.x,0)),U.y>1&&S.y>=0?U=new l.MercatorCoordinate((1-q.y)/ae(q,U)+q.x,1):U.y<0&&S.y<=1&&(U=new l.MercatorCoordinate(-q.y/ae(q,U)+q.x,0)),(new l.LngLatBounds).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(q))}_getBounds3D(){const t=this.elevation;if(!t.visibleDemTiles.length)return this._getBounds(0,0);const c=t.visibleDemTiles.reduce((g,b)=>{if(b.dem){const C=b.dem.tree;g.min=Math.min(g.min,C.minimums[0]),g.max=Math.max(g.max,C.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBounds(c.min*t.exaggeration(),c.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-c*(1-this._horizonShift);return t?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-l.MAX_MERCATOR_LATITUDE,this.maxLat=l.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=l.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=l.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=l.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=l.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,c){return this.projection.createTileMatrix(this,c,t)}calculateDistanceTileData(t){const c=t.key,g=this._distanceTileDataCache;if(g[c])return g[c];const b=t.canonical,C=1/this.height,I=this.cameraWorldSize/this.zoomScale(b.z),S=(b.x+Math.pow(2,b.z)*t.wrap)*I,U=b.y*I,q=this.point,J=this.angle,ae=Math.sin(-J),Te=-Math.cos(-J);return g[c]={bearing:[ae,Te],center:[(q.x-S)*C,(q.y-U)*C],scale:I/l.EXTENT*C},g[c]}calculateFogTileMatrix(t){const c=t.key,g=this._fogTileMatrixCache;if(g[c])return g[c];const b=this.calculatePosMatrix(t,this.cameraWorldSize);return l.multiply$1(b,this.worldToFogMatrix,b),g[c]=new Float32Array(b),g[c]}calculateProjMatrix(t,c=!1){const g=t.key,b=c?this._alignedProjMatrixCache:this._projMatrixCache;if(b[g])return b[g];const C=this.calculatePosMatrix(t,this.worldSize);return l.multiply$1(C,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,C),b[g]=new Float32Array(C),b[g]}calculatePixelsToTileUnitsMatrix(t){const c=t.tileID.key,g=this._pixelsToTileUnitsCache;if(g[c])return g[c];const b=function(C,I){const{scale:S}=C.tileTransform,U=S*l.EXTENT/(C.tileSize*Math.pow(2,I.zoom-C.tileID.overscaledZ+C.tileID.canonical.z));return q=new Float32Array(4),Te=(J=I.inverseAdjustmentMatrix)[1],Ve=J[2],Oe=J[3],at=(ae=[U,U])[1],q[0]=J[0]*(xe=ae[0]),q[1]=Te*xe,q[2]=Ve*at,q[3]=Oe*at,q;var q,J,ae,Te,Ve,Oe,xe,at}(t,this);return g[c]=b,g[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const c=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(c),b=this._camera.forward(),C=l.mercatorZfromAltitude(1,this._center.lat);g[2]/=C,b[2]/=C,l.normalize(b,b);const I=t.raycast(g,b,t.exaggeration());if(I){const S=l.scaleAndAdd([],g,b,I),U=new l.MercatorCoordinate(S[0],S[1],l.mercatorZfromAltitude(S[2],l.latFromMercatorY(S[1]))),q=(U.z+l.length([U.x-g[0],U.y-g[1],U.z-g[2]*C]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(q),this._centerAltitude=U.toAltitude(),this._center=this.coordinateLocation(U),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const c=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(c),b=t.getAtPointOrZero(new l.MercatorCoordinate(...g)),C=this._minimumHeightOverTerrain()*Math.cos(l.degToRad(this._maxPitch)),I=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*b;if(I<C){const S=this.locationCoordinate(this._center,this._centerAltitude),U=[S.x-g[0],S.y-g[1],S.z-g[2]],q=l.length(U);U[2]-=(C-I)/this._projectionScaler;const J=l.length(U);if(0===J)return;l.scale$2(U,U,q/J*this._projectionScaler),this._camera.position=[S.x-U[0],S.y-U[1],S.z*this._projectionScaler-U[2]],this._camera.orientation=Vl(U,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const ae=this.center;return ae.lat=l.clamp(ae.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(ae.lng=l.clamp(ae.lng,this.minLng,this.maxLng)),this.center=ae,void(this._constraining=!1)}const t=this._unmodified,{x:c,y:g}=this.point;let b=0,C=c,I=g;const S=this.width/2,U=this.height/2,q=this.worldMinY*this.scale,J=this.worldMaxY*this.scale;if(g-U<q&&(I=q+U),g+U>J&&(I=J-U),J-q<this.height&&(b=Math.max(b,this.height/(J-q)),I=(J+q)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ae=this.worldMinX*this.scale,Te=this.worldMaxX*this.scale,Ve=this.worldSize/2-(ae+Te)/2;C=(c+Ve+this.worldSize)%this.worldSize-Ve,C-S<ae&&(C=ae+S),C+S>Te&&(C=Te-S),Te-ae<this.width&&(b=Math.max(b,this.width/(Te-ae)),C=(Te+ae)/2)}C===c&&I===g||(this.center=this.unproject(new l.pointGeometry(C,I))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this._fov/2,c=this.centerOffset,g=this.pixelsPerMeter;this._projectionScaler=g/(l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(t)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?g:1),C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);C[8]=2*-c.x/this.width,C[9]=2*c.y/this.height;let I=l.mul([],C,b);if(this.projection.isReprojectedInTileSpace){const mt=this.locationCoordinate(this.center),nt=l.identity([]);l.translate(nt,nt,[mt.x*this.worldSize,mt.y*this.worldSize,0]),l.multiply$1(nt,nt,Wa(this)),l.translate(nt,nt,[-mt.x*this.worldSize,-mt.y*this.worldSize,0]),l.multiply$1(I,I,nt),this.inverseAdjustmentMatrix=function(bt){const Jt=Wa(bt,!0);return ve([],[Jt[0],Jt[1],Jt[4],Jt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=l.scale([],I,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=I,this.invProjMatrix=l.invert(new Float64Array(16),this.projMatrix);const S=new Float32Array(16);l.identity(S),l.scale(S,S,[1,-1,1]),l.rotateX(S,S,this._pitch),l.rotateZ(S,S,this.angle);const U=l.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-c.x/this.width,U[9]=2*(c.y+q)/this.height,this.skyboxMatrix=l.multiply$1(S,U,S);const J=this.point,ae=J.x,Te=J.y,Ve=this.width%2/2,Oe=this.height%2/2,xe=Math.cos(this.angle),at=Math.sin(this.angle),Ye=ae-Math.round(ae)+xe*Ve+at*Oe,rt=Te-Math.round(Te)+xe*Oe+at*Ve,ot=new Float64Array(I);if(l.translate(ot,ot,[Ye>.5?Ye-1:Ye,rt>.5?rt-1:rt,0]),this.alignedProjMatrix=ot,I=l.create(),l.scale(I,I,[this.width/2,-this.height/2,1]),l.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=l.create(),l.scale(I,I,[1,-1,1]),l.translate(I,I,[-1,-1,0]),l.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=l.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=l.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");this.pixelMatrixInverse=I,this.globeMatrix="globe"===this.projection.name?l.calculateGlobeMatrix(this):I,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,c=this.cameraPixelsPerMeter,g=this._camera.position,b=1/this.height,C=[t,t,c];l.scale$2(C,C,b),l.scale$2(g,g,-1),l.multiply$2(g,g,C);const I=l.create();l.translate(I,I,g),l.scale(I,I,C),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,c,b)}_computeCameraPosition(t){const c=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),b=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-t/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-g[0]*C,b.y/this.worldSize-g[1]*C,t/this.worldSize*this._centerAltitude-g[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=t[2];let b=1;g>0&&(b=Math.min((c-this._camera.position[2])/g,1)),this._camera.position=l.scaleAndAdd([],this._camera.position,t,b),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const t=this._camera.position,c=this._camera.forward(),{pitch:g,bearing:b}=this._camera.getPitchBearing(),C=l.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(l.degToRad(this._maxPitch)),S=Math.max((t[2]-C)/Math.cos(g),I),U=this._zoomFromMercatorZ(S);l.scaleAndAdd(t,t,c,S),this._pitch=l.clamp(g,l.degToRad(this.minPitch),l.degToRad(this.maxPitch)),this.angle=l.wrap(b,-Math.PI,Math.PI),this._setZoom(l.clamp(U,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new l.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(l.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(t,c){const g=Math.min(t.x,c.x),b=Math.max(t.x,c.x),C=Math.min(t.y,c.y),I=Math.max(t.y,c.y);if(C<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const S=[new l.pointGeometry(g,C),new l.pointGeometry(b,I),new l.pointGeometry(g,I),new l.pointGeometry(b,C)],U=this.renderWorldCopies?-3:0,q=this.renderWorldCopies?4:1;for(const J of S){const ae=this.pointRayIntersection(J);if(ae.t<0)return!0;const Te=this.rayIntersectionCoordinate(ae);if(Te.x<U||Te.y<0||Te.x>q||Te.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+l.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new l.pointGeometry(0,0),new l.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,c){const g=l.length(l.sub([],this._camera.position,t)),b=this._zoomFromMercatorZ(g)+c;return g-this._mercatorZfromZoom(b)}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,t))}}function jl(p,t){let c=!1,g=null;const b=()=>{g=null,c&&(p(),g=setTimeout(b,t),c=!1)};return()=>(c=!0,g||b(),g)}class Ja{constructor(t){this._hashName=t&&encodeURIComponent(t),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=jl(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,l.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),l.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(t){const c=this._map;if(!c)return"";const g=c.getCenter(),b=Math.round(100*c.getZoom())/100,C=Math.ceil((b*Math.LN2+Math.log(512/360/.5))/Math.LN10),I=Math.pow(10,C),S=Math.round(g.lng*I)/I,U=Math.round(g.lat*I)/I,q=c.getBearing(),J=c.getPitch();let ae="";if(ae+=t?`/${S}/${U}/${b}`:`${b}/${U}/${S}`,(q||J)&&(ae+="/"+Math.round(10*q)/10),J&&(ae+=`/${Math.round(J)}`),this._hashName){const Te=this._hashName;let Ve=!1;const Oe=l.window.location.hash.slice(1).split("&").map(xe=>{const at=xe.split("=")[0];return at===Te?(Ve=!0,`${at}=${ae}`):xe}).filter(xe=>xe);return Ve||Oe.push(`${Te}=${ae}`),`#${Oe.join("&")}`}return`#${ae}`}_getCurrentHash(){const t=l.window.location.hash.replace("#","");if(this._hashName){let c;return t.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(c=g)}),(c&&c[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(g=>isNaN(g))){const g=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(c[3]||0):t.getBearing();return t.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:g,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=l.window.location.href.replace(/(#.+)?$/,this.getHashString());l.window.history.replaceState(l.window.history.state,null,t)}}const Ms={linearity:.3,easing:l.bezier(0,0,.3,1)},mc=l.extend({deceleration:2500,maxSpeed:1400},Ms),Zl=l.extend({deceleration:20,maxSpeed:1400},Ms),Md=l.extend({deceleration:1e3,maxSpeed:360},Ms),Ma=l.extend({deceleration:1e3,maxSpeed:90},Ms);class Xa{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,c=l.exported.now();for(;t.length>0&&c-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)c.zoom+=C.zoomDelta||0,c.bearing+=C.bearingDelta||0,c.pitch+=C.pitchDelta||0,C.panDelta&&c.pan._add(C.panDelta),C.around&&(c.around=C.around),C.pinchAround&&(c.pinchAround=C.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(c.pan.mag()){const C=bo(c.pan.mag(),g,l.extend({},mc,t||{}));b.offset=c.pan.mult(C.amount/c.pan.mag()),b.center=this._map.transform.center,Ka(b,C)}if(c.zoom){const C=bo(c.zoom,g,Zl);b.zoom=this._map.transform.zoom+C.amount,Ka(b,C)}if(c.bearing){const C=bo(c.bearing,g,Md);b.bearing=this._map.transform.bearing+l.clamp(C.amount,-179,179),Ka(b,C)}if(c.pitch){const C=bo(c.pitch,g,Ma);b.pitch=this._map.transform.pitch+C.amount,Ka(b,C)}if(b.zoom||b.bearing){const C=void 0===c.pinchAround?c.around:c.pinchAround;b.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function Ka(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function bo(p,t,c){const{maxSpeed:g,linearity:b,deceleration:C}=c,I=l.clamp(p*b/(t/1e3),-g,g),S=Math.abs(I)/(C*b);return{easing:c.easing,duration:1e3*S,amount:I*(S/2)}}class $o extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,c,g,b={}){const C=ke(c.getCanvasContainer(),g),I=c.unproject(C);super(t,l.extend({point:C,lngLat:I,originalEvent:g},b)),this._defaultPrevented=!1,this.target=c}}class Qa extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,c,g){const b="touchend"===t?g.changedTouches:g.touches,C=He(c.getCanvasContainer(),b),I=C.map(U=>c.unproject(U)),S=C.reduce((U,q,J,ae)=>U.add(q.div(ae.length)),new l.pointGeometry(0,0));super(t,{points:C,point:S,lngLats:I,lngLat:c.unproject(S),originalEvent:g}),this._defaultPrevented=!1}}class Hc extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,c,g){super(t,{originalEvent:g}),this._defaultPrevented=!1}}class el{constructor(t,c){this._map=t,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Hc(t.type,this._map,t))}mousedown(t,c){return this._mousedownPos=c,this._firePreventable(new $o(t.type,this._map,t))}mouseup(t){this._map.fire(new $o(t.type,this._map,t))}preclick(t){const c=l.extend({},t);c.type="preclick",this._map.fire(new $o(c.type,this._map,c))}click(t,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(t),this._map.fire(new $o(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new $o(t.type,this._map,t))}mouseover(t){this._map.fire(new $o(t.type,this._map,t))}mouseout(t){this._map.fire(new $o(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Qa(t.type,this._map,t))}touchmove(t){this._map.fire(new Qa(t.type,this._map,t))}touchend(t){this._map.fire(new Qa(t.type,this._map,t))}touchcancel(t){this._map.fire(new Qa(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ws{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new $o(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $o("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new $o(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Aa{constructor(t,c){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,c){this.isEnabled()&&t.shiftKey&&0===t.button&&(Ie(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(t,c){if(!this._active)return;const g=c;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=g,this._box||(this._box=De("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const C=Math.min(b.x,g.x),I=Math.max(b.x,g.x),S=Math.min(b.y,g.y),U=Math.max(b.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${C}px,${S}px)`,this._box.style.width=I-C+"px",this._box.style.height=U-S+"px")})}mouseupWindow(t,c){if(!this._active||0!==t.button)return;const g=this._startPos,b=c;if(this.reset(),Ne(),g.x!==b.x||g.y!==b.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:C=>C.fitScreenCoordinates(g,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),we(),delete this._startPos,delete this._lastPos}_fireEvent(t,c){return this._map.fire(new l.Event(t,{originalEvent:c}))}}function Ys(p,t){const c={};for(let g=0;g<p.length;g++)c[p[g].identifier]=t[g];return c}class ys{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,c,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),g.length===this.numTouches&&(this.centroid=function(b){const C=new l.pointGeometry(0,0);for(const I of b)C._add(I);return C.div(b.length)}(c),this.touches=Ys(g,c)))}touchmove(t,c,g){if(this.aborted||!this.centroid)return;const b=Ys(g,c);for(const C in this.touches){const I=this.touches[C],S=b[C];(!S||S.dist(I)>30)&&(this.aborted=!0)}}touchend(t,c,g){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Sa{constructor(t){this.singleTap=new ys(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,c,g){this.singleTap.touchstart(t,c,g)}touchmove(t,c,g){this.singleTap.touchmove(t,c,g)}touchend(t,c,g){const b=this.singleTap.touchend(t,c,g);if(b){const C=t.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(b)<30;if(C&&I||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class ti{constructor(){this._zoomIn=new Sa({numTouches:1,numTaps:2}),this._zoomOut=new Sa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,c,g){this._zoomIn.touchstart(t,c,g),this._zoomOut.touchstart(t,c,g)}touchmove(t,c,g){this._zoomIn.touchmove(t,c,g),this._zoomOut.touchmove(t,c,g)}touchend(t,c,g){const b=this._zoomIn.touchend(t,c,g),C=this._zoomOut.touchend(t,c,g);return b?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(b)},{originalEvent:t})}):C?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(C)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const gc={0:1,2:2};class _l{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,c){return!1}_move(t,c){return{}}mousedown(t,c){if(this._lastPoint)return;const g=We(t);this._correctButton(t,g)&&(this._lastPoint=c,this._eventButton=g)}mousemoveWindow(t,c){const g=this._lastPoint;if(g)if(t.preventDefault(),null!=this._eventButton&&function(b,C){const I=gc[C];return void 0===b.buttons||(b.buttons&I)!==I}(t,this._eventButton))this.reset();else if(this._moved||!(c.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(g,c)}mouseupWindow(t){this._lastPoint&&We(t)===this._eventButton&&(this._moved&&Ne(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yl extends _l{mousedown(t,c){super.mousedown(t,c),this._lastPoint&&(this._active=!0)}_correctButton(t,c){return 0===c&&!t.ctrlKey}_move(t,c){return{around:c,panDelta:c.sub(t)}}}class la extends _l{_correctButton(t,c){return 0===c&&t.ctrlKey||2===c}_move(t,c){const g=.8*(c.x-t.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(t){t.preventDefault()}}class z extends _l{_correctButton(t,c){return 0===c&&t.ctrlKey||2===c}_move(t,c){const g=-.5*(c.y-t.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(t){t.preventDefault()}}class O{constructor(t,c){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),l.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0)}touchstart(t,c,g){return this._calculateTransform(t,c,g)}touchmove(t,c,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===g.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,c,g)}}touchend(t,c,g){this._calculateTransform(t,c,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,c,g){g.length>0&&(this._active=!0);const b=Ys(g,c),C=new l.pointGeometry(0,0),I=new l.pointGeometry(0,0);let S=0;for(const q in b){const J=b[q],ae=this._touches[q];ae&&(C._add(J),I._add(J.sub(ae)),S++,b[q]=J)}if(this._touches=b,S<this._minTouches||!I.mag())return;const U=I.div(S);return this._sum._add(U),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(S),panDelta:U}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=De("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class P{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,c,g){return{}}touchstart(t,c,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([c[0],c[1]]))}touchmove(t,c,g){const b=this._firstTwoTouches;if(!b)return;t.preventDefault();const[C,I]=b,S=G(g,c,C),U=G(g,c,I);if(!S||!U)return;const q=this._aroundCenter?null:S.add(U).div(2);return this._move([S,U],q,t)}touchend(t,c,g){if(!this._firstTwoTouches)return;const[b,C]=this._firstTwoTouches,I=G(g,c,b),S=G(g,c,C);I&&S||(this._active&&Ne(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function G(p,t,c){for(let g=0;g<p.length;g++)if(p[g].identifier===c)return t[g]}function oe(p,t){return Math.log(p/t)/Math.LN2}class Se extends P{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,c){const g=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(oe(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:oe(this._distance,g),pinchAround:c}}}function ft(p,t){return 180*p.angleWith(t)/Math.PI}class Mt extends P{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,c){const g=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ft(this._vector,g),pinchAround:c}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const c=25/(Math.PI*this._minDiameter)*360,g=ft(t,this._startVector);return Math.abs(g)<c}}function cn(p){return Math.abs(p.y)>Math.abs(p.x)}class ni extends P{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,cn(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,c,g){const b=this._lastPoints;if(!b)return;const C=t[0].sub(b[0]),I=t[1].sub(b[1]);return this._map._cooperativeGestures&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(C,I,g.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(C.y+I.y)/2*-.5})}gestureBeginsVertically(t,c,g){if(void 0!==this._valid)return this._valid;const b=t.mag()>=2,C=c.mag()>=2;if(!b&&!C)return;if(!b||!C)return null==this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const I=t.y>0==c.y>0;return cn(t)&&cn(c)&&I}}const or={panStep:100,bearingStep:15,pitchStep:10};class Mi{constructor(){const t=or;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let c=0,g=0,b=0,C=0,I=0;switch(t.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:t.shiftKey?g=-1:(t.preventDefault(),C=-1);break;case 39:t.shiftKey?g=1:(t.preventDefault(),C=1);break;case 38:t.shiftKey?b=1:(t.preventDefault(),I=-1);break;case 40:t.shiftKey?b=-1:(t.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(g=0,b=0),{cameraAnimation:S=>{const U=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Tr,zoom:c?Math.round(U)+c*(t.shiftKey?2:1):U,bearing:S.getBearing()+g*this._bearingStep,pitch:S.getPitch()+b*this._pitchStep,offset:[-C*this._panStep,-I*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Tr(p){return p*(2-p)}const Ur=4.000244140625;class Pa{constructor(t,c){this._map=t,this._el=t.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=t.deltaMode===l.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const g=l.exported.now(),b=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==c&&c%Ur==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(b*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),t.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=t,this._delta-=c,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=ke(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,c=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const U="wheel"===this._type&&Math.abs(this._delta)>Ur?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*U)));this._delta<0&&0!==q&&(q=1/q);const J=c(),ae=Math.pow(2,J),Te="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):ae;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(Te*q))),"wheel"===this._type&&(this._startZoom=c(),this._easing=this._smoothOutEasing(200)),this._delta=0}const g="number"==typeof this._targetZoom?this._targetZoom:c(),b=this._startZoom,C=this._easing;let I,S=!1;if("wheel"===this._type&&b&&C){const U=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),q=C(U);I=l.number(b,g,q),U<1?this._frameId||(this._frameId=!0):S=!0}else I=g,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:I-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let c=l.ease;if(this._prevEase){const g=this._prevEase,b=(l.exported.now()-g.start)/g.duration,C=g.easing(b+.01)-g.easing(b),I=.27/Math.sqrt(C*C+1e-4)*.01,S=Math.sqrt(.0729-I*I);c=l.bezier(I,S,.25,1)}return this._prevEase={start:l.exported.now(),duration:t,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=De("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(l.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!l.window.document.fullscreenElement||!!l.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Oa{constructor(t,c){this._clickZoom=t,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ca{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,c){return t.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(t.shiftKey?-1:1),around:g.unproject(c)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vl{constructor(){this._tap=new Sa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,c,g){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=c[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(t,c,g))}touchmove(t,c,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const b=c[0],C=b.y-this._swipePoint.y;return this._swipePoint=b,t.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(t,c,g)}touchend(t,c,g){this._tapTime?this._swipePoint&&0===g.length&&this.reset():this._tap.touchend(t,c,g)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xa{constructor(t,c,g){this._el=t,this._mousePan=c,this._touchPan=g}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gl{constructor(t,c,g){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=c,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class xl{constructor(t,c,g,b){this._el=t,this._touchZoom=c,this._touchRotate=g,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ba=p=>p.zoom||p.drag||p.pitch||p.rotate;class tl extends l.Event{}class Au{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,c){const g=l.sub([],c,t);this.radius=l.length(g[2]<0?l.div([],g,this.constants):[g[0],g[1],0])}projectRay(t){l.div(t,t,this.constants),l.normalize(t,t),l.mul$1(t,t,this.constants);const c=l.scale$2([],t,this.radius);if(c[2]>0){const g=l.scale$2([],[0,0,1],l.dot(c,[0,0,1])),b=l.scale$2([],l.normalize([],[c[0],c[1],0]),this.radius),C=l.add([],c,l.scale$2([],l.sub([],l.add([],b,g),c),2));c[0]=C[0],c[1]=C[1]}return c}}function nl(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class bl{constructor(t,c){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Xa(t),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Au,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),l.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[l.window.document,"mousemove",{capture:!0}],[l.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[l.window,"blur",void 0]];for(const[b,C,I]of this._listeners)b.addEventListener(C,b===l.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[t,c,g]of this._listeners)t.removeEventListener(c,t===l.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(t){const c=this._map,g=c.getCanvasContainer();this._add("mapEvent",new el(c,t));const b=c.boxZoom=new Aa(c,t);this._add("boxZoom",b);const C=new ti,I=new ca;c.doubleClickZoom=new Oa(I,C),this._add("tapZoom",C),this._add("clickZoom",I);const S=new vl;this._add("tapDragZoom",S);const U=c.touchPitch=new ni(c);this._add("touchPitch",U);const q=new la(t),J=new z(t);c.dragRotate=new Gl(t,q,J),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",J,["mouseRotate"]);const ae=new yl(t),Te=new O(c,t);c.dragPan=new xa(g,ae,Te),this._add("mousePan",ae),this._add("touchPan",Te,["touchZoom","touchRotate"]);const Ve=new Mt,Oe=new Se;c.touchZoomRotate=new xl(g,Oe,Ve,S),this._add("touchRotate",Ve,["touchPan","touchZoom"]),this._add("touchZoom",Oe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ws(c));const xe=c.scrollZoom=new Pa(c,this);this._add("scrollZoom",xe,["mousePan"]);const at=c.keyboard=new Mi;this._add("keyboard",at);for(const Ye of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Ye]&&c[Ye].enable(t[Ye])}_add(t,c,g){this._handlers.push({handlerName:t,handler:c,allowed:g}),this._handlersById[t]=c}stop(t){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ba(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,c,g){for(const b in t)if(b!==g&&(!c||c.indexOf(b)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const c=[];for(const g of t)this._el.contains(g.target)&&c.push(g);return c}handleEvent(t,c){this._updatingCamera=!0;const g="renderFrame"===t.type,b=g?void 0:t,C={needsRenderFrame:!1},I={},S={},U=t.touches?this._getMapTouches(t.touches):void 0,q=U?He(this._el,U):g?void 0:ke(this._el,t);for(const{handlerName:Te,handler:Ve,allowed:Oe}of this._handlers){if(!Ve.isEnabled())continue;let xe;this._blockedByActive(S,Oe,Te)?Ve.reset():Ve[c||t.type]&&(xe=Ve[c||t.type](t,q,U),this.mergeHandlerResult(C,I,xe,Te,b),xe&&xe.needsRenderFrame&&this._triggerRenderFrame()),(xe||Ve.isActive())&&(S[Te]=Ve)}const J={};for(const Te in this._previousActiveHandlers)S[Te]||(J[Te]=b);this._previousActiveHandlers=S,(Object.keys(J).length||nl(C))&&(this._changes.push([C,I,J]),this._triggerRenderFrame()),(Object.keys(S).length||nl(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ae}=C;ae&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ae(this._map))}mergeHandlerResult(t,c,g,b,C){if(!g)return;l.extend(t,g);const I={handlerName:b,originalEvent:g.originalEvent||C};void 0!==g.zoomDelta&&(c.zoom=I),void 0!==g.panDelta&&(c.drag=I),void 0!==g.pitchDelta&&(c.pitch=I),void 0!==g.bearingDelta&&(c.rotate=I)}_applyChanges(){const t={},c={},g={};for(const[b,C,I]of this._changes)b.panDelta&&(t.panDelta=(t.panDelta||new l.pointGeometry(0,0))._add(b.panDelta)),b.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(t.around=b.around),void 0!==b.aroundCoord&&(t.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(t.pinchAround=b.pinchAround),b.noInertia&&(t.noInertia=b.noInertia),l.extend(c,C),l.extend(g,I);this._updateMapTransform(t,c,g),this._changes=[]}_updateMapTransform(t,c,g){const b=this._map,C=b.transform,I=rt=>[rt.x,rt.y,rt.z];if((rt=>{const ot=this._eventsInProgress.drag;return ot&&!this._handlersById[ot.handlerName].isActive()})()&&!nl(t)){const rt=C.zoom;C.cameraElevationReference="sea",C.recenterOnTerrain(),C.cameraElevationReference="ground",rt!==C.zoom&&this._map._update(!0)}if(!nl(t))return void this._fireEvents(c,g,!0);let{panDelta:S,zoomDelta:U,bearingDelta:q,pitchDelta:J,around:ae,aroundCoord:Te,pinchAround:Ve}=t;void 0!==Ve&&(ae=Ve),(rt=>c.drag&&!this._eventsInProgress.drag)()&&ae&&(this._dragOrigin=I(C.pointCoordinate3D(ae)),this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",b._stop(!0),ae=ae||b.transform.centerPoint,q&&(C.bearing+=q),J&&(C.pitch+=J),C._updateCameraState();const Oe=[0,0,0];if(S){const rt=C.pointCoordinate(ae);if("globe"===C.projection.name){const ot=l.latFromMercatorY(rt.y),mt=C.center.lat,nt=Math.min(l.mercatorZfromAltitude(1,ot)/l.mercatorZfromAltitude(1,mt),2);S=S.rotate(-C.angle),Oe[0]=-S.x/C.worldSize*nt,Oe[1]=-S.y/C.worldSize*nt}else{const ot=C.pointCoordinate(ae.sub(S));rt&&ot&&(Oe[0]=ot.x-rt.x,Oe[1]=ot.y-rt.y)}}const xe=C.zoom,at=[0,0,0];if(U){const rt=I(Te||C.pointCoordinate3D(ae)),ot={dir:l.normalize([],l.sub([],rt,C._camera.position))};if(ot.dir[2]<0){const mt=C.zoomDeltaToMovement(rt,U);l.scale$2(at,ot.dir,mt)}}const Ye=l.add(Oe,Oe,at);C._translateCameraConstrained(Ye),U&&Math.abs(C.zoom-xe)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(c,g,!0)}_fireEvents(t,c,g){const b=ba(this._eventsInProgress),C=ba(t),I={};for(const J in t){const{originalEvent:ae}=t[J];this._eventsInProgress[J]||(I[`${J}start`]=ae),this._eventsInProgress[J]=t[J]}!b&&C&&this._fireEvent("movestart",C.originalEvent);for(const J in I)this._fireEvent(J,I[J]);C&&this._fireEvent("move",C.originalEvent);for(const J in t){const{originalEvent:ae}=t[J];this._fireEvent(J,ae)}const S={};let U;for(const J in this._eventsInProgress){const{handlerName:ae,originalEvent:Te}=this._eventsInProgress[J];this._handlersById[ae].isActive()||(delete this._eventsInProgress[J],U=c[ae]||Te,S[`${J}end`]=U)}for(const J in S)this._fireEvent(J,S[J]);const q=ba(this._eventsInProgress);if(g&&(b||C)&&!q){this._updatingCamera=!0;const J=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ae=Te=>0!==Te&&-this._bearingSnap<Te&&Te<this._bearingSnap;J?(ae(J.bearing||this._map.getBearing())&&(J.bearing=0),this._map.easeTo(J,{originalEvent:U})):(this._map.fire(new l.Event("moveend",{originalEvent:U})),ae(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,c){this._map.fire(new l.Event(t,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new tl("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Su="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Pu extends l.Evented{constructor(t,c){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=c.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,c){return this.jumpTo({center:t},c)}panBy(t,c,g){return t=l.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,l.extend({offset:t},c),g)}panTo(t,c,g){return this.easeTo(l.extend({center:t},c),g)}getZoom(){return this.transform.zoom}setZoom(t,c){return this.jumpTo({zoom:t},c),this}zoomTo(t,c,g){return this.easeTo(l.extend({zoom:t},c),g)}zoomIn(t,c){return this.zoomTo(this.getZoom()+1,t,c),this}zoomOut(t,c){return this.zoomTo(this.getZoom()-1,t,c),this}getBearing(){return this.transform.bearing}setBearing(t,c){return this.jumpTo({bearing:t},c),this}getPadding(){return this.transform.padding}setPadding(t,c){return this.jumpTo({padding:t},c),this}rotateTo(t,c,g){return this.easeTo(l.extend({bearing:t},c),g)}resetNorth(t,c){return this.rotateTo(0,l.extend({duration:1e3},t),c),this}resetNorthPitch(t,c){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},t),c),this}snapToNorth(t,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,c):this}getPitch(){return this.transform.pitch}setPitch(t,c){return this.jumpTo({pitch:t},c),this}cameraForBounds(t,c){t=l.LngLatBounds.convert(t);const g=c&&c.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),g,c)}_extendCameraOptions(t){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=l.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const g=t.padding;t.padding={top:g,bottom:g,right:g,left:g}}return t.padding=l.extend(c,t.padding),t}_cameraForBoxAndBearing(t,c,g,b){const C=this._extendCameraOptions(b),I=this.transform,S=I.padding,U=I.project(l.LngLat.convert(t)),q=I.project(l.LngLat.convert(c)),J=new l.pointGeometry(U.x,q.y),ae=new l.pointGeometry(q.x,U.y),Te=-l.degToRad(g),Ve=U.rotate(Te),Oe=q.rotate(Te),xe=J.rotate(Te),at=ae.rotate(Te),Ye=new l.pointGeometry(Math.max(Ve.x,Oe.x,xe.x,at.x),Math.max(Ve.y,Oe.y,xe.y,at.y)),rt=new l.pointGeometry(Math.min(Ve.x,Oe.x,xe.x,at.x),Math.min(Ve.y,Oe.y,xe.y,at.y)),ot=Ye.sub(rt),mt=(I.width-((S.left||0)+(S.right||0)+C.padding.left+C.padding.right))/ot.x,nt=(I.height-((S.top||0)+(S.bottom||0)+C.padding.top+C.padding.bottom))/ot.y;if(nt<0||mt<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const bt=Math.min(I.scaleZoom(I.scale*Math.min(mt,nt)),C.maxZoom),Jt="number"==typeof C.offset.x&&"number"==typeof C.offset.y?new l.pointGeometry(C.offset.x,C.offset.y):l.pointGeometry.convert(C.offset),rn=new l.pointGeometry((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(g*Math.PI/180),hn=Jt.add(rn).mult(I.scale/I.zoomScale(bt));return{center:I.unproject(U.add(q).div(2).sub(hn)),zoom:bt,bearing:g}}_cameraForBox(t,c,g,b,C){const I=this._extendCameraOptions(C);g=g||0,b=b||0,t=l.LngLat.convert(t),c=l.LngLat.convert(c);const S=this.transform.clone();S.padding=I.padding;const U=this.getFreeCameraOptions(),q=new l.LngLat(.5*(t.lng+c.lng),.5*(t.lat+c.lat)),J=.5*(g+b);if(S._camera.position[2]<l.mercatorZfromAltitude(J,q.lat))return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");U.lookAtPoint(q),S.setFreeCameraOptions(U);const ae=l.MercatorCoordinate.fromLngLat(t),Te=l.MercatorCoordinate.fromLngLat(c),Ve=S.pointRayIntersection(S.centerPoint,J),Oe=[(xe=S.rayIntersectionCoordinate(Ve)).x,xe.y,xe.z];var xe;const at=S.screenPointToMercatorRay(S.centerPoint),Ye="globe"!==S.projection.name;let rt,ot=0;do{const mt=Math.floor(S.zoom),nt=1<<mt,bt=Math.min(nt*ae.x,nt*Te.x),Jt=Math.min(nt*ae.y,nt*Te.y),rn=Math.max(nt*ae.x,nt*Te.x),hn=Math.max(nt*ae.y,nt*Te.y),un=new l.Aabb([bt,Jt,g],[rn,hn,b]),Un=l.Frustum.fromInvProjectionMatrix(S.invProjMatrix,S.worldSize,mt,Ye);if(2!==un.intersects(Un)){rt&&(S._camera.position=l.scaleAndAdd([],S._camera.position,at.dir,-rt),S._updateStateFromCamera());break}const Zt=l.sub([],S._camera.position,Oe);rt=.5*l.length(Zt),S._camera.position=l.scaleAndAdd([],S._camera.position,at.dir,rt);try{S._updateStateFromCamera()}catch{return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ot<10);return{center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch}}fitBounds(t,c,g){return this._fitInternal(this.cameraForBounds(t,c),c,g)}_raycastElevationBox(t,c){const g=this.transform.elevation;if(!g)return;const b=new l.pointGeometry(t.x,c.y),C=new l.pointGeometry(c.x,t.y),I=g.pointCoordinate(t);if(!I)return;const S=g.pointCoordinate(c);if(!S)return;const U=g.pointCoordinate(b);if(!U)return;const q=g.pointCoordinate(C);if(!q)return;const J=new l.MercatorCoordinate(I[0],I[1]).toLngLat(),ae=new l.MercatorCoordinate(S[0],S[1]).toLngLat(),Te=new l.MercatorCoordinate(U[0],U[1]).toLngLat(),Ve=new l.MercatorCoordinate(q[0],q[1]).toLngLat(),Oe=Math.min(J.lng,Math.min(ae.lng,Math.min(Te.lng,Ve.lng))),xe=Math.min(J.lat,Math.min(ae.lat,Math.min(Te.lat,Ve.lat))),at=Math.max(J.lng,Math.max(ae.lng,Math.max(Te.lng,Ve.lng))),Ye=Math.max(J.lat,Math.max(ae.lat,Math.max(Te.lat,Ve.lat))),rt=Math.min(I[3],Math.min(S[3],Math.min(U[3],q[3]))),ot=Math.max(I[3],Math.max(S[3],Math.max(U[3],q[3])));return{minLngLat:new l.LngLat(Oe,xe),maxLngLat:new l.LngLat(at,Ye),minAltitude:rt,maxAltitude:ot}}fitScreenCoordinates(t,c,g,b,C){let I,S,U,q;const J=l.pointGeometry.convert(t),ae=l.pointGeometry.convert(c),Te=this._raycastElevationBox(J,ae);if(Te)I=Te.minLngLat,S=Te.maxLngLat,U=Te.minAltitude,q=Te.maxAltitude;else{if(this.transform.anyCornerOffEdge(J,ae))return this;I=this.transform.pointLocation(J),S=this.transform.pointLocation(ae)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(t)),this.transform.pointLocation(l.pointGeometry.convert(c)),g,b):this._cameraForBox(I,S,U,q,b),b,C)}_fitInternal(t,c,g){return t?(delete(c=l.extend(t,c)).padding,c.linear?this.easeTo(c,g):this.flyTo(c,g)):this}jumpTo(t,c){this.stop();const g=t.preloadOnly?this.transform.clone():this.transform;let b=!1,C=!1,I=!1;return"zoom"in t&&g.zoom!==+t.zoom&&(b=!0,g.zoom=+t.zoom),void 0!==t.center&&(g.center=l.LngLat.convert(t.center)),"bearing"in t&&g.bearing!==+t.bearing&&(C=!0,g.bearing=+t.bearing),"pitch"in t&&g.pitch!==+t.pitch&&(I=!0,g.pitch=+t.pitch),null==t.padding||g.isPaddingEqual(t.padding)||(g.padding=t.padding),t.preloadOnly?(this._preloadTiles(g),this):(this.fire(new l.Event("movestart",c)).fire(new l.Event("move",c)),b&&this.fire(new l.Event("zoomstart",c)).fire(new l.Event("zoom",c)).fire(new l.Event("zoomend",c)),C&&this.fire(new l.Event("rotatestart",c)).fire(new l.Event("rotate",c)).fire(new l.Event("rotateend",c)),I&&this.fire(new l.Event("pitchstart",c)).fire(new l.Event("pitch",c)).fire(new l.Event("pitchend",c)),this.fire(new l.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||l.warnOnce(Su),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,c){const g=this.transform;if(!g.projection.supportsFreeCamera)return l.warnOnce(Su),this;this.stop();const b=g.zoom,C=g.pitch,I=g.bearing;g.setFreeCameraOptions(t);const S=b!==g.zoom,U=C!==g.pitch,q=I!==g.bearing;return this.fire(new l.Event("movestart",c)).fire(new l.Event("move",c)),S&&this.fire(new l.Event("zoomstart",c)).fire(new l.Event("zoom",c)).fire(new l.Event("zoomend",c)),q&&this.fire(new l.Event("rotatestart",c)).fire(new l.Event("rotate",c)).fire(new l.Event("rotateend",c)),U&&this.fire(new l.Event("pitchstart",c)).fire(new l.Event("pitch",c)).fire(new l.Event("pitchend",c)),this.fire(new l.Event("moveend",c)),this}easeTo(t,c){this._stop(!1,t.easeId),(!1===(t=l.extend({offset:[0,0],duration:500,easing:l.ease},t)).animate||!t.essential&&l.exported.prefersReducedMotion)&&(t.duration=0);const g=this.transform,b=this.getZoom(),C=this.getBearing(),I=this.getPitch(),S=this.getPadding(),U="zoom"in t?+t.zoom:b,q="bearing"in t?this._normalizeBearing(t.bearing,C):C,J="pitch"in t?+t.pitch:I,ae="padding"in t?t.padding:g.padding,Te=l.pointGeometry.convert(t.offset);let Ve,Oe,xe;if("globe"===g.projection.name){const hn=l.MercatorCoordinate.fromLngLat(g.center),un=Te.rotate(-g.angle);hn.x+=un.x/g.worldSize,hn.y+=un.y/g.worldSize;const Un=hn.toLngLat(),Zt=l.LngLat.convert(t.center||Un);this._normalizeCenter(Zt),Ve=g.centerPoint.add(un),Oe=new l.pointGeometry(hn.x,hn.y).mult(g.worldSize),xe=new l.pointGeometry(l.mercatorXfromLng(Zt.lng),l.mercatorYfromLat(Zt.lat)).mult(g.worldSize).sub(Oe)}else{Ve=g.centerPoint.add(Te);const hn=g.pointLocation(Ve),un=l.LngLat.convert(t.center||hn);this._normalizeCenter(un),Oe=g.project(hn),xe=g.project(un).sub(Oe)}const at=g.zoomScale(U-b);let Ye,rt;t.around&&(Ye=l.LngLat.convert(t.around),rt=g.locationPoint(Ye));const ot=this._zooming||U!==b,mt=this._rotating||C!==q,nt=this._pitching||J!==I,bt=!g.isPaddingEqual(ae),Jt=hn=>un=>{if(ot&&(hn.zoom=l.number(b,U,un)),mt&&(hn.bearing=l.number(C,q,un)),nt&&(hn.pitch=l.number(I,J,un)),bt&&(hn.interpolatePadding(S,ae,un),Ve=hn.centerPoint.add(Te)),Ye)hn.setLocationAtPoint(Ye,rt);else{const Un=hn.zoomScale(hn.zoom-b),Zt=U>b?Math.min(2,at):Math.max(.5,at),Vn=Math.pow(Zt,1-un),Bn=hn.unproject(Oe.add(xe.mult(un*Vn)).mult(Un));hn.setLocationAtPoint(hn.renderWorldCopies?Bn.wrap():Bn,Ve)}return t.preloadOnly||this._fireMoveEvents(c),hn};if(t.preloadOnly){const hn=this._emulate(Jt,t.duration,g);return this._preloadTiles(hn),this}const rn={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ot,this._rotating=mt,this._pitching=nt,this._padding=bt,this._easeId=t.easeId,this._prepareEase(c,t.noMoveStart,rn),this._ease(Jt(g),hn=>{g.recenterOnTerrain(),this._afterEase(c,hn)},t),this}_prepareEase(t,c,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||g.moving||this.fire(new l.Event("movestart",t)),this._zooming&&!g.zooming&&this.fire(new l.Event("zoomstart",t)),this._rotating&&!g.rotating&&this.fire(new l.Event("rotatestart",t)),this._pitching&&!g.pitching&&this.fire(new l.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new l.Event("move",t)),this._zooming&&this.fire(new l.Event("zoom",t)),this._rotating&&this.fire(new l.Event("rotate",t)),this._pitching&&this.fire(new l.Event("pitch",t))}_afterEase(t,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,b=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new l.Event("zoomend",t)),b&&this.fire(new l.Event("rotateend",t)),C&&this.fire(new l.Event("pitchend",t)),this.fire(new l.Event("moveend",t))}flyTo(t,c){if(!t.essential&&l.exported.prefersReducedMotion){const ui=l.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ui,c)}this.stop(),t=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},t);const g=this.transform,b=this.getZoom(),C=this.getBearing(),I=this.getPitch(),S=this.getPadding(),U="zoom"in t?l.clamp(+t.zoom,g.minZoom,g.maxZoom):b,q="bearing"in t?this._normalizeBearing(t.bearing,C):C,J="pitch"in t?+t.pitch:I,ae="padding"in t?t.padding:g.padding,Te=g.zoomScale(U-b),Ve=l.pointGeometry.convert(t.offset);let Oe=g.centerPoint.add(Ve);const xe=g.pointLocation(Oe),at=l.LngLat.convert(t.center||xe);this._normalizeCenter(at);const Ye=g.project(xe),rt=g.project(at).sub(Ye);let ot=t.curve;const mt=Math.max(g.width,g.height),nt=mt/Te,bt=rt.mag();if("minZoom"in t){const ui=l.clamp(Math.min(t.minZoom,b,U),g.minZoom,g.maxZoom),si=mt/g.zoomScale(ui-b);ot=Math.sqrt(si/bt*2)}const Jt=ot*ot;function rn(ui){const si=(nt*nt-mt*mt+(ui?-1:1)*Jt*Jt*bt*bt)/(2*(ui?nt:mt)*Jt*bt);return Math.log(Math.sqrt(si*si+1)-si)}function hn(ui){return(Math.exp(ui)-Math.exp(-ui))/2}function un(ui){return(Math.exp(ui)+Math.exp(-ui))/2}const Un=rn(0);let Zt=function(ui){return un(Un)/un(Un+ot*ui)},Vn=function(ui){return mt*((un(Un)*(hn(si=Un+ot*ui)/un(si))-hn(Un))/Jt)/bt;var si},Bn=(rn(1)-Un)/ot;if(Math.abs(bt)<1e-6||!isFinite(Bn)){if(Math.abs(mt-nt)<1e-6)return this.easeTo(t,c);const ui=nt<mt?-1:1;Bn=Math.abs(Math.log(nt/mt))/ot,Vn=function(){return 0},Zt=function(si){return Math.exp(ui*ot*si)}}t.duration="duration"in t?+t.duration:1e3*Bn/("screenSpeed"in t?+t.screenSpeed/ot:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const li=C!==q,pn=J!==I,ci=!g.isPaddingEqual(ae),Ti=ui=>si=>{const Ei=si*Bn,qi=1/Zt(Ei);ui.zoom=1===si?U:b+ui.scaleZoom(qi),li&&(ui.bearing=l.number(C,q,si)),pn&&(ui.pitch=l.number(I,J,si)),ci&&(ui.interpolatePadding(S,ae,si),Oe=ui.centerPoint.add(Ve));const _i=1===si?at:ui.unproject(Ye.add(rt.mult(Vn(Ei))).mult(qi));return ui.setLocationAtPoint(ui.renderWorldCopies?_i.wrap():_i,Oe),ui._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(c),ui};if(t.preloadOnly){const ui=this._emulate(Ti,t.duration,g);return this._preloadTiles(ui),this}return this._zooming=!0,this._rotating=li,this._pitching=pn,this._padding=ci,this._prepareEase(c,!1),this._ease(Ti(g),()=>this._afterEase(c),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,c)}if(!t){const g=this.handlers;g&&g.stop(!1)}return this}_ease(t,c,g){!1===g.animate||0===g.duration?(t(1),c()):(this._easeStart=l.exported.now(),this._easeOptions=g,this._onEaseFrame=t,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,c){t=l.wrap(t,-180,180);const g=Math.abs(t-c);return Math.abs(t-360-c)<g&&(t-=360),Math.abs(t+360-c)<g&&(t+=360),t}_normalizeCenter(t){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const g=t.lng-c.center.lng;t.lng+=g>180?-360:g<-180?360:0}_emulate(t,c,g){const b=Math.ceil(15*c/1e3),C=[],I=t(g.clone());for(let S=0;S<=b;S++){const U=I(S/b);C.push(U.clone())}return C}}class lo{constructor(t={}){this.options=t,l.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const c=this.options&&this.options.compact;return this._map=t,this._container=De("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=De("button","mapboxgl-ctrl-attrib-button",this._container),De("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=De("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,c){const g=this._map._getUIString(`AttributionControl.${c}`);t.setAttribute("aria-label",g),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||l.config.ACCESS_TOKEN}];if(t){const g=c.reduce((b,C,I)=>(C.value&&(b+=`${C.key}=${C.value}${I<c.length-1?"&":""}`),b),"?");t.href=`${l.config.FEEDBACK_URL}/${g}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const c=this._map.style._sourceCaches;for(const b in c){const C=c[b];if(C.used){const I=C.getSource();I.attribution&&t.indexOf(I.attribution)<0&&t.push(I.attribution)}}t.sort((b,C)=>b.length-C.length),t=t.filter((b,C)=>{for(let I=C+1;I<t.length;I++)if(t[I].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const g=t.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,t.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ad{constructor(){l.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=De("div","mapboxgl-ctrl");const c=De("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const c in t){const g=t[c].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const c=t[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Ah{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const c=++this._id;return this._queue.push({callback:t,id:c,cancelled:!1}),c}remove(t){const c=this._currentlyRunning,g=c?this._queue.concat(c):this._queue;for(const b of g)if(b.id===t)return void(b.cancelled=!0)}run(t=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const g of c)if(!g.cancelled&&(g.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ou(p,t,c){if(p=new l.LngLat(p.lng,p.lat),t){const g=new l.LngLat(p.lng-360,p.lat),b=new l.LngLat(p.lng+360,p.lat),C=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),I=c.locationPoint(p).distSqr(t),S=t.x<0||t.y<0||t.x>c.width||t.y>c.height;c.locationPoint(g).distSqr(t)<I&&(S||Math.abs(g.lng-c.center.lng)<C)?p=g:c.locationPoint(b).distSqr(t)<I&&(S||Math.abs(b.lng-c.center.lng)<C)&&(p=b)}for(;Math.abs(p.lng-c.center.lng)>180;){const g=c.locationPoint(p);if(g.x>=0&&g.y>=0&&g.x<=c.width&&g.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const Lu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ru extends l.Evented{constructor(t,c){if(super(),(t instanceof l.window.HTMLElement||c)&&(t=l.extend({element:t},c)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=l.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=De("div");const b=41,C=27,I=ge("svg",{display:"block",height:b*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${b}`},this._element),S=ge("radialGradient",{id:"shadowGradient"},ge("defs",{},I));ge("stop",{offset:"10%","stop-opacity":.4},S),ge("stop",{offset:"100%","stop-opacity":.05},S),ge("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),ge("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),ge("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),ge("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=l.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const g=this._element.classList;for(const b in Lu)g.remove(`mapboxgl-marker-anchor-${b}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const c=t.code,g=t.charCode||t.keyCode;"Space"!==c&&"Enter"!==c&&32!==g&&13!==g||this.togglePopup()}_onMapClick(t){const c=t.originalEvent.target,g=this._element;this._popup&&(c===g||g.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const t=this._map;if(!t)return;const c=this._pos;if(!c||c.x<0||c.x>t.transform.width||c.y<0||c.y>t.transform.height)return void this._clearFadeTimer();const g=t.unproject(c);let b=!1;if(t.transform._terrainEnabled()&&t.getTerrain()){const I=t.getFreeCameraOptions();if(I.position){const S=I.position.toLngLat();b=S.distanceTo(g)<.9*S.distanceTo(this._lngLat)}}const C=(1-t._queryFogOpacity(g))*(b?.2:1);this._element.style.opacity=`${C}`,this._popup&&this._popup._setOpacity(`${C}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t)return;const c=this._offset.mult(this._scale),g=this._calculatePitch(),b=this._calculateRotation();this._element.style.transform=`\n            translate(${t.x}px, ${t.y}px) ${Lu[this._anchor]}\n            rotateX(${g}deg) rotateZ(${b}deg)\n            translate(${c.x}px, ${c.y}px)\n        `}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:this._map&&"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:this._map&&"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(t){l.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Ou(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),!0===t?this._updateFrameId=l.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!c.getTerrain()&&!c.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=l.pointGeometry.convert(t),this._update(),this}_onMove(t){const c=this._map;if(c){if(!this._isDragging){const g=this._clickTolerance||c._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(t){const c=this._map;c&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos),this._pointerdownPos=t.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const c=this._map;return c&&(t?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Qp{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const c=l.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,c,g){this._start=this.getValue(c),this._end=t,this._startTime=c,this._endTime=c+g}}const ef={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},wl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function qc(p){p.parentNode&&p.parentNode.removeChild(p)}const Io={showCompass:!0,showZoom:!0,visualizePitch:!1};class _c{constructor(t,c,g=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new la({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,g&&(this.mousePitch=new z({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(t,c){this.mouseRotate.mousedown(t,c),this.mousePitch&&this.mousePitch.mousedown(t,c),Ie()}move(t,c){const g=this.map,b=this.mouseRotate.mousemoveWindow(t,c),C=b&&b.bearingDelta;if(C&&g.setBearing(g.getBearing()+C),this.mousePitch){const I=this.mousePitch.mousemoveWindow(t,c),S=I&&I.pitchDelta;S&&g.setPitch(g.getPitch()+S)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){we(),l.window.removeEventListener("mousemove",this.mousemove),l.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(l.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),ke(this.element,t)),l.window.addEventListener("mousemove",this.mousemove),l.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,ke(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=He(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=He(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const jo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Js,yc=0,Zo=!1;const Xs={maxWidth:100,unit:"metric"};function vc(p,t,c){const g=c&&c.maxWidth||100,b=p._containerHeight/2,C=p._containerWidth/2-g/2,I=p.unproject([C,b]),S=p.unproject([C+g,b]),U=I.distanceTo(S);if(c&&"imperial"===c.unit){const q=3.2808*U;q>5280?La(t,g,q/5280,p._getUIString("ScaleControl.Miles"),p):La(t,g,q,p._getUIString("ScaleControl.Feet"),p)}else c&&"nautical"===c.unit?La(t,g,U/1852,p._getUIString("ScaleControl.NauticalMiles"),p):U>=1e3?La(t,g,U/1e3,p._getUIString("ScaleControl.Kilometers"),p):La(t,g,U,p._getUIString("ScaleControl.Meters"),p)}function La(p,t,c,g,b){const C=function(S){const U=Math.pow(10,`${Math.floor(S)}`.length-1);let q=S/U;return q=q>=10?10:q>=5?5:q>=3?3:q>=2?2:q>=1?1:function(J){const ae=Math.pow(10,Math.ceil(-Math.log(J)/Math.LN10));return Math.round(J*ae)/ae}(q),U*q}(c),I=C/c;b._requestDomTask(()=>{p.style.width=t*I+"px",p.innerHTML=`${C}&nbsp;${g}`})}const cs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xc(p=new l.pointGeometry(0,0),t="bottom"){if("number"==typeof p){const c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(t){case"top":return new l.pointGeometry(0,p);case"top-left":return new l.pointGeometry(c,c);case"top-right":return new l.pointGeometry(-c,c);case"bottom":return new l.pointGeometry(0,-p);case"bottom-left":return new l.pointGeometry(c,-c);case"bottom-right":return new l.pointGeometry(-c,-c);case"left":return new l.pointGeometry(p,0);case"right":return new l.pointGeometry(-p,0)}return new l.pointGeometry(0,0)}return p instanceof l.pointGeometry||Array.isArray(p)?l.pointGeometry.convert(p):l.pointGeometry.convert(p[t]||[0,0])}const Hl={version:l.version,supported:ie,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends Pu{constructor(p){if(null!=(p=l.extend({},wl,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&l.isSafariWithAntialiasingBug(l.window)&&(p.antialias=!1,l.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new $l(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._renderTaskQueue=new Ah,this._domRenderTaskQueue=new Ah,this._controls=[],this._markers=[],this._mapId=l.uniqueId(),this._locale=l.extend({},ef,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Qp(0),this._explicitProjection=null,this._requestManager=new l.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=l.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof l.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&l.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==l.window&&(l.window.addEventListener("online",this._onWindowOnline,!1),l.window.addEventListener("resize",this._onWindowResize,!1),l.window.addEventListener("orientationchange",this._onWindowResize,!1),l.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new bl(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new Ja("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,l.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new lo({customAttribution:p.customAttribution})),this._logoControl=new Ad,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new l.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new l.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(p,t){if(void 0===t&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const g=this._controlPositions[t];return-1!==t.indexOf("bottom")?g.insertBefore(c,g.firstChild):g.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new l.Event("movestart",p)).fire(new l.Event("move",p)),this.fire(new l.Event("resize",p)),t&&this.fire(new l.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(l.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(p){return this._lazyInitEmptyStyle(),p?"string"==typeof p&&(p={name:p}):p=null,this._updateProjection(p)}_updateProjection(p){null===p&&(this._explicitProjection=null);const t=p||this.getProjection(),c=this.transform.setProjection(t);if(p&&(this._explicitProjection=this.transform.getProjection()),c){this.painter.clearBackgroundTiles();for(const g in this.style._sourceCaches)this.style._sourceCaches[g].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(p){return this.transform.locationPoint3D(l.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(l.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(p,t,c){if("mouseenter"===p||"mouseover"===p){let g=!1;const b=I=>{const S=t.filter(q=>this.getLayer(q)),U=S.length?this.queryRenderedFeatures(I.point,{layers:S}):[];U.length?g||(g=!0,c.call(this,new $o(p,this,I.originalEvent,{features:U}))):g=!1},C=()=>{g=!1};return{layers:new Set(t),listener:c,delegates:{mousemove:b,mouseout:C}}}if("mouseleave"===p||"mouseout"===p){let g=!1;const b=I=>{const S=t.filter(U=>this.getLayer(U));(S.length?this.queryRenderedFeatures(I.point,{layers:S}):[]).length?g=!0:g&&(g=!1,c.call(this,new $o(p,this,I.originalEvent)))},C=I=>{g&&(g=!1,c.call(this,new $o(p,this,I.originalEvent)))};return{layers:new Set(t),listener:c,delegates:{mousemove:b,mouseout:C}}}{const g=b=>{const C=t.filter(S=>this.getLayer(S)),I=C.length?this.queryRenderedFeatures(b.point,{layers:C}):[];I.length&&(b.features=I,c.call(this,b),delete b.features)};return{layers:new Set(t),listener:c,delegates:{[p]:g}}}}on(p,t,c){if(void 0===c)return super.on(p,t);Array.isArray(t)||(t=[t]);const g=this._createDelegatedListener(p,t,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(g);for(const b in g.delegates)this.on(b,g.delegates[b]);return this}once(p,t,c){if(void 0===c)return super.once(p,t);Array.isArray(t)||(t=[t]);const g=this._createDelegatedListener(p,t,c);for(const b in g.delegates)this.once(b,g.delegates[b]);return this}off(p,t,c){if(void 0===c)return super.off(p,t);t=new Set(Array.isArray(t)?t:[t]);const g=(C,I)=>{if(C.size!==I.size)return!1;for(const S of C)if(!I.has(S))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[p]:void 0;return b&&(C=>{for(let I=0;I<C.length;I++){const S=C[I];if(S.listener===c&&g(S.layers,t)){for(const U in S.delegates)this.off(U,S.delegates[U]);return C.splice(I,1),this}}})(b),this}queryRenderedFeatures(p,t){return this.style?(void 0!==t||void 0===p||p instanceof l.pointGeometry||Array.isArray(p)||(t=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}queryTerrainElevation(p,t){const c=this.transform.elevation;return c?(t=l.extend({},{exaggerated:!0},t),c.getAtPoint(l.MercatorCoordinate.fromLngLat(p),null,t.exaggerated)):null}setStyle(p,t){return!1!==(t=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(p,t))}_getUIString(p){const t=this._locale[p];if(null==t)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new eo(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new eo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if("string"==typeof p){const c=this._requestManager.normalizeStyleURL(p),g=this._requestManager.transformRequest(c,l.ResourceType.Style);l.getJSON(g,(b,C)=>{b?this.fire(new l.ErrorEvent(b)):C&&this._updateDiff(C,t)})}else"object"==typeof p&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p)&&this._update(!0)}catch(c){l.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(l.warnOnce("There is no style added to the map."),!1)}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const t in p){const c=p[t]._tiles;for(const g in c){const b=c[g];if("loaded"!==b.state&&"errored"!==b.state)return!1}}return!0}addSourceType(p,t,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,t,c)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,{pixelRatio:c=1,sdf:g=!1,stretchX:b,stretchY:C,content:I}={}){if(this._lazyInitEmptyStyle(),t instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&t instanceof l.window.ImageBitmap){const{width:S,height:U,data:q}=l.exported.getImageData(t);this.style.addImage(p,{data:new l.RGBAImage({width:S,height:U},q),pixelRatio:c,stretchX:b,stretchY:C,content:I,sdf:g,version:0})}else if(void 0===t.width||void 0===t.height)this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:U}=t,q=t;this.style.addImage(p,{data:new l.RGBAImage({width:S,height:U},new Uint8Array(q.data)),pixelRatio:c,stretchX:b,stretchY:C,content:I,sdf:g,version:0,userImage:q}),q.onAdd&&q.onAdd(this,p)}}updateImage(p,t){const c=this.style.getImage(p);if(!c)return void this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=t instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&t instanceof l.window.ImageBitmap?l.exported.getImageData(t):t,{width:b,height:C}=g;void 0!==b&&void 0!==C?b===c.data.width&&C===c.data.height?(c.data.replace(g.data,!(t instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&t instanceof l.window.ImageBitmap)),this.style.updateImage(p,c)):this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,t){l.getImage(this._requestManager.transformRequest(p,l.ResourceType.Image),(c,g)=>{t(c,g instanceof l.window.HTMLImageElement?l.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,t,c){return this.style.setLayerZoomRange(p,t,c),this._update(!0)}setFilter(p,t,c={}){return this.style.setFilter(p,t,c),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,c,g={}){return this.style.setPaintProperty(p,t,c,g),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,c,g={}){return this.style.setLayoutProperty(p,t,c,g),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(l.LngLat.convert(p),this.transform):0}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let c,g,b,C=this._container;for(;C&&(!g||!b);){const I=l.window.getComputedStyle(C).transform;I&&"none"!==I&&(c=I.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&"0"!==c[0]&&"1"!==c[0]&&(g=c[0]),c[3]&&"0"!==c[3]&&"1"!==c[3]&&(b=c[3])),C=C.parentElement}this._containerWidth=g?Math.abs(p/g):p,this._containerHeight=b?Math.abs(t/b):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==l.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&l.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=De("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=De("div","mapboxgl-canvas-container",p);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=De("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=De("div","mapboxgl-control-container",p),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{g[b]=De("div",`mapboxgl-ctrl-${b}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,t){const c=l.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(t),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const t=this._markers.indexOf(p);-1!==t&&this._markers.splice(t,1)}_setupPainter(){const p=l.extend({},ie.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);t?(l.storeAuthState(t,!0),this.painter=new Zc(t,this.transform),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),l.exported$1.testSupport(t)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let t;const c=this.painter.context.extTimerQuery,g=l.exported.now();if(this.listens("gpu-timing-frame")&&(t=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;let b=!1;const C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const U=this.transform.zoom,q=this.transform.pitch,J=l.exported.now();this.style.zoomHistory.update(U,J);const ae=new l.EvaluationParameters(U,{now:J,fadeDuration:C,pitch:q,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Te=ae.crossFadingFactor();1===Te&&Te===this._crossFadingFactor||(b=!0,this._crossFadingFactor=Te),this.style.update(ae)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let I=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),I=this._updateAverageElevation(g),this.style._updateSources(this.transform),this._forceMarkerUpdate()):I=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const U=l.exported.now()-g;c.endQueryEXT(c.TIME_ELAPSED_EXT,t),setTimeout(()=>{const q=c.getQueryObjectEXT(t,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(t),this.fire(new l.Event("gpu-timing-frame",{cpuTime:U,gpuTime:q}))},50)}if(this.listens("gpu-timing-layer")){const U=this.painter.collectGpuTimers();setTimeout(()=>{const q=this.painter.queryGpuTimers(U);this.fire(new l.Event("gpu-timing-layer",{layerTimes:q}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||I;if(S||this._repaint)this.triggerRepaint();else{const U=!this.isMoving()&&this.loaded();if(U&&(I=this._updateAverageElevation(g,!0)),I)this.triggerRepaint();else if(this._triggerFrame(!1),U&&(this.fire(new l.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const q=this._calculateSpeedIndex();this.fire(new l.Event("speedindexcompleted",{speedIndex:q})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,t=!1){const c=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((t||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const g=this.transform.averageElevation;let b=this.transform.sampleAverageElevation(),C=!1;this.transform.elevation&&(C=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=p;const I=Math.abs(g-b);if(I>1){if(this._isInitialLoad||C)return this._averageElevation.jumpTo(b),c(b);this._averageElevation.easeTo(b,p,300)}else if(I>1e-4)return this._averageElevation.jumpTo(b),c(b)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){l.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===l.AUTH_ERR_MSG||401===p.status)){const t=this.painter.context.gl;l.storeAuthState(t,!1),this._logoControl instanceof Ad&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new l.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),l.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const c=this.painter.context.gl,g=c.createFramebuffer();function b(C){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,C,0);const I=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,I),I}return c.bindFramebuffer(c.FRAMEBUFFER,g),this._canvasPixelComparison(b(p),t.canvasCopies.map(b),t.timeStamps)}_canvasPixelComparison(p,t,c){let g=c[1]-c[0];const b=p.length/4;for(let C=0;C<t.length;C++){const I=t[C];let S=0;for(let U=0;U<I.length;U+=4)I[U]===p[U]&&I[U+1]===p[U+1]&&I[U+2]===p[U+2]&&I[U+3]===p[U+3]&&(S+=1);g+=(c[C+2]-c[C+1])*(1-S/b)}return g}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==l.window&&(l.window.removeEventListener("resize",this._onWindowResize,!1),l.window.removeEventListener("orientationchange",this._onWindowResize,!1),l.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),qc(this._canvasContainer),qc(this._controlContainer),qc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),l.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=l.exported.frame(t=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(t)}))}_preloadTiles(p){const t=this.style?Object.values(this.style._sourceCaches):[];return l.asyncAll(t,(c,g)=>c._preloadTiles(p,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,t){l.setCacheLimits(p,t)}get version(){return l.version}},NavigationControl:class{constructor(p){this.options=l.extend({},Io,p),this._container=De("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),De("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),De("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:t}):c.resetNorth({},{originalEvent:t}))}),this._compassIcon=De("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const t=p.getZoom(),c=t===p.getMaxZoom(),g=t===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _c(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,t){const c=De("button",p,this._container);return c.type="button",c.addEventListener("click",t),c}_setButtonTitle(p,t){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${t}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends l.Evented{constructor(p){super(),this.options=l.extend({},jo,p),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=jl(this._updateMarkerRotation,20)}onAdd(p){var t;return this._map=p,this._container=De("div","mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,void 0!==Js?t(Js):void 0!==l.window.navigator.permissions?l.window.navigator.permissions.query({name:"geolocation"}).then(c=>{Js="denied"!==c.state,t(Js)}):(Js=!!l.window.navigator.geolocation,t(Js)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(l.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,yc=0,Zo=!1}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),c=p.coords;return!!t&&(c.longitude<t.getWest()||c.longitude>t.getEast()||c.latitude<t.getSouth()||c.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",p)),this._finish()}}_updateCamera(p){const t=new l.LngLat(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,g=this._map.getBearing(),b=l.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(c),b,{geolocateSource:!0})}_updateMarker(p){if(p){const t=new l.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map._containerHeight/2,t=this._map.unproject([0,p]),c=this._map.unproject([100,p]),g=t.distanceTo(c)/100,b=Math.ceil(2*this._accuracy/g);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&Zo)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=De("button","mapboxgl-ctrl-geolocate",this._container),De("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=De("div","mapboxgl-user-location"),this._dotElement.appendChild(De("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(De("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ru({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=De("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ru({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":yc--,Zo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),yc++,yc>1?(p={maximumAge:6e5,timeout:0},Zo=!0):(p=this.options.positionOptions,Zo=!1),this._geolocationWatchID=l.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else l.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{l.window.addEventListener("ondeviceorientationabsolute"in l.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==l.window.DeviceMotionEvent&&"function"==typeof l.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&p()}).catch(console.error):p()}_clearWatch(){l.window.navigator.geolocation.clearWatch(this._geolocationWatchID),l.window.removeEventListener("deviceorientation",this._onDeviceOrientation),l.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:lo,ScaleControl:class{constructor(p){this.options=l.extend({},Xs,p),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){vc(this._map,this._container,this.options)}onAdd(p){return this._map=p,this._container=De("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(p){this.options.unit=p,vc(this._map,this._container,this.options)}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof l.window.HTMLElement?this._container=p.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in l.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in l.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=De("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,l.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!l.window.document.fullscreenEnabled&&!l.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=De("button","mapboxgl-ctrl-fullscreen",this._controlContainer);De("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),l.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(l.window.document.fullscreenElement||l.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?l.window.document.exitFullscreen?l.window.document.exitFullscreen():l.window.document.webkitCancelFullScreen&&l.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends l.Evented{constructor(p){super(),this.options=l.extend(Object.create(cs),p),l.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=l.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(l.window.document.createTextNode(p))}setHTML(p){const t=l.window.document.createDocumentFragment(),c=l.window.document.createElement("body");let g;for(c.innerHTML=p;g=c.firstChild,g;)t.appendChild(g);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=De("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(p),this.options.closeButton){const c=this._closeButton=De("button","mapboxgl-popup-close-button",t);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let t;return this._classList.delete(p)?t=!1:(this._classList.add(p),t=!0),this._updateClassList(),t}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const t=this._map,c=this._container,g=this._pos;if(!t||!c||!g)return"bottom";const b=c.offsetWidth,C=c.offsetHeight,I=g.x<b/2,S=g.x>t.transform.width-b/2;if(g.y+p<C)return I?"top-left":S?"top-right":"top";if(g.y>t.transform.height-C){if(I)return"bottom-left";if(S)return"bottom-right"}return I?"left":S?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),p.className=t.join(" ")}_update(p){const t=this._map,c=this._content;if(!t||!this._lngLat&&!this._trackPointer||!c)return;let g=this._container;if(g||(g=this._container=De("div","mapboxgl-popup",t.getContainer()),this._tip=De("div","mapboxgl-popup-tip",g),g.appendChild(c)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ou(this._lngLat,this._pos,t.transform)),!this._trackPointer||p){const b=this._pos=this._trackPointer&&p?p:t.project(this._lngLat),C=xc(this.options.offset),I=this._anchor=this._getAnchor(C.y),S=xc(this.options.offset,I),U=b.add(S).round();t._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${Lu[I]} translate(${U.x}px,${U.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Gr);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._content&&(this._content.style.opacity=p),this._tip&&(this._tip.style.opacity=p)}},Marker:Ru,Style:eo,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,FreeCameraOptions:va,Evented:l.Evented,config:l.config,prewarm:function(){Xn().acquire(oi)},clearPrewarmedResources:function(){const p=Hn;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(oi),Hn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return l.config.ACCESS_TOKEN},set accessToken(p){l.config.ACCESS_TOKEN=p},get baseApiUrl(){return l.config.API_URL},set baseApiUrl(p){l.config.API_URL=p},get workerCount(){return Rn.workerCount},set workerCount(p){Rn.workerCount=p},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){l.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){l.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:l.exported.setNow,restoreNow:l.exported.restoreNow};return Hl}),d}()},1135:(Ln,At,k)=>{"use strict";k.d(At,{X:()=>m});var d=k(7579);class m extends d.x{constructor(l){super(),this._value=l}get value(){return this.getValue()}_subscribe(l){const ie=super._subscribe(l);return!ie.closed&&l.next(this._value),ie}getValue(){const{hasError:l,thrownError:ie,_value:re}=this;if(l)throw ie;return this._throwIfClosed(),re}next(l){super.next(this._value=l)}}},8306:(Ln,At,k)=>{"use strict";k.d(At,{y:()=>ge});var d=k(2961),m=k(727),ce=k(8822),l=k(4671);var v=k(2416),ne=k(576),De=k(2806);let ge=(()=>{class Ie{constructor(Ue){Ue&&(this._subscribe=Ue)}lift(Ue){const Ne=new Ie;return Ne.source=this,Ne.operator=Ue,Ne}subscribe(Ue,Ne,ke){const He=function se(Ie){return Ie&&Ie instanceof d.Lv||function ue(Ie){return Ie&&(0,ne.m)(Ie.next)&&(0,ne.m)(Ie.error)&&(0,ne.m)(Ie.complete)}(Ie)&&(0,m.Nn)(Ie)}(Ue)?Ue:new d.Hp(Ue,Ne,ke);return(0,De.x)(()=>{const{operator:We,source:Qe}=this;He.add(We?We.call(He,Qe):Qe?this._subscribe(He):this._trySubscribe(He))}),He}_trySubscribe(Ue){try{return this._subscribe(Ue)}catch(Ne){Ue.error(Ne)}}forEach(Ue,Ne){return new(Ne=X(Ne))((ke,He)=>{const We=new d.Hp({next:Qe=>{try{Ue(Qe)}catch(ve){He(ve),We.unsubscribe()}},error:He,complete:ke});this.subscribe(We)})}_subscribe(Ue){var Ne;return null===(Ne=this.source)||void 0===Ne?void 0:Ne.subscribe(Ue)}[ce.L](){return this}pipe(...Ue){return function re(Ie){return 0===Ie.length?l.y:1===Ie.length?Ie[0]:function(Ue){return Ie.reduce((Ne,ke)=>ke(Ne),Ue)}}(Ue)(this)}toPromise(Ue){return new(Ue=X(Ue))((Ne,ke)=>{let He;this.subscribe(We=>He=We,We=>ke(We),()=>Ne(He))})}}return Ie.create=we=>new Ie(we),Ie})();function X(Ie){var we;return null!==(we=Ie??v.v.Promise)&&void 0!==we?we:Promise}},7579:(Ln,At,k)=>{"use strict";k.d(At,{x:()=>v});var d=k(8306),m=k(727);const l=(0,k(3888).d)(De=>function(){De(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var ie=k(8737),re=k(2806);let v=(()=>{class De extends d.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(X){const ue=new ne(this,this);return ue.operator=X,ue}_throwIfClosed(){if(this.closed)throw new l}next(X){(0,re.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const ue of this.currentObservers)ue.next(X)}})}error(X){(0,re.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=X;const{observers:ue}=this;for(;ue.length;)ue.shift().error(X)}})}complete(){(0,re.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:X}=this;for(;X.length;)X.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var X;return(null===(X=this.observers)||void 0===X?void 0:X.length)>0}_trySubscribe(X){return this._throwIfClosed(),super._trySubscribe(X)}_subscribe(X){return this._throwIfClosed(),this._checkFinalizedStatuses(X),this._innerSubscribe(X)}_innerSubscribe(X){const{hasError:ue,isStopped:se,observers:Ie}=this;return ue||se?m.Lc:(this.currentObservers=null,Ie.push(X),new m.w0(()=>{this.currentObservers=null,(0,ie.P)(Ie,X)}))}_checkFinalizedStatuses(X){const{hasError:ue,thrownError:se,isStopped:Ie}=this;ue?X.error(se):Ie&&X.complete()}asObservable(){const X=new d.y;return X.source=this,X}}return De.create=(ge,X)=>new ne(ge,X),De})();class ne extends v{constructor(ge,X){super(),this.destination=ge,this.source=X}next(ge){var X,ue;null===(ue=null===(X=this.destination)||void 0===X?void 0:X.next)||void 0===ue||ue.call(X,ge)}error(ge){var X,ue;null===(ue=null===(X=this.destination)||void 0===X?void 0:X.error)||void 0===ue||ue.call(X,ge)}complete(){var ge,X;null===(X=null===(ge=this.destination)||void 0===ge?void 0:ge.complete)||void 0===X||X.call(ge)}_subscribe(ge){var X,ue;return null!==(ue=null===(X=this.source)||void 0===X?void 0:X.subscribe(ge))&&void 0!==ue?ue:m.Lc}}},2961:(Ln,At,k)=>{"use strict";k.d(At,{Hp:()=>Ue,Lv:()=>ue});var d=k(576),m=k(727),ce=k(2416),l=k(7849);function ie(){}const re=De("C",void 0,void 0);function De(Qe,ve,me){return{kind:Qe,value:ve,error:me}}var ge=k(3410),X=k(2806);class ue extends m.w0{constructor(ve){super(),this.isStopped=!1,ve?(this.destination=ve,(0,m.Nn)(ve)&&ve.add(this)):this.destination=We}static create(ve,me,Ze){return new Ue(ve,me,Ze)}next(ve){this.isStopped?He(function ne(Qe){return De("N",Qe,void 0)}(ve),this):this._next(ve)}error(ve){this.isStopped?He(function v(Qe){return De("E",void 0,Qe)}(ve),this):(this.isStopped=!0,this._error(ve))}complete(){this.isStopped?He(re,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(ve){this.destination.next(ve)}_error(ve){try{this.destination.error(ve)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const se=Function.prototype.bind;function Ie(Qe,ve){return se.call(Qe,ve)}class we{constructor(ve){this.partialObserver=ve}next(ve){const{partialObserver:me}=this;if(me.next)try{me.next(ve)}catch(Ze){Ne(Ze)}}error(ve){const{partialObserver:me}=this;if(me.error)try{me.error(ve)}catch(Ze){Ne(Ze)}else Ne(ve)}complete(){const{partialObserver:ve}=this;if(ve.complete)try{ve.complete()}catch(me){Ne(me)}}}class Ue extends ue{constructor(ve,me,Ze){let Pe;if(super(),(0,d.m)(ve)||!ve)Pe={next:ve??void 0,error:me??void 0,complete:Ze??void 0};else{let Ge;this&&ce.v.useDeprecatedNextContext?(Ge=Object.create(ve),Ge.unsubscribe=()=>this.unsubscribe(),Pe={next:ve.next&&Ie(ve.next,Ge),error:ve.error&&Ie(ve.error,Ge),complete:ve.complete&&Ie(ve.complete,Ge)}):Pe=ve}this.destination=new we(Pe)}}function Ne(Qe){ce.v.useDeprecatedSynchronousErrorHandling?(0,X.O)(Qe):(0,l.h)(Qe)}function He(Qe,ve){const{onStoppedNotification:me}=ce.v;me&&ge.z.setTimeout(()=>me(Qe,ve))}const We={closed:!0,next:ie,error:function ke(Qe){throw Qe},complete:ie}},727:(Ln,At,k)=>{"use strict";k.d(At,{Lc:()=>re,w0:()=>ie,Nn:()=>v});var d=k(576);const ce=(0,k(3888).d)(De=>function(X){De(this),this.message=X?`${X.length} errors occurred during unsubscription:\n${X.map((ue,se)=>`${se+1}) ${ue.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=X});var l=k(8737);class ie{constructor(ge){this.initialTeardown=ge,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let ge;if(!this.closed){this.closed=!0;const{_parentage:X}=this;if(X)if(this._parentage=null,Array.isArray(X))for(const Ie of X)Ie.remove(this);else X.remove(this);const{initialTeardown:ue}=this;if((0,d.m)(ue))try{ue()}catch(Ie){ge=Ie instanceof ce?Ie.errors:[Ie]}const{_finalizers:se}=this;if(se){this._finalizers=null;for(const Ie of se)try{ne(Ie)}catch(we){ge=ge??[],we instanceof ce?ge=[...ge,...we.errors]:ge.push(we)}}if(ge)throw new ce(ge)}}add(ge){var X;if(ge&&ge!==this)if(this.closed)ne(ge);else{if(ge instanceof ie){if(ge.closed||ge._hasParent(this))return;ge._addParent(this)}(this._finalizers=null!==(X=this._finalizers)&&void 0!==X?X:[]).push(ge)}}_hasParent(ge){const{_parentage:X}=this;return X===ge||Array.isArray(X)&&X.includes(ge)}_addParent(ge){const{_parentage:X}=this;this._parentage=Array.isArray(X)?(X.push(ge),X):X?[X,ge]:ge}_removeParent(ge){const{_parentage:X}=this;X===ge?this._parentage=null:Array.isArray(X)&&(0,l.P)(X,ge)}remove(ge){const{_finalizers:X}=this;X&&(0,l.P)(X,ge),ge instanceof ie&&ge._removeParent(this)}}ie.EMPTY=(()=>{const De=new ie;return De.closed=!0,De})();const re=ie.EMPTY;function v(De){return De instanceof ie||De&&"closed"in De&&(0,d.m)(De.remove)&&(0,d.m)(De.add)&&(0,d.m)(De.unsubscribe)}function ne(De){(0,d.m)(De)?De():De.unsubscribe()}},2416:(Ln,At,k)=>{"use strict";k.d(At,{v:()=>d});const d={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},7272:(Ln,At,k)=>{"use strict";k.d(At,{z:()=>ie});var d=k(8189),ce=k(7669),l=k(2076);function ie(...re){return function m(){return(0,d.J)(1)}()((0,l.D)(re,(0,ce.yG)(re)))}},9770:(Ln,At,k)=>{"use strict";k.d(At,{P:()=>ce});var d=k(8306),m=k(8421);function ce(l){return new d.y(ie=>{(0,m.Xf)(l()).subscribe(ie)})}},515:(Ln,At,k)=>{"use strict";k.d(At,{E:()=>m});const m=new(k(8306).y)(ie=>ie.complete())},4128:(Ln,At,k)=>{"use strict";k.d(At,{D:()=>ne});var d=k(8306),m=k(4742),ce=k(8421),l=k(7669),ie=k(5403),re=k(3268),v=k(1810);function ne(...De){const ge=(0,l.jO)(De),{args:X,keys:ue}=(0,m.D)(De),se=new d.y(Ie=>{const{length:we}=X;if(!we)return void Ie.complete();const Ue=new Array(we);let Ne=we,ke=we;for(let He=0;He<we;He++){let We=!1;(0,ce.Xf)(X[He]).subscribe((0,ie.x)(Ie,Qe=>{We||(We=!0,ke--),Ue[He]=Qe},()=>Ne--,void 0,()=>{(!Ne||!We)&&(ke||Ie.next(ue?(0,v.n)(ue,Ue):Ue),Ie.complete())}))}});return ge?se.pipe((0,re.Z)(ge)):se}},2076:(Ln,At,k)=>{"use strict";k.d(At,{D:()=>Ze});var d=k(8421),m=k(9672),ce=k(4482),l=k(5403);function ie(Pe,Ge=0){return(0,ce.e)((tt,ye)=>{tt.subscribe((0,l.x)(ye,Ae=>(0,m.f)(ye,Pe,()=>ye.next(Ae),Ge),()=>(0,m.f)(ye,Pe,()=>ye.complete(),Ge),Ae=>(0,m.f)(ye,Pe,()=>ye.error(Ae),Ge)))})}function re(Pe,Ge=0){return(0,ce.e)((tt,ye)=>{ye.add(Pe.schedule(()=>tt.subscribe(ye),Ge))})}var De=k(8306),X=k(2202),ue=k(576);function Ie(Pe,Ge){if(!Pe)throw new Error("Iterable cannot be null");return new De.y(tt=>{(0,m.f)(tt,Ge,()=>{const ye=Pe[Symbol.asyncIterator]();(0,m.f)(tt,Ge,()=>{ye.next().then(Ae=>{Ae.done?tt.complete():tt.next(Ae.value)})},0,!0)})})}var we=k(3670),Ue=k(8239),Ne=k(1144),ke=k(6495),He=k(2206),We=k(4532),Qe=k(3260);function Ze(Pe,Ge){return Ge?function me(Pe,Ge){if(null!=Pe){if((0,we.c)(Pe))return function v(Pe,Ge){return(0,d.Xf)(Pe).pipe(re(Ge),ie(Ge))}(Pe,Ge);if((0,Ne.z)(Pe))return function ge(Pe,Ge){return new De.y(tt=>{let ye=0;return Ge.schedule(function(){ye===Pe.length?tt.complete():(tt.next(Pe[ye++]),tt.closed||this.schedule())})})}(Pe,Ge);if((0,Ue.t)(Pe))return function ne(Pe,Ge){return(0,d.Xf)(Pe).pipe(re(Ge),ie(Ge))}(Pe,Ge);if((0,He.D)(Pe))return Ie(Pe,Ge);if((0,ke.T)(Pe))return function se(Pe,Ge){return new De.y(tt=>{let ye;return(0,m.f)(tt,Ge,()=>{ye=Pe[X.h](),(0,m.f)(tt,Ge,()=>{let Ae,Be;try{({value:Ae,done:Be}=ye.next())}catch(st){return void tt.error(st)}Be?tt.complete():tt.next(Ae)},0,!0)}),()=>(0,ue.m)(null==ye?void 0:ye.return)&&ye.return()})}(Pe,Ge);if((0,Qe.L)(Pe))return function ve(Pe,Ge){return Ie((0,Qe.Q)(Pe),Ge)}(Pe,Ge)}throw(0,We.z)(Pe)}(Pe,Ge):(0,d.Xf)(Pe)}},4968:(Ln,At,k)=>{"use strict";k.d(At,{R:()=>ge});var d=k(8421),m=k(8306),ce=k(5577),l=k(1144),ie=k(576),re=k(3268);const v=["addListener","removeListener"],ne=["addEventListener","removeEventListener"],De=["on","off"];function ge(we,Ue,Ne,ke){if((0,ie.m)(Ne)&&(ke=Ne,Ne=void 0),ke)return ge(we,Ue,Ne).pipe((0,re.Z)(ke));const[He,We]=function Ie(we){return(0,ie.m)(we.addEventListener)&&(0,ie.m)(we.removeEventListener)}(we)?ne.map(Qe=>ve=>we[Qe](Ue,ve,Ne)):function ue(we){return(0,ie.m)(we.addListener)&&(0,ie.m)(we.removeListener)}(we)?v.map(X(we,Ue)):function se(we){return(0,ie.m)(we.on)&&(0,ie.m)(we.off)}(we)?De.map(X(we,Ue)):[];if(!He&&(0,l.z)(we))return(0,ce.z)(Qe=>ge(Qe,Ue,Ne))((0,d.Xf)(we));if(!He)throw new TypeError("Invalid event target");return new m.y(Qe=>{const ve=(...me)=>Qe.next(1<me.length?me:me[0]);return He(ve),()=>We(ve)})}function X(we,Ue){return Ne=>ke=>we[Ne](Ue,ke)}},8421:(Ln,At,k)=>{"use strict";k.d(At,{Xf:()=>se});var d=k(5987),m=k(1144),ce=k(8239),l=k(8306),ie=k(3670),re=k(2206),v=k(4532),ne=k(6495),De=k(3260),ge=k(576),X=k(7849),ue=k(8822);function se(Qe){if(Qe instanceof l.y)return Qe;if(null!=Qe){if((0,ie.c)(Qe))return function Ie(Qe){return new l.y(ve=>{const me=Qe[ue.L]();if((0,ge.m)(me.subscribe))return me.subscribe(ve);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(Qe);if((0,m.z)(Qe))return function we(Qe){return new l.y(ve=>{for(let me=0;me<Qe.length&&!ve.closed;me++)ve.next(Qe[me]);ve.complete()})}(Qe);if((0,ce.t)(Qe))return function Ue(Qe){return new l.y(ve=>{Qe.then(me=>{ve.closed||(ve.next(me),ve.complete())},me=>ve.error(me)).then(null,X.h)})}(Qe);if((0,re.D)(Qe))return ke(Qe);if((0,ne.T)(Qe))return function Ne(Qe){return new l.y(ve=>{for(const me of Qe)if(ve.next(me),ve.closed)return;ve.complete()})}(Qe);if((0,De.L)(Qe))return function He(Qe){return ke((0,De.Q)(Qe))}(Qe)}throw(0,v.z)(Qe)}function ke(Qe){return new l.y(ve=>{(function We(Qe,ve){var me,Ze,Pe,Ge;return(0,d.mG)(this,void 0,void 0,function*(){try{for(me=(0,d.KL)(Qe);!(Ze=yield me.next()).done;)if(ve.next(Ze.value),ve.closed)return}catch(tt){Pe={error:tt}}finally{try{Ze&&!Ze.done&&(Ge=me.return)&&(yield Ge.call(me))}finally{if(Pe)throw Pe.error}}ve.complete()})})(Qe,ve).catch(me=>ve.error(me))})}},9646:(Ln,At,k)=>{"use strict";k.d(At,{of:()=>ce});var d=k(7669),m=k(2076);function ce(...l){const ie=(0,d.yG)(l);return(0,m.D)(l,ie)}},5403:(Ln,At,k)=>{"use strict";k.d(At,{x:()=>m});var d=k(2961);function m(l,ie,re,v,ne){return new ce(l,ie,re,v,ne)}class ce extends d.Lv{constructor(ie,re,v,ne,De,ge){super(ie),this.onFinalize=De,this.shouldUnsubscribe=ge,this._next=re?function(X){try{re(X)}catch(ue){ie.error(ue)}}:super._next,this._error=ne?function(X){try{ne(X)}catch(ue){ie.error(ue)}finally{this.unsubscribe()}}:super._error,this._complete=v?function(){try{v()}catch(X){ie.error(X)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var ie;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:re}=this;super.unsubscribe(),!re&&(null===(ie=this.onFinalize)||void 0===ie||ie.call(this))}}}},4351:(Ln,At,k)=>{"use strict";k.d(At,{b:()=>ce});var d=k(5577),m=k(576);function ce(l,ie){return(0,m.m)(ie)?(0,d.z)(l,ie,1):(0,d.z)(l,1)}},9300:(Ln,At,k)=>{"use strict";k.d(At,{h:()=>ce});var d=k(4482),m=k(5403);function ce(l,ie){return(0,d.e)((re,v)=>{let ne=0;re.subscribe((0,m.x)(v,De=>l.call(ie,De,ne++)&&v.next(De)))})}},4004:(Ln,At,k)=>{"use strict";k.d(At,{U:()=>ce});var d=k(4482),m=k(5403);function ce(l,ie){return(0,d.e)((re,v)=>{let ne=0;re.subscribe((0,m.x)(v,De=>{v.next(l.call(ie,De,ne++))}))})}},8189:(Ln,At,k)=>{"use strict";k.d(At,{J:()=>ce});var d=k(5577),m=k(4671);function ce(l=1/0){return(0,d.z)(m.y,l)}},5577:(Ln,At,k)=>{"use strict";k.d(At,{z:()=>ne});var d=k(4004),m=k(8421),ce=k(4482),l=k(9672),ie=k(5403),v=k(576);function ne(De,ge,X=1/0){return(0,v.m)(ge)?ne((ue,se)=>(0,d.U)((Ie,we)=>ge(ue,Ie,se,we))((0,m.Xf)(De(ue,se))),X):("number"==typeof ge&&(X=ge),(0,ce.e)((ue,se)=>function re(De,ge,X,ue,se,Ie,we,Ue){const Ne=[];let ke=0,He=0,We=!1;const Qe=()=>{We&&!Ne.length&&!ke&&ge.complete()},ve=Ze=>ke<ue?me(Ze):Ne.push(Ze),me=Ze=>{Ie&&ge.next(Ze),ke++;let Pe=!1;(0,m.Xf)(X(Ze,He++)).subscribe((0,ie.x)(ge,Ge=>{null==se||se(Ge),Ie?ve(Ge):ge.next(Ge)},()=>{Pe=!0},void 0,()=>{if(Pe)try{for(ke--;Ne.length&&ke<ue;){const Ge=Ne.shift();we?(0,l.f)(ge,we,()=>me(Ge)):me(Ge)}Qe()}catch(Ge){ge.error(Ge)}}))};return De.subscribe((0,ie.x)(ge,ve,()=>{We=!0,Qe()})),()=>{null==Ue||Ue()}}(ue,se,De,X)))}},3099:(Ln,At,k)=>{"use strict";k.d(At,{B:()=>re});var d=k(2076),m=k(5698),ce=k(7579),l=k(2961),ie=k(4482);function re(ne={}){const{connector:De=(()=>new ce.x),resetOnError:ge=!0,resetOnComplete:X=!0,resetOnRefCountZero:ue=!0}=ne;return se=>{let Ie=null,we=null,Ue=null,Ne=0,ke=!1,He=!1;const We=()=>{null==we||we.unsubscribe(),we=null},Qe=()=>{We(),Ie=Ue=null,ke=He=!1},ve=()=>{const me=Ie;Qe(),null==me||me.unsubscribe()};return(0,ie.e)((me,Ze)=>{Ne++,!He&&!ke&&We();const Pe=Ue=Ue??De();Ze.add(()=>{Ne--,0===Ne&&!He&&!ke&&(we=v(ve,ue))}),Pe.subscribe(Ze),Ie||(Ie=new l.Hp({next:Ge=>Pe.next(Ge),error:Ge=>{He=!0,We(),we=v(Qe,ge,Ge),Pe.error(Ge)},complete:()=>{ke=!0,We(),we=v(Qe,X),Pe.complete()}}),(0,d.D)(me).subscribe(Ie))})(se)}}function v(ne,De,...ge){return!0===De?(ne(),null):!1===De?null:De(...ge).pipe((0,m.q)(1)).subscribe(()=>ne())}},3900:(Ln,At,k)=>{"use strict";k.d(At,{w:()=>l});var d=k(8421),m=k(4482),ce=k(5403);function l(ie,re){return(0,m.e)((v,ne)=>{let De=null,ge=0,X=!1;const ue=()=>X&&!De&&ne.complete();v.subscribe((0,ce.x)(ne,se=>{null==De||De.unsubscribe();let Ie=0;const we=ge++;(0,d.Xf)(ie(se,we)).subscribe(De=(0,ce.x)(ne,Ue=>ne.next(re?re(se,Ue,we,Ie++):Ue),()=>{De=null,ue()}))},()=>{X=!0,ue()}))})}},5698:(Ln,At,k)=>{"use strict";k.d(At,{q:()=>l});var d=k(515),m=k(4482),ce=k(5403);function l(ie){return ie<=0?()=>d.E:(0,m.e)((re,v)=>{let ne=0;re.subscribe((0,ce.x)(v,De=>{++ne<=ie&&(v.next(De),ie<=ne&&v.complete())}))})}},6063:(Ln,At,k)=>{"use strict";k.d(At,{l:()=>d});const d={now:()=>(d.delegate||Date).now(),delegate:void 0}},3410:(Ln,At,k)=>{"use strict";k.d(At,{z:()=>d});const d={setTimeout(m,ce,...l){const{delegate:ie}=d;return(null==ie?void 0:ie.setTimeout)?ie.setTimeout(m,ce,...l):setTimeout(m,ce,...l)},clearTimeout(m){const{delegate:ce}=d;return((null==ce?void 0:ce.clearTimeout)||clearTimeout)(m)},delegate:void 0}},2202:(Ln,At,k)=>{"use strict";k.d(At,{h:()=>m});const m=function d(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},8822:(Ln,At,k)=>{"use strict";k.d(At,{L:()=>d});const d="function"==typeof Symbol&&Symbol.observable||"@@observable"},7669:(Ln,At,k)=>{"use strict";k.d(At,{_6:()=>re,jO:()=>l,yG:()=>ie});var d=k(576);function ce(v){return v[v.length-1]}function l(v){return(0,d.m)(ce(v))?v.pop():void 0}function ie(v){return function m(v){return v&&(0,d.m)(v.schedule)}(ce(v))?v.pop():void 0}function re(v,ne){return"number"==typeof ce(v)?v.pop():ne}},4742:(Ln,At,k)=>{"use strict";k.d(At,{D:()=>ie});const{isArray:d}=Array,{getPrototypeOf:m,prototype:ce,keys:l}=Object;function ie(v){if(1===v.length){const ne=v[0];if(d(ne))return{args:ne,keys:null};if(function re(v){return v&&"object"==typeof v&&m(v)===ce}(ne)){const De=l(ne);return{args:De.map(ge=>ne[ge]),keys:De}}}return{args:v,keys:null}}},8737:(Ln,At,k)=>{"use strict";function d(m,ce){if(m){const l=m.indexOf(ce);0<=l&&m.splice(l,1)}}k.d(At,{P:()=>d})},3888:(Ln,At,k)=>{"use strict";function d(m){const l=m(ie=>{Error.call(ie),ie.stack=(new Error).stack});return l.prototype=Object.create(Error.prototype),l.prototype.constructor=l,l}k.d(At,{d:()=>d})},1810:(Ln,At,k)=>{"use strict";function d(m,ce){return m.reduce((l,ie,re)=>(l[ie]=ce[re],l),{})}k.d(At,{n:()=>d})},2806:(Ln,At,k)=>{"use strict";k.d(At,{O:()=>l,x:()=>ce});var d=k(2416);let m=null;function ce(ie){if(d.v.useDeprecatedSynchronousErrorHandling){const re=!m;if(re&&(m={errorThrown:!1,error:null}),ie(),re){const{errorThrown:v,error:ne}=m;if(m=null,v)throw ne}}else ie()}function l(ie){d.v.useDeprecatedSynchronousErrorHandling&&m&&(m.errorThrown=!0,m.error=ie)}},9672:(Ln,At,k)=>{"use strict";function d(m,ce,l,ie=0,re=!1){const v=ce.schedule(function(){l(),re?m.add(this.schedule(null,ie)):this.unsubscribe()},ie);if(m.add(v),!re)return v}k.d(At,{f:()=>d})},4671:(Ln,At,k)=>{"use strict";function d(m){return m}k.d(At,{y:()=>d})},1144:(Ln,At,k)=>{"use strict";k.d(At,{z:()=>d});const d=m=>m&&"number"==typeof m.length&&"function"!=typeof m},2206:(Ln,At,k)=>{"use strict";k.d(At,{D:()=>m});var d=k(576);function m(ce){return Symbol.asyncIterator&&(0,d.m)(null==ce?void 0:ce[Symbol.asyncIterator])}},576:(Ln,At,k)=>{"use strict";function d(m){return"function"==typeof m}k.d(At,{m:()=>d})},3670:(Ln,At,k)=>{"use strict";k.d(At,{c:()=>ce});var d=k(8822),m=k(576);function ce(l){return(0,m.m)(l[d.L])}},6495:(Ln,At,k)=>{"use strict";k.d(At,{T:()=>ce});var d=k(2202),m=k(576);function ce(l){return(0,m.m)(null==l?void 0:l[d.h])}},8239:(Ln,At,k)=>{"use strict";k.d(At,{t:()=>m});var d=k(576);function m(ce){return(0,d.m)(null==ce?void 0:ce.then)}},3260:(Ln,At,k)=>{"use strict";k.d(At,{L:()=>l,Q:()=>ce});var d=k(5987),m=k(576);function ce(ie){return(0,d.FC)(this,arguments,function*(){const v=ie.getReader();try{for(;;){const{value:ne,done:De}=yield(0,d.qq)(v.read());if(De)return yield(0,d.qq)(void 0);yield yield(0,d.qq)(ne)}}finally{v.releaseLock()}})}function l(ie){return(0,m.m)(null==ie?void 0:ie.getReader)}},4482:(Ln,At,k)=>{"use strict";k.d(At,{A:()=>m,e:()=>ce});var d=k(576);function m(l){return(0,d.m)(null==l?void 0:l.lift)}function ce(l){return ie=>{if(m(ie))return ie.lift(function(re){try{return l(re,this)}catch(v){this.error(v)}});throw new TypeError("Unable to lift unknown Observable type")}}},3268:(Ln,At,k)=>{"use strict";k.d(At,{Z:()=>l});var d=k(4004);const{isArray:m}=Array;function l(ie){return(0,d.U)(re=>function ce(ie,re){return m(re)?ie(...re):ie(re)}(ie,re))}},7849:(Ln,At,k)=>{"use strict";k.d(At,{h:()=>ce});var d=k(2416),m=k(3410);function ce(l){m.z.setTimeout(()=>{const{onUnhandledError:ie}=d.v;if(!ie)throw l;ie(l)})}},4532:(Ln,At,k)=>{"use strict";function d(m){return new TypeError(`You provided ${null!==m&&"object"==typeof m?"an invalid object":`'${m}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}k.d(At,{z:()=>d})},863:(Ln,At,k)=>{var d={"./ion-accordion_2.entry.js":[9654,8592,9654],"./ion-action-sheet.entry.js":[3648,8592,3648],"./ion-alert.entry.js":[1118,8592,1118],"./ion-app_8.entry.js":[53,8592,53],"./ion-avatar_3.entry.js":[4753,8592,4753],"./ion-back-button.entry.js":[2073,8592,2073],"./ion-backdrop.entry.js":[8939,8939],"./ion-breadcrumb_2.entry.js":[7544,8592,7544],"./ion-button_2.entry.js":[5652,8592,5652],"./ion-card_5.entry.js":[5929,8592,388],"./ion-checkbox.entry.js":[9922,8592,9922],"./ion-chip.entry.js":[657,8592,657],"./ion-col_3.entry.js":[9824,9824],"./ion-datetime_3.entry.js":[4959,8592,4959],"./ion-fab_3.entry.js":[5836,8592,5836],"./ion-img.entry.js":[1033,1033],"./ion-infinite-scroll_2.entry.js":[8034,8592,8034],"./ion-input.entry.js":[1217,8592,1217],"./ion-item-option_3.entry.js":[2933,8592,2933],"./ion-item_8.entry.js":[4711,8592,4711],"./ion-loading.entry.js":[9434,8592,9434],"./ion-menu_3.entry.js":[8136,8592,8136],"./ion-modal.entry.js":[2349,8592,2349],"./ion-nav_2.entry.js":[5349,8592,5349],"./ion-picker-column-internal.entry.js":[7602,8592,7602],"./ion-picker-internal.entry.js":[9016,9016],"./ion-popover.entry.js":[3804,8592,3804],"./ion-progress-bar.entry.js":[4174,8592,4174],"./ion-radio_2.entry.js":[4432,8592,4432],"./ion-range.entry.js":[1709,8592,1709],"./ion-refresher_2.entry.js":[3326,8592,3326],"./ion-reorder_2.entry.js":[3583,8592,3583],"./ion-ripple-effect.entry.js":[9958,9958],"./ion-route_4.entry.js":[4330,8592,4330],"./ion-searchbar.entry.js":[8628,8592,8628],"./ion-segment_2.entry.js":[9325,8592,9325],"./ion-select_3.entry.js":[2773,8592,2773],"./ion-slide_2.entry.js":[1650,1650],"./ion-spinner.entry.js":[4908,8592,4908],"./ion-split-pane.entry.js":[9536,9536],"./ion-tab-bar_2.entry.js":[438,8592,438],"./ion-tab_2.entry.js":[1536,8592,1536],"./ion-text.entry.js":[4376,8592,4376],"./ion-textarea.entry.js":[6560,8592,6560],"./ion-toast.entry.js":[6120,8592,6120],"./ion-toggle.entry.js":[5168,8592,5168],"./ion-virtual-scroll.entry.js":[2289,2289]};function m(ce){if(!k.o(d,ce))return Promise.resolve().then(()=>{var re=new Error("Cannot find module '"+ce+"'");throw re.code="MODULE_NOT_FOUND",re});var l=d[ce],ie=l[0];return Promise.all(l.slice(1).map(k.e)).then(()=>k(ie))}m.keys=()=>Object.keys(d),m.id=863,Ln.exports=m},5987:(Ln,At,k)=>{"use strict";function ne(ye,Ae,Be,st){return new(Be||(Be=Promise))(function(Yt,xn){function Ht(Dt){try{Bt(st.next(Dt))}catch(ht){xn(ht)}}function Nt(Dt){try{Bt(st.throw(Dt))}catch(ht){xn(ht)}}function Bt(Dt){Dt.done?Yt(Dt.value):function _t(Yt){return Yt instanceof Be?Yt:new Be(function(xn){xn(Yt)})}(Dt.value).then(Ht,Nt)}Bt((st=st.apply(ye,Ae||[])).next())})}function Ne(ye){return this instanceof Ne?(this.v=ye,this):new Ne(ye)}function ke(ye,Ae,Be){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _t,st=Be.apply(ye,Ae||[]),Yt=[];return _t={},xn("next"),xn("throw"),xn("return"),_t[Symbol.asyncIterator]=function(){return this},_t;function xn(Lt){st[Lt]&&(_t[Lt]=function(_e){return new Promise(function(it,Ot){Yt.push([Lt,_e,it,Ot])>1||Ht(Lt,_e)})})}function Ht(Lt,_e){try{!function Nt(Lt){Lt.value instanceof Ne?Promise.resolve(Lt.value.v).then(Bt,Dt):ht(Yt[0][2],Lt)}(st[Lt](_e))}catch(it){ht(Yt[0][3],it)}}function Bt(Lt){Ht("next",Lt)}function Dt(Lt){Ht("throw",Lt)}function ht(Lt,_e){Lt(_e),Yt.shift(),Yt.length&&Ht(Yt[0][0],Yt[0][1])}}function We(ye){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Be,Ae=ye[Symbol.asyncIterator];return Ae?Ae.call(ye):(ye=function ue(ye){var Ae="function"==typeof Symbol&&Symbol.iterator,Be=Ae&&ye[Ae],st=0;if(Be)return Be.call(ye);if(ye&&"number"==typeof ye.length)return{next:function(){return ye&&st>=ye.length&&(ye=void 0),{value:ye&&ye[st++],done:!ye}}};throw new TypeError(Ae?"Object is not iterable.":"Symbol.iterator is not defined.")}(ye),Be={},st("next"),st("throw"),st("return"),Be[Symbol.asyncIterator]=function(){return this},Be);function st(Yt){Be[Yt]=ye[Yt]&&function(xn){return new Promise(function(Ht,Nt){!function _t(Yt,xn,Ht,Nt){Promise.resolve(Nt).then(function(Bt){Yt({value:Bt,done:Ht})},xn)}(Ht,Nt,(xn=ye[Yt](xn)).done,xn.value)})}}}k.d(At,{FC:()=>ke,KL:()=>We,mG:()=>ne,qq:()=>Ne})},9671:(Ln,At,k)=>{"use strict";function d(ce,l,ie,re,v,ne,De){try{var ge=ce[ne](De),X=ge.value}catch(ue){return void ie(ue)}ge.done?l(X):Promise.resolve(X).then(re,v)}function m(ce){return function(){var l=this,ie=arguments;return new Promise(function(re,v){var ne=ce.apply(l,ie);function De(X){d(ne,re,v,De,ge,"next",X)}function ge(X){d(ne,re,v,De,ge,"throw",X)}De(void 0)})}}k.d(At,{Z:()=>m})},6895:(Ln,At,k)=>{"use strict";k.d(At,{Do:()=>Qe,EM:()=>to,HT:()=>ie,JF:()=>Ds,JJ:()=>po,K0:()=>v,Mx:()=>Ir,O5:()=>Ee,S$:()=>Ne,V_:()=>ge,Ye:()=>ve,b0:()=>We,bD:()=>eo,ez:()=>So,lw:()=>ne,mr:()=>He,q:()=>ce,sg:()=>Kr,tP:()=>hi,uU:()=>pt,w_:()=>re});var d=k(8274);let m=null;function ce(){return m}function ie(Y){m||(m=Y)}class re{}const v=new d.OlP("DocumentToken");let ne=(()=>{class Y{historyGo(K){throw new Error("Not implemented")}}return Y.\u0275fac=function(K){return new(K||Y)},Y.\u0275prov=d.Yz7({token:Y,factory:function(){return function De(){return(0,d.LFG)(X)}()},providedIn:"platform"}),Y})();const ge=new d.OlP("Location Initialized");let X=(()=>{class Y extends ne{constructor(K){super(),this._doc=K,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ce().getBaseHref(this._doc)}onPopState(K){const Fe=ce().getGlobalEventTarget(this._doc,"window");return Fe.addEventListener("popstate",K,!1),()=>Fe.removeEventListener("popstate",K)}onHashChange(K){const Fe=ce().getGlobalEventTarget(this._doc,"window");return Fe.addEventListener("hashchange",K,!1),()=>Fe.removeEventListener("hashchange",K)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(K){this.location.pathname=K}pushState(K,Fe,wt){ue()?this._history.pushState(K,Fe,wt):this.location.hash=wt}replaceState(K,Fe,wt){ue()?this._history.replaceState(K,Fe,wt):this.location.hash=wt}forward(){this._history.forward()}back(){this._history.back()}historyGo(K=0){this._history.go(K)}getState(){return this._history.state}}return Y.\u0275fac=function(K){return new(K||Y)(d.LFG(v))},Y.\u0275prov=d.Yz7({token:Y,factory:function(){return function se(){return new X((0,d.LFG)(v))}()},providedIn:"platform"}),Y})();function ue(){return!!window.history.pushState}function Ie(Y,Me){if(0==Y.length)return Me;if(0==Me.length)return Y;let K=0;return Y.endsWith("/")&&K++,Me.startsWith("/")&&K++,2==K?Y+Me.substring(1):1==K?Y+Me:Y+"/"+Me}function we(Y){const Me=Y.match(/#|\?|$/),K=Me&&Me.index||Y.length;return Y.slice(0,K-("/"===Y[K-1]?1:0))+Y.slice(K)}function Ue(Y){return Y&&"?"!==Y[0]?"?"+Y:Y}let Ne=(()=>{class Y{historyGo(K){throw new Error("Not implemented")}}return Y.\u0275fac=function(K){return new(K||Y)},Y.\u0275prov=d.Yz7({token:Y,factory:function(){return function ke(Y){const Me=(0,d.LFG)(v).location;return new We((0,d.LFG)(ne),Me&&Me.origin||"")}()},providedIn:"root"}),Y})();const He=new d.OlP("appBaseHref");let We=(()=>{class Y extends Ne{constructor(K,Fe){if(super(),this._platformLocation=K,this._removeListenerFns=[],null==Fe&&(Fe=this._platformLocation.getBaseHrefFromDOM()),null==Fe)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=Fe}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(K){this._removeListenerFns.push(this._platformLocation.onPopState(K),this._platformLocation.onHashChange(K))}getBaseHref(){return this._baseHref}prepareExternalUrl(K){return Ie(this._baseHref,K)}path(K=!1){const Fe=this._platformLocation.pathname+Ue(this._platformLocation.search),wt=this._platformLocation.hash;return wt&&K?`${Fe}${wt}`:Fe}pushState(K,Fe,wt,gn){const kn=this.prepareExternalUrl(wt+Ue(gn));this._platformLocation.pushState(K,Fe,kn)}replaceState(K,Fe,wt,gn){const kn=this.prepareExternalUrl(wt+Ue(gn));this._platformLocation.replaceState(K,Fe,kn)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(K=0){this._platformLocation.historyGo?.(K)}}return Y.\u0275fac=function(K){return new(K||Y)(d.LFG(ne),d.LFG(He,8))},Y.\u0275prov=d.Yz7({token:Y,factory:Y.\u0275fac}),Y})(),Qe=(()=>{class Y extends Ne{constructor(K,Fe){super(),this._platformLocation=K,this._baseHref="",this._removeListenerFns=[],null!=Fe&&(this._baseHref=Fe)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(K){this._removeListenerFns.push(this._platformLocation.onPopState(K),this._platformLocation.onHashChange(K))}getBaseHref(){return this._baseHref}path(K=!1){let Fe=this._platformLocation.hash;return null==Fe&&(Fe="#"),Fe.length>0?Fe.substring(1):Fe}prepareExternalUrl(K){const Fe=Ie(this._baseHref,K);return Fe.length>0?"#"+Fe:Fe}pushState(K,Fe,wt,gn){let kn=this.prepareExternalUrl(wt+Ue(gn));0==kn.length&&(kn=this._platformLocation.pathname),this._platformLocation.pushState(K,Fe,kn)}replaceState(K,Fe,wt,gn){let kn=this.prepareExternalUrl(wt+Ue(gn));0==kn.length&&(kn=this._platformLocation.pathname),this._platformLocation.replaceState(K,Fe,kn)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(K=0){this._platformLocation.historyGo?.(K)}}return Y.\u0275fac=function(K){return new(K||Y)(d.LFG(ne),d.LFG(He,8))},Y.\u0275prov=d.Yz7({token:Y,factory:Y.\u0275fac}),Y})(),ve=(()=>{class Y{constructor(K,Fe){this._subject=new d.vpe,this._urlChangeListeners=[],this._platformStrategy=K;const wt=this._platformStrategy.getBaseHref();this._platformLocation=Fe,this._baseHref=we(Pe(wt)),this._platformStrategy.onPopState(gn=>{this._subject.emit({url:this.path(!0),pop:!0,state:gn.state,type:gn.type})})}path(K=!1){return this.normalize(this._platformStrategy.path(K))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(K,Fe=""){return this.path()==this.normalize(K+Ue(Fe))}normalize(K){return Y.stripTrailingSlash(function Ze(Y,Me){return Y&&Me.startsWith(Y)?Me.substring(Y.length):Me}(this._baseHref,Pe(K)))}prepareExternalUrl(K){return K&&"/"!==K[0]&&(K="/"+K),this._platformStrategy.prepareExternalUrl(K)}go(K,Fe="",wt=null){this._platformStrategy.pushState(wt,"",K,Fe),this._notifyUrlChangeListeners(this.prepareExternalUrl(K+Ue(Fe)),wt)}replaceState(K,Fe="",wt=null){this._platformStrategy.replaceState(wt,"",K,Fe),this._notifyUrlChangeListeners(this.prepareExternalUrl(K+Ue(Fe)),wt)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(K=0){this._platformStrategy.historyGo?.(K)}onUrlChange(K){this._urlChangeListeners.push(K),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(Fe=>{this._notifyUrlChangeListeners(Fe.url,Fe.state)}))}_notifyUrlChangeListeners(K="",Fe){this._urlChangeListeners.forEach(wt=>wt(K,Fe))}subscribe(K,Fe,wt){return this._subject.subscribe({next:K,error:Fe,complete:wt})}}return Y.normalizeQueryParams=Ue,Y.joinWithSlash=Ie,Y.stripTrailingSlash=we,Y.\u0275fac=function(K){return new(K||Y)(d.LFG(Ne),d.LFG(ne))},Y.\u0275prov=d.Yz7({token:Y,factory:function(){return function me(){return new ve((0,d.LFG)(Ne),(0,d.LFG)(ne))}()},providedIn:"root"}),Y})();function Pe(Y){return Y.replace(/\/index.html$/,"")}var tt=(()=>((tt=tt||{})[tt.Decimal=0]="Decimal",tt[tt.Percent=1]="Percent",tt[tt.Currency=2]="Currency",tt[tt.Scientific=3]="Scientific",tt))(),Ae=(()=>((Ae=Ae||{})[Ae.Format=0]="Format",Ae[Ae.Standalone=1]="Standalone",Ae))(),Be=(()=>((Be=Be||{})[Be.Narrow=0]="Narrow",Be[Be.Abbreviated=1]="Abbreviated",Be[Be.Wide=2]="Wide",Be[Be.Short=3]="Short",Be))(),st=(()=>((st=st||{})[st.Short=0]="Short",st[st.Medium=1]="Medium",st[st.Long=2]="Long",st[st.Full=3]="Full",st))(),_t=(()=>((_t=_t||{})[_t.Decimal=0]="Decimal",_t[_t.Group=1]="Group",_t[_t.List=2]="List",_t[_t.PercentSign=3]="PercentSign",_t[_t.PlusSign=4]="PlusSign",_t[_t.MinusSign=5]="MinusSign",_t[_t.Exponential=6]="Exponential",_t[_t.SuperscriptingExponent=7]="SuperscriptingExponent",_t[_t.PerMille=8]="PerMille",_t[_t.Infinity=9]="Infinity",_t[_t.NaN=10]="NaN",_t[_t.TimeSeparator=11]="TimeSeparator",_t[_t.CurrencyDecimal=12]="CurrencyDecimal",_t[_t.CurrencyGroup=13]="CurrencyGroup",_t))();function _e(Y,Me){return di((0,d.cg1)(Y)[d.wAp.DateFormat],Me)}function it(Y,Me){return di((0,d.cg1)(Y)[d.wAp.TimeFormat],Me)}function Ot(Y,Me){return di((0,d.cg1)(Y)[d.wAp.DateTimeFormat],Me)}function Qt(Y,Me){const K=(0,d.cg1)(Y),Fe=K[d.wAp.NumberSymbols][Me];if(typeof Fe>"u"){if(Me===_t.CurrencyDecimal)return K[d.wAp.NumberSymbols][_t.Decimal];if(Me===_t.CurrencyGroup)return K[d.wAp.NumberSymbols][_t.Group]}return Fe}function yi(Y){if(!Y[d.wAp.ExtraData])throw new Error(`Missing extra locale data for the locale "${Y[d.wAp.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function di(Y,Me){for(let K=Me;K>-1;K--)if(typeof Y[K]<"u")return Y[K];throw new Error("Locale data API: locale data undefined")}function Ai(Y){const[Me,K]=Y.split(":");return{hours:+Me,minutes:+K}}const It=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,qe={},dt=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Wt=(()=>((Wt=Wt||{})[Wt.Short=0]="Short",Wt[Wt.ShortGMT=1]="ShortGMT",Wt[Wt.Long=2]="Long",Wt[Wt.Extended=3]="Extended",Wt))(),de=(()=>((de=de||{})[de.FullYear=0]="FullYear",de[de.Month=1]="Month",de[de.Date=2]="Date",de[de.Hours=3]="Hours",de[de.Minutes=4]="Minutes",de[de.Seconds=5]="Seconds",de[de.FractionalSeconds=6]="FractionalSeconds",de[de.Day=7]="Day",de))(),Je=(()=>((Je=Je||{})[Je.DayPeriods=0]="DayPeriods",Je[Je.Days=1]="Days",Je[Je.Months=2]="Months",Je[Je.Eras=3]="Eras",Je))();function $t(Y,Me,K,Fe){let wt=function Tt(Y){if(Et(Y))return Y;if("number"==typeof Y&&!isNaN(Y))return new Date(Y);if("string"==typeof Y){if(Y=Y.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(Y)){const[wt,gn=1,kn=1]=Y.split("-").map(Jn=>+Jn);return dn(wt,gn-1,kn)}const K=parseFloat(Y);if(!isNaN(Y-K))return new Date(K);let Fe;if(Fe=Y.match(It))return function Ct(Y){const Me=new Date(0);let K=0,Fe=0;const wt=Y[8]?Me.setUTCFullYear:Me.setFullYear,gn=Y[8]?Me.setUTCHours:Me.setHours;Y[9]&&(K=Number(Y[9]+Y[10]),Fe=Number(Y[9]+Y[11])),wt.call(Me,Number(Y[1]),Number(Y[2])-1,Number(Y[3]));const kn=Number(Y[4]||0)-K,Jn=Number(Y[5]||0)-Fe,Mr=Number(Y[6]||0),cr=Math.floor(1e3*parseFloat("0."+(Y[7]||0)));return gn.call(Me,kn,Jn,Mr,cr),Me}(Fe)}const Me=new Date(Y);if(!Et(Me))throw new Error(`Unable to convert "${Y}" into a date`);return Me}(Y);Me=Qn(K,Me)||Me;let Jn,kn=[];for(;Me;){if(Jn=dt.exec(Me),!Jn){kn.push(Me);break}{kn=kn.concat(Jn.slice(1));const er=kn.pop();if(!er)break;Me=er}}let Mr=wt.getTimezoneOffset();Fe&&(Mr=pe(Fe,Mr),wt=function gt(Y,Me,K){const Fe=K?-1:1,wt=Y.getTimezoneOffset();return function $e(Y,Me){return(Y=new Date(Y.getTime())).setMinutes(Y.getMinutes()+Me),Y}(Y,Fe*(pe(Me,wt)-wt))}(wt,Fe,!0));let cr="";return kn.forEach(er=>{const Vi=function N(Y){if(Q[Y])return Q[Y];let Me;switch(Y){case"G":case"GG":case"GGG":Me=xi(Je.Eras,Be.Abbreviated);break;case"GGGG":Me=xi(Je.Eras,Be.Wide);break;case"GGGGG":Me=xi(Je.Eras,Be.Narrow);break;case"y":Me=wi(de.FullYear,1,0,!1,!0);break;case"yy":Me=wi(de.FullYear,2,0,!0,!0);break;case"yyy":Me=wi(de.FullYear,3,0,!1,!0);break;case"yyyy":Me=wi(de.FullYear,4,0,!1,!0);break;case"Y":Me=L(1);break;case"YY":Me=L(2,!0);break;case"YYY":Me=L(3);break;case"YYYY":Me=L(4);break;case"M":case"L":Me=wi(de.Month,1,1);break;case"MM":case"LL":Me=wi(de.Month,2,1);break;case"MMM":Me=xi(Je.Months,Be.Abbreviated);break;case"MMMM":Me=xi(Je.Months,Be.Wide);break;case"MMMMM":Me=xi(Je.Months,Be.Narrow);break;case"LLL":Me=xi(Je.Months,Be.Abbreviated,Ae.Standalone);break;case"LLLL":Me=xi(Je.Months,Be.Wide,Ae.Standalone);break;case"LLLLL":Me=xi(Je.Months,Be.Narrow,Ae.Standalone);break;case"w":Me=je(1);break;case"ww":Me=je(2);break;case"W":Me=je(1,!0);break;case"d":Me=wi(de.Date,1);break;case"dd":Me=wi(de.Date,2);break;case"c":case"cc":Me=wi(de.Day,1);break;case"ccc":Me=xi(Je.Days,Be.Abbreviated,Ae.Standalone);break;case"cccc":Me=xi(Je.Days,Be.Wide,Ae.Standalone);break;case"ccccc":Me=xi(Je.Days,Be.Narrow,Ae.Standalone);break;case"cccccc":Me=xi(Je.Days,Be.Short,Ae.Standalone);break;case"E":case"EE":case"EEE":Me=xi(Je.Days,Be.Abbreviated);break;case"EEEE":Me=xi(Je.Days,Be.Wide);break;case"EEEEE":Me=xi(Je.Days,Be.Narrow);break;case"EEEEEE":Me=xi(Je.Days,Be.Short);break;case"a":case"aa":case"aaa":Me=xi(Je.DayPeriods,Be.Abbreviated);break;case"aaaa":Me=xi(Je.DayPeriods,Be.Wide);break;case"aaaaa":Me=xi(Je.DayPeriods,Be.Narrow);break;case"b":case"bb":case"bbb":Me=xi(Je.DayPeriods,Be.Abbreviated,Ae.Standalone,!0);break;case"bbbb":Me=xi(Je.DayPeriods,Be.Wide,Ae.Standalone,!0);break;case"bbbbb":Me=xi(Je.DayPeriods,Be.Narrow,Ae.Standalone,!0);break;case"B":case"BB":case"BBB":Me=xi(Je.DayPeriods,Be.Abbreviated,Ae.Format,!0);break;case"BBBB":Me=xi(Je.DayPeriods,Be.Wide,Ae.Format,!0);break;case"BBBBB":Me=xi(Je.DayPeriods,Be.Narrow,Ae.Format,!0);break;case"h":Me=wi(de.Hours,1,-12);break;case"hh":Me=wi(de.Hours,2,-12);break;case"H":Me=wi(de.Hours,1);break;case"HH":Me=wi(de.Hours,2);break;case"m":Me=wi(de.Minutes,1);break;case"mm":Me=wi(de.Minutes,2);break;case"s":Me=wi(de.Seconds,1);break;case"ss":Me=wi(de.Seconds,2);break;case"S":Me=wi(de.FractionalSeconds,1);break;case"SS":Me=wi(de.FractionalSeconds,2);break;case"SSS":Me=wi(de.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":Me=$i(Wt.Short);break;case"ZZZZZ":Me=$i(Wt.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":Me=$i(Wt.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":Me=$i(Wt.Long);break;default:return null}return Q[Y]=Me,Me}(er);cr+=Vi?Vi(wt,K,Mr):"''"===er?"'":er.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),cr}function dn(Y,Me,K){const Fe=new Date(0);return Fe.setFullYear(Y,Me,K),Fe.setHours(0,0,0),Fe}function Qn(Y,Me){const K=function xn(Y){return(0,d.cg1)(Y)[d.wAp.LocaleId]}(Y);if(qe[K]=qe[K]||{},qe[K][Me])return qe[K][Me];let Fe="";switch(Me){case"shortDate":Fe=_e(Y,st.Short);break;case"mediumDate":Fe=_e(Y,st.Medium);break;case"longDate":Fe=_e(Y,st.Long);break;case"fullDate":Fe=_e(Y,st.Full);break;case"shortTime":Fe=it(Y,st.Short);break;case"mediumTime":Fe=it(Y,st.Medium);break;case"longTime":Fe=it(Y,st.Long);break;case"fullTime":Fe=it(Y,st.Full);break;case"short":const wt=Qn(Y,"shortTime"),gn=Qn(Y,"shortDate");Fe=Qi(Ot(Y,st.Short),[wt,gn]);break;case"medium":const kn=Qn(Y,"mediumTime"),Jn=Qn(Y,"mediumDate");Fe=Qi(Ot(Y,st.Medium),[kn,Jn]);break;case"long":const Mr=Qn(Y,"longTime"),cr=Qn(Y,"longDate");Fe=Qi(Ot(Y,st.Long),[Mr,cr]);break;case"full":const er=Qn(Y,"fullTime"),Vi=Qn(Y,"fullDate");Fe=Qi(Ot(Y,st.Full),[er,Vi])}return Fe&&(qe[K][Me]=Fe),Fe}function Qi(Y,Me){return Me&&(Y=Y.replace(/\{([^}]+)}/g,function(K,Fe){return null!=Me&&Fe in Me?Me[Fe]:K})),Y}function nr(Y,Me,K="-",Fe,wt){let gn="";(Y<0||wt&&Y<=0)&&(wt?Y=1-Y:(Y=-Y,gn=K));let kn=String(Y);for(;kn.length<Me;)kn="0"+kn;return Fe&&(kn=kn.substr(kn.length-Me)),gn+kn}function wi(Y,Me,K=0,Fe=!1,wt=!1){return function(gn,kn){let Jn=function Di(Y,Me){switch(Y){case de.FullYear:return Me.getFullYear();case de.Month:return Me.getMonth();case de.Date:return Me.getDate();case de.Hours:return Me.getHours();case de.Minutes:return Me.getMinutes();case de.Seconds:return Me.getSeconds();case de.FractionalSeconds:return Me.getMilliseconds();case de.Day:return Me.getDay();default:throw new Error(`Unknown DateType value "${Y}".`)}}(Y,gn);if((K>0||Jn>-K)&&(Jn+=K),Y===de.Hours)0===Jn&&-12===K&&(Jn=12);else if(Y===de.FractionalSeconds)return function _r(Y,Me){return nr(Y,3).substr(0,Me)}(Jn,Me);const Mr=Qt(kn,_t.MinusSign);return nr(Jn,Me,Mr,Fe,wt)}}function xi(Y,Me,K=Ae.Format,Fe=!1){return function(wt,gn){return function Xr(Y,Me,K,Fe,wt,gn){switch(K){case Je.Months:return function Bt(Y,Me,K){const Fe=(0,d.cg1)(Y),gn=di([Fe[d.wAp.MonthsFormat],Fe[d.wAp.MonthsStandalone]],Me);return di(gn,K)}(Me,wt,Fe)[Y.getMonth()];case Je.Days:return function Nt(Y,Me,K){const Fe=(0,d.cg1)(Y),gn=di([Fe[d.wAp.DaysFormat],Fe[d.wAp.DaysStandalone]],Me);return di(gn,K)}(Me,wt,Fe)[Y.getDay()];case Je.DayPeriods:const kn=Y.getHours(),Jn=Y.getMinutes();if(gn){const cr=function Ui(Y){const Me=(0,d.cg1)(Y);return yi(Me),(Me[d.wAp.ExtraData][2]||[]).map(Fe=>"string"==typeof Fe?Ai(Fe):[Ai(Fe[0]),Ai(Fe[1])])}(Me),er=function Xi(Y,Me,K){const Fe=(0,d.cg1)(Y);yi(Fe);const gn=di([Fe[d.wAp.ExtraData][0],Fe[d.wAp.ExtraData][1]],Me)||[];return di(gn,K)||[]}(Me,wt,Fe),Vi=cr.findIndex(xr=>{if(Array.isArray(xr)){const[fr,br]=xr,ee=kn>=fr.hours&&Jn>=fr.minutes,W=kn<br.hours||kn===br.hours&&Jn<br.minutes;if(fr.hours<br.hours){if(ee&&W)return!0}else if(ee||W)return!0}else if(xr.hours===kn&&xr.minutes===Jn)return!0;return!1});if(-1!==Vi)return er[Vi]}return function Ht(Y,Me,K){const Fe=(0,d.cg1)(Y),gn=di([Fe[d.wAp.DayPeriodsFormat],Fe[d.wAp.DayPeriodsStandalone]],Me);return di(gn,K)}(Me,wt,Fe)[kn<12?0:1];case Je.Eras:return function Dt(Y,Me){return di((0,d.cg1)(Y)[d.wAp.Eras],Me)}(Me,Fe)[Y.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${K}`)}}(wt,gn,Y,Me,K,Fe)}}function $i(Y){return function(Me,K,Fe){const wt=-1*Fe,gn=Qt(K,_t.MinusSign),kn=wt>0?Math.floor(wt/60):Math.ceil(wt/60);switch(Y){case Wt.Short:return(wt>=0?"+":"")+nr(kn,2,gn)+nr(Math.abs(wt%60),2,gn);case Wt.ShortGMT:return"GMT"+(wt>=0?"+":"")+nr(kn,1,gn);case Wt.Long:return"GMT"+(wt>=0?"+":"")+nr(kn,2,gn)+":"+nr(Math.abs(wt%60),2,gn);case Wt.Extended:return 0===Fe?"Z":(wt>=0?"+":"")+nr(kn,2,gn)+":"+nr(Math.abs(wt%60),2,gn);default:throw new Error(`Unknown zone width "${Y}"`)}}}function Ci(Y){return dn(Y.getFullYear(),Y.getMonth(),Y.getDate()+(4-Y.getDay()))}function je(Y,Me=!1){return function(K,Fe){let wt;if(Me){const gn=new Date(K.getFullYear(),K.getMonth(),1).getDay()-1,kn=K.getDate();wt=1+Math.floor((kn+gn)/7)}else{const gn=Ci(K),kn=function ar(Y){const Me=dn(Y,0,1).getDay();return dn(Y,0,1+(Me<=4?4:11)-Me)}(gn.getFullYear()),Jn=gn.getTime()-kn.getTime();wt=1+Math.round(Jn/6048e5)}return nr(wt,Y,Qt(Fe,_t.MinusSign))}}function L(Y,Me=!1){return function(K,Fe){return nr(Ci(K).getFullYear(),Y,Qt(Fe,_t.MinusSign),Me)}}const Q={};function pe(Y,Me){Y=Y.replace(/:/g,"");const K=Date.parse("Jan 01, 1970 00:00:00 "+Y)/6e4;return isNaN(K)?Me:K}function Et(Y){return Y instanceof Date&&!isNaN(Y.valueOf())}const ln=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Dr(Y){const Me=parseInt(Y);if(isNaN(Me))throw new Error("Invalid integer literal when parsing "+Y);return Me}function Ir(Y,Me){Me=encodeURIComponent(Me);for(const K of Y.split(";")){const Fe=K.indexOf("="),[wt,gn]=-1==Fe?[K,""]:[K.slice(0,Fe),K.slice(Fe+1)];if(wt.trim()===Me)return decodeURIComponent(gn)}return null}class Br{constructor(Me,K,Fe,wt){this.$implicit=Me,this.ngForOf=K,this.index=Fe,this.count=wt}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Kr=(()=>{class Y{constructor(K,Fe,wt){this._viewContainer=K,this._template=Fe,this._differs=wt,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(K){this._ngForOf=K,this._ngForOfDirty=!0}set ngForTrackBy(K){this._trackByFn=K}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(K){K&&(this._template=K)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const K=this._ngForOf;!this._differ&&K&&(this._differ=this._differs.find(K).create(this.ngForTrackBy))}if(this._differ){const K=this._differ.diff(this._ngForOf);K&&this._applyChanges(K)}}_applyChanges(K){const Fe=this._viewContainer;K.forEachOperation((wt,gn,kn)=>{if(null==wt.previousIndex)Fe.createEmbeddedView(this._template,new Br(wt.item,this._ngForOf,-1,-1),null===kn?void 0:kn);else if(null==kn)Fe.remove(null===gn?void 0:gn);else if(null!==gn){const Jn=Fe.get(gn);Fe.move(Jn,kn),Lr(Jn,wt)}});for(let wt=0,gn=Fe.length;wt<gn;wt++){const Jn=Fe.get(wt).context;Jn.index=wt,Jn.count=gn,Jn.ngForOf=this._ngForOf}K.forEachIdentityChange(wt=>{Lr(Fe.get(wt.currentIndex),wt)})}static ngTemplateContextGuard(K,Fe){return!0}}return Y.\u0275fac=function(K){return new(K||Y)(d.Y36(d.s_b),d.Y36(d.Rgc),d.Y36(d.ZZ4))},Y.\u0275dir=d.lG2({type:Y,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),Y})();function Lr(Y,Me){Y.context.$implicit=Me.item}let Ee=(()=>{class Y{constructor(K,Fe){this._viewContainer=K,this._context=new Xe,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=Fe}set ngIf(K){this._context.$implicit=this._context.ngIf=K,this._updateView()}set ngIfThen(K){vt("ngIfThen",K),this._thenTemplateRef=K,this._thenViewRef=null,this._updateView()}set ngIfElse(K){vt("ngIfElse",K),this._elseTemplateRef=K,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(K,Fe){return!0}}return Y.\u0275fac=function(K){return new(K||Y)(d.Y36(d.s_b),d.Y36(d.Rgc))},Y.\u0275dir=d.lG2({type:Y,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),Y})();class Xe{constructor(){this.$implicit=null,this.ngIf=null}}function vt(Y,Me){if(Me&&!Me.createEmbeddedView)throw new Error(`${Y} must be a TemplateRef, but received '${(0,d.AaK)(Me)}'.`)}let hi=(()=>{class Y{constructor(K){this._viewContainerRef=K,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null}ngOnChanges(K){if(K.ngTemplateOutlet){const Fe=this._viewContainerRef;this._viewRef&&Fe.remove(Fe.indexOf(this._viewRef)),this._viewRef=this.ngTemplateOutlet?Fe.createEmbeddedView(this.ngTemplateOutlet,this.ngTemplateOutletContext):null}else this._viewRef&&K.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return Y.\u0275fac=function(K){return new(K||Y)(d.Y36(d.s_b))},Y.\u0275dir=d.lG2({type:Y,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet"},features:[d.TTD]}),Y})();function Bi(Y,Me){return new d.vHH(2100,"")}const ko=new d.OlP("DATE_PIPE_DEFAULT_TIMEZONE");let pt=(()=>{class Y{constructor(K,Fe){this.locale=K,this.defaultTimezone=Fe}transform(K,Fe="mediumDate",wt,gn){if(null==K||""===K||K!=K)return null;try{return $t(K,Fe,gn||this.locale,wt??this.defaultTimezone??void 0)}catch(kn){throw Bi()}}}return Y.\u0275fac=function(K){return new(K||Y)(d.Y36(d.soG,16),d.Y36(ko,24))},Y.\u0275pipe=d.Yjl({name:"date",type:Y,pure:!0}),Y})(),po=(()=>{class Y{constructor(K){this._locale=K}transform(K,Fe,wt){if(!function as(Y){return!(null==Y||""===Y||Y!=Y)}(K))return null;wt=wt||this._locale;try{return function gr(Y,Me,K){return function Xt(Y,Me,K,Fe,wt,gn,kn=!1){let Jn="",Mr=!1;if(isFinite(Y)){let cr=function mi(Y){let Fe,wt,gn,kn,Jn,Me=Math.abs(Y)+"",K=0;for((wt=Me.indexOf("."))>-1&&(Me=Me.replace(".","")),(gn=Me.search(/e/i))>0?(wt<0&&(wt=gn),wt+=+Me.slice(gn+1),Me=Me.substring(0,gn)):wt<0&&(wt=Me.length),gn=0;"0"===Me.charAt(gn);gn++);if(gn===(Jn=Me.length))Fe=[0],wt=1;else{for(Jn--;"0"===Me.charAt(Jn);)Jn--;for(wt-=gn,Fe=[],kn=0;gn<=Jn;gn++,kn++)Fe[kn]=Number(Me.charAt(gn))}return wt>22&&(Fe=Fe.splice(0,21),K=wt-1,wt=1),{digits:Fe,exponent:K,integerLen:wt}}(Y);kn&&(cr=function Dn(Y){if(0===Y.digits[0])return Y;const Me=Y.digits.length-Y.integerLen;return Y.exponent?Y.exponent+=2:(0===Me?Y.digits.push(0,0):1===Me&&Y.digits.push(0),Y.integerLen+=2),Y}(cr));let er=Me.minInt,Vi=Me.minFrac,xr=Me.maxFrac;if(gn){const Re=gn.match(ln);if(null===Re)throw new Error(`${gn} is not a valid digit info`);const wn=Re[1],Ii=Re[3],Rr=Re[5];null!=wn&&(er=Dr(wn)),null!=Ii&&(Vi=Dr(Ii)),null!=Rr?xr=Dr(Rr):null!=Ii&&Vi>xr&&(xr=Vi)}!function Wn(Y,Me,K){if(Me>K)throw new Error(`The minimum number of digits after fraction (${Me}) is higher than the maximum (${K}).`);let Fe=Y.digits,wt=Fe.length-Y.integerLen;const gn=Math.min(Math.max(Me,wt),K);let kn=gn+Y.integerLen,Jn=Fe[kn];if(kn>0){Fe.splice(Math.max(Y.integerLen,kn));for(let Vi=kn;Vi<Fe.length;Vi++)Fe[Vi]=0}else{wt=Math.max(0,wt),Y.integerLen=1,Fe.length=Math.max(1,kn=gn+1),Fe[0]=0;for(let Vi=1;Vi<kn;Vi++)Fe[Vi]=0}if(Jn>=5)if(kn-1<0){for(let Vi=0;Vi>kn;Vi--)Fe.unshift(0),Y.integerLen++;Fe.unshift(1),Y.integerLen++}else Fe[kn-1]++;for(;wt<Math.max(0,gn);wt++)Fe.push(0);let Mr=0!==gn;const cr=Me+Y.integerLen,er=Fe.reduceRight(function(Vi,xr,fr,br){return br[fr]=(xr+=Vi)<10?xr:xr-10,Mr&&(0===br[fr]&&fr>=cr?br.pop():Mr=!1),xr>=10?1:0},0);er&&(Fe.unshift(er),Y.integerLen++)}(cr,Vi,xr);let fr=cr.digits,br=cr.integerLen;const ee=cr.exponent;let W=[];for(Mr=fr.every(Re=>!Re);br<er;br++)fr.unshift(0);for(;br<0;br++)fr.unshift(0);br>0?W=fr.splice(br,fr.length):(W=fr,fr=[0]);const H=[];for(fr.length>=Me.lgSize&&H.unshift(fr.splice(-Me.lgSize,fr.length).join(""));fr.length>Me.gSize;)H.unshift(fr.splice(-Me.gSize,fr.length).join(""));fr.length&&H.unshift(fr.join("")),Jn=H.join(Qt(K,Fe)),W.length&&(Jn+=Qt(K,wt)+W.join("")),ee&&(Jn+=Qt(K,_t.Exponential)+"+"+ee)}else Jn=Qt(K,_t.Infinity);return Jn=Y<0&&!Mr?Me.negPre+Jn+Me.negSuf:Me.posPre+Jn+Me.posSuf,Jn}(Y,function lr(Y,Me="-"){const K={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},Fe=Y.split(";"),wt=Fe[0],gn=Fe[1],kn=-1!==wt.indexOf(".")?wt.split("."):[wt.substring(0,wt.lastIndexOf("0")+1),wt.substring(wt.lastIndexOf("0")+1)],Jn=kn[0],Mr=kn[1]||"";K.posPre=Jn.substr(0,Jn.indexOf("#"));for(let er=0;er<Mr.length;er++){const Vi=Mr.charAt(er);"0"===Vi?K.minFrac=K.maxFrac=er+1:"#"===Vi?K.maxFrac=er+1:K.posSuf+=Vi}const cr=Jn.split(",");if(K.gSize=cr[1]?cr[1].length:0,K.lgSize=cr[2]||cr[1]?(cr[2]||cr[1]).length:0,gn){const er=wt.length-K.posPre.length-K.posSuf.length,Vi=gn.indexOf("#");K.negPre=gn.substr(0,Vi).replace(/'/g,""),K.negSuf=gn.substr(Vi+er).replace(/'/g,"")}else K.negPre=Me+K.posPre,K.negSuf=K.posSuf;return K}(function _n(Y,Me){return(0,d.cg1)(Y)[d.wAp.NumberFormats][Me]}(Me,tt.Decimal),Qt(Me,_t.MinusSign)),Me,_t.Group,_t.Decimal,K)}(function Cs(Y){if("string"==typeof Y&&!isNaN(Number(Y)-parseFloat(Y)))return Number(Y);if("number"!=typeof Y)throw new Error(`${Y} is not a number`);return Y}(K),wt,Fe)}catch(gn){throw Bi()}}}return Y.\u0275fac=function(K){return new(K||Y)(d.Y36(d.soG,16))},Y.\u0275pipe=d.Yjl({name:"number",type:Y,pure:!0}),Y})();let So=(()=>{class Y{}return Y.\u0275fac=function(K){return new(K||Y)},Y.\u0275mod=d.oAB({type:Y}),Y.\u0275inj=d.cJS({}),Y})();const eo="browser";let to=(()=>{class Y{}return Y.\u0275prov=(0,d.Yz7)({token:Y,providedIn:"root",factory:()=>new Gs((0,d.LFG)(v),window)}),Y})();class Gs{constructor(Me,K){this.document=Me,this.window=K,this.offset=()=>[0,0]}setOffset(Me){this.offset=Array.isArray(Me)?()=>Me:Me}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(Me){this.supportsScrolling()&&this.window.scrollTo(Me[0],Me[1])}scrollToAnchor(Me){if(!this.supportsScrolling())return;const K=function ms(Y,Me){const K=Y.getElementById(Me)||Y.getElementsByName(Me)[0];if(K)return K;if("function"==typeof Y.createTreeWalker&&Y.body&&(Y.body.createShadowRoot||Y.body.attachShadow)){const Fe=Y.createTreeWalker(Y.body,NodeFilter.SHOW_ELEMENT);let wt=Fe.currentNode;for(;wt;){const gn=wt.shadowRoot;if(gn){const kn=gn.getElementById(Me)||gn.querySelector(`[name="${Me}"]`);if(kn)return kn}wt=Fe.nextNode()}}return null}(this.document,Me);K&&(this.scrollToElement(K),K.focus())}setHistoryScrollRestoration(Me){if(this.supportScrollRestoration()){const K=this.window.history;K&&K.scrollRestoration&&(K.scrollRestoration=Me)}}scrollToElement(Me){const K=Me.getBoundingClientRect(),Fe=K.left+this.window.pageXOffset,wt=K.top+this.window.pageYOffset,gn=this.offset();this.window.scrollTo(Fe-gn[0],wt-gn[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const Me=Po(this.window.history)||Po(Object.getPrototypeOf(this.window.history));return!(!Me||!Me.writable&&!Me.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function Po(Y){return Object.getOwnPropertyDescriptor(Y,"scrollRestoration")}class Ds{}},529:(Ln,At,k)=>{"use strict";k.d(At,{JF:()=>Ai,TP:()=>xn,WM:()=>ge,eN:()=>_t});var d=k(6895),m=k(8274),ce=k(9646),l=k(8306),ie=k(4351),re=k(9300),v=k(4004);class ne{}class De{}class ge{constructor(It){this.normalizedNames=new Map,this.lazyUpdate=null,It?this.lazyInit="string"==typeof It?()=>{this.headers=new Map,It.split("\n").forEach(qe=>{const dt=qe.indexOf(":");if(dt>0){const Wt=qe.slice(0,dt),de=Wt.toLowerCase(),Je=qe.slice(dt+1).trim();this.maybeSetNormalizedName(Wt,de),this.headers.has(de)?this.headers.get(de).push(Je):this.headers.set(de,[Je])}})}:()=>{this.headers=new Map,Object.keys(It).forEach(qe=>{let dt=It[qe];const Wt=qe.toLowerCase();"string"==typeof dt&&(dt=[dt]),dt.length>0&&(this.headers.set(Wt,dt),this.maybeSetNormalizedName(qe,Wt))})}:this.headers=new Map}has(It){return this.init(),this.headers.has(It.toLowerCase())}get(It){this.init();const qe=this.headers.get(It.toLowerCase());return qe&&qe.length>0?qe[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(It){return this.init(),this.headers.get(It.toLowerCase())||null}append(It,qe){return this.clone({name:It,value:qe,op:"a"})}set(It,qe){return this.clone({name:It,value:qe,op:"s"})}delete(It,qe){return this.clone({name:It,value:qe,op:"d"})}maybeSetNormalizedName(It,qe){this.normalizedNames.has(qe)||this.normalizedNames.set(qe,It)}init(){this.lazyInit&&(this.lazyInit instanceof ge?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(It=>this.applyUpdate(It)),this.lazyUpdate=null))}copyFrom(It){It.init(),Array.from(It.headers.keys()).forEach(qe=>{this.headers.set(qe,It.headers.get(qe)),this.normalizedNames.set(qe,It.normalizedNames.get(qe))})}clone(It){const qe=new ge;return qe.lazyInit=this.lazyInit&&this.lazyInit instanceof ge?this.lazyInit:this,qe.lazyUpdate=(this.lazyUpdate||[]).concat([It]),qe}applyUpdate(It){const qe=It.name.toLowerCase();switch(It.op){case"a":case"s":let dt=It.value;if("string"==typeof dt&&(dt=[dt]),0===dt.length)return;this.maybeSetNormalizedName(It.name,qe);const Wt=("a"===It.op?this.headers.get(qe):void 0)||[];Wt.push(...dt),this.headers.set(qe,Wt);break;case"d":const de=It.value;if(de){let Je=this.headers.get(qe);if(!Je)return;Je=Je.filter($t=>-1===de.indexOf($t)),0===Je.length?(this.headers.delete(qe),this.normalizedNames.delete(qe)):this.headers.set(qe,Je)}else this.headers.delete(qe),this.normalizedNames.delete(qe)}}forEach(It){this.init(),Array.from(this.normalizedNames.keys()).forEach(qe=>It(this.normalizedNames.get(qe),this.headers.get(qe)))}}class X{encodeKey(It){return we(It)}encodeValue(It){return we(It)}decodeKey(It){return decodeURIComponent(It)}decodeValue(It){return decodeURIComponent(It)}}const se=/%(\d[a-f0-9])/gi,Ie={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function we(on){return encodeURIComponent(on).replace(se,(It,qe)=>Ie[qe]??It)}function Ue(on){return`${on}`}class Ne{constructor(It={}){if(this.updates=null,this.cloneFrom=null,this.encoder=It.encoder||new X,It.fromString){if(It.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function ue(on,It){const qe=new Map;return on.length>0&&on.replace(/^\?/,"").split("&").forEach(Wt=>{const de=Wt.indexOf("="),[Je,$t]=-1==de?[It.decodeKey(Wt),""]:[It.decodeKey(Wt.slice(0,de)),It.decodeValue(Wt.slice(de+1))],dn=qe.get(Je)||[];dn.push($t),qe.set(Je,dn)}),qe}(It.fromString,this.encoder)}else It.fromObject?(this.map=new Map,Object.keys(It.fromObject).forEach(qe=>{const dt=It.fromObject[qe];this.map.set(qe,Array.isArray(dt)?dt:[dt])})):this.map=null}has(It){return this.init(),this.map.has(It)}get(It){this.init();const qe=this.map.get(It);return qe?qe[0]:null}getAll(It){return this.init(),this.map.get(It)||null}keys(){return this.init(),Array.from(this.map.keys())}append(It,qe){return this.clone({param:It,value:qe,op:"a"})}appendAll(It){const qe=[];return Object.keys(It).forEach(dt=>{const Wt=It[dt];Array.isArray(Wt)?Wt.forEach(de=>{qe.push({param:dt,value:de,op:"a"})}):qe.push({param:dt,value:Wt,op:"a"})}),this.clone(qe)}set(It,qe){return this.clone({param:It,value:qe,op:"s"})}delete(It,qe){return this.clone({param:It,value:qe,op:"d"})}toString(){return this.init(),this.keys().map(It=>{const qe=this.encoder.encodeKey(It);return this.map.get(It).map(dt=>qe+"="+this.encoder.encodeValue(dt)).join("&")}).filter(It=>""!==It).join("&")}clone(It){const qe=new Ne({encoder:this.encoder});return qe.cloneFrom=this.cloneFrom||this,qe.updates=(this.updates||[]).concat(It),qe}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(It=>this.map.set(It,this.cloneFrom.map.get(It))),this.updates.forEach(It=>{switch(It.op){case"a":case"s":const qe=("a"===It.op?this.map.get(It.param):void 0)||[];qe.push(Ue(It.value)),this.map.set(It.param,qe);break;case"d":if(void 0===It.value){this.map.delete(It.param);break}{let dt=this.map.get(It.param)||[];const Wt=dt.indexOf(Ue(It.value));-1!==Wt&&dt.splice(Wt,1),dt.length>0?this.map.set(It.param,dt):this.map.delete(It.param)}}}),this.cloneFrom=this.updates=null)}}class He{constructor(){this.map=new Map}set(It,qe){return this.map.set(It,qe),this}get(It){return this.map.has(It)||this.map.set(It,It.defaultValue()),this.map.get(It)}delete(It){return this.map.delete(It),this}has(It){return this.map.has(It)}keys(){return this.map.keys()}}function Qe(on){return typeof ArrayBuffer<"u"&&on instanceof ArrayBuffer}function ve(on){return typeof Blob<"u"&&on instanceof Blob}function me(on){return typeof FormData<"u"&&on instanceof FormData}class Pe{constructor(It,qe,dt,Wt){let de;if(this.url=qe,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=It.toUpperCase(),function We(on){switch(on){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||Wt?(this.body=void 0!==dt?dt:null,de=Wt):de=dt,de&&(this.reportProgress=!!de.reportProgress,this.withCredentials=!!de.withCredentials,de.responseType&&(this.responseType=de.responseType),de.headers&&(this.headers=de.headers),de.context&&(this.context=de.context),de.params&&(this.params=de.params)),this.headers||(this.headers=new ge),this.context||(this.context=new He),this.params){const Je=this.params.toString();if(0===Je.length)this.urlWithParams=qe;else{const $t=qe.indexOf("?");this.urlWithParams=qe+(-1===$t?"?":$t<qe.length-1?"&":"")+Je}}else this.params=new Ne,this.urlWithParams=qe}serializeBody(){return null===this.body?null:Qe(this.body)||ve(this.body)||me(this.body)||function Ze(on){return typeof URLSearchParams<"u"&&on instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Ne?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||me(this.body)?null:ve(this.body)?this.body.type||null:Qe(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Ne?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(It={}){const qe=It.method||this.method,dt=It.url||this.url,Wt=It.responseType||this.responseType,de=void 0!==It.body?It.body:this.body,Je=void 0!==It.withCredentials?It.withCredentials:this.withCredentials,$t=void 0!==It.reportProgress?It.reportProgress:this.reportProgress;let dn=It.headers||this.headers,Qn=It.params||this.params;const Qi=It.context??this.context;return void 0!==It.setHeaders&&(dn=Object.keys(It.setHeaders).reduce((nr,_r)=>nr.set(_r,It.setHeaders[_r]),dn)),It.setParams&&(Qn=Object.keys(It.setParams).reduce((nr,_r)=>nr.set(_r,It.setParams[_r]),Qn)),new Pe(qe,dt,de,{params:Qn,headers:dn,context:Qi,reportProgress:$t,responseType:Wt,withCredentials:Je})}}var Ge=(()=>((Ge=Ge||{})[Ge.Sent=0]="Sent",Ge[Ge.UploadProgress=1]="UploadProgress",Ge[Ge.ResponseHeader=2]="ResponseHeader",Ge[Ge.DownloadProgress=3]="DownloadProgress",Ge[Ge.Response=4]="Response",Ge[Ge.User=5]="User",Ge))();class tt{constructor(It,qe=200,dt="OK"){this.headers=It.headers||new ge,this.status=void 0!==It.status?It.status:qe,this.statusText=It.statusText||dt,this.url=It.url||null,this.ok=this.status>=200&&this.status<300}}class ye extends tt{constructor(It={}){super(It),this.type=Ge.ResponseHeader}clone(It={}){return new ye({headers:It.headers||this.headers,status:void 0!==It.status?It.status:this.status,statusText:It.statusText||this.statusText,url:It.url||this.url||void 0})}}class Ae extends tt{constructor(It={}){super(It),this.type=Ge.Response,this.body=void 0!==It.body?It.body:null}clone(It={}){return new Ae({body:void 0!==It.body?It.body:this.body,headers:It.headers||this.headers,status:void 0!==It.status?It.status:this.status,statusText:It.statusText||this.statusText,url:It.url||this.url||void 0})}}class Be extends tt{constructor(It){super(It,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${It.url||"(unknown url)"}`:`Http failure response for ${It.url||"(unknown url)"}: ${It.status} ${It.statusText}`,this.error=It.error||null}}function st(on,It){return{body:It,headers:on.headers,context:on.context,observe:on.observe,params:on.params,reportProgress:on.reportProgress,responseType:on.responseType,withCredentials:on.withCredentials}}let _t=(()=>{class on{constructor(qe){this.handler=qe}request(qe,dt,Wt={}){let de;if(qe instanceof Pe)de=qe;else{let dn,Qn;dn=Wt.headers instanceof ge?Wt.headers:new ge(Wt.headers),Wt.params&&(Qn=Wt.params instanceof Ne?Wt.params:new Ne({fromObject:Wt.params})),de=new Pe(qe,dt,void 0!==Wt.body?Wt.body:null,{headers:dn,context:Wt.context,params:Qn,reportProgress:Wt.reportProgress,responseType:Wt.responseType||"json",withCredentials:Wt.withCredentials})}const Je=(0,ce.of)(de).pipe((0,ie.b)(dn=>this.handler.handle(dn)));if(qe instanceof Pe||"events"===Wt.observe)return Je;const $t=Je.pipe((0,re.h)(dn=>dn instanceof Ae));switch(Wt.observe||"body"){case"body":switch(de.responseType){case"arraybuffer":return $t.pipe((0,v.U)(dn=>{if(null!==dn.body&&!(dn.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return dn.body}));case"blob":return $t.pipe((0,v.U)(dn=>{if(null!==dn.body&&!(dn.body instanceof Blob))throw new Error("Response is not a Blob.");return dn.body}));case"text":return $t.pipe((0,v.U)(dn=>{if(null!==dn.body&&"string"!=typeof dn.body)throw new Error("Response is not a string.");return dn.body}));default:return $t.pipe((0,v.U)(dn=>dn.body))}case"response":return $t;default:throw new Error(`Unreachable: unhandled observe type ${Wt.observe}}`)}}delete(qe,dt={}){return this.request("DELETE",qe,dt)}get(qe,dt={}){return this.request("GET",qe,dt)}head(qe,dt={}){return this.request("HEAD",qe,dt)}jsonp(qe,dt){return this.request("JSONP",qe,{params:(new Ne).append(dt,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(qe,dt={}){return this.request("OPTIONS",qe,dt)}patch(qe,dt,Wt={}){return this.request("PATCH",qe,st(Wt,dt))}post(qe,dt,Wt={}){return this.request("POST",qe,st(Wt,dt))}put(qe,dt,Wt={}){return this.request("PUT",qe,st(Wt,dt))}}return on.\u0275fac=function(qe){return new(qe||on)(m.LFG(ne))},on.\u0275prov=m.Yz7({token:on,factory:on.\u0275fac}),on})();class Yt{constructor(It,qe){this.next=It,this.interceptor=qe}handle(It){return this.interceptor.intercept(It,this.next)}}const xn=new m.OlP("HTTP_INTERCEPTORS");let Ht=(()=>{class on{intercept(qe,dt){return dt.handle(qe)}}return on.\u0275fac=function(qe){return new(qe||on)},on.\u0275prov=m.Yz7({token:on,factory:on.\u0275fac}),on})();const Qt=/^\)\]\}',?\n/;let Tn=(()=>{class on{constructor(qe){this.xhrFactory=qe}handle(qe){if("JSONP"===qe.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new l.y(dt=>{const Wt=this.xhrFactory.build();if(Wt.open(qe.method,qe.urlWithParams),qe.withCredentials&&(Wt.withCredentials=!0),qe.headers.forEach((wi,Di)=>Wt.setRequestHeader(wi,Di.join(","))),qe.headers.has("Accept")||Wt.setRequestHeader("Accept","application/json, text/plain, */*"),!qe.headers.has("Content-Type")){const wi=qe.detectContentTypeHeader();null!==wi&&Wt.setRequestHeader("Content-Type",wi)}if(qe.responseType){const wi=qe.responseType.toLowerCase();Wt.responseType="json"!==wi?wi:"text"}const de=qe.serializeBody();let Je=null;const $t=()=>{if(null!==Je)return Je;const wi=Wt.statusText||"OK",Di=new ge(Wt.getAllResponseHeaders()),xi=function _n(on){return"responseURL"in on&&on.responseURL?on.responseURL:/^X-Request-URL:/m.test(on.getAllResponseHeaders())?on.getResponseHeader("X-Request-URL"):null}(Wt)||qe.url;return Je=new ye({headers:Di,status:Wt.status,statusText:wi,url:xi}),Je},dn=()=>{let{headers:wi,status:Di,statusText:xi,url:Xr}=$t(),$i=null;204!==Di&&($i=typeof Wt.response>"u"?Wt.responseText:Wt.response),0===Di&&(Di=$i?200:0);let Oi=Di>=200&&Di<300;if("json"===qe.responseType&&"string"==typeof $i){const Wr=$i;$i=$i.replace(Qt,"");try{$i=""!==$i?JSON.parse($i):null}catch(ar){$i=Wr,Oi&&(Oi=!1,$i={error:ar,text:$i})}}Oi?(dt.next(new Ae({body:$i,headers:wi,status:Di,statusText:xi,url:Xr||void 0})),dt.complete()):dt.error(new Be({error:$i,headers:wi,status:Di,statusText:xi,url:Xr||void 0}))},Qn=wi=>{const{url:Di}=$t(),xi=new Be({error:wi,status:Wt.status||0,statusText:Wt.statusText||"Unknown Error",url:Di||void 0});dt.error(xi)};let Qi=!1;const nr=wi=>{Qi||(dt.next($t()),Qi=!0);let Di={type:Ge.DownloadProgress,loaded:wi.loaded};wi.lengthComputable&&(Di.total=wi.total),"text"===qe.responseType&&!!Wt.responseText&&(Di.partialText=Wt.responseText),dt.next(Di)},_r=wi=>{let Di={type:Ge.UploadProgress,loaded:wi.loaded};wi.lengthComputable&&(Di.total=wi.total),dt.next(Di)};return Wt.addEventListener("load",dn),Wt.addEventListener("error",Qn),Wt.addEventListener("timeout",Qn),Wt.addEventListener("abort",Qn),qe.reportProgress&&(Wt.addEventListener("progress",nr),null!==de&&Wt.upload&&Wt.upload.addEventListener("progress",_r)),Wt.send(de),dt.next({type:Ge.Sent}),()=>{Wt.removeEventListener("error",Qn),Wt.removeEventListener("abort",Qn),Wt.removeEventListener("load",dn),Wt.removeEventListener("timeout",Qn),qe.reportProgress&&(Wt.removeEventListener("progress",nr),null!==de&&Wt.upload&&Wt.upload.removeEventListener("progress",_r)),Wt.readyState!==Wt.DONE&&Wt.abort()}})}}return on.\u0275fac=function(qe){return new(qe||on)(m.LFG(d.JF))},on.\u0275prov=m.Yz7({token:on,factory:on.\u0275fac}),on})();const mn=new m.OlP("XSRF_COOKIE_NAME"),lt=new m.OlP("XSRF_HEADER_NAME");class qt{}let En=(()=>{class on{constructor(qe,dt,Wt){this.doc=qe,this.platform=dt,this.cookieName=Wt,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const qe=this.doc.cookie||"";return qe!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,d.Mx)(qe,this.cookieName),this.lastCookieString=qe),this.lastToken}}return on.\u0275fac=function(qe){return new(qe||on)(m.LFG(d.K0),m.LFG(m.Lbi),m.LFG(mn))},on.\u0275prov=m.Yz7({token:on,factory:on.\u0275fac}),on})(),yi=(()=>{class on{constructor(qe,dt){this.tokenService=qe,this.headerName=dt}intercept(qe,dt){const Wt=qe.url.toLowerCase();if("GET"===qe.method||"HEAD"===qe.method||Wt.startsWith("http://")||Wt.startsWith("https://"))return dt.handle(qe);const de=this.tokenService.getToken();return null!==de&&!qe.headers.has(this.headerName)&&(qe=qe.clone({headers:qe.headers.set(this.headerName,de)})),dt.handle(qe)}}return on.\u0275fac=function(qe){return new(qe||on)(m.LFG(qt),m.LFG(lt))},on.\u0275prov=m.Yz7({token:on,factory:on.\u0275fac}),on})(),Ui=(()=>{class on{constructor(qe,dt){this.backend=qe,this.injector=dt,this.chain=null}handle(qe){if(null===this.chain){const dt=this.injector.get(xn,[]);this.chain=dt.reduceRight((Wt,de)=>new Yt(Wt,de),this.backend)}return this.chain.handle(qe)}}return on.\u0275fac=function(qe){return new(qe||on)(m.LFG(De),m.LFG(m.zs3))},on.\u0275prov=m.Yz7({token:on,factory:on.\u0275fac}),on})(),di=(()=>{class on{static disable(){return{ngModule:on,providers:[{provide:yi,useClass:Ht}]}}static withOptions(qe={}){return{ngModule:on,providers:[qe.cookieName?{provide:mn,useValue:qe.cookieName}:[],qe.headerName?{provide:lt,useValue:qe.headerName}:[]]}}}return on.\u0275fac=function(qe){return new(qe||on)},on.\u0275mod=m.oAB({type:on}),on.\u0275inj=m.cJS({providers:[yi,{provide:xn,useExisting:yi,multi:!0},{provide:qt,useClass:En},{provide:mn,useValue:"XSRF-TOKEN"},{provide:lt,useValue:"X-XSRF-TOKEN"}]}),on})(),Ai=(()=>{class on{}return on.\u0275fac=function(qe){return new(qe||on)},on.\u0275mod=m.oAB({type:on}),on.\u0275inj=m.cJS({providers:[_t,{provide:ne,useClass:Ui},Tn,{provide:De,useExisting:Tn}],imports:[[di.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),on})()},8274:(Ln,At,k)=>{"use strict";k.d(At,{deG:()=>Ad,tb:()=>s0,AFp:()=>n0,ip1:()=>t0,CZH:()=>E_,hGG:()=>tw,z2F:()=>L_,sBO:()=>Nb,Sil:()=>yb,_Vd:()=>$m,EJc:()=>gb,SBq:()=>Hp,qLn:()=>Gu,vpe:()=>cc,tBr:()=>si,XFs:()=>ri,OlP:()=>lo,zs3:()=>Ua,ZZ4:()=>N_,aQg:()=>U_,soG:()=>I_,YKP:()=>fv,h0i:()=>Dh,PXZ:()=>Pb,R0b:()=>Bl,FiY:()=>Ei,Lbi:()=>pb,g9A:()=>o0,Qsj:()=>u1,FYo:()=>uv,JOm:()=>Ba,tp0:()=>_i,Rgc:()=>Jp,dDg:()=>c0,GfV:()=>dv,s_b:()=>Gm,ifc:()=>Qn,eFA:()=>h0,G48:()=>zb,Gpc:()=>Ue,_c5:()=>ew,VLi:()=>Mb,c2e:()=>fb,zSh:()=>_d,wAp:()=>Wi,vHH:()=>We,cg1:()=>n_,kL8:()=>Ry,dqk:()=>Di,sIi:()=>zc,CqO:()=>Vo,QGY:()=>Os,F4k:()=>qo,RDi:()=>Me,AaK:()=>se,qOj:()=>mh,TTD:()=>eo,_Bn:()=>av,xp6:()=>ou,uIk:()=>yh,ekj:()=>Jg,Suo:()=>Rv,Xpm:()=>pe,lG2:()=>Cn,Yz7:()=>Tn,cJS:()=>lt,oAB:()=>Et,Yjl:()=>oi,Y36:()=>_o,_UZ:()=>uo,GkF:()=>Fr,BQk:()=>hs,ynx:()=>xs,qZA:()=>io,TgZ:()=>Pr,EpF:()=>bs,n5z:()=>vl,LFG:()=>Zt,$8M:()=>Gl,$Z:()=>Hr,NdJ:()=>Jr,CRH:()=>kv,oxw:()=>fs,ALo:()=>Tv,lcZ:()=>Ev,xi3:()=>Dv,Hsn:()=>Ll,F$t:()=>fa,Q6J:()=>To,s9C:()=>$c,DdM:()=>yv,iGM:()=>Ov,MAs:()=>Lm,CHM:()=>gs,LSH:()=>Jc,Udp:()=>Yg,YNc:()=>Pm,_uU:()=>_y,Oqu:()=>Kg,hij:()=>Fm,AsE:()=>Qg,lnq:()=>e_,HOy:()=>t_,Gf:()=>Lv});var d=k(8189),m=k(8421),ce=k(515),l=k(7669),ie=k(2076),v=k(7579),ne=k(727),De=k(8306),ge=k(3099);function X(r){for(let o in r)if(r[o]===X)return o;throw Error("Could not find renamed property on target object.")}function ue(r,o){for(const a in o)o.hasOwnProperty(a)&&!r.hasOwnProperty(a)&&(r[a]=o[a])}function se(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(se).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const o=r.toString();if(null==o)return""+o;const a=o.indexOf("\n");return-1===a?o:o.substring(0,a)}function Ie(r,o){return null==r||""===r?null===o?"":o:null==o||""===o?r:r+" "+o}const we=X({__forward_ref__:X});function Ue(r){return r.__forward_ref__=Ue,r.toString=function(){return se(this())},r}function Ne(r){return ke(r)?r():r}function ke(r){return"function"==typeof r&&r.hasOwnProperty(we)&&r.__forward_ref__===Ue}class We extends Error{constructor(o,a){super(function Qe(r,o){return`NG0${Math.abs(r)}${o?": "+o:""}`}(o,a)),this.code=o}}function ve(r){return"string"==typeof r?r:null==r?"":String(r)}function me(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():ve(r)}function tt(r,o){const a=o?` in ${o}`:"";throw new We(-201,`No provider for ${me(r)} found${a}`)}function _e(r,o){null==r&&function it(r,o,a,h){throw new Error(`ASSERTION ERROR: ${r}`+(null==h?"":` [Expected=> ${a} ${h} ${o} <=Actual]`))}(o,r,null,"!=")}function Tn(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function lt(r){return{providers:r.providers||[],imports:r.imports||[]}}function qt(r){return En(r,mr)||En(r,Ai)}function En(r,o){return r.hasOwnProperty(o)?r[o]:null}function Xi(r){return r&&(r.hasOwnProperty(di)||r.hasOwnProperty(Hi))?r[di]:null}const mr=X({\u0275prov:X}),di=X({\u0275inj:X}),Ai=X({ngInjectableDef:X}),Hi=X({ngInjectorDef:X});var ri=(()=>((ri=ri||{})[ri.Default=0]="Default",ri[ri.Host=1]="Host",ri[ri.Self=2]="Self",ri[ri.SkipSelf=4]="SkipSelf",ri[ri.Optional=8]="Optional",ri))();let on;function qe(r){const o=on;return on=r,o}function dt(r,o,a){const h=qt(r);return h&&"root"==h.providedIn?void 0===h.value?h.value=h.factory():h.value:a&ri.Optional?null:void 0!==o?o:void tt(se(r),"Injector")}function de(r){return{toString:r}.toString()}var Je=(()=>((Je=Je||{})[Je.OnPush=0]="OnPush",Je[Je.Default=1]="Default",Je))(),Qn=(()=>{return(r=Qn||(Qn={}))[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",Qn;var r})();const Qi=typeof globalThis<"u"&&globalThis,nr=typeof window<"u"&&window,_r=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self,Di=Qi||typeof global<"u"&&global||nr||_r,$i={},Oi=[],Wr=X({\u0275cmp:X}),ar=X({\u0275dir:X}),Ci=X({\u0275pipe:X}),je=X({\u0275mod:X}),L=X({\u0275fac:X}),Q=X({__NG_ELEMENT_ID__:X});let N=0;function pe(r){return de(()=>{const a={},h={type:r.type,providersResolver:null,decls:r.decls,vars:r.vars,factory:null,template:r.template||null,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:a,inputs:null,outputs:null,exportAs:r.exportAs||null,onPush:r.changeDetection===Je.OnPush,directiveDefs:null,pipeDefs:null,selectors:r.selectors||Oi,viewQuery:r.viewQuery||null,features:r.features||null,data:r.data||{},encapsulation:r.encapsulation||Qn.Emulated,id:"c",styles:r.styles||Oi,_:null,setInput:null,schemas:r.schemas||null,tView:null},y=r.directives,w=r.features,A=r.pipes;return h.id+=N++,h.inputs=yn(r.inputs,a),h.outputs=yn(r.outputs),w&&w.forEach(F=>F(h)),h.directiveDefs=y?()=>("function"==typeof y?y():y).map(gt):null,h.pipeDefs=A?()=>("function"==typeof A?A():A).map(Tt):null,h})}function gt(r){return Rn(r)||function Hn(r){return r[ar]||null}(r)}function Tt(r){return function Xn(r){return r[Ci]||null}(r)}const Ct={};function Et(r){return de(()=>{const o={type:r.type,bootstrap:r.bootstrap||Oi,declarations:r.declarations||Oi,imports:r.imports||Oi,exports:r.exports||Oi,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null};return null!=r.id&&(Ct[r.id]=r.type),o})}function yn(r,o){if(null==r)return $i;const a={};for(const h in r)if(r.hasOwnProperty(h)){let y=r[h],w=y;Array.isArray(y)&&(w=y[1],y=y[0]),a[y]=h,o&&(o[y]=w)}return a}const Cn=pe;function oi(r){return{type:r.type,name:r.name,factory:null,pure:!1!==r.pure,onDestroy:r.type.prototype.ngOnDestroy||null}}function Rn(r){return r[Wr]||null}function Ut(r,o){const a=r[je]||null;if(!a&&!0===o)throw new Error(`Type ${se(r)} does not have '\u0275mod' property.`);return a}function nn(r){return Array.isArray(r)&&"object"==typeof r[1]}function Nn(r){return Array.isArray(r)&&!0===r[1]}function hi(r){return 0!=(8&r.flags)}function bi(r){return 2==(2&r.flags)}function Bi(r){return 1==(1&r.flags)}function Ki(r){return null!==r.template}function zr(r){return 0!=(512&r[2])}function ls(r,o){return r.hasOwnProperty(L)?r[L]:null}class So{constructor(o,a,h){this.previousValue=o,this.currentValue=a,this.firstChange=h}isFirstChange(){return this.firstChange}}function eo(){return Co}function Co(r){return r.type.prototype.ngOnChanges&&(r.setInput=yo),Ls}function Ls(){const r=Zs(this),o=r?.current;if(o){const a=r.previous;if(a===$i)r.previous=o;else for(let h in o)a[h]=o[h];r.current=null,this.ngOnChanges(o)}}function yo(r,o,a,h){const y=Zs(r)||function Ts(r,o){return r[vo]=o}(r,{previous:$i,current:null}),w=y.current||(y.current={}),A=y.previous,F=this.declaredInputs[a],$=A[F];w[F]=new So($&&$.currentValue,o,A===$i),r[h]=o}eo.ngInherit=!0;const vo="__ngSimpleChanges__";function Zs(r){return r[vo]||null}let Y;function Me(r){Y=r}function wt(r){return!!r.listen}const gn={createRenderer:(r,o)=>function K(){return void 0!==Y?Y:typeof document<"u"?document:void 0}()};function Jn(r){for(;Array.isArray(r);)r=r[0];return r}function er(r,o){return Jn(o[r])}function Vi(r,o){return Jn(o[r.index])}function fr(r,o){return r.data[o]}function br(r,o){return r[o]}function ee(r,o){const a=o[r];return nn(a)?a:a[0]}function W(r){return 4==(4&r[2])}function H(r){return 128==(128&r[2])}function wn(r,o){return null==o?null:r[o]}function Ii(r){r[18]=0}function Rr(r,o){r[5]+=o;let a=r,h=r[3];for(;null!==h&&(1===o&&1===a[5]||-1===o&&0===a[5]);)h[5]+=o,a=h,h=h[3]}const Ri={lFrame:Qo(null),bindingsEnabled:!0};function Is(){return Ri.bindingsEnabled}function Pn(){return Ri.lFrame.lView}function ur(){return Ri.lFrame.tView}function gs(r){return Ri.lFrame.contextLView=r,r[8]}function ro(){let r=gl();for(;null!==r&&64===r.type;)r=r.parent;return r}function gl(){return Ri.lFrame.currentTNode}function Oo(r,o){const a=Ri.lFrame;a.currentTNode=r,a.isParent=o}function Ha(){return Ri.lFrame.isParent}function Hs(){Ri.lFrame.isParent=!1}function ao(){const r=Ri.lFrame;let o=r.bindingRootIndex;return-1===o&&(o=r.bindingRootIndex=r.tView.bindingStartIndex),o}function E(){return Ri.lFrame.bindingIndex}function D(){return Ri.lFrame.bindingIndex++}function j(r){const o=Ri.lFrame,a=o.bindingIndex;return o.bindingIndex=o.bindingIndex+r,a}function Sn(r,o){const a=Ri.lFrame;a.bindingIndex=a.bindingRootIndex=r,Li(o)}function Li(r){Ri.lFrame.currentDirectiveIndex=r}function ir(){return Ri.lFrame.currentQueryIndex}function Cr(r){Ri.lFrame.currentQueryIndex=r}function Ar(r){const o=r[1];return 2===o.type?o.declTNode:1===o.type?r[6]:null}function fo(r,o,a){if(a&ri.SkipSelf){let y=o,w=r;for(;!(y=y.parent,null!==y||a&ri.Host||(y=Ar(w),null===y||(w=w[15],10&y.type))););if(null===y)return!1;o=y,r=w}const h=Ri.lFrame=Zn();return h.currentTNode=o,h.lView=r,!0}function Lo(r){const o=Zn(),a=r[1];Ri.lFrame=o,o.currentTNode=a.firstChild,o.lView=r,o.tView=a,o.contextLView=r,o.bindingIndex=a.bindingStartIndex,o.inI18n=!1}function Zn(){const r=Ri.lFrame,o=null===r?null:r.child;return null===o?Qo(r):o}function Qo(r){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=o),o}function oa(){const r=Ri.lFrame;return Ri.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const pc=oa;function Ea(){const r=oa();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function Do(){return Ri.lFrame.selectedIndex}function Fo(r){Ri.lFrame.selectedIndex=r}function kr(){const r=Ri.lFrame;return fr(r.tView,r.selectedIndex)}function va(r,o){for(let a=o.directiveStart,h=o.directiveEnd;a<h;a++){const w=r.data[a].type.prototype,{ngAfterContentInit:A,ngAfterContentChecked:F,ngAfterViewInit:$,ngAfterViewChecked:le,ngOnDestroy:be}=w;A&&(r.contentHooks||(r.contentHooks=[])).push(-a,A),F&&((r.contentHooks||(r.contentHooks=[])).push(a,F),(r.contentCheckHooks||(r.contentCheckHooks=[])).push(a,F)),$&&(r.viewHooks||(r.viewHooks=[])).push(-a,$),le&&((r.viewHooks||(r.viewHooks=[])).push(a,le),(r.viewCheckHooks||(r.viewCheckHooks=[])).push(a,le)),null!=be&&(r.destroyHooks||(r.destroyHooks=[])).push(a,be)}}function xo(r,o,a){aa(r,o,3,a)}function Wa(r,o,a,h){(3&r[2])===a&&aa(r,o,a,h)}function Ya(r,o){let a=r[2];(3&a)===o&&(a&=2047,a+=1,r[2]=a)}function aa(r,o,a,h){const w=h??-1,A=o.length-1;let F=0;for(let $=void 0!==h?65535&r[18]:0;$<A;$++)if("number"==typeof o[$+1]){if(F=o[$],null!=h&&F>=h)break}else o[$]<0&&(r[18]+=65536),(F<w||-1==w)&&(qs(r,a,o,$),r[18]=(4294901760&r[18])+$+2),$++}function qs(r,o,a,h){const y=a[h]<0,w=a[h+1],F=r[y?-a[h]:a[h]];if(y){if(r[2]>>11<r[18]>>16&&(3&r[2])===o){r[2]+=2048;try{w.call(F)}finally{}}}else try{w.call(F)}finally{}}class Ia{constructor(o,a,h){this.factory=o,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=h}}function Xa(r,o,a){const h=wt(r);let y=0;for(;y<a.length;){const w=a[y];if("number"==typeof w){if(0!==w)break;y++;const A=a[y++],F=a[y++],$=a[y++];h?r.setAttribute(o,F,$,A):o.setAttributeNS(A,F,$)}else{const A=w,F=a[++y];bo(A)?h&&r.setProperty(o,A,F):h?r.setAttribute(o,A,F):o.setAttribute(A,F),y++}}return y}function Ka(r){return 3===r||4===r||6===r}function bo(r){return 64===r.charCodeAt(0)}function $o(r,o){if(null!==o&&0!==o.length)if(null===r||0===r.length)r=o.slice();else{let a=-1;for(let h=0;h<o.length;h++){const y=o[h];"number"==typeof y?a=y:0===a||Qa(r,a,y,null,-1===a||2===a?o[++h]:null)}}return r}function Qa(r,o,a,h,y){let w=0,A=r.length;if(-1===o)A=-1;else for(;w<r.length;){const F=r[w++];if("number"==typeof F){if(F===o){A=-1;break}if(F>o){A=w-1;break}}}for(;w<r.length;){const F=r[w];if("number"==typeof F)break;if(F===a){if(null===h)return void(null!==y&&(r[w+1]=y));if(h===r[w+1])return void(r[w+2]=y)}w++,null!==h&&w++,null!==y&&w++}-1!==A&&(r.splice(A,0,o),w=A+1),r.splice(w++,0,a),null!==h&&r.splice(w++,0,h),null!==y&&r.splice(w++,0,y)}function Hc(r){return-1!==r}function el(r){return 32767&r}function Aa(r,o){let a=function Ws(r){return r>>16}(r),h=o;for(;a>0;)h=h[15],a--;return h}let Ys=!0;function ys(r){const o=Ys;return Ys=r,o}let _l=0;function la(r,o){const a=O(r,o);if(-1!==a)return a;const h=o[1];h.firstCreatePass&&(r.injectorIndex=o.length,z(h.data,r),z(o,null),z(h.blueprint,null));const y=P(r,o),w=r.injectorIndex;if(Hc(y)){const A=el(y),F=Aa(y,o),$=F[1].data;for(let le=0;le<8;le++)o[w+le]=F[A+le]|$[A+le]}return o[w+8]=y,w}function z(r,o){r.push(0,0,0,0,0,0,0,0,o)}function O(r,o){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===o[r.injectorIndex+8]?-1:r.injectorIndex}function P(r,o){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let a=0,h=null,y=o;for(;null!==y;){const w=y[1],A=w.type;if(h=2===A?w.declTNode:1===A?y[6]:null,null===h)return-1;if(a++,y=y[15],-1!==h.injectorIndex)return h.injectorIndex|a<<16}return-1}function G(r,o,a){!function yl(r,o,a){let h;"string"==typeof a?h=a.charCodeAt(0)||0:a.hasOwnProperty(Q)&&(h=a[Q]),null==h&&(h=a[Q]=_l++);const y=255&h;o.data[r+(y>>5)]|=1<<y}(r,o,a)}function Se(r,o,a){if(a&ri.Optional)return r;tt(o,"NodeInjector")}function ft(r,o,a,h){if(a&ri.Optional&&void 0===h&&(h=null),0==(a&(ri.Self|ri.Host))){const y=r[9],w=qe(void 0);try{return y?y.get(o,h,a&ri.Optional):dt(o,h,a&ri.Optional)}finally{qe(w)}}return Se(h,o,a)}function Mt(r,o,a,h=ri.Default,y){if(null!==r){const w=function Ur(r){if("string"==typeof r)return r.charCodeAt(0)||0;const o=r.hasOwnProperty(Q)?r[Q]:void 0;return"number"==typeof o?o>=0?255&o:ni:o}(a);if("function"==typeof w){if(!fo(o,r,h))return h&ri.Host?Se(y,a,h):ft(o,a,h,y);try{const A=w(h);if(null!=A||h&ri.Optional)return A;tt(a)}finally{pc()}}else if("number"==typeof w){let A=null,F=O(r,o),$=-1,le=h&ri.Host?o[16][6]:null;for((-1===F||h&ri.SkipSelf)&&($=-1===F?P(r,o):o[F+8],-1!==$&&Oa(h,!1)?(A=o[1],F=el($),o=Aa($,o)):F=-1);-1!==F;){const be=o[1];if(Pa(w,F,be.data)){const ut=or(F,o,a,A,h,le);if(ut!==cn)return ut}$=o[F+8],-1!==$&&Oa(h,o[1].data[F+8]===le)&&Pa(w,F,o)?(A=be,F=el($),o=Aa($,o)):F=-1}}}return ft(o,a,h,y)}const cn={};function ni(){return new ca(ro(),Pn())}function or(r,o,a,h,y,w){const A=o[1],F=A.data[r+8],be=Mi(F,A,a,null==h?bi(F)&&Ys:h!=A&&0!=(3&F.type),y&ri.Host&&w===F);return null!==be?Tr(o,A,be,F):cn}function Mi(r,o,a,h,y){const w=r.providerIndexes,A=o.data,F=1048575&w,$=r.directiveStart,be=w>>20,Rt=y?F+be:r.directiveEnd;for(let Kt=h?F:F+be;Kt<Rt;Kt++){const Mn=A[Kt];if(Kt<$&&a===Mn||Kt>=$&&Mn.type===a)return Kt}if(y){const Kt=A[$];if(Kt&&Ki(Kt)&&Kt.type===a)return $}return null}function Tr(r,o,a,h){let y=r[a];const w=o.data;if(function $l(r){return r instanceof Ia}(y)){const A=y;A.resolving&&function Ze(r,o){const a=o?`. Dependency path: ${o.join(" > ")} > ${r}`:"";throw new We(-200,`Circular dependency in DI detected for ${r}${a}`)}(me(w[a]));const F=ys(A.canSeeViewProviders);A.resolving=!0;const $=A.injectImpl?qe(A.injectImpl):null;fo(r,h,ri.Default);try{y=r[a]=A.factory(void 0,w,r,h),o.firstCreatePass&&a>=h.directiveStart&&function Vl(r,o,a){const{ngOnChanges:h,ngOnInit:y,ngDoCheck:w}=o.type.prototype;if(h){const A=Co(o);(a.preOrderHooks||(a.preOrderHooks=[])).push(r,A),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(r,A)}y&&(a.preOrderHooks||(a.preOrderHooks=[])).push(0-r,y),w&&((a.preOrderHooks||(a.preOrderHooks=[])).push(r,w),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(r,w))}(a,w[a],o)}finally{null!==$&&qe($),ys(F),A.resolving=!1,pc()}}return y}function Pa(r,o,a){return!!(a[o+(r>>5)]&1<<r)}function Oa(r,o){return!(r&ri.Self||r&ri.Host&&o)}class ca{constructor(o,a){this._tNode=o,this._lView=a}get(o,a,h){return Mt(this._tNode,this._lView,o,h,a)}}function vl(r){return de(()=>{const o=r.prototype.constructor,a=o[L]||xa(o),h=Object.prototype;let y=Object.getPrototypeOf(r.prototype).constructor;for(;y&&y!==h;){const w=y[L]||xa(y);if(w&&w!==a)return w;y=Object.getPrototypeOf(y)}return w=>new w})}function xa(r){return ke(r)?()=>{const o=xa(Ne(r));return o&&o()}:ls(r)}function Gl(r){return function oe(r,o){if("class"===o)return r.classes;if("style"===o)return r.styles;const a=r.attrs;if(a){const h=a.length;let y=0;for(;y<h;){const w=a[y];if(Ka(w))break;if(0===w)y+=2;else if("number"==typeof w)for(y++;y<h&&"string"==typeof a[y];)y++;else{if(w===o)return a[y+1];y+=2}}}return null}(ro(),r)}const ba="__parameters__";function bl(r,o,a){return de(()=>{const h=function nl(r){return function(...a){if(r){const h=r(...a);for(const y in h)this[y]=h[y]}}}(o);function y(...w){if(this instanceof y)return h.apply(this,w),this;const A=new y(...w);return F.annotation=A,F;function F($,le,be){const ut=$.hasOwnProperty(ba)?$[ba]:Object.defineProperty($,ba,{value:[]})[ba];for(;ut.length<=be;)ut.push(null);return(ut[be]=ut[be]||[]).push(A),$}}return a&&(y.prototype=Object.create(a.prototype)),y.prototype.ngMetadataName=r,y.annotationCls=y,y})}class lo{constructor(o,a){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof a?this.__NG_ELEMENT_ID__=a:void 0!==a&&(this.\u0275prov=Tn({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}toString(){return`InjectionToken ${this._desc}`}}const Ad=new lo("AnalyzeForEntryComponents");function Zo(r,o){void 0===o&&(o=r);for(let a=0;a<r.length;a++){let h=r[a];Array.isArray(h)?(o===r&&(o=r.slice(0,a)),Zo(h,o)):o!==r&&o.push(h)}return o}function Xs(r,o){r.forEach(a=>Array.isArray(a)?Xs(a,o):o(a))}function vc(r,o,a){o>=r.length?r.push(a):r.splice(o,0,a)}function La(r,o){return o>=r.length-1?r.pop():r.splice(o,1)[0]}function cs(r,o){const a=[];for(let h=0;h<r;h++)a.push(o);return a}function g(r,o,a){let h=C(r,o);return h>=0?r[1|h]=a:(h=~h,function Hl(r,o,a,h){let y=r.length;if(y==o)r.push(a,h);else if(1===y)r.push(h,r[0]),r[0]=a;else{for(y--,r.push(r[y-1],r[y]);y>o;)r[y]=r[y-2],y--;r[o]=a,r[o+1]=h}}(r,h,o,a)),h}function b(r,o){const a=C(r,o);if(a>=0)return r[1|a]}function C(r,o){return function S(r,o,a){let h=0,y=r.length>>a;for(;y!==h;){const w=h+(y-h>>1),A=r[w<<a];if(o===A)return w<<a;A>o?y=w:h=w+1}return~(y<<a)}(r,o,1)}const Ye={},rt="__NG_DI_FLAG__",ot="ngTempTokenPath",nt=/\n/gm,Jt="__source",rn=X({provide:String,useValue:X});let hn;function un(r){const o=hn;return hn=r,o}function Un(r,o=ri.Default){if(void 0===hn)throw new We(203,"");return null===hn?dt(r,void 0,o):hn.get(r,o&ri.Optional?null:void 0,o)}function Zt(r,o=ri.Default){return(function It(){return on}()||Un)(Ne(r),o)}const Bn=Zt;function li(r){const o=[];for(let a=0;a<r.length;a++){const h=Ne(r[a]);if(Array.isArray(h)){if(0===h.length)throw new We(900,"");let y,w=ri.Default;for(let A=0;A<h.length;A++){const F=h[A],$=ci(F);"number"==typeof $?-1===$?y=F.token:w|=$:y=F}o.push(Zt(y,w))}else o.push(Zt(h))}return o}function pn(r,o){return r[rt]=o,r.prototype[rt]=o,r}function ci(r){return r[rt]}const si=pn(bl("Inject",r=>({token:r})),-1),Ei=pn(bl("Optional"),8),_i=pn(bl("SkipSelf"),4);class Pd{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function ql(r){return r instanceof Pd?r.changingThisBreaksApplicationSecurity:r}const Qm=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,eg=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var oo=(()=>((oo=oo||{})[oo.NONE=0]="NONE",oo[oo.HTML=1]="HTML",oo[oo.STYLE=2]="STYLE",oo[oo.SCRIPT=3]="SCRIPT",oo[oo.URL=4]="URL",oo[oo.RESOURCE_URL=5]="RESOURCE_URL",oo))();function Jc(r){const o=function Xc(){const r=Pn();return r&&r[12]}();return o?o.sanitize(oo.URL,r)||"":function Bu(r,o){const a=function Xm(r){return r instanceof Pd&&r.getTypeName()||null}(r);if(null!=a&&a!==o){if("ResourceURL"===a&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${a} (see https://g.co/ng/security#xss)`)}return a===o}(r,"URL")?ql(r):function Nu(r){return(r=String(r)).match(Qm)||r.match(eg)?r:"unsafe:"+r}(ve(r))}const df="__ngContext__";function zo(r,o){r[df]=o}function $d(r){const o=function Xl(r){return r[df]||null}(r);return o?Array.isArray(o)?o:o.lView:null}function zh(r){return r.ngOriginalError}function mf(r,...o){r.error(...o)}class Gu{constructor(){this._console=console}handleError(o){const a=this._findOriginalError(o),h=function Nh(r){return r&&r.ngErrorLogger||mf}(o);h(this._console,"ERROR",o),a&&h(this._console,"ORIGINAL ERROR",a)}_findOriginalError(o){let a=o&&zh(o);for(;a&&zh(a);)a=zh(a);return a||null}}const vf=(()=>(typeof requestAnimationFrame<"u"&&requestAnimationFrame||setTimeout).bind(Di))();function al(r){return r instanceof Function?r():r}var Ba=(()=>((Ba=Ba||{})[Ba.Important=1]="Important",Ba[Ba.DashCase=2]="DashCase",Ba))();function Ns(r,o){return undefined(r,o)}function Kc(r){const o=r[3];return Nn(o)?o[3]:o}function Zd(r){return jh(r[13])}function Gd(r){return jh(r[4])}function jh(r){for(;null!==r&&!Nn(r);)r=r[4];return r}function ta(r,o,a,h,y){if(null!=h){let w,A=!1;Nn(h)?w=h:nn(h)&&(A=!0,h=h[0]);const F=Jn(h);0===r&&null!==a?null==y?Wd(o,a,F):Ac(o,a,F,y||null,!0):1===r&&null!==a?Ac(o,a,F,y||null,!0):2===r?function Jd(r,o,a){const h=Yd(r,o);h&&function Qc(r,o,a,h){wt(r)?r.removeChild(o,a,h):o.removeChild(a)}(r,h,o,a)}(o,F,A):3===r&&o.destroyNode(F),null!=w&&function Yh(r,o,a,h,y){const w=a[7];w!==Jn(a)&&ta(o,r,h,w,y);for(let F=10;F<a.length;F++){const $=a[F];iu($[1],$,r,o,h,w)}}(o,r,w,a,y)}}function Gh(r,o,a){if(wt(r))return r.createElement(o,a);{const h=null!==a?function Ds(r){const o=r.toLowerCase();return"svg"===o?"http://www.w3.org/2000/svg":"math"===o?"http://www.w3.org/1998/MathML/":null}(a):null;return null===h?r.createElement(o):r.createElementNS(h,o)}}function El(r,o){const a=r[9],h=a.indexOf(o),y=o[3];1024&o[2]&&(o[2]&=-1025,Rr(y,-1)),a.splice(h,1)}function Mc(r,o){if(r.length<=10)return;const a=10+o,h=r[a];if(h){const y=h[17];null!==y&&y!==r&&El(y,h),o>0&&(r[a-1][4]=h[4]);const w=La(r,10+o);!function sg(r,o){iu(r,o,o[11],2,null,null),o[0]=null,o[6]=null}(h[1],h);const A=w[19];null!==A&&A.detachView(w[1]),h[3]=null,h[4]=null,h[2]&=-129}return h}function Mf(r,o){if(!(256&o[2])){const a=o[11];wt(a)&&a.destroyNode&&iu(r,o,a,3,null,null),function lg(r){let o=r[13];if(!o)return Hh(r[1],r);for(;o;){let a=null;if(nn(o))a=o[13];else{const h=o[10];h&&(a=h)}if(!a){for(;o&&!o[4]&&o!==r;)nn(o)&&Hh(o[1],o),o=o[3];null===o&&(o=r),nn(o)&&Hh(o[1],o),a=o&&o[4]}o=a}}(o)}}function Hh(r,o){if(!(256&o[2])){o[2]&=-129,o[2]|=256,function ug(r,o){let a;if(null!=r&&null!=(a=r.destroyHooks))for(let h=0;h<a.length;h+=2){const y=o[a[h]];if(!(y instanceof Ia)){const w=a[h+1];if(Array.isArray(w))for(let A=0;A<w.length;A+=2){const F=y[w[A]],$=w[A+1];try{$.call(F)}finally{}}else try{w.call(y)}finally{}}}}(r,o),function cg(r,o){const a=r.cleanup,h=o[7];let y=-1;if(null!==a)for(let w=0;w<a.length-1;w+=2)if("string"==typeof a[w]){const A=a[w+1],F="function"==typeof A?A(o):Jn(o[A]),$=h[y=a[w+2]],le=a[w+3];"boolean"==typeof le?F.removeEventListener(a[w],$,le):le>=0?h[y=le]():h[y=-le].unsubscribe(),w+=2}else{const A=h[y=a[w+1]];a[w].call(A)}if(null!==h){for(let w=y+1;w<h.length;w++)h[w]();o[7]=null}}(r,o),1===o[1].type&&wt(o[11])&&o[11].destroy();const a=o[17];if(null!==a&&Nn(o[3])){a!==o[3]&&El(a,o);const h=o[19];null!==h&&h.detachView(r)}}}function Af(r,o,a){return function Sf(r,o,a){let h=o;for(;null!==h&&40&h.type;)h=(o=h).parent;if(null===h)return a[0];if(2&h.flags){const y=r.data[h.directiveStart].encapsulation;if(y===Qn.None||y===Qn.Emulated)return null}return Vi(h,a)}(r,o.parent,a)}function Ac(r,o,a,h,y){wt(r)?r.insertBefore(o,a,h,y):o.insertBefore(a,h,y)}function Wd(r,o,a){wt(r)?r.appendChild(o,a):o.appendChild(a)}function Pf(r,o,a,h,y){null!==h?Ac(r,o,a,h,y):Wd(r,o,a)}function Yd(r,o){return wt(r)?r.parentNode(o):o.parentNode}function Qu(r,o,a){return ed(r,o,a)}let ed=function qh(r,o,a){return 40&r.type?Vi(r,a):null};function td(r,o,a,h){const y=Af(r,h,o),w=o[11],F=Qu(h.parent||o[6],h,o);if(null!=y)if(Array.isArray(a))for(let $=0;$<a.length;$++)Pf(w,y,a[$],F,!1);else Pf(w,y,a,F,!1)}function nd(r,o){if(null!==o){const a=o.type;if(3&a)return Vi(o,r);if(4&a)return id(-1,r[o.index]);if(8&a){const h=o.child;if(null!==h)return nd(r,h);{const y=r[o.index];return Nn(y)?id(-1,y):Jn(y)}}if(32&a)return Ns(o,r)()||Jn(r[o.index]);{const h=nu(r,o);return null!==h?Array.isArray(h)?h[0]:nd(Kc(r[16]),h):nd(r,o.next)}}return null}function nu(r,o){return null!==o?r[16][6].projection[o.projection]:null}function id(r,o){const a=10+r+1;if(a<o.length){const h=o[a],y=h[1].firstChild;if(null!==y)return nd(h,y)}return o[7]}function Wh(r,o,a,h,y,w,A){for(;null!=a;){const F=h[a.index],$=a.type;if(A&&0===o&&(F&&zo(Jn(F),h),a.flags|=4),64!=(64&a.flags))if(8&$)Wh(r,o,a.child,h,y,w,!1),ta(o,r,y,F,w);else if(32&$){const le=Ns(a,h);let be;for(;be=le();)ta(o,r,y,be,w);ta(o,r,y,F,w)}else 16&$?Of(r,o,h,a,y,w):ta(o,r,y,F,w);a=A?a.projectionNext:a.next}}function iu(r,o,a,h,y,w){Wh(a,h,r.firstChild,o,y,w,!1)}function Of(r,o,a,h,y,w){const A=a[16],$=A[6].projection[h.projection];if(Array.isArray($))for(let le=0;le<$.length;le++)ta(o,r,y,$[le],w);else Wh(r,o,$,A[3],y,w,!0)}function Xd(r,o,a){wt(r)?r.setAttribute(o,"style",a):o.style.cssText=a}function od(r,o,a){wt(r)?""===a?r.removeAttribute(o,"class"):r.setAttribute(o,"class",a):o.className=a}function sd(r,o,a){let h=r.length;for(;;){const y=r.indexOf(o,a);if(-1===y)return y;if(0===y||r.charCodeAt(y-1)<=32){const w=o.length;if(y+w===h||r.charCodeAt(y+w)<=32)return y}a=y+1}}const Lf="ng-template";function hg(r,o,a){let h=0;for(;h<r.length;){let y=r[h++];if(a&&"class"===y){if(y=r[h],-1!==sd(y.toLowerCase(),o,0))return!0}else if(1===y){for(;h<r.length&&"string"==typeof(y=r[h++]);)if(y.toLowerCase()===o)return!0;return!1}}return!1}function Rf(r){return 4===r.type&&r.value!==Lf}function pg(r,o,a){return o===(4!==r.type||a?r.value:Lf)}function fg(r,o,a){let h=4;const y=r.attrs||[],w=function Ff(r){for(let o=0;o<r.length;o++)if(Ka(r[o]))return o;return r.length}(y);let A=!1;for(let F=0;F<o.length;F++){const $=o[F];if("number"!=typeof $){if(!A)if(4&h){if(h=2|1&h,""!==$&&!pg(r,$,a)||""===$&&1===o.length){if(Ca(h))return!1;A=!0}}else{const le=8&h?$:o[++F];if(8&h&&null!==r.attrs){if(!hg(r.attrs,le,a)){if(Ca(h))return!1;A=!0}continue}const ut=ru(8&h?"class":$,y,Rf(r),a);if(-1===ut){if(Ca(h))return!1;A=!0;continue}if(""!==le){let Rt;Rt=ut>w?"":y[ut+1].toLowerCase();const Kt=8&h?Rt:null;if(Kt&&-1!==sd(Kt,le,0)||2&h&&le!==Rt){if(Ca(h))return!1;A=!0}}}}else{if(!A&&!Ca(h)&&!Ca($))return!1;if(A&&Ca($))continue;A=!1,h=$|1&h}}return Ca(h)||A}function Ca(r){return 0==(1&r)}function ru(r,o,a,h){if(null===o)return-1;let y=0;if(h||!a){let w=!1;for(;y<o.length;){const A=o[y];if(A===r)return y;if(3===A||6===A)w=!0;else{if(1===A||2===A){let F=o[++y];for(;"string"==typeof F;)F=o[++y];continue}if(4===A)break;if(0===A){y+=4;continue}}y+=w?1:2}return-1}return function Bf(r,o){let a=r.indexOf(4);if(a>-1)for(a++;a<r.length;){const h=r[a];if("number"==typeof h)return-1;if(h===o)return a;a++}return-1}(o,r)}function kf(r,o,a=!1){for(let h=0;h<o.length;h++)if(fg(r,o[h],a))return!0;return!1}function gg(r,o){e:for(let a=0;a<o.length;a++){const h=o[a];if(r.length===h.length){for(let y=0;y<r.length;y++)if(r[y]!==h[y])continue e;return!0}}return!1}function zf(r,o){return r?":not("+o.trim()+")":o}function Sc(r){let o=r[0],a=1,h=2,y="",w=!1;for(;a<r.length;){let A=r[a];if("string"==typeof A)if(2&h){const F=r[++a];y+="["+A+(F.length>0?'="'+F+'"':"")+"]"}else 8&h?y+="."+A:4&h&&(y+=" "+A);else""!==y&&!Ca(A)&&(o+=zf(w,y),y=""),h=A,w=w||!Ca(h);a++}return""!==y&&(o+=zf(w,y)),o}const rr={};function ou(r){su(ur(),Pn(),Do()+r,!1)}function su(r,o,a,h){if(!h)if(3==(3&o[2])){const w=r.preOrderCheckHooks;null!==w&&xo(o,w,a)}else{const w=r.preOrderHooks;null!==w&&Wa(o,w,0,a)}Fo(a)}function Kl(r,o){return r<<17|o<<2}function za(r){return r>>17&32767}function Qd(r){return 2|r}function ll(r){return(131068&r)>>2}function Xh(r,o){return-131069&r|o<<2}function Kh(r){return 1|r}function cd(r,o){const a=r.contentQueries;if(null!==a)for(let h=0;h<a.length;h+=2){const y=a[h],w=a[h+1];if(-1!==w){const A=r.data[w];Cr(y),A.contentQueries(2,o[w],w)}}}function ud(r,o,a,h,y,w,A,F,$,le){const be=o.blueprint.slice();return be[0]=y,be[2]=140|h,Ii(be),be[3]=be[15]=r,be[8]=a,be[10]=A||r&&r[10],be[11]=F||r&&r[11],be[12]=$||r&&r[12]||null,be[9]=le||r&&r[9]||null,be[6]=w,be[16]=2==o.type?r[16]:be,be}function uu(r,o,a,h,y){let w=r.data[o];if(null===w)w=function sp(r,o,a,h,y){const w=gl(),A=Ha(),$=r.data[o]=function lp(r,o,a,h,y,w){return{type:a,index:h,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:y,attrs:w,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,A?w:w&&w.parent,a,o,h,y);return null===r.firstChild&&(r.firstChild=$),null!==w&&(A?null==w.child&&null!==$.parent&&(w.child=$):null===w.next&&(w.next=$)),$}(r,o,a,h,y),function fe(){return Ri.lFrame.inI18n}()&&(w.flags|=64);else if(64&w.type){w.type=a,w.value=h,w.attrs=y;const A=function _s(){const r=Ri.lFrame,o=r.currentTNode;return r.isParent?o:o.parent}();w.injectorIndex=null===A?-1:A.injectorIndex}return Oo(w,!0),w}function ec(r,o,a,h){if(0===a)return-1;const y=o.length;for(let w=0;w<a;w++)o.push(h),r.blueprint.push(h),r.data.push(null);return y}function Oc(r,o,a){Lo(o);try{const h=r.viewQuery;null!==h&&yp(1,h,a);const y=r.template;null!==y&&du(r,o,y,1,a),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&cd(r,o),r.staticViewQueries&&yp(2,r.viewQuery,a);const w=r.components;null!==w&&function Gf(r,o){for(let a=0;a<o.length;a++)tc(r,o[a])}(o,w)}catch(h){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),h}finally{o[2]&=-5,Ea()}}function Lc(r,o,a,h){const y=o[2];if(256!=(256&y)){Lo(o);try{Ii(o),function Z(r){return Ri.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==a&&du(r,o,a,2,h);const A=3==(3&y);if(A){const le=r.preOrderCheckHooks;null!==le&&xo(o,le,null)}else{const le=r.preOrderHooks;null!==le&&Wa(o,le,0,null),Ya(o,0)}if(function kg(r){for(let o=Zd(r);null!==o;o=Gd(o)){if(!o[2])continue;const a=o[9];for(let h=0;h<a.length;h++){const y=a[h],w=y[3];0==(1024&y[2])&&Rr(w,1),y[2]|=1024}}}(o),function am(r){for(let o=Zd(r);null!==o;o=Gd(o))for(let a=10;a<o.length;a++){const h=o[a],y=h[1];H(h)&&Lc(y,h,y.template,h[8])}}(o),null!==r.contentQueries&&cd(r,o),A){const le=r.contentCheckHooks;null!==le&&xo(o,le)}else{const le=r.contentHooks;null!==le&&Wa(o,le,1),Ya(o,1)}!function Mg(r,o){const a=r.hostBindingOpCodes;if(null!==a)try{for(let h=0;h<a.length;h++){const y=a[h];if(y<0)Fo(~y);else{const w=y,A=a[++h],F=a[++h];Sn(A,w),F(2,o[w])}}}finally{Fo(-1)}}(r,o);const F=r.components;null!==F&&function cu(r,o){for(let a=0;a<o.length;a++)hp(r,o[a])}(o,F);const $=r.viewQuery;if(null!==$&&yp(2,$,h),A){const le=r.viewCheckHooks;null!==le&&xo(o,le)}else{const le=r.viewHooks;null!==le&&Wa(o,le,2),Ya(o,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),o[2]&=-73,1024&o[2]&&(o[2]&=-1025,Rr(o[3],-1))}finally{Ea()}}}function ha(r,o,a,h){const y=o[10],A=W(o);try{!A&&y.begin&&y.begin(),A&&Oc(r,o,h),Lc(r,o,a,h)}finally{!A&&y.end&&y.end()}}function du(r,o,a,h,y){const w=Do(),A=2&h;try{Fo(-1),A&&o.length>20&&su(r,o,20,!1),a(h,y)}finally{Fo(w)}}function Rc(r,o,a){if(hi(o)){const y=o.directiveEnd;for(let w=o.directiveStart;w<y;w++){const A=r.data[w];A.contentQueries&&A.contentQueries(1,a[w],w)}}}function dd(r,o,a){!Is()||(function tm(r,o,a,h){const y=a.directiveStart,w=a.directiveEnd;r.firstCreatePass||la(a,o),zo(h,o);const A=a.initialInputs;for(let F=y;F<w;F++){const $=r.data[F],le=Ki($);le&&Lg(o,a,$);const be=Tr(o,r,F,a);zo(be,o),null!==A&&Rg(0,F-y,be,$,0,A),le&&(ee(a.index,o)[8]=be)}}(r,o,a,Vi(a,o)),128==(128&a.flags)&&function up(r,o,a){const h=a.directiveStart,y=a.directiveEnd,A=a.index,F=function Yn(){return Ri.lFrame.currentDirectiveIndex}();try{Fo(A);for(let $=h;$<y;$++){const le=r.data[$],be=o[$];Li($),(null!==le.hostBindings||0!==le.hostVars||null!==le.hostAttrs)&&kc(le,be)}}finally{Fo(-1),Li(F)}}(r,o,a))}function hu(r,o,a=Vi){const h=o.localNames;if(null!==h){let y=o.index+1;for(let w=0;w<h.length;w+=2){const A=h[w+1],F=-1===A?a(o,r):r[A];r[y++]=F}}}function Hf(r){const o=r.tView;return null===o||o.incompleteFirstPass?r.tView=hd(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts):o}function hd(r,o,a,h,y,w,A,F,$,le){const be=20+h,ut=be+y,Rt=function qf(r,o){const a=[];for(let h=0;h<o;h++)a.push(h<r?null:rr);return a}(be,ut),Kt="function"==typeof le?le():le;return Rt[1]={type:r,blueprint:Rt,template:a,queries:null,viewQuery:F,declTNode:o,data:Rt.slice().fill(null,be),bindingStartIndex:be,expandoStartIndex:ut,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof w?w():w,pipeRegistry:"function"==typeof A?A():A,firstChild:null,schemas:$,consts:Kt,incompleteFirstPass:!1}}function sh(r,o,a,h){const y=Ml(o);null===a?y.push(h):(y.push(a),r.firstCreatePass&&hm(r).push(h,y.length-1))}function cp(r,o,a){for(let h in r)if(r.hasOwnProperty(h)){const y=r[h];(a=null===a?{}:a).hasOwnProperty(h)?a[h].push(o,y):a[h]=[o,y]}return a}function No(r,o,a,h,y,w,A,F){const $=Vi(o,a);let be,le=o.inputs;!F&&null!=le&&(be=le[h])?(gd(r,a,be,h,y),bi(o)&&function Jf(r,o){const a=ee(o,r);16&a[2]||(a[2]|=64)}(a,o.index)):3&o.type&&(h=function Yf(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(h),y=null!=A?A(y,o.value||"",h):y,wt(w)?w.setProperty($,h,y):bo(h)||($.setProperty?$.setProperty(h,y):$[h]=y))}function ah(r,o,a,h){let y=!1;if(Is()){const w=function nm(r,o,a){const h=r.directiveRegistry;let y=null;if(h)for(let w=0;w<h.length;w++){const A=h[w];kf(a,A.selectors,!1)&&(y||(y=[]),G(la(a,o),r,A.type),Ki(A)?(pd(r,a),y.unshift(A)):y.push(A))}return y}(r,o,a),A=null===h?null:{"":-1};if(null!==w){y=!0,fd(a,r.data.length,w.length);for(let be=0;be<w.length;be++){const ut=w[be];ut.providersResolver&&ut.providersResolver(ut)}let F=!1,$=!1,le=ec(r,o,w.length,null);for(let be=0;be<w.length;be++){const ut=w[be];a.mergedAttrs=$o(a.mergedAttrs,ut.hostAttrs),rm(r,a,o,le,ut),lh(le,ut,A),null!==ut.contentQueries&&(a.flags|=8),(null!==ut.hostBindings||null!==ut.hostAttrs||0!==ut.hostVars)&&(a.flags|=128);const Rt=ut.type.prototype;!F&&(Rt.ngOnChanges||Rt.ngOnInit||Rt.ngDoCheck)&&((r.preOrderHooks||(r.preOrderHooks=[])).push(a.index),F=!0),!$&&(Rt.ngOnChanges||Rt.ngDoCheck)&&((r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(a.index),$=!0),le++}!function Sg(r,o){const h=o.directiveEnd,y=r.data,w=o.attrs,A=[];let F=null,$=null;for(let le=o.directiveStart;le<h;le++){const be=y[le],ut=be.inputs,Rt=null===w||Rf(o)?null:fu(ut,w);A.push(Rt),F=cp(ut,le,F),$=cp(be.outputs,le,$)}null!==F&&(F.hasOwnProperty("class")&&(o.flags|=16),F.hasOwnProperty("style")&&(o.flags|=32)),o.initialInputs=A,o.inputs=F,o.outputs=$}(r,a)}A&&function im(r,o,a){if(o){const h=r.localNames=[];for(let y=0;y<o.length;y+=2){const w=a[o[y+1]];if(null==w)throw new We(-301,!1);h.push(o[y],w)}}}(a,h,A)}return a.mergedAttrs=$o(a.mergedAttrs,a.attrs),y}function pu(r,o,a,h,y,w){const A=w.hostBindings;if(A){let F=r.hostBindingOpCodes;null===F&&(F=r.hostBindingOpCodes=[]);const $=~o.index;(function em(r){let o=r.length;for(;o>0;){const a=r[--o];if("number"==typeof a&&a<0)return a}return 0})(F)!=$&&F.push($),F.push(h,y,A)}}function kc(r,o){null!==r.hostBindings&&r.hostBindings(1,o)}function pd(r,o){o.flags|=2,(r.components||(r.components=[])).push(o.index)}function lh(r,o,a){if(a){if(o.exportAs)for(let h=0;h<o.exportAs.length;h++)a[o.exportAs[h]]=r;Ki(o)&&(a[""]=r)}}function fd(r,o,a){r.flags|=1,r.directiveStart=o,r.directiveEnd=o+a,r.providerIndexes=o}function rm(r,o,a,h,y){r.data[h]=y;const w=y.factory||(y.factory=ls(y.type)),A=new Ia(w,Ki(y),null);r.blueprint[h]=A,a[h]=A,pu(r,o,0,h,ec(r,a,y.hostVars,rr),y)}function Lg(r,o,a){const h=Vi(o,r),y=Hf(a),w=r[10],A=md(r,ud(r,y,null,a.onPush?64:16,h,o,w,w.createRenderer(h,a),null,null));r[o.index]=A}function cl(r,o,a,h,y,w){const A=Vi(r,o);!function dp(r,o,a,h,y,w,A){if(null==w)wt(r)?r.removeAttribute(o,y,a):o.removeAttribute(y);else{const F=null==A?ve(w):A(w,h||"",y);wt(r)?r.setAttribute(o,y,F,a):a?o.setAttributeNS(a,y,F):o.setAttribute(y,F)}}(o[11],A,w,r.value,a,h,y)}function Rg(r,o,a,h,y,w){const A=w[o];if(null!==A){const F=h.setInput;for(let $=0;$<A.length;){const le=A[$++],be=A[$++],ut=A[$++];null!==F?h.setInput(a,ut,le,be):a[be]=ut}}}function fu(r,o){let a=null,h=0;for(;h<o.length;){const y=o[h];if(0!==y)if(5!==y){if("number"==typeof y)break;r.hasOwnProperty(y)&&(null===a&&(a=[]),a.push(y,r[y],o[h+1])),h+=2}else h+=2;else h+=4}return a}function sm(r,o,a,h){return new Array(r,!0,!1,o,null,0,h,a,null,null)}function hp(r,o){const a=ee(o,r);if(H(a)){const h=a[1];80&a[2]?Lc(h,a,h.template,a[8]):a[5]>0&&pp(a)}}function pp(r){for(let h=Zd(r);null!==h;h=Gd(h))for(let y=10;y<h.length;y++){const w=h[y];if(1024&w[2]){const A=w[1];Lc(A,w,A.template,w[8])}else w[5]>0&&pp(w)}const a=r[1].components;if(null!==a)for(let h=0;h<a.length;h++){const y=ee(a[h],r);H(y)&&y[5]>0&&pp(y)}}function tc(r,o){const a=ee(o,r),h=a[1];(function lm(r,o){for(let a=o.length;a<r.blueprint.length;a++)o.push(r.blueprint[a])})(h,a),Oc(h,a,a[8])}function md(r,o){return r[13]?r[14][4]=o:r[13]=o,r[14]=o,o}function mu(r){for(;r;){r[2]|=64;const o=Kc(r);if(zr(r)&&!o)return r;r=o}return null}function cm(r){!function mp(r){for(let o=0;o<r.components.length;o++){const a=r.components[o],h=$d(a),y=h[1];ha(y,h,y.template,a)}}(r[8])}function yp(r,o,a){Cr(0),o(r,a)}const vp=(()=>Promise.resolve(null))();function Ml(r){return r[7]||(r[7]=[])}function hm(r){return r.cleanup||(r.cleanup=[])}function xp(r,o){const a=r[9],h=a?a.get(Gu,null):null;h&&h.handleError(o)}function gd(r,o,a,h,y){for(let w=0;w<a.length;){const A=a[w++],F=a[w++],$=o[A],le=r.data[A];null!==le.setInput?le.setInput($,y,h,F):$[F]=y}}function Al(r,o,a){const h=er(o,r);!function Df(r,o,a){wt(r)?r.setValue(o,a):o.textContent=a}(r[11],h,a)}function uh(r,o,a){let h=a?r.styles:null,y=a?r.classes:null,w=0;if(null!==o)for(let A=0;A<o.length;A++){const F=o[A];"number"==typeof F?w=F:1==w?y=Ie(y,F):2==w&&(h=Ie(h,F+": "+o[++A]+";"))}a?r.styles=h:r.stylesWithoutHost=h,a?r.classes=y:r.classesWithoutHost=y}const bp=new lo("INJECTOR",-1);class gu{get(o,a=Ye){if(a===Ye){const h=new Error(`NullInjectorError: No provider for ${se(o)}!`);throw h.name="NullInjectorError",h}return a}}const _d=new lo("Set Injector scope."),yd={},zg={};let dh;function fm(){return void 0===dh&&(dh=new gu),dh}function mm(r,o=null,a=null,h){const y=gm(r,o,a,h);return y._resolveInjectorDefTypes(),y}function gm(r,o=null,a=null,h){return new _m(r,a,o||fm(),h)}class _m{constructor(o,a,h,y=null){this.parent=h,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const w=[];a&&Xs(a,F=>this.processProvider(F,o,a)),Xs([o],F=>this.processInjectorType(F,[],w)),this.records.set(bp,ns(void 0,this));const A=this.records.get(_d);this.scope=null!=A?A.value:null,this.source=y||("object"==typeof o?null:se(o))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(o=>o.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(o,a=Ye,h=ri.Default){this.assertNotDestroyed();const y=un(this),w=qe(void 0);try{if(!(h&ri.SkipSelf)){let F=this.records.get(o);if(void 0===F){const $=function Sl(r){return"function"==typeof r||"object"==typeof r&&r instanceof lo}(o)&&qt(o);F=$&&this.injectableDefInScope($)?ns(hh(o),yd):null,this.records.set(o,F)}if(null!=F)return this.hydrate(o,F)}return(h&ri.Self?fm():this.parent).get(o,a=h&ri.Optional&&a===Ye?null:a)}catch(A){if("NullInjectorError"===A.name){if((A[ot]=A[ot]||[]).unshift(se(o)),y)throw A;return function Ti(r,o,a,h){const y=r[ot];throw o[Jt]&&y.unshift(o[Jt]),r.message=function ui(r,o,a,h=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.substr(2):r;let y=se(o);if(Array.isArray(o))y=o.map(se).join(" -> ");else if("object"==typeof o){let w=[];for(let A in o)if(o.hasOwnProperty(A)){let F=o[A];w.push(A+":"+("string"==typeof F?JSON.stringify(F):se(F)))}y=`{${w.join(", ")}}`}return`${a}${h?"("+h+")":""}[${y}]: ${r.replace(nt,"\n  ")}`}("\n"+r.message,y,a,h),r.ngTokenPath=y,r[ot]=null,r}(A,o,"R3InjectorError",this.source)}throw A}finally{qe(w),un(y)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(o=>this.get(o))}toString(){const o=[];return this.records.forEach((h,y)=>o.push(se(y))),`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new We(205,!1)}processInjectorType(o,a,h){if(!(o=Ne(o)))return!1;let y=Xi(o);const w=null==y&&o.ngModule||void 0,A=void 0===w?o:w,F=-1!==h.indexOf(A);if(void 0!==w&&(y=Xi(w)),null==y)return!1;if(null!=y.imports&&!F){let be;h.push(A);try{Xs(y.imports,ut=>{this.processInjectorType(ut,a,h)&&(void 0===be&&(be=[]),be.push(ut))})}finally{}if(void 0!==be)for(let ut=0;ut<be.length;ut++){const{ngModule:Rt,providers:Kt}=be[ut];Xs(Kt,Mn=>this.processProvider(Mn,Rt,Kt||Oi))}}this.injectorDefTypes.add(A);const $=ls(A)||(()=>new A);this.records.set(A,ns($,yd));const le=y.providers;if(null!=le&&!F){const be=o;Xs(le,ut=>this.processProvider(ut,be,le))}return void 0!==w&&void 0!==o.providers}processProvider(o,a,h){let y=ul(o=Ne(o))?o:Ne(o&&o.provide);const w=function _u(r,o,a){return ym(r)?ns(void 0,r.useValue):ns(Us(r),yd)}(o);if(ul(o)||!0!==o.multi)this.records.get(y);else{let A=this.records.get(y);A||(A=ns(void 0,yd,!0),A.factory=()=>li(A.multi),this.records.set(y,A)),y=o,A.multi.push(o)}this.records.set(y,w)}hydrate(o,a){return a.value===yd&&(a.value=zg,a.value=a.factory()),"object"==typeof a.value&&a.value&&function vm(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(a.value)&&this.onDestroy.add(a.value),a.value}injectableDefInScope(o){if(!o.providedIn)return!1;const a=Ne(o.providedIn);return"string"==typeof a?"any"===a||a===this.scope:this.injectorDefTypes.has(a)}}function hh(r){const o=qt(r),a=null!==o?o.factory:ls(r);if(null!==a)return a;if(r instanceof lo)throw new We(204,!1);if(r instanceof Function)return function vd(r){const o=r.length;if(o>0)throw cs(o,"?"),new We(204,!1);const a=function yi(r){const o=r&&(r[mr]||r[Ai]);if(o){const a=function Ui(r){if(r.hasOwnProperty("name"))return r.name;const o=(""+r).match(/^function\s*([^\s(]+)/);return null===o?"":o[1]}(r);return console.warn(`DEPRECATED: DI is instantiating a token "${a}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${a}" class.`),o}return null}(r);return null!==a?()=>a.factory(r):()=>new r}(r);throw new We(204,!1)}function Us(r,o,a){let h;if(ul(r)){const y=Ne(r);return ls(y)||hh(y)}if(ym(r))h=()=>Ne(r.useValue);else if(function wp(r){return!(!r||!r.useFactory)}(r))h=()=>r.useFactory(...li(r.deps||[]));else if(function Ng(r){return!(!r||!r.useExisting)}(r))h=()=>Zt(Ne(r.useExisting));else{const y=Ne(r&&(r.useClass||r.provide));if(!function Cp(r){return!!r.deps}(r))return ls(y)||hh(y);h=()=>new y(...li(r.deps))}return h}function ns(r,o,a=!1){return{factory:r,value:o,multi:a?[]:void 0}}function ym(r){return null!==r&&"object"==typeof r&&rn in r}function ul(r){return"function"==typeof r}let Ua=(()=>{class r{static create(a,h){if(Array.isArray(a))return mm({name:""},h,a,"");{const y=a.name??"";return mm({name:y},a.parent,a.providers,y)}}}return r.THROW_IF_NOT_FOUND=Ye,r.NULL=new gu,r.\u0275prov=Tn({token:r,providedIn:"any",factory:()=>Zt(bp)}),r.__NG_ELEMENT_ID__=-1,r})();function Cm(r,o){va($d(r)[1],ro())}function mh(r){let o=function Sp(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),a=!0;const h=[r];for(;o;){let y;if(Ki(r))y=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new We(903,"");y=o.\u0275dir}if(y){if(a){h.push(y);const A=r;A.inputs=gh(r.inputs),A.declaredInputs=gh(r.declaredInputs),A.outputs=gh(r.outputs);const F=y.hostBindings;F&&Dm(r,F);const $=y.viewQuery,le=y.contentQueries;if($&&Em(r,$),le&&nc(r,le),ue(r.inputs,y.inputs),ue(r.declaredInputs,y.declaredInputs),ue(r.outputs,y.outputs),Ki(y)&&y.data.animation){const be=r.data;be.animation=(be.animation||[]).concat(y.data.animation)}}const w=y.features;if(w)for(let A=0;A<w.length;A++){const F=w[A];F&&F.ngInherit&&F(r),F===mh&&(a=!1)}}o=Object.getPrototypeOf(o)}!function Tm(r){let o=0,a=null;for(let h=r.length-1;h>=0;h--){const y=r[h];y.hostVars=o+=y.hostVars,y.hostAttrs=$o(y.hostAttrs,a=$o(a,y.hostAttrs))}}(h)}function gh(r){return r===$i?{}:r===Oi?[]:r}function Em(r,o){const a=r.viewQuery;r.viewQuery=a?(h,y)=>{o(h,y),a(h,y)}:o}function nc(r,o){const a=r.contentQueries;r.contentQueries=a?(h,y,w)=>{o(h,y,w),a(h,y,w)}:o}function Dm(r,o){const a=r.hostBindings;r.hostBindings=a?(h,y)=>{o(h,y),a(h,y)}:o}let xu=null;function ic(){if(!xu){const r=Di.Symbol;if(r&&r.iterator)xu=r.iterator;else{const o=Object.getOwnPropertyNames(Map.prototype);for(let a=0;a<o.length;++a){const h=o[a];"entries"!==h&&"size"!==h&&Map.prototype[h]===Map.prototype.entries&&(xu=h)}}}return xu}function zc(r){return!!Ol(r)&&(Array.isArray(r)||!(r instanceof Map)&&ic()in r)}function Ol(r){return null!==r&&("function"==typeof r||"object"==typeof r)}function ja(r,o,a){return r[o]=a}function is(r,o,a){return!Object.is(r[o],a)&&(r[o]=a,!0)}function rc(r,o,a,h){const y=is(r,o,a);return is(r,o+1,h)||y}function yh(r,o,a,h){const y=Pn();return is(y,D(),o)&&(ur(),cl(kr(),y,r,o,a,h)),yh}function oc(r,o,a,h){return is(r,D(),a)?o+ve(a)+h:rr}function Uc(r,o,a,h,y,w,A,F){const le=function bd(r,o,a,h,y){const w=rc(r,o,a,h);return is(r,o+2,y)||w}(r,E(),a,y,A);return j(3),le?o+ve(a)+h+ve(y)+w+ve(A)+F:rr}function Cu(r,o,a,h,y,w,A,F,$,le){const ut=function Ta(r,o,a,h,y,w){const A=rc(r,o,a,h);return rc(r,o+2,y,w)||A}(r,E(),a,y,A,$);return j(4),ut?o+ve(a)+h+ve(y)+w+ve(A)+F+ve($)+le:rr}function Pm(r,o,a,h,y,w,A,F){const $=Pn(),le=ur(),be=r+20,ut=le.firstCreatePass?function Sm(r,o,a,h,y,w,A,F,$){const le=o.consts,be=uu(o,r,4,A||null,wn(le,F));ah(o,a,be,wn(le,$)),va(o,be);const ut=be.tViews=hd(2,be,h,y,w,o.directiveRegistry,o.pipeRegistry,null,o.schemas,le);return null!==o.queries&&(o.queries.template(o,be),ut.queries=o.queries.embeddedTView(be)),be}(be,le,$,o,a,h,y,w,A):le.data[be];Oo(ut,!1);const Rt=$[11].createComment("");td(le,$,Rt,ut),zo(Rt,$),md($,$[be]=sm(Rt,$,Rt,ut)),Bi(ut)&&dd(le,$,ut),null!=A&&hu($,ut,F)}function Lm(r){return br(function zl(){return Ri.lFrame.contextLView}(),20+r)}function _o(r,o=ri.Default){const a=Pn();return null===a?Zt(r,o):Mt(ro(),a,Ne(r),o)}function Hr(){throw new Error("invalid")}function To(r,o,a){const h=Pn();return is(h,D(),o)&&No(ur(),kr(),h,r,o,h[11],a,!1),To}function vr(r,o,a,h,y){const A=y?"class":"style";gd(r,a,o.inputs[A],A,h)}function Pr(r,o,a,h){const y=Pn(),w=ur(),A=20+r,F=y[11],$=y[A]=Gh(F,o,function Ul(){return Ri.lFrame.currentNamespace}()),le=w.firstCreatePass?function pr(r,o,a,h,y,w,A){const F=o.consts,le=uu(o,r,2,y,wn(F,w));return ah(o,a,le,wn(F,A)),null!==le.attrs&&uh(le,le.attrs,!1),null!==le.mergedAttrs&&uh(le,le.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,le),le}(A,w,y,0,o,a,h):w.data[A];Oo(le,!0);const be=le.mergedAttrs;null!==be&&Xa(F,$,be);const ut=le.classes;null!==ut&&od(F,$,ut);const Rt=le.styles;return null!==Rt&&Xd(F,$,Rt),64!=(64&le.flags)&&td(w,y,$,le),0===function fl(){return Ri.lFrame.elementDepthCount}()&&zo($,y),function uc(){Ri.lFrame.elementDepthCount++}(),Bi(le)&&(dd(w,y,le),Rc(w,le,y)),null!==h&&hu(y,le),Pr}function io(){let r=ro();Ha()?Hs():(r=r.parent,Oo(r,!1));const o=r;!function ml(){Ri.lFrame.elementDepthCount--}();const a=ur();return a.firstCreatePass&&(va(a,r),hi(r)&&a.queries.elementEnd(r)),null!=o.classesWithoutHost&&function mc(r){return 0!=(16&r.flags)}(o)&&vr(a,o,Pn(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function Zl(r){return 0!=(32&r.flags)}(o)&&vr(a,o,Pn(),o.stylesWithoutHost,!1),io}function uo(r,o,a,h){return Pr(r,o,a,h),io(),uo}function xs(r,o,a){const h=Pn(),y=ur(),w=r+20,A=y.firstCreatePass?function Ho(r,o,a,h,y){const w=o.consts,A=wn(w,h),F=uu(o,r,8,"ng-container",A);return null!==A&&uh(F,A,!0),ah(o,a,F,wn(w,y)),null!==o.queries&&o.queries.elementStart(o,F),F}(w,y,h,o,a):y.data[w];Oo(A,!0);const F=h[w]=h[11].createComment("");return td(y,h,F,A),zo(F,h),Bi(A)&&(dd(y,h,A),Rc(y,A,h)),null!=a&&hu(h,A),xs}function hs(){let r=ro();const o=ur();return Ha()?Hs():(r=r.parent,Oo(r,!1)),o.firstCreatePass&&(va(o,r),hi(r)&&o.queries.elementEnd(r)),hs}function Fr(r,o,a){return xs(r,o,a),hs(),Fr}function bs(){return Pn()}function Os(r){return!!r&&"function"==typeof r.then}function qo(r){return!!r&&"function"==typeof r.subscribe}const Vo=qo;function Jr(r,o,a,h){const y=Pn(),w=ur(),A=ro();return function ws(r,o,a,h,y,w,A,F){const $=Bi(h),be=r.firstCreatePass&&hm(r),ut=o[8],Rt=Ml(o);let Kt=!0;if(3&h.type||F){const fi=Vi(h,o),Pi=F?F(fi):fi,Fn=Rt.length,ji=F?Or=>F(Jn(Or[h.index])):h.index;if(wt(a)){let Or=null;if(!F&&$&&(Or=function $s(r,o,a,h){const y=r.cleanup;if(null!=y)for(let w=0;w<y.length-1;w+=2){const A=y[w];if(A===a&&y[w+1]===h){const F=o[7],$=y[w+2];return F.length>$?F[$]:null}"string"==typeof A&&(w+=2)}return null}(r,o,y,h.index)),null!==Or)(Or.__ngLastListenerFn__||Or).__ngNextListenerFn__=w,Or.__ngLastListenerFn__=w,Kt=!1;else{w=ps(h,o,ut,w,!1);const so=a.listen(Pi,y,w);Rt.push(w,so),be&&be.push(y,ji,Fn,Fn+1)}}else w=ps(h,o,ut,w,!0),Pi.addEventListener(y,w,A),Rt.push(w),be&&be.push(y,ji,Fn,A)}else w=ps(h,o,ut,w,!1);const Mn=h.outputs;let Kn;if(Kt&&null!==Mn&&(Kn=Mn[y])){const fi=Kn.length;if(fi)for(let Pi=0;Pi<fi;Pi+=2){const Ga=o[Kn[Pi]][Kn[Pi+1]].subscribe(w),Id=Rt.length;Rt.push(w,Ga),be&&be.push(y,h.index,Id,-(Id+1))}}}(w,y,y[11],A,r,o,!!a,h),Jr}function Eo(r,o,a,h){try{return!1!==a(h)}catch(y){return xp(r,y),!1}}function ps(r,o,a,h,y){return function w(A){if(A===Function)return h;const F=2&r.flags?ee(r.index,o):o;0==(32&o[2])&&mu(F);let $=Eo(o,0,h,A),le=w.__ngNextListenerFn__;for(;le;)$=Eo(o,0,le,A)&&$,le=le.__ngNextListenerFn__;return y&&!1===$&&(A.preventDefault(),A.returnValue=!1),$}}function fs(r=1){return function Da(r){return(Ri.lFrame.contextLView=function sa(r,o){for(;r>0;)o=o[15],r--;return o}(r,Ri.lFrame.contextLView))[8]}(r)}function Wo(r,o){let a=null;const h=function mg(r){const o=r.attrs;if(null!=o){const a=o.indexOf(5);if(0==(1&a))return o[a+1]}return null}(r);for(let y=0;y<o.length;y++){const w=o[y];if("*"!==w){if(null===h?kf(r,w,!0):gg(h,w))return y}else a=y}return a}function fa(r){const o=Pn()[16][6];if(!o.projection){const h=o.projection=cs(r?r.length:1,null),y=h.slice();let w=o.child;for(;null!==w;){const A=r?Wo(w,r):0;null!==A&&(y[A]?y[A].projectionNext=w:h[A]=w,y[A]=w),w=w.next}}}function Ll(r,o=0,a){const h=Pn(),y=ur(),w=uu(y,20+r,16,null,a||null);null===w.projection&&(w.projection=o),Hs(),64!=(64&w.flags)&&function rd(r,o,a){Of(o[11],0,o,a,Af(r,a,o),Qu(a.parent||o[6],a,o))}(y,h,w)}function $c(r,o,a){return jc(r,"",o,"",a),$c}function jc(r,o,a,h,y){const w=Pn(),A=oc(w,o,a,h);return A!==rr&&No(ur(),kr(),w,r,A,w[11],y,!1),jc}function Rl(r,o,a,h,y){const w=r[a+1],A=null===o;let F=h?za(w):ll(w),$=!1;for(;0!==F&&(!1===$||A);){const be=r[F+1];Up(r[F],o)&&($=!0,r[F+1]=h?Kh(be):Qd(be)),F=h?za(be):ll(be)}$&&(r[a+1]=h?Qd(w):Kh(w))}function Up(r,o){return null===r||null==o||(Array.isArray(r)?r[1]:r)===o||!(!Array.isArray(r)||"string"!=typeof o)&&C(r,o)>=0}function Yg(r,o,a){return kl(r,o,a,!1),Yg}function Jg(r,o){return kl(r,o,null,!0),Jg}function kl(r,o,a,h){const y=Pn(),w=ur(),A=j(2);w.firstUpdatePass&&function hy(r,o,a,h){const y=r.data;if(null===y[a+1]){const w=y[Do()],A=function dy(r,o){return o>=r.expandoStartIndex}(r,a);(function gy(r,o){return 0!=(r.flags&(o?16:32))})(w,h)&&null===o&&!A&&(o=!1),o=function L0(r,o,a,h){const y=function pi(r){const o=Ri.lFrame.currentDirectiveIndex;return-1===o?null:r[o]}(r);let w=h?o.residualClasses:o.residualStyles;if(null===y)0===(h?o.classBindings:o.styleBindings)&&(a=Vp(a=Xg(null,r,o,a,h),o.attrs,h),w=null);else{const A=o.directiveStylingLast;if(-1===A||r[A]!==y)if(a=Xg(y,r,o,a,h),null===w){let $=function R0(r,o,a){const h=a?o.classBindings:o.styleBindings;if(0!==ll(h))return r[za(h)]}(r,o,h);void 0!==$&&Array.isArray($)&&($=Xg(null,r,o,$[1],h),$=Vp($,o.attrs,h),function k0(r,o,a,h){r[za(a?o.classBindings:o.styleBindings)]=h}(r,o,h,$))}else w=function F0(r,o,a){let h;const y=o.directiveEnd;for(let w=1+o.directiveStylingLast;w<y;w++)h=Vp(h,r[w].hostAttrs,a);return Vp(h,o.attrs,a)}(r,o,h)}return void 0!==w&&(h?o.residualClasses=w:o.residualStyles=w),a}(y,w,o,h),function zp(r,o,a,h,y,w){let A=w?o.classBindings:o.styleBindings,F=za(A),$=ll(A);r[h]=a;let be,le=!1;if(Array.isArray(a)){const ut=a;be=ut[1],(null===be||C(ut,be)>0)&&(le=!0)}else be=a;if(y)if(0!==$){const Rt=za(r[F+1]);r[h+1]=Kl(Rt,F),0!==Rt&&(r[Rt+1]=Xh(r[Rt+1],h)),r[F+1]=function ad(r,o){return 131071&r|o<<17}(r[F+1],h)}else r[h+1]=Kl(F,0),0!==F&&(r[F+1]=Xh(r[F+1],h)),F=h;else r[h+1]=Kl($,0),0===F?F=h:r[$+1]=Xh(r[$+1],h),$=h;le&&(r[h+1]=Qd(r[h+1])),Rl(r,be,h,!0),Rl(r,be,h,!1),function Np(r,o,a,h,y){const w=y?r.residualClasses:r.residualStyles;null!=w&&"string"==typeof o&&C(w,o)>=0&&(a[h+1]=Kh(a[h+1]))}(o,be,r,h,w),A=Kl(F,$),w?o.classBindings=A:o.styleBindings=A}(y,w,o,a,A,h)}}(w,r,A,h),o!==rr&&is(y,A,o)&&function fy(r,o,a,h,y,w,A,F){if(!(3&o.type))return;const $=r.data,le=$[F+1];km(function Uf(r){return 1==(1&r)}(le)?my($,o,a,y,ll(le),A):void 0)||(km(w)||function Nf(r){return 2==(2&r)}(le)&&(w=my($,null,a,y,F,A)),function dg(r,o,a,h,y){const w=wt(r);if(o)y?w?r.addClass(a,h):a.classList.add(h):w?r.removeClass(a,h):a.classList.remove(h);else{let A=-1===h.indexOf("-")?void 0:Ba.DashCase;if(null==y)w?r.removeStyle(a,h,A):a.style.removeProperty(h);else{const F="string"==typeof y&&y.endsWith("!important");F&&(y=y.slice(0,-10),A|=Ba.Important),w?r.setStyle(a,h,y,A):a.style.setProperty(h,y,F?"important":"")}}}(h,A,er(Do(),a),y,w))}(w,w.data[Do()],y,y[11],r,y[A+1]=function N0(r,o){return null==r||("string"==typeof o?r+=o:"object"==typeof r&&(r=se(ql(r)))),r}(o,a),h,A)}function Xg(r,o,a,h,y){let w=null;const A=a.directiveEnd;let F=a.directiveStylingLast;for(-1===F?F=a.directiveStart:F++;F<A&&(w=o[F],h=Vp(h,w.hostAttrs,y),w!==r);)F++;return null!==r&&(a.directiveStylingLast=F),h}function Vp(r,o,a){const h=a?1:2;let y=-1;if(null!==o)for(let w=0;w<o.length;w++){const A=o[w];"number"==typeof A?y=A:y===h&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),g(r,A,!!a||o[++w]))}return void 0===r?null:r}function my(r,o,a,h,y,w){const A=null===o;let F;for(;y>0;){const $=r[y],le=Array.isArray($),be=le?$[1]:$,ut=null===be;let Rt=a[y+1];Rt===rr&&(Rt=ut?Oi:void 0);let Kt=ut?b(Rt,h):be===h?Rt:void 0;if(le&&!km(Kt)&&(Kt=b($,h)),km(Kt)&&(F=Kt,A))return F;const Mn=r[y+1];y=A?za(Mn):ll(Mn)}if(null!==o){let $=w?o.residualClasses:o.residualStyles;null!=$&&(F=b($,h))}return F}function km(r){return void 0!==r}function _y(r,o=""){const a=Pn(),h=ur(),y=r+20,w=h.firstCreatePass?uu(h,y,1,o,null):h.data[y],A=a[y]=function Ps(r,o){return wt(r)?r.createText(o):r.createTextNode(o)}(a[11],o);td(h,a,A,w),Oo(w,!1)}function Kg(r){return Fm("",r,""),Kg}function Fm(r,o,a){const h=Pn(),y=oc(h,r,o,a);return y!==rr&&Al(h,Do(),y),Fm}function Qg(r,o,a,h,y){const w=Pn(),A=function Nc(r,o,a,h,y,w){const F=rc(r,E(),a,y);return j(2),F?o+ve(a)+h+ve(y)+w:rr}(w,r,o,a,h,y);return A!==rr&&Al(w,Do(),A),Qg}function e_(r,o,a,h,y,w,A){const F=Pn(),$=Uc(F,r,o,a,h,y,w,A);return $!==rr&&Al(F,Do(),$),e_}function t_(r,o,a,h,y,w,A,F,$){const le=Pn(),be=Cu(le,r,o,a,h,y,w,A,F,$);return be!==rr&&Al(le,Do(),be),t_}const Ed=void 0;var ox=["en",[["a","p"],["AM","PM"],Ed],[["AM","PM"],Ed,Ed],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Ed,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Ed,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Ed,"{1} 'at' {0}",Ed],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function rx(r){const a=Math.floor(Math.abs(r)),h=r.toString().replace(/^[^.]*\.?/,"").length;return 1===a&&0===h?1:5}];let Ch={};function n_(r){const o=function sx(r){return r.toLowerCase().replace(/_/g,"-")}(r);let a=ky(o);if(a)return a;const h=o.split("-")[0];if(a=ky(h),a)return a;if("en"===h)return ox;throw new Error(`Missing locale data for the locale "${r}".`)}function Ry(r){return n_(r)[Wi.PluralCase]}function ky(r){return r in Ch||(Ch[r]=Di.ng&&Di.ng.common&&Di.ng.common.locales&&Di.ng.common.locales[r]),Ch[r]}var Wi=(()=>((Wi=Wi||{})[Wi.LocaleId=0]="LocaleId",Wi[Wi.DayPeriodsFormat=1]="DayPeriodsFormat",Wi[Wi.DayPeriodsStandalone=2]="DayPeriodsStandalone",Wi[Wi.DaysFormat=3]="DaysFormat",Wi[Wi.DaysStandalone=4]="DaysStandalone",Wi[Wi.MonthsFormat=5]="MonthsFormat",Wi[Wi.MonthsStandalone=6]="MonthsStandalone",Wi[Wi.Eras=7]="Eras",Wi[Wi.FirstDayOfWeek=8]="FirstDayOfWeek",Wi[Wi.WeekendRange=9]="WeekendRange",Wi[Wi.DateFormat=10]="DateFormat",Wi[Wi.TimeFormat=11]="TimeFormat",Wi[Wi.DateTimeFormat=12]="DateTimeFormat",Wi[Wi.NumberSymbols=13]="NumberSymbols",Wi[Wi.NumberFormats=14]="NumberFormats",Wi[Wi.CurrencyCode=15]="CurrencyCode",Wi[Wi.CurrencySymbol=16]="CurrencySymbol",Wi[Wi.CurrencyName=17]="CurrencyName",Wi[Wi.Currencies=18]="Currencies",Wi[Wi.Directionality=19]="Directionality",Wi[Wi.PluralCase=20]="PluralCase",Wi[Wi.ExtraData=21]="ExtraData",Wi))();const Bm="en-US";let Fy=Bm;function o_(r,o,a,h,y){if(r=Ne(r),Array.isArray(r))for(let w=0;w<r.length;w++)o_(r[w],o,a,h,y);else{const w=ur(),A=Pn();let F=ul(r)?r:Ne(r.provide),$=Us(r);const le=ro(),be=1048575&le.providerIndexes,ut=le.directiveStart,Rt=le.providerIndexes>>20;if(ul(r)||!r.multi){const Kt=new Ia($,y,_o),Mn=a_(F,o,y?be:be+Rt,ut);-1===Mn?(G(la(le,A),w,F),s_(w,r,o.length),o.push(F),le.directiveStart++,le.directiveEnd++,y&&(le.providerIndexes+=1048576),a.push(Kt),A.push(Kt)):(a[Mn]=Kt,A[Mn]=Kt)}else{const Kt=a_(F,o,be+Rt,ut),Mn=a_(F,o,be,be+Rt),Kn=Kt>=0&&a[Kt],fi=Mn>=0&&a[Mn];if(y&&!fi||!y&&!Kn){G(la(le,A),w,F);const Pi=function r1(r,o,a,h,y){const w=new Ia(r,a,_o);return w.multi=[],w.index=o,w.componentProviders=0,sv(w,y,h&&!a),w}(y?i1:n1,a.length,y,h,$);!y&&fi&&(a[Mn].providerFactory=Pi),s_(w,r,o.length,0),o.push(F),le.directiveStart++,le.directiveEnd++,y&&(le.providerIndexes+=1048576),a.push(Pi),A.push(Pi)}else s_(w,r,Kt>-1?Kt:Mn,sv(a[y?Mn:Kt],$,!y&&h));!y&&h&&fi&&a[Mn].componentProviders++}}}function s_(r,o,a,h){const y=ul(o),w=function Ug(r){return!!r.useClass}(o);if(y||w){const $=(w?Ne(o.useClass):o).prototype.ngOnDestroy;if($){const le=r.destroyHooks||(r.destroyHooks=[]);if(!y&&o.multi){const be=le.indexOf(a);-1===be?le.push(a,[h,$]):le[be+1].push(h,$)}else le.push(a,$)}}}function sv(r,o,a){return a&&r.componentProviders++,r.multi.push(o)-1}function a_(r,o,a,h){for(let y=a;y<h;y++)if(o[y]===r)return y;return-1}function n1(r,o,a,h){return l_(this.multi,[])}function i1(r,o,a,h){const y=this.multi;let w;if(this.providerFactory){const A=this.providerFactory.componentProviders,F=Tr(a,a[1],this.providerFactory.index,h);w=F.slice(0,A),l_(y,w);for(let $=A;$<F.length;$++)w.push(F[$])}else w=[],l_(y,w);return w}function l_(r,o){for(let a=0;a<r.length;a++)o.push((0,r[a])());return o}function av(r,o=[]){return a=>{a.providersResolver=(h,y)=>function t1(r,o,a){const h=ur();if(h.firstCreatePass){const y=Ki(r);o_(a,h.data,h.blueprint,y,!0),o_(o,h.data,h.blueprint,y,!1)}}(h,y?y(r):r,o)}}class lv{}class a1{resolveComponentFactory(o){throw function s1(r){const o=Error(`No component factory found for ${se(r)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=r,o}(o)}}let $m=(()=>{class r{}return r.NULL=new a1,r})();function l1(){return Eh(ro(),Pn())}function Eh(r,o){return new Hp(Vi(r,o))}let Hp=(()=>{class r{constructor(a){this.nativeElement=a}}return r.__NG_ELEMENT_ID__=l1,r})();function c1(r){return r instanceof Hp?r.nativeElement:r}class uv{}let u1=(()=>{class r{}return r.__NG_ELEMENT_ID__=()=>function h1(){const r=Pn(),a=ee(ro().index,r);return function d1(r){return r[11]}(nn(a)?a:r)}(),r})(),p1=(()=>{class r{}return r.\u0275prov=Tn({token:r,providedIn:"root",factory:()=>null}),r})();class dv{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const f1=new dv("13.3.8"),c_={};function jm(r,o,a,h,y=!1){for(;null!==a;){const w=o[a.index];if(null!==w&&h.push(Jn(w)),Nn(w))for(let F=10;F<w.length;F++){const $=w[F],le=$[1].firstChild;null!==le&&jm($[1],$,le,h)}const A=a.type;if(8&A)jm(r,o,a.child,h);else if(32&A){const F=Ns(a,o);let $;for(;$=F();)h.push($)}else if(16&A){const F=nu(o,a);if(Array.isArray(F))h.push(...F);else{const $=Kc(o[16]);jm($[1],$,F,h,!0)}}a=y?a.projectionNext:a.next}return h}class qp{constructor(o,a){this._lView=o,this._cdRefInjectingView=a,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const o=this._lView,a=o[1];return jm(a,o,a.firstChild,[])}get context(){return this._lView[8]}set context(o){this._lView[8]=o}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[3];if(Nn(o)){const a=o[8],h=a?a.indexOf(this):-1;h>-1&&(Mc(o,h),La(a,h))}this._attachedToViewContainer=!1}Mf(this._lView[1],this._lView)}onDestroy(o){sh(this._lView[1],this._lView,null,o)}markForCheck(){mu(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){!function gp(r,o,a){const h=o[10];h.begin&&h.begin();try{Lc(r,o,r.template,a)}catch(y){throw xp(o,y),y}finally{h.end&&h.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new We(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Hd(r,o){iu(r,o,o[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new We(902,"");this._appRef=o}}class m1 extends qp{constructor(o){super(o),this._view=o}detectChanges(){cm(this._view)}checkNoChanges(){}get context(){return null}}class hv extends $m{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const a=Rn(o);return new u_(a,this.ngModule)}}function pv(r){const o=[];for(let a in r)r.hasOwnProperty(a)&&o.push({propName:r[a],templateName:a});return o}class u_ extends lv{constructor(o,a){super(),this.componentDef=o,this.ngModule=a,this.componentType=o.type,this.selector=function Kd(r){return r.map(Sc).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!a}get inputs(){return pv(this.componentDef.inputs)}get outputs(){return pv(this.componentDef.outputs)}create(o,a,h,y){const w=(y=y||this.ngModule)?function _1(r,o){return{get:(a,h,y)=>{const w=r.get(a,c_,y);return w!==c_||h===c_?w:o.get(a,h,y)}}}(o,y.injector):o,A=w.get(uv,gn),F=w.get(p1,null),$=A.createRenderer(null,this.componentDef),le=this.componentDef.selectors[0][0]||"div",be=h?function ap(r,o,a){if(wt(r))return r.selectRootElement(o,a===Qn.ShadowDom);let h="string"==typeof o?r.querySelector(o):o;return h.textContent="",h}($,h,this.componentDef.encapsulation):Gh(A.createRenderer(null,this.componentDef),le,function g1(r){const o=r.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(le)),ut=this.componentDef.onPush?576:528,Rt=function wm(r,o){return{components:[],scheduler:r||vf,clean:vp,playerHandler:o||null,flags:0}}(),Kt=hd(0,null,null,1,0,null,null,null,null,null),Mn=ud(null,Kt,Rt,ut,null,null,A,$,F,w);let Kn,fi;Lo(Mn);try{const Pi=function Ap(r,o,a,h,y,w){const A=a[1];a[20]=r;const $=uu(A,20,2,"#host",null),le=$.mergedAttrs=o.hostAttrs;null!==le&&(uh($,le,!0),null!==r&&(Xa(y,r,le),null!==$.classes&&od(y,r,$.classes),null!==$.styles&&Xd(y,r,$.styles)));const be=h.createRenderer(r,o),ut=ud(a,Hf(o),null,o.onPush?64:16,a[20],$,h,be,w||null,null);return A.firstCreatePass&&(G(la($,a),A,o.type),pd(A,$),fd($,a.length,1)),md(a,ut),a[20]=ut}(be,this.componentDef,Mn,A,$);if(be)if(h)Xa($,be,["ng-version",f1.full]);else{const{attrs:Fn,classes:ji}=function _g(r){const o=[],a=[];let h=1,y=2;for(;h<r.length;){let w=r[h];if("string"==typeof w)2===y?""!==w&&o.push(w,r[++h]):8===y&&a.push(w);else{if(!Ca(y))break;y=w}h++}return{attrs:o,classes:a}}(this.componentDef.selectors[0]);Fn&&Xa($,be,Fn),ji&&ji.length>0&&od($,be,ji.join(" "))}if(fi=fr(Kt,20),void 0!==a){const Fn=fi.projection=[];for(let ji=0;ji<this.ngContentSelectors.length;ji++){const Or=a[ji];Fn.push(null!=Or?Array.from(Or):null)}}Kn=function fh(r,o,a,h,y){const w=a[1],A=function Qf(r,o,a){const h=ro();r.firstCreatePass&&(a.providersResolver&&a.providersResolver(a),rm(r,h,o,ec(r,o,1,null),a));const y=Tr(o,r,h.directiveStart,h);zo(y,o);const w=Vi(h,o);return w&&zo(w,o),y}(w,a,o);if(h.components.push(A),r[8]=A,y&&y.forEach($=>$(A,o)),o.contentQueries){const $=ro();o.contentQueries(1,A,$.directiveStart)}const F=ro();return!w.firstCreatePass||null===o.hostBindings&&null===o.hostAttrs||(Fo(F.index),pu(a[1],F,0,F.directiveStart,F.directiveEnd,o),kc(o,A)),A}(Pi,this.componentDef,Mn,Rt,[Cm]),Oc(Kt,Mn,null)}finally{Ea()}return new v1(this.componentType,Kn,Eh(fi,Mn),Mn,fi)}}class v1 extends class o1{}{constructor(o,a,h,y,w){super(),this.location=h,this._rootLView=y,this._tNode=w,this.instance=a,this.hostView=this.changeDetectorRef=new m1(y),this.componentType=o}get injector(){return new ca(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}class Dh{}class fv{}const Ih=new Map;class _v extends Dh{constructor(o,a){super(),this._parent=a,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new hv(this);const h=Ut(o);this._bootstrapComponents=al(h.bootstrap),this._r3Injector=gm(o,a,[{provide:Dh,useValue:this},{provide:$m,useValue:this.componentFactoryResolver}],se(o)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(o)}get(o,a=Ua.THROW_IF_NOT_FOUND,h=ri.Default){return o===Ua||o===Dh||o===bp?this:this._r3Injector.get(o,a,h)}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class d_ extends fv{constructor(o){super(),this.moduleType=o,null!==Ut(o)&&function b1(r){const o=new Set;!function a(h){const y=Ut(h,!0),w=y.id;null!==w&&(function mv(r,o,a){if(o&&o!==a)throw new Error(`Duplicate module registered for ${r} - ${se(o)} vs ${se(o.name)}`)}(w,Ih.get(w),h),Ih.set(w,h));const A=al(y.imports);for(const F of A)o.has(F)||(o.add(F),a(F))}(r)}(o)}create(o){return new _v(this.moduleType,o)}}function yv(r,o,a){const h=ao()+r,y=Pn();return y[h]===rr?ja(y,h,a?o.call(a):o()):function bu(r,o){return r[o]}(y,h)}function Wp(r,o){const a=r[o];return a===rr?void 0:a}function Tv(r,o){const a=ur();let h;const y=r+20;a.firstCreatePass?(h=function P1(r,o){if(o)for(let a=o.length-1;a>=0;a--){const h=o[a];if(r===h.name)return h}}(o,a.pipeRegistry),a.data[y]=h,h.onDestroy&&(a.destroyHooks||(a.destroyHooks=[])).push(y,h.onDestroy)):h=a.data[y];const w=h.factory||(h.factory=ls(h.type)),A=qe(_o);try{const F=ys(!1),$=w();return ys(F),function Om(r,o,a,h){a>=r.data.length&&(r.data[a]=null,r.blueprint[a]=null),o[a]=h}(a,Pn(),y,$),$}finally{qe(A)}}function Ev(r,o,a){const h=r+20,y=Pn(),w=br(y,h);return Yp(y,h)?function vv(r,o,a,h,y,w){const A=o+a;return is(r,A,y)?ja(r,A+1,w?h.call(w,y):h(y)):Wp(r,A+1)}(y,ao(),o,w.transform,a,w):w.transform(a)}function Dv(r,o,a,h){const y=r+20,w=Pn(),A=br(w,y);return Yp(w,y)?function xv(r,o,a,h,y,w,A){const F=o+a;return rc(r,F,y,w)?ja(r,F+2,A?h.call(A,y,w):h(y,w)):Wp(r,F+2)}(w,ao(),o,A.transform,a,h,A):A.transform(a,h)}function Yp(r,o){return r[1].data[o].pure}function h_(r){return o=>{setTimeout(r,void 0,o)}}const cc=class k1 extends v.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,a,h){let y=o,w=a||(()=>null),A=h;if(o&&"object"==typeof o){const $=o;y=$.next?.bind($),w=$.error?.bind($),A=$.complete?.bind($)}this.__isAsync&&(w=h_(w),y&&(y=h_(y)),A&&(A=h_(A)));const F=super.subscribe({next:y,error:w,complete:A});return o instanceof ne.w0&&o.add(F),F}};function F1(){return this._results[ic()]()}class p_{constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const a=ic(),h=p_.prototype;h[a]||(h[a]=F1)}get changes(){return this._changes||(this._changes=new cc)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,a){return this._results.reduce(o,a)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,a){const h=this;h.dirty=!1;const y=Zo(o);(this._changesDetected=!function yc(r,o,a){if(r.length!==o.length)return!1;for(let h=0;h<r.length;h++){let y=r[h],w=o[h];if(a&&(y=a(y),w=a(w)),w!==y)return!1}return!0}(h._results,y,a))&&(h._results=y,h.length=y.length,h.last=y[this.length-1],h.first=y[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Jp=(()=>{class r{}return r.__NG_ELEMENT_ID__=N1,r})();const B1=Jp,z1=class extends B1{constructor(o,a,h){super(),this._declarationLView=o,this._declarationTContainer=a,this.elementRef=h}createEmbeddedView(o){const a=this._declarationTContainer.tViews,h=ud(this._declarationLView,a,o,16,null,a.declTNode,null,null,null,null);h[17]=this._declarationLView[this._declarationTContainer.index];const w=this._declarationLView[19];return null!==w&&(h[19]=w.createEmbeddedView(a)),Oc(a,h,o),new qp(h)}};function N1(){return Zm(ro(),Pn())}function Zm(r,o){return 4&r.type?new z1(o,r,Eh(r,o)):null}let Gm=(()=>{class r{}return r.__NG_ELEMENT_ID__=U1,r})();function U1(){return Av(ro(),Pn())}const V1=Gm,Iv=class extends V1{constructor(o,a,h){super(),this._lContainer=o,this._hostTNode=a,this._hostLView=h}get element(){return Eh(this._hostTNode,this._hostLView)}get injector(){return new ca(this._hostTNode,this._hostLView)}get parentInjector(){const o=P(this._hostTNode,this._hostLView);if(Hc(o)){const a=Aa(o,this._hostLView),h=el(o);return new ca(a[1].data[h+8],a)}return new ca(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const a=Mv(this._lContainer);return null!==a&&a[o]||null}get length(){return this._lContainer.length-10}createEmbeddedView(o,a,h){const y=o.createEmbeddedView(a||{});return this.insert(y,h),y}createComponent(o,a,h,y,w){const A=o&&!function jo(r){return"function"==typeof r}(o);let F;if(A)F=a;else{const ut=a||{};F=ut.index,h=ut.injector,y=ut.projectableNodes,w=ut.ngModuleRef}const $=A?o:new u_(Rn(o)),le=h||this.parentInjector;if(!w&&null==$.ngModule){const Rt=(A?le:this.parentInjector).get(Dh,null);Rt&&(w=Rt)}const be=$.create(le,y,void 0,w);return this.insert(be.hostView,F),be}insert(o,a){const h=o._lView,y=h[1];if(function Re(r){return Nn(r[3])}(h)){const be=this.indexOf(o);if(-1!==be)this.detach(be);else{const ut=h[3],Rt=new Iv(ut,ut[6],ut[3]);Rt.detach(Rt.indexOf(o))}}const w=this._adjustIndex(a),A=this._lContainer;!function qd(r,o,a,h){const y=10+h,w=a.length;h>0&&(a[y-1][4]=o),h<w-10?(o[4]=a[y],vc(a,10+h,o)):(a.push(o),o[4]=null),o[3]=a;const A=o[17];null!==A&&a!==A&&function If(r,o){const a=r[9];o[16]!==o[3][3][16]&&(r[2]=!0),null===a?r[9]=[o]:a.push(o)}(A,o);const F=o[19];null!==F&&F.insertView(r),o[2]|=128}(y,h,A,w);const F=id(w,A),$=h[11],le=Yd($,A[7]);return null!==le&&function ag(r,o,a,h,y,w){h[0]=y,h[6]=o,iu(r,h,a,1,y,w)}(y,A[6],$,h,le,F),o.attachToViewContainerRef(),vc(f_(A),w,o),o}move(o,a){return this.insert(o,a)}indexOf(o){const a=Mv(this._lContainer);return null!==a?a.indexOf(o):-1}remove(o){const a=this._adjustIndex(o,-1),h=Mc(this._lContainer,a);h&&(La(f_(this._lContainer),a),Mf(h[1],h))}detach(o){const a=this._adjustIndex(o,-1),h=Mc(this._lContainer,a);return h&&null!=La(f_(this._lContainer),a)?new qp(h):null}_adjustIndex(o,a=0){return o??this.length+a}};function Mv(r){return r[8]}function f_(r){return r[8]||(r[8]=[])}function Av(r,o){let a;const h=o[r.index];if(Nn(h))a=h;else{let y;if(8&r.type)y=Jn(h);else{const w=o[11];y=w.createComment("");const A=Vi(r,o);Ac(w,Yd(w,A),y,function Mo(r,o){return wt(r)?r.nextSibling(o):o.nextSibling}(w,A),!1)}o[r.index]=a=sm(h,o,y,r),md(o,a)}return new Iv(a,r,o)}class m_{constructor(o){this.queryList=o,this.matches=null}clone(){return new m_(this.queryList)}setDirty(){this.queryList.setDirty()}}class g_{constructor(o=[]){this.queries=o}createEmbeddedView(o){const a=o.queries;if(null!==a){const h=null!==o.contentQueries?o.contentQueries[0]:a.length,y=[];for(let w=0;w<h;w++){const A=a.getByIndex(w);y.push(this.queries[A.indexInDeclarationView].clone())}return new g_(y)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let a=0;a<this.queries.length;a++)null!==zv(o,a).matches&&this.queries[a].setDirty()}}class Sv{constructor(o,a,h=null){this.predicate=o,this.flags=a,this.read=h}}class __{constructor(o=[]){this.queries=o}elementStart(o,a){for(let h=0;h<this.queries.length;h++)this.queries[h].elementStart(o,a)}elementEnd(o){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(o)}embeddedTView(o){let a=null;for(let h=0;h<this.length;h++){const y=null!==a?a.length:0,w=this.getByIndex(h).embeddedTView(o,y);w&&(w.indexInDeclarationView=h,null!==a?a.push(w):a=[w])}return null!==a?new __(a):null}template(o,a){for(let h=0;h<this.queries.length;h++)this.queries[h].template(o,a)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class y_{constructor(o,a=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(o,a){this.isApplyingToNode(a)&&this.matchTNode(o,a)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,a){this.elementStart(o,a)}embeddedTView(o,a){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,a),new y_(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const a=this._declarationNodeIndex;let h=o.parent;for(;null!==h&&8&h.type&&h.index!==a;)h=h.parent;return a===(null!==h?h.index:-1)}return this._appliesToNextNode}matchTNode(o,a){const h=this.metadata.predicate;if(Array.isArray(h))for(let y=0;y<h.length;y++){const w=h[y];this.matchTNodeWithReadOption(o,a,Z1(a,w)),this.matchTNodeWithReadOption(o,a,Mi(a,o,w,!1,!1))}else h===Jp?4&a.type&&this.matchTNodeWithReadOption(o,a,-1):this.matchTNodeWithReadOption(o,a,Mi(a,o,h,!1,!1))}matchTNodeWithReadOption(o,a,h){if(null!==h){const y=this.metadata.read;if(null!==y)if(y===Hp||y===Gm||y===Jp&&4&a.type)this.addMatch(a.index,-2);else{const w=Mi(a,o,y,!1,!1);null!==w&&this.addMatch(a.index,w)}else this.addMatch(a.index,h)}}addMatch(o,a){null===this.matches?this.matches=[o,a]:this.matches.push(o,a)}}function Z1(r,o){const a=r.localNames;if(null!==a)for(let h=0;h<a.length;h+=2)if(a[h]===o)return a[h+1];return null}function H1(r,o,a,h){return-1===a?function G1(r,o){return 11&r.type?Eh(r,o):4&r.type?Zm(r,o):null}(o,r):-2===a?function q1(r,o,a){return a===Hp?Eh(o,r):a===Jp?Zm(o,r):a===Gm?Av(o,r):void 0}(r,o,h):Tr(r,r[1],a,o)}function Pv(r,o,a,h){const y=o[19].queries[h];if(null===y.matches){const w=r.data,A=a.matches,F=[];for(let $=0;$<A.length;$+=2){const le=A[$];F.push(le<0?null:H1(o,w[le],A[$+1],a.metadata.read))}y.matches=F}return y.matches}function v_(r,o,a,h){const y=r.queries.getByIndex(a),w=y.matches;if(null!==w){const A=Pv(r,o,y,a);for(let F=0;F<w.length;F+=2){const $=w[F];if($>0)h.push(A[F/2]);else{const le=w[F+1],be=o[-$];for(let ut=10;ut<be.length;ut++){const Rt=be[ut];Rt[17]===Rt[3]&&v_(Rt[1],Rt,le,h)}if(null!==be[9]){const ut=be[9];for(let Rt=0;Rt<ut.length;Rt++){const Kt=ut[Rt];v_(Kt[1],Kt,le,h)}}}}}return h}function Ov(r){const o=Pn(),a=ur(),h=ir();Cr(h+1);const y=zv(a,h);if(r.dirty&&W(o)===(2==(2&y.metadata.flags))){if(null===y.matches)r.reset([]);else{const w=y.crossesNgTemplate?v_(a,o,h,[]):Pv(a,o,y,h);r.reset(w,c1),r.notifyOnChanges()}return!0}return!1}function Lv(r,o,a){const h=ur();h.firstCreatePass&&(Bv(h,new Sv(r,o,a),-1),2==(2&o)&&(h.staticViewQueries=!0)),Fv(h,Pn(),o)}function Rv(r,o,a,h){const y=ur();if(y.firstCreatePass){const w=ro();Bv(y,new Sv(o,a,h),w.index),function Y1(r,o){const a=r.contentQueries||(r.contentQueries=[]);o!==(a.length?a[a.length-1]:-1)&&a.push(r.queries.length-1,o)}(y,r),2==(2&a)&&(y.staticContentQueries=!0)}Fv(y,Pn(),a)}function kv(){return function W1(r,o){return r[19].queries[o].queryList}(Pn(),ir())}function Fv(r,o,a){const h=new p_(4==(4&a));sh(r,o,h,h.destroy),null===o[19]&&(o[19]=new g_),o[19].queries.push(new m_(h))}function Bv(r,o,a){null===r.queries&&(r.queries=new __),r.queries.track(new y_(o,a))}function zv(r,o){return r.queries.getByIndex(o)}function Wm(...r){}const t0=new lo("Application Initializer");let E_=(()=>{class r{constructor(a){this.appInits=a,this.resolve=Wm,this.reject=Wm,this.initialized=!1,this.done=!1,this.donePromise=new Promise((h,y)=>{this.resolve=h,this.reject=y})}runInitializers(){if(this.initialized)return;const a=[],h=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let y=0;y<this.appInits.length;y++){const w=this.appInits[y]();if(Os(w))a.push(w);else if(Vo(w)){const A=new Promise((F,$)=>{w.subscribe({complete:F,error:$})});a.push(A)}}Promise.all(a).then(()=>{h()}).catch(y=>{this.reject(y)}),0===a.length&&h(),this.initialized=!0}}return r.\u0275fac=function(a){return new(a||r)(Zt(t0,8))},r.\u0275prov=Tn({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const n0=new lo("AppId",{providedIn:"root",factory:function r0(){return`${D_()}${D_()}${D_()}`}});function D_(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const o0=new lo("Platform Initializer"),pb=new lo("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),s0=new lo("appBootstrapListener");let fb=(()=>{class r{log(a){console.log(a)}warn(a){console.warn(a)}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=Tn({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();const I_=new lo("LocaleId",{providedIn:"root",factory:()=>Bn(I_,ri.Optional|ri.SkipSelf)||function mb(){return typeof $localize<"u"&&$localize.locale||Bm}()}),gb=new lo("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class _b{constructor(o,a){this.ngModuleFactory=o,this.componentFactories=a}}let yb=(()=>{class r{compileModuleSync(a){return new d_(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){const h=this.compileModuleSync(a),w=al(Ut(a).declarations).reduce((A,F)=>{const $=Rn(F);return $&&A.push(new u_($)),A},[]);return new _b(h,w)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=Tn({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const xb=(()=>Promise.resolve(0))();function M_(r){typeof Zone>"u"?xb.then(()=>{r&&r.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",r)}class Bl{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:h=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new cc(!1),this.onMicrotaskEmpty=new cc(!1),this.onStable=new cc(!1),this.onError=new cc(!1),typeof Zone>"u")throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const y=this;y._nesting=0,y._outer=y._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(y._inner=y._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(y._inner=y._inner.fork(Zone.longStackTraceZoneSpec)),y.shouldCoalesceEventChangeDetection=!h&&a,y.shouldCoalesceRunChangeDetection=h,y.lastRequestAnimationFrameId=-1,y.nativeRequestAnimationFrame=function bb(){let r=Di.requestAnimationFrame,o=Di.cancelAnimationFrame;if(typeof Zone<"u"&&r&&o){const a=r[Zone.__symbol__("OriginalDelegate")];a&&(r=a);const h=o[Zone.__symbol__("OriginalDelegate")];h&&(o=h)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function Tb(r){const o=()=>{!function Cb(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(Di,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,S_(r),r.isCheckStableRunning=!0,A_(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),S_(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(a,h,y,w,A,F)=>{try{return a0(r),a.invokeTask(y,w,A,F)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===w.type||r.shouldCoalesceRunChangeDetection)&&o(),l0(r)}},onInvoke:(a,h,y,w,A,F,$)=>{try{return a0(r),a.invoke(y,w,A,F,$)}finally{r.shouldCoalesceRunChangeDetection&&o(),l0(r)}},onHasTask:(a,h,y,w)=>{a.hasTask(y,w),h===y&&("microTask"==w.change?(r._hasPendingMicrotasks=w.microTask,S_(r),A_(r)):"macroTask"==w.change&&(r.hasPendingMacrotasks=w.macroTask))},onHandleError:(a,h,y,w)=>(a.handleError(y,w),r.runOutsideAngular(()=>r.onError.emit(w)),!1)})}(y)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Bl.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Bl.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(o,a,h){return this._inner.run(o,a,h)}runTask(o,a,h,y){const w=this._inner,A=w.scheduleEventTask("NgZoneEvent: "+y,o,wb,Wm,Wm);try{return w.runTask(A,a,h)}finally{w.cancelTask(A)}}runGuarded(o,a,h){return this._inner.runGuarded(o,a,h)}runOutsideAngular(o){return this._outer.run(o)}}const wb={};function A_(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function S_(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function a0(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function l0(r){r._nesting--,A_(r)}class Eb{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new cc,this.onMicrotaskEmpty=new cc,this.onStable=new cc,this.onError=new cc}run(o,a,h){return o.apply(a,h)}runGuarded(o,a,h){return o.apply(a,h)}runOutsideAngular(o){return o()}runTask(o,a,h,y){return o.apply(a,h)}}let c0=(()=>{class r{constructor(a){this._ngZone=a,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),a.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Bl.assertNotInAngularZone(),M_(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())M_(()=>{for(;0!==this._callbacks.length;){let a=this._callbacks.pop();clearTimeout(a.timeoutId),a.doneCb(this._didWork)}this._didWork=!1});else{let a=this.getPendingTasks();this._callbacks=this._callbacks.filter(h=>!h.updateCb||!h.updateCb(a)||(clearTimeout(h.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(a=>({source:a.source,creationLocation:a.creationLocation,data:a.data})):[]}addCallback(a,h,y){let w=-1;h&&h>0&&(w=setTimeout(()=>{this._callbacks=this._callbacks.filter(A=>A.timeoutId!==w),a(this._didWork,this.getPendingTasks())},h)),this._callbacks.push({doneCb:a,timeoutId:w,updateCb:y})}whenStable(a,h,y){if(y&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(a,h,y),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(a,h,y){return[]}}return r.\u0275fac=function(a){return new(a||r)(Zt(Bl))},r.\u0275prov=Tn({token:r,factory:r.\u0275fac}),r})(),Db=(()=>{class r{constructor(){this._applications=new Map,P_.addToWindow(this)}registerApplication(a,h){this._applications.set(a,h)}unregisterApplication(a){this._applications.delete(a)}unregisterAllApplications(){this._applications.clear()}getTestability(a){return this._applications.get(a)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(a,h=!0){return P_.findTestabilityInTree(this,a,h)}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=Tn({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();class Ib{addToWindow(o){}findTestabilityInTree(o,a,h){return null}}function Mb(r){P_=r}let P_=new Ib,Kp=null;const u0=new lo("AllowMultipleToken"),d0=new lo("PlatformOnDestroy");class Pb{constructor(o,a){this.name=o,this.token=a}}function h0(r,o,a=[]){const h=`Platform: ${o}`,y=new lo(h);return(w=[])=>{let A=O_();if(!A||A.injector.get(u0,!1)){const F=[...a,...w,{provide:y,useValue:!0}];r?r(F):function Ob(r){if(Kp&&!Kp.get(u0,!1))throw new We(400,"");Kp=r;const o=r.get(p0),a=r.get(o0,null);a&&a.forEach(h=>h())}(function Rb(r=[],o){return Ua.create({name:o,providers:[{provide:_d,useValue:"platform"},{provide:d0,useValue:()=>Kp=null},...r]})}(F,h))}return function Lb(r){const o=O_();if(!o)throw new We(401,"");return o}()}}function O_(){return Kp?.get(p0)??null}let p0=(()=>{class r{constructor(a){this._injector=a,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(a,h){const F=function kb(r,o){let a;return a="noop"===r?new Eb:("zone.js"===r?void 0:r)||new Bl({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!o?.ngZoneEventCoalescing,shouldCoalesceRunChangeDetection:!!o?.ngZoneRunCoalescing}),a}(h?h.ngZone:void 0,{ngZoneEventCoalescing:h&&h.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:h&&h.ngZoneRunCoalescing||!1}),$=[{provide:Bl,useValue:F}];return F.run(()=>{const le=Ua.create({providers:$,parent:this.injector,name:a.moduleType.name}),be=a.create(le),ut=be.injector.get(Gu,null);if(!ut)throw new We(402,"");return F.runOutsideAngular(()=>{const Rt=F.onError.subscribe({next:Kt=>{ut.handleError(Kt)}});be.onDestroy(()=>{R_(this._modules,be),Rt.unsubscribe()})}),function Fb(r,o,a){try{const h=a();return Os(h)?h.catch(y=>{throw o.runOutsideAngular(()=>r.handleError(y)),y}):h}catch(h){throw o.runOutsideAngular(()=>r.handleError(h)),h}}(ut,F,()=>{const Rt=be.injector.get(E_);return Rt.runInitializers(),Rt.donePromise.then(()=>(function ux(r){_e(r,"Expected localeId to be defined"),"string"==typeof r&&(Fy=r.toLowerCase().replace(/_/g,"-"))}(be.injector.get(I_,Bm)||Bm),this._moduleDoBootstrap(be),be))})})}bootstrapModule(a,h=[]){const y=f0({},h);return function Ab(r,o,a){const h=new d_(a);return Promise.resolve(h)}(0,0,a).then(w=>this.bootstrapModuleFactory(w,y))}_moduleDoBootstrap(a){const h=a.injector.get(L_);if(a._bootstrapComponents.length>0)a._bootstrapComponents.forEach(y=>h.bootstrap(y));else{if(!a.instance.ngDoBootstrap)throw new We(403,"");a.instance.ngDoBootstrap(h)}this._modules.push(a)}onDestroy(a){this._destroyListeners.push(a)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new We(404,"");this._modules.slice().forEach(h=>h.destroy()),this._destroyListeners.forEach(h=>h()),this._injector.get(d0,null)?.(),this._destroyed=!0}get destroyed(){return this._destroyed}}return r.\u0275fac=function(a){return new(a||r)(Zt(Ua))},r.\u0275prov=Tn({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();function f0(r,o){return Array.isArray(o)?o.reduce(f0,r):{...r,...o}}let L_=(()=>{class r{constructor(a,h,y,w){this._zone=a,this._injector=h,this._exceptionHandler=y,this._initStatus=w,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const A=new De.y($=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{$.next(this._stable),$.complete()})}),F=new De.y($=>{let le;this._zone.runOutsideAngular(()=>{le=this._zone.onStable.subscribe(()=>{Bl.assertNotInAngularZone(),M_(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,$.next(!0))})})});const be=this._zone.onUnstable.subscribe(()=>{Bl.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{$.next(!1)}))});return()=>{le.unsubscribe(),be.unsubscribe()}});this.isStable=function re(...r){const o=(0,l.yG)(r),a=(0,l._6)(r,1/0),h=r;return h.length?1===h.length?(0,m.Xf)(h[0]):(0,d.J)(a)((0,ie.D)(h,o)):ce.E}(A,F.pipe((0,ge.B)()))}bootstrap(a,h){if(!this._initStatus.done)throw new We(405,"");let y;y=a instanceof lv?a:this._injector.get($m).resolveComponentFactory(a),this.componentTypes.push(y.componentType);const w=function Sb(r){return r.isBoundToModule}(y)?void 0:this._injector.get(Dh),F=y.create(Ua.NULL,[],h||y.selector,w),$=F.location.nativeElement,le=F.injector.get(c0,null),be=le&&F.injector.get(Db);return le&&be&&be.registerApplication($,le),F.onDestroy(()=>{this.detachView(F.hostView),R_(this.components,F),be&&be.unregisterApplication($)}),this._loadComponent(F),F}tick(){if(this._runningTick)throw new We(101,"");try{this._runningTick=!0;for(let a of this._views)a.detectChanges()}catch(a){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(a))}finally{this._runningTick=!1}}attachView(a){const h=a;this._views.push(h),h.attachToAppRef(this)}detachView(a){const h=a;R_(this._views,h),h.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView),this.tick(),this.components.push(a),this._injector.get(s0,[]).concat(this._bootstrapListeners).forEach(y=>y(a))}ngOnDestroy(){this._views.slice().forEach(a=>a.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return r.\u0275fac=function(a){return new(a||r)(Zt(Bl),Zt(Ua),Zt(Gu),Zt(E_))},r.\u0275prov=Tn({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function R_(r,o){const a=r.indexOf(o);a>-1&&r.splice(a,1)}let g0=!0;function zb(){g0=!1}let Nb=(()=>{class r{}return r.__NG_ELEMENT_ID__=Ub,r})();function Ub(r){return function Vb(r,o,a){if(bi(r)&&!a){const h=ee(r.index,o);return new qp(h,h)}return 47&r.type?new qp(o[16],o):null}(ro(),Pn(),16==(16&r))}class b0{constructor(){}supports(o){return zc(o)}create(o){return new qb(o)}}const Hb=(r,o)=>o;class qb{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||Hb}forEachItem(o){let a;for(a=this._itHead;null!==a;a=a._next)o(a)}forEachOperation(o){let a=this._itHead,h=this._removalsHead,y=0,w=null;for(;a||h;){const A=!h||a&&a.currentIndex<C0(h,y,w)?a:h,F=C0(A,y,w),$=A.currentIndex;if(A===h)y--,h=h._nextRemoved;else if(a=a._next,null==A.previousIndex)y++;else{w||(w=[]);const le=F-y,be=$-y;if(le!=be){for(let Rt=0;Rt<le;Rt++){const Kt=Rt<w.length?w[Rt]:w[Rt]=0,Mn=Kt+Rt;be<=Mn&&Mn<le&&(w[Rt]=Kt+1)}w[A.previousIndex]=be-le}}F!==$&&o(A,F,$)}}forEachPreviousItem(o){let a;for(a=this._previousItHead;null!==a;a=a._nextPrevious)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachMovedItem(o){let a;for(a=this._movesHead;null!==a;a=a._nextMoved)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}forEachIdentityChange(o){let a;for(a=this._identityChangesHead;null!==a;a=a._nextIdentityChange)o(a)}diff(o){if(null==o&&(o=[]),!zc(o))throw new We(900,"");return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let y,w,A,a=this._itHead,h=!1;if(Array.isArray(o)){this.length=o.length;for(let F=0;F<this.length;F++)w=o[F],A=this._trackByFn(F,w),null!==a&&Object.is(a.trackById,A)?(h&&(a=this._verifyReinsertion(a,w,A,F)),Object.is(a.item,w)||this._addIdentityChange(a,w)):(a=this._mismatch(a,w,A,F),h=!0),a=a._next}else y=0,function $a(r,o){if(Array.isArray(r))for(let a=0;a<r.length;a++)o(r[a]);else{const a=r[ic()]();let h;for(;!(h=a.next()).done;)o(h.value)}}(o,F=>{A=this._trackByFn(y,F),null!==a&&Object.is(a.trackById,A)?(h&&(a=this._verifyReinsertion(a,F,A,y)),Object.is(a.item,F)||this._addIdentityChange(a,F)):(a=this._mismatch(a,F,A,y),h=!0),a=a._next,y++}),this.length=y;return this._truncate(a),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,a,h,y){let w;return null===o?w=this._itTail:(w=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._reinsertAfter(o,w,y)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(h,y))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._moveAfter(o,w,y)):o=this._addAfter(new Wb(a,h),w,y),o}_verifyReinsertion(o,a,h,y){let w=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null);return null!==w?o=this._reinsertAfter(w,o._prev,y):o.currentIndex!=y&&(o.currentIndex=y,this._addToMoves(o,y)),o}_truncate(o){for(;null!==o;){const a=o._next;this._addToRemovals(this._unlink(o)),o=a}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,a,h){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const y=o._prevRemoved,w=o._nextRemoved;return null===y?this._removalsHead=w:y._nextRemoved=w,null===w?this._removalsTail=y:w._prevRemoved=y,this._insertAfter(o,a,h),this._addToMoves(o,h),o}_moveAfter(o,a,h){return this._unlink(o),this._insertAfter(o,a,h),this._addToMoves(o,h),o}_addAfter(o,a,h){return this._insertAfter(o,a,h),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,a,h){const y=null===a?this._itHead:a._next;return o._next=y,o._prev=a,null===y?this._itTail=o:y._prev=o,null===a?this._itHead=o:a._next=o,null===this._linkedRecords&&(this._linkedRecords=new w0),this._linkedRecords.put(o),o.currentIndex=h,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const a=o._prev,h=o._next;return null===a?this._itHead=h:a._next=h,null===h?this._itTail=a:h._prev=a,o}_addToMoves(o,a){return o.previousIndex===a||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new w0),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,a){return o.item=a,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class Wb{constructor(o,a){this.item=o,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Yb{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,a){let h;for(h=this._head;null!==h;h=h._nextDup)if((null===a||a<=h.currentIndex)&&Object.is(h.trackById,o))return h;return null}remove(o){const a=o._prevDup,h=o._nextDup;return null===a?this._head=h:a._nextDup=h,null===h?this._tail=a:h._prevDup=a,null===this._head}}class w0{constructor(){this.map=new Map}put(o){const a=o.trackById;let h=this.map.get(a);h||(h=new Yb,this.map.set(a,h)),h.add(o)}get(o,a){const y=this.map.get(o);return y?y.get(o,a):null}remove(o){const a=o.trackById;return this.map.get(a).remove(o)&&this.map.delete(a),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function C0(r,o,a){const h=r.previousIndex;if(null===h)return h;let y=0;return a&&h<a.length&&(y=a[h]),h+o+y}class T0{constructor(){}supports(o){return o instanceof Map||Ol(o)}create(){return new Jb}}class Jb{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let a;for(a=this._mapHead;null!==a;a=a._next)o(a)}forEachPreviousItem(o){let a;for(a=this._previousMapHead;null!==a;a=a._nextPrevious)o(a)}forEachChangedItem(o){let a;for(a=this._changesHead;null!==a;a=a._nextChanged)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}diff(o){if(o){if(!(o instanceof Map||Ol(o)))throw new We(900,"")}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let a=this._mapHead;if(this._appendAfter=null,this._forEach(o,(h,y)=>{if(a&&a.key===y)this._maybeAddToChanges(a,h),this._appendAfter=a,a=a._next;else{const w=this._getOrCreateRecordForKey(y,h);a=this._insertBeforeOrAppend(a,w)}}),a){a._prev&&(a._prev._next=null),this._removalsHead=a;for(let h=a;null!==h;h=h._nextRemoved)h===this._mapHead&&(this._mapHead=null),this._records.delete(h.key),h._nextRemoved=h._next,h.previousValue=h.currentValue,h.currentValue=null,h._prev=null,h._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,a){if(o){const h=o._prev;return a._next=o,a._prev=h,o._prev=a,h&&(h._next=a),o===this._mapHead&&(this._mapHead=a),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=a,a._prev=this._appendAfter):this._mapHead=a,this._appendAfter=a,null}_getOrCreateRecordForKey(o,a){if(this._records.has(o)){const y=this._records.get(o);this._maybeAddToChanges(y,a);const w=y._prev,A=y._next;return w&&(w._next=A),A&&(A._prev=w),y._next=null,y._prev=null,y}const h=new Xb(o);return this._records.set(o,h),h.currentValue=a,this._addToAdditions(h),h}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,a){Object.is(a,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=a,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,a){o instanceof Map?o.forEach(a):Object.keys(o).forEach(h=>a(o[h],h))}}class Xb{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function E0(){return new N_([new b0])}let N_=(()=>{class r{constructor(a){this.factories=a}static create(a,h){if(null!=h){const y=h.factories.slice();a=a.concat(y)}return new r(a)}static extend(a){return{provide:r,useFactory:h=>r.create(a,h||E0()),deps:[[r,new _i,new Ei]]}}find(a){const h=this.factories.find(y=>y.supports(a));if(null!=h)return h;throw new We(901,"")}}return r.\u0275prov=Tn({token:r,providedIn:"root",factory:E0}),r})();function D0(){return new U_([new T0])}let U_=(()=>{class r{constructor(a){this.factories=a}static create(a,h){if(h){const y=h.factories.slice();a=a.concat(y)}return new r(a)}static extend(a){return{provide:r,useFactory:h=>r.create(a,h||D0()),deps:[[r,new _i,new Ei]]}}find(a){const h=this.factories.find(w=>w.supports(a));if(h)return h;throw new We(901,"")}}return r.\u0275prov=Tn({token:r,providedIn:"root",factory:D0}),r})();const ew=h0(null,"core",[]);let tw=(()=>{class r{constructor(a){}}return r.\u0275fac=function(a){return new(a||r)(Zt(L_))},r.\u0275mod=Et({type:r}),r.\u0275inj=lt({}),r})()},4006:(Ln,At,k)=>{"use strict";k.d(At,{Fd:()=>Ts,Fj:()=>Ie,JJ:()=>Xi,JU:()=>ne,On:()=>en,a5:()=>qt,qQ:()=>ai,u5:()=>er,wV:()=>Nn});var d=k(8274),m=k(6895),ce=k(2076),l=k(4128),ie=k(4004);let re=(()=>{class ee{constructor(H,Re){this._renderer=H,this._elementRef=Re,this.onChange=wn=>{},this.onTouched=()=>{}}setProperty(H,Re){this._renderer.setProperty(this._elementRef.nativeElement,H,Re)}registerOnTouched(H){this.onTouched=H}registerOnChange(H){this.onChange=H}setDisabledState(H){this.setProperty("disabled",H)}}return ee.\u0275fac=function(H){return new(H||ee)(d.Y36(d.Qsj),d.Y36(d.SBq))},ee.\u0275dir=d.lG2({type:ee}),ee})(),v=(()=>{class ee extends re{}return ee.\u0275fac=function(){let W;return function(Re){return(W||(W=d.n5z(ee)))(Re||ee)}}(),ee.\u0275dir=d.lG2({type:ee,features:[d.qOj]}),ee})();const ne=new d.OlP("NgValueAccessor"),X={provide:ne,useExisting:(0,d.Gpc)(()=>Ie),multi:!0},se=new d.OlP("CompositionEventMode");let Ie=(()=>{class ee extends re{constructor(H,Re,wn){super(H,Re),this._compositionMode=wn,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function ue(){const ee=(0,m.q)()?(0,m.q)().getUserAgent():"";return/android (\d+)/.test(ee.toLowerCase())}())}writeValue(H){this.setProperty("value",H??"")}_handleInput(H){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(H)}_compositionStart(){this._composing=!0}_compositionEnd(H){this._composing=!1,this._compositionMode&&this.onChange(H)}}return ee.\u0275fac=function(H){return new(H||ee)(d.Y36(d.Qsj),d.Y36(d.SBq),d.Y36(se,8))},ee.\u0275dir=d.lG2({type:ee,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(H,Re){1&H&&d.NdJ("input",function(Ii){return Re._handleInput(Ii.target.value)})("blur",function(){return Re.onTouched()})("compositionstart",function(){return Re._compositionStart()})("compositionend",function(Ii){return Re._compositionEnd(Ii.target.value)})},features:[d._Bn([X]),d.qOj]}),ee})();function we(ee){return null==ee||0===ee.length}const Ne=new d.OlP("NgValidators"),ke=new d.OlP("NgAsyncValidators");function Ae(ee){return null}function Be(ee){return null!=ee}function st(ee){const W=(0,d.QGY)(ee)?(0,ce.D)(ee):ee;return(0,d.CqO)(W),W}function _t(ee){let W={};return ee.forEach(H=>{W=null!=H?{...W,...H}:W}),0===Object.keys(W).length?null:W}function Yt(ee,W){return W.map(H=>H(ee))}function Ht(ee){return ee.map(W=>function xn(ee){return!ee.validate}(W)?W:H=>W.validate(H))}function Bt(ee){return null!=ee?function Nt(ee){if(!ee)return null;const W=ee.filter(Be);return 0==W.length?null:function(H){return _t(Yt(H,W))}}(Ht(ee)):null}function ht(ee){return null!=ee?function Dt(ee){if(!ee)return null;const W=ee.filter(Be);return 0==W.length?null:function(H){const Re=Yt(H,W).map(st);return(0,l.D)(Re).pipe((0,ie.U)(_t))}}(Ht(ee)):null}function Lt(ee,W){return null===ee?[W]:Array.isArray(ee)?[...ee,W]:[ee,W]}function Ot(ee){return ee?Array.isArray(ee)?ee:[ee]:[]}function Qt(ee,W){return Array.isArray(ee)?ee.includes(W):ee===W}function _n(ee,W){const H=Ot(W);return Ot(ee).forEach(wn=>{Qt(H,wn)||H.push(wn)}),H}function Tn(ee,W){return Ot(W).filter(H=>!Qt(ee,H))}class mn{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(W){this._rawValidators=W||[],this._composedValidatorFn=Bt(this._rawValidators)}_setAsyncValidators(W){this._rawAsyncValidators=W||[],this._composedAsyncValidatorFn=ht(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(W){this._onDestroyCallbacks.push(W)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(W=>W()),this._onDestroyCallbacks=[]}reset(W){this.control&&this.control.reset(W)}hasError(W,H){return!!this.control&&this.control.hasError(W,H)}getError(W,H){return this.control?this.control.getError(W,H):null}}class lt extends mn{get formDirective(){return null}get path(){return null}}class qt extends mn{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}let Xi=(()=>{class ee extends class En{constructor(W){this._cd=W}is(W){return"submitted"===W?!!this._cd?.submitted:!!this._cd?.control?.[W]}}{constructor(H){super(H)}}return ee.\u0275fac=function(H){return new(H||ee)(d.Y36(qt,2))},ee.\u0275dir=d.lG2({type:ee,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(H,Re){2&H&&d.ekj("ng-untouched",Re.is("untouched"))("ng-touched",Re.is("touched"))("ng-pristine",Re.is("pristine"))("ng-dirty",Re.is("dirty"))("ng-valid",Re.is("valid"))("ng-invalid",Re.is("invalid"))("ng-pending",Re.is("pending"))},features:[d.qOj]}),ee})();function wi(ee,W){(function $i(ee,W){const H=function _e(ee){return ee._rawValidators}(ee);null!==W.validator?ee.setValidators(Lt(H,W.validator)):"function"==typeof H&&ee.setValidators([H]);const Re=function it(ee){return ee._rawAsyncValidators}(ee);null!==W.asyncValidator?ee.setAsyncValidators(Lt(Re,W.asyncValidator)):"function"==typeof Re&&ee.setAsyncValidators([Re]);const wn=()=>ee.updateValueAndValidity();xi(W._rawValidators,wn),xi(W._rawAsyncValidators,wn)})(ee,W),W.valueAccessor.writeValue(ee.value),function Wr(ee,W){W.valueAccessor.registerOnChange(H=>{ee._pendingValue=H,ee._pendingChange=!0,ee._pendingDirty=!0,"change"===ee.updateOn&&Ci(ee,W)})}(ee,W),function je(ee,W){const H=(Re,wn)=>{W.valueAccessor.writeValue(Re),wn&&W.viewToModelUpdate(Re)};ee.registerOnChange(H),W._registerOnDestroy(()=>{ee._unregisterOnChange(H)})}(ee,W),function ar(ee,W){W.valueAccessor.registerOnTouched(()=>{ee._pendingTouched=!0,"blur"===ee.updateOn&&ee._pendingChange&&Ci(ee,W),"submit"!==ee.updateOn&&ee.markAsTouched()})}(ee,W),function Xr(ee,W){if(W.valueAccessor.setDisabledState){const H=Re=>{W.valueAccessor.setDisabledState(Re)};ee.registerOnDisabledChange(H),W._registerOnDestroy(()=>{ee._unregisterOnDisabledChange(H)})}}(ee,W)}function xi(ee,W){ee.forEach(H=>{H.registerOnValidatorChange&&H.registerOnValidatorChange(W)})}function Ci(ee,W){ee._pendingDirty&&ee.markAsDirty(),ee.setValue(ee._pendingValue,{emitModelToViewChange:!1}),W.viewToModelUpdate(ee._pendingValue),ee._pendingChange=!1}function yn(ee,W){const H=ee.indexOf(W);H>-1&&ee.splice(H,1)}const Rn="VALID",Hn="INVALID",Xn="PENDING",Ut="DISABLED";function Xt(ee){return(lr(ee)?ee.validators:ee)||null}function qn(ee){return Array.isArray(ee)?Bt(ee):ee||null}function ei(ee,W){return(lr(W)?W.asyncValidators:ee)||null}function gr(ee){return Array.isArray(ee)?ht(ee):ee||null}function lr(ee){return null!=ee&&!Array.isArray(ee)&&"object"==typeof ee}const mi=ee=>ee instanceof Ir;function Dr(ee){return(ee=>ee instanceof jr)(ee)?ee.value:ee.getRawValue()}function yr(ee,W){const H=mi(ee),Re=ee.controls;if(!(H?Object.keys(Re):Re).length)throw new d.vHH(1e3,"");if(!Re[W])throw new d.vHH(1001,"")}function jn(ee,W){mi(ee),ee._forEachChild((Re,wn)=>{if(void 0===W[wn])throw new d.vHH(1002,"")})}class $r{constructor(W,H){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=W,this._rawAsyncValidators=H,this._composedValidatorFn=qn(this._rawValidators),this._composedAsyncValidatorFn=gr(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(W){this._rawValidators=this._composedValidatorFn=W}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(W){this._rawAsyncValidators=this._composedAsyncValidatorFn=W}get parent(){return this._parent}get valid(){return this.status===Rn}get invalid(){return this.status===Hn}get pending(){return this.status==Xn}get disabled(){return this.status===Ut}get enabled(){return this.status!==Ut}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(W){this._rawValidators=W,this._composedValidatorFn=qn(W)}setAsyncValidators(W){this._rawAsyncValidators=W,this._composedAsyncValidatorFn=gr(W)}addValidators(W){this.setValidators(_n(W,this._rawValidators))}addAsyncValidators(W){this.setAsyncValidators(_n(W,this._rawAsyncValidators))}removeValidators(W){this.setValidators(Tn(W,this._rawValidators))}removeAsyncValidators(W){this.setAsyncValidators(Tn(W,this._rawAsyncValidators))}hasValidator(W){return Qt(this._rawValidators,W)}hasAsyncValidator(W){return Qt(this._rawAsyncValidators,W)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(W={}){this.touched=!0,this._parent&&!W.onlySelf&&this._parent.markAsTouched(W)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(W=>W.markAllAsTouched())}markAsUntouched(W={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(H=>{H.markAsUntouched({onlySelf:!0})}),this._parent&&!W.onlySelf&&this._parent._updateTouched(W)}markAsDirty(W={}){this.pristine=!1,this._parent&&!W.onlySelf&&this._parent.markAsDirty(W)}markAsPristine(W={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(H=>{H.markAsPristine({onlySelf:!0})}),this._parent&&!W.onlySelf&&this._parent._updatePristine(W)}markAsPending(W={}){this.status=Xn,!1!==W.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!W.onlySelf&&this._parent.markAsPending(W)}disable(W={}){const H=this._parentMarkedDirty(W.onlySelf);this.status=Ut,this.errors=null,this._forEachChild(Re=>{Re.disable({...W,onlySelf:!0})}),this._updateValue(),!1!==W.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...W,skipPristineCheck:H}),this._onDisabledChange.forEach(Re=>Re(!0))}enable(W={}){const H=this._parentMarkedDirty(W.onlySelf);this.status=Rn,this._forEachChild(Re=>{Re.enable({...W,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:W.emitEvent}),this._updateAncestors({...W,skipPristineCheck:H}),this._onDisabledChange.forEach(Re=>Re(!1))}_updateAncestors(W){this._parent&&!W.onlySelf&&(this._parent.updateValueAndValidity(W),W.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(W){this._parent=W}updateValueAndValidity(W={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Rn||this.status===Xn)&&this._runAsyncValidator(W.emitEvent)),!1!==W.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!W.onlySelf&&this._parent.updateValueAndValidity(W)}_updateTreeValidity(W={emitEvent:!0}){this._forEachChild(H=>H._updateTreeValidity(W)),this.updateValueAndValidity({onlySelf:!0,emitEvent:W.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ut:Rn}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(W){if(this.asyncValidator){this.status=Xn,this._hasOwnPendingAsyncValidator=!0;const H=st(this.asyncValidator(this));this._asyncValidationSubscription=H.subscribe(Re=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(Re,{emitEvent:W})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(W,H={}){this.errors=W,this._updateControlsErrors(!1!==H.emitEvent)}get(W){return function vi(ee,W,H){if(null==W||(Array.isArray(W)||(W=W.split(H)),Array.isArray(W)&&0===W.length))return null;let Re=ee;return W.forEach(wn=>{Re=mi(Re)?Re.controls.hasOwnProperty(wn)?Re.controls[wn]:null:(ee=>ee instanceof wr)(Re)&&Re.at(wn)||null}),Re}(this,W,".")}getError(W,H){const Re=H?this.get(H):this;return Re&&Re.errors?Re.errors[W]:null}hasError(W,H){return!!this.getError(W,H)}get root(){let W=this;for(;W._parent;)W=W._parent;return W}_updateControlsErrors(W){this.status=this._calculateStatus(),W&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(W)}_initObservables(){this.valueChanges=new d.vpe,this.statusChanges=new d.vpe}_calculateStatus(){return this._allControlsDisabled()?Ut:this.errors?Hn:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Xn)?Xn:this._anyControlsHaveStatus(Hn)?Hn:Rn}_anyControlsHaveStatus(W){return this._anyControls(H=>H.status===W)}_anyControlsDirty(){return this._anyControls(W=>W.dirty)}_anyControlsTouched(){return this._anyControls(W=>W.touched)}_updatePristine(W={}){this.pristine=!this._anyControlsDirty(),this._parent&&!W.onlySelf&&this._parent._updatePristine(W)}_updateTouched(W={}){this.touched=this._anyControlsTouched(),this._parent&&!W.onlySelf&&this._parent._updateTouched(W)}_isBoxedValue(W){return"object"==typeof W&&null!==W&&2===Object.keys(W).length&&"value"in W&&"disabled"in W}_registerOnCollectionChange(W){this._onCollectionChange=W}_setUpdateStrategy(W){lr(W)&&null!=W.updateOn&&(this._updateOn=W.updateOn)}_parentMarkedDirty(W){return!W&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class jr extends $r{constructor(W=null,H,Re){super(Xt(H),ei(Re,H)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(W),this._setUpdateStrategy(H),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),lr(H)&&H.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(W)?W.value:W)}setValue(W,H={}){this.value=this._pendingValue=W,this._onChange.length&&!1!==H.emitModelToViewChange&&this._onChange.forEach(Re=>Re(this.value,!1!==H.emitViewToModelChange)),this.updateValueAndValidity(H)}patchValue(W,H={}){this.setValue(W,H)}reset(W=this.defaultValue,H={}){this._applyFormState(W),this.markAsPristine(H),this.markAsUntouched(H),this.setValue(this.value,H),this._pendingChange=!1}_updateValue(){}_anyControls(W){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(W){this._onChange.push(W)}_unregisterOnChange(W){yn(this._onChange,W)}registerOnDisabledChange(W){this._onDisabledChange.push(W)}_unregisterOnDisabledChange(W){yn(this._onDisabledChange,W)}_forEachChild(W){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(W){this._isBoxedValue(W)?(this.value=this._pendingValue=W.value,W.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=W}}class Ir extends $r{constructor(W,H,Re){super(Xt(H),ei(Re,H)),this.controls=W,this._initObservables(),this._setUpdateStrategy(H),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(W,H){return this.controls[W]?this.controls[W]:(this.controls[W]=H,H.setParent(this),H._registerOnCollectionChange(this._onCollectionChange),H)}addControl(W,H,Re={}){this.registerControl(W,H),this.updateValueAndValidity({emitEvent:Re.emitEvent}),this._onCollectionChange()}removeControl(W,H={}){this.controls[W]&&this.controls[W]._registerOnCollectionChange(()=>{}),delete this.controls[W],this.updateValueAndValidity({emitEvent:H.emitEvent}),this._onCollectionChange()}setControl(W,H,Re={}){this.controls[W]&&this.controls[W]._registerOnCollectionChange(()=>{}),delete this.controls[W],H&&this.registerControl(W,H),this.updateValueAndValidity({emitEvent:Re.emitEvent}),this._onCollectionChange()}contains(W){return this.controls.hasOwnProperty(W)&&this.controls[W].enabled}setValue(W,H={}){jn(this,W),Object.keys(W).forEach(Re=>{yr(this,Re),this.controls[Re].setValue(W[Re],{onlySelf:!0,emitEvent:H.emitEvent})}),this.updateValueAndValidity(H)}patchValue(W,H={}){null!=W&&(Object.keys(W).forEach(Re=>{this.controls[Re]&&this.controls[Re].patchValue(W[Re],{onlySelf:!0,emitEvent:H.emitEvent})}),this.updateValueAndValidity(H))}reset(W={},H={}){this._forEachChild((Re,wn)=>{Re.reset(W[wn],{onlySelf:!0,emitEvent:H.emitEvent})}),this._updatePristine(H),this._updateTouched(H),this.updateValueAndValidity(H)}getRawValue(){return this._reduceChildren({},(W,H,Re)=>(W[Re]=Dr(H),W))}_syncPendingControls(){let W=this._reduceChildren(!1,(H,Re)=>!!Re._syncPendingControls()||H);return W&&this.updateValueAndValidity({onlySelf:!0}),W}_forEachChild(W){Object.keys(this.controls).forEach(H=>{const Re=this.controls[H];Re&&W(Re,H)})}_setUpControls(){this._forEachChild(W=>{W.setParent(this),W._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(W){for(const H of Object.keys(this.controls)){const Re=this.controls[H];if(this.contains(H)&&W(Re))return!0}return!1}_reduceValue(){return this._reduceChildren({},(W,H,Re)=>((H.enabled||this.disabled)&&(W[Re]=H.value),W))}_reduceChildren(W,H){let Re=W;return this._forEachChild((wn,Ii)=>{Re=H(Re,wn,Ii)}),Re}_allControlsDisabled(){for(const W of Object.keys(this.controls))if(this.controls[W].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class wr extends $r{constructor(W,H,Re){super(Xt(H),ei(Re,H)),this.controls=W,this._initObservables(),this._setUpdateStrategy(H),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(W){return this.controls[W]}push(W,H={}){this.controls.push(W),this._registerControl(W),this.updateValueAndValidity({emitEvent:H.emitEvent}),this._onCollectionChange()}insert(W,H,Re={}){this.controls.splice(W,0,H),this._registerControl(H),this.updateValueAndValidity({emitEvent:Re.emitEvent})}removeAt(W,H={}){this.controls[W]&&this.controls[W]._registerOnCollectionChange(()=>{}),this.controls.splice(W,1),this.updateValueAndValidity({emitEvent:H.emitEvent})}setControl(W,H,Re={}){this.controls[W]&&this.controls[W]._registerOnCollectionChange(()=>{}),this.controls.splice(W,1),H&&(this.controls.splice(W,0,H),this._registerControl(H)),this.updateValueAndValidity({emitEvent:Re.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(W,H={}){jn(this,W),W.forEach((Re,wn)=>{yr(this,wn),this.at(wn).setValue(Re,{onlySelf:!0,emitEvent:H.emitEvent})}),this.updateValueAndValidity(H)}patchValue(W,H={}){null!=W&&(W.forEach((Re,wn)=>{this.at(wn)&&this.at(wn).patchValue(Re,{onlySelf:!0,emitEvent:H.emitEvent})}),this.updateValueAndValidity(H))}reset(W=[],H={}){this._forEachChild((Re,wn)=>{Re.reset(W[wn],{onlySelf:!0,emitEvent:H.emitEvent})}),this._updatePristine(H),this._updateTouched(H),this.updateValueAndValidity(H)}getRawValue(){return this.controls.map(W=>Dr(W))}clear(W={}){this.controls.length<1||(this._forEachChild(H=>H._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:W.emitEvent}))}_syncPendingControls(){let W=this.controls.reduce((H,Re)=>!!Re._syncPendingControls()||H,!1);return W&&this.updateValueAndValidity({onlySelf:!0}),W}_forEachChild(W){this.controls.forEach((H,Re)=>{W(H,Re)})}_updateValue(){this.value=this.controls.filter(W=>W.enabled||this.disabled).map(W=>W.value)}_anyControls(W){return this.controls.some(H=>H.enabled&&W(H))}_setUpControls(){this._forEachChild(W=>this._registerControl(W))}_allControlsDisabled(){for(const W of this.controls)if(W.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(W){W.setParent(this),W._registerOnCollectionChange(this._onCollectionChange)}}const ct={provide:qt,useExisting:(0,d.Gpc)(()=>en)},kt=(()=>Promise.resolve(null))();let en=(()=>{class ee extends qt{constructor(H,Re,wn,Ii,Rr){super(),this._changeDetectorRef=Rr,this.control=new jr,this._registered=!1,this.update=new d.vpe,this._parent=H,this._setValidators(Re),this._setAsyncValidators(wn),this.valueAccessor=function ln(ee,W){if(!W)return null;let H,Re,wn;return Array.isArray(W),W.forEach(Ii=>{Ii.constructor===Ie?H=Ii:function Ct(ee){return Object.getPrototypeOf(ee.constructor)===v}(Ii)?Re=Ii:wn=Ii}),wn||Re||H||null}(0,Ii)}ngOnChanges(H){if(this._checkForErrors(),!this._registered||"name"in H){if(this._registered&&(this._checkName(),this.formDirective)){const Re=H.name.previousValue;this.formDirective.removeControl({name:Re,path:this._getPath(Re)})}this._setUpControl()}"isDisabled"in H&&this._updateDisabled(H),function Tt(ee,W){if(!ee.hasOwnProperty("model"))return!1;const H=ee.model;return!!H.isFirstChange()||!Object.is(W,H.currentValue)}(H,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(H){this.viewModel=H,this.update.emit(H)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){wi(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(H){kt.then(()=>{this.control.setValue(H,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(H){const Re=H.isDisabled.currentValue,wn=""===Re||Re&&"false"!==Re;kt.then(()=>{wn&&!this.control.disabled?this.control.disable():!wn&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(H){return this._parent?function _r(ee,W){return[...W.path,ee]}(H,this._parent):[H]}}return ee.\u0275fac=function(H){return new(H||ee)(d.Y36(lt,9),d.Y36(Ne,10),d.Y36(ke,10),d.Y36(ne,10),d.Y36(d.sBO,8))},ee.\u0275dir=d.lG2({type:ee,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[d._Bn([ct]),d.qOj,d.TTD]}),ee})();const nn={provide:ne,useExisting:(0,d.Gpc)(()=>Nn),multi:!0};let Nn=(()=>{class ee extends v{writeValue(H){this.setProperty("value",H??"")}registerOnChange(H){this.onChange=Re=>{H(""==Re?null:parseFloat(Re))}}}return ee.\u0275fac=function(){let W;return function(Re){return(W||(W=d.n5z(ee)))(Re||ee)}}(),ee.\u0275dir=d.lG2({type:ee,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(H,Re){1&H&&d.NdJ("input",function(Ii){return Re.onChange(Ii.target.value)})("blur",function(){return Re.onTouched()})},features:[d._Bn([nn]),d.qOj]}),ee})(),Bi=(()=>{class ee{}return ee.\u0275fac=function(H){return new(H||ee)},ee.\u0275mod=d.oAB({type:ee}),ee.\u0275inj=d.cJS({}),ee})();function yo(ee){return"number"==typeof ee?ee:parseFloat(ee)}let vo=(()=>{class ee{constructor(){this._validator=Ae}ngOnChanges(H){if(this.inputName in H){const Re=this.normalizeInput(H[this.inputName].currentValue);this._enabled=this.enabled(Re),this._validator=this._enabled?this.createValidator(Re):Ae,this._onChange&&this._onChange()}}validate(H){return this._validator(H)}registerOnValidatorChange(H){this._onChange=H}enabled(H){return null!=H}}return ee.\u0275fac=function(H){return new(H||ee)},ee.\u0275dir=d.lG2({type:ee,features:[d.TTD]}),ee})();const Zs={provide:Ne,useExisting:(0,d.Gpc)(()=>Ts),multi:!0};let Ts=(()=>{class ee extends vo{constructor(){super(...arguments),this.inputName="max",this.normalizeInput=H=>yo(H),this.createValidator=H=>function ve(ee){return W=>{if(we(W.value)||we(ee))return null;const H=parseFloat(W.value);return!isNaN(H)&&H>ee?{max:{max:ee,actual:W.value}}:null}}(H)}}return ee.\u0275fac=function(){let W;return function(Re){return(W||(W=d.n5z(ee)))(Re||ee)}}(),ee.\u0275dir=d.lG2({type:ee,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(H,Re){2&H&&d.uIk("max",Re._enabled?Re.max:null)},inputs:{max:"max"},features:[d._Bn([Zs]),d.qOj]}),ee})();const Es={provide:Ne,useExisting:(0,d.Gpc)(()=>ai),multi:!0};let ai=(()=>{class ee extends vo{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=H=>yo(H),this.createValidator=H=>function Qe(ee){return W=>{if(we(W.value)||we(ee))return null;const H=parseFloat(W.value);return!isNaN(H)&&H<ee?{min:{min:ee,actual:W.value}}:null}}(H)}}return ee.\u0275fac=function(){let W;return function(Re){return(W||(W=d.n5z(ee)))(Re||ee)}}(),ee.\u0275dir=d.lG2({type:ee,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(H,Re){2&H&&d.uIk("min",Re._enabled?Re.min:null)},inputs:{min:"min"},features:[d._Bn([Es]),d.qOj]}),ee})(),cr=(()=>{class ee{}return ee.\u0275fac=function(H){return new(H||ee)},ee.\u0275mod=d.oAB({type:ee}),ee.\u0275inj=d.cJS({imports:[[Bi]]}),ee})(),er=(()=>{class ee{}return ee.\u0275fac=function(H){return new(H||ee)},ee.\u0275mod=d.oAB({type:ee}),ee.\u0275inj=d.cJS({imports:[cr]}),ee})()},6014:(Ln,At,k)=>{"use strict";k.d(At,{gz:()=>kt,y6:()=>Po,OD:()=>En,eC:()=>$t,wN:()=>Da,F0:()=>xo,rH:()=>aa,Bz:()=>$o,Hx:()=>Xn});var d=k(6895),m=k(8274),ce=k(8306),l=k(4742),ie=k(2076),re=k(4671),v=k(3268),ne=k(7669),De=k(1810),ge=k(5403),X=k(9672);function Ie(z,O,P){z?(0,X.f)(P,z,O):O()}var we=k(576);function Ue(z,O){const P=(0,we.m)(z)?z:()=>z,G=oe=>oe.error(P());return new ce.y(O?oe=>O.schedule(G,0,oe):G)}const ke=(0,k(3888).d)(z=>function(){z(this),this.name="EmptyError",this.message="no elements in sequence"});var He=k(727),We=k(4482);function Qe(){return(0,We.e)((z,O)=>{let P=null;z._refCount++;const G=(0,ge.x)(O,void 0,void 0,void 0,()=>{if(!z||z._refCount<=0||0<--z._refCount)return void(P=null);const oe=z._connection,Se=P;P=null,oe&&(!Se||oe===Se)&&oe.unsubscribe(),O.unsubscribe()});z.subscribe(G),G.closed||(P=z.connect())})}class ve extends ce.y{constructor(O,P){super(),this.source=O,this.subjectFactory=P,this._subject=null,this._refCount=0,this._connection=null,(0,We.A)(O)&&(this.lift=O.lift)}_subscribe(O){return this.getSubject().subscribe(O)}getSubject(){const O=this._subject;return(!O||O.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:O}=this;this._subject=this._connection=null,null==O||O.unsubscribe()}connect(){let O=this._connection;if(!O){O=this._connection=new He.w0;const P=this.getSubject();O.add(this.source.subscribe((0,ge.x)(P,void 0,()=>{this._teardown(),P.complete()},G=>{this._teardown(),P.error(G)},()=>this._teardown()))),O.closed&&(this._connection=null,O=He.w0.EMPTY)}return O}refCount(){return Qe()(this)}}var me=k(9646),Ze=k(1135),Pe=k(7272),Ge=k(9770),tt=k(515),ye=k(7579);function Be(z,O,P,G,oe){return(Se,ft)=>{let Mt=P,cn=O,ni=0;Se.subscribe((0,ge.x)(ft,or=>{const Mi=ni++;cn=Mt?z(cn,or,Mi):(Mt=!0,or),G&&ft.next(cn)},oe&&(()=>{Mt&&ft.next(cn),ft.complete()})))}}function st(z,O){return(0,We.e)(Be(z,O,arguments.length>=2,!0))}var _t=k(8421);function Yt(z){return(0,We.e)((O,P)=>{let Se,G=null,oe=!1;G=O.subscribe((0,ge.x)(P,void 0,void 0,ft=>{Se=(0,_t.Xf)(z(ft,Yt(z)(O))),G?(G.unsubscribe(),G=null,Se.subscribe(P)):oe=!0})),oe&&(G.unsubscribe(),G=null,Se.subscribe(P))})}var xn=k(9300);function Ht(z){return z<=0?()=>tt.E:(0,We.e)((O,P)=>{let G=[];O.subscribe((0,ge.x)(P,oe=>{G.push(oe),z<G.length&&G.shift()},()=>{for(const oe of G)P.next(oe);P.complete()},void 0,()=>{G=null}))})}function Nt(z=Bt){return(0,We.e)((O,P)=>{let G=!1;O.subscribe((0,ge.x)(P,oe=>{G=!0,P.next(oe)},()=>G?P.complete():P.error(z())))})}function Bt(){return new ke}function Dt(z){return(0,We.e)((O,P)=>{let G=!1;O.subscribe((0,ge.x)(P,oe=>{G=!0,P.next(oe)},()=>{G||P.next(z),P.complete()}))})}var Lt=k(5698);function _e(z,O){const P=arguments.length>=2;return G=>G.pipe(z?(0,xn.h)((oe,Se)=>z(oe,Se,G)):re.y,(0,Lt.q)(1),P?Dt(O):Nt(()=>new ke))}function it(z,O,P){const G=(0,we.m)(z)||O||P?{next:z,error:O,complete:P}:z;return G?(0,We.e)((oe,Se)=>{var ft;null===(ft=G.subscribe)||void 0===ft||ft.call(G);let Mt=!0;oe.subscribe((0,ge.x)(Se,cn=>{var ni;null===(ni=G.next)||void 0===ni||ni.call(G,cn),Se.next(cn)},()=>{var cn;Mt=!1,null===(cn=G.complete)||void 0===cn||cn.call(G),Se.complete()},cn=>{var ni;Mt=!1,null===(ni=G.error)||void 0===ni||ni.call(G,cn),Se.error(cn)},()=>{var cn,ni;Mt&&(null===(cn=G.unsubscribe)||void 0===cn||cn.call(G)),null===(ni=G.finalize)||void 0===ni||ni.call(G)}))}):re.y}var Qt=k(4004),_n=k(3900),Tn=k(4351),mn=k(5577),lt=k(8189);class qt{constructor(O,P){this.id=O,this.url=P}}class En extends qt{constructor(O,P,G="imperative",oe=null){super(O,P),this.navigationTrigger=G,this.restoredState=oe}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class yi extends qt{constructor(O,P,G){super(O,P),this.urlAfterRedirects=G}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Ui extends qt{constructor(O,P,G){super(O,P),this.reason=G}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Xi extends qt{constructor(O,P,G){super(O,P),this.error=G}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class mr extends qt{constructor(O,P,G,oe){super(O,P),this.urlAfterRedirects=G,this.state=oe}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class di extends qt{constructor(O,P,G,oe){super(O,P),this.urlAfterRedirects=G,this.state=oe}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ai extends qt{constructor(O,P,G,oe,Se){super(O,P),this.urlAfterRedirects=G,this.state=oe,this.shouldActivate=Se}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Hi extends qt{constructor(O,P,G,oe){super(O,P),this.urlAfterRedirects=G,this.state=oe}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ri extends qt{constructor(O,P,G,oe){super(O,P),this.urlAfterRedirects=G,this.state=oe}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class on{constructor(O){this.route=O}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class It{constructor(O){this.route=O}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class qe{constructor(O){this.snapshot=O}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class dt{constructor(O){this.snapshot=O}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Wt{constructor(O){this.snapshot=O}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class de{constructor(O){this.snapshot=O}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Je{constructor(O,P,G){this.routerEvent=O,this.position=P,this.anchor=G}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const $t="primary";class dn{constructor(O){this.params=O||{}}has(O){return Object.prototype.hasOwnProperty.call(this.params,O)}get(O){if(this.has(O)){const P=this.params[O];return Array.isArray(P)?P[0]:P}return null}getAll(O){if(this.has(O)){const P=this.params[O];return Array.isArray(P)?P:[P]}return[]}get keys(){return Object.keys(this.params)}}function Qn(z){return new dn(z)}const Qi="ngNavigationCancelingError";function nr(z){const O=Error("NavigationCancelingError: "+z);return O[Qi]=!0,O}function wi(z,O,P){const G=P.path.split("/");if(G.length>z.length||"full"===P.pathMatch&&(O.hasChildren()||G.length<z.length))return null;const oe={};for(let Se=0;Se<G.length;Se++){const ft=G[Se],Mt=z[Se];if(ft.startsWith(":"))oe[ft.substring(1)]=Mt;else if(ft!==Mt.path)return null}return{consumed:z.slice(0,G.length),posParams:oe}}function xi(z,O){const P=z?Object.keys(z):void 0,G=O?Object.keys(O):void 0;if(!P||!G||P.length!=G.length)return!1;let oe;for(let Se=0;Se<P.length;Se++)if(oe=P[Se],!Xr(z[oe],O[oe]))return!1;return!0}function Xr(z,O){if(Array.isArray(z)&&Array.isArray(O)){if(z.length!==O.length)return!1;const P=[...z].sort(),G=[...O].sort();return P.every((oe,Se)=>G[Se]===oe)}return z===O}function $i(z){return Array.prototype.concat.apply([],z)}function Oi(z){return z.length>0?z[z.length-1]:null}function ar(z,O){for(const P in z)z.hasOwnProperty(P)&&O(z[P],P)}function Ci(z){return(0,m.CqO)(z)?z:(0,m.QGY)(z)?(0,ie.D)(Promise.resolve(z)):(0,me.of)(z)}const L={exact:function $e(z,O,P){if(!Rn(z.segments,O.segments)||!Et(z.segments,O.segments,P)||z.numberOfChildren!==O.numberOfChildren)return!1;for(const G in O.children)if(!z.children[G]||!$e(z.children[G],O.children[G],P))return!1;return!0},subset:Tt},Q={exact:function pe(z,O){return xi(z,O)},subset:function gt(z,O){return Object.keys(O).length<=Object.keys(z).length&&Object.keys(O).every(P=>Xr(z[P],O[P]))},ignored:()=>!0};function N(z,O,P){return L[P.paths](z.root,O.root,P.matrixParams)&&Q[P.queryParams](z.queryParams,O.queryParams)&&!("exact"===P.fragment&&z.fragment!==O.fragment)}function Tt(z,O,P){return Ct(z,O,O.segments,P)}function Ct(z,O,P,G){if(z.segments.length>P.length){const oe=z.segments.slice(0,P.length);return!(!Rn(oe,P)||O.hasChildren()||!Et(oe,P,G))}if(z.segments.length===P.length){if(!Rn(z.segments,P)||!Et(z.segments,P,G))return!1;for(const oe in O.children)if(!z.children[oe]||!Tt(z.children[oe],O.children[oe],G))return!1;return!0}{const oe=P.slice(0,z.segments.length),Se=P.slice(z.segments.length);return!!(Rn(z.segments,oe)&&Et(z.segments,oe,G)&&z.children[$t])&&Ct(z.children[$t],O,Se,G)}}function Et(z,O,P){return O.every((G,oe)=>Q[P](z[oe].parameters,G.parameters))}class ln{constructor(O,P,G){this.root=O,this.queryParams=P,this.fragment=G}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Qn(this.queryParams)),this._queryParamMap}toString(){return vi.serialize(this)}}class yn{constructor(O,P){this.segments=O,this.children=P,this.parent=null,ar(P,(G,oe)=>G.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Xt(this)}}class Cn{constructor(O,P){this.path=O,this.parameters=P}get parameterMap(){return this._parameterMap||(this._parameterMap=Qn(this.parameters)),this._parameterMap}toString(){return Dr(this)}}function Rn(z,O){return z.length===O.length&&z.every((P,G)=>P.path===O[G].path)}class Xn{}class Ut{parse(O){const P=new Kr(O);return new ln(P.parseRootSegment(),P.parseQueryParams(),P.parseFragment())}serialize(O){const P=`/${qn(O.root,!0)}`,G=function jn(z){const O=Object.keys(z).map(P=>{const G=z[P];return Array.isArray(G)?G.map(oe=>`${gr(P)}=${gr(oe)}`).join("&"):`${gr(P)}=${gr(G)}`}).filter(P=>!!P);return O.length?`?${O.join("&")}`:""}(O.queryParams);return`${P}${G}${"string"==typeof O.fragment?`#${function lr(z){return encodeURI(z)}(O.fragment)}`:""}`}}const vi=new Ut;function Xt(z){return z.segments.map(O=>Dr(O)).join("/")}function qn(z,O){if(!z.hasChildren())return Xt(z);if(O){const P=z.children[$t]?qn(z.children[$t],!1):"",G=[];return ar(z.children,(oe,Se)=>{Se!==$t&&G.push(`${Se}:${qn(oe,!1)}`)}),G.length>0?`${P}(${G.join("//")})`:P}{const P=function Hn(z,O){let P=[];return ar(z.children,(G,oe)=>{oe===$t&&(P=P.concat(O(G,oe)))}),ar(z.children,(G,oe)=>{oe!==$t&&(P=P.concat(O(G,oe)))}),P}(z,(G,oe)=>oe===$t?[qn(z.children[$t],!1)]:[`${oe}:${qn(G,!1)}`]);return 1===Object.keys(z.children).length&&null!=z.children[$t]?`${Xt(z)}/${P[0]}`:`${Xt(z)}/(${P.join("//")})`}}function ei(z){return encodeURIComponent(z).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function gr(z){return ei(z).replace(/%3B/gi,";")}function Dn(z){return ei(z).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function mi(z){return decodeURIComponent(z)}function Wn(z){return mi(z.replace(/\+/g,"%20"))}function Dr(z){return`${Dn(z.path)}${function yr(z){return Object.keys(z).map(O=>`;${Dn(O)}=${Dn(z[O])}`).join("")}(z.parameters)}`}const $r=/^[^\/()?;=#]+/;function jr(z){const O=z.match($r);return O?O[0]:""}const Ir=/^[^=?&#]+/,ki=/^[^&#]+/;class Kr{constructor(O){this.url=O,this.remaining=O}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new yn([],{}):new yn([],this.parseChildren())}parseQueryParams(){const O={};if(this.consumeOptional("?"))do{this.parseQueryParam(O)}while(this.consumeOptional("&"));return O}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const O=[];for(this.peekStartsWith("(")||O.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),O.push(this.parseSegment());let P={};this.peekStartsWith("/(")&&(this.capture("/"),P=this.parseParens(!0));let G={};return this.peekStartsWith("(")&&(G=this.parseParens(!1)),(O.length>0||Object.keys(P).length>0)&&(G[$t]=new yn(O,P)),G}parseSegment(){const O=jr(this.remaining);if(""===O&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(O),new Cn(mi(O),this.parseMatrixParams())}parseMatrixParams(){const O={};for(;this.consumeOptional(";");)this.parseParam(O);return O}parseParam(O){const P=jr(this.remaining);if(!P)return;this.capture(P);let G="";if(this.consumeOptional("=")){const oe=jr(this.remaining);oe&&(G=oe,this.capture(G))}O[mi(P)]=mi(G)}parseQueryParam(O){const P=function wr(z){const O=z.match(Ir);return O?O[0]:""}(this.remaining);if(!P)return;this.capture(P);let G="";if(this.consumeOptional("=")){const ft=function Br(z){const O=z.match(ki);return O?O[0]:""}(this.remaining);ft&&(G=ft,this.capture(G))}const oe=Wn(P),Se=Wn(G);if(O.hasOwnProperty(oe)){let ft=O[oe];Array.isArray(ft)||(ft=[ft],O[oe]=ft),ft.push(Se)}else O[oe]=Se}parseParens(O){const P={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const G=jr(this.remaining),oe=this.remaining[G.length];if("/"!==oe&&")"!==oe&&";"!==oe)throw new Error(`Cannot parse url '${this.url}'`);let Se;G.indexOf(":")>-1?(Se=G.substr(0,G.indexOf(":")),this.capture(Se),this.capture(":")):O&&(Se=$t);const ft=this.parseChildren();P[Se]=1===Object.keys(ft).length?ft[$t]:new yn([],ft),this.consumeOptional("//")}return P}peekStartsWith(O){return this.remaining.startsWith(O)}consumeOptional(O){return!!this.peekStartsWith(O)&&(this.remaining=this.remaining.substring(O.length),!0)}capture(O){if(!this.consumeOptional(O))throw new Error(`Expected "${O}".`)}}class Lr{constructor(O){this._root=O}get root(){return this._root.value}parent(O){const P=this.pathFromRoot(O);return P.length>1?P[P.length-2]:null}children(O){const P=Yi(O,this._root);return P?P.children.map(G=>G.value):[]}firstChild(O){const P=Yi(O,this._root);return P&&P.children.length>0?P.children[0].value:null}siblings(O){const P=Ee(O,this._root);return P.length<2?[]:P[P.length-2].children.map(oe=>oe.value).filter(oe=>oe!==O)}pathFromRoot(O){return Ee(O,this._root).map(P=>P.value)}}function Yi(z,O){if(z===O.value)return O;for(const P of O.children){const G=Yi(z,P);if(G)return G}return null}function Ee(z,O){if(z===O.value)return[O];for(const P of O.children){const G=Ee(z,P);if(G.length)return G.unshift(O),G}return[]}class Xe{constructor(O,P){this.value=O,this.children=P}toString(){return`TreeNode(${this.value})`}}function vt(z){const O={};return z&&z.children.forEach(P=>O[P.value.outlet]=P),O}class Gt extends Lr{constructor(O,P){super(O),this.snapshot=P,hi(this,O)}toString(){return this.snapshot.toString()}}function et(z,O){const P=function ct(z,O){const ft=new nn([],{},{},"",{},$t,O,null,z.root,-1,{});return new Nn("",new Xe(ft,[]))}(z,O),G=new Ze.X([new Cn("",{})]),oe=new Ze.X({}),Se=new Ze.X({}),ft=new Ze.X({}),Mt=new Ze.X(""),cn=new kt(G,oe,ft,Mt,Se,$t,O,P.root);return cn.snapshot=P.root,new Gt(new Xe(cn,[]),P)}class kt{constructor(O,P,G,oe,Se,ft,Mt,cn){this.url=O,this.params=P,this.queryParams=G,this.fragment=oe,this.data=Se,this.outlet=ft,this.component=Mt,this._futureSnapshot=cn}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Qt.U)(O=>Qn(O)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Qt.U)(O=>Qn(O)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function en(z,O="emptyOnly"){const P=z.pathFromRoot;let G=0;if("always"!==O)for(G=P.length-1;G>=1;){const oe=P[G],Se=P[G-1];if(oe.routeConfig&&""===oe.routeConfig.path)G--;else{if(Se.component)break;G--}}return function bn(z){return z.reduce((O,P)=>({params:{...O.params,...P.params},data:{...O.data,...P.data},resolve:{...O.resolve,...P._resolvedData}}),{params:{},data:{},resolve:{}})}(P.slice(G))}class nn{constructor(O,P,G,oe,Se,ft,Mt,cn,ni,or,Mi){this.url=O,this.params=P,this.queryParams=G,this.fragment=oe,this.data=Se,this.outlet=ft,this.component=Mt,this.routeConfig=cn,this._urlSegment=ni,this._lastPathIndex=or,this._resolve=Mi}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Qn(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Qn(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(G=>G.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Nn extends Lr{constructor(O,P){super(P),this.url=O,hi(this,P)}toString(){return bi(this._root)}}function hi(z,O){O.value._routerState=z,O.children.forEach(P=>hi(z,P))}function bi(z){const O=z.children.length>0?` { ${z.children.map(bi).join(", ")} } `:"";return`${z.value}${O}`}function Bi(z){if(z.snapshot){const O=z.snapshot,P=z._futureSnapshot;z.snapshot=P,xi(O.queryParams,P.queryParams)||z.queryParams.next(P.queryParams),O.fragment!==P.fragment&&z.fragment.next(P.fragment),xi(O.params,P.params)||z.params.next(P.params),function Di(z,O){if(z.length!==O.length)return!1;for(let P=0;P<z.length;++P)if(!xi(z[P],O[P]))return!1;return!0}(O.url,P.url)||z.url.next(P.url),xi(O.data,P.data)||z.data.next(P.data)}else z.snapshot=z._futureSnapshot,z.data.next(z._futureSnapshot.data)}function Ki(z,O){const P=xi(z.params,O.params)&&function oi(z,O){return Rn(z,O)&&z.every((P,G)=>xi(P.parameters,O[G].parameters))}(z.url,O.url);return P&&!(!z.parent!=!O.parent)&&(!z.parent||Ki(z.parent,O.parent))}function Nr(z,O,P){if(P&&z.shouldReuseRoute(O.value,P.value.snapshot)){const G=P.value;G._futureSnapshot=O.value;const oe=function Jo(z,O,P){return O.children.map(G=>{for(const oe of P.children)if(z.shouldReuseRoute(G.value,oe.value.snapshot))return Nr(z,G,oe);return Nr(z,G)})}(z,O,P);return new Xe(G,oe)}{if(z.shouldAttach(O.value)){const Se=z.retrieve(O.value);if(null!==Se){const ft=Se.route;return ft.value._futureSnapshot=O.value,ft.children=O.children.map(Mt=>Nr(z,Mt)),ft}}const G=function ho(z){return new kt(new Ze.X(z.url),new Ze.X(z.params),new Ze.X(z.queryParams),new Ze.X(z.fragment),new Ze.X(z.data),z.outlet,z.component,z)}(O.value),oe=O.children.map(Se=>Nr(z,Se));return new Xe(G,oe)}}function ss(z){return"object"==typeof z&&null!=z&&!z.outlets&&!z.segmentPath}function Qr(z){return"object"==typeof z&&null!=z&&z.outlets}function Xo(z,O,P,G,oe){let Se={};if(G&&ar(G,(Mt,cn)=>{Se[cn]=Array.isArray(Mt)?Mt.map(ni=>`${ni}`):`${Mt}`}),z===O)return new ln(P,Se,oe);const ft=ko(z,O,P);return new ln(ft,Se,oe)}function ko(z,O,P){const G={};return ar(z.children,(oe,Se)=>{G[Se]=oe===O?P:ko(oe,O,P)}),new yn(z.segments,G)}class pt{constructor(O,P,G){if(this.isAbsolute=O,this.numberOfDoubleDots=P,this.commands=G,O&&G.length>0&&ss(G[0]))throw new Error("Root segment cannot have matrix parameters");const oe=G.find(Qr);if(oe&&oe!==Oi(G))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Le{constructor(O,P,G){this.segmentGroup=O,this.processChildren=P,this.index=G}}function Ji(z,O,P){if(z||(z=new yn([],{})),0===z.segments.length&&z.hasChildren())return Zr(z,O,P);const G=function po(z,O,P){let G=0,oe=O;const Se={match:!1,pathIndex:0,commandIndex:0};for(;oe<z.segments.length;){if(G>=P.length)return Se;const ft=z.segments[oe],Mt=P[G];if(Qr(Mt))break;const cn=`${Mt}`,ni=G<P.length-1?P[G+1]:null;if(oe>0&&void 0===cn)break;if(cn&&ni&&"object"==typeof ni&&void 0===ni.outlets){if(!Cs(cn,ni,ft))return Se;G+=2}else{if(!Cs(cn,{},ft))return Se;G++}oe++}return{match:!0,pathIndex:oe,commandIndex:G}}(z,O,P),oe=P.slice(G.commandIndex);if(G.match&&G.pathIndex<z.segments.length){const Se=new yn(z.segments.slice(0,G.pathIndex),{});return Se.children[$t]=new yn(z.segments.slice(G.pathIndex),z.children),Zr(Se,0,oe)}return G.match&&0===oe.length?new yn(z.segments,{}):G.match&&!z.hasChildren()?Ao(z,O,P):G.match?Zr(z,0,oe):Ao(z,O,P)}function Zr(z,O,P){if(0===P.length)return new yn(z.segments,{});{const G=function Si(z){return Qr(z[0])?z[0].outlets:{[$t]:z}}(P),oe={};return ar(G,(Se,ft)=>{"string"==typeof Se&&(Se=[Se]),null!==Se&&(oe[ft]=Ji(z.children[ft],O,Se))}),ar(z.children,(Se,ft)=>{void 0===G[ft]&&(oe[ft]=Se)}),new yn(z.segments,oe)}}function Ao(z,O,P){const G=z.segments.slice(0,O);let oe=0;for(;oe<P.length;){const Se=P[oe];if(Qr(Se)){const cn=Ko(Se.outlets);return new yn(G,cn)}if(0===oe&&ss(P[0])){G.push(new Cn(z.segments[O].path,as(P[0]))),oe++;continue}const ft=Qr(Se)?Se.outlets[$t]:`${Se}`,Mt=oe<P.length-1?P[oe+1]:null;ft&&Mt&&ss(Mt)?(G.push(new Cn(ft,as(Mt))),oe+=2):(G.push(new Cn(ft,{})),oe++)}return new yn(G,{})}function Ko(z){const O={};return ar(z,(P,G)=>{"string"==typeof P&&(P=[P]),null!==P&&(O[G]=Ao(new yn([],{}),0,P))}),O}function as(z){const O={};return ar(z,(P,G)=>O[G]=`${P}`),O}function Cs(z,O,P){return z==P.path&&xi(O,P.parameters)}class ls{constructor(O,P,G,oe){this.routeReuseStrategy=O,this.futureState=P,this.currState=G,this.forwardEvent=oe}activate(O){const P=this.futureState._root,G=this.currState?this.currState._root:null;this.deactivateChildRoutes(P,G,O),Bi(this.futureState.root),this.activateChildRoutes(P,G,O)}deactivateChildRoutes(O,P,G){const oe=vt(P);O.children.forEach(Se=>{const ft=Se.value.outlet;this.deactivateRoutes(Se,oe[ft],G),delete oe[ft]}),ar(oe,(Se,ft)=>{this.deactivateRouteAndItsChildren(Se,G)})}deactivateRoutes(O,P,G){const oe=O.value,Se=P?P.value:null;if(oe===Se)if(oe.component){const ft=G.getContext(oe.outlet);ft&&this.deactivateChildRoutes(O,P,ft.children)}else this.deactivateChildRoutes(O,P,G);else Se&&this.deactivateRouteAndItsChildren(P,G)}deactivateRouteAndItsChildren(O,P){O.value.component&&this.routeReuseStrategy.shouldDetach(O.value.snapshot)?this.detachAndStoreRouteSubtree(O,P):this.deactivateRouteAndOutlet(O,P)}detachAndStoreRouteSubtree(O,P){const G=P.getContext(O.value.outlet),oe=G&&O.value.component?G.children:P,Se=vt(O);for(const ft of Object.keys(Se))this.deactivateRouteAndItsChildren(Se[ft],oe);if(G&&G.outlet){const ft=G.outlet.detach(),Mt=G.children.onOutletDeactivated();this.routeReuseStrategy.store(O.value.snapshot,{componentRef:ft,route:O,contexts:Mt})}}deactivateRouteAndOutlet(O,P){const G=P.getContext(O.value.outlet),oe=G&&O.value.component?G.children:P,Se=vt(O);for(const ft of Object.keys(Se))this.deactivateRouteAndItsChildren(Se[ft],oe);G&&G.outlet&&(G.outlet.deactivate(),G.children.onOutletDeactivated(),G.attachRef=null,G.resolver=null,G.route=null)}activateChildRoutes(O,P,G){const oe=vt(P);O.children.forEach(Se=>{this.activateRoutes(Se,oe[Se.value.outlet],G),this.forwardEvent(new de(Se.value.snapshot))}),O.children.length&&this.forwardEvent(new dt(O.value.snapshot))}activateRoutes(O,P,G){const oe=O.value,Se=P?P.value:null;if(Bi(oe),oe===Se)if(oe.component){const ft=G.getOrCreateContext(oe.outlet);this.activateChildRoutes(O,P,ft.children)}else this.activateChildRoutes(O,P,G);else if(oe.component){const ft=G.getOrCreateContext(oe.outlet);if(this.routeReuseStrategy.shouldAttach(oe.snapshot)){const Mt=this.routeReuseStrategy.retrieve(oe.snapshot);this.routeReuseStrategy.store(oe.snapshot,null),ft.children.onOutletReAttached(Mt.contexts),ft.attachRef=Mt.componentRef,ft.route=Mt.route.value,ft.outlet&&ft.outlet.attach(Mt.componentRef,Mt.route.value),Bi(Mt.route.value),this.activateChildRoutes(O,null,ft.children)}else{const Mt=function So(z){for(let O=z.parent;O;O=O.parent){const P=O.routeConfig;if(P&&P._loadedConfig)return P._loadedConfig;if(P&&P.component)return null}return null}(oe.snapshot),cn=Mt?Mt.module.componentFactoryResolver:null;ft.attachRef=null,ft.route=oe,ft.resolver=cn,ft.outlet&&ft.outlet.activateWith(oe,cn),this.activateChildRoutes(O,null,ft.children)}}else this.activateChildRoutes(O,null,G)}}class eo{constructor(O,P){this.routes=O,this.module=P}}function Co(z){return"function"==typeof z}function yo(z){return z instanceof ln}const ai=Symbol("INITIAL_VALUE");function to(){return(0,_n.w)(z=>function ue(...z){const O=(0,ne.yG)(z),P=(0,ne.jO)(z),{args:G,keys:oe}=(0,l.D)(z);if(0===G.length)return(0,ie.D)([],O);const Se=new ce.y(function se(z,O,P=re.y){return G=>{Ie(O,()=>{const{length:oe}=z,Se=new Array(oe);let ft=oe,Mt=oe;for(let cn=0;cn<oe;cn++)Ie(O,()=>{const ni=(0,ie.D)(z[cn],O);let or=!1;ni.subscribe((0,ge.x)(G,Mi=>{Se[cn]=Mi,or||(or=!0,Mt--),Mt||G.next(P(Se.slice()))},()=>{--ft||G.complete()}))},G)},G)}}(G,O,oe?ft=>(0,De.n)(oe,ft):re.y));return P?Se.pipe((0,v.Z)(P)):Se}(z.map(O=>O.pipe((0,Lt.q)(1),function Ae(...z){const O=(0,ne.yG)(z);return(0,We.e)((P,G)=>{(O?(0,Pe.z)(z,P,O):(0,Pe.z)(z,P)).subscribe(G)})}(ai)))).pipe(st((O,P)=>{let G=!1;return P.reduce((oe,Se,ft)=>oe!==ai?oe:(Se===ai&&(G=!0),G||!1!==Se&&ft!==P.length-1&&!yo(Se)?oe:Se),O)},ai),(0,xn.h)(O=>O!==ai),(0,Qt.U)(O=>yo(O)?O:!0===O),(0,Lt.q)(1)))}class Gs{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Po,this.attachRef=null}}class Po{constructor(){this.contexts=new Map}onChildOutletCreated(O,P){const G=this.getOrCreateContext(O);G.outlet=P,this.contexts.set(O,G)}onChildOutletDestroyed(O){const P=this.getContext(O);P&&(P.outlet=null,P.attachRef=null)}onOutletDeactivated(){const O=this.contexts;return this.contexts=new Map,O}onOutletReAttached(O){this.contexts=O}getOrCreateContext(O){let P=this.getContext(O);return P||(P=new Gs,this.contexts.set(O,P)),P}getContext(O){return this.contexts.get(O)||null}}let ms=(()=>{class z{constructor(P,G,oe,Se,ft){this.parentContexts=P,this.location=G,this.resolver=oe,this.changeDetector=ft,this.activated=null,this._activatedRoute=null,this.activateEvents=new m.vpe,this.deactivateEvents=new m.vpe,this.attachEvents=new m.vpe,this.detachEvents=new m.vpe,this.name=Se||$t,P.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const P=this.parentContexts.getContext(this.name);P&&P.route&&(P.attachRef?this.attach(P.attachRef,P.route):this.activateWith(P.route,P.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const P=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(P.instance),P}attach(P,G){this.activated=P,this._activatedRoute=G,this.location.insert(P.hostView),this.attachEvents.emit(P.instance)}deactivate(){if(this.activated){const P=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(P)}}activateWith(P,G){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=P;const ft=(G=G||this.resolver).resolveComponentFactory(P._futureSnapshot.routeConfig.component),Mt=this.parentContexts.getOrCreateContext(this.name).children,cn=new _a(P,Mt,this.location.injector);this.activated=this.location.createComponent(ft,this.location.length,cn),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return z.\u0275fac=function(P){return new(P||z)(m.Y36(Po),m.Y36(m.s_b),m.Y36(m._Vd),m.$8M("name"),m.Y36(m.sBO))},z.\u0275dir=m.lG2({type:z,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),z})();class _a{constructor(O,P,G){this.route=O,this.childContexts=P,this.parent=G}get(O,P){return O===kt?this.route:O===Po?this.childContexts:this.parent.get(O,P)}}let Ds=(()=>{class z{}return z.\u0275fac=function(P){return new(P||z)},z.\u0275cmp=m.Xpm({type:z,selectors:[["ng-component"]],decls:1,vars:0,template:function(P,G){1&P&&m._UZ(0,"router-outlet")},directives:[ms],encapsulation:2}),z})();function Y(z,O=""){for(let P=0;P<z.length;P++){const G=z[P];Me(G,K(O,G))}}function Me(z,O){z.children&&Y(z.children,O)}function K(z,O){return O?z||O.path?z&&!O.path?`${z}/`:!z&&O.path?O.path:`${z}/${O.path}`:"":z}function Fe(z){const O=z.children&&z.children.map(Fe),P=O?{...z,children:O}:{...z};return!P.component&&(O||P.loadChildren)&&P.outlet&&P.outlet!==$t&&(P.component=Ds),P}function wt(z){return z.outlet||$t}function gn(z,O){const P=z.filter(G=>wt(G)===O);return P.push(...z.filter(G=>wt(G)!==O)),P}const kn={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Jn(z,O,P){if(""===O.path)return"full"===O.pathMatch&&(z.hasChildren()||P.length>0)?{...kn}:{matched:!0,consumedSegments:[],remainingSegments:P,parameters:{},positionalParamSegments:{}};const oe=(O.matcher||wi)(P,z,O);if(!oe)return{...kn};const Se={};ar(oe.posParams,(Mt,cn)=>{Se[cn]=Mt.path});const ft=oe.consumed.length>0?{...Se,...oe.consumed[oe.consumed.length-1].parameters}:Se;return{matched:!0,consumedSegments:oe.consumed,remainingSegments:P.slice(oe.consumed.length),parameters:ft,positionalParamSegments:oe.posParams??{}}}function Mr(z,O,P,G,oe="corrected"){if(P.length>0&&function Vi(z,O,P){return P.some(G=>fr(z,O,G)&&wt(G)!==$t)}(z,P,G)){const ft=new yn(O,function er(z,O,P,G){const oe={};oe[$t]=G,G._sourceSegment=z,G._segmentIndexShift=O.length;for(const Se of P)if(""===Se.path&&wt(Se)!==$t){const ft=new yn([],{});ft._sourceSegment=z,ft._segmentIndexShift=O.length,oe[wt(Se)]=ft}return oe}(z,O,G,new yn(P,z.children)));return ft._sourceSegment=z,ft._segmentIndexShift=O.length,{segmentGroup:ft,slicedSegments:[]}}if(0===P.length&&function xr(z,O,P){return P.some(G=>fr(z,O,G))}(z,P,G)){const ft=new yn(z.segments,function cr(z,O,P,G,oe,Se){const ft={};for(const Mt of G)if(fr(z,P,Mt)&&!oe[wt(Mt)]){const cn=new yn([],{});cn._sourceSegment=z,cn._segmentIndexShift="legacy"===Se?z.segments.length:O.length,ft[wt(Mt)]=cn}return{...oe,...ft}}(z,O,P,G,z.children,oe));return ft._sourceSegment=z,ft._segmentIndexShift=O.length,{segmentGroup:ft,slicedSegments:P}}const Se=new yn(z.segments,z.children);return Se._sourceSegment=z,Se._segmentIndexShift=O.length,{segmentGroup:Se,slicedSegments:P}}function fr(z,O,P){return(!(z.hasChildren()||O.length>0)||"full"!==P.pathMatch)&&""===P.path}function br(z,O,P,G){return!!(wt(z)===G||G!==$t&&fr(O,P,z))&&("**"===z.path||Jn(O,z,P).matched)}function ee(z,O,P){return 0===O.length&&!z.children[P]}class W{constructor(O){this.segmentGroup=O||null}}class H{constructor(O){this.urlTree=O}}function Re(z){return Ue(new W(z))}function wn(z){return Ue(new H(z))}class Rs{constructor(O,P,G,oe,Se){this.configLoader=P,this.urlSerializer=G,this.urlTree=oe,this.config=Se,this.allowRedirects=!0,this.ngModule=O.get(m.h0i)}apply(){const O=Mr(this.urlTree.root,[],[],this.config).segmentGroup,P=new yn(O.segments,O.children);return this.expandSegmentGroup(this.ngModule,this.config,P,$t).pipe((0,Qt.U)(Se=>this.createUrlTree(fl(Se),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Yt(Se=>{if(Se instanceof H)return this.allowRedirects=!1,this.match(Se.urlTree);throw Se instanceof W?this.noMatchError(Se):Se}))}match(O){return this.expandSegmentGroup(this.ngModule,this.config,O.root,$t).pipe((0,Qt.U)(oe=>this.createUrlTree(fl(oe),O.queryParams,O.fragment))).pipe(Yt(oe=>{throw oe instanceof W?this.noMatchError(oe):oe}))}noMatchError(O){return new Error(`Cannot match any routes. URL Segment: '${O.segmentGroup}'`)}createUrlTree(O,P,G){const oe=O.segments.length>0?new yn([],{[$t]:O}):O;return new ln(oe,P,G)}expandSegmentGroup(O,P,G,oe){return 0===G.segments.length&&G.hasChildren()?this.expandChildren(O,P,G).pipe((0,Qt.U)(Se=>new yn([],Se))):this.expandSegment(O,G,P,G.segments,oe,!0)}expandChildren(O,P,G){const oe=[];for(const Se of Object.keys(G.children))"primary"===Se?oe.unshift(Se):oe.push(Se);return(0,ie.D)(oe).pipe((0,Tn.b)(Se=>{const ft=G.children[Se],Mt=gn(P,Se);return this.expandSegmentGroup(O,Mt,ft,Se).pipe((0,Qt.U)(cn=>({segment:cn,outlet:Se})))}),st((Se,ft)=>(Se[ft.outlet]=ft.segment,Se),{}),function ht(z,O){const P=arguments.length>=2;return G=>G.pipe(z?(0,xn.h)((oe,Se)=>z(oe,Se,G)):re.y,Ht(1),P?Dt(O):Nt(()=>new ke))}())}expandSegment(O,P,G,oe,Se,ft){return(0,ie.D)(G).pipe((0,Tn.b)(Mt=>this.expandSegmentAgainstRoute(O,P,G,Mt,oe,Se,ft).pipe(Yt(ni=>{if(ni instanceof W)return(0,me.of)(null);throw ni}))),_e(Mt=>!!Mt),Yt((Mt,cn)=>{if(Mt instanceof ke||"EmptyError"===Mt.name)return ee(P,oe,Se)?(0,me.of)(new yn([],{})):Re(P);throw Mt}))}expandSegmentAgainstRoute(O,P,G,oe,Se,ft,Mt){return br(oe,P,Se,ft)?void 0===oe.redirectTo?this.matchSegmentAgainstRoute(O,P,oe,Se,ft):Mt&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(O,P,G,oe,Se,ft):Re(P):Re(P)}expandSegmentAgainstRouteUsingRedirect(O,P,G,oe,Se,ft){return"**"===oe.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(O,G,oe,ft):this.expandRegularSegmentAgainstRouteUsingRedirect(O,P,G,oe,Se,ft)}expandWildCardWithParamsAgainstRouteUsingRedirect(O,P,G,oe){const Se=this.applyRedirectCommands([],G.redirectTo,{});return G.redirectTo.startsWith("/")?wn(Se):this.lineralizeSegments(G,Se).pipe((0,mn.z)(ft=>{const Mt=new yn(ft,{});return this.expandSegment(O,Mt,P,ft,oe,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(O,P,G,oe,Se,ft){const{matched:Mt,consumedSegments:cn,remainingSegments:ni,positionalParamSegments:or}=Jn(P,oe,Se);if(!Mt)return Re(P);const Mi=this.applyRedirectCommands(cn,oe.redirectTo,or);return oe.redirectTo.startsWith("/")?wn(Mi):this.lineralizeSegments(oe,Mi).pipe((0,mn.z)(Tr=>this.expandSegment(O,P,G,Tr.concat(ni),ft,!1)))}matchSegmentAgainstRoute(O,P,G,oe,Se){if("**"===G.path)return G.loadChildren?(G._loadedConfig?(0,me.of)(G._loadedConfig):this.configLoader.load(O.injector,G)).pipe((0,Qt.U)(Mi=>(G._loadedConfig=Mi,new yn(oe,{})))):(0,me.of)(new yn(oe,{}));const{matched:ft,consumedSegments:Mt,remainingSegments:cn}=Jn(P,G,oe);return ft?this.getChildConfig(O,G,oe).pipe((0,mn.z)(or=>{const Mi=or.module,Tr=or.routes,{segmentGroup:Ur,slicedSegments:Pa}=Mr(P,Mt,cn,Tr),Oa=new yn(Ur.segments,Ur.children);if(0===Pa.length&&Oa.hasChildren())return this.expandChildren(Mi,Tr,Oa).pipe((0,Qt.U)(Gl=>new yn(Mt,Gl)));if(0===Tr.length&&0===Pa.length)return(0,me.of)(new yn(Mt,{}));const ca=wt(G)===Se;return this.expandSegment(Mi,Oa,Tr,Pa,ca?$t:Se,!0).pipe((0,Qt.U)(xa=>new yn(Mt.concat(xa.segments),xa.children)))})):Re(P)}getChildConfig(O,P,G){return P.children?(0,me.of)(new eo(P.children,O)):P.loadChildren?void 0!==P._loadedConfig?(0,me.of)(P._loadedConfig):this.runCanLoadGuards(O.injector,P,G).pipe((0,mn.z)(oe=>oe?this.configLoader.load(O.injector,P).pipe((0,Qt.U)(Se=>(P._loadedConfig=Se,Se))):function Rr(z){return Ue(nr(`Cannot load children because the guard of the route "path: '${z.path}'" returned false`))}(P))):(0,me.of)(new eo([],O))}runCanLoadGuards(O,P,G){const oe=P.canLoad;if(!oe||0===oe.length)return(0,me.of)(!0);const Se=oe.map(ft=>{const Mt=O.get(ft);let cn;if(function vo(z){return z&&Co(z.canLoad)}(Mt))cn=Mt.canLoad(P,G);else{if(!Co(Mt))throw new Error("Invalid CanLoad guard");cn=Mt(P,G)}return Ci(cn)});return(0,me.of)(Se).pipe(to(),it(ft=>{if(!yo(ft))return;const Mt=nr(`Redirecting to "${this.urlSerializer.serialize(ft)}"`);throw Mt.url=ft,Mt}),(0,Qt.U)(ft=>!0===ft))}lineralizeSegments(O,P){let G=[],oe=P.root;for(;;){if(G=G.concat(oe.segments),0===oe.numberOfChildren)return(0,me.of)(G);if(oe.numberOfChildren>1||!oe.children[$t])return Ue(new Error(`Only absolute redirects can have named outlets. redirectTo: '${O.redirectTo}'`));oe=oe.children[$t]}}applyRedirectCommands(O,P,G){return this.applyRedirectCreatreUrlTree(P,this.urlSerializer.parse(P),O,G)}applyRedirectCreatreUrlTree(O,P,G,oe){const Se=this.createSegmentGroup(O,P.root,G,oe);return new ln(Se,this.createQueryParams(P.queryParams,this.urlTree.queryParams),P.fragment)}createQueryParams(O,P){const G={};return ar(O,(oe,Se)=>{if("string"==typeof oe&&oe.startsWith(":")){const Mt=oe.substring(1);G[Se]=P[Mt]}else G[Se]=oe}),G}createSegmentGroup(O,P,G,oe){const Se=this.createSegments(O,P.segments,G,oe);let ft={};return ar(P.children,(Mt,cn)=>{ft[cn]=this.createSegmentGroup(O,Mt,G,oe)}),new yn(Se,ft)}createSegments(O,P,G,oe){return P.map(Se=>Se.path.startsWith(":")?this.findPosParam(O,Se,oe):this.findOrReturn(Se,G))}findPosParam(O,P,G){const oe=G[P.path.substring(1)];if(!oe)throw new Error(`Cannot redirect to '${O}'. Cannot find '${P.path}'.`);return oe}findOrReturn(O,P){let G=0;for(const oe of P){if(oe.path===O.path)return P.splice(G),oe;G++}return O}}function fl(z){const O={};for(const G of Object.keys(z.children)){const Se=fl(z.children[G]);(Se.segments.length>0||Se.hasChildren())&&(O[G]=Se)}return function ks(z){if(1===z.numberOfChildren&&z.children[$t]){const O=z.children[$t];return new yn(z.segments.concat(O.segments),O.children)}return z}(new yn(z.segments,O))}class ml{constructor(O){this.path=O,this.route=this.path[this.path.length-1]}}class Is{constructor(O,P){this.component=O,this.route=P}}function dc(z,O,P){const G=z._root;return gs(G,O?O._root:null,P,[G.value])}function Pn(z,O,P){const G=function ur(z){if(!z)return null;for(let O=z.parent;O;O=O.parent){const P=O.routeConfig;if(P&&P._loadedConfig)return P._loadedConfig}return null}(O);return(G?G.module.injector:P).get(z)}function gs(z,O,P,G,oe={canDeactivateChecks:[],canActivateChecks:[]}){const Se=vt(O);return z.children.forEach(ft=>{(function ro(z,O,P,G,oe={canDeactivateChecks:[],canActivateChecks:[]}){const Se=z.value,ft=O?O.value:null,Mt=P?P.getContext(z.value.outlet):null;if(ft&&Se.routeConfig===ft.routeConfig){const cn=function gl(z,O,P){if("function"==typeof P)return P(z,O);switch(P){case"pathParamsChange":return!Rn(z.url,O.url);case"pathParamsOrQueryParamsChange":return!Rn(z.url,O.url)||!xi(z.queryParams,O.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Ki(z,O)||!xi(z.queryParams,O.queryParams);default:return!Ki(z,O)}}(ft,Se,Se.routeConfig.runGuardsAndResolvers);cn?oe.canActivateChecks.push(new ml(G)):(Se.data=ft.data,Se._resolvedData=ft._resolvedData),gs(z,O,Se.component?Mt?Mt.children:null:P,G,oe),cn&&Mt&&Mt.outlet&&Mt.outlet.isActivated&&oe.canDeactivateChecks.push(new Is(Mt.outlet.component,ft))}else ft&&_s(O,Mt,oe),oe.canActivateChecks.push(new ml(G)),gs(z,null,Se.component?Mt?Mt.children:null:P,G,oe)})(ft,Se[ft.value.outlet],P,G.concat([ft.value]),oe),delete Se[ft.value.outlet]}),ar(Se,(ft,Mt)=>_s(ft,P.getContext(Mt),oe)),oe}function _s(z,O,P){const G=vt(z),oe=z.value;ar(G,(Se,ft)=>{_s(Se,oe.component?O?O.children.getContext(ft):null:O,P)}),P.canDeactivateChecks.push(new Is(oe.component&&O&&O.outlet&&O.outlet.isActivated?O.outlet.component:null,oe))}class E{}function Z(z){return new ce.y(O=>O.error(z))}class j{constructor(O,P,G,oe,Se,ft){this.rootComponentType=O,this.config=P,this.urlTree=G,this.url=oe,this.paramsInheritanceStrategy=Se,this.relativeLinkResolution=ft}recognize(){const O=Mr(this.urlTree.root,[],[],this.config.filter(ft=>void 0===ft.redirectTo),this.relativeLinkResolution).segmentGroup,P=this.processSegmentGroup(this.config,O,$t);if(null===P)return null;const G=new nn([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},$t,this.rootComponentType,null,this.urlTree.root,-1,{}),oe=new Xe(G,P),Se=new Nn(this.url,oe);return this.inheritParamsAndData(Se._root),Se}inheritParamsAndData(O){const P=O.value,G=en(P,this.paramsInheritanceStrategy);P.params=Object.freeze(G.params),P.data=Object.freeze(G.data),O.children.forEach(oe=>this.inheritParamsAndData(oe))}processSegmentGroup(O,P,G){return 0===P.segments.length&&P.hasChildren()?this.processChildren(O,P):this.processSegment(O,P,P.segments,G)}processChildren(O,P){const G=[];for(const Se of Object.keys(P.children)){const ft=P.children[Se],Mt=gn(O,Se),cn=this.processSegmentGroup(Mt,ft,Se);if(null===cn)return null;G.push(...cn)}const oe=Yn(G);return function fe(z){z.sort((O,P)=>O.value.outlet===$t?-1:P.value.outlet===$t?1:O.value.outlet.localeCompare(P.value.outlet))}(oe),oe}processSegment(O,P,G,oe){for(const Se of O){const ft=this.processSegmentAgainstRoute(Se,P,G,oe);if(null!==ft)return ft}return ee(P,G,oe)?[]:null}processSegmentAgainstRoute(O,P,G,oe){if(O.redirectTo||!br(O,P,G,oe))return null;let Se,ft=[],Mt=[];if("**"===O.path){const Ur=G.length>0?Oi(G).parameters:{};Se=new nn(G,Ur,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Cr(O),wt(O),O.component,O,pi(P),ir(P)+G.length,Ar(O))}else{const Ur=Jn(P,O,G);if(!Ur.matched)return null;ft=Ur.consumedSegments,Mt=Ur.remainingSegments,Se=new nn(ft,Ur.parameters,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Cr(O),wt(O),O.component,O,pi(P),ir(P)+ft.length,Ar(O))}const cn=function Pt(z){return z.children?z.children:z.loadChildren?z._loadedConfig.routes:[]}(O),{segmentGroup:ni,slicedSegments:or}=Mr(P,ft,Mt,cn.filter(Ur=>void 0===Ur.redirectTo),this.relativeLinkResolution);if(0===or.length&&ni.hasChildren()){const Ur=this.processChildren(cn,ni);return null===Ur?null:[new Xe(Se,Ur)]}if(0===cn.length&&0===or.length)return[new Xe(Se,[])];const Mi=wt(O)===oe,Tr=this.processSegment(cn,ni,or,Mi?$t:oe);return null===Tr?null:[new Xe(Se,Tr)]}}function Sn(z){const O=z.value.routeConfig;return O&&""===O.path&&void 0===O.redirectTo}function Yn(z){const O=[],P=new Set;for(const G of z){if(!Sn(G)){O.push(G);continue}const oe=O.find(Se=>G.value.routeConfig===Se.value.routeConfig);void 0!==oe?(oe.children.push(...G.children),P.add(oe)):O.push(G)}for(const G of P){const oe=Yn(G.children);O.push(new Xe(G.value,oe))}return O.filter(G=>!P.has(G))}function pi(z){let O=z;for(;O._sourceSegment;)O=O._sourceSegment;return O}function ir(z){let O=z,P=O._segmentIndexShift?O._segmentIndexShift:0;for(;O._sourceSegment;)O=O._sourceSegment,P+=O._segmentIndexShift?O._segmentIndexShift:0;return P-1}function Cr(z){return z.data||{}}function Ar(z){return z.resolve||{}}function oa(z){return[...Object.keys(z),...Object.getOwnPropertySymbols(z)]}function Ea(z){return(0,_n.w)(O=>{const P=z(O);return P?(0,ie.D)(P).pipe((0,Qt.U)(()=>O)):(0,me.of)(O)})}class Da{}class Do extends class sa{shouldDetach(O){return!1}store(O,P){}shouldAttach(O){return!1}retrieve(O){return null}shouldReuseRoute(O,P){return O.routeConfig===P.routeConfig}}{}const Fo=new m.OlP("ROUTES");class kr{constructor(O,P,G,oe){this.injector=O,this.compiler=P,this.onLoadStartListener=G,this.onLoadEndListener=oe}load(O,P){if(P._loader$)return P._loader$;this.onLoadStartListener&&this.onLoadStartListener(P);const oe=this.loadModuleFactory(P.loadChildren).pipe((0,Qt.U)(Se=>{this.onLoadEndListener&&this.onLoadEndListener(P);const ft=Se.create(O);return new eo($i(ft.injector.get(Fo,void 0,m.XFs.Self|m.XFs.Optional)).map(Fe),ft)}),Yt(Se=>{throw P._loader$=void 0,Se}));return P._loader$=new ve(oe,()=>new ye.x).pipe(Qe()),P._loader$}loadModuleFactory(O){return Ci(O()).pipe((0,mn.z)(P=>P instanceof m.YKP?(0,me.of)(P):(0,ie.D)(this.compiler.compileModuleAsync(P))))}}class Zc{shouldProcessUrl(O){return!0}extract(O){return O}merge(O,P){return O}}function ya(z){throw z}function Gc(z,O,P){return O.parse("/")}function Ul(z,O){return(0,me.of)(null)}const Vl={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},va={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let xo=(()=>{class z{constructor(P,G,oe,Se,ft,Mt,cn){this.rootComponentType=P,this.urlSerializer=G,this.rootContexts=oe,this.location=Se,this.config=cn,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new ye.x,this.errorHandler=ya,this.malformedUriErrorHandler=Gc,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Ul,afterPreactivation:Ul},this.urlHandlingStrategy=new Zc,this.routeReuseStrategy=new Do,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=ft.get(m.h0i),this.console=ft.get(m.c2e);const Mi=ft.get(m.R0b);this.isNgZoneEnabled=Mi instanceof m.R0b&&m.R0b.isInAngularZone(),this.resetConfig(cn),this.currentUrlTree=function je(){return new ln(new yn([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new kr(ft,Mt,Tr=>this.triggerEvent(new on(Tr)),Tr=>this.triggerEvent(new It(Tr))),this.routerState=et(this.currentUrlTree,this.rootComponentType),this.transitions=new Ze.X({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(P){const G=this.events;return P.pipe((0,xn.h)(oe=>0!==oe.id),(0,Qt.U)(oe=>({...oe,extractedUrl:this.urlHandlingStrategy.extract(oe.rawUrl)})),(0,_n.w)(oe=>{let Se=!1,ft=!1;return(0,me.of)(oe).pipe(it(Mt=>{this.currentNavigation={id:Mt.id,initialUrl:Mt.currentRawUrl,extractedUrl:Mt.extractedUrl,trigger:Mt.source,extras:Mt.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,_n.w)(Mt=>{const cn=this.browserUrlTree.toString(),ni=!this.navigated||Mt.extractedUrl.toString()!==cn||cn!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||ni)&&this.urlHandlingStrategy.shouldProcessUrl(Mt.rawUrl))return Ya(Mt.source)&&(this.browserUrlTree=Mt.extractedUrl),(0,me.of)(Mt).pipe((0,_n.w)(Mi=>{const Tr=this.transitions.getValue();return G.next(new En(Mi.id,this.serializeUrl(Mi.extractedUrl),Mi.source,Mi.restoredState)),Tr!==this.transitions.getValue()?tt.E:Promise.resolve(Mi)}),function uc(z,O,P,G){return(0,_n.w)(oe=>function Ri(z,O,P,G,oe){return new Rs(z,O,P,G,oe).apply()}(z,O,P,oe.extractedUrl,G).pipe((0,Qt.U)(Se=>({...oe,urlAfterRedirects:Se}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),it(Mi=>{this.currentNavigation={...this.currentNavigation,finalUrl:Mi.urlAfterRedirects}}),function fo(z,O,P,G,oe){return(0,mn.z)(Se=>function D(z,O,P,G,oe="emptyOnly",Se="legacy"){try{const ft=new j(z,O,P,G,oe,Se).recognize();return null===ft?Z(new E):(0,me.of)(ft)}catch(ft){return Z(ft)}}(z,O,Se.urlAfterRedirects,P(Se.urlAfterRedirects),G,oe).pipe((0,Qt.U)(ft=>({...Se,targetSnapshot:ft}))))}(this.rootComponentType,this.config,Mi=>this.serializeUrl(Mi),this.paramsInheritanceStrategy,this.relativeLinkResolution),it(Mi=>{if("eager"===this.urlUpdateStrategy){if(!Mi.extras.skipLocationChange){const Ur=this.urlHandlingStrategy.merge(Mi.urlAfterRedirects,Mi.rawUrl);this.setBrowserUrl(Ur,Mi)}this.browserUrlTree=Mi.urlAfterRedirects}const Tr=new mr(Mi.id,this.serializeUrl(Mi.extractedUrl),this.serializeUrl(Mi.urlAfterRedirects),Mi.targetSnapshot);G.next(Tr)}));if(ni&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:Tr,extractedUrl:Ur,source:Pa,restoredState:Oa,extras:ca}=Mt,vl=new En(Tr,this.serializeUrl(Ur),Pa,Oa);G.next(vl);const xa=et(Ur,this.rootComponentType).snapshot;return(0,me.of)({...Mt,targetSnapshot:xa,urlAfterRedirects:Ur,extras:{...ca,skipLocationChange:!1,replaceUrl:!1}})}return this.rawUrlTree=Mt.rawUrl,Mt.resolve(null),tt.E}),Ea(Mt=>{const{targetSnapshot:cn,id:ni,extractedUrl:or,rawUrl:Mi,extras:{skipLocationChange:Tr,replaceUrl:Ur}}=Mt;return this.hooks.beforePreactivation(cn,{navigationId:ni,appliedUrlTree:or,rawUrlTree:Mi,skipLocationChange:!!Tr,replaceUrl:!!Ur})}),it(Mt=>{const cn=new di(Mt.id,this.serializeUrl(Mt.extractedUrl),this.serializeUrl(Mt.urlAfterRedirects),Mt.targetSnapshot);this.triggerEvent(cn)}),(0,Qt.U)(Mt=>({...Mt,guards:dc(Mt.targetSnapshot,Mt.currentSnapshot,this.rootContexts)})),function Oo(z,O){return(0,mn.z)(P=>{const{targetSnapshot:G,currentSnapshot:oe,guards:{canActivateChecks:Se,canDeactivateChecks:ft}}=P;return 0===ft.length&&0===Se.length?(0,me.of)({...P,guardsResult:!0}):function Ha(z,O,P,G){return(0,ie.D)(z).pipe((0,mn.z)(oe=>function ao(z,O,P,G,oe){const Se=O&&O.routeConfig?O.routeConfig.canDeactivate:null;if(!Se||0===Se.length)return(0,me.of)(!0);const ft=Se.map(Mt=>{const cn=Pn(Mt,O,oe);let ni;if(function Es(z){return z&&Co(z.canDeactivate)}(cn))ni=Ci(cn.canDeactivate(z,O,P,G));else{if(!Co(cn))throw new Error("Invalid CanDeactivate guard");ni=Ci(cn(z,O,P,G))}return ni.pipe(_e())});return(0,me.of)(ft).pipe(to())}(oe.component,oe.route,P,O,G)),_e(oe=>!0!==oe,!0))}(ft,G,oe,z).pipe((0,mn.z)(Mt=>Mt&&function Ls(z){return"boolean"==typeof z}(Mt)?function Hs(z,O,P,G){return(0,ie.D)(O).pipe((0,Tn.b)(oe=>(0,Pe.z)(function zl(z,O){return null!==z&&O&&O(new qe(z)),(0,me.of)(!0)}(oe.route.parent,G),function qa(z,O){return null!==z&&O&&O(new Wt(z)),(0,me.of)(!0)}(oe.route,G),function dr(z,O,P){const G=O[O.length-1],Se=O.slice(0,O.length-1).reverse().map(ft=>function hc(z){const O=z.routeConfig?z.routeConfig.canActivateChild:null;return O&&0!==O.length?{node:z,guards:O}:null}(ft)).filter(ft=>null!==ft).map(ft=>(0,Ge.P)(()=>{const Mt=ft.guards.map(cn=>{const ni=Pn(cn,ft.node,P);let or;if(function Ts(z){return z&&Co(z.canActivateChild)}(ni))or=Ci(ni.canActivateChild(G,z));else{if(!Co(ni))throw new Error("Invalid CanActivateChild guard");or=Ci(ni(G,z))}return or.pipe(_e())});return(0,me.of)(Mt).pipe(to())}));return(0,me.of)(Se).pipe(to())}(z,oe.path,P),function Nl(z,O,P){const G=O.routeConfig?O.routeConfig.canActivate:null;if(!G||0===G.length)return(0,me.of)(!0);const oe=G.map(Se=>(0,Ge.P)(()=>{const ft=Pn(Se,O,P);let Mt;if(function Zs(z){return z&&Co(z.canActivate)}(ft))Mt=Ci(ft.canActivate(O,z));else{if(!Co(ft))throw new Error("Invalid CanActivate guard");Mt=Ci(ft(O,z))}return Mt.pipe(_e())}));return(0,me.of)(oe).pipe(to())}(z,oe.route,P))),_e(oe=>!0!==oe,!0))}(G,Se,z,O):(0,me.of)(Mt)),(0,Qt.U)(Mt=>({...P,guardsResult:Mt})))})}(this.ngModule.injector,Mt=>this.triggerEvent(Mt)),it(Mt=>{if(yo(Mt.guardsResult)){const ni=nr(`Redirecting to "${this.serializeUrl(Mt.guardsResult)}"`);throw ni.url=Mt.guardsResult,ni}const cn=new Ai(Mt.id,this.serializeUrl(Mt.extractedUrl),this.serializeUrl(Mt.urlAfterRedirects),Mt.targetSnapshot,!!Mt.guardsResult);this.triggerEvent(cn)}),(0,xn.h)(Mt=>!!Mt.guardsResult||(this.restoreHistory(Mt),this.cancelNavigationTransition(Mt,""),!1)),Ea(Mt=>{if(Mt.guards.canActivateChecks.length)return(0,me.of)(Mt).pipe(it(cn=>{const ni=new Hi(cn.id,this.serializeUrl(cn.extractedUrl),this.serializeUrl(cn.urlAfterRedirects),cn.targetSnapshot);this.triggerEvent(ni)}),(0,_n.w)(cn=>{let ni=!1;return(0,me.of)(cn).pipe(function Lo(z,O){return(0,mn.z)(P=>{const{targetSnapshot:G,guards:{canActivateChecks:oe}}=P;if(!oe.length)return(0,me.of)(P);let Se=0;return(0,ie.D)(oe).pipe((0,Tn.b)(ft=>function Zn(z,O,P,G){return function Qo(z,O,P,G){const oe=oa(z);if(0===oe.length)return(0,me.of)({});const Se={};return(0,ie.D)(oe).pipe((0,mn.z)(ft=>function pc(z,O,P,G){const oe=Pn(z,O,G);return Ci(oe.resolve?oe.resolve(O,P):oe(O,P))}(z[ft],O,P,G).pipe(it(Mt=>{Se[ft]=Mt}))),Ht(1),(0,mn.z)(()=>oa(Se).length===oe.length?(0,me.of)(Se):tt.E))}(z._resolve,z,O,G).pipe((0,Qt.U)(Se=>(z._resolvedData=Se,z.data={...z.data,...en(z,P).resolve},null)))}(ft.route,G,z,O)),it(()=>Se++),Ht(1),(0,mn.z)(ft=>Se===oe.length?(0,me.of)(P):tt.E))})}(this.paramsInheritanceStrategy,this.ngModule.injector),it({next:()=>ni=!0,complete:()=>{ni||(this.restoreHistory(cn),this.cancelNavigationTransition(cn,"At least one route resolver didn't emit any value."))}}))}),it(cn=>{const ni=new ri(cn.id,this.serializeUrl(cn.extractedUrl),this.serializeUrl(cn.urlAfterRedirects),cn.targetSnapshot);this.triggerEvent(ni)}))}),Ea(Mt=>{const{targetSnapshot:cn,id:ni,extractedUrl:or,rawUrl:Mi,extras:{skipLocationChange:Tr,replaceUrl:Ur}}=Mt;return this.hooks.afterPreactivation(cn,{navigationId:ni,appliedUrlTree:or,rawUrlTree:Mi,skipLocationChange:!!Tr,replaceUrl:!!Ur})}),(0,Qt.U)(Mt=>{const cn=function zr(z,O,P){const G=Nr(z,O._root,P?P._root:void 0);return new Gt(G,O)}(this.routeReuseStrategy,Mt.targetSnapshot,Mt.currentRouterState);return{...Mt,targetRouterState:cn}}),it(Mt=>{this.currentUrlTree=Mt.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(Mt.urlAfterRedirects,Mt.rawUrl),this.routerState=Mt.targetRouterState,"deferred"===this.urlUpdateStrategy&&(Mt.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,Mt),this.browserUrlTree=Mt.urlAfterRedirects)}),((z,O,P)=>(0,Qt.U)(G=>(new ls(O,G.targetRouterState,G.currentRouterState,P).activate(z),G)))(this.rootContexts,this.routeReuseStrategy,Mt=>this.triggerEvent(Mt)),it({next(){Se=!0},complete(){Se=!0}}),function Ot(z){return(0,We.e)((O,P)=>{try{O.subscribe(P)}finally{P.add(z)}})}(()=>{Se||ft||this.cancelNavigationTransition(oe,`Navigation ID ${oe.id} is not equal to the current navigation id ${this.navigationId}`),this.currentNavigation?.id===oe.id&&(this.currentNavigation=null)}),Yt(Mt=>{if(ft=!0,function _r(z){return z&&z[Qi]}(Mt)){const cn=yo(Mt.url);cn||(this.navigated=!0,this.restoreHistory(oe,!0));const ni=new Ui(oe.id,this.serializeUrl(oe.extractedUrl),Mt.message);G.next(ni),cn?setTimeout(()=>{const or=this.urlHandlingStrategy.merge(Mt.url,this.rawUrlTree),Mi={skipLocationChange:oe.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Ya(oe.source)};this.scheduleNavigation(or,"imperative",null,Mi,{resolve:oe.resolve,reject:oe.reject,promise:oe.promise})},0):oe.resolve(!1)}else{this.restoreHistory(oe,!0);const cn=new Xi(oe.id,this.serializeUrl(oe.extractedUrl),Mt);G.next(cn);try{oe.resolve(this.errorHandler(Mt))}catch(ni){oe.reject(ni)}}return tt.E}))}))}resetRootComponentType(P){this.rootComponentType=P,this.routerState.root.component=this.rootComponentType}setTransition(P){this.transitions.next({...this.transitions.value,...P})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(P=>{const G="popstate"===P.type?"popstate":"hashchange";"popstate"===G&&setTimeout(()=>{const oe={replaceUrl:!0},Se=P.state?.navigationId?P.state:null;if(Se){const Mt={...Se};delete Mt.navigationId,delete Mt.\u0275routerPageId,0!==Object.keys(Mt).length&&(oe.state=Mt)}const ft=this.parseUrl(P.url);this.scheduleNavigation(ft,G,Se,oe)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(P){this.events.next(P)}resetConfig(P){Y(P),this.config=P.map(Fe),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(P,G={}){const{relativeTo:oe,queryParams:Se,fragment:ft,queryParamsHandling:Mt,preserveFragment:cn}=G,ni=oe||this.routerState.root,or=cn?this.currentUrlTree.fragment:ft;let Mi=null;switch(Mt){case"merge":Mi={...this.currentUrlTree.queryParams,...Se};break;case"preserve":Mi=this.currentUrlTree.queryParams;break;default:Mi=Se||null}return null!==Mi&&(Mi=this.removeEmptyProps(Mi)),function os(z,O,P,G,oe){if(0===P.length)return Xo(O.root,O.root,O.root,G,oe);const Se=function xt(z){if("string"==typeof z[0]&&1===z.length&&"/"===z[0])return new pt(!0,0,z);let O=0,P=!1;const G=z.reduce((oe,Se,ft)=>{if("object"==typeof Se&&null!=Se){if(Se.outlets){const Mt={};return ar(Se.outlets,(cn,ni)=>{Mt[ni]="string"==typeof cn?cn.split("/"):cn}),[...oe,{outlets:Mt}]}if(Se.segmentPath)return[...oe,Se.segmentPath]}return"string"!=typeof Se?[...oe,Se]:0===ft?(Se.split("/").forEach((Mt,cn)=>{0==cn&&"."===Mt||(0==cn&&""===Mt?P=!0:".."===Mt?O++:""!=Mt&&oe.push(Mt))}),oe):[...oe,Se]},[]);return new pt(P,O,G)}(P);if(Se.toRoot())return Xo(O.root,O.root,new yn([],{}),G,oe);const ft=function Ft(z,O,P){if(z.isAbsolute)return new Le(O.root,!0,0);if(-1===P.snapshot._lastPathIndex){const Se=P.snapshot._urlSegment;return new Le(Se,Se===O.root,0)}const G=ss(z.commands[0])?0:1;return function fn(z,O,P){let G=z,oe=O,Se=P;for(;Se>oe;){if(Se-=oe,G=G.parent,!G)throw new Error("Invalid number of '../'");oe=G.segments.length}return new Le(G,!1,oe-Se)}(P.snapshot._urlSegment,P.snapshot._lastPathIndex+G,z.numberOfDoubleDots)}(Se,O,z),Mt=ft.processChildren?Zr(ft.segmentGroup,ft.index,Se.commands):Ji(ft.segmentGroup,ft.index,Se.commands);return Xo(O.root,ft.segmentGroup,Mt,G,oe)}(ni,this.currentUrlTree,P,Mi,or??null)}navigateByUrl(P,G={skipLocationChange:!1}){const oe=yo(P)?P:this.parseUrl(P),Se=this.urlHandlingStrategy.merge(oe,this.rawUrlTree);return this.scheduleNavigation(Se,"imperative",null,G)}navigate(P,G={skipLocationChange:!1}){return function Wa(z){for(let O=0;O<z.length;O++){const P=z[O];if(null==P)throw new Error(`The requested path contains ${P} segment at index ${O}`)}}(P),this.navigateByUrl(this.createUrlTree(P,G),G)}serializeUrl(P){return this.urlSerializer.serialize(P)}parseUrl(P){let G;try{G=this.urlSerializer.parse(P)}catch(oe){G=this.malformedUriErrorHandler(oe,this.urlSerializer,P)}return G}isActive(P,G){let oe;if(oe=!0===G?{...Vl}:!1===G?{...va}:G,yo(P))return N(this.currentUrlTree,P,oe);const Se=this.parseUrl(P);return N(this.currentUrlTree,Se,oe)}removeEmptyProps(P){return Object.keys(P).reduce((G,oe)=>{const Se=P[oe];return null!=Se&&(G[oe]=Se),G},{})}processNavigations(){this.navigations.subscribe(P=>{this.navigated=!0,this.lastSuccessfulId=P.id,this.currentPageId=P.targetPageId,this.events.next(new yi(P.id,this.serializeUrl(P.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,P.resolve(!0)},P=>{this.console.warn(`Unhandled Navigation Error: ${P}`)})}scheduleNavigation(P,G,oe,Se,ft){if(this.disposed)return Promise.resolve(!1);let Mt,cn,ni;ft?(Mt=ft.resolve,cn=ft.reject,ni=ft.promise):ni=new Promise((Tr,Ur)=>{Mt=Tr,cn=Ur});const or=++this.navigationId;let Mi;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(oe=this.location.getState()),Mi=oe&&oe.\u0275routerPageId?oe.\u0275routerPageId:Se.replaceUrl||Se.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):Mi=0,this.setTransition({id:or,targetPageId:Mi,source:G,restoredState:oe,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:P,extras:Se,resolve:Mt,reject:cn,promise:ni,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),ni.catch(Tr=>Promise.reject(Tr))}setBrowserUrl(P,G){const oe=this.urlSerializer.serialize(P),Se={...G.extras.state,...this.generateNgRouterState(G.id,G.targetPageId)};this.location.isCurrentPathEqualTo(oe)||G.extras.replaceUrl?this.location.replaceState(oe,"",Se):this.location.go(oe,"",Se)}restoreHistory(P,G=!1){if("computed"===this.canceledNavigationResolution){const oe=this.currentPageId-P.targetPageId;"popstate"!==P.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===oe?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===oe&&(this.resetState(P),this.browserUrlTree=P.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(oe)}else"replace"===this.canceledNavigationResolution&&(G&&this.resetState(P),this.resetUrlToCurrentUrlTree())}resetState(P){this.routerState=P.currentRouterState,this.currentUrlTree=P.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,P.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(P,G){const oe=new Ui(P.id,this.serializeUrl(P.extractedUrl),G);this.triggerEvent(oe),P.resolve(!1)}generateNgRouterState(P,G){return"computed"===this.canceledNavigationResolution?{navigationId:P,\u0275routerPageId:G}:{navigationId:P}}}return z.\u0275fac=function(P){m.$Z()},z.\u0275prov=m.Yz7({token:z,factory:z.\u0275fac}),z})();function Ya(z){return"imperative"!==z}let aa=(()=>{class z{constructor(P,G,oe,Se,ft){this.router=P,this.route=G,this.tabIndexAttribute=oe,this.renderer=Se,this.el=ft,this.commands=null,this.onChanges=new ye.x,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(P){if(null!=this.tabIndexAttribute)return;const G=this.renderer,oe=this.el.nativeElement;null!==P?G.setAttribute(oe,"tabindex",P):G.removeAttribute(oe,"tabindex")}ngOnChanges(P){this.onChanges.next(this)}set routerLink(P){null!=P?(this.commands=Array.isArray(P)?P:[P],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const P={skipLocationChange:es(this.skipLocationChange),replaceUrl:es(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,P),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:es(this.preserveFragment)})}}return z.\u0275fac=function(P){return new(P||z)(m.Y36(xo),m.Y36(kt),m.$8M("tabindex"),m.Y36(m.Qsj),m.Y36(m.SBq))},z.\u0275dir=m.lG2({type:z,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(P,G){1&P&&m.NdJ("click",function(){return G.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[m.TTD]}),z})();function es(z){return""===z||!!z}class jl{}class Ms{preload(O,P){return(0,me.of)(null)}}let mc=(()=>{class z{constructor(P,G,oe,Se){this.router=P,this.injector=oe,this.preloadingStrategy=Se,this.loader=new kr(oe,G,cn=>P.triggerEvent(new on(cn)),cn=>P.triggerEvent(new It(cn)))}setUpPreloading(){this.subscription=this.router.events.pipe((0,xn.h)(P=>P instanceof yi),(0,Tn.b)(()=>this.preload())).subscribe(()=>{})}preload(){const P=this.injector.get(m.h0i);return this.processRoutes(P,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(P,G){const oe=[];for(const Se of G)if(Se.loadChildren&&!Se.canLoad&&Se._loadedConfig){const ft=Se._loadedConfig;oe.push(this.processRoutes(ft.module,ft.routes))}else Se.loadChildren&&!Se.canLoad?oe.push(this.preloadConfig(P,Se)):Se.children&&oe.push(this.processRoutes(P,Se.children));return(0,ie.D)(oe).pipe((0,lt.J)(),(0,Qt.U)(Se=>{}))}preloadConfig(P,G){return this.preloadingStrategy.preload(G,()=>(G._loadedConfig?(0,me.of)(G._loadedConfig):this.loader.load(P.injector,G)).pipe((0,mn.z)(Se=>(G._loadedConfig=Se,this.processRoutes(Se.module,Se.routes)))))}}return z.\u0275fac=function(P){return new(P||z)(m.LFG(xo),m.LFG(m.Sil),m.LFG(m.zs3),m.LFG(jl))},z.\u0275prov=m.Yz7({token:z,factory:z.\u0275fac}),z})(),Zl=(()=>{class z{constructor(P,G,oe={}){this.router=P,this.viewportScroller=G,this.options=oe,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},oe.scrollPositionRestoration=oe.scrollPositionRestoration||"disabled",oe.anchorScrolling=oe.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(P=>{P instanceof En?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=P.navigationTrigger,this.restoredId=P.restoredState?P.restoredState.navigationId:0):P instanceof yi&&(this.lastId=P.id,this.scheduleScrollEvent(P,this.router.parseUrl(P.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(P=>{P instanceof Je&&(P.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(P.position):P.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(P.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(P,G){this.router.triggerEvent(new Je(P,"popstate"===this.lastSource?this.store[this.restoredId]:null,G))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return z.\u0275fac=function(P){m.$Z()},z.\u0275prov=m.Yz7({token:z,factory:z.\u0275fac}),z})();const Ma=new m.OlP("ROUTER_CONFIGURATION"),Xa=new m.OlP("ROUTER_FORROOT_GUARD"),Ka=[d.Ye,{provide:Xn,useClass:Ut},{provide:xo,useFactory:function Aa(z,O,P,G,oe,Se,ft={},Mt,cn){const ni=new xo(null,z,O,P,G,oe,$i(Se));return Mt&&(ni.urlHandlingStrategy=Mt),cn&&(ni.routeReuseStrategy=cn),function Ys(z,O){z.errorHandler&&(O.errorHandler=z.errorHandler),z.malformedUriErrorHandler&&(O.malformedUriErrorHandler=z.malformedUriErrorHandler),z.onSameUrlNavigation&&(O.onSameUrlNavigation=z.onSameUrlNavigation),z.paramsInheritanceStrategy&&(O.paramsInheritanceStrategy=z.paramsInheritanceStrategy),z.relativeLinkResolution&&(O.relativeLinkResolution=z.relativeLinkResolution),z.urlUpdateStrategy&&(O.urlUpdateStrategy=z.urlUpdateStrategy),z.canceledNavigationResolution&&(O.canceledNavigationResolution=z.canceledNavigationResolution)}(ft,ni),ft.enableTracing&&ni.events.subscribe(or=>{console.group?.(`Router Event: ${or.constructor.name}`),console.log(or.toString()),console.log(or),console.groupEnd?.()}),ni},deps:[Xn,Po,d.Ye,m.zs3,m.Sil,Fo,Ma,[class fc{},new m.FiY],[Da,new m.FiY]]},Po,{provide:kt,useFactory:function ys(z){return z.routerState.root},deps:[xo]},mc,Ms,class Ja{preload(O,P){return P().pipe(Yt(()=>(0,me.of)(null)))}},{provide:Ma,useValue:{enableTracing:!1}}];function bo(){return new m.PXZ("Router",xo)}let $o=(()=>{class z{constructor(P,G){}static forRoot(P,G){return{ngModule:z,providers:[Ka,Ws(P),{provide:Xa,useFactory:el,deps:[[xo,new m.FiY,new m.tp0]]},{provide:Ma,useValue:G||{}},{provide:d.S$,useFactory:Hc,deps:[d.lw,[new m.tBr(d.mr),new m.FiY],Ma]},{provide:Zl,useFactory:Qa,deps:[xo,d.EM,Ma]},{provide:jl,useExisting:G&&G.preloadingStrategy?G.preloadingStrategy:Ms},{provide:m.PXZ,multi:!0,useFactory:bo},[Sa,{provide:m.ip1,multi:!0,useFactory:ti,deps:[Sa]},{provide:_l,useFactory:gc,deps:[Sa]},{provide:m.tb,multi:!0,useExisting:_l}]]}}static forChild(P){return{ngModule:z,providers:[Ws(P)]}}}return z.\u0275fac=function(P){return new(P||z)(m.LFG(Xa,8),m.LFG(xo,8))},z.\u0275mod=m.oAB({type:z}),z.\u0275inj=m.cJS({}),z})();function Qa(z,O,P){return P.scrollOffset&&O.setOffset(P.scrollOffset),new Zl(z,O,P)}function Hc(z,O,P={}){return P.useHash?new d.Do(z,O):new d.b0(z,O)}function el(z){return"guarded"}function Ws(z){return[{provide:m.deG,multi:!0,useValue:z},{provide:Fo,multi:!0,useValue:z}]}let Sa=(()=>{class z{constructor(P){this.injector=P,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new ye.x}appInitializer(){return this.injector.get(d.V_,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let G=null;const oe=new Promise(Mt=>G=Mt),Se=this.injector.get(xo),ft=this.injector.get(Ma);return"disabled"===ft.initialNavigation?(Se.setUpLocationChangeListener(),G(!0)):"enabled"===ft.initialNavigation||"enabledBlocking"===ft.initialNavigation?(Se.hooks.afterPreactivation=()=>this.initNavigation?(0,me.of)(null):(this.initNavigation=!0,G(!0),this.resultOfPreactivationDone),Se.initialNavigation()):G(!0),oe})}bootstrapListener(P){const G=this.injector.get(Ma),oe=this.injector.get(mc),Se=this.injector.get(Zl),ft=this.injector.get(xo),Mt=this.injector.get(m.z2F);P===Mt.components[0]&&(("enabledNonBlocking"===G.initialNavigation||void 0===G.initialNavigation)&&ft.initialNavigation(),oe.setUpPreloading(),Se.init(),ft.resetRootComponentType(Mt.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return z.\u0275fac=function(P){return new(P||z)(m.LFG(m.zs3))},z.\u0275prov=m.Yz7({token:z,factory:z.\u0275fac}),z})();function ti(z){return z.appInitializer.bind(z)}function gc(z){return z.bootstrapListener.bind(z)}const _l=new m.OlP("Router Initializer")},4463:(Ln,At,k)=>{"use strict";k.d(At,{Zw:()=>ke,aw:()=>Dt,X$:()=>Bt,sK:()=>Ht});var d=k(8274),m=k(8306),ce=k(576);function l(ht){return!!ht&&(ht instanceof m.y||(0,ce.m)(ht.lift)&&(0,ce.m)(ht.subscribe))}var ie=k(9646),re=k(4128),v=k(7272),ne=k(9770),De=k(7579),ge=k(6063);class X extends De.x{constructor(Lt=1/0,_e=1/0,it=ge.l){super(),this._bufferSize=Lt,this._windowTime=_e,this._timestampProvider=it,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=_e===1/0,this._bufferSize=Math.max(1,Lt),this._windowTime=Math.max(1,_e)}next(Lt){const{isStopped:_e,_buffer:it,_infiniteTimeWindow:Ot,_timestampProvider:Qt,_windowTime:_n}=this;_e||(it.push(Lt),!Ot&&it.push(Qt.now()+_n)),this._trimBuffer(),super.next(Lt)}_subscribe(Lt){this._throwIfClosed(),this._trimBuffer();const _e=this._innerSubscribe(Lt),{_infiniteTimeWindow:it,_buffer:Ot}=this,Qt=Ot.slice();for(let _n=0;_n<Qt.length&&!Lt.closed;_n+=it?1:2)Lt.next(Qt[_n]);return this._checkFinalizedStatuses(Lt),_e}_trimBuffer(){const{_bufferSize:Lt,_timestampProvider:_e,_buffer:it,_infiniteTimeWindow:Ot}=this,Qt=(Ot?1:2)*Lt;if(Lt<1/0&&Qt<it.length&&it.splice(0,it.length-Qt),!Ot){const _n=_e.now();let Tn=0;for(let mn=1;mn<it.length&&it[mn]<=_n;mn+=2)Tn=mn;Tn&&it.splice(0,Tn+1)}}}var ue=k(3099);function se(ht,Lt,_e){let it,Ot=!1;return ht&&"object"==typeof ht?({bufferSize:it=1/0,windowTime:Lt=1/0,refCount:Ot=!1,scheduler:_e}=ht):it=ht??1/0,(0,ue.B)({connector:()=>new X(it,Lt,_e),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:Ot})}var Ie=k(5698),we=k(4004),Ue=k(4351),Ne=k(3900);class ke{}let He=(()=>{class ht extends ke{getTranslation(_e){return(0,ie.of)({})}}return ht.\u0275fac=function(){let Lt;return function(it){return(Lt||(Lt=d.n5z(ht)))(it||ht)}}(),ht.\u0275prov=d.Yz7({token:ht,factory:ht.\u0275fac}),ht})();class We{}let Qe=(()=>{class ht{handle(_e){return _e.key}}return ht.\u0275fac=function(_e){return new(_e||ht)},ht.\u0275prov=d.Yz7({token:ht,factory:ht.\u0275fac}),ht})();function ve(ht,Lt){if(ht===Lt)return!0;if(null===ht||null===Lt)return!1;if(ht!=ht&&Lt!=Lt)return!0;let Ot,Qt,_n,_e=typeof ht;if(_e==typeof Lt&&"object"==_e){if(!Array.isArray(ht)){if(Array.isArray(Lt))return!1;for(Qt in _n=Object.create(null),ht){if(!ve(ht[Qt],Lt[Qt]))return!1;_n[Qt]=!0}for(Qt in Lt)if(!(Qt in _n)&&typeof Lt[Qt]<"u")return!1;return!0}if(!Array.isArray(Lt))return!1;if((Ot=ht.length)==Lt.length){for(Qt=0;Qt<Ot;Qt++)if(!ve(ht[Qt],Lt[Qt]))return!1;return!0}}return!1}function me(ht){return typeof ht<"u"&&null!==ht}function Ze(ht){return ht&&"object"==typeof ht&&!Array.isArray(ht)}function Pe(ht,Lt){let _e=Object.assign({},ht);return Ze(ht)&&Ze(Lt)&&Object.keys(Lt).forEach(it=>{Ze(Lt[it])?it in ht?_e[it]=Pe(ht[it],Lt[it]):Object.assign(_e,{[it]:Lt[it]}):Object.assign(_e,{[it]:Lt[it]})}),_e}class Ge{}let tt=(()=>{class ht extends Ge{constructor(){super(...arguments),this.templateMatcher=/{{\s?([^{}\s]*)\s?}}/g}interpolate(_e,it){let Ot;return Ot="string"==typeof _e?this.interpolateString(_e,it):"function"==typeof _e?this.interpolateFunction(_e,it):_e,Ot}getValue(_e,it){let Ot="string"==typeof it?it.split("."):[it];it="";do{it+=Ot.shift(),!me(_e)||!me(_e[it])||"object"!=typeof _e[it]&&Ot.length?Ot.length?it+=".":_e=void 0:(_e=_e[it],it="")}while(Ot.length);return _e}interpolateFunction(_e,it){return _e(it)}interpolateString(_e,it){return it?_e.replace(this.templateMatcher,(Ot,Qt)=>{let _n=this.getValue(it,Qt);return me(_n)?_n:Ot}):_e}}return ht.\u0275fac=function(){let Lt;return function(it){return(Lt||(Lt=d.n5z(ht)))(it||ht)}}(),ht.\u0275prov=d.Yz7({token:ht,factory:ht.\u0275fac}),ht})();class ye{}let Ae=(()=>{class ht extends ye{compile(_e,it){return _e}compileTranslations(_e,it){return _e}}return ht.\u0275fac=function(){let Lt;return function(it){return(Lt||(Lt=d.n5z(ht)))(it||ht)}}(),ht.\u0275prov=d.Yz7({token:ht,factory:ht.\u0275fac}),ht})();class Be{constructor(){this.currentLang=this.defaultLang,this.translations={},this.langs=[],this.onTranslationChange=new d.vpe,this.onLangChange=new d.vpe,this.onDefaultLangChange=new d.vpe}}const st=new d.OlP("USE_STORE"),_t=new d.OlP("USE_DEFAULT_LANG"),Yt=new d.OlP("DEFAULT_LANGUAGE"),xn=new d.OlP("USE_EXTEND");let Ht=(()=>{class ht{constructor(_e,it,Ot,Qt,_n,Tn=!0,mn=!1,lt=!1,qt){this.store=_e,this.currentLoader=it,this.compiler=Ot,this.parser=Qt,this.missingTranslationHandler=_n,this.useDefaultLang=Tn,this.isolate=mn,this.extend=lt,this.pending=!1,this._onTranslationChange=new d.vpe,this._onLangChange=new d.vpe,this._onDefaultLangChange=new d.vpe,this._langs=[],this._translations={},this._translationRequests={},qt&&this.setDefaultLang(qt)}get onTranslationChange(){return this.isolate?this._onTranslationChange:this.store.onTranslationChange}get onLangChange(){return this.isolate?this._onLangChange:this.store.onLangChange}get onDefaultLangChange(){return this.isolate?this._onDefaultLangChange:this.store.onDefaultLangChange}get defaultLang(){return this.isolate?this._defaultLang:this.store.defaultLang}set defaultLang(_e){this.isolate?this._defaultLang=_e:this.store.defaultLang=_e}get currentLang(){return this.isolate?this._currentLang:this.store.currentLang}set currentLang(_e){this.isolate?this._currentLang=_e:this.store.currentLang=_e}get langs(){return this.isolate?this._langs:this.store.langs}set langs(_e){this.isolate?this._langs=_e:this.store.langs=_e}get translations(){return this.isolate?this._translations:this.store.translations}set translations(_e){this.isolate?this._translations=_e:this.store.translations=_e}setDefaultLang(_e){if(_e===this.defaultLang)return;let it=this.retrieveTranslations(_e);typeof it<"u"?(null==this.defaultLang&&(this.defaultLang=_e),it.pipe((0,Ie.q)(1)).subscribe(Ot=>{this.changeDefaultLang(_e)})):this.changeDefaultLang(_e)}getDefaultLang(){return this.defaultLang}use(_e){if(_e===this.currentLang)return(0,ie.of)(this.translations[_e]);let it=this.retrieveTranslations(_e);return typeof it<"u"?(this.currentLang||(this.currentLang=_e),it.pipe((0,Ie.q)(1)).subscribe(Ot=>{this.changeLang(_e)}),it):(this.changeLang(_e),(0,ie.of)(this.translations[_e]))}retrieveTranslations(_e){let it;return(typeof this.translations[_e]>"u"||this.extend)&&(this._translationRequests[_e]=this._translationRequests[_e]||this.getTranslation(_e),it=this._translationRequests[_e]),it}getTranslation(_e){this.pending=!0;const it=this.currentLoader.getTranslation(_e).pipe(se(1),(0,Ie.q)(1));return this.loadingTranslations=it.pipe((0,we.U)(Ot=>this.compiler.compileTranslations(Ot,_e)),se(1),(0,Ie.q)(1)),this.loadingTranslations.subscribe({next:Ot=>{this.translations[_e]=this.extend&&this.translations[_e]?{...Ot,...this.translations[_e]}:Ot,this.updateLangs(),this.pending=!1},error:Ot=>{this.pending=!1}}),it}setTranslation(_e,it,Ot=!1){it=this.compiler.compileTranslations(it,_e),this.translations[_e]=(Ot||this.extend)&&this.translations[_e]?Pe(this.translations[_e],it):it,this.updateLangs(),this.onTranslationChange.emit({lang:_e,translations:this.translations[_e]})}getLangs(){return this.langs}addLangs(_e){_e.forEach(it=>{-1===this.langs.indexOf(it)&&this.langs.push(it)})}updateLangs(){this.addLangs(Object.keys(this.translations))}getParsedResult(_e,it,Ot){let Qt;if(it instanceof Array){let _n={},Tn=!1;for(let mn of it)_n[mn]=this.getParsedResult(_e,mn,Ot),l(_n[mn])&&(Tn=!0);if(Tn){const mn=it.map(lt=>l(_n[lt])?_n[lt]:(0,ie.of)(_n[lt]));return(0,re.D)(mn).pipe((0,we.U)(lt=>{let qt={};return lt.forEach((En,yi)=>{qt[it[yi]]=En}),qt}))}return _n}if(_e&&(Qt=this.parser.interpolate(this.parser.getValue(_e,it),Ot)),typeof Qt>"u"&&null!=this.defaultLang&&this.defaultLang!==this.currentLang&&this.useDefaultLang&&(Qt=this.parser.interpolate(this.parser.getValue(this.translations[this.defaultLang],it),Ot)),typeof Qt>"u"){let _n={key:it,translateService:this};typeof Ot<"u"&&(_n.interpolateParams=Ot),Qt=this.missingTranslationHandler.handle(_n)}return typeof Qt<"u"?Qt:it}get(_e,it){if(!me(_e)||!_e.length)throw new Error('Parameter "key" required');if(this.pending)return this.loadingTranslations.pipe((0,Ue.b)(Ot=>l(Ot=this.getParsedResult(Ot,_e,it))?Ot:(0,ie.of)(Ot)));{let Ot=this.getParsedResult(this.translations[this.currentLang],_e,it);return l(Ot)?Ot:(0,ie.of)(Ot)}}getStreamOnTranslationChange(_e,it){if(!me(_e)||!_e.length)throw new Error('Parameter "key" required');return(0,v.z)((0,ne.P)(()=>this.get(_e,it)),this.onTranslationChange.pipe((0,Ne.w)(Ot=>{const Qt=this.getParsedResult(Ot.translations,_e,it);return"function"==typeof Qt.subscribe?Qt:(0,ie.of)(Qt)})))}stream(_e,it){if(!me(_e)||!_e.length)throw new Error('Parameter "key" required');return(0,v.z)((0,ne.P)(()=>this.get(_e,it)),this.onLangChange.pipe((0,Ne.w)(Ot=>{const Qt=this.getParsedResult(Ot.translations,_e,it);return l(Qt)?Qt:(0,ie.of)(Qt)})))}instant(_e,it){if(!me(_e)||!_e.length)throw new Error('Parameter "key" required');let Ot=this.getParsedResult(this.translations[this.currentLang],_e,it);if(l(Ot)){if(_e instanceof Array){let Qt={};return _e.forEach((_n,Tn)=>{Qt[_e[Tn]]=_e[Tn]}),Qt}return _e}return Ot}set(_e,it,Ot=this.currentLang){this.translations[Ot][_e]=this.compiler.compile(it,Ot),this.updateLangs(),this.onTranslationChange.emit({lang:Ot,translations:this.translations[Ot]})}changeLang(_e){this.currentLang=_e,this.onLangChange.emit({lang:_e,translations:this.translations[_e]}),null==this.defaultLang&&this.changeDefaultLang(_e)}changeDefaultLang(_e){this.defaultLang=_e,this.onDefaultLangChange.emit({lang:_e,translations:this.translations[_e]})}reloadLang(_e){return this.resetLang(_e),this.getTranslation(_e)}resetLang(_e){this._translationRequests[_e]=void 0,this.translations[_e]=void 0}getBrowserLang(){if(typeof window>"u"||typeof window.navigator>"u")return;let _e=window.navigator.languages?window.navigator.languages[0]:null;return _e=_e||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,typeof _e>"u"?void 0:(-1!==_e.indexOf("-")&&(_e=_e.split("-")[0]),-1!==_e.indexOf("_")&&(_e=_e.split("_")[0]),_e)}getBrowserCultureLang(){if(typeof window>"u"||typeof window.navigator>"u")return;let _e=window.navigator.languages?window.navigator.languages[0]:null;return _e=_e||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,_e}}return ht.\u0275fac=function(_e){return new(_e||ht)(d.LFG(Be),d.LFG(ke),d.LFG(ye),d.LFG(Ge),d.LFG(We),d.LFG(_t),d.LFG(st),d.LFG(xn),d.LFG(Yt))},ht.\u0275prov=d.Yz7({token:ht,factory:ht.\u0275fac}),ht})(),Bt=(()=>{class ht{constructor(_e,it){this.translate=_e,this._ref=it,this.value="",this.lastKey=null,this.lastParams=[]}updateValue(_e,it,Ot){let Qt=_n=>{this.value=void 0!==_n?_n:_e,this.lastKey=_e,this._ref.markForCheck()};if(Ot){let _n=this.translate.getParsedResult(Ot,_e,it);l(_n.subscribe)?_n.subscribe(Qt):Qt(_n)}this.translate.get(_e,it).subscribe(Qt)}transform(_e,...it){if(!_e||!_e.length)return _e;if(ve(_e,this.lastKey)&&ve(it,this.lastParams))return this.value;let Ot;if(me(it[0])&&it.length)if("string"==typeof it[0]&&it[0].length){let Qt=it[0].replace(/(\')?([a-zA-Z0-9_]+)(\')?(\s)?:/g,'"$2":').replace(/:(\s)?(\')(.*?)(\')/g,':"$3"');try{Ot=JSON.parse(Qt)}catch{throw new SyntaxError(`Wrong parameter in TranslatePipe. Expected a valid Object, received: ${it[0]}`)}}else"object"==typeof it[0]&&!Array.isArray(it[0])&&(Ot=it[0]);return this.lastKey=_e,this.lastParams=it,this.updateValue(_e,Ot),this._dispose(),this.onTranslationChange||(this.onTranslationChange=this.translate.onTranslationChange.subscribe(Qt=>{this.lastKey&&Qt.lang===this.translate.currentLang&&(this.lastKey=null,this.updateValue(_e,Ot,Qt.translations))})),this.onLangChange||(this.onLangChange=this.translate.onLangChange.subscribe(Qt=>{this.lastKey&&(this.lastKey=null,this.updateValue(_e,Ot,Qt.translations))})),this.onDefaultLangChange||(this.onDefaultLangChange=this.translate.onDefaultLangChange.subscribe(()=>{this.lastKey&&(this.lastKey=null,this.updateValue(_e,Ot))})),this.value}_dispose(){typeof this.onTranslationChange<"u"&&(this.onTranslationChange.unsubscribe(),this.onTranslationChange=void 0),typeof this.onLangChange<"u"&&(this.onLangChange.unsubscribe(),this.onLangChange=void 0),typeof this.onDefaultLangChange<"u"&&(this.onDefaultLangChange.unsubscribe(),this.onDefaultLangChange=void 0)}ngOnDestroy(){this._dispose()}}return ht.\u0275fac=function(_e){return new(_e||ht)(d.Y36(Ht,16),d.Y36(d.sBO,16))},ht.\u0275pipe=d.Yjl({name:"translate",type:ht,pure:!1}),ht.\u0275prov=d.Yz7({token:ht,factory:ht.\u0275fac}),ht})(),Dt=(()=>{class ht{static forRoot(_e={}){return{ngModule:ht,providers:[_e.loader||{provide:ke,useClass:He},_e.compiler||{provide:ye,useClass:Ae},_e.parser||{provide:Ge,useClass:tt},_e.missingTranslationHandler||{provide:We,useClass:Qe},Be,{provide:st,useValue:_e.isolate},{provide:_t,useValue:_e.useDefaultLang},{provide:xn,useValue:_e.extend},{provide:Yt,useValue:_e.defaultLanguage},Ht]}}static forChild(_e={}){return{ngModule:ht,providers:[_e.loader||{provide:ke,useClass:He},_e.compiler||{provide:ye,useClass:Ae},_e.parser||{provide:Ge,useClass:tt},_e.missingTranslationHandler||{provide:We,useClass:Qe},{provide:st,useValue:_e.isolate},{provide:_t,useValue:_e.useDefaultLang},{provide:xn,useValue:_e.extend},{provide:Yt,useValue:_e.defaultLanguage},Ht]}}}return ht.\u0275fac=function(_e){return new(_e||ht)},ht.\u0275mod=d.oAB({type:ht}),ht.\u0275inj=d.cJS({}),ht})()}},Ln=>{Ln(Ln.s=3592)}]);