(self.webpackChunkapp=self.webpackChunkapp||[]).push([[179],{3175:(Pn,Et,k)=>{"use strict";k.d(Et,{Ar:()=>xe,N0:()=>Me});var d=k(8274),y=k(6895),te=k(4004),l=k(5577),q=k(9770),re=k(9646),b=k(529);const he=new d.OlP("JWT_OPTIONS");let Me=(()=>{class fe{constructor(le=null){this.tokenGetter=le&&le.tokenGetter||function(){}}urlBase64Decode(le){let Ke=le.replace(/-/g,"+").replace(/_/g,"/");switch(Ke.length%4){case 0:break;case 2:Ke+="==";break;case 3:Ke+="=";break;default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(Ke)}b64decode(le){let Oe="";if((le=String(le).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let Ye,St,Q=0,lt=0;St=le.charAt(lt++);~St&&(Ye=Q%4?64*Ye+St:St,Q++%4)?Oe+=String.fromCharCode(255&Ye>>(-2*Q&6)):0)St="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(St);return Oe}b64DecodeUnicode(le){return decodeURIComponent(Array.prototype.map.call(this.b64decode(le),Ke=>"%"+("00"+Ke.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(le=this.tokenGetter()){return le instanceof Promise?le.then(Ke=>this._decodeToken(Ke)):this._decodeToken(le)}_decodeToken(le){if(!le||""===le)return null;const Ke=le.split(".");if(3!==Ke.length)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");const Oe=this.urlBase64Decode(Ke[1]);if(!Oe)throw new Error("Cannot decode the token.");return JSON.parse(Oe)}getTokenExpirationDate(le=this.tokenGetter()){return le instanceof Promise?le.then(Ke=>this._getTokenExpirationDate(Ke)):this._getTokenExpirationDate(le)}_getTokenExpirationDate(le){let Ke;if(Ke=this.decodeToken(le),!Ke||!Ke.hasOwnProperty("exp"))return null;const Oe=new Date(0);return Oe.setUTCSeconds(Ke.exp),Oe}isTokenExpired(le=this.tokenGetter(),Ke){return le instanceof Promise?le.then(Oe=>this._isTokenExpired(Oe,Ke)):this._isTokenExpired(le,Ke)}_isTokenExpired(le,Ke){if(!le||""===le)return!0;const Oe=this.getTokenExpirationDate(le);return Ke=Ke||0,null!==Oe&&!(Oe.valueOf()>(new Date).valueOf()+1e3*Ke)}getAuthScheme(le,Ke){return"function"==typeof le?le(Ke):le}}return fe.\u0275fac=function(le){return new(le||fe)(d.LFG(he))},fe.\u0275prov=d.Yz7({token:fe,factory:fe.\u0275fac}),fe})();const Ve=fe=>fe instanceof Promise?(0,q.P)(()=>fe):(0,re.of)(fe);let X=(()=>{class fe{constructor(le,Ke,Oe){this.jwtHelper=Ke,this.document=Oe,this.standardPorts=["80","443"],this.tokenGetter=le.tokenGetter,this.headerName=le.headerName||"Authorization",this.authScheme=le.authScheme||""===le.authScheme?le.authScheme:"Bearer ",this.allowedDomains=le.allowedDomains||[],this.disallowedRoutes=le.disallowedRoutes||[],this.throwNoTokenError=le.throwNoTokenError||!1,this.skipWhenExpired=le.skipWhenExpired}isAllowedDomain(le){const Ke=new URL(le.url,this.document.location.origin);if(Ke.host===this.document.location.host)return!0;const Oe=`${Ke.hostname}${Ke.port&&!this.standardPorts.includes(Ke.port)?":"+Ke.port:""}`;return this.allowedDomains.findIndex(Q=>"string"==typeof Q?Q===Oe:Q instanceof RegExp&&Q.test(Oe))>-1}isDisallowedRoute(le){const Ke=new URL(le.url,this.document.location.origin);return this.disallowedRoutes.findIndex(Oe=>{if("string"==typeof Oe){const Q=new URL(Oe,this.document.location.origin);return Q.hostname===Ke.hostname&&Q.pathname===Ke.pathname}return Oe instanceof RegExp&&Oe.test(le.url)})>-1}handleInterception(le,Ke,Oe){const Q=this.jwtHelper.getAuthScheme(this.authScheme,Ke);if(!le&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");let Ye=(0,re.of)(!1);return this.skipWhenExpired&&(Ye=le?Ve(this.jwtHelper.isTokenExpired(le)):(0,re.of)(!0)),le?Ye.pipe((0,te.U)(St=>St&&this.skipWhenExpired?Ke.clone():Ke.clone({setHeaders:{[this.headerName]:`${Q}${le}`}})),(0,l.z)(St=>Oe.handle(St))):Oe.handle(Ke)}intercept(le,Ke){if(!this.isAllowedDomain(le)||this.isDisallowedRoute(le))return Ke.handle(le);const Oe=this.tokenGetter(le);return Ve(Oe).pipe((0,l.z)(Q=>this.handleInterception(Q,le,Ke)))}}return fe.\u0275fac=function(le){return new(le||fe)(d.LFG(he),d.LFG(Me),d.LFG(y.K0))},fe.\u0275prov=d.Yz7({token:fe,factory:fe.\u0275fac}),fe})(),xe=(()=>{class fe{constructor(le){if(le)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(le){return{ngModule:fe,providers:[{provide:b.TP,useClass:X,multi:!0},le.jwtOptionsProvider||{provide:he,useValue:le.config},Me]}}}return fe.\u0275fac=function(le){return new(le||fe)(d.LFG(fe,12))},fe.\u0275mod=d.oAB({type:fe}),fe.\u0275inj=d.cJS({}),fe})()},7423:(Pn,Et,k)=>{"use strict";k.d(Et,{Uw:()=>Oe,fo:()=>ze});var d=k(5861);typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"&&global;var he=(()=>{return(de=he||(he={})).Unimplemented="UNIMPLEMENTED",de.Unavailable="UNAVAILABLE",he;var de})();class Me extends Error{constructor(oe,Ee,vt){super(oe),this.message=oe,this.code=Ee,this.data=vt}}const X=de=>{var oe,Ee,vt,Tt,Gt;const Ot=de.CapacitorCustomPlatform||null,yt=de.Capacitor||{},Mt=yt.Plugins=yt.Plugins||{},gt=de.CapacitorPlatforms,at=(null===(oe=gt?.currentPlatform)||void 0===oe?void 0:oe.getPlatform)||(()=>null!==Ot?Ot.name:(de=>{var oe,Ee;return de?.androidBridge?"android":null!==(Ee=null===(oe=de?.webkit)||void 0===oe?void 0:oe.messageHandlers)&&void 0!==Ee&&Ee.bridge?"ios":"web"})(de)),bt=(null===(Ee=gt?.currentPlatform)||void 0===Ee?void 0:Ee.isNativePlatform)||(()=>"web"!==at()),Vt=(null===(vt=gt?.currentPlatform)||void 0===vt?void 0:vt.isPluginAvailable)||(ri=>!(!Nt.get(ri)?.platforms.has(at())&&!Fn(ri))),Fn=(null===(Tt=gt?.currentPlatform)||void 0===Tt?void 0:Tt.getPluginHeader)||(ri=>{var Bn;return null===(Bn=yt.PluginHeaders)||void 0===Bn?void 0:Bn.find(pi=>pi.name===ri)}),Nt=new Map,Kn=(null===(Gt=gt?.currentPlatform)||void 0===Gt?void 0:Gt.registerPlugin)||((ri,Bn={})=>{const pi=Nt.get(ri);if(pi)return console.warn(`Capacitor plugin "${ri}" already registered. Cannot register plugins twice.`),pi.proxy;const bi=at(),vi=Fn(ri);let Li;const Si=function(){var Je=(0,d.Z)(function*(){return!Li&&bi in Bn?Li=Li="function"==typeof Bn[bi]?yield Bn[bi]():Bn[bi]:null!==Ot&&!Li&&"web"in Bn&&(Li=Li="function"==typeof Bn.web?yield Bn.web():Bn.web),Li});return function(){return Je.apply(this,arguments)}}(),Yi=Je=>{let jt;const Qt=(...li)=>{const Ii=Si().then(tr=>{const fi=((Je,jt)=>{var Qt,li;if(!vi){if(Je)return null===(li=Je[jt])||void 0===li?void 0:li.bind(Je);throw new Me(`"${ri}" plugin is not implemented on ${bi}`,he.Unimplemented)}{const Ii=vi?.methods.find(tr=>jt===tr.name);if(Ii)return"promise"===Ii.rtype?tr=>yt.nativePromise(ri,jt.toString(),tr):(tr,fi)=>yt.nativeCallback(ri,jt.toString(),tr,fi);if(Je)return null===(Qt=Je[jt])||void 0===Qt?void 0:Qt.bind(Je)}})(tr,Je);if(fi){const yr=fi(...li);return jt=yr?.remove,yr}throw new Me(`"${ri}.${Je}()" is not implemented on ${bi}`,he.Unimplemented)});return"addListener"===Je&&(Ii.remove=(0,d.Z)(function*(){return jt()})),Ii};return Qt.toString=()=>`${Je.toString()}() { [capacitor code] }`,Object.defineProperty(Qt,"name",{value:Je,writable:!1,configurable:!1}),Qt},Zt=Yi("addListener"),It=Yi("removeListener"),He=(Je,jt)=>{const Qt=Zt({eventName:Je},jt),li=function(){var tr=(0,d.Z)(function*(){const fi=yield Qt;It({eventName:Je,callbackId:fi},jt)});return function(){return tr.apply(this,arguments)}}(),Ii=new Promise(tr=>Qt.then(()=>tr({remove:li})));return Ii.remove=(0,d.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield li()}),Ii},ne=new Proxy({},{get(Je,jt){switch(jt){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return vi?He:Zt;case"removeListener":return It;default:return Yi(jt)}}});return Mt[ri]=ne,Nt.set(ri,{name:ri,proxy:ne,platforms:new Set([...Object.keys(Bn),...vi?[bi]:[]])}),ne});return yt.convertFileSrc||(yt.convertFileSrc=ri=>ri),yt.getPlatform=at,yt.handleError=ri=>de.console.error(ri),yt.isNativePlatform=bt,yt.isPluginAvailable=Vt,yt.pluginMethodNoop=(ri,Bn,pi)=>Promise.reject(`${pi} does not have an implementation of "${Bn}".`),yt.registerPlugin=Kn,yt.Exception=Me,yt.DEBUG=!!yt.DEBUG,yt.isLoggingEnabled=!!yt.isLoggingEnabled,yt.platform=yt.getPlatform(),yt.isNative=yt.isNativePlatform(),yt},fe=(de=>de.Capacitor=X(de))(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),ze=fe.registerPlugin;class Oe{constructor(oe){this.listeners={},this.windowListeners={},oe&&(console.warn(`Capacitor WebPlugin "${oe.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=oe)}addListener(oe,Ee){var vt=this;this.listeners[oe]||(this.listeners[oe]=[]),this.listeners[oe].push(Ee);const Gt=this.windowListeners[oe];Gt&&!Gt.registered&&this.addWindowListener(Gt);const Ot=function(){var Mt=(0,d.Z)(function*(){return vt.removeListener(oe,Ee)});return function(){return Mt.apply(this,arguments)}}(),yt=Promise.resolve({remove:Ot});return Object.defineProperty(yt,"remove",{value:(Mt=(0,d.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield Ot()}),function(){return Mt.apply(this,arguments)})}),yt;var Mt}removeAllListeners(){var oe=this;return(0,d.Z)(function*(){oe.listeners={};for(const Ee in oe.windowListeners)oe.removeWindowListener(oe.windowListeners[Ee]);oe.windowListeners={}})()}notifyListeners(oe,Ee){const vt=this.listeners[oe];vt&&vt.forEach(Tt=>Tt(Ee))}hasListeners(oe){return!!this.listeners[oe].length}registerWindowListener(oe,Ee){this.windowListeners[Ee]={registered:!1,windowEventName:oe,pluginEventName:Ee,handler:vt=>{this.notifyListeners(Ee,vt)}}}unimplemented(oe="not implemented"){return new fe.Exception(oe,he.Unimplemented)}unavailable(oe="not available"){return new fe.Exception(oe,he.Unavailable)}removeListener(oe,Ee){var vt=this;return(0,d.Z)(function*(){const Tt=vt.listeners[oe];if(!Tt)return;const Gt=Tt.indexOf(Ee);vt.listeners[oe].splice(Gt,1),vt.listeners[oe].length||vt.removeWindowListener(vt.windowListeners[oe])})()}addWindowListener(oe){window.addEventListener(oe.windowEventName,oe.handler),oe.registered=!0}removeWindowListener(oe){oe&&(window.removeEventListener(oe.windowEventName,oe.handler),oe.registered=!1)}}const Ye=de=>encodeURIComponent(de).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),St=de=>de.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class lt extends Oe{getCookies(){return(0,d.Z)(function*(){const oe=document.cookie,Ee={};return oe.split(";").forEach(vt=>{if(vt.length<=0)return;let[Tt,Gt]=vt.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");Tt=St(Tt).trim(),Gt=St(Gt).trim(),Ee[Tt]=Gt}),Ee})()}setCookie(oe){return(0,d.Z)(function*(){try{const Ee=Ye(oe.key),vt=Ye(oe.value),Tt=`; expires=${(oe.expires||"").replace("expires=","")}`,Gt=(oe.path||"/").replace("path=",""),Ot=null!=oe.url&&oe.url.length>0?`domain=${oe.url}`:"";document.cookie=`${Ee}=${vt||""}${Tt}; path=${Gt}; ${Ot};`}catch(Ee){return Promise.reject(Ee)}})()}deleteCookie(oe){return(0,d.Z)(function*(){try{document.cookie=`${oe.key}=; Max-Age=0`}catch(Ee){return Promise.reject(Ee)}})()}clearCookies(){return(0,d.Z)(function*(){try{const oe=document.cookie.split(";")||[];for(const Ee of oe)document.cookie=Ee.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(oe){return Promise.reject(oe)}})()}clearAllCookies(){var oe=this;return(0,d.Z)(function*(){try{yield oe.clearCookies()}catch(Ee){return Promise.reject(Ee)}})()}}ze("CapacitorCookies",{web:()=>new lt});const ke=function(){var de=(0,d.Z)(function*(oe){return new Promise((Ee,vt)=>{const Tt=new FileReader;Tt.onload=()=>{const Gt=Tt.result;Ee(Gt.indexOf(",")>=0?Gt.split(",")[1]:Gt)},Tt.onerror=Gt=>vt(Gt),Tt.readAsDataURL(oe)})});return function(Ee){return de.apply(this,arguments)}}();class We extends Oe{request(oe){return(0,d.Z)(function*(){const Ee=((de,oe={})=>{const Ee=Object.assign({method:de.method||"GET",headers:de.headers},oe),Tt=((de={})=>{const oe=Object.keys(de);return Object.keys(de).map(Tt=>Tt.toLocaleLowerCase()).reduce((Tt,Gt,Ot)=>(Tt[Gt]=de[oe[Ot]],Tt),{})})(de.headers)["content-type"]||"";if("string"==typeof de.data)Ee.body=de.data;else if(Tt.includes("application/x-www-form-urlencoded")){const Gt=new URLSearchParams;for(const[Ot,yt]of Object.entries(de.data||{}))Gt.set(Ot,yt);Ee.body=Gt.toString()}else if(Tt.includes("multipart/form-data")){const Gt=new FormData;if(de.data instanceof FormData)de.data.forEach((yt,Mt)=>{Gt.append(Mt,yt)});else for(const yt of Object.keys(de.data))Gt.append(yt,de.data[yt]);Ee.body=Gt;const Ot=new Headers(Ee.headers);Ot.delete("content-type"),Ee.headers=Ot}else(Tt.includes("application/json")||"object"==typeof de.data)&&(Ee.body=JSON.stringify(de.data));return Ee})(oe,oe.webFetchExtra),vt=((de,oe=!0)=>de?Object.entries(de).reduce((vt,Tt)=>{const[Gt,Ot]=Tt;let yt,Mt;return Array.isArray(Ot)?(Mt="",Ot.forEach(gt=>{yt=oe?encodeURIComponent(gt):gt,Mt+=`${Gt}=${yt}&`}),Mt.slice(0,-1)):(yt=oe?encodeURIComponent(Ot):Ot,Mt=`${Gt}=${yt}`),`${vt}&${Mt}`},"").substr(1):null)(oe.params,oe.shouldEncodeUrlParams),Tt=vt?`${oe.url}?${vt}`:oe.url,Gt=yield fetch(Tt,Ee),Ot=Gt.headers.get("content-type")||"";let Mt,gt,{responseType:yt="text"}=Gt.ok?oe:{};switch(Ot.includes("application/json")&&(yt="json"),yt){case"arraybuffer":case"blob":gt=yield Gt.blob(),Mt=yield ke(gt);break;case"json":Mt=yield Gt.json();break;default:Mt=yield Gt.text()}const it={};return Gt.headers.forEach((at,Ce)=>{it[Ce]=at}),{data:Mt,headers:it,status:Gt.status,url:Gt.url}})()}get(oe){var Ee=this;return(0,d.Z)(function*(){return Ee.request(Object.assign(Object.assign({},oe),{method:"GET"}))})()}post(oe){var Ee=this;return(0,d.Z)(function*(){return Ee.request(Object.assign(Object.assign({},oe),{method:"POST"}))})()}put(oe){var Ee=this;return(0,d.Z)(function*(){return Ee.request(Object.assign(Object.assign({},oe),{method:"PUT"}))})()}patch(oe){var Ee=this;return(0,d.Z)(function*(){return Ee.request(Object.assign(Object.assign({},oe),{method:"PATCH"}))})()}delete(oe){var Ee=this;return(0,d.Z)(function*(){return Ee.request(Object.assign(Object.assign({},oe),{method:"DELETE"}))})()}}ze("CapacitorHttp",{web:()=>new We})},425:(Pn,Et,k)=>{"use strict";k.d(Et,{BX:()=>hr,Br:()=>Ts,w:()=>Cr,dr:()=>tt,BJ:()=>Rt,oU:()=>At,cs:()=>ds,yp:()=>be,YG:()=>pt,Sm:()=>on,PM:()=>Dn,FN:()=>Nn,Zi:()=>Wn,wI:()=>ki,W2:()=>Gr,IJ:()=>Xt,W4:()=>no,zq:()=>vr,fr:()=>eo,jY:()=>wo,Gu:()=>mi,gu:()=>Qi,pK:()=>oi,Ie:()=>Cn,Q$:()=>$e,q_:()=>ft,yh:()=>Ft,z0:()=>hn,fG:()=>Jt,zc:()=>Vn,uN:()=>Bi,I_:()=>Hr,nJ:()=>zr,Wo:()=>lr,jP:()=>wi,Nd:()=>fo,VI:()=>_s,cJ:()=>Wo,GO:()=>xr,t9:()=>Ur,n0:()=>ua,PQ:()=>ys,jI:()=>co,g2:()=>Co,Bs:()=>mo,wd:()=>Hs,ho:()=>vs,sr:()=>as,Pc:()=>dl,r4:()=>Es,HT:()=>So,IN:()=>Ri,SH:()=>jo,X1:()=>go,as:()=>si,t4:()=>qo,YI:()=>Js,QI:()=>wt,j9:()=>Pt,yF:()=>ul});var d=k(8274),y=k(4006);function b(M,j,S,V){var wn,ve=arguments.length,Dt=ve<3?j:null===V?V=Object.getOwnPropertyDescriptor(j,S):V;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)Dt=Reflect.decorate(M,j,S,V);else for(var zn=M.length-1;zn>=0;zn--)(wn=M[zn])&&(Dt=(ve<3?wn(Dt):ve>3?wn(j,S,Dt):wn(j,S))||Dt);return ve>3&&Dt&&Object.defineProperty(j,S,Dt),Dt}function Ve(M,j,S,V){return new(S||(S=Promise))(function(Dt,wn){function zn(Gi){try{ti(V.next(Gi))}catch(nr){wn(nr)}}function xi(Gi){try{ti(V.throw(Gi))}catch(nr){wn(nr)}}function ti(Gi){Gi.done?Dt(Gi.value):function ve(Dt){return Dt instanceof S?Dt:new S(function(wn){wn(Dt)})}(Gi.value).then(zn,xi)}ti((V=V.apply(M,j||[])).next())})}var oe=k(4968),Ee=k(7579),vt=k(1135),Tt=k(4228),gt=(k(181),k(6439),k(7838),k(1898),k(5179)),it=k(5730),at=k(1843),bt=(k(6369),k(7996)),yn=(k(3457),k(4349),k(1308)),Kn=k(9300),ri=k(3900),Bn=k(4671),pi=k(4482),bi=k(5403);function Li(M,j){return M===j}var Si=k(6895);const Yi=gt.i,He=["*"],Ii=M=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(M):"function"==typeof requestAnimationFrame?requestAnimationFrame(M):setTimeout(M),tr=M=>!!M.resolveComponentFactory;let fi=(()=>{class M{constructor(S,V){this.injector=S,this.el=V,this.onChange=()=>{},this.onTouched=()=>{}}writeValue(S){this.el.nativeElement.value=this.lastValue=S??"",yr(this.el)}handleChangeEvent(S,V){S===this.el.nativeElement&&(V!==this.lastValue&&(this.lastValue=V,this.onChange(V)),yr(this.el))}_handleBlurEvent(S){S===this.el.nativeElement&&(this.onTouched(),yr(this.el))}registerOnChange(S){this.onChange=S}registerOnTouched(S){this.onTouched=S}setDisabledState(S){this.el.nativeElement.disabled=S}ngOnDestroy(){this.statusChanges&&this.statusChanges.unsubscribe()}ngAfterViewInit(){let S;try{S=this.injector.get(y.a5)}catch{}if(!S)return;S.statusChanges&&(this.statusChanges=S.statusChanges.subscribe(()=>yr(this.el)));const V=S.control;V&&["markAsTouched","markAllAsTouched","markAsUntouched","markAsDirty","markAsPristine"].forEach(Dt=>{if(typeof V[Dt]<"u"){const wn=V[Dt].bind(V);V[Dt]=(...zn)=>{wn(...zn),yr(this.el)}}})}}return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.zs3),d.Y36(d.SBq))},M.\u0275dir=d.lG2({type:M,hostBindings:function(S,V){1&S&&d.NdJ("ionBlur",function(Dt){return V._handleBlurEvent(Dt.target)})}}),M})();const yr=M=>{Ii(()=>{const j=M.nativeElement,S=null!=j.value&&j.value.toString().length>0,V=Ai(j);fr(j,V);const ve=j.closest("ion-item");ve&&fr(ve,S?[...V,"item-has-value"]:V)})},Ai=M=>{const j=M.classList,S=[];for(let V=0;V<j.length;V++){const ve=j.item(V);null!==ve&&wr(ve,"ng-")&&S.push(`ion-${ve.substring(3)}`)}return S},fr=(M,j)=>{const S=M.classList;S.remove("ion-valid","ion-invalid","ion-touched","ion-untouched","ion-dirty","ion-pristine"),S.add(...j)},wr=(M,j)=>M.substring(0,j.length)===j;let Cr=(()=>{class M extends fi{constructor(S,V){super(S,V)}writeValue(S){this.el.nativeElement.checked=this.lastValue=S??!1,yr(this.el)}_handleIonChange(S){this.handleChangeEvent(S,S.checked)}}return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.zs3),d.Y36(d.SBq))},M.\u0275dir=d.lG2({type:M,selectors:[["ion-checkbox"],["ion-toggle"]],hostBindings:function(S,V){1&S&&d.NdJ("ionChange",function(Dt){return V._handleIonChange(Dt.target)})},features:[d._Bn([{provide:y.JU,useExisting:M,multi:!0}]),d.qOj]}),M})(),si=(()=>{class M extends fi{constructor(S,V){super(S,V)}_handleIonChange(S){this.handleChangeEvent(S,S.value)}registerOnChange(S){super.registerOnChange(V=>{S(""===V?null:parseFloat(V))})}}return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.zs3),d.Y36(d.SBq))},M.\u0275dir=d.lG2({type:M,selectors:[["ion-input","type","number"]],hostBindings:function(S,V){1&S&&d.NdJ("ionChange",function(Dt){return V._handleIonChange(Dt.target)})},features:[d._Bn([{provide:y.JU,useExisting:M,multi:!0}]),d.qOj]}),M})(),wt=(()=>{class M extends fi{constructor(S,V){super(S,V)}_handleChangeEvent(S){this.handleChangeEvent(S,S.value)}}return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.zs3),d.Y36(d.SBq))},M.\u0275dir=d.lG2({type:M,selectors:[["ion-range"],["ion-select"],["ion-radio-group"],["ion-segment"],["ion-datetime"]],hostBindings:function(S,V){1&S&&d.NdJ("ionChange",function(Dt){return V._handleChangeEvent(Dt.target)})},features:[d._Bn([{provide:y.JU,useExisting:M,multi:!0}]),d.qOj]}),M})(),Pt=(()=>{class M extends fi{constructor(S,V){super(S,V)}_handleInputEvent(S){this.handleChangeEvent(S,S.value)}}return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.zs3),d.Y36(d.SBq))},M.\u0275dir=d.lG2({type:M,selectors:[["ion-input",3,"type","number"],["ion-textarea"],["ion-searchbar"]],hostBindings:function(S,V){1&S&&d.NdJ("ionChange",function(Dt){return V._handleInputEvent(Dt.target)})},features:[d._Bn([{provide:y.JU,useExisting:M,multi:!0}]),d.qOj]}),M})();const gn=(M,j)=>{const S=M.prototype;j.forEach(V=>{Object.defineProperty(S,V,{get(){return this.el[V]},set(ve){this.z.runOutsideAngular(()=>this.el[V]=ve)}})})},Ue=(M,j)=>{const S=M.prototype;j.forEach(V=>{S[V]=function(){const ve=arguments;return this.z.runOutsideAngular(()=>this.el[V].apply(this.el,ve))}})},se=(M,j,S)=>{S.forEach(V=>M[V]=(0,oe.R)(j,V))};function z(M){return function(S){const{defineCustomElementFn:V,inputs:ve,methods:Dt}=M;return void 0!==V&&V(),ve&&gn(S,ve),Dt&&Ue(S,Dt),S}}let tt=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-app"]],ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0})],M),M})(),Rt=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-avatar"]],ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0})],M),M})(),At=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-back-button"]],inputs:{color:"color",defaultHref:"defaultHref",disabled:"disabled",icon:"icon",mode:"mode",routerAnimation:"routerAnimation",text:"text",type:"type"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["color","defaultHref","disabled","icon","mode","routerAnimation","text","type"]})],M),M})(),be=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-badge"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["color","mode"]})],M),M})(),pt=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement,se(this,this.el,["ionFocus","ionBlur"])}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-button"]],inputs:{buttonType:"buttonType",color:"color",disabled:"disabled",download:"download",expand:"expand",fill:"fill",form:"form",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",size:"size",strong:"strong",target:"target",type:"type"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["buttonType","color","disabled","download","expand","fill","form","href","mode","rel","routerAnimation","routerDirection","shape","size","strong","target","type"]})],M),M})(),on=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-buttons"]],inputs:{collapse:"collapse"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["collapse"]})],M),M})(),Dn=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-card"]],inputs:{button:"button",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",target:"target",type:"type"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["button","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","target","type"]})],M),M})(),Nn=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-card-content"]],inputs:{mode:"mode"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["mode"]})],M),M})(),Wn=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-card-header"]],inputs:{color:"color",mode:"mode",translucent:"translucent"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["color","mode","translucent"]})],M),M})(),ki=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-col"]],inputs:{offset:"offset",offsetLg:"offsetLg",offsetMd:"offsetMd",offsetSm:"offsetSm",offsetXl:"offsetXl",offsetXs:"offsetXs",pull:"pull",pullLg:"pullLg",pullMd:"pullMd",pullSm:"pullSm",pullXl:"pullXl",pullXs:"pullXs",push:"push",pushLg:"pushLg",pushMd:"pushMd",pushSm:"pushSm",pushXl:"pushXl",pushXs:"pushXs",size:"size",sizeLg:"sizeLg",sizeMd:"sizeMd",sizeSm:"sizeSm",sizeXl:"sizeXl",sizeXs:"sizeXs"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["offset","offsetLg","offsetMd","offsetSm","offsetXl","offsetXs","pull","pullLg","pullMd","pullSm","pullXl","pullXs","push","pushLg","pushMd","pushSm","pushXl","pushXs","size","sizeLg","sizeMd","sizeSm","sizeXl","sizeXs"]})],M),M})(),Gr=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement,se(this,this.el,["ionScrollStart","ionScroll","ionScrollEnd"])}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-content"]],inputs:{color:"color",forceOverscroll:"forceOverscroll",fullscreen:"fullscreen",scrollEvents:"scrollEvents",scrollX:"scrollX",scrollY:"scrollY"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["color","forceOverscroll","fullscreen","scrollEvents","scrollX","scrollY"],methods:["getScrollElement","scrollToTop","scrollToBottom","scrollByPoint","scrollToPoint"]})],M),M})(),Xt=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-fab"]],inputs:{activated:"activated",edge:"edge",horizontal:"horizontal",vertical:"vertical"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["activated","edge","horizontal","vertical"],methods:["close"]})],M),M})(),no=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement,se(this,this.el,["ionFocus","ionBlur"])}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-fab-button"]],inputs:{activated:"activated",closeIcon:"closeIcon",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",show:"show",size:"size",target:"target",translucent:"translucent",type:"type"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["activated","closeIcon","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","show","size","target","translucent","type"]})],M),M})(),vr=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-fab-list"]],inputs:{activated:"activated",side:"side"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["activated","side"]})],M),M})(),eo=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-footer"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["collapse","mode","translucent"]})],M),M})(),wo=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-grid"]],inputs:{fixed:"fixed"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["fixed"]})],M),M})(),mi=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-header"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["collapse","mode","translucent"]})],M),M})(),Qi=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-icon"]],inputs:{color:"color",flipRtl:"flipRtl",icon:"icon",ios:"ios",lazy:"lazy",md:"md",mode:"mode",name:"name",sanitize:"sanitize",size:"size",src:"src"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["color","flipRtl","icon","ios","lazy","md","mode","name","sanitize","size","src"]})],M),M})(),oi=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement,se(this,this.el,["ionInput","ionChange","ionBlur","ionFocus"])}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-input"]],inputs:{accept:"accept",autocapitalize:"autocapitalize",autocomplete:"autocomplete",autocorrect:"autocorrect",autofocus:"autofocus",clearInput:"clearInput",clearOnEdit:"clearOnEdit",color:"color",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",max:"max",maxlength:"maxlength",min:"min",minlength:"minlength",mode:"mode",multiple:"multiple",name:"name",pattern:"pattern",placeholder:"placeholder",readonly:"readonly",required:"required",size:"size",spellcheck:"spellcheck",step:"step",type:"type",value:"value"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["accept","autocapitalize","autocomplete","autocorrect","autofocus","clearInput","clearOnEdit","color","debounce","disabled","enterkeyhint","inputmode","max","maxlength","min","minlength","mode","multiple","name","pattern","placeholder","readonly","required","size","spellcheck","step","type","value"],methods:["setFocus","getInputElement"]})],M),M})(),Cn=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-item"]],inputs:{button:"button",color:"color",counter:"counter",counterFormatter:"counterFormatter",detail:"detail",detailIcon:"detailIcon",disabled:"disabled",download:"download",fill:"fill",href:"href",lines:"lines",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",target:"target",type:"type"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["button","color","counter","counterFormatter","detail","detailIcon","disabled","download","fill","href","lines","mode","rel","routerAnimation","routerDirection","shape","target","type"]})],M),M})(),$e=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-label"]],inputs:{color:"color",mode:"mode",position:"position"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["color","mode","position"]})],M),M})(),ft=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-list"]],inputs:{inset:"inset",lines:"lines",mode:"mode"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["inset","lines","mode"],methods:["closeSlidingItems"]})],M),M})(),Ft=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-list-header"]],inputs:{color:"color",lines:"lines",mode:"mode"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["color","lines","mode"]})],M),M})(),hn=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement,se(this,this.el,["ionWillOpen","ionWillClose","ionDidOpen","ionDidClose"])}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-menu"]],inputs:{contentId:"contentId",disabled:"disabled",maxEdgeStart:"maxEdgeStart",menuId:"menuId",side:"side",swipeGesture:"swipeGesture",type:"type"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["contentId","disabled","maxEdgeStart","menuId","side","swipeGesture","type"],methods:["isOpen","isActive","open","close","toggle","setOpen"]})],M),M})(),Jt=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-menu-button"]],inputs:{autoHide:"autoHide",color:"color",disabled:"disabled",menu:"menu",mode:"mode",type:"type"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["autoHide","color","disabled","menu","mode","type"]})],M),M})(),Vn=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-menu-toggle"]],inputs:{autoHide:"autoHide",menu:"menu"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["autoHide","menu"]})],M),M})(),Bi=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-note"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["color","mode"]})],M),M})(),Hr=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement,se(this,this.el,["ionChange","ionFocus","ionBlur","ionKnobMoveStart","ionKnobMoveEnd"])}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-range"]],inputs:{activeBarStart:"activeBarStart",color:"color",debounce:"debounce",disabled:"disabled",dualKnobs:"dualKnobs",max:"max",min:"min",mode:"mode",name:"name",pin:"pin",pinFormatter:"pinFormatter",snaps:"snaps",step:"step",ticks:"ticks",value:"value"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["activeBarStart","color","debounce","disabled","dualKnobs","max","min","mode","name","pin","pinFormatter","snaps","step","ticks","value"]})],M),M})(),zr=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement,se(this,this.el,["ionRefresh","ionPull","ionStart"])}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-refresher"]],inputs:{closeDuration:"closeDuration",disabled:"disabled",pullFactor:"pullFactor",pullMax:"pullMax",pullMin:"pullMin",snapbackDuration:"snapbackDuration"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["closeDuration","disabled","pullFactor","pullMax","pullMin","snapbackDuration"],methods:["complete","cancel","getProgress"]})],M),M})(),lr=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-refresher-content"]],inputs:{pullingIcon:"pullingIcon",pullingText:"pullingText",refreshingSpinner:"refreshingSpinner",refreshingText:"refreshingText"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["pullingIcon","pullingText","refreshingSpinner","refreshingText"]})],M),M})(),fo=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-row"]],ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0})],M),M})(),_s=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement,se(this,this.el,["ionInput","ionChange","ionCancel","ionClear","ionBlur","ionFocus"])}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-searchbar"]],inputs:{animated:"animated",autocomplete:"autocomplete",autocorrect:"autocorrect",cancelButtonIcon:"cancelButtonIcon",cancelButtonText:"cancelButtonText",clearIcon:"clearIcon",color:"color",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",mode:"mode",placeholder:"placeholder",searchIcon:"searchIcon",showCancelButton:"showCancelButton",showClearButton:"showClearButton",spellcheck:"spellcheck",type:"type",value:"value"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["animated","autocomplete","autocorrect","cancelButtonIcon","cancelButtonText","clearIcon","color","debounce","disabled","enterkeyhint","inputmode","mode","placeholder","searchIcon","showCancelButton","showClearButton","spellcheck","type","value"],methods:["setFocus","getInputElement"]})],M),M})(),Wo=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement,se(this,this.el,["ionChange"])}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-segment"]],inputs:{color:"color",disabled:"disabled",mode:"mode",scrollable:"scrollable",selectOnFocus:"selectOnFocus",swipeGesture:"swipeGesture",value:"value"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["color","disabled","mode","scrollable","selectOnFocus","swipeGesture","value"]})],M),M})(),xr=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-segment-button"]],inputs:{disabled:"disabled",layout:"layout",mode:"mode",type:"type",value:"value"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["disabled","layout","mode","type","value"]})],M),M})(),Ur=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement,se(this,this.el,["ionChange","ionCancel","ionDismiss","ionFocus","ionBlur"])}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-select"]],inputs:{cancelText:"cancelText",compareWith:"compareWith",disabled:"disabled",interface:"interface",interfaceOptions:"interfaceOptions",mode:"mode",multiple:"multiple",name:"name",okText:"okText",placeholder:"placeholder",selectedText:"selectedText",value:"value"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["cancelText","compareWith","disabled","interface","interfaceOptions","mode","multiple","name","okText","placeholder","selectedText","value"],methods:["open"]})],M),M})(),ua=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-select-option"]],inputs:{disabled:"disabled",value:"value"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["disabled","value"]})],M),M})(),ys=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-spinner"]],inputs:{color:"color",duration:"duration",name:"name",paused:"paused"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["color","duration","name","paused"]})],M),M})(),co=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement,se(this,this.el,["ionSplitPaneVisible"])}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-split-pane"]],inputs:{contentId:"contentId",disabled:"disabled",when:"when"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["contentId","disabled","when"]})],M),M})(),Co=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement,se(this,this.el,["ionChange","ionInput","ionBlur","ionFocus"])}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-textarea"]],inputs:{autoGrow:"autoGrow",autocapitalize:"autocapitalize",autofocus:"autofocus",clearOnEdit:"clearOnEdit",color:"color",cols:"cols",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",maxlength:"maxlength",minlength:"minlength",mode:"mode",name:"name",placeholder:"placeholder",readonly:"readonly",required:"required",rows:"rows",spellcheck:"spellcheck",value:"value",wrap:"wrap"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["autoGrow","autocapitalize","autofocus","clearOnEdit","color","cols","debounce","disabled","enterkeyhint","inputmode","maxlength","minlength","mode","name","placeholder","readonly","required","rows","spellcheck","value","wrap"],methods:["setFocus","getInputElement"]})],M),M})(),mo=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-thumbnail"]],ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0})],M),M})(),Hs=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-title"]],inputs:{color:"color",size:"size"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["color","size"]})],M),M})(),vs=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement,se(this,this.el,["ionChange","ionFocus","ionBlur"])}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-toggle"]],inputs:{checked:"checked",color:"color",disabled:"disabled",enableOnOffLabels:"enableOnOffLabels",mode:"mode",name:"name",value:"value"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["checked","color","disabled","enableOnOffLabels","mode","name","value"]})],M),M})(),as=(()=>{let M=class{constructor(S,V,ve){this.z=ve,S.detach(),this.el=V.nativeElement}};return M.\u0275fac=function(S){return new(S||M)(d.Y36(d.sBO),d.Y36(d.SBq),d.Y36(d.R0b))},M.\u0275cmp=d.Xpm({type:M,selectors:[["ion-toolbar"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:He,decls:1,vars:0,template:function(S,V){1&S&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),M=b([z({defineCustomElementFn:void 0,inputs:["color","mode"]})],M),M})();class go{constructor(j={}){this.data=j}get(j){return this.data[j]}}let xs=(()=>{class M{constructor(S,V){this.zone=S,this.appRef=V}create(S,V,ve,Dt){return new so(S,V,ve,this.appRef,this.zone,Dt)}}return M.\u0275fac=function(S){return new(S||M)(d.LFG(d.R0b),d.LFG(d.z2F))},M.\u0275prov=d.Yz7({token:M,factory:M.\u0275fac}),M})();class so{constructor(j,S,V,ve,Dt,wn){this.resolverOrInjector=j,this.injector=S,this.location=V,this.appRef=ve,this.zone=Dt,this.elementReferenceKey=wn,this.elRefMap=new WeakMap,this.elEventsMap=new WeakMap}attachViewToDom(j,S,V,ve){return this.zone.run(()=>new Promise(Dt=>{const wn=Object.assign({},V);void 0!==this.elementReferenceKey&&(wn[this.elementReferenceKey]=j),Dt(ks(this.zone,this.resolverOrInjector,this.injector,this.location,this.appRef,this.elRefMap,this.elEventsMap,j,S,wn,ve))}))}removeViewFromDom(j,S){return this.zone.run(()=>new Promise(V=>{const ve=this.elRefMap.get(S);if(ve){ve.destroy(),this.elRefMap.delete(S);const Dt=this.elEventsMap.get(S);Dt&&(Dt(),this.elEventsMap.delete(S))}V()}))}}const ks=(M,j,S,V,ve,Dt,wn,zn,xi,ti,Gi)=>{let nr;const cr=d.zs3.create({providers:Ws(ti),parent:S});if(j&&tr(j)){const Ko=j.resolveComponentFactory(xi);nr=V?V.createComponent(Ko,V.length,cr):Ko.create(cr)}else{if(!V)return null;nr=V.createComponent(xi,{index:V.indexOf,injector:cr,environmentInjector:j})}const yo=nr.instance,vo=nr.location.nativeElement;if(ti&&Object.assign(yo,ti),Gi)for(const Ko of Gi)vo.classList.add(Ko);const Ds=ha(M,yo,vo);return zn.appendChild(vo),V||ve.attachView(nr.hostView),nr.changeDetectorRef.reattach(),Dt.set(vo,nr),wn.set(vo,Ds),vo},bs=[at.L,at.a,at.b,at.c,at.d],ha=(M,j,S)=>M.run(()=>{const V=bs.filter(ve=>"function"==typeof j[ve]).map(ve=>{const Dt=wn=>j[ve](wn.detail);return S.addEventListener(ve,Dt),()=>S.removeEventListener(ve,Dt)});return()=>V.forEach(ve=>ve())}),pa=new d.OlP("NavParamsToken"),Ws=M=>[{provide:pa,useValue:M},{provide:go,useFactory:ls,deps:[pa]}],ls=M=>new go(M),Mo=(M,j)=>((M=M.filter(S=>S.stackId!==j.stackId)).push(j),M),cs=(M,j)=>{const S=M.createUrlTree(["."],{relativeTo:j});return M.serializeUrl(S)},Uo=(M,j)=>{if(!M)return;const S=ji(j);for(let V=0;V<S.length;V++){if(V>=M.length)return S[V];if(S[V]!==M[V])return}},ji=M=>M.split("/").map(j=>j.trim()).filter(j=>""!==j),qs=M=>{M&&(M.ref.destroy(),M.unlistenEvents())};class Ys{constructor(j,S,V,ve,Dt,wn){this.containerEl=S,this.router=V,this.navCtrl=ve,this.zone=Dt,this.location=wn,this.views=[],this.skipTransition=!1,this.nextId=0,this.tabsPrefix=void 0!==j?ji(j):void 0}createView(j,S){var V;const ve=cs(this.router,S),Dt=null===(V=j?.location)||void 0===V?void 0:V.nativeElement,wn=ha(this.zone,j.instance,Dt);return{id:this.nextId++,stackId:Uo(this.tabsPrefix,ve),unlistenEvents:wn,element:Dt,ref:j,url:ve}}getExistingView(j){const S=cs(this.router,j),V=this.views.find(ve=>ve.url===S);return V&&V.ref.changeDetectorRef.reattach(),V}setActive(j){var S,V;const ve=this.navCtrl.consumeTransition();let{direction:Dt,animation:wn,animationBuilder:zn}=ve;const xi=this.activeView,ti=((M,j)=>!j||M.stackId!==j.stackId)(j,xi);ti&&(Dt="back",wn=void 0);const Gi=this.views.slice();let nr;const cr=this.router;cr.getCurrentNavigation?nr=cr.getCurrentNavigation():!(null===(S=cr.navigations)||void 0===S)&&S.value&&(nr=cr.navigations.value),null!==(V=nr?.extras)&&void 0!==V&&V.replaceUrl&&this.views.length>0&&this.views.splice(-1,1);const yo=this.views.includes(j),vo=this.insertView(j,Dt);yo||j.ref.changeDetectorRef.detectChanges();const Ds=j.animationBuilder;return void 0===zn&&"back"===Dt&&!ti&&void 0!==Ds&&(zn=Ds),xi&&(xi.animationBuilder=zn),this.zone.runOutsideAngular(()=>this.wait(()=>(xi&&xi.ref.changeDetectorRef.detach(),j.ref.changeDetectorRef.reattach(),this.transition(j,xi,wn,this.canGoBack(1),!1,zn).then(()=>Vo(j,vo,Gi,this.location,this.zone)).then(()=>({enteringView:j,direction:Dt,animation:wn,tabSwitch:ti})))))}canGoBack(j,S=this.getActiveStackId()){return this.getStack(S).length>j}pop(j,S=this.getActiveStackId()){return this.zone.run(()=>{var V,ve;const Dt=this.getStack(S);if(Dt.length<=j)return Promise.resolve(!1);const wn=Dt[Dt.length-j-1];let zn=wn.url;const xi=wn.savedData;if(xi){const Gi=xi.get("primary");null!==(ve=null===(V=Gi?.route)||void 0===V?void 0:V._routerState)&&void 0!==ve&&ve.snapshot.url&&(zn=Gi.route._routerState.snapshot.url)}const{animationBuilder:ti}=this.navCtrl.consumeTransition();return this.navCtrl.navigateBack(zn,Object.assign(Object.assign({},wn.savedExtras),{animation:ti})).then(()=>!0)})}startBackTransition(){const j=this.activeView;if(j){const S=this.getStack(j.stackId),V=S[S.length-2],ve=V.animationBuilder;return this.wait(()=>this.transition(V,j,"back",this.canGoBack(2),!0,ve))}return Promise.resolve()}endBackTransition(j){j?(this.skipTransition=!0,this.pop(1)):this.activeView&&Lo(this.activeView,this.views,this.views,this.location,this.zone)}getLastUrl(j){const S=this.getStack(j);return S.length>0?S[S.length-1]:void 0}getRootUrl(j){const S=this.getStack(j);return S.length>0?S[0]:void 0}getActiveStackId(){return this.activeView?this.activeView.stackId:void 0}hasRunningTask(){return void 0!==this.runningTask}destroy(){this.containerEl=void 0,this.views.forEach(qs),this.activeView=void 0,this.views=[]}getStack(j){return this.views.filter(S=>S.stackId===j)}insertView(j,S){return this.activeView=j,this.views=((M,j,S)=>"root"===S?Mo(M,j):"forward"===S?((M,j)=>(M.indexOf(j)>=0?M=M.filter(V=>V.stackId!==j.stackId||V.id<=j.id):M.push(j),M))(M,j):((M,j)=>M.indexOf(j)>=0?M.filter(V=>V.stackId!==j.stackId||V.id<=j.id):Mo(M,j))(M,j))(this.views,j,S),this.views.slice()}transition(j,S,V,ve,Dt,wn){if(this.skipTransition)return this.skipTransition=!1,Promise.resolve(!1);if(S===j)return Promise.resolve(!1);const zn=j?j.element:void 0,xi=S?S.element:void 0,ti=this.containerEl;return zn&&zn!==xi&&(zn.classList.add("ion-page"),zn.classList.add("ion-page-invisible"),zn.parentElement!==ti&&ti.appendChild(zn),ti.commit)?ti.commit(zn,xi,{deepWait:!0,duration:void 0===V?0:void 0,direction:V,showGoBack:ve,progressAnimation:Dt,animationBuilder:wn}):Promise.resolve(!1)}wait(j){return Ve(this,void 0,void 0,function*(){void 0!==this.runningTask&&(yield this.runningTask,this.runningTask=void 0);const S=this.runningTask=j();return S.finally(()=>this.runningTask=void 0),S})}}const Vo=(M,j,S,V,ve)=>"function"==typeof requestAnimationFrame?new Promise(Dt=>{requestAnimationFrame(()=>{Lo(M,j,S,V,ve),Dt()})}):Promise.resolve(),Lo=(M,j,S,V,ve)=>{ve.run(()=>S.filter(Dt=>!j.includes(Dt)).forEach(qs)),j.forEach(Dt=>{const zn=V.path().split("?")[0].split("#")[0];if(Dt!==M&&Dt.url!==zn){const xi=Dt.element;xi.setAttribute("aria-hidden","true"),xi.classList.add("ion-page-hidden"),Dt.ref.changeDetectorRef.detach()}})};let ws=(()=>{class M{get(S,V){const ve=us();return ve?ve.get(S,V):null}getBoolean(S,V){const ve=us();return!!ve&&ve.getBoolean(S,V)}getNumber(S,V){const ve=us();return ve?ve.getNumber(S,V):0}}return M.\u0275fac=function(S){return new(S||M)},M.\u0275prov=d.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})();const Cs=new d.OlP("USERCONFIG"),us=()=>{if(typeof window<"u"){const M=window.Ionic;if(M?.config)return M.config}return null};let qo=(()=>{class M{constructor(S,V){this.doc=S,this.backButton=new Ee.x,this.keyboardDidShow=new Ee.x,this.keyboardDidHide=new Ee.x,this.pause=new Ee.x,this.resume=new Ee.x,this.resize=new Ee.x,V.run(()=>{var ve;let Dt;this.win=S.defaultView,this.backButton.subscribeWithPriority=function(wn,zn){return this.subscribe(xi=>xi.register(wn,ti=>V.run(()=>zn(ti))))},_o(this.pause,S,"pause"),_o(this.resume,S,"resume"),_o(this.backButton,S,"ionBackButton"),_o(this.resize,this.win,"resize"),_o(this.keyboardDidShow,this.win,"ionKeyboardDidShow"),_o(this.keyboardDidHide,this.win,"ionKeyboardDidHide"),this._readyPromise=new Promise(wn=>{Dt=wn}),null!==(ve=this.win)&&void 0!==ve&&ve.cordova?S.addEventListener("deviceready",()=>{Dt("cordova")},{once:!0}):Dt("dom")})}is(S){return(0,gt.a)(this.win,S)}platforms(){return(0,gt.g)(this.win)}ready(){return this._readyPromise}get isRTL(){return"rtl"===this.doc.dir}getQueryParam(S){return uo(this.win.location.href,S)}isLandscape(){return!this.isPortrait()}isPortrait(){var S,V;return null===(V=(S=this.win).matchMedia)||void 0===V?void 0:V.call(S,"(orientation: portrait)").matches}testUserAgent(S){const V=this.win.navigator;return!!(V?.userAgent&&V.userAgent.indexOf(S)>=0)}url(){return this.win.location.href}width(){return this.win.innerWidth}height(){return this.win.innerHeight}}return M.\u0275fac=function(S){return new(S||M)(d.LFG(Si.K0),d.LFG(d.R0b))},M.\u0275prov=d.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})();const uo=(M,j)=>{j=j.replace(/[[\]\\]/g,"\\$&");const V=new RegExp("[\\?&]"+j+"=([^&#]*)").exec(M);return V?decodeURIComponent(V[1].replace(/\+/g," ")):null},_o=(M,j,S)=>{j&&j.addEventListener(S,V=>{M.next(V?.detail)})};let jo=(()=>{class M{constructor(S,V,ve,Dt){this.location=V,this.serializer=ve,this.router=Dt,this.direction=ma,this.animated=Yo,this.guessDirection="forward",this.lastNavId=-1,Dt&&Dt.events.subscribe(wn=>{if(wn instanceof Tt.OD){const zn=wn.restoredState?wn.restoredState.navigationId:wn.id;this.guessDirection=zn<this.lastNavId?"back":"forward",this.guessAnimation=wn.restoredState?void 0:this.guessDirection,this.lastNavId="forward"===this.guessDirection?wn.id:zn}}),S.backButton.subscribeWithPriority(0,wn=>{this.pop(),wn()})}navigateForward(S,V={}){return this.setDirection("forward",V.animated,V.animationDirection,V.animation),this.navigate(S,V)}navigateBack(S,V={}){return this.setDirection("back",V.animated,V.animationDirection,V.animation),this.navigate(S,V)}navigateRoot(S,V={}){return this.setDirection("root",V.animated,V.animationDirection,V.animation),this.navigate(S,V)}back(S={animated:!0,animationDirection:"back"}){return this.setDirection("back",S.animated,S.animationDirection,S.animation),this.location.back()}pop(){return Ve(this,void 0,void 0,function*(){let S=this.topOutlet;for(;S&&!(yield S.pop());)S=S.parentOutlet})}setDirection(S,V,ve,Dt){this.direction=S,this.animated=Xr(S,V,ve),this.animationBuilder=Dt}setTopOutlet(S){this.topOutlet=S}consumeTransition(){let V,S="root";const ve=this.animationBuilder;return"auto"===this.direction?(S=this.guessDirection,V=this.guessAnimation):(V=this.animated,S=this.direction),this.direction=ma,this.animated=Yo,this.animationBuilder=void 0,{direction:S,animation:V,animationBuilder:ve}}navigate(S,V){if(Array.isArray(S))return this.router.navigate(S,V);{const ve=this.serializer.parse(S.toString());return void 0!==V.queryParams&&(ve.queryParams=Object.assign({},V.queryParams)),void 0!==V.fragment&&(ve.fragment=V.fragment),this.router.navigateByUrl(ve,V)}}}return M.\u0275fac=function(S){return new(S||M)(d.LFG(qo),d.LFG(Si.Ye),d.LFG(Tt.Hx),d.LFG(Tt.F0,8))},M.\u0275prov=d.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})();const Xr=(M,j,S)=>{if(!1!==j){if(void 0!==S)return S;if("forward"===M||"back"===M)return M;if("root"===M&&!0===j)return"forward"}},ma="auto",Yo=void 0;let wi=(()=>{class M{constructor(S,V,ve,Dt,wn,zn,xi,ti,Gi,nr,cr,yo,vo){this.parentContexts=S,this.location=V,this.config=wn,this.navCtrl=zn,this.componentFactoryResolver=xi,this.parentOutlet=vo,this.activated=null,this.activatedView=null,this._activatedRoute=null,this.proxyMap=new WeakMap,this.currentActivatedRoute$=new vt.X(null),this.stackEvents=new d.vpe,this.activateEvents=new d.vpe,this.deactivateEvents=new d.vpe,this.nativeEl=Gi.nativeElement,this.name=ve||Tt.eC,this.tabsPrefix="true"===Dt?cs(nr,yo):void 0,this.stackCtrl=new Ys(this.tabsPrefix,this.nativeEl,nr,zn,cr,ti),S.onChildOutletCreated(this.name,this)}set animation(S){this.nativeEl.animation=S}set animated(S){this.nativeEl.animated=S}set swipeGesture(S){this._swipeGesture=S,this.nativeEl.swipeHandler=S?{canStart:()=>this.stackCtrl.canGoBack(1)&&!this.stackCtrl.hasRunningTask(),onStart:()=>this.stackCtrl.startBackTransition(),onEnd:V=>this.stackCtrl.endBackTransition(V)}:void 0}ngOnDestroy(){this.stackCtrl.destroy()}getContext(){return this.parentContexts.getContext(this.name)}ngOnInit(){if(!this.activated){const S=this.getContext();S?.route&&this.activateWith(S.route,S.resolver||null)}new Promise(S=>(0,it.c)(this.nativeEl,S)).then(()=>{void 0===this._swipeGesture&&(this.swipeGesture=this.config.getBoolean("swipeBackEnabled","ios"===this.nativeEl.mode))})}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){throw new Error("incompatible reuse strategy")}attach(S,V){throw new Error("incompatible reuse strategy")}deactivate(){if(this.activated){if(this.activatedView){const V=this.getContext();this.activatedView.savedData=new Map(V.children.contexts);const ve=this.activatedView.savedData.get("primary");if(ve&&V.route&&(ve.route=Object.assign({},V.route)),this.activatedView.savedExtras={},V.route){const Dt=V.route.snapshot;this.activatedView.savedExtras.queryParams=Dt.queryParams,this.activatedView.savedExtras.fragment=Dt.fragment}}const S=this.component;this.activatedView=null,this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(S)}}activateWith(S,V){var ve;if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=S;let Dt,wn=this.stackCtrl.getExistingView(S);if(wn){Dt=this.activated=wn.ref;const zn=wn.savedData;zn&&(this.getContext().children.contexts=zn),this.updateActivatedRouteProxy(Dt.instance,S)}else{const zn=S._futureSnapshot;if(null==zn.routeConfig.component&&null==this.environmentInjector)return void console.warn('[Ionic Warning]: You must supply an environmentInjector to use standalone components with routing:\n\nIn your component class, add:\n\n   import { EnvironmentInjector } from \'@angular/core\';\n   constructor(public environmentInjector: EnvironmentInjector) {}\n\nIn your router outlet template, add:\n\n   <ion-router-outlet [environmentInjector]="environmentInjector"></ion-router-outlet>\n\nAlternatively, if you are routing within ion-tabs:\n\n   <ion-tabs [environmentInjector]="environmentInjector"></ion-tabs>');const xi=this.parentContexts.getOrCreateContext(this.name).children,ti=new vt.X(null),Gi=this.createActivatedRouteProxy(ti,S),nr=new Sa(Gi,xi,this.location.injector),cr=null!==(ve=zn.routeConfig.component)&&void 0!==ve?ve:zn.component;if((V=V||this.componentFactoryResolver)&&tr(V)){const yo=V.resolveComponentFactory(cr);Dt=this.activated=this.location.createComponent(yo,this.location.length,nr)}else Dt=this.activated=this.location.createComponent(cr,{index:this.location.length,injector:nr,environmentInjector:V??this.environmentInjector});ti.next(Dt.instance),wn=this.stackCtrl.createView(this.activated,S),this.proxyMap.set(Dt.instance,Gi),this.currentActivatedRoute$.next({component:Dt.instance,activatedRoute:S})}this.activatedView=wn,this.navCtrl.setTopOutlet(this),this.stackCtrl.setActive(wn).then(zn=>{this.activateEvents.emit(Dt.instance),this.stackEvents.emit(zn)})}canGoBack(S=1,V){return this.stackCtrl.canGoBack(S,V)}pop(S=1,V){return this.stackCtrl.pop(S,V)}getLastUrl(S){const V=this.stackCtrl.getLastUrl(S);return V?V.url:void 0}getLastRouteView(S){return this.stackCtrl.getLastUrl(S)}getRootView(S){return this.stackCtrl.getRootUrl(S)}getActiveStackId(){return this.stackCtrl.getActiveStackId()}createActivatedRouteProxy(S,V){const ve=new Tt.gz;return ve._futureSnapshot=V._futureSnapshot,ve._routerState=V._routerState,ve.snapshot=V.snapshot,ve.outlet=V.outlet,ve.component=V.component,ve._paramMap=this.proxyObservable(S,"paramMap"),ve._queryParamMap=this.proxyObservable(S,"queryParamMap"),ve.url=this.proxyObservable(S,"url"),ve.params=this.proxyObservable(S,"params"),ve.queryParams=this.proxyObservable(S,"queryParams"),ve.fragment=this.proxyObservable(S,"fragment"),ve.data=this.proxyObservable(S,"data"),ve}proxyObservable(S,V){return S.pipe((0,Kn.h)(ve=>!!ve),(0,ri.w)(ve=>this.currentActivatedRoute$.pipe((0,Kn.h)(Dt=>null!==Dt&&Dt.component===ve),(0,ri.w)(Dt=>Dt&&Dt.activatedRoute[V]),function vi(M,j=Bn.y){return M=M??Li,(0,pi.e)((S,V)=>{let ve,Dt=!0;S.subscribe((0,bi.x)(V,wn=>{const zn=j(wn);(Dt||!M(ve,zn))&&(Dt=!1,ve=zn,V.next(wn))}))})}())))}updateActivatedRouteProxy(S,V){const ve=this.proxyMap.get(S);if(!ve)throw new Error("Could not find activated route proxy for view");ve._futureSnapshot=V._futureSnapshot,ve._routerState=V._routerState,ve.snapshot=V.snapshot,ve.outlet=V.outlet,ve.component=V.component,this.currentActivatedRoute$.next({component:S,activatedRoute:V})}}return M.\u0275fac=function(S){return new(S||M)(d.Y36(Tt.y6),d.Y36(d.s_b),d.$8M("name"),d.$8M("tabs"),d.Y36(ws),d.Y36(jo),d.Y36(d._Vd,8),d.Y36(Si.Ye),d.Y36(d.SBq),d.Y36(Tt.F0),d.Y36(d.R0b),d.Y36(Tt.gz),d.Y36(M,12))},M.\u0275dir=d.lG2({type:M,selectors:[["ion-router-outlet"]],inputs:{animated:"animated",animation:"animation",mode:"mode",swipeGesture:"swipeGesture",environmentInjector:"environmentInjector"},outputs:{stackEvents:"stackEvents",activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),M})();class Sa{constructor(j,S,V){this.route=j,this.childContexts=S,this.parent=V}get(j,S){return j===Tt.gz?this.route:j===Tt.y6?this.childContexts:this.parent.get(j,S)}}let ds=(()=>{class M{constructor(S,V,ve){this.routerOutlet=S,this.navCtrl=V,this.config=ve}onClick(S){var V;const ve=this.defaultHref||this.config.get("backButtonDefaultHref");null!==(V=this.routerOutlet)&&void 0!==V&&V.canGoBack()?(this.navCtrl.setDirection("back",void 0,void 0,this.routerAnimation),this.routerOutlet.pop(),S.preventDefault()):null!=ve&&(this.navCtrl.navigateBack(ve,{animation:this.routerAnimation}),S.preventDefault())}}return M.\u0275fac=function(S){return new(S||M)(d.Y36(wi,8),d.Y36(jo),d.Y36(ws))},M.\u0275dir=d.lG2({type:M,selectors:[["ion-back-button"]],hostBindings:function(S,V){1&S&&d.NdJ("click",function(Dt){return V.onClick(Dt)})},inputs:{defaultHref:"defaultHref",routerAnimation:"routerAnimation"}}),M})(),Js=(()=>{class M{constructor(S,V,ve,Dt,wn){this.locationStrategy=S,this.navCtrl=V,this.elementRef=ve,this.router=Dt,this.routerLink=wn,this.routerDirection="forward"}ngOnInit(){this.updateTargetUrlAndHref()}ngOnChanges(){this.updateTargetUrlAndHref()}updateTargetUrlAndHref(){var S;if(null!==(S=this.routerLink)&&void 0!==S&&S.urlTree){const V=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.routerLink.urlTree));this.elementRef.nativeElement.href=V}}onClick(S){this.navCtrl.setDirection(this.routerDirection,void 0,void 0,this.routerAnimation),S.preventDefault()}}return M.\u0275fac=function(S){return new(S||M)(d.Y36(Si.S$),d.Y36(jo),d.Y36(d.SBq),d.Y36(Tt.F0),d.Y36(Tt.rH,8))},M.\u0275dir=d.lG2({type:M,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(S,V){1&S&&d.NdJ("click",function(Dt){return V.onClick(Dt)})},inputs:{routerDirection:"routerDirection",routerAnimation:"routerAnimation"},features:[d.TTD]}),M})();class dr{constructor(j){this.ctrl=j}create(j){return this.ctrl.create(j||{})}dismiss(j,S,V){return this.ctrl.dismiss(j,S,V)}getTop(){return this.ctrl.getTop()}}let hr=(()=>{class M extends dr{constructor(){super(bt.b)}}return M.\u0275fac=function(S){return new(S||M)},M.\u0275prov=d.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})(),Ts=(()=>{class M extends dr{constructor(){super(bt.a)}}return M.\u0275fac=function(S){return new(S||M)},M.\u0275prov=d.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})(),So=(()=>{class M extends dr{constructor(){super(bt.l)}}return M.\u0275fac=function(S){return new(S||M)},M.\u0275prov=d.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})();class Sn{}let Ri=(()=>{class M extends dr{constructor(S,V,ve,Dt){super(bt.m),this.angularDelegate=S,this.resolver=V,this.injector=ve,this.environmentInjector=Dt}create(S){var V;return super.create(Object.assign(Object.assign({},S),{delegate:this.angularDelegate.create(null!==(V=this.resolver)&&void 0!==V?V:this.environmentInjector,this.injector,void 0,"modal")}))}}return M.\u0275fac=function(S){return new(S||M)(d.LFG(xs),d.LFG(d._Vd),d.LFG(d.zs3),d.LFG(Sn,8))},M.\u0275prov=d.Yz7({token:M,factory:M.\u0275fac}),M})(),Pa=(()=>{class M extends dr{constructor(S,V,ve,Dt){super(bt.c),this.angularDelegate=S,this.resolver=V,this.injector=ve,this.environmentInjector=Dt}create(S){var V;return super.create(Object.assign(Object.assign({},S),{delegate:this.angularDelegate.create(null!==(V=this.resolver)&&void 0!==V?V:this.environmentInjector,this.injector,void 0,"popover")}))}}return M.\u0275fac=function(S){return new(S||M)(d.LFG(xs),d.LFG(d._Vd),d.LFG(d.zs3),d.LFG(Sn,8))},M.\u0275prov=d.Yz7({token:M,factory:M.\u0275fac}),M})(),ul=(()=>{class M extends dr{constructor(){super(bt.t)}}return M.\u0275fac=function(S){return new(S||M)},M.\u0275prov=d.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})();class Es{shouldDetach(j){return!1}shouldAttach(j){return!1}store(j,S){}retrieve(j){return null}shouldReuseRoute(j,S){if(j.routeConfig!==S.routeConfig)return!1;const V=j.params,ve=S.params,Dt=Object.keys(V),wn=Object.keys(ve);if(Dt.length!==wn.length)return!1;for(const zn of Dt)if(ve[zn]!==V[zn])return!1;return!0}}const Xo=(M,j,S)=>()=>{if(j.defaultView&&typeof window<"u"){(M=>{const j=window,S=j.Ionic;S&&S.config&&"Object"!==S.config.constructor.name||(j.Ionic=j.Ionic||{},j.Ionic.config=Object.assign(Object.assign({},j.Ionic.config),M))})(Object.assign(Object.assign({},M),{_zoneGate:Dt=>S.run(Dt)}));const ve="__zone_symbol__addEventListener"in j.body?"__zone_symbol__addEventListener":"addEventListener";return function Fi(){var M=[];if(typeof window<"u"){var j=window;(!j.customElements||j.Element&&(!j.Element.prototype.closest||!j.Element.prototype.matches||!j.Element.prototype.remove||!j.Element.prototype.getRootNode))&&M.push(k.e(6748).then(k.t.bind(k,723,23))),("function"!=typeof Object.assign||!Object.entries||!Array.prototype.find||!Array.prototype.includes||!String.prototype.startsWith||!String.prototype.endsWith||j.NodeList&&!j.NodeList.prototype.forEach||!j.fetch||!function(){try{var V=new URL("b","http://a");return V.pathname="c%20d","http://a/c%20d"===V.href&&V.searchParams}catch{return!1}}()||typeof WeakMap>"u")&&M.push(k.e(2214).then(k.t.bind(k,4144,23)))}return Promise.all(M)}().then(()=>((M,j)=>typeof window>"u"?Promise.resolve():(0,yn.p)().then(()=>(Yi(),(0,yn.b)(JSON.parse('[["ion-menu_3",[[33,"ion-menu-button",{"color":[513],"disabled":[4],"menu":[1],"autoHide":[4,"auto-hide"],"type":[1],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]],[33,"ion-menu",{"contentId":[513,"content-id"],"menuId":[513,"menu-id"],"type":[1025],"disabled":[1028],"side":[513],"swipeGesture":[4,"swipe-gesture"],"maxEdgeStart":[2,"max-edge-start"],"isPaneVisible":[32],"isEndSide":[32],"isOpen":[64],"isActive":[64],"open":[64],"close":[64],"toggle":[64],"setOpen":[64]},[[16,"ionSplitPaneVisible","onSplitPaneChanged"],[2,"click","onBackdropClick"],[0,"keydown","onKeydown"]]],[1,"ion-menu-toggle",{"menu":[1],"autoHide":[4,"auto-hide"],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]]]],["ion-fab_3",[[33,"ion-fab-button",{"color":[513],"activated":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1],"show":[4],"translucent":[4],"type":[1],"size":[1],"closeIcon":[1,"close-icon"]}],[1,"ion-fab",{"horizontal":[1],"vertical":[1],"edge":[4],"activated":[1028],"close":[64],"toggle":[64]}],[1,"ion-fab-list",{"activated":[4],"side":[1]}]]],["ion-refresher_2",[[0,"ion-refresher-content",{"pullingIcon":[1025,"pulling-icon"],"pullingText":[1,"pulling-text"],"refreshingSpinner":[1025,"refreshing-spinner"],"refreshingText":[1,"refreshing-text"]}],[32,"ion-refresher",{"pullMin":[2,"pull-min"],"pullMax":[2,"pull-max"],"closeDuration":[1,"close-duration"],"snapbackDuration":[1,"snapback-duration"],"pullFactor":[2,"pull-factor"],"disabled":[4],"nativeRefresher":[32],"state":[32],"complete":[64],"cancel":[64],"getProgress":[64]}]]],["ion-back-button",[[33,"ion-back-button",{"color":[513],"defaultHref":[1025,"default-href"],"disabled":[516],"icon":[1],"text":[1],"type":[1],"routerAnimation":[16]}]]],["ion-toast",[[33,"ion-toast",{"overlayIndex":[2,"overlay-index"],"color":[513],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"duration":[2],"header":[1],"message":[1],"keyboardClose":[4,"keyboard-close"],"position":[1],"buttons":[16],"translucent":[4],"animated":[4],"icon":[1],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-card_5",[[33,"ion-card",{"color":[513],"button":[4],"type":[1],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}],[32,"ion-card-content"],[33,"ion-card-header",{"color":[513],"translucent":[4]}],[33,"ion-card-subtitle",{"color":[513]}],[33,"ion-card-title",{"color":[513]}]]],["ion-item-option_3",[[33,"ion-item-option",{"color":[513],"disabled":[4],"download":[1],"expandable":[4],"href":[1],"rel":[1],"target":[1],"type":[1]}],[32,"ion-item-options",{"side":[1],"fireSwipeEvent":[64]}],[0,"ion-item-sliding",{"disabled":[4],"state":[32],"getOpenAmount":[64],"getSlidingRatio":[64],"open":[64],"close":[64],"closeOpened":[64]}]]],["ion-accordion_2",[[49,"ion-accordion",{"value":[1],"disabled":[4],"readonly":[4],"toggleIcon":[1,"toggle-icon"],"toggleIconSlot":[1,"toggle-icon-slot"],"state":[32],"isNext":[32],"isPrevious":[32]}],[33,"ion-accordion-group",{"animated":[4],"multiple":[4],"value":[1025],"disabled":[4],"readonly":[4],"expand":[1],"requestAccordionToggle":[64],"getAccordions":[64]},[[0,"keydown","onKeydown"]]]]],["ion-breadcrumb_2",[[33,"ion-breadcrumb",{"collapsed":[4],"last":[4],"showCollapsedIndicator":[4,"show-collapsed-indicator"],"color":[1],"active":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"separator":[4],"target":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}],[33,"ion-breadcrumbs",{"color":[1],"maxItems":[2,"max-items"],"itemsBeforeCollapse":[2,"items-before-collapse"],"itemsAfterCollapse":[2,"items-after-collapse"],"collapsed":[32],"activeChanged":[32]},[[0,"collapsedClick","onCollapsedClick"]]]]],["ion-infinite-scroll_2",[[32,"ion-infinite-scroll-content",{"loadingSpinner":[1025,"loading-spinner"],"loadingText":[1,"loading-text"]}],[0,"ion-infinite-scroll",{"threshold":[1],"disabled":[4],"position":[1],"isLoading":[32],"complete":[64]}]]],["ion-reorder_2",[[33,"ion-reorder",null,[[2,"click","onClick"]]],[0,"ion-reorder-group",{"disabled":[4],"state":[32],"complete":[64]}]]],["ion-segment_2",[[33,"ion-segment-button",{"disabled":[4],"layout":[1],"type":[1],"value":[1],"checked":[32],"setFocus":[64]}],[33,"ion-segment",{"color":[513],"disabled":[4],"scrollable":[4],"swipeGesture":[4,"swipe-gesture"],"value":[1025],"selectOnFocus":[4,"select-on-focus"],"activated":[32]},[[0,"keydown","onKeyDown"]]]]],["ion-tab-bar_2",[[33,"ion-tab-button",{"disabled":[4],"download":[1],"href":[1],"rel":[1],"layout":[1025],"selected":[1028],"tab":[1],"target":[1]},[[8,"ionTabBarChanged","onTabBarChanged"]]],[33,"ion-tab-bar",{"color":[513],"selectedTab":[1,"selected-tab"],"translucent":[4],"keyboardVisible":[32]}]]],["ion-chip",[[1,"ion-chip",{"color":[513],"outline":[4],"disabled":[4]}]]],["ion-datetime-button",[[33,"ion-datetime-button",{"color":[513],"disabled":[516],"datetime":[1],"datetimePresentation":[32],"dateText":[32],"timeText":[32],"datetimeActive":[32],"selectedButton":[32]}]]],["ion-input",[[34,"ion-input",{"fireFocusEvents":[4,"fire-focus-events"],"color":[513],"accept":[1],"autocapitalize":[1],"autocomplete":[1],"autocorrect":[1],"autofocus":[4],"clearInput":[4,"clear-input"],"clearOnEdit":[4,"clear-on-edit"],"debounce":[2],"disabled":[4],"enterkeyhint":[1],"inputmode":[1],"max":[8],"maxlength":[2],"min":[8],"minlength":[2],"multiple":[4],"name":[1],"pattern":[1],"placeholder":[1],"readonly":[4],"required":[4],"spellcheck":[4],"step":[1],"size":[2],"type":[1],"value":[1032],"hasFocus":[32],"setFocus":[64],"setBlur":[64],"getInputElement":[64]}]]],["ion-searchbar",[[34,"ion-searchbar",{"color":[513],"animated":[4],"autocomplete":[1],"autocorrect":[1],"cancelButtonIcon":[1,"cancel-button-icon"],"cancelButtonText":[1,"cancel-button-text"],"clearIcon":[1,"clear-icon"],"debounce":[2],"disabled":[4],"inputmode":[1],"enterkeyhint":[1],"placeholder":[1],"searchIcon":[1,"search-icon"],"showCancelButton":[1,"show-cancel-button"],"showClearButton":[1,"show-clear-button"],"spellcheck":[4],"type":[1],"value":[1025],"focused":[32],"noAnimate":[32],"setFocus":[64],"getInputElement":[64]}]]],["ion-toggle",[[33,"ion-toggle",{"color":[513],"name":[1],"checked":[1028],"disabled":[4],"value":[1],"enableOnOffLabels":[4,"enable-on-off-labels"],"activated":[32]}]]],["ion-avatar_3",[[33,"ion-avatar"],[33,"ion-badge",{"color":[513]}],[1,"ion-thumbnail"]]],["ion-textarea",[[34,"ion-textarea",{"fireFocusEvents":[4,"fire-focus-events"],"color":[513],"autocapitalize":[1],"autofocus":[4],"clearOnEdit":[1028,"clear-on-edit"],"debounce":[2],"disabled":[4],"inputmode":[1],"enterkeyhint":[1],"maxlength":[2],"minlength":[2],"name":[1],"placeholder":[1],"readonly":[4],"required":[4],"spellcheck":[4],"cols":[2],"rows":[2],"wrap":[1],"autoGrow":[516,"auto-grow"],"value":[1025],"hasFocus":[32],"setFocus":[64],"setBlur":[64],"getInputElement":[64]}]]],["ion-backdrop",[[33,"ion-backdrop",{"visible":[4],"tappable":[4],"stopPropagation":[4,"stop-propagation"]},[[2,"click","onMouseDown"]]]]],["ion-loading",[[34,"ion-loading",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"message":[1],"cssClass":[1,"css-class"],"duration":[2],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"spinner":[1025],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-modal",[[33,"ion-modal",{"hasController":[4,"has-controller"],"overlayIndex":[2,"overlay-index"],"delegate":[16],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"breakpoints":[16],"initialBreakpoint":[2,"initial-breakpoint"],"backdropBreakpoint":[2,"backdrop-breakpoint"],"handle":[4],"handleBehavior":[1,"handle-behavior"],"component":[1],"componentProps":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"animated":[4],"swipeToClose":[4,"swipe-to-close"],"presentingElement":[16],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"keepContentsMounted":[4,"keep-contents-mounted"],"canDismiss":[4,"can-dismiss"],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"setCurrentBreakpoint":[64],"getCurrentBreakpoint":[64]}]]],["ion-route_4",[[0,"ion-route",{"url":[1],"component":[1],"componentProps":[16],"beforeLeave":[16],"beforeEnter":[16]}],[0,"ion-route-redirect",{"from":[1],"to":[1]}],[0,"ion-router",{"root":[1],"useHash":[4,"use-hash"],"canTransition":[64],"push":[64],"back":[64],"printDebug":[64],"navChanged":[64]},[[8,"popstate","onPopState"],[4,"ionBackButton","onBackButton"]]],[1,"ion-router-link",{"color":[513],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}]]],["ion-col_3",[[1,"ion-col",{"offset":[1],"offsetXs":[1,"offset-xs"],"offsetSm":[1,"offset-sm"],"offsetMd":[1,"offset-md"],"offsetLg":[1,"offset-lg"],"offsetXl":[1,"offset-xl"],"pull":[1],"pullXs":[1,"pull-xs"],"pullSm":[1,"pull-sm"],"pullMd":[1,"pull-md"],"pullLg":[1,"pull-lg"],"pullXl":[1,"pull-xl"],"push":[1],"pushXs":[1,"push-xs"],"pushSm":[1,"push-sm"],"pushMd":[1,"push-md"],"pushLg":[1,"push-lg"],"pushXl":[1,"push-xl"],"size":[1],"sizeXs":[1,"size-xs"],"sizeSm":[1,"size-sm"],"sizeMd":[1,"size-md"],"sizeLg":[1,"size-lg"],"sizeXl":[1,"size-xl"]},[[9,"resize","onResize"]]],[1,"ion-grid",{"fixed":[4]}],[1,"ion-row"]]],["ion-nav_2",[[1,"ion-nav",{"delegate":[16],"swipeGesture":[1028,"swipe-gesture"],"animated":[4],"animation":[16],"rootParams":[16],"root":[1],"push":[64],"insert":[64],"insertPages":[64],"pop":[64],"popTo":[64],"popToRoot":[64],"removeIndex":[64],"setRoot":[64],"setPages":[64],"setRouteId":[64],"getRouteId":[64],"getActive":[64],"getByIndex":[64],"canGoBack":[64],"getPrevious":[64]}],[0,"ion-nav-link",{"component":[1],"componentProps":[16],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}]]],["ion-slide_2",[[0,"ion-slide"],[36,"ion-slides",{"options":[8],"pager":[4],"scrollbar":[4],"update":[64],"updateAutoHeight":[64],"slideTo":[64],"slideNext":[64],"slidePrev":[64],"getActiveIndex":[64],"getPreviousIndex":[64],"length":[64],"isEnd":[64],"isBeginning":[64],"startAutoplay":[64],"stopAutoplay":[64],"lockSwipeToNext":[64],"lockSwipeToPrev":[64],"lockSwipes":[64],"getSwiper":[64]}]]],["ion-tab_2",[[1,"ion-tab",{"active":[1028],"delegate":[16],"tab":[1],"component":[1],"setActive":[64]}],[1,"ion-tabs",{"useRouter":[1028,"use-router"],"selectedTab":[32],"select":[64],"getTab":[64],"getSelected":[64],"setRouteId":[64],"getRouteId":[64]}]]],["ion-img",[[1,"ion-img",{"alt":[1],"src":[1],"loadSrc":[32],"loadError":[32]}]]],["ion-progress-bar",[[33,"ion-progress-bar",{"type":[1],"reversed":[4],"value":[2],"buffer":[2],"color":[513]}]]],["ion-range",[[33,"ion-range",{"color":[513],"debounce":[2],"name":[1],"dualKnobs":[4,"dual-knobs"],"min":[2],"max":[2],"pin":[4],"pinFormatter":[16],"snaps":[4],"step":[2],"ticks":[4],"activeBarStart":[1026,"active-bar-start"],"disabled":[4],"value":[1026],"ratioA":[32],"ratioB":[32],"pressedKnob":[32]}]]],["ion-split-pane",[[33,"ion-split-pane",{"contentId":[513,"content-id"],"disabled":[4],"when":[8],"visible":[32]}]]],["ion-text",[[1,"ion-text",{"color":[513]}]]],["ion-virtual-scroll",[[0,"ion-virtual-scroll",{"approxItemHeight":[2,"approx-item-height"],"approxHeaderHeight":[2,"approx-header-height"],"approxFooterHeight":[2,"approx-footer-height"],"headerFn":[16],"footerFn":[16],"items":[16],"itemHeight":[16],"headerHeight":[16],"footerHeight":[16],"renderItem":[16],"renderHeader":[16],"renderFooter":[16],"nodeRender":[16],"domRender":[16],"totalHeight":[32],"positionForItem":[64],"checkRange":[64],"checkEnd":[64]},[[9,"resize","onResize"]]]]],["ion-picker-column-internal",[[33,"ion-picker-column-internal",{"items":[16],"value":[1032],"color":[513],"numericInput":[4,"numeric-input"],"isActive":[32],"scrollActiveItemIntoView":[64],"setValue":[64]}]]],["ion-picker-internal",[[33,"ion-picker-internal",{"exitInputMode":[64]},[[1,"touchstart","preventTouchStartPropagation"]]]]],["ion-radio_2",[[33,"ion-radio",{"color":[513],"name":[1],"disabled":[4],"value":[8],"checked":[32],"buttonTabindex":[32],"setFocus":[64],"setButtonTabindex":[64]}],[0,"ion-radio-group",{"allowEmptySelection":[4,"allow-empty-selection"],"name":[1],"value":[1032]},[[4,"keydown","onKeydown"]]]]],["ion-ripple-effect",[[1,"ion-ripple-effect",{"type":[1],"addRipple":[64]}]]],["ion-button_2",[[33,"ion-button",{"color":[513],"buttonType":[1025,"button-type"],"disabled":[516],"expand":[513],"fill":[1537],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"download":[1],"href":[1],"rel":[1],"shape":[513],"size":[513],"strong":[4],"target":[1],"type":[1],"form":[1]}],[1,"ion-icon",{"mode":[1025],"color":[1],"ios":[1],"md":[1],"flipRtl":[4,"flip-rtl"],"name":[513],"src":[1],"icon":[8],"size":[1],"lazy":[4],"sanitize":[4],"svgContent":[32],"isVisible":[32],"ariaLabel":[32]}]]],["ion-datetime_3",[[33,"ion-datetime",{"color":[1],"name":[1],"disabled":[4],"readonly":[4],"isDateEnabled":[16],"min":[1025],"max":[1025],"presentation":[1],"cancelText":[1,"cancel-text"],"doneText":[1,"done-text"],"clearText":[1,"clear-text"],"yearValues":[8,"year-values"],"monthValues":[8,"month-values"],"dayValues":[8,"day-values"],"hourValues":[8,"hour-values"],"minuteValues":[8,"minute-values"],"locale":[1],"firstDayOfWeek":[2,"first-day-of-week"],"titleSelectedDatesFormatter":[16],"multiple":[4],"value":[1025],"showDefaultTitle":[4,"show-default-title"],"showDefaultButtons":[4,"show-default-buttons"],"showClearButton":[4,"show-clear-button"],"showDefaultTimeLabel":[4,"show-default-time-label"],"hourCycle":[1,"hour-cycle"],"size":[1],"preferWheel":[4,"prefer-wheel"],"showMonthAndYear":[32],"activeParts":[32],"workingParts":[32],"isPresented":[32],"isTimePopoverOpen":[32],"confirm":[64],"reset":[64],"cancel":[64]}],[34,"ion-picker",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"columns":[16],"cssClass":[1,"css-class"],"duration":[2],"showBackdrop":[4,"show-backdrop"],"backdropDismiss":[4,"backdrop-dismiss"],"animated":[4],"htmlAttributes":[16],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"getColumn":[64]}],[32,"ion-picker-column",{"col":[16]}]]],["ion-action-sheet",[[34,"ion-action-sheet",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"header":[1],"subHeader":[1,"sub-header"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-alert",[[34,"ion-alert",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"header":[1],"subHeader":[1,"sub-header"],"message":[1],"buttons":[16],"inputs":[1040],"backdropDismiss":[4,"backdrop-dismiss"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},[[4,"keydown","onKeydown"]]]]],["ion-popover",[[33,"ion-popover",{"hasController":[4,"has-controller"],"delegate":[16],"overlayIndex":[2,"overlay-index"],"enterAnimation":[16],"leaveAnimation":[16],"component":[1],"componentProps":[16],"keyboardClose":[4,"keyboard-close"],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"event":[8],"showBackdrop":[4,"show-backdrop"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"triggerAction":[1,"trigger-action"],"trigger":[1],"size":[1],"dismissOnSelect":[4,"dismiss-on-select"],"reference":[1],"side":[1],"alignment":[1025],"arrow":[4],"isOpen":[4,"is-open"],"keyboardEvents":[4,"keyboard-events"],"keepContentsMounted":[4,"keep-contents-mounted"],"presented":[32],"presentFromTrigger":[64],"present":[64],"dismiss":[64],"getParentPopover":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-checkbox",[[33,"ion-checkbox",{"color":[513],"name":[1],"checked":[1028],"indeterminate":[1028],"disabled":[4],"value":[8]}]]],["ion-select_3",[[33,"ion-select",{"disabled":[4],"cancelText":[1,"cancel-text"],"okText":[1,"ok-text"],"placeholder":[1],"name":[1],"selectedText":[1,"selected-text"],"multiple":[4],"interface":[1],"interfaceOptions":[8,"interface-options"],"compareWith":[1,"compare-with"],"value":[1032],"isExpanded":[32],"open":[64]}],[1,"ion-select-option",{"disabled":[4],"value":[8]}],[34,"ion-select-popover",{"header":[1],"subHeader":[1,"sub-header"],"message":[1],"multiple":[4],"options":[16]},[[0,"ionChange","onSelect"]]]]],["ion-app_8",[[0,"ion-app",{"setFocus":[64]}],[1,"ion-content",{"color":[513],"fullscreen":[4],"forceOverscroll":[1028,"force-overscroll"],"scrollX":[4,"scroll-x"],"scrollY":[4,"scroll-y"],"scrollEvents":[4,"scroll-events"],"getScrollElement":[64],"getBackgroundElement":[64],"scrollToTop":[64],"scrollToBottom":[64],"scrollByPoint":[64],"scrollToPoint":[64]},[[8,"appload","onAppLoad"],[9,"resize","onResize"]]],[36,"ion-footer",{"collapse":[1],"translucent":[4],"keyboardVisible":[32]}],[36,"ion-header",{"collapse":[1],"translucent":[4]}],[1,"ion-router-outlet",{"mode":[1025],"delegate":[16],"animated":[4],"animation":[16],"swipeHandler":[16],"commit":[64],"setRouteId":[64],"getRouteId":[64]}],[33,"ion-title",{"color":[513],"size":[1]}],[33,"ion-toolbar",{"color":[513]},[[0,"ionStyle","childrenStyle"]]],[34,"ion-buttons",{"collapse":[4]}]]],["ion-spinner",[[1,"ion-spinner",{"color":[513],"duration":[2],"name":[1],"paused":[4]}]]],["ion-item_8",[[33,"ion-item-divider",{"color":[513],"sticky":[4]}],[32,"ion-item-group"],[1,"ion-skeleton-text",{"animated":[4]}],[32,"ion-list",{"lines":[1],"inset":[4],"closeSlidingItems":[64]}],[33,"ion-list-header",{"color":[513],"lines":[1]}],[49,"ion-item",{"color":[513],"button":[4],"detail":[4],"detailIcon":[1,"detail-icon"],"disabled":[4],"download":[1],"fill":[1],"shape":[1],"href":[1],"rel":[1],"lines":[1],"counter":[4],"routerAnimation":[16],"routerDirection":[1,"router-direction"],"target":[1],"type":[1],"counterFormatter":[16],"multipleInputs":[32],"focusable":[32],"counterString":[32]},[[0,"ionChange","handleIonChange"],[0,"ionColor","labelColorChanged"],[0,"ionStyle","itemStyle"]]],[34,"ion-label",{"color":[513],"position":[1],"noAnimate":[32]}],[33,"ion-note",{"color":[513]}]]]]'),j))))(0,{exclude:["ion-tabs","ion-tab"],syncQueue:!0,raf:Ii,jmp:Dt=>S.runOutsideAngular(Dt),ael(Dt,wn,zn,xi){Dt[ve](wn,zn,xi)},rel(Dt,wn,zn,xi){Dt.removeEventListener(wn,zn,xi)}}))}};let dl=(()=>{class M{static forRoot(S){return{ngModule:M,providers:[{provide:Cs,useValue:S},{provide:d.ip1,useFactory:Xo,multi:!0,deps:[Cs,Si.K0,d.R0b]}]}}}return M.\u0275fac=function(S){return new(S||M)},M.\u0275mod=d.oAB({type:M}),M.\u0275inj=d.cJS({providers:[xs,Ri,Pa],imports:[[Si.ez]]}),M})()},181:(Pn,Et,k)=>{"use strict";k.d(Et,{c:()=>Ke});var d=k(5730),y=k(3457);let te;const q=Oe=>Oe.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),re=Oe=>(void 0===te&&(te=void 0===Oe.style.animationName&&void 0!==Oe.style.webkitAnimationName?"-webkit-":""),te),b=(Oe,Q,Ye)=>{const St=Q.startsWith("animation")?re(Oe):"";Oe.style.setProperty(St+Q,Ye)},he=(Oe,Q)=>{const Ye=Q.startsWith("animation")?re(Oe):"";Oe.style.removeProperty(Ye+Q)},X=[],le=(Oe=[],Q)=>{if(void 0!==Q){const Ye=Array.isArray(Q)?Q:[Q];return[...Oe,...Ye]}return Oe},Ke=Oe=>{let Q,Ye,St,lt,_e,ke,ge,yt,Mt,gt,it,kt,Vt,Ne=[],we=[],Xe=[],We=!1,de={},oe=[],Ee=[],vt={},Tt=0,Gt=!1,Ot=!1,at=!0,Ce=!1,bt=!0,yn=!1;const Fn=Oe,cn=[],ot=[],Nt=[],bn=[],Kn=[],ri=[],Bn=[],pi=[],bi=[],vi=[],Li="function"==typeof AnimationEffect||void 0!==y.w&&"function"==typeof y.w.AnimationEffect,Si="function"==typeof Element&&"function"==typeof Element.prototype.animate&&Li,Yi=()=>vi,Je=($e,ft)=>((ft?.oneTimeCallback?ot:cn).push({c:$e,o:ft}),Vt),Qt=()=>{if(Si)vi.forEach($e=>{$e.cancel()}),vi.length=0;else{const $e=Nt.slice();(0,d.r)(()=>{$e.forEach(ft=>{he(ft,"animation-name"),he(ft,"animation-duration"),he(ft,"animation-timing-function"),he(ft,"animation-iteration-count"),he(ft,"animation-delay"),he(ft,"animation-play-state"),he(ft,"animation-fill-mode"),he(ft,"animation-direction")})})}},li=()=>{Kn.forEach($e=>{$e?.parentNode&&$e.parentNode.removeChild($e)}),Kn.length=0},gn=()=>void 0!==_e?_e:ge?ge.getFill():"both",Ue=()=>void 0!==Mt?Mt:void 0!==ke?ke:ge?ge.getDirection():"normal",se=()=>Gt?"linear":void 0!==St?St:ge?ge.getEasing():"linear",R=()=>Ot?0:void 0!==gt?gt:void 0!==Ye?Ye:ge?ge.getDuration():0,z=()=>void 0!==lt?lt:ge?ge.getIterations():1,ce=()=>void 0!==it?it:void 0!==Q?Q:ge?ge.getDelay():0,di=()=>{0!==Tt&&(Tt--,0===Tt&&((()=>{Er(),pi.forEach(Jt=>Jt()),bi.forEach(Jt=>Jt());const $e=at?1:0,ft=oe,Ft=Ee,hn=vt;Nt.forEach(Jt=>{const Vn=Jt.classList;ft.forEach(Yn=>Vn.add(Yn)),Ft.forEach(Yn=>Vn.remove(Yn));for(const Yn in hn)hn.hasOwnProperty(Yn)&&b(Jt,Yn,hn[Yn])}),cn.forEach(Jt=>Jt.c($e,Vt)),ot.forEach(Jt=>Jt.c($e,Vt)),ot.length=0,bt=!0,at&&(Ce=!0),at=!0})(),ge&&ge.animationFinish()))},Hn=($e=!0)=>{li();const ft=(Oe=>(Oe.forEach(Q=>{for(const Ye in Q)if(Q.hasOwnProperty(Ye)){const St=Q[Ye];if("easing"===Ye)Q["animation-timing-function"]=St,delete Q[Ye];else{const lt=q(Ye);lt!==Ye&&(Q[lt]=St,delete Q[Ye])}}}),Oe))(Ne);Nt.forEach(Ft=>{if(ft.length>0){const hn=((Oe=[])=>Oe.map(Q=>{const Ye=Q.offset,St=[];for(const lt in Q)Q.hasOwnProperty(lt)&&"offset"!==lt&&St.push(`${lt}: ${Q[lt]};`);return`${100*Ye}% { ${St.join(" ")} }`}).join(" "))(ft);kt=void 0!==Oe?Oe:(Oe=>{let Q=X.indexOf(Oe);return Q<0&&(Q=X.push(Oe)-1),`ion-animation-${Q}`})(hn);const Jt=((Oe,Q,Ye)=>{var St;const lt=(Oe=>{const Q=void 0!==Oe.getRootNode?Oe.getRootNode():Oe;return Q.head||Q})(Ye),_e=re(Ye),ke=lt.querySelector("#"+Oe);if(ke)return ke;const Ne=(null!==(St=Ye.ownerDocument)&&void 0!==St?St:document).createElement("style");return Ne.id=Oe,Ne.textContent=`@${_e}keyframes ${Oe} { ${Q} } @${_e}keyframes ${Oe}-alt { ${Q} }`,lt.appendChild(Ne),Ne})(kt,hn,Ft);Kn.push(Jt),b(Ft,"animation-duration",`${R()}ms`),b(Ft,"animation-timing-function",se()),b(Ft,"animation-delay",`${ce()}ms`),b(Ft,"animation-fill-mode",gn()),b(Ft,"animation-direction",Ue());const Vn=z()===1/0?"infinite":z().toString();b(Ft,"animation-iteration-count",Vn),b(Ft,"animation-play-state","paused"),$e&&b(Ft,"animation-name",`${Jt.id}-alt`),(0,d.r)(()=>{b(Ft,"animation-name",Jt.id||null)})}})},ki=($e=!0)=>{(()=>{ri.forEach(hn=>hn()),Bn.forEach(hn=>hn());const $e=we,ft=Xe,Ft=de;Nt.forEach(hn=>{const Jt=hn.classList;$e.forEach(Vn=>Jt.add(Vn)),ft.forEach(Vn=>Jt.remove(Vn));for(const Vn in Ft)Ft.hasOwnProperty(Vn)&&b(hn,Vn,Ft[Vn])})})(),Ne.length>0&&(Si?(Nt.forEach($e=>{const ft=$e.animate(Ne,{id:Fn,delay:ce(),duration:R(),easing:se(),iterations:z(),fill:gn(),direction:Ue()});ft.pause(),vi.push(ft)}),vi.length>0&&(vi[0].onfinish=()=>{di()})):Hn($e)),We=!0},Gr=$e=>{if($e=Math.min(Math.max($e,0),.9999),Si)vi.forEach(ft=>{ft.currentTime=ft.effect.getComputedTiming().delay+R()*$e,ft.pause()});else{const ft=`-${R()*$e}ms`;Nt.forEach(Ft=>{Ne.length>0&&(b(Ft,"animation-delay",ft),b(Ft,"animation-play-state","paused"))})}},Tr=$e=>{vi.forEach(ft=>{ft.effect.updateTiming({delay:ce(),duration:R(),easing:se(),iterations:z(),fill:gn(),direction:Ue()})}),void 0!==$e&&Gr($e)},Or=($e=!0,ft)=>{(0,d.r)(()=>{Nt.forEach(Ft=>{b(Ft,"animation-name",kt||null),b(Ft,"animation-duration",`${R()}ms`),b(Ft,"animation-timing-function",se()),b(Ft,"animation-delay",void 0!==ft?`-${ft*R()}ms`:`${ce()}ms`),b(Ft,"animation-fill-mode",gn()||null),b(Ft,"animation-direction",Ue()||null);const hn=z()===1/0?"infinite":z().toString();b(Ft,"animation-iteration-count",hn),$e&&b(Ft,"animation-name",`${kt}-alt`),(0,d.r)(()=>{b(Ft,"animation-name",kt||null)})})})},Xt=($e=!1,ft=!0,Ft)=>($e&&bn.forEach(hn=>{hn.update($e,ft,Ft)}),Si?Tr(Ft):Or(ft,Ft),Vt),wo=()=>{We&&(Si?vi.forEach($e=>{$e.pause()}):Nt.forEach($e=>{b($e,"animation-play-state","paused")}),yn=!0)},Qi=()=>{yt=void 0,di()},Er=()=>{yt&&clearTimeout(yt)},me=$e=>new Promise(ft=>{$e?.sync&&(Ot=!0,Je(()=>Ot=!1,{oneTimeCallback:!0})),We||ki(),Ce&&(Si?(Gr(0),Tr()):Or(),Ce=!1),bt&&(Tt=bn.length+1,bt=!1),Je(()=>ft(),{oneTimeCallback:!0}),bn.forEach(Ft=>{Ft.play()}),Si?(vi.forEach($e=>{$e.play()}),(0===Ne.length||0===Nt.length)&&di()):(()=>{if(Er(),(0,d.r)(()=>{Nt.forEach($e=>{Ne.length>0&&b($e,"animation-play-state","running")})}),0===Ne.length||0===Nt.length)di();else{const $e=ce()||0,ft=R()||0,Ft=z()||1;isFinite(Ft)&&(yt=setTimeout(Qi,$e+ft*Ft+100)),((Oe,Q)=>{let Ye;const St={passive:!0},_e=ke=>{Oe===ke.target&&(Ye&&Ye(),Er(),(0,d.r)(()=>{Nt.forEach($e=>{he($e,"animation-duration"),he($e,"animation-delay"),he($e,"animation-play-state")}),(0,d.r)(di)}))};Oe&&(Oe.addEventListener("webkitAnimationEnd",_e,St),Oe.addEventListener("animationend",_e,St),Ye=()=>{Oe.removeEventListener("webkitAnimationEnd",_e,St),Oe.removeEventListener("animationend",_e,St)})})(Nt[0])}})(),yn=!1}),ct=($e,ft)=>{const Ft=Ne[0];return void 0===Ft||void 0!==Ft.offset&&0!==Ft.offset?Ne=[{offset:0,[$e]:ft},...Ne]:Ft[$e]=ft,Vt};return Vt={parentAnimation:ge,elements:Nt,childAnimations:bn,id:Fn,animationFinish:di,from:ct,to:($e,ft)=>{const Ft=Ne[Ne.length-1];return void 0===Ft||void 0!==Ft.offset&&1!==Ft.offset?Ne=[...Ne,{offset:1,[$e]:ft}]:Ft[$e]=ft,Vt},fromTo:($e,ft,Ft)=>ct($e,ft).to($e,Ft),parent:$e=>(ge=$e,Vt),play:me,pause:()=>(bn.forEach($e=>{$e.pause()}),wo(),Vt),stop:()=>{bn.forEach($e=>{$e.stop()}),We&&(Qt(),We=!1),Gt=!1,Ot=!1,bt=!0,Mt=void 0,gt=void 0,it=void 0,Tt=0,Ce=!1,at=!0,yn=!1},destroy:$e=>(bn.forEach(ft=>{ft.destroy($e)}),($e=>{Qt(),$e&&li()})($e),Nt.length=0,bn.length=0,Ne.length=0,cn.length=0,ot.length=0,We=!1,bt=!0,Vt),keyframes:$e=>{const ft=Ne!==$e;return Ne=$e,ft&&($e=>{Si?Yi().forEach(ft=>{if(ft.effect.setKeyframes)ft.effect.setKeyframes($e);else{const Ft=new KeyframeEffect(ft.effect.target,$e,ft.effect.getTiming());ft.effect=Ft}}):Hn()})(Ne),Vt},addAnimation:$e=>{if(null!=$e)if(Array.isArray($e))for(const ft of $e)ft.parent(Vt),bn.push(ft);else $e.parent(Vt),bn.push($e);return Vt},addElement:$e=>{if(null!=$e)if(1===$e.nodeType)Nt.push($e);else if($e.length>=0)for(let ft=0;ft<$e.length;ft++)Nt.push($e[ft]);else console.error("Invalid addElement value");return Vt},update:Xt,fill:$e=>(_e=$e,Xt(!0),Vt),direction:$e=>(ke=$e,Xt(!0),Vt),iterations:$e=>(lt=$e,Xt(!0),Vt),duration:$e=>(!Si&&0===$e&&($e=1),Ye=$e,Xt(!0),Vt),easing:$e=>(St=$e,Xt(!0),Vt),delay:$e=>(Q=$e,Xt(!0),Vt),getWebAnimations:Yi,getKeyframes:()=>Ne,getFill:gn,getDirection:Ue,getDelay:ce,getIterations:z,getEasing:se,getDuration:R,afterAddRead:$e=>(pi.push($e),Vt),afterAddWrite:$e=>(bi.push($e),Vt),afterClearStyles:($e=[])=>{for(const ft of $e)vt[ft]="";return Vt},afterStyles:($e={})=>(vt=$e,Vt),afterRemoveClass:$e=>(Ee=le(Ee,$e),Vt),afterAddClass:$e=>(oe=le(oe,$e),Vt),beforeAddRead:$e=>(ri.push($e),Vt),beforeAddWrite:$e=>(Bn.push($e),Vt),beforeClearStyles:($e=[])=>{for(const ft of $e)de[ft]="";return Vt},beforeStyles:($e={})=>(de=$e,Vt),beforeRemoveClass:$e=>(Xe=le(Xe,$e),Vt),beforeAddClass:$e=>(we=le(we,$e),Vt),onFinish:Je,isRunning:()=>0!==Tt&&!yn,progressStart:($e=!1,ft)=>(bn.forEach(Ft=>{Ft.progressStart($e,ft)}),wo(),Gt=$e,We||ki(),Xt(!1,!0,ft),Vt),progressStep:$e=>(bn.forEach(ft=>{ft.progressStep($e)}),Gr($e),Vt),progressEnd:($e,ft,Ft)=>(Gt=!1,bn.forEach(hn=>{hn.progressEnd($e,ft,Ft)}),void 0!==Ft&&(gt=Ft),Ce=!1,at=!0,0===$e?(Mt="reverse"===Ue()?"normal":"reverse","reverse"===Mt&&(at=!1),Si?(Xt(),Gr(1-ft)):(it=(1-ft)*R()*-1,Xt(!1,!1))):1===$e&&(Si?(Xt(),Gr(ft)):(it=ft*R()*-1,Xt(!1,!1))),void 0!==$e&&(Je(()=>{gt=void 0,Mt=void 0,it=void 0},{oneTimeCallback:!0}),ge||me()),Vt)}}},4349:(Pn,Et,k)=>{"use strict";k.d(Et,{G:()=>q});class y{constructor(b,he,Me,Ve,X){this.id=he,this.name=Me,this.disableScroll=X,this.priority=1e6*Ve+he,this.ctrl=b}canStart(){return!!this.ctrl&&this.ctrl.canStart(this.name)}start(){return!!this.ctrl&&this.ctrl.start(this.name,this.id,this.priority)}capture(){if(!this.ctrl)return!1;const b=this.ctrl.capture(this.name,this.id,this.priority);return b&&this.disableScroll&&this.ctrl.disableScroll(this.id),b}release(){this.ctrl&&(this.ctrl.release(this.id),this.disableScroll&&this.ctrl.enableScroll(this.id))}destroy(){this.release(),this.ctrl=void 0}}class te{constructor(b,he,Me,Ve){this.id=he,this.disable=Me,this.disableScroll=Ve,this.ctrl=b}block(){if(this.ctrl){if(this.disable)for(const b of this.disable)this.ctrl.disableGesture(b,this.id);this.disableScroll&&this.ctrl.disableScroll(this.id)}}unblock(){if(this.ctrl){if(this.disable)for(const b of this.disable)this.ctrl.enableGesture(b,this.id);this.disableScroll&&this.ctrl.enableScroll(this.id)}}destroy(){this.unblock(),this.ctrl=void 0}}const l="backdrop-no-scroll",q=new class d{constructor(){this.gestureId=0,this.requestedStart=new Map,this.disabledGestures=new Map,this.disabledScroll=new Set}createGesture(b){var he;return new y(this,this.newID(),b.name,null!==(he=b.priority)&&void 0!==he?he:0,!!b.disableScroll)}createBlocker(b={}){return new te(this,this.newID(),b.disable,!!b.disableScroll)}start(b,he,Me){return this.canStart(b)?(this.requestedStart.set(he,Me),!0):(this.requestedStart.delete(he),!1)}capture(b,he,Me){if(!this.start(b,he,Me))return!1;const Ve=this.requestedStart;let X=-1e4;if(Ve.forEach(xe=>{X=Math.max(X,xe)}),X===Me){this.capturedId=he,Ve.clear();const xe=new CustomEvent("ionGestureCaptured",{detail:{gestureName:b}});return document.dispatchEvent(xe),!0}return Ve.delete(he),!1}release(b){this.requestedStart.delete(b),this.capturedId===b&&(this.capturedId=void 0)}disableGesture(b,he){let Me=this.disabledGestures.get(b);void 0===Me&&(Me=new Set,this.disabledGestures.set(b,Me)),Me.add(he)}enableGesture(b,he){const Me=this.disabledGestures.get(b);void 0!==Me&&Me.delete(he)}disableScroll(b){this.disabledScroll.add(b),1===this.disabledScroll.size&&document.body.classList.add(l)}enableScroll(b){this.disabledScroll.delete(b),0===this.disabledScroll.size&&document.body.classList.remove(l)}canStart(b){return!(void 0!==this.capturedId||this.isDisabled(b))}isCaptured(){return void 0!==this.capturedId}isScrollDisabled(){return this.disabledScroll.size>0}isDisabled(b){const he=this.disabledGestures.get(b);return!!(he&&he.size>0)}newID(){return this.gestureId++,this.gestureId}}},7593:(Pn,Et,k)=>{"use strict";k.r(Et),k.d(Et,{MENU_BACK_BUTTON_PRIORITY:()=>q,OVERLAY_BACK_BUTTON_PRIORITY:()=>l,blockHardwareBackButton:()=>y,startHardwareBackButton:()=>te});var d=k(5861);const y=()=>{document.addEventListener("backbutton",()=>{})},te=()=>{const re=document;let b=!1;re.addEventListener("backbutton",()=>{if(b)return;let he=0,Me=[];const Ve=new CustomEvent("ionBackButton",{bubbles:!1,detail:{register(fe,ze){Me.push({priority:fe,handler:ze,id:he++})}}});re.dispatchEvent(Ve);const X=function(){var fe=(0,d.Z)(function*(ze){try{if(ze?.handler){const le=ze.handler(xe);null!=le&&(yield le)}}catch(le){console.error(le)}});return function(le){return fe.apply(this,arguments)}}(),xe=()=>{if(Me.length>0){let fe={priority:Number.MIN_SAFE_INTEGER,handler:()=>{},id:-1};Me.forEach(ze=>{ze.priority>=fe.priority&&(fe=ze)}),b=!0,Me=Me.filter(ze=>ze.id!==fe.id),X(fe).then(()=>b=!1)}};xe()})},l=100,q=99},5730:(Pn,Et,k)=>{"use strict";k.d(Et,{a:()=>b,b:()=>he,c:()=>te,d:()=>ze,e:()=>le,f:()=>fe,g:()=>Me,h:()=>lt,i:()=>re,j:()=>l,k:()=>xe,l:()=>Ke,m:()=>X,n:()=>Oe,o:()=>St,p:()=>Ye,q:()=>_e,r:()=>Ve,s:()=>ke,t:()=>d,u:()=>Q});const d=(Ne,we=0)=>new Promise(Xe=>{y(Ne,we,Xe)}),y=(Ne,we=0,Xe)=>{let We,ge;const de={passive:!0},Ee=()=>{We&&We()},vt=Tt=>{(void 0===Tt||Ne===Tt.target)&&(Ee(),Xe(Tt))};return Ne&&(Ne.addEventListener("webkitTransitionEnd",vt,de),Ne.addEventListener("transitionend",vt,de),ge=setTimeout(vt,we+500),We=()=>{ge&&(clearTimeout(ge),ge=void 0),Ne.removeEventListener("webkitTransitionEnd",vt,de),Ne.removeEventListener("transitionend",vt,de)}),Ee},te=(Ne,we)=>{Ne.componentOnReady?Ne.componentOnReady().then(Xe=>we(Xe)):Ve(()=>we(Ne))},l=(Ne,we=[])=>{const Xe={};return we.forEach(We=>{Ne.hasAttribute(We)&&(null!==Ne.getAttribute(We)&&(Xe[We]=Ne.getAttribute(We)),Ne.removeAttribute(We))}),Xe},q=["role","aria-activedescendant","aria-atomic","aria-autocomplete","aria-braillelabel","aria-brailleroledescription","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colindextext","aria-colspan","aria-controls","aria-current","aria-describedby","aria-description","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowindextext","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext"],re=(Ne,we)=>{let Xe=q;return we&&we.length>0&&(Xe=Xe.filter(We=>!we.includes(We))),l(Ne,Xe)},b=(Ne,we,Xe,We)=>{var ge;if(typeof window<"u"){const oe=null===(ge=window?.Ionic)||void 0===ge?void 0:ge.config;if(oe){const Ee=oe.get("_ael");if(Ee)return Ee(Ne,we,Xe,We);if(oe._ael)return oe._ael(Ne,we,Xe,We)}}return Ne.addEventListener(we,Xe,We)},he=(Ne,we,Xe,We)=>{var ge;if(typeof window<"u"){const oe=null===(ge=window?.Ionic)||void 0===ge?void 0:ge.config;if(oe){const Ee=oe.get("_rel");if(Ee)return Ee(Ne,we,Xe,We);if(oe._rel)return oe._rel(Ne,we,Xe,We)}}return Ne.removeEventListener(we,Xe,We)},Me=(Ne,we=Ne)=>Ne.shadowRoot||we,Ve=Ne=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(Ne):"function"==typeof requestAnimationFrame?requestAnimationFrame(Ne):setTimeout(Ne),X=Ne=>!!Ne.shadowRoot&&!!Ne.attachShadow,xe=Ne=>{const we=Ne.closest("ion-item");return we?we.querySelector("ion-label"):null},fe=Ne=>{if(Ne.focus(),Ne.classList.contains("ion-focusable")){const we=Ne.closest("ion-app");we&&we.setFocus([Ne])}},ze=(Ne,we)=>{let Xe;const We=Ne.getAttribute("aria-labelledby"),ge=Ne.id;let de=null!==We&&""!==We.trim()?We:we+"-lbl",oe=null!==We&&""!==We.trim()?document.getElementById(We):xe(Ne);return oe?(null===We&&(oe.id=de),Xe=oe.textContent,oe.setAttribute("aria-hidden","true")):""!==ge.trim()&&(oe=document.querySelector(`label[for="${ge}"]`),oe&&(""!==oe.id?de=oe.id:oe.id=de=`${ge}-lbl`,Xe=oe.textContent)),{label:oe,labelId:de,labelText:Xe}},le=(Ne,we,Xe,We,ge)=>{if(Ne||X(we)){let de=we.querySelector("input.aux-input");de||(de=we.ownerDocument.createElement("input"),de.type="hidden",de.classList.add("aux-input"),we.appendChild(de)),de.disabled=ge,de.name=Xe,de.value=We||""}},Ke=(Ne,we,Xe)=>Math.max(Ne,Math.min(we,Xe)),Oe=(Ne,we)=>{if(!Ne){const Xe="ASSERT: "+we;throw console.error(Xe),new Error(Xe)}},Q=Ne=>Ne.timeStamp||Date.now(),Ye=Ne=>{if(Ne){const we=Ne.changedTouches;if(we&&we.length>0){const Xe=we[0];return{x:Xe.clientX,y:Xe.clientY}}if(void 0!==Ne.pageX)return{x:Ne.pageX,y:Ne.pageY}}return{x:0,y:0}},St=Ne=>{const we="rtl"===document.dir;switch(Ne){case"start":return we;case"end":return!we;default:throw new Error(`"${Ne}" is not a valid value for [side]. Use "start" or "end" instead.`)}},lt=(Ne,we)=>{const Xe=Ne._original||Ne;return{_original:Ne,emit:_e(Xe.emit.bind(Xe),we)}},_e=(Ne,we=0)=>{let Xe;return(...We)=>{clearTimeout(Xe),Xe=setTimeout(Ne,we,...We)}},ke=(Ne,we)=>{if(Ne??(Ne={}),we??(we={}),Ne===we)return!0;const Xe=Object.keys(Ne);if(Xe.length!==Object.keys(we).length)return!1;for(const We of Xe)if(!(We in we)||Ne[We]!==we[We])return!1;return!0}},1843:(Pn,Et,k)=>{"use strict";k.d(Et,{L:()=>l,a:()=>q,b:()=>re,c:()=>b,d:()=>he,e:()=>we,g:()=>ge,l:()=>ke,s:()=>Xe,t:()=>X});var d=k(5861),y=k(1308),te=k(5730);const l="ionViewWillEnter",q="ionViewDidEnter",re="ionViewWillLeave",b="ionViewDidLeave",he="ionViewWillUnload",X=de=>new Promise((oe,Ee)=>{(0,y.c)(()=>{xe(de),fe(de).then(vt=>{vt.animation&&vt.animation.destroy(),ze(de),oe(vt)},vt=>{ze(de),Ee(vt)})})}),xe=de=>{const oe=de.enteringEl,Ee=de.leavingEl;We(oe,Ee,de.direction),de.showGoBack?oe.classList.add("can-go-back"):oe.classList.remove("can-go-back"),Xe(oe,!1),oe.style.setProperty("pointer-events","none"),Ee&&(Xe(Ee,!1),Ee.style.setProperty("pointer-events","none"))},fe=function(){var de=(0,d.Z)(function*(oe){const Ee=yield le(oe);return Ee&&y.B.isBrowser?Ke(Ee,oe):Oe(oe)});return function(Ee){return de.apply(this,arguments)}}(),ze=de=>{const oe=de.enteringEl,Ee=de.leavingEl;oe.classList.remove("ion-page-invisible"),oe.style.removeProperty("pointer-events"),void 0!==Ee&&(Ee.classList.remove("ion-page-invisible"),Ee.style.removeProperty("pointer-events"))},le=function(){var de=(0,d.Z)(function*(oe){return oe.leavingEl&&oe.animated&&0!==oe.duration?oe.animationBuilder?oe.animationBuilder:"ios"===oe.mode?(yield Promise.resolve().then(k.bind(k,6439))).iosTransitionAnimation:(yield Promise.resolve().then(k.bind(k,7838))).mdTransitionAnimation:void 0});return function(Ee){return de.apply(this,arguments)}}(),Ke=function(){var de=(0,d.Z)(function*(oe,Ee){yield Q(Ee,!0);const vt=oe(Ee.baseEl,Ee);lt(Ee.enteringEl,Ee.leavingEl);const Tt=yield St(vt,Ee);return Ee.progressCallback&&Ee.progressCallback(void 0),Tt&&_e(Ee.enteringEl,Ee.leavingEl),{hasCompleted:Tt,animation:vt}});return function(Ee,vt){return de.apply(this,arguments)}}(),Oe=function(){var de=(0,d.Z)(function*(oe){const Ee=oe.enteringEl,vt=oe.leavingEl;return yield Q(oe,!1),lt(Ee,vt),_e(Ee,vt),{hasCompleted:!0}});return function(Ee){return de.apply(this,arguments)}}(),Q=function(){var de=(0,d.Z)(function*(oe,Ee){const Tt=(void 0!==oe.deepWait?oe.deepWait:Ee)?[we(oe.enteringEl),we(oe.leavingEl)]:[Ne(oe.enteringEl),Ne(oe.leavingEl)];yield Promise.all(Tt),yield Ye(oe.viewIsReady,oe.enteringEl)});return function(Ee,vt){return de.apply(this,arguments)}}(),Ye=function(){var de=(0,d.Z)(function*(oe,Ee){oe&&(yield oe(Ee))});return function(Ee,vt){return de.apply(this,arguments)}}(),St=(de,oe)=>{const Ee=oe.progressCallback,vt=new Promise(Tt=>{de.onFinish(Gt=>Tt(1===Gt))});return Ee?(de.progressStart(!0),Ee(de)):de.play(),vt},lt=(de,oe)=>{ke(oe,re),ke(de,l)},_e=(de,oe)=>{ke(de,q),ke(oe,b)},ke=(de,oe)=>{if(de){const Ee=new CustomEvent(oe,{bubbles:!1,cancelable:!1});de.dispatchEvent(Ee)}},Ne=de=>de?new Promise(oe=>(0,te.c)(de,oe)):Promise.resolve(),we=function(){var de=(0,d.Z)(function*(oe){const Ee=oe;if(Ee){if(null!=Ee.componentOnReady){if(null!=(yield Ee.componentOnReady()))return}else if(null!=Ee.__registerHost)return void(yield new Promise(Tt=>(0,te.r)(Tt)));yield Promise.all(Array.from(Ee.children).map(we))}});return function(Ee){return de.apply(this,arguments)}}(),Xe=(de,oe)=>{oe?(de.setAttribute("aria-hidden","true"),de.classList.add("ion-page-hidden")):(de.hidden=!1,de.removeAttribute("aria-hidden"),de.classList.remove("ion-page-hidden"))},We=(de,oe,Ee)=>{void 0!==de&&(de.style.zIndex="back"===Ee?"99":"101"),void 0!==oe&&(oe.style.zIndex="100")},ge=de=>de.classList.contains("ion-page")?de:de.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")||de},6369:(Pn,Et,k)=>{"use strict";k.d(Et,{m:()=>X});var d=k(5861),y=k(7593),te=k(5730),l=k(5179),q=k(181);const re=xe=>(0,q.c)().duration(xe?400:300),b=xe=>{let fe,ze;const le=xe.width+8,Ke=(0,q.c)(),Oe=(0,q.c)();xe.isEndSide?(fe=le+"px",ze="0px"):(fe=-le+"px",ze="0px"),Ke.addElement(xe.menuInnerEl).fromTo("transform",`translateX(${fe})`,`translateX(${ze})`);const Ye="ios"===(0,l.b)(xe),St=Ye?.2:.25;return Oe.addElement(xe.backdropEl).fromTo("opacity",.01,St),re(Ye).addAnimation([Ke,Oe])},he=xe=>{let fe,ze;const le=(0,l.b)(xe),Ke=xe.width;xe.isEndSide?(fe=-Ke+"px",ze=Ke+"px"):(fe=Ke+"px",ze=-Ke+"px");const Oe=(0,q.c)().addElement(xe.menuInnerEl).fromTo("transform",`translateX(${ze})`,"translateX(0px)"),Q=(0,q.c)().addElement(xe.contentEl).fromTo("transform","translateX(0px)",`translateX(${fe})`),Ye=(0,q.c)().addElement(xe.backdropEl).fromTo("opacity",.01,.32);return re("ios"===le).addAnimation([Oe,Q,Ye])},Me=xe=>{const fe=(0,l.b)(xe),ze=xe.width*(xe.isEndSide?-1:1)+"px",le=(0,q.c)().addElement(xe.contentEl).fromTo("transform","translateX(0px)",`translateX(${ze})`);return re("ios"===fe).addAnimation(le)},X=(()=>{const xe=new Map,fe=[],ze=function(){var yt=(0,d.Z)(function*(Mt){const gt=yield lt(Mt);return!!gt&&gt.open()});return function(gt){return yt.apply(this,arguments)}}(),le=function(){var yt=(0,d.Z)(function*(Mt){const gt=yield void 0!==Mt?lt(Mt):_e();return void 0!==gt&&gt.close()});return function(gt){return yt.apply(this,arguments)}}(),Ke=function(){var yt=(0,d.Z)(function*(Mt){const gt=yield lt(Mt);return!!gt&&gt.toggle()});return function(gt){return yt.apply(this,arguments)}}(),Oe=function(){var yt=(0,d.Z)(function*(Mt,gt){const it=yield lt(gt);return it&&(it.disabled=!Mt),it});return function(gt,it){return yt.apply(this,arguments)}}(),Q=function(){var yt=(0,d.Z)(function*(Mt,gt){const it=yield lt(gt);return it&&(it.swipeGesture=Mt),it});return function(gt,it){return yt.apply(this,arguments)}}(),Ye=function(){var yt=(0,d.Z)(function*(Mt){if(null!=Mt){const gt=yield lt(Mt);return void 0!==gt&&gt.isOpen()}return void 0!==(yield _e())});return function(gt){return yt.apply(this,arguments)}}(),St=function(){var yt=(0,d.Z)(function*(Mt){const gt=yield lt(Mt);return!!gt&&!gt.disabled});return function(gt){return yt.apply(this,arguments)}}(),lt=function(){var yt=(0,d.Z)(function*(Mt){return yield Ot(),"start"===Mt||"end"===Mt?Gt(at=>at.side===Mt&&!at.disabled)||Gt(at=>at.side===Mt):null!=Mt?Gt(it=>it.menuId===Mt):Gt(it=>!it.disabled)||(fe.length>0?fe[0].el:void 0)});return function(gt){return yt.apply(this,arguments)}}(),_e=function(){var yt=(0,d.Z)(function*(){return yield Ot(),Ee()});return function(){return yt.apply(this,arguments)}}(),ke=function(){var yt=(0,d.Z)(function*(){return yield Ot(),vt()});return function(){return yt.apply(this,arguments)}}(),Ne=function(){var yt=(0,d.Z)(function*(){return yield Ot(),Tt()});return function(){return yt.apply(this,arguments)}}(),we=(yt,Mt)=>{xe.set(yt,Mt)},ge=yt=>{const Mt=yt.side;fe.filter(gt=>gt.side===Mt&&gt!==yt).forEach(gt=>gt.disabled=!0)},de=function(){var yt=(0,d.Z)(function*(Mt,gt,it){if(Tt())return!1;if(gt){const at=yield _e();at&&Mt.el!==at&&(yield at.setOpen(!1,!1))}return Mt._setOpen(gt,it)});return function(gt,it,at){return yt.apply(this,arguments)}}(),Ee=()=>Gt(yt=>yt._isOpen),vt=()=>fe.map(yt=>yt.el),Tt=()=>fe.some(yt=>yt.isAnimating),Gt=yt=>{const Mt=fe.find(yt);if(void 0!==Mt)return Mt.el},Ot=()=>Promise.all(Array.from(document.querySelectorAll("ion-menu")).map(yt=>new Promise(Mt=>(0,te.c)(yt,Mt))));return we("reveal",Me),we("push",he),we("overlay",b),typeof document<"u"&&document.addEventListener("ionBackButton",yt=>{const Mt=Ee();Mt&&yt.detail.register(y.MENU_BACK_BUTTON_PRIORITY,()=>Mt.close())}),{registerAnimation:we,get:lt,getMenus:ke,getOpen:_e,isEnabled:St,swipeGesture:Q,isAnimating:Ne,isOpen:Ye,enable:Oe,toggle:Ke,close:le,open:ze,_getOpenSync:Ee,_createAnimation:(yt,Mt)=>{const gt=xe.get(yt);if(!gt)throw new Error("animation not registered");return gt(Mt)},_register:yt=>{fe.indexOf(yt)<0&&(yt.disabled||ge(yt),fe.push(yt))},_unregister:yt=>{const Mt=fe.indexOf(yt);Mt>-1&&fe.splice(Mt,1)},_setOpen:de,_setActiveMenu:ge}})()},3457:(Pn,Et,k)=>{"use strict";k.d(Et,{w:()=>d});const d=typeof window<"u"?window:void 0},1898:(Pn,Et,k)=>{"use strict";k.r(Et),k.d(Et,{GESTURE_CONTROLLER:()=>d.G,createGesture:()=>Me});var d=k(4349);const y=(fe,ze,le,Ke)=>{const Oe=te(fe)?{capture:!!Ke.capture,passive:!!Ke.passive}:!!Ke.capture;let Q,Ye;return fe.__zone_symbol__addEventListener?(Q="__zone_symbol__addEventListener",Ye="__zone_symbol__removeEventListener"):(Q="addEventListener",Ye="removeEventListener"),fe[Q](ze,le,Oe),()=>{fe[Ye](ze,le,Oe)}},te=fe=>{if(void 0===l)try{const ze=Object.defineProperty({},"passive",{get:()=>{l=!0}});fe.addEventListener("optsTest",()=>{},ze)}catch{l=!1}return!!l};let l;const b=fe=>fe instanceof Document?fe:fe.ownerDocument,Me=fe=>{let ze=!1,le=!1,Ke=!0,Oe=!1;const Q=Object.assign({disableScroll:!1,direction:"x",gesturePriority:0,passive:!0,maxAngle:40,threshold:10},fe),Ye=Q.canStart,St=Q.onWillStart,lt=Q.onStart,_e=Q.onEnd,ke=Q.notCaptured,Ne=Q.onMove,we=Q.threshold,Xe=Q.passive,We=Q.blurOnStart,ge={type:"pan",startX:0,startY:0,startTime:0,currentX:0,currentY:0,velocityX:0,velocityY:0,deltaX:0,deltaY:0,currentTime:0,event:void 0,data:void 0},de=((fe,ze,le)=>{const Ke=le*(Math.PI/180),Oe="x"===fe,Q=Math.cos(Ke),Ye=ze*ze;let St=0,lt=0,_e=!1,ke=0;return{start(Ne,we){St=Ne,lt=we,ke=0,_e=!0},detect(Ne,we){if(!_e)return!1;const Xe=Ne-St,We=we-lt,ge=Xe*Xe+We*We;if(ge<Ye)return!1;const de=Math.sqrt(ge),oe=(Oe?Xe:We)/de;return ke=oe>Q?1:oe<-Q?-1:0,_e=!1,!0},isGesture:()=>0!==ke,getDirection:()=>ke}})(Q.direction,Q.threshold,Q.maxAngle),oe=d.G.createGesture({name:fe.gestureName,priority:fe.gesturePriority,disableScroll:fe.disableScroll}),Tt=()=>{ze&&(Oe=!1,Ne&&Ne(ge))},Gt=()=>!!oe.capture()&&(ze=!0,Ke=!1,ge.startX=ge.currentX,ge.startY=ge.currentY,ge.startTime=ge.currentTime,St?St(ge).then(yt):yt(),!0),yt=()=>{We&&(()=>{if(typeof document<"u"){const Ce=document.activeElement;Ce?.blur&&Ce.blur()}})(),lt&&lt(ge),Ke=!0},Mt=()=>{ze=!1,le=!1,Oe=!1,Ke=!0,oe.release()},gt=Ce=>{const bt=ze,kt=Ke;if(Mt(),kt){if(Ve(ge,Ce),bt)return void(_e&&_e(ge));ke&&ke(ge)}},it=((fe,ze,le,Ke,Oe)=>{let Q,Ye,St,lt,_e,ke,Ne,we=0;const Xe=Ot=>{we=Date.now()+2e3,ze(Ot)&&(!Ye&&le&&(Ye=y(fe,"touchmove",le,Oe)),St||(St=y(Ot.target,"touchend",ge,Oe)),lt||(lt=y(Ot.target,"touchcancel",ge,Oe)))},We=Ot=>{we>Date.now()||ze(Ot)&&(!ke&&le&&(ke=y(b(fe),"mousemove",le,Oe)),Ne||(Ne=y(b(fe),"mouseup",de,Oe)))},ge=Ot=>{oe(),Ke&&Ke(Ot)},de=Ot=>{Ee(),Ke&&Ke(Ot)},oe=()=>{Ye&&Ye(),St&&St(),lt&&lt(),Ye=St=lt=void 0},Ee=()=>{ke&&ke(),Ne&&Ne(),ke=Ne=void 0},vt=()=>{oe(),Ee()},Tt=(Ot=!0)=>{Ot?(Q||(Q=y(fe,"touchstart",Xe,Oe)),_e||(_e=y(fe,"mousedown",We,Oe))):(Q&&Q(),_e&&_e(),Q=_e=void 0,vt())};return{enable:Tt,stop:vt,destroy:()=>{Tt(!1),Ke=le=ze=void 0}}})(Q.el,Ce=>{const bt=xe(Ce);return!(le||!Ke||(X(Ce,ge),ge.startX=ge.currentX,ge.startY=ge.currentY,ge.startTime=ge.currentTime=bt,ge.velocityX=ge.velocityY=ge.deltaX=ge.deltaY=0,ge.event=Ce,Ye&&!1===Ye(ge))||(oe.release(),!oe.start()))&&(le=!0,0===we?Gt():(de.start(ge.startX,ge.startY),!0))},Ce=>{ze?!Oe&&Ke&&(Oe=!0,Ve(ge,Ce),requestAnimationFrame(Tt)):(Ve(ge,Ce),de.detect(ge.currentX,ge.currentY)&&(!de.isGesture()||!Gt())&&at())},gt,{capture:!1,passive:Xe}),at=()=>{Mt(),it.stop(),ke&&ke(ge)};return{enable(Ce=!0){Ce||(ze&&gt(void 0),Mt()),it.enable(Ce)},destroy(){oe.destroy(),it.destroy()}}},Ve=(fe,ze)=>{if(!ze)return;const le=fe.currentX,Ke=fe.currentY,Oe=fe.currentTime;X(ze,fe);const Q=fe.currentX,Ye=fe.currentY,lt=(fe.currentTime=xe(ze))-Oe;if(lt>0&&lt<100){const ke=(Ye-Ke)/lt;fe.velocityX=(Q-le)/lt*.7+.3*fe.velocityX,fe.velocityY=.7*ke+.3*fe.velocityY}fe.deltaX=Q-fe.startX,fe.deltaY=Ye-fe.startY,fe.event=ze},X=(fe,ze)=>{let le=0,Ke=0;if(fe){const Oe=fe.changedTouches;if(Oe&&Oe.length>0){const Q=Oe[0];le=Q.clientX,Ke=Q.clientY}else void 0!==fe.pageX&&(le=fe.pageX,Ke=fe.pageY)}ze.currentX=le,ze.currentY=Ke},xe=fe=>fe.timeStamp||Date.now()},1308:(Pn,Et,k)=>{"use strict";k.d(Et,{B:()=>Cn,H:()=>Nt,a:()=>at,b:()=>Wn,c:()=>oi,e:()=>fr,f:()=>Rn,g:()=>Ce,h:()=>cn,i:()=>Ai,j:()=>Ue,k:()=>Ei,p:()=>Ke,r:()=>Vi,s:()=>ze});var d=k(5861);let te,l,q,re=!1,b=!1,he=!1,Me=!1,Ve=!1;const X=typeof window<"u"?window:{},xe=X.document||{head:{}},fe={$flags$:0,$resourcesUrl$:"",jmp:me=>me(),raf:me=>requestAnimationFrame(me),ael:(me,Ge,ct,zt)=>me.addEventListener(Ge,ct,zt),rel:(me,Ge,ct,zt)=>me.removeEventListener(Ge,ct,zt),ce:(me,Ge)=>new CustomEvent(me,Ge)},ze=me=>{Object.assign(fe,me)},Ke=me=>Promise.resolve(me),Oe=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replaceSync}catch{}return!1})(),Q=(me,Ge,ct,zt)=>{ct&&ct.map(([Yt,$e,ft])=>{const Ft=St(me,Yt),hn=Ye(Ge,ft),Jt=lt(Yt);fe.ael(Ft,$e,hn,Jt),(Ge.$rmListeners$=Ge.$rmListeners$||[]).push(()=>fe.rel(Ft,$e,hn,Jt))})},Ye=(me,Ge)=>ct=>{try{256&me.$flags$?me.$lazyInstance$[Ge](ct):(me.$queuedListeners$=me.$queuedListeners$||[]).push([Ge,ct])}catch(zt){Tr(zt)}},St=(me,Ge)=>4&Ge?xe:8&Ge?X:16&Ge?xe.body:me,lt=me=>0!=(2&me),Xe="s-id",We="sty-id",oe="http://www.w3.org/1999/xlink",Tt=new WeakMap,Gt=(me,Ge,ct)=>{let zt=no.get(me);Oe&&ct?(zt=zt||new CSSStyleSheet,"string"==typeof zt?zt=Ge:zt.replaceSync(Ge)):zt=Ge,no.set(me,zt)},Ot=(me,Ge,ct,zt)=>{let Yt=Mt(Ge,ct);const $e=no.get(Yt);if(me=11===me.nodeType?me:xe,$e)if("string"==typeof $e){let Ft,ft=Tt.get(me=me.head||me);ft||Tt.set(me,ft=new Set),ft.has(Yt)||(me.host&&(Ft=me.querySelector(`[${We}="${Yt}"]`))?Ft.innerHTML=$e:(Ft=xe.createElement("style"),Ft.innerHTML=$e,me.insertBefore(Ft,me.querySelector("link"))),ft&&ft.add(Yt))}else me.adoptedStyleSheets.includes($e)||(me.adoptedStyleSheets=[...me.adoptedStyleSheets,$e]);return Yt},Mt=(me,Ge)=>"sc-"+(Ge&&32&me.$flags$?me.$tagName$+"-"+Ge:me.$tagName$),gt=me=>me.replace(/\/\*!@([^\/]+)\*\/[^\{]+\{/g,"$1{"),at=me=>vr.push(me),Ce=me=>Hn(me).$modeName$,bt={},Fn=me=>"object"==(me=typeof me)||"function"===me,cn=(me,Ge,...ct)=>{let zt=null,Yt=null,$e=null,ft=!1,Ft=!1;const hn=[],Jt=Yn=>{for(let Mi=0;Mi<Yn.length;Mi++)zt=Yn[Mi],Array.isArray(zt)?Jt(zt):null!=zt&&"boolean"!=typeof zt&&((ft="function"!=typeof me&&!Fn(zt))&&(zt=String(zt)),ft&&Ft?hn[hn.length-1].$text$+=zt:hn.push(ft?ot(null,zt):zt),Ft=ft)};if(Jt(ct),Ge){Ge.key&&(Yt=Ge.key),Ge.name&&($e=Ge.name);{const Yn=Ge.className||Ge.class;Yn&&(Ge.class="object"!=typeof Yn?Yn:Object.keys(Yn).filter(Mi=>Yn[Mi]).join(" "))}}if("function"==typeof me)return me(null===Ge?{}:Ge,hn,Kn);const Vn=ot(me,null);return Vn.$attrs$=Ge,hn.length>0&&(Vn.$children$=hn),Vn.$key$=Yt,Vn.$name$=$e,Vn},ot=(me,Ge)=>({$flags$:0,$tag$:me,$text$:Ge,$elm$:null,$children$:null,$attrs$:null,$key$:null,$name$:null}),Nt={},Kn={forEach:(me,Ge)=>me.map(ri).forEach(Ge),map:(me,Ge)=>me.map(ri).map(Ge).map(Bn)},ri=me=>({vattrs:me.$attrs$,vchildren:me.$children$,vkey:me.$key$,vname:me.$name$,vtag:me.$tag$,vtext:me.$text$}),Bn=me=>{if("function"==typeof me.vtag){const ct=Object.assign({},me.vattrs);return me.vkey&&(ct.key=me.vkey),me.vname&&(ct.name=me.vname),cn(me.vtag,ct,...me.vchildren||[])}const Ge=ot(me.vtag,me.vtext);return Ge.$attrs$=me.vattrs,Ge.$children$=me.vchildren,Ge.$key$=me.vkey,Ge.$name$=me.vname,Ge},pi=(me,Ge,ct,zt,Yt,$e)=>{if(ct!==zt){let ft=Gr(me,Ge),Ft=Ge.toLowerCase();if("class"===Ge){const hn=me.classList,Jt=vi(ct),Vn=vi(zt);hn.remove(...Jt.filter(Yn=>Yn&&!Vn.includes(Yn))),hn.add(...Vn.filter(Yn=>Yn&&!Jt.includes(Yn)))}else if("style"===Ge){for(const hn in ct)(!zt||null==zt[hn])&&(hn.includes("-")?me.style.removeProperty(hn):me.style[hn]="");for(const hn in zt)(!ct||zt[hn]!==ct[hn])&&(hn.includes("-")?me.style.setProperty(hn,zt[hn]):me.style[hn]=zt[hn])}else if("key"!==Ge)if("ref"===Ge)zt&&zt(me);else if(ft||"o"!==Ge[0]||"n"!==Ge[1]){const hn=Fn(zt);if((ft||hn&&null!==zt)&&!Yt)try{if(me.tagName.includes("-"))me[Ge]=zt;else{const Vn=zt??"";"list"===Ge?ft=!1:(null==ct||me[Ge]!=Vn)&&(me[Ge]=Vn)}}catch{}let Jt=!1;Ft!==(Ft=Ft.replace(/^xlink\:?/,""))&&(Ge=Ft,Jt=!0),null==zt||!1===zt?(!1!==zt||""===me.getAttribute(Ge))&&(Jt?me.removeAttributeNS(oe,Ge):me.removeAttribute(Ge)):(!ft||4&$e||Yt)&&!hn&&(zt=!0===zt?"":zt,Jt?me.setAttributeNS(oe,Ge,zt):me.setAttribute(Ge,zt))}else Ge="-"===Ge[2]?Ge.slice(3):Gr(X,Ft)?Ft.slice(2):Ft[2]+Ge.slice(3),ct&&fe.rel(me,Ge,ct,!1),zt&&fe.ael(me,Ge,zt,!1)}},bi=/\s/,vi=me=>me?me.split(bi):[],Li=(me,Ge,ct,zt)=>{const Yt=11===Ge.$elm$.nodeType&&Ge.$elm$.host?Ge.$elm$.host:Ge.$elm$,$e=me&&me.$attrs$||bt,ft=Ge.$attrs$||bt;for(zt in $e)zt in ft||pi(Yt,zt,$e[zt],void 0,ct,Ge.$flags$);for(zt in ft)pi(Yt,zt,$e[zt],ft[zt],ct,Ge.$flags$)},Si=(me,Ge,ct,zt)=>{const Yt=Ge.$children$[ct];let ft,Ft,hn,$e=0;if(re||(he=!0,"slot"===Yt.$tag$&&(te&&zt.classList.add(te+"-s"),Yt.$flags$|=Yt.$children$?2:1)),null!==Yt.$text$)ft=Yt.$elm$=xe.createTextNode(Yt.$text$);else if(1&Yt.$flags$)ft=Yt.$elm$=xe.createTextNode("");else{if(Me||(Me="svg"===Yt.$tag$),ft=Yt.$elm$=xe.createElementNS(Me?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",2&Yt.$flags$?"slot-fb":Yt.$tag$),Me&&"foreignObject"===Yt.$tag$&&(Me=!1),Li(null,Yt,Me),(me=>null!=me)(te)&&ft["s-si"]!==te&&ft.classList.add(ft["s-si"]=te),Yt.$children$)for($e=0;$e<Yt.$children$.length;++$e)Ft=Si(me,Yt,$e,ft),Ft&&ft.appendChild(Ft);"svg"===Yt.$tag$?Me=!1:"foreignObject"===ft.tagName&&(Me=!0)}return ft["s-hn"]=q,3&Yt.$flags$&&(ft["s-sr"]=!0,ft["s-cr"]=l,ft["s-sn"]=Yt.$name$||"",hn=me&&me.$children$&&me.$children$[ct],hn&&hn.$tag$===Yt.$tag$&&me.$elm$&&Fi(me.$elm$,!1)),ft},Fi=(me,Ge)=>{fe.$flags$|=1;const ct=me.childNodes;for(let zt=ct.length-1;zt>=0;zt--){const Yt=ct[zt];Yt["s-hn"]!==q&&Yt["s-ol"]&&(Je(Yt).insertBefore(Yt,ne(Yt)),Yt["s-ol"].remove(),Yt["s-ol"]=void 0,he=!0),Ge&&Fi(Yt,Ge)}fe.$flags$&=-2},Yi=(me,Ge,ct,zt,Yt,$e)=>{let Ft,ft=me["s-cr"]&&me["s-cr"].parentNode||me;for(ft.shadowRoot&&ft.tagName===q&&(ft=ft.shadowRoot);Yt<=$e;++Yt)zt[Yt]&&(Ft=Si(null,ct,Yt,me),Ft&&(zt[Yt].$elm$=Ft,ft.insertBefore(Ft,ne(Ge))))},Zt=(me,Ge,ct,zt,Yt)=>{for(;Ge<=ct;++Ge)(zt=me[Ge])&&(Yt=zt.$elm$,fi(zt),b=!0,Yt["s-ol"]?Yt["s-ol"].remove():Fi(Yt,!0),Yt.remove())},He=(me,Ge)=>me.$tag$===Ge.$tag$&&("slot"===me.$tag$?me.$name$===Ge.$name$:me.$key$===Ge.$key$),ne=me=>me&&me["s-ol"]||me,Je=me=>(me["s-ol"]?me["s-ol"]:me).parentNode,jt=(me,Ge)=>{const ct=Ge.$elm$=me.$elm$,zt=me.$children$,Yt=Ge.$children$,$e=Ge.$tag$,ft=Ge.$text$;let Ft;null===ft?(Me="svg"===$e||"foreignObject"!==$e&&Me,"slot"===$e||Li(me,Ge,Me),null!==zt&&null!==Yt?((me,Ge,ct,zt)=>{let Ni,Nr,Yt=0,$e=0,ft=0,Ft=0,hn=Ge.length-1,Jt=Ge[0],Vn=Ge[hn],Yn=zt.length-1,Mi=zt[0],Bi=zt[Yn];for(;Yt<=hn&&$e<=Yn;)if(null==Jt)Jt=Ge[++Yt];else if(null==Vn)Vn=Ge[--hn];else if(null==Mi)Mi=zt[++$e];else if(null==Bi)Bi=zt[--Yn];else if(He(Jt,Mi))jt(Jt,Mi),Jt=Ge[++Yt],Mi=zt[++$e];else if(He(Vn,Bi))jt(Vn,Bi),Vn=Ge[--hn],Bi=zt[--Yn];else if(He(Jt,Bi))("slot"===Jt.$tag$||"slot"===Bi.$tag$)&&Fi(Jt.$elm$.parentNode,!1),jt(Jt,Bi),me.insertBefore(Jt.$elm$,Vn.$elm$.nextSibling),Jt=Ge[++Yt],Bi=zt[--Yn];else if(He(Vn,Mi))("slot"===Jt.$tag$||"slot"===Bi.$tag$)&&Fi(Vn.$elm$.parentNode,!1),jt(Vn,Mi),me.insertBefore(Vn.$elm$,Jt.$elm$),Vn=Ge[--hn],Mi=zt[++$e];else{for(ft=-1,Ft=Yt;Ft<=hn;++Ft)if(Ge[Ft]&&null!==Ge[Ft].$key$&&Ge[Ft].$key$===Mi.$key$){ft=Ft;break}ft>=0?(Nr=Ge[ft],Nr.$tag$!==Mi.$tag$?Ni=Si(Ge&&Ge[$e],ct,ft,me):(jt(Nr,Mi),Ge[ft]=void 0,Ni=Nr.$elm$),Mi=zt[++$e]):(Ni=Si(Ge&&Ge[$e],ct,$e,me),Mi=zt[++$e]),Ni&&Je(Jt.$elm$).insertBefore(Ni,ne(Jt.$elm$))}Yt>hn?Yi(me,null==zt[Yn+1]?null:zt[Yn+1].$elm$,ct,zt,$e,Yn):$e>Yn&&Zt(Ge,Yt,hn)})(ct,zt,Ge,Yt):null!==Yt?(null!==me.$text$&&(ct.textContent=""),Yi(ct,null,Ge,Yt,0,Yt.length-1)):null!==zt&&Zt(zt,0,zt.length-1),Me&&"svg"===$e&&(Me=!1)):(Ft=ct["s-cr"])?Ft.parentNode.textContent=ft:me.$text$!==ft&&(ct.data=ft)},Qt=me=>{const Ge=me.childNodes;let ct,zt,Yt,$e,ft,Ft;for(zt=0,Yt=Ge.length;zt<Yt;zt++)if(ct=Ge[zt],1===ct.nodeType){if(ct["s-sr"])for(ft=ct["s-sn"],ct.hidden=!1,$e=0;$e<Yt;$e++)if(Ft=Ge[$e].nodeType,Ge[$e]["s-hn"]!==ct["s-hn"]||""!==ft){if(1===Ft&&ft===Ge[$e].getAttribute("slot")){ct.hidden=!0;break}}else if(1===Ft||3===Ft&&""!==Ge[$e].textContent.trim()){ct.hidden=!0;break}Qt(ct)}},li=[],Ii=me=>{let Ge,ct,zt,Yt,$e,ft,Ft=0;const hn=me.childNodes,Jt=hn.length;for(;Ft<Jt;Ft++){if(Ge=hn[Ft],Ge["s-sr"]&&(ct=Ge["s-cr"])&&ct.parentNode)for(zt=ct.parentNode.childNodes,Yt=Ge["s-sn"],ft=zt.length-1;ft>=0;ft--)ct=zt[ft],!ct["s-cn"]&&!ct["s-nr"]&&ct["s-hn"]!==Ge["s-hn"]&&(tr(ct,Yt)?($e=li.find(Vn=>Vn.$nodeToRelocate$===ct),b=!0,ct["s-sn"]=ct["s-sn"]||Yt,$e?$e.$slotRefNode$=Ge:li.push({$slotRefNode$:Ge,$nodeToRelocate$:ct}),ct["s-sr"]&&li.map(Vn=>{tr(Vn.$nodeToRelocate$,ct["s-sn"])&&($e=li.find(Yn=>Yn.$nodeToRelocate$===ct),$e&&!Vn.$slotRefNode$&&(Vn.$slotRefNode$=$e.$slotRefNode$))})):li.some(Vn=>Vn.$nodeToRelocate$===ct)||li.push({$nodeToRelocate$:ct}));1===Ge.nodeType&&Ii(Ge)}},tr=(me,Ge)=>1===me.nodeType?null===me.getAttribute("slot")&&""===Ge||me.getAttribute("slot")===Ge:me["s-sn"]===Ge||""===Ge,fi=me=>{me.$attrs$&&me.$attrs$.ref&&me.$attrs$.ref(null),me.$children$&&me.$children$.map(fi)},Ai=me=>Hn(me).$hostElement$,fr=(me,Ge,ct)=>{const zt=Ai(me);return{emit:Yt=>wr(zt,Ge,{bubbles:!!(4&ct),composed:!!(2&ct),cancelable:!!(1&ct),detail:Yt})}},wr=(me,Ge,ct)=>{const zt=fe.ce(Ge,ct);return me.dispatchEvent(zt),zt},Cr=(me,Ge)=>{Ge&&!me.$onRenderResolve$&&Ge["s-p"]&&Ge["s-p"].push(new Promise(ct=>me.$onRenderResolve$=ct))},si=(me,Ge)=>{if(me.$flags$|=16,!(4&me.$flags$))return Cr(me,me.$ancestorComponent$),oi(()=>dn(me,Ge));me.$flags$|=512},dn=(me,Ge)=>{const zt=me.$lazyInstance$;let Yt;return Ge&&(me.$flags$|=256,me.$queuedListeners$&&(me.$queuedListeners$.map(([$e,ft])=>R(zt,$e,ft)),me.$queuedListeners$=null),Yt=R(zt,"componentWillLoad")),Yt=z(Yt,()=>R(zt,"componentWillRender")),z(Yt,()=>wt(me,zt,Ge))},wt=function(){var me=(0,d.Z)(function*(Ge,ct,zt){const Yt=Ge.$hostElement$,ft=Yt["s-rc"];zt&&(me=>{const Ge=me.$cmpMeta$,ct=me.$hostElement$,zt=Ge.$flags$,$e=Ot(ct.shadowRoot?ct.shadowRoot:ct.getRootNode(),Ge,me.$modeName$);10&zt&&(ct["s-sc"]=$e,ct.classList.add($e+"-h"),2&zt&&ct.classList.add($e+"-s"))})(Ge);Pt(Ge,ct),ft&&(ft.map(hn=>hn()),Yt["s-rc"]=void 0);{const hn=Yt["s-p"],Jt=()=>gn(Ge);0===hn.length?Jt():(Promise.all(hn).then(Jt),Ge.$flags$|=4,hn.length=0)}});return function(ct,zt,Yt){return me.apply(this,arguments)}}(),Pt=(me,Ge,ct)=>{try{Ge=Ge.render&&Ge.render(),me.$flags$&=-17,me.$flags$|=2,((me,Ge)=>{const ct=me.$hostElement$,zt=me.$cmpMeta$,Yt=me.$vnode$||ot(null,null),$e=(me=>me&&me.$tag$===Nt)(Ge)?Ge:cn(null,null,Ge);if(q=ct.tagName,zt.$attrsToReflect$&&($e.$attrs$=$e.$attrs$||{},zt.$attrsToReflect$.map(([ft,Ft])=>$e.$attrs$[Ft]=ct[ft])),$e.$tag$=null,$e.$flags$|=4,me.$vnode$=$e,$e.$elm$=Yt.$elm$=ct.shadowRoot||ct,te=ct["s-sc"],l=ct["s-cr"],re=0!=(1&zt.$flags$),b=!1,jt(Yt,$e),fe.$flags$|=1,he){Ii($e.$elm$);let ft,Ft,hn,Jt,Vn,Yn,Mi=0;for(;Mi<li.length;Mi++)ft=li[Mi],Ft=ft.$nodeToRelocate$,Ft["s-ol"]||(hn=xe.createTextNode(""),hn["s-nr"]=Ft,Ft.parentNode.insertBefore(Ft["s-ol"]=hn,Ft));for(Mi=0;Mi<li.length;Mi++)if(ft=li[Mi],Ft=ft.$nodeToRelocate$,ft.$slotRefNode$){for(Jt=ft.$slotRefNode$.parentNode,Vn=ft.$slotRefNode$.nextSibling,hn=Ft["s-ol"];hn=hn.previousSibling;)if(Yn=hn["s-nr"],Yn&&Yn["s-sn"]===Ft["s-sn"]&&Jt===Yn.parentNode&&(Yn=Yn.nextSibling,!Yn||!Yn["s-nr"])){Vn=Yn;break}(!Vn&&Jt!==Ft.parentNode||Ft.nextSibling!==Vn)&&Ft!==Vn&&(!Ft["s-hn"]&&Ft["s-ol"]&&(Ft["s-hn"]=Ft["s-ol"].parentNode.nodeName),Jt.insertBefore(Ft,Vn))}else 1===Ft.nodeType&&(Ft.hidden=!0)}b&&Qt($e.$elm$),fe.$flags$&=-2,li.length=0})(me,Ge)}catch(zt){Tr(zt,me.$hostElement$)}return null},gn=me=>{const ct=me.$hostElement$,Yt=me.$lazyInstance$,$e=me.$ancestorComponent$;R(Yt,"componentDidRender"),64&me.$flags$?R(Yt,"componentDidUpdate"):(me.$flags$|=64,ce(ct),R(Yt,"componentDidLoad"),me.$onReadyResolve$(ct),$e||se()),me.$onInstanceResolve$(ct),me.$onRenderResolve$&&(me.$onRenderResolve$(),me.$onRenderResolve$=void 0),512&me.$flags$&&mr(()=>si(me,!1)),me.$flags$&=-517},Ue=me=>{{const Ge=Hn(me),ct=Ge.$hostElement$.isConnected;return ct&&2==(18&Ge.$flags$)&&si(Ge,!1),ct}},se=me=>{ce(xe.documentElement),mr(()=>wr(X,"appload",{detail:{namespace:"ionic"}}))},R=(me,Ge,ct)=>{if(me&&me[Ge])try{return me[Ge](ct)}catch(zt){Tr(zt)}},z=(me,Ge)=>me&&me.then?me.then(Ge):Ge(),ce=me=>me.classList.add("hydrated"),tt=(me,Ge,ct,zt,Yt,$e,ft)=>{let Ft,hn,Jt,Vn;if(1===$e.nodeType){for(Ft=$e.getAttribute("c-id"),Ft&&(hn=Ft.split("."),(hn[0]===ft||"0"===hn[0])&&(Jt={$flags$:0,$hostId$:hn[0],$nodeId$:hn[1],$depth$:hn[2],$index$:hn[3],$tag$:$e.tagName.toLowerCase(),$elm$:$e,$attrs$:null,$children$:null,$key$:null,$name$:null,$text$:null},Ge.push(Jt),$e.removeAttribute("c-id"),me.$children$||(me.$children$=[]),me.$children$[Jt.$index$]=Jt,me=Jt,zt&&"0"===Jt.$depth$&&(zt[Jt.$index$]=Jt.$elm$))),Vn=$e.childNodes.length-1;Vn>=0;Vn--)tt(me,Ge,ct,zt,Yt,$e.childNodes[Vn],ft);if($e.shadowRoot)for(Vn=$e.shadowRoot.childNodes.length-1;Vn>=0;Vn--)tt(me,Ge,ct,zt,Yt,$e.shadowRoot.childNodes[Vn],ft)}else if(8===$e.nodeType)hn=$e.nodeValue.split("."),(hn[1]===ft||"0"===hn[1])&&(Ft=hn[0],Jt={$flags$:0,$hostId$:hn[1],$nodeId$:hn[2],$depth$:hn[3],$index$:hn[4],$elm$:$e,$attrs$:null,$children$:null,$key$:null,$name$:null,$tag$:null,$text$:null},"t"===Ft?(Jt.$elm$=$e.nextSibling,Jt.$elm$&&3===Jt.$elm$.nodeType&&(Jt.$text$=Jt.$elm$.textContent,Ge.push(Jt),$e.remove(),me.$children$||(me.$children$=[]),me.$children$[Jt.$index$]=Jt,zt&&"0"===Jt.$depth$&&(zt[Jt.$index$]=Jt.$elm$))):Jt.$hostId$===ft&&("s"===Ft?(Jt.$tag$="slot",$e["s-sn"]=hn[5]?Jt.$name$=hn[5]:"",$e["s-sr"]=!0,zt&&(Jt.$elm$=xe.createElement(Jt.$tag$),Jt.$name$&&Jt.$elm$.setAttribute("name",Jt.$name$),$e.parentNode.insertBefore(Jt.$elm$,$e),$e.remove(),"0"===Jt.$depth$&&(zt[Jt.$index$]=Jt.$elm$)),ct.push(Jt),me.$children$||(me.$children$=[]),me.$children$[Jt.$index$]=Jt):"r"===Ft&&(zt?$e.remove():(Yt["s-cr"]=$e,$e["s-cn"]=!0))));else if(me&&"style"===me.$tag$){const Yn=ot(null,$e.textContent);Yn.$elm$=$e,Yn.$index$="0",me.$children$=[Yn]}},Rt=(me,Ge)=>{if(1===me.nodeType){let ct=0;for(;ct<me.childNodes.length;ct++)Rt(me.childNodes[ct],Ge);if(me.shadowRoot)for(ct=0;ct<me.shadowRoot.childNodes.length;ct++)Rt(me.shadowRoot.childNodes[ct],Ge)}else if(8===me.nodeType){const ct=me.nodeValue.split(".");"o"===ct[0]&&(Ge.set(ct[1]+"."+ct[2],me),me.nodeValue="",me["s-en"]=ct[3])}},De=(me,Ge,ct)=>{if(Ge.$members$){me.watchers&&(Ge.$watchers$=me.watchers);const zt=Object.entries(Ge.$members$),Yt=me.prototype;if(zt.map(([$e,[ft]])=>{31&ft||2&ct&&32&ft?Object.defineProperty(Yt,$e,{get(){return((me,Ge)=>Hn(this).$instanceValues$.get(Ge))(0,$e)},set(Ft){((me,Ge,ct,zt)=>{const Yt=Hn(me),$e=Yt.$hostElement$,ft=Yt.$instanceValues$.get(Ge),Ft=Yt.$flags$,hn=Yt.$lazyInstance$;ct=((me,Ge)=>null==me||Fn(me)?me:4&Ge?"false"!==me&&(""===me||!!me):2&Ge?parseFloat(me):1&Ge?String(me):me)(ct,zt.$members$[Ge][0]);const Jt=Number.isNaN(ft)&&Number.isNaN(ct);if((!(8&Ft)||void 0===ft)&&ct!==ft&&!Jt&&(Yt.$instanceValues$.set(Ge,ct),hn)){if(zt.$watchers$&&128&Ft){const Yn=zt.$watchers$[Ge];Yn&&Yn.map(Mi=>{try{hn[Mi](ct,ft,Ge)}catch(Bi){Tr(Bi,$e)}})}2==(18&Ft)&&si(Yt,!1)}})(this,$e,Ft,Ge)},configurable:!0,enumerable:!0}):1&ct&&64&ft&&Object.defineProperty(Yt,$e,{value(...Ft){const hn=Hn(this);return hn.$onInstancePromise$.then(()=>hn.$lazyInstance$[$e](...Ft))}})}),1&ct){const $e=new Map;Yt.attributeChangedCallback=function(ft,Ft,hn){fe.jmp(()=>{const Jt=$e.get(ft);if(this.hasOwnProperty(Jt))hn=this[Jt],delete this[Jt];else if(Yt.hasOwnProperty(Jt)&&"number"==typeof this[Jt]&&this[Jt]==hn)return;this[Jt]=(null!==hn||"boolean"!=typeof this[Jt])&&hn})},me.observedAttributes=zt.filter(([ft,Ft])=>15&Ft[0]).map(([ft,Ft])=>{const hn=Ft[1]||ft;return $e.set(hn,ft),512&Ft[0]&&Ge.$attrsToReflect$.push([ft,hn]),hn})}}return me},dt=function(){var me=(0,d.Z)(function*(Ge,ct,zt,Yt,$e){if(!(32&ct.$flags$)){{if(ct.$flags$|=32,($e=Xt(zt)).then){const Jt=()=>{};$e=yield $e,Jt()}$e.isProxied||(zt.$watchers$=$e.watchers,De($e,zt,2),$e.isProxied=!0);const hn=()=>{};ct.$flags$|=8;try{new $e(ct)}catch(Jt){Tr(Jt)}ct.$flags$&=-9,ct.$flags$|=128,hn(),pt(ct.$lazyInstance$)}if($e.style){let hn=$e.style;"string"!=typeof hn&&(hn=hn[ct.$modeName$=(me=>vr.map(Ge=>Ge(me)).find(Ge=>!!Ge))(Ge)]);const Jt=Mt(zt,ct.$modeName$);if(!no.has(Jt)){const Vn=()=>{};Gt(Jt,hn,!!(1&zt.$flags$)),Vn()}}}const ft=ct.$ancestorComponent$,Ft=()=>si(ct,!0);ft&&ft["s-rc"]?ft["s-rc"].push(Ft):Ft()});return function(ct,zt,Yt,$e,ft){return me.apply(this,arguments)}}(),pt=me=>{R(me,"connectedCallback")},Dn=me=>{const Ge=me["s-cr"]=xe.createComment("");Ge["s-cn"]=!0,me.insertBefore(Ge,me.firstChild)},Wn=(me,Ge={})=>{const zt=[],Yt=Ge.exclude||[],$e=X.customElements,ft=xe.head,Ft=ft.querySelector("meta[charset]"),hn=xe.createElement("style"),Jt=[],Vn=xe.querySelectorAll(`[${We}]`);let Yn,Mi=!0,Bi=0;for(Object.assign(fe,Ge),fe.$resourcesUrl$=new URL(Ge.resourcesUrl||"./",xe.baseURI).href,fe.$flags$|=2;Bi<Vn.length;Bi++)Gt(Vn[Bi].getAttribute(We),gt(Vn[Bi].innerHTML),!0);me.map(Ni=>{Ni[1].map(Nr=>{const ir={$flags$:Nr[0],$tagName$:Nr[1],$members$:Nr[2],$listeners$:Nr[3]};ir.$members$=Nr[2],ir.$listeners$=Nr[3],ir.$attrsToReflect$=[],ir.$watchers$={};const Hr=ir.$tagName$,zr=class extends HTMLElement{constructor(lr){super(lr),ki(lr=this,ir),1&ir.$flags$&&lr.attachShadow({mode:"open",delegatesFocus:!!(16&ir.$flags$)})}connectedCallback(){Yn&&(clearTimeout(Yn),Yn=null),Mi?Jt.push(this):fe.jmp(()=>(me=>{if(!(1&fe.$flags$)){const Ge=Hn(me),ct=Ge.$cmpMeta$,zt=()=>{};if(1&Ge.$flags$)Q(me,Ge,ct.$listeners$),pt(Ge.$lazyInstance$);else{let Yt;if(Ge.$flags$|=1,Yt=me.getAttribute(Xe),Yt){if(1&ct.$flags$){const $e=Ot(me.shadowRoot,ct,me.getAttribute("s-mode"));me.classList.remove($e+"-h",$e+"-s")}((me,Ge,ct,zt)=>{const $e=me.shadowRoot,ft=[],hn=$e?[]:null,Jt=zt.$vnode$=ot(Ge,null);fe.$orgLocNodes$||Rt(xe.body,fe.$orgLocNodes$=new Map),me[Xe]=ct,me.removeAttribute(Xe),tt(Jt,ft,[],hn,me,me,ct),ft.map(Vn=>{const Yn=Vn.$hostId$+"."+Vn.$nodeId$,Mi=fe.$orgLocNodes$.get(Yn),Bi=Vn.$elm$;Mi&&""===Mi["s-en"]&&Mi.parentNode.insertBefore(Bi,Mi.nextSibling),$e||(Bi["s-hn"]=Ge,Mi&&(Bi["s-ol"]=Mi,Bi["s-ol"]["s-nr"]=Bi)),fe.$orgLocNodes$.delete(Yn)}),$e&&hn.map(Vn=>{Vn&&$e.appendChild(Vn)})})(me,ct.$tagName$,Yt,Ge)}Yt||12&ct.$flags$&&Dn(me);{let $e=me;for(;$e=$e.parentNode||$e.host;)if(1===$e.nodeType&&$e.hasAttribute("s-id")&&$e["s-p"]||$e["s-p"]){Cr(Ge,Ge.$ancestorComponent$=$e);break}}ct.$members$&&Object.entries(ct.$members$).map(([$e,[ft]])=>{if(31&ft&&me.hasOwnProperty($e)){const Ft=me[$e];delete me[$e],me[$e]=Ft}}),mr(()=>dt(me,Ge,ct))}zt()}})(this))}disconnectedCallback(){fe.jmp(()=>(me=>{if(!(1&fe.$flags$)){const Ge=Hn(this),ct=Ge.$lazyInstance$;Ge.$rmListeners$&&(Ge.$rmListeners$.map(zt=>zt()),Ge.$rmListeners$=void 0),R(ct,"disconnectedCallback")}})())}componentOnReady(){return Hn(this).$onReadyPromise$}};ir.$lazyBundleId$=Ni[0],!Yt.includes(Hr)&&!$e.get(Hr)&&(zt.push(Hr),$e.define(Hr,De(zr,ir,1)))})}),hn.innerHTML=zt+"{visibility:hidden}.hydrated{visibility:inherit}",hn.setAttribute("data-styles",""),ft.insertBefore(hn,Ft?Ft.nextSibling:ft.firstChild),Mi=!1,Jt.length?Jt.map(Ni=>Ni.connectedCallback()):fe.jmp(()=>Yn=setTimeout(se,30))},Ei=me=>{const Ge=new URL(me,fe.$resourcesUrl$);return Ge.origin!==X.location.origin?Ge.href:Ge.pathname},di=new WeakMap,Hn=me=>di.get(me),Vi=(me,Ge)=>di.set(Ge.$lazyInstance$=me,Ge),ki=(me,Ge)=>{const ct={$flags$:0,$hostElement$:me,$cmpMeta$:Ge,$instanceValues$:new Map};return ct.$onInstancePromise$=new Promise(zt=>ct.$onInstanceResolve$=zt),ct.$onReadyPromise$=new Promise(zt=>ct.$onReadyResolve$=zt),me["s-p"]=[],me["s-rc"]=[],Q(me,ct,Ge.$listeners$),di.set(me,ct)},Gr=(me,Ge)=>Ge in me,Tr=(me,Ge)=>(0,console.error)(me,Ge),Or=new Map,Xt=(me,Ge,ct)=>{const zt=me.$tagName$.replace(/-/g,"_"),Yt=me.$lazyBundleId$,$e=Or.get(Yt);return $e?$e[zt]:k(863)(`./${Yt}.entry.js`).then(ft=>(Or.set(Yt,ft),ft[zt]),Tr)},no=new Map,vr=[],eo=[],wo=[],mi=(me,Ge)=>ct=>{me.push(ct),Ve||(Ve=!0,Ge&&4&fe.$flags$?mr(Er):fe.raf(Er))},Qi=me=>{for(let Ge=0;Ge<me.length;Ge++)try{me[Ge](performance.now())}catch(ct){Tr(ct)}me.length=0},Er=()=>{Qi(eo),Qi(wo),(Ve=eo.length>0)&&fe.raf(Er)},mr=me=>Ke().then(me),Rn=mi(eo,!1),oi=mi(wo,!0),Cn={isDev:!1,isBrowser:!0,isServer:!1,isTesting:!1}},5179:(Pn,Et,k)=>{"use strict";k.d(Et,{a:()=>X,b:()=>Tt,c:()=>te,g:()=>Ve,i:()=>Gt});var d=k(1308);class y{constructor(){this.m=new Map}reset(yt){this.m=new Map(Object.entries(yt))}get(yt,Mt){const gt=this.m.get(yt);return void 0!==gt?gt:Mt}getBoolean(yt,Mt=!1){const gt=this.m.get(yt);return void 0===gt?Mt:"string"==typeof gt?"true"===gt:!!gt}getNumber(yt,Mt){const gt=parseFloat(this.m.get(yt));return isNaN(gt)?void 0!==Mt?Mt:NaN:gt}set(yt,Mt){this.m.set(yt,Mt)}}const te=new y,Me="ionic-persist-config",Ve=Ot=>xe(Ot),X=(Ot,yt)=>("string"==typeof Ot&&(yt=Ot,Ot=void 0),Ve(Ot).includes(yt)),xe=(Ot=window)=>{if(typeof Ot>"u")return[];Ot.Ionic=Ot.Ionic||{};let yt=Ot.Ionic.platforms;return null==yt&&(yt=Ot.Ionic.platforms=fe(Ot),yt.forEach(Mt=>Ot.document.documentElement.classList.add(`plt-${Mt}`))),yt},fe=Ot=>{const yt=te.get("platform");return Object.keys(Ee).filter(Mt=>{const gt=yt?.[Mt];return"function"==typeof gt?gt(Ot):Ee[Mt](Ot)})},le=Ot=>!!(de(Ot,/iPad/i)||de(Ot,/Macintosh/i)&&_e(Ot)),Q=Ot=>de(Ot,/android|sink/i),_e=Ot=>oe(Ot,"(any-pointer:coarse)"),Ne=Ot=>we(Ot)||Xe(Ot),we=Ot=>!!(Ot.cordova||Ot.phonegap||Ot.PhoneGap),Xe=Ot=>!!Ot.Capacitor?.isNative,de=(Ot,yt)=>yt.test(Ot.navigator.userAgent),oe=(Ot,yt)=>{var Mt;return null===(Mt=Ot.matchMedia)||void 0===Mt?void 0:Mt.call(Ot,yt).matches},Ee={ipad:le,iphone:Ot=>de(Ot,/iPhone/i),ios:Ot=>de(Ot,/iPhone|iPod/i)||le(Ot),android:Q,phablet:Ot=>{const yt=Ot.innerWidth,Mt=Ot.innerHeight,gt=Math.min(yt,Mt),it=Math.max(yt,Mt);return gt>390&&gt<520&&it>620&&it<800},tablet:Ot=>{const yt=Ot.innerWidth,Mt=Ot.innerHeight,gt=Math.min(yt,Mt),it=Math.max(yt,Mt);return le(Ot)||(Ot=>Q(Ot)&&!de(Ot,/mobile/i))(Ot)||gt>460&&gt<820&&it>780&&it<1400},cordova:we,capacitor:Xe,electron:Ot=>de(Ot,/electron/i),pwa:Ot=>{var yt;return!!(null!==(yt=Ot.matchMedia)&&void 0!==yt&&yt.call(Ot,"(display-mode: standalone)").matches||Ot.navigator.standalone)},mobile:_e,mobileweb:Ot=>_e(Ot)&&!Ne(Ot),desktop:Ot=>!_e(Ot),hybrid:Ne};let vt;const Tt=Ot=>Ot&&(0,d.g)(Ot)||vt,Gt=(Ot={})=>{if(typeof window>"u")return;const yt=window.document,Mt=window,gt=Mt.Ionic=Mt.Ionic||{},it={};Ot._ael&&(it.ael=Ot._ael),Ot._rel&&(it.rel=Ot._rel),Ot._ce&&(it.ce=Ot._ce),(0,d.s)(it);const at=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},(Ot=>{try{const yt=Ot.sessionStorage.getItem(Me);return null!==yt?JSON.parse(yt):{}}catch{return{}}})(Mt)),{persistConfig:!1}),gt.config),(Ot=>{const yt={};return Ot.location.search.slice(1).split("&").map(Mt=>Mt.split("=")).map(([Mt,gt])=>[decodeURIComponent(Mt),decodeURIComponent(gt)]).filter(([Mt])=>((Ot,yt)=>Ot.substr(0,yt.length)===yt)(Mt,"ionic:")).map(([Mt,gt])=>[Mt.slice("ionic:".length),gt]).forEach(([Mt,gt])=>{yt[Mt]=gt}),yt})(Mt)),Ot);te.reset(at),te.getBoolean("persistConfig")&&((Ot,yt)=>{try{Ot.sessionStorage.setItem(Me,JSON.stringify(yt))}catch{return}})(Mt,at),xe(Mt),gt.config=te,gt.mode=vt=te.get("mode",yt.documentElement.getAttribute("mode")||(X(Mt,"ios")?"ios":"md")),te.set("mode",vt),yt.documentElement.setAttribute("mode",vt),yt.documentElement.classList.add(vt),te.getBoolean("_testing")&&te.set("animated",!1);const Ce=kt=>{var Vt;return null===(Vt=kt.tagName)||void 0===Vt?void 0:Vt.startsWith("ION-")},bt=kt=>["ios","md"].includes(kt);(0,d.a)(kt=>{for(;kt;){const Vt=kt.mode||kt.getAttribute("mode");if(Vt){if(bt(Vt))return Vt;Ce(kt)&&console.warn('Invalid ionic mode: "'+Vt+'", expected: "ios" or "md"')}kt=kt.parentElement}return vt})}},6439:(Pn,Et,k)=>{"use strict";k.r(Et),k.d(Et,{iosTransitionAnimation:()=>fe,shadow:()=>b});var d=k(181),y=k(1843);k(3457),k(1308);const re=ze=>document.querySelector(`${ze}.ion-cloned-element`),b=ze=>ze.shadowRoot||ze,he=ze=>{const le="ION-TABS"===ze.tagName?ze:ze.querySelector("ion-tabs"),Ke="ion-content ion-header:not(.header-collapse-condense-inactive) ion-title.title-large";if(null!=le){const Oe=le.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");return null!=Oe?Oe.querySelector(Ke):null}return ze.querySelector(Ke)},Me=(ze,le)=>{const Ke="ION-TABS"===ze.tagName?ze:ze.querySelector("ion-tabs");let Oe=[];if(null!=Ke){const Q=Ke.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");null!=Q&&(Oe=Q.querySelectorAll("ion-buttons"))}else Oe=ze.querySelectorAll("ion-buttons");for(const Q of Oe){const Ye=Q.closest("ion-header"),St=Ye&&!Ye.classList.contains("header-collapse-condense-inactive"),lt=Q.querySelector("ion-back-button"),_e=Q.classList.contains("buttons-collapse");if(null!==lt&&("start"===Q.slot||""===Q.slot)&&(_e&&St&&le||!_e))return lt}return null},X=(ze,le,Ke,Oe,Q,Ye)=>{const St=le?`calc(100% - ${Ye.right+4}px)`:Ye.left-4+"px",lt=le?"7px":"-7px",_e=le?"-4px":"4px",ke=le?"-4px":"4px",Ne=le?"right":"left",we=le?"left":"right",ge=Ke?[{offset:0,opacity:1,transform:`translate3d(${_e}, ${Ye.top-46}px, 0) scale(1)`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${lt}, ${Q.top-40}px, 0) scale(2.1)`}]:[{offset:0,opacity:0,transform:`translate3d(${lt}, ${Q.top-40}px, 0) scale(2.1)`},{offset:1,opacity:1,transform:`translate3d(${_e}, ${Ye.top-46}px, 0) scale(1)`}],Ee=Ke?[{offset:0,opacity:1,transform:`translate3d(${ke}, ${Ye.top-46}px, 0) scale(1)`},{offset:.2,opacity:0,transform:`translate3d(${ke}, ${Ye.top-41}px, 0) scale(0.6)`},{offset:1,opacity:0,transform:`translate3d(${ke}, ${Ye.top-41}px, 0) scale(0.6)`}]:[{offset:0,opacity:0,transform:`translate3d(${ke}, ${Ye.top-41}px, 0) scale(0.6)`},{offset:1,opacity:1,transform:`translate3d(${ke}, ${Ye.top-46}px, 0) scale(1)`}],vt=(0,d.c)(),Tt=(0,d.c)(),Gt=re("ion-back-button"),Ot=b(Gt).querySelector(".button-text"),yt=b(Gt).querySelector("ion-icon");Gt.text=Oe.text,Gt.mode=Oe.mode,Gt.icon=Oe.icon,Gt.color=Oe.color,Gt.disabled=Oe.disabled,Gt.style.setProperty("display","block"),Gt.style.setProperty("position","fixed"),Tt.addElement(yt),vt.addElement(Ot),vt.beforeStyles({"transform-origin":`${Ne} center`}).beforeAddWrite(()=>{Oe.style.setProperty("display","none"),Gt.style.setProperty(Ne,St)}).afterAddWrite(()=>{Oe.style.setProperty("display",""),Gt.style.setProperty("display","none"),Gt.style.removeProperty(Ne)}).keyframes(ge),Tt.beforeStyles({"transform-origin":`${we} center`}).keyframes(Ee),ze.addAnimation([vt,Tt])},xe=(ze,le,Ke,Oe,Q,Ye)=>{const St=le?`calc(100% - ${Q.right}px)`:`${Q.left}px`,lt=le?"-18px":"18px",_e=le?"right":"left",we=Ke?[{offset:0,opacity:0,transform:`translate3d(${lt}, ${Ye.top-4}px, 0) scale(0.49)`},{offset:.1,opacity:0},{offset:1,opacity:1,transform:`translate3d(0, ${Q.top-2}px, 0) scale(1)`}]:[{offset:0,opacity:.99,transform:`translate3d(0, ${Q.top-2}px, 0) scale(1)`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${lt}, ${Ye.top-4}px, 0) scale(0.5)`}],Xe=re("ion-title"),We=(0,d.c)();Xe.innerText=Oe.innerText,Xe.size=Oe.size,Xe.color=Oe.color,We.addElement(Xe),We.beforeStyles({"transform-origin":`${_e} center`,height:"46px",display:"",position:"relative",[_e]:St}).beforeAddWrite(()=>{Oe.style.setProperty("display","none")}).afterAddWrite(()=>{Oe.style.setProperty("display",""),Xe.style.setProperty("display","none")}).keyframes(we),ze.addAnimation(We)},fe=(ze,le)=>{var Ke;try{const Oe="cubic-bezier(0.32,0.72,0,1)",Q="opacity",Ye="transform",St="0%",_e="rtl"===ze.ownerDocument.dir,ke=_e?"-99.5%":"99.5%",Ne=_e?"33%":"-33%",we=le.enteringEl,Xe=le.leavingEl,We="back"===le.direction,ge=we.querySelector(":scope > ion-content"),de=we.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *"),oe=we.querySelectorAll(":scope > ion-header > ion-toolbar"),Ee=(0,d.c)(),vt=(0,d.c)();if(Ee.addElement(we).duration((null!==(Ke=le.duration)&&void 0!==Ke?Ke:0)||540).easing(le.easing||Oe).fill("both").beforeRemoveClass("ion-page-invisible"),Xe&&null!=ze){const yt=(0,d.c)();yt.addElement(ze),Ee.addAnimation(yt)}if(ge||0!==oe.length||0!==de.length?(vt.addElement(ge),vt.addElement(de)):vt.addElement(we.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),Ee.addAnimation(vt),We?vt.beforeClearStyles([Q]).fromTo("transform",`translateX(${Ne})`,`translateX(${St})`).fromTo(Q,.8,1):vt.beforeClearStyles([Q]).fromTo("transform",`translateX(${ke})`,`translateX(${St})`),ge){const yt=b(ge).querySelector(".transition-effect");if(yt){const Mt=yt.querySelector(".transition-cover"),gt=yt.querySelector(".transition-shadow"),it=(0,d.c)(),at=(0,d.c)(),Ce=(0,d.c)();it.addElement(yt).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),at.addElement(Mt).beforeClearStyles([Q]).fromTo(Q,0,.1),Ce.addElement(gt).beforeClearStyles([Q]).fromTo(Q,.03,.7),it.addAnimation([at,Ce]),vt.addAnimation([it])}}const Tt=we.querySelector("ion-header.header-collapse-condense"),{forward:Gt,backward:Ot}=((ze,le,Ke,Oe,Q)=>{const Ye=Me(Oe,Ke),St=he(Q),lt=he(Oe),_e=Me(Q,Ke),ke=null!==Ye&&null!==St&&!Ke,Ne=null!==lt&&null!==_e&&Ke;if(ke){const we=St.getBoundingClientRect(),Xe=Ye.getBoundingClientRect();xe(ze,le,Ke,St,we,Xe),X(ze,le,Ke,Ye,we,Xe)}else if(Ne){const we=lt.getBoundingClientRect(),Xe=_e.getBoundingClientRect();xe(ze,le,Ke,lt,we,Xe),X(ze,le,Ke,_e,we,Xe)}return{forward:ke,backward:Ne}})(Ee,_e,We,we,Xe);if(oe.forEach(yt=>{const Mt=(0,d.c)();Mt.addElement(yt),Ee.addAnimation(Mt);const gt=(0,d.c)();gt.addElement(yt.querySelector("ion-title"));const it=(0,d.c)(),at=Array.from(yt.querySelectorAll("ion-buttons,[menuToggle]")),Ce=yt.closest("ion-header"),bt=Ce?.classList.contains("header-collapse-condense-inactive");let kt;kt=at.filter(We?ot=>{const Nt=ot.classList.contains("buttons-collapse");return Nt&&!bt||!Nt}:ot=>!ot.classList.contains("buttons-collapse")),it.addElement(kt);const Vt=(0,d.c)();Vt.addElement(yt.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])"));const yn=(0,d.c)();yn.addElement(b(yt).querySelector(".toolbar-background"));const Fn=(0,d.c)(),cn=yt.querySelector("ion-back-button");if(cn&&Fn.addElement(cn),Mt.addAnimation([gt,it,Vt,yn,Fn]),it.fromTo(Q,.01,1),Vt.fromTo(Q,.01,1),We)bt||gt.fromTo("transform",`translateX(${Ne})`,`translateX(${St})`).fromTo(Q,.01,1),Vt.fromTo("transform",`translateX(${Ne})`,`translateX(${St})`),Fn.fromTo(Q,.01,1);else if(Tt||gt.fromTo("transform",`translateX(${ke})`,`translateX(${St})`).fromTo(Q,.01,1),Vt.fromTo("transform",`translateX(${ke})`,`translateX(${St})`),yn.beforeClearStyles([Q,"transform"]),Ce?.translucent?yn.fromTo("transform",_e?"translateX(-100%)":"translateX(100%)","translateX(0px)"):yn.fromTo(Q,.01,"var(--opacity)"),Gt||Fn.fromTo(Q,.01,1),cn&&!Gt){const Nt=(0,d.c)();Nt.addElement(b(cn).querySelector(".button-text")).fromTo("transform",_e?"translateX(-100px)":"translateX(100px)","translateX(0px)"),Mt.addAnimation(Nt)}}),Xe){const yt=(0,d.c)(),Mt=Xe.querySelector(":scope > ion-content"),gt=Xe.querySelectorAll(":scope > ion-header > ion-toolbar"),it=Xe.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *");if(Mt||0!==gt.length||0!==it.length?(yt.addElement(Mt),yt.addElement(it)):yt.addElement(Xe.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),Ee.addAnimation(yt),We){yt.beforeClearStyles([Q]).fromTo("transform",`translateX(${St})`,_e?"translateX(-100%)":"translateX(100%)");const at=(0,y.g)(Xe);Ee.afterAddWrite(()=>{"normal"===Ee.getDirection()&&at.style.setProperty("display","none")})}else yt.fromTo("transform",`translateX(${St})`,`translateX(${Ne})`).fromTo(Q,1,.8);if(Mt){const at=b(Mt).querySelector(".transition-effect");if(at){const Ce=at.querySelector(".transition-cover"),bt=at.querySelector(".transition-shadow"),kt=(0,d.c)(),Vt=(0,d.c)(),yn=(0,d.c)();kt.addElement(at).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),Vt.addElement(Ce).beforeClearStyles([Q]).fromTo(Q,.1,0),yn.addElement(bt).beforeClearStyles([Q]).fromTo(Q,.7,.03),kt.addAnimation([Vt,yn]),yt.addAnimation([kt])}}gt.forEach(at=>{const Ce=(0,d.c)();Ce.addElement(at);const bt=(0,d.c)();bt.addElement(at.querySelector("ion-title"));const kt=(0,d.c)(),Vt=at.querySelectorAll("ion-buttons,[menuToggle]"),yn=at.closest("ion-header"),Fn=yn?.classList.contains("header-collapse-condense-inactive"),cn=Array.from(Vt).filter(Bn=>{const pi=Bn.classList.contains("buttons-collapse");return pi&&!Fn||!pi});kt.addElement(cn);const ot=(0,d.c)(),Nt=at.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])");Nt.length>0&&ot.addElement(Nt);const bn=(0,d.c)();bn.addElement(b(at).querySelector(".toolbar-background"));const Kn=(0,d.c)(),ri=at.querySelector("ion-back-button");if(ri&&Kn.addElement(ri),Ce.addAnimation([bt,kt,ot,Kn,bn]),Ee.addAnimation(Ce),Kn.fromTo(Q,.99,0),kt.fromTo(Q,.99,0),ot.fromTo(Q,.99,0),We){if(Fn||bt.fromTo("transform",`translateX(${St})`,_e?"translateX(-100%)":"translateX(100%)").fromTo(Q,.99,0),ot.fromTo("transform",`translateX(${St})`,_e?"translateX(-100%)":"translateX(100%)"),bn.beforeClearStyles([Q,"transform"]),yn?.translucent?bn.fromTo("transform","translateX(0px)",_e?"translateX(-100%)":"translateX(100%)"):bn.fromTo(Q,"var(--opacity)",0),ri&&!Ot){const pi=(0,d.c)();pi.addElement(b(ri).querySelector(".button-text")).fromTo("transform",`translateX(${St})`,`translateX(${(_e?-124:124)+"px"})`),Ce.addAnimation(pi)}}else Fn||bt.fromTo("transform",`translateX(${St})`,`translateX(${Ne})`).fromTo(Q,.99,0).afterClearStyles([Ye,Q]),ot.fromTo("transform",`translateX(${St})`,`translateX(${Ne})`).afterClearStyles([Ye,Q]),Kn.afterClearStyles([Q]),bt.afterClearStyles([Q]),kt.afterClearStyles([Q])})}return Ee}catch(Oe){throw Oe}}},7838:(Pn,Et,k)=>{"use strict";k.r(Et),k.d(Et,{mdTransitionAnimation:()=>q});var d=k(181),y=k(1843);k(3457),k(1308);const q=(re,b)=>{var he,Me,Ve;const X="40px",fe="back"===b.direction,le=b.leavingEl,Ke=(0,y.g)(b.enteringEl),Oe=Ke.querySelector("ion-toolbar"),Q=(0,d.c)();if(Q.addElement(Ke).fill("both").beforeRemoveClass("ion-page-invisible"),fe?Q.duration((null!==(he=b.duration)&&void 0!==he?he:0)||200).easing("cubic-bezier(0.47,0,0.745,0.715)"):Q.duration((null!==(Me=b.duration)&&void 0!==Me?Me:0)||280).easing("cubic-bezier(0.36,0.66,0.04,1)").fromTo("transform",`translateY(${X})`,"translateY(0px)").fromTo("opacity",.01,1),Oe){const Ye=(0,d.c)();Ye.addElement(Oe),Q.addAnimation(Ye)}if(le&&fe){Q.duration((null!==(Ve=b.duration)&&void 0!==Ve?Ve:0)||200).easing("cubic-bezier(0.47,0,0.745,0.715)");const Ye=(0,d.c)();Ye.addElement((0,y.g)(le)).onFinish(St=>{1===St&&Ye.elements.length>0&&Ye.elements[0].style.setProperty("display","none")}).fromTo("transform","translateY(0px)",`translateY(${X})`).fromTo("opacity",1,0),Q.addAnimation(Ye)}return Q}},7996:(Pn,Et,k)=>{"use strict";k.d(Et,{B:()=>Mt,G:()=>gt,a:()=>he,b:()=>Me,c:()=>fe,d:()=>We,e:()=>le,f:()=>de,g:()=>vt,h:()=>re,i:()=>Gt,j:()=>Q,k:()=>we,l:()=>Ve,m:()=>X,s:()=>yt,t:()=>ze});var d=k(5861),y=k(5179),te=k(7593),l=k(5730);let q=0;const re=new WeakMap,b=it=>({create:at=>Ke(it,at),dismiss:(at,Ce,bt)=>ke(document,at,Ce,it,bt),getTop:()=>(0,d.Z)(function*(){return we(document,it)})()}),he=b("ion-alert"),Me=b("ion-action-sheet"),Ve=b("ion-loading"),X=b("ion-modal"),fe=b("ion-popover"),ze=b("ion-toast"),le=it=>{typeof document<"u"&&_e(document);const at=q++;it.overlayIndex=at,it.hasAttribute("id")||(it.id=`ion-overlay-${at}`)},Ke=(it,at)=>typeof window<"u"&&typeof window.customElements<"u"?window.customElements.whenDefined(it).then(()=>{const Ce=document.createElement(it);return Ce.classList.add("overlay-hidden"),Object.assign(Ce,Object.assign(Object.assign({},at),{hasController:!0})),oe(document).appendChild(Ce),new Promise(bt=>(0,l.c)(Ce,bt))}):Promise.resolve(),Oe='[tabindex]:not([tabindex^="-"]):not([hidden]):not([disabled]), input:not([type=hidden]):not([tabindex^="-"]):not([hidden]):not([disabled]), textarea:not([tabindex^="-"]):not([hidden]):not([disabled]), button:not([tabindex^="-"]):not([hidden]):not([disabled]), select:not([tabindex^="-"]):not([hidden]):not([disabled]), .ion-focusable:not([tabindex^="-"]):not([hidden]):not([disabled]), .ion-focusable[disabled="false"]:not([tabindex^="-"]):not([hidden])',Q=(it,at)=>{let Ce=it.querySelector(Oe);const bt=Ce?.shadowRoot;bt&&(Ce=bt.querySelector(Oe)||Ce),Ce?(0,l.f)(Ce):at.focus()},St=(it,at)=>{const Ce=Array.from(it.querySelectorAll(Oe));let bt=Ce.length>0?Ce[Ce.length-1]:null;const kt=bt?.shadowRoot;kt&&(bt=kt.querySelector(Oe)||bt),bt?bt.focus():at.focus()},_e=it=>{0===q&&(q=1,it.addEventListener("focus",at=>{((it,at)=>{const Ce=we(at,"ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker,ion-popover"),bt=it.target;Ce&&bt&&!Ce.classList.contains("ion-disable-focus-trap")&&(Ce.shadowRoot?(()=>{if(Ce.contains(bt))Ce.lastFocus=bt;else{const yn=Ce.lastFocus;Q(Ce,Ce),yn===at.activeElement&&St(Ce,Ce),Ce.lastFocus=at.activeElement}})():(()=>{if(Ce===bt)Ce.lastFocus=void 0;else{const yn=(0,l.g)(Ce);if(!yn.contains(bt))return;const Fn=yn.querySelector(".ion-overlay-wrapper");if(!Fn)return;if(Fn.contains(bt))Ce.lastFocus=bt;else{const cn=Ce.lastFocus;Q(Fn,Ce),cn===at.activeElement&&St(Fn,Ce),Ce.lastFocus=at.activeElement}}})())})(at,it)},!0),it.addEventListener("ionBackButton",at=>{const Ce=we(it);Ce?.backdropDismiss&&at.detail.register(te.OVERLAY_BACK_BUTTON_PRIORITY,()=>Ce.dismiss(void 0,Mt))}),it.addEventListener("keyup",at=>{if("Escape"===at.key){const Ce=we(it);Ce?.backdropDismiss&&Ce.dismiss(void 0,Mt)}}))},ke=(it,at,Ce,bt,kt)=>{const Vt=we(it,bt,kt);return Vt?Vt.dismiss(at,Ce):Promise.reject("overlay does not exist")},we=(it,at,Ce)=>{const bt=((it,at)=>(void 0===at&&(at="ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker,ion-popover,ion-toast"),Array.from(it.querySelectorAll(at)).filter(Ce=>Ce.overlayIndex>0)))(it,at).filter(kt=>!(it=>it.classList.contains("overlay-hidden"))(kt));return void 0===Ce?bt[bt.length-1]:bt.find(kt=>kt.id===Ce)},Xe=(it=!1)=>{const Ce=oe(document).querySelector("ion-router-outlet, ion-nav, #ion-view-container-root");Ce&&(it?Ce.setAttribute("aria-hidden","true"):Ce.removeAttribute("aria-hidden"))},We=function(){var it=(0,d.Z)(function*(at,Ce,bt,kt,Vt){var yn,Fn;if(at.presented)return;Xe(!0),at.presented=!0,at.willPresent.emit(),null===(yn=at.willPresentShorthand)||void 0===yn||yn.emit();const cn=(0,y.b)(at),ot=at.enterAnimation?at.enterAnimation:y.c.get(Ce,"ios"===cn?bt:kt);(yield Ee(at,ot,at.el,Vt))&&(at.didPresent.emit(),null===(Fn=at.didPresentShorthand)||void 0===Fn||Fn.emit()),"ION-TOAST"!==at.el.tagName&&ge(at.el),at.keyboardClose&&(null===document.activeElement||!at.el.contains(document.activeElement))&&at.el.focus()});return function(Ce,bt,kt,Vt,yn){return it.apply(this,arguments)}}(),ge=function(){var it=(0,d.Z)(function*(at){let Ce=document.activeElement;if(!Ce)return;const bt=Ce?.shadowRoot;bt&&(Ce=bt.querySelector(Oe)||Ce),yield at.onDidDismiss(),Ce.focus()});return function(Ce){return it.apply(this,arguments)}}(),de=function(){var it=(0,d.Z)(function*(at,Ce,bt,kt,Vt,yn,Fn){var cn,ot;if(!at.presented)return!1;Xe(!1),at.presented=!1;try{at.el.style.setProperty("pointer-events","none"),at.willDismiss.emit({data:Ce,role:bt}),null===(cn=at.willDismissShorthand)||void 0===cn||cn.emit({data:Ce,role:bt});const Nt=(0,y.b)(at),bn=at.leaveAnimation?at.leaveAnimation:y.c.get(kt,"ios"===Nt?Vt:yn);bt!==gt&&(yield Ee(at,bn,at.el,Fn)),at.didDismiss.emit({data:Ce,role:bt}),null===(ot=at.didDismissShorthand)||void 0===ot||ot.emit({data:Ce,role:bt}),re.delete(at),at.el.classList.add("overlay-hidden"),at.el.style.removeProperty("pointer-events")}catch(Nt){console.error(Nt)}return at.el.remove(),!0});return function(Ce,bt,kt,Vt,yn,Fn,cn){return it.apply(this,arguments)}}(),oe=it=>it.querySelector("ion-app")||it.body,Ee=function(){var it=(0,d.Z)(function*(at,Ce,bt,kt){bt.classList.remove("overlay-hidden");const yn=Ce(at.el,kt);(!at.animated||!y.c.getBoolean("animated",!0))&&yn.duration(0),at.keyboardClose&&yn.beforeAddWrite(()=>{const cn=bt.ownerDocument.activeElement;cn?.matches("input,ion-input, ion-textarea")&&cn.blur()});const Fn=re.get(at)||[];return re.set(at,[...Fn,yn]),yield yn.play(),!0});return function(Ce,bt,kt,Vt){return it.apply(this,arguments)}}(),vt=(it,at)=>{let Ce;const bt=new Promise(kt=>Ce=kt);return Tt(it,at,kt=>{Ce(kt.detail)}),bt},Tt=(it,at,Ce)=>{const bt=kt=>{(0,l.b)(it,at,bt),Ce(kt)};(0,l.a)(it,at,bt)},Gt=it=>"cancel"===it||it===Mt,Ot=it=>it(),yt=(it,at)=>{if("function"==typeof it)return y.c.get("_zoneGate",Ot)(()=>{try{return it(at)}catch(bt){throw bt}})},Mt="backdrop",gt="gesture"},1099:(Pn,Et,k)=>{"use strict";k.d(Et,{B:()=>xe});var d=k(8274),y=k(6579),te=k(6895),l=k(425);function q(fe,ze){if(1&fe&&(d.TgZ(0,"ion-badge",7),d._uU(1),d.qZA()),2&fe){const le=d.oxw().$implicit;d.xp6(1),d.hij("",le.Quantity," x")}}function re(fe,ze){if(1&fe&&(d.TgZ(0,"strong"),d._uU(1),d.qZA()),2&fe){const le=d.oxw().$implicit;d.xp6(1),d.hij("",le.PowerKW," kW ")}}function b(fe,ze){if(1&fe&&(d.TgZ(0,"div"),d._uU(1),d.qZA()),2&fe){const le=d.oxw().$implicit;d.xp6(1),d.hij("",null==le.CurrentType?null:le.CurrentType.Title," ")}}function he(fe,ze){if(1&fe&&(d.TgZ(0,"span"),d._uU(1),d.qZA()),2&fe){const le=d.oxw().$implicit;d.xp6(1),d.hij("",le.Amps,"A ")}}function Me(fe,ze){if(1&fe&&(d.TgZ(0,"span"),d._uU(1),d.qZA()),2&fe){const le=d.oxw().$implicit;d.xp6(1),d.hij("",le.Voltage,"V ")}}function Ve(fe,ze){if(1&fe){const le=d.EpF();d.TgZ(0,"ion-col")(1,"ion-button",8),d.NdJ("click",function(){d.CHM(le);const Oe=d.oxw().$implicit,Q=d.oxw();return d.KtG(Q.editConnection(Oe))}),d._UZ(2,"ion-icon",9),d.qZA(),d._UZ(3,"br"),d.TgZ(4,"ion-button",10),d.NdJ("click",function(){d.CHM(le);const Oe=d.oxw().$implicit,Q=d.oxw();return d.KtG(Q.deleteConnection(Oe))}),d._UZ(5,"ion-icon",11),d.qZA()()}}function X(fe,ze){if(1&fe&&(d.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-row")(3,"ion-col",1),d._UZ(4,"img",2),d.YNc(5,q,2,1,"ion-badge",3),d.TgZ(6,"div",4),d._uU(7),d.qZA()(),d.TgZ(8,"ion-col")(9,"ion-row")(10,"ion-col")(11,"ion-note")(12,"div")(13,"strong",5),d._uU(14),d.qZA()(),d.YNc(15,re,2,1,"strong",6),d.YNc(16,b,2,1,"div",6),d.qZA(),d.TgZ(17,"ion-note"),d.YNc(18,he,2,1,"span",6),d.YNc(19,Me,2,1,"span",6),d.qZA()()(),d.TgZ(20,"ion-row")(21,"ion-col",4),d._uU(22),d.qZA(),d.TgZ(23,"ion-col",4),d._uU(24),d.qZA()()(),d.YNc(25,Ve,6,0,"ion-col",6),d.qZA()()()),2&fe){const le=ze.$implicit,Ke=d.oxw();d.xp6(4),d.Q6J("src",Ke.getConnectorTypeIcon(le.ConnectionTypeID),d.LSH),d.xp6(1),d.Q6J("ngIf",le.Quantity),d.xp6(2),d.Oqu(null==le.StatusType?null:le.StatusType.Title),d.xp6(6),d.s9C("title",null==le.ConnectionType?null:le.ConnectionType.FormalName),d.xp6(1),d.hij("",null==le.ConnectionType?null:le.ConnectionType.Title," "),d.xp6(1),d.Q6J("ngIf",le.PowerKW),d.xp6(1),d.Q6J("ngIf",le.CurrentTypeID),d.xp6(2),d.Q6J("ngIf",le.Amps),d.xp6(1),d.Q6J("ngIf",le.Voltage),d.xp6(3),d.Oqu(le.Reference),d.xp6(2),d.Oqu(le.Comments),d.xp6(1),d.Q6J("ngIf",Ke.enableEdit)}}let xe=(()=>{class fe{constructor(){this.enableEdit=!1,this.onEdit=new d.vpe,this.onDelete=new d.vpe}ngOnInit(){}editConnection(le){this.onEdit.emit(le)}deleteConnection(le){this.onDelete.emit(le)}getConnectorTypeIcon(le){return y.c.getIconForConnector(le)}}return fe.\u0275fac=function(le){return new(le||fe)},fe.\u0275cmp=d.Xpm({type:fe,selectors:[["app-equipment-details"]],inputs:{item:"item",enableEdit:"enableEdit"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],["size","3"],[2,"max-width","64px",3,"src"],["color","primary",4,"ngIf"],[1,"info"],[3,"title"],[4,"ngIf"],["color","primary"],["size","small","color","secondary",3,"click"],["name","create","slot","icon-only"],["size","small","color","danger",3,"click"],["name","trash","slot","icon-only"]],template:function(le,Ke){1&le&&(d.TgZ(0,"ion-grid"),d.YNc(1,X,26,12,"ion-row",0),d.qZA()),2&le&&(d.xp6(1),d.Q6J("ngForOf",Ke.item.Connections))},dependencies:[te.sg,te.O5,l.yp,l.YG,l.wI,l.jY,l.gu,l.uN,l.Nd]}),fe})()},2428:(Pn,Et,k)=>{"use strict";k.d(Et,{v:()=>xe});var d=k(5861),y=k(7689),te=k(8274),l=k(553),q=k(425),re=k(529),b=k(6260),he=k(6895);function Me(fe,ze){1&fe&&(te.TgZ(0,"div"),te._UZ(1,"ion-spinner"),te.qZA())}function Ve(fe,ze){if(1&fe){const le=te.EpF();te.TgZ(0,"ion-item",5),te.NdJ("click",function(){const Q=te.CHM(le).$implicit,Ye=te.oxw(2);return te.KtG(Ye.placeSelected(Q))}),te.TgZ(1,"ion-avatar",6),te._UZ(2,"ion-icon",7),te.qZA(),te.TgZ(3,"ion-label")(4,"p"),te._uU(5),te.qZA()()()}if(2&fe){const le=ze.$implicit;te.xp6(5),te.Oqu(le.Address)}}function X(fe,ze){if(1&fe&&(te.TgZ(0,"div",1),te.YNc(1,Me,2,0,"div",2),te.TgZ(2,"ion-list"),te.YNc(3,Ve,6,1,"ion-item",3),te.TgZ(4,"ion-item")(5,"p",4),te._uU(6),te.qZA()()()()),2&fe){const le=te.oxw();te.xp6(1),te.Q6J("ngIf",le.searchInProgress),te.xp6(2),te.Q6J("ngForOf",le.placeList),te.xp6(3),te.hij(" ",le.placeAttribution," ")}}let xe=(()=>{class fe{constructor(le,Ke,Oe,Q,Ye){this.logging=le,this.changeDetector=Ke,this.platform=Oe,this.http=Q,this.events=Ye,this.searchInProgress=!1,this.placeSearchActive=!1,this.placeAttribution="",this.placeChanged=new te.vpe,this.searchKeyword="",this.searchInProgress=!1,this.mapService=new l.k(Ye,le,Q)}ngOnInit(){var le=this;return(0,d.Z)(function*(){yield le.platform.ready(),le.mapService.initAPI()})()}onSearchFocus(){this.placeSearchFocused=!0}onSearchBlur(){this.placeSearchFocused=!1}onSearchCancel(){}getPlacesAutoComplete(le,Ke){var Oe=this;return(0,d.Z)(function*(){Oe.placeSearchType=Ke;let Q=le.target.value;if(Q&&Q.length>3){Oe.logging.log("Starting place lookup for:"+Q),Oe.placeSearchActive=!0,Oe.searchInProgress=!0,Oe.searchInProgress=!1,Oe.placeSearchActive=!0;try{Oe.placeList=yield Oe.mapService.placeSearch(Q),Oe.placeList&&Oe.placeList.length>0&&(Oe.placeAttribution=Oe.placeList[0].Attribution)}catch{}Oe.searchInProgress=!1,Oe.placeSearchActive=!0}else Oe.searchInProgress=!1,Oe.placeSearchActive=!1})()}placeSelected(le){this.logging.log("Looking up place details:"+le.Title+"::"+le.ReferenceID),this.selectedPlace=le,this.placeChanged.emit(le),this.placeSearchActive=!1}}return fe.\u0275fac=function(le){return new(le||fe)(te.Y36(y.z),te.Y36(te.sBO),te.Y36(q.t4),te.Y36(re.eN),te.Y36(b.z))},fe.\u0275cmp=te.Xpm({type:fe,selectors:[["place-search"]],inputs:{searchKeyword:"searchKeyword"},outputs:{selectedPlace:"selectedPlace",placeChanged:"placeChanged"},decls:1,vars:1,consts:[["class","place-search",4,"ngIf"],[1,"place-search"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],[1,"place-attribution"],[3,"click"],["item-left",""],["name","locate"]],template:function(le,Ke){1&le&&te.YNc(0,X,7,3,"div",0),2&le&&te.Q6J("ngIf",Ke.placeSearchActive)},dependencies:[he.sg,he.O5,q.BJ,q.gu,q.Ie,q.Q$,q.q_,q.PQ],styles:[".place-search[_ngcontent-%COMP%]{position:absolute;z-index:1000}.place-attribution[_ngcontent-%COMP%]{font-size:9px;color:#dcdcdc;max-width:100%}"]}),fe})()},6585:(Pn,Et,k)=>{"use strict";k.d(Et,{o:()=>he});var d=k(8274),y=k(6579),te=k(6895),l=k(425);function q(Me,Ve){if(1&Me){const X=d.EpF();d.TgZ(0,"ion-button",5),d.NdJ("click",function(){d.CHM(X);const fe=d.oxw().$implicit,ze=d.oxw();return d.KtG(ze.onCopyCommand(fe))}),d._uU(1,"Copy"),d.qZA()}}function re(Me,Ve){if(1&Me){const X=d.EpF();d.TgZ(0,"ion-button",5),d.NdJ("click",function(){d.CHM(X);const fe=d.oxw().$implicit,ze=d.oxw();return d.KtG(ze.onEditCommand(fe))}),d._uU(1,"Edit"),d.qZA()}}function b(Me,Ve){if(1&Me&&(d.TgZ(0,"ion-item",1)(1,"ion-grid")(2,"ion-row")(3,"ion-col"),d._uU(4),d.qZA()(),d.TgZ(5,"ion-row")(6,"ion-col",2)(7,"p"),d._UZ(8,"img",3),d.qZA(),d.TgZ(9,"ion-note"),d._uU(10),d.qZA(),d.YNc(11,q,2,0,"ion-button",4),d.YNc(12,re,2,0,"ion-button",4),d.qZA(),d.TgZ(13,"ion-col")(14,"ion-row")(15,"ion-col")(16,"p"),d._uU(17),d.qZA(),d.TgZ(18,"ion-note"),d._uU(19),d.qZA()()(),d.TgZ(20,"ion-row")(21,"ion-col"),d._uU(22),d.qZA(),d.TgZ(23,"ion-col"),d._uU(24),d.qZA()()()()()()),2&Me){const X=Ve.$implicit,xe=d.oxw();d.xp6(4),d.hij(" ",X.AddressInfo.Title," "),d.xp6(4),d.Q6J("src",xe.getIconForPOI(X),d.LSH),d.xp6(2),d.hij(" ",xe.getFormattedDistance(X)," "),d.xp6(1),d.Q6J("ngIf",xe.enableCopyOption),d.xp6(1),d.Q6J("ngIf",xe.enableEditOption),d.xp6(5),d.hij(" ",xe.getFormattedAddress(X)," "),d.xp6(2),d.hij(" ",xe.getFormattedConnectorList(X)," "),d.xp6(3),d.hij(" ",null==X.UsageType?null:X.UsageType.Title," "),d.xp6(2),d.hij(" ",null==X.OperatorInfo?null:X.OperatorInfo.Title," ")}}let he=(()=>{class Me{constructor(){this.enableCopyOption=!1,this.enableEditOption=!1,this.poiList=[],this.onCopy=new d.vpe,this.onEdit=new d.vpe}ngOnInit(){}onCopyCommand(X){this.onCopy.emit(X)}onEditCommand(X){this.onEdit.emit(X)}getFormattedAddress(X){let xe="";return xe+=X.AddressInfo.Title!=X.AddressInfo.AddressLine1?X.AddressInfo.Title:X.AddressInfo.Town,xe}getFormattedConnectorList(X){if(!X.Connections)return;let xe=[];for(let fe of X.Connections)null!=fe.ConnectionType&&(xe.find(ze=>ze==fe.ConnectionType.Title)||xe.push(fe.ConnectionType.Title));return xe.join(", ")}getIconForPOI(X){return y.c.getIconForPOI(X)}getFormattedDistance(X){return y.c.getFormattedDistance(X)}}return Me.\u0275fac=function(X){return new(X||Me)},Me.\u0275cmp=d.Xpm({type:Me,selectors:[["app-poi-list"]],inputs:{enableCopyOption:"enableCopyOption",enableEditOption:"enableEditOption",poiList:"poiList"},outputs:{onCopy:"onCopy",onEdit:"onEdit"},decls:2,vars:1,consts:[["style","max-width:400px;",4,"ngFor","ngForOf"],[2,"max-width","400px"],["size","3"],[2,"width","24px",3,"src"],["size","small",3,"click",4,"ngIf"],["size","small",3,"click"]],template:function(X,xe){1&X&&(d.TgZ(0,"ion-list"),d.YNc(1,b,25,9,"ion-item",0),d.qZA()),2&X&&(d.xp6(1),d.Q6J("ngForOf",xe.poiList))},dependencies:[te.sg,te.O5,l.YG,l.wI,l.jY,l.Ie,l.q_,l.uN,l.Nd]}),Me})()},8936:(Pn,Et,k)=>{"use strict";k.d(Et,{e:()=>re});var d=k(6895),y=k(425),te=k(4006),l=k(4463),q=k(8274);let re=(()=>{class b{}return b.\u0275fac=function(Me){return new(Me||b)},b.\u0275mod=q.oAB({type:b}),b.\u0275inj=q.cJS({providers:[d.JJ],imports:[d.ez,y.Pc,te.u5,l.aw]}),b})()},2951:(Pn,Et,k)=>{"use strict";k.d(Et,{X:()=>y});var d=k(2340);class y{constructor(){this.baseURL="https://map.openchargemap.io",this.loginProviderRedirectBaseURL="https://openchargemap.org/site/loginprovider/?_mode=silent&_forceLogin=true&_redirectURL=",this.loginProviderRedirectURL=this.loginProviderRedirectBaseURL+this.baseURL,this.enableLiveMapQuerying=!0,this.googleMapsAPIKey=d.N.googleMapsKey,this.enableStaticMaps=d.N.enableStaticMaps}}},6579:(Pn,Et,k)=>{"use strict";k.d(Et,{c:()=>y});var d=k(2340);let y=(()=>{class te{static isFeatureEnabled(q){return!!d.N.enabledFeatures.find(re=>re===q)}static getClientHeight(){const q=document.body,re=document.documentElement;return Math.max(q.scrollHeight,q.offsetHeight,re.clientHeight,re.scrollHeight,re.offsetHeight)}static getClientWidth(){const q=document.body,re=document.documentElement;return Math.max(q.scrollWidth,q.offsetWidth,re.clientWidth,re.scrollWidth,re.offsetWidth)}static getMaxLevelOfPOI(q){let re=0;if(null!=q.Connections)for(let b=0;b<q.Connections.length;b++)null!=q.Connections[b].Level&&q.Connections[b].Level.ID>re&&(re=q.Connections[b].Level.ID);return 4===re&&(re=2),re>4&&(re=3),re}static getIconForPOI(q){let b="assets/images/icons/map/level"+te.getMaxLevelOfPOI(q);return null!=q.UsageType&&q.UsageType.Title.indexOf("Private")>-1?b+="_private":b+=null!=q.StatusType&&!0!==q.StatusType.IsOperational?"_nonoperational":"_operational",b+="_icon.png",b}static getColorForPOI(q){const re=te.getMaxLevelOfPOI(q);let b="#c0c0c0";return null!=q.UsageType&&q.UsageType.Title.indexOf("Private")>-1?b="#FF0000":null!=q.StatusType&&!0!==q.StatusType.IsOperational?b="#a0a0a0":2==re?b="#72EB0D":3==re&&(b="#EB800D"),b}static getIconForConnector(q){let re="assets/images/icons/connectors/";return re+=1===q?"Type1_J1772.svg":2===q?"Chademo_type4.svg":25===q?"Type2_socket.svg":32===q?"Type1_CCS.svg":33===q?"Type2_CCS.svg":1036===q?"Type2_tethered.svg":26===q?"Type3c.svg":28===q?"schuko.svg":"Unknown.svg",re}static getFormattedDistance(q){return q&&q.AddressInfo&&q.AddressInfo.Distance?q.AddressInfo.Distance.toFixed(1)+" "+(1===q.AddressInfo.DistanceUnit?"km":"miles"):""}static fixJSONDate(q){if(null==q)return null;if(0==q.indexOf("/")){let b=/Date\(([^)]+)\)/.exec(q);q=new Date(parseFloat(b[1]))}else q=new Date(q);return q}static formatMapLinkFromPosition(q,re,b,he,Me){return'<a href="https://maps.google.com/maps?saddr='+re+","+b+"&daddr="+q.AddressInfo.Latitude+","+q.AddressInfo.Longitude+'">Map ('+Math.ceil(he)+" "+Me+")</a>"}static formatSystemWebLink(q,re){return"<a href='#' onclick=\"window.open('"+q+"', '_system');return false;\">"+re+"</a>"}static formatMapLink(q,re,b){return b?device&&"WinCE"==device.platform?this.formatSystemWebLink("maps:"+q.AddressInfo.Latitude+","+q.AddressInfo.Longitude,re):device&&"iOS"===device.platform?this.formatSystemWebLink("https://maps.apple.com/?q="+q.AddressInfo.Latitude+","+q.AddressInfo.Longitude,re):this.formatSystemWebLink("https://maps.google.com/maps?q="+q.AddressInfo.Latitude+","+q.AddressInfo.Longitude,re):'<a target="_blank"  href="https://maps.google.com/maps?q='+q.AddressInfo.Latitude+","+q.AddressInfo.Longitude+'">'+re+"</a>"}static formatURL(q,re=null){return null==q||""==q?"":(-1==q.indexOf("http")&&(q="https://"+q),'<a target="_blank" href="'+q+'">'+(re??q)+"</a>")}static formatString(q){return null==q?"":q.toString()}static formatTextField(q,re=null,b=!1,he=!1,Me=null){if(null==q||""==q||null==q)return"";let Ve=(null!=re?"<strong class='ocm-label' "+(null!=Me?"data-localize='"+Me+"' ":"")+">"+re+"</strong>: ":"")+(b?"<br/>":"")+q.toString().replace("\n","<br/>")+"<br/>";return 1==he&&(Ve="<p>"+Ve+"</p>"),Ve}static formatEmailAddress(q){return null!=q&&null!=q&&""!=q?"<i class='fa fa-envelope fa-fw'></i> <a href=\"mailto:"+q+'">'+q+"</a><br/>":""}static formatPhone(q,re=null){return null!=q&&null!=q&&""!=q?(null==re?re="<i class='fa fa-phone fa-fw '></i> ":re+=": ",re+'<a href="tel:'+q+'">'+q+"</a><br/>"):""}static formatPOIDetails(q,re){let he=new Date;null==re&&(re=!1);let Me=this.formatPOIAddress(q,!1),Ve="";Ve+=this.formatPhone(q.AddressInfo.ContactTelephone1),Ve+=this.formatPhone(q.AddressInfo.ContactTelephone2),Ve+=this.formatEmailAddress(q.AddressInfo.ContactEmail);let X="";if(null!=q.AddressInfo.Distance){let Oe="https://maps.google.com/maps?saddr=&daddr="+q.AddressInfo.Latitude+","+q.AddressInfo.Longitude;X+="<strong id='addr_distance'><span data-localize='details.approxDistance'>Distance</span>: "+q.AddressInfo.Distance.toFixed(1)+" "+(2==q.AddressInfo.DistanceUnit?"Miles":"KM")+"</strong>",X+="<p>"+this.formatSystemWebLink(Oe,"Get Directions")+"</p>"}if(null!=q.AddressInfo.RelatedURL&&""!=q.AddressInfo.RelatedURL){let Oe=q.AddressInfo.RelatedURL;Oe=Oe.replace(/.*?:\/\//g,""),Oe.length>40&&(Oe=Oe.substr(0,40)+".."),Ve+="<i class='fa fa-fw fa-external-link'></i>  "+this.formatSystemWebLink(q.AddressInfo.RelatedURL,"<span data-localize='details.addressRelatedURL'>"+Oe+"</span>")}Ve+="</p>";const xe=this.formatTextField(q.GeneralComments,null,!1,!0)+this.formatTextField(q.AddressInfo.AccessComments,"Access",!0,!0,"details.accessComments");let fe="";null!=q.NumberOfPoints&&(fe+=this.formatTextField(q.NumberOfPoints,"Bays",!1,!0,"details.numberOfPoints")),null!=q.UsageType&&(fe+=this.formatTextField(q.UsageType.Title,"Usage",!1,!0,"details.usageType")),null!=q.UsageCost&&(fe+=this.formatTextField(q.UsageCost,"Usage Cost",!1,!0,"details.usageCost")),null!=q.OperatorInfo&&1!=q.OperatorInfo.ID&&(fe+=this.formatTextField(q.OperatorInfo.Title,"Operator",!1,!0,"details.operatorTitle"),null!=q.OperatorInfo.WebsiteURL&&(fe+=this.formatTextField(this.formatURL(q.OperatorInfo.WebsiteURL),"Operator Website",!0,!0,"details.operatorWebsite")));let ze="";if(null!=q.StatusType&&(ze+=this.formatTextField(q.StatusType.Title,"Status",!1,!0,"details.operationalStatus"),null!=q.DateLastStatusUpdate&&(ze+=this.formatTextField(Math.round((he-this.fixJSONDate(q.DateLastStatusUpdate))/864e5)+" days ago","Last Updated",!1,!0,"details.lastUpdated"))),null!=q.Connections&&q.Connections.length>0){ze+="<table class='table table-striped'>",ze+="<tr><th data-localize='details.equipment.connectionType'>Connection</th><th data-localize='details.equipment.powerLevel'>Power Level</th><th data-localize='details.operationalStatus'>Status</th></tr>";for(let Oe=0;Oe<q.Connections.length;Oe++){let Q=q.Connections[Oe];""==Q.Amps&&(Q.Amps=null),""==Q.Voltage&&(Q.Voltage=null),""==Q.Quantity&&(Q.Quantity=null),""==Q.PowerKW&&(Q.PowerKW=null),ze+="<tr><td>"+(null!=Q.ConnectionType?Q.ConnectionType.Title:"")+"</td><td>"+(null!=Q.Level?"<strong>"+Q.Level.Title+"</strong><br/>":"")+(null!=Q.Amps?this.formatString(Q.Amps)+"A/ ":"")+(null!=Q.Voltage?this.formatString(Q.Voltage)+"V/ ":"")+(null!=Q.PowerKW?this.formatString(Q.PowerKW)+"kW <br/>":"")+(null!=Q.CurrentType?Q.CurrentType.Title:"")+"<br/>"+(null!=Q.Quantity?this.formatString(Q.Quantity):"1")+" Present</td><td>"+(null!=Q.StatusType?Q.StatusType.Title:"-")+"</td></tr>"}ze+="</table>"}let le="";return le+=this.formatTextField("<a target='_blank' href='https://openchargemap.org/site/poi/details/"+q.ID+"'>OCM-"+q.ID+"</a>","OpenChargeMap Ref",!1,!0,"details.refNumber"),null!=q.DataProvider&&(le+=this.formatTextField(q.DataProvider.Title,"Data Provider",!1,!0,"details.dataProviderTitle"),null!=q.DataProvider.WebsiteURL&&(le+=this.formatTextField(this.formatURL(q.DataProvider.WebsiteURL),"Website",!1,!0,"details.dataProviderWebsite")),le+=this.formatTextField(q.AddressInfo.Latitude,"Latitude",!1,!0,null),le+=this.formatTextField(q.AddressInfo.Longitude,"Longitude",!1,!0,null)),{address:Me,drivingInfo:X,contactInfo:Ve,additionalInfo:xe+fe+ze,advancedInfo:le}}static debounce(q,re,b){let he;return function(){let Me=this,Ve=arguments,X=function(){he=null,b||q.apply(Me,Ve)},xe=b&&!he;clearTimeout(he),he=setTimeout(X,re),xe&&q.apply(Me,Ve)}}static getRandomInt(q){return Math.floor(Math.random()*Math.floor(q))}}return te.formatPOIAddress=function(l,q=!0){let re="";return re=q?""+this.formatTextField(l.AddressInfo.AddressLine1)+this.formatTextField(l.AddressInfo.AddressLine2)+this.formatTextField(l.AddressInfo.Town)+this.formatTextField(l.AddressInfo.StateOrProvince)+this.formatTextField(l.AddressInfo.Postcode)+(null!=l.AddressInfo.Country?this.formatTextField(l.AddressInfo.Country.Title):""):this.formatStringArray([l.AddressInfo.AddressLine1,l.AddressInfo.AddressLine2,l.AddressInfo.Town,l.AddressInfo.StateOrProvince,l.AddressInfo.Postcode,null!=l.AddressInfo.Country?l.AddressInfo.Country.Title:""]),re},te.formatStringArray=function(l,q=", "){if(null==l)return"";let re="";for(let b=0;b<l.length;b++)null!=l[b]&&""!=l[b].trim()&&(re+=b==l.length-1?l[b]:l[b]+q);return re},te})()},4120:(Pn,Et,k)=>{"use strict";k.d(Et,{LL:()=>te,jR:()=>y,wC:()=>d});class d{constructor(q=null,re=null){this.latitude=q,this.longitude=re}}class y{constructor(q=null,re=null){this.coords=new d,this.coords.latitude=q,this.coords.longitude=re}static fromPosition(q){return new y(q.coords.latitude,q.coords.longitude)}}class te{constructor(q,re){this.northEast=q,this.southWest=re}}},129:(Pn,Et,k)=>{"use strict";k.d(Et,{Qp:()=>te,fw:()=>re,JJ:()=>he,eN:()=>b,vw:()=>q,kA:()=>l});class d{constructor(Ve,X){this.itemType=Ve,this.itemId=d.getNewItemId(),this.version=1,this.schemaVersion=X,this.syncTimeStamp=d.getNewSyncTimeStamp()}static getNewSyncTimeStamp(){return Date.now().toString()}static getNewItemId(){return"_syncitem_"+Date.now().toString()}}class y{constructor(Ve,X){this._sync=new d(Ve,X)}}class te extends y{}class l extends y{constructor(){super("waypoint",1)}}class q extends y{constructor(){super("journey_stage",1),this.WayPoints=[]}}class re extends y{constructor(){super("journey",1),this.ID=""+Date.now(),this.Stages=[]}}class b{}class he{}},8016:(Pn,Et,k)=>{"use strict";k.d(Et,{b:()=>d});class d{constructor(){this.poiIdList=null,this.countryCode=null,this.latitude=null,this.longitude=null,this.locationTitle=null,this.distance=null,this.distanceUnit=null,this.connectionTypeIdList=null,this.operatorIdList=null,this.levelIdList=null,this.countryIdList=null,this.usageTypeIdList=null,this.statusTypeIdList=null,this.minPowerKW=null,this.maxPowerKW=null,this.submissionStatusTypeIdList=null,this.maxResults=500,this.additionalParams=null,this.includeComments=!1,this.compact=!0,this.enableCaching=!0,this.levelOfDetail=1,this.polyline=null,this.boundingbox=null}}},4209:(Pn,Et,k)=>{"use strict";k.d(Et,{n:()=>d});class d{}},7627:(Pn,Et,k)=>{"use strict";k.d(Et,{N:()=>y,U:()=>d});const d=650;class y{constructor(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MaxPowerKW=null,this.MinPowerKW=null,this.HasActiveFilters=!1,this.FilterOptionsByCountryId=null,this.UseDistanceInKM=!0,this.MapType="ROADMAP",this.EnableAdvancedEditorFeatures=!1}LoadSettings(){}SaveSettings(){}ClearActiveFilters(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MinPowerKW=null,this.MaxPowerKW=null}CheckForActiveFilters(){return this.HasActiveFilters=this.OperatorList.length>0||this.ConnectionTypeList.length>0||this.CountryList.length>0||this.UsageTypeList.length>0||this.StatusTypeList.length>0||this.MinPowerKW>0||this.MaxPowerKW>0||null!=this.MaxPowerKW&&this.MaxPowerKW<d,this.HasActiveFilters}}},8649:(Pn,Et,k)=>{"use strict";k.d(Et,{q:()=>d});var d=(()=>{return(y=d||(d={}))[y.POI=0]="POI",y[y.Comment=1]="Comment",y[y.Media=2]="Media",d;var y})()},534:(Pn,Et,k)=>{"use strict";k.r(Et),k.d(Et,{AboutPageModule:()=>Ve});var d=k(6895),y=k(4006),te=k(425),l=k(4228),q=k(388),re=k(8274);const b=[{path:"",component:q.t}];let he=(()=>{class X{}return X.\u0275fac=function(fe){return new(fe||X)},X.\u0275mod=re.oAB({type:X}),X.\u0275inj=re.cJS({imports:[l.Bz.forChild(b),l.Bz]}),X})();var Me=k(4463);let Ve=(()=>{class X{}return X.\u0275fac=function(fe){return new(fe||X)},X.\u0275mod=re.oAB({type:X}),X.\u0275inj=re.cJS({imports:[d.ez,y.u5,te.Pc,Me.aw,he]}),X})()},388:(Pn,Et,k)=>{"use strict";k.d(Et,{t:()=>q});var d=k(2340),y=k(8274),te=k(425),l=k(4463);let q=(()=>{class re{constructor(he){this.modalController=he}get appVersion(){return d.N.version}get apiUrl(){return d.N.apiBase}ngOnInit(){}close(){this.modalController.dismiss()}}return re.\u0275fac=function(he){return new(he||re)(y.Y36(te.IN))},re.\u0275cmp=y.Xpm({type:re,selectors:[["app-about"]],decls:49,vars:5,consts:[[1,"ion-padding"],["size","2"],["src","assets/images/icons/branding/AppIcon_128x128.png",2,"padding-top","2em"],["href","https://openchargemap.org"],["href","https://community.openchargemap.org"],["href","https://github.com/openchargemap/ocm-system/issues"],["href","https://webprofusion.com"],["href","https://opencollective.com/openchargemap"],["slot","end"],[3,"click"],["name","close","slot","start"]],template:function(he,Me){1&he&&(y.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),y._uU(3),y.ALo(4,"translate"),y.qZA()()(),y.TgZ(5,"ion-content",0)(6,"ion-grid")(7,"ion-row")(8,"ion-col",1),y._UZ(9,"img",2),y.qZA(),y.TgZ(10,"ion-col")(11,"h1"),y._uU(12,"Open Charge Map"),y.qZA(),y.TgZ(13,"h2"),y._uU(14,"The global public registry of Electric Vehicle charging locations"),y.qZA(),y.TgZ(15,"p"),y._uU(16,"Web: "),y.TgZ(17,"a",3),y._uU(18,"https://openchargemap.org"),y.qZA()()()()(),y.TgZ(19,"p"),y._uU(20,"Community Discussions: "),y.TgZ(21,"a",4),y._uU(22,"https://community.openchargemap.org"),y.qZA()(),y.TgZ(23,"p"),y._uU(24,"App or System Bugs and feature suggestions: "),y.TgZ(25,"a",5),y._uU(26,"GitHub"),y.qZA()(),y.TgZ(27,"p"),y._uU(28,"App development by Webprofusion Pty Ltd ("),y.TgZ(29,"a",6),y._uU(30,"https://webprofusion.com"),y.qZA(),y._uU(31,")"),y.qZA(),y.TgZ(32,"h3"),y._uU(33,"Funding"),y.qZA(),y.TgZ(34,"p"),y._uU(35,"Our software is developed and hosted by volunteers, our data is crowdsourced by you. To help further development please encourage your organisation to sponsor us: "),y.TgZ(36,"a",7),y._uU(37,"Open Collective"),y.qZA()(),y.TgZ(38,"ion-note")(39,"p"),y._uU(40),y.qZA(),y.TgZ(41,"p"),y._uU(42),y.qZA()()(),y.TgZ(43,"ion-footer")(44,"ion-toolbar")(45,"ion-buttons",8)(46,"ion-button",9),y.NdJ("click",function(){return Me.close()}),y._UZ(47,"ion-icon",10),y._uU(48," Close "),y.qZA()()()()),2&he&&(y.xp6(3),y.Oqu(y.lcZ(4,3,"ocm.general.about")),y.xp6(37),y.hij("App Version: ",Me.appVersion,""),y.xp6(2),y.hij("API: ",Me.apiUrl,""))},dependencies:[te.YG,te.Sm,te.wI,te.W2,te.fr,te.jY,te.Gu,te.gu,te.uN,te.Nd,te.wd,te.sr,l.X$]}),re})()},5476:(Pn,Et,k)=>{"use strict";k.r(Et),k.d(Et,{JourneysModule:()=>Me});var d=k(9741),y=k(8936),te=k(4463),l=k(6895),q=k(4006),re=k(425),b=k(4228),he=k(8274);let Me=(()=>{class Ve{}return Ve.\u0275fac=function(xe){return new(xe||Ve)},Ve.\u0275mod=he.oAB({type:Ve}),Ve.\u0275inj=he.cJS({imports:[l.ez,q.u5,re.Pc,te.aw,y.e,b.Bz.forChild([{path:"",component:d.g}])]}),Ve})()},9741:(Pn,Et,k)=>{"use strict";k.d(Et,{g:()=>St});var d=k(3912),y=k(7814),te=k(3855),l=k(4120),q=k(3399),re=k(8274),b=k(425),he=k(6895);function Me(lt,_e){1&lt&&(re.TgZ(0,"p"),re._uU(1," You have no journeys yet. Start by browsing to a charging location, then add it as Favourite to start a new Journey. "),re.qZA())}function Ve(lt,_e){if(1&lt&&(re.TgZ(0,"p"),re._uU(1),re.qZA()),2&lt){const ke=re.oxw(2).$implicit;re.xp6(1),re.hij(" ",ke.Poi.AddressInfo.AddressLine1,"")}}function X(lt,_e){if(1&lt&&(re.TgZ(0,"p"),re._uU(1),re.qZA()),2&lt){const ke=re.oxw(2).$implicit;re.xp6(1),re.hij(" ",ke.Poi.AddressInfo.AddressLine2,"")}}function xe(lt,_e){if(1&lt&&(re.TgZ(0,"p"),re._uU(1),re.qZA()),2&lt){const ke=re.oxw(2).$implicit;re.xp6(1),re.hij(" ",ke.Poi.AddressInfo.Town,"")}}function fe(lt,_e){if(1&lt&&(re.TgZ(0,"p"),re._uU(1),re.qZA()),2&lt){const ke=re.oxw(2).$implicit;re.xp6(1),re.hij(" ",ke.Poi.AddressInfo.StateOrProvince,"")}}function ze(lt,_e){if(1&lt&&(re.TgZ(0,"p"),re._uU(1),re.qZA()),2&lt){const ke=re.oxw(2).$implicit;re.xp6(1),re.hij(" ",ke.Poi.AddressInfo.Postcode,"")}}function le(lt,_e){if(1&lt){const ke=re.EpF();re.TgZ(0,"div")(1,"div",18),re.NdJ("click",function(){re.CHM(ke);const we=re.oxw().$implicit,Xe=re.oxw(4);return re.KtG(Xe.viewPOIDetails(we.Poi))}),re.YNc(2,Ve,2,1,"p",4),re.YNc(3,X,2,1,"p",4),re.YNc(4,xe,2,1,"p",4),re.YNc(5,fe,2,1,"p",4),re.YNc(6,ze,2,1,"p",4),re.qZA(),re.TgZ(7,"ion-button",19),re.NdJ("click",function(){re.CHM(ke);const we=re.oxw().$implicit,Xe=re.oxw(4);return re.KtG(Xe.launchNavigation(we.Poi))}),re._UZ(8,"ion-icon",20),re._uU(9," Navigate "),re.qZA()()}if(2&lt){const ke=re.oxw().$implicit;re.xp6(2),re.Q6J("ngIf",ke.Poi.AddressInfo.AddressLine1),re.xp6(1),re.Q6J("ngIf",ke.Poi.AddressInfo.AddressLine2),re.xp6(1),re.Q6J("ngIf",ke.Poi.AddressInfo.Town),re.xp6(1),re.Q6J("ngIf",ke.Poi.AddressInfo.StateOrProvince),re.xp6(1),re.Q6J("ngIf",ke.Poi.AddressInfo.Postcode)}}function Ke(lt,_e){if(1&lt&&(re.TgZ(0,"div",17),re.YNc(1,le,10,5,"div",4),re.qZA()),2&lt){const ke=_e.$implicit;re.xp6(1),re.Q6J("ngIf",ke.Poi)}}function Oe(lt,_e){if(1&lt&&(re.TgZ(0,"ion-item")(1,"h2"),re._uU(2),re.qZA(),re.TgZ(3,"ion-thumbnail",0),re._UZ(4,"ion-icon",15),re.qZA(),re.TgZ(5,"p"),re._uU(6),re.qZA(),re.YNc(7,Ke,2,1,"div",16),re.qZA()),2&lt){const ke=_e.$implicit;re.xp6(2),re.Oqu(ke.Title),re.xp6(4),re.Oqu(ke.Notes),re.xp6(1),re.Q6J("ngForOf",ke.PoiList)}}function Q(lt,_e){if(1&lt&&(re.TgZ(0,"ion-list")(1,"ion-list-header",11),re._uU(2),re._UZ(3,"ion-icon",12),re._uU(4," -- "),re._UZ(5,"ion-icon",13),re._uU(6," -- "),re._UZ(7,"ion-icon",14),re._uU(8," -- "),re.qZA(),re.YNc(9,Oe,8,3,"ion-item",5),re.qZA()),2&lt){const ke=_e.$implicit;re.xp6(2),re.hij(" ",ke.Title," "),re.xp6(7),re.Q6J("ngForOf",ke.WayPoints)}}function Ye(lt,_e){if(1&lt){const ke=re.EpF();re.TgZ(0,"ion-card")(1,"ion-card-content")(2,"ion-toolbar",8)(3,"ion-title"),re._uU(4),re.qZA(),re.TgZ(5,"ion-buttons",9)(6,"ion-button",1),re.NdJ("click",function(){const Xe=re.CHM(ke).$implicit,We=re.oxw();return re.KtG(We.deleteJourney(Xe.ID))}),re._UZ(7,"ion-icon",10),re.qZA()()(),re.TgZ(8,"p"),re._uU(9),re.qZA(),re.YNc(10,Q,10,2,"ion-list",5),re.qZA()()}if(2&lt){const ke=_e.$implicit;re.xp6(4),re.hij(" ",ke.Title,""),re.xp6(5),re.Oqu(ke.Notes),re.xp6(1),re.Q6J("ngForOf",ke.Stages)}}let St=(()=>{class lt{constructor(ke,Ne,we,Xe,We){this.appManager=ke,this.journeyManager=Ne,this.api=we,this.modalController=Xe,this.alertController=We}dismiss(){this.modalController.dismiss()}discoverImages(){this.journeyManager.journeys.forEach(ke=>{ke.Stages.forEach(Ne=>{Ne.WayPoints.forEach(we=>{null!=we.PoiList&&we.PoiList.forEach(Xe=>{Xe.Poi&&this.api.getPanoramioLocationPhotos(new l.wC(Xe.Poi.AddressInfo.Latitude,Xe.Poi.AddressInfo.Longitude)).then(We=>{Xe.Photos=We})})})})})}getJson(ke){return JSON.stringify(ke,null,4)}viewPOIDetails(ke){this.modalController.create({component:q.H,componentProps:{item:ke}}).then(Ne=>Ne.present())}get staticMapSize(){return"60x60"}getStaticMapURL(ke){return"https://maps.googleapis.com/maps/api/staticmap?center="+ke.AddressInfo.Latitude+","+ke.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+ke.AddressInfo.Latitude+","+ke.AddressInfo.Longitude}deleteJourney(ke){this.alertController.create({header:"Delete this Journey?",message:"Are you sure you want to delete this Journey?",buttons:[{text:"No",handler:()=>{}},{text:"Delete",handler:()=>{this.journeyManager.deleteJourney(ke)}}]}).then(Ne=>Ne.present())}launchNavigation(ke){let Ne="https://maps.google.com/?q="+ke.AddressInfo.Latitude+","+ke.AddressInfo.Longitude;this.appManager.platform.is("ios")&&(Ne="https://maps.apple.com?q="+ke.AddressInfo.Latitude+","+ke.AddressInfo.Longitude),window.open(Ne,"_system")}}return lt.\u0275fac=function(ke){return new(ke||lt)(re.Y36(te.c),re.Y36(d.i),re.Y36(y.l),re.Y36(b.IN),re.Y36(b.Br))},lt.\u0275cmp=re.Xpm({type:lt,selectors:[["ng-component"]],decls:18,vars:2,consts:[["slot","start"],[3,"click"],[1,"journeys-page"],[1,"ion-padding"],[4,"ngIf"],[4,"ngFor","ngForOf"],["slot","end"],["name","close","slot","start"],["primary",""],["slot","primary"],["name","close","slot","icon-only"],[2,"font-size","1.5rem"],["name","car"],["name","time"],["name","flash"],["name","caret-down",2,"font-size","4rem"],["style","text-align:right;width:100%;",4,"ngFor","ngForOf"],[2,"text-align","right","width","100%"],["tappable","",3,"click"],["clear","","item-right","",3,"click"],["name","navigate","slot","start"]],template:function(ke,Ne){1&ke&&(re.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-back-button",1),re.NdJ("click",function(){return Ne.dismiss()}),re.qZA()(),re.TgZ(4,"ion-title"),re._uU(5," Journeys "),re.qZA()()(),re.TgZ(6,"ion-content",2)(7,"div",3)(8,"p"),re._uU(9," You can create and plan journeys to group your favourite charging routes together. "),re.qZA(),re.YNc(10,Me,2,0,"p",4),re.qZA(),re.YNc(11,Ye,11,3,"ion-card",5),re.qZA(),re.TgZ(12,"ion-footer")(13,"ion-toolbar")(14,"ion-buttons",6)(15,"ion-button",1),re.NdJ("click",function(){return Ne.dismiss()}),re._UZ(16,"ion-icon",7),re._uU(17," Close "),re.qZA()()()()),2&ke&&(re.xp6(10),re.Q6J("ngIf",null==Ne.journeyManager.journeys||0==Ne.journeyManager.journeys.length),re.xp6(1),re.Q6J("ngForOf",Ne.journeyManager.journeys))},dependencies:[he.sg,he.O5,b.oU,b.YG,b.Sm,b.PM,b.FN,b.W2,b.fr,b.Gu,b.gu,b.Ie,b.q_,b.yh,b.Bs,b.wd,b.sr,b.cs],encapsulation:2}),lt})()},5005:(Pn,Et,k)=>{"use strict";k.r(Et),k.d(Et,{LayerEditorPageModule:()=>Ve});var d=k(6895),y=k(4006),te=k(425),l=k(4228),q=k(6588),re=k(8274);const b=[{path:"",component:q.A}];let he=(()=>{class X{}return X.\u0275fac=function(fe){return new(fe||X)},X.\u0275mod=re.oAB({type:X}),X.\u0275inj=re.cJS({imports:[l.Bz.forChild(b),l.Bz]}),X})();var Me=k(8936);let Ve=(()=>{class X{}return X.\u0275fac=function(fe){return new(fe||X)},X.\u0275mod=re.oAB({type:X}),X.\u0275inj=re.cJS({imports:[d.ez,y.u5,te.Pc,he,Me.e]}),X})()},6588:(Pn,Et,k)=>{"use strict";k.d(Et,{A:()=>he});var d=k(5861),y=k(6799),te=k(8274),l=k(425),q=k(6895),re=k(6585);function b(Me,Ve){if(1&Me&&(te.TgZ(0,"div"),te._uU(1),te._UZ(2,"app-poi-list",10),te.qZA()),2&Me){const X=te.oxw();te.xp6(1),te.hij(" Items Parsed: ",X.fileData.length," "),te.xp6(1),te.Q6J("poiList",X.fileData)}}let he=(()=>{class Me{constructor(X,xe){this.modalController=X,this.refData=xe}ngOnInit(){}previewFile(){var X=this;return(0,d.Z)(function*(){yield X.loadFile(!1)})()}cancel(){var X=this;return(0,d.Z)(function*(){yield X.modalController.dismiss(X.fileData)})()}loadFile(X=!0){var xe=this;return(0,d.Z)(function*(){const fe=new FileReader;fe.onload=()=>{let le=JSON.parse(fe.result);for(let Ke of le)Ke.ID="imp_"+Ke.ID;xe.fileData=xe.refData.hydrateCompactPOIList(le),X&&xe.modalController.dismiss(xe.fileData)},fe.onerror=()=>{},fe.readAsText(document.getElementById("file-upload").files[0])})()}add(){var X=this;return(0,d.Z)(function*(){X.modalController.dismiss(X.fileData)})()}}return Me.\u0275fac=function(X){return new(X||Me)(te.Y36(l.IN),te.Y36(y.W))},Me.\u0275cmp=te.Xpm({type:Me,selectors:[["app-layer-editor"]],decls:27,vars:1,consts:[[1,"ion-padding"],[1,"upload"],["name","file","aria-label","file","slot","start"],["type","file","required","","id","file-upload",3,"change"],[4,"ngIf"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","checkmark-circle-outline","slot","end"],[3,"poiList"]],template:function(X,xe){1&X&&(te.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),te._uU(3," Edit Layer "),te.qZA()()(),te.TgZ(4,"ion-content",0)(5,"p"),te._uU(6,"POI layers are used to preview data from other Open Data sources. "),te.qZA(),te.TgZ(7,"p"),te._uU(8,"Select a POI layer JSON file: "),te.qZA(),te.TgZ(9,"div")(10,"label",1)(11,"ion-button"),te._UZ(12,"ion-icon",2),te.TgZ(13,"ion-label"),te._uU(14,"Choose File.."),te.qZA()(),te.TgZ(15,"input",3),te.NdJ("change",function(){return xe.previewFile()}),te.qZA()()(),te.YNc(16,b,3,2,"div",4),te.qZA(),te.TgZ(17,"ion-footer")(18,"ion-toolbar")(19,"ion-buttons",5)(20,"ion-button",6),te.NdJ("click",function(){return xe.cancel()}),te._UZ(21,"ion-icon",7),te._uU(22," Cancel "),te.qZA()(),te.TgZ(23,"ion-buttons",8)(24,"ion-button",6),te.NdJ("click",function(){return xe.add()}),te._uU(25," Add "),te._UZ(26,"ion-icon",9),te.qZA()()()()),2&X&&(te.xp6(16),te.Q6J("ngIf",xe.fileData&&xe.fileData.length>0))},dependencies:[q.O5,l.YG,l.Sm,l.W2,l.fr,l.Gu,l.gu,l.Q$,l.wd,l.sr,re.o],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]}),Me})()},3399:(Pn,Et,k)=>{"use strict";k.d(Et,{H:()=>gn});var d=k(3855),y=k(8274),te=k(425),l=k(5861),q=k(3912),re=k(129),b=k(6895),he=k(4006);function Me(Ue,se){if(1&Ue&&(y.TgZ(0,"ion-select-option",13),y._uU(1),y.qZA()),2&Ue){const R=se.$implicit;y.Q6J("value",R.ID),y.xp6(1),y.Oqu(R.Title)}}function Ve(Ue,se){if(1&Ue&&(y.TgZ(0,"ion-select-option",16),y._uU(1),y.qZA()),2&Ue){const R=se.$implicit;y.Q6J("value",se.index),y.xp6(1),y.Oqu(R.Title)}}function X(Ue,se){if(1&Ue){const R=y.EpF();y.TgZ(0,"ion-item")(1,"ion-label",2),y._uU(2,"Journey Stage"),y.qZA(),y.TgZ(3,"ion-select",3),y.NdJ("ngModelChange",function(ce){y.CHM(R);const Be=y.oxw();return y.KtG(Be.selectedStageIndex=ce)}),y.TgZ(4,"ion-select-option",14),y._uU(5,"Create a Journey Stage"),y.qZA(),y.YNc(6,Ve,2,2,"ion-select-option",15),y.qZA()()}if(2&Ue){const R=y.oxw();y.xp6(3),y.Q6J("ngModel",R.selectedStageIndex),y.xp6(3),y.Q6J("ngForOf",R.journeyManager.getJourneyStages(R.selectedJourneyID))}}function xe(Ue,se){if(1&Ue){const R=y.EpF();y.TgZ(0,"ion-item")(1,"ion-label",2),y._uU(2,"New Journey Name"),y.qZA(),y.TgZ(3,"ion-input",7),y.NdJ("ngModelChange",function(ce){y.CHM(R);const Be=y.oxw();return y.KtG(Be.newJourneyName=ce)}),y.qZA()()}if(2&Ue){const R=y.oxw();y.xp6(3),y.Q6J("ngModel",R.newJourneyName)}}let fe=(()=>{class Ue{constructor(R,z,ce,Be){this.appManager=R,this.navParams=z,this.journeyManager=ce,this.modalController=Be,this.poi=this.navParams.get("poi"),this.waypoint=new re.kA,this.waypoint.Title=this.poi.AddressInfo.Title,this.waypoint.PoiIDs=[this.poi.ID],this.waypoint.PoiList=[];const tt=new re.Qp("charging",1);tt.Poi=this.poi,tt.PoiID=this.poi.ID,this.waypoint.PoiList.push(tt),this.newJourneyName="Trip to "+this.poi.AddressInfo.Title}cancel(){this.modalController.dismiss()}add(){if(null!=this.selectedJourneyID&&""!==this.selectedJourneyID)this.journeyManager.addJourneyWaypoint(this.selectedJourneyID,this.selectedStageIndex,this.waypoint);else{const R=new re.fw;R.ID=Date.now().toString(),""===this.newJourneyName&&(this.newJourneyName="New Journey"),R.Title=this.newJourneyName,this.journeyManager.addJourney(R,this.waypoint)}this.journeyManager.saveJourneys(),this.modalController.dismiss()}}return Ue.\u0275fac=function(R){return new(R||Ue)(y.Y36(d.c),y.Y36(te.X1),y.Y36(q.i),y.Y36(te.IN))},Ue.\u0275cmp=y.Xpm({type:Ue,selectors:[["ng-component"]],decls:39,vars:8,consts:[[1,"journeys-page","ion-padding"],[1,"banner"],["position","stacked"],[3,"ngModel","ngModelChange"],["value","","checked",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","text",3,"ngModel","ngModelChange"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","add","slot","end"],[3,"value"],["value",""],["checked","",3,"value",4,"ngFor","ngForOf"],["checked","",3,"value"]],template:function(R,z){1&R&&(y.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),y._uU(3," Edit Favourite "),y.qZA()()(),y.TgZ(4,"ion-content",0)(5,"div",1)(6,"h1"),y._uU(7),y.qZA(),y.TgZ(8,"p"),y._uU(9),y.qZA()(),y.TgZ(10,"p"),y._uU(11," Add Charging Location as a Journey Waypoint "),y.qZA(),y.TgZ(12,"ion-item")(13,"ion-label",2),y._uU(14,"Add to a Journey"),y.qZA(),y.TgZ(15,"ion-select",3),y.NdJ("ngModelChange",function(Be){return z.selectedJourneyID=Be}),y.TgZ(16,"ion-select-option",4),y._uU(17,"Create a New Journey"),y.qZA(),y.YNc(18,Me,2,2,"ion-select-option",5),y.qZA()(),y.YNc(19,X,7,2,"ion-item",6),y.YNc(20,xe,4,1,"ion-item",6),y.TgZ(21,"ion-item")(22,"ion-label",2),y._uU(23,"Name for this step of your journey"),y.qZA(),y.TgZ(24,"ion-input",7),y.NdJ("ngModelChange",function(Be){return z.waypoint.Title=Be}),y.qZA()(),y.TgZ(25,"ion-item")(26,"ion-label",2),y._uU(27,"Other Notes"),y.qZA(),y.TgZ(28,"ion-textarea",3),y.NdJ("ngModelChange",function(Be){return z.waypoint.Notes=Be}),y.qZA()()(),y.TgZ(29,"ion-footer")(30,"ion-toolbar")(31,"ion-buttons",8)(32,"ion-button",9),y.NdJ("click",function(){return z.cancel()}),y._UZ(33,"ion-icon",10),y._uU(34," Cancel "),y.qZA()(),y.TgZ(35,"ion-buttons",11)(36,"ion-button",9),y.NdJ("click",function(){return z.add()}),y._uU(37," Add "),y._UZ(38,"ion-icon",12),y.qZA()()()()),2&R&&(y.xp6(7),y.Oqu(z.poi.AddressInfo.Title),y.xp6(2),y.Oqu(z.poi.AddressInfo.AddressLine1),y.xp6(6),y.Q6J("ngModel",z.selectedJourneyID),y.xp6(3),y.Q6J("ngForOf",z.journeyManager.journeys),y.xp6(1),y.Q6J("ngIf",z.selectedJourneyID),y.xp6(1),y.Q6J("ngIf",!z.selectedJourneyID),y.xp6(4),y.Q6J("ngModel",z.waypoint.Title),y.xp6(4),y.Q6J("ngModel",z.waypoint.Notes))},dependencies:[b.sg,b.O5,he.JJ,he.On,te.YG,te.Sm,te.W2,te.fr,te.Gu,te.gu,te.pK,te.Ie,te.Q$,te.t9,te.n0,te.g2,te.wd,te.sr,te.QI,te.j9],encapsulation:2}),Ue})();var ze=k(7689);function le(Ue,se){if(1&Ue){const R=y.EpF();y.TgZ(0,"ion-card")(1,"ion-toolbar")(2,"ion-title",14),y._uU(3,"Preview"),y.qZA(),y.TgZ(4,"ion-buttons",15)(5,"ion-button",4),y.NdJ("click",function(){y.CHM(R);const ce=y.oxw();return y.KtG(ce.rotateImage())}),y._UZ(6,"ion-icon",16),y.TgZ(7,"ion-label"),y._uU(8,"Rotate"),y.qZA()()()(),y.TgZ(9,"ion-card-content")(10,"ion-list")(11,"ion-item")(12,"ion-label",17),y._uU(13,"Comment"),y.qZA(),y.TgZ(14,"ion-input",18),y.NdJ("ngModelChange",function(ce){y.CHM(R);const Be=y.oxw();return y.KtG(Be.comment=ce)}),y.qZA()()(),y._UZ(15,"img",19),y.qZA()()}if(2&Ue){const R=y.oxw();y.xp6(14),y.Q6J("ngModel",R.comment)}}let Ke=(()=>{class Ue{constructor(R,z,ce,Be,tt){this.navParams=R,this.appManager=z,this.nav=ce,this.modalController=Be,this.logging=tt,this.processingQuality=.8,this.targetWidth=1024,this.targetHeight=800,this.mode=z.platformMode,this.chargePointId=this.navParams.get("id"),this.poi=this.navParams.get("poi"),this.comment=""}processNativeImageSource(R){let z=R;const ce=document.getElementById("img-upload-canvas"),Be=ce.getContext("2d"),tt=new Image;tt.onload=()=>{this.logging.log("img load:"+tt.width),ce.width=tt.width,ce.height=tt.height,Be.fillStyle="rgb(0,0,0)",Be.fillRect(0,0,ce.width,ce.height),Be.drawImage(tt,0,0,ce.width,ce.height),this.imgData=ce.toDataURL("image/png"),this.processImage()},tt.src=z}loadCameraOrLibraryImage(R=!1){this.logging.log("PWA mode: fetching image");const z=new FileReader;z.onload=()=>{this.imgData=z.result,this.processImage()},z.onerror=()=>{},z.readAsDataURL(document.getElementById("img-upload-media").files[0])}isBrowserMode(){return this.appManager.isPlatform("desktop")||this.appManager.isPlatform("hybrid")}processImage(){if(null!=this.imgData){const z=document.getElementById("img-upload-canvas"),ce=z.getContext("2d"),Be=new Image;Be.onload=()=>{z.width=Be.width,z.height=Be.height,ce.fillStyle="rgb(0,0,0)",ce.fillRect(0,0,z.width,z.height),ce.drawImage(Be,0,0,z.width,z.height),this.refreshImageFromCanvas()},Be.src=this.imgData}else this.logging.log("processImage: nothing to process.")}refreshImageFromCanvas(){const R=document.getElementById("img-upload-canvas");this.imgData=R.toDataURL("image/jpeg",.8),document.getElementById("preview").src=this.imgData}rotateImage(){const R=document.getElementById("img-upload-canvas");let z=new Image;z.src=R.toDataURL(),z.onload=()=>{let ce=R.height,Be=R.width;R.width=ce,R.height=Be,ce=R.height,Be=R.width;const tt=R.getContext("2d");tt.save(),tt.translate(Be,ce/Be),tt.rotate(Math.PI/2),tt.drawImage(z,0,0),tt.restore(),z=null,this.refreshImageFromCanvas()}}performUpload(){var R=this;return(0,l.Z)(function*(){if(!R.imgData)return void(yield R.appManager.showToastNotification("Select an image to upload."));const z={chargePointID:R.chargePointId,comment:R.comment,imageDataBase64:R.imgData};yield R.appManager.showLoadingProgress("Uploading photo..");try{yield R.appManager.submitMediaItem(z),R.appManager.dismissLoadingProgress().then(()=>{R.appManager.showToastNotification("Upload completed"),R.modalController.dismiss()}),R.appManager.analytics.appEvent("MediaUpload","Completed")}catch{yield R.appManager.dismissLoadingProgress(),yield R.appManager.showToastNotification("Upload failed, please try again."),R.appManager.analytics.appEvent("MediaUpload","Failed")}})()}cancel(){var R=this;return(0,l.Z)(function*(){yield R.modalController.dismiss()})()}}return Ue.\u0275fac=function(R){return new(R||Ue)(y.Y36(te.X1),y.Y36(d.c),y.Y36(te.SH),y.Y36(te.IN),y.Y36(ze.z))},Ue.\u0275cmp=y.Xpm({type:Ue,selectors:[["ng-component"]],decls:32,vars:3,consts:[[1,"media-upload"],[1,"ion-padding"],[1,"banner"],[1,"upload"],[3,"click"],["name","camera","aria-label","camera","slot","start"],["type","file","required","","id","img-upload-media",3,"change"],["inputFile",""],["id","img-upload-canvas",2,"display","none","width","500","height","500","border","1px solid red"],[4,"ngIf"],["slot","secondary"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],["slot","start"],["slot","end"],["name","refresh","slot","start"],["position","floating"],["type","text","placeholder","(optional comment)",3,"ngModel","ngModelChange"],["id","preview",2,"max-width","500px"]],template:function(R,z){if(1&R){const ce=y.EpF();y.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),y._uU(3," Share Photo "),y.qZA()()(),y.TgZ(4,"ion-content",0)(5,"div",1)(6,"div",2)(7,"h1"),y._uU(8),y.qZA(),y.TgZ(9,"p"),y._uU(10),y.qZA()(),y.TgZ(11,"p"),y._uU(12,"You can upload a photo from your device or take a new photo: "),y.qZA(),y.TgZ(13,"div",3)(14,"ion-button",4),y.NdJ("click",function(){y.CHM(ce);const tt=y.MAs(19);return y.KtG(tt.click())}),y._UZ(15,"ion-icon",5),y.TgZ(16,"ion-label"),y._uU(17,"Choose Photo.."),y.qZA()(),y.TgZ(18,"input",6,7),y.NdJ("change",function(){return z.loadCameraOrLibraryImage()}),y.qZA()(),y._UZ(20,"canvas",8),y.YNc(21,le,16,1,"ion-card",9),y.qZA()(),y.TgZ(22,"ion-footer")(23,"ion-toolbar")(24,"ion-buttons",10)(25,"ion-button",4),y.NdJ("click",function(){return z.cancel()}),y._UZ(26,"ion-icon",11),y._uU(27," Cancel "),y.qZA()(),y.TgZ(28,"ion-buttons",12)(29,"ion-button",4),y.NdJ("click",function(){return z.performUpload()}),y._uU(30," Upload "),y._UZ(31,"ion-icon",13),y.qZA()()()()}2&R&&(y.xp6(8),y.Oqu(z.poi.AddressInfo.Title),y.xp6(2),y.Oqu(z.poi.AddressInfo.AddressLine1),y.xp6(11),y.Q6J("ngIf",null!=z.imgData))},dependencies:[b.O5,he.JJ,he.On,te.YG,te.Sm,te.PM,te.FN,te.W2,te.fr,te.Gu,te.gu,te.pK,te.Ie,te.Q$,te.q_,te.wd,te.sr,te.j9],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]}),Ue})();var Oe=k(4228);function Q(Ue,se){if(1&Ue&&(y.TgZ(0,"ion-select-option",19),y._uU(1),y.qZA()),2&Ue){const R=se.$implicit;y.Q6J("value",R.ID),y.xp6(1),y.Oqu(R.Title)}}function Ye(Ue,se){if(1&Ue&&(y.TgZ(0,"ion-select-option",19),y._uU(1),y.qZA()),2&Ue){const R=se.$implicit;y.Q6J("value",R.ID),y.xp6(1),y.Oqu(R.Title)}}let St=(()=>{class Ue{constructor(R,z,ce,Be,tt,Rt,At,ye){this.navParams=R,this.appManager=z,this.nav=ce,this.zone=Be,this.loadingController=tt,this.modalController=Rt,this.logging=At,this.router=ye,this.commentModel={ChargePointID:this.navParams.get("id"),Comment:"",CheckinStatusTypeID:10,CommentTypeID:10,Rating:null},this.poi=this.navParams.get("poi"),this.commentTypes=z.referenceDataManager.getCommentTypes(!0,!0),this.checkinTypes=z.referenceDataManager.getCheckinStatusTypes(!0,!0)}onPageWillEnter(){}cancel(){this.modalController.dismiss()}add(){var R=this;return(0,l.Z)(function*(){const z=yield R.loadingController.create({message:"Sending .."});yield z.present(),(yield R.appManager.submitComment(R.commentModel).catch(Be=>{R.appManager.showToastNotification("There was a problem submitting your comment."),R.loadingController.dismiss(),R.appManager.analytics.appEvent("Comment","Failed")}))&&(R.logging.log("Comment submitted"),yield z.dismiss(),yield R.modalController.dismiss(),R.appManager.analytics.appEvent("Comment","Submitted"))})()}}return Ue.\u0275fac=function(R){return new(R||Ue)(y.Y36(te.X1),y.Y36(d.c),y.Y36(te.SH),y.Y36(y.R0b),y.Y36(te.HT),y.Y36(te.IN),y.Y36(ze.z),y.Y36(Oe.F0))},Ue.\u0275cmp=y.Xpm({type:Ue,selectors:[["ng-component"]],decls:53,vars:8,consts:[["color","primary"],[1,"comment-page","ion-padding"],[1,"banner"],[1,"ion-padding"],["position","stacked"],[3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","(optional comment)",3,"ngModel","ngModelChange"],["value","5"],["value","4"],["value","3"],["value","2"],["value","1"],["value",""],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],[3,"value"]],template:function(R,z){1&R&&(y.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),y._uU(3," Add Comment "),y.qZA()()(),y.TgZ(4,"ion-content",1)(5,"div",2)(6,"h1"),y._uU(7),y.qZA(),y.TgZ(8,"p"),y._uU(9),y.qZA()(),y.TgZ(10,"p",3),y._uU(11,"Recent Check-ins are a big help to other drivers when planning their journey. Tell everyone what you thought about this charging location. "),y.qZA(),y.TgZ(12,"ion-list")(13,"ion-item")(14,"ion-label",4),y._uU(15,"Comment Type"),y.qZA(),y.TgZ(16,"ion-select",5),y.NdJ("ngModelChange",function(Be){return z.commentModel.CommentTypeID=Be}),y.YNc(17,Q,2,2,"ion-select-option",6),y.qZA()(),y.TgZ(18,"ion-item")(19,"ion-label",4),y._uU(20,"What Did You Think?"),y.qZA(),y.TgZ(21,"ion-input",7),y.NdJ("ngModelChange",function(Be){return z.commentModel.Comment=Be}),y.qZA()(),y.TgZ(22,"ion-item")(23,"ion-label",4),y._uU(24,"Did You Successfully Charge?"),y.qZA(),y.TgZ(25,"ion-select",5),y.NdJ("ngModelChange",function(Be){return z.commentModel.CheckinStatusTypeID=Be}),y.YNc(26,Ye,2,2,"ion-select-option",6),y.qZA()(),y.TgZ(27,"ion-item")(28,"ion-label",4),y._uU(29,"Your Rating"),y.qZA(),y.TgZ(30,"ion-select",5),y.NdJ("ngModelChange",function(Be){return z.commentModel.Rating=Be}),y.TgZ(31,"ion-select-option",8),y._uU(32,"5 - Excellent"),y.qZA(),y.TgZ(33,"ion-select-option",9),y._uU(34,"4 - Good"),y.qZA(),y.TgZ(35,"ion-select-option",10),y._uU(36,"3 - Average"),y.qZA(),y.TgZ(37,"ion-select-option",11),y._uU(38,"2 - Not Good"),y.qZA(),y.TgZ(39,"ion-select-option",12),y._uU(40,"1 - Bad"),y.qZA(),y.TgZ(41,"ion-select-option",13),y._uU(42,"Not Rated"),y.qZA()()()()(),y.TgZ(43,"ion-footer")(44,"ion-toolbar")(45,"ion-buttons",14)(46,"ion-button",15),y.NdJ("click",function(){return z.cancel()}),y._UZ(47,"ion-icon",16),y._uU(48," Cancel "),y.qZA()(),y.TgZ(49,"ion-buttons",17)(50,"ion-button",15),y.NdJ("click",function(){return z.add()}),y._uU(51," Submit "),y._UZ(52,"ion-icon",18),y.qZA()()()()),2&R&&(y.xp6(7),y.Oqu(z.poi.AddressInfo.Title),y.xp6(2),y.Oqu(z.poi.AddressInfo.AddressLine1),y.xp6(7),y.Q6J("ngModel",z.commentModel.CommentTypeID),y.xp6(1),y.Q6J("ngForOf",z.commentTypes),y.xp6(4),y.Q6J("ngModel",z.commentModel.Comment),y.xp6(4),y.Q6J("ngModel",z.commentModel.CheckinStatusTypeID),y.xp6(1),y.Q6J("ngForOf",z.checkinTypes),y.xp6(4),y.Q6J("ngModel",z.commentModel.Rating))},dependencies:[b.sg,he.JJ,he.On,te.YG,te.Sm,te.W2,te.fr,te.Gu,te.gu,te.pK,te.Ie,te.Q$,te.q_,te.t9,te.n0,te.wd,te.sr,te.QI,te.j9],encapsulation:2}),Ue})();var lt=k(2951),_e=k(9698),ke=k(9492),Ne=k(4508),we=k(6579),Xe=k(4463),We=k(1099);function ge(Ue,se){if(1&Ue&&(y.TgZ(0,"div")(1,"small"),y._uU(2),y.qZA()()),2&Ue){const R=y.oxw(2);y.xp6(2),y.Oqu(R.connectionSummary)}}function de(Ue,se){if(1&Ue&&(y.TgZ(0,"div")(1,"small"),y._uU(2),y.qZA()()),2&Ue){const R=y.oxw(2);y.xp6(2),y.Oqu(R.poi.OperatorInfo.Title)}}function oe(Ue,se){if(1&Ue){const R=y.EpF();y.ynx(0),y.TgZ(1,"ion-button",28),y.NdJ("click",function(){y.CHM(R);const ce=y.oxw(2);return y.KtG(ce.addFavourite())}),y._UZ(2,"ion-icon",29),y.TgZ(3,"ion-label"),y._uU(4,"Favourite"),y.qZA()(),y.TgZ(5,"ion-button",13),y.NdJ("click",function(){y.CHM(R);const ce=y.oxw(2);return y.KtG(ce.edit())}),y._UZ(6,"ion-icon",30),y.TgZ(7,"ion-label"),y._uU(8,"Edit"),y.qZA()(),y.BQk()}}function Ee(Ue,se){if(1&Ue){const R=y.EpF();y.ynx(0),y.TgZ(1,"ion-button",31),y.NdJ("click",function(){y.CHM(R);const ce=y.oxw(2);return y.KtG(ce.launchNavigation())}),y._UZ(2,"ion-icon",32),y.TgZ(3,"ion-label"),y._uU(4,"Navigate"),y.qZA()(),y.BQk()}}function vt(Ue,se){if(1&Ue){const R=y.EpF();y.ynx(0),y.TgZ(1,"ion-button",33),y.NdJ("click",function(){y.CHM(R);const ce=y.oxw(2);return y.KtG(ce.addComment())}),y._UZ(2,"ion-icon",34),y.TgZ(3,"ion-label"),y._uU(4,"Add Comment"),y.qZA()(),y.BQk()}}function Tt(Ue,se){if(1&Ue){const R=y.EpF();y.ynx(0),y.TgZ(1,"ion-button",35),y.NdJ("click",function(){y.CHM(R);const ce=y.oxw(2);return y.KtG(ce.addMedia())}),y._UZ(2,"ion-icon",36),y.TgZ(3,"ion-label"),y._uU(4," Add Photo"),y.qZA()(),y.BQk()}}function Gt(Ue,se){if(1&Ue&&(y.TgZ(0,"div"),y._uU(1),y.qZA()),2&Ue){const R=y.oxw(4);y.xp6(1),y.hij(" ",R.poi.AddressInfo.AddressLine1,"")}}function Ot(Ue,se){if(1&Ue&&(y.TgZ(0,"div"),y._uU(1),y.qZA()),2&Ue){const R=y.oxw(4);y.xp6(1),y.hij(" ",R.poi.AddressInfo.AddressLine2,"")}}function yt(Ue,se){if(1&Ue&&(y.TgZ(0,"div"),y._uU(1),y.qZA()),2&Ue){const R=y.oxw(4);y.xp6(1),y.hij(" ",R.poi.AddressInfo.Town,"")}}function Mt(Ue,se){if(1&Ue&&(y.TgZ(0,"div"),y._uU(1),y.qZA()),2&Ue){const R=y.oxw(4);y.xp6(1),y.hij(" ",R.poi.AddressInfo.StateOrProvince,"")}}function gt(Ue,se){if(1&Ue&&(y.TgZ(0,"div"),y._uU(1),y.qZA()),2&Ue){const R=y.oxw(4);y.xp6(1),y.hij(" ",R.poi.AddressInfo.Postcode,"")}}function it(Ue,se){if(1&Ue&&(y.TgZ(0,"div"),y._uU(1),y.qZA()),2&Ue){const R=y.oxw(4);y.xp6(1),y.hij(" ",R.poi.AddressInfo.Country.Title,"")}}function at(Ue,se){if(1&Ue&&(y.TgZ(0,"p"),y._uU(1),y.qZA()),2&Ue){const R=y.oxw(4);y.xp6(1),y.hij(" ",R.poi.AddressInfo.AccessComments," ")}}function Ce(Ue,se){if(1&Ue&&(y.TgZ(0,"p"),y._UZ(1,"ion-icon",48),y.TgZ(2,"span",45),y._uU(3),y.qZA()()),2&Ue){const R=y.oxw(4);y.xp6(3),y.Oqu(R.poi.AddressInfo.ContactTelephone1)}}function bt(Ue,se){if(1&Ue&&(y.TgZ(0,"p"),y._UZ(1,"ion-icon",48),y.TgZ(2,"span",45),y._uU(3),y.qZA()()),2&Ue){const R=y.oxw(4);y.xp6(3),y.Oqu(R.poi.AddressInfo.ContactTelephone2)}}function kt(Ue,se){if(1&Ue&&(y.TgZ(0,"p"),y._UZ(1,"ion-icon",49),y.TgZ(2,"span",45),y._uU(3),y.qZA()()),2&Ue){const R=y.oxw(4);y.xp6(3),y.Oqu(R.poi.AddressInfo.ContactEmail)}}function Vt(Ue,se){if(1&Ue&&(y.TgZ(0,"p"),y._UZ(1,"ion-icon",50),y.TgZ(2,"span",45)(3,"a",51),y._uU(4),y.qZA()()()),2&Ue){const R=y.oxw(4);y.xp6(3),y.s9C("href",R.poi.AddressInfo.RelatedURL,y.LSH),y.xp6(1),y.Oqu(R.poi.AddressInfo.RelatedURL)}}function yn(Ue,se){if(1&Ue&&(y.TgZ(0,"ion-card")(1,"ion-card-header"),y._UZ(2,"ion-icon",43),y._uU(3),y.ALo(4,"translate"),y.qZA(),y.TgZ(5,"ion-card-content")(6,"ion-grid")(7,"ion-row")(8,"ion-col")(9,"ion-label",44),y._uU(10),y.ALo(11,"translate"),y.qZA(),y.TgZ(12,"div",45),y.YNc(13,Gt,2,1,"div",0),y.YNc(14,Ot,2,1,"div",0),y.YNc(15,yt,2,1,"div",0),y.YNc(16,Mt,2,1,"div",0),y.YNc(17,gt,2,1,"div",0),y.YNc(18,it,2,1,"div",0),y.qZA()(),y.TgZ(19,"ion-col"),y.YNc(20,at,2,1,"p",0),y.YNc(21,Ce,4,1,"p",0),y.YNc(22,bt,4,1,"p",0),y.YNc(23,kt,4,1,"p",0),y.YNc(24,Vt,5,2,"p",0),y.qZA()(),y.TgZ(25,"ion-row")(26,"ion-col"),y._UZ(27,"ion-icon",46),y.TgZ(28,"ion-label",47),y._uU(29),y.ALo(30,"number"),y.ALo(31,"number"),y.qZA()()()()()()),2&Ue){const R=y.oxw(3);y.xp6(3),y.hij(" ",y.lcZ(4,15,"ocm.details.location.sectionTitle")," "),y.xp6(7),y.hij(" ",y.lcZ(11,17,"ocm.details.location.address"),""),y.xp6(3),y.Q6J("ngIf",R.poi.AddressInfo.AddressLine1),y.xp6(1),y.Q6J("ngIf",R.poi.AddressInfo.AddressLine2),y.xp6(1),y.Q6J("ngIf",R.poi.AddressInfo.Town),y.xp6(1),y.Q6J("ngIf",R.poi.AddressInfo.StateOrProvince),y.xp6(1),y.Q6J("ngIf",R.poi.AddressInfo.Postcode),y.xp6(1),y.Q6J("ngIf",R.poi.AddressInfo.Country),y.xp6(2),y.Q6J("ngIf",R.poi.AddressInfo.AccessComments),y.xp6(1),y.Q6J("ngIf",R.poi.AddressInfo.ContactTelephone1),y.xp6(1),y.Q6J("ngIf",R.poi.AddressInfo.ContactTelephone2),y.xp6(1),y.Q6J("ngIf",R.poi.AddressInfo.ContactEmail),y.xp6(1),y.Q6J("ngIf",R.poi.AddressInfo.RelatedURL),y.xp6(5),y.AsE(" ",y.xi3(30,19,R.poi.AddressInfo.Latitude,"1.1-13")," , ",y.xi3(31,22,R.poi.AddressInfo.Longitude,"1.1-13")," ")}}function Fn(Ue,se){if(1&Ue&&(y.TgZ(0,"p")(1,"span",44),y._uU(2),y.ALo(3,"translate"),y.qZA(),y.TgZ(4,"span",45),y._uU(5),y.qZA()()),2&Ue){const R=y.oxw(3);y.xp6(2),y.hij("",y.lcZ(3,2,"ocm.details.numberOfPoints"),":"),y.xp6(3),y.Oqu(R.poi.NumberOfPoints)}}function cn(Ue,se){if(1&Ue&&(y.TgZ(0,"p")(1,"span",44),y._uU(2),y.ALo(3,"translate"),y.qZA(),y.TgZ(4,"span",45),y._uU(5),y.qZA()()),2&Ue){const R=y.oxw(3);y.xp6(2),y.hij("",y.lcZ(3,2,"ocm.details.operationalStatus"),":"),y.xp6(3),y.hij(" ",R.poi.StatusType.Title," ")}}function ot(Ue,se){if(1&Ue&&(y.TgZ(0,"p")(1,"span",44),y._uU(2),y.ALo(3,"translate"),y.qZA(),y.TgZ(4,"span",45),y._uU(5),y.qZA()()),2&Ue){const R=y.oxw(3);y.xp6(2),y.hij("",y.lcZ(3,2,"ocm.details.usageType"),":"),y.xp6(3),y.Oqu(R.poi.UsageType.Title)}}function Nt(Ue,se){if(1&Ue&&(y.TgZ(0,"p")(1,"span",44),y._uU(2),y.ALo(3,"translate"),y.qZA(),y.TgZ(4,"span",45),y._uU(5),y.qZA()()),2&Ue){const R=y.oxw(3);y.xp6(2),y.hij("",y.lcZ(3,2,"ocm.details.usageCost"),":"),y.xp6(3),y.hij(" ",R.poi.UsageCost,"")}}function bn(Ue,se){if(1&Ue&&(y.TgZ(0,"p"),y._UZ(1,"br"),y._uU(2),y.ALo(3,"translate"),y._UZ(4,"br"),y.TgZ(5,"span",45),y._uU(6),y.qZA()()),2&Ue){const R=y.oxw(3);y.xp6(2),y.hij("",y.lcZ(3,2,"ocm.details.generalComments"),": "),y.xp6(4),y.Oqu(R.poi.GeneralComments)}}function Kn(Ue,se){if(1&Ue&&(y.TgZ(0,"p"),y._UZ(1,"ion-icon",54),y._uU(2),y.qZA()),2&Ue){const R=y.oxw(4);y.xp6(2),y.hij(" ",R.poi.OperatorInfo.WebsiteURL," ")}}function ri(Ue,se){if(1&Ue&&(y.TgZ(0,"p"),y._UZ(1,"ion-icon",49),y._uU(2),y.qZA()),2&Ue){const R=y.oxw(4);y.xp6(2),y.hij(" ",R.poi.OperatorInfo.ContactEmail," ")}}function Bn(Ue,se){if(1&Ue&&(y.TgZ(0,"p"),y._UZ(1,"ion-icon",49),y._uU(2),y.qZA()),2&Ue){const R=y.oxw(4);y.xp6(2),y.hij(" ",R.poi.OperatorInfo.FaultReportEmail," ")}}function pi(Ue,se){if(1&Ue&&(y.TgZ(0,"ion-card")(1,"ion-card-header"),y._UZ(2,"ion-icon",52),y._uU(3),y.ALo(4,"translate"),y.qZA(),y.TgZ(5,"ion-card-content")(6,"div",45)(7,"p",53),y._uU(8),y.qZA(),y.YNc(9,Kn,3,1,"p",0),y.YNc(10,ri,3,1,"p",0),y.YNc(11,Bn,3,1,"p",0),y.qZA()()()),2&Ue){const R=y.oxw(3);y.xp6(3),y.hij(" ",y.lcZ(4,5,"ocm.details.operator.sectionTitle")," "),y.xp6(5),y.hij(" ",R.poi.OperatorInfo.Title," "),y.xp6(1),y.Q6J("ngIf",R.poi.OperatorInfo.WebsiteURL),y.xp6(1),y.Q6J("ngIf",null!=R.poi.OperatorInfo.ContactEmail),y.xp6(1),y.Q6J("ngIf",null!=R.poi.OperatorInfo.FaultReportEmail&&R.poi.OperatorInfo.FaultReportEmail!=R.poi.OperatorInfo.ContactEmail)}}function bi(Ue,se){if(1&Ue){const R=y.EpF();y.TgZ(0,"a",56),y.NdJ("click",function(){y.CHM(R);const ce=y.oxw(4);return y.KtG(ce.launchURL(ce.poi.DataProvider.WebsiteURL))}),y._uU(1),y.qZA()}if(2&Ue){const R=y.oxw(4);y.xp6(1),y.Oqu(R.poi.DataProvider.WebsiteURL)}}function vi(Ue,se){if(1&Ue&&(y.TgZ(0,"div",45)(1,"h3"),y._uU(2),y.ALo(3,"translate"),y.qZA(),y.TgZ(4,"p"),y._uU(5),y.qZA(),y.YNc(6,bi,2,1,"a",55),y.TgZ(7,"p"),y._uU(8),y.qZA()()),2&Ue){const R=y.oxw(3);y.xp6(2),y.hij(" ",y.lcZ(3,4,"ocm.details.dataProvider.sectionTitle")," "),y.xp6(3),y.Oqu(null==R.poi.DataProvider?null:R.poi.DataProvider.Title),y.xp6(1),y.Q6J("ngIf",R.poi.DataProvider.WebsiteURL),y.xp6(2),y.Oqu(null==R.poi.DataProvider?null:R.poi.DataProvider.License)}}function Li(Ue,se){if(1&Ue&&(y.TgZ(0,"div",37),y.YNc(1,yn,32,25,"ion-card",0),y.TgZ(2,"ion-card")(3,"ion-card-header"),y._UZ(4,"ion-icon",38),y._uU(5),y.ALo(6,"translate"),y.qZA(),y.TgZ(7,"ion-card-content"),y.YNc(8,Fn,6,4,"p",0),y._UZ(9,"app-equipment-details",39),y.qZA()(),y.TgZ(10,"ion-card")(11,"ion-card-header"),y._UZ(12,"ion-icon",40),y._uU(13," Usage Restrictions "),y.qZA(),y.TgZ(14,"ion-card-content"),y.YNc(15,cn,6,4,"p",0),y.YNc(16,ot,6,4,"p",0),y.YNc(17,Nt,6,4,"p",0),y.YNc(18,bn,7,4,"p",0),y.qZA()(),y.YNc(19,pi,12,7,"ion-card",0),y.TgZ(20,"ion-card")(21,"ion-card-header"),y._UZ(22,"ion-icon",41),y._uU(23),y.ALo(24,"translate"),y.qZA(),y.TgZ(25,"ion-card-content"),y.YNc(26,vi,9,6,"div",42),y.qZA()()()),2&Ue){const R=y.oxw(2);y.xp6(1),y.Q6J("ngIf",R.poi.AddressInfo),y.xp6(4),y.hij(" ",y.lcZ(6,11,"ocm.details.equipment.sectionTitle")," "),y.xp6(3),y.Q6J("ngIf",null!=R.poi.NumberOfPoints),y.xp6(1),y.Q6J("item",R.poi),y.xp6(6),y.Q6J("ngIf",null!=R.poi.StatusType),y.xp6(1),y.Q6J("ngIf",null!=R.poi.UsageType),y.xp6(1),y.Q6J("ngIf",null!=R.poi.UsageCost),y.xp6(1),y.Q6J("ngIf",null!=R.poi.GeneralComments),y.xp6(1),y.Q6J("ngIf",R.poi.OperatorInfo),y.xp6(4),y.hij(" ",y.lcZ(24,13,"ocm.details.advancedDetails")," "),y.xp6(3),y.Q6J("ngIf",R.poi.DataProvider)}}function Si(Ue,se){if(1&Ue&&y._UZ(0,"img",60),2&Ue){const R=y.oxw().$implicit;y.s9C("src",null==R.User?null:R.User.ProfileImageURL,y.LSH)}}function Fi(Ue,se){if(1&Ue&&(y.TgZ(0,"span"),y._uU(1),y.qZA()),2&Ue){const R=y.oxw().$implicit;y.xp6(1),y.Oqu(R.User.Username)}}function Yi(Ue,se){if(1&Ue&&(y.TgZ(0,"span"),y._uU(1),y.qZA()),2&Ue){const R=y.oxw().$implicit;y.xp6(1),y.Oqu(R.Username)}}function Zt(Ue,se){if(1&Ue&&(y.TgZ(0,"p",45),y._uU(1),y.qZA()),2&Ue){const R=y.oxw().$implicit;y.xp6(1),y.hij(" ",null==R.CommentType?null:R.CommentType.Title," ")}}function It(Ue,se){if(1&Ue&&(y.TgZ(0,"p")(1,"span",44),y._uU(2,"Rating:"),y.qZA(),y.TgZ(3,"span",45),y._uU(4),y.qZA()()),2&Ue){const R=y.oxw().$implicit;y.xp6(4),y.hij("",R.Rating," out of 5")}}function He(Ue,se){1&Ue&&(y.ynx(0),y._UZ(1,"ion-icon",61),y.BQk())}function ne(Ue,se){1&Ue&&(y.ynx(0),y._UZ(1,"ion-icon",62),y.BQk())}function Je(Ue,se){if(1&Ue&&(y.TgZ(0,"p"),y.YNc(1,He,2,0,"ng-container",0),y.YNc(2,ne,2,0,"ng-container",0),y._uU(3),y.qZA()),2&Ue){const R=y.oxw().$implicit;y.xp6(1),y.Q6J("ngIf",!0===R.CheckinStatusType.IsPositive),y.xp6(1),y.Q6J("ngIf",!1===R.CheckinStatusType.IsPositive),y.xp6(1),y.hij(" ",R.CheckinStatusType.Title," ")}}function jt(Ue,se){if(1&Ue&&(y.TgZ(0,"ion-card")(1,"ion-item")(2,"ion-avatar",19),y.YNc(3,Si,1,1,"img",59),y.qZA(),y.TgZ(4,"ion-label"),y.YNc(5,Fi,2,1,"span",0),y.YNc(6,Yi,2,1,"span",0),y.qZA(),y.TgZ(7,"ion-label",20),y._uU(8),y.ALo(9,"date"),y.qZA()(),y.TgZ(10,"ion-card-content")(11,"p"),y._uU(12),y.qZA(),y.YNc(13,Zt,2,1,"p",42),y.YNc(14,It,5,1,"p",0),y.YNc(15,Je,4,3,"p",0),y.qZA()()),2&Ue){const R=se.$implicit;y.xp6(3),y.Q6J("ngIf",R.User&&R.User.ProfileImageURL),y.xp6(2),y.Q6J("ngIf",R.User),y.xp6(1),y.Q6J("ngIf",!R.User),y.xp6(2),y.hij(" ",y.lcZ(9,8,R.DateCreated)," "),y.xp6(4),y.Oqu(R.Comment),y.xp6(1),y.Q6J("ngIf",10!=R.CommentTypeID),y.xp6(1),y.Q6J("ngIf",R.Rating),y.xp6(1),y.Q6J("ngIf",R.CheckinStatusType)}}function Qt(Ue,se){if(1&Ue&&(y.ynx(0),y.YNc(1,jt,16,10,"ion-card",58),y.BQk()),2&Ue){const R=y.oxw(3);y.xp6(1),y.Q6J("ngForOf",R.poi.UserComments)}}function li(Ue,se){1&Ue&&(y.TgZ(0,"p",21),y._uU(1),y.ALo(2,"translate"),y.qZA()),2&Ue&&(y.xp6(1),y.hij(" ",y.lcZ(2,1,"ocm.details.commentsAndRatings.zeroComments")," "))}function Ii(Ue,se){if(1&Ue&&(y.TgZ(0,"div"),y.YNc(1,Qt,2,1,"ng-container",0),y.YNc(2,li,3,3,"p",57),y.qZA()),2&Ue){const R=y.oxw(2);y.xp6(1),y.Q6J("ngIf",1==R.poi._hasComments),y.xp6(1),y.Q6J("ngIf",0==R.poi._hasComments)}}function tr(Ue,se){if(1&Ue&&y._UZ(0,"img",60),2&Ue){const R=y.oxw().$implicit;y.s9C("src",null==R.User?null:R.User.ProfileImageURL,y.LSH)}}function fi(Ue,se){if(1&Ue&&(y.TgZ(0,"span"),y._uU(1),y.qZA()),2&Ue){const R=y.oxw().$implicit;y.xp6(1),y.Oqu(R.User.Username)}}function yr(Ue,se){if(1&Ue&&(y.TgZ(0,"span"),y._uU(1),y.qZA()),2&Ue){const R=y.oxw().$implicit;y.xp6(1),y.Oqu(R.Username)}}function Ai(Ue,se){if(1&Ue&&(y.TgZ(0,"ion-card"),y._UZ(1,"img",60),y.TgZ(2,"ion-item")(3,"ion-avatar",19),y.YNc(4,tr,1,1,"img",59),y.qZA(),y.TgZ(5,"ion-label"),y.YNc(6,fi,2,1,"span",0),y.YNc(7,yr,2,1,"span",0),y.qZA(),y.TgZ(8,"ion-label",20),y._uU(9),y.ALo(10,"date"),y.qZA()(),y.TgZ(11,"ion-card-content")(12,"p"),y._uU(13),y.qZA()()()),2&Ue){const R=se.$implicit;y.xp6(1),y.s9C("src",R.ItemMediumURL,y.LSH),y.xp6(3),y.Q6J("ngIf",R.User&&R.User.ProfileImageURL),y.xp6(2),y.Q6J("ngIf",R.User),y.xp6(1),y.Q6J("ngIf",!R.User),y.xp6(2),y.hij(" ",y.lcZ(10,6,R.DateCreated)," "),y.xp6(4),y.Oqu(R.Comment)}}function fr(Ue,se){if(1&Ue&&(y.TgZ(0,"div"),y.YNc(1,Ai,14,8,"ion-card",58),y.qZA()),2&Ue){const R=y.oxw(3);y.xp6(1),y.Q6J("ngForOf",R.poi.MediaItems)}}function wr(Ue,se){1&Ue&&(y.TgZ(0,"div",21)(1,"p",63),y._uU(2),y.ALo(3,"translate"),y.qZA()()),2&Ue&&(y.xp6(2),y.hij(" ",y.lcZ(3,1,"ocm.details.mediaItems.addPrompt"),""))}function Cr(Ue,se){if(1&Ue&&(y.TgZ(0,"div"),y.YNc(1,fr,2,1,"div",0),y.YNc(2,wr,4,3,"div",57),y.qZA()),2&Ue){const R=y.oxw(2);y.xp6(1),y.Q6J("ngIf",R.poi._hasPhotos),y.xp6(1),y.Q6J("ngIf",!R.poi._hasPhotos)}}function si(Ue,se){if(1&Ue&&(y.TgZ(0,"p",64),y._uU(1),y.qZA()),2&Ue){const R=y.oxw(2);y.xp6(1),y.hij(" ",R.json,"")}}function dn(Ue,se){if(1&Ue){const R=y.EpF();y.TgZ(0,"div")(1,"div",1)(2,"div",2)(3,"h2"),y._uU(4),y.qZA(),y.TgZ(5,"div")(6,"small"),y._uU(7),y.qZA()(),y.YNc(8,ge,3,1,"div",0),y.YNc(9,de,3,1,"div",0),y.TgZ(10,"ion-badge",3),y._uU(11),y.ALo(12,"number"),y.qZA()(),y.TgZ(13,"ion-fab",4)(14,"ion-fab-button"),y._UZ(15,"ion-icon",5),y.qZA(),y.TgZ(16,"ion-fab-list",6)(17,"ion-fab-button",7),y.NdJ("click",function(){y.CHM(R);const ce=y.oxw();return y.KtG(ce.addComment())}),y._UZ(18,"ion-icon",8),y.qZA(),y.TgZ(19,"ion-fab-button",9),y.NdJ("click",function(){y.CHM(R);const ce=y.oxw();return y.KtG(ce.addMedia())}),y._UZ(20,"ion-icon",10),y.qZA(),y.TgZ(21,"ion-fab-button",11),y.NdJ("click",function(){y.CHM(R);const ce=y.oxw();return y.KtG(ce.addFavourite())}),y._UZ(22,"ion-icon",12),y.qZA(),y.TgZ(23,"ion-fab-button",13),y.NdJ("click",function(){y.CHM(R);const ce=y.oxw();return y.KtG(ce.edit())}),y._UZ(24,"ion-icon",14),y.qZA(),y.TgZ(25,"ion-fab-button",15),y.NdJ("click",function(){y.CHM(R);const ce=y.oxw();return y.KtG(ce.refresh())}),y._UZ(26,"ion-icon",16),y.qZA()()()(),y.TgZ(27,"ion-refresher",17),y.NdJ("ionRefresh",function(ce){y.CHM(R);const Be=y.oxw();return y.KtG(Be.refresh(ce))}),y._UZ(28,"ion-refresher-content",18),y.qZA(),y.TgZ(29,"ion-toolbar")(30,"ion-buttons",19),y.YNc(31,oe,9,0,"ng-container",0),y.qZA(),y.TgZ(32,"ion-buttons",20),y.YNc(33,Ee,5,0,"ng-container",0),y.YNc(34,vt,5,0,"ng-container",0),y.YNc(35,Tt,5,0,"ng-container",0),y.qZA()(),y.TgZ(36,"div",21)(37,"ion-segment",22),y.NdJ("ngModelChange",function(ce){y.CHM(R);const Be=y.oxw();return y.KtG(Be.selectedTab=ce)}),y.TgZ(38,"ion-segment-button",23)(39,"ion-label"),y._uU(40," Details "),y.qZA()(),y.TgZ(41,"ion-segment-button",24)(42,"ion-label"),y._uU(43),y.qZA()(),y.TgZ(44,"ion-segment-button",25)(45,"ion-label"),y._uU(46),y.qZA()()()(),y.YNc(47,Li,27,15,"div",26),y.YNc(48,Ii,3,2,"div",0),y.YNc(49,Cr,3,2,"div",0),y.YNc(50,si,2,1,"p",27),y.qZA()}if(2&Ue){const R=y.oxw();y.xp6(1),y.Udp("background-image",R.backdropImage?"url("+R.backdropImage+")":""),y.xp6(3),y.hij(" ",R.poi.AddressInfo.Title," "),y.xp6(3),y.hij("OCM-",R.poi.ID,""),y.xp6(1),y.Q6J("ngIf",R.connectionSummary),y.xp6(1),y.Q6J("ngIf",R.poi.OperatorInfo),y.xp6(2),y.Oqu(y.xi3(12,18,R.avgRating,"1.1-1")),y.xp6(20),y.Q6J("ngIf","location"==R.selectedTab),y.xp6(2),y.Q6J("ngIf","location"==R.selectedTab),y.xp6(1),y.Q6J("ngIf","comments"==R.selectedTab),y.xp6(1),y.Q6J("ngIf","media"==R.selectedTab),y.xp6(2),y.Q6J("ngModel",R.selectedTab),y.xp6(6),y.hij("Comments (",R.poi.UserComments?R.poi.UserComments.length:0,")"),y.xp6(3),y.hij(" Photos (",R.poi.MediaItems?R.poi.MediaItems.length:0,")"),y.xp6(1),y.Q6J("ngIf","location"==R.selectedTab),y.xp6(1),y.Q6J("ngIf","comments"==R.selectedTab),y.xp6(1),y.Q6J("ngIf","media"==R.selectedTab),y.xp6(1),y.Q6J("ngIf",1==R.appManager.isDebugMode)}}function wt(Ue,se){1&Ue&&(y.TgZ(0,"div")(1,"h2"),y._uU(2,"POI Not Found"),y.qZA(),y.TgZ(3,"p"),y._uU(4,"The POI details could not be loaded."),y.qZA()())}let Pt=(()=>{class Ue{constructor(R,z,ce,Be,tt,Rt,At,ye){this.appManager=R,this.nav=z,this.translate=ce,this.logging=Be,this.modalController=tt,this.actionSheetController=Rt,this.poiManager=At,this.router=ye,this.hasNavBar=!1}ngOnChanges(R){if(this.logging.log("In ngOnChanges of POI Details"),null!=this.poi&&null!=this.poi.AddressInfo){if(this.selectedTab="location",null!=this.poi.MediaItems&&this.poi.MediaItems.length>0){this.poi._hasPhotos=!0;for(let z of this.poi.MediaItems)z.ItemMediumURL=z.ItemThumbnailURL.replace(".thmb.",".medi.");this.backdropImage=this.poi.MediaItems[this.poi.MediaItems.length-1].ItemThumbnailURL.replace(".thmb.",".medi.")}else this.poi._hasPhotos=!1,this.backdropImage=null;if(null!=this.poi.UserComments&&this.poi.UserComments.length>0){this.poi._hasComments=!0;try{let z=this.poi.UserComments.filter(ce=>ce.Rating>0);if(z.length>0){let ce=0;for(let Be of z)ce+=Be.Rating;this.avgRating=ce/z.length}else this.avgRating=null}catch{}}else this.poi._hasComments=!1;if(this.poi.Connections&&this.poi.Connections.length>0){let z="";for(let ce of this.poi.Connections)-1==z.indexOf(ce.ConnectionType.Title)&&(z+=(""!=z?", ":"")+ce.ConnectionType.Title);this.connectionSummary=z}}}ngOnInit(){this.logging.log("In ngInit of POI Details")}get staticMapURL(){return"https://maps.googleapis.com/maps/api/staticmap?key="+(new lt.X).googleMapsAPIKey+"&center="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude}get staticMapSize(){return 0===this.appManager.clientWidth?"240x100":this.appManager.clientWidth>=800?"640x100":this.appManager.clientWidth>=400?"400x100":"240x100"}continueAddComment(){var R=this;return(0,l.Z)(function*(){const z=yield R.modalController.create({component:St,componentProps:{id:R.poi.ID,poi:R.poi}});setTimeout(()=>{R.refresh()},1e3),yield z.present()})()}addComment(){var R=this;return(0,l.Z)(function*(){if(R.appManager.isUserAuthenticated(!0))yield R.continueAddComment();else{const z=yield R.modalController.create({component:ke.F});z.onDidDismiss().then((0,l.Z)(function*(){R.appManager.isUserAuthenticated(!0)&&(yield R.continueAddComment())})),yield z.present()}})()}continueAddMedia(){var R=this;return(0,l.Z)(function*(){const z=yield R.modalController.create({component:Ke,componentProps:{id:R.poi.ID,poi:R.poi}});z.onDidDismiss().then(()=>{setTimeout(()=>{R.refresh()},1e3)}),yield z.present()})()}addMedia(){var R=this;return(0,l.Z)(function*(){if(R.appManager.isUserAuthenticated(!0))yield R.continueAddMedia();else{const z=yield R.modalController.create({component:ke.F});z.onDidDismiss().then((0,l.Z)(function*(){R.appManager.isUserAuthenticated(!0)&&(yield R.continueAddMedia())})),yield z.present()}})()}addFavourite(){var R=this;return(0,l.Z)(function*(){yield(yield R.actionSheetController.create({header:"Add Favourite",buttons:[{text:"Add to Journey",handler:()=>{R.modalController.create({component:fe,componentProps:{poi:R.poi}}).then(ce=>ce.present())}},{text:"Cancel",role:"cancel",handler:()=>{}}]})).present()})()}launchNavigation(){this.appManager.isPlatform("ios")?this.appManager.launchWebPage("https://maps.apple.com/?ll="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude):this.appManager.launchWebPage("https://maps.google.com/?q="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude)}launchURL(R){this.appManager.launchWebPage(R)}continueEdit(){var R=this;return(0,l.Z)(function*(){const z=yield R.modalController.create({component:Ne.Y,componentProps:{id:R.poi.ID}});return z.onDidDismiss().then(ce=>{R.refresh()}),yield z.present()})()}edit(){var R=this;return(0,l.Z)(function*(){if(we.c.isFeatureEnabled("EDIT_POI"))if(R.appManager.isUserAuthenticated(!0))yield R.continueEdit();else{const z=yield R.modalController.create({component:ke.F});z.onDidDismiss().then((0,l.Z)(function*(){R.appManager.isUserAuthenticated(!0)&&(yield R.continueEdit())})),yield z.present()}else R.appManager.launchOCMWebPage("/poi/edit/"+R.poi.ID)})()}refresh(R=null){this.poi&&this.poiManager.getPOIById(this.poi.ID,!0,!0).then(z=>{z&&(this.poi=z,this.ngOnChanges(null)),R&&R.target.complete()})}}return Ue.\u0275fac=function(R){return new(R||Ue)(y.Y36(d.c),y.Y36(te.SH),y.Y36(Xe.sK),y.Y36(ze.z),y.Y36(te.IN),y.Y36(te.BX),y.Y36(_e.R),y.Y36(Oe.F0))},Ue.\u0275cmp=y.Xpm({type:Ue,selectors:[["poi-details"]],inputs:{poi:"poi"},features:[y.TTD],decls:2,vars:2,consts:[[4,"ngIf"],[1,"banner"],[1,"banner-content"],["color","primary","title","Average User Rating"],["vertical","top","horizontal","end","slot","fixed"],["name","add"],["side","bottom"],["title","Add a comment or charging check-in",3,"click"],["name","chatbubbles"],["title","Add a Photo",3,"click"],["name","camera"],["title","Add to Favourites",3,"click"],["name","star"],["title","Submit an Edit",3,"click"],["name","create"],["title","Refresh",3,"click"],["name","refresh"],["slot","fixed",3,"ionRefresh"],["pullingIcon","caret-down","pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refreshing..."],["slot","start"],["slot","end"],[1,"ion-padding"],[3,"ngModel","ngModelChange"],["value","location","selected",""],["value","comments"],["value","media"],["class","address-details",4,"ngIf"],["style","white-space: pre-wrap;",4,"ngIf"],["size","small","title","Add to Favourites",3,"click"],["name","star","slot","start"],["name","create","slot","start"],[3,"click"],["name","navigate","slot","start"],["size","small","title","Add a comment or charging check-in",3,"click"],["name","chatbubbles","slot","start"],["size","small","title","Add a Photo",3,"click"],["name","camera","slot","start"],[1,"address-details"],["name","battery-charging"],[3,"item"],["name","book"],["name","information-circle"],["class","details",4,"ngIf"],["name","map"],[1,"label"],[1,"details"],["name","pin"],[1,"details-minor"],["name","call"],["name","mail"],["name","globe"],["target","_system",3,"href"],["name","help-circle"],[1,"ion-padding-left"],["name","link"],["href","javascript:void(0)",3,"click",4,"ngIf"],["href","javascript:void(0)",3,"click"],["class","ion-padding",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"src",4,"ngIf"],[3,"src"],["name","checkmark-circle","color","success",2,"font-size","2em"],["name","close-circle","color","danger"],[1,"subtle"],[2,"white-space","pre-wrap"]],template:function(R,z){1&R&&(y.YNc(0,dn,51,21,"div",0),y.YNc(1,wt,5,0,"div",0)),2&R&&(y.Q6J("ngIf",null!=z.poi&&null!=z.poi.AddressInfo),y.xp6(1),y.Q6J("ngIf",null==z.poi||null==z.poi.AddressInfo))},dependencies:[b.sg,b.O5,te.BJ,te.yp,te.YG,te.Sm,te.PM,te.FN,te.Zi,te.wI,te.IJ,te.W4,te.zq,te.jY,te.gu,te.Ie,te.Q$,te.nJ,te.Wo,te.Nd,te.cJ,te.GO,te.sr,te.QI,he.JJ,he.On,We.B,b.JJ,b.uU,Xe.X$],styles:[".banner[_ngcontent-%COMP%]{background-color:#4f712f;color:#ffffffec;padding:1em;text-shadow:#000 1px 1px 1px;min-height:180px;background-size:cover}.banner[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.banner-content[_ngcontent-%COMP%]{padding-right:48px}h3[_ngcontent-%COMP%]{font-weight:700}.label[_ngcontent-%COMP%]{color:#000;font-weight:700;font-size:12px}.details[_ngcontent-%COMP%]{color:#707d61;margin-left:1em;font-size:12px}.details-minor[_ngcontent-%COMP%]{color:#707d61;font-size:12px}p[_ngcontent-%COMP%]{display:block;padding:4px}ion-card-header[_ngcontent-%COMP%]{font-weight:700;padding-bottom:0}ion-card-content[_ngcontent-%COMP%]{padding-top:4px}"]}),Ue})(),gn=(()=>{class Ue{constructor(R,z,ce){this.modalController=R,this.navParams=z,this.appManager=ce,this.hasNavbar=!1,this.poi=this.navParams.get("item"),this.appManager.analytics.viewEvent("POIDetails")}close(){this.modalController.dismiss()}}return Ue.\u0275fac=function(R){return new(R||Ue)(y.Y36(te.IN),y.Y36(te.X1),y.Y36(d.c))},Ue.\u0275cmp=y.Xpm({type:Ue,selectors:[["ng-component"]],decls:11,vars:3,consts:[["color","primary"],["slot","start"],[3,"click"],["name","close","slot","icon-only"],[1,"poi-details"],[3,"poi"]],template:function(R,z){1&R&&(y.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),y._uU(3),y.TgZ(4,"small"),y._uU(5),y.qZA()(),y.TgZ(6,"ion-buttons",1)(7,"ion-button",2),y.NdJ("click",function(){return z.close()}),y._UZ(8,"ion-icon",3),y.qZA()()()(),y.TgZ(9,"ion-content",4),y._UZ(10,"poi-details",5),y.qZA()),2&R&&(y.xp6(3),y.hij(" ",z.poi.AddressInfo.Title," "),y.xp6(2),y.hij("OCM-",z.poi.ID,""),y.xp6(5),y.Q6J("poi",z.poi))},dependencies:[te.YG,te.Sm,te.W2,te.Gu,te.gu,te.wd,te.sr,Pt],styles:['.left-col[_ngcontent-%COMP%]{float:left;width:50%;overflow:auto}.right-col[_ngcontent-%COMP%]{float:right;width:50%;overflow:auto}.row[_ngcontent-%COMP%]:after{content:"";display:table;clear:both;overflow:auto}.row[_ngcontent-%COMP%]{margin-bottom:1em}.subtle[_ngcontent-%COMP%]{color:silver}@media screen and (max-width: 768px){.left-col[_ngcontent-%COMP%]{float:none;width:100%}.right-col[_ngcontent-%COMP%]{margin-top:1em;float:none;width:100%}}.address-details[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:200px;width:auto}ion-label[_ngcontent-%COMP%]{overflow:inherit}ion-title[_ngcontent-%COMP%] > small[_ngcontent-%COMP%]{color:#ffffffbf}']}),Ue})()},1948:(Pn,Et,k)=>{"use strict";k.r(Et),k.d(Et,{PoiEditorPageModule:()=>Ve});var d=k(6895),y=k(4006),te=k(4228),l=k(425),q=k(4508),re=k(4463),b=k(8936),he=k(8274);const Me=[{path:"",component:q.Y}];let Ve=(()=>{class X{}return X.\u0275fac=function(fe){return new(fe||X)},X.\u0275mod=he.oAB({type:X}),X.\u0275inj=he.cJS({imports:[d.ez,y.u5,l.Pc,re.aw,b.e,te.Bz.forChild(Me)]}),X})()},4508:(Pn,Et,k)=>{"use strict";k.d(Et,{Y:()=>Zt});var d=k(5861),y=k(3855),te=k(8016),l=k(6579),q=k(9698),re=k(4781),b=k(8274),he=k(4120),Me=k(5906),Ve=k(553),X=k(7689),xe=k(6260),fe=k(529),ze=k(6895),le=k(425);function Ke(It,He){if(1&It){const ne=b.EpF();b.ynx(0),b.TgZ(1,"ion-note")(2,"p"),b._uU(3," The closest address to this position is: "),b.qZA(),b.TgZ(4,"p")(5,"strong"),b._uU(6),b.qZA(),b._UZ(7,"br"),b._uU(8),b._UZ(9,"br"),b.TgZ(10,"ion-button",3),b.NdJ("click",function(){b.CHM(ne);const jt=b.oxw();return b.KtG(jt.useAddressSelection())}),b._uU(11,"Use this address below "),b._UZ(12,"ion-icon",4),b.qZA()()(),b.BQk()}if(2&It){const ne=b.oxw();b.xp6(6),b.Oqu(ne.suggestedAddress.AddressLine1),b.xp6(2),b.HOy(" ",ne.suggestedAddress.AddressLine2," ",ne.suggestedAddress.Town," ",ne.suggestedAddress.StateOrProvince," ",ne.suggestedAddress.Postcode," ")}}let Oe=(()=>{class It{constructor(ne,Je,jt,Qt,li){this.mapping=ne,this.events=Je,this.logging=jt,this.http=Qt,this.appManager=li,this.latitudeChange=new b.vpe,this.longitudeChange=new b.vpe,this.suggestedAddress=null,this.suggestedAddressChange=new b.vpe,this.onUseSuggestedAddress=new b.vpe,this.suggestedAddressAttribution=null,this.suggestedAddressAttributionChange=new b.vpe,this.isMapInitialised=!1}ngOnInit(){this.mapService=new Ve.k(this.events,this.logging,this.http),this.mapService.initAPI(),this.mapOptions=new Me._,this.mapOptions.mapType=this.appManager.searchSettings.MapType,this.mapOptions.onMapMoveCompleted=()=>{let ne;ne=this.mapService.getMapCenter(),ne.subscribe(Je=>{Je&&(this.latitude=Je.coords.latitude,this.longitude=Je.coords.longitude,this.latitudeChange.emit(this.latitude),this.longitudeChange.emit(this.longitude),this.getAddressForCurrentLatLng())})}}ngAfterContentInit(){this.focusMap()}ngOnDestroy(){this.mapService.disposeMap()}focusMap(){0==this.isMapInitialised&&this.mapService&&0!=this.latitude&&0!=this.longitude&&(this.isMapInitialised=!0,this.mapService.initMap("editor-map",this.mapOptions,null),this.mapService.setMapCenter(new he.jR(this.latitude,this.longitude)),this.originalMarkerPos=new he.wC(this.latitude,this.longitude))}ngOnChanges(ne){this.focusMap()}getAddressForCurrentLatLng(){var ne=this;return(0,d.Z)(function*(){ne.latitude&&ne.longitude&&ne.appManager.api.fetchReverseGeocodeResult(ne.latitude,ne.longitude).then(Je=>{Je.AddressInfo&&(ne.suggestedAddress=Je.AddressInfo)})})()}useAddressSelection(){this.onUseSuggestedAddress.emit({suggestedAddress:this.suggestedAddress,attribution:this.suggestedAddressAttribution}),this.suggestedAddress=null,this.suggestedAddressAttribution=null}}return It.\u0275fac=function(ne){return new(ne||It)(b.Y36(re.v),b.Y36(xe.z),b.Y36(X.z),b.Y36(fe.eN),b.Y36(y.c))},It.\u0275cmp=b.Xpm({type:It,selectors:[["app-poi-location-editor"]],inputs:{latitude:"latitude",longitude:"longitude"},outputs:{latitudeChange:"latitudeChange",longitudeChange:"longitudeChange",suggestedAddressChange:"suggestedAddressChange",onUseSuggestedAddress:"onUseSuggestedAddress",suggestedAddressAttributionChange:"suggestedAddressAttributionChange"},features:[b.TTD],decls:4,vars:1,consts:[[1,"instruction"],["id","editor-map"],[4,"ngIf"],["size","small",3,"click"],["slot","end","name","copy"]],template:function(ne,Je){1&ne&&(b.TgZ(0,"p",0),b._uU(1,"Drag the map to center the marker on the charging location:"),b.qZA(),b._UZ(2,"div",1),b.YNc(3,Ke,13,5,"ng-container",2)),2&ne&&(b.xp6(3),b.Q6J("ngIf",Je.suggestedAddress))},dependencies:[ze.O5,le.YG,le.gu,le.uN],styles:["#editor-map[_ngcontent-%COMP%]{border:1px solid gainsboro;background-color:gray;width:100%;height:128px}"]}),It})();var Q=k(6799),Ye=k(4006);function St(It,He){if(1&It&&(b.TgZ(0,"ion-select-option",14),b._uU(1),b.qZA()),2&It){const ne=He.$implicit;b.Q6J("value",ne.ID),b.xp6(1),b.Oqu(ne.Title)}}function lt(It,He){if(1&It&&(b.TgZ(0,"ion-select-option",14),b._uU(1),b.qZA()),2&It){const ne=He.$implicit;b.Q6J("value",ne.ID),b.xp6(1),b.Oqu(ne.Title)}}function _e(It,He){if(1&It&&(b.TgZ(0,"ion-select-option",14),b._uU(1),b.qZA()),2&It){const ne=He.$implicit;b.Q6J("value",ne.ID),b.xp6(1),b.Oqu(ne.Title)}}let ke=(()=>{class It{constructor(ne,Je){this.modalController=ne,this.referenceDataManager=Je,this.useFilteredConnectionTypes=!0,this.useFilteredOperators=!0}get isAddMode(){return!(null!=this.conn&&this.conn.ID>0)}get connectionTypes(){return this.referenceDataManager.getConnectionTypes(this.useFilteredConnectionTypes)}get currentTypes(){return this.referenceDataManager.getOutputCurrentTypes()}get statusTypes(){return this.referenceDataManager.getStatusTypes().filter(ne=>1==ne.IsUserSelectable)}ngOnInit(){}save(){this.modalController.dismiss({item:this.conn})}cancel(){this.modalController.dismiss()}}return It.\u0275fac=function(ne){return new(ne||It)(b.Y36(le.IN),b.Y36(Q.W))},It.\u0275cmp=b.Xpm({type:It,selectors:[["app-poi-equipment-editor"]],decls:60,vars:13,consts:[[1,"ion-padding"],["position","floating"],[3,"ngModel","ngModelChange"],["value","0"],[3,"value",4,"ngFor","ngForOf"],["type","number",3,"ngModel","ngModelChange"],["type","text","placeholder","(optional) other comments",3,"ngModel","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],["slot","start"],[3,"click"],["name","close","slot","start"],["slot","end"],["color","success",3,"click"],["name","send","slot","end"],[3,"value"]],template:function(ne,Je){1&ne&&(b.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),b._uU(3),b.qZA()()(),b.TgZ(4,"ion-content",0)(5,"p"),b._uU(6,"Please provide as much information as you can about the equipment. If you don't know then leave the field blank. At a minimum you should include the Connection Type and approximate Power kW (max)."),b.qZA(),b.TgZ(7,"ion-item")(8,"ion-label",1),b._uU(9,"Connection Type"),b.qZA(),b.TgZ(10,"ion-select",2),b.NdJ("ngModelChange",function(Qt){return Je.conn.ConnectionTypeID=Qt}),b.TgZ(11,"ion-select-option",3),b._uU(12,"Unknown"),b.qZA(),b.YNc(13,St,2,2,"ion-select-option",4),b.qZA()(),b.TgZ(14,"ion-item")(15,"ion-label",1),b._uU(16,"Supply Type"),b.qZA(),b.TgZ(17,"ion-select",2),b.NdJ("ngModelChange",function(Qt){return Je.conn.CurrentTypeID=Qt}),b.TgZ(18,"ion-select-option",3),b._uU(19,"Unknown"),b.qZA(),b.YNc(20,lt,2,2,"ion-select-option",4),b.qZA()(),b.TgZ(21,"ion-item")(22,"ion-label",1),b._uU(23,"Power (kW)"),b.qZA(),b.TgZ(24,"ion-input",5),b.NdJ("ngModelChange",function(Qt){return Je.conn.PowerKW=Qt}),b.qZA()(),b.TgZ(25,"ion-item")(26,"ion-label",1),b._uU(27,"Amps"),b.qZA(),b.TgZ(28,"ion-input",5),b.NdJ("ngModelChange",function(Qt){return Je.conn.Amps=Qt}),b.qZA()(),b.TgZ(29,"ion-item")(30,"ion-label",1),b._uU(31,"Voltage"),b.qZA(),b.TgZ(32,"ion-input",5),b.NdJ("ngModelChange",function(Qt){return Je.conn.Voltage=Qt}),b.qZA()(),b.TgZ(33,"ion-item")(34,"ion-label",1),b._uU(35,"Status"),b.qZA(),b.TgZ(36,"ion-select",2),b.NdJ("ngModelChange",function(Qt){return Je.conn.StatusTypeID=Qt}),b.YNc(37,_e,2,2,"ion-select-option",4),b.qZA()(),b.TgZ(38,"ion-item")(39,"ion-label",1),b._uU(40,"Quantity Available"),b.qZA(),b.TgZ(41,"ion-input",5),b.NdJ("ngModelChange",function(Qt){return Je.conn.Quantity=Qt}),b.qZA()(),b.TgZ(42,"ion-item")(43,"ion-label",1),b._uU(44,"Comment"),b.qZA(),b.TgZ(45,"ion-input",6),b.NdJ("ngModelChange",function(Qt){return Je.conn.Comments=Qt}),b.qZA()(),b.TgZ(46,"ion-item")(47,"ion-label",1),b._uU(48,"Operators Reference"),b.qZA(),b.TgZ(49,"ion-input",7),b.NdJ("ngModelChange",function(Qt){return Je.conn.Reference=Qt}),b.qZA()()(),b.TgZ(50,"ion-footer")(51,"ion-toolbar")(52,"ion-buttons",8)(53,"ion-button",9),b.NdJ("click",function(){return Je.cancel()}),b._UZ(54,"ion-icon",10),b._uU(55," Cancel "),b.qZA()(),b.TgZ(56,"ion-buttons",11)(57,"ion-button",12),b.NdJ("click",function(){return Je.save()}),b._uU(58," OK "),b._UZ(59,"ion-icon",13),b.qZA()()()()),2&ne&&(b.xp6(3),b.Oqu(Je.isAddMode?"Add Equipment":"Edit Equipment"),b.xp6(7),b.Q6J("ngModel",Je.conn.ConnectionTypeID),b.xp6(3),b.Q6J("ngForOf",Je.connectionTypes),b.xp6(4),b.Q6J("ngModel",Je.conn.CurrentTypeID),b.xp6(3),b.Q6J("ngForOf",Je.currentTypes),b.xp6(4),b.Q6J("ngModel",Je.conn.PowerKW),b.xp6(4),b.Q6J("ngModel",Je.conn.Amps),b.xp6(4),b.Q6J("ngModel",Je.conn.Voltage),b.xp6(4),b.Q6J("ngModel",Je.conn.StatusTypeID),b.xp6(1),b.Q6J("ngForOf",Je.statusTypes),b.xp6(4),b.Q6J("ngModel",Je.conn.Quantity),b.xp6(4),b.Q6J("ngModel",Je.conn.Comments),b.xp6(4),b.Q6J("ngModel",Je.conn.Reference))},dependencies:[ze.sg,le.YG,le.Sm,le.W2,le.fr,le.Gu,le.gu,le.pK,le.Ie,le.Q$,le.t9,le.n0,le.wd,le.sr,le.as,le.QI,le.j9,Ye.JJ,Ye.On]}),It})();var Ne=(()=>{return(It=Ne||(Ne={}))[It.Unknown=0]="Unknown",It[It.CurrentlyAvailable=10]="CurrentlyAvailable",It[It.CurrentlyInUse=20]="CurrentlyInUse",It[It.TemporarilyUnavailable=30]="TemporarilyUnavailable",It[It.Operational=50]="Operational",It[It.PartlyOperational=75]="PartlyOperational",It[It.NotOperational=100]="NotOperational",It[It.PlannedForFutureDate=150]="PlannedForFutureDate",It[It.RemovedDecomissioned=200]="RemovedDecomissioned",Ne;var It})(),we=(()=>{return(It=we||(we={}))[It.UnknownOperator=1]="UnknownOperator",It[It.SiteOwner=45]="SiteOwner",we;var It})(),ge=k(6585),de=k(1099);function oe(It,He){if(1&It&&(b.TgZ(0,"ion-select-option",5),b._uU(1),b.qZA()),2&It){const ne=He.$implicit;b.Q6J("value",ne.ID),b.xp6(1),b.Oqu(ne.Title)}}function Ee(It,He){1&It&&(b.TgZ(0,"ion-select-option",6),b._uU(1,"Other..."),b.qZA())}function vt(It,He){if(1&It){const ne=b.EpF();b.TgZ(0,"ion-item")(1,"ion-label",1),b._uU(2,"Network Operator"),b.qZA(),b.TgZ(3,"ion-select",2),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw();return b.KtG(Qt.operatorId=jt)})("ionChange",function(){b.CHM(ne);const jt=b.oxw();return b.KtG(jt.onOperatorChange())}),b.YNc(4,oe,2,2,"ion-select-option",3),b.YNc(5,Ee,2,0,"ion-select-option",4),b.qZA()()}if(2&It){const ne=b.oxw();b.xp6(3),b.Q6J("ngModel",ne.operatorId),b.xp6(1),b.Q6J("ngForOf",ne.operators),b.xp6(1),b.Q6J("ngIf",ne.useFilteredOperators)}}function Tt(It,He){if(1&It){const ne=b.EpF();b.TgZ(0,"ion-item")(1,"ion-label"),b._uU(2,"Network Operator"),b.qZA(),b.TgZ(3,"ion-searchbar",7),b.NdJ("ionCancel",function(){b.CHM(ne);const jt=b.oxw();return b.KtG(jt.cancelOperatorLookup())})("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw();return b.KtG(Qt.operatorSearchKeyword=jt)})("ionChange",function(jt){b.CHM(ne);const Qt=b.oxw();return b.KtG(Qt.searchOperators(jt))}),b.qZA()()}if(2&It){const ne=b.oxw();b.xp6(3),b.Q6J("ngModel",ne.operatorSearchKeyword)}}function Gt(It,He){if(1&It){const ne=b.EpF();b.TgZ(0,"ion-item",9),b.NdJ("click",function(){const Qt=b.CHM(ne).$implicit,li=b.oxw(2);return b.KtG(li.onOperatorChange(Qt))}),b.TgZ(1,"ion-avatar",10),b._UZ(2,"ion-icon",11),b.qZA(),b.TgZ(3,"ion-label")(4,"p"),b._uU(5),b.qZA(),b.TgZ(6,"p"),b._uU(7),b.qZA()()()}if(2&It){const ne=He.$implicit;b.xp6(5),b.Oqu(ne.Title),b.xp6(2),b.Oqu(ne.WebsiteURL)}}function Ot(It,He){if(1&It&&(b.ynx(0),b.TgZ(1,"ion-list"),b.YNc(2,Gt,8,2,"ion-item",8),b.qZA(),b.BQk()),2&It){const ne=b.oxw();b.xp6(2),b.Q6J("ngForOf",ne.operatorSearchResults)}}function yt(It,He){if(1&It){const ne=b.EpF();b.ynx(0),b.TgZ(1,"ion-item")(2,"ion-avatar",10),b._UZ(3,"ion-icon",12),b.qZA(),b.TgZ(4,"ion-label")(5,"p"),b._uU(6),b.qZA(),b.TgZ(7,"p"),b._uU(8),b.qZA(),b.TgZ(9,"ion-button",9),b.NdJ("click",function(){b.CHM(ne);const jt=b.oxw();return b.KtG(jt.selectedOperator=null)}),b._uU(10,"Change"),b.qZA()()(),b.BQk()}if(2&It){const ne=b.oxw();b.xp6(6),b.Oqu(ne.selectedOperator.Title),b.xp6(2),b.Oqu(ne.selectedOperator.WebsiteURL)}}let Mt=(()=>{class It{constructor(ne){this.referenceDataManager=ne,this.operatorId=null,this.useFilteredOperators=null,this.operatorChanged=new b.vpe,this.operatorCache=[],this.operatorSearchResults=[],this.operatorSearchKeyword="",this.selectedOperator=null}get operators(){return this.referenceDataManager.getNetworkOperators(this.useFilteredOperators)}ngOnInit(){this.operatorCache=this.referenceDataManager.getNetworkOperators(!1),null!=this.operatorId&&(this.selectedOperator=this.operatorCache.find(ne=>ne.ID==this.operatorId))}searchOperators(){this.operatorSearchResults=[],0!=this.operatorSearchKeyword.length&&(this.operatorSearchResults=this.operatorCache?this.operatorCache.filter(ne=>ne.Title.toLowerCase().startsWith(this.operatorSearchKeyword.toLowerCase())||ne.Title.toLowerCase().startsWith("("+this.operatorSearchKeyword.toLowerCase())).slice(0,10):[])}onOperatorChange(ne=null){var Je=this;return(0,d.Z)(function*(){null==ne&&Je.operatorId&&(ne=Je.operatorCache.find(jt=>jt.ID==Je.operatorId)),null!=ne&&(Je.operatorSearchResults=[],Je.selectedOperator=ne,Je.operatorId=ne.ID),Je.operatorId?Je.operatorChanged.emit(Je.selectedOperator):Je.useFilteredOperators=!1})()}cancelOperatorLookup(){this.selectedOperator=null}}return It.\u0275fac=function(ne){return new(ne||It)(b.Y36(Q.W))},It.\u0275cmp=b.Xpm({type:It,selectors:[["app-operator-lookup"]],inputs:{operatorId:"operatorId",useFilteredOperators:"useFilteredOperators"},outputs:{operatorChanged:"operatorChanged"},decls:4,vars:4,consts:[[4,"ngIf"],["position","floating"],[3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["value","",4,"ngIf"],[3,"value"],["value",""],["placeholder","Search by network name (in any country)","showCancelButton","focus","autocomplete","on",3,"ngModel","ionCancel","ngModelChange","ionChange"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["item-left",""],["name","card"],["name","locate"]],template:function(ne,Je){1&ne&&(b.YNc(0,vt,6,3,"ion-item",0),b.YNc(1,Tt,4,1,"ion-item",0),b.YNc(2,Ot,3,1,"ng-container",0),b.YNc(3,yt,11,2,"ng-container",0)),2&ne&&(b.Q6J("ngIf",Je.useFilteredOperators&&!Je.selectedOperator),b.xp6(1),b.Q6J("ngIf",!Je.useFilteredOperators&&!Je.selectedOperator),b.xp6(1),b.Q6J("ngIf",Je.operatorSearchResults.length>0),b.xp6(1),b.Q6J("ngIf",null!=Je.selectedOperator))},dependencies:[ze.sg,ze.O5,le.BJ,le.YG,le.gu,le.Ie,le.Q$,le.q_,le.VI,le.t9,le.n0,le.QI,le.j9,Ye.JJ,Ye.On]}),It})();function gt(It,He){1&It&&b._UZ(0,"ion-icon",13)}function it(It,He){1&It&&b._UZ(0,"ion-icon",13)}function at(It,He){1&It&&b._UZ(0,"ion-icon",13)}function Ce(It,He){if(1&It&&(b.TgZ(0,"ion-select-option",27),b._uU(1),b.qZA()),2&It){const ne=He.$implicit;b.Q6J("value",ne.ID),b.xp6(1),b.Oqu(ne.Title)}}function bt(It,He){if(1&It){const ne=b.EpF();b.ynx(0),b.TgZ(1,"app-poi-location-editor",14,15),b.NdJ("latitudeChange",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.item.AddressInfo.Latitude=jt)})("longitudeChange",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.item.AddressInfo.Longitude=jt)})("onUseSuggestedAddress",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.useSuggestedAddress(jt))}),b.qZA(),b.TgZ(3,"ion-list")(4,"ion-item")(5,"ion-label",16),b._uU(6,"Location Name"),b.qZA(),b.TgZ(7,"ion-input",17),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.item.AddressInfo.Title=jt)}),b.qZA()(),b.TgZ(8,"ion-item")(9,"ion-label",16),b._uU(10,"Address Line 1"),b.qZA(),b.TgZ(11,"ion-input",18),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.item.AddressInfo.AddressLine1=jt)}),b.qZA()(),b.TgZ(12,"ion-item")(13,"ion-label",16),b._uU(14,"Address Line 2"),b.qZA(),b.TgZ(15,"ion-input",19),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.item.AddressInfo.AddressLine2=jt)}),b.qZA()(),b.TgZ(16,"ion-item")(17,"ion-label",16),b._uU(18,"Town"),b.qZA(),b.TgZ(19,"ion-input",20),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.item.AddressInfo.Town=jt)}),b.qZA()(),b.TgZ(20,"ion-item")(21,"ion-label",16),b._uU(22,"State or Province"),b.qZA(),b.TgZ(23,"ion-input",21),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.item.AddressInfo.StateOrProvince=jt)}),b.qZA()(),b.TgZ(24,"ion-item")(25,"ion-label",16),b._uU(26,"Postal Code"),b.qZA(),b.TgZ(27,"ion-input",22),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.item.AddressInfo.Postcode=jt)}),b.qZA()(),b.TgZ(28,"ion-item")(29,"ion-label",16),b._uU(30,"Country"),b.qZA(),b.TgZ(31,"ion-select",23),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.item.AddressInfo.CountryID=jt)})("ionChange",function(){b.CHM(ne);const jt=b.oxw(2);return b.KtG(jt.onCountryChange())}),b.YNc(32,Ce,2,2,"ion-select-option",24),b.qZA()(),b.TgZ(33,"ion-item")(34,"ion-label",16),b._uU(35,"Latitude"),b.qZA(),b.TgZ(36,"ion-input",25),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.item.AddressInfo.Latitude=jt)}),b.qZA()(),b.TgZ(37,"ion-item")(38,"ion-label",16),b._uU(39,"Longitude"),b.qZA(),b.TgZ(40,"ion-input",26),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.item.AddressInfo.Longitude=jt)}),b.qZA()()(),b.BQk()}if(2&It){const ne=b.oxw(2);b.xp6(1),b.Q6J("latitude",ne.item.AddressInfo.Latitude)("longitude",ne.item.AddressInfo.Longitude),b.xp6(6),b.Q6J("ngModel",ne.item.AddressInfo.Title),b.xp6(4),b.Q6J("ngModel",ne.item.AddressInfo.AddressLine1),b.xp6(4),b.Q6J("ngModel",ne.item.AddressInfo.AddressLine2),b.xp6(4),b.Q6J("ngModel",ne.item.AddressInfo.Town),b.xp6(4),b.Q6J("ngModel",ne.item.AddressInfo.StateOrProvince),b.xp6(4),b.Q6J("ngModel",ne.item.AddressInfo.Postcode),b.xp6(4),b.Q6J("ngModel",ne.item.AddressInfo.CountryID),b.xp6(1),b.Q6J("ngForOf",ne.countries),b.xp6(4),b.Q6J("ngModel",ne.item.AddressInfo.Latitude),b.xp6(4),b.Q6J("ngModel",ne.item.AddressInfo.Longitude)}}function kt(It,He){if(1&It){const ne=b.EpF();b.ynx(0),b.TgZ(1,"h3"),b._uU(2,"Locations Nearby"),b.qZA(),b.TgZ(3,"p")(4,"strong"),b._uU(5,"The following locations already exist nearby."),b.qZA()(),b.TgZ(6,"div",28)(7,"p"),b._uU(8,"Ensure you are not adding a duplicate site unless it is for different equipment from another network operator."),b.qZA(),b.TgZ(9,"p"),b._uU(10,"You can edit any of these listings if required instead:"),b.qZA()(),b.TgZ(11,"app-poi-list",29),b.NdJ("onEdit",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.editPOI(jt))}),b.qZA(),b.BQk()}if(2&It){const ne=b.oxw(2);b.xp6(11),b.Q6J("poiList",ne.nearbySites)("enableEditOption",!0)}}function Vt(It,He){if(1&It&&(b.ynx(0),b.YNc(1,bt,41,12,"ng-container",9),b.YNc(2,kt,12,2,"ng-container",9),b.BQk()),2&It){const ne=b.oxw();b.xp6(1),b.Q6J("ngIf","location"==ne.step),b.xp6(1),b.Q6J("ngIf","poi-nearby"==ne.step)}}function yn(It,He){if(1&It){const ne=b.EpF();b.ynx(0),b.TgZ(1,"p"),b._uU(2,"Copied the equipment configuration from:"),b.qZA(),b.TgZ(3,"ion-item")(4,"ion-label"),b._uU(5),b._UZ(6,"br"),b._uU(7),b._UZ(8,"br"),b._uU(9),b._UZ(10,"br"),b._uU(11),b._UZ(12,"br"),b._uU(13),b.qZA(),b.TgZ(14,"ion-button",31),b.NdJ("click",function(){b.CHM(ne);const jt=b.oxw(5);return b.KtG(jt.changeTemplatePOI())}),b._uU(15,"Change.."),b.qZA()(),b.BQk()}if(2&It){const ne=b.oxw(5);b.xp6(5),b.hij(" ",ne.selectedTemplatePOI.AddressInfo.Title," "),b.xp6(2),b.hij(" ",ne.selectedTemplatePOI.AddressInfo.AddressLine1," "),b.xp6(2),b.hij(" ",null==ne.selectedTemplatePOI.Connections[0].ConnectionType?null:ne.selectedTemplatePOI.Connections[0].ConnectionType.Title," "),b.xp6(2),b.hij(" ",ne.selectedTemplatePOI.Connections[0].PowerKW," "),b.xp6(2),b.hij(" ",ne.selectedTemplatePOI.DateCreated," ")}}function Fn(It,He){if(1&It){const ne=b.EpF();b.ynx(0),b.TgZ(1,"h4"),b._uU(2,"Similar Sites"),b.qZA(),b.TgZ(3,"app-poi-list",32),b.NdJ("onCopy",function(jt){b.CHM(ne);const Qt=b.oxw(6);return b.KtG(Qt.useTemplatePOI(jt))}),b.qZA(),b.BQk()}if(2&It){const ne=b.oxw(6);b.xp6(3),b.Q6J("enableCopyOption",!0)("poiList",ne.templateSites)}}function cn(It,He){1&It&&(b.ynx(0),b.TgZ(1,"p"),b._uU(2," There are no suggested sites to copy for this network operator. "),b.qZA(),b.BQk())}function ot(It,He){if(1&It&&(b.ynx(0),b.YNc(1,Fn,4,2,"ng-container",9),b.YNc(2,cn,3,0,"ng-container",9),b.BQk()),2&It){const ne=b.oxw(5);b.xp6(1),b.Q6J("ngIf",ne.templateSites.length>0),b.xp6(1),b.Q6J("ngIf",0==ne.templateSites.length)}}function Nt(It,He){if(1&It&&(b.ynx(0),b.YNc(1,yn,16,5,"ng-container",9),b.YNc(2,ot,3,2,"ng-container",9),b.BQk()),2&It){const ne=b.oxw(4);b.xp6(1),b.Q6J("ngIf",ne.selectedTemplatePOI),b.xp6(1),b.Q6J("ngIf",!ne.selectedTemplatePOI)}}function bn(It,He){if(1&It){const ne=b.EpF();b.ynx(0),b.TgZ(1,"p",28),b._uU(2,"You can copy the equipment settings from other sites operated by the same network operator or choose 'Next' to skip this step: "),b.qZA(),b.TgZ(3,"app-operator-lookup",30),b.NdJ("operatorChanged",function(jt){b.CHM(ne);const Qt=b.oxw(3);return b.KtG(Qt.onOperatorChange(jt))}),b.qZA(),b.YNc(4,Nt,3,2,"ng-container",9),b.BQk()}if(2&It){const ne=b.oxw(3);b.xp6(3),b.Q6J("operatorId",ne.item.OperatorID),b.xp6(1),b.Q6J("ngIf",ne.item.AddressInfo.CountryID&&ne.item.OperatorID)}}function Kn(It,He){if(1&It&&(b.ynx(0),b.YNc(1,bn,5,2,"ng-container",9),b.BQk()),2&It){const ne=b.oxw(2);b.xp6(1),b.Q6J("ngIf",!ne.skipPOICopy)}}function ri(It,He){if(1&It){const ne=b.EpF();b.ynx(0),b.TgZ(1,"app-operator-lookup",33),b.NdJ("operatorChanged",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.onOperatorChange(jt))}),b.qZA(),b.TgZ(2,"ion-item")(3,"ion-label",16),b._uU(4,"Number of Stations or Parking Bays"),b.qZA(),b.TgZ(5,"ion-input",21),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.item.NumberOfPoints=jt)}),b.qZA()(),b.TgZ(6,"h4"),b._uU(7,"Equipment"),b.qZA(),b.TgZ(8,"ion-button",34),b.NdJ("click",function(){b.CHM(ne);const jt=b.oxw(2);return b.KtG(jt.addConnection())}),b._UZ(9,"ion-icon",35),b.qZA(),b.TgZ(10,"app-equipment-details",36),b.NdJ("onEdit",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.editConnection(jt))})("onDelete",function(jt){b.CHM(ne);const Qt=b.oxw(2);return b.KtG(Qt.deleteConnection(jt))}),b.qZA(),b.BQk()}if(2&It){const ne=b.oxw(2);b.xp6(1),b.Q6J("operatorId",ne.item.OperatorID)("useFilteredOperators",!1),b.xp6(4),b.Q6J("ngModel",ne.item.NumberOfPoints),b.xp6(5),b.Q6J("item",ne.item)("enableEdit",!0)}}function Bn(It,He){if(1&It&&(b.ynx(0),b.YNc(1,Kn,2,1,"ng-container",9),b.YNc(2,ri,11,5,"ng-container",9),b.BQk()),2&It){const ne=b.oxw();b.xp6(1),b.Q6J("ngIf","copy-equipment"==ne.step),b.xp6(1),b.Q6J("ngIf","edit-equipment"==ne.step)}}function pi(It,He){if(1&It&&(b.TgZ(0,"p",43)(1,"strong"),b._uU(2,"Your changes cannot be saved until the following issues are resolved:"),b.qZA(),b.TgZ(3,"ion-label",44),b._uU(4),b.qZA()()),2&It){const ne=b.oxw(2);b.xp6(4),b.hij(" ",ne.validationMsg,"")}}function bi(It,He){if(1&It&&(b.TgZ(0,"ion-select-option",27),b._uU(1),b.qZA()),2&It){const ne=He.$implicit;b.Q6J("value",ne.ID),b.xp6(1),b.Oqu(ne.Title)}}function vi(It,He){if(1&It&&(b.TgZ(0,"ion-select-option",27),b._uU(1),b.qZA()),2&It){const ne=He.$implicit;b.Q6J("value",ne.ID),b.xp6(1),b.Oqu(ne.Title)}}function Li(It,He){if(1&It){const ne=b.EpF();b.ynx(0),b.YNc(1,pi,5,1,"p",37),b.TgZ(2,"p"),b._uU(3,"Please provide any other facts related to this site. Additional comments (your charging experiences etc) can be added as check-in comments once the site is listed."),b.qZA(),b.TgZ(4,"ion-item")(5,"ion-label",16),b._uU(6,"Operational Status (All Equipment))"),b.qZA(),b.TgZ(7,"ion-select",38),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw();return b.KtG(Qt.item.StatusTypeID=jt)}),b.YNc(8,bi,2,2,"ion-select-option",24),b.qZA()(),b.TgZ(9,"ion-item")(10,"ion-label",16),b._uU(11,"Usage Type"),b.qZA(),b.TgZ(12,"ion-select",38),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw();return b.KtG(Qt.item.UsageTypeID=jt)}),b.YNc(13,vi,2,2,"ion-select-option",24),b.qZA()(),b.TgZ(14,"ion-item")(15,"ion-label",16),b._uU(16,"Usage Cost"),b.qZA(),b.TgZ(17,"ion-input",21),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw();return b.KtG(Qt.item.UsageCost=jt)}),b.qZA()(),b.TgZ(18,"ion-item")(19,"ion-label",16),b._uU(20,"General Comments"),b.qZA(),b.TgZ(21,"ion-input",39),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw();return b.KtG(Qt.item.GeneralComments=jt)}),b.qZA()(),b.TgZ(22,"ion-item")(23,"ion-label",16),b._uU(24,"Main Telephone Number "),b.qZA(),b.TgZ(25,"ion-input",40),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw();return b.KtG(Qt.item.AddressInfo.ContactTelephone1=jt)}),b.qZA()(),b.TgZ(26,"ion-item")(27,"ion-label",16),b._uU(28,"Other Telephone Number "),b.qZA(),b.TgZ(29,"ion-input",40),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw();return b.KtG(Qt.item.AddressInfo.ContactTelephone2=jt)}),b.qZA()(),b.TgZ(30,"ion-item")(31,"ion-label",16),b._uU(32,"Access Comments"),b.qZA(),b.TgZ(33,"ion-input",41),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw();return b.KtG(Qt.item.AddressInfo.AccessComments=jt)}),b.qZA()(),b.TgZ(34,"ion-item")(35,"ion-label",16),b._uU(36,"Related Website"),b.qZA(),b.TgZ(37,"ion-input",42),b.NdJ("ngModelChange",function(jt){b.CHM(ne);const Qt=b.oxw();return b.KtG(Qt.item.AddressInfo.RelatedURL=jt)}),b.qZA()(),b.BQk()}if(2&It){const ne=b.oxw();b.xp6(1),b.Q6J("ngIf",ne.validationMsg),b.xp6(6),b.Q6J("ngModel",ne.item.StatusTypeID),b.xp6(1),b.Q6J("ngForOf",ne.statusTypes),b.xp6(4),b.Q6J("ngModel",ne.item.UsageTypeID),b.xp6(1),b.Q6J("ngForOf",ne.usageTypes),b.xp6(4),b.Q6J("ngModel",ne.item.UsageCost),b.xp6(4),b.Q6J("ngModel",ne.item.GeneralComments),b.xp6(4),b.Q6J("ngModel",ne.item.AddressInfo.ContactTelephone1),b.xp6(4),b.Q6J("ngModel",ne.item.AddressInfo.ContactTelephone2),b.xp6(4),b.Q6J("ngModel",ne.item.AddressInfo.AccessComments),b.xp6(4),b.Q6J("ngModel",ne.item.AddressInfo.RelatedURL)}}function Si(It,He){if(1&It){const ne=b.EpF();b.TgZ(0,"ion-button",1),b.NdJ("click",function(){b.CHM(ne);const jt=b.oxw();return b.KtG(jt.previous())}),b._uU(1," Previous "),b._UZ(2,"ion-icon",45),b.qZA()}}function Fi(It,He){if(1&It){const ne=b.EpF();b.TgZ(0,"ion-button",1),b.NdJ("click",function(){b.CHM(ne);const jt=b.oxw();return b.KtG(jt.next())}),b._uU(1," Next "),b._UZ(2,"ion-icon",46),b.qZA()}}function Yi(It,He){if(1&It){const ne=b.EpF();b.TgZ(0,"ion-button",47),b.NdJ("click",function(){b.CHM(ne);const jt=b.oxw();return b.KtG(jt.save())}),b._uU(1," Submit "),b._UZ(2,"ion-icon",48),b.qZA()}}let Zt=(()=>{class It{constructor(ne,Je,jt,Qt,li,Ii){this.appManager=ne,this.modalController=Je,this.poiManager=jt,this.mapping=Qt,this.loadingController=li,this.alertController=Ii,this.useFilteredConnectionTypes=!0,this.templateSites=[],this.nearbySites=[],this.selectedTemplatePOI=null,this.suggestedAddress=null,this.suggestedAddressAttribution=null,this.isNonDuplicateConfirmed=!1,this.skipPOICopy=!1,this.validationMsg=null,this.initNewItem()}get countries(){return this.appManager.referenceDataManager.getCountries()}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes()}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes().filter(ne=>1==ne.IsUserSelectable)}get isAddMode(){return this.item.ID<=0}initNewItem(){this.item={ID:-1,DataProviderID:1,DataProvidersReference:null,OperatorsReference:null,OperatorID:1,UsageCost:null,UsageTypeID:4,NumberOfPoints:1,GeneralComments:null,DatePlanned:null,StatusTypeID:50,SubmissionStatusTypeID:null,Connections:[],MetadataValues:[],AddressInfo:{ID:-1,CountryID:18,Title:"",AddressLine1:"",Latitude:0,Longitude:0}},this.step="location",this.selectedTab="location"}get isReadyToSubmit(){return this.validate().isValid&&"info"==this.step}ngOnInit(){}presentLoadingUI(){var ne=this;return(0,d.Z)(function*(){ne.loading=yield ne.loadingController.create({message:"Please Wait.."}),yield ne.loading.present()})()}dismissLoadingUI(){var ne=this;return(0,d.Z)(function*(){ne.loading&&(yield ne.loading.dismiss())})()}ionViewDidEnter(){if(null!=this.id)this.editExistingPOI(this.id);else{let ne=localStorage.getItem("_editor-operatorid");ne&&(this.item.OperatorID=parseInt(ne,10)),this.startPos?(this.item.AddressInfo.Latitude=this.startPos.latitude,this.item.AddressInfo.Longitude=this.startPos.longitude):this.mapping&&this.mapping.getMapCenter().subscribe(Je=>{Je&&(this.item.AddressInfo.Latitude=Je.coords.latitude,this.item.AddressInfo.Longitude=Je.coords.longitude)})}this.refreshFilteredReferenceData()}previous(){var ne=this;return(0,d.Z)(function*(){switch(ne.step){case"info":ne.step="edit-equipment";break;case"edit-equipment":ne.step=ne.isAddMode?"copy-equipment":"location";break;case"copy-equipment":case"poi-nearby":ne.step="location"}yield ne.initCurrentStep(!1)})()}next(){var ne=this;return(0,d.Z)(function*(){if("poi-nearby"==ne.step&&ne.nearbySites.length>0&&!ne.isNonDuplicateConfirmed)return void(yield ne.alertController.create({header:"Confirm",message:"Please confirm you are not adding a duplicate site.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:Qt=>{}},{text:"Confirm",handler:()=>{ne.isNonDuplicateConfirmed=!0,ne.next()}}]})).present();const Je=ne.validate(ne.step);if(Je.isValid){switch(ne.step){case"location":ne.step=ne.isAddMode?"poi-nearby":"edit-equipment";break;case"poi-nearby":ne.step=ne.isAddMode?"copy-equipment":"edit-equipment";break;case"copy-equipment":ne.step="edit-equipment";break;case"edit-equipment":ne.step="info"}yield ne.initCurrentStep(!0)}else(yield ne.alertController.create({message:Je.msg})).present()})()}initCurrentStep(ne){var Je=this;return(0,d.Z)(function*(){"poi-nearby"==Je.step?(Je.selectedTab="location",0==(yield Je.refreshNearbySites())&&(ne?yield Je.next():yield Je.previous())):"location"==Je.step?Je.selectedTab="location":"copy-equipment"==Je.step?(Je.selectedTab="equipment",yield Je.refreshTemplateSites()):"edit-equipment"==Je.step?Je.selectedTab="equipment":"info"==Je.step&&(Je.selectedTab="info")})()}onCountryChange(){var ne=this;return(0,d.Z)(function*(){ne.refreshFilteredReferenceData()})()}onOperatorChange(ne=null){var Je=this;return(0,d.Z)(function*(){null!=ne&&Je.item.OperatorID!=ne.ID&&(Je.item.OperatorID=ne.ID,localStorage.setItem("_editor-operatorid",Je.item.OperatorID.toString()),yield Je.refreshTemplateSites())})()}useSuggestedAddress(ne=null){ne&&(this.suggestedAddress=ne.suggestedAddress,this.suggestedAddressAttribution=ne.suggestedAddressAttribution),Object.assign(this.item.AddressInfo,this.suggestedAddress),this.suggestedAddressAttribution&&(this.item.MetadataValues.find(Je=>4==Je.MetadataFieldID)||this.item.MetadataValues.push({ID:-1,MetadataFieldID:4,ItemValue:this.suggestedAddressAttribution,MetadataFieldOptionID:null,MetadataFieldOption:null}))}editConnection(ne){var Je=this;return(0,d.Z)(function*(){const jt=Je.item.Connections.find(Ii=>Ii.ID==ne.ID),Qt=Object.assign({},jt),li=yield Je.modalController.create({component:ke,componentProps:{conn:Qt}});return li.onWillDismiss().then(Ii=>{Ii&&Ii.data&&Ii.data.item&&Je.updateConnection(Ii.data.item)}),yield li.present()})()}deleteConnection(ne){var Je=this;return(0,d.Z)(function*(){const jt=Je.item.Connections.find(li=>li.ID==ne.ID);(yield Je.alertController.create({header:"Confirm Delete",message:"Are you sure you want to delete this connection information?",buttons:[{text:"No",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Yes",handler:()=>{Je.item.Connections=Je.item.Connections.filter(li=>li.ID!=jt.ID),Je.appManager.referenceDataManager.hydrateCompactPOI(Je.item,!0)}}]})).present()})()}addConnection(){var ne=this;return(0,d.Z)(function*(){const Je={ID:-l.c.getRandomInt(1e4),ConnectionTypeID:null,StatusTypeID:50,PowerKW:null,Quantity:1},jt=yield ne.modalController.create({component:ke,componentProps:{conn:Je}});return jt.onWillDismiss().then(Qt=>{Qt&&Qt.data&&Qt.data.item&&ne.updateConnection(Qt.data.item)}),yield jt.present()})()}refreshFilteredReferenceData(){this.appManager.referenceDataManager.refreshFilteredReferenceData(this.appManager.api,{CountryIds:[this.item.AddressInfo.CountryID]})}updateConnection(ne){if(ne){let Je=this.item.Connections.find(jt=>jt.ID==ne.ID);Je?Object.assign(Je,ne):this.item.Connections.push(ne)}this.appManager.referenceDataManager.hydrateCompactPOI(this.item,!0)}validate(ne="all"){let Je=null;return("all"==ne||"location"==ne)&&((!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(Je="Location is required"),""==this.item.AddressInfo.Title&&(Je="A location title is required"),!this.item.AddressInfo.AddressLine1&&!this.item.AddressInfo.AddressLine2&&(Je="An approximate address is required."),this.item.AddressInfo.CountryID||(Je="A country selection is required"),(!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(Je="A location latitude and longitude is required")),("all"==ne||"poi-nearby"==ne)&&this.nearbySites.length>0&&!this.isNonDuplicateConfirmed&&(Je="Please confirm that the site is not a duplicate"),("all"==ne||"equipment"==ne)&&(this.item.OperatorID||(Je="Please confirm the charging network or equipment operator."),0==this.item.Connections.length&&(Je="Equipment information is required")),Je?(this.validationMsg=Je,{isValid:!1,msg:Je}):(this.validationMsg=null,{isValid:!0,msg:null})}save(){var ne=this;return(0,d.Z)(function*(){let Je=ne.validate();if(Je.isValid){yield ne.presentLoadingUI();try{yield ne.appManager.submitPOI(ne.item),yield ne.dismissLoadingUI(),ne.appManager.showToastNotification("You submission will be reviewed (if required) and published shortly."),ne.modalController.dismiss()}catch(jt){yield ne.dismissLoadingUI(),jt.error&&alert("Sorry, your submission could not be completed at this time. Please try again later.")}}else alert(Je.msg)})()}cancel(){var ne=this;return(0,d.Z)(function*(){ne.modalController.dismiss()})()}refreshTemplateSites(){var ne=this;return(0,d.Z)(function*(){if(ne.item.AddressInfo.CountryID&&ne.item.OperatorID){yield ne.presentLoadingUI(),ne.templateSites=[];let Je=new te.b;Je.countryIdList=[ne.item.AddressInfo.CountryID],Je.minPowerKW=1,Je.operatorIdList=[ne.item.OperatorID],Je.maxResults=10;let jt=yield ne.poiManager.fetchPOIList(Je);jt.sort((Qt,li)=>new Date(Qt.DateCreated).getTime()-new Date(li.DateCreated).getTime()),ne.templateSites=jt,ne.dismissLoadingUI()}})()}refreshNearbySites(){var ne=this;return(0,d.Z)(function*(){if(ne.item.AddressInfo.Latitude&&ne.item.AddressInfo.Longitude){yield ne.presentLoadingUI(),ne.nearbySites=[];let Je=new te.b;Je.latitude=ne.item.AddressInfo.Latitude,Je.longitude=ne.item.AddressInfo.Longitude,Je.distance=5,Je.distanceUnit="km",Je.maxResults=10;let jt=yield ne.poiManager.fetchPOIList(Je);return jt.sort((Qt,li)=>Qt.Distance-li.Distance),ne.nearbySites=jt,ne.dismissLoadingUI(),jt.length}return 0})()}confirmNonDuplicate(){this.isNonDuplicateConfirmed=!0,this.next()}changeTemplatePOI(){this.selectedTemplatePOI=null}editPOI(ne){this.editExistingPOI(ne.ID)}editExistingPOI(ne){var Je=this;return(0,d.Z)(function*(){Je.skipPOICopy=!0,Je.isNonDuplicateConfirmed=!0,yield Je.presentLoadingUI(),Je.poiManager.getPOIById(ne,!0,!0).then(jt=>{Je.item=Object.assign({},jt),null==Je.item.OperatorID&&(Je.item.OperatorID=we.UnknownOperator),Je.refreshFilteredReferenceData(),Je.dismissLoadingUI()})})()}useTemplatePOI(ne){this.selectedTemplatePOI=ne,Object.assign(this.item.Connections,ne.Connections);for(let Je of this.item.Connections)Je.ID=-l.c.getRandomInt(1e4),Je.Reference=null,Je.Comments=null,Je.StatusTypeID=Ne.Operational;this.item.UsageCost=ne.UsageCost,this.item.UsageTypeID=ne.UsageTypeID,this.appManager.referenceDataManager.hydrateCompactPOI(this.item)}skipCopyingPOI(){this.skipPOICopy=!0}}return It.\u0275fac=function(ne){return new(ne||It)(b.Y36(y.c),b.Y36(le.IN),b.Y36(q.R),b.Y36(re.v),b.Y36(le.HT),b.Y36(le.Br))},It.\u0275cmp=b.Xpm({type:It,selectors:[["app-poi-editor"]],viewQuery:function(ne,Je){if(1&ne&&b.Gf(Oe,5),2&ne){let jt;b.iGM(jt=b.CRH())&&(Je.editorMap=jt.first)}},decls:33,vars:14,consts:[["slot","end"],[3,"click"],["name","close","slot","start"],[1,"ion-padding"],[3,"ngModel"],["value","location","layout","icon-start",3,"disabled"],["name","caret-forward",4,"ngIf"],["value","equipment","layout","icon-start",3,"disabled"],["value","info","layout","icon-start",3,"disabled"],[4,"ngIf"],["slot","start"],[3,"click",4,"ngIf"],["color","success",3,"click",4,"ngIf"],["name","caret-forward"],[3,"latitude","longitude","latitudeChange","longitudeChange","onUseSuggestedAddress"],["editorMap",""],["position","floating"],["type","text","autocapitalize","words","placeholder","A title for this location",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","The nearest street address",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Optional",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Town or City",3,"ngModel","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Optional Postal Code",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["type","number","placeholder","Latitude (if entering manually)",3,"ngModel","ngModelChange"],["type","number","placeholder","Longitude (if entering manually)",3,"ngModel","ngModelChange"],[3,"value"],[1,"instruction"],[3,"poiList","enableEditOption","onEdit"],[3,"operatorId","operatorChanged"],["slot","start","size","small",3,"click"],[3,"enableCopyOption","poiList","onCopy"],[3,"operatorId","useFilteredOperators","operatorChanged"],["size","small",3,"click"],["name","add","slot","icon-only"],[3,"item","enableEdit","onEdit","onDelete"],["color","warning",4,"ngIf"],[3,"ngModel","ngModelChange"],["type","text","autocapitalize","sentences",3,"ngModel","ngModelChange"],["type","tel","placeholder","",3,"ngModel","ngModelChange"],["type","text","autocapitalize","sentences","placeholder","Instructions for access or tips for finding charging location",3,"ngModel","ngModelChange"],["type","url","placeholder","Website related to this site",3,"ngModel","ngModelChange"],["color","warning"],["color","danger"],["name","caret-back","slot","start"],["name","caret-forward","slot","end"],["color","success",3,"click"],["name","send","slot","end"]],template:function(ne,Je){1&ne&&(b.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),b._uU(3),b.qZA(),b.TgZ(4,"ion-buttons",0)(5,"ion-button",1),b.NdJ("click",function(){return Je.cancel()}),b._UZ(6,"ion-icon",2),b._uU(7," Cancel "),b.qZA()()()(),b.TgZ(8,"ion-content",3),b.ynx(9),b.TgZ(10,"ion-segment",4)(11,"ion-segment-button",5),b.YNc(12,gt,1,0,"ion-icon",6),b.TgZ(13,"ion-label"),b._uU(14,"Location"),b.qZA()(),b.TgZ(15,"ion-segment-button",7),b.YNc(16,it,1,0,"ion-icon",6),b.TgZ(17,"ion-label"),b._uU(18,"Equipment"),b.qZA()(),b.TgZ(19,"ion-segment-button",8),b.YNc(20,at,1,0,"ion-icon",6),b.TgZ(21,"ion-label"),b._uU(22,"Info"),b.qZA()()(),b.YNc(23,Vt,3,2,"ng-container",9),b.YNc(24,Bn,3,2,"ng-container",9),b.YNc(25,Li,38,11,"ng-container",9),b.BQk(),b.qZA(),b.TgZ(26,"ion-footer")(27,"ion-toolbar")(28,"ion-buttons",10),b.YNc(29,Si,3,0,"ion-button",11),b.qZA(),b.TgZ(30,"ion-buttons",0),b.YNc(31,Fi,3,0,"ion-button",11),b.YNc(32,Yi,3,0,"ion-button",12),b.qZA()()()),2&ne&&(b.xp6(3),b.Oqu(Je.isAddMode?"Add Location":"Edit Location"),b.xp6(7),b.Q6J("ngModel",Je.selectedTab),b.xp6(1),b.Q6J("disabled",!0),b.xp6(1),b.Q6J("ngIf","location"==Je.selectedTab),b.xp6(3),b.Q6J("disabled",!0),b.xp6(1),b.Q6J("ngIf","equipment"==Je.selectedTab),b.xp6(3),b.Q6J("disabled",!0),b.xp6(1),b.Q6J("ngIf","info"==Je.selectedTab),b.xp6(3),b.Q6J("ngIf","location"==Je.selectedTab),b.xp6(1),b.Q6J("ngIf","equipment"==Je.selectedTab),b.xp6(1),b.Q6J("ngIf","info"==Je.selectedTab),b.xp6(4),b.Q6J("ngIf","location"!=Je.step),b.xp6(2),b.Q6J("ngIf",!Je.isReadyToSubmit&&"info"!=Je.step),b.xp6(1),b.Q6J("ngIf",Je.isReadyToSubmit))},dependencies:[ze.sg,ze.O5,Ye.JJ,Ye.On,le.YG,le.Sm,le.W2,le.fr,le.Gu,le.gu,le.pK,le.Ie,le.Q$,le.q_,le.cJ,le.GO,le.t9,le.n0,le.wd,le.sr,le.as,le.QI,le.j9,ge.o,de.B,Oe,Mt],styles:['ul.breadcrumb[_ngcontent-%COMP%]{display:inline-flex;margin:0;padding:0}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-flex;margin-right:6px;color:var(--ion-color-light-shade);font-size:10px}ul.breadcrumb[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{color:var(--ion-color-dark-shade)}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:">";padding-right:4px}']}),It})()},6763:(Pn,Et,k)=>{"use strict";k.d(Et,{u:()=>Ne});var d=k(8274),y=k(425),te=k(4120),l=k(3912),q=k(7689),re=k(129),b=k(529);let he=(()=>{class we{constructor(We,ge){this.http=We,this.journeyManager=ge}getDirections(We,ge){return new Promise((de,oe)=>{(new google.maps.DirectionsService).route({origin:We,destination:ge,travelMode:google.maps.TravelMode.DRIVING},(vt,Tt)=>{Tt===google.maps.DirectionsStatus.OK?de(vt):oe(Tt)})})}analyseRoutes(We,ge){const de=new Array;return We.routes.forEach(oe=>{const Ee=new re.JJ;Ee.Title=""+de.length+1,Ee.JourneyRouteLegs=new Array,Ee.TotalDistanceKM=0,Ee.TotalDurationMinutes=0,Ee.TotalEnergykWh=0,oe.legs.forEach(vt=>{const Tt=vt.duration.value,Gt=vt.distance.value/1e3,Ot=this.journeyManager.calculateEnergyConsumptionkWh(Gt,0,null,ge),yt=new re.eN;yt.DistanceKM=Gt,yt.DurationMinutes=Tt/60,yt.EnergyConsumptionkWh=Ot,Ee.JourneyRouteLegs.push(yt),Ee.TotalDistanceKM+=yt.DistanceKM,Ee.TotalDurationMinutes+=yt.DurationMinutes,Ee.TotalEnergykWh=yt.EnergyConsumptionkWh}),de.push(Ee)}),de}}return we.\u0275fac=function(We){return new(We||we)(d.LFG(b.eN),d.LFG(l.i))},we.\u0275prov=d.Yz7({token:we,factory:we.\u0275fac,providedIn:"root"}),we})();var Me=k(4781),Ve=k(6895),X=k(4006),xe=k(2428);function fe(we,Xe){if(1&we){const We=d.EpF();d.TgZ(0,"ion-item"),d._UZ(1,"ion-icon",12),d.TgZ(2,"ion-searchbar",13),d.NdJ("ngModelChange",function(de){d.CHM(We);const oe=d.oxw();return d.KtG(oe.routeStart=de)})("ionInput",function(de){d.CHM(We),d.oxw();const oe=d.MAs(18);return d.KtG(oe.getPlacesAutoComplete(de,"routeStart"))})("ionCancel",function(de){d.CHM(We);const oe=d.oxw();return d.KtG(oe.onPlaceSearchCancel(de))}),d.qZA()()}if(2&we){const We=d.oxw();d.xp6(2),d.Q6J("ngModel",We.routeStart)("debounce",500)}}function ze(we,Xe){if(1&we){const We=d.EpF();d.TgZ(0,"ion-item",14),d.NdJ("click",function(){d.CHM(We);const de=d.oxw();return d.KtG(de.clearRouteStart())}),d._UZ(1,"ion-icon",12),d.TgZ(2,"h2"),d._uU(3),d.qZA()()}if(2&we){d.oxw();const We=d.MAs(18);d.xp6(3),d.Oqu(null==We.selectedPlace?null:We.selectedPlace.name)}}function le(we,Xe){if(1&we){const We=d.EpF();d.TgZ(0,"ion-item"),d._UZ(1,"ion-icon",15),d.TgZ(2,"ion-searchbar",16),d.NdJ("ngModelChange",function(de){d.CHM(We);const oe=d.oxw();return d.KtG(oe.routeDestination=de)})("ionInput",function(de){d.CHM(We),d.oxw();const oe=d.MAs(20);return d.KtG(oe.getPlacesAutoComplete(de,"routeDestination"))})("ionCancel",function(de){d.CHM(We);const oe=d.oxw();return d.KtG(oe.onPlaceSearchCancel(de))}),d.qZA()()}if(2&we){const We=d.oxw();d.xp6(2),d.Q6J("ngModel",We.routeDestination)("debounce",500)}}function Ke(we,Xe){if(1&we){const We=d.EpF();d.TgZ(0,"ion-item",14),d.NdJ("click",function(){d.CHM(We);const de=d.oxw();return d.KtG(de.clearRouteDestination())}),d._UZ(1,"ion-icon",15),d.TgZ(2,"h2"),d._uU(3),d.qZA()()}if(2&we){d.oxw();const We=d.MAs(20);d.xp6(3),d.Oqu(null==We.selectedPlace?null:We.selectedPlace.name)}}function Oe(we,Xe){if(1&we){const We=d.EpF();d.TgZ(0,"ion-button",14),d.NdJ("click",function(){d.CHM(We);const de=d.oxw();return d.KtG(de.clearRoute())}),d._UZ(1,"ion-icon",17),d._uU(2," Clear Route "),d.qZA()}}function Q(we,Xe){if(1&we){const We=d.EpF();d.TgZ(0,"ion-button",14),d.NdJ("click",function(){d.CHM(We);const de=d.oxw();return d.KtG(de.showSettings())}),d._uU(1," Show Settings "),d._UZ(2,"ion-icon",18),d.qZA()}}function Ye(we,Xe){if(1&we){const We=d.EpF();d.TgZ(0,"ion-button",14),d.NdJ("click",function(){d.CHM(We);const de=d.oxw();return d.KtG(de.hideSettings())}),d._uU(1," Hide Settings "),d._UZ(2,"ion-icon",18),d.qZA()}}function St(we,Xe){1&we&&(d.TgZ(0,"p",19),d._UZ(1,"ion-spinner",19),d._uU(2," Calculating Route.. "),d.qZA())}function lt(we,Xe){if(1&we&&(d.TgZ(0,"ion-list")(1,"ion-list-header"),d._uU(2),d.ALo(3,"number"),d.ALo(4,"number"),d.qZA()()),2&we){const We=d.oxw();d.xp6(2),d.lnq(" Total Distance ",d.xi3(3,3,We.selectedJourneyRoute.TotalDistanceKM,"1.0-2")," km, ",We.formatDuration(We.selectedJourneyRoute.TotalDurationMinutes),", ",d.xi3(4,6,We.selectedJourneyRoute.TotalEnergykWh,"1.0-2")," kWh ")}}function _e(we,Xe){if(1&we){const We=d.EpF();d.TgZ(0,"div")(1,"ion-list")(2,"ion-list-header"),d._UZ(3,"ion-icon",20),d._uU(4," Route Settings "),d.qZA(),d.TgZ(5,"ion-item")(6,"ion-label",21),d._uU(7),d.qZA(),d.TgZ(8,"ion-range",22),d.NdJ("ngModelChange",function(de){d.CHM(We);const oe=d.oxw();return d.KtG(oe.routeSearchDistance=de)}),d._UZ(9,"ion-icon",23)(10,"ion-icon",24),d.qZA()(),d.TgZ(11,"ion-item")(12,"ion-label",21),d._uU(13,"Energy Efficiency (kWh Per km)"),d.qZA(),d.TgZ(14,"ion-input",25),d.NdJ("ngModelChange",function(de){d.CHM(We);const oe=d.oxw();return d.KtG(oe.kWhPerKM=de)}),d.qZA()()()()}if(2&we){const We=d.oxw();d.xp6(7),d.hij("Search Distance (",We.routeSearchDistance,")"),d.xp6(1),d.Q6J("ngModel",We.routeSearchDistance),d.xp6(6),d.Q6J("ngModel",We.kWhPerKM)}}let ke=(()=>{class we{constructor(We,ge,de,oe,Ee,vt){this.mapping=We,this.logging=ge,this.directions=de,this.journeyManager=oe,this.changeDetector=Ee,this.numberPipe=vt,this.routeSearchDistance=5,this.routeCalcInProgress=!1,this.advancedSettingsMode=!1,this.routeStart="",this.routeDestination="",this.kWhPerKM=.212}get isRouteSet(){return null!=this.routeStartPlace&&null!=this.routeDestinationPlace}showSettings(){this.advancedSettingsMode=!0}hideSettings(){this.advancedSettingsMode=!1}routeStartSelected(We){this.routeStartPlace=We,this.calculateRoute(),this.changeDetector.detectChanges()}routeDestinationSelected(We){this.routeDestinationPlace=We,this.calculateRoute(),this.changeDetector.detectChanges()}clearRouteStart(){this.routeStartPlace=null,this.changeDetector.detectChanges()}clearRouteDestination(){this.routeDestinationPlace=null,this.changeDetector.detectChanges()}clearRoute(){this.routeStartPlace=null,this.routeDestinationPlace=null,this.journeyManager.setRoutePolyline(null),this.mapping.clearPolyline()}formatDuration(We){if(We<=60)return this.numberPipe.transform(We,"1.0-2")+" mins";{const ge=Math.round(We/60),de=Math.floor(We-60*ge);return ge+" hours "+(de>0?de+" mins":"")}}calculateRoute(){null!=this.routeStartPlace&&null!=this.routeDestinationPlace&&(this.logging.log("Fetching route directions.."),this.routeCalcInProgress=!0,this.directions.getDirections(this.routeStartPlace.Location.latitude+","+this.routeStartPlace.Location.longitude,this.routeDestinationPlace.Location.latitude+","+this.routeDestinationPlace.Location.longitude).then(We=>{if(null!=We.routes&&We.routes.length>0){this.logging.log("Got route directions, analysing.."),this.routePolyline=We.routes[0].overview_polyline;const ge=We.routes[0].bounds.getSouthWest(),de=We.routes[0].bounds.getNorthEast(),oe=new te.wC(de.lat(),de.lng()),Ee=new te.wC(ge.lat(),ge.lng()),vt=new te.LL(oe,Ee);this.journeyRoutes=this.directions.analyseRoutes(We,this.kWhPerKM),this.journeyRoutes.length>0&&(this.selectedJourneyRoute=this.journeyRoutes[0]),this.journeyManager.setRoutePolyline(this.routePolyline),this.mapping.renderPolyline(this.routePolyline),this.mapping.moveToMapBounds(vt)}else this.logging.log("No route returned..");this.routeCalcInProgress=!1}))}}return we.\u0275fac=function(We){return new(We||we)(d.Y36(Me.v),d.Y36(q.z),d.Y36(he),d.Y36(l.i),d.Y36(d.sBO),d.Y36(Ve.JJ))},we.\u0275cmp=d.Xpm({type:we,selectors:[["route-planner"]],decls:24,vars:10,consts:[[1,"route"],[1,"route-places"],["name","map","slot","start"],[4,"ngIf"],[3,"click",4,"ngIf"],["primary",""],["slot","secondary"],["slot","primary"],[3,"placeChanged"],["placeSearchRouteStart",""],["placeSearchRouteDestination",""],["class","ion-padding",4,"ngIf"],["name","ionic","item-left",""],["placeholder","Starting Point",3,"ngModel","debounce","ngModelChange","ionInput","ionCancel"],[3,"click"],["name","pin","item-left",""],["placeholder","Destination",3,"ngModel","debounce","ngModelChange","ionInput","ionCancel"],["name","close","slot","start"],["name","cog","slot","end"],[1,"ion-padding"],["name","cog"],["position","stacked"],["min","1","max","200","step","5","snaps","true","pin","true","light","",3,"ngModel","ngModelChange"],["slot","start","small","","name","map"],["slot","end","large","","name","map"],["type","number","min","0.1","max","1",3,"ngModel","ngModelChange"]],template:function(We,ge){1&We&&(d.TgZ(0,"div",0)(1,"div",1)(2,"ion-list")(3,"ion-list-header"),d._UZ(4,"ion-icon",2),d.TgZ(5,"ion-label"),d._uU(6,"Plan Your Journey"),d.qZA()(),d.YNc(7,fe,3,2,"ion-item",3),d.YNc(8,ze,4,1,"ion-item",4),d.YNc(9,le,3,2,"ion-item",3),d.YNc(10,Ke,4,1,"ion-item",4),d.qZA(),d.TgZ(11,"ion-toolbar",5)(12,"ion-buttons",6),d.YNc(13,Oe,3,0,"ion-button",4),d.qZA(),d.TgZ(14,"ion-buttons",7),d.YNc(15,Q,3,0,"ion-button",4),d.YNc(16,Ye,3,0,"ion-button",4),d.qZA()()(),d.TgZ(17,"place-search",8,9),d.NdJ("placeChanged",function(oe){return ge.routeStartSelected(oe)}),d.qZA(),d.TgZ(19,"place-search",8,10),d.NdJ("placeChanged",function(oe){return ge.routeDestinationSelected(oe)}),d.qZA(),d.YNc(21,St,3,0,"p",11),d.YNc(22,lt,5,9,"ion-list",3),d.YNc(23,_e,15,3,"div",3),d.qZA()),2&We&&(d.xp6(7),d.Q6J("ngIf",null==ge.routeStartPlace),d.xp6(1),d.Q6J("ngIf",null!=ge.routeStartPlace),d.xp6(1),d.Q6J("ngIf",null==ge.routeDestinationPlace),d.xp6(1),d.Q6J("ngIf",null!=ge.routeDestinationPlace),d.xp6(3),d.Q6J("ngIf",ge.isRouteSet),d.xp6(2),d.Q6J("ngIf",!ge.advancedSettingsMode),d.xp6(1),d.Q6J("ngIf",ge.advancedSettingsMode),d.xp6(5),d.Q6J("ngIf",ge.routeCalcInProgress),d.xp6(1),d.Q6J("ngIf",null!=ge.selectedJourneyRoute),d.xp6(1),d.Q6J("ngIf",ge.advancedSettingsMode))},dependencies:[Ve.O5,y.YG,y.Sm,y.gu,y.pK,y.Ie,y.Q$,y.q_,y.yh,y.I_,y.VI,y.PQ,y.sr,y.as,y.QI,y.j9,X.JJ,X.On,xe.v,Ve.JJ],encapsulation:2}),we})(),Ne=(()=>{class we{constructor(We){this.modalController=We,this.hasNavbar=!1}close(){this.modalController.dismiss()}}return we.\u0275fac=function(We){return new(We||we)(d.Y36(y.IN))},we.\u0275cmp=d.Xpm({type:we,selectors:[["ng-component"]],decls:10,vars:0,consts:[["slot","end"],[3,"click"],["name","close","slot","end"],[1,"route-planner","ion-padding"]],template:function(We,ge){1&We&&(d.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),d._uU(3," Route Planner "),d.qZA(),d.TgZ(4,"ion-buttons",0)(5,"ion-button",1),d.NdJ("click",function(){return ge.close()}),d._UZ(6,"ion-icon",2),d._uU(7," Close "),d.qZA()()()(),d.TgZ(8,"ion-content",3),d._UZ(9,"route-planner"),d.qZA())},dependencies:[y.YG,y.Sm,y.W2,y.Gu,y.gu,y.wd,y.sr,ke],encapsulation:2}),we})()},3548:(Pn,Et,k)=>{"use strict";k.r(Et),k.d(Et,{SearchPageModule:()=>yn});var d=k(8936),y=k(4463),te=k(6895),l=k(4006),q=k(425),re=k(4228),b=k(5861),he=k(2340),Me=k(2951),Ve=k(6314),X=k(6763),xe=k(3399),fe=k(4120),ze=k(8016),le=k(6579),Ke=k(7689),Oe=k(3912),Q=k(4781),Ye=k(9698),St=k(3855),lt=k(2428),_e=k(4968),ke=k(727);class Ne extends ke.w0{constructor(cn,ot){super()}schedule(cn,ot=0){return this}}const we={setInterval(Fn,cn,...ot){const{delegate:Nt}=we;return Nt?.setInterval?Nt.setInterval(Fn,cn,...ot):setInterval(Fn,cn,...ot)},clearInterval(Fn){const{delegate:cn}=we;return(cn?.clearInterval||clearInterval)(Fn)},delegate:void 0};var Xe=k(8737),ge=k(6063);class de{constructor(cn,ot=de.now){this.schedulerActionCtor=cn,this.now=ot}schedule(cn,ot=0,Nt){return new this.schedulerActionCtor(this,cn).schedule(Nt,ot)}}de.now=ge.l.now;const Ee=new class oe extends de{constructor(cn,ot=de.now){super(cn,ot),this.actions=[],this._active=!1}flush(cn){const{actions:ot}=this;if(this._active)return void ot.push(cn);let Nt;this._active=!0;do{if(Nt=cn.execute(cn.state,cn.delay))break}while(cn=ot.shift());if(this._active=!1,Nt){for(;cn=ot.shift();)cn.unsubscribe();throw Nt}}}(class We extends Ne{constructor(cn,ot){super(cn,ot),this.scheduler=cn,this.work=ot,this.pending=!1}schedule(cn,ot=0){var Nt;if(this.closed)return this;this.state=cn;const bn=this.id,Kn=this.scheduler;return null!=bn&&(this.id=this.recycleAsyncId(Kn,bn,ot)),this.pending=!0,this.delay=ot,this.id=null!==(Nt=this.id)&&void 0!==Nt?Nt:this.requestAsyncId(Kn,this.id,ot),this}requestAsyncId(cn,ot,Nt=0){return we.setInterval(cn.flush.bind(cn,this),Nt)}recycleAsyncId(cn,ot,Nt=0){if(null!=Nt&&this.delay===Nt&&!1===this.pending)return ot;null!=ot&&we.clearInterval(ot)}execute(cn,ot){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const Nt=this._execute(cn,ot);if(Nt)return Nt;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(cn,ot){let bn,Nt=!1;try{this.work(cn)}catch(Kn){Nt=!0,bn=Kn||new Error("Scheduled action threw falsy error")}if(Nt)return this.unsubscribe(),bn}unsubscribe(){if(!this.closed){const{id:cn,scheduler:ot}=this,{actions:Nt}=ot;this.work=this.state=this.scheduler=null,this.pending=!1,(0,Xe.P)(Nt,this),null!=cn&&(this.id=this.recycleAsyncId(ot,cn,null)),this.delay=null,super.unsubscribe()}}});var Tt=k(4482),Gt=k(5403);const Mt=(0,k(7423).fo)("Geolocation",{web:()=>k.e(4561).then(k.bind(k,4561)).then(Fn=>new Fn.GeolocationWeb)});var gt=k(8274),it=k(6260);function at(Fn,cn){1&Fn&&gt._UZ(0,"ion-icon",13)}function Ce(Fn,cn){1&Fn&&gt._UZ(0,"ion-spinner")}function bt(Fn,cn){if(1&Fn){const ot=gt.EpF();gt.TgZ(0,"ion-button",3),gt.NdJ("click",function(){gt.CHM(ot);const bn=gt.oxw();return gt.KtG(bn.openSideView())}),gt._UZ(1,"ion-icon",14),gt.qZA()}}function kt(Fn,cn){1&Fn&&(gt.ynx(0),gt.TgZ(1,"div",15)(2,"p"),gt._uU(3,"There was a problem communicating with Open Charge Map. Please check your data connection."),gt.qZA()(),gt.BQk())}let Vt=(()=>{class Fn{constructor(ot,Nt,bn,Kn,ri,Bn,pi,bi,vi,Li,Si,Fi){this.appManager=ot,this.nav=Nt,this.events=bn,this.translate=Kn,this.platform=ri,this.poiManager=Bn,this.mapping=pi,this.journeyManager=bi,this.zone=vi,this.modalController=Li,this.alertController=Si,this.logging=Fi,this.mapDisplayed=!1,this.initialResultsShown=!1,this.searchOnDemand=!1,this.poiViewMode="modal",this.sideViewAvailable=!1,this.routePlanningMode=!0,this.searchKeyword="",this.appConfig=new Me.X,this.defaultMapZoom=15,this.defaultStartPos=new fe.wC(37.415328,-122.076575),this._watchId=null,this.mapCanvasID="map-canvas",this.mapping.setMapType(ot.searchSettings.MapType),this.mapping.setMapAPI(he.N.defaultMapProvider),(0,_e.R)(window,"resize").pipe(function Ot(Fn,cn=Ee){return(0,Tt.e)((ot,Nt)=>{let bn=null,Kn=null,ri=null;const Bn=()=>{if(bn){bn.unsubscribe(),bn=null;const bi=Kn;Kn=null,Nt.next(bi)}};function pi(){const bi=ri+Fn,vi=cn.now();if(vi<bi)return bn=this.schedule(void 0,bi-vi),void Nt.add(bn);Bn()}ot.subscribe((0,Gt.x)(Nt,bi=>{Kn=bi,ri=cn.now(),bn||(bn=cn.schedule(pi,Fn),Nt.add(bn))},()=>{Bn(),Nt.complete()},void 0,()=>{Kn=bn=null}))})}(500)).subscribe(Zt=>{let It={width:le.c.getClientHeight(),height:le.c.getClientWidth()};this.events.publish("ocm:window:resized",[It])})}ionViewDidEnter(){this.logging.log("Entered search page.",Ke.i.VERBOSE),this.mapping.focusMap(),this.mapping.updateMapSize()}ionViewWillLeave(){this.logging.log("Leaving search page.",Ke.i.VERBOSE),this.mapping.unfocusMap()}getPreferredMapHeight(ot){return null==ot&&(ot=le.c.getClientHeight()),ot-56}enforceMapHeight(ot){this.logging.log("Would resize map:"+ot.width+" "+ot.height,Ke.i.VERBOSE),this.checkViewportMode();const Nt=this.getPreferredMapHeight(ot[0]);document.getElementById(this.mapCanvasID).offsetHeight!==Nt&&(document.getElementById(this.mapCanvasID).style.height=Nt+"px"),this.mapping&&(this.logging.log("Map height:"+Nt,Ke.i.VERBOSE),this.mapping.updateMapSize())}checkViewportMode(){}initialiseMapping(){var ot=this;return(0,b.Z)(function*(){yield ot.platform.ready(),ot.debouncedRefreshMapResults=le.c.debounce(ot.refreshMapResults,1e3,!1),ot.events.subscribe("ocm:mapping:ready",(0,b.Z)(function*(){if(ot.logging.log("init map: mapping ready"),ot.mapping&&ot.mapping.updateMapSize(),!ot.initialResultsShown)if(ot.appManager.searchSettings.StartSearchPosition)ot.searchOnDemand=!0,ot.mapping.updateMapCentrePos(ot.appManager.searchSettings.StartSearchPosition.latitude,ot.appManager.searchSettings.StartSearchPosition.longitude,!0,ot.defaultMapZoom);else{let Nt=localStorage.getItem("_locationEnabled");1==ot.appManager.isEmbeddedMode&&"true"!=Nt?yield(yield ot.alertController.create({header:"Search using your location?",message:"Select OK to continue.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:(Kn=(0,b.Z)(function*(ri){yield ot.useFallbackPosition()}),function(Bn){return Kn.apply(this,arguments)})},{text:"OK",handler:function(){var Kn=(0,b.Z)(function*(){yield ot.locateUser()});return function(){return Kn.apply(this,arguments)}}()}]})).present():(yield ot.locateUser(),ot.mapping&&ot.mapping.updateMapSize())}var Kn})),ot.events.subscribe("ocm:mapping:zoom",()=>{ot.debouncedRefreshMapResults()}),ot.events.subscribe("ocm:mapping:dragend",()=>{ot.debouncedRefreshMapResults()}),ot.events.subscribe("ocm:poiList:updated",Nt=>{ot.showPOIListOnMap(Nt)}),ot.events.subscribe("ocm:poiList:cleared",()=>{ot.mapping.clearMarkers(),setTimeout(()=>{ot.debouncedRefreshMapResults()},500)}),ot.events.subscribe("ocm:window:resized",Nt=>{null!=Nt&&Nt.length>0&&ot.enforceMapHeight(Nt[0])}),ot.events.subscribe("ocm:poi:selected",Nt=>{if(Nt.poi)ot.viewPOIDetails(Nt,Nt.poi);else{let bn=ot.getPOIByID(Nt.poiId);ot.viewPOIDetails(Nt,bn)}}),ot.checkViewportMode(),ot.mapping.initMap(ot.mapCanvasID)})()}ngAfterViewInit(){var ot=this;return(0,b.Z)(function*(){yield ot.initialiseMapping()})()}ngOnInit(){var ot=this;return(0,b.Z)(function*(){ot.logging.log("Refreshing reference data ..",Ke.i.VERBOSE),(yield ot.appManager.referenceDataManager.refreshReferenceData(ot.appManager.api))||(ot.appManager.isOffline=!0)})()}showPOIListOnMap(ot){const Nt=this.getPreferredMapHeight(null);this.mapping.refreshMapView(Nt,this.poiManager.poiList,null),this.mapDisplayed||(this.mapDisplayed=!0)}getIconForPOI(ot){return le.c.getIconForPOI(ot)}getPOIByID(ot){const Nt=this.poiManager.poiList;for(let bn=0;bn<Nt.length;bn++)if(Nt[bn].ID===ot)return Nt[bn];return null}refreshMapResults(){var ot=this;return(0,b.Z)(function*(){if(!ot.searchOnDemand)return void ot.logging.log("Skipping refresh, search on demand disabled..",Ke.i.VERBOSE);ot.logging.log("Refreshing Results..",Ke.i.VERBOSE);const Nt=new ze.b;let bn=null;if(ot.appManager.searchSettings.StartSearchPosition&&(bn=new fe.jR(ot.appManager.searchSettings.StartSearchPosition.latitude,ot.appManager.searchSettings.StartSearchPosition.longitude),ot.appManager.searchSettings.StartSearchPosition=null),bn&&0==bn.coords.latitude&&0==bn.coords.longitude)return void ot.logging.log("Map center is zero. No query will be performed",Ke.i.WARNING);if(null!=bn)Nt.latitude=bn.coords.latitude,Nt.longitude=bn.coords.longitude,Nt.distance=25,Nt.boundingbox=null,ot.appManager.searchSettings.LastSearchPosition=new fe.wC(bn.coords.latitude,bn.coords.longitude);else{Nt.latitude=null,Nt.longitude=null;let ri=yield ot.mapping.getMapBounds().toPromise();Nt.boundingbox="("+ri[0].latitude+","+ri[0].longitude+"),("+ri[1].latitude+","+ri[1].longitude+")",ot.logging.log(JSON.stringify(ri),Ke.i.VERBOSE)}Nt.includeComments=!0,Nt.enableCaching=!0,null!=ot.appManager.searchSettings&&(null!=ot.appManager.searchSettings.ConnectionTypeList&&(Nt.connectionTypeIdList=ot.appManager.searchSettings.ConnectionTypeList),null!=ot.appManager.searchSettings.UsageTypeList&&(Nt.usageTypeIdList=ot.appManager.searchSettings.UsageTypeList),null!=ot.appManager.searchSettings.StatusTypeList&&(Nt.statusTypeIdList=ot.appManager.searchSettings.StatusTypeList),null!=ot.appManager.searchSettings.OperatorList&&(Nt.operatorIdList=ot.appManager.searchSettings.OperatorList),null!=ot.appManager.searchSettings.MinPowerKW&&ot.appManager.searchSettings.MinPowerKW>0&&(Nt.minPowerKW=ot.appManager.searchSettings.MinPowerKW),null!=ot.appManager.searchSettings.MaxPowerKW&&ot.appManager.searchSettings.MaxPowerKW>0&&(Nt.maxPowerKW=ot.appManager.searchSettings.MaxPowerKW),null!=ot.journeyManager.getRoutePolyline()&&(Nt.polyline=ot.journeyManager.getRoutePolyline(),Nt.boundingbox=null,Nt.levelOfDetail=null,Nt.latitude=null,Nt.longitude=null)),ot.appManager.isRequestInProgress=!0;let Kn=yield ot.poiManager.refreshPOIList(Nt);ot.appManager.isRequestInProgress=!1,ot.initialResultsShown=!0,Kn>=Nt.maxResults&&ot.appManager.showToastNotification("A maximum of "+Kn+" results are returned per search. Zoom in for details.")})()}viewPOIDetails(ot,Nt){this.logging.log("Viewing/fetching ["+this.poiViewMode+"] POI Details "+ot.poiId),null!=Nt?(this.mapping.unfocusMap(),this.modalController.create({component:xe.H,componentProps:{item:Nt}}).then(bn=>{bn.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),bn.present()})):this.poiManager.getPOIById(ot.poiId,!0).then(bn=>{this.logging.log("Got POI Details "+bn.ID),"modal"===this.poiViewMode&&(this.searchOnDemand=!1,this.modalController.create({component:xe.H,componentProps:{item:bn}}).then(Kn=>{Kn.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),Kn.present()}),this.mapping.unfocusMap()),"side"===this.poiViewMode&&(this.selectedPOI=bn)},bn=>{this.appManager.showToastNotification("POI Details not available")})}closePOIDetails(){this.selectedPOI=null}openRoutePlannerModal(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:X.u}).then(ot=>{ot.onDidDismiss().then(Nt=>{this.logging.log("Dismissing Route Planner Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),ot.present()})}openSearchOptions(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:Ve.N}).then(ot=>{ot.onDidDismiss().then(Nt=>{this.mapping.focusMap(),this.searchOnDemand=!0}),ot.present()})}openSideView(){this.poiViewMode="side",this.mapping.updateMapSize()}closeSideView(){this.poiViewMode="modal",this.mapping.updateMapSize()}planRoute(){this.routePlanningMode=!0}search(ot){this.placeSearchMapPOI.getPlacesAutoComplete(ot,"poiSearch")}useFallbackPosition(){let ot=this.defaultStartPos;null!=this.appManager.searchSettings.LastSearchPosition&&(ot=this.appManager.searchSettings.LastSearchPosition),this.appManager.searchSettings.StartSearchPosition=ot,this.appManager.searchSettings.LastSearchPosition=null,this.searchOnDemand=!0,this.mapping.updateMapCentrePos(ot.latitude,ot.longitude,!0,this.defaultMapZoom)}getPosition(ot={}){var Nt=this;return(0,b.Z)(function*(){return new Promise((bn,Kn)=>{Nt._watchId=Mt.watchPosition(ot,(ri,Bn)=>{Mt.clearWatch({id:Nt._watchId}),Bn?Kn(Bn):bn(ri)})})})()}locateUser(){var ot=this;return(0,b.Z)(function*(){ot.useFallbackPosition();try{ot.logging.log("Attempting to locate user..");const Nt=yield ot.getPosition({timeout:1e4});if(!Nt)throw"Failed to get user location.";return ot.logging.log("Got user location."),ot.appManager.searchSettings.StartSearchPosition=new fe.wC(Nt.coords.latitude,Nt.coords.longitude),ot.searchOnDemand=!0,ot.mapping.updateMapCentrePos(Nt.coords.latitude,Nt.coords.longitude,!0,ot.defaultMapZoom),localStorage.setItem("_locationEnabled","true"),!0}catch(Nt){return ot.logging.log("Failed to get user location. Searching using default or last position."+Nt),ot.appManager.showToastNotification("Your location could not be determined."),ot.useFallbackPosition(),!1}})()}placeSelected(ot){this.searchKeyword=ot.Address,this.logging.log("Got place details:"+ot.Address),this.mapping.focusMap(),this.mapping.updateMapCentrePos(ot.Location.latitude,ot.Location.longitude,!0),this.debouncedRefreshMapResults()}}return Fn.\u0275fac=function(ot){return new(ot||Fn)(gt.Y36(St.c),gt.Y36(q.SH),gt.Y36(it.z),gt.Y36(y.sK),gt.Y36(q.t4),gt.Y36(Ye.R),gt.Y36(Q.v),gt.Y36(Oe.i),gt.Y36(gt.R0b),gt.Y36(q.IN),gt.Y36(q.Br),gt.Y36(Ke.z))},Fn.\u0275cmp=gt.Xpm({type:Fn,selectors:[["ng-component"]],viewQuery:function(ot,Nt){if(1&ot&&gt.Gf(lt.v,7),2&ot){let bn;gt.iGM(bn=gt.CRH())&&(Nt.placeSearchMapPOI=bn.first)}},decls:18,vars:10,consts:[["slot","start"],["autocapitalize","on","autocomplete","on",3,"ngModel","placeholder","debounce","ngModelChange","ionInput"],["slot","end"],[3,"click"],["name","locate","slot","start",4,"ngIf"],[4,"ngIf"],[3,"color","click"],["name","options","slot","end"],[3,"click",4,"ngIf"],[1,"search-page"],[3,"placeChanged"],["placeSearchMapPOI",""],["id","map-canvas",2,"height","100%","width","100%","min-height","300px"],["name","locate","slot","start"],["name","car","title","Route","slot","end"],[2,"position","absolute"]],template:function(ot,Nt){1&ot&&(gt.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),gt._UZ(3,"ion-menu-button"),gt.qZA(),gt.TgZ(4,"ion-searchbar",1),gt.NdJ("ngModelChange",function(Kn){return Nt.searchKeyword=Kn})("ionInput",function(Kn){return Nt.search(Kn)}),gt.ALo(5,"translate"),gt.qZA(),gt.TgZ(6,"ion-buttons",2)(7,"ion-button",3),gt.NdJ("click",function(){return Nt.locateUser()}),gt.YNc(8,at,1,0,"ion-icon",4),gt.YNc(9,Ce,1,0,"ion-spinner",5),gt.qZA(),gt.TgZ(10,"ion-button",6),gt.NdJ("click",function(){return Nt.openSearchOptions()}),gt._UZ(11,"ion-icon",7),gt.qZA(),gt.YNc(12,bt,2,0,"ion-button",8),gt.qZA()()(),gt.TgZ(13,"ion-content",9)(14,"place-search",10,11),gt.NdJ("placeChanged",function(Kn){return Nt.placeSelected(Kn)}),gt.qZA(),gt.YNc(16,kt,4,0,"ng-container",5),gt._UZ(17,"div",12),gt.qZA()),2&ot&&(gt.xp6(4),gt.Q6J("ngModel",Nt.searchKeyword)("placeholder",gt.lcZ(5,8,"ocm.search.performSearch"))("debounce",500),gt.xp6(4),gt.Q6J("ngIf",!Nt.appManager.isRequestInProgress),gt.xp6(1),gt.Q6J("ngIf",Nt.appManager.isRequestInProgress),gt.xp6(1),gt.Q6J("color",Nt.appManager.searchSettings.HasActiveFilters?"danger":"default"),gt.xp6(2),gt.Q6J("ngIf",1==Nt.sideViewAvailable&&"modal"==Nt.poiViewMode),gt.xp6(4),gt.Q6J("ngIf",Nt.appManager.isOffline))},dependencies:[te.O5,l.JJ,l.On,q.YG,q.Sm,q.W2,q.Gu,q.gu,q.fG,q.VI,q.PQ,q.sr,q.j9,lt.v,y.X$],styles:[".search-page[_ngcontent-%COMP%]   #map-canvas[_ngcontent-%COMP%]{width:100%;height:98%}.search-page[_ngcontent-%COMP%]   #place-search[_ngcontent-%COMP%]{min-height:300px;background-color:#f0f0f0;position:absolute;z-index:100;width:100%}.search-page[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]{flex:.4}.search-page[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%], .search-page[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%], .search-page[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding:0}.search-page[_ngcontent-%COMP%]   scroll-content[_ngcontent-%COMP%]{overflow-y:hidden}.search-page[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]{padding-left:2em}.search-page[_ngcontent-%COMP%]   .sideview[_ngcontent-%COMP%]{background:rgb(238,238,238);background:linear-gradient(to bottom,rgb(238,238,238) 0%,rgb(255,255,255) 100%)}"]}),Fn})(),yn=(()=>{class Fn{}return Fn.\u0275fac=function(ot){return new(ot||Fn)},Fn.\u0275mod=gt.oAB({type:Fn}),Fn.\u0275inj=gt.cJS({imports:[te.ez,l.u5,q.Pc,y.aw,d.e,re.Bz.forChild([{path:"",component:Vt}])]}),Fn})()},6314:(Pn,Et,k)=>{"use strict";k.d(Et,{N:()=>_e});var d=k(5861),y=k(9698),te=k(3855),l=k(7627),q=k(6579),re=k(4781),b=k(8274),he=k(425),Me=k(6260),Ve=k(6895),X=k(4006),xe=k(4463);let fe=(()=>{class ke extends xe.X${constructor(we,Xe){super(we,Xe)}transform(we,...Xe){let We=super.transform(we,...Xe);return We==we?null!=Xe&&Xe[0].default?Xe[0].default:Xe[0].Title?Xe[0].Title:We:We}}return ke.\u0275fac=function(we){return new(we||ke)(b.Y36(xe.sK,16),b.Y36(b.sBO,16))},ke.\u0275pipe=b.Yjl({name:"nullableTranslate",type:ke,pure:!0}),ke.\u0275prov=b.Yz7({token:ke,factory:ke.\u0275fac}),ke})();function ze(ke,Ne){if(1&ke){const we=b.EpF();b.TgZ(0,"p",21),b._UZ(1,"ion-icon",22),b._uU(2," One or more filters are currently being applied. "),b.TgZ(3,"ion-button",23),b.NdJ("click",function(){b.CHM(we);const We=b.oxw();return b.KtG(We.clearFilters())}),b._UZ(4,"ion-icon",24),b.TgZ(5,"ion-label"),b._uU(6,"Clear"),b.qZA()()()}}function le(ke,Ne){if(1&ke&&(b.TgZ(0,"ion-select-option",26),b._uU(1),b.qZA()),2&ke){const we=Ne.$implicit;b.Q6J("value",we.ID),b.xp6(1),b.Oqu(we.Title)}}function Ke(ke,Ne){if(1&ke){const we=b.EpF();b.TgZ(0,"ion-item")(1,"ion-label"),b._uU(2),b.ALo(3,"translate"),b.qZA(),b.TgZ(4,"ion-select",14),b.NdJ("ngModelChange",function(We){b.CHM(we);const ge=b.oxw();return b.KtG(ge.searchSettings.FilterOptionsByCountryId=We)})("ionChange",function(){b.CHM(we);const We=b.oxw();return b.KtG(We.onCountryChange())}),b.TgZ(5,"ion-select",25),b._uU(6,"(All Countries)"),b.qZA(),b.YNc(7,le,2,2,"ion-select-option",4),b.qZA()()}if(2&ke){const we=b.oxw();b.xp6(2),b.Oqu(b.lcZ(3,3,"ocm.search.countries")),b.xp6(2),b.Q6J("ngModel",we.searchSettings.FilterOptionsByCountryId),b.xp6(3),b.Q6J("ngForOf",we.countries)}}function Oe(ke,Ne){if(1&ke&&(b.TgZ(0,"ion-select-option",26),b._uU(1),b.ALo(2,"nullableTranslate"),b.qZA()),2&ke){const we=Ne.$implicit;b.Q6J("value",we.ID),b.xp6(1),b.Oqu(b.xi3(2,2,"ocm.reference.operatorInfo.value_"+we.ID,we))}}function Q(ke,Ne){if(1&ke&&(b.TgZ(0,"ion-select-option",26),b._uU(1),b.ALo(2,"nullableTranslate"),b.qZA()),2&ke){const we=Ne.$implicit;b.Q6J("value",we.ID),b.xp6(1),b.Oqu(b.xi3(2,2,"ocm.reference.usageType.value_"+we.ID,we))}}function Ye(ke,Ne){if(1&ke&&(b.TgZ(0,"ion-select-option",26),b._uU(1),b.ALo(2,"nullableTranslate"),b.qZA()),2&ke){const we=Ne.$implicit;b.Q6J("value",we.ID),b.xp6(1),b.Oqu(b.xi3(2,2,"ocm.reference.statusType.value_"+we.ID,we))}}function St(ke,Ne){if(1&ke&&(b.TgZ(0,"ion-select-option",26),b._uU(1),b.ALo(2,"nullableTranslate"),b.qZA()),2&ke){const we=Ne.$implicit;b.Q6J("value",we.ID),b.xp6(1),b.Oqu(b.xi3(2,2,"ocm.reference.connectionType.value_"+we.ID,we))}}function lt(ke,Ne){if(1&ke&&(b.TgZ(0,"ion-select-option",26),b._uU(1),b.qZA()),2&ke){const we=Ne.$implicit;b.Q6J("value",we.code),b.xp6(1),b.Oqu(we.title)}}let _e=(()=>{class ke{constructor(we,Xe,We,ge,de){this.appManager=we,this.poiManager=Xe,this.mapping=We,this.modalController=ge,this.events=de,this.maxPower=l.U,this.powerRange={lower:0,upper:this.maxPower},this._languages=[],this.searchSettings=we.searchSettings}ngOnInit(){var we=this;return(0,d.Z)(function*(){null!=we.searchSettings.MinPowerKW&&(we.powerRange.lower=we.searchSettings.MinPowerKW),null!=we.searchSettings.MaxPowerKW&&(we.powerRange.upper=we.searchSettings.MaxPowerKW),0==we.powerRange.upper&&(we.powerRange.upper=we.maxPower),we.appManager.analytics.viewEvent("Settings"),we.useFilteredOptions&&(yield we.onCountryChange())})()}get useFilteredOptions(){return this.searchSettings.FilterOptionsByCountryId>0}clearFilters(){this.searchSettings.ClearActiveFilters(),this.powerRange={lower:0,upper:this.maxPower},this.searchSettings.CheckForActiveFilters()}get operators(){return this.appManager.referenceDataManager.getNetworkOperators(this.useFilteredOptions)}get connectionTypes(){return this.appManager.referenceDataManager.getConnectionTypes(this.useFilteredOptions)}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes(this.useFilteredOptions)}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes(this.useFilteredOptions)}get countries(){return this.appManager.referenceDataManager.getCountries(this.useFilteredOptions)}get isCountryFilterFeatureEnabled(){return q.c.isFeatureEnabled("FILTER_OPTIONS_BY_COUNTRY")}get languages(){return this._languages.length>0||(this._languages=this.appManager.getLanguages()),this._languages}ionViewWillLeave(){null!=this.searchSettings.Language&&this.appManager.setLanguage(this.searchSettings.Language),this.searchSettings.MinPowerKW=this.powerRange.lower,this.searchSettings.MaxPowerKW=this.powerRange.upper,1==this.searchSettings.MinPowerKW&&(this.searchSettings.MinPowerKW=null),this.searchSettings.MaxPowerKW==this.maxPower&&(this.searchSettings.MaxPowerKW=null),this.appManager.searchSettings=this.searchSettings,this.appManager.saveSearchSettings(),this.events.publish("ocm:poiList:cleared")}onLanguageChange(){null!=this.searchSettings.Language&&""!=this.searchSettings.Language&&this.appManager.setLanguage(this.searchSettings.Language)}onCountryChange(){var we=this;return(0,d.Z)(function*(){we.appManager.referenceDataManager.refreshFilteredReferenceData(we.appManager.api,{CountryIds:[we.searchSettings.FilterOptionsByCountryId]})})()}onMapTypeChange(){var we=this;return(0,d.Z)(function*(){we.mapping.setMapType(we.searchSettings.MapType)})()}close(){this.modalController.dismiss()}}return ke.\u0275fac=function(we){return new(we||ke)(b.Y36(te.c),b.Y36(y.R),b.Y36(re.v),b.Y36(he.IN),b.Y36(Me.z))},ke.\u0275cmp=b.Xpm({type:ke,selectors:[["ng-component"]],decls:77,vars:38,consts:[[1,"settings-page","ion-padding"],["danger","",4,"ngIf"],[4,"ngIf"],["multiple","true","cancelText","Cancel","okText","OK",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["lines","none"],["dualKnobs","true","min","0","max","650","pin","true",3,"ngModel","ngModelChange"],["slot","start","size","small","name","flash"],["slot","end","name","flash"],["slot","start",2,"padding-top","0"],["type","number","min","0",2,"width","3em","border","none",3,"ngModel","max","ngModelChange"],["slot","end",2,"padding-top","0"],["type","number",2,"width","3em","border","none",3,"ngModel","max","min","ngModelChange"],["multiple","false",3,"ngModel","ngModelChange","ionChange"],["multiple","false","cancelText","Cancel","okText","OK",3,"ngModel","ngModelChange","ionChange"],["value","ROADMAP"],["value","SATELLITE"],[3,"ngModel","ngModelChange"],["slot","end"],[3,"click"],["name","close","slot","start"],["danger",""],["name","alert"],["size","small","color","light",3,"click"],["slot","start","name","close"],["value",""],[3,"value"]],template:function(we,Xe){1&we&&(b.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),b._uU(3),b.ALo(4,"translate"),b.qZA()()(),b.TgZ(5,"ion-content",0)(6,"h2"),b._uU(7,"Search Filters"),b.qZA(),b.TgZ(8,"p"),b._uU(9,"Note: Filters will remove usable charging locations from your search results if we do not have complete data (i.e Operator or Power Levels)."),b.qZA(),b.YNc(10,ze,7,0,"p",1),b.TgZ(11,"ion-list"),b.YNc(12,Ke,8,5,"ion-item",2),b.TgZ(13,"ion-item")(14,"ion-label"),b._uU(15),b.ALo(16,"translate"),b.qZA(),b.TgZ(17,"ion-select",3),b.NdJ("ngModelChange",function(ge){return Xe.searchSettings.OperatorList=ge}),b.YNc(18,Oe,3,5,"ion-select-option",4),b.qZA()(),b.TgZ(19,"ion-item")(20,"ion-label"),b._uU(21),b.ALo(22,"translate"),b.qZA(),b.TgZ(23,"ion-select",3),b.NdJ("ngModelChange",function(ge){return Xe.searchSettings.UsageTypeList=ge}),b.YNc(24,Q,3,5,"ion-select-option",4),b.qZA()(),b.TgZ(25,"ion-item")(26,"ion-label"),b._uU(27),b.ALo(28,"translate"),b.qZA(),b.TgZ(29,"ion-select",3),b.NdJ("ngModelChange",function(ge){return Xe.searchSettings.StatusTypeList=ge}),b.YNc(30,Ye,3,5,"ion-select-option",4),b.qZA()(),b.TgZ(31,"ion-item")(32,"ion-label"),b._uU(33),b.ALo(34,"translate"),b.qZA(),b.TgZ(35,"ion-select",3),b.NdJ("ngModelChange",function(ge){return Xe.searchSettings.ConnectionTypeList=ge}),b.YNc(36,St,3,5,"ion-select-option",4),b.qZA()(),b.TgZ(37,"ion-item",5)(38,"ion-range",6),b.NdJ("ngModelChange",function(ge){return Xe.powerRange=ge}),b.TgZ(39,"ion-icon",7),b._uU(40,"0"),b.qZA(),b._UZ(41,"ion-icon",8),b.qZA()(),b.TgZ(42,"ion-item",5)(43,"ion-note",9),b._uU(44,"Min. Power (kW)"),b._UZ(45,"br"),b.TgZ(46,"input",10),b.NdJ("ngModelChange",function(ge){return Xe.powerRange.lower=ge}),b.qZA()(),b.TgZ(47,"ion-note",11),b._uU(48,"Max. Power (kW)"),b._UZ(49,"br"),b.TgZ(50,"input",12),b.NdJ("ngModelChange",function(ge){return Xe.powerRange.upper=ge}),b.qZA()()()(),b.TgZ(51,"h2"),b._uU(52," General Settings "),b.qZA(),b.TgZ(53,"ion-item")(54,"ion-label"),b._uU(55,"Language"),b.qZA(),b.TgZ(56,"ion-select",13),b.NdJ("ngModelChange",function(ge){return Xe.searchSettings.Language=ge})("ionChange",function(){return Xe.onLanguageChange()}),b.YNc(57,lt,2,2,"ion-select-option",4),b.qZA()(),b.TgZ(58,"ion-item")(59,"ion-label"),b._uU(60),b.ALo(61,"translate"),b.qZA(),b.TgZ(62,"ion-select",14),b.NdJ("ngModelChange",function(ge){return Xe.searchSettings.MapType=ge})("ionChange",function(){return Xe.onMapTypeChange()}),b.TgZ(63,"ion-select-option",15),b._uU(64,"Road Map"),b.qZA(),b.TgZ(65,"ion-select-option",16),b._uU(66,"Satellite"),b.qZA()()(),b.TgZ(67,"ion-item")(68,"ion-label"),b._uU(69,"Enable Advanced Editor Options"),b.qZA(),b.TgZ(70,"ion-toggle",17),b.NdJ("ngModelChange",function(ge){return Xe.searchSettings.EnableAdvancedEditorFeatures=ge}),b.qZA()()(),b.TgZ(71,"ion-footer")(72,"ion-toolbar")(73,"ion-buttons",18)(74,"ion-button",19),b.NdJ("click",function(){return Xe.close()}),b._UZ(75,"ion-icon",20),b._uU(76," Close "),b.qZA()()()()),2&we&&(b.xp6(3),b.hij(" ",b.lcZ(4,26,"ocm.general.settings")," "),b.xp6(7),b.Q6J("ngIf",1==Xe.searchSettings.HasActiveFilters),b.xp6(2),b.Q6J("ngIf",Xe.isCountryFilterFeatureEnabled),b.xp6(3),b.Oqu(b.lcZ(16,28,"ocm.search.networkOperators")),b.xp6(2),b.Q6J("ngModel",Xe.searchSettings.OperatorList),b.xp6(1),b.Q6J("ngForOf",Xe.operators),b.xp6(3),b.Oqu(b.lcZ(22,30,"ocm.search.usageTypes")),b.xp6(2),b.Q6J("ngModel",Xe.searchSettings.UsageTypeList),b.xp6(1),b.Q6J("ngForOf",Xe.usageTypes),b.xp6(3),b.Oqu(b.lcZ(28,32,"ocm.search.operationalStatusTypes")),b.xp6(2),b.Q6J("ngModel",Xe.searchSettings.StatusTypeList),b.xp6(1),b.Q6J("ngForOf",Xe.statusTypes),b.xp6(3),b.Oqu(b.lcZ(34,34,"ocm.search.connectionTypes")),b.xp6(2),b.Q6J("ngModel",Xe.searchSettings.ConnectionTypeList),b.xp6(1),b.Q6J("ngForOf",Xe.connectionTypes),b.xp6(2),b.Q6J("ngModel",Xe.powerRange),b.xp6(8),b.Q6J("ngModel",Xe.powerRange.lower)("max",Xe.powerRange.upper),b.xp6(4),b.Q6J("ngModel",Xe.powerRange.upper)("max",Xe.maxPower)("min",Xe.powerRange.lower),b.xp6(6),b.Q6J("ngModel",Xe.searchSettings.Language),b.xp6(1),b.Q6J("ngForOf",Xe.languages),b.xp6(3),b.Oqu(b.lcZ(61,36,"ocm.details.location.map")),b.xp6(2),b.Q6J("ngModel",Xe.searchSettings.MapType),b.xp6(8),b.Q6J("ngModel",Xe.searchSettings.EnableAdvancedEditorFeatures))},dependencies:[Ve.sg,Ve.O5,X.Fj,X.wV,X.JJ,X.qQ,X.Fd,X.On,he.YG,he.Sm,he.W2,he.fr,he.Gu,he.gu,he.Ie,he.Q$,he.q_,he.uN,he.I_,he.t9,he.n0,he.wd,he.ho,he.sr,he.w,he.QI,xe.X$,fe],encapsulation:2}),ke})()},6779:(Pn,Et,k)=>{"use strict";k.r(Et),k.d(Et,{SignInModule:()=>Me});var d=k(9492),y=k(8936),te=k(4463),l=k(6895),q=k(4006),re=k(425),b=k(4228),he=k(8274);let Me=(()=>{class Ve{}return Ve.\u0275fac=function(xe){return new(xe||Ve)},Ve.\u0275mod=he.oAB({type:Ve}),Ve.\u0275inj=he.cJS({imports:[l.ez,q.u5,re.Pc,te.aw,y.e,b.Bz.forChild([{path:"",component:d.F}])]}),Ve})()},9492:(Pn,Et,k)=>{"use strict";k.d(Et,{F:()=>Ve});var d=k(5861),y=k(7689),te=k(3855),l=k(8274),q=k(425),re=k(4463),b=k(4228),he=k(6895),Me=k(4006);let Ve=(()=>{class X{constructor(fe,ze,le,Ke,Oe,Q,Ye,St){this.appManager=fe,this.modalController=ze,this.translate=le,this.alertController=Ke,this.loadingController=Oe,this.logging=Q,this.router=Ye,this.location=St,this.email=""}cancelSignIn(){this.modalController.dismiss()}performSignIn(){var fe=this;return(0,d.Z)(function*(){const ze=yield fe.loadingController.create({message:"Signing In.."});yield ze.present();let le=!1;try{yield fe.appManager.api.performSignIn(fe.email,fe.password),ze.dismiss(),localStorage.setItem("authResponse",JSON.stringify(fe.appManager.api.authResponse)),fe.appManager.isUserAuthenticated(!0),fe.modalController.dismiss(),fe.appManager.analytics.appEvent("Profile","SignedIn")}catch(Ke){le=!0,ze.dismiss(),yield(yield fe.alertController.create({header:"Open Charge Map",subHeader:"Email or Password not recognised",buttons:["Ok"]})).present(),fe.logging.log("Error logging in:"+Ke)}})()}}return X.\u0275fac=function(fe){return new(fe||X)(l.Y36(te.c),l.Y36(q.IN),l.Y36(re.sK),l.Y36(q.Br),l.Y36(q.HT),l.Y36(y.z),l.Y36(b.F0),l.Y36(he.Ye))},X.\u0275cmp=l.Xpm({type:X,selectors:[["ng-component"]],decls:37,vars:8,consts:[[1,"signin-page","ion-padding"],["item-left",""],["src","assets/images/icons/branding/AppIcon_128x128.png"],[1,"ion-padding"],["position","floating"],["type","text",3,"ngModel","ngModelChange"],["type","password",3,"ngModel","ngModelChange"],[3,"click"],["slot","secondary"],["name","close","slot","start"],["slot","primary"],["type","submit","color","primary",3,"click"],["name","log-in","slot","start"]],template:function(fe,ze){1&fe&&(l.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),l._uU(3),l.ALo(4,"translate"),l.qZA()()(),l.TgZ(5,"ion-content",0)(6,"ion-avatar",1),l._UZ(7,"img",2),l.qZA(),l.TgZ(8,"p",3),l._uU(9," Sign in using your Open Charge Map account. "),l.qZA(),l.TgZ(10,"ion-list")(11,"ion-item")(12,"ion-label",4),l._uU(13,"Email"),l.qZA(),l.TgZ(14,"ion-input",5),l.NdJ("ngModelChange",function(Ke){return ze.email=Ke}),l.qZA()(),l.TgZ(15,"ion-item")(16,"ion-label",4),l._uU(17,"Password"),l.qZA(),l.TgZ(18,"ion-input",6),l.NdJ("ngModelChange",function(Ke){return ze.password=Ke}),l.qZA()()(),l.TgZ(19,"p"),l._uU(20,"or "),l.TgZ(21,"a",7),l.NdJ("click",function(){return ze.appManager.launchWebPage("https://openchargemap.org/site/loginprovider/register")}),l._uU(22,"Register as New User"),l.qZA(),l._uU(23," or "),l.TgZ(24,"a",7),l.NdJ("click",function(){return ze.appManager.launchWebPage("https://openchargemap.org/site/loginprovider/passwordreset")}),l._uU(25,"Reset your password"),l.qZA()()(),l.TgZ(26,"ion-footer")(27,"ion-toolbar")(28,"ion-buttons",8)(29,"ion-button",7),l.NdJ("click",function(){return ze.cancelSignIn()}),l._UZ(30,"ion-icon",9),l._uU(31," Cancel"),l.qZA()(),l.TgZ(32,"ion-buttons",10)(33,"ion-button",11),l.NdJ("click",function(){return ze.performSignIn()}),l._UZ(34,"ion-icon",12),l._uU(35),l.ALo(36,"translate"),l.qZA()()()()),2&fe&&(l.xp6(3),l.hij(" ",l.lcZ(4,4,"ocm.general.signIn")," "),l.xp6(11),l.Q6J("ngModel",ze.email),l.xp6(4),l.Q6J("ngModel",ze.password),l.xp6(17),l.hij(" ",l.lcZ(36,6,"ocm.general.signIn"),""))},dependencies:[Me.JJ,Me.On,q.BJ,q.YG,q.Sm,q.W2,q.fr,q.Gu,q.gu,q.pK,q.Ie,q.Q$,q.q_,q.wd,q.sr,q.j9,re.X$],encapsulation:2}),X})()},7814:(Pn,Et,k)=>{"use strict";k.d(Et,{l:()=>he});var d=k(5861),y=k(7689),te=k(6799),l=k(8649),q=k(529),re=k(2340),b=k(8274);let he=(()=>{class Me{constructor(X,xe,fe){this.http=X,this.refData=xe,this.logging=fe,this.serviceBase="https://api.openchargemap.io",this.serviceBaseURL=this.serviceBase+"/v3",this.hasAuthorizationError=!1,this.ATTRIBUTION_METADATAFIELDID=4,this.clientName="ocm.api.default",this.allowMirror=!1,this.lastPOIApiCallURL="",this.serviceBaseURL=re.N.apiBase+"/v3"}getNumberListString(X){let xe="";for(let fe=0;fe<X.length;fe++)xe+=X[fe],fe<X.length&&(xe+=",");return xe}fetchPOIListByParam(X){var xe=this;return(0,d.Z)(function*(){const fe=xe.serviceBaseURL+"/poi/?client="+xe.clientName+(xe.allowMirror?" &allowmirror=true":"")+"&verbose=false&output=json";X.compact=!0;let ze="";null!=X.countryCode&&(ze+="&countrycode="+X.countryCode),null!=X.latitude&&(ze+="&latitude="+X.latitude),null!=X.longitude&&(ze+="&longitude="+X.longitude),null!=X.distance&&(ze+="&distance="+X.distance),null!=X.distanceUnit&&(ze+="&distanceunit="+X.distanceUnit),null!=X.includeComments&&(ze+="&includecomments="+X.includeComments),null!=X.maxResults&&(ze+="&maxresults="+X.maxResults),null!=X.countryIdList&&(ze+="&countryid="+xe.getNumberListString(X.countryIdList)),null!=X.levelIdList&&(ze+="&levelid="+xe.getNumberListString(X.levelIdList)),null!=X.connectionTypeIdList&&X.connectionTypeIdList.length>0&&(ze+="&connectiontypeid="+xe.getNumberListString(X.connectionTypeIdList)),null!=X.operatorIdList&&X.operatorIdList.length>0&&(ze+="&operatorid="+xe.getNumberListString(X.operatorIdList)),null!=X.usageTypeIdList&&X.usageTypeIdList.length>0&&(ze+="&usagetypeid="+xe.getNumberListString(X.usageTypeIdList)),null!=X.statusTypeIdList&&X.statusTypeIdList.length>0&&(ze+="&statustypeid="+xe.getNumberListString(X.statusTypeIdList)),null!=X.locationTitle&&(ze+="&locationtitle="+X.locationTitle),null!=X.minPowerKW&&X.minPowerKW>0&&(ze+="&minpowerkw="+X.minPowerKW),null!=X.maxPowerKW&&X.maxPowerKW>0&&(ze+="&maxpowerkw="+X.maxPowerKW),null!=X.submissionStatusTypeIdList&&(ze+="&submissionstatustypeid="+xe.getNumberListString(X.submissionStatusTypeIdList)),null!=X.poiIdList&&X.poiIdList.length>0&&(ze+="&chargepointid="+xe.getNumberListString(X.poiIdList)),0==X.enableCaching&&(ze+="&enablecaching=false"),null!=X.compact&&(ze+="&compact="+X.compact),X.levelOfDetail>1&&(ze+="&levelofdetail="+X.levelOfDetail),null!=X.polyline&&(ze+="&polyline="+X.polyline),null!=X.boundingbox&&(ze+="&boundingbox="+X.boundingbox),null!=X.additionalParams&&(ze+="&"+X.additionalParams);const le=fe+ze;if(xe.lastPOIApiCallURL===le&&0!=X.enableCaching)return xe.logging.log("Skipped API call due to same query being repeated."),[];xe.lastPOIApiCallURL=le,xe.logging.log("API Call:"+le,y.i.VERBOSE);try{let Ke=yield xe.http.get(le,xe.getHttpRequestOptions()).toPromise();return xe.refData.hydrateCompactPOIList(Ke)}catch(Ke){const Oe=Ke.message||"Could not fetch POI list from server.";throw xe.logging.log("API Client: "+JSON.stringify(Ke),y.i.ERROR),Oe}})()}getHttpRequestOptions(X=!0){let xe=new q.WM;return X&&(xe=xe.append("Content-Type","application/json")),this.authResponse&&this.authResponse.Data&&this.authResponse.Data.access_token&&(xe=xe.append("Authorization","Bearer "+this.authResponse.Data.access_token)),xe=xe.append("X-API-Key",re.N.apiKey),{headers:xe}}fetchCoreReferenceData(X){let xe=this.serviceBaseURL+"/referencedata/?client="+this.clientName+"&output=json"+(this.allowMirror?"&allowmirror=true":"")+"&verbose=false&compact=true";return null!=X&&null!=X.CountryIds&&(xe+="&countryid="+this.getNumberListString(X.CountryIds)),this.logging.log("API Call:"+xe,y.i.VERBOSE),this.http.get(xe,this.getHttpRequestOptions())}performSignIn(X,xe){return this.http.post(this.serviceBaseURL+"/profile/authenticate/",JSON.stringify({emailaddress:X,password:xe}),this.getHttpRequestOptions()).toPromise().then(le=>(this.authResponse=le,this.authResponse))}performSubmission(X,xe){return X===l.q.POI?this.submitPOI(xe):X===l.q.Comment?this.submitUserComment(xe):X===l.q.Media?this.submitMediaItem(xe):void 0}submitUserComment(X){const xe=JSON.stringify(X);return this.logging.log("[api] Submitting user comment"),this.http.post(this.serviceBaseURL+"/comment/",xe,this.getHttpRequestOptions()).toPromise()}submitMediaItem(X){const xe=JSON.stringify(X);return this.http.post(this.serviceBaseURL+"/mediaitem/",xe,this.getHttpRequestOptions()).toPromise()}submitPOI(X){const xe=JSON.stringify(X);return this.http.post(this.serviceBaseURL+"/poi/",xe,this.getHttpRequestOptions()).toPromise()}getPanoramioLocationPhotos(X){return new Promise(xe=>{const ze="https://www.panoramio.com/map/get_panoramas.php?set=public&from=0&to=2&minx="+(X.longitude-.001)+"&miny="+(X.latitude-.001)+"&maxx="+(X.longitude+.001)+"maxy="+(X.latitude+.001)+"&size=medium&mapfilter=true&callback=?";return console.log(ze),this.http.get(ze).toPromise()})}fetchReverseGeocodeResult(X,xe){return this.http.get(this.serviceBaseURL+"/geocode/?client="+this.clientName+"&output=json&camelcase=false&latitude="+X+"&longitude="+xe,this.getHttpRequestOptions()).toPromise()}isLocalStorageAvailable(){return typeof window.localStorage<"u"}setCachedDataObject(X,xe){this.isLocalStorageAvailable()&&(typeof xe>"u"&&(xe=null),null===xe?localStorage.removeItem(X):localStorage.setItem(X,JSON.stringify(xe)))}getCachedDataObject(X){if(this.isLocalStorageAvailable()){const xe=localStorage.getItem(X);if(null!=xe&&xe.length>0)return JSON.parse(xe)}return null}}return Me.\u0275fac=function(X){return new(X||Me)(b.LFG(q.eN),b.LFG(te.W),b.LFG(y.z))},Me.\u0275prov=b.Yz7({token:Me,factory:Me.\u0275fac,providedIn:"root"}),Me})()},56:(Pn,Et,k)=>{"use strict";k.d(Et,{c:()=>q});var d=k(5861),y=k(7689),te=k(8274),l=k(425);let q=(()=>{class re{constructor(he,Me){this.logger=he,this.platform=Me,this.isCordova=!1,this.ga=null,this.isCordova=!(!Me.is("cordova")&&!Me.is("capacitor"))}init(he){var Me=this;return(0,d.Z)(function*(){Me.isCordova&&Me.ga?yield Me.ga.startTrackerWithId(he):Me.logger.log("Could not initialise analytics")})()}setAppVersion(he){var Me=this;return(0,d.Z)(function*(){if(Me.isCordova&&Me.ga)return Me.ga.setAppVersion(he);Me.logger.log(he)})()}appEvent(he,Me){var Ve=this;return(0,d.Z)(function*(){if(Ve.isCordova&&Ve.ga)return Ve.ga.trackEvent(he,Me);Ve.logger.log(Me)})()}viewEvent(he){var Me=this;return(0,d.Z)(function*(){if(Me.isCordova&&Me.ga)return Me.ga.trackView(he);Me.logger.log(he)})()}}return re.\u0275fac=function(he){return new(he||re)(te.LFG(y.z),te.LFG(l.t4))},re.\u0275prov=te.Yz7({token:re,factory:re.\u0275fac,providedIn:"root"}),re})()},3855:(Pn,Et,k)=>{"use strict";k.d(Et,{c:()=>Ye});var d=k(5861),y=k(7689),te=k(7814),l=k(7627),q=k(4120),re=k(8649),b=k(6799),he=k(3912),Me=k(56),Ve=k(2340),X=k(8274),xe=k(529),fe=k(6260);class ze{constructor(lt,_e){this.SubmissionType=lt,this.Data=_e,this.DateQueued=new Date,this.IsSubmitted=!1,this.IsInProgress=!1,this.IsCancelled=!1,this.IsFailure=!1,this.Attempts=0,this.ID=new Date+"_"+100*Math.random()}}let le=(()=>{class St{constructor(_e){this.events=_e,this.isQueueProcessing=!1}setAppManager(_e){this.appManager=_e}add(_e,ke){let Ne=this.getQueueItems();Ne.push(new ze(_e,ke)),this.saveQueueItems(Ne)}update(_e){let ke=this.getQueueItems(),Ne=new Array;return ke.forEach(we=>{Ne.push(we.ID==_e.ID?_e:we)}),Ne}processNextQueueItem(){let _e=this.getNextQueueItem();null!=_e&&null!=this.appManager&&this.appManager.api.performSubmission(_e.SubmissionType,_e.Data).then(()=>{_e.IsSubmitted=!0,_e.Attempts++,this.update(_e),this.clear()})}getNextQueueItem(){let _e=this.getQueueItems(),ke=null;return _e.forEach(Ne=>{null==ke&&!Ne.IsCancelled&&!Ne.IsInProgress&&!Ne.IsSubmitted&&(ke=Ne)}),ke}hasPendingItems(){let _e=!1;return this.getQueueItems().forEach(Ne=>{!Ne.IsFailure&&!Ne.IsCancelled&&!Ne.IsSubmitted&&(_e=!0)}),_e}isCompleted(){let _e=this.getQueueItems(),ke=!0;return _e.forEach(Ne=>{(Ne.IsInProgress||Ne.IsFailure)&&(ke=!1)}),ke}clear(_e=!1){let ke=this.getQueueItems(),Ne=new Array;_e||ke.forEach(we=>{(we.IsInProgress||we.IsFailure)&&Ne.push(we)}),this.saveQueueItems(Ne)}saveQueueItems(_e){localStorage.setItem("submissionQueue",JSON.stringify(_e))}getQueueItems(){let _e=localStorage.getItem("submissionQueue");return null!=_e?JSON.parse(_e):new Array}}return St.\u0275fac=function(_e){return new(_e||St)(X.LFG(fe.z))},St.\u0275prov=X.Yz7({token:St,factory:St.\u0275fac,providedIn:"root"}),St})();var Ke=k(425),Oe=k(4463),Q=k(3175);let Ye=(()=>{class St{constructor(_e,ke,Ne,we,Xe,We,ge,de,oe,Ee,vt,Tt,Gt){this.http=_e,this.events=ke,this.api=Ne,this.submissionQueue=we,this.platform=Xe,this.referenceDataManager=We,this.journeyManager=ge,this.translateService=de,this.toastController=oe,this.loadingController=Ee,this.jwtHelper=vt,this.logging=Tt,this.analytics=Gt,this.isRequestInProgress=!1,this.title="Open Charge Map",this._isUserAuthenticated=null,this.isEmbeddedMode=!1,this.isOffline=!1,this.api.clientName="ocm.app.ionic."+Ve.N.version,this.isDebugMode=!1,this.enableSubmissionQueue=!1,this.submissionQueue.setAppManager(this),this.platformMode=Xe.is("cordova")?"cordova":"web",this.initAppManager(),this.searchSettings=new l.N,this.loadSearchSettings(),this.applyURLQueryStringOptions(),this.searchSettings.CheckForActiveFilters(),this.journeyManager.loadJourneys()}loadSearchSettings(){if(null!=localStorage.getItem("searchSettings")){this.searchSettings=new l.N;try{let _e=JSON.parse(localStorage.getItem("searchSettings"));Object.assign(this.searchSettings,_e)}catch{}}}savePushRegistration(_e){localStorage.setItem("_pushToken",_e.toString())}getPushRegistration(){localStorage.getItem("_pushToken")}getQueryVariable(_e){let Ne=window.location.search.substring(1).split("&");for(let we=0;we<Ne.length;we++){let Xe=Ne[we].split("=");if(decodeURIComponent(Xe[0])==_e)return Xe[1].split(",").map(de=>decodeURIComponent(de))}return null}applyURLQueryStringOptions(){if(this.getQueryVariable("mode")&&"embedded"==this.getQueryVariable("mode")[0]&&(this.isEmbeddedMode=!0),this.getQueryVariable("operatorid")){let _e=this.getQueryVariable("operatorid");for(let ke of _e)this.searchSettings.OperatorList.unshift(parseInt(ke,10))}if(this.getQueryVariable("latitude")&&this.getQueryVariable("longitude")){let _e=this.getQueryVariable("latitude")[0],ke=this.getQueryVariable("longitude")[0];this.searchSettings.StartSearchPosition=new q.wC(parseFloat(_e),parseFloat(ke))}this.getQueryVariable("title")&&(this.title=this.getQueryVariable("title")[0]),this.getQueryVariable("languagecode")&&this.setLanguage(this.getQueryVariable("languagecode")[0])}saveSearchSettings(){this.searchSettings.CheckForActiveFilters(),localStorage.setItem("searchSettings",JSON.stringify(this.searchSettings))}getLanguages(){return[{code:"ar",title:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629 / Arabic"},{code:"bg",title:"Bulgarian / \u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438"},{code:"cs",title:"Czech / \u010ce\u0161tina"},{code:"de",title:"German / Deutsch"},{code:"el",title:"Greek / \u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ae"},{code:"en",title:"English"},{code:"es",title:"Spanish / Espa\xf1ol"},{code:"et",title:"Estonian / Eesti"},{code:"fi",title:"Finnish / Suomi"},{code:"fr",title:"French / Fran\xe7ais"},{code:"fy",title:"West Frisian / Frysk"},{code:"hu",title:"Hungarian / Magyar"},{code:"it",title:"Italian / Italiano"},{code:"ja",title:"Japanese / \u65e5\u672c\u8a9e"},{code:"lt",title:"Lithuanian / Lietuvi\u0173"},{code:"nl",title:"Dutch / Nederlands"},{code:"pt",title:"Portuguese / portugu\xeas"},{code:"ru",title:"Russian / P\u0443\u0441\u0441\u043a\u0438\u0439"},{code:"sk",title:"Slovak / Sloven\u010dina"},{code:"tr",title:"Turkish / T\xfcrk\xe7e"},{code:"zh",title:"Chinese / \u4e2d\u56fd\u7684"}]}setLanguage(_e){(null==_e||""==_e)&&(_e="en"),this.logging.log("Changing language: "+_e),this.translateService.use(_e)}initAppManager(){this.initAuthFromStorage(),this.isUserAuthenticated(!0)&&this.enableSubmissionQueue&&null!=this.submissionQueue&&this.submissionQueue.hasPendingItems()&&this.submissionQueue.processNextQueueItem()}initAuthFromStorage(){let _e=localStorage.getItem("authResponse");if(null!=_e){let ke=JSON.parse(_e);null!=ke.Data&&null!=ke.Data.access_token&&(this.jwtHelper.decodeToken(ke.Data.access_token),this.jwtHelper.isTokenExpired(ke.Data.access_token)?localStorage.removeItem("authResponse"):(this.api.authResponse=ke,this.logging.log("User has valid auth token in local storage",y.i.VERBOSE)))}}isUserAuthenticated(_e=!1){return!1===_e&&null!=this._isUserAuthenticated||(this._isUserAuthenticated=!1,null!=this.api.authResponse&&(this.jwtHelper.isTokenExpired(this.api.authResponse.Data.access_token)||(this._isUserAuthenticated=!0))),this._isUserAuthenticated}getCurrentAuthToken(){return null!=this.api.authResponse?this.api.authResponse.Data.access_token:null}getUserProfile(){return null!=this.api.authResponse?this.api.authResponse.Data.UserProfile:null}signOutCurrentUser(){localStorage.removeItem("authResponse"),this.api.authResponse=null,this._isUserAuthenticated=!1}submitComment(_e){if(!this.enableSubmissionQueue)return this.api.performSubmission(re.q.Comment,_e);this.submissionQueue.add(re.q.Comment,_e),this.submissionQueue.processNextQueueItem()}submitMediaItem(_e){if(!this.enableSubmissionQueue)return this.api.performSubmission(re.q.Media,_e);this.submissionQueue.add(re.q.Media,_e),this.submissionQueue.processNextQueueItem()}submitPOI(_e){if(!this.enableSubmissionQueue)return this.api.performSubmission(re.q.POI,_e);this.submissionQueue.add(re.q.POI,_e),this.submissionQueue.processNextQueueItem()}showToastNotification(_e){var ke=this;return(0,d.Z)(function*(){yield(yield ke.toastController.create({message:_e,duration:3e3})).present()})()}showLoadingProgress(_e){var ke=this;return(0,d.Z)(function*(){yield(yield ke.loadingController.create({message:_e})).present()})()}dismissLoadingProgress(){var _e=this;return(0,d.Z)(function*(){return _e.loadingController.dismiss()})()}launchOCMWebPage(_e){this.isUserAuthenticated(!0)&&(-1===_e.indexOf("?")&&(_e+="?"),_e+="&auth="+this.getCurrentAuthToken()),_e="https://openchargemap.org/site"+_e,window.open(_e,"_system")}launchWebPage(_e){window.open(_e,"_system")}isPlatform(_e){return this.platform.is(_e)}}return St.\u0275fac=function(_e){return new(_e||St)(X.LFG(xe.eN),X.LFG(fe.z),X.LFG(te.l),X.LFG(le),X.LFG(Ke.t4),X.LFG(b.W),X.LFG(he.i),X.LFG(Oe.sK),X.LFG(Ke.yF),X.LFG(Ke.HT),X.LFG(Q.N0),X.LFG(y.z),X.LFG(Me.c))},St.\u0275prov=X.Yz7({token:St,factory:St.\u0275fac,providedIn:"root"}),St})()},6260:(Pn,Et,k)=>{"use strict";k.d(Et,{z:()=>y});var d=k(8274);let y=(()=>{class te{constructor(){this.c=new Map}subscribe(q,...re){let b=this.c.get(q);b||this.c.set(q,b=[]),b.push(...re)}unsubscribe(q,re){if(!re)return this.c.delete(q);const b=this.c.get(q);if(!b)return!1;const he=b.indexOf(re);return!(he<0||(b.splice(he,1),0===b.length&&this.c.delete(q),0))}publish(q,...re){const b=this.c.get(q);return b?b.map(he=>{try{return he(...re)}catch(Me){return console.error(Me),null}}):null}}return te.\u0275fac=function(q){return new(q||te)},te.\u0275prov=d.Yz7({token:te,factory:te.\u0275fac,providedIn:"root"}),te})()},3912:(Pn,Et,k)=>{"use strict";k.d(Et,{i:()=>he});var d=k(7689),y=k(7814),te=k(9698),l=k(8016),q=k(129),re=k(4120),b=k(8274);let he=(()=>{class Me{constructor(X,xe,fe){this.api=X,this.poiManager=xe,this.logging=fe,this.journeys=[],this.favourites=[]}loadJourneys(){let X=localStorage.getItem("journeys");if(null!=X&&(this.journeys=JSON.parse(X)),null!=this.journeys)for(let xe of this.journeys)this.fetchAllJourneyPOIDetails(xe)}fetchAllJourneyPOIDetails(X){this.logging.log("Journeys - fetching poi details for Journey "+X.Title);let xe=new l.b;xe.poiIdList=[];for(let fe of X.Stages)for(let ze of fe.WayPoints)for(let le of ze.PoiIDs)xe.poiIdList.push(le);this.api.fetchPOIListByParam(xe).then(fe=>{for(let ze of fe)this.updateStoredPOI(ze)})}updateStoredPOI(X){if(this.journeys.forEach(xe=>{xe.Stages.forEach(fe=>{fe.WayPoints.forEach(ze=>{ze.PoiIDs.forEach(le=>{if(le==X.ID)if(null==ze.PoiList){ze.PoiList=[];let Ke=new q.Qp("charging",1);Ke.Poi=X,Ke.PoiID=X.ID,ze.PoiList.push(Ke)}else for(let Ke of ze.PoiList)Ke.PoiID==X.ID&&(Ke.Poi=X)})})})}),null!=this.favourites)for(let xe of this.favourites)"charging"==xe.Type&&xe.PoiID==X.ID&&(xe.Poi=X)}saveJourneys(){let X=JSON.parse(JSON.stringify(this.journeys));for(let fe of X)for(const ze of fe.Stages)for(let le of ze.WayPoints)for(let Ke of le.PoiList)Ke.Poi=null,Ke.Photos=null;const xe=JSON.stringify(X);localStorage.setItem("journeys",xe)}addJourney(X,xe){let fe=new q.vw;fe.Title="Stage 1",null!=xe&&fe.WayPoints.push(xe),X.Stages.push(fe),this.journeys.push(X)}deleteJourney(X){this.journeys=this.journeys.filter(xe=>xe.ID!=X),this.saveJourneys()}getJourney(X){let xe=this.journeys.filter(fe=>fe.ID==X);return xe.length>0?xe[0]:null}getJourneyStages(X){return this.getJourney(X).Stages}addJourneyWaypoint(X,xe,fe){let ze=this.getJourney(X);if(null==xe){let le=new q.vw;le.Title="Stage "+(ze.Stages.length+1),le.WayPoints.push(fe),ze.Stages.push(le)}else{let le=ze.Stages[xe];null==le.WayPoints&&(le.WayPoints=[]),le.WayPoints.push(fe)}}addJourneyStage(X,xe){return this.getJourney(X).Stages.push(xe)-1}setupTestJourneys(){this.journeys=[];let X=new q.fw;X.Title="New York to Brooklyn",X.Notes="A little jaunt to Brooklyn",X.Stages=[];let xe=new q.vw,fe=new q.kA;fe.Notes="Starting point",fe.Position=new re.wC(40,1.2),fe.Title="Start",xe.WayPoints.push(fe);let ze=new q.kA;ze.Notes="Middle point",ze.Position=new re.wC(40,1.33),ze.Title="Middle",xe.WayPoints.push(ze);let le=new q.kA;le.Notes="End point",le.Position=new re.wC(40,1.33),le.Title="End",xe.WayPoints.push(le),X.Stages.push(xe),this.journeys.push(X);let Ke=new q.fw;Ke.Title="Aberdeen to London",Ke.Notes="Roadtrip",Ke.Stages=[],this.journeys.push(Ke)}calculateEnergyConsumptionkWh(X,xe,fe=0,ze){return X*ze}setRoutePolyline(X){this.routePolyline=X}getRoutePolyline(){return this.routePolyline}}return Me.\u0275fac=function(X){return new(X||Me)(b.LFG(y.l),b.LFG(te.R),b.LFG(d.z))},Me.\u0275prov=b.Yz7({token:Me,factory:Me.\u0275fac,providedIn:"root"}),Me})()},7689:(Pn,Et,k)=>{"use strict";k.d(Et,{i:()=>te,z:()=>l});var d=k(2340),y=k(8274),te=(()=>{return(q=te||(te={}))[q.VERBOSE=0]="VERBOSE",q[q.INFO=1]="INFO",q[q.WARNING=2]="WARNING",q[q.ERROR=3]="ERROR",te;var q})();let l=(()=>{class q{constructor(){this.logLevel=te.VERBOSE,d.N.production&&(this.logLevel=te.INFO)}log(b,he=te.VERBOSE){console&&console.log&&he>=this.logLevel&&console.log("["+te[he]+"] {"+(new Date).toLocaleTimeString()+"} "+b)}}return q.\u0275fac=function(b){return new(b||q)},q.\u0275prov=y.Yz7({token:q,factory:q.\u0275fac,providedIn:"root"}),q})()},9698:(Pn,Et,k)=>{"use strict";k.d(Et,{R:()=>b});var d=k(5861),y=k(7689),te=k(7814),l=k(56),q=k(8274),re=k(6260);let b=(()=>{class he{constructor(Ve,X,xe,fe){this.api=Ve,this.events=X,this.logging=xe,this.analytics=fe,this.isRequestInProgress=!1}refreshPOIList(Ve){var X=this;return(0,d.Z)(function*(){try{return X.poiList=yield X.fetchPOIList(Ve),X.events.publish("ocm:poiList:updated"),X.analytics.appEvent("Search","Fetched Results"),X.poiList.length}catch{return 0}})()}fetchPOIList(Ve){var X=this;return(0,d.Z)(function*(){X.isRequestInProgress=!0;try{let xe=yield X.api.fetchPOIListByParam(Ve);return X.isRequestInProgress=!1,xe&&xe.length&&X.logging.log("fetched POI list ["+xe.length+"]"),xe}catch{return X.isRequestInProgress=!1,[]}})()}clearResults(){this.poiList=[],this.events.publish("ocm:poiList:cleared"),this.logging.log("clearing results after settings change",y.i.VERBOSE)}getPOIById(Ve,X=!1,xe=!1){var fe=this;return(0,d.Z)(function*(){if(!xe&&null!=fe.poiList){const Ke=fe.poiList.find(Oe=>Oe.ID==Ve);if(Ke)return Ke}const ze={poiIdList:[Ve],enableCaching:!xe,includeComments:!0},le=yield fe.api.fetchPOIListByParam(ze);return le&&le.length>0?(fe.poiList&&le[0].ID==Ve&&(fe.poiList=fe.poiList.filter(Ke=>Ke.ID!=Ve),fe.poiList.push(le[0]),fe.logging.log("POI refreshed in cache "+Ve)),le[0]):null})()}}return he.\u0275fac=function(Ve){return new(Ve||he)(q.LFG(te.l),q.LFG(re.z),q.LFG(y.z),q.LFG(l.c))},he.\u0275prov=q.Yz7({token:he,factory:he.\u0275fac,providedIn:"root"}),he})()},6799:(Pn,Et,k)=>{"use strict";k.d(Et,{W:()=>q});var d=k(5861),y=k(7689),te=k(8274),l=k(529);let q=(()=>{class re{constructor(he,Me){this.http=he,this.logging=Me,this.loadCachedRefData()}refreshReferenceData(he){var Me=this;return(0,d.Z)(function*(){try{const Ve=yield he.fetchCoreReferenceData(null).toPromise();return Me.setCoreReferenceData(Ve),Me.setFilteredReferenceData(Ve),Me.logging.log("Got refreshed core ref data.",y.i.VERBOSE),Me.sortCoreReferenceData(),Me.cacheCurrentRefData(),!0}catch(Ve){return Me.logging.log("Error fetching core ref data:"+Ve),!1}})()}refreshFilteredReferenceData(he,Me){he.fetchCoreReferenceData(Me).subscribe(Ve=>{this.setFilteredReferenceData(Ve),this.sortCoreReferenceData(),this.logging.log("Got refreshed filtered reference data.",y.i.VERBOSE)},Ve=>{this.logging.log("Error fetching filtered reference data:"+Ve)})}setCoreReferenceData(he){this.referenceData=he}setFilteredReferenceData(he){this.filteredReferenceData=he}referenceDataLoaded(){return null!=this.referenceData}getCountries(he=!1){return 1==he?this.filteredReferenceData.Countries:this.referenceData.Countries}getCountryByID(he){return this.getRefDataByID(this.referenceData.Countries,he)}getConnectionTypes(he=!1){return 1==he?this.filteredReferenceData.ConnectionTypes:this.referenceData.ConnectionTypes}getConnectionTypeByID(he){return this.getRefDataByID(this.referenceData.ConnectionTypes,he)}getUsageTypes(he=!1){return 1==he?this.filteredReferenceData.UsageTypes:this.referenceData.UsageTypes.filter(Me=>Me.ID>0)}getUsageTypeByID(he){return this.getRefDataByID(this.referenceData.UsageTypes,he)}getStatusTypes(he=!1){return 1==he?this.filteredReferenceData.StatusTypes:this.referenceData.StatusTypes.filter(Me=>Me.ID>0)}getStatusTypeByID(he){return this.getRefDataByID(this.referenceData.StatusTypes,he)}getNetworkOperators(he=!1){return 1==he?this.filteredReferenceData.Operators:this.referenceData.Operators}getNetworkOperatorByID(he){return this.getRefDataByID(this.referenceData.Operators,he)}getDataProviders(he=!1){return 1==he?this.filteredReferenceData.DataProviders:this.referenceData.DataProviders}getDataProviderByID(he){return this.getRefDataByID(this.referenceData.DataProviders,he)}getCheckinStatusTypes(he=!1,Me=!0){let Ve=null;return Ve=1==he?this.filteredReferenceData.CheckinStatusTypes:this.referenceData.CheckinStatusTypes,Me&&(Ve=Ve.filter(X=>!1===X.IsAutomatedCheckin)),Ve}getCheckinStatusTypeByID(he){return this.getRefDataByID(this.referenceData.CheckinStatusTypes,he)}getCommentTypes(he=!1,Me=!0){let Ve;return Ve=1==he?this.filteredReferenceData.UserCommentTypes:this.referenceData.UserCommentTypes,Me&&(Ve=Ve.filter(X=>100!==X.ID&&110!==X.ID)),Ve}getCommentTypeByID(he){return this.getRefDataByID(this.referenceData.UserCommentTypes,he)}getSubmissionStatusTypes(he=!1){return 1==he?this.filteredReferenceData.SubmissionStatusTypes:this.referenceData.SubmissionStatusTypes}getSubmissionStatusTypesByID(he){return this.getRefDataByID(this.referenceData.SubmissionStatusTypes,he)}getChargingLevelTypes(he=!1){return 1==he?this.filteredReferenceData.ChargerTypes:this.referenceData.ChargerTypes}getChargingLevelTypeByID(he){return this.getRefDataByID(this.referenceData.ChargerTypes,he)}getOutputCurrentTypes(he=!1){return he?this.referenceData.CurrentTypes:this.filteredReferenceData.CurrentTypes}getOutputCurrentTypeByID(he){return this.getRefDataByID(this.referenceData.CurrentTypes,he)}loadCachedRefData(){const he=localStorage.getItem("referenceData");if(null==he)this.http.get("./assets/data/CoreReferenceData.json").subscribe(Me=>{this.logging.log("Using bundled reference data as cached ref data."),this.setCoreReferenceData(Me),this.setFilteredReferenceData(Me)});else{let Me=JSON.parse(he);this.setCoreReferenceData(Me)}this.setFilteredReferenceData(this.referenceData)}cacheCurrentRefData(){null!=this.referenceData&&(this.referenceData.CacheDate=new Date,localStorage.setItem("referenceData",JSON.stringify(this.referenceData)))}getRefDataByID(he,Me){if(""!==Me&&(Me=parseInt(Me,10)),null!=he)for(let Ve=0;Ve<he.length;Ve++)if(he[Ve].ID===Me)return he[Ve];return null}sortCoreReferenceData(){this.sortReferenceData(this.referenceData.ConnectionTypes),this.sortReferenceData(this.referenceData.Countries),this.sortReferenceData(this.referenceData.Operators),this.sortReferenceData(this.referenceData.DataProviders),this.sortReferenceData(this.referenceData.UsageTypes),this.sortReferenceData(this.referenceData.StatusTypes),this.sortReferenceData(this.referenceData.CheckinStatusTypes),this.sortReferenceData(this.referenceData.SubmissionStatusTypes),this.filteredReferenceData&&(this.sortReferenceData(this.filteredReferenceData.ConnectionTypes),this.sortReferenceData(this.filteredReferenceData.Operators))}sortReferenceData(he){he.sort(this.sortListByTitle)}sortListByTitle(he,Me){return he.Title<Me.Title?-1:he.Title>Me.Title?1:0}getMetadataValueByMetadataFieldID(he,Me){if(""!==Me&&(Me=parseInt(Me,10)),null!=he)for(let Ve=0;Ve<he.length;Ve++)if(he[Ve].ID===Me)return he[Ve];return null}hydrateCompactPOI(he,Me=!1){const Ve=this;if(null!=he.DataProviderID&&(Me||null==he.DataProvider)&&(he.DataProvider=Ve.getDataProviderByID(he.DataProviderID)),null!=he.OperatorID&&(Me||null==he.OperatorInfo)&&(he.OperatorInfo=Ve.getNetworkOperatorByID(he.OperatorID)),null!=he.UsageTypeID&&(Me||null==he.UsageType)&&(he.UsageType=Ve.getUsageTypeByID(he.UsageTypeID)),null!=he.AddressInfo.CountryID&&(Me||null==he.AddressInfo.Country)&&(he.AddressInfo.Country=Ve.getCountryByID(he.AddressInfo.CountryID)),null!=he.StatusTypeID&&(Me||null==he.StatusType)&&(he.StatusType=Ve.getStatusTypeByID(he.StatusTypeID)),null!=he.SubmissionStatusTypeID&&(Me||null==he.SubmissionStatusType)&&(he.SubmissionStatusType=Ve.getSubmissionStatusTypesByID(he.SubmissionStatusTypeID)),null!=he.Connections)for(let X=0;X<he.Connections.length;X++){const xe=he.Connections[X];null!=xe.ConnectionTypeID&&(Me||null==xe.ConnectionType)&&(xe.ConnectionType=Ve.getConnectionTypeByID(xe.ConnectionTypeID)),null!=xe.LevelID&&(Me||null==xe.Level)&&(xe.Level=Ve.getChargingLevelTypeByID(xe.LevelID)),null!=xe.CurrentTypeID&&(Me||null==xe.CurrentType)&&(xe.CurrentType=Ve.getOutputCurrentTypeByID(xe.CurrentTypeID)),null!=xe.StatusTypeID&&(Me||null==xe.StatusType)&&(xe.StatusType=Ve.getStatusTypeByID(xe.StatusTypeID)),he.Connections[X]=xe}if(null!=he.UserComments)for(let X=0;X<he.UserComments.length;X++){const xe=he.UserComments[X];null!=xe.CommentTypeID&&(Me||null==xe.CommentType)&&(xe.CommentType=Ve.getCommentTypeByID(xe.CommentTypeID)),null!=xe.CheckinStatusTypeID&&(Me||null==xe.CheckinStatusType)&&(xe.CheckinStatusType=Ve.getCheckinStatusTypeByID(xe.CheckinStatusTypeID)),he.UserComments[X]=xe}return he}hydrateCompactPOIList(he){for(let Me=0;Me<he.length;Me++)he[Me]=this.hydrateCompactPOI(he[Me]);return he}}return re.\u0275fac=function(he){return new(he||re)(te.LFG(l.eN),te.LFG(y.z))},re.\u0275prov=te.Yz7({token:re,factory:re.\u0275fac,providedIn:"root"}),re})()},4781:(Pn,Et,k)=>{"use strict";k.d(Et,{v:()=>Ke});var d=k(553),y=k(5906),te=k(6579),l=k(7689),q=k(5861),re=k(9751),b=k(4120),he=k(2340),Me=k(4209);class Ve{constructor(Q,Ye){this.events=Q,this.logging=Ye,this.events=Q,this.mapAPIType=y.b.MAPKIT_JS,this.mapReady=!1,this.markerList=new Map,this.mapkitUtils=new X}initAPI(){mapkit&&mapkit.init({authorizationCallback:function(Q){Q(he.N.mapKitToken)}})}disposeMap(){}initMap(Q,Ye,St){this.mapCanvasID=Q;let lt=!0;if(lt=!(typeof mapkit>"u"),!lt)return this.logging.log("Call to initMap before API is ready:"+y.b[this.mapAPIType],l.i.ERROR),this.mapReady=!1,!1;this.initAPI(),null==this.map&&(document.getElementById(Q),this.map=new mapkit.Map(Q),this.map.annotationForCluster=function(ke){"poi"===ke.clusteringIdentifier&&(ke.title="Charging Location",ke.subtitle=ke.memberAnnotations.reduce((Ne,we)=>Ne+we.population,0))},this.mapReady=!0,mapkit.addEventListener("configuration-change",ke=>{this.events.publish("ocm:mapping:ready")}),this.map.addEventListener("scroll-end",ke=>{this.events.publish("ocm:mapping:dragend")}),this.map.addEventListener("zoom-end",ke=>{this.events.publish("ocm:mapping:zoom")}))}clearMarkers(){null!=this.markerList&&this.markerList.forEach((Q,Ye)=>{try{this.map.removeAnnotation(Ye)}catch{}}),this.markerList=new Map}showPOIListOnMap(Q,Ye){let ke=0,we=0==this.markerList.size;if(null!=Q){let We=[];for(let ge=0;ge<Q.length;ge++)if(null!=Q[ge].AddressInfo&&null!=Q[ge].AddressInfo.Latitude&&null!=Q[ge].AddressInfo.Longitude){let de=Q[ge],oe=!0;if(null!=this.markerList&&this.markerList.has(de.ID)&&(oe=!1),oe){let Ee=null;Ee=te.c.getIconForPOI(de);let Ot="OCM-"+de.ID+": "+de.AddressInfo.Title+":";null!=de.UsageType&&(Ot+=" "+de.UsageType.Title),null!=de.StatusType&&(Ot+=" "+de.StatusType.Title);const yt=new mapkit.Coordinate(de.AddressInfo.Latitude,de.AddressInfo.Longitude);let Mt=new mapkit.ImageAnnotation(yt,{title:Ot,size:{width:34,height:50},url:{1:Ee},clusteringIdentifier:"poi"});Mt.poi=de,Mt.addEventListener("select",gt=>{const it=gt.target.poi;this.events.publish("ocm:poi:selected",{poi:it,poiId:it.ID})}),this.markerList.set(de.ID,Mt),We.push(Mt),ke++}}We.length>0&&(this.map.addAnnotations(We),we&&this.map.showItems(We,{animate:!0,padding:new mapkit.Padding(60,25,60,25)})),this.logging.log(ke+" new map markers added out of a total "+this.markerList.size)}}refreshMapLayout(){null!=this.map&&setTimeout(()=>{this.logging.log("MapKit: refreshMapLayout",l.i.VERBOSE)},200)}setMapCenter(Q,Ye){this.map&&(this.map.setCenterAnimated(new mapkit.Coordinate(Q.coords.latitude,Q.coords.longitude),!1),Ye&&this.setMapZoom(Ye))}getMapCenter(){return new re.y(Ye=>{if(null!=this.map){let St=this.map.center;null!=St&&(Ye.next(new b.jR(St.latitude,St.longitude)),Ye.complete())}})}setMapZoom(Q){const Ye=Math.min(Q,28),St=this.mapkitUtils.deltaFromZoomLevel(this.map,this.map.center,Math.round(Ye)),lt=new mapkit.CoordinateSpan(111*St.latitudeDelta,111*St.longitudeDelta),_e=new mapkit.CoordinateRegion(this.map.center,lt);this.map.setRegionAnimated(_e)}getMapZoom(){return new re.y(Ye=>{this.logging.log("MapKit: getMapZoom not supported",l.i.VERBOSE),Ye.next(this.map._impl.zoomLevel),Ye.complete()})}setMapType(Q){this.logging.log("MapKit: skipped setting Map Type :"+Q)}getMapBounds(){return new re.y(Ye=>{let St=new Array,lt=this.map.region.toBoundingRegion();St.push(new b.wC(lt.southLatitude,lt.westLongitude)),St.push(new b.wC(lt.northLatitude,lt.eastLongitude)),Ye.next(St),Ye.complete()})}moveToMapBounds(Q){this.logging.log("MapKit: map bounds not implemented")}renderMap(Q,Ye,St){return document.getElementById(this.mapCanvasID).style.height=Ye+"px",this.mapReady&&this.showPOIListOnMap(Q,St),!0}renderPolyline(Q){this.clearPolyline()}clearPolyline(){null!=this.polylinePath&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(Q){return(0,q.Z)(function*(){let Ye=new mapkit.Search({getsUserLocation:!0});return new Promise(function(){var St=(0,q.Z)(function*(lt,_e){let ke=[];Ye.search(Q,function(){var Ne=(0,q.Z)(function*(we,Xe){we&&_e(we),ke=[],Xe.places.map(We=>{let ge=new Me.n;ge.Title=We.name,ge.Address=We.formattedAddress,ge.Type="place",ge.Location=new b.wC(We.coordinate.latitude,We.coordinate.longitude),ke.push(ge)}),lt(ke)});return function(we,Xe){return Ne.apply(this,arguments)}}())});return function(lt,_e){return St.apply(this,arguments)}}())})()}addPOILayer(Q){this.logging.log("Add POI Layer not implemented in this provider.")}}class X{constructor(){this.mercatorRadius=85445659.44705395,this.mercatorOffset=268435456}longitudeToPixelSpaceX(Q){return Math.round(this.mercatorOffset+this.mercatorRadius*Q*Math.PI/180)}latitudeToPixelSpaceY(Q){return Math.round(this.mercatorOffset-this.mercatorRadius*Math.log((1+Math.sin(Q*Math.PI/180))/(1-Math.sin(Q*Math.PI/180)))/2)}pixelSpaceXToLongitude(Q){return(Math.round(Q)-this.mercatorOffset)/this.mercatorRadius*180/Math.PI}pixelSpaceYToLatitude(Q){return 180*(Math.PI/2-2*Math.atan(Math.exp((Math.round(Q)-this.mercatorOffset)/this.mercatorRadius)))/Math.PI}deltaFromZoomLevel(Q,Ye,St){let lt=this.longitudeToPixelSpaceX(Ye.longitude),_e=this.latitudeToPixelSpaceY(Ye.latitude),Ne=Math.pow(2,20-St),we=Q.visibleMapRect.size,Xe=we.width*Ne,We=we.height*Ne,ge=lt-Xe/2,de=_e-We/2,oe=this.pixelSpaceXToLongitude(ge),vt=this.pixelSpaceXToLongitude(ge+Xe)-oe,Tt=this.pixelSpaceYToLatitude(de);return{latitudeDelta:-1*(this.pixelSpaceYToLatitude(de+We)-Tt),longitudeDelta:vt}}}var xe=k(8274),fe=k(6260),ze=k(529);let le=(()=>{class Oe extends d.k{constructor(Ye,St,lt){super(Ye,St,lt),this.mapAPIType=y.b.MAPTILER,this.mapTileSet="https://maps.tilehosting.com/styles/streets/style.json?key=Gs9z7krALe3CGI60d5cL"}initAPI(){}}return Oe.\u0275fac=function(Ye){return new(Ye||Oe)(xe.LFG(fe.z),xe.LFG(l.z),xe.LFG(ze.eN))},Oe.\u0275prov=xe.Yz7({token:Oe,factory:Oe.\u0275fac}),Oe})(),Ke=(()=>{class Oe{constructor(Ye,St,lt){this.logging=St,this.http=lt,this.isFocused=!1,this.events=Ye,this.mapOptions=new y._,this.mapAPIReady=!1,this.mapsInitialised=!1,this.setMapAPI(this.mapOptions.mapAPI);let _e=this;this.debouncedMapPositionUpdate=te.c.debounce(()=>{this.logging.log("signaling map position change:"),_e.mapProvider.mapReady&&_e.getMapCenter().subscribe(ke=>{null!=ke?(this.logging.log("Map centre/zoom changed, updating search position:"+ke),this.updateMapCentrePos(ke.coords.latitude,ke.coords.longitude,!1)):this.logging.log("Map centre/zoom changed - map not ready to change centre pos:")})},300,!1)}setParentAppContext(Ye){this.parentAppContext=Ye}setMapAPI(Ye){this.mapOptions.mapAPI=Ye,this.mapOptions.mapAPI==y.b.MAPBOX&&(this.mapProvider=new d.k(this.events,this.logging,this.http)),this.mapOptions.mapAPI==y.b.MAPKIT_JS&&(this.mapProvider=new Ve(this.events,this.logging)),this.mapOptions.mapAPI==y.b.MAPTILER&&(this.mapProvider=new le(this.events,this.logging,this.http))}isMapReady(){return null!=this.mapProvider&&this.mapProvider.mapReady}externalAPILoaded(Ye){this.mapAPIReady=!0,this.logging.log("Mapping API Loaded: "+y.b[Ye])}initMap(Ye){if(!this.isMapReady())if(null!=this.mapProvider)this.mapsInitialised&&this.logging.log("initMap: Map provider already initialised"),this.logging.log("Mapping Manager: Init "+y.b[this.mapProvider.mapAPIType]),this.mapProvider.initMap(Ye,this.mapOptions,this);else{if(this.mapsInitialised)return void this.logging.log("initMap: map already initialised");this.logging.log("initMap: "+this.mapOptions.mapAPI)}}mapManipulationPerformed(Ye){this.logging.log("map manipulated:"+Ye),("drag"==Ye||"zoom"==Ye)&&this.debouncedMapPositionUpdate()}updateMapSize(){this.mapProvider&&this.mapProvider.refreshMapLayout()}updateMapCentrePos(Ye,St,lt,_e){lt&&null!=this.mapProvider&&this.mapProvider.setMapCenter(new b.jR(Ye,St),_e),this.mapOptions.mapCentre=new b.jR(Ye,St)}moveToMapBounds(Ye){this.mapProvider.moveToMapBounds(Ye)}refreshMapView(Ye,St,lt){return null!=this.mapProvider?(this.logging.log("Mapping Manager: renderMap "+y.b[this.mapProvider.mapAPIType]),this.isMapReady()?this.mapProvider.renderMap(St,Ye,this.parentAppContext):this.logging.log("refreshMapView: map provider not initialised..")):this.logging.log("Unsupported Map API: refreshMapView",l.i.ERROR),!0}setMapType(Ye){this.mapOptions.mapType!=Ye&&(this.mapOptions.mapType=Ye,this.isMapReady()&&null!=this.mapProvider?(this.logging.log("Changing map type:"+Ye),this.mapProvider.setMapType(Ye)):this.logging.log("Map type set, maps not initialised yet."))}unfocusMap(){this.logging.log("[mapping] Unfocus Map."),this.isFocused=!1,this.mapProvider.unfocusMap()}focusMap(){this.logging.log("[mapping] Focus Map."),this.isFocused=!0,this.mapProvider.focusMap()}getMapBounds(){return this.mapProvider.getMapBounds()}getMapZoom(){return this.mapProvider.getMapZoom()}setMapZoom(Ye){this.mapProvider.setMapZoom(Ye)}getMapCenter(){return this.mapProvider.getMapCenter()}showPOIOnStaticMap(Ye,St,lt=!1,_e=!1,ke=200,Ne=200){let we=document.getElementById(Ye);if(null!=we){let We=St.AddressInfo.Latitude,ge=St.AddressInfo.Longitude;ke>640&&(ke=640),Ne>640&&(Ne=640);let de=ke,oe=Ne,Ee="https://maps.googleapis.com/maps/api/staticmap?center="+We+","+ge+"&zoom=14&size="+de+"x"+oe+"&maptype=roadmap&markers=color:blue%7Clabel:A%7C"+We+","+ge+"&sensor=false",vt="";vt+=1==lt?"<div>"+te.c.formatMapLink(St,'<div><img width="'+de+'" height="'+oe+'" src="'+Ee+'" /></div>',_e)+"</div>":'<div><img width="'+de+'" height="'+oe+'" src="'+Ee+'" /></div>',we.innerHTML=vt}}renderPolyline(Ye){this.mapProvider.renderPolyline(Ye)}clearPolyline(){this.mapProvider.clearPolyline()}clearMarkers(){this.logging.log("mapping: clearing markers"),this.mapProvider.clearMarkers()}addPOILayer(Ye){this.mapProvider.addPOILayer(Ye)}}return Oe.\u0275fac=function(Ye){return new(Ye||Oe)(xe.LFG(fe.z),xe.LFG(l.z),xe.LFG(ze.eN))},Oe.\u0275prov=xe.Yz7({token:Oe,factory:Oe.\u0275fac,providedIn:"root"}),Oe})()},5906:(Pn,Et,k)=>{"use strict";k.d(Et,{_:()=>te,b:()=>y});var d=k(2340),y=(()=>{return(l=y||(y={}))[l.GOOGLE_WEB=1]="GOOGLE_WEB",l[l.GOOGLE_NATIVE=2]="GOOGLE_NATIVE",l[l.LEAFLET=3]="LEAFLET",l[l.MAPBOX=4]="MAPBOX",l[l.MAPKIT_JS=5]="MAPKIT_JS",l[l.MAPTILER=6]="MAPTILER",y;var l})();class te{constructor(){this.enableClustering=!1,this.resultBatchID=-1,this.useMarkerIcons=!0,this.useMarkerAnimation=!0,this.enableTrackingMapCentre=!1,this.enableSearchByWatchingLocation=!1,this.mapCentre=null,this.mapAPI=d.N.defaultMapProvider,this.mapType="ROADMAP",this.searchDistanceKM=1e5,this.mapMoveQueryRefreshMS=300,this.enableSearchRadiusIndicator=!1,this.minZoomLevel=2}}},553:(Pn,Et,k)=>{"use strict";k.d(Et,{k:()=>le});var d=k(5861),y=k(6579),te=k(5906),l=k(9751),q=k(4120),re=k(7689),b=k(9898),Me=k(2340),Ve=k(4209),X=k(8274),xe=k(6260),fe=k(529);let le=(()=>{class Ke{constructor(Q,Ye,St){this.events=Q,this.logging=Ye,this.http=St,this._isMapAnimating=!1,this.events=Q,this.mapAPIType=te.b.MAPBOX,this.mapReady=!1,this.markerList=new Map}initAPI(){b&&(b.accessToken=Me.N.mapBoxToken)}disposeMap(){this.map&&(this.logging.log("Disposing map",re.i.INFO),this.map.remove())}getCurrentMapTileSet(Q){return"SATELLITE"==Q?"mapbox://styles/mapbox/satellite-streets-v12?optimize=true":"mapbox://styles/mapbox/streets-v12?optimize=true"}flyAroundPoint(Q){if(this._isMapAnimating){this.map.rotateTo(Q/100%360,{duration:0});const Ye=this;requestAnimationFrame(function(St){Ye.flyAroundPoint(St)})}}initMap(Q,Ye,St){this.mapCanvasID=Q;let lt=!0;if(lt=!(typeof b>"u"),!lt)return this.logging.log("Call to initMap before API is ready:"+te.b[this.mapAPIType],re.i.ERROR),this.mapReady=!1,!1;if(null==this.map){let we=function(We){return We*(2-We)};document.getElementById(Q),this.initAPI(),this.map=new b.Map({container:Q,style:this.getCurrentMapTileSet(Ye.mapType),zoom:15,attributionControl:!1}),this.map.addControl(new b.AttributionControl({compact:!0,customAttribution:["Open Charge Map Contributors"]})),this.map.addControl(new b.NavigationControl),this.mapReady=!0,this.map.getCanvas().focus();let ke=100,Ne=25;this.map.getCanvas().addEventListener("keydown",We=>{We.preventDefault(),38===We.which?this.map.panBy([0,-ke],{easing:we}):40===We.which?this.map.panBy([0,ke],{easing:we}):37===We.which?this.map.easeTo({bearing:this.map.getBearing()-Ne,easing:we}):39===We.which?this.map.easeTo({bearing:this.map.getBearing()+Ne,easing:we}):32===We.which&&(this._isMapAnimating?this._isMapAnimating=!1:(this._isMapAnimating=!0,this.flyAroundPoint(0)))},!0),this.map.on("load",()=>{this.events.publish("ocm:mapping:ready")});let Xe=y.c.debounce(()=>{this.getMapCenter().subscribe(We=>{this.searchMarker.setLngLat(new b.LngLat(We.coords.longitude,We.coords.latitude))})},500,!1);this.map.on("move",()=>{this.searchMarker&&Xe()}),this.map.on("moveend",()=>{this.events.publish("ocm:mapping:dragend"),Ye.onMapMoveCompleted&&Ye.onMapMoveCompleted()}),this.map.on("zoomend",()=>{this.events.publish("ocm:mapping:zoom")})}}clearMarkers(){null!=this.markerList&&this.markerList.forEach((Q,Ye)=>{Q.remove()}),this.markerList=new Map}showPOIListOnMap(Q,Ye,St=!0){let _e=this.map,ke=new b.LngLatBounds,Ne=0;if(_e.getZoom(),null!=Q){for(let de=0;de<Q.length;de++)if(null!=Q[de].AddressInfo&&null!=Q[de].AddressInfo.Latitude&&null!=Q[de].AddressInfo.Longitude){let oe=Q[de],Ee=!0;if(null!=this.markerList&&this.markerList.has(oe.ID)){Ee=!1;let vt=this.markerList.get(oe.ID);vt&&vt.poi&&vt.poi.DateLastStatusUpdate!=oe.DateLastStatusUpdate&&(vt.remove(),Ee=!0)}if(Ee){let vt=null,Tt=null;St?(vt=document.createElement("img"),vt.src=y.c.getIconForPOI(oe),vt.width=34,vt.height=50):(vt=null,Tt=y.c.getColorForPOI(oe));let Ot=(St?"OCM-":"EXT-")+oe.ID+": "+oe.AddressInfo.Title+":";null!=oe.UsageType&&(Ot+=" "+oe.UsageType.Title),null!=oe.StatusType&&(Ot+=" "+oe.StatusType.Title);let yt=new b.Marker({element:vt,color:Tt,anchor:"bottom"}).setLngLat([oe.AddressInfo.Longitude,oe.AddressInfo.Latitude]).addTo(_e);yt.poi=oe;let Mt=yt.getElement();Mt.poi=oe,Mt.addEventListener("click",gt=>{const it=gt.currentTarget.poi;this.events.publish("ocm:poi:selected",{poiId:it.ID,poi:it})}),ke.extend(yt.getLngLat()),this.markerList.set(oe.ID,yt),Ne++}}this.logging.log(Ne+" new map markers added out of a total "+this.markerList.size)}if(null!=Q&&Q.length>0)if(null==Ye||Ye.appConfig.enableLiveMapQuerying)null==_e.getCenter()&&_e.setCenter(ke.getCenter());else{this.logging.log("Fitting to marker bounds:"+ke),_e.setCenter(ke.getCenter()),this.logging.log("zoom before fit bounds:"+_e.getZoom()),_e.fitBounds(ke);let ge=_e.getZoom();_e.setZoom(ge<6?6:ge)}}refreshMapLayout(){null!=this.map&&setTimeout(()=>{this.logging.log("MapBoxGL: refreshMapLayout",re.i.VERBOSE),this.map.resize()},200)}setMapCenter(Q){this.mapReady&&(this.map.setCenter(new b.LngLat(Q.coords.longitude,Q.coords.latitude)),this.searchMarker||(this.searchMarker=new b.Marker({color:"#99ccff",anchor:"bottom"}).setLngLat(new b.LngLat(Q.coords.longitude,Q.coords.latitude)).addTo(this.map),this.searchMarker.getElement().addEventListener("click",()=>{let Ye=this.searchMarker.getLngLat();this.events.publish("ocm:mapping:addpoi",new q.wC(Ye.lat,Ye.lng))})))}getMapCenter(){return new l.y(Ye=>{if(null!=this.map){let St=this.map.getCenter();null!=St&&(Ye.next(new q.jR(St.lat,St.lng)),Ye.complete())}})}setMapZoom(Q){this.map.setZoom(Q)}getMapZoom(){return new l.y(Ye=>{let St=this.map.getZoom();Ye.next(St),Ye.complete()})}setMapType(Q){this.map.setStyle(this.getCurrentMapTileSet(Q))}getMapBounds(){return new l.y(Ye=>{let St=new Array,lt=this.map.getBounds();St.push(new q.wC(lt.getSouthWest().lat,lt.getSouthWest().lng)),St.push(new q.wC(lt.getNorthEast().lat,lt.getNorthEast().lng)),Ye.next(St),Ye.complete()})}moveToMapBounds(Q){this.map.fitBounds(new b.LngLatBounds(new b.LngLat(Q.southWest.longitude,Q.southWest.latitude),new b.LngLat(Q.northEast.longitude,Q.northEast.latitude)))}renderMap(Q,Ye,St){return document.getElementById(this.mapCanvasID).style.height=Ye+"px",this.mapReady&&this.showPOIListOnMap(Q,St),!0}renderPolyline(Q){this.clearPolyline()}clearPolyline(){null!=this.polylinePath&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(Q,Ye,St){var lt=this;return(0,d.Z)(function*(){let _e=`https://api.mapbox.com/geocoding/v5/mapbox.places/${Q||St+","+Ye}.json?access_token=${Me.N.mapBoxToken}`;return new Promise(function(){var ke=(0,d.Z)(function*(Ne,we){lt.http.get(_e).toPromise().then(Xe=>{let We=[];We=[],Xe.features&&Xe.features.map(ge=>{let de=new Ve.n;de.Title=ge.place_name,de.Address=ge.place_name,de.Type="place",de.Location=new q.wC(ge.center[1],ge.center[0]),de.Attribution=Xe.attribution,We.push(de)}),Ne(We)})});return function(Ne,we){return ke.apply(this,arguments)}}())})()}addPOILayer(Q){this.logging.log("Add POI Layer not implemented in this provider."),this.showPOIListOnMap(Q,null,!1)}}return Ke.\u0275fac=function(Q){return new(Q||Ke)(X.LFG(xe.z),X.LFG(re.z),X.LFG(fe.eN))},Ke.\u0275prov=X.Yz7({token:Ke,factory:Ke.\u0275fac}),Ke})()},2340:(Pn,Et,k)=>{"use strict";k.d(Et,{N:()=>d});const d={name:"prod",version:"8.5.0",production:!0,analyticsId:"",googleMapsKey:"",mapBoxToken:"pk.eyJ1Ijoid2VicHJvZnVzaW9uIiwiYSI6ImNrdHZlc2N5dTI5Zjcydm8zYWFwc2JnbTMifQ.M7b5SOzbPcg_8XAHCOeP0w",mapKitToken:"",enableStaticMaps:!1,defaultMapProvider:4,apiBase:"https://api.openchargemap.io",apiKey:"9bb03e5b-0fb2-4916-9b2b-26c6bd27a56a",enabledFeatures:["MAP","ADD_COMMENT","ADD_PHOTO","FAVOURITES","FILTER_OPTIONS_BY_COUNTRY","ADD_POI","EDIT_POI","LAYERS"]}},659:(Pn,Et,k)=>{"use strict";var d=k(1481),y=k(8274),te=k(8936),l=k(4463),q=k(6895),re=k(4006),b=k(425);let he=(()=>{class Zt{}return Zt.\u0275fac=function(He){return new(He||Zt)},Zt.\u0275mod=y.oAB({type:Zt}),Zt.\u0275inj=y.cJS({imports:[q.ez,re.u5,b.Pc,l.aw,te.e]}),Zt})(),Me=(()=>{class Zt{}return Zt.\u0275fac=function(He){return new(He||Zt)},Zt.\u0275mod=y.oAB({type:Zt}),Zt.\u0275inj=y.cJS({imports:[q.ez,re.u5,b.Pc,l.aw,te.e]}),Zt})(),Ve=(()=>{class Zt{}return Zt.\u0275fac=function(He){return new(He||Zt)},Zt.\u0275mod=y.oAB({type:Zt}),Zt.\u0275inj=y.cJS({imports:[q.ez,re.u5,b.Pc,l.aw,te.e]}),Zt})();var X=k(3548),xe=k(529),fe=k(4228),ze=k(3175);class le{constructor(It,He="/assets/i18n/",ne=".json"){this.http=It,this.prefix=He,this.suffix=ne}getTranslation(It){return this.http.get(`${this.prefix}${It}${this.suffix}`)}}var Ke=k(5861),Oe=k(4781),Q=k(6763),Ye=k(9492),St=k(9741),lt=k(3855);function _e(Zt,It){if(1&Zt){const He=y.EpF();y.TgZ(0,"div"),y._uU(1," You are not signed in. "),y.TgZ(2,"button",5),y.NdJ("click",function(){y.CHM(He);const Je=y.oxw();return y.KtG(Je.showSignInModal())}),y._uU(3),y.ALo(4,"translate"),y.qZA()()}2&Zt&&(y.xp6(3),y.Oqu(y.lcZ(4,1,"ocm.general.signIn")))}function ke(Zt,It){if(1&Zt&&(y.TgZ(0,"div")(1,"ion-card")(2,"ion-item")(3,"ion-avatar",6),y._UZ(4,"img",7),y.qZA(),y.TgZ(5,"h2"),y._uU(6),y.qZA()(),y.TgZ(7,"ion-card-content")(8,"p"),y._uU(9),y.qZA(),y.TgZ(10,"p"),y._uU(11),y.qZA()(),y.TgZ(12,"ion-item")(13,"ion-note",8),y._UZ(14,"ion-icon",9),y._uU(15),y.qZA()()()()),2&Zt){const He=y.oxw();y.xp6(4),y.s9C("src",He.userProfile.ProfileImageURL,y.LSH),y.xp6(2),y.Oqu(He.userProfile.Username),y.xp6(3),y.hij(" ",He.userProfile.Profile,""),y.xp6(2),y.hij(" Date Joined: ",He.userProfile.DateCreated," "),y.xp6(4),y.hij(" ",He.userProfile.ReputationPoints," Contributor Points ")}}let Ne=(()=>{class Zt{constructor(He,ne,Je,jt){this.appManager=He,this.nav=ne,this.translate=Je,this.modalController=jt}ionViewDidEnter(){this.userProfile=this.appManager.getUserProfile(),null!=this.userProfile&&this.appManager.isUserAuthenticated(!0)?this.refreshProfileView():this.showSignInModal(),this.appManager.analytics.viewEvent("Profile")}refreshProfileView(){this.userProfile=this.appManager.getUserProfile()}showSignInModal(){this.modalController.create({component:Ye.F,componentProps:{Profile:this.userProfile}}).then(He=>{He.onDidDismiss().then(()=>{this.refreshProfileView()}),He.present()})}close(){this.modalController.dismiss()}}return Zt.\u0275fac=function(He){return new(He||Zt)(y.Y36(lt.c),y.Y36(b.SH),y.Y36(l.sK),y.Y36(b.IN))},Zt.\u0275cmp=y.Xpm({type:Zt,selectors:[["ng-component"]],decls:14,vars:5,consts:[[1,"profile-page","ion-padding"],[4,"ngIf"],["slot","end"],[3,"click"],["name","close","slot","start"],["ion-button","",3,"click"],["slot","start"],[3,"src"],["item-left",""],["name","star"]],template:function(He,ne){1&He&&(y.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),y._uU(3),y.ALo(4,"translate"),y.qZA()()(),y.TgZ(5,"ion-content",0),y.YNc(6,_e,5,3,"div",1),y.YNc(7,ke,16,5,"div",1),y.qZA(),y.TgZ(8,"ion-footer")(9,"ion-toolbar")(10,"ion-buttons",2)(11,"ion-button",3),y.NdJ("click",function(){return ne.close()}),y._UZ(12,"ion-icon",4),y._uU(13," Close "),y.qZA()()()()),2&He&&(y.xp6(3),y.hij(" ",y.lcZ(4,3,"ocm.navigation.profile.sectionTitle")," "),y.xp6(3),y.Q6J("ngIf",null==ne.userProfile),y.xp6(1),y.Q6J("ngIf",null!=ne.userProfile))},dependencies:[q.O5,b.BJ,b.YG,b.Sm,b.PM,b.FN,b.W2,b.fr,b.Gu,b.gu,b.Ie,b.uN,b.wd,b.sr,l.X$],encapsulation:2}),Zt})();var we=k(7689),Xe=k(2340),We=k(4508),ge=k(56),de=k(6579),oe=k(388),Ee=k(6588),vt=k(7423);const Tt=(0,vt.fo)("PushNotifications",{}),Gt=(0,vt.fo)("StatusBar"),Ot=(0,vt.fo)("SplashScreen",{web:()=>k.e(2680).then(k.bind(k,2680)).then(Zt=>new Zt.SplashScreenWeb)}),yt=(0,vt.fo)("App",{web:()=>k.e(4477).then(k.bind(k,4477)).then(Zt=>new Zt.AppWeb)});var Mt=k(6260);function gt(Zt,It){if(1&Zt){const He=y.EpF();y.TgZ(0,"ion-item",9),y.NdJ("click",function(){y.CHM(He);const Je=y.oxw();return y.KtG(Je.openRoutePlannerModal())}),y._UZ(1,"ion-icon",12),y.TgZ(2,"ion-label"),y._uU(3," Route Planner "),y.qZA()()}}function it(Zt,It){if(1&Zt){const He=y.EpF();y.TgZ(0,"ion-item",9),y.NdJ("click",function(){y.CHM(He);const Je=y.oxw();return y.KtG(Je.add())}),y._UZ(1,"ion-icon",13),y.TgZ(2,"ion-label"),y._uU(3),y.ALo(4,"translate"),y.qZA()()}2&Zt&&(y.xp6(3),y.hij(" ",y.lcZ(4,1,"ocm.general.addLocation")," "))}function at(Zt,It){if(1&Zt){const He=y.EpF();y.TgZ(0,"ion-item",9),y.NdJ("click",function(){y.CHM(He);const Je=y.oxw();return y.KtG(Je.journeys())}),y._UZ(1,"ion-icon",12),y.TgZ(2,"ion-label"),y._uU(3," Journeys "),y.qZA()()}}function Ce(Zt,It){if(1&Zt){const He=y.EpF();y.TgZ(0,"ion-item",9),y.NdJ("click",function(){y.CHM(He);const Je=y.oxw();return y.KtG(Je.addLayer())}),y._UZ(1,"ion-icon",14),y.TgZ(2,"ion-label"),y._uU(3," Add Layer "),y.qZA()()}}function bt(Zt,It){if(1&Zt){const He=y.EpF();y.ynx(0),y.TgZ(1,"ion-item",9),y.NdJ("click",function(){y.CHM(He);const Je=y.oxw();return y.KtG(Je.signIn())}),y._UZ(2,"ion-icon",15),y.TgZ(3,"ion-label"),y._uU(4),y.ALo(5,"translate"),y.qZA()(),y.BQk()}2&Zt&&(y.xp6(4),y.hij(" ",y.lcZ(5,1,"ocm.general.signIn")," "))}function kt(Zt,It){if(1&Zt){const He=y.EpF();y.ynx(0),y.TgZ(1,"ion-item",9),y.NdJ("click",function(){y.CHM(He);const Je=y.oxw();return y.KtG(Je.profile())}),y._UZ(2,"ion-icon",15),y.TgZ(3,"ion-label"),y._uU(4),y.ALo(5,"translate"),y.qZA()(),y.TgZ(6,"ion-item",9),y.NdJ("click",function(){y.CHM(He);const Je=y.oxw();return y.KtG(Je.signOut())}),y._UZ(7,"ion-icon",16),y.TgZ(8,"ion-label"),y._uU(9),y.ALo(10,"translate"),y._UZ(11,"br"),y.TgZ(12,"small",17),y._uU(13),y.qZA()()(),y.BQk()}if(2&Zt){const He=y.oxw();y.xp6(4),y.hij(" ",y.lcZ(5,3,"ocm.navigation.profile.sectionTitle")," "),y.xp6(5),y.hij(" ",y.lcZ(10,5,"ocm.general.signOut")," "),y.xp6(4),y.hij(" ",He.getUserName(),"")}}const Vt=function(){return["/search"]};let yn=(()=>{class Zt{constructor(He,ne,Je,jt,Qt,li,Ii,tr){this.platform=He,this.translate=ne,this.mapping=Je,this.modalController=jt,this.appManager=Qt,this.logger=li,this.analytics=Ii,this.events=tr,this.logger.log("Environment: "+Xe.N.name),this.initializeApp(),this.enabledFeatures=Xe.N.enabledFeatures,1!=Qt.searchSettings.EnableAdvancedEditorFeatures&&(this.enabledFeatures=this.enabledFeatures.filter(fi=>"LAYERS"!=fi))}configurePushNotifications(){Tt.register(),Tt.addListener("registration",He=>{this.logger.log("Push registration success, token: "+He.value),this.appManager.savePushRegistration(He.value)}),Tt.addListener("registrationError",He=>{this.logger.log("Error on registration: "+JSON.stringify(He))}),Tt.addListener("pushNotificationReceived",He=>{this.logger.log("Push received: "+JSON.stringify(He),we.i.INFO)}),Tt.addListener("pushNotificationActionPerformed",He=>{this.logger.log("Push action performed: "+JSON.stringify(He))})}isUserAuthenticated(){return this.appManager.isUserAuthenticated()}getUserName(){let He=this.appManager.getUserProfile();return He?He.EmailAddress?He.EmailAddress:He.Username:"Not Signed In"}initializeApp(){var He=this;this.platform.ready().then(()=>{this.platform.is("capacitor")&&(Gt.show(),Ot.hide()),this.translate.addLangs(this.appManager.getLanguages().map(ne=>ne.code)),this.translate.setDefaultLang("en"),null!=this.appManager.searchSettings.Language?this.translate.use(this.appManager.searchSettings.Language):this.translate.currentLang||this.translate.use("en"),this.translate.get("ocm.search.performSearch").toPromise().then(ne=>{}),this.analytics.init(Xe.N.analyticsId).then(()=>{this.analytics.setAppVersion(Xe.N.version),this.analytics.appEvent("Startup","App Loaded")}).catch(ne=>this.logger.log("Error starting analytics")),this.events.subscribe("ocm:mapping:addpoi",function(){var ne=(0,Ke.Z)(function*(Je){de.c.isFeatureEnabled("ADD_POI")&&He.add(Je)});return function(Je){return ne.apply(this,arguments)}}()),(this.platform.is("ios")||this.platform.is("android"))&&(this.configurePushNotifications(),this.checkForAppOpenUrl())})}checkForAppOpenUrl(){return(0,Ke.Z)(function*(){yt.addListener("appUrlOpen",ne=>{alert("App (re)opened with URL: "+ne.url)});let He=yield yt.getLaunchUrl();He&&He.url&&alert("App opened with URL: "+He.url)})()}openRoutePlannerModal(){var He=this;return(0,Ke.Z)(function*(){He.mapping.unfocusMap();const ne=yield He.modalController.create({component:Q.u});ne.onDidDismiss().then(Je=>{He.mapping.focusMap()}),yield ne.present()})()}continueAdd(He){var ne=this;return(0,Ke.Z)(function*(){const Je=yield ne.modalController.create({component:We.Y,componentProps:{startPos:He}});Je.onDidDismiss().then(jt=>{ne.mapping.focusMap()}),yield Je.present()})()}add(He){var ne=this;return(0,Ke.Z)(function*(){if(ne.mapping.unfocusMap(),!ne.appManager.isUserAuthenticated(!0)){const Je=yield ne.modalController.create({component:Ye.F});return Je.onDidDismiss().then(function(){var jt=(0,Ke.Z)(function*(Qt){ne.mapping.focusMap(),ne.appManager.isUserAuthenticated(!0)&&(yield ne.continueAdd(He))});return function(Qt){return jt.apply(this,arguments)}}()),yield Je.present()}yield ne.continueAdd(He)})()}signIn(){var He=this;return(0,Ke.Z)(function*(){He.mapping.unfocusMap();const ne=yield He.modalController.create({component:Ye.F});return ne.onDidDismiss().then(Je=>{He.mapping.focusMap(),He.appManager.isUserAuthenticated(!0)}),yield ne.present()})()}signOut(){var He=this;return(0,Ke.Z)(function*(){He.appManager.signOutCurrentUser()})()}profile(){var He=this;return(0,Ke.Z)(function*(){He.mapping.unfocusMap();const ne=yield He.modalController.create({component:Ne});ne.onDidDismiss().then(Je=>{He.mapping.focusMap()}),yield ne.present()})()}journeys(){var He=this;return(0,Ke.Z)(function*(){He.mapping.unfocusMap();const ne=yield He.modalController.create({component:St.g});ne.onDidDismiss().then(Je=>{He.mapping.focusMap()}),yield ne.present()})()}addLayer(){var He=this;return(0,Ke.Z)(function*(){const ne=yield He.modalController.create({component:Ee.A});yield ne.present();const{data:Je}=yield ne.onWillDismiss();Je&&He.mapping.addPOILayer(Je)})()}about(){var He=this;return(0,Ke.Z)(function*(){He.mapping.unfocusMap();const ne=yield He.modalController.create({component:oe.t});ne.onDidDismiss().then(Je=>{He.mapping.focusMap()}),yield ne.present()})()}}return Zt.\u0275fac=function(He){return new(He||Zt)(y.Y36(b.t4),y.Y36(l.sK),y.Y36(Oe.v),y.Y36(b.IN),y.Y36(lt.c),y.Y36(we.z),y.Y36(ge.c),y.Y36(Mt.z))},Zt.\u0275cmp=y.Xpm({type:Zt,selectors:[["app-root"]],decls:29,vars:17,consts:[["contentId","main-content",3,"disabled"],["contentId","main-content","swipeGesture","false"],["slot","start"],["src","assets/images/icons/branding/AppIcon_128x128.png"],["auto-hide","false"],[3,"routerDirection","routerLink"],["slot","start","name","home"],[3,"click",4,"ngIf"],[4,"ngIf"],[3,"click"],["slot","start","name","information-circle-outline"],["id","main-content"],["slot","start","name","map"],["slot","start","name","add-circle-outline"],["slot","start","name","albums"],["slot","start","name","person"],["slot","start","name","log-out"],[2,"color","#c0c0c0"]],template:function(He,ne){1&He&&(y.TgZ(0,"ion-app")(1,"ion-split-pane",0)(2,"ion-menu",1)(3,"ion-header")(4,"ion-toolbar")(5,"ion-thumbnail",2),y._UZ(6,"img",3),y.qZA(),y.TgZ(7,"ion-title"),y._uU(8),y.qZA()()(),y.TgZ(9,"ion-content")(10,"ion-list")(11,"ion-menu-toggle",4)(12,"ion-item",5),y._UZ(13,"ion-icon",6),y.TgZ(14,"ion-label"),y._uU(15),y.ALo(16,"translate"),y.qZA()(),y.YNc(17,gt,4,0,"ion-item",7),y.YNc(18,it,5,3,"ion-item",7),y.YNc(19,at,4,0,"ion-item",7),y.YNc(20,Ce,4,0,"ion-item",7),y.YNc(21,bt,6,3,"ng-container",8),y.YNc(22,kt,14,7,"ng-container",8),y.TgZ(23,"ion-item",9),y.NdJ("click",function(){return ne.about()}),y._UZ(24,"ion-icon",10),y.TgZ(25,"ion-label"),y._uU(26),y.ALo(27,"translate"),y.qZA()()()()()(),y._UZ(28,"ion-router-outlet",11),y.qZA()()),2&He&&(y.xp6(1),y.Q6J("disabled",!0),y.xp6(7),y.Oqu(ne.appManager.title),y.xp6(4),y.Q6J("routerDirection","root")("routerLink",y.DdM(16,Vt)),y.xp6(3),y.hij(" ",y.lcZ(16,12,"ocm.search.sectionTitle")," "),y.xp6(2),y.Q6J("ngIf",ne.enabledFeatures.includes("ROUTE_PLANNER")),y.xp6(1),y.Q6J("ngIf",ne.enabledFeatures.includes("ADD_POI")),y.xp6(1),y.Q6J("ngIf",ne.enabledFeatures.includes("FAVOURITES")),y.xp6(1),y.Q6J("ngIf",ne.enabledFeatures.includes("LAYERS")),y.xp6(1),y.Q6J("ngIf",!ne.isUserAuthenticated()),y.xp6(1),y.Q6J("ngIf",ne.isUserAuthenticated()),y.xp6(4),y.hij(" ",y.lcZ(27,14,"ocm.general.about")," "))},dependencies:[q.O5,b.dr,b.W2,b.Gu,b.gu,b.Ie,b.Q$,b.q_,b.z0,b.zc,b.jI,b.Bs,b.wd,b.sr,b.jP,b.YI,fe.rH,l.X$],encapsulation:2}),Zt})();const Fn=[{path:"",redirectTo:"search",pathMatch:"full"},{path:"search",loadChildren:()=>Promise.resolve().then(k.bind(k,3548)).then(Zt=>Zt.SearchPageModule)},{path:"journeys",loadChildren:()=>Promise.resolve().then(k.bind(k,5476)).then(Zt=>Zt.JourneysModule)},{path:"signin",loadChildren:()=>Promise.resolve().then(k.bind(k,6779)).then(Zt=>Zt.SignInModule)},{path:"poi-editor/:id",loadChildren:()=>Promise.resolve().then(k.bind(k,1948)).then(Zt=>Zt.PoiEditorPageModule)},{path:"about",loadChildren:()=>Promise.resolve().then(k.bind(k,534)).then(Zt=>Zt.AboutPageModule)},{path:"layer-editor",loadChildren:()=>Promise.resolve().then(k.bind(k,5005)).then(Zt=>Zt.LayerEditorPageModule)}];let cn=(()=>{class Zt{}return Zt.\u0275fac=function(He){return new(He||Zt)},Zt.\u0275mod=y.oAB({type:Zt}),Zt.\u0275inj=y.cJS({imports:[fe.Bz.forRoot(Fn,{useHash:!0}),fe.Bz]}),Zt})(),ot=(()=>{class Zt{}return Zt.\u0275fac=function(He){return new(He||Zt)},Zt.\u0275mod=y.oAB({type:Zt}),Zt.\u0275inj=y.cJS({imports:[q.ez,re.u5,b.Pc,l.aw,te.e]}),Zt})();var Nt=k(6779);let bn=(()=>{class Zt{}return Zt.\u0275fac=function(He){return new(He||Zt)},Zt.\u0275mod=y.oAB({type:Zt}),Zt.\u0275inj=y.cJS({imports:[q.ez,re.u5,b.Pc,l.aw,te.e,fe.Bz.forChild([{path:"",component:Ne}])]}),Zt})();var Kn=k(6314);let ri=(()=>{class Zt{}return Zt.\u0275fac=function(He){return new(He||Zt)},Zt.\u0275mod=y.oAB({type:Zt}),Zt.\u0275inj=y.cJS({imports:[q.ez,re.u5,b.Pc,l.aw,te.e,fe.Bz.forChild([{path:"",component:Kn.N}])]}),Zt})();var Bn=k(5476),pi=k(1948),bi=k(534),vi=k(5005);function Li(){return localStorage.getItem("access_token")}function Si(Zt){return new le(Zt,"/assets/i18n/",".json")}let Yi=(()=>{class Zt{}return Zt.\u0275fac=function(He){return new(He||Zt)},Zt.\u0275mod=y.oAB({type:Zt,bootstrap:[yn]}),Zt.\u0275inj=y.cJS({providers:[{provide:fe.wN,useClass:b.r4}],imports:[d.b2,xe.JF,l.aw.forRoot({loader:{provide:l.Zw,useFactory:Si,deps:[xe.eN]}}),b.Pc.forRoot(),cn,ze.Ar.forRoot({config:{tokenGetter:Li}}),X.SearchPageModule,ot,Bn.JourneysModule,Nt.SignInModule,Ve,he,Me,pi.PoiEditorPageModule,bn,ri,bi.AboutPageModule,vi.LayerEditorPageModule]}),Zt})();Xe.N.production&&(0,y.G48)(),d.q6().bootstrapModule(Yi).catch(Zt=>console.log(Zt))},9898:function(Pn){Pn.exports=function(){"use strict";var Et,k,d;function y(l,q){if(Et)if(k){var re="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Et+")(sharedChunk); ("+k+")(sharedChunk); self.onerror = null;",b={};Et(b),d=q(b),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([re],{type:"text/javascript"})))}else k=q;else Et=q}return y(0,function(l){var q=typeof self<"u"?self:{},re="2.12.1";let b;const he={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==b){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{b=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{b=t}}return b},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Me={supported:!1,testSupport:function(t){!xe&&X&&(fe?ze(t):Ve=t)}};let Ve,X,xe=!1,fe=!1;function ze(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,X),t.isContextLost())return;Me.supported=!0}catch{}t.deleteTexture(e),xe=!0}q.document&&(X=q.document.createElement("img"),X.onload=function(){Ve&&ze(Ve),Ve=null,fe=!0},X.onerror=function(){xe=!0,Ve=null},X.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const le="01";var Ke=Oe;function Oe(t,e,n,s){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=s}Oe.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,s=0;s<8;s++){var h=this.sampleCurveX(n)-t;if(Math.abs(h)<e)return n;var _=this.sampleCurveDerivativeX(n);if(Math.abs(_)<1e-6)break;n-=h/_}var x=0,T=1;for(n=t,s=0;s<20&&(h=this.sampleCurveX(n),!(Math.abs(h-t)<e));s++)t>h?x=n:T=n,n=.5*(T-x)+x;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Q=Ye;function Ye(t,e){this.x=t,this.y=e}Ye.prototype={clone:function(){return new Ye(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(t,e){var n=Math.cos(t),s=Math.sin(t),h=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ye.convert=function(t){return t instanceof Ye?t:Array.isArray(t)?new Ye(t[0],t[1]):t};const St=Math.PI/180,lt=180/Math.PI;function _e(t){return t*St}function ke(t){return t*lt}const Ne=[[0,0],[1,0],[1,1],[0,1]];function we(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Xe(t,e,n,s){const h=new Ke(t,e,n,s);return function(_){return h.solve(_)}}const We=Xe(.25,.1,.25,1);function ge(t,e,n){return Math.min(n,Math.max(e,t))}function de(t,e,n){return(n=ge((n-t)/(e-t),0,1))*n*(3-2*n)}function oe(t,e,n){const s=n-e,h=((t-e)%s+s)%s+e;return h===e?n:h}function Ee(t,e,n){if(!t.length)return n(null,[]);let s=t.length;const h=new Array(t.length);let _=null;t.forEach((x,T)=>{e(x,(I,A)=>{I&&(_=I),h[T]=A,0==--s&&n(_,h)})})}function vt(t){const e=[];for(const n in t)e.push(t[n]);return e}function Tt(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}let Gt=1;function Ot(){return Gt++}function yt(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Mt(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function gt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function it(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function at(t,e){return-1!==t.indexOf(e,t.length-e.length)}function Ce(t,e,n){const s={};for(const h in t)s[h]=e.call(n||this,t[h],h,t);return s}function bt(t,e,n){const s={};for(const h in t)e.call(n||this,t[h],h,t)&&(s[h]=t[h]);return s}function kt(t){return Array.isArray(t)?t.map(kt):"object"==typeof t&&t?Ce(t,kt):t}const Vt={};function yn(t){Vt[t]||(typeof console<"u"&&console.warn(t),Vt[t]=!0)}function Fn(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function cn(t){let e=0;for(let n,s,h=0,_=t.length,x=_-1;h<_;x=h++)n=t[h],s=t[x],e+=(s.x-n.x)*(n.y+s.y);return e}function ot(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Nt(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,h,_)=>{const x=h||_;return e[s]=!x||x.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let bn=null;function Kn(t){if(null==bn){const e=t.navigator?t.navigator.userAgent:null;bn=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return bn}function ri(t){try{const e=q[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Bn(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const pi="mapbox-tiles";let bi,vi,Li=500,Si=50;function Fi(){try{return q.caches}catch{}}function Yi(){Fi()&&!bi&&(bi=q.caches.open(pi))}function Zt(t){const e=t.indexOf("?");if(e<0)return t;const s=function(h){const _=h.indexOf("?");return _>0?h.slice(_+1).split("&"):[]}(t).filter(h=>{const _=h.split("=");return"language"===_[0]||"worldview"===_[0]});return s.length?`${t.slice(0,e)}?${s.join("&")}`:t.slice(0,e)}let It=1/0;const He={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(He);class ne extends Error{constructor(e,n,s){401===n&&wr(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Je=ot()?()=>self.worker&&self.worker.referrer:()=>("blob:"===q.location.protocol?q.parent:q).location.href,jt=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Je())&&!/^\w+:/.test(n))){if(q.fetch&&q.Request&&q.AbortController&&q.Request.prototype.hasOwnProperty("signal"))return function(s,h){const _=new q.AbortController,x=new q.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Je(),signal:_.signal});let T=!1,I=!1;const A=(L=x.url).indexOf("sku=")>0&&wr(L);var L;"json"===s.type&&x.headers.set("Accept","application/json");const N=(J,ee,pe)=>{if(I)return;if(J&&"SecurityError"!==J.message&&yn(J),ee&&pe)return Z(ee);const Pe=Date.now();q.fetch(x).then(Qe=>{if(Qe.ok){const ut=A?Qe.clone():null;return Z(Qe,ut,Pe)}return h(new ne(Qe.statusText,Qe.status,s.url))}).catch(Qe=>{20!==Qe.code&&h(new Error(Qe.message))})},Z=(J,ee,pe)=>{("arrayBuffer"===s.type?J.arrayBuffer():"json"===s.type?J.json():J.text()).then(Pe=>{I||(ee&&pe&&function(Qe,ut,et){if(Yi(),!bi)return;const st={status:ut.status,statusText:ut.statusText,headers:new q.Headers};ut.headers.forEach((Kt,qt)=>st.headers.set(qt,Kt));const Ct=Nt(ut.headers.get("Cache-Control")||"");if(Ct["no-store"])return;Ct["max-age"]&&st.headers.set("Expires",new Date(et+1e3*Ct["max-age"]).toUTCString());const mt=st.headers.get("Expires");mt&&(new Date(mt).getTime()-et<42e4||function(Kt,qt){if(void 0===vi)try{new Response(new ReadableStream),vi=!0}catch{vi=!1}vi?qt(Kt.body):Kt.blob().then(qt)}(ut,Kt=>{const qt=new q.Response(Kt,st);Yi(),bi&&bi.then(mn=>mn.put(Zt(Qe.url),qt)).catch(mn=>yn(mn.message))}))}(x,ee,pe),T=!0,h(null,Pe,J.headers.get("Cache-Control"),J.headers.get("Expires")))}).catch(Pe=>{I||h(new Error(Pe.message))})};return A?function(J,ee){if(Yi(),!bi)return ee(null);const pe=Zt(J.url);bi.then(Pe=>{Pe.match(pe).then(Qe=>{const ut=function(et){if(!et)return!1;const st=new Date(et.headers.get("Expires")||0),Ct=Nt(et.headers.get("Cache-Control")||"");return st>Date.now()&&!Ct["no-cache"]}(Qe);Pe.delete(pe),ut&&Pe.put(pe,Qe.clone()),ee(null,Qe,ut)}).catch(ee)}).catch(ee)}(x,N):N(null,null),{cancel:()=>{I=!0,T||_.abort()}}}(t,e);if(ot()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(s,h){const _=new q.XMLHttpRequest;_.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(_.responseType="arraybuffer");for(const x in s.headers)_.setRequestHeader(x,s.headers[x]);return"json"===s.type&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials="include"===s.credentials,_.onerror=()=>{h(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||0===_.status)&&null!==_.response){let x=_.response;if("json"===s.type)try{x=JSON.parse(_.response)}catch(T){return h(T)}h(null,x,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else h(new ne(_.statusText,_.status,s.url))},_.send(s.body),{cancel:()=>_.abort()}}(t,e)},Qt=function(t,e){return jt(Tt(t,{type:"arrayBuffer"}),e)};function li(t){const e=q.document.createElement("a");return e.href=t,e.protocol===q.document.location.protocol&&e.host===q.document.location.host}const Ii="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let tr,fi;tr=[],fi=0;const yr=function(t,e){if(Me.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),fi>=he.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return tr.push(_),_}fi++;let n=!1;const s=()=>{if(!n)for(n=!0,fi--;tr.length&&fi<he.MAX_PARALLEL_IMAGE_REQUESTS;){const _=tr.shift(),{requestParameters:x,callback:T,cancelled:I}=_;I||(_.cancel=yr(x,T).cancel)}},h=Qt(t,(_,x,T,I)=>{s(),_?e(_):x&&(q.createImageBitmap?function(A,L){const N=new q.Blob([new Uint8Array(A)],{type:"image/png"});q.createImageBitmap(N).then(Z=>{L(null,Z)}).catch(Z=>{L(new Error(`Could not load image because of ${Z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(A,L)=>e(A,L,T,I)):function(A,L){const N=new q.Image,Z=q.URL;N.onload=()=>{L(null,N),Z.revokeObjectURL(N.src),N.onload=null,q.requestAnimationFrame(()=>{N.src=Ii})},N.onerror=()=>L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const J=new q.Blob([new Uint8Array(A)],{type:"image/png"});N.src=A.byteLength?Z.createObjectURL(J):Ii}(x,(A,L)=>e(A,L,T,I)))});return{cancel:()=>{h.cancel(),s()}}},Ai="NO_ACCESS_TOKEN";function fr(t){return 0===t.indexOf("mapbox:")}function wr(t){return he.API_URL_REGEX.test(t)}function Cr(t){return he.API_CDN_URL_REGEX.test(t)}function si(t){return he.API_STYLE_REGEX.test(t)&&!dn(t)}function dn(t){return he.API_SPRITE_REGEX.test(t)}const wt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Pt(t){const e=t.match(wt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function gn(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function Ue(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(q.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class se{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=Ue(he.ACCESS_TOKEN);let s="";return s=n&&n.u?q.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(h,_)=>String.fromCharCode(Number("0x"+_)))):he.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=ri("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const h=q.localStorage.getItem(n);h&&(this.eventData=JSON.parse(h));const _=q.localStorage.getItem(s);_&&(this.anonId=_)}catch{yn("Unable to read from LocalStorage")}}saveEventData(){const e=ri("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{q.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&q.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{yn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,s,h){if(!he.EVENTS_URL)return;const _=Pt(he.EVENTS_URL);_.params.push(`access_token=${h||he.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(e).toISOString()},T=n?Tt(x,n):x,I={url:gn(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([T])};var L;this.pendingRequest=(L=A=>{this.pendingRequest=null,s(A),this.saveEventData(),this.processRequests(h)},jt(Tt(I,{method:"POST"}),L))}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const R=new class extends se{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){he.EVENTS_URL&&he.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>fr(n)||wr(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ue(he.ACCESS_TOKEN),n=e?e.u:he.ACCESS_TOKEN;let s=n!==this.eventData.tokenU;gt(this.anonId)||(this.anonId=yt(),s=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),x=new Date(h),T=(h-this.eventData.lastSuccess)/864e5;s=s||T>=1||T<-1||_.getDate()!==x.getDate()}else s=!0;s?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:re,skuId:le,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=h,this.eventData.tokenU=n)},t):this.processRequests()}},z=R.postTurnstileEvent.bind(R),ce=new class extends se{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,s){this.skuToken=e,this.errorCb=s,he.EVENTS_URL&&(n||he.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Ai)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),gt(this.anonId)||(this.anonId=yt()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:re,skuId:le,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}},Be=ce.postMapLoadEvent.bind(ce),tt=new class extends se{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){he.EVENTS_URL&&(t||he.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:n}=this.queue.shift(),s=function(h){const _=q.performance.getEntriesByType("resource"),x=q.performance.getEntriesByType("mark"),T=function(Z){const J={};if(Z)for(const ee in Z)if("other"!==ee)for(const pe of Z[ee]){const Pe=`${ee}ResolveRangeMin`,Qe=`${ee}ResolveRangeMax`,ut=`${ee}RequestCount`,et=`${ee}RequestCachedCount`;J[Pe]=Math.min(J[Pe]||1/0,pe.startTime),J[Qe]=Math.max(J[Qe]||-1/0,pe.responseEnd);const st=Ct=>{void 0===J[Ct]&&(J[Ct]=0),++J[Ct]};void 0!==pe.transferSize&&0===pe.transferSize&&st(et),st(ut)}return J}(function(Z,J){const ee={};if(Z)for(const pe of Z){const Pe=J(pe);void 0===ee[Pe]&&(ee[Pe]=[]),ee[Pe].push(pe)}return ee}(_,pt)),I=q.devicePixelRatio,A=q.navigator.connection||q.navigator.mozConnection||q.navigator.webkitConnection,L={counters:[],metadata:[],attributes:[]},N=(Z,J,ee)=>{null!=ee&&Z.push({name:J,value:ee.toString()})};for(const Z in T)N(L.counters,Z,T[Z]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(N(L.counters,"interactionRangeMin",h.interactionRange[0]),N(L.counters,"interactionRangeMax",h.interactionRange[1])),x)for(const Z of Object.keys(De)){const J=De[Z],ee=x.find(pe=>pe.name===J);ee&&N(L.counters,J,ee.startTime)}return N(L.counters,"visibilityHidden",h.visibilityHidden),N(L.attributes,"style",function(Z){if(Z)for(const J of Z){const ee=J.name.split("?")[0];if(si(ee)){const pe=ee.split("/").slice(-2);if(2===pe.length)return`mapbox://styles/${pe[0]}/${pe[1]}`}}}(_)),N(L.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),N(L.attributes,"fogEnabled",h.fogEnabled?"true":"false"),N(L.attributes,"projection",h.projection),N(L.attributes,"zoom",h.zoom),N(L.metadata,"devicePixelRatio",I),N(L.metadata,"connectionEffectiveType",A?A.effectiveType:void 0),N(L.metadata,"navigatorUserAgent",q.navigator.userAgent),N(L.metadata,"screenWidth",q.screen.width),N(L.metadata,"screenHeight",q.screen.height),N(L.metadata,"windowWidth",q.innerWidth),N(L.metadata,"windowHeight",q.innerHeight),N(L.metadata,"mapWidth",h.width/I),N(L.metadata,"mapHeight",h.height/I),N(L.metadata,"webglRenderer",h.renderer),N(L.metadata,"webglVendor",h.vendor),N(L.metadata,"sdkVersion",re),N(L.metadata,"sdkIdentifier","mapbox-gl-js"),L}(n);for(const h of s.metadata);for(const h of s.counters);for(const h of s.attributes);this.postEvent(e,s,()=>{},t)}},Rt=tt.postPerformanceEvent.bind(tt),At=new class extends se{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,s){if(!he.API_URL||!he.SESSION_PATH)return;const h=Pt(he.API_URL+he.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${s||he.ACCESS_TOKEN||""}`);const _={url:gn(h),headers:{"Content-Type":"text/plain"}};var T;this.pendingRequest=(T=x=>{this.pendingRequest=null,n(x),this.saveEventData(),this.processRequests(s)},jt(Tt(_,{method:"GET"}),T))}getSessionAPI(t,e,n,s){this.skuToken=e,this.errorCb=s,he.SESSION_PATH&&he.API_URL&&(n||he.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Ai)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}},ye=At.getSessionAPI.bind(At),be=new Set,De={create:"create",load:"load",fullLoad:"fullLoad"},dt={mark(t){q.performance.mark(t)},measure(t,e,n){q.performance.measure(t,e,n)}};function pt(t){const e=t.name.split("?")[0];return Cr(e)&&e.includes("mapbox-gl.js")?"javascript":Cr(e)&&e.includes("mapbox-gl.css")?"css":he.API_FONTS_REGEX.test(e)?"fontRange":dn(e)?"sprite":si(e)?"style":he.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const on=q.performance;function Dn(t){const e=t?t.url.toString():void 0;return on.getEntriesByName(e)}let Nn,Wn,Ei,di;const Hn={now:()=>void 0!==Ei?Ei:q.performance.now(),setNow(t){Ei=t},restoreNow(){Ei=void 0},frame(t){const e=q.requestAnimationFrame(t);return{cancel:()=>q.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:s}=t;di||(di=q.document.createElement("canvas"));const h=di.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(n>di.width||s>di.height)&&(di.width=n,di.height=s),h.clearRect(-e,-e,n+2*e,s+2*e),h.drawImage(t,0,0,n,s),h.getImageData(-e,-e,n+2*e,s+2*e)},resolveURL:t=>(Nn||(Nn=q.document.createElement("a")),Nn.href=t,Nn.href),get devicePixelRatio(){return q.devicePixelRatio},get prefersReducedMotion(){return!!q.matchMedia&&(null==Wn&&(Wn=q.matchMedia("(prefers-reduced-motion: reduce)")),Wn.matches)}};function Vi(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function ki(t,e,n){if(n&&n[t]){const s=n[t].indexOf(e);-1!==s&&n[t].splice(s,1)}}class Gr{constructor(e,n={}){Tt(this,n),this.type=e}}class Tr extends Gr{constructor(e,n={}){super("error",Tt({error:e},n))}}class Or{on(e,n){return this._listeners=this._listeners||{},Vi(e,n,this._listeners),this}off(e,n){return ki(e,n,this._listeners),ki(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Vi(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){"string"==typeof e&&(e=new Gr(e,n||{}));const s=e.type;if(this.listens(s)){e.target=this;const h=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const T of h)T.call(this,e);const _=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const T of _)ki(s,T,this._oneTimeListeners),T.call(this,e);const x=this._eventedParent;x&&(Tt(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),x.fire(e))}else e instanceof Tr&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Xt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function no(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}function vr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function eo(t){if(Array.isArray(t))return t.map(eo);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=eo(t[n]);return e}return vr(t)}class wo extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var mi=wo;class Qi{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,h]of n)this.bindings[s]=h}concat(e){return new Qi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Er=Qi;const mr={kind:"null"},Rn={kind:"number"},oi={kind:"string"},Cn={kind:"boolean"},me={kind:"color"},Ge={kind:"object"},ct={kind:"value"},zt={kind:"collator"},Yt={kind:"formatted"},$e={kind:"resolvedImage"};function ft(t,e){return{kind:"array",itemType:t,N:e}}function Ft(t){if("array"===t.kind){const e=Ft(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const hn=[mr,Rn,oi,Cn,me,Yt,Ge,ft(ct),$e];function Jt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Jt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const n of hn)if(!Jt(n,e))return null}return`Expected ${Ft(t)} but found ${Ft(e)} instead.`}function Vn(t,e){return e.some(n=>n.kind===t.kind)}function Yn(t,e){return e.some(n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t)}var Mi,Bi={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ni(t){return(t=Math.round(t))<0?0:t>255?255:t}function Nr(t){return Ni("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function ir(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Hr(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{Mi={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Bi)return Bi[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=n.indexOf("("),h=n.indexOf(")");if(-1!==s&&h+1===n.length){var _=n.substr(0,s),x=n.substr(s+1,h-(s+1)).split(","),T=1;switch(_){case"rgba":if(4!==x.length)return null;T=ir(x.pop());case"rgb":return 3!==x.length?null:[Nr(x[0]),Nr(x[1]),Nr(x[2]),T];case"hsla":if(4!==x.length)return null;T=ir(x.pop());case"hsl":if(3!==x.length)return null;var I=(parseFloat(x[0])%360+360)%360/360,A=ir(x[1]),L=ir(x[2]),N=L<=.5?L*(A+1):L+A-L*A,Z=2*L-N;return[Ni(255*Hr(Z,N,I+1/3)),Ni(255*Hr(Z,N,I)),Ni(255*Hr(Z,N,I-1/3)),T];default:return null}}return null}}catch{}class zr{constructor(e,n,s,h=1){this.r=e,this.g=n,this.b=s,this.a=h}static parse(e){if(!e)return;if(e instanceof zr)return e;if("string"!=typeof e)return;const n=Mi(e);return n?new zr(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,s,h]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${h})`}toArray(){const{r:e,g:n,b:s,a:h}=this;return 0===h?[0,0,0,0]:[255*e/h,255*n/h,255*s/h,h]}toArray01(){const{r:e,g:n,b:s,a:h}=this;return 0===h?[0,0,0,0]:[e/h,n/h,s/h,h]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:s,a:h}=this;return[e,n,s,h]}}zr.black=new zr(0,0,0,1),zr.white=new zr(1,1,1,1),zr.transparent=new zr(0,0,0,0),zr.red=new zr(1,0,0,1),zr.blue=new zr(0,0,1,1);var lr=zr;class or{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Wa{constructor(e,n,s,h,_){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=s,this.fontStack=h,this.textColor=_}}class Wr{constructor(e){this.sections=e}static fromString(e){return new Wr([new Wa(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Wr?e:Wr.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(s)}return e}}class fo{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new fo({name:e,available:!1}):null}serialize(){return["image",this.name]}}function _s(t,e,n,s){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[t,e,n,s]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Wo(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof lr||t instanceof or||t instanceof Wr||t instanceof fo)return!0;if(Array.isArray(t)){for(const e of t)if(!Wo(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!Wo(t[e]))return!1;return!0}return!1}function xr(t){if(null===t)return mr;if("string"==typeof t)return oi;if("boolean"==typeof t)return Cn;if("number"==typeof t)return Rn;if(t instanceof lr)return me;if(t instanceof or)return zt;if(t instanceof Wr)return Yt;if(t instanceof fo)return $e;if(Array.isArray(t)){const e=t.length;let n;for(const s of t){const h=xr(s);if(n){if(n===h)continue;n=ct;break}n=h}return ft(n||ct,e)}return Ge}function Ur(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof lr||t instanceof Wr||t instanceof fo?t.toString():JSON.stringify(t)}class ua{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Wo(e[1]))return n.error("invalid value");const s=e[1];let h=xr(s);const _=n.expectedType;return"array"!==h.kind||0!==h.N||!_||"array"!==_.kind||"number"==typeof _.N&&0!==_.N||(h=_),new ua(h,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof lr?["rgba"].concat(this.value.toArray()):this.value instanceof Wr?this.value.serialize():this.value}}var qr=ua,gr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const zo={string:oi,number:Rn,boolean:Cn,object:Ge};class ys{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,h=1;const _=e[0];if("array"===_){let T,I;if(e.length>2){const A=e[1];if("string"!=typeof A||!(A in zo)||"object"===A)return n.error('The item type argument of "array" must be one of string, number, boolean',1);T=zo[A],h++}else T=ct;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);I=e[2],h++}s=ft(T,I)}else s=zo[_];const x=[];for(;h<e.length;h++){const T=n.parse(e[h],h,ct);if(!T)return null;x.push(T)}return new ys(s,x)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!Jt(this.type,xr(s)))return s;if(n===this.args.length-1)throw new gr(`Expected value to be of type ${Ft(this.type)}, but found ${Ft(xr(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){n.push(s.kind);const h=e.N;("number"==typeof h||this.args.length>1)&&n.push(h)}}return n.concat(this.args.map(s=>s.serialize()))}}var co=ys;class to{constructor(e){this.type=Yt,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return n.error("First argument must be an image or text section.");const h=[];let _=!1;for(let x=1;x<=e.length-1;++x){const T=e[x];if(_&&"object"==typeof T&&!Array.isArray(T)){_=!1;let I=null;if(T["font-scale"]&&(I=n.parse(T["font-scale"],1,Rn),!I))return null;let A=null;if(T["text-font"]&&(A=n.parse(T["text-font"],1,ft(oi)),!A))return null;let L=null;if(T["text-color"]&&(L=n.parse(T["text-color"],1,me),!L))return null;const N=h[h.length-1];N.scale=I,N.font=A,N.textColor=L}else{const I=n.parse(e[x],1,ct);if(!I)return null;const A=I.type.kind;if("string"!==A&&"value"!==A&&"null"!==A&&"resolvedImage"!==A)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,h.push({content:I,scale:null,font:null,textColor:null})}}return new to(h)}evaluate(e){return new Wr(this.sections.map(n=>{const s=n.content.evaluate(e);return xr(s)===$e?new Wa("",s,null,null,null):new Wa(Ur(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),e.push(s)}return e}}class Fs{constructor(e){this.type=$e,this.input=e}static parse(e,n){if(2!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,oi);return s?new Fs(s):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),s=fo.fromString(n);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(n)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const da={"to-boolean":Cn,"to-color":me,"to-number":Rn,"to-string":oi};class Co{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return n.error("Expected one argument.");const h=da[s],_=[];for(let x=1;x<e.length;x++){const T=n.parse(e[x],x,ct);if(!T)return null;_.push(T)}return new Co(h,_)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let n,s;for(const h of this.args){if(n=h.evaluate(e),s=null,n instanceof lr)return n;if("string"==typeof n){const _=e.parseColor(n);if(_)return _}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:_s(n[0],n[1],n[2],n[3]),!s))return new lr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new gr(s||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const s of this.args){if(n=s.evaluate(e),null===n)return 0;const h=Number(n);if(!isNaN(h))return h}throw new gr(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?Wr.fromString(Ur(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?fo.fromString(Ur(this.args[0].evaluate(e))):Ur(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new to([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Fs(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var mo=Co;const Hs=["Unknown","Point","LineString","Polygon"];var vs=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Hs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(s*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=lr.parse(t)),e}};class as{constructor(e,n,s,h){this.name=e,this.type=n,this._evaluate=s,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const s=e[0],h=as.definitions[s];if(!h)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(h)?h[0]:h.type,x=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,T=x.filter(([A])=>!Array.isArray(A)||A.length===e.length-1);let I=null;for(const[A,L]of T){I=new _o(n.registry,n.path,null,n.scope);const N=[];let Z=!1;for(let J=1;J<e.length;J++){const ee=e[J],pe=Array.isArray(A)?A[J-1]:A.type,Pe=I.parse(ee,1+N.length,pe);if(!Pe){Z=!0;break}N.push(Pe)}if(!Z)if(Array.isArray(A)&&A.length!==N.length)I.error(`Expected ${A.length} arguments, but found ${N.length} instead.`);else{for(let J=0;J<N.length;J++){const ee=Array.isArray(A)?A[J]:A.type,pe=N[J];I.concat(J+1).checkSubtype(ee,pe.type)}if(0===I.errors.length)return new as(s,_,L,N)}}if(1===T.length)n.errors.push(...I.errors);else{const A=(T.length?T:x).map(([N])=>{return Z=N,Array.isArray(Z)?`(${Z.map(Ft).join(", ")})`:`(${Ft(Z.type)}...)`;var Z}).join(" | "),L=[];for(let N=1;N<e.length;N++){const Z=n.parse(e[N],1+L.length);if(!Z)return null;L.push(Ft(Z.type))}n.error(`Expected arguments of type ${A}, but found (${L.join(", ")}) instead.`)}return null}static register(e,n){as.definitions=n;for(const s in n)e[s]=as}}var go=as;class xs{constructor(e,n,s){this.type=zt,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return n.error("Collator options argument must be an object.");const h=n.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Cn);if(!h)return null;const _=n.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Cn);if(!_)return null;let x=null;return s.locale&&(x=n.parse(s.locale,1,oi),!x)?null:new xs(h,_,x)}evaluate(e){return new or(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const so=8192;function ks(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function bs(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function ha(t,e){const n=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(n*h*so),Math.round(s*h*so)]}function pa(t,e,n){const s=t[0]-e[0],h=t[1]-e[1],_=t[0]-n[0],x=t[1]-n[1];return s*x-_*h==0&&s*_<=0&&h*x<=0}function Ws(t,e){let n=!1;for(let x=0,T=e.length;x<T;x++){const I=e[x];for(let A=0,L=I.length;A<L-1;A++){if(pa(t,I[A],I[A+1]))return!1;(h=I[A])[1]>(s=t)[1]!=(_=I[A+1])[1]>s[1]&&s[0]<(_[0]-h[0])*(s[1]-h[1])/(_[1]-h[1])+h[0]&&(n=!n)}}var s,h,_;return n}function ls(t,e){for(let n=0;n<e.length;n++)if(Ws(t,e[n]))return!0;return!1}function fa(t,e,n,s){const h=s[0]-n[0],_=s[1]-n[1],x=(t[0]-n[0])*_-h*(t[1]-n[1]),T=(e[0]-n[0])*_-h*(e[1]-n[1]);return x>0&&T<0||x<0&&T>0}function Mo(t,e,n){for(const A of n)for(let L=0;L<A.length-1;++L)if((T=[(x=A[L+1])[0]-(_=A[L])[0],x[1]-_[1]])[0]*(I=[(h=e)[0]-(s=t)[0],h[1]-s[1]])[1]-T[1]*I[0]!=0&&fa(s,h,_,x)&&fa(_,x,s,h))return!0;var s,h,_,x,T,I;return!1}function cl(t,e){for(let n=0;n<t.length;++n)if(!Ws(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Mo(t[n],t[n+1],e))return!1;return!0}function Ma(t,e){for(let n=0;n<e.length;n++)if(cl(t,e[n]))return!0;return!1}function cs(t,e,n){const s=[];for(let h=0;h<t.length;h++){const _=[];for(let x=0;x<t[h].length;x++){const T=ha(t[h][x],n);ks(e,T),_.push(T)}s.push(_)}return s}function Ro(t,e,n){const s=[];for(let h=0;h<t.length;h++){const _=cs(t[h],e,n);s.push(_)}return s}function Uo(t,e,n,s){if(t[0]<n[0]||t[0]>n[2]){const h=.5*s;let _=t[0]-n[0]>h?-s:n[0]-t[0]>h?s:0;0===_&&(_=t[0]-n[2]>h?-s:n[2]-t[0]>h?s:0),t[0]+=_}ks(e,t)}function ji(t,e,n,s){const h=Math.pow(2,s.z)*so,_=[s.x*so,s.y*so],x=[];if(!t)return x;for(const T of t)for(const I of T){const A=[I.x+_[0],I.y+_[1]];Uo(A,e,n,h),x.push(A)}return x}function qs(t,e,n,s){const h=Math.pow(2,s.z)*so,_=[s.x*so,s.y*so],x=[];if(!t)return x;for(const I of t){const A=[];for(const L of I){const N=[L.x+_[0],L.y+_[1]];ks(e,N),A.push(N)}x.push(A)}if(e[2]-e[0]<=h/2){(T=e)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const I of x)for(const A of I)Uo(A,e,n,h)}var T;return x}class Ys{constructor(e,n){this.type=Cn,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Wo(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let h=0;h<s.features.length;++h){const _=s.features[h].geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new Ys(s,s.features[h].geometry)}else if("Feature"===s.type){const h=s.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new Ys(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new Ys(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(n,s){const h=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=n.canonicalID();if(!x)return!1;if("Polygon"===s.type){const T=cs(s.coordinates,_,x),I=ji(n.geometry(),h,_,x);if(!bs(h,_))return!1;for(const A of I)if(!Ws(A,T))return!1}if("MultiPolygon"===s.type){const T=Ro(s.coordinates,_,x),I=ji(n.geometry(),h,_,x);if(!bs(h,_))return!1;for(const A of I)if(!ls(A,T))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(n,s){const h=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=n.canonicalID();if(!x)return!1;if("Polygon"===s.type){const T=cs(s.coordinates,_,x),I=qs(n.geometry(),h,_,x);if(!bs(h,_))return!1;for(const A of I)if(!cl(A,T))return!1}if("MultiPolygon"===s.type){const T=Ro(s.coordinates,_,x),I=qs(n.geometry(),h,_,x);if(!bs(h,_))return!1;for(const A of I)if(!Ma(A,T))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Vo=Ys;function Lo(t){if(t instanceof go&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof Vo)return!1;let e=!0;return t.eachChild(n=>{e&&!Lo(n)&&(e=!1)}),e}function ws(t){if(t instanceof go&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!ws(n)&&(e=!1)}),e}function Cs(t,e){if(t instanceof go&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(s=>{n&&!Cs(s,e)&&(n=!1)}),n}class us{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new us(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var qo=us;class uo{constructor(e,n=[],s,h=new Er,_=[]){this.registry=e,this.path=n,this.key=n.map(x=>`[${x}]`).join(""),this.scope=h,this.errors=_,this.expectedType=s}parse(e,n,s,h,_={}){return n?this.concat(n,s,h)._parse(e,_):this._parse(e,_)}_parse(e,n){function s(h,_,x){return"assert"===x?new co(_,[h]):"coerce"===x?new mo(_,[h]):h}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[h];if(_){let x=_.parse(e,this);if(!x)return null;if(this.expectedType){const T=this.expectedType,I=x.type;if("string"!==T.kind&&"number"!==T.kind&&"boolean"!==T.kind&&"object"!==T.kind&&"array"!==T.kind||"value"!==I.kind)if("color"!==T.kind&&"formatted"!==T.kind&&"resolvedImage"!==T.kind||"value"!==I.kind&&"string"!==I.kind){if(this.checkSubtype(T,I))return null}else x=s(x,T,n.typeAnnotation||"coerce");else x=s(x,T,n.typeAnnotation||"assert")}if(!(x instanceof qr)&&"resolvedImage"!==x.type.kind&&jo(x)){const T=new vs;try{x=new qr(x.type,x.evaluate(T))}catch(I){return this.error(I.message),null}}return x}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const h="number"==typeof e?this.path.concat(e):this.path,_=s?this.scope.concat(s):this.scope;return new uo(this.registry,h,n||null,_,this.errors)}error(e,...n){const s=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new mi(s,e))}checkSubtype(e,n){const s=Jt(e,n);return s&&this.error(s),s}}var _o=uo;function jo(t){if(t instanceof qo)return jo(t.boundExpression);if(t instanceof go&&"error"===t.name||t instanceof xs||t instanceof Vo)return!1;const e=t instanceof mo||t instanceof co;let n=!0;return t.eachChild(s=>{n=e?n&&jo(s):n&&s instanceof qr}),!!n&&Lo(t)&&Cs(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Xr(t,e){const n=t.length-1;let s,h,_=0,x=n,T=0;for(;_<=x;)if(T=Math.floor((_+x)/2),s=t[T],h=t[T+1],s<=e){if(T===n||e<h)return T;_=T+1}else{if(!(s>e))throw new gr("Input is not a number.");x=T-1}return 0}class ma{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[h,_]of s)this.labels.push(h),this.outputs.push(_)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,Rn);if(!s)return null;const h=[];let _=null;n.expectedType&&"value"!==n.expectedType.kind&&(_=n.expectedType);for(let x=1;x<e.length;x+=2){const T=1===x?-1/0:e[x],I=e[x+1],A=x,L=x+1;if("number"!=typeof T)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(h.length&&h[h.length-1][0]>=T)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const N=n.parse(I,L,_);if(!N)return null;_=_||N.type,h.push([T,N])}return new ma(_,s,h)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return s[0].evaluate(e);const _=n.length;return h>=n[_-1]?s[_-1].evaluate(e):s[Xr(n,h)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var Yo=ma;function wi(t,e,n){return t*(1-n)+e*n}var Sa=Object.freeze({__proto__:null,number:wi,color:function(t,e,n){return new lr(wi(t.r,e.r,n),wi(t.g,e.g,n),wi(t.b,e.b,n),wi(t.a,e.a,n))},array:function(t,e,n){return t.map((s,h)=>wi(s,e[h],n))}});const Dr=4/29,Js=6/29,Jo=3*Js*Js,qa=Math.PI/180,K=180/Math.PI;function Y(t){return t>.008856451679035631?Math.pow(t,1/3):t/Jo+Dr}function G(t){return t>Js?t*t*t:Jo*(t-Dr)}function Ie(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function pn(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ci(t){const e=pn(t.r),n=pn(t.g),s=pn(t.b),h=Y((.4124564*e+.3575761*n+.1804375*s)/.95047),_=Y((.2126729*e+.7151522*n+.072175*s)/1);return{l:116*_-16,a:500*(h-_),b:200*(_-Y((.0193339*e+.119192*n+.9503041*s)/1.08883)),alpha:t.a}}function dr(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*G(e),n=.95047*G(n),s=1.08883*G(s),new lr(Ie(3.2404542*n-1.5371385*e-.4985314*s),Ie(-.969266*n+1.8760108*e+.041556*s),Ie(.0556434*n-.2040259*e+1.0572252*s),t.alpha)}function hr(t,e,n){const s=e-t;return t+n*(s>180||s<-180?s-360*Math.round(s/360):s)}const Ts={forward:ci,reverse:dr,interpolate:function(t,e,n){return{l:wi(t.l,e.l,n),a:wi(t.a,e.a,n),b:wi(t.b,e.b,n),alpha:wi(t.alpha,e.alpha,n)}}},So={forward:function(t){const{l:e,a:n,b:s}=ci(t),h=Math.atan2(s,n)*K;return{h:h<0?h+360:h,c:Math.sqrt(n*n+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*qa,n=t.c;return dr({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:hr(t.h,e.h,n),c:wi(t.c,e.c,n),l:wi(t.l,e.l,n),alpha:wi(t.alpha,e.alpha,n)}}};var Ya=Object.freeze({__proto__:null,lab:Ts,hcl:So});class Al{constructor(e,n,s,h,_){this.type=e,this.operator=n,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(const[x,T]of _)this.labels.push(x),this.outputs.push(T)}static interpolationFactor(e,n,s,h){let _=0;if("exponential"===e.name)_=Sn(n,e.base,s,h);else if("linear"===e.name)_=Sn(n,1,s,h);else if("cubic-bezier"===e.name){const x=e.controlPoints;_=new Ke(x[0],x[1],x[2],x[3]).solve(Sn(n,1,s,h))}return _}static parse(e,n){let[s,h,_,...x]=e;if(!Array.isArray(h)||0===h.length)return n.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const A=h[1];if("number"!=typeof A)return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:A}}else{if("cubic-bezier"!==h[0])return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const A=h.slice(1);if(4!==A.length||A.some(L=>"number"!=typeof L||L<0||L>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(_=n.parse(_,2,Rn),!_)return null;const T=[];let I=null;"interpolate-hcl"===s||"interpolate-lab"===s?I=me:n.expectedType&&"value"!==n.expectedType.kind&&(I=n.expectedType);for(let A=0;A<x.length;A+=2){const L=x[A],N=x[A+1],Z=A+3,J=A+4;if("number"!=typeof L)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(T.length&&T[T.length-1][0]>=L)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Z);const ee=n.parse(N,J,I);if(!ee)return null;I=I||ee.type,T.push([L,ee])}return"number"===I.kind||"color"===I.kind||"array"===I.kind&&"number"===I.itemType.kind&&"number"==typeof I.N?new Al(I,s,h,_,T):n.error(`Type ${Ft(I)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return s[0].evaluate(e);const _=n.length;if(h>=n[_-1])return s[_-1].evaluate(e);const x=Xr(n,h),T=Al.interpolationFactor(this.interpolation,h,n[x],n[x+1]),I=s[x].evaluate(e),A=s[x+1].evaluate(e);return"interpolate"===this.operator?Sa[this.type.kind.toLowerCase()](I,A,T):"interpolate-hcl"===this.operator?So.reverse(So.interpolate(So.forward(I),So.forward(A),T)):Ts.reverse(Ts.interpolate(Ts.forward(I),Ts.forward(A),T))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function Sn(t,e,n,s){const h=s-n,_=t-n;return 0===h?0:1===e?_/h:(Math.pow(e,_)-1)/(Math.pow(e,h)-1)}var Ri=Al;class Pa{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const h=n.expectedType;h&&"value"!==h.kind&&(s=h);const _=[];for(const T of e.slice(1)){const I=n.parse(T,1+_.length,s,void 0,{typeAnnotation:"omit"});if(!I)return null;s=s||I.type,_.push(I)}const x=h&&_.some(T=>Jt(h,T.type));return new Pa(x?ct:s,_)}evaluate(e){let n,s=null,h=0;for(const _ of this.args){if(h++,s=_.evaluate(e),s&&s instanceof fo&&!s.available&&(n||(n=s),s=null,h===this.args.length))return n;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var ul=Pa;class ao{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let _=1;_<e.length-1;_+=2){const x=e[_];if("string"!=typeof x)return n.error(`Expected string, but found ${typeof x} instead.`,_);if(/[^a-zA-Z0-9_]/.test(x))return n.error("Variable names must contain only alphanumeric characters or '_'.",_);const T=n.parse(e[_+1],_+1);if(!T)return null;s.push([x,T])}const h=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return h?new ao(s,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,s]of this.bindings)e.push(n,s.serialize());return e.push(this.result.serialize()),e}}var pc=ao;class Xs{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Rn),h=n.parse(e[2],2,ft(n.expectedType||ct));return s&&h?new Xs(h.type.itemType,s,h):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new gr(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new gr(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new gr(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var $o=Xs;class Es{constructor(e,n){this.type=Cn,this.needle=e,this.haystack=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,ct),h=n.parse(e[2],2,ct);return s&&h?Vn(s.type,[Cn,oi,Rn,mr,ct])?new Es(s,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!Yn(n,["boolean","string","number","null"]))throw new gr(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(xr(n))} instead.`);if(!Yn(s,["string","array"]))throw new gr(`Expected second argument to be of type array or string, but found ${Ft(xr(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Xo=Es;class Ks{constructor(e,n,s){this.type=Rn,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,ct),h=n.parse(e[2],2,ct);if(!s||!h)return null;if(!Vn(s.type,[Cn,oi,Rn,mr,ct]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(s.type)} instead`);if(4===e.length){const _=n.parse(e[3],3,Rn);return _?new Ks(s,h,_):null}return new Ks(s,h)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Yn(n,["boolean","string","number","null"]))throw new gr(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(xr(n))} instead.`);if(!Yn(s,["string","array"]))throw new gr(`Expected second argument to be of type array or string, but found ${Ft(xr(s))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return s.indexOf(n,h)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Du=Ks;class dl{constructor(e,n,s,h,_,x){this.inputType=e,this.type=n,this.input=s,this.cases=h,this.outputs=_,this.otherwise=x}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,h;n.expectedType&&"value"!==n.expectedType.kind&&(h=n.expectedType);const _={},x=[];for(let A=2;A<e.length-1;A+=2){let L=e[A];const N=e[A+1];Array.isArray(L)||(L=[L]);const Z=n.concat(A);if(0===L.length)return Z.error("Expected at least one branch label.");for(const ee of L){if("number"!=typeof ee&&"string"!=typeof ee)return Z.error("Branch labels must be numbers or strings.");if("number"==typeof ee&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return Z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof ee&&Math.floor(ee)!==ee)return Z.error("Numeric branch labels must be integer values.");if(s){if(Z.checkSubtype(s,xr(ee)))return null}else s=xr(ee);if(void 0!==_[String(ee)])return Z.error("Branch labels must be unique.");_[String(ee)]=x.length}const J=n.parse(N,A,h);if(!J)return null;h=h||J.type,x.push(J)}const T=n.parse(e[1],1,ct);if(!T)return null;const I=n.parse(e[e.length-1],e.length-1,h);return I?"value"!==T.type.kind&&n.concat(1).checkSubtype(s,T.type)?null:new dl(s,h,T,_,x,I):null}evaluate(e){const n=this.input.evaluate(e);return(xr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],h={};for(const x of n){const T=h[this.cases[x]];void 0===T?(h[this.cases[x]]=s.length,s.push([this.cases[x],[x]])):s[T][1].push(x)}const _=x=>"number"===this.inputType.kind?Number(x):x;for(const[x,T]of s)e.push(1===T.length?_(T[0]):T.map(_)),e.push(this.outputs[x].serialize());return e.push(this.otherwise.serialize()),e}}var M=dl;class j{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&"value"!==n.expectedType.kind&&(s=n.expectedType);const h=[];for(let x=1;x<e.length-1;x+=2){const T=n.parse(e[x],x,Cn);if(!T)return null;const I=n.parse(e[x+1],x+1,s);if(!I)return null;h.push([T,I]),s=s||I.type}const _=n.parse(e[e.length-1],e.length-1,s);return _?new j(s,h,_):null}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var S=j;class V{constructor(e,n,s,h){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=h}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,ct),h=n.parse(e[2],2,Rn);if(!s||!h)return null;if(!Vn(s.type,[ft(ct),oi,ct]))return n.error(`Expected first argument to be of type array or string, but found ${Ft(s.type)} instead`);if(4===e.length){const _=n.parse(e[3],3,Rn);return _?new V(s.type,s,h,_):null}return new V(s.type,s,h)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Yn(n,["string","array"]))throw new gr(`Expected first argument to be of type array or string, but found ${Ft(xr(n))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return n.slice(s,h)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ve=V;function Dt(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function wn(t,e,n,s){return 0===s.compare(e,n)}function zn(t,e,n){const s="=="!==t&&"!="!==t;return class V0{constructor(_,x,T){this.type=Cn,this.lhs=_,this.rhs=x,this.collator=T,this.hasUntypedArgument="value"===_.type.kind||"value"===x.type.kind}static parse(_,x){if(3!==_.length&&4!==_.length)return x.error("Expected two or three arguments.");const T=_[0];let I=x.parse(_[1],1,ct);if(!I)return null;if(!Dt(T,I.type))return x.concat(1).error(`"${T}" comparisons are not supported for type '${Ft(I.type)}'.`);let A=x.parse(_[2],2,ct);if(!A)return null;if(!Dt(T,A.type))return x.concat(2).error(`"${T}" comparisons are not supported for type '${Ft(A.type)}'.`);if(I.type.kind!==A.type.kind&&"value"!==I.type.kind&&"value"!==A.type.kind)return x.error(`Cannot compare types '${Ft(I.type)}' and '${Ft(A.type)}'.`);s&&("value"===I.type.kind&&"value"!==A.type.kind?I=new co(A.type,[I]):"value"!==I.type.kind&&"value"===A.type.kind&&(A=new co(I.type,[A])));let L=null;if(4===_.length){if("string"!==I.type.kind&&"string"!==A.type.kind&&"value"!==I.type.kind&&"value"!==A.type.kind)return x.error("Cannot use collator to compare non-string types.");if(L=x.parse(_[3],3,zt),!L)return null}return new V0(I,A,L)}evaluate(_){const x=this.lhs.evaluate(_),T=this.rhs.evaluate(_);if(s&&this.hasUntypedArgument){const I=xr(x),A=xr(T);if(I.kind!==A.kind||"string"!==I.kind&&"number"!==I.kind)throw new gr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${I.kind}, ${A.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const I=xr(x),A=xr(T);if("string"!==I.kind||"string"!==A.kind)return e(_,x,T)}return this.collator?n(_,x,T,this.collator.evaluate(_)):e(_,x,T)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[t];return this.eachChild(x=>{_.push(x.serialize())}),_}}}const xi=zn("==",function(t,e,n){return e===n},wn),ti=zn("!=",function(t,e,n){return e!==n},function(t,e,n,s){return!wn(0,e,n,s)}),Gi=zn("<",function(t,e,n){return e<n},function(t,e,n,s){return s.compare(e,n)<0}),nr=zn(">",function(t,e,n){return e>n},function(t,e,n,s){return s.compare(e,n)>0}),cr=zn("<=",function(t,e,n){return e<=n},function(t,e,n,s){return s.compare(e,n)<=0}),yo=zn(">=",function(t,e,n){return e>=n},function(t,e,n,s){return s.compare(e,n)>=0});class vo{constructor(e,n,s,h,_,x){this.type=oi,this.number=e,this.locale=n,this.currency=s,this.unit=h,this.minFractionDigits=_,this.maxFractionDigits=x}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,Rn);if(!s)return null;const h=e[2];if("object"!=typeof h||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let _=null;if(h.locale&&(_=n.parse(h.locale,1,oi),!_))return null;let x=null;if(h.currency&&(x=n.parse(h.currency,1,oi),!x))return null;let T=null;if(h.unit&&(T=n.parse(h.unit,1,oi),!T))return null;let I=null;if(h["min-fraction-digits"]&&(I=n.parse(h["min-fraction-digits"],1,Rn),!I))return null;let A=null;return h["max-fraction-digits"]&&(A=n.parse(h["max-fraction-digits"],1,Rn),!A)?null:new vo(s,_,x,T,I,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ds{constructor(e){this.type=Rn,this.input=e}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?n.error(`Expected argument of type string or array, but found ${Ft(s.type)} instead.`):new Ds(s):null}evaluate(e){const n=this.input.evaluate(e);if("string"==typeof n||Array.isArray(n))return n.length;throw new gr(`Expected value to be of type string or array, but found ${Ft(xr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Ko={"==":xi,"!=":ti,">":nr,"<":Gi,">=":yo,"<=":cr,array:co,at:$o,boolean:co,case:S,coalesce:ul,collator:xs,format:to,image:Fs,in:Xo,"index-of":Du,interpolate:Ri,"interpolate-hcl":Ri,"interpolate-lab":Ri,length:Ds,let:pc,literal:qr,match:M,number:co,"number-format":vo,object:co,slice:ve,step:Yo,string:co,"to-boolean":mo,"to-color":mo,"to-number":mo,"to-string":mo,var:qo,within:Vo};function ql(t,[e,n,s,h]){e=e.evaluate(t),n=n.evaluate(t),s=s.evaluate(t);const _=h?h.evaluate(t):1,x=_s(e,n,s,_);if(x)throw new gr(x);return new lr(e/255*_,n/255*_,s/255*_,_)}function hl(t,e){return t in e}function ga(t,e){const n=e[t];return void 0===n?null:n}function Zo(t){return{type:t}}go.register(Ko,{error:[{kind:"error"},[oi],(t,[e])=>{throw new gr(e.evaluate(t))}],typeof:[oi,[ct],(t,[e])=>Ft(xr(e.evaluate(t)))],"to-rgba":[ft(Rn,4),[me],(t,[e])=>e.evaluate(t).toArray()],rgb:[me,[Rn,Rn,Rn],ql],rgba:[me,[Rn,Rn,Rn,Rn],ql],has:{type:Cn,overloads:[[[oi],(t,[e])=>hl(e.evaluate(t),t.properties())],[[oi,Ge],(t,[e,n])=>hl(e.evaluate(t),n.evaluate(t))]]},get:{type:ct,overloads:[[[oi],(t,[e])=>ga(e.evaluate(t),t.properties())],[[oi,Ge],(t,[e,n])=>ga(e.evaluate(t),n.evaluate(t))]]},"feature-state":[ct,[oi],(t,[e])=>ga(e.evaluate(t),t.featureState||{})],properties:[Ge,[],t=>t.properties()],"geometry-type":[oi,[],t=>t.geometryType()],id:[ct,[],t=>t.id()],zoom:[Rn,[],t=>t.globals.zoom],pitch:[Rn,[],t=>t.globals.pitch||0],"distance-from-center":[Rn,[],t=>t.distanceFromCenter()],"heatmap-density":[Rn,[],t=>t.globals.heatmapDensity||0],"line-progress":[Rn,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Rn,[],t=>t.globals.skyRadialProgress||0],accumulated:[ct,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Rn,Zo(Rn),(t,e)=>{let n=0;for(const s of e)n+=s.evaluate(t);return n}],"*":[Rn,Zo(Rn),(t,e)=>{let n=1;for(const s of e)n*=s.evaluate(t);return n}],"-":{type:Rn,overloads:[[[Rn,Rn],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Rn],(t,[e])=>-e.evaluate(t)]]},"/":[Rn,[Rn,Rn],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Rn,[Rn,Rn],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Rn,[],()=>Math.LN2],pi:[Rn,[],()=>Math.PI],e:[Rn,[],()=>Math.E],"^":[Rn,[Rn,Rn],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Rn,[Rn],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Rn,[Rn],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Rn,[Rn],(t,[e])=>Math.log(e.evaluate(t))],log2:[Rn,[Rn],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Rn,[Rn],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Rn,[Rn],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Rn,[Rn],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Rn,[Rn],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Rn,[Rn],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Rn,[Rn],(t,[e])=>Math.atan(e.evaluate(t))],min:[Rn,Zo(Rn),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[Rn,Zo(Rn),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[Rn,[Rn],(t,[e])=>Math.abs(e.evaluate(t))],round:[Rn,[Rn],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Rn,[Rn],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Rn,[Rn],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Cn,[oi,ct],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Cn,[ct],(t,[e])=>t.id()===e.value],"filter-type-==":[Cn,[oi],(t,[e])=>t.geometryType()===e.value],"filter-<":[Cn,[oi,ct],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s<h}],"filter-id-<":[Cn,[ct],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[Cn,[oi,ct],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s>h}],"filter-id->":[Cn,[ct],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[Cn,[oi,ct],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s<=h}],"filter-id-<=":[Cn,[ct],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[Cn,[oi,ct],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s>=h}],"filter-id->=":[Cn,[ct],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[Cn,[ct],(t,[e])=>e.value in t.properties()],"filter-has-id":[Cn,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Cn,[ft(oi)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Cn,[ft(ct)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Cn,[oi,ft(ct)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Cn,[oi,ft(ct)],(t,[e,n])=>function(s,h,_,x){for(;_<=x;){const T=_+x>>1;if(h[T]===s)return!0;h[T]>s?x=T-1:_=T+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Cn,overloads:[[[Cn,Cn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Zo(Cn),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Cn,overloads:[[[Cn,Cn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Zo(Cn),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Cn,[Cn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Cn,[oi],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[oi,[oi],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[oi,[oi],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[oi,Zo(ct),(t,e)=>e.map(n=>Ur(n.evaluate(t))).join("")],"resolved-locale":[oi,[zt],(t,[e])=>e.evaluate(t).resolvedLocale()]});var pl=Ko;function fl(t){return{result:"success",value:t}}function Rr(t){return{result:"error",value:t}}function hs(t){return"data-driven"===t["property-type"]}function Sr(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function fc(t){return!!t.expression&&t.expression.interpolated}function ur(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Pl(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function U(t){return t}function ae(t,e){const n="color"===e.type,s=t.stops&&"object"==typeof t.stops[0][0],h=s||!(s||void 0!==t.property),_=t.type||(fc(e)?"exponential":"interval");if(n&&((t=no({},t)).stops&&(t.stops=t.stops.map(A=>[A[0],lr.parse(A[1])])),t.default=lr.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Ya[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let x,T,I;if("exponential"===_)x=un;else if("interval"===_)x=ht;else if("categorical"===_){x=Se,T=Object.create(null);for(const A of t.stops)T[A[0]]=A[1];I=typeof t.stops[0][0]}else{if("identity"!==_)throw new Error(`Unknown function type "${_}"`);x=Tn}if(s){const A={},L=[];for(let J=0;J<t.stops.length;J++){const ee=t.stops[J],pe=ee[0].zoom;void 0===A[pe]&&(A[pe]={zoom:pe,type:t.type,property:t.property,default:t.default,stops:[]},L.push(pe)),A[pe].stops.push([ee[0].value,ee[1]])}const N=[];for(const J of L)N.push([A[J].zoom,ae(A[J],e)]);const Z={name:"linear"};return{kind:"composite",interpolationType:Z,interpolationFactor:Ri.interpolationFactor.bind(void 0,Z),zoomStops:N.map(J=>J[0]),evaluate:({zoom:J},ee)=>un({stops:N,base:t.base},e,J).evaluate(J,ee)}}if(h){const A="exponential"===_?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Ri.interpolationFactor.bind(void 0,A),zoomStops:t.stops.map(L=>L[0]),evaluate:({zoom:L})=>x(t,e,L,T,I)}}return{kind:"source",evaluate(A,L){const N=L&&L.properties?L.properties[t.property]:void 0;return void 0===N?H(t.default,e.default):x(t,e,N,T,I)}}}function H(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function Se(t,e,n,s,h){return H(typeof n===h?s[n]:void 0,t.default,e.default)}function ht(t,e,n){if("number"!==ur(n))return H(t.default,e.default);const s=t.stops.length;if(1===s||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];const h=Xr(t.stops.map(_=>_[0]),n);return t.stops[h][1]}function un(t,e,n){const s=void 0!==t.base?t.base:1;if("number"!==ur(n))return H(t.default,e.default);const h=t.stops.length;if(1===h||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[h-1][0])return t.stops[h-1][1];const _=Xr(t.stops.map(L=>L[0]),n),x=function(L,N,Z,J){const ee=J-Z,pe=L-Z;return 0===ee?0:1===N?pe/ee:(Math.pow(N,pe)-1)/(Math.pow(N,ee)-1)}(n,s,t.stops[_][0],t.stops[_+1][0]),T=t.stops[_][1],I=t.stops[_+1][1];let A=Sa[e.type]||U;if(t.colorSpace&&"rgb"!==t.colorSpace){const L=Ya[t.colorSpace];A=(N,Z)=>L.reverse(L.interpolate(L.forward(N),L.forward(Z),x))}return"function"==typeof T.evaluate?{evaluate(...L){const N=T.evaluate.apply(void 0,L),Z=I.evaluate.apply(void 0,L);if(void 0!==N&&void 0!==Z)return A(N,Z,x)}}:A(T,I,x)}function Tn(t,e,n){return"color"===e.type?n=lr.parse(n):"formatted"===e.type?n=Wr.fromString(n.toString()):"resolvedImage"===e.type?n=fo.fromString(n.toString()):ur(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),H(n,t.default,e.default)}class ai{constructor(e,n){var s;this.expression=e,this._warningHistory={},this._evaluator=new vs,this._defaultValue=n?"color"===(s=n).type&&(Pl(s.default)||Array.isArray(s.default))?new lr(0,0,0,0):"color"===s.type?lr.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(e,n,s,h,_,x,T,I){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=h||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=I||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,h,_,x,T,I){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=I||null;try{const A=this.expression.evaluate(this._evaluator);if(null==A||"number"==typeof A&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new gr(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function rr(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in pl}function $i(t,e){const n=new _o(pl,[],e?function(h){const _={color:me,string:oi,number:Rn,enum:oi,boolean:Cn,formatted:Yt,resolvedImage:$e};return"array"===h.type?ft(_[h.value]||ct,h.length):_[h.type]}(e):void 0),s=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?fl(new ai(s,e)):Rr(n.errors)}class Hi{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent="constant"!==e&&!ws(n.expression)}evaluateWithoutErrorHandling(e,n,s,h,_,x){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,h,_,x)}evaluate(e,n,s,h,_,x){return this._styleExpression.evaluate(e,n,s,h,_,x)}}class Xi{constructor(e,n,s,h){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent="camera"!==e&&!ws(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,n,s,h,_,x){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,h,_,x)}evaluate(e,n,s,h,_,x){return this._styleExpression.evaluate(e,n,s,h,_,x)}interpolationFactor(e,n,s){return this.interpolationType?Ri.interpolationFactor(this.interpolationType,e,n,s):0}}function ho(t,e){if("error"===(t=$i(t,e)).result)return t;const n=t.value.expression,s=Lo(n);if(!s&&!hs(e))return Rr([new mi("","data expressions not supported")]);const h=Cs(n,["zoom","pitch","distance-from-center"]);if(!h&&!Sr(e))return Rr([new mi("","zoom expressions not supported")]);const _=io(n);return _||h?_ instanceof mi?Rr([_]):_ instanceof Ri&&!fc(e)?Rr([new mi("",'"interpolate" expressions cannot be used with this property')]):fl(_?new Xi(s?"camera":"composite",t.value,_.labels,_ instanceof Ri?_.interpolation:void 0):new Hi(s?"constant":"source",t.value)):Rr([new mi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class sr{constructor(e,n){this._parameters=e,this._specification=n,no(this,ae(this._parameters,this._specification))}static deserialize(e){return new sr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function io(t){let e=null;if(t instanceof pc)e=io(t.result);else if(t instanceof ul){for(const n of t.args)if(e=io(n),e)break}else(t instanceof Yo||t instanceof Ri)&&t.input instanceof go&&"zoom"===t.input.name&&(e=t);return e instanceof mi||t.eachChild(n=>{const s=io(n);s instanceof mi?e=s:!e&&s?e=new mi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new mi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class $n{constructor(e,n,s,h){this.message=(e?`${e}: `:"")+s,h&&(this.identifier=h),null!=n&&n.__line__&&(this.line=n.__line__)}}function ro(t){const e=t.key,n=t.value,s=t.valueSpec||{},h=t.objectElementValidators||{},_=t.style,x=t.styleSpec;let T=[];const I=ur(n);if("object"!==I)return[new $n(e,n,`object expected, ${I} found`)];for(const A in n){const L=A.split(".")[0];let Z;h[L]?Z=h[L]:s[L]?Z=Fo:h["*"]?Z=h["*"]:s["*"]&&(Z=Fo),Z?T=T.concat(Z({key:(e&&`${e}.`)+A,value:n[A],valueSpec:s[L]||s["*"],style:_,styleSpec:x,object:n,objectKey:A},n)):T.push(new $n(e,n[A],`unknown property "${A}"`))}for(const A in s)h[A]||s[A].required&&void 0===s[A].default&&void 0===n[A]&&T.push(new $n(e,n,`missing required property "${A}"`));return T}function Bs(t){const e=t.value,n=t.valueSpec,s=t.style,h=t.styleSpec,_=t.key,x=t.arrayElementValidator||Fo;if("array"!==ur(e))return[new $n(_,e,`array expected, ${ur(e)} found`)];if(n.length&&e.length!==n.length)return[new $n(_,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new $n(_,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let T={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};h.$version<7&&(T.function=n.function),"object"===ur(n.value)&&(T=n.value);let I=[];for(let A=0;A<e.length;A++)I=I.concat(x({array:e,arrayIndex:A,value:e[A],valueSpec:T,style:s,styleSpec:h,key:`${_}[${A}]`}));return I}function _a(t){const e=t.key,n=t.value,s=t.valueSpec;let h=ur(n);if("number"===h&&n!=n&&(h="NaN"),"number"!==h)return[new $n(e,n,`number expected, ${h} found`)];if("minimum"in s){let _=s.minimum;if("array"===ur(s.minimum)&&(_=s.minimum[t.arrayIndex]),n<_)return[new $n(e,n,`${n} is less than the minimum value ${_}`)]}if("maximum"in s){let _=s.maximum;if("array"===ur(s.maximum)&&(_=s.maximum[t.arrayIndex]),n>_)return[new $n(e,n,`${n} is greater than the maximum value ${_}`)]}return[]}function Oa(t){const e=t.valueSpec,n=vr(t.value.type);let s,h,_,x={};const T="categorical"!==n&&void 0===t.value.property,I=!T,A="array"===ur(t.value.stops)&&"array"===ur(t.value.stops[0])&&"object"===ur(t.value.stops[0][0]),L=ro({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(J){if("identity"===n)return[new $n(J.key,J.value,'identity function may not have a "stops" property')];let ee=[];const pe=J.value;return ee=ee.concat(Bs({key:J.key,value:pe,valueSpec:J.valueSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:N})),"array"===ur(pe)&&0===pe.length&&ee.push(new $n(J.key,pe,"array must have at least one stop")),ee},default:function(J){return Fo({key:J.key,value:J.value,valueSpec:e,style:J.style,styleSpec:J.styleSpec})}}});return"identity"===n&&T&&L.push(new $n(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||L.push(new $n(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!fc(t.valueSpec)&&L.push(new $n(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(I&&!hs(t.valueSpec)?L.push(new $n(t.key,t.value,"property functions not supported")):T&&!Sr(t.valueSpec)&&L.push(new $n(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!A||void 0!==t.value.property||L.push(new $n(t.key,t.value,'"property" property is required')),L;function N(J){let ee=[];const pe=J.value,Pe=J.key;if("array"!==ur(pe))return[new $n(Pe,pe,`array expected, ${ur(pe)} found`)];if(2!==pe.length)return[new $n(Pe,pe,`array length 2 expected, length ${pe.length} found`)];if(A){if("object"!==ur(pe[0]))return[new $n(Pe,pe,`object expected, ${ur(pe[0])} found`)];if(void 0===pe[0].zoom)return[new $n(Pe,pe,"object stop key must have zoom")];if(void 0===pe[0].value)return[new $n(Pe,pe,"object stop key must have value")];const Qe=vr(pe[0].zoom);if("number"!=typeof Qe)return[new $n(Pe,pe[0].zoom,"stop zoom values must be numbers")];if(_&&_>Qe)return[new $n(Pe,pe[0].zoom,"stop zoom values must appear in ascending order")];Qe!==_&&(_=Qe,h=void 0,x={}),ee=ee.concat(ro({key:`${Pe}[0]`,value:pe[0],valueSpec:{zoom:{}},style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:_a,value:Z}}))}else ee=ee.concat(Z({key:`${Pe}[0]`,value:pe[0],valueSpec:{},style:J.style,styleSpec:J.styleSpec},pe));return rr(eo(pe[1]))?ee.concat([new $n(`${Pe}[1]`,pe[1],"expressions are not allowed in function stops.")]):ee.concat(Fo({key:`${Pe}[1]`,value:pe[1],valueSpec:e,style:J.style,styleSpec:J.styleSpec}))}function Z(J,ee){const pe=ur(J.value),Pe=vr(J.value),Qe=null!==J.value?J.value:ee;if(s){if(pe!==s)return[new $n(J.key,Qe,`${pe} stop domain type must match previous stop domain type ${s}`)]}else s=pe;if("number"!==pe&&"string"!==pe&&"boolean"!==pe&&"number"!=typeof Pe&&"string"!=typeof Pe&&"boolean"!=typeof Pe)return[new $n(J.key,Qe,"stop domain value must be a number, string, or boolean")];if("number"!==pe&&"categorical"!==n){let ut=`number expected, ${pe} found`;return hs(e)&&void 0===n&&(ut+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $n(J.key,Qe,ut)]}return"categorical"!==n||"number"!==pe||"number"==typeof Pe&&isFinite(Pe)&&Math.floor(Pe)===Pe?"categorical"!==n&&"number"===pe&&"number"==typeof Pe&&"number"==typeof h&&void 0!==h&&Pe<h?[new $n(J.key,Qe,"stop domain values must appear in ascending order")]:(h=Pe,"categorical"===n&&Pe in x?[new $n(J.key,Qe,"stop domain values must be unique")]:(x[Pe]=!0,[])):[new $n(J.key,Qe,`integer expected, found ${String(Pe)}`)]}}function Qs(t){const e=("property"===t.expressionContext?ho:$i)(eo(t.value),t.valueSpec);if("error"===e.result)return e.value.map(s=>new $n(`${t.key}${s.key}`,t.value,s.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new $n(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!ws(n))return[new $n(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return ml(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Cs(n,["zoom","feature-state"]))return[new $n(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Lo(n))return[new $n(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ml(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const h of e.valueSpec.expression.parameters)n.delete(h);if(0===n.size)return[];const s=[];return t instanceof go&&n.has(t.name)?[new $n(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(h=>{s.push(...ml(h,e))}),s)}function ya(t){const e=t.key,n=t.value,s=t.valueSpec,h=[];return Array.isArray(s.values)?-1===s.values.indexOf(vr(n))&&h.push(new $n(e,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(s.values).indexOf(vr(n))&&h.push(new $n(e,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function gl(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!gl(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Ra(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};gl(t)||(t=Ja(t));const n=t;let s=!0;try{s=function(A){if(!La(A))return A;let L=eo(A);return _l(L),L=lo(L),L}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const h=Xt[`filter_${e}`],_=$i(s,h);let x=null;if("error"===_.result)throw new Error(_.value.map(A=>`${A.key}: ${A.message}`).join(", "));x=(A,L,N)=>_.value.evaluate(A,L,{},N);let T=null,I=null;if(s!==n){const A=$i(n,h);if("error"===A.result)throw new Error(A.value.map(L=>`${L.key}: ${L.message}`).join(", "));T=(L,N,Z,J,ee)=>A.value.evaluate(L,N,{},Z,void 0,void 0,J,ee),I=!Lo(A.value.expression)}return{filter:x,dynamicFilter:T||void 0,needGeometry:gc(s),needFeature:!!I}}function lo(t){if(!Array.isArray(t))return t;const e=function(n){if(mc.has(n[0]))for(let s=1;s<n.length;s++)if(La(n[s]))return!0;return n}(t);return!0===e?e:e.map(n=>lo(n))}function _l(t){let e=!1;const n=[];if("case"===t[0]){for(let s=1;s<t.length-1;s+=2)e=e||La(t[s]),n.push(t[s+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||La(t[1]);for(let s=2;s<t.length-1;s+=2)n.push(t[s+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||La(t[1]);for(let s=1;s<t.length-1;s+=2)n.push(t[s+1])}e&&(t.length=0,t.push("any",...n));for(let s=1;s<t.length;s++)_l(t[s])}function La(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let n=1;n<t.length;n++)if(La(t[n]))return!0;return!1}const mc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function yl(t,e){return t<e?-1:t>e?1:0}function gc(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(gc(t[e]))return!0;return!1}function Ja(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Yl(t[1],t[2],"=="):"!="===e?yc(Yl(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Yl(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(Ja))):"all"===e?["all"].concat(t.slice(1).map(Ja)):"none"===e?["all"].concat(t.slice(1).map(Ja).map(yc)):"in"===e?_c(t[1],t.slice(2)):"!in"===e?yc(_c(t[1],t.slice(2))):"has"===e?Ns(t[1]):"!has"===e?yc(Ns(t[1])):"within"!==e||t;var n}function Yl(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function _c(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(yl)]]:["filter-in-small",t,["literal",e]]}}function Ns(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function yc(t){return["!",t]}function Xa(t){return gl(eo(t.value))?Qs(no({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):vc(t)}function vc(t){const e=t.value,n=t.key;if("array"!==ur(e))return[new $n(n,e,`array expected, ${ur(e)} found`)];const s=t.styleSpec;let h,_=[];if(e.length<1)return[new $n(n,e,"filter array must have at least 1 element")];switch(_=_.concat(ya({key:`${n}[0]`,value:e[0],valueSpec:s.filter_operator,style:t.style,styleSpec:t.styleSpec})),vr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===vr(e[1])&&_.push(new $n(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&_.push(new $n(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=ur(e[1]),"string"!==h&&_.push(new $n(`${n}[1]`,e[1],`string expected, ${h} found`)));for(let x=2;x<e.length;x++)h=ur(e[x]),"$type"===vr(e[1])?_=_.concat(ya({key:`${n}[${x}]`,value:e[x],valueSpec:s.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&_.push(new $n(`${n}[${x}]`,e[x],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let x=1;x<e.length;x++)_=_.concat(vc({key:`${n}[${x}]`,value:e[x],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":h=ur(e[1]),2!==e.length?_.push(new $n(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==h&&_.push(new $n(`${n}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=ur(e[1]),2!==e.length?_.push(new $n(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==h&&_.push(new $n(`${n}[1]`,e[1],`object expected, ${h} found`))}return _}function vl(t,e){const n=t.key,s=t.style,h=t.styleSpec,_=t.value,x=t.objectKey,T=h[`${e}_${t.layerType}`];if(!T)return[];const I=x.match(/^(.*)-transition$/);if("paint"===e&&I&&T[I[1]]&&T[I[1]].transition)return Fo({key:n,value:_,valueSpec:h.transition,style:s,styleSpec:h});const A=t.valueSpec||T[x];if(!A)return[new $n(n,_,`unknown property "${x}"`)];let L;if("string"===ur(_)&&hs(A)&&!A.tokens&&(L=/^{([^}]+)}$/.exec(_)))return[new $n(n,_,`"${x}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const N=[];return"symbol"===t.layerType&&("text-field"===x&&s&&!s.glyphs&&N.push(new $n(n,_,'use of "text-field" requires a style "glyphs" property')),"text-font"===x&&Pl(eo(_))&&"identity"===vr(_.type)&&N.push(new $n(n,_,'"text-font" does not support identity functions'))),N.concat(Fo({key:t.key,value:_,valueSpec:A,style:s,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:x}))}function Jl(t){return vl(t,"paint")}function xc(t){return vl(t,"layout")}function Xl(t){let e=[];const n=t.value,s=t.key,h=t.style,_=t.styleSpec;n.type||n.ref||e.push(new $n(s,n,'either "type" or "ref" is required'));let x=vr(n.type);const T=vr(n.ref);if(n.id){const I=vr(n.id);for(let A=0;A<t.arrayIndex;A++){const L=h.layers[A];vr(L.id)===I&&e.push(new $n(s,n.id,`duplicate layer id "${n.id}", previously used at line ${L.id.__line__}`))}}if("ref"in n){let I;["type","source","source-layer","filter","layout"].forEach(A=>{A in n&&e.push(new $n(s,n[A],`"${A}" is prohibited for ref layers`))}),h.layers.forEach(A=>{vr(A.id)===T&&(I=A)}),I?I.ref?e.push(new $n(s,n.ref,"ref cannot reference another ref layer")):x=vr(I.type):"string"==typeof T&&e.push(new $n(s,n.ref,`ref layer "${T}" not found`))}else if("background"!==x&&"sky"!==x)if(n.source){const I=h.sources&&h.sources[n.source],A=I&&vr(I.type);I?"vector"===A&&"raster"===x?e.push(new $n(s,n.source,`layer "${n.id}" requires a raster source`)):"raster"===A&&"raster"!==x?e.push(new $n(s,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==A||n["source-layer"]?"raster-dem"===A&&"hillshade"!==x?e.push(new $n(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==x||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===A&&I.lineMetrics||e.push(new $n(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new $n(s,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new $n(s,n.source,`source "${n.source}" not found`))}else e.push(new $n(s,n,'missing required property "source"'));return e=e.concat(ro({key:s,value:n,valueSpec:_.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Fo({key:`${s}.type`,value:n.type,valueSpec:_.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:I=>Xa(no({layerType:x},I)),layout:I=>ro({layer:n,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":A=>xc(no({layerType:x},A))}}),paint:I=>ro({layer:n,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":A=>Jl(no({layerType:x},A))}})}})),e}function va(t){const e=t.value,n=t.key,s=ur(e);return"string"!==s?[new $n(n,e,`string expected, ${s} found`)]:[]}const bc={promoteId:function({key:t,value:e}){if("string"===ur(e))return va({key:t,value:e});{const n=[];for(const s in e)n.push(...va({key:`${t}.${s}`,value:e[s]}));return n}}};function Bc(t){const e=t.value,n=t.key,s=t.styleSpec,h=t.style;if(!e.type)return[new $n(n,e,'"type" is required')];const _=vr(e.type);let x;switch(_){case"vector":case"raster":case"raster-dem":return x=ro({key:n,value:e,valueSpec:s[`source_${_.replace("-","_")}`],style:t.style,styleSpec:s,objectElementValidators:bc}),x;case"geojson":if(x=ro({key:n,value:e,valueSpec:s.source_geojson,style:h,styleSpec:s,objectElementValidators:bc}),e.cluster)for(const T in e.clusterProperties){const[I,A]=e.clusterProperties[T],L="string"==typeof I?[I,["accumulated"],["get",T]]:I;x.push(...Qs({key:`${n}.${T}.map`,value:A,expressionContext:"cluster-map"})),x.push(...Qs({key:`${n}.${T}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return x;case"video":return ro({key:n,value:e,valueSpec:s.source_video,style:h,styleSpec:s});case"image":return ro({key:n,value:e,valueSpec:s.source_image,style:h,styleSpec:s});case"canvas":return[new $n(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ya({key:`${n}.type`,value:e.type,valueSpec:{values:Nc(s)},style:h,styleSpec:s})}}function Nc(t){return t.source.reduce((e,n)=>{const s=t[n];return"enum"===s.type.type&&(e=e.concat(Object.keys(s.type.values))),e},[])}function Qo(t){const e=t.value,n=t.styleSpec,s=n.light,h=t.style;let _=[];const x=ur(e);if(void 0===e)return _;if("object"!==x)return _=_.concat([new $n("light",e,`object expected, ${x} found`)]),_;for(const T in e){const I=T.match(/^(.*)-transition$/);_=_.concat(I&&s[I[1]]&&s[I[1]].transition?Fo({key:T,value:e[T],valueSpec:n.transition,style:h,styleSpec:n}):s[T]?Fo({key:T,value:e[T],valueSpec:s[T],style:h,styleSpec:n}):[new $n(T,e[T],`unknown property "${T}"`)])}return _}function xl(t){const e=t.value,n=t.key,s=t.style,h=t.styleSpec,_=h.terrain;let x=[];const T=ur(e);if(void 0===e)return x;if("object"!==T)return x=x.concat([new $n("terrain",e,`object expected, ${T} found`)]),x;for(const I in e){const A=I.match(/^(.*)-transition$/);x=x.concat(A&&_[A[1]]&&_[A[1]].transition?Fo({key:I,value:e[I],valueSpec:h.transition,style:s,styleSpec:h}):_[I]?Fo({key:I,value:e[I],valueSpec:_[I],style:s,styleSpec:h}):[new $n(I,e[I],`unknown property "${I}"`)])}if(e.source){const I=s.sources&&s.sources[e.source],A=I&&vr(I.type);I?"raster-dem"!==A&&x.push(new $n(n,e.source,`terrain cannot be used with a source of type ${String(A)}, it only be used with a "raster-dem" source type`)):x.push(new $n(n,e.source,`source "${e.source}" not found`))}else x.push(new $n(n,e,'terrain is missing required property "source"'));return x}function ea(t){const e=t.value,n=t.style,s=t.styleSpec,h=s.fog;let _=[];const x=ur(e);if(void 0===e)return _;if("object"!==x)return _=_.concat([new $n("fog",e,`object expected, ${x} found`)]),_;for(const T in e){const I=T.match(/^(.*)-transition$/);_=_.concat(I&&h[I[1]]&&h[I[1]].transition?Fo({key:T,value:e[T],valueSpec:s.transition,style:n,styleSpec:s}):h[T]?Fo({key:T,value:e[T],valueSpec:h[T],style:n,styleSpec:s}):[new $n(T,e[T],`unknown property "${T}"`)])}return _}const Iu={"*":()=>[],array:Bs,boolean:function(t){const e=t.value,n=t.key,s=ur(e);return"boolean"!==s?[new $n(n,e,`boolean expected, ${s} found`)]:[]},number:_a,color:function(t){const e=t.key,n=t.value,s=ur(n);return"string"!==s?[new $n(e,n,`color expected, ${s} found`)]:null===Mi(n)?[new $n(e,n,`color expected, "${n}" found`)]:[]},enum:ya,filter:Xa,function:Oa,layer:Xl,object:ro,source:Bc,light:Qo,terrain:xl,fog:ea,string:va,formatted:function(t){return 0===va(t).length?[]:Qs(t)},resolvedImage:function(t){return 0===va(t).length?[]:Qs(t)},projection:function(t){const e=t.value,n=t.styleSpec,s=n.projection,h=t.style;let _=[];const x=ur(e);if("object"===x)for(const T in e)_=_.concat(Fo({key:T,value:e[T],valueSpec:s[T],style:h,styleSpec:n}));else"string"!==x&&(_=_.concat([new $n("projection",e,`object or string expected, ${x} found`)]));return _}};function Fo(t){const e=t.value,n=t.valueSpec,s=t.styleSpec;return n.expression&&Pl(vr(e))?Oa(t):n.expression&&rr(eo(e))?Qs(t):n.type&&Iu[n.type]?Iu[n.type](t):ro(no({},t,{valueSpec:n.type?s[n.type]:n}))}function zc(t){const e=t.value,n=t.key,s=va(t);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new $n(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new $n(n,e,'"glyphs" url must include a "{range}" token'))),s}function bl(t,e=Xt){return Is(Fo({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:zc,"*":()=>[]}}))}const Xd=t=>Is(Jl(t)),Mu=t=>Is(xc(t));function Is(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function Uc(t,e){let n=!1;if(e&&e.length)for(const s of e)t.fire(new Tr(new Error(s.message))),n=!0;return n}var zs=ta;function ta(t,e,n){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var h=new Int32Array(this.arrayBuffer);t=h[0],this.d=(e=h[1])+2*(n=h[2]);for(var _=0;_<this.d*this.d;_++){var x=h[3+_],T=h[3+_+1];s.push(x===T?null:h.subarray(x,T))}var I=h[3+s.length+1];this.keys=h.subarray(h[3+s.length],I),this.bboxes=h.subarray(I),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var A=0;A<this.d*this.d;A++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var L=n/e*t;this.min=-L,this.max=t+L}ta.prototype.insert=function(t,e,n,s,h){this._forEachCell(e,n,s,h,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(h)},ta.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ta.prototype._insertCell=function(t,e,n,s,h,_){this.cells[h].push(_)},ta.prototype.query=function(t,e,n,s,h){var _=this.min,x=this.max;if(t<=_&&e<=_&&x<=n&&x<=s&&!h)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(t,e,n,s,this._queryCell,T,{},h),T},ta.prototype._queryCell=function(t,e,n,s,h,_,x,T){var I=this.cells[h];if(null!==I)for(var A=this.keys,L=this.bboxes,N=0;N<I.length;N++){var Z=I[N];if(void 0===x[Z]){var J=4*Z;(T?T(L[J+0],L[J+1],L[J+2],L[J+3]):t<=L[J+2]&&e<=L[J+3]&&n>=L[J+0]&&s>=L[J+1])?(x[Z]=!0,_.push(A[Z])):x[Z]=!1}}},ta.prototype._forEachCell=function(t,e,n,s,h,_,x,T){for(var I=this._convertToCellCoord(t),A=this._convertToCellCoord(e),L=this._convertToCellCoord(n),N=this._convertToCellCoord(s),Z=I;Z<=L;Z++)for(var J=A;J<=N;J++){var ee=this.d*J+Z;if((!T||T(this._convertFromCellCoord(Z),this._convertFromCellCoord(J),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(J+1)))&&h.call(this,t,e,n,s,ee,_,x,T))return}},ta.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ta.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ta.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var h=new Int32Array(e+n+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var _=e,x=0;x<t.length;x++){var T=t[x];h[3+x]=_,h.set(T,_),_+=T.length}return h[3+t.length]=_,h.set(this.keys,_),h[3+t.length+1]=_+=this.keys.length,h.set(this.bboxes,_),_+=this.bboxes.length,h.buffer};const xa={};function Zn(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),xa[e]={klass:t,omit:n.omit||[]}}Zn(Object,"Object"),zs.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},zs.deserialize=function(t){return new zs(t.buffer)},Object.defineProperty(zs,"name",{value:"Grid"}),Zn(zs,"Grid"),Zn(lr,"Color"),Zn(Error,"Error"),Zn(ne,"AJAXError"),Zn(fo,"ResolvedImage"),Zn(sr,"StylePropertyFunction"),Zn(ai,"StyleExpression",{omit:["_evaluator"]}),Zn(Xi,"ZoomDependentExpression"),Zn(Hi,"ZoomConstantExpression"),Zn(go,"CompoundExpression",{omit:["_evaluate"]});for(const t in pl)xa[pl[t]._classRegistryKey]||Zn(pl[t],`Expression${t}`);function Fa(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Vc(t){return q.ImageBitmap&&t instanceof q.ImageBitmap}function ka(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Fa(t)||Vc(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof q.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const s of t)n.push(ka(s,e));return n}if("object"==typeof t){const n=t.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const h=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const _ in t)t.hasOwnProperty(_)&&(xa[s].omit.indexOf(_)>=0||(h[_]=ka(t[_],e)));t instanceof Error&&(h.message=t.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(h.$name=s),h}throw new Error("can't serialize object of type "+typeof t)}function Ba(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Fa(t)||Vc(t)||ArrayBuffer.isView(t)||t instanceof q.ImageData)return t;if(Array.isArray(t))return t.map(Ba);if("object"==typeof t){const e=t.$name||"Object",{klass:n}=xa[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const s=Object.create(n.prototype);for(const h of Object.keys(t))"$name"!==h&&(s[h]=Ba(t[h]));return s}throw new Error("can't deserialize object of type "+typeof t)}const jc=t=>t>=1536&&t<=1791,$c=t=>t>=1872&&t<=1919,Ar=t=>t>=2208&&t<=2303,Su=t=>t>=11904&&t<=12031,Au=t=>t>=12032&&t<=12255,Pu=t=>t>=12272&&t<=12287,Ol=t=>t>=12288&&t<=12351,wc=t=>t>=12352&&t<=12447,Ou=t=>t>=12448&&t<=12543,Kd=t=>t>=12544&&t<=12591,na=t=>t>=12704&&t<=12735,Qd=t=>t>=12736&&t<=12783,Ru=t=>t>=12784&&t<=12799,xo=t=>t>=12800&&t<=13055,Cc=t=>t>=13056&&t<=13311,Rl=t=>t>=13312&&t<=19903,Zc=t=>t>=19968&&t<=40959,Ms=t=>t>=40960&&t<=42127,Ka=t=>t>=42128&&t<=42191,Tc=t=>t>=44032&&t<=55215,Qa=t=>t>=63744&&t<=64255,m=t=>t>=64336&&t<=65023,i=t=>t>=65040&&t<=65055,u=t=>t>=65072&&t<=65103,a=t=>t>=65104&&t<=65135,f=t=>t>=65136&&t<=65279,p=t=>t>=65280&&t<=65519;function v(t){for(const e of t)if(P(e.charCodeAt(0)))return!0;return!1}function C(t){for(const e of t)if(!D(e.charCodeAt(0)))return!1;return!0}function D(t){return!(jc(t)||$c(t)||Ar(t)||m(t)||f(t))}function P(t){return!(746!==t&&747!==t&&(t<4352||!(na(t)||Kd(t)||u(t)&&!(t>=65097&&t<=65103)||Qa(t)||Cc(t)||Su(t)||Qd(t)||!(!Ol(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Rl(t)||Zc(t)||xo(t)||(e=t,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||Tc(t)||wc(t)||Pu(t)||(e=>e>=12688&&e<=12703)(t)||Au(t)||Ru(t)||Ou(t)&&12540!==t||!(!p(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!a(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||i(t)||(e=>e>=19904&&e<=19967)(t)||Ms(t)||Ka(t))));var e}function F(t){return!(P(t)||(e=t,(n=e)>=128&&n<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(n=>n>=8192&&n<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&9251!==e||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ol(e)||Ou(e)||(n=>n>=57344&&n<=63743)(e)||u(e)||a(e)||p(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,n}function W(t){return t>=1424&&t<=2303||m(t)||f(t)}function ue(t,e){return!(!e&&W(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(n=t,n>=6016&&n<=6143));var n}function Te(t){for(const e of t)if(W(e.charCodeAt(0)))return!0;return!1}const Re="deferred",je="loading",Le="loaded";let Fe=null,qe="unavailable",Ze=null;const rt=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(qe="error"),Fe&&Fe(t)};function _t(){xt.fire(new Gr("pluginStateChange",{pluginStatus:qe,pluginURL:Ze}))}const xt=new Or,Lt=function(){return qe},en=function(){if(qe!==Re||!Ze)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");qe=je,_t(),Ze&&Qt({url:Ze},t=>{t?rt(t):(qe=Le,_t())})},Wt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>qe===Le||null!=Wt.applyArabicShaping,isLoading:()=>qe===je,setState(t){qe=t.pluginStatus,Ze=t.pluginURL},isParsed:()=>null!=Wt.applyArabicShaping&&null!=Wt.processBidirectionalText&&null!=Wt.processStyledBidirectionalText,getPluginURL:()=>Ze};class Ut{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,s){for(const h of n)if(!ue(h.charCodeAt(0),s))return!1;return!0}(e,Wt.isLoaded())}}class Ln{constructor(e,n){this.property=e,this.value=n,this.expression=function(s,h){if(Pl(s))return new sr(s,h);if(rr(s)){const _=ho(s,h);if("error"===_.result)throw new Error(_.value.map(x=>`${x.key}: ${x.message}`).join(", "));return _.value}{let _=s;return"string"==typeof s&&"color"===h.type&&(_=lr.parse(s)),{kind:"constant",evaluate:()=>_}}}(void 0===n?e.specification.default:n,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class Ht{constructor(e){this.property=e,this.value=new Ln(e,void 0)}transitioned(e,n){return new tn(this.property,this.value,n,Tt({},e.transition,this.transition),e.now)}untransitioned(){return new tn(this.property,this.value,null,{},0)}}class fn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return kt(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Ht(this._values[e].property)),this._values[e].value=new Ln(this._values[e].property,null===n?void 0:kt(n))}getTransition(e){return kt(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Ht(this._values[e].property)),this._values[e].transition=kt(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s);const h=this.getTransition(n);void 0!==h&&(e[`${n}-transition`]=h)}return e}transitioned(e,n){const s=new An(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].transitioned(e,n._values[h]);return s}untransitioned(){const e=new An(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class tn{constructor(e,n,s,h,_){const x=h.delay||0,T=h.duration||0;_=_||0,this.property=e,this.value=n,this.begin=_+x,this.end=this.begin+T,e.specification.transition&&(h.delay||h.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const h=e.now||0,_=this.value.possiblyEvaluate(e,n,s),x=this.prior;if(x){if(h>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(h<this.begin)return x.possiblyEvaluate(e,n,s);{const T=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(e,n,s),_,we(T))}}return _}}class An{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const h=new kn(this._properties);for(const _ of Object.keys(this._values))h._values[_]=this._values[_].possiblyEvaluate(e,n,s);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ln{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return kt(this._values[e].value)}setValue(e,n){this._values[e]=new Ln(this._values[e].property,null===n?void 0:kt(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const h=new kn(this._properties);for(const _ of Object.keys(this._values))h._values[_]=this._values[_].possiblyEvaluate(e,n,s);return h}}class xn{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,n,s,h){return this.property.evaluate(this.value,this.parameters,e,n,s,h)}}class kn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class $t{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,s){const h=Sa[this.specification.type];return h?h(e,n,s):e}}class rn{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,h){return new xn(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(n,null,{},s,h)}:e.expression,n)}interpolate(e,n,s){if("constant"!==e.value.kind||"constant"!==n.value.kind)return e;if(void 0===e.value.value||void 0===n.value.value)return new xn(this,{kind:"constant",value:void 0},e.parameters);const h=Sa[this.specification.type];return h?new xn(this,{kind:"constant",value:h(e.value.value,n.value.value,s)},e.parameters):e}evaluate(e,n,s,h,_,x){return"constant"===e.kind?e.value:e.evaluate(n,s,h,_,x)}}class ni{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,h){return!!e.expression.evaluate(n,null,{},s,h)}interpolate(){return!1}}class hi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Ut(0,{});for(const s in e){const h=e[s];h.specification.overridable&&this.overridableProperties.push(s);const _=this.defaultPropertyValues[s]=new Ln(h,void 0),x=this.defaultTransitionablePropertyValues[s]=new Ht(h);this.defaultTransitioningPropertyValues[s]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=_.possiblyEvaluate(n)}}}function Qn(t,e){return 256*(t=ge(Math.floor(t),0,255))+ge(Math.floor(e),0,255)}Zn(rn,"DataDrivenProperty"),Zn($t,"DataConstantProperty"),Zn(ni,"ColorRampProperty");const Ci={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Zi{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ui{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Xn(t,e=1){let n=0,s=0;return{members:t.map(h=>{const _=Ci[h.type].BYTES_PER_ELEMENT,x=n=Ir(n,Math.max(e,_)),T=h.components||1;return s=Math.max(s,_),n+=_*T,{name:h.name,type:h.type,components:T,offset:x}}),size:Ir(n,Math.max(s,e)),alignment:e}}function Ir(t,e){return Math.ceil(t/e)*e}class br extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.int16[h+0]=n,this.int16[h+1]=s,e}}br.prototype.bytesPerElement=4,Zn(br,"StructArrayLayout2i4");class Br extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const _=3*e;return this.int16[_+0]=n,this.int16[_+1]=s,this.int16[_+2]=h,e}}Br.prototype.bytesPerElement=6,Zn(Br,"StructArrayLayout3i6");class Lr extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,h)}emplace(e,n,s,h,_){const x=4*e;return this.int16[x+0]=n,this.int16[x+1]=s,this.int16[x+2]=h,this.int16[x+3]=_,e}}Lr.prototype.bytesPerElement=8,Zn(Lr,"StructArrayLayout4i8");class ps extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,_,x,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,s,h,_,x,T)}emplace(e,n,s,h,_,x,T,I){const A=6*e,L=12*e,N=3*e;return this.int16[A+0]=n,this.int16[A+1]=s,this.uint8[L+4]=h,this.uint8[L+5]=_,this.uint8[L+6]=x,this.uint8[L+7]=T,this.float32[N+2]=I,e}}ps.prototype.bytesPerElement=12,Zn(ps,"StructArrayLayout2i4ub1f12");class ba extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,h)}emplace(e,n,s,h,_){const x=4*e;return this.float32[x+0]=n,this.float32[x+1]=s,this.float32[x+2]=h,this.float32[x+3]=_,e}}ba.prototype.bytesPerElement=16,Zn(ba,"StructArrayLayout4f16");class Us extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,s,h,_)}emplace(e,n,s,h,_,x){const T=6*e,I=3*e;return this.uint16[T+0]=n,this.uint16[T+1]=s,this.uint16[T+2]=h,this.uint16[T+3]=_,this.float32[I+2]=x,e}}Us.prototype.bytesPerElement=12,Zn(Us,"StructArrayLayout4ui1f12");class wa extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,h)}emplace(e,n,s,h,_){const x=4*e;return this.uint16[x+0]=n,this.uint16[x+1]=s,this.uint16[x+2]=h,this.uint16[x+3]=_,e}}wa.prototype.bytesPerElement=8,Zn(wa,"StructArrayLayout4ui8");class Kr extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,s,h,_,x)}emplace(e,n,s,h,_,x,T){const I=6*e;return this.int16[I+0]=n,this.int16[I+1]=s,this.int16[I+2]=h,this.int16[I+3]=_,this.int16[I+4]=x,this.int16[I+5]=T,e}}Kr.prototype.bytesPerElement=12,Zn(Kr,"StructArrayLayout6i12");class Vr extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,_,x,T,I,A,L,N,Z){const J=this.length;return this.resize(J+1),this.emplace(J,e,n,s,h,_,x,T,I,A,L,N,Z)}emplace(e,n,s,h,_,x,T,I,A,L,N,Z,J){const ee=12*e;return this.int16[ee+0]=n,this.int16[ee+1]=s,this.int16[ee+2]=h,this.int16[ee+3]=_,this.uint16[ee+4]=x,this.uint16[ee+5]=T,this.uint16[ee+6]=I,this.uint16[ee+7]=A,this.int16[ee+8]=L,this.int16[ee+9]=N,this.int16[ee+10]=Z,this.int16[ee+11]=J,e}}Vr.prototype.bytesPerElement=24,Zn(Vr,"StructArrayLayout4i4ui4i24");class _r extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,s,h,_,x)}emplace(e,n,s,h,_,x,T){const I=10*e,A=5*e;return this.int16[I+0]=n,this.int16[I+1]=s,this.int16[I+2]=h,this.float32[A+2]=_,this.float32[A+3]=x,this.float32[A+4]=T,e}}_r.prototype.bytesPerElement=20,Zn(_r,"StructArrayLayout3i3f20");class To extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}To.prototype.bytesPerElement=4,Zn(To,"StructArrayLayout1ul4");class Ss extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,_,x,T,I,A,L,N,Z,J){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,n,s,h,_,x,T,I,A,L,N,Z,J)}emplace(e,n,s,h,_,x,T,I,A,L,N,Z,J,ee){const pe=20*e,Pe=10*e;return this.int16[pe+0]=n,this.int16[pe+1]=s,this.int16[pe+2]=h,this.int16[pe+3]=_,this.int16[pe+4]=x,this.float32[Pe+3]=T,this.float32[Pe+4]=I,this.float32[Pe+5]=A,this.float32[Pe+6]=L,this.int16[pe+14]=N,this.uint32[Pe+8]=Z,this.uint16[pe+18]=J,this.uint16[pe+19]=ee,e}}Ss.prototype.bytesPerElement=40,Zn(Ss,"StructArrayLayout5i4f1i1ul2ui40");class jr extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,_,x,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,s,h,_,x,T)}emplace(e,n,s,h,_,x,T,I){const A=8*e;return this.int16[A+0]=n,this.int16[A+1]=s,this.int16[A+2]=h,this.int16[A+4]=_,this.int16[A+5]=x,this.int16[A+6]=T,this.int16[A+7]=I,e}}jr.prototype.bytesPerElement=16,Zn(jr,"StructArrayLayout3i2i2i16");class fs extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,s,h,_)}emplace(e,n,s,h,_,x){const T=4*e,I=8*e;return this.float32[T+0]=n,this.float32[T+1]=s,this.float32[T+2]=h,this.int16[I+6]=_,this.int16[I+7]=x,e}}fs.prototype.bytesPerElement=16,Zn(fs,"StructArrayLayout2f1f2i16");class Kl extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,h)}emplace(e,n,s,h,_){const x=12*e,T=3*e;return this.uint8[x+0]=n,this.uint8[x+1]=s,this.float32[T+1]=h,this.float32[T+2]=_,e}}Kl.prototype.bytesPerElement=12,Zn(Kl,"StructArrayLayout2ub2f12");class el extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const _=3*e;return this.float32[_+0]=n,this.float32[_+1]=s,this.float32[_+2]=h,e}}el.prototype.bytesPerElement=12,Zn(el,"StructArrayLayout3f12");class es extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const _=3*e;return this.uint16[_+0]=n,this.uint16[_+1]=s,this.uint16[_+2]=h,e}}es.prototype.bytesPerElement=6,Zn(es,"StructArrayLayout3ui6");class ia extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,_,x,T,I,A,L,N,Z,J,ee,pe,Pe,Qe,ut,et,st,Ct){const mt=this.length;return this.resize(mt+1),this.emplace(mt,e,n,s,h,_,x,T,I,A,L,N,Z,J,ee,pe,Pe,Qe,ut,et,st,Ct)}emplace(e,n,s,h,_,x,T,I,A,L,N,Z,J,ee,pe,Pe,Qe,ut,et,st,Ct,mt){const Kt=30*e,qt=15*e,mn=60*e;return this.int16[Kt+0]=n,this.int16[Kt+1]=s,this.int16[Kt+2]=h,this.float32[qt+2]=_,this.float32[qt+3]=x,this.uint16[Kt+8]=T,this.uint16[Kt+9]=I,this.uint32[qt+5]=A,this.uint32[qt+6]=L,this.uint32[qt+7]=N,this.uint16[Kt+16]=Z,this.uint16[Kt+17]=J,this.uint16[Kt+18]=ee,this.float32[qt+10]=pe,this.float32[qt+11]=Pe,this.uint8[mn+48]=Qe,this.uint8[mn+49]=ut,this.uint8[mn+50]=et,this.uint32[qt+13]=st,this.int16[Kt+28]=Ct,this.uint8[mn+58]=mt,e}}ia.prototype.bytesPerElement=60,Zn(ia,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ko extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,_,x,T,I,A,L,N,Z,J,ee,pe,Pe,Qe,ut,et,st,Ct,mt,Kt,qt,mn,Mn,an,_n,vn,In){const On=this.length;return this.resize(On+1),this.emplace(On,e,n,s,h,_,x,T,I,A,L,N,Z,J,ee,pe,Pe,Qe,ut,et,st,Ct,mt,Kt,qt,mn,Mn,an,_n,vn,In)}emplace(e,n,s,h,_,x,T,I,A,L,N,Z,J,ee,pe,Pe,Qe,ut,et,st,Ct,mt,Kt,qt,mn,Mn,an,_n,vn,In,On){const sn=38*e,Gn=19*e;return this.int16[sn+0]=n,this.int16[sn+1]=s,this.int16[sn+2]=h,this.float32[Gn+2]=_,this.float32[Gn+3]=x,this.int16[sn+8]=T,this.int16[sn+9]=I,this.int16[sn+10]=A,this.int16[sn+11]=L,this.int16[sn+12]=N,this.int16[sn+13]=Z,this.uint16[sn+14]=J,this.uint16[sn+15]=ee,this.uint16[sn+16]=pe,this.uint16[sn+17]=Pe,this.uint16[sn+18]=Qe,this.uint16[sn+19]=ut,this.uint16[sn+20]=et,this.uint16[sn+21]=st,this.uint16[sn+22]=Ct,this.uint16[sn+23]=mt,this.uint16[sn+24]=Kt,this.uint16[sn+25]=qt,this.uint16[sn+26]=mn,this.uint16[sn+27]=Mn,this.uint16[sn+28]=an,this.uint32[Gn+15]=_n,this.float32[Gn+16]=vn,this.float32[Gn+17]=In,this.float32[Gn+18]=On,e}}ko.prototype.bytesPerElement=76,Zn(ko,"StructArrayLayout3i2f6i15ui1ul3f76");class tl extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}tl.prototype.bytesPerElement=4,Zn(tl,"StructArrayLayout1f4");class Gc extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,s,h,_)}emplace(e,n,s,h,_,x){const T=5*e;return this.float32[T+0]=n,this.float32[T+1]=s,this.float32[T+2]=h,this.float32[T+3]=_,this.float32[T+4]=x,e}}Gc.prototype.bytesPerElement=20,Zn(Gc,"StructArrayLayout5f20");class Ec extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,h)}emplace(e,n,s,h,_){const x=6*e;return this.uint32[3*e+0]=n,this.uint16[x+2]=s,this.uint16[x+3]=h,this.uint16[x+4]=_,e}}Ec.prototype.bytesPerElement=12,Zn(Ec,"StructArrayLayout1ul3ui12");class Na extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.uint16[h+0]=n,this.uint16[h+1]=s,e}}Na.prototype.bytesPerElement=4,Zn(Na,"StructArrayLayout2ui4");class Hc extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Hc.prototype.bytesPerElement=2,Zn(Hc,"StructArrayLayout1ui2");class eh extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.float32[h+0]=n,this.float32[h+1]=s,e}}eh.prototype.bytesPerElement=8,Zn(eh,"StructArrayLayout2f8");class Kf extends Zi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Kf.prototype.size=40;class up extends Ss{get(e){return new Kf(this,e)}}Zn(up,"CollisionBoxArray");class dp extends Zi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}dp.prototype.size=60;class Qf extends ia{get(e){return new dp(this,e)}}Zn(Qf,"PlacedSymbolArray");class em extends Zi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}em.prototype.size=76;class ra extends ko{get(e){return new em(this,e)}}Zn(ra,"SymbolInstanceArray");class th extends tl{getoffsetX(e){return this.float32[1*e+0]}}Zn(th,"GlyphOffsetArray");class hp extends br{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Zn(hp,"SymbolLineVertexArray");class nh extends Zi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}nh.prototype.size=12;class As extends Ec{get(e){return new nh(this,e)}}Zn(As,"FeatureIndexArray");class Lu extends Na{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Zn(Lu,"FillExtrusionCentroidArray");const tm=Xn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),nm=Xn([{name:"a_dash",components:4,type:"Uint16"}]);var Fu={exports:{}},fp=function(t,e){var n,s,h,_,x,T,I,A;for(s=t.length-(n=3&t.length),h=e,x=3432918353,T=461845907,A=0;A<s;)I=255&t.charCodeAt(A)|(255&t.charCodeAt(++A))<<8|(255&t.charCodeAt(++A))<<16|(255&t.charCodeAt(++A))<<24,++A,h=27492+(65535&(_=5*(65535&(h=(h^=I=(65535&(I=(I=(65535&I)*x+(((I>>>16)*x&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(I=0,n){case 3:I^=(255&t.charCodeAt(A+2))<<16;case 2:I^=(255&t.charCodeAt(A+1))<<8;case 1:h^=I=(65535&(I=(I=(65535&(I^=255&t.charCodeAt(A)))*x+(((I>>>16)*x&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return h^=t.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0},Hg=function(t,e){for(var n,s=t.length,h=e^s,_=0;s>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(_)|(255&t.charCodeAt(++_))<<8|(255&t.charCodeAt(++_))<<16|(255&t.charCodeAt(++_))<<24))+((1540483477*(n>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++_;switch(s){case 3:h^=(255&t.charCodeAt(_+2))<<16;case 2:h^=(255&t.charCodeAt(_+1))<<8;case 1:h=1540483477*(65535&(h^=255&t.charCodeAt(_)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};Fu.exports=fp,Fu.exports.murmur3=fp,Fu.exports.murmur2=Hg;class gd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,s,h){this.ids.push(rm(e)),this.positions.push(n,s,h)}getPositions(e){const n=rm(e);let s=0,h=this.ids.length-1;for(;s<h;){const x=s+h>>1;this.ids[x]>=n?h=x:s=x+1}const _=[];for(;this.ids[s]===n;)_.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return _}static serialize(e,n){const s=new Float64Array(e.ids),h=new Uint32Array(e.positions);return mp(s,h,0,s.length-1),n&&n.push(s.buffer,h.buffer),{ids:s,positions:h}}static deserialize(e){const n=new gd;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function rm(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Fu.exports(String(t))}function mp(t,e,n,s){for(;n<s;){const h=t[n+s>>1];let _=n-1,x=s+1;for(;;){do{_++}while(t[_]<h);do{x--}while(t[x]>h);if(_>=x)break;ku(t,_,x),ku(e,3*_,3*x),ku(e,3*_+1,3*x+1),ku(e,3*_+2,3*x+2)}x-n<s-x?(mp(t,e,n,x),n=x+1):(mp(t,e,x+1,s),s=x)}}function ku(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}Zn(gd,"FeaturePositionMap");class wl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class ih extends wl{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Bu extends wl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class om extends wl{constructor(e){super(e),this.current=lr.transparent}set(e,n,s){this.fetchUniformLocation(e,n)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const Wg=new Float32Array(16),gp=new Float32Array(9),_p=new Float32Array(4);function rh(t){return[Qn(255*t.r,255*t.g),Qn(255*t.b,255*t.a)]}class Ll{constructor(e,n,s){this.value=e,this.uniformNames=n.map(h=>`u_${h}`),this.type=s}setUniform(e,n,s,h,_){n.set(e,_,h.constantOr(this.value))}getBinding(e,n){return"color"===this.type?new om(e):new ih(e)}}class Dc{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,s,h,_){const x="u_pattern"===_||"u_dash"===_?this.pattern:"u_pixel_ratio"===_?this.pixelRatio:null;x&&n.set(e,_,x)}getBinding(e,n){return"u_pattern"===n||"u_dash"===n?new Bu(e):new ih(e)}}class Fl{constructor(e,n,s,h){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,n,s,h,_,x){const T=this.paintVertexArray.length,I=this.expression.evaluate(new Ut(0),n,{},_,h,x);this.paintVertexArray.resize(e),this._setPaintValue(T,e,I)}updatePaintArray(e,n,s,h,_){const x=this.expression.evaluate({zoom:0},s,h,void 0,_);this._setPaintValue(e,n,x)}_setPaintValue(e,n,s){if("color"===this.type){const h=rh(s);for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,h[0],h[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Cl{constructor(e,n,s,h,_,x){this.expression=e,this.uniformNames=n.map(T=>`u_${T}_t`),this.type=s,this.useIntegerZoom=h,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=n.map(T=>({name:`a_${T}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(e,n,s,h,_,x){const T=this.expression.evaluate(new Ut(this.zoom),n,{},_,h,x),I=this.expression.evaluate(new Ut(this.zoom+1),n,{},_,h,x),A=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(A,e,T,I)}updatePaintArray(e,n,s,h,_){const x=this.expression.evaluate({zoom:this.zoom},s,h,void 0,_),T=this.expression.evaluate({zoom:this.zoom+1},s,h,void 0,_);this._setPaintValue(e,n,x,T)}_setPaintValue(e,n,s,h){if("color"===this.type){const _=rh(s),x=rh(h);for(let T=e;T<n;T++)this.paintVertexArray.emplace(T,_[0],_[1],x[0],x[1])}else{for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,s,h,_){const x=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,T=ge(this.expression.interpolationFactor(x,this.zoom,this.zoom+1),0,1);n.set(e,_,T)}getBinding(e,n){return new ih(e)}}class kl{constructor(e,n,s,h,_){this.expression=e,this.layerId=_,this.paintVertexAttributes=("array"===s?nm:tm).members;for(let x=0;x<n.length;++x);this.paintVertexArray=new h}populatePaintArray(e,n,s){const h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(h,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,h,_,x){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],x)}_setPaintValues(e,n,s,h){if(!h||!s)return;const _=h[s];if(!_)return;const{tl:x,br:T,pixelRatio:I}=_;for(let A=e;A<n;A++)this.paintVertexArray.emplace(A,x[0],x[1],T[0],T[1],I)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ic{constructor(e,n,s=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const _ in e.paint._values){if(!s(_))continue;const x=e.paint.get(_);if(!(x instanceof xn&&hs(x.property.specification)))continue;const T=Yg(_,e.type),I=x.value,A=x.property.specification.type,L=x.property.useIntegerZoom,N="line-dasharray"===_||_.endsWith("pattern"),Z="line-dasharray"===_&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==I.kind||Z)if("source"===I.kind||Z||N){const J=yp(_,A,"source");this.binders[_]=N?new kl(I,T,A,J,e.id):new Fl(I,T,A,J),h.push(`/a_${_}`)}else{const J=yp(_,A,"composite");this.binders[_]=new Cl(I,T,A,L,n,J),h.push(`/z_${_}`)}else this.binders[_]=N?new Dc(I.value,T):new Ll(I.value,T,A),h.push(`/u_${_}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Fl||n instanceof Cl?n.maxValue:0}populatePaintArrays(e,n,s,h,_,x){for(const T in this.binders){const I=this.binders[T];(I instanceof Fl||I instanceof Cl||I instanceof kl)&&I.populatePaintArray(e,n,s,h,_,x)}}setConstantPatternPositions(e){for(const n in this.binders){const s=this.binders[n];s instanceof Dc&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,n,s,h,_,x){let T=!1;for(const I in e){const A=n.getPositions(I);for(const L of A){const N=s.feature(L.index);for(const Z in this.binders){const J=this.binders[Z];if((J instanceof Fl||J instanceof Cl||J instanceof kl)&&!0===J.expression.isStateDependent){const ee=h.paint.get(Z);J.expression=ee.value,J.updatePaintArray(L.start,L.end,N,e[I],_,x),T=!0}}}}return T}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof Ll||s instanceof Dc)&&e.push(...s.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof Fl||s instanceof Cl||s instanceof kl)for(let h=0;h<s.paintVertexAttributes.length;h++)e.push(s.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof Ll||s instanceof Dc||s instanceof Cl)for(const h of s.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof Ll||h instanceof Dc||h instanceof Cl)for(const _ of h.uniformNames)n.push({name:_,property:s,binding:h.getBinding(e,_)})}return n}setUniforms(e,n,s,h,_){for(const{name:x,property:T,binding:I}of s)this.binders[T].setUniform(e,I,_,h.get(T),x)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Fl||n instanceof Cl||n instanceof kl)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof Fl||s instanceof Cl||s instanceof kl)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Fl||n instanceof Cl||n instanceof kl)&&n.destroy()}}}class Wc{constructor(e,n,s=(()=>!0)){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new Ic(h,n,s);this.needsUpload=!1,this._featureMap=new gd,this._bufferOffset=0}populatePaintArrays(e,n,s,h,_,x,T){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,n,h,_,x,T);void 0!==n.id&&this._featureMap.add(n.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,h,_){for(const x of s)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,n,x,h,_)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const qg={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Yg(t,e){return qg[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Jg={"line-pattern":{source:Us,composite:Us},"fill-pattern":{source:Us,composite:Us},"fill-extrusion-pattern":{source:Us,composite:Us},"line-dasharray":{source:wa,composite:wa}},Xg={color:{source:eh,composite:ba},number:{source:tl,composite:eh}};function yp(t,e,n){const s=Jg[t];return s&&s[n]||Xg[e][n]}Zn(Ll,"ConstantBinder"),Zn(Dc,"PatternConstantBinder"),Zn(Fl,"SourceExpressionBinder"),Zn(kl,"PatternCompositeBinder"),Zn(Cl,"CompositeExpressionBinder"),Zn(Ic,"ProgramConfiguration",{omit:["_buffers"]}),Zn(Wc,"ProgramConfigurationSet");const Nu="-transition";class nl extends Or{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new ln(n.layout)),n.paint)){this._transitionablePaint=new fn(n.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new kn(n.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,s={}){null!=n&&this._validate(Mu,`layers.${this.id}.layout.${e}`,e,n,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return at(e,Nu)?this._transitionablePaint.getTransition(e.slice(0,-Nu.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,s={}){if(null!=n&&this._validate(Xd,`layers.${this.id}.paint.${e}`,e,n,s))return!1;if(at(e,Nu))return this._transitionablePaint.setTransition(e.slice(0,-Nu.length),n||void 0),!1;{const h=this._transitionablePaint._values[e],_=h.value.isDataDriven(),x=h.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value,I=T.isDataDriven(),A=at(e,"pattern")||"line-dasharray"===e;return I||_||A||this._handleOverridablePaintPropertyUpdate(e,x,T)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),bt(e,(n,s)=>!(void 0===n||"layout"===s&&!Object.keys(n).length||"paint"===s&&!Object.keys(n).length))}_validate(e,n,s,h,_={}){return(!_||!1!==_.validate)&&Uc(this,e.call(bl,{key:n,layerType:this.type,objectKey:s,value:h,styleSpec:Xt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof xn&&hs(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ra(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const vp=Xn([{name:"a_pos",components:2,type:"Int16"}],4),Kg=Xn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ao{constructor(e=[]){this.segments=e}prepareSegment(e,n,s,h){let _=this.segments[this.segments.length-1];return e>Ao.MAX_VERTEX_ARRAY_LENGTH&&yn(`Max vertices per segment is ${Ao.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!_||_.vertexLength+e>Ao.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==h)&&(_={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==h&&(_.sortKey=h),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,h){return new Ao([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])}}Ao.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zn(Ao,"SegmentVector");var Di=8192;class Ql{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ar?new ar(e.lng,e.lat):ar.convert(e),this}setSouthWest(e){return this._sw=e instanceof ar?new ar(e.lng,e.lat):ar.convert(e),this}extend(e){const n=this._sw,s=this._ne;let h,_;if(e instanceof ar)h=e,_=e;else{if(!(e instanceof Ql))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Ql.convert(e)):this.extend(ar.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(ar.convert(e)):this;if(h=e._sw,_=e._ne,!h||!_)return this}return n||s?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),s.lng=Math.max(_.lng,s.lng),s.lat=Math.max(_.lat,s.lat)):(this._sw=new ar(h.lng,h.lat),this._ne=new ar(_.lng,_.lat)),this}getCenter(){return new ar((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ar(this.getWest(),this.getNorth())}getSouthEast(){return new ar(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:s}=ar.convert(e);let h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&h}static convert(e){return!e||e instanceof Ql?e:new Ql(e)}}const Bl=6371008.8;class ar{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ar(oe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,h=e.lat*n,_=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((e.lng-this.lng)*n);return Bl*Math.acos(Math.min(_,1))}toBounds(e=0){const n=360*e/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new Ql(new ar(this.lng-s,this.lat-n),new ar(this.lng+s,this.lat+n))}static convert(e){if(e instanceof ar)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new ar(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new ar(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const xp=2*Math.PI*Bl;function bp(t){return xp*Math.cos(t*Math.PI/180)}function ec(t){return(180+t)/360}function za(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function il(t,e){return t/bp(e)}function Ca(t){return 360*t-180}function ts(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function wp(t,e){return t*bp(ts(e))}const rl=85.051129;function Cp(t){return 1/Math.cos(t*Math.PI/180)}class tc{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=ar.convert(e);return new tc(ec(s.lng),za(s.lat),il(n,s.lat))}toLngLat(){return new ar(Ca(this.x),ts(this.y))}toAltitude(){return wp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/xp*Cp(ts(this.y))}}function zu(t,e,n,s,h,_,x,T,I){const A=(e+s)/2,L=(n+h)/2,N=new Q(A,L);T(N),function(Z,J,ee,pe,Pe,Qe){const ut=ee-Pe,et=pe-Qe;return Math.abs((pe-J)*ut-(ee-Z)*et)/Math.hypot(ut,et)}(N.x,N.y,_.x,_.y,x.x,x.y)>=I?(zu(t,e,n,A,L,_,N,T,I),zu(t,A,L,s,h,N,x,T,I)):t.push(x)}function Tp(t,e,n){let s=t[0],h=s.x,_=s.y;e(s);const x=[s];for(let T=1;T<t.length;T++){const I=t[T],{x:A,y:L}=I;e(I),zu(x,h,_,A,L,s,I,e,n),h=A,_=L,s=I}return x}function _d(t,e,n,s){if(s(e,n)){const h=e.add(n)._mult(.5);_d(t,e,h,s),_d(t,h,n,s)}else t.push(n)}function Ep(t,e){let n=t[0];const s=[n];for(let h=1;h<t.length;h++){const _=t[h];_d(s,n,_,e),n=_}return s}const yd=Math.pow(2,14)-1,Uu=-yd-1;function Qg(t,e){const n=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=ge(n,Uu,yd),t.y=ge(s,Uu,yd),(n<t.x||n>t.x+1||s<t.y||s>t.y+1)&&yn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Nl(t,e,n){const s=t.loadGeometry(),h=t.extent,_=Di/h;if(e&&n&&n.projection.isReprojectedInTileSpace){const x=1<<e.z,{scale:T,x:I,y:A,projection:L}=n,N=Z=>{const J=Ca((e.x+Z.x/h)/x),ee=ts((e.y+Z.y/h)/x),pe=L.project(J,ee);Z.x=(pe.x*T-I)*h,Z.y=(pe.y*T-A)*h};for(let Z=0;Z<s.length;Z++)if(1!==t.type)s[Z]=Tp(s[Z],N,1);else{const J=[];for(const ee of s[Z])ee.x<0||ee.x>=h||ee.y<0||ee.y>=h||(N(ee),J.push(ee));s[Z]=J}}for(const x of s)for(const T of x)Qg(T,_);return s}function qc(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Nl(t):[]}}function oh(t,e,n,s,h){t.emplaceBack(2*e+(s+1)/2,2*n+(h+1)/2)}function sh(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class ah{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new br,this.indexArray=new es,this.segments=new Ao,this.programConfigurations=new Wc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,h){const _=this.layers[0],x=[];let T=null;"circle"===_.type&&(T=_.layout.get("circle-sort-key"));for(const{feature:A,id:L,index:N,sourceLayerIndex:Z}of e){const J=this.layers[0]._featureFilter.needGeometry,ee=qc(A,J);if(!this.layers[0]._featureFilter.filter(new Ut(this.zoom),ee,s))continue;const pe=T?T.evaluate(ee,{},s):void 0,Pe={id:L,properties:A.properties,type:A.type,sourceLayerIndex:Z,index:N,geometry:J?ee.geometry:Nl(A,s,h),patterns:{},sortKey:pe};x.push(Pe)}T&&x.sort((A,L)=>A.sortKey-L.sortKey);let I=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new Kr,I=h.projection);for(const A of x){const{geometry:L,index:N,sourceLayerIndex:Z}=A,J=e[N].feature;this.addFeature(A,L,N,n.availableImages,s,I),n.featureIndex.insert(J,L,N,Z,this.index)}}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Kg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,s,h,_,x){for(const T of n)for(const I of T){const A=I.x,L=I.y;if(A<0||A>=Di||L<0||L>=Di)continue;if(x){const J=x.projectTilePoint(A,L,_),ee=x.upVector(_,A,L),pe=this.globeExtVertexArray;sh(pe,J,ee),sh(pe,J,ee),sh(pe,J,ee),sh(pe,J,ee)}const N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),Z=N.vertexLength;oh(this.layoutVertexArray,A,L,-1,-1),oh(this.layoutVertexArray,A,L,1,-1),oh(this.layoutVertexArray,A,L,1,1),oh(this.layoutVertexArray,A,L,-1,1),this.indexArray.emplaceBack(Z,Z+1,Z+2),this.indexArray.emplaceBack(Z,Z+2,Z+3),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},h,_)}}function Dp(t,e){for(let n=0;n<t.length;n++)if(Jc(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Jc(t,e[n]))return!0;return!!Ip(t,e)}function lh(t,e,n){return!!Jc(t,e)||!!sm(e,t,n)}function ch(t,e){if(1===t.length)return uh(e,t[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let h=0;h<s.length;h++)if(Jc(t,s[h]))return!0}for(let n=0;n<t.length;n++)if(uh(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ip(t,e[n]))return!0;return!1}function Yc(t,e,n){if(t.length>1){if(Ip(t,e))return!0;for(let s=0;s<e.length;s++)if(sm(e[s],t,n))return!0}for(let s=0;s<t.length;s++)if(sm(t[s],e,n))return!0;return!1}function Ip(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const s=t[n],h=t[n+1];for(let _=0;_<e.length-1;_++)if(e_(s,h,e[_],e[_+1]))return!0}return!1}function e_(t,e,n,s){return Fn(t,n,s)!==Fn(e,n,s)&&Fn(t,e,n)!==Fn(t,e,s)}function sm(t,e,n){const s=n*n;if(1===e.length)return t.distSqr(e[0])<s;for(let h=1;h<e.length;h++)if(am(t,e[h-1],e[h])<s)return!0;return!1}function am(t,e,n){const s=e.distSqr(n);if(0===s)return t.distSqr(e);const h=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/s;return t.distSqr(h<0?e:h>1?n:n.sub(e)._mult(h)._add(e))}function uh(t,e){let n,s,h,_=!1;for(let x=0;x<t.length;x++){n=t[x];for(let T=0,I=n.length-1;T<n.length;I=T++)s=n[T],h=n[I],s.y>e.y!=h.y>e.y&&e.x<(h.x-s.x)*(e.y-s.y)/(h.y-s.y)+s.x&&(_=!_)}return _}function Jc(t,e){let n=!1;for(let s=0,h=t.length-1;s<t.length;h=s++){const _=t[s],x=t[h];_.y>e.y!=x.y>e.y&&e.x<(x.x-_.x)*(e.y-_.y)/(x.y-_.y)+_.x&&(n=!n)}return n}function Mp(t,e,n,s,h){for(const x of t)if(e<=x.x&&n<=x.y&&s>=x.x&&h>=x.y)return!0;const _=[new Q(e,n),new Q(e,h),new Q(s,h),new Q(s,n)];if(t.length>2)for(const x of _)if(Jc(t,x))return!0;for(let x=0;x<t.length-1;x++)if(dh(t[x],t[x+1],_))return!0;return!1}function dh(t,e,n){const s=n[0],h=n[2];if(t.x<s.x&&e.x<s.x||t.x>h.x&&e.x>h.x||t.y<s.y&&e.y<s.y||t.y>h.y&&e.y>h.y)return!1;const _=Fn(t,e,n[0]);return _!==Fn(t,e,n[1])||_!==Fn(t,e,n[2])||_!==Fn(t,e,n[3])}function Mc(t,e,n){const s=e.paint.get(t).value;return"constant"===s.kind?s.value:n.programConfigurations.get(e.id).getMaxValue(t)}function vd(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Sp(t,e,n,s,h){if(!e[0]&&!e[1])return t;const _=Q.convert(e)._mult(h);"viewport"===n&&_._rotate(-s);const x=[];for(let T=0;T<t.length;T++)x.push(t[T].sub(_));return x}function Ap(t,e,n,s){const h=Q.convert(t)._mult(s);return"viewport"===e&&h._rotate(-n),h}Zn(ah,"CircleBucket",{omit:["layers"]});const lm=new hi({"circle-sort-key":new rn(Xt.layout_circle["circle-sort-key"])});var t_={paint:new hi({"circle-radius":new rn(Xt.paint_circle["circle-radius"]),"circle-color":new rn(Xt.paint_circle["circle-color"]),"circle-blur":new rn(Xt.paint_circle["circle-blur"]),"circle-opacity":new rn(Xt.paint_circle["circle-opacity"]),"circle-translate":new $t(Xt.paint_circle["circle-translate"]),"circle-translate-anchor":new $t(Xt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $t(Xt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $t(Xt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new rn(Xt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new rn(Xt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new rn(Xt.paint_circle["circle-stroke-opacity"])}),layout:lm},hh=1e-6,Ta=typeof Float32Array<"u"?Float32Array:Array;function cm(){var t=new Ta(9);return Ta!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function um(t,e,n){var s=e[0],h=e[1],_=e[2],x=e[3],T=e[4],I=e[5],A=e[6],L=e[7],N=e[8],Z=n[0],J=n[1],ee=n[2],pe=n[3],Pe=n[4],Qe=n[5],ut=n[6],et=n[7],st=n[8];return t[0]=Z*s+J*x+ee*A,t[1]=Z*h+J*T+ee*L,t[2]=Z*_+J*I+ee*N,t[3]=pe*s+Pe*x+Qe*A,t[4]=pe*h+Pe*T+Qe*L,t[5]=pe*_+Pe*I+Qe*N,t[6]=ut*s+et*x+st*A,t[7]=ut*h+et*T+st*L,t[8]=ut*_+et*I+st*N,t}function ms(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Xc(t,e){var n=e[0],s=e[1],h=e[2],_=e[3],x=e[4],T=e[5],I=e[6],A=e[7],L=e[8],N=e[9],Z=e[10],J=e[11],ee=e[12],pe=e[13],Pe=e[14],Qe=e[15],ut=n*T-s*x,et=n*I-h*x,st=n*A-_*x,Ct=s*I-h*T,mt=s*A-_*T,Kt=h*A-_*I,qt=L*pe-N*ee,mn=L*Pe-Z*ee,Mn=L*Qe-J*ee,an=N*Pe-Z*pe,_n=N*Qe-J*pe,vn=Z*Qe-J*Pe,In=ut*vn-et*_n+st*an+Ct*Mn-mt*mn+Kt*qt;return In?(t[0]=(T*vn-I*_n+A*an)*(In=1/In),t[1]=(h*_n-s*vn-_*an)*In,t[2]=(pe*Kt-Pe*mt+Qe*Ct)*In,t[3]=(Z*mt-N*Kt-J*Ct)*In,t[4]=(I*Mn-x*vn-A*mn)*In,t[5]=(n*vn-h*Mn+_*mn)*In,t[6]=(Pe*st-ee*Kt-Qe*et)*In,t[7]=(L*Kt-Z*st+J*et)*In,t[8]=(x*_n-T*Mn+A*qt)*In,t[9]=(s*Mn-n*_n-_*qt)*In,t[10]=(ee*mt-pe*st+Qe*ut)*In,t[11]=(N*st-L*mt-J*ut)*In,t[12]=(T*mn-x*an-I*qt)*In,t[13]=(n*an-s*mn+h*qt)*In,t[14]=(pe*et-ee*Ct-Pe*ut)*In,t[15]=(L*Ct-N*et+Z*ut)*In,t):null}function Kc(t,e,n){var s=e[0],h=e[1],_=e[2],x=e[3],T=e[4],I=e[5],A=e[6],L=e[7],N=e[8],Z=e[9],J=e[10],ee=e[11],pe=e[12],Pe=e[13],Qe=e[14],ut=e[15],et=n[0],st=n[1],Ct=n[2],mt=n[3];return t[0]=et*s+st*T+Ct*N+mt*pe,t[1]=et*h+st*I+Ct*Z+mt*Pe,t[2]=et*_+st*A+Ct*J+mt*Qe,t[3]=et*x+st*L+Ct*ee+mt*ut,t[4]=(et=n[4])*s+(st=n[5])*T+(Ct=n[6])*N+(mt=n[7])*pe,t[5]=et*h+st*I+Ct*Z+mt*Pe,t[6]=et*_+st*A+Ct*J+mt*Qe,t[7]=et*x+st*L+Ct*ee+mt*ut,t[8]=(et=n[8])*s+(st=n[9])*T+(Ct=n[10])*N+(mt=n[11])*pe,t[9]=et*h+st*I+Ct*Z+mt*Pe,t[10]=et*_+st*A+Ct*J+mt*Qe,t[11]=et*x+st*L+Ct*ee+mt*ut,t[12]=(et=n[12])*s+(st=n[13])*T+(Ct=n[14])*N+(mt=n[15])*pe,t[13]=et*h+st*I+Ct*Z+mt*Pe,t[14]=et*_+st*A+Ct*J+mt*Qe,t[15]=et*x+st*L+Ct*ee+mt*ut,t}function ph(t,e,n){var s,h,_,x,T,I,A,L,N,Z,J,ee,pe=n[0],Pe=n[1],Qe=n[2];return e===t?(t[12]=e[0]*pe+e[4]*Pe+e[8]*Qe+e[12],t[13]=e[1]*pe+e[5]*Pe+e[9]*Qe+e[13],t[14]=e[2]*pe+e[6]*Pe+e[10]*Qe+e[14],t[15]=e[3]*pe+e[7]*Pe+e[11]*Qe+e[15]):(h=e[1],_=e[2],x=e[3],T=e[4],I=e[5],A=e[6],L=e[7],N=e[8],Z=e[9],J=e[10],ee=e[11],t[0]=s=e[0],t[1]=h,t[2]=_,t[3]=x,t[4]=T,t[5]=I,t[6]=A,t[7]=L,t[8]=N,t[9]=Z,t[10]=J,t[11]=ee,t[12]=s*pe+T*Pe+N*Qe+e[12],t[13]=h*pe+I*Pe+Z*Qe+e[13],t[14]=_*pe+A*Pe+J*Qe+e[14],t[15]=x*pe+L*Pe+ee*Qe+e[15]),t}function Vu(t,e,n){var s=n[0],h=n[1],_=n[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*h,t[5]=e[5]*h,t[6]=e[6]*h,t[7]=e[7]*h,t[8]=e[8]*_,t[9]=e[9]*_,t[10]=e[10]*_,t[11]=e[11]*_,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function dm(t,e,n){var s=Math.sin(n),h=Math.cos(n),_=e[4],x=e[5],T=e[6],I=e[7],A=e[8],L=e[9],N=e[10],Z=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=_*h+A*s,t[5]=x*h+L*s,t[6]=T*h+N*s,t[7]=I*h+Z*s,t[8]=A*h-_*s,t[9]=L*h-x*s,t[10]=N*h-T*s,t[11]=Z*h-I*s,t}function Pp(t,e,n){var s=Math.sin(n),h=Math.cos(n),_=e[0],x=e[1],T=e[2],I=e[3],A=e[8],L=e[9],N=e[10],Z=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=_*h-A*s,t[1]=x*h-L*s,t[2]=T*h-N*s,t[3]=I*h-Z*s,t[8]=_*s+A*h,t[9]=x*s+L*h,t[10]=T*s+N*h,t[11]=I*s+Z*h,t}function n_(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Op(t,e,n){var s,h,_,x=n[0],T=n[1],I=n[2],A=Math.hypot(x,T,I);return A<hh?null:(x*=A=1/A,T*=A,I*=A,s=Math.sin(e),h=Math.cos(e),t[0]=x*x*(_=1-h)+h,t[1]=T*x*_+I*s,t[2]=I*x*_-T*s,t[3]=0,t[4]=x*T*_-I*s,t[5]=T*T*_+h,t[6]=I*T*_+x*s,t[7]=0,t[8]=x*I*_+T*s,t[9]=T*I*_-x*s,t[10]=I*I*_+h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var i_=Kc;function Rp(){var t=new Ta(3);return Ta!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function hm(t){var e=new Ta(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function xd(t){return Math.hypot(t[0],t[1],t[2])}function Sc(t,e,n){var s=new Ta(3);return s[0]=t,s[1]=e,s[2]=n,s}function Ps(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Qc(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Lp(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ju(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function $u(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function ol(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function fh(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t}function oa(t,e){var n=e[0],s=e[1],h=e[2],_=n*n+s*s+h*h;return _>0&&(_=1/Math.sqrt(_)),t[0]=e[0]*_,t[1]=e[1]*_,t[2]=e[2]*_,t}function Ea(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function bd(t,e,n){var s=e[0],h=e[1],_=e[2],x=n[0],T=n[1],I=n[2];return t[0]=h*I-_*T,t[1]=_*x-s*I,t[2]=s*T-h*x,t}function Eo(t,e,n){var s=e[0],h=e[1],_=e[2],x=n[3]*s+n[7]*h+n[11]*_+n[15];return t[0]=(n[0]*s+n[4]*h+n[8]*_+n[12])/(x=x||1),t[1]=(n[1]*s+n[5]*h+n[9]*_+n[13])/x,t[2]=(n[2]*s+n[6]*h+n[10]*_+n[14])/x,t}function r_(t,e,n){var s=n[0],h=n[1],_=n[2],x=e[0],T=e[1],I=e[2],A=h*I-_*T,L=_*x-s*I,N=s*T-h*x,Z=h*N-_*L,J=_*A-s*N,ee=s*L-h*A,pe=2*n[3];return L*=pe,N*=pe,J*=2,ee*=2,t[0]=x+(A*=pe)+(Z*=2),t[1]=T+L+J,t[2]=I+N+ee,t}var Zu,Tl=Qc,o_=Lp,s_=xd;function pm(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Fp(t,e){var n=e[0],s=e[1],h=e[2],_=e[3],x=n*n+s*s+h*h+_*_;return x>0&&(x=1/Math.sqrt(x)),t[0]=n*x,t[1]=s*x,t[2]=h*x,t[3]=_*x,t}function zl(t,e,n){var s=e[0],h=e[1],_=e[2],x=e[3];return t[0]=n[0]*s+n[4]*h+n[8]*_+n[12]*x,t[1]=n[1]*s+n[5]*h+n[9]*_+n[13]*x,t[2]=n[2]*s+n[6]*h+n[10]*_+n[14]*x,t[3]=n[3]*s+n[7]*h+n[11]*_+n[15]*x,t}function fm(){var t=new Ta(4);return Ta!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function mh(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function mm(t,e,n){n*=.5;var s=e[0],h=e[1],_=e[2],x=e[3],T=Math.sin(n),I=Math.cos(n);return t[0]=s*I+x*T,t[1]=h*I+_*T,t[2]=_*I-h*T,t[3]=x*I-s*T,t}function Bo(t,e,n){n*=.5;var s=e[0],h=e[1],_=e[2],x=e[3],T=Math.sin(n),I=Math.cos(n);return t[0]=s*I-_*T,t[1]=h*I+x*T,t[2]=_*I+s*T,t[3]=x*I-h*T,t}Rp(),Zu=new Ta(4),Ta!=Float32Array&&(Zu[0]=0,Zu[1]=0,Zu[2]=0,Zu[3]=0);var a_=Fp;Rp(),Sc(1,0,0),Sc(0,1,0),fm(),fm(),cm();class kp{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,s){const h=Ea(n,this.dir);if(Math.abs(h)<1e-6)return!1;const _=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/h;return s[0]=this.pos[0]+this.dir[0]*_,s[1]=this.pos[1]+this.dir[1]*_,s[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(e,n,s){if(pe=(J=this.pos)[0],Pe=J[1],Qe=J[2],ut=(ee=e)[0],et=ee[1],st=ee[2],Math.abs(pe-ut)<=hh*Math.max(1,Math.abs(pe),Math.abs(ut))&&Math.abs(Pe-et)<=hh*Math.max(1,Math.abs(Pe),Math.abs(et))&&Math.abs(Qe-st)<=hh*Math.max(1,Math.abs(Qe),Math.abs(st))||0===n)return s[0]=s[1]=s[2]=0,!1;var J,ee,pe,Pe,Qe,ut,et,st;const[h,_,x]=this.dir,T=this.pos[0]-e[0],I=this.pos[1]-e[1],A=this.pos[2]-e[2],L=h*h+_*_+x*x,N=2*(T*h+I*_+A*x),Z=N*N-4*L*(T*T+I*I+A*A-n*n);if(Z<0){const J=Math.max(-N/2,0),ee=T+h*J,pe=I+_*J,Pe=A+x*J,Qe=Math.hypot(ee,pe,Pe);return s[0]=ee*n/Qe,s[1]=pe*n/Qe,s[2]=Pe*n/Qe,!1}{const J=(-N-Math.sqrt(Z))/(2*L);if(J<0){const ee=Math.hypot(T,I,A);return s[0]=T*n/ee,s[1]=I*n/ee,s[2]=A*n/ee,!1}return s[0]=T+h*J,s[1]=I+_*J,s[2]=A+x*J,!0}}}class wd{constructor(e,n,s,h,_){this.TL=e,this.TR=n,this.BR=s,this.BL=h,this.horizon=_}static fromInvProjectionMatrix(e,n,s){const h=[-1,1,1],_=[1,1,1],x=[1,-1,1],T=[-1,-1,1],I=Eo(h,h,e),A=Eo(_,_,e),L=Eo(x,x,e),N=Eo(T,T,e);return new wd(I,A,L,N,n/s)}}class gh{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,s,h){const _=Math.pow(2,s),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const A=zl([],I,e),L=1/A[3]/n*_;return(N=A)[0]=(Z=A)[0]*(J=[L,L,h?1/A[3]:L,L])[0],N[1]=Z[1]*J[1],N[2]=Z[2]*J[2],N[3]=Z[3]*J[3],N;var N,Z,J}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const A=oa([],bd([],Tl([],x[I[0]],x[I[1]]),Tl([],x[I[2]],x[I[1]]))),L=-Ea(A,x[I[1]]);return A.concat(L)});return new gh(x,T)}}class Vs{static fromPoints(e){const n=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const h of e)ju(n,n,h),$u(s,s,h);return new Vs(n,s)}static applyTransform(e,n){const s=e.getCorners();for(let h=0;h<s.length;++h)Eo(s[h],s[h],n);return Vs.fromPoints(s)}constructor(e,n){this.min=e,this.max=n,this.center=ol([],Ps([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],s=hm(this.min),h=hm(this.max);for(let _=0;_<n.length;_++)s[_]=n[_]?this.min[_]:this.center[_],h[_]=n[_]?this.center[_]:this.max[_];return h[2]=this.max[2],new Vs(s,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let s=!0;for(let h=0;h<e.planes.length;h++){const _=e.planes[h];let x=0;for(let T=0;T<n.length;T++)x+=Ea(_,n[T])+_[3]>=0;if(0===x)return 0;x!==n.length&&(s=!1)}if(s)return 2;for(let h=0;h<3;h++){let _=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let T=0;T<e.points.length;T++){const I=e.points[T][h]-this.min[h];_=Math.min(_,I),x=Math.max(x,I)}if(x<0||_>this.max[h]-this.min[h])return 0}return 1}}function gm(t,e,n,s,h,_,x,T,I){if(_&&t.queryGeometry.isAboveHorizon)return!1;_&&(I*=t.pixelToTileUnitsFactor);const A=t.tileID.canonical,L=n.projection.upVectorScale(A,n.center.lat,n.worldSize).metersToTile;for(const N of e)for(const Z of N){const J=Z.add(T),ee=h&&n.elevation?n.elevation.exaggeration()*h.getElevationAt(J.x,J.y,!0):0,pe=n.projection.projectTilePoint(J.x,J.y,A);if(ee>0){const et=n.projection.upVector(A,J.x,J.y);pe.x+=et[0]*L*ee,pe.y+=et[1]*L*ee,pe.z+=et[2]*L*ee}const Pe=_?J:l_(pe.x,pe.y,pe.z,s),Qe=_?t.tilespaceRays.map(et=>Oy(et,ee)):t.queryGeometry.screenGeometry,ut=zl([],[pe.x,pe.y,pe.z,1],s);if(!x&&_?I*=ut[3]/n.cameraToCenterDistance:x&&!_&&(I*=n.cameraToCenterDistance/ut[3]),_){const et=ts((Z.y/Di+A.y)/(1<<A.z));I/=n.projection.pixelsPerMeter(et,1)/il(1,et)}if(lh(Qe,Pe,I))return!0}return!1}function l_(t,e,n,s){const h=zl([],[t,e,n,1],s);return new Q(h[0]/h[3],h[1]/h[3])}const _m=Sc(0,0,0),ym=Sc(0,0,1);function Oy(t,e){const n=Rp();return _m[2]=e,t.intersectsPlane(_m,ym,n),new Q(n[0],n[1])}class c_ extends ah{}function Gu(t,{width:e,height:n},s,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*n*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*n*s);return t.width=e,t.height=n,t.data=h,t}function _h(t,e,n){const{width:s,height:h}=e;s===t.width&&h===t.height||(yh(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,h)},n),t.width=s,t.height=h,t.data=e.data)}function yh(t,e,n,s,h,_){if(0===h.width||0===h.height)return e;if(h.width>t.width||h.height>t.height||n.x>t.width-h.width||n.y>t.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||s.x>e.width-h.width||s.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const x=t.data,T=e.data;for(let I=0;I<h.height;I++){const A=((n.y+I)*t.width+n.x)*_,L=((s.y+I)*e.width+s.x)*_;for(let N=0;N<h.width*_;N++)T[L+N]=x[A+N]}return e}Zn(c_,"HeatmapBucket",{omit:["layers"]});class Ul{constructor(e,n){Gu(this,e,1,n)}resize(e){_h(this,new Ul(e),1)}clone(){return new Ul({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,h,_){yh(e,n,s,h,_,1)}}class sa{constructor(e,n){Gu(this,e,4,n)}resize(e){_h(this,new sa(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new sa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,h,_){yh(e,n,s,h,_,4)}}Zn(Ul,"AlphaImage"),Zn(sa,"RGBAImage");var u_={paint:new hi({"heatmap-radius":new rn(Xt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new rn(Xt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $t(Xt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ni(Xt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $t(Xt.paint_heatmap["heatmap-opacity"])})};function Bp(t){const e={},n=t.resolution||256,s=t.clips?t.clips.length:1,h=t.image||new sa({width:n,height:s}),_=(x,T,I)=>{e[t.evaluationKey]=I;const A=t.expression.evaluate(e);h.data[x+T+0]=Math.floor(255*A.r/A.a),h.data[x+T+1]=Math.floor(255*A.g/A.a),h.data[x+T+2]=Math.floor(255*A.b/A.a),h.data[x+T+3]=Math.floor(255*A.a)};if(t.clips)for(let x=0,T=0;x<s;++x,T+=4*n)for(let I=0,A=0;I<n;I++,A+=4){const L=I/(n-1),{start:N,end:Z}=t.clips[x];_(T,A,N*(1-L)+Z*L)}else for(let x=0,T=0;x<n;x++,T+=4)_(0,T,x/(n-1));return h}var vm={paint:new hi({"hillshade-illumination-direction":new $t(Xt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $t(Xt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $t(Xt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $t(Xt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $t(Xt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $t(Xt.paint_hillshade["hillshade-accent-color"])})};const xm=Xn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Np}=xm;var vh={exports:{}};function Hu(t,e,n){n=n||2;var s,h,_,x,T,I,A,L=e&&e.length,N=L?e[0]*n:t.length,Z=bm(t,0,N,n,!0),J=[];if(!Z||Z.next===Z.prev)return J;if(L&&(Z=function(pe,Pe,Qe,ut){var et,st,Ct,mt=[];for(et=0,st=Pe.length;et<st;et++)(Ct=bm(pe,Pe[et]*ut,et<st-1?Pe[et+1]*ut:pe.length,ut,!1))===Ct.next&&(Ct.steiner=!0),mt.push(tu(Ct));for(mt.sort(xh),et=0;et<mt.length;et++)Qe=h_(mt[et],Qe);return Qe}(t,e,Z,n)),t.length>80*n){s=_=t[0],h=x=t[1];for(var ee=n;ee<N;ee+=n)(T=t[ee])<s&&(s=T),(I=t[ee+1])<h&&(h=I),T>_&&(_=T),I>x&&(x=I);A=0!==(A=Math.max(_-s,x-h))?32767/A:0}return Wu(Z,J,n,s,h,A,0),J}function bm(t,e,n,s,h){var _,x;if(h===$p(t,e,n,s)>0)for(_=e;_<n;_+=s)x=Ch(_,t[_],t[_+1],x);else for(_=n-s;_>=e;_-=s)x=Ch(_,t[_],t[_+1],x);return x&&bh(x,x.next)&&(Td(x),x=x.next),x}function nc(t,e){if(!t)return t;e||(e=t);var n,s=t;do{if(n=!1,s.steiner||!bh(s,s.next)&&0!==Do(s.prev,s,s.next))s=s.next;else{if(Td(s),(s=e=s.prev)===s.next)break;n=!0}}while(n||s!==e);return e}function Wu(t,e,n,s,h,_,x){if(t){!x&&_&&function(L,N,Z,J){var ee=L;do{0===ee.z&&(ee.z=qu(ee.x,ee.y,N,Z,J)),ee.prevZ=ee.prev,ee.nextZ=ee.next,ee=ee.next}while(ee!==L);ee.prevZ.nextZ=null,ee.prevZ=null,function(pe){var Pe,Qe,ut,et,st,Ct,mt,Kt,qt=1;do{for(Qe=pe,pe=null,st=null,Ct=0;Qe;){for(Ct++,ut=Qe,mt=0,Pe=0;Pe<qt&&(mt++,ut=ut.nextZ);Pe++);for(Kt=qt;mt>0||Kt>0&&ut;)0!==mt&&(0===Kt||!ut||Qe.z<=ut.z)?(et=Qe,Qe=Qe.nextZ,mt--):(et=ut,ut=ut.nextZ,Kt--),st?st.nextZ=et:pe=et,et.prevZ=st,st=et;Qe=ut}st.nextZ=null,qt*=2}while(Ct>1)}(ee)}(t,s,h,_);for(var T,I,A=t;t.prev!==t.next;)if(T=t.prev,I=t.next,_?eu(t,s,h,_):wm(t))e.push(T.i/n|0),e.push(t.i/n|0),e.push(I.i/n|0),Td(t),t=I.next,A=I.next;else if((t=I)===A){x?1===x?Wu(t=d_(nc(t),e,n),e,n,s,h,_,2):2===x&&zp(t,e,n,s,h,_):Wu(nc(t),e,n,s,h,_,1);break}}}function wm(t){var e=t.prev,n=t,s=t.next;if(Do(e,n,s)>=0)return!1;for(var h=e.x,_=n.x,x=s.x,T=e.y,I=n.y,A=s.y,L=h<_?h<x?h:x:_<x?_:x,N=T<I?T<A?T:A:I<A?I:A,Z=h>_?h>x?h:x:_>x?_:x,J=T>I?T>A?T:A:I>A?I:A,ee=s.next;ee!==e;){if(ee.x>=L&&ee.x<=Z&&ee.y>=N&&ee.y<=J&&nu(h,T,_,I,x,A,ee.x,ee.y)&&Do(ee.prev,ee,ee.next)>=0)return!1;ee=ee.next}return!0}function eu(t,e,n,s){var h=t.prev,_=t,x=t.next;if(Do(h,_,x)>=0)return!1;for(var T=h.x,I=_.x,A=x.x,L=h.y,N=_.y,Z=x.y,J=T<I?T<A?T:A:I<A?I:A,ee=L<N?L<Z?L:Z:N<Z?N:Z,pe=T>I?T>A?T:A:I>A?I:A,Pe=L>N?L>Z?L:Z:N>Z?N:Z,Qe=qu(J,ee,e,n,s),ut=qu(pe,Pe,e,n,s),et=t.prevZ,st=t.nextZ;et&&et.z>=Qe&&st&&st.z<=ut;){if(et.x>=J&&et.x<=pe&&et.y>=ee&&et.y<=Pe&&et!==h&&et!==x&&nu(T,L,I,N,A,Z,et.x,et.y)&&Do(et.prev,et,et.next)>=0||(et=et.prevZ,st.x>=J&&st.x<=pe&&st.y>=ee&&st.y<=Pe&&st!==h&&st!==x&&nu(T,L,I,N,A,Z,st.x,st.y)&&Do(st.prev,st,st.next)>=0))return!1;st=st.nextZ}for(;et&&et.z>=Qe;){if(et.x>=J&&et.x<=pe&&et.y>=ee&&et.y<=Pe&&et!==h&&et!==x&&nu(T,L,I,N,A,Z,et.x,et.y)&&Do(et.prev,et,et.next)>=0)return!1;et=et.prevZ}for(;st&&st.z<=ut;){if(st.x>=J&&st.x<=pe&&st.y>=ee&&st.y<=Pe&&st!==h&&st!==x&&nu(T,L,I,N,A,Z,st.x,st.y)&&Do(st.prev,st,st.next)>=0)return!1;st=st.nextZ}return!0}function d_(t,e,n){var s=t;do{var h=s.prev,_=s.next.next;!bh(h,_)&&jp(h,s,s.next,_)&&Cd(h,_)&&Cd(_,h)&&(e.push(h.i/n|0),e.push(s.i/n|0),e.push(_.i/n|0),Td(s),Td(s.next),s=t=_),s=s.next}while(s!==t);return nc(s)}function zp(t,e,n,s,h,_){var x=t;do{for(var T=x.next.next;T!==x.prev;){if(x.i!==T.i&&Vp(x,T)){var I=Cm(x,T);return x=nc(x,x.next),I=nc(I,I.next),Wu(x,e,n,s,h,_,0),void Wu(I,e,n,s,h,_,0)}T=T.next}x=x.next}while(x!==t)}function xh(t,e){return t.x-e.x}function h_(t,e){var n=function(h,_){var x,T=_,I=h.x,A=h.y,L=-1/0;do{if(A<=T.y&&A>=T.next.y&&T.next.y!==T.y){var N=T.x+(A-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(N<=I&&N>L&&(L=N,x=T.x<T.next.x?T:T.next,N===I))return x}T=T.next}while(T!==_);if(!x)return null;var Z,J=x,ee=x.x,pe=x.y,Pe=1/0;T=x;do{I>=T.x&&T.x>=ee&&I!==T.x&&nu(A<pe?I:L,A,ee,pe,A<pe?L:I,A,T.x,T.y)&&(Z=Math.abs(A-T.y)/(I-T.x),Cd(T,h)&&(Z<Pe||Z===Pe&&(T.x>x.x||T.x===x.x&&Up(x,T)))&&(x=T,Pe=Z)),T=T.next}while(T!==J);return x}(t,e);if(!n)return e;var s=Cm(n,t);return nc(s,s.next),nc(n,n.next)}function Up(t,e){return Do(t.prev,t,e.prev)<0&&Do(e.next,t,t.next)<0}function qu(t,e,n,s,h){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function tu(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function nu(t,e,n,s,h,_,x,T){return(h-x)*(e-T)>=(t-x)*(_-T)&&(t-x)*(s-T)>=(n-x)*(e-T)&&(n-x)*(_-T)>=(h-x)*(s-T)}function Vp(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,s){var h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==s.i&&h.next.i!==s.i&&jp(h,h.next,n,s))return!0;h=h.next}while(h!==n);return!1}(t,e)&&(Cd(t,e)&&Cd(e,t)&&function(n,s){var h=n,_=!1,x=(n.x+s.x)/2,T=(n.y+s.y)/2;do{h.y>T!=h.next.y>T&&h.next.y!==h.y&&x<(h.next.x-h.x)*(T-h.y)/(h.next.y-h.y)+h.x&&(_=!_),h=h.next}while(h!==n);return _}(t,e)&&(Do(t.prev,t,e.prev)||Do(t,e.prev,e))||bh(t,e)&&Do(t.prev,t,t.next)>0&&Do(e.prev,e,e.next)>0)}function Do(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function bh(t,e){return t.x===e.x&&t.y===e.y}function jp(t,e,n,s){var h=wh(Do(t,e,n)),_=wh(Do(t,e,s)),x=wh(Do(n,s,t)),T=wh(Do(n,s,e));return h!==_&&x!==T||!(0!==h||!ic(t,n,e))||!(0!==_||!ic(t,s,e))||!(0!==x||!ic(n,t,s))||!(0!==T||!ic(n,e,s))}function ic(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function wh(t){return t>0?1:t<0?-1:0}function Cd(t,e){return Do(t.prev,t,t.next)<0?Do(t,e,t.next)>=0&&Do(t,t.prev,e)>=0:Do(t,e,t.prev)<0||Do(t,t.next,e)<0}function Cm(t,e){var n=new Th(t.i,t.x,t.y),s=new Th(e.i,e.x,e.y),h=t.next,_=e.prev;return t.next=e,e.prev=t,n.next=h,h.prev=n,s.next=n,n.prev=s,_.next=s,s.prev=_,s}function Ch(t,e,n,s){var h=new Th(t,e,n);return s?(h.next=s.next,h.prev=s,s.next.prev=h,s.next=h):(h.prev=h,h.next=h),h}function Td(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Th(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $p(t,e,n,s){for(var h=0,_=e,x=n-s;_<n;_+=s)h+=(t[x]-t[_])*(t[_+1]+t[x+1]),x=_;return h}function Tm(t,e,n,s,h){p_(t,e,n||0,s||t.length-1,h||Dd)}function p_(t,e,n,s,h){for(;s>n;){if(s-n>600){var _=s-n+1,x=e-n+1,T=Math.log(_),I=.5*Math.exp(2*T/3),A=.5*Math.sqrt(T*I*(_-I)/_)*(x-_/2<0?-1:1);p_(t,e,Math.max(n,Math.floor(e-x*I/_+A)),Math.min(s,Math.floor(e+(_-x)*I/_+A)),h)}var L=t[e],N=n,Z=s;for(Ed(t,n,e),h(t[s],L)>0&&Ed(t,n,s);N<Z;){for(Ed(t,N,Z),N++,Z--;h(t[N],L)<0;)N++;for(;h(t[Z],L)>0;)Z--}0===h(t[n],L)?Ed(t,n,Z):Ed(t,++Z,s),Z<=e&&(n=Z+1),e<=Z&&(s=Z-1)}}function Ed(t,e,n){var s=t[e];t[e]=t[n],t[n]=s}function Dd(t,e){return t<e?-1:t>e?1:0}function Zp(t,e){const n=t.length;if(n<=1)return[t];const s=[];let h,_;for(let x=0;x<n;x++){const T=cn(t[x]);0!==T&&(t[x].area=Math.abs(T),void 0===_&&(_=T<0),_===T<0?(h&&s.push(h),h=[t[x]]):h.push(t[x]))}if(h&&s.push(h),e>1)for(let x=0;x<s.length;x++)s[x].length<=e||(Tm(s[x],e,1,s[x].length-1,Yu),s[x]=s[x].slice(0,e));return s}function Yu(t,e){return e.area-t.area}function iu(t,e,n){const s=n.patternDependencies;let h=!1;for(const _ of e){const x=_.paint.get(`${t}-pattern`);x.isConstant()||(h=!0);const T=x.constantOr(null);T&&(h=!0,s[T]=!0)}return h}function Gp(t,e,n,s,h){const _=h.patternDependencies;for(const x of e){const T=x.paint.get(`${t}-pattern`).value;if("constant"!==T.kind){let I=T.evaluate({zoom:s},n,{},h.availableImages);I=I&&I.name?I.name:I,_[I]=!0,n.patterns[x.id]=I}}return n}vh.exports=Hu,vh.exports.default=Hu,Hu.deviation=function(t,e,n,s){var h=e&&e.length,_=Math.abs($p(t,0,h?e[0]*n:t.length,n));if(h)for(var x=0,T=e.length;x<T;x++)_-=Math.abs($p(t,e[x]*n,x<T-1?e[x+1]*n:t.length,n));var I=0;for(x=0;x<s.length;x+=3){var A=s[x]*n,L=s[x+1]*n,N=s[x+2]*n;I+=Math.abs((t[A]-t[N])*(t[L+1]-t[A+1])-(t[A]-t[L])*(t[N+1]-t[A+1]))}return 0===_&&0===I?0:Math.abs((I-_)/_)},Hu.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,h=0;h<t.length;h++){for(var _=0;_<t[h].length;_++)for(var x=0;x<e;x++)n.vertices.push(t[h][_][x]);h>0&&n.holes.push(s+=t[h-1].length)}return n};class Id{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new br,this.indexArray=new es,this.indexArray2=new Na,this.programConfigurations=new Wc(e.layers,e.zoom),this.segments=new Ao,this.segments2=new Ao,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,s,h){this.hasPattern=iu("fill",this.layers,n);const _=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:T,id:I,index:A,sourceLayerIndex:L}of e){const N=this.layers[0]._featureFilter.needGeometry,Z=qc(T,N);if(!this.layers[0]._featureFilter.filter(new Ut(this.zoom),Z,s))continue;const J=_?_.evaluate(Z,{},s,n.availableImages):void 0,ee={id:I,properties:T.properties,type:T.type,sourceLayerIndex:L,index:A,geometry:N?Z.geometry:Nl(T,s,h),patterns:{},sortKey:J};x.push(ee)}_&&x.sort((T,I)=>T.sortKey-I.sortKey);for(const T of x){const{geometry:I,index:A,sourceLayerIndex:L}=T;if(this.hasPattern){const N=Gp("fill",this.layers,T,this.zoom,n);this.patternFeatures.push(N)}else this.addFeature(T,I,A,s,{},n.availableImages);n.featureIndex.insert(e[A].feature,I,A,L,this.index)}}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}addFeatures(e,n,s,h,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,n,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Np),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,h,_,x=[]){for(const T of Zp(n,500)){let I=0;for(const ee of T)I+=ee.length;const A=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),L=A.vertexLength,N=[],Z=[];for(const ee of T){if(0===ee.length)continue;ee!==T[0]&&Z.push(N.length/2);const pe=this.segments2.prepareSegment(ee.length,this.layoutVertexArray,this.indexArray2),Pe=pe.vertexLength;this.layoutVertexArray.emplaceBack(ee[0].x,ee[0].y),this.indexArray2.emplaceBack(Pe+ee.length-1,Pe),N.push(ee[0].x),N.push(ee[0].y);for(let Qe=1;Qe<ee.length;Qe++)this.layoutVertexArray.emplaceBack(ee[Qe].x,ee[Qe].y),this.indexArray2.emplaceBack(Pe+Qe-1,Pe+Qe),N.push(ee[Qe].x),N.push(ee[Qe].y);pe.vertexLength+=ee.length,pe.primitiveLength+=ee.length}const J=vh.exports(N,Z);for(let ee=0;ee<J.length;ee+=3)this.indexArray.emplaceBack(L+J[ee],L+J[ee+1],L+J[ee+2]);A.vertexLength+=I,A.primitiveLength+=J.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,_,x,h)}}Zn(Id,"FillBucket",{omit:["layers","patternFeatures"]});const f_=new hi({"fill-sort-key":new rn(Xt.layout_fill["fill-sort-key"])});var m_={paint:new hi({"fill-antialias":new $t(Xt.paint_fill["fill-antialias"]),"fill-opacity":new rn(Xt.paint_fill["fill-opacity"]),"fill-color":new rn(Xt.paint_fill["fill-color"]),"fill-outline-color":new rn(Xt.paint_fill["fill-outline-color"]),"fill-translate":new $t(Xt.paint_fill["fill-translate"]),"fill-translate-anchor":new $t(Xt.paint_fill["fill-translate-anchor"]),"fill-pattern":new rn(Xt.paint_fill["fill-pattern"])}),layout:f_};const g_=Xn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Em=Xn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),__=Xn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Hp}=g_;var Ju={},y_=Q,Eh=Vl;function Vl(t,e,n,s,h){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=h,t.readFields(v_,this,e)}function v_(t,e,n){1==t?e.id=n.readVarint():2==t?function(s,h){for(var _=s.readVarint()+s.pos;s.pos<_;){var x=h._keys[s.readVarint()],T=h._values[s.readVarint()];h.properties[x]=T}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function x_(t){for(var e,n,s=0,h=0,_=t.length,x=_-1;h<_;x=h++)s+=((n=t[x]).x-(e=t[h]).x)*(e.y+n.y);return s}Vl.types=["Unknown","Point","LineString","Polygon"],Vl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,s=1,h=0,_=0,x=0,T=[];t.pos<n;){if(h<=0){var I=t.readVarint();s=7&I,h=I>>3}if(h--,1===s||2===s)_+=t.readSVarint(),x+=t.readSVarint(),1===s&&(e&&T.push(e),e=[]),e.push(new y_(_,x));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&T.push(e),T},Vl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,s=0,h=0,_=0,x=1/0,T=-1/0,I=1/0,A=-1/0;t.pos<e;){if(s<=0){var L=t.readVarint();n=7&L,s=L>>3}if(s--,1===n||2===n)(h+=t.readSVarint())<x&&(x=h),h>T&&(T=h),(_+=t.readSVarint())<I&&(I=_),_>A&&(A=_);else if(7!==n)throw new Error("unknown command "+n)}return[x,I,T,A]},Vl.prototype.toGeoJSON=function(t,e,n){var s,h,_=this.extent*Math.pow(2,n),x=this.extent*t,T=this.extent*e,I=this.loadGeometry(),A=Vl.types[this.type];function L(J){for(var ee=0;ee<J.length;ee++){var pe=J[ee];J[ee]=[360*(pe.x+x)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(pe.y+T)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(s=0;s<I.length;s++)N[s]=I[s][0];L(I=N);break;case 2:for(s=0;s<I.length;s++)L(I[s]);break;case 3:for(I=function(J){var ee=J.length;if(ee<=1)return[J];for(var pe,Pe,Qe=[],ut=0;ut<ee;ut++){var et=x_(J[ut]);0!==et&&(void 0===Pe&&(Pe=et<0),Pe===et<0?(pe&&Qe.push(pe),pe=[J[ut]]):pe.push(J[ut]))}return pe&&Qe.push(pe),Qe}(I),s=0;s<I.length;s++)for(h=0;h<I[s].length;h++)L(I[s][h])}1===I.length?I=I[0]:A="Multi"+A;var Z={type:"Feature",geometry:{type:A,coordinates:I},properties:this.properties};return"id"in this&&(Z.id=this.id),Z};var b_=Eh,Dm=Im;function Im(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(w_,this,e),this.length=this._features.length}function w_(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(s){for(var h=null,_=s.readVarint()+s.pos;s.pos<_;){var x=s.readVarint()>>3;h=1===x?s.readString():2===x?s.readFloat():3===x?s.readDouble():4===x?s.readVarint64():5===x?s.readVarint():6===x?s.readSVarint():7===x?s.readBoolean():null}return h}(n))}Im.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new b_(this._pbf,e,this.extent,this._keys,this._values)};var C_=Dm;function Xu(t,e,n){if(3===t){var s=new C_(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}var El=Ju.VectorTile=function(t,e){this.layers=t.readFields(Xu,{},e)},Dh=Ju.VectorTileFeature=Eh;function Ih(t,e,n,s){const h=[],_=0===s?(x,T,I,A,L,N)=>{x.push(new Q(N,I+(N-T)/(A-T)*(L-I)))}:(x,T,I,A,L,N)=>{x.push(new Q(T+(N-I)/(L-I)*(A-T),N))};for(const x of t){const T=[];for(const I of x){if(I.length<=2)continue;const A=[];for(let Z=0;Z<I.length-1;Z++){const J=I[Z].x,ee=I[Z].y,pe=I[Z+1].x,Pe=I[Z+1].y,Qe=0===s?J:ee,ut=0===s?pe:Pe;Qe<e?ut>e&&_(A,J,ee,pe,Pe,e):Qe>n?ut<n&&_(A,J,ee,pe,Pe,n):A.push(I[Z]),ut<e&&Qe>=e&&_(A,J,ee,pe,Pe,e),ut>n&&Qe<=n&&_(A,J,ee,pe,Pe,n)}let L=I[I.length-1];const N=0===s?L.x:L.y;N>=e&&N<=n&&A.push(L),A.length&&(L=A[A.length-1],A[0].x===L.x&&A[0].y===L.y||A.push(A[0]),T.push(A))}T.length&&h.push(T)}return h}Ju.VectorTileLayer=Dm;const Ry=Dh.types,Ly=Math.pow(2,13);function Ku(t,e,n,s,h,_,x,T){t.emplaceBack((e<<1)+x,(n<<1)+_,(Math.floor(s*Ly)<<1)+h,Math.round(T))}function Mh(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class Wp{constructor(){this.acc=new Q(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Q(e.x,e.y),this.max=new Q(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,h=this.max;e.x<s.x?s.x=e.x:e.x>h.x&&(h.x=e.x),e.y<s.y?s.y=e.y:e.y>h.y&&(h.y=e.y),((0===e.x||e.x===Di)&&e.x===n.x)!=((0===e.y||e.y===Di)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,wi(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Di!=e.x>Di&&this.addBorderIntersection(1,wi(n.y,e.y,(Di-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,wi(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Di!=e.y>Di&&this.addBorderIntersection(3,wi(n.x,e.x,(Di-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((n,s)=>n+s.edges,0);return 0!==e?this.acc.div(e)._round():new Q(0,0)}span(){return new Q(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class Qu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Lr,this.centroidVertexArray=new Lu,this.indexArray=new es,this.programConfigurations=new Wc(e.layers,e.zoom),this.segments=new Ao,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,s,h){this.features=[],this.hasPattern=iu("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(_){const x=Math.exp(Math.PI*(1-_.y/(1<<_.z)*2));return 80150034*x/(x*x+1)/Di/(1<<_.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:_,id:x,index:T,sourceLayerIndex:I}of e){const A=this.layers[0]._featureFilter.needGeometry,L=qc(_,A);if(!this.layers[0]._featureFilter.filter(new Ut(this.zoom),L,s))continue;const N={id:x,sourceLayerIndex:I,index:T,geometry:A?L.geometry:Nl(_,s,h),properties:_.properties,type:_.type,patterns:{}},Z=this.layoutVertexArray.length;this.hasPattern?this.features.push(Gp("fill-extrusion",this.layers,N,this.zoom,n)):this.addFeature(N,N.geometry,T,s,{},n.availableImages,h),n.featureIndex.insert(_,N.geometry,T,I,this.index,Z)}this.sortBorders()}addFeatures(e,n,s,h,_){for(const x of this.features){const{geometry:T}=x;this.addFeature(x,T,x.index,n,s,h,_)}this.sortBorders()}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hp),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,__.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Em.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,h,_,x,T){const I=[new Q(0,0),new Q(Di,Di)],A=T.projection,L="globe"===A.name,N=this.enableTerrain&&!L?new Wp:null,Z="Polygon"===Ry[e.type];L&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Kr);const J=Zp(n,500);for(let Qe=J.length-1;Qe>=0;Qe--){const ut=J[Qe];(0===ut.length||(ee=ut[0]).every(et=>et.x<=0)||ee.every(et=>et.x>=Di)||ee.every(et=>et.y<=0)||ee.every(et=>et.y>=Di))&&J.splice(Qe,1)}var ee;let pe;if(L)pe=Rm(J,I,h);else{pe=[];for(const Qe of J)pe.push({polygon:Qe,bounds:I})}const Pe=Z?this.edgeRadius:0;for(const{polygon:Qe,bounds:ut}of pe){let et=0,st=0;for(const mt of Qe)Z&&!mt[0].equals(mt[mt.length-1])&&mt.push(mt[0]),st+=Z?mt.length-1:mt.length;const Ct=this.segments.prepareSegment((Z?5:4)*st,this.layoutVertexArray,this.indexArray);if(Z){const mt=[],Kt=[];et=Ct.vertexLength;for(const mn of Qe){let Mn,an;mn.length&&mn!==Qe[0]&&Kt.push(mt.length/2),Mn=mn[1].sub(mn[0])._perp()._unit();for(let _n=1;_n<mn.length;_n++){const vn=mn[_n],In=mn[_n===mn.length-1?1:_n+1];let{x:On,y:sn}=vn;if(Pe){an=In.sub(vn)._perp()._unit();const Gn=Mn.add(an)._unit(),gi=Pe*Math.min(4,1/(Mn.x*Gn.x+Mn.y*Gn.y));On+=gi*Gn.x,sn+=gi*Gn.y,Mn=an}Ku(this.layoutVertexArray,On,sn,0,0,1,1,0),Ct.vertexLength++,mt.push(vn.x,vn.y),L&&Mh(this.layoutVertexExtArray,A.projectTilePoint(On,sn,h),A.upVector(h,On,sn))}}const qt=vh.exports(mt,Kt);for(let mn=0;mn<qt.length;mn+=3)this.indexArray.emplaceBack(et+qt[mn],et+qt[mn+2],et+qt[mn+1]),Ct.primitiveLength++}for(const mt of Qe){N&&mt.length&&N.startRing(mt[0]);let Kt,qt,mn,Mn=mt.length>4&&sl(mt[mt.length-2],mt[0],mt[1]),an=Pe?Sm(mt[mt.length-2],mt[0],mt[1],Pe):0;qt=mt[1].sub(mt[0])._perp()._unit();let _n=!0;for(let vn=1,In=0;vn<mt.length;vn++){let On=mt[vn-1],sn=mt[vn];const Gn=mt[vn===mt.length-1?1:vn+1];if(N&&Z&&N.currentPolyCount.top++,Pm(sn,On,ut)){Pe&&(qt=Gn.sub(sn)._perp()._unit(),_n=!_n);continue}N&&N.append(sn,On);const gi=sn.sub(On)._perp(),qn=gi.x/(Math.abs(gi.x)+Math.abs(gi.y)),ei=gi.y>0?1:0,jn=On.dist(sn);if(In+jn>32768&&(In=0),Pe){mn=Gn.sub(sn)._perp()._unit();let qi=Am(On,sn,Gn,Mm(qt,mn),Pe);isNaN(qi)&&(qi=0);const Ti=sn.sub(On)._unit();On=On.add(Ti.mult(an))._round(),sn=sn.add(Ti.mult(-qi))._round(),an=qi,qt=mn}const _i=Ct.vertexLength,Ji=mt.length>4&&sl(On,sn,Gn);let Wi=Om(In,Mn,_n);if(Ku(this.layoutVertexArray,On.x,On.y,qn,ei,0,0,Wi),Ku(this.layoutVertexArray,On.x,On.y,qn,ei,0,1,Wi),In+=jn,Wi=Om(In,Ji,!_n),Mn=Ji,Ku(this.layoutVertexArray,sn.x,sn.y,qn,ei,0,0,Wi),Ku(this.layoutVertexArray,sn.x,sn.y,qn,ei,0,1,Wi),Ct.vertexLength+=4,this.indexArray.emplaceBack(_i+0,_i+1,_i+2),this.indexArray.emplaceBack(_i+1,_i+3,_i+2),Ct.primitiveLength+=2,Pe){const qi=et+(1===vn?mt.length-2:vn-2),Ti=1===vn?et:qi+1;if(this.indexArray.emplaceBack(_i+1,qi,_i+3),this.indexArray.emplaceBack(qi,Ti,_i+3),Ct.primitiveLength+=2,void 0===Kt&&(Kt=_i),!Pm(Gn,mt[vn],ut)){const Mr=vn===mt.length-1?Kt:Ct.vertexLength;this.indexArray.emplaceBack(_i+2,_i+3,Mr),this.indexArray.emplaceBack(_i+3,Mr+1,Mr),this.indexArray.emplaceBack(_i+3,Ti,Mr+1),Ct.primitiveLength+=3}_n=!_n}if(L){const qi=this.layoutVertexExtArray,Ti=A.projectTilePoint(On.x,On.y,h),Mr=A.projectTilePoint(sn.x,sn.y,h),Oi=A.upVector(h,On.x,On.y),Ki=A.upVector(h,sn.x,sn.y);Mh(qi,Ti,Oi),Mh(qi,Ti,Oi),Mh(qi,Mr,Ki),Mh(qi,Mr,Ki)}}Z&&(et+=mt.length-1)}}if(N&&N.polyCount.length>0){if(N.borders){N.vertexArrayOffset=this.centroidVertexArray.length;const Qe=N.borders,ut=this.featuresOnBorder.push(N)-1;for(let et=0;et<4;et++)Qe[et][0]!==Number.MAX_VALUE&&this.borders[et].push(ut)}this.encodeCentroid(N.borders?void 0:N.centroid(),N)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,_,x,h)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,s)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,n,s=!0){let h,_;if(e)if(0!==e.y){const T=n.span()._mult(this.tileToMeter);h=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(T.x/10)),_=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(T.y/10))}else h=Math.ceil(7*(e.x+450)),_=0;else h=0,_=+s;let x=s?this.centroidVertexArray.length:n.vertexArrayOffset;for(const T of n.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*T.edges+T.top);for(let I=0;I<T.top;I++)this.centroidVertexArray.emplace(x++,h,_);for(let I=0;I<2*T.edges;I++)this.centroidVertexArray.emplace(x++,0,_),this.centroidVertexArray.emplace(x++,h,_)}}}function Mm(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function Sm(t,e,n,s){const h=e.sub(t)._perp()._unit(),_=n.sub(e)._perp()._unit();return Am(t,e,n,Mm(h,_),s)}function Am(t,e,n,s,h){const _=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(n)/3,h*_/s)}function Pm(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function sl(t,e,n){if(t.x<0||t.x>=Di||e.x<0||e.x>=Di||n.x<0||n.x>=Di)return!1;const s=n.sub(e),h=s.perp(),_=t.sub(e);return(s.x*_.x+s.y*_.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(_.x*_.x+_.y*_.y))>-.866&&h.x*_.x+h.y*_.y<0}function Om(t,e,n){const s=e?2|t:-3&t;return n?1|s:-2&s}function qp(){const t=Math.PI/32,e=Math.tan(t),n=Bl;return n*Math.sqrt(1+2*e*e)-n}function Rm(t,e,n){const s=1<<n.z,h=Ca(n.x/s),_=Ca((n.x+1)/s),x=ts(n.y/s),T=ts((n.y+1)/s);return function(I,A,L,N,Z=0,J){const ee=[];if(!I.length||!L||!N)return ee;const pe=(mt,Kt)=>{for(const qt of mt)ee.push({polygon:qt,bounds:Kt})},Pe=Math.ceil(Math.log2(L)),Qe=Math.ceil(Math.log2(N)),ut=Pe-Qe,et=[];for(let mt=0;mt<Math.abs(ut);mt++)et.push(ut>0?0:1);for(let mt=0;mt<Math.min(Pe,Qe);mt++)et.push(0),et.push(1);let st=I;if(st=Ih(st,A[0].y-Z,A[1].y+Z,1),st=Ih(st,A[0].x-Z,A[1].x+Z,0),!st.length)return ee;const Ct=[];for(et.length?Ct.push({polygons:st,bounds:A,depth:0}):pe(st,A);Ct.length;){const mt=Ct.pop(),Kt=mt.depth,qt=et[Kt],mn=mt.bounds[0],Mn=mt.bounds[1],an=0===qt?mn.x:mn.y,_n=0===qt?Mn.x:Mn.y,vn=J?J(qt,an,_n):.5*(an+_n),In=Ih(mt.polygons,an-Z,vn+Z,qt),On=Ih(mt.polygons,vn-Z,_n+Z,qt);if(In.length){const sn=[mn,new Q(0===qt?vn:Mn.x,1===qt?vn:Mn.y)];et.length>Kt+1?Ct.push({polygons:In,bounds:sn,depth:Kt+1}):pe(In,sn)}if(On.length){const sn=[new Q(0===qt?vn:mn.x,1===qt?vn:mn.y),Mn];et.length>Kt+1?Ct.push({polygons:On,bounds:sn,depth:Kt+1}):pe(On,sn)}}return ee}(t,e,Math.ceil((_-h)/11.25),Math.ceil((x-T)/11.25),1,(I,A,L)=>{if(0===I)return.5*(A+L);{const N=ts((n.y+A/Di)/s);return(za(.5*(ts((n.y+L/Di)/s)+N))*s-n.y)*Di}})}Zn(Qu,"FillExtrusionBucket",{omit:["layers","features"]}),Zn(Wp,"PartMetadata");const T_=new hi({"fill-extrusion-edge-radius":new $t(Xt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var E_={paint:new hi({"fill-extrusion-opacity":new $t(Xt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new rn(Xt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $t(Xt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $t(Xt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new rn(Xt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new rn(Xt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new rn(Xt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $t(Xt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new $t(Xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new $t(Xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:T_};function Lm(t,e,n){var s=2*Math.PI*6378137/256/Math.pow(2,n);return[t*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Md{constructor(e,n,s){this.z=e,this.x=n,this.y=s,this.key=Sd(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const s=(x=this.y,T=this.z,I=Lm(256*(_=this.x),256*(x=Math.pow(2,T)-x-1),T),A=Lm(256*(_+1),256*(x+1),T),I[0]+","+I[1]+","+A[0]+","+A[1]),h=function(_,x,T){let I,A="";for(let L=_;L>0;L--)I=1<<L-1,A+=(x&I?1:0)+(T&I?2:0);return A}(this.z,this.x,this.y);var _,x,T,I,A;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Fm{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Sd(e,n.z,n.z,n.x,n.y)}}class js{constructor(e,n,s,h,_){this.overscaledZ=e,this.wrap=n,this.canonical=new Md(s,+h,+_),this.key=0===n&&e===s?this.canonical.key:Sd(n,e,s,h,_)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new js(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new js(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Sd(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Sd(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new js(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new js(n,this.wrap,n,s,h),new js(n,this.wrap,n,s+1,h),new js(n,this.wrap,n,s,h+1),new js(n,this.wrap,n,s+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new js(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new js(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Fm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Sd(t,e,n,s,h){const _=1<<Math.min(n,22);let x=_*(h%_)+s%_;return t&&n<22&&(x+=_*_*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*x+n)+(e-n)}Zn(Md,"CanonicalTileID"),Zn(js,"OverscaledTileID",{omit:["projMatrix"]});class zi extends Q{constructor(e,n,s){super(e,n),this.z=s}}function ed(t,e){return t.x*e.x+t.y*e.y}function Yp(t,e){if(1===t.length){let n=0;const s=e[n++];let h;for(;!h||s.equals(h);)if(h=e[n++],!h)return 1/0;for(;n<e.length;n++){const _=e[n],x=t[0],T=h.sub(s),I=_.sub(s),A=x.sub(s),L=ed(T,T),N=ed(T,I),Z=ed(I,I),J=ed(A,T),ee=ed(A,I),pe=L*Z-N*N,Pe=(Z*J-N*ee)/pe,Qe=(L*ee-N*J)/pe,ut=s.z*(1-Pe-Qe)+h.z*Pe+_.z*Qe;if(isFinite(ut))return ut}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}function Jp(t,e,n,s,h,_,x,T){const I=x*h.getElevationAt(t,e,!0,!0),A=0!==_[0],L=A?0===_[1]?x*(_[0]/7-450):x*function(N,Z,J){const ee=Math.floor(Z[0]/8),pe=Math.floor(Z[1]/8),Pe=10*(Z[0]-8*ee),Qe=10*(Z[1]-8*pe),ut=N.getElevationAt(ee,pe,!0,!0),et=N.getMeterToDEM(J),st=Math.floor(.5*(Pe*et-1)),Ct=Math.floor(.5*(Qe*et-1)),mt=N.tileCoordToPixel(ee,pe),Kt=2*st+1,qt=2*Ct+1,mn=(gi=Kt,qn=qt,[(On=N).getElevationAtPixel(sn=mt.x-st,Gn=mt.y-Ct,!0),On.getElevationAtPixel(sn+qn,Gn,!0),On.getElevationAtPixel(sn,Gn+qn,!0),On.getElevationAtPixel(sn+gi,Gn+qn,!0)]),Mn=Math.abs(mn[0]-mn[1]),an=Math.abs(mn[2]-mn[3]),_n=Math.abs(mn[0]-mn[2])+Math.abs(mn[1]-mn[3]),vn=Math.min(.25,.5*et*(Mn+an)/Kt),In=Math.min(.25,.5*et*_n/qt);var On,sn,Gn,gi,qn;return ut+Math.max(vn*Pe,In*Qe)}(h,_,T):I;return{base:I+(0===n)?-1:n,top:A?Math.max(L+s,I+n+2):I+s}}const D_=Xn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:I_}=D_,km=Xn([{name:"a_packed",components:4,type:"Float32"}]),{members:M_}=km,Bm=Dh.types,S_=Math.cos(Math.PI/180*37.5);class Sh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new ps,this.layoutVertexArray2=new ba,this.indexArray=new es,this.programConfigurations=new Wc(e.layers,e.zoom),this.segments=new Ao,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,h){this.hasPattern=iu("line",this.layers,n);const _=this.layers[0].layout.get("line-sort-key"),x=[];for(const{feature:L,id:N,index:Z,sourceLayerIndex:J}of e){const ee=this.layers[0]._featureFilter.needGeometry,pe=qc(L,ee);if(!this.layers[0]._featureFilter.filter(new Ut(this.zoom),pe,s))continue;const Pe=_?_.evaluate(pe,{},s):void 0,Qe={id:N,properties:L.properties,type:L.type,sourceLayerIndex:J,index:Z,geometry:ee?pe.geometry:Nl(L,s,h),patterns:{},sortKey:Pe};x.push(Qe)}_&&x.sort((L,N)=>L.sortKey-N.sortKey);const{lineAtlas:T,featureIndex:I}=n,A=this.addConstantDashes(T);for(const L of x){const{geometry:N,index:Z,sourceLayerIndex:J}=L;if(A&&this.addFeatureDashes(L,T),this.hasPattern){const ee=Gp("line",this.layers,L,this.zoom,n);this.patternFeatures.push(ee)}else this.addFeature(L,N,Z,s,T.positions,n.availableImages);I.insert(e[Z].feature,N,Z,J,this.index)}}addConstantDashes(e){let n=!1;for(const s of this.layers){const h=s.paint.get("line-dasharray").value,_=s.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==_.kind)n=!0;else{const x=_.value,T=h.value;if(!T)continue;e.addDash(T,x)}}return n}addFeatureDashes(e,n){const s=this.zoom;for(const h of this.layers){const _=h.paint.get("line-dasharray").value,x=h.layout.get("line-cap").value;if("constant"===_.kind&&"constant"===x.kind)continue;let T,I;if("constant"===_.kind){if(T=_.value,!T)continue}else T=_.evaluate({zoom:s},e);I="constant"===x.kind?x.value:x.evaluate({zoom:s},e),n.addDash(T,I),e.patterns[h.id]=n.getKey(T,I)}}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}addFeatures(e,n,s,h,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,n,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,M_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,I_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,h,_,x){const T=this.layers[0].layout,I=T.get("line-join").evaluate(e,{}),A=T.get("line-cap").evaluate(e,{}),L=T.get("line-miter-limit"),N=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const Z of n)this.addLine(Z,e,I,A,L,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,_,x,h)}addLine(e,n,s,h,_,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Qe=0;Qe<e.length-1;Qe++)this.totalDistance+=e[Qe].dist(e[Qe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T="Polygon"===Bm[n.type];let I=e.length;for(;I>=2&&e[I-1].equals(e[I-2]);)I--;let A=0;for(;A<I-1&&e[A].equals(e[A+1]);)A++;if(I<(T?3:2))return;"bevel"===s&&(_=1.05);const L=this.overscaling<=16?122880/(512*this.overscaling):0,N=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let Z,J,ee,pe,Pe;this.e1=this.e2=-1,T&&(Z=e[I-2],Pe=e[A].sub(Z)._unit()._perp());for(let Qe=A;Qe<I;Qe++){if(ee=Qe===I-1?T?e[A+1]:void 0:e[Qe+1],ee&&e[Qe].equals(ee))continue;Pe&&(pe=Pe),Z&&(J=Z),Z=e[Qe],Pe=ee?ee.sub(Z)._unit()._perp():pe,pe=pe||Pe;let ut=pe.add(Pe);0===ut.x&&0===ut.y||ut._unit();const et=pe.x*Pe.x+pe.y*Pe.y,st=ut.x*Pe.x+ut.y*Pe.y,Ct=0!==st?1/st:1/0,mt=2*Math.sqrt(2-2*st),Kt=st<S_&&J&&ee,qt=pe.x*Pe.y-pe.y*Pe.x>0;if(Kt&&Qe>A){const an=Z.dist(J);if(an>2*L){const _n=Z.sub(Z.sub(J)._mult(L/an)._round());this.updateDistance(J,_n),this.addCurrentVertex(_n,pe,0,0,N),J=_n}}const mn=J&&ee;let Mn=mn?s:T?"butt":h;if(mn&&"round"===Mn&&(Ct<x?Mn="miter":Ct<=2&&(Mn="fakeround")),"miter"===Mn&&Ct>_&&(Mn="bevel"),"bevel"===Mn&&(Ct>2&&(Mn="flipbevel"),Ct<_&&(Mn="miter")),J&&this.updateDistance(J,Z),"miter"===Mn)ut._mult(Ct),this.addCurrentVertex(Z,ut,0,0,N);else if("flipbevel"===Mn){if(Ct>100)ut=Pe.mult(-1);else{const an=Ct*pe.add(Pe).mag()/pe.sub(Pe).mag();ut._perp()._mult(an*(qt?-1:1))}this.addCurrentVertex(Z,ut,0,0,N),this.addCurrentVertex(Z,ut.mult(-1),0,0,N)}else if("bevel"===Mn||"fakeround"===Mn){const an=-Math.sqrt(Ct*Ct-1),_n=qt?an:0,vn=qt?0:an;if(J&&this.addCurrentVertex(Z,pe,_n,vn,N),"fakeround"===Mn){const In=Math.round(180*mt/Math.PI/20);for(let On=1;On<In;On++){let sn=On/In;if(.5!==sn){const gi=sn-.5;sn+=sn*gi*(sn-1)*((1.0904+et*(et*(3.55645-1.43519*et)-3.2452))*gi*gi+(.848013+et*(.215638*et-1.06021)))}const Gn=Pe.sub(pe)._mult(sn)._add(pe)._unit()._mult(qt?-1:1);this.addHalfVertex(Z,Gn.x,Gn.y,!1,qt,0,N)}}ee&&this.addCurrentVertex(Z,Pe,-_n,-vn,N)}else if("butt"===Mn)this.addCurrentVertex(Z,ut,0,0,N);else if("square"===Mn){const an=J?1:-1;J||this.addCurrentVertex(Z,ut,an,an,N),this.addCurrentVertex(Z,ut,0,0,N),J&&this.addCurrentVertex(Z,ut,an,an,N)}else"round"===Mn&&(J&&(this.addCurrentVertex(Z,pe,0,0,N),this.addCurrentVertex(Z,pe,1,1,N,!0)),ee&&(this.addCurrentVertex(Z,Pe,-1,-1,N,!0),this.addCurrentVertex(Z,Pe,0,0,N)));if(Kt&&Qe<I-1){const an=Z.dist(ee);if(an>2*L){const _n=Z.add(ee.sub(Z)._mult(L/an)._round());this.updateDistance(Z,_n),this.addCurrentVertex(_n,Pe,0,0,N),Z=_n}}}}addCurrentVertex(e,n,s,h,_,x=!1){const T=n.y*h-n.x,I=-n.y-n.x*h;this.addHalfVertex(e,n.x+n.y*s,n.y-n.x*s,x,!1,s,_),this.addHalfVertex(e,T,I,x,!0,-h,_)}addHalfVertex({x:e,y:n},s,h,_,x,T,I){this.layoutVertexArray.emplaceBack((e<<1)+(_?1:0),(n<<1)+(x?1:0),Math.round(63*s)+128,Math.round(63*h)+128,1+(0===T?0:T<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const A=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),I.primitiveLength++),x?this.e2=A:this.e1=A}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}Zn(Sh,"LineBucket",{omit:["layers","patternFeatures"]});const Fy=new hi({"line-cap":new rn(Xt.layout_line["line-cap"]),"line-join":new rn(Xt.layout_line["line-join"]),"line-miter-limit":new $t(Xt.layout_line["line-miter-limit"]),"line-round-limit":new $t(Xt.layout_line["line-round-limit"]),"line-sort-key":new rn(Xt.layout_line["line-sort-key"])});var Xp={paint:new hi({"line-opacity":new rn(Xt.paint_line["line-opacity"]),"line-color":new rn(Xt.paint_line["line-color"]),"line-translate":new $t(Xt.paint_line["line-translate"]),"line-translate-anchor":new $t(Xt.paint_line["line-translate-anchor"]),"line-width":new rn(Xt.paint_line["line-width"]),"line-gap-width":new rn(Xt.paint_line["line-gap-width"]),"line-offset":new rn(Xt.paint_line["line-offset"]),"line-blur":new rn(Xt.paint_line["line-blur"]),"line-dasharray":new rn(Xt.paint_line["line-dasharray"]),"line-pattern":new rn(Xt.paint_line["line-pattern"]),"line-gradient":new ni(Xt.paint_line["line-gradient"]),"line-trim-offset":new $t(Xt.paint_line["line-trim-offset"])}),layout:Fy};const Kp=new class extends rn{possiblyEvaluate(t,e){return e=new Ut(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,s){return e=Tt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,s)}}(Xp.paint.properties["line-width"].specification);function Ac(t,e){return e>0?e+2*t:t}Kp.useIntegerZoom=!0;const A_=Xn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Qp=Xn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ef=Xn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Xn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const P_=Xn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ky=Xn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Xn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const O_=Xn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),By=Xn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Xn([{name:"triangle",components:3,type:"Uint16"}]),Xn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Xn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Xn([{type:"Float32",name:"offsetX"}]),Xn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const Dl=128;function Nm(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Ut(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:h}=n;let _=0;for(;_<s.length&&s[_]<=t;)_++;_=Math.max(0,_-1);let x=_;for(;x<s.length&&s[x]<t+1;)x++;x=Math.min(s.length-1,x);const T=s[_],I=s[x];return"composite"===n.kind?{kind:"composite",minZoom:T,maxZoom:I,interpolationType:h}:{kind:"camera",minZoom:T,maxZoom:I,minSize:n.evaluate(new Ut(T)),maxSize:n.evaluate(new Ut(I)),interpolationType:h}}}function Ah(t,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:h}){return"source"===t.kind?s/Dl:"composite"===t.kind?wi(s/Dl,h/Dl,n):e}function Il(t,e){let n=0,s=0;if("constant"===t.kind)s=t.layoutSize;else if("source"!==t.kind){const{interpolationType:h,minZoom:_,maxZoom:x}=t,T=h?ge(Ri.interpolationFactor(h,e,_,x),0,1):0;"camera"===t.kind?s=wi(t.minSize,t.maxSize,T):n=T}return{uSizeT:n,uSize:s}}var R_=Object.freeze({__proto__:null,getSizeData:Nm,evaluateSizeForFeature:Ah,evaluateSizeForZoom:Il,SIZE_PACK_FACTOR:Dl});function zm(t,e,n){return t.sections.forEach(s=>{s.text=function(h,_,x){const T=_.layout.get("text-transform").evaluate(x,{});return"uppercase"===T?h=h.toLocaleUpperCase():"lowercase"===T&&(h=h.toLocaleLowerCase()),Wt.applyArabicShaping&&(h=Wt.applyArabicShaping(h)),h}(s.text,e,n)}),t}const Pc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function L_(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function Um(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var Ad=$r,Vm=function(t,e,n,s,h){var _,x,T=8*h-s-1,I=(1<<T)-1,A=I>>1,L=-7,N=n?h-1:0,Z=n?-1:1,J=t[e+N];for(N+=Z,_=J&(1<<-L)-1,J>>=-L,L+=T;L>0;_=256*_+t[e+N],N+=Z,L-=8);for(x=_&(1<<-L)-1,_>>=-L,L+=s;L>0;x=256*x+t[e+N],N+=Z,L-=8);if(0===_)_=1-A;else{if(_===I)return x?NaN:1/0*(J?-1:1);x+=Math.pow(2,s),_-=A}return(J?-1:1)*x*Math.pow(2,_-s)},jm=function(t,e,n,s,h,_){var x,T,I,A=8*_-h-1,L=(1<<A)-1,N=L>>1,Z=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,J=s?0:_-1,ee=s?1:-1,pe=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(T=isNaN(e)?1:0,x=L):(x=Math.floor(Math.log(e)/Math.LN2),e*(I=Math.pow(2,-x))<1&&(x--,I*=2),(e+=x+N>=1?Z/I:Z*Math.pow(2,1-N))*I>=2&&(x++,I/=2),x+N>=L?(T=0,x=L):x+N>=1?(T=(e*I-1)*Math.pow(2,h),x+=N):(T=e*Math.pow(2,N-1)*Math.pow(2,h),x=0));h>=8;t[n+J]=255&T,J+=ee,T/=256,h-=8);for(x=x<<h|T,A+=h;A>0;t[n+J]=255&x,J+=ee,x/=256,A-=8);t[n+J-ee]|=128*pe};function $r(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}$r.Varint=0,$r.Fixed64=1,$r.Bytes=2,$r.Fixed32=5;var tf=4294967296,nf=1/tf,$m=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function jl(t){return t.type===$r.Bytes?t.readVarint()+t.pos:t.pos+1}function Ph(t,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var h=n.pos-1;h>=t;h--)n.buf[h+s]=n.buf[h]}function Ny(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function rf(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function F_(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function zy(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function td(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function Zm(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function k_(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function Gm(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function B_(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Oh(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function rc(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function ou(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function sf(t,e,n){e.glyphs=[],1===t&&n.readMessage(Pd,e)}function Pd(t,e,n){if(3===t){const{id:s,bitmap:h,width:_,height:x,left:T,top:I,advance:A}=n.readMessage(af,{});e.glyphs.push({id:s,bitmap:new Ul({width:_+6,height:x+6},h),metrics:{width:_,height:x,left:T,top:I,advance:A}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function af(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function nd(t){let e=0,n=0;for(const x of t)e+=x.w*x.h,n=Math.max(n,x.w);t.sort((x,T)=>T.h-x.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let h=0,_=0;for(const x of t)for(let T=s.length-1;T>=0;T--){const I=s[T];if(!(x.w>I.w||x.h>I.h)){if(x.x=I.x,x.y=I.y,_=Math.max(_,x.y+x.h),h=Math.max(h,x.x+x.w),x.w===I.w&&x.h===I.h){const A=s.pop();T<s.length&&(s[T]=A)}else x.h===I.h?(I.x+=x.w,I.w-=x.w):x.w===I.w?(I.y+=x.h,I.h-=x.h):(s.push({x:I.x+x.w,y:I.y,w:I.w-x.w,h:x.h}),I.y+=x.h,I.h-=x.h);break}}return{w:h,h:_,fill:e/(h*_)||0}}$r.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),h=s>>3,_=this.pos;this.type=7&s,t(h,e,this),this.pos===_&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Oh(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=ou(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Oh(this.buf,this.pos)+Oh(this.buf,this.pos+4)*tf;return this.pos+=8,t},readSFixed64:function(){var t=Oh(this.buf,this.pos)+ou(this.buf,this.pos+4)*tf;return this.pos+=8,t},readFloat:function(){var t=Vm(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Vm(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(h,_,x){var T,I,A=x.buf;if(T=(112&(I=A[x.pos++]))>>4,I<128||(T|=(127&(I=A[x.pos++]))<<3,I<128)||(T|=(127&(I=A[x.pos++]))<<10,I<128)||(T|=(127&(I=A[x.pos++]))<<17,I<128)||(T|=(127&(I=A[x.pos++]))<<24,I<128)||(T|=(1&(I=A[x.pos++]))<<31,I<128))return function ru(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(h,T,_);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&$m?$m.decode(this.buf.subarray(e,t)):function(n,s,h){for(var _="",x=s;x<h;){var T,I,A,L=n[x],N=null,Z=L>239?4:L>223?3:L>191?2:1;if(x+Z>h)break;1===Z?L<128&&(N=L):2===Z?128==(192&(T=n[x+1]))&&(N=(31&L)<<6|63&T)<=127&&(N=null):3===Z?(I=n[x+2],128==(192&(T=n[x+1]))&&128==(192&I)&&((N=(15&L)<<12|(63&T)<<6|63&I)<=2047||N>=55296&&N<=57343)&&(N=null)):4===Z&&(I=n[x+2],A=n[x+3],128==(192&(T=n[x+1]))&&128==(192&I)&&128==(192&A)&&((N=(15&L)<<18|(63&T)<<12|(63&I)<<6|63&A)<=65535||N>=1114112)&&(N=null)),null===N?(N=65533,Z=1):N>65535&&(N-=65536,_+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),_+=String.fromCharCode(N),x+=Z}return _}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==$r.Bytes)return t.push(this.readVarint(e));var n=jl(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==$r.Bytes)return t.push(this.readSVarint());var e=jl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==$r.Bytes)return t.push(this.readBoolean());var e=jl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==$r.Bytes)return t.push(this.readFloat());var e=jl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==$r.Bytes)return t.push(this.readDouble());var e=jl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==$r.Bytes)return t.push(this.readFixed32());var e=jl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==$r.Bytes)return t.push(this.readSFixed32());var e=jl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==$r.Bytes)return t.push(this.readFixed64());var e=jl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==$r.Bytes)return t.push(this.readSFixed64());var e=jl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===$r.Varint)for(;this.buf[this.pos++]>127;);else if(e===$r.Bytes)this.pos=this.readVarint()+this.pos;else if(e===$r.Fixed32)this.pos+=4;else{if(e!==$r.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),rc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),rc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),rc(this.buf,-1&t,this.pos),rc(this.buf,Math.floor(t*nf),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),rc(this.buf,-1&t,this.pos),rc(this.buf,Math.floor(t*nf),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var s,h,_,T;if(e>=0?(s=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,h=h+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),_=s,(T=n).buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,T.buf[T.pos]=127&(_>>>=7),function(_,x){var T=(7&_)<<4;x.buf[x.pos++]|=T|((_>>>=3)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_)))))}(h,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,h,_){for(var x,T,I=0;I<h.length;I++){if((x=h.charCodeAt(I))>55295&&x<57344){if(!T){x>56319||I+1===h.length?(s[_++]=239,s[_++]=191,s[_++]=189):T=x;continue}if(x<56320){s[_++]=239,s[_++]=191,s[_++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(s[_++]=239,s[_++]=191,s[_++]=189,T=null);x<128?s[_++]=x:(x<2048?s[_++]=x>>6|192:(x<65536?s[_++]=x>>12|224:(s[_++]=x>>18|240,s[_++]=x>>12&63|128),s[_++]=x>>6&63|128),s[_++]=63&x|128)}return _}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&Ph(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),jm(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),jm(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var s=this.pos-n;s>=128&&Ph(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,n){this.writeTag(t,$r.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Ny,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,rf,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,td,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,F_,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,zy,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Zm,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,k_,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Gm,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,B_,e)},writeBytesField:function(t,e){this.writeTag(t,$r.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,$r.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,$r.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,$r.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,$r.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,$r.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,$r.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,$r.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,$r.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,$r.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Rh{constructor(e,{pixelRatio:n,version:s,stretchX:h,stretchY:_,content:x}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=h,this.stretchY=_,this.content=x,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Lh{constructor(e,n){const s={},h={};this.haveRenderCallbacks=[];const _=[];this.addImages(e,s,_),this.addImages(n,h,_);const{w:x,h:T}=nd(_),I=new sa({width:x||1,height:T||1});for(const A in e){const L=e[A],N=s[A].paddedRect;sa.copy(L.data,I,{x:0,y:0},{x:N.x+1,y:N.y+1},L.data)}for(const A in n){const L=n[A],N=h[A].paddedRect,Z=N.x+1,J=N.y+1,ee=L.data.width,pe=L.data.height;sa.copy(L.data,I,{x:0,y:0},{x:Z,y:J},L.data),sa.copy(L.data,I,{x:0,y:pe-1},{x:Z,y:J-1},{width:ee,height:1}),sa.copy(L.data,I,{x:0,y:0},{x:Z,y:J+pe},{width:ee,height:1}),sa.copy(L.data,I,{x:ee-1,y:0},{x:Z-1,y:J},{width:1,height:pe}),sa.copy(L.data,I,{x:0,y:0},{x:Z+ee,y:J},{width:1,height:pe})}this.image=I,this.iconPositions=s,this.patternPositions=h}addImages(e,n,s){for(const h in e){const _=e[h],x={x:0,y:0,w:_.data.width+2,h:_.data.height+2};s.push(x),n[h]=new Rh(x,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[h,_]=e.tl;s.update(n.data,void 0,{x:h,y:_})}}Zn(Rh,"ImagePosition"),Zn(Lh,"ImageAtlas");const aa={horizontal:1,vertical:2,horizontalOnly:3};class su{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new su;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new su;return n.imageName=e,n}}class au{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new au;for(let h=0;h<e.sections.length;h++){const _=e.sections[h];_.image?s.addImageSection(_):s.addTextSection(_,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,s){let h="";for(let _=0;_<n.length;_++){const x=n.charCodeAt(_+1)||null,T=n.charCodeAt(_-1)||null;h+=!s&&(x&&F(x)&&!Pc[n[_+1]]||T&&F(T)&&!Pc[n[_-1]])||!Pc[n[_]]?n[_]:Pc[n[_]]}return h}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Fh[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Fh[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new au;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(su.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.name:"";if(0===n.length)return void yn("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(su.forImage(n)),this.sectionIndex.push(this.sections.length-1)):yn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Od(t,e,n,s,h,_,x,T,I,A,L,N,Z,J,ee){const pe=au.fromFeature(t,h);N===aa.vertical&&pe.verticalizePunctuation(Z);let Pe=[];const Qe=function(mt,Kt,qt,mn,Mn,an){if(!mt)return[];const _n=[],vn=function(Gn,gi,qn,ei,jn,_i){let Ji=0;for(let Wi=0;Wi<Gn.length();Wi++){const qi=Gn.getSection(Wi);Ji+=lf(Gn.getCharCode(Wi),qi,ei,jn,gi,_i)}return Ji/Math.max(1,Math.ceil(Ji/qn))}(mt,Kt,qt,mn,Mn,an),In=mt.text.indexOf("\u200b")>=0;let On=0;for(let Gn=0;Gn<mt.length();Gn++){const gi=mt.getSection(Gn),qn=mt.getCharCode(Gn);if(Fh[qn]||(On+=lf(qn,gi,mn,Mn,Kt,an)),Gn<mt.length()-1){const ei=!((sn=qn)<11904||!(na(sn)||Kd(sn)||u(sn)||Qa(sn)||Cc(sn)||Su(sn)||Qd(sn)||Ol(sn)||Rl(sn)||Zc(sn)||xo(sn)||p(sn)||wc(sn)||Pu(sn)||Au(sn)||Ru(sn)||Ou(sn)||i(sn)||Ka(sn)||Ms(sn)));(N_[qn]||ei||gi.imageName)&&_n.push(cf(Gn+1,On,vn,_n,Wm(qn,mt.getCharCode(Gn+1),ei&&In),!1))}}var sn;return qm(cf(mt.length(),On,vn,_n,0,!0))}(pe,A,_,e,s,J),{processBidirectionalText:ut,processStyledBidirectionalText:et}=Wt;if(ut&&1===pe.sections.length){const mt=ut(pe.toString(),Qe);for(const Kt of mt){const qt=new au;qt.text=Kt,qt.sections=pe.sections;for(let mn=0;mn<Kt.length;mn++)qt.sectionIndex.push(0);Pe.push(qt)}}else if(et){const mt=et(pe.text,pe.sectionIndex,Qe);for(const Kt of mt){const qt=new au;qt.text=Kt[0],qt.sectionIndex=Kt[1],qt.sections=pe.sections,Pe.push(qt)}}else Pe=function(mt,Kt){const qt=[],mn=mt.text;let Mn=0;for(const an of Kt)qt.push(mt.substring(Mn,an)),Mn=an;return Mn<mn.length&&qt.push(mt.substring(Mn,mn.length)),qt}(pe,Qe);const st=[],Ct={positionedLines:st,text:pe.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:N,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(mt,Kt,qt,mn,Mn,an,_n,vn,In,On,sn,Gn){let gi=0,qn=0,ei=0;const jn="right"===vn?1:"left"===vn?0:.5;let _i=!1;for(const Oi of Mn){const Ki=Oi.getSections();for(const Fr of Ki){if(Fr.imageName)continue;const Yr=Kt[Fr.fontStack];if(Yr&&(_i=void 0!==Yr.ascender&&void 0!==Yr.descender,!_i))break}if(!_i)break}let Ji=0;for(const Oi of Mn){Oi.trim();const Ki=Oi.getMaxScale(),Fr=24*(Ki-1),Yr={positionedGlyphs:[],lineOffset:0};mt.positionedLines[Ji]=Yr;const Zr=Yr.positionedGlyphs;let Jr=0;if(!Oi.length()){qn+=an,++Ji;continue}let Qr=0,po=0;for(let Pr=0;Pr<Oi.length();Pr++){const Po=Oi.getSection(Pr),Io=Oi.getSectionIndex(Pr),pr=Oi.getCharCode(Pr);let oo=Po.scale,No=null,kr=null,bo=null,Rs=24,rs=0;const os=!(In===aa.horizontal||!sn&&!P(pr)||sn&&(Fh[pr]||(Wi=pr,jc(Wi)||$c(Wi)||Ar(Wi)||m(Wi)||f(Wi))));if(Po.imageName){const Ls=mn[Po.imageName];if(!Ls)continue;bo=Po.imageName,mt.iconsInText=mt.iconsInText||!0,kr=Ls.paddedRect;const Go=Ls.displaySize;oo=24*oo/Gn,No={width:Go[0],height:Go[1],left:1,top:-3,advance:os?Go[1]:Go[0],localGlyph:!1},rs=_i?-No.height*oo:24*Ki-17-Go[1]*oo,Rs=No.advance;const Gl=(os?Go[0]:Go[1])*oo-24*Ki;Gl>0&&Gl>Jr&&(Jr=Gl)}else{const Ls=qt[Po.fontStack];if(!Ls)continue;Ls[pr]&&(kr=Ls[pr]);const Go=Kt[Po.fontStack];if(!Go)continue;const Gl=Go.glyphs[pr];if(!Gl)continue;if(No=Gl.metrics,Rs=8203!==pr?24:0,_i){const wu=void 0!==Go.ascender?Math.abs(Go.ascender):0,pd=void 0!==Go.descender?Math.abs(Go.descender):0,fd=(wu+pd)*oo;Qr<fd&&(Qr=fd,po=(wu-pd)/2*oo),rs=-wu*oo}else rs=24*(Ki-oo)-17}os?(mt.verticalizable=!0,Zr.push({glyph:pr,imageName:bo,x:gi,y:qn+rs,vertical:os,scale:oo,localGlyph:No.localGlyph,fontStack:Po.fontStack,sectionIndex:Io,metrics:No,rect:kr}),gi+=Rs*oo+On):(Zr.push({glyph:pr,imageName:bo,x:gi,y:qn+rs,vertical:os,scale:oo,localGlyph:No.localGlyph,fontStack:Po.fontStack,sectionIndex:Io,metrics:No,rect:kr}),gi+=No.advance*oo+On)}0!==Zr.length&&(ei=Math.max(gi-On,ei),_i?Da(Zr,jn,Jr,po,an*Ki/2):Da(Zr,jn,Jr,0,an/2)),gi=0;const is=an*Ki+Jr;Yr.lineOffset=Math.max(Jr,Fr),qn+=is,++Ji}var Wi;const qi=qn,{horizontalAlign:Ti,verticalAlign:Mr}=uf(_n);(function(Oi,Ki,Fr,Yr,Zr,Jr){const Qr=(Ki-Fr)*Zr,po=-Jr*Yr;for(const is of Oi)for(const Pr of is.positionedGlyphs)Pr.x+=Qr,Pr.y+=po})(mt.positionedLines,jn,Ti,Mr,ei,qi),mt.top+=-Mr*qi,mt.bottom=mt.top+qi,mt.left+=-Ti*ei,mt.right=mt.left+ei,mt.hasBaseline=_i}(Ct,e,n,s,Pe,x,T,I,N,A,Z,ee),!function(mt){for(const Kt of mt)if(0!==Kt.positionedGlyphs.length)return!1;return!0}(st)&&Ct}const Fh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},N_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function lf(t,e,n,s,h,_){if(e.imageName){const x=s[e.imageName];return x?x.displaySize[0]*e.scale*24/_+h:0}{const x=n[e.fontStack],T=x&&x.glyphs[t];return T?T.metrics.advance*e.scale+h:0}}function Hm(t,e,n,s){const h=Math.pow(t-e,2);return s?t<e?h/2:2*h:h+Math.abs(n)*n}function Wm(t,e,n){let s=0;return 10===t&&(s-=1e4),n&&(s+=150),40!==t&&65288!==t||(s+=50),41!==e&&65289!==e||(s+=50),s}function cf(t,e,n,s,h,_){let x=null,T=Hm(e,n,h,_);for(const I of s){const A=Hm(e-I.x,n,h,_)+I.badness;A<=T&&(x=I,T=A)}return{index:t,x:e,priorBreak:x,badness:T}}function qm(t){return t?qm(t.priorBreak).concat(t.index):[]}function uf(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Da(t,e,n,s,h){if(!(e||n||s||h))return;const _=t.length-1,x=t[_],T=(x.x+x.metrics.advance*x.scale)*e;for(let I=0;I<=_;I++)t[I].x-=T,t[I].y+=n+s+h}function Ym(t,e,n){const{horizontalAlign:s,verticalAlign:h}=uf(n),_=e[0]-t.displaySize[0]*s,x=e[1]-t.displaySize[1]*h;return{image:t,top:x,bottom:x+t.displaySize[1],left:_,right:_+t.displaySize[0]}}function Jm(t,e,n,s,h,_){const x=t.image;let T;if(x.content){const Pe=x.content,Qe=x.pixelRatio||1;T=[Pe[0]/Qe,Pe[1]/Qe,x.displaySize[0]-Pe[2]/Qe,x.displaySize[1]-Pe[3]/Qe]}const I=e.left*_,A=e.right*_;let L,N,Z,J;"width"===n||"both"===n?(J=h[0]+I-s[3],N=h[0]+A+s[1]):(J=h[0]+(I+A-x.displaySize[0])/2,N=J+x.displaySize[0]);const ee=e.top*_,pe=e.bottom*_;return"height"===n||"both"===n?(L=h[1]+ee-s[0],Z=h[1]+pe+s[2]):(L=h[1]+(ee+pe-x.displaySize[1])/2,Z=L+x.displaySize[1]),{image:x,top:L,right:N,bottom:Z,left:J,collisionPadding:T}}class Oc extends Q{constructor(e,n,s,h,_){super(e,n),this.angle=h,this.z=s,void 0!==_&&(this.segment=_)}clone(){return new Oc(this.x,this.y,this.z,this.angle,this.segment)}}function kh(t,e,n,s,h){if(void 0===e.segment)return!0;let _=e,x=e.segment+1,T=0;for(;T>-n/2;){if(x--,x<0)return!1;T-=t[x].dist(_),_=t[x]}T+=t[x].dist(t[x+1]),x++;const I=[];let A=0;for(;T<n/2;){const L=t[x],N=t[x+1];if(!N)return!1;let Z=t[x-1].angleTo(L)-L.angleTo(N);for(Z=Math.abs((Z+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:T,angleDelta:Z}),A+=Z;T-I[0].distance>s;)A-=I.shift().angleDelta;if(A>h)return!1;x++,T+=L.dist(N)}return!0}function df(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Xm(t,e,n){return t?.6*e*n:0}function Km(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function z_(t,e,n,s,h,_){const x=Xm(n,h,_),T=Km(n,s)*_;let I=0;const A=df(t)/2;for(let L=0;L<t.length-1;L++){const N=t[L],Z=t[L+1],J=N.dist(Z);if(I+J>A){const ee=(A-I)/J,pe=wi(N.x,Z.x,ee),Pe=wi(N.y,Z.y,ee),Qe=new Oc(pe,Pe,0,Z.angleTo(N),L);return!x||kh(t,Qe,T,x,e)?Qe:void 0}I+=J}}function Qm(t,e,n,s,h,_,x,T,I){const A=Xm(s,_,x),L=Km(s,h),N=L*x,Z=0===t[0].x||t[0].x===I||0===t[0].y||t[0].y===I;return e-N<e/4&&(e=N+e/4),eg(t,Z?e/2*T%e:(L/2+2*_)*x*T%e,e,A,n,N,Z,!1,I)}function eg(t,e,n,s,h,_,x,T,I){const A=_/2,L=df(t);let N=0,Z=e-n,J=[];for(let ee=0;ee<t.length-1;ee++){const pe=t[ee],Pe=t[ee+1],Qe=pe.dist(Pe),ut=Pe.angleTo(pe);for(;Z+n<N+Qe;){Z+=n;const et=(Z-N)/Qe,st=wi(pe.x,Pe.x,et),Ct=wi(pe.y,Pe.y,et);if(st>=0&&st<I&&Ct>=0&&Ct<I&&Z-A>=0&&Z+A<=L){const mt=new Oc(st,Ct,0,ut,ee);mt._round(),s&&!kh(t,mt,_,s,h)||J.push(mt)}}N+=Qe}return T||J.length||x||(J=eg(t,N/2,n,s,h,_,x,!0,I)),J}function tg(t,e,n,s,h){const _=[];for(let x=0;x<t.length;x++){const T=t[x];let I;for(let A=0;A<T.length-1;A++){let L=T[A],N=T[A+1];L.x<e&&N.x<e||(L.x<e?L=new Q(e,L.y+(e-L.x)/(N.x-L.x)*(N.y-L.y))._round():N.x<e&&(N=new Q(e,L.y+(e-L.x)/(N.x-L.x)*(N.y-L.y))._round()),L.y<n&&N.y<n||(L.y<n?L=new Q(L.x+(n-L.y)/(N.y-L.y)*(N.x-L.x),n)._round():N.y<n&&(N=new Q(L.x+(n-L.y)/(N.y-L.y)*(N.x-L.x),n)._round()),L.x>=s&&N.x>=s||(L.x>=s?L=new Q(s,L.y+(s-L.x)/(N.x-L.x)*(N.y-L.y))._round():N.x>=s&&(N=new Q(s,L.y+(s-L.x)/(N.x-L.x)*(N.y-L.y))._round()),L.y>=h&&N.y>=h||(L.y>=h?L=new Q(L.x+(h-L.y)/(N.y-L.y)*(N.x-L.x),h)._round():N.y>=h&&(N=new Q(L.x+(h-L.y)/(N.y-L.y)*(N.x-L.x),h)._round()),I&&L.equals(I[I.length-1])||(I=[L],_.push(I)),I.push(N)))))}}return _}Zn(Oc,"Anchor");const lu=1e20;function ng(t,e,n,s,h,_,x,T,I){for(let A=e;A<e+s;A++)ig(t,n*_+A,_,h,x,T,I);for(let A=n;A<n+h;A++)ig(t,A*_+e,1,s,x,T,I)}function ig(t,e,n,s,h,_,x){_[0]=0,x[0]=-lu,x[1]=lu,h[0]=t[e];for(let T=1,I=0,A=0;T<s;T++){h[T]=t[e+T*n];const L=T*T;do{const N=_[I];A=(h[T]-h[N]+L-N*N)/(T-N)/2}while(A<=x[I]&&--I>-1);I++,_[I]=T,x[I]=A,x[I+1]=lu}for(let T=0,I=0;T<s;T++){for(;x[I+1]<T;)I++;const A=_[I],L=T-A;t[e+T*n]=h[A]+L*L}}const hf={none:0,ideographs:1,all:2};class id{constructor(e,n,s){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const s=[];for(const h in e)for(const _ of e[h])s.push({stack:h,id:_});Ee(s,({stack:h,id:_},x)=>{let T=this.entries[h];T||(T=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let I=T.glyphs[_];if(void 0!==I)return void x(null,{stack:h,id:_,glyph:I});if(I=this._tinySDF(T,h,_),I)return T.glyphs[_]=I,void x(null,{stack:h,id:_,glyph:I});const A=Math.floor(_/256);if(256*A>65535)return void x(new Error("glyphs > 65535 not supported"));if(T.ranges[A])return void x(null,{stack:h,id:_,glyph:I});let L=T.requests[A];L||(L=T.requests[A]=[],id.loadGlyphRange(h,A,this.url,this.requestManager,(N,Z)=>{if(Z){T.ascender=Z.ascender,T.descender=Z.descender;for(const J in Z.glyphs)this._doesCharSupportLocalGlyph(+J)||(T.glyphs[+J]=Z.glyphs[+J]);T.ranges[A]=!0}for(const J of L)J(N,Z);delete T.requests[A]})),L.push((N,Z)=>{N?x(N):Z&&x(null,{stack:h,id:_,glyph:Z.glyphs[_]||null})})},(h,_)=>{if(h)n(h);else if(_){const x={};for(const{stack:T,id:I,glyph:A}of _)void 0===x[T]&&(x[T]={}),void 0===x[T].glyphs&&(x[T].glyphs={}),x[T].glyphs[I]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},x[T].ascender=this.entries[T].ascender,x[T].descender=this.entries[T].descender;n(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==hf.none&&(this.localGlyphMode===hf.all?!!this.localFontFamily:!!this.localFontFamily&&(Zc(e)||Tc(e)||wc(e)||Ou(e)||Ol(e)))}_tinySDF(e,n,s){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(s))return;let _=e.tinySDF;if(!_){let pe="400";/bold/i.test(n)?pe="900":/medium/i.test(n)?pe="500":/light/i.test(n)&&(pe="200"),_=e.tinySDF=new id.TinySDF({fontFamily:h,fontWeight:pe,fontSize:48,buffer:6,radius:16}),_.fontWeight=pe}if(this.localGlyphs[_.fontWeight][s])return this.localGlyphs[_.fontWeight][s];const x=String.fromCharCode(s),{data:T,width:I,height:A,glyphWidth:L,glyphHeight:N,glyphLeft:Z,glyphTop:J,glyphAdvance:ee}=_.draw(x);return this.localGlyphs[_.fontWeight][s]={id:s,bitmap:new Ul({width:I,height:A},T),metrics:{width:L/2,height:N/2,left:Z/2,top:J/2-27,advance:ee/2,localGlyph:!0}}}}function rg(t,e,n,s){const h=[],_=t.image,x=_.pixelRatio,T=_.paddedRect.w-2,I=_.paddedRect.h-2,A=t.right-t.left,L=t.bottom-t.top,N=_.stretchX||[[0,T]],Z=_.stretchY||[[0,I]],J=(an,_n)=>an+_n[1]-_n[0],ee=N.reduce(J,0),pe=Z.reduce(J,0),Pe=T-ee,Qe=I-pe;let ut=0,et=ee,st=0,Ct=pe,mt=0,Kt=Pe,qt=0,mn=Qe;if(_.content&&s){const an=_.content;ut=Ua(N,0,an[0]),st=Ua(Z,0,an[1]),et=Ua(N,an[0],an[2]),Ct=Ua(Z,an[1],an[3]),mt=an[0]-ut,qt=an[1]-st,Kt=an[2]-an[0]-et,mn=an[3]-an[1]-Ct}const Mn=(an,_n,vn,In)=>{const On=Nh(an.stretch-ut,et,A,t.left),sn=zh(an.fixed-mt,Kt,an.stretch,ee),Gn=Nh(_n.stretch-st,Ct,L,t.top),gi=zh(_n.fixed-qt,mn,_n.stretch,pe),qn=Nh(vn.stretch-ut,et,A,t.left),ei=zh(vn.fixed-mt,Kt,vn.stretch,ee),jn=Nh(In.stretch-st,Ct,L,t.top),_i=zh(In.fixed-qt,mn,In.stretch,pe),Ji=new Q(On,Gn),Wi=new Q(qn,Gn),qi=new Q(qn,jn),Ti=new Q(On,jn),Mr=new Q(sn/x,gi/x),Oi=new Q(ei/x,_i/x),Ki=e*Math.PI/180;if(Ki){const Zr=Math.sin(Ki),Jr=Math.cos(Ki),Qr=[Jr,-Zr,Zr,Jr];Ji._matMult(Qr),Wi._matMult(Qr),Ti._matMult(Qr),qi._matMult(Qr)}const Fr=an.stretch+an.fixed,Yr=_n.stretch+_n.fixed;return{tl:Ji,tr:Wi,bl:Ti,br:qi,tex:{x:_.paddedRect.x+1+Fr,y:_.paddedRect.y+1+Yr,w:vn.stretch+vn.fixed-Fr,h:In.stretch+In.fixed-Yr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mr,pixelOffsetBR:Oi,minFontScaleX:Kt/x/A,minFontScaleY:mn/x/L,isSDF:n}};if(s&&(_.stretchX||_.stretchY)){const an=Bh(N,Pe,ee),_n=Bh(Z,Qe,pe);for(let vn=0;vn<an.length-1;vn++){const In=an[vn],On=an[vn+1];for(let sn=0;sn<_n.length-1;sn++)h.push(Mn(In,_n[sn],On,_n[sn+1]))}}else h.push(Mn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:I+1}));return h}function Ua(t,e,n){let s=0;for(const h of t)s+=Math.max(e,Math.min(n,h[1]))-Math.max(e,Math.min(n,h[0]));return s}function Bh(t,e,n){const s=[{fixed:-1,stretch:0}];for(const[h,_]of t){const x=s[s.length-1];s.push({fixed:h-x.stretch,stretch:x.stretch}),s.push({fixed:h-x.stretch,stretch:x.stretch+(_-h)})}return s.push({fixed:e+1,stretch:n}),s}function Nh(t,e,n,s){return t/e*n+s}function zh(t,e,n,s){return t-e*n/s}function og(t,e,n,s){const h=e+t.positionedLines[s].lineOffset;return 0===s?n+h/2:n+(h+(e+t.positionedLines[s-1].lineOffset))/2}id.loadGlyphRange=function(t,e,n,s,h){const _=256*e,x=_+255,T=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${_}-${x}`),He.Glyphs);Qt(T,(I,A)=>{if(I)h(I);else if(A){const L={},N=new Ad(A).readFields(sf,{});for(const Z of N.glyphs)L[Z.id]=Z;h(null,{glyphs:L,ascender:N.ascender,descender:N.descender})}})},id.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:s=.25,fontFamily:h="sans-serif",fontWeight:_="normal",fontStyle:x="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=n;const T=this.size=t+4*e,I=this._createCanvas(T),A=this.ctx=I.getContext("2d",{willReadFrequently:!0});A.font=`${x} ${_} ${t}px ${h}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:h,actualBoundingBoxRight:_}=this.ctx.measureText(t),x=Math.ceil(n),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-h))),I=Math.min(this.size-this.buffer,x+Math.ceil(s)),A=T+2*this.buffer,L=I+2*this.buffer,N=Math.max(A*L,0),Z=new Uint8ClampedArray(N),J={data:Z,width:A,height:L,glyphWidth:T,glyphHeight:I,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(0===T||0===I)return J;const{ctx:ee,buffer:pe,gridInner:Pe,gridOuter:Qe}=this;ee.clearRect(pe,pe,T,I),ee.fillText(t,pe,pe+x);const ut=ee.getImageData(pe,pe,T,I);Qe.fill(lu,0,N),Pe.fill(0,0,N);for(let et=0;et<I;et++)for(let st=0;st<T;st++){const Ct=ut.data[4*(et*T+st)+3]/255;if(0===Ct)continue;const mt=(et+pe)*A+st+pe;if(1===Ct)Qe[mt]=0,Pe[mt]=lu;else{const Kt=.5-Ct;Qe[mt]=Kt>0?Kt*Kt:0,Pe[mt]=Kt<0?Kt*Kt:0}}ng(Qe,0,0,A,L,A,this.f,this.v,this.z),ng(Pe,pe,pe,T,I,A,this.f,this.v,this.z);for(let et=0;et<N;et++){const st=Math.sqrt(Qe[et])-Math.sqrt(Pe[et]);Z[et]=Math.round(255-255*(st/this.radius+this.cutoff))}return J}};class U_{constructor(e=[],n=V_){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:s}=this,h=n[e];for(;e>0;){const _=e-1>>1,x=n[_];if(s(h,x)>=0)break;n[e]=x,e=_}n[e]=h}_down(e){const{data:n,compare:s}=this,h=this.length>>1,_=n[e];for(;e<h;){let x=1+(e<<1),T=n[x];const I=x+1;if(I<this.length&&s(n[I],T)<0&&(x=I,T=n[I]),s(T,_)>=0)break;n[e]=T,e=x}n[e]=_}}function V_(t,e){return t<e?-1:t>e?1:0}function j_(t,e=1,n=!1){let s=1/0,h=1/0,_=-1/0,x=-1/0;const T=t[0];for(let J=0;J<T.length;J++){const ee=T[J];(!J||ee.x<s)&&(s=ee.x),(!J||ee.y<h)&&(h=ee.y),(!J||ee.x>_)&&(_=ee.x),(!J||ee.y>x)&&(x=ee.y)}const I=Math.min(_-s,x-h);let A=I/2;const L=new U_([],pf);if(0===I)return new Q(s,h);for(let J=s;J<_;J+=I)for(let ee=h;ee<x;ee+=I)L.push(new rd(J+A,ee+A,A,t));let N=function(J){let ee=0,pe=0,Pe=0;const Qe=J[0];for(let ut=0,et=Qe.length,st=et-1;ut<et;st=ut++){const Ct=Qe[ut],mt=Qe[st],Kt=Ct.x*mt.y-mt.x*Ct.y;pe+=(Ct.x+mt.x)*Kt,Pe+=(Ct.y+mt.y)*Kt,ee+=3*Kt}return new rd(pe/ee,Pe/ee,0,J)}(t),Z=L.length;for(;L.length;){const J=L.pop();(J.d>N.d||!N.d)&&(N=J,n&&console.log("found best %d after %d probes",Math.round(1e4*J.d)/1e4,Z)),J.max-N.d<=e||(A=J.h/2,L.push(new rd(J.p.x-A,J.p.y-A,A,t)),L.push(new rd(J.p.x+A,J.p.y-A,A,t)),L.push(new rd(J.p.x-A,J.p.y+A,A,t)),L.push(new rd(J.p.x+A,J.p.y+A,A,t)),Z+=4)}return n&&(console.log(`num probes: ${Z}`),console.log(`best distance: ${N.d}`)),N.p}function pf(t,e){return e.max-t.max}function rd(t,e,n,s){this.p=new Q(t,e),this.h=n,this.d=function(h,_){let x=!1,T=1/0;for(let I=0;I<_.length;I++){const A=_[I];for(let L=0,N=A.length,Z=N-1;L<N;Z=L++){const J=A[L],ee=A[Z];J.y>h.y!=ee.y>h.y&&h.x<(ee.x-J.x)*(h.y-J.y)/(ee.y-J.y)+J.x&&(x=!x),T=Math.min(T,am(h,J,ee))}}return(x?1:-1)*Math.sqrt(T)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const ff=Number.POSITIVE_INFINITY,Uh=Math.sqrt(2);function Vh(t,[e,n]){let s=0,h=0;if(n===ff){e<0&&(e=0);const _=e/Uh;switch(t){case"top-right":case"top-left":h=_-7;break;case"bottom-right":case"bottom-left":h=7-_;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(t){case"top-right":case"bottom-right":s=-_;break;case"top-left":case"bottom-left":s=_;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":h=n-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-n}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,h]}function jh(t,e,n,s,h,_,x,T,I,A){t.createArrays(),t.tilePixelRatio=Di/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const L=t.layers[0].layout,N=t.layers[0]._unevaluatedLayout._values,Z={};if("composite"===t.textSizeData.kind){const{minZoom:pe,maxZoom:Pe}=t.textSizeData;Z.compositeTextSizes=[N["text-size"].possiblyEvaluate(new Ut(pe),T),N["text-size"].possiblyEvaluate(new Ut(Pe),T)]}if("composite"===t.iconSizeData.kind){const{minZoom:pe,maxZoom:Pe}=t.iconSizeData;Z.compositeIconSizes=[N["icon-size"].possiblyEvaluate(new Ut(pe),T),N["icon-size"].possiblyEvaluate(new Ut(Pe),T)]}Z.layoutTextSize=N["text-size"].possiblyEvaluate(new Ut(I+1),T),Z.layoutIconSize=N["icon-size"].possiblyEvaluate(new Ut(I+1),T),Z.textMaxSize=N["text-size"].possiblyEvaluate(new Ut(18),T);const J="map"===L.get("text-rotation-alignment")&&"point"!==L.get("symbol-placement"),ee=L.get("text-size");for(const pe of t.features){const Pe=L.get("text-font").evaluate(pe,{},T).join(","),Qe=ee.evaluate(pe,{},T),ut=Z.layoutTextSize.evaluate(pe,{},T),et=(Z.layoutIconSize.evaluate(pe,{},T),{horizontal:{},vertical:void 0}),st=pe.text;let Ct,mt=[0,0];if(st){const mn=st.toString(),Mn=24*L.get("text-letter-spacing").evaluate(pe,{},T),an=24*L.get("text-line-height").evaluate(pe,{},T),_n=C(mn)?Mn:0,vn=L.get("text-anchor").evaluate(pe,{},T),In=L.get("text-variable-anchor");if(!In){const qn=L.get("text-radial-offset").evaluate(pe,{},T);mt=qn?Vh(vn,[24*qn,ff]):L.get("text-offset").evaluate(pe,{},T).map(ei=>24*ei)}let On=J?"center":L.get("text-justify").evaluate(pe,{},T);const sn="point"===L.get("symbol-placement"),Gn=sn?24*L.get("text-max-width").evaluate(pe,{},T):1/0,gi=qn=>{t.allowVerticalPlacement&&v(mn)&&(et.vertical=Od(st,e,n,h,Pe,Gn,an,vn,qn,_n,mt,aa.vertical,!0,ut,Qe))};if(!J&&In){const qn="auto"===On?In.map(jn=>sg(jn)):[On];let ei=!1;for(let jn=0;jn<qn.length;jn++){const _i=qn[jn];if(!et.horizontal[_i])if(ei)et.horizontal[_i]=et.horizontal[0];else{const Ji=Od(st,e,n,h,Pe,Gn,an,"center",_i,_n,mt,aa.horizontal,!1,ut,Qe);Ji&&(et.horizontal[_i]=Ji,ei=1===Ji.positionedLines.length)}}gi("left")}else{if("auto"===On&&(On=sg(vn)),sn||L.get("text-writing-mode").indexOf("horizontal")>=0||!v(mn)){const qn=Od(st,e,n,h,Pe,Gn,an,vn,On,_n,mt,aa.horizontal,!1,ut,Qe);qn&&(et.horizontal[On]=qn)}gi(sn?"left":On)}}let Kt=!1;if(pe.icon&&pe.icon.name){const mn=s[pe.icon.name];mn&&(Ct=Ym(h[pe.icon.name],L.get("icon-offset").evaluate(pe,{},T),L.get("icon-anchor").evaluate(pe,{},T)),Kt=mn.sdf,void 0===t.sdfIcons?t.sdfIcons=mn.sdf:t.sdfIcons!==mn.sdf&&yn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(mn.pixelRatio!==t.pixelRatio||0!==L.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const qt=_f(et.horizontal)||et.vertical;t.iconsInText||(t.iconsInText=!!qt&&qt.iconsInText),(qt||Ct)&&mf(t,pe,et,Ct,s,Z,ut,0,mt,Kt,x,T,A)}_&&t.generateCollisionDebugBuffers(I,t.collisionBoxArray)}function sg(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function mf(t,e,n,s,h,_,x,T,I,A,L,N,Z){let J=_.textMaxSize.evaluate(e,{},N);void 0===J&&(J=x);const ee=t.layers[0].layout,pe=ee.get("icon-offset").evaluate(e,{},N),Pe=_f(n.horizontal)||n.vertical,Qe="globe"===Z.name,ut=x/24,et=t.tilePixelRatio*J/24,st=(_n=t.overscaling,t.zoom>18&&_n>2&&(_n>>=1),Math.max(Di/(512*_n),1)*ee.get("symbol-spacing")),Ct=ee.get("text-padding")*t.tilePixelRatio,mt=ee.get("icon-padding")*t.tilePixelRatio,Kt=_e(ee.get("text-max-angle")),qt="map"===ee.get("text-rotation-alignment")&&"point"!==ee.get("symbol-placement"),mn="map"===ee.get("icon-rotation-alignment")&&"point"!==ee.get("symbol-placement"),Mn=ee.get("symbol-placement"),an=st/2;var _n;const vn=ee.get("icon-text-fit");let In;s&&"none"!==vn&&(t.allowVerticalPlacement&&n.vertical&&(In=Jm(s,n.vertical,vn,ee.get("icon-text-fit-padding"),pe,ut)),Pe&&(s=Jm(s,Pe,vn,ee.get("icon-text-fit-padding"),pe,ut)));const On=(sn,Gn,gi)=>{if(Gn.x<0||Gn.x>=Di||Gn.y<0||Gn.y>=Di)return;let qn=null;if(Qe){const{x:ei,y:jn,z:_i}=Z.projectTilePoint(Gn.x,Gn.y,gi);qn={anchor:new Oc(ei,jn,_i,0,void 0),up:Z.upVector(gi,Gn.x,Gn.y)}}!function(ei,jn,_i,Ji,Wi,qi,Ti,Mr,Oi,Ki,Fr,Yr,Zr,Jr,Qr,po,is,Pr,Po,Io,pr,oo,No,kr,bo){const Rs=ei.addToLineVertexArray(jn,Ji);let rs,os,Ls,Go,Gl,wu,pd,fd=0,zf=0,Uf=0,Vf=0,rp=-1,op=-1;const Gs={};let Ig=Fu.exports("");const Cu=_i?_i.anchor:jn;let Fc=0,Mg=0;if(void 0===Oi._unevaluatedLayout.getValue("text-radial-offset")?[Fc,Mg]=Oi.layout.get("text-offset").evaluate(pr,{},bo).map(ca=>24*ca):(Fc=24*Oi.layout.get("text-radial-offset").evaluate(pr,{},bo),Mg=ff),ei.allowVerticalPlacement&&Wi.vertical){const ca=Wi.vertical;if(Qr)wu=$h(ca),Mr&&(pd=$h(Mr));else{const Ga=Oi.layout.get("text-rotate").evaluate(pr,{},bo)+90;Ls=Rd(Ki,Cu,jn,Fr,Yr,Zr,ca,Jr,Ga,po),Mr&&(Go=Rd(Ki,Cu,jn,Fr,Yr,Zr,Mr,Pr,Ga))}}if(qi){const ca=Oi.layout.get("icon-rotate").evaluate(pr,{},bo),Ga="none"!==Oi.layout.get("icon-text-fit"),Pi=rg(qi,ca,No,Ga),jf=Mr?rg(Mr,ca,No,Ga):void 0;os=Rd(Ki,Cu,jn,Fr,Yr,Zr,qi,Pr,ca),fd=4*Pi.length;const Pg=ei.iconSizeData;let Tu=null;"source"===Pg.kind?(Tu=[Dl*Oi.layout.get("icon-size").evaluate(pr,{},bo)],Tu[0]>cu&&yn(`${ei.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Pg.kind&&(Tu=[Dl*oo.compositeIconSizes[0].evaluate(pr,{},bo),Dl*oo.compositeIconSizes[1].evaluate(pr,{},bo)],(Tu[0]>cu||Tu[1]>cu)&&yn(`${ei.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ei.addSymbols(ei.icon,Pi,Tu,Io,Po,pr,!1,_i,jn,Rs.lineStartIndex,Rs.lineLength,-1,kr,bo),rp=ei.icon.placedSymbolArray.length-1,jf&&(zf=4*jf.length,ei.addSymbols(ei.icon,jf,Tu,Io,Po,pr,aa.vertical,_i,jn,Rs.lineStartIndex,Rs.lineLength,-1,kr,bo),op=ei.icon.placedSymbolArray.length-1)}for(const ca in Wi.horizontal){const Ga=Wi.horizontal[ca];rs||(Ig=Fu.exports(Ga.text),Qr?Gl=$h(Ga):rs=Rd(Ki,Cu,jn,Fr,Yr,Zr,Ga,Jr,Oi.layout.get("text-rotate").evaluate(pr,{},bo),po));const Pi=1===Ga.positionedLines.length;if(Uf+=gf(ei,_i,jn,Ga,Ti,Oi,Qr,pr,po,Rs,Wi.vertical?aa.horizontal:aa.horizontalOnly,Pi?Object.keys(Wi.horizontal):[ca],Gs,rp,oo,kr,bo),Pi)break}Wi.vertical&&(Vf+=gf(ei,_i,jn,Wi.vertical,Ti,Oi,Qr,pr,po,Rs,aa.vertical,["vertical"],Gs,op,oo,kr,bo));let Hl=-1;const Sg=(ca,Ga)=>ca?Math.max(ca,Ga):Ga;Hl=Sg(Gl,Hl),Hl=Sg(wu,Hl),Hl=Sg(pd,Hl);const Ag=Hl>-1?1:0;ei.glyphOffsetArray.length>=cc.MAX_GLYPHS&&yn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==pr.sortKey&&ei.addToSortKeyRanges(ei.symbolInstances.length,pr.sortKey),ei.symbolInstances.emplaceBack(Cu.x,Cu.y,Cu.z,jn.x,jn.y,Gs.right>=0?Gs.right:-1,Gs.center>=0?Gs.center:-1,Gs.left>=0?Gs.left:-1,Gs.vertical>=0?Gs.vertical:-1,rp,op,Ig,void 0!==rs?rs:ei.collisionBoxArray.length,void 0!==rs?rs+1:ei.collisionBoxArray.length,void 0!==Ls?Ls:ei.collisionBoxArray.length,void 0!==Ls?Ls+1:ei.collisionBoxArray.length,void 0!==os?os:ei.collisionBoxArray.length,void 0!==os?os+1:ei.collisionBoxArray.length,Go||ei.collisionBoxArray.length,Go?Go+1:ei.collisionBoxArray.length,Fr,Uf,Vf,fd,zf,Ag,0,Fc,Mg,Hl)}(t,Gn,qn,sn,n,s,h,In,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Ct,qt,I,0,mt,mn,pe,e,_,A,L,N)};if("line"===Mn)for(const sn of tg(e.geometry,0,0,Di,Di)){const Gn=Qm(sn,st,Kt,n.vertical||Pe,s,24,et,t.overscaling,Di);for(const gi of Gn)Pe&&yf(t,Pe.text,an,gi)||On(sn,gi,N)}else if("line-center"===Mn){for(const sn of e.geometry)if(sn.length>1){const Gn=z_(sn,Kt,n.vertical||Pe,s,24,et);Gn&&On(sn,Gn,N)}}else if("Polygon"===e.type)for(const sn of Zp(e.geometry,0)){const Gn=j_(sn,16);On(sn[0],new Oc(Gn.x,Gn.y,0,0,void 0),N)}else if("LineString"===e.type)for(const sn of e.geometry)On(sn,new Oc(sn[0].x,sn[0].y,0,0,void 0),N);else if("Point"===e.type)for(const sn of e.geometry)for(const Gn of sn)On([Gn],new Oc(Gn.x,Gn.y,0,0,void 0),N)}const cu=32640;function gf(t,e,n,s,h,_,x,T,I,A,L,N,Z,J,ee,pe,Pe){const Qe=function(st,Ct,mt,Kt,qt,mn,Mn,an){const _n=[];if(0===Ct.positionedLines.length)return _n;const vn=Kt.layout.get("text-rotate").evaluate(mn,{})*Math.PI/180,In=function(qn){const ei=qn[0],jn=qn[1],_i=ei*jn;return _i>0?[ei,-jn]:_i<0?[-ei,jn]:0===ei?[jn,ei]:[jn,-ei]}(mt);let On=Math.abs(Ct.top-Ct.bottom);for(const qn of Ct.positionedLines)On-=qn.lineOffset;const sn=Ct.positionedLines.length,Gn=On/sn;let gi=Ct.top-mt[1];for(let qn=0;qn<sn;++qn){const ei=Ct.positionedLines[qn];gi=og(Ct,Gn,gi,qn);for(const jn of ei.positionedGlyphs){if(!jn.rect)continue;const _i=jn.rect||{};let Ji=4,Wi=!0,qi=1,Ti=0;if(jn.imageName){const kr=Mn[jn.imageName];if(!kr)continue;if(kr.sdf){yn("SDF images are not supported in formatted text and will be ignored.");continue}Wi=!1,qi=kr.pixelRatio,Ji=1/qi}const Mr=(qt||an)&&jn.vertical,Oi=jn.metrics.advance*jn.scale/2,Ki=jn.metrics,Fr=jn.rect;if(null===Fr)continue;an&&Ct.verticalizable&&(Ti=jn.imageName?Oi-jn.metrics.width*jn.scale/2:0);const Yr=qt?[jn.x+Oi,jn.y]:[0,0];let Zr=[0,0],Jr=[0,0],Qr=!1;qt||(Mr?(Jr=[jn.x+Oi+In[0],jn.y+In[1]-Ti],Qr=!0):Zr=[jn.x+Oi+mt[0],jn.y+mt[1]-Ti]);const po=Fr.w*jn.scale/(qi*(jn.localGlyph?2:1)),is=Fr.h*jn.scale/(qi*(jn.localGlyph?2:1));let Pr,Po,Io,pr;if(Mr){const kr=jn.y-gi,bo=new Q(-Oi,Oi-kr),Rs=-Math.PI/2,rs=new Q(...Jr);Pr=new Q(-Oi+Zr[0],Zr[1]),Pr._rotateAround(Rs,bo)._add(rs),Pr.x+=-kr+Oi,Pr.y-=(Ki.left-Ji)*jn.scale;const os=jn.imageName?Ki.advance*jn.scale:24*jn.scale,Ls=String.fromCharCode(jn.glyph);L_(Ls)?Pr.x+=(1-Ji)*jn.scale:Um(Ls)?Pr.x+=os-Ki.height*jn.scale+(-Ji-1)*jn.scale:Pr.x+=jn.imageName||Ki.width+2*Ji===Fr.w&&Ki.height+2*Ji===Fr.h?(os-is)/2:(os-(Ki.height+2*Ji)*jn.scale)/2,Po=new Q(Pr.x,Pr.y-po),Io=new Q(Pr.x+is,Pr.y),pr=new Q(Pr.x+is,Pr.y-po)}else{const kr=(Ki.left-Ji)*jn.scale-Oi+Zr[0],bo=(-Ki.top-Ji)*jn.scale+Zr[1],Rs=kr+po,rs=bo+is;Pr=new Q(kr,bo),Po=new Q(Rs,bo),Io=new Q(kr,rs),pr=new Q(Rs,rs)}if(vn){let kr;kr=qt?new Q(0,0):Qr?new Q(In[0],In[1]):new Q(mt[0],mt[1]),Pr._rotateAround(vn,kr),Po._rotateAround(vn,kr),Io._rotateAround(vn,kr),pr._rotateAround(vn,kr)}const oo=new Q(0,0),No=new Q(0,0);_n.push({tl:Pr,tr:Po,bl:Io,br:pr,tex:_i,writingMode:Ct.writingMode,glyphOffset:Yr,sectionIndex:jn.sectionIndex,isSDF:Wi,pixelOffsetTL:oo,pixelOffsetBR:No,minFontScaleX:0,minFontScaleY:0})}}return _n}(0,s,I,_,x,T,h,t.allowVerticalPlacement),ut=t.textSizeData;let et=null;"source"===ut.kind?(et=[Dl*_.layout.get("text-size").evaluate(T,{},Pe)],et[0]>cu&&yn(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ut.kind&&(et=[Dl*ee.compositeTextSizes[0].evaluate(T,{},Pe),Dl*ee.compositeTextSizes[1].evaluate(T,{},Pe)],(et[0]>cu||et[1]>cu)&&yn(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,Qe,et,I,x,T,L,e,n,A.lineStartIndex,A.lineLength,J,pe,Pe);for(const st of N)Z[st]=t.text.placedSymbolArray.length-1;return 4*Qe.length}function _f(t){for(const e in t)return t[e];return null}function Rd(t,e,n,s,h,_,x,T,I,A){let L=x.top,N=x.bottom,Z=x.left,J=x.right;const ee=x.collisionPadding;if(ee&&(Z-=ee[0],L-=ee[1],J+=ee[2],N+=ee[3]),I){const pe=new Q(Z,L),Pe=new Q(J,L),Qe=new Q(Z,N),ut=new Q(J,N),et=_e(I);let st=new Q(0,0);A&&(st=new Q(A[0],A[1])),pe._rotateAround(et,st),Pe._rotateAround(et,st),Qe._rotateAround(et,st),ut._rotateAround(et,st),Z=Math.min(pe.x,Pe.x,Qe.x,ut.x),J=Math.max(pe.x,Pe.x,Qe.x,ut.x),L=Math.min(pe.y,Pe.y,Qe.y,ut.y),N=Math.max(pe.y,Pe.y,Qe.y,ut.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,Z,L,J,N,T,s,h,_),t.length-1}function $h(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function yf(t,e,n,s){const h=t.compareText;if(e in h){const _=h[e];for(let x=_.length-1;x>=0;x--)if(s.dist(_[x])<n)return!0}else h[e]=[];return h[e].push(s),!1}const oc=Xn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ld}=oc,Fd=Xn([{name:"a_pos_3",components:3,type:"Int16"}]);var sc=Xn([{name:"a_pos",type:"Int16",components:2}]);const ac=Di/Math.PI/2,Zh=2*il(1,0)*ac*Math.PI,od=[64,32,16],al=-ac,$s=ac,$_=[new Vs([al,al,al],[$s,$s,$s]),new Vs([al,al,al],[0,0,$s]),new Vs([0,al,al],[$s,0,$s]),new Vs([al,0,al],[0,$s,$s]),new Vs([0,0,al],[$s,$s,$s])];function Z_(t,e,n,s=!0){const h=ol([],t._camera.position,t.worldSize),_=[e,n,1,1];zl(_,_,t.pixelMatrixInverse),pm(_,_,1/_[3]);const x=oa([],Tl([],_,h)),T=t.globeMatrix,I=[T[12],T[13],T[14]],A=Tl([],I,h),L=xd(A),N=oa([],A),Z=t.worldSize/(2*Math.PI),J=Ea(N,x),ee=Math.asin(Z/L);if(ee<Math.acos(J)){if(!s)return null;const Mn=[],an=[];ol(Mn,x,L/J),oa(an,Tl(an,Mn,A)),oa(x,Ps(x,A,ol(x,an,Math.tan(ee)*L)))}const pe=[];new kp(h,x).closestPointOnSphere(I,Z,pe);const Pe=oa([],Bn(T,0)),Qe=oa([],Bn(T,1)),ut=oa([],Bn(T,2)),et=Ea(Pe,pe),st=Ea(Qe,pe),Ct=Ea(ut,pe),mt=ke(Math.asin(-st/Z));let Kt=ke(Math.atan2(et,Ct));Kt=t.center.lng+function(Mn,an){const _n=(an-Mn+180)%360-180;return _n<-180?_n+360:_n}(t.center.lng,Kt);const qt=ec(Kt),mn=ge(za(mt),0,1);return new tc(qt,mn)}class G_{constructor(e,n,s){this.a=Tl([],e,s),this.b=Tl([],n,s),this.center=s;const h=oa([],this.a),_=oa([],this.b);this.angle=Math.acos(Ea(h,_))}}function vf(t,e){if(0===t.angle)return null;let n;return n=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(s,h,_,x){const T=Math.sin(_);return s*(Math.sin((1-x)*_)/T)+h*(Math.sin(x*_)/T)}(t.a[e],t.b[e],t.angle,ge(n,0,1))+t.center[e]}function $l(t){if(t.z<=1)return $_[t.z+2*t.y+t.x];const e=Bd(kd(t));return Vs.fromPoints(e)}function du(t,e,n){return ol(t,t,1-n),fh(t,t,e,n)}function ag(t,e){const n=ad(e.zoom);if(0===n)return $l(t);const s=kd(t),h=Bd(s),_=ec(s.getWest())*e.worldSize,x=ec(s.getEast())*e.worldSize,T=za(s.getNorth())*e.worldSize,I=za(s.getSouth())*e.worldSize,A=[_,T,0],L=[x,T,0],N=[_,I,0],Z=[x,I,0],J=Xc([],e.globeMatrix);return Eo(A,A,J),Eo(L,L,J),Eo(N,N,J),Eo(Z,Z,J),h[0]=du(h[0],N,n),h[1]=du(h[1],Z,n),h[2]=du(h[2],L,n),h[3]=du(h[3],A,n),Vs.fromPoints(h)}function lg(t,e,n){for(const s of t)Eo(s,s,e),ol(s,s,n)}function kd({x:t,y:e,z:n}){const s=1/(1<<n),h=new ar(Ca(t*s),ts((e+1)*s)),_=new ar(Ca((t+1)*s),ts(e*s));return new Ql(h,_)}function Bd(t){const e=_e(t.getNorth()),n=_e(t.getSouth()),s=Math.cos(e),h=Math.cos(n),_=Math.sin(e),x=Math.sin(n),T=t.getWest(),I=t.getEast();return[sd(h,x,T),sd(h,x,I),sd(s,_,I),sd(s,_,T)]}function sd(t,e,n,s=ac){return n=_e(n),[t*Math.sin(n)*s,-e*s,t*Math.cos(n)*s]}function hu(t,e,n){return sd(Math.cos(_e(t)),Math.sin(_e(t)),e,n)}function Nd(t,e,n,s){const h=1<<n.z,_=(t/Di+n.x)/h;return hu(ts((e/Di+n.y)/h),Ca(_),s)}function Gh({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const cg=new Float64Array(16);function zd(t){const e=Gh(t),n=n_(cg,[e,e,e]);return ph(n,n,((s=[])[0]=-(h=t.min)[0],s[1]=-h[1],s[2]=-h[2],s));var s,h}function xf(t){const e=(s=t.min,(n=cg)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=s[0],n[13]=s[1],n[14]=s[2],n[15]=1,n);var n,s;const h=1/Gh(t);return Vu(e,e,[h,h,h])}function ug(t,e,n,s,h){const _=function(I){const A=Di/(2*Math.PI);return I/(2*Math.PI)/A}(n),x=[t,e,-n/(2*Math.PI)],T=ms(new Float64Array(16));return ph(T,T,x),Vu(T,T,[_,_,_]),dm(T,T,_e(-h)),Pp(T,T,_e(-s)),T}function ad(t){return de(5,6,t)}function bf(t,e){const n=hu(e.lat,e.lng);return x=(h=Qc([],function(ee){const pe=hu(ee._center.lat,ee._center.lng);let Pe=bd([],Sc(0,1,0),pe);const Qe=Op([],-ee.angle,pe);Pe=Eo(Pe,Pe,Qe),Op(Qe,-ee._pitch,Pe);const ut=oa([],pe);return ol(ut,ut,ee.cameraToCenterDistance/ee.pixelsPerMeter*Zh),Eo(ut,ut,Qe),Ps([],pe,ut)}(t),n))[0],T=h[1],I=h[2],A=(_=n)[0],L=_[1],N=_[2],J=(Z=Math.sqrt(x*x+T*T+I*I)*Math.sqrt(A*A+L*L+N*N))&&Ea(h,_)/Z,Math.acos(Math.min(Math.max(J,-1),1));var h,_,x,T,I,A,L,N,Z,J}function Hh(t,e){return bf(t,e)>Math.PI/2*1.01}const dg=_e(85),Uy=Math.cos(dg),hg=Math.sin(dg);function Ud(t,e){const n=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,h=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),_=Math.sin(n)*h/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),x=Math.sin(t._pitch)*_+h;return Math.min(1.01*x,h*(1/t._horizonShift))}function Va(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),s=t.x*n,h=(t.x+1)*n,_=t.y*n,x=(t.y+1)*n,T=Ca(s),I=Ca(h),A=ts(_),L=ts(x),N=e.project(T,A),Z=e.project(I,A),J=e.project(I,L),ee=e.project(T,L);let pe=Math.min(N.x,Z.x,J.x,ee.x),Pe=Math.min(N.y,Z.y,J.y,ee.y),Qe=Math.max(N.x,Z.x,J.x,ee.x),ut=Math.max(N.y,Z.y,J.y,ee.y);const et=n/16;function st(mt,Kt,qt,mn,Mn,an){const _n=(qt+Mn)/2,vn=(mn+an)/2,In=e.project(Ca(_n),ts(vn)),On=Math.max(0,pe-In.x,Pe-In.y,In.x-Qe,In.y-ut);pe=Math.min(pe,In.x),Qe=Math.max(Qe,In.x),Pe=Math.min(Pe,In.y),ut=Math.max(ut,In.y),On>et&&(st(mt,In,qt,mn,_n,vn),st(In,Kt,_n,vn,Mn,an))}st(N,Z,s,_,h,_),st(Z,J,h,_,h,x),st(J,ee,h,x,s,x),st(ee,N,s,x,s,_),pe-=et,Pe-=et,Qe+=et,ut+=et;const Ct=1/Math.max(Qe-pe,ut-Pe);return{scale:Ct,x:pe*Ct,y:Pe*Ct,x2:Qe*Ct,y2:ut*Ct,projection:e}}const Vy=ms(new Float32Array(16));class Ml{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new ar(0,0)}projectTilePoint(e,n,s){return{x:e,y:n,z:0}}locationPoint(e,n,s=!0){return e._coordinatePoint(e.locationCoordinate(n),s)}pixelsPerMeter(e,n){return il(1,e)*n}pixelSpaceConversion(e,n,s){return 1}farthestPixelDistance(e){return Ud(e,e.pixelsPerMeter)}pointCoordinate(e,n,s,h){const _=e.horizonLineFromTop(!1),x=new Q(n,Math.max(_,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(x,h))}pointCoordinate3D(e,n,s){const h=new Q(n,s);if(e.elevation)return e.elevation.pointCoordinate(h);{const _=this.pointCoordinate(e,h.x,h.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const s=e.horizonLineFromTop();return n.y<s}createInversionMatrix(e,n){return Vy}createTileMatrix(e,n,s){let h,_,x;const T=s.canonical,I=ms(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=Va(T,this);h=1,_=A.x+s.wrap*A.scale,x=A.y,Vu(I,I,[h/A.scale,h/A.scale,e.pixelsPerMeter/n])}else h=n/e.zoomScale(T.z),_=(T.x+Math.pow(2,T.z)*s.wrap)*h,x=T.y*h;return ph(I,I,[_,x,0]),Vu(I,I,[h/Di,h/Di,1]),I}upVector(e,n,s){return[0,0,1]}upVectorScale(e,n,s){return{metersToTile:1}}}class W_ extends Ml{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,s]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(_e(n));this.n=(h+Math.sin(_e(s)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:s,c:h,r0:_}=this,x=_e(e-this.center[0]),T=_e(n),I=Math.sqrt(h-2*s*Math.sin(T))/s;return{x:I*Math.sin(x*s),y:I*Math.cos(x*s)-_,z:0}}unproject(e,n){const{n:s,c:h,r0:_}=this,x=_+n;let T=Math.atan2(e,Math.abs(x))*Math.sign(x);x*s<0&&(T-=Math.PI*Math.sign(e)*Math.sign(x));const I=_e(this.center[0])*s;T=oe(T,-Math.PI-I,Math.PI-I);const A=ge(ke(T/s)+this.center[0],-180,180),L=Math.asin(ge((h-(e*e+x*x)*s*s)/(2*s),-1,1)),N=ge(ke(L),-85.051129,rl);return new ar(A,N)}}const Vd=1.340264,pu=-.081106,jd=893e-6,Ia=.003796,Rc=Math.sqrt(3)/2;class Zs extends Ml{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Rc*Math.sin(n)),h=s*s,_=h*h*h;return{x:.5*(e*Math.cos(s)/(Rc*(Vd+3*pu*h+_*(7*jd+9*Ia*h)))/Math.PI+.5),y:1-.5*(s*(Vd+pu*h+_*(jd+Ia*h))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,h=s*s,_=h*h*h;for(let L,N,Z,J=0;J<12&&(N=s*(Vd+pu*h+_*(jd+Ia*h))-n,Z=Vd+3*pu*h+_*(7*jd+9*Ia*h),L=N/Z,s=ge(s-L,-Math.PI/3,Math.PI/3),h=s*s,_=h*h*h,!(Math.abs(L)<1e-12));++J);const x=Rc*e*(Vd+3*pu*h+_*(7*jd+9*Ia*h))/Math.cos(s),T=Math.asin(Math.sin(s)/Rc),I=ge(180*x/Math.PI,-180,180),A=ge(180*T/Math.PI,-85.051129,rl);return new ar(I,A)}}class fu extends Ml{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const s=360*(e-.5),h=ge(360*(.5-n),-85.051129,rl);return new ar(s,h)}}const lc=Math.PI/2;function la(t){return Math.tan((lc+t)/2)}class wf extends Ml{constructor(e){super(e),this.center=e.center||[0,30];const[n,s]=this.parallels=e.parallels||[30,30];let h=_e(n),_=_e(s);this.southernCenter=h+_<0,this.southernCenter&&(h=-h,_=-_);const x=Math.cos(h),T=la(h);this.n=h===_?Math.sin(h):Math.log(x/Math.cos(_))/Math.log(la(_)/T),this.f=x*Math.pow(la(h),this.n)/this.n}project(e,n){n=_e(n),this.southernCenter&&(n=-n),e=_e(e-this.center[0]);const s=1e-6,{n:h,f:_}=this;_>0?n<-lc+s&&(n=-lc+s):n>lc-s&&(n=lc-s);const x=_/Math.pow(la(n),h);let T=x*Math.sin(h*e),I=_-x*Math.cos(h*e);return T=.5*(T/Math.PI+.5),I=.5*(I/Math.PI+.5),{x:T,y:this.southernCenter?I:1-I,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:s,f:h}=this,_=h-n,x=Math.sign(_),T=Math.sign(s)*Math.sqrt(e*e+_*_);let I=Math.atan2(e,Math.abs(_))*x;_*s<0&&(I-=Math.PI*Math.sign(e)*x);const A=ge(ke(I/s)+this.center[0],-180,180),L=ge(ke(2*Math.atan(Math.pow(h/T,1/s))-lc),-85.051129,rl);return new ar(A,this.southernCenter?-L:L)}}class mu extends Ml{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:ec(e),y:za(n),z:0}}unproject(e,n){const s=Ca(e),h=ts(n);return new ar(s,h)}}const gu=_e(rl);class ld extends Ml{project(e,n){const s=(n=_e(n))*n,h=s*s;return{x:.5*((e=_e(e))*(.8707-.131979*s+h*(h*(.003971*s-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+h*(.028874*s-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,h=25,_=0,x=s*s;do{x=s*s;const A=x*x;_=(s*(1.007226+x*(.015085+A*(.028874*x-.044475-.005916*A)))-n)/(1.007226+x*(.045255+A*(.259866*x-.311325-.005916*11*A))),s=ge(s-_,-gu,gu)}while(Math.abs(_)>1e-6&&--h>0);x=s*s;const T=ge(ke(e/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),I=ke(s);return new ar(T,I)}}const _u=_e(rl);class cd extends Ml{project(e,n){n=_e(n),e=_e(e);const s=Math.cos(n),h=2/Math.PI,_=Math.acos(s*Math.cos(e/2)),x=Math.sin(_)/_,T=.5*(e*h+2*s*Math.sin(e/2)/x)||0,I=.5*(n+Math.sin(n)/x)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(I/Math.PI+1),z:0}}unproject(e,n){let s=e=(2*e-.5)*Math.PI,h=n=(2*(1-n)-1)*Math.PI,_=25;const x=1e-6;let T=0,I=0;do{const A=Math.cos(h),L=Math.sin(h),N=2*L*A,Z=L*L,J=A*A,ee=Math.cos(s/2),pe=Math.sin(s/2),Pe=2*ee*pe,Qe=pe*pe,ut=1-J*ee*ee,et=ut?1/ut:0,st=ut?Math.acos(A*ee)*Math.sqrt(1/ut):0,Ct=.5*(2*st*A*pe+2*s/Math.PI)-e,mt=.5*(st*L+h)-n,Kt=.5*et*(J*Qe+st*A*ee*Z)+1/Math.PI,qt=et*(Pe*N/4-st*L*pe),mn=.125*et*(N*pe-st*L*J*Pe),Mn=.5*et*(Z*ee+st*Qe*A)+.5,an=qt*mn-Mn*Kt;T=(mt*qt-Ct*Mn)/an,I=(Ct*mn-mt*Kt)/an,s=ge(s-T,-Math.PI,Math.PI),h=ge(h-I,-_u,_u)}while((Math.abs(T)>x||Math.abs(I)>x)&&--_>0);return new ar(ke(s),ke(h))}}class yu extends Ml{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(_e(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:s,cosPhi:h}=this;return{x:_e(e)*h*s+.5,y:-Math.sin(_e(n))/h*s+.5,z:0}}unproject(e,n){const{scale:s,cosPhi:h}=this,_=-(n-.5)/s,x=ge(ke((e-.5)/s)/h,-180,180),T=Math.asin(ge(_*h,-1,1)),I=ge(ke(T),-85.051129,rl);return new ar(x,I)}}class ud extends mu{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,n,s){const h=Nd(e,n,s);return Eo(h,h,zd($l(s))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,n){const s=hu(n.lat,n.lng),h=oa([],s),_=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;fh(s,s,h,il(1,0)*Di*_);const x=ms(new Float64Array(16));return Kc(x,e.pixelMatrix,e.globeMatrix),Eo(s,s,x),new Q(s[0],s[1])}pixelsPerMeter(e,n){return il(1,0)*n}pixelSpaceConversion(e,n,s){const h=il(1,e)*n,_=wi(il(1,45)*n,h,s);return this.pixelsPerMeter(e,n)/_}createTileMatrix(e,n,s){const h=xf($l(s.canonical));return Kc(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,n){const{center:s}=e,h=zd($l(n));return Pp(h,h,_e(s.lng)),dm(h,h,_e(s.lat)),Vu(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,n,s,h){return Z_(e,n,s,!0)||new tc(0,0)}pointCoordinate3D(e,n,s){const h=this.pointCoordinate(e,n,s,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,n){return!Z_(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(h,_){const x=h.cameraToCenterDistance,T=h._centerAltitude*_,I=h._camera,A=h._camera.forward(),L=Ps([],ol([],A,-x),[0,0,T]),N=h.worldSize/(2*Math.PI),Z=[0,0,-N],J=h.width/h.height,ee=Math.tan(h.fovAboveCenter),pe=ol([],I.up(),ee),Pe=ol([],I.right(),ee*J),Qe=oa([],Ps([],Ps([],A,pe),Pe)),ut=[];let et;if(new kp(L,Qe).closestPointOnSphere(Z,N,ut)){const st=Ps([],ut,Z),Ct=Tl([],st,L);et=Math.cos(h.fovAboveCenter)*xd(Ct)}else{const st=Tl([],L,Z),Ct=Tl([],Z,L);oa(Ct,Ct);const mt=xd(st)-N;et=Math.sqrt(mt*(mt+2*N));const Kt=Math.acos(et/(N+mt))-Math.acos(Ea(A,Ct));et*=Math.cos(Kt)}return 1.01*et}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=ad(e.zoom);if(s>0){const h=Ud(e,il(1,e.center.lat)*e.worldSize),_=e.worldSize/(2*Math.PI),x=Math.max(e.width,e.height)/e.worldSize*Math.PI;return wi(n,h+_*(1-Math.cos(x)),Math.pow(s,10))}return n}upVector(e,n,s){return Nd(n,s,e,1)}upVectorScale(e){return{metersToTile:Zh*Gh($l(e))}}}function vu(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new mu(t);case"equirectangular":return new fu(t);case"naturalEarth":return new ld(t);case"equalEarth":return new Zs(t);case"winkelTripel":return new cd(t);case"albers":return n?new yu(t):new W_(t);case"lambertConformalConic":return n?new yu(t):new wf(t);case"globe":return new ud(t)}throw new Error(`Invalid projection name: ${t.name}`)}const dd=Dh.types,pg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $d(t,e,n,s,h,_,x,T,I,A,L,N,Z){const J=T?Math.min(cu,Math.round(T[0])):0,ee=T?Math.min(cu,Math.round(T[1])):0;t.emplaceBack(e,n,Math.round(32*s),Math.round(32*h),_,x,(J<<1)+(I?1:0),ee,16*A,16*L,256*N,256*Z)}function Zd(t,e,n,s,h,_,x){t.emplaceBack(e,n,s,h,_,x)}function Gd(t,e,n,s,h){t.emplaceBack(e,n,s,h),t.emplaceBack(e,n,s,h),t.emplaceBack(e,n,s,h),t.emplaceBack(e,n,s,h)}function fg(t){for(const e of t.sections)if(Te(e.text))return!0;return!1}class Wh{constructor(e){this.layoutVertexArray=new Vr,this.indexArray=new es,this.programConfigurations=e,this.segments=new Ao,this.dynamicLayoutVertexArray=new ba,this.opacityVertexArray=new To,this.placedSymbolArray=new Qf,this.globeExtVertexArray=new _r}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,n,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,A_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ef.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,pg,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Qp.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Zn(Wh,"SymbolBuffers");class qh{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new Ao,this.collisionVertexArray=new Kl,this.collisionVertexArrayExt=new el}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,P_.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,ky.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Zn(qh,"CollisionBuffers");class cc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(x=>x.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ms([]),this.placementViewportMatrix=ms([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Nm(this.zoom,n["text-size"]),this.iconSizeData=Nm(this.zoom,n["icon-size"]);const s=this.layers[0].layout,h=s.get("symbol-sort-key"),_=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==_&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===_||"auto"===_&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(x=>aa[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Wh(new Wc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Wh(new Wc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new th,this.lineVertexArray=new hp,this.symbolInstances=new ra}calculateGlyphDependencies(e,n,s,h,_){for(let x=0;x<e.length;x++)if(n[e.charCodeAt(x)]=!0,h&&_){const T=Pc[e.charAt(x)];T&&(n[T.charCodeAt(0)]=!0)}}populate(e,n,s,h){const _=this.layers[0],x=_.layout,T="globe"===this.projection.name,I=x.get("text-font"),A=x.get("text-field"),L=x.get("icon-image"),N=("constant"!==A.value.kind||A.value.value instanceof Wr&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&("constant"!==I.value.kind||I.value.value.length>0),Z="constant"!==L.value.kind||!!L.value.value||Object.keys(L.parameters).length>0,J=x.get("symbol-sort-key");if(this.features=[],!N&&!Z)return;const ee=n.iconDependencies,pe=n.glyphDependencies,Pe=n.availableImages,Qe=new Ut(this.zoom);for(const{feature:ut,id:et,index:st,sourceLayerIndex:Ct}of e){const mt=_._featureFilter.needGeometry,Kt=qc(ut,mt);if(!_._featureFilter.filter(Qe,Kt,s))continue;if(mt||(Kt.geometry=Nl(ut,s,h)),T&&1!==ut.type&&s.z<=5){const an=Kt.geometry,_n=.98078528056,vn=(In,On)=>Ea(Nd(In.x,In.y,s,1),Nd(On.x,On.y,s,1))<_n;for(let In=0;In<an.length;In++)an[In]=Ep(an[In],vn)}let qt,mn;if(N){const an=_.getValueAndResolveTokens("text-field",Kt,s,Pe),_n=Wr.factory(an);fg(_n)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Lt()||this.hasRTLText&&Wt.isParsed())&&(qt=zm(_n,_,Kt))}if(Z){const an=_.getValueAndResolveTokens("icon-image",Kt,s,Pe);mn=an instanceof fo?an:fo.fromString(an)}if(!qt&&!mn)continue;const Mn=this.sortFeaturesByKey?J.evaluate(Kt,{},s):void 0;if(this.features.push({id:et,text:qt,icon:mn,index:st,sourceLayerIndex:Ct,geometry:Kt.geometry,properties:ut.properties,type:dd[ut.type],sortKey:Mn}),mn&&(ee[mn.name]=!0),qt){const an=I.evaluate(Kt,{},s).join(","),_n="map"===x.get("text-rotation-alignment")&&"point"!==x.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(aa.vertical)>=0;for(const vn of qt.sections)if(vn.image)ee[vn.image.name]=!0;else{const In=v(qt.toString()),On=vn.fontStack||an,sn=pe[On]=pe[On]||{};this.calculateGlyphDependencies(vn.text,sn,_n,this.allowVerticalPlacement,In)}}}"line"===x.get("symbol-placement")&&(this.features=function(ut){const et={},st={},Ct=[];let mt=0;function Kt(an){Ct.push(ut[an]),mt++}function qt(an,_n,vn){const In=st[an];return delete st[an],st[_n]=In,Ct[In].geometry[0].pop(),Ct[In].geometry[0]=Ct[In].geometry[0].concat(vn[0]),In}function mn(an,_n,vn){const In=et[_n];return delete et[_n],et[an]=In,Ct[In].geometry[0].shift(),Ct[In].geometry[0]=vn[0].concat(Ct[In].geometry[0]),In}function Mn(an,_n,vn){const In=vn?_n[0][_n[0].length-1]:_n[0][0];return`${an}:${In.x}:${In.y}`}for(let an=0;an<ut.length;an++){const _n=ut[an],vn=_n.geometry,In=_n.text?_n.text.toString():null;if(!In){Kt(an);continue}const On=Mn(In,vn),sn=Mn(In,vn,!0);if(On in st&&sn in et&&st[On]!==et[sn]){const Gn=mn(On,sn,vn),gi=qt(On,sn,Ct[Gn].geometry);delete et[On],delete st[sn],st[Mn(In,Ct[gi].geometry,!0)]=gi,Ct[Gn].geometry=null}else On in st?qt(On,sn,vn):sn in et?mn(On,sn,vn):(Kt(an),et[On]=mt-1,st[sn]=mt-1)}return Ct.filter(an=>an.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ut,et)=>ut.sortKey-et.sortKey)}update(e,n,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,s,h),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,s,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=vu(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:h,y:_}of n)this.lineVertexArray.emplaceBack(h,_);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,h,_,x,T,I,A,L,N,Z,J,ee){const pe=e.indexArray,Pe=e.layoutVertexArray,Qe=e.globeExtVertexArray,ut=e.segments.prepareSegment(4*n.length,Pe,pe,this.canOverlap?x.sortKey:void 0),et=this.glyphOffsetArray.length,st=ut.vertexLength,Ct=this.allowVerticalPlacement&&T===aa.vertical?Math.PI/2:0,mt=x.text&&x.text.sections;for(let qt=0;qt<n.length;qt++){const{tl:mn,tr:Mn,bl:an,br:_n,tex:vn,pixelOffsetTL:In,pixelOffsetBR:On,minFontScaleX:sn,minFontScaleY:Gn,glyphOffset:gi,isSDF:qn,sectionIndex:ei}=n[qt],jn=ut.vertexLength,_i=gi[1];if($d(Pe,A.x,A.y,mn.x,_i+mn.y,vn.x,vn.y,s,qn,In.x,In.y,sn,Gn),$d(Pe,A.x,A.y,Mn.x,_i+Mn.y,vn.x+vn.w,vn.y,s,qn,On.x,In.y,sn,Gn),$d(Pe,A.x,A.y,an.x,_i+an.y,vn.x,vn.y+vn.h,s,qn,In.x,On.y,sn,Gn),$d(Pe,A.x,A.y,_n.x,_i+_n.y,vn.x+vn.w,vn.y+vn.h,s,qn,On.x,On.y,sn,Gn),I){const{x:Ji,y:Wi,z:qi}=I.anchor,[Ti,Mr,Oi]=I.up;Zd(Qe,Ji,Wi,qi,Ti,Mr,Oi),Zd(Qe,Ji,Wi,qi,Ti,Mr,Oi),Zd(Qe,Ji,Wi,qi,Ti,Mr,Oi),Zd(Qe,Ji,Wi,qi,Ti,Mr,Oi),Gd(e.dynamicLayoutVertexArray,Ji,Wi,qi,Ct)}else Gd(e.dynamicLayoutVertexArray,A.x,A.y,A.z,Ct);pe.emplaceBack(jn,jn+1,jn+2),pe.emplaceBack(jn+1,jn+2,jn+3),ut.vertexLength+=4,ut.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gi[0]),qt!==n.length-1&&ei===n[qt+1].sectionIndex||e.programConfigurations.populatePaintArrays(Pe.length,x,x.index,{},J,ee,mt&&mt[ei])}const Kt=I?I.anchor:A;e.placedSymbolArray.emplaceBack(Kt.x,Kt.y,Kt.z,A.x,A.y,et,this.glyphOffsetArray.length-et,st,L,N,A.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],T,0,!1,0,Z,0)}_commitLayoutVertex(e,n,s,h,_,x,T){e.emplaceBack(n,s,h,_,x,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(e,n,s,h,_,x,T){const I=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),A=I.vertexLength,L=T.tileAnchorX,N=T.tileAnchorY;for(let J=0;J<4;J++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,h,_,x,L,N,new Q(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,_,x,L,N,new Q(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,_,x,L,N,new Q(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,h,_,x,L,N,new Q(e.x1,e.y2)),I.vertexLength+=4;const Z=s.indexArray;Z.emplaceBack(A,A+1),Z.emplaceBack(A+1,A+2),Z.emplaceBack(A+2,A+3),Z.emplaceBack(A+3,A),I.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,s,h,_,x){for(let T=h;T<_;T++){const I=s.get(T),A=this.getSymbolInstanceTextSize(e,x,n,T);this._addCollisionDebugVertices(I,A,this.textCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(e,n,s,h,_,x){for(let T=h;T<_;T++){const I=s.get(T),A=this.getSymbolInstanceIconSize(e,n,x.placedIconSymbolIndex);this._addCollisionDebugVertices(I,A,this.iconCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,x)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new qh(jr,O_.members,Na),this.iconCollisionBox=new qh(jr,O_.members,Na);const s=Il(this.iconSizeData,e),h=Il(this.textSizeData,e);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(h,e,n,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(h,e,n,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(s,e,n,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(s,e,n,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,n,s,h){const _=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:h),x=Ah(this.textSizeData,e,_)/24;return this.tilePixelRatio*x}getSymbolInstanceIconSize(e,n,s){const h=this.icon.placedSymbolArray.get(s),_=Ah(this.iconSizeData,e,h);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(e,n,s){e.emplaceBack(n,-s,-s),e.emplaceBack(n,s,-s),e.emplaceBack(n,s,s),e.emplaceBack(n,-s,s)}_updateTextDebugCollisionBoxes(e,n,s,h,_,x){for(let T=h;T<_;T++){const I=s.get(T),A=this.getSymbolInstanceTextSize(e,x,n,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,I.padding)}}_updateIconDebugCollisionBoxes(e,n,s,h,_,x){for(let T=h;T<_;T++){const I=s.get(T),A=this.getSymbolInstanceIconSize(e,n,x);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,A,I.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Il(this.iconSizeData,e),h=Il(this.textSizeData,e);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(h,e,n,x.textBoxStartIndex,x.textBoxEndIndex,x),this._updateTextDebugCollisionBoxes(h,e,n,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._updateIconDebugCollisionBoxes(s,e,n,x.iconBoxStartIndex,x.iconBoxEndIndex,x.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,e,n,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,s,h,_,x,T,I,A){const L={};if(n<s){const{x1:N,y1:Z,x2:J,y2:ee,padding:pe,projectedAnchorX:Pe,projectedAnchorY:Qe,projectedAnchorZ:ut,tileAnchorX:et,tileAnchorY:st,featureIndex:Ct}=e.get(n);L.textBox={x1:N,y1:Z,x2:J,y2:ee,padding:pe,projectedAnchorX:Pe,projectedAnchorY:Qe,projectedAnchorZ:ut,tileAnchorX:et,tileAnchorY:st},L.textFeatureIndex=Ct}if(h<_){const{x1:N,y1:Z,x2:J,y2:ee,padding:pe,projectedAnchorX:Pe,projectedAnchorY:Qe,projectedAnchorZ:ut,tileAnchorX:et,tileAnchorY:st,featureIndex:Ct}=e.get(h);L.verticalTextBox={x1:N,y1:Z,x2:J,y2:ee,padding:pe,projectedAnchorX:Pe,projectedAnchorY:Qe,projectedAnchorZ:ut,tileAnchorX:et,tileAnchorY:st},L.verticalTextFeatureIndex=Ct}if(x<T){const{x1:N,y1:Z,x2:J,y2:ee,padding:pe,projectedAnchorX:Pe,projectedAnchorY:Qe,projectedAnchorZ:ut,tileAnchorX:et,tileAnchorY:st,featureIndex:Ct}=e.get(x);L.iconBox={x1:N,y1:Z,x2:J,y2:ee,padding:pe,projectedAnchorX:Pe,projectedAnchorY:Qe,projectedAnchorZ:ut,tileAnchorX:et,tileAnchorY:st},L.iconFeatureIndex=Ct}if(I<A){const{x1:N,y1:Z,x2:J,y2:ee,padding:pe,projectedAnchorX:Pe,projectedAnchorY:Qe,projectedAnchorZ:ut,tileAnchorX:et,tileAnchorY:st,featureIndex:Ct}=e.get(I);L.verticalIconBox={x1:N,y1:Z,x2:J,y2:ee,padding:pe,projectedAnchorX:Pe,projectedAnchorY:Qe,projectedAnchorZ:ut,tileAnchorX:et,tileAnchorY:st},L.verticalIconFeatureIndex=Ct}return L}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),h=s.vertexStartIndex+4*s.numGlyphs;for(let _=s.vertexStartIndex;_<h;_+=4)e.indexArray.emplaceBack(_,_+1,_+2),e.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),h=[],_=[],x=[];for(let T=0;T<this.symbolInstances.length;++T){x.push(T);const I=this.symbolInstances.get(T);h.push(0|Math.round(n*I.tileAnchorX+s*I.tileAnchorY)),_.push(I.featureIndex)}return x.sort((T,I)=>h[T]-h[I]||_[I]-_[T]),x}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:A}=s;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),_>=0&&_!==h&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&x!==_&&x!==h&&this.addIndicesForPlacedSymbol(this.text,x),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Zn(cc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),cc.MAX_GLYPHS=65535,cc.addDynamicAttributes=Gd;const mg=new hi({"symbol-placement":new $t(Xt.layout_symbol["symbol-placement"]),"symbol-spacing":new $t(Xt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $t(Xt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new rn(Xt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $t(Xt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $t(Xt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new $t(Xt.layout_symbol["icon-ignore-placement"]),"icon-optional":new $t(Xt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $t(Xt.layout_symbol["icon-rotation-alignment"]),"icon-size":new rn(Xt.layout_symbol["icon-size"]),"icon-text-fit":new $t(Xt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $t(Xt.layout_symbol["icon-text-fit-padding"]),"icon-image":new rn(Xt.layout_symbol["icon-image"]),"icon-rotate":new rn(Xt.layout_symbol["icon-rotate"]),"icon-padding":new $t(Xt.layout_symbol["icon-padding"]),"icon-keep-upright":new $t(Xt.layout_symbol["icon-keep-upright"]),"icon-offset":new rn(Xt.layout_symbol["icon-offset"]),"icon-anchor":new rn(Xt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $t(Xt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $t(Xt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $t(Xt.layout_symbol["text-rotation-alignment"]),"text-field":new rn(Xt.layout_symbol["text-field"]),"text-font":new rn(Xt.layout_symbol["text-font"]),"text-size":new rn(Xt.layout_symbol["text-size"]),"text-max-width":new rn(Xt.layout_symbol["text-max-width"]),"text-line-height":new rn(Xt.layout_symbol["text-line-height"]),"text-letter-spacing":new rn(Xt.layout_symbol["text-letter-spacing"]),"text-justify":new rn(Xt.layout_symbol["text-justify"]),"text-radial-offset":new rn(Xt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $t(Xt.layout_symbol["text-variable-anchor"]),"text-anchor":new rn(Xt.layout_symbol["text-anchor"]),"text-max-angle":new $t(Xt.layout_symbol["text-max-angle"]),"text-writing-mode":new $t(Xt.layout_symbol["text-writing-mode"]),"text-rotate":new rn(Xt.layout_symbol["text-rotate"]),"text-padding":new $t(Xt.layout_symbol["text-padding"]),"text-keep-upright":new $t(Xt.layout_symbol["text-keep-upright"]),"text-transform":new rn(Xt.layout_symbol["text-transform"]),"text-offset":new rn(Xt.layout_symbol["text-offset"]),"text-allow-overlap":new $t(Xt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new $t(Xt.layout_symbol["text-ignore-placement"]),"text-optional":new $t(Xt.layout_symbol["text-optional"])});var Cf={paint:new hi({"icon-opacity":new rn(Xt.paint_symbol["icon-opacity"]),"icon-color":new rn(Xt.paint_symbol["icon-color"]),"icon-halo-color":new rn(Xt.paint_symbol["icon-halo-color"]),"icon-halo-width":new rn(Xt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new rn(Xt.paint_symbol["icon-halo-blur"]),"icon-translate":new $t(Xt.paint_symbol["icon-translate"]),"icon-translate-anchor":new $t(Xt.paint_symbol["icon-translate-anchor"]),"text-opacity":new rn(Xt.paint_symbol["text-opacity"]),"text-color":new rn(Xt.paint_symbol["text-color"],{runtimeType:me,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new rn(Xt.paint_symbol["text-halo-color"]),"text-halo-width":new rn(Xt.paint_symbol["text-halo-width"]),"text-halo-blur":new rn(Xt.paint_symbol["text-halo-blur"]),"text-translate":new $t(Xt.paint_symbol["text-translate"]),"text-translate-anchor":new $t(Xt.paint_symbol["text-translate-anchor"])}),layout:mg};class gg{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:mr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zn(gg,"FormatSectionOverride",{omit:["defaultValue"]});class Hd extends nl{constructor(e){super(e,Cf)}recalculate(e,n){super.recalculate(e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const h=[];for(const _ of s)h.indexOf(_)<0&&h.push(_);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,s,h){const _=this.layout.get(e).evaluate(n,{},s,h),x=this._unevaluatedLayout._values[e];return x.isDataDriven()||rr(x.value)||!_?_:(T=n.properties,_.replace(/{([^{}]+)}/g,(A,L)=>L in T?String(T[L]):""));var T}createBucket(e){return new cc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Cf.paint.overridableProperties){if(!Hd.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new gg(n),h=new ai(s,n.property.specification);let _=null;_="constant"===n.value.kind||"source"===n.value.kind?new Hi("source",h):new Xi("composite",h,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new xn(n.property,_,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&Hd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),h=Cf.paint.properties[n];let _=!1;const x=T=>{for(const I of T)if(h.overrides&&h.overrides.hasOverride(I))return void(_=!0)};if("constant"===s.value.kind&&s.value.value instanceof Wr)x(s.value.value.sections);else if("source"===s.value.kind){const T=A=>{_||(A instanceof qr&&xr(A.value)===Yt?x(A.value.sections):A instanceof to?x(A.sections):A.eachChild(T))},I=s.value;I._styleExpression&&T(I._styleExpression.expression)}return _}getProgramConfiguration(e){return new Ic(this,e)}}var q_={paint:new hi({"background-color":new $t(Xt.paint_background["background-color"]),"background-pattern":new $t(Xt.paint_background["background-pattern"]),"background-opacity":new $t(Xt.paint_background["background-opacity"])})},_g={paint:new hi({"raster-opacity":new $t(Xt.paint_raster["raster-opacity"]),"raster-hue-rotate":new $t(Xt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $t(Xt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $t(Xt.paint_raster["raster-brightness-max"]),"raster-saturation":new $t(Xt.paint_raster["raster-saturation"]),"raster-contrast":new $t(Xt.paint_raster["raster-contrast"]),"raster-resampling":new $t(Xt.paint_raster["raster-resampling"]),"raster-fade-duration":new $t(Xt.paint_raster["raster-fade-duration"])})};class Tf extends nl{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Ef={paint:new hi({"sky-type":new $t(Xt.paint_sky["sky-type"]),"sky-atmosphere-sun":new $t(Xt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new $t(Xt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new $t(Xt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new $t(Xt.paint_sky["sky-gradient-radius"]),"sky-gradient":new ni(Xt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new $t(Xt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new $t(Xt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new $t(Xt.paint_sky["sky-opacity"])})};function Df(t,e,n){const s=[0,0,1],h=mh([]);return Bo(h,h,n?-_e(t)+Math.PI:_e(t)),mm(h,h,-_e(e)),r_(s,s,h),oa(s,s)}const Yh={circle:class extends nl{constructor(t){super(t,t_)}createBucket(t){return new ah(t)}queryRadius(t){const e=t;return Mc("circle-radius",this,e)+Mc("circle-stroke-width",this,e)+vd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,s,h,_,x,T){const I=Ap(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,t.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return gm(t,s,_,x,T,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),I,A)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Ic(this,t)}},heatmap:class extends nl{createBucket(t){return new c_(t)}constructor(t){super(t,u_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Bp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Mc("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,s,h,_,x,T){const I=this.paint.get("heatmap-radius").evaluate(e,n);return gm(t,s,_,x,T,!0,!0,new Q(0,0),I)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Ic(this,t)}},hillshade:class extends nl{constructor(t){super(t,vm)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends nl{constructor(t){super(t,m_)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new Ic(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Id(t)}queryRadius(){return vd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,s,h,_){return!t.queryGeometry.isAboveHorizon&&ch(Sp(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends nl{constructor(t){super(t,E_)}createBucket(t){return new Qu(t)}queryRadius(){return vd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Ic(this,t)}queryIntersectsFeature(t,e,n,s,h,_,x,T,I){const A=Ap(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,t.pixelToTileUnitsFactor),L=this.paint.get("fill-extrusion-height").evaluate(e,n),N=this.paint.get("fill-extrusion-base").evaluate(e,n),Z=[0,0],J=T&&_.elevation,ee=_.elevation?_.elevation.exaggeration():1,pe=t.tile.getBucket(this);if(J&&pe instanceof Qu){const st=pe.centroidVertexArray,Ct=I+1;Ct<st.length&&(Z[0]=st.geta_centroid_pos0(Ct),Z[1]=st.geta_centroid_pos1(Ct))}if(0===Z[0]&&1===Z[1])return!1;"globe"===_.projection.name&&(s=Rm([s],[new Q(0,0),new Q(Di,Di)],t.tileID.canonical).map(st=>st.polygon).flat());const Pe=J?T:null,[Qe,ut]=(Ct=s,mt=N,Kt=L,qt=A,mn=x,Mn=Pe,an=Z,_n=ee,vn=_.center.lat,"globe"===(st=_).projection.name?function(On,sn,Gn,gi,qn,ei,jn,_i,Ji,Wi,qi){const Ti=[],Mr=[],Oi=On.projection.upVectorScale(qi,On.center.lat,On.worldSize).metersToTile,Ki=[0,0,0,1],Fr=[0,0,0,1],Yr=(Jr,Qr,po,is)=>{Jr[0]=Qr,Jr[1]=po,Jr[2]=is,Jr[3]=1},Zr=qp();Gn>0&&(Gn+=Zr),gi+=Zr;for(const Jr of sn){const Qr=[],po=[];for(const is of Jr){const Pr=is.x+qn.x,Po=is.y+qn.y,Io=On.projection.projectTilePoint(Pr,Po,qi),pr=On.projection.upVector(qi,is.x,is.y);let oo=Gn,No=gi;if(jn){const kr=Jp(Pr,Po,Gn,gi,jn,_i,Ji,Wi);oo+=kr.base,No+=kr.top}0!==Gn?Yr(Ki,Io.x+pr[0]*Oi*oo,Io.y+pr[1]*Oi*oo,Io.z+pr[2]*Oi*oo):Yr(Ki,Io.x,Io.y,Io.z),Yr(Fr,Io.x+pr[0]*Oi*No,Io.y+pr[1]*Oi*No,Io.z+pr[2]*Oi*No),Eo(Ki,Ki,ei),Eo(Fr,Fr,ei),Qr.push(new zi(Ki[0],Ki[1],Ki[2])),po.push(new zi(Fr[0],Fr[1],Fr[2]))}Ti.push(Qr),Mr.push(po)}return[Ti,Mr]}(st,Ct,mt,Kt,qt,mn,Mn,an,_n,vn,t.tileID.canonical):Mn?function(On,sn,Gn,gi,qn,ei,jn,_i,Ji){const Wi=[],qi=[],Ti=[0,0,0,1];for(const Mr of On){const Oi=[],Ki=[];for(const Fr of Mr){const Yr=Fr.x+gi.x,Zr=Fr.y+gi.y,Jr=Jp(Yr,Zr,sn,Gn,ei,jn,_i,Ji);Ti[0]=Yr,Ti[1]=Zr,Ti[2]=Jr.base,Ti[3]=1,zl(Ti,Ti,qn),Ti[3]=Math.max(Ti[3],1e-5);const Qr=new zi(Ti[0]/Ti[3],Ti[1]/Ti[3],Ti[2]/Ti[3]);Ti[0]=Yr,Ti[1]=Zr,Ti[2]=Jr.top,Ti[3]=1,zl(Ti,Ti,qn),Ti[3]=Math.max(Ti[3],1e-5);const po=new zi(Ti[0]/Ti[3],Ti[1]/Ti[3],Ti[2]/Ti[3]);Oi.push(Qr),Ki.push(po)}Wi.push(Oi),qi.push(Ki)}return[Wi,qi]}(Ct,mt,Kt,qt,mn,Mn,an,_n,vn):function(On,sn,Gn,gi,qn){const ei=[],jn=[],_i=qn[8]*sn,Ji=qn[9]*sn,Wi=qn[10]*sn,qi=qn[11]*sn,Ti=qn[8]*Gn,Mr=qn[9]*Gn,Oi=qn[10]*Gn,Ki=qn[11]*Gn;for(const Fr of On){const Yr=[],Zr=[];for(const Jr of Fr){const Qr=Jr.x+gi.x,po=Jr.y+gi.y,is=qn[0]*Qr+qn[4]*po+qn[12],Pr=qn[1]*Qr+qn[5]*po+qn[13],Po=qn[2]*Qr+qn[6]*po+qn[14],Io=qn[3]*Qr+qn[7]*po+qn[15],pr=is+_i,oo=Pr+Ji,No=Po+Wi,kr=Math.max(Io+qi,1e-5),bo=is+Ti,Rs=Pr+Mr,rs=Po+Oi,os=Math.max(Io+Ki,1e-5);Yr.push(new zi(pr/kr,oo/kr,No/kr)),Zr.push(new zi(bo/os,Rs/os,rs/os))}ei.push(Yr),jn.push(Zr)}return[ei,jn]}(Ct,mt,Kt,qt,mn)),et=t.queryGeometry;var st,Ct,mt,Kt,qt,mn,Mn,an,_n,vn;return function(st,Ct,mt){let Kt=1/0;ch(mt,Ct)&&(Kt=Yp(mt,Ct[0]));for(let qt=0;qt<Ct.length;qt++){const mn=Ct[qt],Mn=st[qt];for(let an=0;an<mn.length-1;an++){const _n=mn[an],vn=[_n,mn[an+1],Mn[an+1],Mn[an],_n];Dp(mt,vn)&&(Kt=Math.min(Kt,Yp(mt,vn)))}}return Kt!==1/0&&Kt}(Qe,ut,et.isPointQuery()?et.screenBounds:et.screenGeometry)}},line:class extends nl{constructor(t){super(t,Xp),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Yo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Kp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Sh(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Ic(this,t)}queryRadius(t){const e=t,n=Ac(Mc("line-width",this,e),Mc("line-gap-width",this,e)),s=Mc("line-offset",this,e);return n/2+Math.abs(s)+vd(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,s,h,_){if(t.queryGeometry.isAboveHorizon)return!1;const x=Sp(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,t.pixelToTileUnitsFactor),T=t.pixelToTileUnitsFactor/2*Ac(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),I=this.paint.get("line-offset").evaluate(e,n);return I&&(s=function(A,L){const N=[],Z=new Q(0,0);for(let J=0;J<A.length;J++){const ee=A[J],pe=[];for(let Pe=0;Pe<ee.length;Pe++){const ut=ee[Pe],et=ee[Pe+1],st=0===Pe?Z:ut.sub(ee[Pe-1])._unit()._perp(),Ct=Pe===ee.length-1?Z:et.sub(ut)._unit()._perp(),mt=st._add(Ct)._unit();mt._mult(1/(mt.x*Ct.x+mt.y*Ct.y)),pe.push(mt._mult(L)._add(ut))}N.push(pe)}return N}(s,I*t.pixelToTileUnitsFactor)),function(A,L,N){for(let Z=0;Z<L.length;Z++){const J=L[Z];if(A.length>=3)for(let ee=0;ee<J.length;ee++)if(Jc(A,J[ee]))return!0;if(Yc(A,J,N))return!0}return!1}(x,s,T)}isTileClipped(){return!0}},symbol:Hd,background:class extends nl{constructor(t){super(t,q_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends nl{constructor(t){super(t,_g)}getProgramIds(){return["raster"]}},sky:class extends nl{constructor(t){super(t,Ef),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Bp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),h=!s,_=t.style.light,x=_.properties.get("position");return h&&"viewport"===_.properties.get("anchor")&&yn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Df(x.azimuthal,90-x.polar,e):Df(s[0],90-s[1],e)}const n=this.paint.get("sky-gradient-center");return Df(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class Lc{constructor(e,n,s,h){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(n,h)}update(e,n,s){const{width:h,height:_}=e,{context:x}=this,{gl:T}=x,{HTMLImageElement:I,HTMLCanvasElement:A,HTMLVideoElement:L,ImageData:N,ImageBitmap:Z}=q;if(T.bindTexture(T.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!n||!1!==n.premultiply)),s||this.size&&this.size[0]===h&&this.size[1]===_){const{x:J,y:ee}=s||{x:0,y:0};e instanceof I||e instanceof A||e instanceof L||e instanceof N||Z&&e instanceof Z?T.texSubImage2D(T.TEXTURE_2D,0,J,ee,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,J,ee,h,_,T.RGBA,T.UNSIGNED_BYTE,e.data)}else this.size=[h,_],e instanceof I||e instanceof A||e instanceof L||e instanceof N||Z&&e instanceof Z?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,h,_,0,this.format,T.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&T.generateMipmap(T.TEXTURE_2D)}bind(e,n){const{context:s}=this,{gl:h}=s;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class If{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Y_{constructor(){this.tasks={},this.taskQueue=[],it(["process"],this),this.invoker=new If(this.process),this.nextId=0}add(e,n){const s=this.nextId++,h=function({type:_,isSymbolTile:x,zoom:T}){return T=T||0,"message"===_?0:"maybePrepare"!==_||x?"parseTile"!==_||x?"parseTile"===_&&x?300-T:"maybePrepare"===_&&x?400-T:500:200-T:100-T}(n);if(0===h){ot();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:n,priority:h,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){ot();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let h=0;h<this.taskQueue.length;h++){const _=this.tasks[this.taskQueue[h]];_.priority<n&&(n=_.priority,e=h)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class Wd{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Jh=["tile","layer","source","sourceLayer","state"];class Xh{constructor(e,n,s,h,_){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=s,this._y=h,this.properties=e.properties,this.id=_}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const n of Jh)void 0!==this[n]&&(e[n]=this[n]);return e}}const uc=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,s=0,h=0,_=0,x=0,T=0;for(1&e?h=_=x=32:n=s=T=32;(e>>=1)>1;){const A=n+h>>1,L=s+_>>1;1&e?(h=n,_=s,n=x,s=T):(n=h,s=_,h=x,_=T),x=A,T=L}const I=4*t;uc[I+0]=n,uc[I+1]=s,uc[I+2]=h,uc[I+3]=_}const Sl=new Uint16Array(2178),Zl=new Uint8Array(1089),qd=new Uint16Array(1089);function yg(t){return 0===t?-.03125:32===t?.03125:0}var Mf=Xn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Sf={type:2,extent:Di,loadGeometry:()=>[[new Q(0,0),new Q(8193,0),new Q(8193,8193),new Q(0,8193),new Q(0,0)]]};class Kh{constructor(e,n,s,h,_){this.tileID=e,this.uid=Ot(),this.uses=0,this.tileSize=n,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<Hn.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Va(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,_){const x={};if(!_)return x;for(const T of h){const I=T.layerIds.map(A=>_.getLayer(A)).filter(Boolean);if(0!==I.length){T.layers=I,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(A=>I.filter(L=>L.id===A)[0]));for(const A of I)x[A.id]=T}}return x}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof cc){if(this.hasSymbolBuckets=!0,!s)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof cc&&_.hasRTLText){this.hasRTLText=!0,Wt.isLoading()||Wt.isLoaded()||"deferred"!==Lt()||en();break}}this.queryPadding=0;for(const h in this.buckets){const _=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(h).queryRadius(_))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new up}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const h=this.buckets[s];h.uploadPending()&&h.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Lc(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Lc(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Lc(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,s,h,_,x,T,I){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:T,transform:x,params:_,tileTransform:this.tileTransform},e,n,s):{}}querySourceFeatures(e,n){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const h=s.loadVTLayers(),_=n?n.sourceLayer:"",x=h._geojsonTileLayer||h[_];if(!x)return;const T=Ra(n&&n.filter),{z:I,x:A,y:L}=this.tileID.canonical,N={z:I,x:A,y:L};for(let Z=0;Z<x.length;Z++){const J=x.feature(Z);if(T.needGeometry){const Pe=qc(J,!0);if(!T.filter(new Ut(this.tileID.overscaledZ),Pe,this.tileID.canonical))continue}else if(!T.filter(new Ut(this.tileID.overscaledZ),J))continue;const ee=s.getId(J,_),pe=new Xh(J,I,A,L,ee);pe.tile=N,e.push(pe)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const s=Nt(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let h=!1;if(this.expirationTime>s)h=!1;else if(n)if(this.expirationTime<n)h=!0;else{const _=this.expirationTime-n;_?this.expirationTime=s+Math.max(_,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!n)return;const s=this.latestFeatureIndex.loadVTLayers(),h=n.style.listImages();for(const _ in this.buckets){if(!n.style.hasLayer(_))continue;const x=this.buckets[_],T=x.layers[0].sourceLayer||"_geojsonTileLayer",I=s[T],A=e[T];if(!I||!A||0===Object.keys(A).length)continue;if(x.update(A,I,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),x instanceof Sh||x instanceof Id){const N=n.style._getSourceCache(x.layers[0].source);n._terrain&&n._terrain.enabled&&N&&x.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(N.id,this.tileID)}const L=n&&n.style&&n.style.getLayer(_);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(x)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Hn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Hn.now()+e}setTexture(e,n){const s=n.context,h=s.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Lc(s,e,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),s.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax))}setDependencies(e,n){const s={};for(const h of n)s[h]=!0;this.dependencies[e]=s}hasDependency(e,n){for(const s of e){const h=this.dependencies[s];if(h)for(const _ of n)if(h[_])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const s=Nl(Sf,this.tileID.canonical,this.tileTransform)[0],h=new br,_=new Hc;for(let x=0;x<s.length;x++){const{x:T,y:I}=s[x];h.emplaceBack(T,I),_.emplaceBack(x)}_.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(_),this._tileDebugBuffer=e.createVertexBuffer(h,sc.members),this._tileDebugSegments=Ao.simpleSegment(0,0,h.length,_.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const s=Nl(Sf,this.tileID.canonical,this.tileTransform)[0];let h,_;if(this.isRaster){const x=function(T,I){const A=Va(T,I),L=Math.pow(2,T.z);for(let Pe=0;Pe<33;Pe++)for(let Qe=0;Qe<33;Qe++){const ut=Ca((T.x+(Qe+yg(Qe))/32)/L),et=ts((T.y+(Pe+yg(Pe))/32)/L),st=I.project(ut,et),Ct=33*Pe+Qe;Sl[2*Ct+0]=Math.round((st.x*A.scale-A.x)*Di),Sl[2*Ct+1]=Math.round((st.y*A.scale-A.y)*Di)}Zl.fill(0),qd.fill(0);for(let Pe=2045;Pe>=0;Pe--){const Qe=4*Pe,ut=uc[Qe+0],et=uc[Qe+1],st=uc[Qe+2],Ct=uc[Qe+3],mt=ut+st>>1,Kt=et+Ct>>1,qt=mt+Kt-et,mn=Kt+ut-mt,Mn=33*et+ut,an=33*Ct+st,_n=33*Kt+mt,vn=Math.hypot((Sl[2*Mn+0]+Sl[2*an+0])/2-Sl[2*_n+0],(Sl[2*Mn+1]+Sl[2*an+1])/2-Sl[2*_n+1])>=16;Zl[_n]=Zl[_n]||(vn?1:0),Pe<1022&&(Zl[_n]=Zl[_n]||Zl[33*(et+mn>>1)+(ut+qt>>1)]||Zl[33*(Ct+mn>>1)+(st+qt>>1)])}const N=new Lr,Z=new es;let J=0;function ee(Pe,Qe){const ut=33*Qe+Pe;return 0===qd[ut]&&(N.emplaceBack(Sl[2*ut+0],Sl[2*ut+1],Pe*Di/32,Qe*Di/32),qd[ut]=++J),qd[ut]-1}function pe(Pe,Qe,ut,et,st,Ct){const mt=Pe+ut>>1,Kt=Qe+et>>1;if(Math.abs(Pe-st)+Math.abs(Qe-Ct)>1&&Zl[33*Kt+mt])pe(st,Ct,Pe,Qe,mt,Kt),pe(ut,et,st,Ct,mt,Kt);else{const qt=ee(Pe,Qe),mn=ee(ut,et),Mn=ee(st,Ct);Z.emplaceBack(qt,mn,Mn)}}return pe(0,0,32,32,32,0),pe(32,32,0,0,0,32),{vertices:N,indices:Z}}(this.tileID.canonical,n);h=x.vertices,_=x.indices}else{h=new Lr,_=new es;for(const{x:T,y:I}of s)h.emplaceBack(T,I,0,0);const x=vh.exports(h.int16,void 0,4);for(let T=0;T<x.length;T+=3)_.emplaceBack(x[T],x[T+1],x[T+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,Mf.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(_),this._tileBoundsSegments=Ao.simpleSegment(0,0,h.length,_.length)}_makeGlobeTileDebugBuffers(e,n){const s=n.projection;if(!s||"globe"!==s.name||n.freezeTileCoverage)return;const h=this.tileID.canonical,_=zd(ag(h,n)),x=ad(n.zoom);let T;x>0&&(T=Xc(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,h,n,_,T,x),this._makeGlobeTileDebugTextBuffer(e,h,n,_,T,x)}_globePoint(e,n,s,h,_,x,T){let I=Nd(e,n,s);if(x){const A=1<<s.z,L=ec(h.center.lng),N=za(h.center.lat),Z=(s.x+.5)/A-L;let J=0;Z>.5?J=-1:Z<-.5&&(J=1);let ee=(e/Di+s.x)/A+J,pe=(n/Di+s.y)/A;ee=(ee-L)*h._pixelsPerMercatorPixel+L,pe=(pe-N)*h._pixelsPerMercatorPixel+N;const Pe=[ee*h.worldSize,pe*h.worldSize,0];Eo(Pe,Pe,x),I=du(I,Pe,T)}return Eo(I,I,_)}_makeGlobeTileDebugBorderBuffer(e,n,s,h,_,x){const T=new br,I=new Hc,A=new Br,L=(Z,J,ee,pe,Pe)=>{const Qe=(ee-Z)/(Pe-1),ut=(pe-J)/(Pe-1),et=T.length;for(let st=0;st<Pe;st++){const Ct=Z+st*Qe,mt=J+st*ut;T.emplaceBack(Ct,mt);const Kt=this._globePoint(Ct,mt,n,s,h,_,x);A.emplaceBack(Kt[0],Kt[1],Kt[2]),I.emplaceBack(et+st)}},N=Di;L(0,0,N,0,16),L(N,0,N,N,16),L(N,N,0,N,16),L(0,N,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(I),this._tileDebugBuffer=e.createVertexBuffer(T,sc.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(A,Fd.members),this._tileDebugSegments=Ao.simpleSegment(0,0,T.length,I.length)}_makeGlobeTileDebugTextBuffer(e,n,s,h,_,x){const T=new br,I=new es,A=new Br,L=25;I.reserve(32),T.reserve(L),A.reserve(L);const N=(Z,J)=>L*Z+J;for(let Z=0;Z<L;Z++){const J=2048*Z;for(let ee=0;ee<L;ee++){const pe=2048*ee;T.emplaceBack(pe,J);const Pe=this._globePoint(pe,J,n,s,h,_,x);A.emplaceBack(Pe[0],Pe[1],Pe[2])}}for(let Z=0;Z<4;Z++)for(let J=0;J<4;J++){const ee=N(Z,J),pe=N(Z,J+1),Pe=N(Z+1,J),Qe=N(Z+1,J+1);I.emplaceBack(ee,pe,Pe),I.emplaceBack(Pe,pe,Qe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(I),this._tileDebugTextBuffer=e.createVertexBuffer(T,sc.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(A,Fd.members),this._tileDebugTextSegments=Ao.simpleSegment(0,0,L,32)}}class vg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,s){const h=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},Tt(this.stateChanges[e][h],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const _ in this.state[e])_!==h&&(this.deletedStates[e][_]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][h]){this.deletedStates[e][h]={};for(const _ in this.state[e][h])s[_]||(this.deletedStates[e][h][_]=null)}else for(const _ in s)this.deletedStates[e]&&this.deletedStates[e][h]&&null===this.deletedStates[e][h][_]&&delete this.deletedStates[e][h][_]}removeFeatureState(e,n,s){if(null===this.deletedStates[e])return;const h=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==n)null!==this.deletedStates[e][h]&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][s]=null);else if(void 0!==n)if(this.stateChanges[e]&&this.stateChanges[e][h])for(s in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][s]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,n){const s=String(n),h=Tt({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const _=this.deletedStates[e][n];if(null===_)return{};for(const x in _)delete h[x]}return h}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const s={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const _={};for(const x in this.stateChanges[h])this.state[h][x]||(this.state[h][x]={}),Tt(this.state[h][x],this.stateChanges[h][x]),_[x]=this.state[h][x];s[h]=_}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const _={};if(null===this.deletedStates[h])for(const x in this.state[h])_[x]={},this.state[h][x]={};else for(const x in this.deletedStates[h]){if(null===this.deletedStates[h][x])this.state[h][x]={};else for(const T of Object.keys(this.deletedStates[h][x]))delete this.state[h][x][T];_[x]=this.state[h][x]}s[h]=s[h]||{},Tt(s[h],_)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const h in e)e[h].setFeatureState(s,n)}}class xg{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const s=this.toIdx(e,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function Af(t,e,n,s){let h=0,_=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(s[x])<1e-15){if(n[x]<t[x]||n[x]>e[x])return null}else{const T=1/s[x];let I=(t[x]-n[x])*T,A=(e[x]-n[x])*T;if(I>A){const L=I;I=A,A=L}if(I>h&&(h=I),A<_&&(_=A),h>_)return null}return h}function Pf(t,e,n,s,h,_,x,T,I,A,L){const N=s-t,Z=h-e,J=_-n,ee=x-t,pe=T-e,Pe=I-n,Qe=L[1]*Pe-L[2]*pe,ut=L[2]*ee-L[0]*Pe,et=L[0]*pe-L[1]*ee,st=N*Qe+Z*ut+J*et;if(Math.abs(st)<1e-15)return null;const Ct=1/st,mt=A[0]-t,Kt=A[1]-e,qt=A[2]-n,mn=(mt*Qe+Kt*ut+qt*et)*Ct;if(mn<0||mn>1)return null;const Mn=Kt*J-qt*Z,an=qt*N-mt*J,_n=mt*Z-Kt*N,vn=(L[0]*Mn+L[1]*an+L[2]*_n)*Ct;return vn<0||mn+vn>1?null:(ee*Mn+pe*an+Pe*_n)*Ct}function Qh(t,e,n){return(t-e)/(n-e)}function ep(t,e,n,s,h,_,x,T,I){const A=1<<n,L=_-s,N=x-h,Z=(t+1)/A*L+s,J=(e+0)/A*N+h,ee=(e+1)/A*N+h;T[0]=(t+0)/A*L+s,T[1]=J,I[0]=Z,I[1]=ee}class Of{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(_){const x=Math.ceil(Math.log2(_.dim/8)),T=[];let I=Math.ceil(Math.pow(2,x));const A=1/I,L=(J,ee,pe,Pe,Qe)=>{const ut=Pe?1:0,et=(J+1)*pe-ut,st=ee*pe,Ct=(ee+1)*pe-ut;Qe[0]=J*pe,Qe[1]=st,Qe[2]=et,Qe[3]=Ct};let N=new xg(I);const Z=[];for(let J=0;J<I*I;J++){L(J%I,Math.floor(J/I),A,!1,Z);const ee=dc(Z[0],Z[1],_),pe=dc(Z[2],Z[1],_),Pe=dc(Z[2],Z[3],_),Qe=dc(Z[0],Z[3],_);N.minimums.push(Math.min(ee,pe,Pe,Qe)),N.maximums.push(Math.max(ee,pe,Pe,Qe)),N.leaves.push(1)}for(T.push(N),I/=2;I>=1;I/=2){const J=T[T.length-1];N=new xg(I);for(let ee=0;ee<I*I;ee++){L(ee%I,Math.floor(ee/I),2,!0,Z);const pe=J.getElevation(Z[0],Z[1]),Pe=J.getElevation(Z[2],Z[1]),Qe=J.getElevation(Z[2],Z[3]),ut=J.getElevation(Z[0],Z[3]),et=J.isLeaf(Z[0],Z[1]),st=J.isLeaf(Z[2],Z[1]),Ct=J.isLeaf(Z[2],Z[3]),mt=J.isLeaf(Z[0],Z[3]),Kt=Math.min(pe.min,Pe.min,Qe.min,ut.min),qt=Math.max(pe.max,Pe.max,Qe.max,ut.max),mn=et&&st&&Ct&&mt;N.maximums.push(qt),N.minimums.push(Kt),N.leaves.push(qt-Kt<=5&&mn?1:0)}T.push(N)}return T}(this.dem),s=n.length-1,h=n[s];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(e,n,s,h,_,x,T=1){return Af([e,n,-100],[s,h,this.maximums[0]*T],_,x)}raycast(e,n,s,h,_,x,T=1){if(!this.nodeCount)return null;const I=this.raycastRoot(e,n,s,h,_,x,T);if(null==I)return null;const A=[],L=[],N=[],Z=[],J=[{idx:0,t:I,nodex:0,nodey:0,depth:0}];for(;J.length>0;){const{idx:ee,t:pe,nodex:Pe,nodey:Qe,depth:ut}=J.pop();if(this.leaves[ee]){ep(Pe,Qe,ut,e,n,s,h,N,Z);const st=1<<ut,Ct=(Pe+0)/st,mt=(Pe+1)/st,Kt=(Qe+0)/st,qt=(Qe+1)/st,mn=dc(Ct,Kt,this.dem)*T,Mn=dc(mt,Kt,this.dem)*T,an=dc(mt,qt,this.dem)*T,_n=dc(Ct,qt,this.dem)*T,vn=Pf(N[0],N[1],mn,Z[0],N[1],Mn,Z[0],Z[1],an,_,x),In=Pf(Z[0],Z[1],an,N[0],Z[1],_n,N[0],N[1],mn,_,x),On=Math.min(null!==vn?vn:Number.MAX_VALUE,null!==In?In:Number.MAX_VALUE);if(On!==Number.MAX_VALUE)return On;{const sn=fh([],_,x,pe);if(Rf(mn,Mn,_n,an,Qh(sn[0],N[0],Z[0]),Qh(sn[1],N[1],Z[1]))>=sn[2])return pe}continue}let et=0;for(let st=0;st<this._siblingOffset.length;st++){ep((Pe<<1)+this._siblingOffset[st][0],(Qe<<1)+this._siblingOffset[st][1],ut+1,e,n,s,h,N,Z),N[2]=-100,Z[2]=this.maximums[this.childOffsets[ee]+st]*T;const Ct=Af(N,Z,_,x);if(null!=Ct){const mt=Ct;A[st]=mt;let Kt=!1;for(let qt=0;qt<et&&!Kt;qt++)mt>=A[L[qt]]&&(L.splice(qt,0,st),Kt=!0);Kt||(L[et]=st),et++}}for(let st=0;st<et;st++){const Ct=L[st];J.push({idx:this.childOffsets[ee]+Ct,t:A[Ct],nodex:(Pe<<1)+this._siblingOffset[Ct][0],nodey:(Qe<<1)+this._siblingOffset[Ct][1],depth:ut+1})}}return null}_addNode(e,n,s){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,s,h,_){if(1===e[h].isLeaf(n,s))return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const x=h-1,T=e[x];let I=0,A=0;for(let L=0;L<this._siblingOffset.length;L++){const N=2*n+this._siblingOffset[L][0],Z=2*s+this._siblingOffset[L][1],J=T.getElevation(N,Z),ee=T.isLeaf(N,Z),pe=this._addNode(J.min,J.max,ee);ee&&(I|=1<<L),A||(A=pe)}for(let L=0;L<this._siblingOffset.length;L++)I&1<<L||this._construct(e,2*n+this._siblingOffset[L][0],2*s+this._siblingOffset[L][1],x,A+L)}}function Rf(t,e,n,s,h,_){return wi(wi(t,n,_),wi(e,s,_),h)}function dc(t,e,n){const s=n.dim,h=ge(t*s-.5,0,s-1),_=ge(e*s-.5,0,s-1),x=Math.floor(h),T=Math.floor(_),I=Math.min(x+1,s-1),A=Math.min(T+1,s-1);return Rf(n.get(x,T),n.get(I,T),n.get(x,A),n.get(I,A),h-x,_-T)}const Lf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Yd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,s,h=!1,_=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return yn(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const x=this.dim=n.height-2,T=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=s||"mapbox",this.borderReady=h,!h){for(let I=0;I<x;I++)T[this._idx(-1,I)]=T[this._idx(0,I)],T[this._idx(x,I)]=T[this._idx(x-1,I)],T[this._idx(I,-1)]=T[this._idx(I,0)],T[this._idx(I,x)]=T[this._idx(I,x-1)];T[this._idx(-1,-1)]=T[this._idx(0,0)],T[this._idx(x,-1)]=T[this._idx(x-1,0)],T[this._idx(-1,x)]=T[this._idx(0,x-1)],T[this._idx(x,x)]=T[this._idx(x-1,x-1)],_&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Of(this)}get(e,n,s=!1){s&&(e=ge(e,-1,this.dim),n=ge(n,-1,this.dim));const h=4*this._idx(e,n);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(e){return Lf[e]}get unpackVector(){return Lf[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,s){return(256*e*256+256*n+s)/10-1e4}_unpackTerrarium(e,n,s){return 256*e+n+s/256-32768}static pack(e,n){const s=[0,0,0,0],h=Yd.getUnpackVector(n);let _=Math.floor((e+h[3])/h[2]);return s[2]=_%256,_=Math.floor(_/256),s[1]=_%256,_=Math.floor(_/256),s[0]=_,s}getPixels(){return new sa({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,_=n*this.dim+this.dim,x=s*this.dim,T=s*this.dim+this.dim;switch(n){case-1:h=_-1;break;case 1:_=h+1}switch(s){case-1:x=T-1;break;case 1:T=x+1}const I=-n*this.dim,A=-s*this.dim;for(let L=x;L<T;L++)for(let N=h;N<_;N++){const Z=4*this._idx(N,L),J=4*this._idx(N+I,L+A);this.pixels[Z+0]=e.pixels[J+0],this.pixels[Z+1]=e.pixels[J+1],this.pixels[Z+2]=e.pixels[J+2],this.pixels[Z+3]=e.pixels[J+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Zn(Yd,"DEMData"),Zn(Of,"DemMinMaxQuadTree",{omit:["dem"]});class bg{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,s){const h=e.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const _={value:n,timeout:void 0};if(void 0!==s&&(_.timeout=setTimeout(()=>{this.remove(e,_)},s)),this.data[h].push(_),this.order.push(h),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const s=e.wrapped().key,h=void 0===n?0:this.data[s].indexOf(n),_=this.data[s][h];return this.data[s].splice(h,1),_.timeout&&clearTimeout(_.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(_.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const s in this.data)for(const h of this.data[s])e(h.value)||n.push(h);for(const s of n)this.remove(s.value.tileID,s)}}class xu{constructor(e,n,s){this.func=e,this.mask=n,this.range=s}}xu.ReadOnly=!1,xu.ReadWrite=!0,xu.disabled=new xu(519,xu.ReadOnly,[0,1]);class hd{constructor(e,n,s,h,_,x){this.test=e,this.ref=n,this.mask=s,this.fail=h,this.depthFail=_,this.pass=x}}hd.disabled=new hd({func:519,mask:0},0,0,7680,7680,7680);class Os{constructor(e,n,s){this.blendFunction=e,this.blendColor=n,this.mask=s}}Os.Replace=[1,0],Os.disabled=new Os(Os.Replace,lr.transparent,[!1,!1,!1,!1]),Os.unblended=new Os(Os.Replace,lr.transparent,[!0,!0,!0,!0]),Os.alphaBlended=new Os([1,771],lr.transparent,[!0,!0,!0,!0]);class $a{constructor(e,n,s){this.enable=e,this.mode=n,this.frontFace=s}}$a.disabled=new $a(!1,1029,2305),$a.backCCW=new $a(!0,1029,2305),$a.backCW=new $a(!0,1029,2304),$a.frontCW=new $a(!0,1028,2304),$a.frontCCW=new $a(!0,1028,2305);class Za extends Or{constructor(e,n,s){super(),this.id=e,this._onlySymbols=s,n.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new bg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new vg,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if("loaded"!==n.state&&"errored"!==n.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const s=this._tiles[n];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return vt(this._tiles).map(e=>e.tileID).sort(np).map(e=>e.key)}getRenderableIds(e){const n=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&n.push(this._tiles[s]);return e?n.sort((s,h)=>{const _=s.tileID,x=h.tileID,T=new Q(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),I=new Q(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-x.overscaledZ||I.y-T.y||I.x-T.x}).map(s=>s.tileID.key):n.map(s=>s.tileID).sort(np).map(s=>s.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,e,n)))}_tileLoaded(e,n,s,h){if(h)if(e.state="errored",404!==h.status)this._source.fire(new Tr(h,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Hn.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Gr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let h=0;h<n.length;h++){const _=n[h];if(e.neighboringTiles&&e.neighboringTiles[_]){const x=this.getTileByID(_);s(e,x),s(x,e)}}function s(h,_){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let x=_.tileID.canonical.x-h.tileID.canonical.x;const T=_.tileID.canonical.y-h.tileID.canonical.y,I=Math.pow(2,h.tileID.canonical.z),A=_.tileID.key;0===x&&0===T||Math.abs(T)>1||(Math.abs(x)>1&&(1===Math.abs(x+I)?x+=I:1===Math.abs(x-I)&&(x-=I)),_.dem&&h.dem&&(h.dem.backfillBorder(_.dem,x,T),h.neighboringTiles&&h.neighboringTiles[A]&&(h.neighboringTiles[A].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,s,h){for(const _ in this._tiles){let x=this._tiles[_];if(h[_]||!x.hasData()||x.tileID.overscaledZ<=n||x.tileID.overscaledZ>s)continue;let T=x.tileID;for(;x&&x.tileID.overscaledZ>n+1;){const A=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[A.key],x&&x.hasData()&&(T=A)}let I=T;for(;I.overscaledZ>n;)if(I=I.scaledTo(I.overscaledZ-1),e[I.key]){h[T.key]=T;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=e.overscaledZ-1;s>=n;s--){const h=e.scaledTo(s),_=this._getLoadedTile(h);if(_)return _}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const s=Math.ceil(e.width/n)+1,h=Math.ceil(e.height/n)+1,_=Math.floor(s*h*5),x="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,_):_,T="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(T)}handleWrapJump(e){const n=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,n){const s={};for(const h in this._tiles){const _=this._tiles[h];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+n),s[_.tileID.key]=_}this._tiles=s;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,n,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let h;this.updateCacheSize(e,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new js(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(h=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(T=>this._source.hasTile(T)))):h=[];const _=this._updateRetainedTiles(h);if(wg(this._source.type)&&0!==h.length){const T={},I={},A=Object.keys(_);for(const N of A){const Z=_[N],J=this._tiles[N];if(!J||J.fadeEndTime&&J.fadeEndTime<=Hn.now())continue;const ee=this.findLoadedParent(Z,Math.max(Z.overscaledZ-Za.maxOverzooming,this._source.minzoom));ee&&(this._addTile(ee.tileID),T[ee.tileID.key]=ee.tileID),I[N]=Z}const L=h[h.length-1].overscaledZ;for(const N in this._tiles){const Z=this._tiles[N];if(_[N]||!Z.hasData())continue;let J=Z.tileID;for(;J.overscaledZ>L;){J=J.scaledTo(J.overscaledZ-1);const ee=this._tiles[J.key];if(ee&&ee.hasData()&&I[J.key]){_[N]=Z.tileID;break}}}for(const N in T)_[N]||(this._coveredTiles[N]=!0,_[N]=T[N])}for(const T in _)this._tiles[T].clearFadeHold();const x=function(T,I){const A=[];for(const L in T)L in I||A.push(L);return A}(this._tiles,_);for(const T of x){const I=this._tiles[T];I.hasSymbolBuckets&&!I.holdingForFade()?I.setHoldDuration(this.map._fadeDuration):I.hasSymbolBuckets&&!I.symbolFadeFinished()||this._removeTile(+T)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(0===e.length)return n;const s={},h=e.reduce((A,L)=>Math.min(A,L.overscaledZ),1/0),_=e[0].overscaledZ,x=Math.max(_-Za.maxOverzooming,this._source.minzoom),T=Math.max(_+Za.maxUnderzooming,this._source.minzoom),I={};for(const A of e){const L=this._addTile(A);n[A.key]=A,L.hasData()||h<this._source.maxzoom&&(I[A.key]=A)}this._retainLoadedChildren(I,h,T,n);for(const A of e){let L=this._tiles[A.key];if(L.hasData())continue;if(A.canonical.z>=this._source.maxzoom){const Z=A.children(this._source.maxzoom)[0],J=this.getTile(Z);if(J&&J.hasData()){n[Z.key]=Z;continue}}else{const Z=A.children(this._source.maxzoom);if(n[Z[0].key]&&n[Z[1].key]&&n[Z[2].key]&&n[Z[3].key])continue}let N=L.wasRequested();for(let Z=A.overscaledZ-1;Z>=x;--Z){const J=A.scaledTo(Z);if(s[J.key]||(s[J.key]=!0,L=this.getTile(J),!L&&N&&(L=this._addTile(J)),L&&(n[J.key]=J,N=L.wasRequested(),L.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let s,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){s=this._loadedParentTiles[h.key];break}n.push(h.key);const _=h.scaledTo(h.overscaledZ-1);if(s=this._getLoadedTile(_),s)break;h=_}for(const _ of n)this._loadedParentTiles[_]=s}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const s=Boolean(n);if(!s){const h=this.map?this.map.painter:null;n=new Kh(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,s||this._source.fire(new Gr("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=n.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,s){const h=[],_=this.transform;if(!_)return h;const x="globe"===_.projection.name,T=ec(_.center.lng);for(const I in this._tiles){const A=this._tiles[I];if(s&&A.clearQueryDebugViz(),A.holdingForFade())continue;let L;if(x){const N=A.tileID.canonical;if(0===N.z){const Z=[Math.abs(ge(T,...bu(N,-1))-T),Math.abs(ge(T,...bu(N,1))-T)];L=[0,2*Z.indexOf(Math.min(...Z))-1]}else{const Z=[Math.abs(ge(T,...bu(N,-1))-T),Math.abs(ge(T,...bu(N,0))-T),Math.abs(ge(T,...bu(N,1))-T)];L=[Z.indexOf(Math.min(...Z))-1]}}else L=[0];for(const N of L){const Z=e.containsTile(A,_,n,N);Z&&h.push(Z)}}return h}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of n)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(wg(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=Hn.now())return!0}return!1}setFeatureState(e,n,s){this._state.updateState(e=e||"_geojsonTileLayer",n,s)}removeFeatureState(e,n,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,s)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,s){const h=this._tiles[e];h&&h.setDependencies(n,s)}reloadTilesForDependencies(e,n){for(const s in this._tiles)this._tiles[s].hasDependency(e,n)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,n))}_preloadTiles(e,n){const s=new Map,h=Array.isArray(e)?e:[e],_=this.map.painter.terrain,x=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const T of h){const I=T.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const A of I)s.set(A.key,A);this.usedForTerrain&&T.updateElevation(!1)}Ee(Array.from(s.values()),(T,I)=>{const A=new Kh(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(A,L=>{"raster-dem"===this._source.type&&A.dem&&this._backfillDEM(A),I(L,A)})},n)}}function np(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function wg(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function bu(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}Za.maxOverzooming=10,Za.maxUnderzooming=3;class Bf{constructor(e,n,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(e,n,s){const h=s||e.findDEMTileFor(n);if(!h||!h.dem)return;const _=h.dem,x=h.tileID,T=1<<n.canonical.z-x.canonical.z;return new Bf(h,h.tileSize/Di/T,[(n.canonical.x/T-x.canonical.x)*_.dim,(n.canonical.y/T-x.canonical.y)*_.dim])}tileCoordToPixel(e,n){const s=n*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),_=Math.floor(s);return new Q(h,_)}getElevationAt(e,n,s,h){const _=e*this._scale+this._offset[0],x=n*this._scale+this._offset[1],T=Math.floor(_),I=Math.floor(x),A=this._dem;return h=!!h,s?wi(wi(A.get(T,I,h),A.get(T,I+1,h),x-I),wi(A.get(T+1,I,h),A.get(T+1,I+1,h),x-I),_-T):A.get(T,I,h)}getElevationAtPixel(e,n,s){return this._dem.get(e,n,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*il(1,e)*this._dem.stride}}class J_{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new zs(Di,16,0),this.featureIndexArray=new As,this.promoteId=n}insert(e,n,s,h,_,x=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,_,x);const I=this.grid;for(let A=0;A<n.length;A++){const L=n[A],N=[1/0,1/0,-1/0,-1/0];for(let Z=0;Z<L.length;Z++){const J=L[Z];N[0]=Math.min(N[0],J.x),N[1]=Math.min(N[1],J.y),N[2]=Math.max(N[2],J.x),N[3]=Math.max(N[3],J.y)}N[0]<Di&&N[1]<Di&&N[2]>=0&&N[3]>=0&&I.insert(T,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new El(new Ad(this.rawTileData)).layers,this.sourceLayerCoder=new Wd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,s,h){this.loadVTLayers();const _=e.params||{},x=Ra(_.filter),T=e.tileResult,I=e.transform,A=T.bufferedTilespaceBounds,L=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,(ee,pe,Pe,Qe)=>Mp(T.bufferedTilespaceGeometry,ee,pe,Pe,Qe));L.sort(X_);let N=null;I.elevation&&L.length>0&&(N=Bf.create(I.elevation,this.tileID));const Z={};let J;for(let ee=0;ee<L.length;ee++){const pe=L[ee];if(pe===J)continue;J=pe;const Pe=this.featureIndexArray.get(pe);let Qe=null;this.loadMatchingFeature(Z,Pe,x,_.layers,_.availableImages,n,s,h,(ut,et,st,Ct=0)=>(Qe||(Qe=Nl(ut,this.tileID.canonical,e.tileTransform)),et.queryIntersectsFeature(T,ut,st,Qe,this.z,e.transform,e.pixelPosMatrix,N,Ct)))}return Z}loadMatchingFeature(e,n,s,h,_,x,T,I,A){const{featureIndex:L,bucketIndex:N,sourceLayerIndex:Z,layoutVertexArrayOffset:J}=n,ee=this.bucketLayerIDs[N];if(h&&!function(ut,et){for(let st=0;st<ut.length;st++)if(et.indexOf(ut[st])>=0)return!0;return!1}(h,ee))return;const pe=this.sourceLayerCoder.decode(Z),Pe=this.vtLayers[pe].feature(L);if(s.needGeometry){const ut=qc(Pe,!0);if(!s.filter(new Ut(this.tileID.overscaledZ),ut,this.tileID.canonical))return}else if(!s.filter(new Ut(this.tileID.overscaledZ),Pe))return;const Qe=this.getId(Pe,pe);for(let ut=0;ut<ee.length;ut++){const et=ee[ut];if(h&&h.indexOf(et)<0)continue;const st=x[et];if(!st)continue;let Ct={};void 0!==Qe&&I&&(Ct=I.getState(st.sourceLayer||"_geojsonTileLayer",Qe));const mt=Tt({},T[et]);mt.paint=Cg(mt.paint,st.paint,Pe,Ct,_),mt.layout=Cg(mt.layout,st.layout,Pe,Ct,_);const Kt=!A||A(Pe,st,Ct,J);if(!Kt)continue;const qt=new Xh(Pe,this.z,this.x,this.y,Qe);qt.layer=mt;let mn=e[et];void 0===mn&&(mn=e[et]=[]),mn.push({featureIndex:L,feature:qt,intersectionZ:Kt})}}lookupSymbolFeatures(e,n,s,h,_,x,T,I){const A={};this.loadVTLayers();const L=Ra(_);for(const N of e)this.loadMatchingFeature(A,{bucketIndex:s,sourceLayerIndex:h,featureIndex:N,layoutVertexArrayOffset:0},L,x,T,I,n);return A}loadFeature(e){const{featureIndex:n,sourceLayerIndex:s}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(s),_=this.vtFeatures[h];if(_[n])return _[n];const x=this.vtLayers[h].feature(n);return _[n]=x,x}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;if(this.promoteId){const h="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=h&&(s=e.properties[h]),"boolean"==typeof s&&(s=Number(s))}return s}}function Cg(t,e,n,s,h){return Ce(t,(_,x)=>{const T=e instanceof kn?e.get(x):null;return T&&T.evaluate?T.evaluate(n,s,h):T})}function X_(t,e){return e-t}Zn(J_,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Nf{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Ul({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const s=this.getKey(e,n);return this.positions[s]}trim(){const e=this.width,n=this.height=Mt(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,s){const h=[];let _=e.length%2==1?-e[e.length-1]*s:0,x=e[0]*s,T=!0;h.push({left:_,right:x,isDash:T,zeroLength:0===e[0]});let I=e[0];for(let A=1;A<e.length;A++){T=!T;const L=e[A];_=I*s,I+=L,x=I*s,h.push({left:_,right:x,isDash:T,zeroLength:0===L})}return h}addRoundDash(e,n,s){const h=n/2;for(let _=-s;_<=s;_++){const x=this.width*(this.nextRow+s+_);let T=0,I=e[T];for(let A=0;A<this.width;A++){A/I.right>1&&(I=e[++T]);const L=Math.abs(A-I.left),N=Math.abs(A-I.right),Z=Math.min(L,N);let J;const ee=_/s*(h+1);if(I.isDash){const pe=h-Math.abs(ee);J=Math.sqrt(Z*Z+pe*pe)}else J=h-Math.sqrt(Z*Z+ee*ee);this.image.data[x+A]=Math.max(0,Math.min(255,J+128))}}}addRegularDash(e,n){for(let I=e.length-1;I>=0;--I){const A=e[I],L=e[I+1];A.zeroLength?e.splice(I,1):L&&L.isDash===A.isDash&&(L.left=A.left,e.splice(I,1))}const s=e[0],h=e[e.length-1];s.isDash===h.isDash&&(s.left=h.left-this.width,h.right=s.right+this.width);const _=this.width*this.nextRow;let x=0,T=e[x];for(let I=0;I<this.width;I++){I/T.right>1&&(T=e[++x]);const A=Math.abs(I-T.left),L=Math.abs(I-T.right),N=Math.min(A,L);this.image.data[_+I]=Math.max(0,Math.min(255,(T.isDash?N:-N)+n+128))}}addDash(e,n){const s=this.getKey(e,n);if(this.positions[s])return this.positions[s];const h="round"===n,_=h?7:0,x=2*_+1;if(this.nextRow+x>this.height)return yn("LineAtlas out of space"),null;0===e.length&&e.push(1);let T=0;for(let L=0;L<e.length;L++)e[L]<0&&(yn("Negative value is found in line dasharray, replacing values with 0"),e[L]=0),T+=e[L];if(0!==T){const L=this.width/T,N=this.getDashRanges(e,this.width,L);h?this.addRoundDash(N,L,_):this.addRegularDash(N,"square"===n?.5*L:0)}const I=this.nextRow+_;this.nextRow+=x;const A={tl:[I,_],br:[T,0]};return this.positions[s]=A,A}}Zn(Nf,"LineAtlas");class Tg{constructor(e){const n={},s=[];for(const T in e){const I=e[T],A=n[T]={};for(const L in I.glyphs){const N=I.glyphs[+L];if(!N||0===N.bitmap.width||0===N.bitmap.height)continue;const Z=N.metrics.localGlyph?2:1,J={x:0,y:0,w:N.bitmap.width+2*Z,h:N.bitmap.height+2*Z};s.push(J),A[L]=J}}const{w:h,h:_}=nd(s),x=new Ul({width:h||1,height:_||1});for(const T in e){const I=e[T];for(const A in I.glyphs){const L=I.glyphs[+A];if(!L||0===L.bitmap.width||0===L.bitmap.height)continue;const N=n[T][A],Z=L.metrics.localGlyph?2:1;Ul.copy(L.bitmap,x,{x:0,y:0},{x:N.x+Z,y:N.y+Z},L.bitmap)}}this.image=x,this.positions=n}}Zn(Tg,"GlyphAtlas");class ns{constructor(e){this.tileID=new js(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Va(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,s,h,_){this.status="parsing",this.data=e,this.collisionBoxArray=new up;const x=new Wd(Object.keys(e.layers).sort()),T=new J_(this.tileID,this.promoteId);T.bucketLayerIDs=[];const I={},A=new Nf(256,256),L={featureIndex:T,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:A,availableImages:s},N=n.familiesBySource[this.source];for(const Ct in N){const mt=e.layers[Ct];if(!mt)continue;let Kt=!1,qt=!1;for(const an of N[Ct])"symbol"===an[0].type?Kt=!0:qt=!0;if(!0===this.isSymbolTile&&!Kt||!1===this.isSymbolTile&&!qt)continue;1===mt.version&&yn(`Vector tile source "${this.source}" layer "${Ct}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const mn=x.encode(Ct),Mn=[];for(let an=0;an<mt.length;an++){const _n=mt.feature(an),vn=T.getId(_n,Ct);Mn.push({feature:_n,id:vn,index:an,sourceLayerIndex:mn})}for(const an of N[Ct]){const _n=an[0];void 0!==this.isSymbolTile&&"symbol"===_n.type!==this.isSymbolTile||_n.minzoom&&this.zoom<Math.floor(_n.minzoom)||_n.maxzoom&&this.zoom>=_n.maxzoom||"none"!==_n.visibility&&(ip(an,this.zoom,s),(I[_n.id]=_n.createBucket({index:T.bucketLayerIDs.length,layers:an,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:mn,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(Mn,L,this.tileID.canonical,this.tileTransform),T.bucketLayerIDs.push(an.map(vn=>vn.id)))}}let Z,J,ee,pe;A.trim();const Pe={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Qe=Ce(L.glyphDependencies,Ct=>Object.keys(Ct).map(Number));Object.keys(Qe).length?h.send("getGlyphs",{uid:this.uid,stacks:Qe},(Ct,mt)=>{Z||(Z=Ct,J=mt,st.call(this))},void 0,!1,Pe):J={};const ut=Object.keys(L.iconDependencies);ut.length?h.send("getImages",{icons:ut,source:this.source,tileID:this.tileID,type:"icons"},(Ct,mt)=>{Z||(Z=Ct,ee=mt,st.call(this))},void 0,!1,Pe):ee={};const et=Object.keys(L.patternDependencies);function st(){if(Z)return _(Z);if(J&&ee&&pe){const Ct=new Tg(J),mt=new Lh(ee,pe);for(const Kt in I){const qt=I[Kt];qt instanceof cc?(ip(qt.layers,this.zoom,s),jh(qt,J,Ct.positions,ee,mt.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):qt.hasPattern&&(qt instanceof Sh||qt instanceof Id||qt instanceof Qu)&&(ip(qt.layers,this.zoom,s),qt.addFeatures(L,this.tileID.canonical,mt.patternPositions,s,this.tileTransform))}this.status="done",_(null,{buckets:vt(I).filter(Kt=>!Kt.isEmpty()),featureIndex:T,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ct.image,lineAtlas:A,imageAtlas:mt,glyphMap:this.returnDependencies?J:null,iconMap:this.returnDependencies?ee:null,glyphPositions:this.returnDependencies?Ct.positions:null})}}et.length?h.send("getImages",{icons:et,source:this.source,tileID:this.tileID,type:"patterns"},(Ct,mt)=>{Z||(Z=Ct,pe=mt,st.call(this))},void 0,!1,Pe):pe={},st.call(this)}}function ip(t,e,n){const s=new Ut(e);for(const h of t)h.recalculate(s,n)}class Eg{constructor(e){this.entries={},this.scheduler=e}request(e,n,s,h){const _=this.entries[e]=this.entries[e]||{callbacks:[]};if(_.result){const[x,T]=_.result;return this.scheduler?this.scheduler.add(()=>{h(x,T)},n):h(x,T),()=>{}}return _.callbacks.push(h),_.cancel||(_.cancel=s((x,T)=>{_.result=[x,T];for(const I of _.callbacks)this.scheduler?this.scheduler.add(()=>{I(x,T)},n):I(x,T);setTimeout(()=>delete this.entries[e],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(x=>x!==h),_.callbacks.length||(_.cancel(),delete this.entries[e]))}}}function Dg(t,e,n){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},h=>{const _=Qt(t.request,(x,T,I,A)=>{x?h(x):T&&h(null,{vectorTile:n?void 0:new El(new Ad(T)),rawData:T,cacheControl:I,expires:A})});return()=>{_.cancel(),h()}},e)}l.ARRAY_TYPE=Ta,l.AUTH_ERR_MSG=Ai,l.Aabb=Vs,l.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},it(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ot()?t:q,this.scheduler=new Y_}send(t,e,n,s,h=!1,_){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=_,this.callbacks[x]=n);const T=Kn(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:t,hasCallback:!!n,targetMapId:s,mustQueue:h,sourceMapId:this.mapId,data:ka(e,T)},T),{cancel:()=>{n&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[n];delete this.cancelCallbacks[n],s&&s.cancel()}else if(e.mustQueue||ot()){const s=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),s&&s.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if("<response>"===e.type){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(Ba(e.error)):n(null,Ba(e.data)))}else{const n=Kn(this.globalScope)?void 0:[],s=e.hasCallback?(_,x)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:_?ka(_):null,data:ka(x,n)},n)}:_=>{},h=Ba(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,h,s);else if(this.parent.getWorkerSource){const _=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,_[0],h.source)[_[1]](h,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.CanonicalTileID=Md,l.Color=lr,l.ColorMode=Os,l.CullFaceMode=$a,l.DEMData=Yd,l.DataConstantProperty=$t,l.DedupedRequest=Eg,l.DepthMode=xu,l.EXTENT=Di,l.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,s=1<<n,h=Math.floor(t.x),_=Math.floor((t.x-h)*s),x=Math.floor(t.y*s),T=this.findDEMTileFor(new js(n,h,n,_,x));return!(!T||!T.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const h=s.getSource().maxzoom,_=1<<h,x=Math.floor(t.x),T=t.x-x,I=new js(h,x,h,Math.floor(T*_),Math.floor(t.y*_)),A=this.findDEMTileFor(I);if(!A||!A.dem)return e;const L=A.dem,N=1<<A.tileID.canonical.z,Z=(T*N-A.tileID.canonical.x)*L.dim,J=(t.y*N-A.tileID.canonical.y)*L.dim,ee=Math.floor(Z),pe=Math.floor(J);return(n?this.exaggeration():1)*wi(wi(L.get(ee,pe),L.get(ee,pe+1),J-pe),wi(L.get(ee+1,pe),L.get(ee+1,pe+1),J-pe),Z-ee)}getAtTileOffset(t,e,n){const s=1<<t.canonical.z;return this.getAtPointOrZero(new tc(t.wrap+(t.canonical.x+e/Di)/s,(t.canonical.y+n/Di)/s))}getAtTileOffsetFunc(t,e,n,s){return h=>{const _=this.getAtTileOffset(t,h.x,h.y),x=s.upVector(t.canonical,h.x,h.y);return ol(x,x,_*s.upVectorScale(t.canonical,e,n).metersToTile),x}}getForTilePoints(t,e,n,s){if(this.isUsingMockSource())return!1;const h=Bf.create(this,t,s);return!!h&&(e.forEach(_=>{_[2]=this.exaggeration()*h.getElevationAt(_[0],_[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,s=e.tileID,h=1<<t.canonical.z-s.canonical.z;let _=t.canonical.x/h-s.canonical.x,x=t.canonical.y/h-s.canonical.y,T=0;for(let I=0;I<t.canonical.z-s.canonical.z&&!n.leaves[T];I++){_*=2,x*=2;const A=2*Math.floor(x)+Math.floor(_);T=n.childOffsets[T]+A,_%=1,x%=1}return{min:this.exaggeration()*n.minimums[T],max:this.exaggeration()*n.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},l.ErrorEvent=Tr,l.EvaluationParameters=Ut,l.Event=Gr,l.Evented=Or,l.FillExtrusionBucket=Qu,l.Frustum=gh,l.FrustumCorners=wd,l.GLOBE_METERS_TO_ECEF=Zh,l.GLOBE_RADIUS=ac,l.GLOBE_SCALE_MATCH_LATITUDE=45,l.GLOBE_ZOOM_THRESHOLD_MAX=6,l.GLOBE_ZOOM_THRESHOLD_MIN=5,l.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_createGrid(t){const e=new br,n=new es,s=65;for(let h=0;h<s;h++)for(let _=0;_<s;_++)e.emplaceBack(_,h);this._gridSegments=[];for(let h=0,_=0;h<od.length;h++){const x=od[h];for(let I=0;I<x;I++)for(let A=0;A<64;A++){const L=I*s+A;n.emplaceBack(L+1,L,L+s),n.emplaceBack(L+s,L+s+1,L+1)}const T=64*x*2;this._gridSegments.push(Ao.simpleSegment(0,_,(x+1)*s,T)),_+=T}this._gridBuffer=t.createVertexBuffer(e,sc.members),this._gridIndexBuffer=t.createIndexBuffer(n,!0)}_createPoles(t){const e=new es;for(let h=0;h<=64;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new Gc,s=new Gc;this._poleSegments=[];for(let h=0,_=0;h<5;h++){const x=360/(1<<h);n.emplaceBack(0,-ac,0,.5,0),s.emplaceBack(0,-ac,0,.5,1);for(let T=0;T<=64;T++){const I=T/64,A=wi(0,x,I),[L,N,Z]=sd(Uy,hg,A,ac);n.emplaceBack(L,N,Z,I,0),s.emplaceBack(L,N,Z,I,1)}this._poleSegments.push(Ao.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,Ld,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,Ld,!1)}getGridBuffers(t){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[t]]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const n=new Na,s=64,h=s+1;this._wireframeSegments=[];for(let _=0,x=0;_<od.length;_++){const T=od[_];for(let A=0;A<T;A++)for(let L=0;L<s;L++){const N=A*h+L;n.emplaceBack(N,N+1),n.emplaceBack(N,N+h),n.emplaceBack(N,N+h+1)}const I=T*s*3;this._wireframeSegments.push(Ao.simpleSegment(0,x,(T+1)*h,I)),x+=I}this._wireframeIndexBuffer=t.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},l.GlyphManager=id,l.ImagePosition=Rh,l.LivePerformanceUtils=dt,l.LngLat=ar,l.LngLatBounds=Ql,l.LocalGlyphMode=hf,l.MAX_MERCATOR_LATITUDE=rl,l.MercatorCoordinate=tc,l.ONE_EM=24,l.OverscaledTileID=js,l.PerformanceMarkers=De,l.Properties=hi,l.RGBAImage=sa,l.Ray=kp,l.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",le,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!fr(t))return t;const n=Pt(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!fr(t))return t;const n=Pt(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,s){if(!fr(t))return t;const h=Pt(t);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),n&&h.params.push(`language=${n}`),s&&h.params.push(`worldview=${s}`),this._makeAPIURL(h,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,s){const h=Pt(t);return fr(t)?(h.path=`/styles/v1${h.path}/sprite${e}${n}`,this._makeAPIURL(h,this._customAccessToken||s)):(h.path+=`${e}${n}`,gn(h))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!fr(t))return t;const s=Pt(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&"raster"!==s.authority&&512===n?"@2x":""}${Me.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${he.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${he.TILE_URL_VERSION}${s.path}`);const h=this._customAccessToken||function(_){for(const x of _){const T=x.match(/^access_token=(.*)$/);if(T)return T[1]}return null}(s.params)||he.ACCESS_TOKEN;return he.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,h)}canonicalizeTileURL(t,e){const n=Pt(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let s="mapbox://";n.path.match(/^\/raster\/v1\//)?s+=`raster/${n.path.replace(`/${he.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${n.path.replace(`/${he.TILE_URL_VERSION}/`,"")}`;let h=n.params;return e&&(h=h.filter(_=>!_.match(/^access_token=/))),h.length&&(s+=`?${h.join("&")}`),s}canonicalizeTileset(t,e){const n=!!e&&fr(e),s=[];for(const h of t.tiles||[])wr(h)?s.push(this.canonicalizeTileURL(h,n)):s.push(h);return s}_makeAPIURL(t,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Pt(he.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,"http"===t.protocol){const h=t.params.indexOf("secure");h>=0&&t.params.splice(h,1)}if("/"!==s.path&&(t.path=`${s.path}${t.path}`),!he.REQUIRE_ACCESS_TOKEN)return gn(t);if(e=e||he.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(h=>-1===h.indexOf("access_token")),t.params.push(`access_token=${e||""}`),gn(t)}},l.ResourceType=He,l.SegmentVector=Ao,l.SourceCache=Za,l.StencilMode=hd,l.StructArrayLayout1ui2=Hc,l.StructArrayLayout2f1f2i16=fs,l.StructArrayLayout2i4=br,l.StructArrayLayout2ui4=Na,l.StructArrayLayout3f12=el,l.StructArrayLayout3ui6=es,l.StructArrayLayout4i8=Lr,l.StructArrayLayout5f20=Gc,l.Texture=Lc,l.Tile=Kh,l.Transitionable=fn,l.Uniform1f=ih,l.Uniform1i=class extends wl{constructor(t){super(t),this.current=0}set(t,e,n){this.fetchUniformLocation(t,e)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},l.Uniform2f=class extends wl{constructor(t){super(t),this.current=[0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},l.Uniform3f=class extends wl{constructor(t){super(t),this.current=[0,0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},l.Uniform4f=Bu,l.UniformColor=om,l.UniformMatrix2f=class extends wl{constructor(t){super(t),this.current=_p}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<4;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},l.UniformMatrix3f=class extends wl{constructor(t){super(t),this.current=gp}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<9;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},l.UniformMatrix4f=class extends wl{constructor(t){super(t),this.current=Wg}set(t,e,n){if(this.fetchUniformLocation(t,e)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let s=1;s<16;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},l.UnwrappedTileID=Fm,l.ValidationError=$n,l.VectorTileFeature=Dh,l.VectorTileWorkerSource=class extends Or{constructor(t,e,n,s,h){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=h||Dg,this.loading={},this.loaded={},this.deduped=new Eg(t.scheduler),this.isSpriteLoaded=s,this.scheduler=t.scheduler}loadTile(t,e){const n=t.uid,s=t&&t.request,h=s&&s.collectResourceTiming,_=this.loading[n]=new ns(t);_.abort=this.loadVectorData(t,(x,T)=>{const I=!this.loading[n];if(delete this.loading[n],I||x||!T)return _.status="done",I||(this.loaded[n]=_),e(x);const A=T.rawData,L={};T.expires&&(L.expires=T.expires),T.cacheControl&&(L.cacheControl=T.cacheControl),_.vectorTile=T.vectorTile||new El(new Ad(A));const N=()=>{_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,(Z,J)=>{if(Z||!J)return e(Z);const ee={};if(h){const pe=Dn(s);pe.length>0&&(ee.resourceTiming=JSON.parse(JSON.stringify(pe)))}e(null,Tt({rawTileData:A.slice(0)},J,L,ee))})};this.isSpriteLoaded?N():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(N,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):N()}),this.loaded=this.loaded||{},this.loaded[n]=_})}reloadTile(t,e){const n=this.loaded,s=t.uid,h=this;if(n&&n[s]){const _=n[s];_.showCollisionBoxes=t.showCollisionBoxes,_.enableTerrain=!!t.enableTerrain,_.projection=t.projection,_.tileTransform=Va(t.tileID.canonical,t.projection);const x=(T,I)=>{const A=_.reloadCallback;A&&(delete _.reloadCallback,_.parse(_.vectorTile,h.layerIndex,this.availableImages,h.actor,A)),e(T,I)};"parsing"===_.status?_.reloadCallback=x:"done"===_.status&&(_.vectorTile?_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,x):x())}}abortTile(t,e){const n=t.uid,s=this.loading[n];s&&(s.abort&&s.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,s=t.uid;n&&n[s]&&delete n[s],e()}},l.WritingMode=aa,l.add=Ps,l.addDynamicAttributes=Gd,l.adjoint=function(t,e){var n=e[0],s=e[1],h=e[2],_=e[3],x=e[4],T=e[5],I=e[6],A=e[7],L=e[8];return t[0]=x*L-T*A,t[1]=h*A-s*L,t[2]=s*T-h*x,t[3]=T*I-_*L,t[4]=n*L-h*I,t[5]=h*_-n*T,t[6]=_*A-x*I,t[7]=s*I-n*A,t[8]=n*x-s*_,t},l.asyncAll=Ee,l.bezier=Xe,l.bindAll=it,l.boundsAttributes=Mf,l.bufferConvexPolygon=function(t,e){const n=[];for(let s=0;s<t.length;s++){const h=oe(s-1,-1,t.length-1),_=oe(s+1,-1,t.length-1),x=t[s],T=t[_],I=t[h].sub(x).unit(),A=T.sub(x).unit(),L=A.angleWithSep(I.x,I.y),N=I.add(A).unit().mult(-1*e/Math.sin(L/2));n.push(x.add(N))}return n},l.cacheEntryPossiblyAdded=function(t){It++,It>Si&&(t.getActor().send("enforceCacheSizeLimit",Li),It=0)},l.calculateGlobeLabelMatrix=function(t,e){const{x:n,y:s}=t.point,h=ug(n,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Kc(h,h,xf($l(e)))},l.calculateGlobeMatrix=function(t){const{x:e,y:n}=t.point,{lng:s,lat:h}=t._center;return ug(e,n,t.worldSize,s,h)},l.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,n=e/il(1,t.center.lat),s=ms(new Float64Array(16));return ph(s,s,[t.point.x,t.point.y,0]),Vu(s,s,[n,n,e]),Float32Array.from(s)},l.circumferenceAtLatitude=bp,l.clamp=ge,l.clearTileCache=function(t){if(!Fi())return;const e=q.caches.delete(pi);t&&e.catch(t).then(()=>t())},l.clipLine=tg,l.clone=function(t){var e=new Ta(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},l.clone$1=kt,l.collisionCircleLayout=By,l.config=he,l.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},l.create=function(){var t=new Ta(16);return Ta!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},l.create$1=cm,l.createExpression=$i,l.createLayout=Xn,l.createStyleLayer=function(t){return"custom"===t.type?new Tf(t):new Yh[t.type](t)},l.cross=bd,l.degToRad=_e,l.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},l.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},l.dot=Ea,l.earthRadius=Bl,l.ease=We,l.easeCubicInOut=we,l.ecefToLatLng=function([t,e,n]){const s=Math.hypot(t,e,n),h=Math.atan2(t,n),_=.5*Math.PI-Math.acos(-e/s);return new ar(ke(h),ke(_))},l.emitValidationErrors=Uc,l.endsWith=at,l.enforceCacheSizeLimit=function(t){Yi(),bi&&bi.then(e=>{e.keys().then(n=>{for(let s=0;s<n.length-t;s++)e.delete(n[s])})})},l.evaluateSizeForFeature=Ah,l.evaluateSizeForZoom=Il,l.evaluateVariableOffset=Vh,l.evented=xt,l.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},l.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},l.exported=Hn,l.exported$1=Me,l.extend=Tt,l.extend$1=no,l.fillExtrusionHeightLift=qp,l.filterObject=bt,l.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},l.fromQuat=function(t,e){var n=e[0],s=e[1],h=e[2],_=e[3],x=n+n,T=s+s,I=h+h,A=n*x,L=s*x,N=s*T,Z=h*x,J=h*T,ee=h*I,pe=_*x,Pe=_*T,Qe=_*I;return t[0]=1-N-ee,t[1]=L+Qe,t[2]=Z-Pe,t[3]=0,t[4]=L-Qe,t[5]=1-A-ee,t[6]=J+pe,t[7]=0,t[8]=Z+Pe,t[9]=J-pe,t[10]=1-A-N,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=0,t[3]=-n,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},l.fromScaling=n_,l.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return Ne[e]},l.getAABBPointSquareDist=function(t,e,n){let s=0;for(let h=0;h<2;++h){const _=n?n[h]:0;t[h]>_&&(s+=(t[h]-_)*(t[h]-_)),e[h]<_&&(s+=(_-e[h])*(_-e[h]))}return s},l.getAnchorAlignment=uf,l.getAnchorJustification=sg,l.getBounds=function(t){let e=1/0,n=1/0,s=-1/0,h=-1/0;for(const _ of t)e=Math.min(e,_.x),n=Math.min(n,_.y),s=Math.max(s,_.x),h=Math.max(h,_.y);return{min:new Q(e,n),max:new Q(s,h)}},l.getColumn=Bn,l.getGridMatrix=function(t,e,n,s){const h=e.getNorth(),_=e.getSouth(),x=e.getWest(),T=e.getEast(),I=1<<t.z,A=T-x,L=h-_,N=A/64,Z=-L/od[n],J=[0,N,0,Z,0,0,h,x,0];if(t.z>0){const ee=180/s;um(J,J,[ee/A+1,0,0,0,ee/L+1,0,-.5*ee/N,.5*ee/Z,1])}return J[2]=I,J[5]=t.x,J[8]=t.y,J},l.getImage=yr,l.getJSON=function(t,e){return jt(Tt(t,{type:"json"}),e)},l.getLatitudinalLod=function(t){const e=80.051129;t=ge(t,-80.051129,e)/e*90;const n=Math.pow(Math.abs(Math.sin(_e(t))),3);return Math.round(n*(od.length-1))},l.getMapSessionAPI=ye,l.getPerformanceMeasurement=Dn,l.getProjection=vu,l.getRTLTextPluginStatus=Lt,l.getReferrer=Je,l.getTilePoint=function(t,{x:e,y:n},s=0){return new Q(((e-s)*t.scale-t.x)*Di,(n*t.scale-t.y)*Di)},l.getTileVec3=function(t,e,n=0){return Sc(((e.x-n)*t.scale-t.x)*Di,(e.y*t.scale-t.y)*Di,wp(e.z,e.y))},l.getVideo=function(t,e){const n=q.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<t.length;s++){const h=q.document.createElement("source");li(t[s])||(n.crossOrigin="Anonymous"),h.src=t[s],n.appendChild(h)}return{cancel:()=>{}}},l.globeCenterToScreenPoint=function(t){const e=[0,0,0],n=ms(new Float64Array(16));return Kc(n,t.pixelMatrix,t.globeMatrix),Eo(e,e,n),new Q(e[0],e[1])},l.globeDenormalizeECEF=xf,l.globeECEFOrigin=function(t,e){const n=[0,0,0];return Eo(n,n,zd($l(e.canonical))),Eo(n,n,t),n},l.globeNormalizeECEF=zd,l.globePixelsToTileUnits=function(t,e){return Di/(512*Math.pow(2,t))*Gh($l(e))},l.globePoleMatrixForTile=function(t,e,n){const s=ms(new Float64Array(16)),h=(e/(1<<t)-.5)*Math.PI*2;return Pp(s,n.globeMatrix,h),Float32Array.from(s)},l.globeTileBounds=$l,l.globeTiltAtLngLat=bf,l.globeToMercatorTransition=ad,l.globeUseCustomAntiAliasing=function(t,e,n){const s=ad(n.zoom),h=t.style.map._antialias,_=!!e.extStandardDerivatives,x=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===s&&!h&&!x&&_},l.identity=ms,l.identity$1=mh,l.invert=Xc,l.isFullscreen=function(){return!!q.document.fullscreenElement||!!q.document.webkitFullscreenElement},l.isLngLatBehindGlobe=Hh,l.isMapAuthenticated=function(t){return be.has(t)},l.isMapboxURL=fr,l.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Kn(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},l.latFromMercatorY=ts,l.latLngToECEF=hu,l.len=s_,l.length=xd,l.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},l.lngFromMercatorX=Ca,l.loadVectorTile=Dg,l.makeRequest=jt,l.mapValue=function(t,e,n,s,h){return ge((t-e)/(n-e)*(h-s)+s,s,h)},l.mercatorScale=Cp,l.mercatorXfromLng=ec,l.mercatorYfromLat=za,l.mercatorZfromAltitude=il,l.mul=i_,l.mul$1=o_,l.multiply=Kc,l.multiply$1=um,l.multiply$2=Lp,l.nextPowerOfTwo=Mt,l.normalize=oa,l.normalize$1=a_,l.normalize$2=Fp,l.number=wi,l.ortho=function(t,e,n,s,h,_,x){var T=1/(e-n),I=1/(s-h),A=1/(_-x);return t[0]=-2*T,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*I,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*A,t[11]=0,t[12]=(e+n)*T,t[13]=(h+s)*I,t[14]=(x+_)*A,t[15]=1,t},l.pbf=Ad,l.perspective=function(t,e,n,s,h){var _,x=1/Math.tan(e/2);return t[0]=x/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=h&&h!==1/0?(t[10]=(h+s)*(_=1/(s-h)),t[14]=2*h*s*_):(t[10]=-1,t[14]=-2*s),t},l.pick=function(t,e){const n={};for(let s=0;s<e.length;s++){const h=e[s];h in t&&(n[h]=t[h])}return n},l.plugin=Wt,l.pointGeometry=Q,l.polesInViewport=function(t){const e=ms(new Float64Array(16));Kc(e,t.pixelMatrix,t.globeMatrix);const n=[0,al,0],s=[0,$s,0];return Eo(n,n,e),Eo(s,s,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Hh(t,new ar(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!Hh(t,new ar(t.center.lat,-90))]},l.polygonContainsPoint=Jc,l.polygonIntersectsBox=Mp,l.polygonIntersectsPolygon=Dp,l.polygonizeBounds=function(t,e,n=0,s=!0){const h=new Q(n,n),_=t.sub(h),x=e.add(h),T=[_,new Q(x.x,_.y),x,new Q(_.x,x.y)];return s&&T.push(_.clone()),T},l.posAttributes=sc,l.postMapLoadEvent=Be,l.postPerformanceEvent=Rt,l.postTurnstileEvent=z,l.potpack=nd,l.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},l.radToDeg=ke,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.registerForPluginStateChange=function(t){return t({pluginStatus:qe,pluginURL:Ze}),xt.on("pluginStateChange",t),t},l.removeAuthState=function(t){be.delete(t)},l.renderColorRamp=Bp,l.resample=Tp,l.rotateX=dm,l.rotateX$1=mm,l.rotateY=Pp,l.rotateY$1=Bo,l.rotateZ=function(t,e,n){var s=Math.sin(n),h=Math.cos(n),_=e[0],x=e[1],T=e[2],I=e[3],A=e[4],L=e[5],N=e[6],Z=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=_*h+A*s,t[1]=x*h+L*s,t[2]=T*h+N*s,t[3]=I*h+Z*s,t[4]=A*h-_*s,t[5]=L*h-x*s,t[6]=N*h-T*s,t[7]=Z*h-I*s,t},l.rotateZ$1=function(t,e,n){n*=.5;var s=e[0],h=e[1],_=e[2],x=e[3],T=Math.sin(n),I=Math.cos(n);return t[0]=s*I+h*T,t[1]=h*I-s*T,t[2]=_*I+x*T,t[3]=x*I-_*T,t},l.scale=Vu,l.scale$1=pm,l.scale$2=ol,l.scaleAndAdd=fh,l.set=function(t,e,n,s){return t[0]=e,t[1]=n,t[2]=s,t},l.setCacheLimits=function(t,e){Li=t,Si=e},l.setColumn=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},l.setRTLTextPlugin=function(t,e,n=!1){if(qe===Re||qe===je||qe===Le)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ze=Hn.resolveURL(t),qe=Re,Fe=e,_t(),n||en()},l.smoothstep=de,l.spec=Xt,l.squaredLength=function(t){var e=t[0],n=t[1],s=t[2];return e*e+n*n+s*s},l.storeAuthState=function(t,e){e?be.add(t):be.delete(t)},l.sub=Tl,l.subtract=Qc,l.symbolSize=R_,l.tileAABB=function(t,e,n,s,h,_,x,T,I){if("globe"===I.name)return function H_(t,e,n){const s=e/t.worldSize,h=t.globeMatrix;if(n.z<=1){const qt=$l(n).getCorners();return lg(qt,h,s),Vs.fromPoints(qt)}const _=kd(n),x=Bd(_);lg(x,h,s);const T=Number.MAX_VALUE,I=[-T,-T,-T],A=[T,T,T];if(_.contains(t.center)){for(const Mn of x)ju(A,A,Mn),$u(I,I,Mn);I[2]=0;const qt=t.point,mn=[qt.x*s,qt.y*s,0];return ju(A,A,mn),$u(I,I,mn),new Vs(A,I)}const L=[h[12]*s,h[13]*s,h[14]*s],N=_.getCenter(),Z=ge(t.center.lat,-85.051129,rl),J=ge(N.lat,-85.051129,rl),ee=ec(t.center.lng),pe=za(Z);let Pe=ee-ec(N.lng);const Qe=pe-za(J);Pe>.5?Pe-=1:Pe<-.5&&(Pe+=1);let ut=0;Math.abs(Pe)>Math.abs(Qe)?ut=Pe>=0?1:3:(ut=Qe>=0?0:2,fh(L,L,[h[4]*s,h[5]*s,h[6]*s],-Math.sin(_e(Qe>=0?_.getSouth():_.getNorth()))*ac));const et=x[ut],st=x[(ut+1)%4],Ct=new G_(et,st,L),mt=[vf(Ct,0)||et[0],vf(Ct,1)||et[1],vf(Ct,2)||et[2]],Kt=ad(t.zoom);if(Kt>0){const qt=function({x:Mn,y:an,z:_n},vn,In,On,sn){const Gn=1/(1<<_n);let gi=Mn*Gn,qn=gi+Gn,ei=an*Gn,jn=ei+Gn,_i=0;const Ji=(gi+qn)/2-On;return Ji>.5?_i=-1:Ji<-.5&&(_i=1),gi=((gi+_i)*vn-(On*=vn))*In+On,qn=((qn+_i)*vn-On)*In+On,ei=(ei*vn-(sn*=vn))*In+sn,jn=(jn*vn-sn)*In+sn,[[gi,jn,0],[qn,jn,0],[qn,ei,0],[gi,ei,0]]}(n,e,t._pixelsPerMercatorPixel,ee,pe);for(let Mn=0;Mn<x.length;Mn++)du(x[Mn],qt[Mn],Kt);const mn=Ps([],qt[ut],qt[(ut+1)%4]);ol(mn,mn,.5),du(mt,mn,Kt)}for(const qt of x)ju(A,A,qt),$u(I,I,qt);return A[2]=Math.min(et[2],st[2]),ju(A,A,mt),$u(I,I,mt),new Vs(A,I)}(t,e,new Md(n,s,h));const A=Va({z:n,x:s,y:h},I);return new Vs([(_+A.x/A.scale)*e,e*(A.y/A.scale),x],[(_+A.x2/A.scale)*e,e*(A.y2/A.scale),T])},l.tileCornersToBounds=kd,l.tileTransform=Va,l.transformMat3=function(t,e,n){var s=e[0],h=e[1],_=e[2];return t[0]=s*n[0]+h*n[3]+_*n[6],t[1]=s*n[1]+h*n[4]+_*n[7],t[2]=s*n[2]+h*n[5]+_*n[8],t},l.transformMat4=Eo,l.transformMat4$1=zl,l.transformQuat=r_,l.transitionTileAABBinECEF=ag,l.translate=ph,l.transpose=function(t,e){if(t===e){var n=e[1],s=e[2],h=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=s,t[7]=h}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},l.triggerPluginCompletionEvent=rt,l.uniqueId=Ot,l.updateGlobeVertexNormal=function(t,e,n,s,h){const _=5*e+2;t.float32[_+0]=n,t.float32[_+1]=s,t.float32[_+2]=h},l.validateCustomStyleLayer=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:`layers.${n}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},l.validateFilter=t=>Is(Xa(t)),l.validateFog=t=>Is(ea(t)),l.validateLayer=t=>Is(Xl(t)),l.validateLight=t=>Is(Qo(t)),l.validateSource=t=>Is(Bc(t)),l.validateStyle=bl,l.validateTerrain=t=>Is(xl(t)),l.values=vt,l.vectorTile=Ju,l.version=re,l.warnOnce=yn,l.window=q,l.wrap=oe}),y(0,function(l){function q(se){if("number"==typeof se||"boolean"==typeof se||"string"==typeof se||null==se)return JSON.stringify(se);if(Array.isArray(se)){let z="[";for(const ce of se)z+=`${q(ce)},`;return`${z}]`}let R="{";for(const z of Object.keys(se).sort())R+=`${z}:${q(se[z])},`;return`${R}}`}function re(se){let R="";for(const z of l.refProperties)R+=`/${q(se[z])}`;return R}class b{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,z){for(const Be of R)this._layerConfigs[Be.id]=Be,(this._layers[Be.id]=l.createStyleLayer(Be)).compileFilter(),this.keyCache[Be.id]&&delete this.keyCache[Be.id];for(const Be of z)delete this.keyCache[Be],delete this._layerConfigs[Be],delete this._layers[Be];this.familiesBySource={};const ce=function(Be,tt){const Rt={};for(let ye=0;ye<Be.length;ye++){const be=tt&&tt[Be[ye].id]||re(Be[ye]);tt&&(tt[Be[ye].id]=be);let De=Rt[be];De||(De=Rt[be]=[]),De.push(Be[ye])}const At=[];for(const ye in Rt)At.push(Rt[ye]);return At}(l.values(this._layerConfigs),this.keyCache);for(const Be of ce){const tt=Be.map(dt=>this._layers[dt.id]),Rt=tt[0];if("none"===Rt.visibility)continue;const At=Rt.source||"";let ye=this.familiesBySource[At];ye||(ye=this.familiesBySource[At]={});const be=Rt.sourceLayer||"_geojsonTileLayer";let De=ye[be];De||(De=ye[be]=[]),De.push(tt)}}}class he{loadTile(R,z){const{uid:ce,encoding:Be,rawImageData:tt,padding:Rt,buildQuadTree:At}=R,ye=l.window.ImageBitmap&&tt instanceof l.window.ImageBitmap?this.getImageData(tt,Rt):tt;z(null,new l.DEMData(ce,ye,Be,Rt<1,At))}getImageData(R,z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(R.width,R.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=R.width,this.offscreenCanvas.height=R.height,this.offscreenCanvasContext.drawImage(R,0,0,R.width,R.height);const ce=this.offscreenCanvasContext.getImageData(-z,-z,R.width+2*z,R.height+2*z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}var Me=function se(R,z){var ce,Be=R&&R.type;if("FeatureCollection"===Be)for(ce=0;ce<R.features.length;ce++)se(R.features[ce],z);else if("GeometryCollection"===Be)for(ce=0;ce<R.geometries.length;ce++)se(R.geometries[ce],z);else if("Feature"===Be)se(R.geometry,z);else if("Polygon"===Be)Ve(R.coordinates,z);else if("MultiPolygon"===Be)for(ce=0;ce<R.coordinates.length;ce++)Ve(R.coordinates[ce],z);return R};function Ve(se,R){if(0!==se.length){X(se[0],R);for(var z=1;z<se.length;z++)X(se[z],!R)}}function X(se,R){for(var z=0,ce=0,Be=0,tt=se.length,Rt=tt-1;Be<tt;Rt=Be++){var At=(se[Be][0]-se[Rt][0])*(se[Rt][1]+se[Be][1]),ye=z+At;ce+=Math.abs(z)>=Math.abs(At)?z-ye+At:At-ye+z,z=ye}z+ce>=0!=!!R&&se.reverse()}const xe=l.VectorTileFeature.prototype.toGeoJSON;class fe{constructor(R){this._feature=R,this.extent=l.EXTENT,this.type=R.type,this.properties=R.tags,"id"in R&&!isNaN(R.id)&&(this.id=parseInt(R.id,10))}loadGeometry(){if(1===this._feature.type){const R=[];for(const z of this._feature.geometry)R.push([new l.pointGeometry(z[0],z[1])]);return R}{const R=[];for(const z of this._feature.geometry){const ce=[];for(const Be of z)ce.push(new l.pointGeometry(Be[0],Be[1]));R.push(ce)}return R}}toGeoJSON(R,z,ce){return xe.call(this,R,z,ce)}}class ze{constructor(R){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=R.length,this._features=R}feature(R){return new fe(this._features[R])}}var le={exports:{}},Ke=l.pointGeometry,Oe=l.vectorTile.VectorTileFeature,Q=Ye;function Ye(se,R){this.options=R||{},this.features=se,this.length=se.length}function St(se,R){this.id="number"==typeof se.id?se.id:void 0,this.type=se.type,this.rawGeometry=1===se.type?[se.geometry]:se.geometry,this.properties=se.tags,this.extent=R||4096}Ye.prototype.feature=function(se){return new St(this.features[se],this.options.extent)},St.prototype.loadGeometry=function(){var se=this.rawGeometry;this.geometry=[];for(var R=0;R<se.length;R++){for(var z=se[R],ce=[],Be=0;Be<z.length;Be++)ce.push(new Ke(z[Be][0],z[Be][1]));this.geometry.push(ce)}return this.geometry},St.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var se=this.geometry,R=1/0,z=-1/0,ce=1/0,Be=-1/0,tt=0;tt<se.length;tt++)for(var Rt=se[tt],At=0;At<Rt.length;At++){var ye=Rt[At];R=Math.min(R,ye.x),z=Math.max(z,ye.x),ce=Math.min(ce,ye.y),Be=Math.max(Be,ye.y)}return[R,ce,z,Be]},St.prototype.toGeoJSON=Oe.prototype.toGeoJSON;var lt=l.pbf,_e=Q;function ke(se){var R=new lt;return function(z,ce){for(var Be in z.layers)ce.writeMessage(3,Ne,z.layers[Be])}(se,R),R.finish()}function Ne(se,R){var z;R.writeVarintField(15,se.version||1),R.writeStringField(1,se.name||""),R.writeVarintField(5,se.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for(z=0;z<se.length;z++)ce.feature=se.feature(z),R.writeMessage(2,we,ce);var Be=ce.keys;for(z=0;z<Be.length;z++)R.writeStringField(3,Be[z]);var tt=ce.values;for(z=0;z<tt.length;z++)R.writeMessage(4,oe,tt[z])}function we(se,R){var z=se.feature;void 0!==z.id&&R.writeVarintField(1,z.id),R.writeMessage(2,Xe,se),R.writeVarintField(3,z.type),R.writeMessage(4,de,z)}function Xe(se,R){var z=se.feature,ce=se.keys,Be=se.values,tt=se.keycache,Rt=se.valuecache;for(var At in z.properties){var ye=z.properties[At],be=tt[At];if(null!==ye){void 0===be&&(ce.push(At),tt[At]=be=ce.length-1),R.writeVarint(be);var De=typeof ye;"string"!==De&&"boolean"!==De&&"number"!==De&&(ye=JSON.stringify(ye));var dt=De+":"+ye,pt=Rt[dt];void 0===pt&&(Be.push(ye),Rt[dt]=pt=Be.length-1),R.writeVarint(pt)}}}function We(se,R){return(R<<3)+(7&se)}function ge(se){return se<<1^se>>31}function de(se,R){for(var z=se.loadGeometry(),ce=se.type,Be=0,tt=0,Rt=z.length,At=0;At<Rt;At++){var ye=z[At],be=1;1===ce&&(be=ye.length),R.writeVarint(We(1,be));for(var De=3===ce?ye.length-1:ye.length,dt=0;dt<De;dt++){1===dt&&1!==ce&&R.writeVarint(We(2,De-1));var pt=ye[dt].x-Be,on=ye[dt].y-tt;R.writeVarint(ge(pt)),R.writeVarint(ge(on)),Be+=pt,tt+=on}3===ce&&R.writeVarint(We(7,1))}}function oe(se,R){var z=typeof se;"string"===z?R.writeStringField(1,se):"boolean"===z?R.writeBooleanField(7,se):"number"===z&&(se%1!=0?R.writeDoubleField(3,se):se<0?R.writeSVarintField(6,se):R.writeVarintField(5,se))}function Ee(se,R,z,ce,Be,tt){if(Be-ce<=z)return;const Rt=ce+Be>>1;vt(se,R,Rt,ce,Be,tt%2),Ee(se,R,z,ce,Rt-1,tt+1),Ee(se,R,z,Rt+1,Be,tt+1)}function vt(se,R,z,ce,Be,tt){for(;Be>ce;){if(Be-ce>600){const be=Be-ce+1,De=z-ce+1,dt=Math.log(be),pt=.5*Math.exp(2*dt/3),on=.5*Math.sqrt(dt*pt*(be-pt)/be)*(De-be/2<0?-1:1);vt(se,R,z,Math.max(ce,Math.floor(z-De*pt/be+on)),Math.min(Be,Math.floor(z+(be-De)*pt/be+on)),tt)}const Rt=R[2*z+tt];let At=ce,ye=Be;for(Tt(se,R,ce,z),R[2*Be+tt]>Rt&&Tt(se,R,ce,Be);At<ye;){for(Tt(se,R,At,ye),At++,ye--;R[2*At+tt]<Rt;)At++;for(;R[2*ye+tt]>Rt;)ye--}R[2*ce+tt]===Rt?Tt(se,R,ce,ye):(ye++,Tt(se,R,ye,Be)),ye<=z&&(ce=ye+1),z<=ye&&(Be=ye-1)}}function Tt(se,R,z,ce){Gt(se,z,ce),Gt(R,2*z,2*ce),Gt(R,2*z+1,2*ce+1)}function Gt(se,R,z){const ce=se[R];se[R]=se[z],se[z]=ce}function Ot(se,R,z,ce){const Be=se-z,tt=R-ce;return Be*Be+tt*tt}le.exports=ke,le.exports.fromVectorTileJs=ke,le.exports.fromGeojsonVt=function(se,R){R=R||{};var z={};for(var ce in se)z[ce]=new _e(se[ce].features,R),z[ce].name=ce,z[ce].version=R.version,z[ce].extent=R.extent;return ke({layers:z})},le.exports.GeoJSONWrapper=_e;const yt=se=>se[0],Mt=se=>se[1];class gt{constructor(R,z=yt,ce=Mt,Be=64,tt=Float64Array){this.nodeSize=Be,this.points=R;const Rt=R.length<65536?Uint16Array:Uint32Array,At=this.ids=new Rt(R.length),ye=this.coords=new tt(2*R.length);for(let be=0;be<R.length;be++)At[be]=be,ye[2*be]=z(R[be]),ye[2*be+1]=ce(R[be]);Ee(At,ye,Be,0,At.length-1,0)}range(R,z,ce,Be){return function(tt,Rt,At,ye,be,De,dt){const pt=[0,tt.length-1,0],on=[];let Dn,Nn;for(;pt.length;){const Wn=pt.pop(),Ei=pt.pop(),di=pt.pop();if(Ei-di<=dt){for(let ki=di;ki<=Ei;ki++)Dn=Rt[2*ki],Nn=Rt[2*ki+1],Dn>=At&&Dn<=be&&Nn>=ye&&Nn<=De&&on.push(tt[ki]);continue}const Hn=Math.floor((di+Ei)/2);Dn=Rt[2*Hn],Nn=Rt[2*Hn+1],Dn>=At&&Dn<=be&&Nn>=ye&&Nn<=De&&on.push(tt[Hn]);const Vi=(Wn+1)%2;(0===Wn?At<=Dn:ye<=Nn)&&(pt.push(di),pt.push(Hn-1),pt.push(Vi)),(0===Wn?be>=Dn:De>=Nn)&&(pt.push(Hn+1),pt.push(Ei),pt.push(Vi))}return on}(this.ids,this.coords,R,z,ce,Be,this.nodeSize)}within(R,z,ce){return function(Be,tt,Rt,At,ye,be){const De=[0,Be.length-1,0],dt=[],pt=ye*ye;for(;De.length;){const on=De.pop(),Dn=De.pop(),Nn=De.pop();if(Dn-Nn<=be){for(let Vi=Nn;Vi<=Dn;Vi++)Ot(tt[2*Vi],tt[2*Vi+1],Rt,At)<=pt&&dt.push(Be[Vi]);continue}const Wn=Math.floor((Nn+Dn)/2),Ei=tt[2*Wn],di=tt[2*Wn+1];Ot(Ei,di,Rt,At)<=pt&&dt.push(Be[Wn]);const Hn=(on+1)%2;(0===on?Rt-ye<=Ei:At-ye<=di)&&(De.push(Nn),De.push(Wn-1),De.push(Hn)),(0===on?Rt+ye>=Ei:At+ye>=di)&&(De.push(Wn+1),De.push(Dn),De.push(Hn))}return dt}(this.ids,this.coords,R,z,ce,this.nodeSize)}}const it={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:se=>se},at=Math.fround||(Ce=new Float32Array(1),se=>(Ce[0]=+se,Ce[0]));var Ce;class bt{constructor(R){this.options=bn(Object.create(it),R),this.trees=new Array(this.options.maxZoom+1)}load(R){const{log:z,minZoom:ce,maxZoom:Be,nodeSize:tt}=this.options;z&&console.time("total time");const Rt=`prepare ${R.length} points`;z&&console.time(Rt),this.points=R;let At=[];for(let ye=0;ye<R.length;ye++)R[ye].geometry&&At.push(Vt(R[ye],ye));this.trees[Be+1]=new gt(At,Kn,ri,tt,Float32Array),z&&console.timeEnd(Rt);for(let ye=Be;ye>=ce;ye--){const be=+Date.now();At=this._cluster(At,ye),this.trees[ye]=new gt(At,Kn,ri,tt,Float32Array),z&&console.log("z%d: %d clusters in %dms",ye,At.length,+Date.now()-be)}return z&&console.timeEnd("total time"),this}getClusters(R,z){let ce=((R[0]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,R[1]));let tt=180===R[2]?180:((R[2]+180)%360+360)%360-180;const Rt=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)ce=-180,tt=180;else if(ce>tt){const De=this.getClusters([ce,Be,180,Rt],z),dt=this.getClusters([-180,Be,tt,Rt],z);return De.concat(dt)}const At=this.trees[this._limitZoom(z)],ye=At.range(cn(ce),ot(Rt),cn(tt),ot(Be)),be=[];for(const De of ye){const dt=At.points[De];be.push(dt.numPoints?yn(dt):this.points[dt.index])}return be}getChildren(R){const z=this._getOriginId(R),ce=this._getOriginZoom(R),Be="No cluster with the specified id.",tt=this.trees[ce];if(!tt)throw new Error(Be);const Rt=tt.points[z];if(!Rt)throw new Error(Be);const At=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),ye=tt.within(Rt.x,Rt.y,At),be=[];for(const De of ye){const dt=tt.points[De];dt.parentId===R&&be.push(dt.numPoints?yn(dt):this.points[dt.index])}if(0===be.length)throw new Error(Be);return be}getLeaves(R,z,ce){const Be=[];return this._appendLeaves(Be,R,z=z||10,ce=ce||0,0),Be}getTile(R,z,ce){const Be=this.trees[this._limitZoom(R)],tt=Math.pow(2,R),{extent:Rt,radius:At}=this.options,ye=At/Rt,be=(ce-ye)/tt,De=(ce+1+ye)/tt,dt={features:[]};return this._addTileFeatures(Be.range((z-ye)/tt,be,(z+1+ye)/tt,De),Be.points,z,ce,tt,dt),0===z&&this._addTileFeatures(Be.range(1-ye/tt,be,1,De),Be.points,tt,ce,tt,dt),z===tt-1&&this._addTileFeatures(Be.range(0,be,ye/tt,De),Be.points,-1,ce,tt,dt),dt.features.length?dt:null}getClusterExpansionZoom(R){let z=this._getOriginZoom(R)-1;for(;z<=this.options.maxZoom;){const ce=this.getChildren(R);if(z++,1!==ce.length)break;R=ce[0].properties.cluster_id}return z}_appendLeaves(R,z,ce,Be,tt){const Rt=this.getChildren(z);for(const At of Rt){const ye=At.properties;if(ye&&ye.cluster?tt+ye.point_count<=Be?tt+=ye.point_count:tt=this._appendLeaves(R,ye.cluster_id,ce,Be,tt):tt<Be?tt++:R.push(At),R.length===ce)break}return tt}_addTileFeatures(R,z,ce,Be,tt,Rt){for(const At of R){const ye=z[At],be=ye.numPoints;let De,dt,pt;if(be)De=Fn(ye),dt=ye.x,pt=ye.y;else{const Nn=this.points[ye.index];De=Nn.properties,dt=cn(Nn.geometry.coordinates[0]),pt=ot(Nn.geometry.coordinates[1])}const on={type:1,geometry:[[Math.round(this.options.extent*(dt*tt-ce)),Math.round(this.options.extent*(pt*tt-Be))]],tags:De};let Dn;be?Dn=ye.id:this.options.generateId?Dn=ye.index:this.points[ye.index].id&&(Dn=this.points[ye.index].id),void 0!==Dn&&(on.id=Dn),Rt.features.push(on)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,z){const ce=[],{radius:Be,extent:tt,reduce:Rt,minPoints:At}=this.options,ye=Be/(tt*Math.pow(2,z));for(let be=0;be<R.length;be++){const De=R[be];if(De.zoom<=z)continue;De.zoom=z;const dt=this.trees[z+1],pt=dt.within(De.x,De.y,ye),on=De.numPoints||1;let Dn=on;for(const Nn of pt){const Wn=dt.points[Nn];Wn.zoom>z&&(Dn+=Wn.numPoints||1)}if(Dn>on&&Dn>=At){let Nn=De.x*on,Wn=De.y*on,Ei=Rt&&on>1?this._map(De,!0):null;const di=(be<<5)+(z+1)+this.points.length;for(const Hn of pt){const Vi=dt.points[Hn];if(Vi.zoom<=z)continue;Vi.zoom=z;const ki=Vi.numPoints||1;Nn+=Vi.x*ki,Wn+=Vi.y*ki,Vi.parentId=di,Rt&&(Ei||(Ei=this._map(De,!0)),Rt(Ei,this._map(Vi)))}De.parentId=di,ce.push(kt(Nn/Dn,Wn/Dn,di,Dn,Ei))}else if(ce.push(De),Dn>1)for(const Nn of pt){const Wn=dt.points[Nn];Wn.zoom<=z||(Wn.zoom=z,ce.push(Wn))}}return ce}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,z){if(R.numPoints)return z?bn({},R.properties):R.properties;const ce=this.points[R.index].properties,Be=this.options.map(ce);return z&&Be===ce?bn({},Be):Be}}function kt(se,R,z,ce,Be){return{x:at(se),y:at(R),zoom:1/0,id:z,parentId:-1,numPoints:ce,properties:Be}}function Vt(se,R){const[z,ce]=se.geometry.coordinates;return{x:at(cn(z)),y:at(ot(ce)),zoom:1/0,index:R,parentId:-1}}function yn(se){return{type:"Feature",id:se.id,properties:Fn(se),geometry:{type:"Point",coordinates:[(R=se.x,360*(R-.5)),Nt(se.y)]}};var R}function Fn(se){const R=se.numPoints,z=R>=1e4?`${Math.round(R/1e3)}k`:R>=1e3?Math.round(R/100)/10+"k":R;return bn(bn({},se.properties),{cluster:!0,cluster_id:se.id,point_count:R,point_count_abbreviated:z})}function cn(se){return se/360+.5}function ot(se){const R=Math.sin(se*Math.PI/180),z=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return z<0?0:z>1?1:z}function Nt(se){const R=(180-360*se)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function bn(se,R){for(const z in R)se[z]=R[z];return se}function Kn(se){return se.x}function ri(se){return se.y}function Bn(se,R,z,ce){for(var Be,tt=ce,Rt=z-R>>1,At=z-R,ye=se[R],be=se[R+1],De=se[z],dt=se[z+1],pt=R+3;pt<z;pt+=3){var on=pi(se[pt],se[pt+1],ye,be,De,dt);if(on>tt)Be=pt,tt=on;else if(on===tt){var Dn=Math.abs(pt-Rt);Dn<At&&(Be=pt,At=Dn)}}tt>ce&&(Be-R>3&&Bn(se,R,Be,ce),se[Be+2]=tt,z-Be>3&&Bn(se,Be,z,ce))}function pi(se,R,z,ce,Be,tt){var Rt=Be-z,At=tt-ce;if(0!==Rt||0!==At){var ye=((se-z)*Rt+(R-ce)*At)/(Rt*Rt+At*At);ye>1?(z=Be,ce=tt):ye>0&&(z+=Rt*ye,ce+=At*ye)}return(Rt=se-z)*Rt+(At=R-ce)*At}function bi(se,R,z,ce){var Be={id:void 0===se?null:se,type:R,geometry:z,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(tt){var Rt=tt.geometry,At=tt.type;if("Point"===At||"MultiPoint"===At||"LineString"===At)vi(tt,Rt);else if("Polygon"===At||"MultiLineString"===At)for(var ye=0;ye<Rt.length;ye++)vi(tt,Rt[ye]);else if("MultiPolygon"===At)for(ye=0;ye<Rt.length;ye++)for(var be=0;be<Rt[ye].length;be++)vi(tt,Rt[ye][be])}(Be),Be}function vi(se,R){for(var z=0;z<R.length;z+=3)se.minX=Math.min(se.minX,R[z]),se.minY=Math.min(se.minY,R[z+1]),se.maxX=Math.max(se.maxX,R[z]),se.maxY=Math.max(se.maxY,R[z+1])}function Li(se,R,z,ce){if(R.geometry){var Be=R.geometry.coordinates,tt=R.geometry.type,Rt=Math.pow(z.tolerance/((1<<z.maxZoom)*z.extent),2),At=[],ye=R.id;if(z.promoteId?ye=R.properties[z.promoteId]:z.generateId&&(ye=ce||0),"Point"===tt)Si(Be,At);else if("MultiPoint"===tt)for(var be=0;be<Be.length;be++)Si(Be[be],At);else if("LineString"===tt)Fi(Be,At,Rt,!1);else if("MultiLineString"===tt){if(z.lineMetrics){for(be=0;be<Be.length;be++)Fi(Be[be],At=[],Rt,!1),se.push(bi(ye,"LineString",At,R.properties));return}Yi(Be,At,Rt,!1)}else if("Polygon"===tt)Yi(Be,At,Rt,!0);else{if("MultiPolygon"!==tt){if("GeometryCollection"===tt){for(be=0;be<R.geometry.geometries.length;be++)Li(se,{id:ye,geometry:R.geometry.geometries[be],properties:R.properties},z,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(be=0;be<Be.length;be++){var De=[];Yi(Be[be],De,Rt,!0),At.push(De)}}se.push(bi(ye,tt,At,R.properties))}}function Si(se,R){R.push(Zt(se[0])),R.push(It(se[1])),R.push(0)}function Fi(se,R,z,ce){for(var Be,tt,Rt=0,At=0;At<se.length;At++){var ye=Zt(se[At][0]),be=It(se[At][1]);R.push(ye),R.push(be),R.push(0),At>0&&(Rt+=ce?(Be*be-ye*tt)/2:Math.sqrt(Math.pow(ye-Be,2)+Math.pow(be-tt,2))),Be=ye,tt=be}var De=R.length-3;R[2]=1,Bn(R,0,De,z),R[De+2]=1,R.size=Math.abs(Rt),R.start=0,R.end=R.size}function Yi(se,R,z,ce){for(var Be=0;Be<se.length;Be++){var tt=[];Fi(se[Be],tt,z,ce),R.push(tt)}}function Zt(se){return se/360+.5}function It(se){var R=Math.sin(se*Math.PI/180),z=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return z<0?0:z>1?1:z}function He(se,R,z,ce,Be,tt,Rt,At){if(ce/=R,tt>=(z/=R)&&Rt<ce)return se;if(Rt<z||tt>=ce)return null;for(var ye=[],be=0;be<se.length;be++){var De=se[be],dt=De.geometry,pt=De.type,on=0===Be?De.minX:De.minY,Dn=0===Be?De.maxX:De.maxY;if(on>=z&&Dn<ce)ye.push(De);else if(!(Dn<z||on>=ce)){var Nn=[];if("Point"===pt||"MultiPoint"===pt)ne(dt,Nn,z,ce,Be);else if("LineString"===pt)Je(dt,Nn,z,ce,Be,!1,At.lineMetrics);else if("MultiLineString"===pt)Qt(dt,Nn,z,ce,Be,!1);else if("Polygon"===pt)Qt(dt,Nn,z,ce,Be,!0);else if("MultiPolygon"===pt)for(var Wn=0;Wn<dt.length;Wn++){var Ei=[];Qt(dt[Wn],Ei,z,ce,Be,!0),Ei.length&&Nn.push(Ei)}if(Nn.length){if(At.lineMetrics&&"LineString"===pt){for(Wn=0;Wn<Nn.length;Wn++)ye.push(bi(De.id,pt,Nn[Wn],De.tags));continue}"LineString"!==pt&&"MultiLineString"!==pt||(1===Nn.length?(pt="LineString",Nn=Nn[0]):pt="MultiLineString"),"Point"!==pt&&"MultiPoint"!==pt||(pt=3===Nn.length?"Point":"MultiPoint"),ye.push(bi(De.id,pt,Nn,De.tags))}}}return ye.length?ye:null}function ne(se,R,z,ce,Be){for(var tt=0;tt<se.length;tt+=3){var Rt=se[tt+Be];Rt>=z&&Rt<=ce&&(R.push(se[tt]),R.push(se[tt+1]),R.push(se[tt+2]))}}function Je(se,R,z,ce,Be,tt,Rt){for(var At,ye,be=jt(se),De=0===Be?Ii:tr,dt=se.start,pt=0;pt<se.length-3;pt+=3){var on=se[pt],Dn=se[pt+1],Nn=se[pt+2],Wn=se[pt+3],Ei=se[pt+4],di=0===Be?on:Dn,Hn=0===Be?Wn:Ei,Vi=!1;Rt&&(At=Math.sqrt(Math.pow(on-Wn,2)+Math.pow(Dn-Ei,2))),di<z?Hn>z&&(ye=De(be,on,Dn,Wn,Ei,z),Rt&&(be.start=dt+At*ye)):di>ce?Hn<ce&&(ye=De(be,on,Dn,Wn,Ei,ce),Rt&&(be.start=dt+At*ye)):li(be,on,Dn,Nn),Hn<z&&di>=z&&(ye=De(be,on,Dn,Wn,Ei,z),Vi=!0),Hn>ce&&di<=ce&&(ye=De(be,on,Dn,Wn,Ei,ce),Vi=!0),!tt&&Vi&&(Rt&&(be.end=dt+At*ye),R.push(be),be=jt(se)),Rt&&(dt+=At)}var ki=se.length-3;on=se[ki],Dn=se[ki+1],Nn=se[ki+2],(di=0===Be?on:Dn)>=z&&di<=ce&&li(be,on,Dn,Nn),ki=be.length-3,tt&&ki>=3&&(be[ki]!==be[0]||be[ki+1]!==be[1])&&li(be,be[0],be[1],be[2]),be.length&&R.push(be)}function jt(se){var R=[];return R.size=se.size,R.start=se.start,R.end=se.end,R}function Qt(se,R,z,ce,Be,tt){for(var Rt=0;Rt<se.length;Rt++)Je(se[Rt],R,z,ce,Be,tt,!1)}function li(se,R,z,ce){se.push(R),se.push(z),se.push(ce)}function Ii(se,R,z,ce,Be,tt){var Rt=(tt-R)/(ce-R);return se.push(tt),se.push(z+(Be-z)*Rt),se.push(1),Rt}function tr(se,R,z,ce,Be,tt){var Rt=(tt-z)/(Be-z);return se.push(R+(ce-R)*Rt),se.push(tt),se.push(1),Rt}function fi(se,R){for(var z=[],ce=0;ce<se.length;ce++){var Be,tt=se[ce],Rt=tt.type;if("Point"===Rt||"MultiPoint"===Rt||"LineString"===Rt)Be=yr(tt.geometry,R);else if("MultiLineString"===Rt||"Polygon"===Rt){Be=[];for(var At=0;At<tt.geometry.length;At++)Be.push(yr(tt.geometry[At],R))}else if("MultiPolygon"===Rt)for(Be=[],At=0;At<tt.geometry.length;At++){for(var ye=[],be=0;be<tt.geometry[At].length;be++)ye.push(yr(tt.geometry[At][be],R));Be.push(ye)}z.push(bi(tt.id,Rt,Be,tt.tags))}return z}function yr(se,R){var z=[];z.size=se.size,void 0!==se.start&&(z.start=se.start,z.end=se.end);for(var ce=0;ce<se.length;ce+=3)z.push(se[ce]+R,se[ce+1],se[ce+2]);return z}function Ai(se,R){if(se.transformed)return se;var z,ce,Be,tt=1<<se.z,Rt=se.x,At=se.y;for(z=0;z<se.features.length;z++){var ye=se.features[z],be=ye.geometry,De=ye.type;if(ye.geometry=[],1===De)for(ce=0;ce<be.length;ce+=2)ye.geometry.push(fr(be[ce],be[ce+1],R,tt,Rt,At));else for(ce=0;ce<be.length;ce++){var dt=[];for(Be=0;Be<be[ce].length;Be+=2)dt.push(fr(be[ce][Be],be[ce][Be+1],R,tt,Rt,At));ye.geometry.push(dt)}}return se.transformed=!0,se}function fr(se,R,z,ce,Be,tt){return[Math.round(z*(se*ce-Be)),Math.round(z*(R*ce-tt))]}function wr(se,R,z,ce,Be){for(var tt=R===Be.maxZoom?0:Be.tolerance/((1<<R)*Be.extent),Rt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:z,y:ce,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},At=0;At<se.length;At++){Rt.numFeatures++,Cr(Rt,se[At],tt,Be);var ye=se[At].minX,be=se[At].minY,De=se[At].maxX,dt=se[At].maxY;ye<Rt.minX&&(Rt.minX=ye),be<Rt.minY&&(Rt.minY=be),De>Rt.maxX&&(Rt.maxX=De),dt>Rt.maxY&&(Rt.maxY=dt)}return Rt}function Cr(se,R,z,ce){var Be=R.geometry,tt=R.type,Rt=[];if("Point"===tt||"MultiPoint"===tt)for(var At=0;At<Be.length;At+=3)Rt.push(Be[At]),Rt.push(Be[At+1]),se.numPoints++,se.numSimplified++;else if("LineString"===tt)si(Rt,Be,se,z,!1,!1);else if("MultiLineString"===tt||"Polygon"===tt)for(At=0;At<Be.length;At++)si(Rt,Be[At],se,z,"Polygon"===tt,0===At);else if("MultiPolygon"===tt)for(var ye=0;ye<Be.length;ye++){var be=Be[ye];for(At=0;At<be.length;At++)si(Rt,be[At],se,z,!0,0===At)}if(Rt.length){var De=R.tags||null;if("LineString"===tt&&ce.lineMetrics){for(var dt in De={},R.tags)De[dt]=R.tags[dt];De.mapbox_clip_start=Be.start/Be.size,De.mapbox_clip_end=Be.end/Be.size}var pt={geometry:Rt,type:"Polygon"===tt||"MultiPolygon"===tt?3:"LineString"===tt||"MultiLineString"===tt?2:1,tags:De};null!==R.id&&(pt.id=R.id),se.features.push(pt)}}function si(se,R,z,ce,Be,tt){var Rt=ce*ce;if(ce>0&&R.size<(Be?Rt:ce))z.numPoints+=R.length/3;else{for(var At=[],ye=0;ye<R.length;ye+=3)(0===ce||R[ye+2]>Rt)&&(z.numSimplified++,At.push(R[ye]),At.push(R[ye+1])),z.numPoints++;Be&&function(be,De){for(var dt=0,pt=0,on=be.length,Dn=on-2;pt<on;Dn=pt,pt+=2)dt+=(be[pt]-be[Dn])*(be[pt+1]+be[Dn+1]);if(dt>0===De)for(pt=0,on=be.length;pt<on/2;pt+=2){var Nn=be[pt],Wn=be[pt+1];be[pt]=be[on-2-pt],be[pt+1]=be[on-1-pt],be[on-2-pt]=Nn,be[on-1-pt]=Wn}}(At,tt),se.push(At)}}function dn(se,R){var z=(R=this.options=function(Be,tt){for(var Rt in tt)Be[Rt]=tt[Rt];return Be}(Object.create(this.options),R)).debug;if(z&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var Be,tt,Rt,At,ye,be,ce=function(Be,tt){var Rt=[];if("FeatureCollection"===Be.type)for(var At=0;At<Be.features.length;At++)Li(Rt,Be.features[At],tt,At);else Li(Rt,"Feature"===Be.type?Be:{geometry:Be},tt);return Rt}(se,R);this.tiles={},this.tileCoords=[],z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),At=Be=ce,ye=He(Be,1,-1-(Rt=(tt=R).buffer/tt.extent),Rt,0,-1,2,tt),be=He(Be,1,1-Rt,2+Rt,0,-1,2,tt),(ye||be)&&(At=He(Be,1,-Rt,1+Rt,0,-1,2,tt)||[],ye&&(At=fi(ye,1).concat(At)),be&&(At=At.concat(fi(be,-1)))),(ce=At).length&&this.splitTile(ce,0,0,0),z&&(ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function wt(se,R,z){return 32*((1<<se)*z+R)+se}function Pt(se,R){const z=se.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const ce=this._geoJSONIndex.getTile(z.z,z.x,z.y);if(!ce)return R(null,null);const Be=new ze(ce.features);let tt=le.exports(Be);0===tt.byteOffset&&tt.byteLength===tt.buffer.byteLength||(tt=new Uint8Array(tt)),R(null,{vectorTile:Be,rawData:tt.buffer})}dn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},dn.prototype.splitTile=function(se,R,z,ce,Be,tt,Rt){for(var At=[se,R,z,ce],ye=this.options,be=ye.debug;At.length;){ce=At.pop(),z=At.pop(),R=At.pop(),se=At.pop();var De=1<<R,dt=wt(R,z,ce),pt=this.tiles[dt];if(!pt&&(be>1&&console.time("creation"),pt=this.tiles[dt]=wr(se,R,z,ce,ye),this.tileCoords.push({z:R,x:z,y:ce}),be)){be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,z,ce,pt.numFeatures,pt.numPoints,pt.numSimplified),console.timeEnd("creation"));var on="z"+R;this.stats[on]=(this.stats[on]||0)+1,this.total++}if(pt.source=se,Be){if(R===ye.maxZoom||R===Be)continue;var Dn=1<<Be-R;if(z!==Math.floor(tt/Dn)||ce!==Math.floor(Rt/Dn))continue}else if(R===ye.indexMaxZoom||pt.numPoints<=ye.indexMaxPoints)continue;if(pt.source=null,0!==se.length){be>1&&console.time("clipping");var Nn,Wn,Ei,di,Hn,Vi,ki=.5*ye.buffer/ye.extent,Gr=.5-ki,Tr=.5+ki,Or=1+ki;Nn=Wn=Ei=di=null,Hn=He(se,De,z-ki,z+Tr,0,pt.minX,pt.maxX,ye),Vi=He(se,De,z+Gr,z+Or,0,pt.minX,pt.maxX,ye),se=null,Hn&&(Nn=He(Hn,De,ce-ki,ce+Tr,1,pt.minY,pt.maxY,ye),Wn=He(Hn,De,ce+Gr,ce+Or,1,pt.minY,pt.maxY,ye),Hn=null),Vi&&(Ei=He(Vi,De,ce-ki,ce+Tr,1,pt.minY,pt.maxY,ye),di=He(Vi,De,ce+Gr,ce+Or,1,pt.minY,pt.maxY,ye),Vi=null),be>1&&console.timeEnd("clipping"),At.push(Nn||[],R+1,2*z,2*ce),At.push(Wn||[],R+1,2*z,2*ce+1),At.push(Ei||[],R+1,2*z+1,2*ce),At.push(di||[],R+1,2*z+1,2*ce+1)}}},dn.prototype.getTile=function(se,R,z){var ce=this.options,Be=ce.extent,tt=ce.debug;if(se<0||se>24)return null;var Rt=1<<se,At=wt(se,R=(R%Rt+Rt)%Rt,z);if(this.tiles[At])return Ai(this.tiles[At],Be);tt>1&&console.log("drilling down to z%d-%d-%d",se,R,z);for(var ye,be=se,De=R,dt=z;!ye&&be>0;)be--,De=Math.floor(De/2),dt=Math.floor(dt/2),ye=this.tiles[wt(be,De,dt)];return ye&&ye.source?(tt>1&&console.log("found parent tile z%d-%d-%d",be,De,dt),tt>1&&console.time("drilling down"),this.splitTile(ye.source,be,De,dt,se,R,z),tt>1&&console.timeEnd("drilling down"),this.tiles[At]?Ai(this.tiles[At],Be):null):null};class gn extends l.VectorTileWorkerSource{constructor(R,z,ce,Be,tt){super(R,z,ce,Be,Pt),tt&&(this.loadGeoJSON=tt)}loadData(R,z){const ce=R&&R.request,Be=ce&&ce.collectResourceTiming;this.loadGeoJSON(R,(tt,Rt)=>{if(tt||!Rt)return z(tt);if("object"!=typeof Rt)return z(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{Me(Rt,!0);try{if(R.filter){const ye=l.createExpression(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ye.result)throw new Error(ye.value.map(De=>`${De.key}: ${De.message}`).join(", "));Rt={type:"FeatureCollection",features:Rt.features.filter(De=>ye.value.evaluate({zoom:0},De))}}this._geoJSONIndex=R.cluster?new bt(function({superclusterOptions:ye,clusterProperties:be}){if(!be||!ye)return ye;const De={},dt={},pt={accumulated:null,zoom:0},on={properties:null},Dn=Object.keys(be);for(const Nn of Dn){const[Wn,Ei]=be[Nn],di=l.createExpression(Ei),Hn=l.createExpression("string"==typeof Wn?[Wn,["accumulated"],["get",Nn]]:Wn);De[Nn]=di.value,dt[Nn]=Hn.value}return ye.map=Nn=>{on.properties=Nn;const Wn={};for(const Ei of Dn)Wn[Ei]=De[Ei].evaluate(pt,on);return Wn},ye.reduce=(Nn,Wn)=>{on.properties=Wn;for(const Ei of Dn)pt.accumulated=Nn[Ei],Nn[Ei]=dt[Ei].evaluate(pt,on)},ye}(R)).load(Rt.features):new dn(ye=Rt,R.geojsonVtOptions)}catch(ye){return z(ye)}this.loaded={};const At={};if(Be){const ye=l.getPerformanceMeasurement(ce);ye&&(At.resourceTiming={},At.resourceTiming[R.source]=JSON.parse(JSON.stringify(ye)))}z(null,At)}var ye})}reloadTile(R,z){const ce=this.loaded;return ce&&ce[R.uid]?super.reloadTile(R,z):this.loadTile(R,z)}loadGeoJSON(R,z){if(R.request)l.getJSON(R.request,z);else{if("string"!=typeof R.data)return z(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));try{return z(null,JSON.parse(R.data))}catch{return z(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(R,z){try{z(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch(ce){z(ce)}}getClusterChildren(R,z){try{z(null,this._geoJSONIndex.getChildren(R.clusterId))}catch(ce){z(ce)}}getClusterLeaves(R,z){try{z(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch(ce){z(ce)}}}class Ue{constructor(R){this.self=R,this.actor=new l.Actor(R,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=l.getProjection({name:"mercator"}),this.workerSourceTypes={vector:l.VectorTileWorkerSource,geojson:gn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(z,ce)=>{if(this.workerSourceTypes[z])throw new Error(`Worker source with name "${z}" already registered.`);this.workerSourceTypes[z]=ce},this.self.registerRTLTextPlugin=z=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=z.applyArabicShaping,l.plugin.processBidirectionalText=z.processBidirectionalText,l.plugin.processStyledBidirectionalText=z.processStyledBidirectionalText}}clearCaches(R,z,ce){delete this.layerIndexes[R],delete this.availableImages[R],delete this.workerSources[R],delete this.demWorkerSources[R],ce()}checkIfReady(R,z,ce){ce()}setReferrer(R,z){this.referrer=z}spriteLoaded(R,z){this.isSpriteLoaded[R]=z;for(const ce in this.workerSources[R]){const Be=this.workerSources[R][ce];for(const tt in Be)Be[tt]instanceof l.VectorTileWorkerSource&&(Be[tt].isSpriteLoaded=z,Be[tt].fire(new l.Event("isSpriteLoaded")))}}setImages(R,z,ce){this.availableImages[R]=z;for(const Be in this.workerSources[R]){const tt=this.workerSources[R][Be];for(const Rt in tt)tt[Rt].availableImages=z}ce()}enableTerrain(R,z,ce){this.terrain=z,ce()}setProjection(R,z){this.projections[R]=l.getProjection(z)}setLayers(R,z,ce){this.getLayerIndex(R).replace(z),ce()}updateLayers(R,z,ce){this.getLayerIndex(R).update(z.layers,z.removedIds),ce()}loadTile(R,z,ce){const Be=this.enableTerrain?l.extend({enableTerrain:this.terrain},z):z;Be.projection=this.projections[R]||this.defaultProjection,this.getWorkerSource(R,z.type,z.source).loadTile(Be,ce)}loadDEMTile(R,z,ce){const Be=this.enableTerrain?l.extend({buildQuadTree:this.terrain},z):z;this.getDEMWorkerSource(R,z.source).loadTile(Be,ce)}reloadTile(R,z,ce){const Be=this.enableTerrain?l.extend({enableTerrain:this.terrain},z):z;Be.projection=this.projections[R]||this.defaultProjection,this.getWorkerSource(R,z.type,z.source).reloadTile(Be,ce)}abortTile(R,z,ce){this.getWorkerSource(R,z.type,z.source).abortTile(z,ce)}removeTile(R,z,ce){this.getWorkerSource(R,z.type,z.source).removeTile(z,ce)}removeSource(R,z,ce){if(!this.workerSources[R]||!this.workerSources[R][z.type]||!this.workerSources[R][z.type][z.source])return;const Be=this.workerSources[R][z.type][z.source];delete this.workerSources[R][z.type][z.source],void 0!==Be.removeSource?Be.removeSource(z,ce):ce()}loadWorkerSource(R,z,ce){try{this.self.importScripts(z.url),ce()}catch(Be){ce(Be.toString())}}syncRTLPluginState(R,z,ce){try{l.plugin.setState(z);const Be=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&null!=Be){this.self.importScripts(Be);const tt=l.plugin.isParsed();ce(tt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Be}`),tt)}}catch(Be){ce(Be.toString())}}getAvailableImages(R){let z=this.availableImages[R];return z||(z=[]),z}getLayerIndex(R){let z=this.layerIndexes[R];return z||(z=this.layerIndexes[R]=new b),z}getWorkerSource(R,z,ce){return this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][z]||(this.workerSources[R][z]={}),this.workerSources[R][z][ce]||(this.workerSources[R][z][ce]=new this.workerSourceTypes[z]({send:(tt,Rt,At,ye,be,De)=>{this.actor.send(tt,Rt,At,R,be,De)},scheduler:this.actor.scheduler},this.getLayerIndex(R),this.getAvailableImages(R),this.isSpriteLoaded[R])),this.workerSources[R][z][ce]}getDEMWorkerSource(R,z){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][z]||(this.demWorkerSources[R][z]=new he),this.demWorkerSources[R][z]}enforceCacheSizeLimit(R,z){l.enforceCacheSizeLimit(z)}getWorkerPerformanceMetrics(R,z,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ue(self)),Ue}),y(0,function(l){function q(m,i){if(Array.isArray(m)){if(!Array.isArray(i)||m.length!==i.length)return!1;for(let u=0;u<m.length;u++)if(!q(m[u],i[u]))return!1;return!0}if("object"==typeof m&&null!==m&&null!==i){if("object"!=typeof i||Object.keys(m).length!==Object.keys(i).length)return!1;for(const u in m)if(!q(m[u],i[u]))return!1;return!0}return m===i}var re=b;function b(m){return i=m,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var a,f,p=new Blob([""],{type:"text/javascript"}),v=URL.createObjectURL(p);try{f=new Worker(v),a=!0}catch{a=!1}return f&&f.terminate(),URL.revokeObjectURL(v),a}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var a=document.createElement("canvas");a.width=a.height=1;var f=a.getContext("2d");if(!f)return!1;var p=f.getImageData(0,0,1,1);return p&&p.width===a.width}()||(void 0===he[u=i&&i.failIfMajorPerformanceCaveat]&&(he[u]=function(a){var f,v,C,D,p=(v=a,C=document.createElement("canvas"),(D=Object.create(b.webGLContextAttributes)).failIfMajorPerformanceCaveat=v,C.getContext("webgl",D)||C.getContext("experimental-webgl",D));if(!p)return!1;try{f=p.createShader(p.VERTEX_SHADER)}catch{return!1}return!(!f||p.isContextLost())&&(p.shaderSource(f,"void main() {}"),p.compileShader(f),!0===p.getShaderParameter(f,p.COMPILE_STATUS))}(u)),!he[u]||document.documentMode));var i,u}var he={};function Me(m,i,u){const a=l.window.document.createElement(m);return void 0!==i&&(a.className=i),u&&u.appendChild(a),a}function Ve(m,i,u){const a=l.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const f of Object.keys(i))a.setAttributeNS(null,f,i[f]);return u&&u.appendChild(a),a}b.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const X=l.window.document&&l.window.document.documentElement.style,xe=X&&void 0!==X.userSelect?"userSelect":"WebkitUserSelect";let fe;function ze(){X&&xe&&(fe=X[xe],X[xe]="none")}function le(){X&&xe&&(X[xe]=fe)}function Ke(m){m.preventDefault(),m.stopPropagation(),l.window.removeEventListener("click",Ke,!0)}function Oe(){l.window.addEventListener("click",Ke,!0),l.window.setTimeout(()=>{l.window.removeEventListener("click",Ke,!0)},0)}function Q(m,i){const u=m.getBoundingClientRect();return lt(m,u,i)}function Ye(m,i){const u=m.getBoundingClientRect(),a=[];for(let f=0;f<i.length;f++)a.push(lt(m,u,i[f]));return a}function St(m){return void 0!==l.window.InstallTrigger&&2===m.button&&m.ctrlKey&&l.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function lt(m,i,u){const a=m.offsetWidth===i.width?1:m.offsetWidth/i.width;return new l.pointGeometry((u.clientX-i.left)*a,(u.clientY-i.top)*a)}function _e(m,i){var u=i[0],a=i[1],f=i[2],p=i[3],v=u*p-f*a;return v?(m[0]=p*(v=1/v),m[1]=-a*v,m[2]=-f*v,m[3]=u*v,m):null}function ke(m){const{userImage:i}=m;return!!(i&&i.render&&i.render())&&(m.data.replace(new Uint8Array(i.data.buffer)),!0)}class Ne extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:u,callback:a}of this.requestors)this._notify(u,a);this.requestors=[]}}hasImage(i){return!!this.getImage(i)}getImage(i){return this.images[i]}addImage(i,u){this._validate(i,u)&&(this.images[i]=u)}_validate(i,u){let a=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),a=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),a=!1),this._validateContent(u.content,u)||(this.fire(new l.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),a=!1),a}_validateStretch(i,u){if(!i)return!0;let a=0;for(const f of i){if(f[0]<a||f[1]<f[0]||u<f[1])return!1;a=f[1]}return!0}_validateContent(i,u){return!(i&&(4!==i.length||i[0]<0||u.data.width<i[0]||i[1]<0||u.data.height<i[1]||i[2]<0||u.data.width<i[2]||i[3]<0||u.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,u){u.version=this.images[i].version+1,this.images[i]=u,this.updatedImages[i]=!0}removeImage(i){const u=this.images[i];delete this.images[i],delete this.patterns[i],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,u){let a=!0;if(!this.isLoaded())for(const f of i)this.images[f]||(a=!1);this.isLoaded()||a?this._notify(i,u):this.requestors.push({ids:i,callback:u})}_notify(i,u){const a={};for(const f of i){this.images[f]||this.fire(new l.Event("styleimagemissing",{id:f}));const p=this.images[f];p?a[f]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,hasRenderCallback:Boolean(p.userImage&&p.userImage.render)}:l.warnOnce(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,a)}getPixelSize(){const{width:i,height:u}=this.atlasImage;return{width:i,height:u}}getPattern(i){const u=this.patterns[i],a=this.getImage(i);if(!a)return null;if(u&&u.position.version===a.version)return u.position;if(u)u.position.version=a.version;else{const f={w:a.data.width+2,h:a.data.height+2,x:0,y:0},p=new l.ImagePosition(f,a);this.patterns[i]={bin:f,position:p}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const u=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.Texture(i,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const p in this.patterns)i.push(this.patterns[p].bin);const{w:u,h:a}=l.potpack(i),f=this.atlasImage;f.resize({width:u||1,height:a||1});for(const p in this.patterns){const{bin:v}=this.patterns[p],C=v.x+1,D=v.y+1,P=this.images[p].data,F=P.width,W=P.height;l.RGBAImage.copy(P,f,{x:0,y:0},{x:C,y:D},{width:F,height:W}),l.RGBAImage.copy(P,f,{x:0,y:W-1},{x:C,y:D-1},{width:F,height:1}),l.RGBAImage.copy(P,f,{x:0,y:0},{x:C,y:D+W},{width:F,height:1}),l.RGBAImage.copy(P,f,{x:F-1,y:0},{x:C-1,y:D},{width:1,height:W}),l.RGBAImage.copy(P,f,{x:0,y:0},{x:C+F,y:D},{width:1,height:W})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const u of i){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const a=this.images[u];ke(a)&&this.updateImage(u,a)}}}const we=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(m,i){return function([u,a,f]){const p=l.degToRad(a+90),v=l.degToRad(f);return{x:u*Math.cos(p)*Math.sin(v),y:u*Math.sin(p)*Math.sin(v),z:u*Math.cos(v),azimuthal:a,polar:f}}(m.expression.evaluate(i))}interpolate(m,i,u){return{x:l.number(m.x,i.x,u),y:l.number(m.y,i.y,u),z:l.number(m.z,i.z,u),azimuthal:l.number(m.azimuthal,i.azimuthal,u),polar:l.number(m.polar,i.polar,u)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),Xe="-transition";class We extends l.Evented{constructor(i){super(),this._transitionable=new l.Transitionable(we),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,u={}){if(!this._validate(l.validateLight,i,u))for(const a in i){const f=i[a];l.endsWith(a,Xe)?this._transitionable.setTransition(a.slice(0,-Xe.length),f):this._transitionable.setValue(a,f)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,u,a){return(!a||!1!==a.validate)&&l.emitValidationErrors(this,i.call(l.validateStyle,l.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}const ge=new l.Properties({source:new l.DataConstantProperty(l.spec.terrain.source),exaggeration:new l.DataConstantProperty(l.spec.terrain.exaggeration)}),de="-transition";class oe extends l.Evented{constructor(i,u){super(),this._transitionable=new l.Transitionable(ge),this.set(i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=u}get(){return this._transitionable.serialize()}set(i){for(const u in i){const a=i[u];l.endsWith(u,de)?this._transitionable.setTransition(u.slice(0,-de.length),a):this._transitionable.setValue(u,a)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function Ee(m,i,u,a){const f=l.smoothstep(45,65,u),[p,v]=vt(m,a),C=l.length(i);let D=1-Math.min(1,Math.exp((C-p)/(v-p)*-6));return D*=D*D,D=Math.min(1,1.00747*D),D*f*m.alpha}function vt(m,i){const u=.5/Math.tan(.5*i);return[m.range[0]+u,m.range[1]+u]}const Tt=new l.Properties({range:new l.DataConstantProperty(l.spec.fog.range),color:new l.DataConstantProperty(l.spec.fog.color),"high-color":new l.DataConstantProperty(l.spec.fog["high-color"]),"space-color":new l.DataConstantProperty(l.spec.fog["space-color"]),"horizon-blend":new l.DataConstantProperty(l.spec.fog["horizon-blend"]),"star-intensity":new l.DataConstantProperty(l.spec.fog["star-intensity"])}),Gt="-transition";class Ot extends l.Evented{constructor(i,u){super(),this._transitionable=new l.Transitionable(Tt),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){const i=this._transform,u="globe"===i.projection.name,a=l.globeToMercatorTransition(i.zoom),f=this.properties.get("range"),p=[.5,3];return{range:u?[l.number(p[0],f[0],a),l.number(p[1],f[1],a)]:f,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,u={}){if(!this._validate(l.validateFog,i,u)){for(const a of Object.keys(l.spec.fog))i&&void 0===i[a]&&(i[a]=l.spec.fog[a].default);for(const a in i){const f=i[a];l.endsWith(a,Gt)?this._transitionable.setTransition(a.slice(0,-Gt.length),f):this._transitionable.setValue(a,f)}}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:l.smoothstep(45,65,i))*u.a}getOpacityAtLatLng(i,u){return this._transform.projection.supportsFog?function(a,f,p){const v=l.MercatorCoordinate.fromLngLat(f),C=p.elevation?p.elevation.getAtPointOrZero(v):0,D=[v.x,v.y,C];return l.transformMat4(D,D,p.mercatorFogMatrix),Ee(a,D,p.pitch,p._fov)}(this.state,i,u):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?vt(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,u,a){return(!a||!1!==a.validate)&&l.emitValidationErrors(this,i.call(l.validateStyle,l.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class yt{constructor(i,u){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const a=this.workerPool.acquire(this.id);for(let f=0;f<a.length;f++){const p=new yt.Actor(a[f],u,this.id);p.name=`Worker ${f}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,u,a){l.asyncAll(this.actors,(f,p)=>{f.send(i,u,p)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Mt(m,i,u){return i*(l.EXTENT/(m.tileSize*Math.pow(2,u-m.tileID.overscaledZ)))}yt.Actor=l.Actor;class gt{constructor(i,u,a,f){this.screenBounds=i,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=a,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(i,u){let a,f;if(i instanceof l.pointGeometry||"number"==typeof i[0]){const p=l.pointGeometry.convert(i);a=[p],f=u.isPointAboveHorizon(p)}else{const p=l.pointGeometry.convert(i[0]),v=l.pointGeometry.convert(i[1]);a=[p,v],f=l.polygonizeBounds(p,v).every(C=>u.isPointAboveHorizon(C))}return new gt(a,u.getCameraPoint(),f,u)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(i){return l.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const u=this.screenBounds[0],a=1===this.screenBounds.length?this.screenBounds[0].add(new l.pointGeometry(1,1)):this.screenBounds[1],f=l.polygonizeBounds(u,a,0,!1);return this.cameraPoint.y>a.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<a.x?f.splice(3,0,this.cameraPoint):this.cameraPoint.x>=a.x?f[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(f[3]=this.cameraPoint)),l.bufferConvexPolygon(f,i)}bufferedCameraGeometryGlobe(i){const u=this.screenBounds[0],a=1===this.screenBounds.length?this.screenBounds[0].add(new l.pointGeometry(1,1)):this.screenBounds[1],f=l.polygonizeBounds(u,a,i),p=this.cameraPoint.clone();switch(3*((p.y>u.y)+(p.y>a.y))+((p.x>u.x)+(p.x>a.x))){case 0:f[0]=p,f[4]=p.clone();break;case 1:f.splice(1,0,p);break;case 2:f[1]=p;break;case 3:f.splice(4,0,p);break;case 5:f.splice(2,0,p);break;case 6:f[3]=p;break;case 7:f.splice(3,0,p);break;case 8:f[2]=p}return f}containsTile(i,u,a,f=0){const p=i.queryPadding/u._pixelsPerMercatorPixel+1,v=a?this._bufferedCameraMercator(p,u):this._bufferedScreenMercator(p,u);let C=i.tileID.wrap+(v.unwrapped?f:0);const D=v.polygon.map(Le=>l.getTilePoint(i.tileTransform,Le,C));if(!l.polygonIntersectsBox(D,0,0,l.EXTENT,l.EXTENT))return;C=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?f:0);const P=this.screenGeometryMercator.polygon.map(Le=>l.getTileVec3(i.tileTransform,Le,C)),F=P.map(Le=>new l.pointGeometry(Le[0],Le[1])),W=u.getFreeCameraOptions().position||new l.MercatorCoordinate(0,0,0),ue=l.getTileVec3(i.tileTransform,W,C),Te=P.map(Le=>{const Fe=l.sub(Le,Le,ue);return l.normalize(Fe,Fe),new l.Ray(ue,Fe)}),Re=Mt(i,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:Te,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(je=l.getBounds(D),je.min.x=l.clamp(je.min.x,0,l.EXTENT),je.min.y=l.clamp(je.min.y,0,l.EXTENT),je.max.x=l.clamp(je.max.x,0,l.EXTENT),je.max.y=l.clamp(je.max.y,0,l.EXTENT),je),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:Re};var je}_bufferedScreenMercator(i,u){const a=Ce(i);if(this._screenRaycastCache[a])return this._screenRaycastCache[a];{let f;return f="globe"===u.projection.name?this._projectAndResample(this.bufferedScreenGeometry(i),u):{polygon:this.bufferedScreenGeometry(i).map(p=>u.pointCoordinate3D(p)),unwrapped:!0},this._screenRaycastCache[a]=f,f}}_bufferedCameraMercator(i,u){const a=Ce(i);if(this._cameraRaycastCache[a])return this._cameraRaycastCache[a];{let f;return f="globe"===u.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),u):{polygon:this.bufferedCameraGeometry(i).map(p=>u.pointCoordinate3D(p)),unwrapped:!0},this._cameraRaycastCache[a]=f,f}}_projectAndResample(i,u){const a=function(p,v){const C=l.multiply([],v.pixelMatrix,v.globeMatrix),D=[0,-l.GLOBE_RADIUS,0,1],P=[0,l.GLOBE_RADIUS,0,1],F=[0,0,0,1];l.transformMat4$1(D,D,C),l.transformMat4$1(P,P,C),l.transformMat4$1(F,F,C);const W=new l.pointGeometry(D[0]/D[3],D[1]/D[3]),ue=new l.pointGeometry(P[0]/P[3],P[1]/P[3]),Te=l.polygonContainsPoint(p,W)&&D[3]<F[3],Re=l.polygonContainsPoint(p,ue)&&P[3]<F[3];if(!Te&&!Re)return null;const je=function(Lt,en,Wt){for(let Ut=1;Ut<Lt.length;Ut++){const Ln=at(en.pointCoordinate3D(Lt[Ut-1]).x),Ht=at(en.pointCoordinate3D(Lt[Ut]).x);if(Wt<0){if(Ln<Ht)return{idx:Ut,t:-Ln/(Ht-1-Ln)}}else if(Ht<Ln)return{idx:Ut,t:(1-Ln)/(Ht+1-Ln)}}return null}(p,v,Te?-1:1);if(!je)return null;const{idx:Le,t:Fe}=je;let qe=Le>1?it(p.slice(0,Le),v):[],Ze=Le<p.length?it(p.slice(Le),v):[];qe=qe.map(Lt=>new l.pointGeometry(at(Lt.x),Lt.y)),Ze=Ze.map(Lt=>new l.pointGeometry(at(Lt.x),Lt.y));const rt=[...qe];0===rt.length&&rt.push(Ze[Ze.length-1]);const _t=l.number(rt[rt.length-1].y,(0===Ze.length?qe[0]:Ze[0]).y,Fe);let xt;return xt=Te?[new l.pointGeometry(0,_t),new l.pointGeometry(0,0),new l.pointGeometry(1,0),new l.pointGeometry(1,_t)]:[new l.pointGeometry(1,_t),new l.pointGeometry(1,1),new l.pointGeometry(0,1),new l.pointGeometry(0,_t)],rt.push(...xt),0===Ze.length?rt.push(qe[0]):rt.push(...Ze),{polygon:rt.map(Lt=>new l.MercatorCoordinate(Lt.x,Lt.y)),unwrapped:!1}}(i,u);if(a)return a;const f=function(p,v){let C=!1,D=-1/0,P=0;for(let W=0;W<p.length-1;W++)p[W].x>D&&(D=p[W].x,P=W);for(let W=0;W<p.length-1;W++){const ue=(P+W)%(p.length-1),Te=p[ue],Re=p[ue+1];Math.abs(Te.x-Re.x)>.5&&(Te.x<Re.x?(Te.x+=1,0===ue&&(p[p.length-1].x+=1)):(Re.x+=1,ue+1===p.length-1&&(p[0].x+=1)),C=!0)}const F=l.mercatorXfromLng(v.center.lng);return C&&F<Math.abs(F-1)&&p.forEach(W=>{W.x-=1}),{polygon:p,unwrapped:C}}(it(i,u).map(p=>new l.pointGeometry(at(p.x),p.y)),u);return{polygon:f.polygon.map(p=>new l.MercatorCoordinate(p.x,p.y)),unwrapped:f.unwrapped}}}function it(m,i){return l.resample(m,u=>{const a=i.pointCoordinate3D(u);u.x=a.x,u.y=a.y},1/256)}function at(m){return m<0?1+m%1:m%1}function Ce(m){return 100*m|0}function bt(m,i,u,a,f){const p=function(v,C){if(v)return f(v);if(C){m.url&&C.tiles&&m.tiles&&delete m.tiles;const D=l.pick(l.extend(C,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(D.vectorLayers=C.vector_layers,D.vectorLayerIds=D.vectorLayers.map(P=>P.id)),D.tiles=i.canonicalizeTileset(D,m.url),f(null,D)}};return m.url?l.getJSON(i.transformRequest(i.normalizeSourceURL(m.url,null,u,a),l.ResourceType.Source),p):l.exported.frame(()=>p(null,m))}class kt{constructor(i,u,a){this.bounds=l.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=u||0,this.maxzoom=a||24}validateBounds(i){return Array.isArray(i)&&4===i.length?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const u=Math.pow(2,i.z),a=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*u),f=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*u),p=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*u),v=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*u);return i.x>=a&&i.x<p&&i.y>=f&&i.y<v}}class Vt{constructor(i,u,a){this.context=i;const f=i.gl;this.buffer=f.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const yn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fn{constructor(i,u,a,f){this.length=u.length,this.attributes=a,this.itemSize=u.bytesPerElement,this.dynamicDraw=f,this.context=i;const p=i.gl;this.buffer=p.createBuffer(),i.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,u){for(let a=0;a<this.attributes.length;a++){const f=u.attributes[this.attributes[a].name];void 0!==f&&i.enableVertexAttribArray(f)}}setVertexAttribPointers(i,u,a){for(let f=0;f<this.attributes.length;f++){const p=this.attributes[f],v=u.attributes[p.name];void 0!==v&&i.vertexAttribPointer(v,p.components,i[yn[p.type]],!1,this.itemSize,p.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class cn{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ot extends cn{getDefault(){return l.Color.transparent}set(i){const u=this.current;(i.r!==u.r||i.g!==u.g||i.b!==u.b||i.a!==u.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Nt extends cn{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class bn extends cn{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Kn extends cn{getDefault(){return[!0,!0,!0,!0]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||i[3]!==u[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class ri extends cn{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Bn extends cn{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class pi extends cn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const u=this.current;(i.func!==u.func||i.ref!==u.ref||i.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class bi extends cn{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class vi extends cn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=i,this.dirty=!1}}class Li extends cn{getDefault(){return[0,1]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Si extends cn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=i,this.dirty=!1}}class Fi extends cn{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Yi extends cn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.BLEND):u.disable(u.BLEND),this.current=i,this.dirty=!1}}class Zt extends cn{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class It extends cn{getDefault(){return l.Color.transparent}set(i){const u=this.current;(i.r!==u.r||i.g!==u.g||i.b!==u.b||i.a!==u.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class He extends cn{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class ne extends cn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=i,this.dirty=!1}}class Je extends cn{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class jt extends cn{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class Qt extends cn{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class li extends cn{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Ii extends cn{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||i[3]!==u[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class tr extends cn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class fi extends cn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class yr extends cn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Ai extends cn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class fr extends cn{getDefault(){return null}set(i){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class wr extends cn{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class Cr extends cn{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class si extends cn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class dn extends cn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class wt extends cn{constructor(i,u){super(i),this.context=i,this.parent=u}getDefault(){return null}}class Pt extends wt{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class gn extends wt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ue extends gn{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class se{constructor(i,u,a,f){this.context=i,this.width=u,this.height=a;const p=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Pt(i,p),f&&(this.depthAttachment=new gn(i,p))}destroy(){const i=this.context.gl,u=this.colorAttachment.get();if(u&&i.deleteTexture(u),this.depthAttachment){const a=this.depthAttachment.get();a&&i.deleteRenderbuffer(a)}i.deleteFramebuffer(this.framebuffer)}}class R{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ot(this),this.clearDepth=new Nt(this),this.clearStencil=new bn(this),this.colorMask=new Kn(this),this.depthMask=new ri(this),this.stencilMask=new Bn(this),this.stencilFunc=new pi(this),this.stencilOp=new bi(this),this.stencilTest=new vi(this),this.depthRange=new Li(this),this.depthTest=new Si(this),this.depthFunc=new Fi(this),this.blend=new Yi(this),this.blendFunc=new Zt(this),this.blendColor=new It(this),this.blendEquation=new He(this),this.cullFace=new ne(this),this.cullFaceSide=new Je(this),this.frontFace=new jt(this),this.program=new Qt(this),this.activeTexture=new li(this),this.viewport=new Ii(this),this.bindFramebuffer=new tr(this),this.bindRenderbuffer=new fi(this),this.bindTexture=new yr(this),this.bindVertexBuffer=new Ai(this),this.bindElementBuffer=new fr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new wr(this),this.pixelStoreUnpack=new Cr(this),this.pixelStoreUnpackPremultiplyAlpha=new si(this),this.pixelStoreUnpackFlipY=new dn(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=i.getExtension("OES_standard_derivatives"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,u){return new Vt(this,i,u)}createVertexBuffer(i,u,a){return new Fn(this,i,u,a)}createRenderbuffer(i,u,a){const f=this.gl,p=f.createRenderbuffer();return this.bindRenderbuffer.set(p),f.renderbufferStorage(f.RENDERBUFFER,i,u,a),this.bindRenderbuffer.set(null),p}createFramebuffer(i,u,a){return new se(this,i,u,a)}clear({color:i,depth:u,stencil:a}){const f=this.gl;let p=0;i&&(p|=f.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(p|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==a&&(p|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),f.clear(p)}setCullFace(i){!1===i.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){q(i.blendFunction,l.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class z extends l.Evented{constructor(i,u,a,f){super(),this.id=i,this.dispatcher=a,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},u),l.extend(this,l.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=bt(this._options,this.map._requestManager,null,null,(i,u)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new l.ErrorEvent(i)):u&&(l.extend(this,u),u.bounds&&(this.tileBounds=new kt(u.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(u.tiles),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,u){const a=l.exported.devicePixelRatio>=2,f=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),a,this.tileSize);i.request=l.getImage(this.map._requestManager.transformRequest(f,l.ResourceType.Tile),(p,v,C,D)=>(delete i.request,i.aborted?(i.state="unloaded",u(null)):p?(i.state="errored",u(p)):v?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:C,expires:D}),i.setTexture(v,this.map.painter),i.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),void u(null)):u(null)))}static loadTileData(i,u,a){i.setTexture(u,a)}static unloadTileData(i,u){i.texture&&u.saveTileTexture(i.texture)}abortTile(i,u){i.request&&(i.request.cancel(),delete i.request),u()}unloadTile(i,u){i.texture&&this.map.painter.saveTileTexture(i.texture),u()}hasTransition(){return!1}}let ce;function Be(m,i,u,a,f,p,v,C){const D=[m,u,f,i,a,p,1,1,1],P=[v,C,1],F=l.adjoint([],D),[W,ue,Te]=l.transformMat3(P,P,l.transpose(F,F));return l.multiply$1(D,[W,0,0,0,ue,0,0,0,Te],D)}class tt extends l.Evented{constructor(i,u,a,f){super(),this.id=i,this.dispatcher=a,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=u,this._dirty=!1}load(i,u){this._loaded=u||!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(a,f)=>{if(this._imageRequest=null,this._loaded=!0,a)this.fire(new l.ErrorEvent(a));else if(f){const{HTMLImageElement:p}=l.window;this.image=f instanceof p?l.exported.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading()}})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(i){this.coordinates=i,this._boundsArray=void 0;const u=i.map(l.MercatorCoordinate.fromLngLat);return this.tileID=function(a){let f=1/0,p=1/0,v=-1/0,C=-1/0;for(const W of a)f=Math.min(f,W.x),p=Math.min(p,W.y),v=Math.max(v,W.x),C=Math.max(C,W.y);const D=Math.max(v-f,C-p),P=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),F=Math.pow(2,P);return new l.CanonicalTileID(P,Math.floor((f+v)/2*F),Math.floor((p+C)/2*F))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(i){for(const D in this.tiles){const P=this.tiles[D];"loaded"!==P.state&&(P.state="loaded",P.texture=this.texture)}if(this._boundsArray)return;const u=l.tileTransform(this.tileID,this.map.transform.projection),[a,f,p,v]=this.coordinates.map(D=>{const P=u.projection.project(D[0],D[1]);return l.getTilePoint(u,P)._round()});this.perspectiveTransform=function(D,P,F,W,ue,Te,Re,je,Le,Fe){const qe=Be(0,0,D,0,0,P,D,P),Ze=Be(F,W,ue,Te,Re,je,Le,Fe);return l.multiply$1(Ze,l.adjoint(qe,qe),Ze),[Ze[6]/Ze[8]*D/l.EXTENT,Ze[7]/Ze[8]*P/l.EXTENT]}(this.width,this.height,a.x,a.y,f.x,f.y,v.x,v.y,p.x,p.y);const C=this._boundsArray=new l.StructArrayLayout4i8;C.emplaceBack(a.x,a.y,0,0),C.emplaceBack(f.x,f.y,l.EXTENT,0),C.emplaceBack(v.x,v.y,0,l.EXTENT),C.emplaceBack(p.x,p.y,l.EXTENT,l.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=i.createVertexBuffer(C,l.boundsAttributes.members),this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const i=this.map.painter.context,u=i.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new l.Texture(i,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(i)}loadTile(i,u){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},u(null)):(i.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Rt={vector:class extends l.Evented{constructor(m,i,u,a){if(super(),this.id=m,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(i,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a),this._tileWorkers={},this._deduped=new l.DedupedRequest}load(m){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map._worldview;this._tileJSONRequest=bt(this._options,this.map._requestManager,i,u,(a,f)=>{this._tileJSONRequest=null,this._loaded=!0,a?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),u&&2!==u.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new l.ErrorEvent(a))):f&&(l.extend(this,f),f.bounds&&(this.tileBounds=new kt(f.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(f.tiles,this.map._requestManager._customAccessToken),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))),m&&m(a)})}loaded(){return this._loaded}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const m=this.map.style._getSourceCaches(this.id);for(const i of m)i.clearTiles()})}setSourceProperty(m){m(),this.reload()}setTiles(m){return this._options.tiles=m,this.reload(),this}setUrl(m){return this.url=m,this._options.url=m,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return l.extend({},this._options)}loadTile(m,i){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),a={request:this.map._requestManager.transformRequest(u,l.ResourceType.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:m.isSymbolTile};if(a.request.collectResourceTiming=this._collectResourceTiming,m.actor&&"expired"!==m.state)"loading"===m.state?m.reloadCallback=i:m.request=m.actor.send("reloadTile",a,f.bind(this));else if(m.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)m.request=m.actor.send("loadTile",a,f.bind(this),void 0,!0);else{const p=l.loadVectorTile.call({deduped:this._deduped},a,(v,C)=>{v||!C?f.call(this,v):(a.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},m.actor&&m.actor.send("loadTile",a,f.bind(this),void 0,!0))},!0);m.request={cancel:p}}function f(p,v){return delete m.request,m.aborted?i(null):p&&404!==p.status?i(p):(v&&v.resourceTiming&&(m.resourceTiming=v.resourceTiming),this.map._refreshExpiredTiles&&v&&m.setExpiryData(v),m.loadVectorData(v,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(m.reloadCallback&&(this.loadTile(m,m.reloadCallback),m.reloadCallback=null)))}}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.actor&&m.actor.send("abortTile",{uid:m.uid,type:this.type,source:this.id})}unloadTile(m){m.unloadVectorData(),m.actor&&m.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:z,"raster-dem":class extends z{constructor(m,i,u,a){super(m,i,u,a),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(m,i){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function a(f,p){f&&(m.state="errored",i(f)),p&&(m.dem=p,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",i(null))}m.request=l.getImage(this.map._requestManager.transformRequest(u,l.ResourceType.Tile),function(f,p,v,C){if(delete m.request,m.aborted)m.state="unloaded",i(null);else if(f)m.state="errored",i(f);else if(p){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:v,expires:C});const D=l.window.ImageBitmap&&p instanceof l.window.ImageBitmap&&(null==ce&&(ce=l.window.OffscreenCanvas&&new l.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof l.window.createImageBitmap),ce),P=1-(p.width-l.prevPowerOfTwo(p.width))/2;P<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const F=D?p:l.exported.getImageData(p,P),W={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:F,encoding:this.encoding,padding:P};m.actor&&"expired"!==m.state||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",W,a.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const i=m.canonical,u=Math.pow(2,i.z),a=(i.x-1+u)%u,f=0===i.x?m.wrap-1:m.wrap,p=(i.x+1+u)%u,v=i.x+1===u?m.wrap+1:m.wrap,C={};return C[new l.OverscaledTileID(m.overscaledZ,f,i.z,a,i.y).key]={backfilled:!1},C[new l.OverscaledTileID(m.overscaledZ,v,i.z,p,i.y).key]={backfilled:!1},i.y>0&&(C[new l.OverscaledTileID(m.overscaledZ,f,i.z,a,i.y-1).key]={backfilled:!1},C[new l.OverscaledTileID(m.overscaledZ,m.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},C[new l.OverscaledTileID(m.overscaledZ,v,i.z,p,i.y-1).key]={backfilled:!1}),i.y+1<u&&(C[new l.OverscaledTileID(m.overscaledZ,f,i.z,a,i.y+1).key]={backfilled:!1},C[new l.OverscaledTileID(m.overscaledZ,m.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},C[new l.OverscaledTileID(m.overscaledZ,v,i.z,p,i.y+1).key]={backfilled:!1}),C}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends l.Evented{constructor(m,i,u,a){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(a),this._data=i.data,this._options=l.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const f=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*f,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*f,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:l.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*f,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},i),this}getClusterChildren(m,i){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},i),this}getClusterLeaves(m,i,u,a){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:i,offset:u},a),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new l.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=l.extend({},this.workerOptions),i=this._data;"string"==typeof i?(m.request=this.map._requestManager.transformRequest(l.exported.resolveURL(i),l.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(u,a)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new l.ErrorEvent(u));else{const f={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&a&&a.resourceTiming&&a.resourceTiming[this.id]&&(f.resourceTiming=a.resourceTiming[this.id]),this.fire(new l.Event("data",f)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,i){const u=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(u,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(a,f)=>(delete m.request,m.unloadVectorData(),m.aborted?i(null):a?i(a):(m.loadVectorData(f,this.map.painter,"reloadTile"===u),i(null))),void 0,"loadTile"===u)}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends tt{constructor(m,i,u,a){super(m,i,u,a),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const i of m.urls)this.urls.push(this.map._requestManager.transformRequest(i,l.ResourceType.Source).url);l.getVideo(this.urls,(i,u)=>{this._loaded=!0,i?this.fire(new l.ErrorEvent(i)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const i=this.video.seekable;m<i.start(0)||m>i.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const m=this.map.painter.context,i=m.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new l.Texture(m,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:tt,canvas:class extends tt{constructor(m,i,u,a){super(m,i,u,a),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(f=>!Array.isArray(f)||2!==f.length||f.some(p=>"number"!=typeof p))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof l.window.HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof l.window.HTMLCanvasElement?this.options.canvas:l.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends l.Evented{constructor(m,i,u,a){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=i,this.setEventedParent(a),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new l.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new l.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new kt(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),l.extend(this,l.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return l.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:i,y:u,z:a}=m.canonical;return this._implementation.hasTile({x:i,y:u,z:a})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,i){const{x:u,y:a,z:f}=m.tileID.canonical,p=new l.window.AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:u,y:a,z:f},{signal:p.signal})).then(function(v){return delete m.request,m.aborted?(m.state="unloaded",i(null)):void 0===v?(m.state="errored",i(null)):null===v?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",i(null)):(C=v)instanceof l.window.ImageData||C instanceof l.window.HTMLCanvasElement||C instanceof l.window.ImageBitmap||C instanceof l.window.HTMLImageElement?(this.loadTileData(m,v),m.state="loaded",void i(null)):(m.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var C}.bind(this)).catch(v=>{20!==v.code&&(m.state="errored",i(v))}),m.request.cancel=()=>p.abort()}loadTileData(m,i){z.loadTileData(m,i,this._map.painter)}unloadTileData(m){z.unloadTileData(m,this._map.painter)}unloadTile(m,i){if(this.unloadTileData(m),this._implementation.unloadTile){const{x:u,y:a,z:f}=m.tileID.canonical;this._implementation.unloadTile({x:u,y:a,z:f})}i()}abortTile(m,i){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))}}},At=function(m,i,u,a){const f=new Rt[i.type](m,i,u,a);if(f.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${f.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],f),f};function ye(m,i){const u=l.identity([]);return l.scale(u,u,[.5*m.width,.5*-m.height,1]),l.translate(u,u,[1,-1,0]),l.multiply(u,u,m.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(u)}function be(m,i,u,a,f,p,v,C=!1){const D=m.tilesIn(a,v,C);D.sort(dt);const P=[];for(const W of D)P.push({wrappedTileID:W.tile.tileID.wrapped().key,queryResults:W.tile.queryRenderedFeatures(i,u,m._state,W,f,p,ye(m.transform,W.tile.tileID),C)});const F=function(W){const ue={},Te={};for(const Re of W){const je=Re.queryResults,Le=Re.wrappedTileID,Fe=Te[Le]=Te[Le]||{};for(const qe in je){const Ze=je[qe],rt=Fe[qe]=Fe[qe]||{},_t=ue[qe]=ue[qe]||[];for(const xt of Ze)rt[xt.featureIndex]||(rt[xt.featureIndex]=!0,_t.push(xt))}}return ue}(P);for(const W in F)F[W].forEach(ue=>{const Te=ue.feature,Re=Te.layer;Re&&"background"!==Re.type&&"sky"!==Re.type&&(Te.source=Re.source,Re["source-layer"]&&(Te.sourceLayer=Re["source-layer"]),Te.state=void 0!==Te.id?m.getFeatureState(Re["source-layer"],Te.id):{})});return F}function De(m,i){const u=m.getRenderableIds().map(p=>m.getTileByID(p)),a=[],f={};for(let p=0;p<u.length;p++){const v=u[p],C=v.tileID.canonical.key;f[C]||(f[C]=!0,v.querySourceFeatures(a,i))}return a}function dt(m,i){const u=m.tileID,a=i.tileID;return u.overscaledZ-a.overscaledZ||u.canonical.y-a.canonical.y||u.wrap-a.wrap||u.canonical.x-a.canonical.x}function pt(){return null!=Qa.workerClass?new Qa.workerClass:new l.window.Worker(Qa.workerUrl)}const on="mapboxgl_preloaded_worker_pool";class Dn{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Dn.workerCount;)this.workers.push(new pt);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[on]}numActive(){return Object.keys(this.active).length}}let Nn;function Wn(){return Nn||(Nn=new Dn),Nn}function Ei(m,i){const u={};for(const a in m)"ref"!==a&&(u[a]=m[a]);return l.refProperties.forEach(a=>{a in i&&(u[a]=i[a])}),u}function di(m){m=m.slice();const i=Object.create(null);for(let u=0;u<m.length;u++)i[m[u].id]=m[u];for(let u=0;u<m.length;u++)"ref"in m[u]&&(m[u]=Ei(m[u],i[m[u].ref]));return m}Dn.workerCount=2;const Hn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Vi(m,i,u){u.push({command:Hn.addSource,args:[m,i[m]]})}function ki(m,i,u){i.push({command:Hn.removeSource,args:[m]}),u[m]=!0}function Gr(m,i,u,a){ki(m,u,a),Vi(m,i,u)}function Tr(m,i,u){let a;for(a in m[u])if(m[u].hasOwnProperty(a)&&"data"!==a&&!q(m[u][a],i[u][a]))return!1;for(a in i[u])if(i[u].hasOwnProperty(a)&&"data"!==a&&!q(m[u][a],i[u][a]))return!1;return!0}function Or(m,i,u,a,f,p){let v;for(v in i=i||{},m=m||{})m.hasOwnProperty(v)&&(q(m[v],i[v])||u.push({command:p,args:[a,v,i[v],f]}));for(v in i)i.hasOwnProperty(v)&&!m.hasOwnProperty(v)&&(q(m[v],i[v])||u.push({command:p,args:[a,v,i[v],f]}))}function Xt(m){return m.id}function no(m,i){return m[i.id]=i,m}class vr{constructor(i,u){this.reset(i,u)}reset(i,u){this.points=i||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(1===this.points.length)return this.points[0];i=l.clamp(i,0,1);let u=1,a=this._distances[u];const f=i*this.paddedLength+this.padding;for(;a<f&&u<this._distances.length;)a=this._distances[++u];const p=u-1,v=this._distances[p],C=a-v,D=C>0?(f-v)/C:0;return this.points[p].mult(1-D).add(this.points[u].mult(D))}}class eo{constructor(i,u,a){const f=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(i/a),this.yCellCount=Math.ceil(u/a);for(let v=0;v<this.xCellCount*this.yCellCount;v++)f.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=u,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,u,a,f,p){this._forEachCell(u,a,f,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(u),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(p)}insertCircle(i,u,a,f){this._forEachCell(u-f,a-f,u+f,a+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(u),this.circles.push(a),this.circles.push(f)}_insertBoxCell(i,u,a,f,p,v){this.boxCells[p].push(v)}_insertCircleCell(i,u,a,f,p,v){this.circleCells[p].push(v)}_query(i,u,a,f,p,v){if(a<0||i>this.width||f<0||u>this.height)return!p&&[];const C=[];if(i<=0&&u<=0&&this.width<=a&&this.height<=f){if(p)return!0;for(let D=0;D<this.boxKeys.length;D++)C.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const P=this.circles[3*D],F=this.circles[3*D+1],W=this.circles[3*D+2];C.push({key:this.circleKeys[D],x1:P-W,y1:F-W,x2:P+W,y2:F+W})}return v?C.filter(v):C}return this._forEachCell(i,u,a,f,this._queryCell,C,{hitTest:p,seenUids:{box:{},circle:{}}},v),p?C.length>0:C}_queryCircle(i,u,a,f,p){const v=i-a,C=i+a,D=u-a,P=u+a;if(C<0||v>this.width||P<0||D>this.height)return!f&&[];const F=[];return this._forEachCell(v,D,C,P,this._queryCellCircle,F,{hitTest:f,circle:{x:i,y:u,radius:a},seenUids:{box:{},circle:{}}},p),f?F.length>0:F}query(i,u,a,f,p){return this._query(i,u,a,f,!1,p)}hitTest(i,u,a,f,p){return this._query(i,u,a,f,!0,p)}hitTestCircle(i,u,a,f){return this._queryCircle(i,u,a,!0,f)}_queryCell(i,u,a,f,p,v,C,D){const P=C.seenUids,F=this.boxCells[p];if(null!==F){const ue=this.bboxes;for(const Te of F)if(!P.box[Te]){P.box[Te]=!0;const Re=4*Te;if(i<=ue[Re+2]&&u<=ue[Re+3]&&a>=ue[Re+0]&&f>=ue[Re+1]&&(!D||D(this.boxKeys[Te]))){if(C.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[Te],x1:ue[Re],y1:ue[Re+1],x2:ue[Re+2],y2:ue[Re+3]})}}}const W=this.circleCells[p];if(null!==W){const ue=this.circles;for(const Te of W)if(!P.circle[Te]){P.circle[Te]=!0;const Re=3*Te;if(this._circleAndRectCollide(ue[Re],ue[Re+1],ue[Re+2],i,u,a,f)&&(!D||D(this.circleKeys[Te]))){if(C.hitTest)return v.push(!0),!0;{const je=ue[Re],Le=ue[Re+1],Fe=ue[Re+2];v.push({key:this.circleKeys[Te],x1:je-Fe,y1:Le-Fe,x2:je+Fe,y2:Le+Fe})}}}}}_queryCellCircle(i,u,a,f,p,v,C,D){const P=C.circle,F=C.seenUids,W=this.boxCells[p];if(null!==W){const Te=this.bboxes;for(const Re of W)if(!F.box[Re]){F.box[Re]=!0;const je=4*Re;if(this._circleAndRectCollide(P.x,P.y,P.radius,Te[je+0],Te[je+1],Te[je+2],Te[je+3])&&(!D||D(this.boxKeys[Re])))return v.push(!0),!0}}const ue=this.circleCells[p];if(null!==ue){const Te=this.circles;for(const Re of ue)if(!F.circle[Re]){F.circle[Re]=!0;const je=3*Re;if(this._circlesCollide(Te[je],Te[je+1],Te[je+2],P.x,P.y,P.radius)&&(!D||D(this.circleKeys[Re])))return v.push(!0),!0}}}_forEachCell(i,u,a,f,p,v,C,D){const P=this._convertToXCellCoord(i),F=this._convertToYCellCoord(u),W=this._convertToXCellCoord(a),ue=this._convertToYCellCoord(f);for(let Te=P;Te<=W;Te++)for(let Re=F;Re<=ue;Re++)if(p.call(this,i,u,a,f,this.xCellCount*Re+Te,v,C,D))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,u,a,f,p,v){const C=f-i,D=p-u,P=a+v;return P*P>C*C+D*D}_circleAndRectCollide(i,u,a,f,p,v,C){const D=(v-f)/2,P=Math.abs(i-(f+D));if(P>D+a)return!1;const F=(C-p)/2,W=Math.abs(u-(p+F));if(W>F+a)return!1;if(P<=D||W<=F)return!0;const ue=P-D,Te=W-F;return ue*ue+Te*Te<=a*a}}const wo=Math.tan(85*Math.PI/180);function mi(m,i,u,a,f,p,v){const C=l.create();if(u)if("globe"===p.name){const D=l.calculateGlobeLabelMatrix(f,i);l.multiply(C,C,D)}else{const D=_e([],v);C[0]=D[0],C[1]=D[1],C[4]=D[2],C[5]=D[3],a||l.rotateZ(C,C,f.angle)}else l.multiply(C,f.labelPlaneMatrix,m);return C}function Qi(m,i,u,a,f,p,v){const C=mi(m,i,u,a,f,p,v);return"globe"===p.name&&u||(C[2]=C[6]=C[10]=C[14]=0),C}function Er(m,i,u,a,f,p,v){if(u){if("globe"===p.name){const C=mi(m,i,u,a,f,p,v);return l.invert(C,C),l.multiply(C,m,C),C}{const C=l.clone(m),D=l.identity([]);return D[0]=v[0],D[1]=v[1],D[4]=v[2],D[5]=v[3],l.multiply(C,C,D),a||l.rotateZ(C,C,-f.angle),C}}return f.glCoordMatrix}function mr(m,i,u,a){const f=[m,i,u,1];u?l.transformMat4$1(f,f,a):Ft(f,f,a);const p=f[3];return f[0]/=p,f[1]/=p,f[2]/=p,f}function Rn(m,i){return Math.min(.5+m/i*.5,1.5)}function oi(m,i){const u=m[0]/m[3],a=m[1]/m[3];return u>=-i[0]&&u<=i[0]&&a>=-i[1]&&a<=i[1]}function Cn(m,i,u,a,f,p,v,C,D,P){const F=u.transform,W=a?m.textSizeData:m.iconSizeData,ue=l.evaluateSizeForZoom(W,u.transform.zoom),Te="globe"===F.projection.name,Re=[256/u.width*2+1,256/u.height*2+1],je=a?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;je.clear();let Le=null;Te&&(Le=a?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const Fe=m.lineVertexArray,qe=a?m.text.placedSymbolArray:m.icon.placedSymbolArray,Ze=u.transform.width/u.transform.height;let rt,_t=!1;for(let xt=0;xt<qe.length;xt++){const Lt=qe.get(xt),{numGlyphs:en,writingMode:Wt}=Lt;if(Wt!==l.WritingMode.vertical||_t||rt===l.WritingMode.horizontal||(_t=!0),rt=Wt,(Lt.hidden||Wt===l.WritingMode.vertical)&&!_t){ft(en,je);continue}_t=!1;const Ut=new l.pointGeometry(Lt.tileAnchorX,Lt.tileAnchorY);let{x:Ln,y:Ht,z:fn}=F.projection.projectTilePoint(Ut.x,Ut.y,P.canonical);if(D){const[hi,Qn,Ci]=D(Ut);Ln+=hi,Ht+=Qn,fn+=Ci}const tn=[Ln,Ht,fn,1];if(l.transformMat4$1(tn,tn,i),!oi(tn,Re)){ft(en,je);continue}const An=Rn(u.transform.cameraToCenterDistance,tn[3]),ln=l.evaluateSizeForFeature(W,ue,Lt),xn=v?ln/An:ln*An,kn=mr(Ln,Ht,fn,f);if(kn[3]<=0){ft(en,je);continue}let $t={};const rn=v?null:D,ni=ct(Lt,xn,!1,C,i,f,p,m.glyphOffsetArray,Fe,je,Le,kn,Ut,$t,Ze,rn,F.projection,P,v);_t=ni.useVertical,rn&&ni.needsFlipping&&($t={}),(ni.notEnoughRoom||_t||ni.needsFlipping&&ct(Lt,xn,!0,C,i,f,p,m.glyphOffsetArray,Fe,je,Le,kn,Ut,$t,Ze,rn,F.projection,P,v).notEnoughRoom)&&ft(en,je)}a?(m.text.dynamicLayoutVertexBuffer.updateData(je),Le&&m.text.globeExtVertexBuffer.updateData(Le)):(m.icon.dynamicLayoutVertexBuffer.updateData(je),Le&&m.icon.globeExtVertexBuffer.updateData(Le))}function me(m,i,u,a,f,p,v,C,D,P,F,W,ue,Te,Re,je){const{lineStartIndex:Le,glyphStartIndex:Fe,segment:qe}=C,Ze=Fe+C.numGlyphs,rt=Le+C.lineLength,_t=i.getoffsetX(Fe),xt=i.getoffsetX(Ze-1),Lt=$e(m*_t,u,a,f,p,v,qe,Le,rt,D,P,F,W,ue,!0,Te,Re,je);if(!Lt)return null;const en=$e(m*xt,u,a,f,p,v,qe,Le,rt,D,P,F,W,ue,!0,Te,Re,je);return en?{first:Lt,last:en}:null}function Ge(m,i,u,a){return m===l.WritingMode.horizontal&&Math.abs(a)>Math.abs(u)?{useVertical:!0}:m===l.WritingMode.vertical?a>0?{needsFlipping:!0}:null:0!==i&&(0===(f=u)||Math.abs(a/f)>wo)?1===i?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null;var f}function ct(m,i,u,a,f,p,v,C,D,P,F,W,ue,Te,Re,je,Le,Fe,qe){const Ze=i/24,rt=m.lineOffsetX*Ze,_t=m.lineOffsetY*Ze,{lineStartIndex:xt,glyphStartIndex:Lt,numGlyphs:en,segment:Wt,writingMode:Ut,flipState:Ln}=m,Ht=xt+m.lineLength,fn=tn=>{if(F){const[kn,$t,rn]=tn.up,ni=P.length;l.updateGlobeVertexNormal(F,ni+0,kn,$t,rn),l.updateGlobeVertexNormal(F,ni+1,kn,$t,rn),l.updateGlobeVertexNormal(F,ni+2,kn,$t,rn),l.updateGlobeVertexNormal(F,ni+3,kn,$t,rn)}const[An,ln,xn]=tn.point;l.addDynamicAttributes(P,An,ln,xn,tn.angle)};if(en>1){const tn=me(Ze,C,rt,_t,u,W,ue,m,D,p,Te,je,!1,Le,Fe,qe);if(!tn)return{notEnoughRoom:!0};if(a&&!u){let[An,ln,xn]=tn.first.point,[kn,$t,rn]=tn.last.point;[An,ln]=mr(An,ln,xn,v),[kn,$t]=mr(kn,$t,rn,v);const ni=Ge(Ut,Ln,(kn-An)*Re,$t-ln);if(m.flipState=ni&&ni.needsFlipping?1:2,ni)return ni}fn(tn.first);for(let An=Lt+1;An<Lt+en-1;An++){const ln=$e(Ze*C.getoffsetX(An),rt,_t,u,W,ue,Wt,xt,Ht,D,p,Te,je,!1,!1,Le,Fe,qe);if(!ln)return P.length-=4*(An-Lt),{notEnoughRoom:!0};fn(ln)}fn(tn.last)}else{if(a&&!u){const An=mr(ue.x,ue.y,0,f),ln=xt+Wt+1,xn=new l.pointGeometry(D.getx(ln),D.gety(ln)),kn=mr(xn.x,xn.y,0,f),$t=kn[3]>0?kn:Yt(ue,xn,An,1,f,void 0,Le,Fe.canonical),rn=Ge(Ut,Ln,($t[0]-An[0])*Re,$t[1]-An[1]);if(m.flipState=rn&&rn.needsFlipping?1:2,rn)return rn}const tn=$e(Ze*C.getoffsetX(Lt),rt,_t,u,W,ue,Wt,xt,Ht,D,p,Te,je,!1,!1,Le,Fe,qe);if(!tn)return{notEnoughRoom:!0};fn(tn)}return{}}function zt(m,i,u,a,f){const{x:p,y:v,z:C}=a.projectTilePoint(m.x,m.y,i);if(!f)return mr(p,v,C,u);const[D,P,F]=f(m);return mr(p+D,v+P,C+F,u)}function Yt(m,i,u,a,f,p,v,C){const D=zt(m.sub(i)._unit()._add(m),C,f,v,p);return l.sub(D,u,D),l.normalize(D,D),l.scaleAndAdd(D,u,D,a)}function $e(m,i,u,a,f,p,v,C,D,P,F,W,ue,Te,Re,je,Le,Fe){const qe=a?m-i:m+i;let Ze=qe>0?1:-1,rt=0;a&&(Ze*=-1,rt=Math.PI),Ze<0&&(rt+=Math.PI);let _t=C+v+(Ze>0?0:1)|0,xt=f,Lt=f,en=0,Wt=0;const Ut=Math.abs(qe),Ln=[],Ht=[];let fn=p,tn=fn;const An=()=>Yt(tn,fn,Lt,Ut-en+1,F,ue,je,Le.canonical);for(;en+Wt<=Ut;){if(_t+=Ze,_t<C||_t>=D)return null;if(Lt=xt,tn=fn,Ln.push(Lt),Te&&Ht.push(tn),fn=new l.pointGeometry(P.getx(_t),P.gety(_t)),xt=W[_t],!xt){const Ci=zt(fn,Le.canonical,F,je,ue);xt=Ci[3]>0?W[_t]=Ci:An()}en+=Wt,Wt=l.distance(Lt,xt)}Re&&ue&&(W[_t]&&(xt=An(),Wt=l.distance(Lt,xt)),W[_t]=xt);const ln=(Ut-en)/Wt,xn=fn.sub(tn)._mult(ln)._add(tn),kn=l.sub([],xt,Lt),$t=l.scaleAndAdd([],Lt,kn,ln);let rn=[0,0,1],ni=kn[0],hi=kn[1];if(Fe&&(rn=je.upVector(Le.canonical,xn.x,xn.y),0!==rn[0]||0!==rn[1]||1!==rn[2])){const Ci=[rn[2],0,-rn[0]],Zi=l.cross([],rn,Ci);l.normalize(Ci,Ci),l.normalize(Zi,Zi),ni=l.dot(kn,Ci),hi=l.dot(kn,Zi)}if(u){const Ci=l.cross([],rn,kn);l.normalize(Ci,Ci),l.scaleAndAdd($t,$t,Ci,u*Ze)}const Qn=rt+Math.atan2(hi,ni);return Ln.push($t),Te&&Ht.push(xn),{point:$t,angle:Qn,path:Ln,tilePath:Ht,up:rn}}function ft(m,i){const u=i.length,a=u+4*m;i.resize(a),i.float32.fill(-1/0,4*u,4*a)}function Ft(m,i,u){const a=i[0],f=i[1];return m[0]=u[0]*a+u[4]*f+u[12],m[1]=u[1]*a+u[5]*f+u[13],m[3]=u[3]*a+u[7]*f+u[15],m}const hn=100;class Jt{constructor(i,u,a=new eo(i.width+200,i.height+200,25),f=new eo(i.width+200,i.height+200,25)){this.transform=i,this.grid=a,this.ignoredGrid=f,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+hn,this.screenBottomBoundary=i.height+hn,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=u}placeCollisionBox(i,u,a,f,p,v,C,D){let P=a.projectedAnchorX,F=a.projectedAnchorY,W=a.projectedAnchorZ;const ue=a.elevation,Te=a.tileID,Re=i.getProjection();if(ue&&Te){const[xt,Lt,en]=Re.upVector(Te.canonical,a.tileAnchorX,a.tileAnchorY),Wt=Re.upVectorScale(Te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=xt*ue*Wt,F+=Lt*ue*Wt,W+=en*ue*Wt}const je=this.projectAndGetPerspectiveRatio(C,P,F,W,a.tileID,"globe"===Re.name||!!ue||this.transform.pitch>0,Re),Le=v*je.perspectiveRatio,Fe=(a.x1*u+f.x-a.padding)*Le+je.point.x,qe=(a.y1*u+f.y-a.padding)*Le+je.point.y,Ze=(a.x2*u+f.x+a.padding)*Le+je.point.x,rt=(a.y2*u+f.y+a.padding)*Le+je.point.y,_t=je.perspectiveRatio<=.55||je.occluded;return!this.isInsideGrid(Fe,qe,Ze,rt)||!p&&this.grid.hitTest(Fe,qe,Ze,rt,D)||_t?{box:[],offscreen:!1,occluded:je.occluded}:{box:[Fe,qe,Ze,rt],offscreen:this.isOffscreen(Fe,qe,Ze,rt),occluded:!1}}placeCollisionCircles(i,u,a,f,p,v,C,D,P,F,W,ue,Te,Re,je){const Le=[],Fe=this.transform.elevation,qe=i.getProjection(),Ze=Fe?Fe.getAtTileOffsetFunc(je,this.transform.center.lat,this.transform.worldSize,qe):null,rt=new l.pointGeometry(a.tileAnchorX,a.tileAnchorY);let{x:_t,y:xt,z:Lt}=qe.projectTilePoint(rt.x,rt.y,je.canonical);if(Ze){const[xn,kn,$t]=Ze(rt);_t+=xn,xt+=kn,Lt+=$t}const en="globe"===qe.name,Wt=this.projectAndGetPerspectiveRatio(C,_t,xt,Lt,je,en||!!Fe||this.transform.pitch>0,qe),{perspectiveRatio:Ut}=Wt,Ln=(W?v/Ut:v*Ut)/l.ONE_EM,Ht=mr(_t,xt,Lt,D),fn=Wt.signedDistanceFromCamera>0?me(Ln,p,a.lineOffsetX*Ln,a.lineOffsetY*Ln,!1,Ht,rt,a,f,D,{},Fe&&!W?Ze:null,W&&!!Fe,qe,je,W):null;let tn=!1,An=!1,ln=!0;if(fn&&!Wt.occluded){const xn=.5*Te*Ut+Re,kn=new l.pointGeometry(-100,-100),$t=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),rn=new vr,{first:ni,last:hi}=fn,Qn=ni.path.length;let Ci=[];for(let Xn=Qn-1;Xn>=1;Xn--)Ci.push(ni.path[Xn]);for(let Xn=1;Xn<hi.path.length;Xn++)Ci.push(hi.path[Xn]);const Zi=2.5*xn;P&&(Ci=Ci.map(([Xn,Ir,br],Br)=>(Ze&&!en&&(br=Ze(Br<Qn-1?ni.tilePath[Qn-1-Br]:hi.tilePath[Br-Qn+2])[2]),mr(Xn,Ir,br,P))),Ci.some(Xn=>Xn[3]<=0)&&(Ci=[]));let ui=[];if(Ci.length>0){let Xn=1/0,Ir=-1/0,br=1/0,Br=-1/0;for(const Lr of Ci)Xn=Math.min(Xn,Lr[0]),br=Math.min(br,Lr[1]),Ir=Math.max(Ir,Lr[0]),Br=Math.max(Br,Lr[1]);Ir>=kn.x&&Xn<=$t.x&&Br>=kn.y&&br<=$t.y&&(ui=[Ci.map(Lr=>new l.pointGeometry(Lr[0],Lr[1]))],(Xn<kn.x||Ir>$t.x||br<kn.y||Br>$t.y)&&(ui=l.clipLine(ui,kn.x,kn.y,$t.x,$t.y)))}for(const Xn of ui){rn.reset(Xn,.25*xn);let Ir=0;Ir=rn.length<=.5*xn?1:Math.ceil(rn.paddedLength/Zi)+1;for(let br=0;br<Ir;br++){const Br=br/Math.max(Ir-1,1),Lr=rn.lerp(Br),ps=Lr.x+hn,ba=Lr.y+hn;Le.push(ps,ba,xn,0);const Us=ps-xn,wa=ba-xn,Kr=ps+xn,Vr=ba+xn;if(ln=ln&&this.isOffscreen(Us,wa,Kr,Vr),An=An||this.isInsideGrid(Us,wa,Kr,Vr),!u&&this.grid.hitTestCircle(ps,ba,xn,ue)&&(tn=!0,!F))return{circles:[],offscreen:!1,collisionDetected:tn,occluded:!1}}}}return{circles:!F&&tn||!An?[]:Le,offscreen:ln,collisionDetected:tn,occluded:Wt.occluded}}queryRenderedSymbols(i){if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let a=1/0,f=1/0,p=-1/0,v=-1/0;for(const F of i){const W=new l.pointGeometry(F.x+hn,F.y+hn);a=Math.min(a,W.x),f=Math.min(f,W.y),p=Math.max(p,W.x),v=Math.max(v,W.y),u.push(W)}const C=this.grid.query(a,f,p,v).concat(this.ignoredGrid.query(a,f,p,v)),D={},P={};for(const F of C){const W=F.key;if(void 0===D[W.bucketInstanceId]&&(D[W.bucketInstanceId]={}),D[W.bucketInstanceId][W.featureIndex])continue;const ue=[new l.pointGeometry(F.x1,F.y1),new l.pointGeometry(F.x2,F.y1),new l.pointGeometry(F.x2,F.y2),new l.pointGeometry(F.x1,F.y2)];l.polygonIntersectsPolygon(u,ue)&&(D[W.bucketInstanceId][W.featureIndex]=!0,void 0===P[W.bucketInstanceId]&&(P[W.bucketInstanceId]=[]),P[W.bucketInstanceId].push(W.featureIndex))}return P}insertCollisionBox(i,u,a,f,p){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:a,featureIndex:f,collisionGroupID:p},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,u,a,f,p){const v=u?this.ignoredGrid:this.grid,C={bucketInstanceId:a,featureIndex:f,collisionGroupID:p};for(let D=0;D<i.length;D+=4)v.insertCircle(C,i[D],i[D+1],i[D+2])}projectAndGetPerspectiveRatio(i,u,a,f,p,v,C){const D=[u,a,f,1];let P=!1;f||this.transform.pitch>0?(l.transformMat4$1(D,D,i),this.fogState&&p&&"globe"!==C.name&&(P=function(Te,Re,je,Le,Fe,qe){const Ze=qe.calculateFogTileMatrix(Fe),rt=[Re,je,Le];return l.transformMat4(rt,rt,Ze),Ee(Te,rt,qe.pitch,qe._fov)}(this.fogState,u,a,f,p.toUnwrapped(),this.transform)>.9)):Ft(D,D,i);const F=D[3];return{point:new l.pointGeometry((D[0]/F+1)/2*this.transform.width+hn,(-D[1]/F+1)/2*this.transform.height+hn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/F*.5,1.5),signedDistanceFromCamera:F,occluded:v&&D[2]>F||P}}isOffscreen(i,u,a,f){return a<hn||i>=this.screenRightBoundary||f<hn||u>this.screenBottomBoundary}isInsideGrid(i,u,a,f){return a>=0&&i<this.gridRightBoundary&&f>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const i=l.identity([]);return l.translate(i,i,[-100,-100,0]),i}}function Vn(m,i,u){const a=i.createTileMatrix(m,m.worldSize,u.toUnwrapped());return l.multiply(new Float32Array(16),m.projMatrix,a)}function Yn(m,i,u){if(i.projection.name===u.projection.name)return m.projMatrix;const a=u.clone();return a.setProjection(i.projection),Vn(a,i.getProjection(),m)}function Mi(m,i,u){return i.name===u.projection.name?m.projMatrix:Vn(u,i,m)}class Bi{constructor(i,u,a,f){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?u:-u))):f&&a?1:0,this.placed=a}isHidden(){return 0===this.opacity&&!this.placed}}class Ni{constructor(i,u,a,f,p,v=!1){this.text=new Bi(i?i.text:null,u,a,p),this.icon=new Bi(i?i.icon:null,u,f,p),this.clipped=v}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Nr{constructor(i,u,a,f=!1){this.text=i,this.icon=u,this.skipFade=a,this.clipped=f}}class ir{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class Hr{constructor(i,u,a,f,p){this.bucketInstanceId=i,this.featureIndex=u,this.sourceLayerIndex=a,this.bucketIndex=f,this.tileID=p}}class zr{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const u=++this.maxGroupID;this.collisionGroups[i]={ID:u,predicate:a=>a.collisionGroupID===u}}return this.collisionGroups[i]}}function lr(m,i,u,a,f){const{horizontalAlign:p,verticalAlign:v}=l.getAnchorAlignment(m),C=-(p-.5)*i,D=-(v-.5)*u,P=l.evaluateVariableOffset(m,a);return new l.pointGeometry(C+P[0]*f,D+P[1]*f)}function or(m,i,u,a,f){const p=new l.pointGeometry(m,i);return u&&p._rotate(a?f:-f),p}class Wa{constructor(i,u,a,f,p){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new Jt(this.transform,p),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new zr(a),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,u,a,f){const p=a.getBucket(u),v=a.latestFeatureIndex;if(!p||!v||u.id!==p.layerIds[0])return;const C=p.layers[0].layout,D=a.collisionBoxArray,P=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),F=a.tileSize/l.EXTENT,W=a.tileID.toUnwrapped();this.transform.setProjection(p.projection);const ue=(Te=a.tileID,Re=p.getProjection(),je=this.transform,Re.name===this.projection?je.calculateProjMatrix(Te.toUnwrapped()):Vn(je,Re,Te));var Te,Re,je;const Le="map"===C.get("text-pitch-alignment"),Fe="map"===C.get("text-rotation-alignment");u.compileFilter();const qe=u.dynamicFilter(),Ze=u.dynamicFilterNeedsFeature(),rt=this.transform.calculatePixelsToTileUnitsMatrix(a),_t=Qi(ue,a.tileID.canonical,Le,Fe,this.transform,p.getProjection(),rt);let xt=null;if(Le){const Wt=Er(ue,a.tileID.canonical,Le,Fe,this.transform,p.getProjection(),rt);xt=l.multiply([],this.transform.labelPlaneMatrix,Wt)}let Lt=null;qe&&a.latestFeatureIndex&&(Lt={unwrappedTileID:W,dynamicFilter:qe,dynamicFilterNeedsFeature:Ze,featureIndex:a.latestFeatureIndex}),this.retainedQueryData[p.bucketInstanceId]=new Hr(p.bucketInstanceId,v,p.sourceLayerIndex,p.index,a.tileID);const en={bucket:p,layout:C,posMatrix:ue,textLabelPlaneMatrix:_t,labelToScreenMatrix:xt,clippingData:Lt,scale:P,textPixelRatio:F,holdingForFade:a.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(p.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:l.evaluateSizeForZoom(p.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(f)for(const Wt of p.sortKeyRanges){const{sortKey:Ut,symbolInstanceStart:Ln,symbolInstanceEnd:Ht}=Wt;i.push({sortKey:Ut,symbolInstanceStart:Ln,symbolInstanceEnd:Ht,parameters:en})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:en})}attemptAnchorPlacement(i,u,a,f,p,v,C,D,P,F,W,ue,Te,Re,je,Le,Fe,qe){const{textOffset0:Ze,textOffset1:rt,crossTileID:_t}=ue,xt=[Ze,rt],Lt=lr(i,a,f,xt,p),en=this.collisionIndex.placeCollisionBox(Re,p,u,or(Lt.x,Lt.y,v,C,this.transform.angle),W,D,P,F.predicate);if(Le){const Wt=Re.getSymbolInstanceIconSize(qe,this.transform.zoom,ue.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(Re,Wt,Le,or(Lt.x,Lt.y,v,C,this.transform.angle),W,D,P,F.predicate).box.length)return}if(en.box.length>0){let Wt;return this.prevPlacement&&this.prevPlacement.variableOffsets[_t]&&this.prevPlacement.placements[_t]&&this.prevPlacement.placements[_t].text&&(Wt=this.prevPlacement.variableOffsets[_t].anchor),this.variableOffsets[_t]={textOffset:xt,width:a,height:f,anchor:i,textScale:p,prevAnchor:Wt},this.markUsedJustification(Re,i,ue,je),Re.allowVerticalPlacement&&(this.markUsedOrientation(Re,je,ue),this.placedOrientations[_t]=je),{shift:Lt,placedGlyphBoxes:en}}}placeLayerBucketPart(i,u,a,f){const{bucket:p,layout:v,posMatrix:C,textLabelPlaneMatrix:D,labelToScreenMatrix:P,clippingData:F,textPixelRatio:W,holdingForFade:ue,collisionBoxArray:Te,partiallyEvaluatedTextSize:Re,partiallyEvaluatedIconSize:je,collisionGroup:Le}=i.parameters,Fe=v.get("text-optional"),qe=v.get("icon-optional"),Ze=v.get("text-allow-overlap"),rt=v.get("icon-allow-overlap"),_t="map"===v.get("text-rotation-alignment"),xt="map"===v.get("text-pitch-alignment"),Lt="none"!==v.get("icon-text-fit"),en="viewport-y"===v.get("symbol-z-order");this.transform.setProjection(p.projection);let Wt=Ze&&(rt||!p.hasIconData()||qe),Ut=rt&&(Ze||!p.hasTextData()||Fe);!p.collisionArrays&&Te&&p.deserializeCollisionBoxes(Te),a&&f&&p.updateCollisionDebugBuffers(this.transform.zoom,Te);const Ln=(Ht,fn,tn)=>{const{crossTileID:An,numVerticalGlyphVertices:ln}=Ht;if(F){const Kr={zoom:this.transform.zoom,pitch:this.transform.pitch};let Vr=null;if(F.dynamicFilterNeedsFeature){const _r=this.retainedQueryData[p.bucketInstanceId];Vr=F.featureIndex.loadFeature({featureIndex:Ht.featureIndex,bucketIndex:_r.bucketIndex,sourceLayerIndex:_r.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,F.dynamicFilter)(Kr,Vr,this.retainedQueryData[p.bucketInstanceId].tileID.canonical,new l.pointGeometry(Ht.tileAnchorX,Ht.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[An]=new Nr(!1,!1,!1,!0),void(u[An]=!0)}if(u[An])return;if(ue)return void(this.placements[An]=new Nr(!1,!1,!1));let xn=!1,kn=!1,$t=!0,rn=!1,ni=!1,hi=null,Qn={box:null,offscreen:null,occluded:null},Ci={box:null,offscreen:null,occluded:null},Zi=null,ui=null,Xn=null,Ir=0,br=0,Br=0;tn.textFeatureIndex?Ir=tn.textFeatureIndex:Ht.useRuntimeCollisionCircles&&(Ir=Ht.featureIndex),tn.verticalTextFeatureIndex&&(br=tn.verticalTextFeatureIndex);const Lr=Kr=>{Kr.tileID=this.retainedQueryData[p.bucketInstanceId].tileID;const Vr=this.transform.elevation;(Vr||Kr.elevation)&&(Kr.elevation=Vr?Vr.getAtTileOffset(Kr.tileID,Kr.tileAnchorX,Kr.tileAnchorY):0)},ps=tn.textBox;if(ps){Lr(ps);const Kr=_r=>{let To=l.WritingMode.horizontal;if(p.allowVerticalPlacement&&!_r&&this.prevPlacement){const Ss=this.prevPlacement.placedOrientations[An];Ss&&(this.placedOrientations[An]=Ss,To=Ss,this.markUsedOrientation(p,To,Ht))}return To},Vr=(_r,To)=>{if(p.allowVerticalPlacement&&ln>0&&tn.verticalTextBox){for(const Ss of p.writingModes)if(Ss===l.WritingMode.vertical?(Qn=To(),Ci=Qn):Qn=_r(),Qn&&Qn.box&&Qn.box.length)break}else Qn=_r()};if(v.get("text-variable-anchor")){let _r=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[An]){const jr=this.prevPlacement.variableOffsets[An];_r.indexOf(jr.anchor)>0&&(_r=_r.filter(fs=>fs!==jr.anchor),_r.unshift(jr.anchor))}const To=(jr,fs,Kl)=>{const el=p.getSymbolInstanceTextSize(Re,Ht,this.transform.zoom,fn),es=(jr.x2-jr.x1)*el+2*jr.padding,ia=(jr.y2-jr.y1)*el+2*jr.padding,ko=Lt&&!rt?fs:null;ko&&Lr(ko);let tl={box:[],offscreen:!1,occluded:!1};const Gc=Ze?2*_r.length:_r.length;for(let Ec=0;Ec<Gc;++Ec){const Na=this.attemptAnchorPlacement(_r[Ec%_r.length],jr,es,ia,el,_t,xt,W,C,Le,Ec>=_r.length,Ht,fn,p,Kl,ko,Re,je);if(Na&&(tl=Na.placedGlyphBoxes,tl&&tl.box&&tl.box.length)){xn=!0,hi=Na.shift;break}}return tl};Vr(()=>To(ps,tn.iconBox,l.WritingMode.horizontal),()=>{const jr=tn.verticalTextBox;return jr&&Lr(jr),p.allowVerticalPlacement&&!(Qn&&Qn.box&&Qn.box.length)&&ln>0&&jr?To(jr,tn.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Qn&&(xn=Qn.box,$t=Qn.offscreen,rn=Qn.occluded);const Ss=Kr(Qn&&Qn.box);if(!xn&&this.prevPlacement){const jr=this.prevPlacement.variableOffsets[An];jr&&(this.variableOffsets[An]=jr,this.markUsedJustification(p,jr.anchor,Ht,Ss))}}else{const _r=(To,Ss)=>{const jr=p.getSymbolInstanceTextSize(Re,Ht,this.transform.zoom,fn),fs=this.collisionIndex.placeCollisionBox(p,jr,To,new l.pointGeometry(0,0),Ze,W,C,Le.predicate);return fs&&fs.box&&fs.box.length&&(this.markUsedOrientation(p,Ss,Ht),this.placedOrientations[An]=Ss),fs};Vr(()=>_r(ps,l.WritingMode.horizontal),()=>{const To=tn.verticalTextBox;return p.allowVerticalPlacement&&ln>0&&To?(Lr(To),_r(To,l.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Kr(Qn&&Qn.box&&Qn.box.length)}}if(Zi=Qn,xn=Zi&&Zi.box&&Zi.box.length>0,$t=Zi&&Zi.offscreen,rn=Zi&&Zi.occluded,Ht.useRuntimeCollisionCircles){const Kr=p.text.placedSymbolArray.get(Ht.centerJustifiedTextSymbolIndex>=0?Ht.centerJustifiedTextSymbolIndex:Ht.verticalPlacedTextSymbolIndex),Vr=l.evaluateSizeForFeature(p.textSizeData,Re,Kr),_r=v.get("text-padding");ui=this.collisionIndex.placeCollisionCircles(p,Ze,Kr,p.lineVertexArray,p.glyphOffsetArray,Vr,C,D,P,a,xt,Le.predicate,Ht.collisionCircleDiameter*Vr/l.ONE_EM,_r,this.retainedQueryData[p.bucketInstanceId].tileID),xn=Ze||ui.circles.length>0&&!ui.collisionDetected,$t=$t&&ui.offscreen,rn=ui.occluded}if(tn.iconFeatureIndex&&(Br=tn.iconFeatureIndex),tn.iconBox){const Kr=Vr=>{Lr(Vr);const _r=Lt&&hi?or(hi.x,hi.y,_t,xt,this.transform.angle):new l.pointGeometry(0,0),To=p.getSymbolInstanceIconSize(je,this.transform.zoom,Ht.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(p,To,Vr,_r,rt,W,C,Le.predicate)};Ci&&Ci.box&&Ci.box.length&&tn.verticalIconBox?(Xn=Kr(tn.verticalIconBox),kn=Xn.box.length>0):(Xn=Kr(tn.iconBox),kn=Xn.box.length>0),$t=$t&&Xn.offscreen,ni=Xn.occluded}const ba=Fe||0===Ht.numHorizontalGlyphVertices&&0===ln,Us=qe||0===Ht.numIconVertices;if(ba||Us?Us?ba||(kn=kn&&xn):xn=kn&&xn:kn=xn=kn&&xn,xn&&Zi&&Zi.box&&this.collisionIndex.insertCollisionBox(Zi.box,v.get("text-ignore-placement"),p.bucketInstanceId,Ci&&Ci.box&&br?br:Ir,Le.ID),kn&&Xn&&this.collisionIndex.insertCollisionBox(Xn.box,v.get("icon-ignore-placement"),p.bucketInstanceId,Br,Le.ID),ui&&(xn&&this.collisionIndex.insertCollisionCircles(ui.circles,v.get("text-ignore-placement"),p.bucketInstanceId,Ir,Le.ID),a)){const Kr=p.bucketInstanceId;let Vr=this.collisionCircleArrays[Kr];void 0===Vr&&(Vr=this.collisionCircleArrays[Kr]=new ir);for(let _r=0;_r<ui.circles.length;_r+=4)Vr.circles.push(ui.circles[_r+0]),Vr.circles.push(ui.circles[_r+1]),Vr.circles.push(ui.circles[_r+2]),Vr.circles.push(ui.collisionDetected?1:0)}const wa="globe"!==p.projection.name;Wt=Wt&&(wa||!rn),Ut=Ut&&(wa||!ni),this.placements[An]=new Nr(xn||Wt,kn||Ut,$t||p.justReloaded),u[An]=!0};if(en){const Ht=p.getSortedSymbolIndexes(this.transform.angle);for(let fn=Ht.length-1;fn>=0;--fn){const tn=Ht[fn];Ln(p.symbolInstances.get(tn),tn,p.collisionArrays[tn])}}else for(let Ht=i.symbolInstanceStart;Ht<i.symbolInstanceEnd;Ht++)Ln(p.symbolInstances.get(Ht),Ht,p.collisionArrays[Ht]);if(a&&p.bucketInstanceId in this.collisionCircleArrays){const Ht=this.collisionCircleArrays[p.bucketInstanceId];l.invert(Ht.invProjMatrix,C),Ht.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(i,u,a,f){const{leftJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:D,crossTileID:P}=a,F=l.getAnchorJustification(u),W=f===l.WritingMode.vertical?D:"left"===F?p:"center"===F?v:"right"===F?C:-1;p>=0&&(i.text.placedSymbolArray.get(p).crossTileID=W>=0&&p!==W?0:P),v>=0&&(i.text.placedSymbolArray.get(v).crossTileID=W>=0&&v!==W?0:P),C>=0&&(i.text.placedSymbolArray.get(C).crossTileID=W>=0&&C!==W?0:P),D>=0&&(i.text.placedSymbolArray.get(D).crossTileID=W>=0&&D!==W?0:P)}markUsedOrientation(i,u,a){const f=u===l.WritingMode.horizontal||u===l.WritingMode.horizontalOnly?u:0,p=u===l.WritingMode.vertical?u:0,{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:P}=a,F=i.text.placedSymbolArray;v>=0&&(F.get(v).placedOrientation=f),C>=0&&(F.get(C).placedOrientation=f),D>=0&&(F.get(D).placedOrientation=f),P>=0&&(F.get(P).placedOrientation=p)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let a=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const f=u?u.symbolFadeChange(i):1,p=u?u.opacities:{},v=u?u.variableOffsets:{},C=u?u.placedOrientations:{};for(const D in this.placements){const P=this.placements[D],F=p[D];F?(this.opacities[D]=new Ni(F,f,P.text,P.icon,null,P.clipped),a=a||P.text!==F.text.placed||P.icon!==F.icon.placed):(this.opacities[D]=new Ni(null,f,P.text,P.icon,P.skipFade,P.clipped),a=a||P.text||P.icon)}for(const D in p){const P=p[D];if(!this.opacities[D]){const F=new Ni(P,f,!1,!1);F.isHidden()||(this.opacities[D]=F,a=a||P.text.placed||P.icon.placed)}}for(const D in v)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=v[D]);for(const D in C)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=C[D]);a?this.lastPlacementChangeTime=i:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:i)}updateLayerOpacities(i,u){const a={};for(const f of u){const p=f.getBucket(i);p&&f.latestFeatureIndex&&i.id===p.layerIds[0]&&this.updateBucketOpacities(p,a,f.collisionBoxArray)}}updateBucketOpacities(i,u,a){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const f=i.layers[0].layout,p=!!i.layers[0].dynamicFilter(),v=new Ni(null,0,!1,!1,!0),C=f.get("text-allow-overlap"),D=f.get("icon-allow-overlap"),P=f.get("text-variable-anchor"),F="map"===f.get("text-rotation-alignment"),W="map"===f.get("text-pitch-alignment"),ue="none"!==f.get("icon-text-fit"),Te=new Ni(null,0,C&&(D||!i.hasIconData()||f.get("icon-optional")),D&&(C||!i.hasTextData()||f.get("text-optional")),!0);!i.collisionArrays&&a&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(a);const Re=(Le,Fe,qe)=>{for(let Ze=0;Ze<Fe/4;Ze++)Le.opacityVertexArray.emplaceBack(qe)};let je=0;for(let Le=0;Le<i.symbolInstances.length;Le++){const Fe=i.symbolInstances.get(Le),{numHorizontalGlyphVertices:qe,numVerticalGlyphVertices:Ze,crossTileID:rt,numIconVertices:_t}=Fe;let xt=this.opacities[rt];u[rt]?xt=v:xt||(xt=Te,this.opacities[rt]=xt),u[rt]=!0;const Lt=qe>0||Ze>0,en=_t>0,Wt=this.placedOrientations[rt],Ut=Wt===l.WritingMode.vertical,Ln=Wt===l.WritingMode.horizontal||Wt===l.WritingMode.horizontalOnly;if(!Lt&&!en||xt.isHidden()||je++,Lt){const Ht=gr(xt.text);Re(i.text,qe,Ut?zo:Ht),Re(i.text,Ze,Ln?zo:Ht);const fn=xt.text.isHidden(),{leftJustifiedTextSymbolIndex:tn,centerJustifiedTextSymbolIndex:An,rightJustifiedTextSymbolIndex:ln,verticalPlacedTextSymbolIndex:xn}=Fe,kn=i.text.placedSymbolArray,$t=fn||Ut?1:0;tn>=0&&(kn.get(tn).hidden=$t),An>=0&&(kn.get(An).hidden=$t),ln>=0&&(kn.get(ln).hidden=$t),xn>=0&&(kn.get(xn).hidden=fn||Ln?1:0);const rn=this.variableOffsets[rt];rn&&this.markUsedJustification(i,rn.anchor,Fe,Wt);const ni=this.placedOrientations[rt];ni&&(this.markUsedJustification(i,"left",Fe,ni),this.markUsedOrientation(i,ni,Fe))}if(en){const Ht=gr(xt.icon),{placedIconSymbolIndex:fn,verticalPlacedIconSymbolIndex:tn}=Fe,An=i.icon.placedSymbolArray,ln=xt.icon.isHidden()?1:0;fn>=0&&(Re(i.icon,_t,Ut?zo:Ht),An.get(fn).hidden=ln),tn>=0&&(Re(i.icon,Fe.numVerticalIconVertices,Ln?zo:Ht),An.get(tn).hidden=ln)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ht=i.collisionArrays[Le];if(Ht){let fn=new l.pointGeometry(0,0),tn=!0;if(Ht.textBox||Ht.verticalTextBox){if(P){const ln=this.variableOffsets[rt];ln?(fn=lr(ln.anchor,ln.width,ln.height,ln.textOffset,ln.textScale),F&&fn._rotate(W?this.transform.angle:-this.transform.angle)):tn=!1}p&&(tn=!xt.clipped),Ht.textBox&&Wr(i.textCollisionBox.collisionVertexArray,xt.text.placed,!tn||Ut,fn.x,fn.y),Ht.verticalTextBox&&Wr(i.textCollisionBox.collisionVertexArray,xt.text.placed,!tn||Ln,fn.x,fn.y)}const An=tn&&Boolean(!Ln&&Ht.verticalIconBox);Ht.iconBox&&Wr(i.iconCollisionBox.collisionVertexArray,xt.icon.placed,An,ue?fn.x:0,ue?fn.y:0),Ht.verticalIconBox&&Wr(i.iconCollisionBox.collisionVertexArray,xt.icon.placed,!An,ue?fn.x:0,ue?fn.y:0)}}}if(i.fullyClipped=0===je,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=Le.invProjMatrix,i.placementViewportMatrix=Le.viewportMatrix,i.collisionCircleArray=Le.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return 0===this.fadeDuration?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,u){const a=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*a>i}setStale(){this.stale=!0}}function Wr(m,i,u,a,f){m.emplaceBack(i?1:0,u?1:0,a||0,f||0),m.emplaceBack(i?1:0,u?1:0,a||0,f||0),m.emplaceBack(i?1:0,u?1:0,a||0,f||0),m.emplaceBack(i?1:0,u?1:0,a||0,f||0)}const fo=Math.pow(2,25),_s=Math.pow(2,24),Wo=Math.pow(2,17),xr=Math.pow(2,16),Ur=Math.pow(2,9),ua=Math.pow(2,8),qr=Math.pow(2,1);function gr(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const i=m.placed?1:0,u=Math.floor(127*m.opacity);return u*fo+i*_s+u*Wo+i*xr+u*Ur+i*ua+u*qr+i}const zo=0;class ys{constructor(i){this._sortAcrossTiles="viewport-y"!==i.layout.get("symbol-z-order")&&void 0!==i.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,u,a,f,p){const v=this._bucketParts;for(;this._currentTileIndex<i.length;)if(u.getBucketParts(v,f,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((C,D)=>C.sortKey-D.sortKey));this._currentPartIndex<v.length;){const C=v[this._currentPartIndex];if(u.placeLayerBucketPart(C,this._seenCrossTileIDs,a,0===C.symbolInstanceStart),this._currentPartIndex++,p())return!0}return!1}}class co{constructor(i,u,a,f,p,v,C,D){this.placement=new Wa(i,p,v,C,D),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=a,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(i,u,a){const f=l.exported.now(),p=()=>{const v=l.exported.now()-f;return!this._forceFullPlacement&&v>2};for(;this._currentPlacementIndex>=0;){const v=u[i[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if("symbol"===v.type&&(!v.minzoom||v.minzoom<=C)&&(!v.maxzoom||v.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new ys(v)),this._inProgressLayer.continuePlacement(a[v.source],this.placement,this._showCollisionBoxes,v,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const to=512/l.EXTENT/2;class Fs{constructor(i,u,a){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(let f=0;f<u.length;f++){const p=u.get(f),v=p.key;this.indexedSymbolInstances[v]||(this.indexedSymbolInstances[v]=[]),this.indexedSymbolInstances[v].push({crossTileID:p.crossTileID,coord:this.getScaledCoordinates(p,i)})}}getScaledCoordinates(i,u){const a=to/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*l.EXTENT+i.tileAnchorX)*a),y:Math.floor((u.canonical.y*l.EXTENT+i.tileAnchorY)*a)}}findMatches(i,u,a){const f=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let p=0;p<i.length;p++){const v=i.get(p);if(v.crossTileID)continue;const C=this.indexedSymbolInstances[v.key];if(!C)continue;const D=this.getScaledCoordinates(v,u);for(const P of C)if(Math.abs(P.coord.x-D.x)<=f&&Math.abs(P.coord.y-D.y)<=f&&!a[P.crossTileID]){a[P.crossTileID]=!0,v.crossTileID=P.crossTileID;break}}}}class da{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Co{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const u=Math.round((i-this.lng)/360);if(0!==u)for(const a in this.indexes){const f=this.indexes[a],p={};for(const v in f){const C=f[v];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+u),p[C.tileID.key]=C}this.indexes[a]=p}this.lng=i}addBucket(i,u,a){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let p=0;p<u.symbolInstances.length;p++)u.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const f=this.usedCrossTileIDs[i.overscaledZ];for(const p in this.indexes){const v=this.indexes[p];if(Number(p)>i.overscaledZ)for(const C in v){const D=v[C];D.tileID.isChildOf(i)&&D.findMatches(u.symbolInstances,i,f)}else{const C=v[i.scaledTo(Number(p)).key];C&&C.findMatches(u.symbolInstances,i,f)}}for(let p=0;p<u.symbolInstances.length;p++){const v=u.symbolInstances.get(p);v.crossTileID||(v.crossTileID=a.generate(),f[v.crossTileID]=!0)}return void 0===this.indexes[i.overscaledZ]&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Fs(i,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(i,u){for(const a in u.indexedSymbolInstances)for(const f of u.indexedSymbolInstances[a])delete this.usedCrossTileIDs[i][f.crossTileID]}removeStaleBuckets(i){let u=!1;for(const a in this.indexes){const f=this.indexes[a];for(const p in f)i[f[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,f[p]),delete f[p],u=!0)}return u}}class mo{constructor(){this.layerIndexes={},this.crossTileIDs=new da,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,u,a,f){let p=this.layerIndexes[i.id];void 0===p&&(p=this.layerIndexes[i.id]=new Co);let v=!1;const C={};"globe"!==f.name&&p.handleWrapJump(a);for(const D of u){const P=D.getBucket(i);P&&i.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(D.tileID,P,this.crossTileIDs)&&(v=!0),C[P.bucketInstanceId]=!0)}return p.removeStaleBuckets(C)&&(v=!0),v}pruneUnusedLayers(i){const u={};i.forEach(a=>{u[a]=!0});for(const a in this.layerIndexes)u[a]||delete this.layerIndexes[a]}}const Hs=(m,i)=>l.emitValidationErrors(m,i&&i.filter(u=>"source.canvas"!==u.identifier)),vs=l.pick(Hn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),as=l.pick(Hn,["setCenter","setZoom","setBearing","setPitch"]),go={version:8,layers:[],sources:{}},xs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class so extends l.Evented{constructor(i,u={}){super(),this.map=i,this.dispatcher=new yt(Wn(),this),this.imageManager=new Ne,this.imageManager.setEventedParent(this),this.glyphManager=new l.GlyphManager(i._requestManager,u.localFontFamily?l.LocalGlyphMode.all:u.localIdeographFontFamily?l.LocalGlyphMode.ideographs:l.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.crossTileSymbolIndex=new mo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const a=this;this._rtlTextPluginCallback=so.registerForPluginStateChange(f=>{a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(p,v)=>{if(l.triggerPluginCompletionEvent(p),v&&v.every(C=>C))for(const C in a._sourceCaches){const D=a._sourceCaches[C],P=D.getSource().type;"vector"!==P&&"geojson"!==P||D.reload()}})}),this.on("data",f=>{if("source"!==f.dataType||"metadata"!==f.sourceDataType)return;const p=this.getSource(f.sourceId);if(p&&p.vectorLayerIds)for(const v in this._layers){const C=this._layers[v];C.source===p.id&&this._validateLayer(C)}})}loadURL(i,u={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const a="boolean"==typeof u.validate?u.validate:!l.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,u.accessToken);const f=this.map._requestManager.transformRequest(i,l.ResourceType.Style);this._request=l.getJSON(f,(p,v)=>{this._request=null,p?this.fire(new l.ErrorEvent(p)):v&&this._load(v,a)})}loadJSON(i,u={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(i,!1!==u.validate)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(go,!1)}_updateLayerCount(i,u){const a=u?1:-1;i.is3D()&&(this._num3DLayers+=a),"circle"===i.type&&(this._numCircleLayers+=a),"symbol"===i.type&&(this._numSymbolLayers+=a)}_load(i,u){if(u&&Hs(this,l.validateStyle(i)))return;this._loaded=!0,this.stylesheet=l.clone$1(i),this._updateMapProjection();for(const f in i.sources)this.addSource(f,i.sources[f],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const a=di(this.stylesheet.layers);this._order=a.map(f=>f.id),this._layers={},this._serializedLayers={};for(let f of a)f=l.createStyleLayer(f),f.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=f,this._serializedLayers[f.id]=f.serialize(),this._updateLayerCount(f,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new We(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(i){this._spriteRequest=function(u,a,f){let p,v,C;const D=l.exported.devicePixelRatio>1?"@2x":"";let P=l.getJSON(a.transformRequest(a.normalizeSpriteURL(u,D,".json"),l.ResourceType.SpriteJSON),(ue,Te)=>{P=null,C||(C=ue,p=Te,W())}),F=l.getImage(a.transformRequest(a.normalizeSpriteURL(u,D,".png"),l.ResourceType.SpriteImage),(ue,Te)=>{F=null,C||(C=ue,v=Te,W())});function W(){if(C)f(C);else if(p&&v){const ue=l.exported.getImageData(v),Te={};for(const Re in p){const{width:je,height:Le,x:Fe,y:qe,sdf:Ze,pixelRatio:rt,stretchX:_t,stretchY:xt,content:Lt}=p[Re],en=new l.RGBAImage({width:je,height:Le});l.RGBAImage.copy(ue,en,{x:Fe,y:qe},{x:0,y:0},{width:je,height:Le}),Te[Re]={data:en,pixelRatio:rt,sdf:Ze,stretchX:_t,stretchY:xt,content:Lt}}f(null,Te)}}return{cancel(){P&&(P.cancel(),P=null),F&&(F.cancel(),F=null)}}}(i,this.map._requestManager,(u,a)=>{if(this._spriteRequest=null,u)this.fire(new l.ErrorEvent(u));else if(a)for(const f in a)this.imageManager.addImage(f,a[f]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(i){const u=this.getSource(i.source);if(!u)return;const a=i.sourceLayer;a&&("geojson"===u.type||u.vectorLayerIds&&-1===u.vectorLayerIds.indexOf(a))&&this.fire(new l.ErrorEvent(new Error(`Source layer "${a}" does not exist on source "${u.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const u=[];for(const a of i){const f=this._layers[a];"custom"!==f.type&&u.push(f.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&xs[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const u=this._changed;if(this._changed){const f=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(f.length||p.length)&&this._updateWorkerLayers(f,p);for(const v in this._updatedSources){const C=this._updatedSources[v];"reload"===C?this._reloadSource(v):"clear"===C&&this._clearSource(v)}this._updateTilesForChangedImages();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const a={};for(const f in this._sourceCaches){const p=this._sourceCaches[f];a[f]=p.used,p.used=!1}for(const f of this._order){const p=this._layers[f];if(p.recalculate(i,this._availableImages),!p.isHidden(i.zoom)){const C=this._getLayerSourceCache(p);C&&(C.used=!0)}const v=this.map.painter;if(v){const C=p.getProgramIds();if(!C)continue;const D=p.getProgramConfiguration(i.zoom);for(const P of C)v.useProgram(P,D)}}for(const f in a){const p=this._sourceCaches[f];a[f]!==p.used&&p.getSource().fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:p.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Hs(this,l.validateStyle(i)))return!1;(i=l.clone$1(i)).layers=di(i.layers);const u=function(f,p){if(!f)return[{command:Hn.setStyle,args:[p]}];let v=[];try{if(!q(f.version,p.version))return[{command:Hn.setStyle,args:[p]}];q(f.center,p.center)||v.push({command:Hn.setCenter,args:[p.center]}),q(f.zoom,p.zoom)||v.push({command:Hn.setZoom,args:[p.zoom]}),q(f.bearing,p.bearing)||v.push({command:Hn.setBearing,args:[p.bearing]}),q(f.pitch,p.pitch)||v.push({command:Hn.setPitch,args:[p.pitch]}),q(f.sprite,p.sprite)||v.push({command:Hn.setSprite,args:[p.sprite]}),q(f.glyphs,p.glyphs)||v.push({command:Hn.setGlyphs,args:[p.glyphs]}),q(f.transition,p.transition)||v.push({command:Hn.setTransition,args:[p.transition]}),q(f.light,p.light)||v.push({command:Hn.setLight,args:[p.light]}),q(f.fog,p.fog)||v.push({command:Hn.setFog,args:[p.fog]}),q(f.projection,p.projection)||v.push({command:Hn.setProjection,args:[p.projection]});const C={},D=[];!function(W,ue,Te,Re){let je;for(je in ue=ue||{},W=W||{})W.hasOwnProperty(je)&&(ue.hasOwnProperty(je)||ki(je,Te,Re));for(je in ue)ue.hasOwnProperty(je)&&(W.hasOwnProperty(je)?q(W[je],ue[je])||("geojson"===W[je].type&&"geojson"===ue[je].type&&Tr(W,ue,je)?Te.push({command:Hn.setGeoJSONSourceData,args:[je,ue[je].data]}):Gr(je,ue,Te,Re)):Vi(je,ue,Te))}(f.sources,p.sources,D,C);const P=[];f.layers&&f.layers.forEach(W=>{W.source&&C[W.source]?v.push({command:Hn.removeLayer,args:[W.id]}):P.push(W)});let F=f.terrain;F&&C[F.source]&&(v.push({command:Hn.setTerrain,args:[void 0]}),F=void 0),v=v.concat(D),q(F,p.terrain)||v.push({command:Hn.setTerrain,args:[p.terrain]}),function(W,ue,Te){ue=ue||[];const Re=(W=W||[]).map(Xt),je=ue.map(Xt),Le=W.reduce(no,{}),Fe=ue.reduce(no,{}),qe=Re.slice(),Ze=Object.create(null);let rt,_t,xt,Lt,en,Wt,Ut;for(rt=0,_t=0;rt<Re.length;rt++)xt=Re[rt],Fe.hasOwnProperty(xt)?_t++:(Te.push({command:Hn.removeLayer,args:[xt]}),qe.splice(qe.indexOf(xt,_t),1));for(rt=0,_t=0;rt<je.length;rt++)xt=je[je.length-1-rt],qe[qe.length-1-rt]!==xt&&(Le.hasOwnProperty(xt)?(Te.push({command:Hn.removeLayer,args:[xt]}),qe.splice(qe.lastIndexOf(xt,qe.length-_t),1)):_t++,Wt=qe[qe.length-rt],Te.push({command:Hn.addLayer,args:[Fe[xt],Wt]}),qe.splice(qe.length-rt,0,xt),Ze[xt]=!0);for(rt=0;rt<je.length;rt++)if(xt=je[rt],Lt=Le[xt],en=Fe[xt],!Ze[xt]&&!q(Lt,en))if(q(Lt.source,en.source)&&q(Lt["source-layer"],en["source-layer"])&&q(Lt.type,en.type)){for(Ut in Or(Lt.layout,en.layout,Te,xt,null,Hn.setLayoutProperty),Or(Lt.paint,en.paint,Te,xt,null,Hn.setPaintProperty),q(Lt.filter,en.filter)||Te.push({command:Hn.setFilter,args:[xt,en.filter]}),q(Lt.minzoom,en.minzoom)&&q(Lt.maxzoom,en.maxzoom)||Te.push({command:Hn.setLayerZoomRange,args:[xt,en.minzoom,en.maxzoom]}),Lt)Lt.hasOwnProperty(Ut)&&"layout"!==Ut&&"paint"!==Ut&&"filter"!==Ut&&"metadata"!==Ut&&"minzoom"!==Ut&&"maxzoom"!==Ut&&(0===Ut.indexOf("paint.")?Or(Lt[Ut],en[Ut],Te,xt,Ut.slice(6),Hn.setPaintProperty):q(Lt[Ut],en[Ut])||Te.push({command:Hn.setLayerProperty,args:[xt,Ut,en[Ut]]}));for(Ut in en)en.hasOwnProperty(Ut)&&!Lt.hasOwnProperty(Ut)&&"layout"!==Ut&&"paint"!==Ut&&"filter"!==Ut&&"metadata"!==Ut&&"minzoom"!==Ut&&"maxzoom"!==Ut&&(0===Ut.indexOf("paint.")?Or(Lt[Ut],en[Ut],Te,xt,Ut.slice(6),Hn.setPaintProperty):q(Lt[Ut],en[Ut])||Te.push({command:Hn.setLayerProperty,args:[xt,Ut,en[Ut]]}))}else Te.push({command:Hn.removeLayer,args:[xt]}),Wt=qe[qe.lastIndexOf(xt)+1],Te.push({command:Hn.addLayer,args:[en,Wt]})}(P,p.layers,v)}catch(C){console.warn("Unable to compute style diff:",C),v=[{command:Hn.setStyle,args:[p]}]}return v}(this.serialize(),i).filter(f=>!(f.command in as));if(0===u.length)return!1;const a=u.filter(f=>!(f.command in vs));if(a.length>0)throw new Error(`Unimplemented: ${a.map(f=>f.command).join(", ")}.`);return u.forEach(f=>{"setTransition"!==f.command&&"setProjection"!==f.command&&this[f.command].apply(this,f.args)}),this.stylesheet=i,this._updateMapProjection(),!0}addImage(i,u){return this.getImage(i)?this.fire(new l.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,u),this._afterImageUpdated(i),this)}updateImage(i,u){this.imageManager.updateImage(i,u)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i),this._afterImageUpdated(i),this):this.fire(new l.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,u,a={}){if(this._checkLoaded(),void 0!==this.getSource(i))throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(l.validateSource,`sources.${i}`,u,null,a))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const f=At(i,u,this.dispatcher,this);f.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i),source:f.serialize(),sourceId:i}));const p=v=>{const C=(v?"symbol:":"other:")+i,D=this._sourceCaches[C]=new l.SourceCache(C,f,v);(v?this._symbolSourceCaches:this._otherSourceCaches)[i]=D,D.style=this,D.onAdd(this.map)};p(!1),"vector"!==u.type&&"geojson"!==u.type||p(!0),f.onAdd&&f.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const u=this.getSource(i);if(!u)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===i)return this.fire(new l.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${f}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new l.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const a=this._getSourceCaches(i);for(const f of a)delete this._sourceCaches[f.id],delete this._updatedSources[f.id],f.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f.getSource().id})),f.setEventedParent(null),f.clearTiles();return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(i,u){this._checkLoaded(),this.getSource(i).setData(u),this._changed=!0}getSource(i){const u=this._getSourceCache(i);return u&&u.getSource()}_getSources(){const i=[];for(const u in this._otherSourceCaches){const a=this._getSourceCache(u);a&&i.push(a.getSource())}return i}addLayer(i,u,a={}){this._checkLoaded();const f=i.id;if(this.getLayer(f))return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${f}" already exists on this map`)));let p;if("custom"===i.type){if(Hs(this,l.validateCustomStyleLayer(i)))return;p=l.createStyleLayer(i)}else{if("object"==typeof i.source&&(this.addSource(f,i.source),i=l.clone$1(i),i=l.extend(i,{source:f})),this._validate(l.validateLayer,`layers.${f}`,i,{arrayIndex:-1},a))return;p=l.createStyleLayer(i),this._validateLayer(p),p.setEventedParent(this,{layer:{id:f}}),this._serializedLayers[p.id]=p.serialize(),this._updateLayerCount(p,!0)}const v=u?this._order.indexOf(u):this._order.length;if(u&&-1===v)return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(v,0,f),this._layerOrderChanged=!0,this._layers[f]=p;const C=this._getLayerSourceCache(p);if(this._removedLayers[f]&&p.source&&C&&"custom"!==p.type){const D=this._removedLayers[f];delete this._removedLayers[f],D.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",C.pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,u){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new l.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===u)return;const a=this._order.indexOf(i);this._order.splice(a,1);const f=u?this._order.indexOf(u):this._order.length;u&&-1===f?this.fire(new l.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(f,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const u=this._layers[i];if(!u)return void this.fire(new l.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const a=this._order.indexOf(i);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=u,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const u in this._layers)if(this._layers[u].type===i)return!0;return!1}setLayerZoomRange(i,u,a){this._checkLoaded();const f=this.getLayer(i);f?f.minzoom===u&&f.maxzoom===a||(null!=u&&(f.minzoom=u),null!=a&&(f.maxzoom=a),this._updateLayer(f)):this.fire(new l.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,u,a={}){this._checkLoaded();const f=this.getLayer(i);if(f){if(!q(f.filter,u))return null==u?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(l.validateFilter,`layers.${f.id}.filter`,u,{layerType:f.type},a)||(f.filter=l.clone$1(u),this._updateLayer(f)))}else this.fire(new l.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){const u=this.getLayer(i);return u&&l.clone$1(u.filter)}setLayoutProperty(i,u,a,f={}){this._checkLoaded();const p=this.getLayer(i);p?q(p.getLayoutProperty(u),a)||(p.setLayoutProperty(u,a,f),this._updateLayer(p)):this.fire(new l.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,u){const a=this.getLayer(i);if(a)return a.getLayoutProperty(u);this.fire(new l.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,u,a,f={}){this._checkLoaded();const p=this.getLayer(i);p?q(p.getPaintProperty(u),a)||(p.setPaintProperty(u,a,f)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new l.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,u){const a=this.getLayer(i);return a&&a.getPaintProperty(u)}setFeatureState(i,u){this._checkLoaded();const a=i.source,f=i.sourceLayer,p=this.getSource(a);if(!p)return void this.fire(new l.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const v=p.type;if("geojson"===v&&f)return void this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===v&&!f)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===i.id&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided.")));const C=this._getSourceCaches(a);for(const D of C)D.setFeatureState(f,i.id,u)}removeFeatureState(i,u){this._checkLoaded();const a=i.source,f=this.getSource(a);if(!f)return void this.fire(new l.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const p=f.type,v="vector"===p?i.sourceLayer:void 0;if("vector"===p&&!v)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&"string"!=typeof i.id&&"number"!=typeof i.id)return void this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const C=this._getSourceCaches(a);for(const D of C)D.removeFeatureState(v,i.id,u)}getFeatureState(i){this._checkLoaded();const u=i.source,a=i.sourceLayer,f=this.getSource(u);if(f){if("vector"!==f.type||a)return void 0===i.id&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(a,i.id);this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const u in this._sourceCaches){const a=this._sourceCaches[u].getSource();i[a.id]||(i[a.id]=a.serialize())}return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},u=>void 0!==u)}_updateLayer(i){this._updatedLayers[i.id]=!0;const u=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&u&&"raster"!==u.getSource().type&&(this._updatedSources[i.source]="reload",u.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const u=v=>"fill-extrusion"===this._layers[v].type,a={},f=[];for(let v=this._order.length-1;v>=0;v--){const C=this._order[v];if(u(C)){a[C]=v;for(const D of i){const P=D[C];if(P)for(const F of P)f.push(F)}}}f.sort((v,C)=>C.intersectionZ-v.intersectionZ);const p=[];for(let v=this._order.length-1;v>=0;v--){const C=this._order[v];if(u(C))for(let D=f.length-1;D>=0;D--){const P=f[D].feature;if(a[P.layer.id]<v)break;p.push(P),f.pop()}else for(const D of i){const P=D[C];if(P)for(const F of P)p.push(F.feature)}}return p}queryRenderedFeatures(i,u,a){u&&u.filter&&this._validate(l.validateFilter,"queryRenderedFeatures.filter",u.filter,null,u);const f={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const D of u.layers){const P=this._layers[D];if(!P)return this.fire(new l.ErrorEvent(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];f[P.source]=!0}}const p=[];u.availableImages=this._availableImages;const v=u&&u.layers?u.layers.some(D=>{const P=this.getLayer(D);return P&&P.is3D()}):this.has3DLayers(),C=gt.createFromScreenPoints(i,a);for(const D in this._sourceCaches){const P=this._sourceCaches[D].getSource().id;u.layers&&!f[P]||p.push(be(this._sourceCaches[D],this._layers,this._serializedLayers,C,u,a,v,!!this.map._showQueryGeometry))}return this.placement&&p.push(function(D,P,F,W,ue,Te,Re){const je={},Le=Te.queryRenderedSymbols(W),Fe=[];for(const qe of Object.keys(Le).map(Number))Fe.push(Re[qe]);Fe.sort(dt);for(const qe of Fe){const Ze=qe.featureIndex.lookupSymbolFeatures(Le[qe.bucketInstanceId],P,qe.bucketIndex,qe.sourceLayerIndex,ue.filter,ue.layers,ue.availableImages,D);for(const rt in Ze){const _t=je[rt]=je[rt]||[],xt=Ze[rt];xt.sort((Lt,en)=>{const Wt=qe.featureSortOrder;if(Wt){const Ut=Wt.indexOf(Lt.featureIndex);return Wt.indexOf(en.featureIndex)-Ut}return en.featureIndex-Lt.featureIndex});for(const Lt of xt)_t.push(Lt)}}for(const qe in je)je[qe].forEach(Ze=>{const rt=Ze.feature,_t=F(D[qe]).getFeatureState(rt.layer["source-layer"],rt.id);rt.source=rt.layer.source,rt.layer["source-layer"]&&(rt.sourceLayer=rt.layer["source-layer"]),rt.state=_t});return je}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),C.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(i,u){u&&u.filter&&this._validate(l.validateFilter,"querySourceFeatures.filter",u.filter,null,u);const a=this._getSourceCaches(i);let f=[];for(const p of a)f=f.concat(De(p,u));return f}addSourceType(i,u,a){return so.getSourceType(i)?a(new Error(`A source type called "${i}" already exists.`)):(so.setSourceType(i,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:u.workerSourceURL},a):a(null,null))}getLight(){return this.light.getLight()}setLight(i,u={}){this._checkLoaded();const a=this.light.getLight();let f=!1;for(const v in i)if(!q(i[v],a[v])){f=!0;break}if(!f)return;const p=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(i,u),this.light.updateTransitions(p)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,u=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===u){if("object"==typeof i.source){const a="terrain-dem-src";this.addSource(a,i.source),i=l.clone$1(i),i=l.extend(i,{source:a})}if(this._validate(l.validateTerrain,"terrain",i))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode)this._createTerrain(i,u);else{const a=this.terrain,f=a.get();for(const p of Object.keys(l.spec.terrain))!i.hasOwnProperty(p)&&l.spec.terrain[p].default&&(i[p]=l.spec.terrain[p].default);for(const p in i)if(!q(i[p],f[p])){a.set(i),this.stylesheet.terrain=i;const v=this._setTransitionParameters({duration:0});a.updateTransitions(v);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const u=this.fog=new Ot(i,this.map.transform);this.stylesheet.fog=i;const a=this._setTransitionParameters({duration:0});u.updateTransitions(a)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,a=u.get();0===Object.keys(i).length&&u.set(i);for(const f in i)if(!q(i[f],a[f])){u.set(i),this.stylesheet.fog=i;const p=this._setTransitionParameters({duration:0});u.updateTransitions(p);break}}else this._createFog(i);this._markersNeedUpdate=!0}_setTransitionParameters(i){return{now:l.exported.now(),transition:l.extend(i,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(a=>this.isLayerDraped(this._layers[a])),u=this._order.filter(a=>!this.isLayerDraped(this._layers[a]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...u)}_createTerrain(i,u){const a=this.terrain=new oe(i,u);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const f=this._setTransitionParameters({duration:0});a.updateTransitions(f)}_force3DLayerUpdate(){for(const i in this._layers){const u=this._layers[i];"fill-extrusion"===u.type&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const u=this._layers[i];"symbol"===u.type&&this._updateLayer(u)}}_validate(i,u,a,f,p={}){return(!p||!1!==p.validate)&&Hs(this,i.call(l.validateStyle,l.extend({key:u,style:this.serialize(),value:a,styleSpec:l.spec},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const u=this._getSourceCaches(i);for(const a of u)a.clearTiles()}_reloadSource(i){const u=this._getSourceCaches(i);for(const a of u)a.resume(),a.reload()}_reloadSources(){for(const i of this._getSources())i.reload&&i.reload()}_updateSources(i){for(const u in this._sourceCaches)this._sourceCaches[u].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const u=this._sourceCaches[i];u.resume(),u.reload()}}_updatePlacement(i,u,a,f,p=!1){let v=!1,C=!1;const D={};for(const P of this._order){const F=this._layers[P];if("symbol"!==F.type)continue;if(!D[F.source]){const ue=this._getLayerSourceCache(F);if(!ue)continue;D[F.source]=ue.getRenderableIds(!0).map(Te=>ue.getTileByID(Te)).sort((Te,Re)=>Re.tileID.overscaledZ-Te.tileID.overscaledZ||(Te.tileID.isLessThan(Re.tileID)?-1:1))}const W=this.crossTileSymbolIndex.addLayer(F,D[F.source],i.center.lng,i.projection);v=v||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),p=p||this._layerOrderChanged||0===a,this._layerOrderChanged&&this.fire(new l.Event("neworder")),(p||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),i.zoom))&&(this.pauseablePlacement=new co(i,this._order,p,u,a,f,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),C=!0),v&&this.pauseablePlacement.placement.setStale()),C||v)for(const P of this._order){const F=this._layers[P];"symbol"===F.type&&this.placement.updateLayerOpacities(F,D[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,u,a){this.imageManager.getImages(u.icons,a),this._updateTilesForChangedImages();const f=p=>{p&&p.setDependencies(u.tileID.key,u.type,u.icons)};f(this._otherSourceCaches[u.source]),f(this._symbolSourceCaches[u.source])}getGlyphs(i,u,a){this.glyphManager.getGlyphs(u.stacks,a)}getResource(i,u,a){return l.makeRequest(u,a)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return"symbol"===i.type?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const u=[];return this._otherSourceCaches[i]&&u.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&u.push(this._symbolSourceCaches[i]),u}_isSourceCacheLoaded(i){const u=this._getSourceCaches(i);return 0===u.length?(this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${i}'`))),!1):u.every(a=>a.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}so.getSourceType=function(m){return Rt[m]},so.setSourceType=function(m,i){Rt[m]=i},so.registerForPluginStateChange=l.registerForPluginStateChange;var ks="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",bs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ha="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",pa="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Ws="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let ls={},fa={};const Mo=[];Uo(ks,Mo),Uo(ha,Mo),Uo(pa,Mo),Uo(Ws,Mo),ls=ji("",ha),fa=ji(Ws,pa);const cl=ji("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ma=ks,cs="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Ro={background:ji("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ji("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ji("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ji("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ji("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ji("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ji("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ji("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ji("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ji("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ji("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ji("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ji("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ji("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ji("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ji("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ji("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ji("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ji("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ji("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ji("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ji("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ji("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ji("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:ji("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ji("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",bs),skyboxGradient:ji("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",bs),skyboxCapture:ji("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ji("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:ji("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Uo(m,i){const u=m.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let a of u)if(a=a.trim(),"#"===a[0]&&a.includes("if")&&!a.includes("endif")){a=a.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const f=a.split(" ");for(const p of f)i.includes(p)||i.push(p)}}function ji(m,i){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),f={},p=[...Mo];return Uo(m,p),Uo(i,p),{fragmentSource:m=m.replace(u,(v,C,D,P,F)=>(f[F]=!0,"define"===C?`\n#ifndef HAS_UNIFORM_u_${F}\nvarying ${D} ${P} ${F};\n#else\nuniform ${D} ${P} u_${F};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${F}\n    ${D} ${P} ${F} = u_${F};\n#endif\n`)),vertexSource:i=i.replace(u,(v,C,D,P,F)=>{const W="float"===P?"vec2":"vec4",ue=F.match(/color/)?"color":W;return f[F]?"define"===C?`\n#ifndef HAS_UNIFORM_u_${F}\nuniform lowp float u_${F}_t;\nattribute ${D} ${W} a_${F};\nvarying ${D} ${P} ${F};\n#else\nuniform ${D} ${P} u_${F};\n#endif\n`:"vec4"===ue?`\n#ifndef HAS_UNIFORM_u_${F}\n    ${F} = a_${F};\n#else\n    ${D} ${P} ${F} = u_${F};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${F}\n    ${F} = unpack_mix_${ue}(a_${F}, u_${F}_t);\n#else\n    ${D} ${P} ${F} = u_${F};\n#endif\n`:"define"===C?`\n#ifndef HAS_UNIFORM_u_${F}\nuniform lowp float u_${F}_t;\nattribute ${D} ${W} a_${F};\n#else\nuniform ${D} ${P} u_${F};\n#endif\n`:"vec4"===ue?`\n#ifndef HAS_UNIFORM_u_${F}\n    ${D} ${P} ${F} = a_${F};\n#else\n    ${D} ${P} ${F} = u_${F};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${F}\n    ${D} ${P} ${F} = unpack_mix_${ue}(a_${F}, u_${F}_t);\n#else\n    ${D} ${P} ${F} = u_${F};\n#endif\n`}),staticAttributes:a,usedDefines:p}}class qs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,u,a,f,p,v,C){this.context=i;let D=this.boundPaintVertexBuffers.length!==f.length;for(let F=0;!D&&F<f.length;F++)this.boundPaintVertexBuffers[F]!==f[F]&&(D=!0);let P=this.boundDynamicVertexBuffers.length!==C.length;for(let F=0;!P&&F<C.length;F++)this.boundDynamicVertexBuffers[F]!==C[F]&&(P=!0);if(!i.extVertexArrayObject||!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==a||D||P||this.boundIndexBuffer!==p||this.boundVertexOffset!==v)this.freshBind(u,a,f,p,v,C);else{i.bindVertexArrayOES.set(this.vao);for(const F of C)F&&F.bind();p&&p.dynamicDraw&&p.bind()}}freshBind(i,u,a,f,p,v){let C;const D=i.numAttributes,P=this.context,F=P.gl;if(P.extVertexArrayObject)this.vao&&this.destroy(),this.vao=P.extVertexArrayObject.createVertexArrayOES(),P.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=i,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=f,this.boundVertexOffset=p,this.boundDynamicVertexBuffers=v;else{C=P.currentNumAttributes||0;for(let W=D;W<C;W++)F.disableVertexAttribArray(W)}u.enableAttributes(F,i),u.bind(),u.setVertexAttribPointers(F,i,p);for(const W of a)W.enableAttributes(F,i),W.bind(),W.setVertexAttribPointers(F,i,p);for(const W of v)W&&(W.enableAttributes(F,i),W.bind(),W.setVertexAttribPointers(F,i,p));f&&f.bind(),P.currentNumAttributes=D}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ys(m,i){const u=Math.pow(2,i.canonical.z),a=i.canonical.y;return[new l.MercatorCoordinate(0,a/u).toLngLat().lat,new l.MercatorCoordinate(0,(a+1)/u).toLngLat().lat]}function Vo(m,i,u,a,f,p,v){const C=m.context,D=C.gl,P=u.fbo;if(!P)return;m.prepareDrawTile();const F=m.useProgram("hillshade");C.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,P.colorAttachment.get());const W=((je,Le,Fe,qe)=>{const Ze=Fe.paint.get("hillshade-shadow-color"),rt=Fe.paint.get("hillshade-highlight-color"),_t=Fe.paint.get("hillshade-accent-color");let xt=Fe.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Fe.paint.get("hillshade-illumination-anchor")&&(xt-=je.transform.angle);const Lt=!je.options.moving;return{u_matrix:qe||je.transform.calculateProjMatrix(Le.tileID.toUnwrapped(),Lt),u_image:0,u_latrange:Ys(0,Le.tileID),u_light:[Fe.paint.get("hillshade-exaggeration"),xt],u_shadow:Ze,u_highlight:rt,u_accent:_t}})(m,u,a,m.terrain?i.projMatrix:null);m.prepareDrawProgram(C,F,i.toUnwrapped());const{tileBoundsBuffer:ue,tileBoundsIndexBuffer:Te,tileBoundsSegments:Re}=m.getTileBoundsBuffers(u);F.draw(C,D.TRIANGLES,f,p,v,l.CullFaceMode.disabled,W,a.id,ue,Te,Re)}function Lo(m,i,u){if(!i.needsDEMTextureUpload)return;const a=m.context,f=a.gl;a.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||m.getTileTexture(u.stride);const p=u.getPixels();i.demTexture?i.demTexture.update(p,{premultiply:!1}):i.demTexture=new l.Texture(a,p,f.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function ws(m,i,u,a,f,p){const v=m.context,C=v.gl;if(!i.dem)return;const D=i.dem;if(v.activeTexture.set(C.TEXTURE1),Lo(m,i,D),!i.demTexture)return;i.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const P=D.dim;v.activeTexture.set(C.TEXTURE0);let F=i.fbo;if(!F){const Re=new l.Texture(v,{width:P,height:P,data:null},C.RGBA);Re.bind(C.LINEAR,C.CLAMP_TO_EDGE),F=i.fbo=v.createFramebuffer(P,P,!0),F.colorAttachment.set(Re.texture)}v.bindFramebuffer.set(F.framebuffer),v.viewport.set([0,0,P,P]);const{tileBoundsBuffer:W,tileBoundsIndexBuffer:ue,tileBoundsSegments:Te}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(v,C.TRIANGLES,a,f,p,l.CullFaceMode.disabled,((Re,je)=>{const Le=je.stride,Fe=l.create();return l.ortho(Fe,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(Fe,Fe,[0,-l.EXTENT,0]),{u_matrix:Fe,u_image:1,u_dimension:[Le,Le],u_zoom:Re.overscaledZ,u_unpack:je.unpackVector}})(i.tileID,D),u.id,W,ue,Te),i.needsHillshadePrepare=!1}const Cs=m=>({u_matrix:new l.UniformMatrix4f(m),u_image0:new l.Uniform1i(m),u_skirt_height:new l.Uniform1f(m)}),us=(m,i)=>({u_matrix:m,u_image0:0,u_skirt_height:i}),qo=(m,i,u,a,f,p,v,C,D,P,F,W,ue,Te)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(a),u_merc_matrix:u,u_zoom_transition:f,u_merc_center:p,u_image0:0,u_frustum_tl:v,u_frustum_tr:C,u_frustum_br:D,u_frustum_bl:P,u_globe_pos:F,u_globe_radius:W,u_viewport:ue,u_grid_matrix:Te?Float32Array.from(Te):new Float32Array(9)});function uo(m,i){return null!=m&&null!=i&&!(!m.hasData()||!i.hasData())&&null!=m.demTexture&&null!=i.demTexture&&m.tileID.key!==i.tileID.key}const _o=new class{constructor(){this.operations={}}newMorphing(m,i,u,a,f){if(m in this.operations){const p=this.operations[m];p.to.tileID.key!==u.tileID.key&&(p.queued=u)}else this.operations[m]={startTime:a,phase:0,duration:f,from:i,to:u,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const i=this.operations[m];return{from:i.from,to:i.to,phase:i.phase}}update(m){for(const i in this.operations){const u=this.operations[i];for(u.phase=(m-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,m)){delete this.operations[i];break}}}_nextOp(m,i){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=i,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},jo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Xr(m,i){const u=1<<m.z;return!i&&(0===m.x||m.x===u-1)||0===m.y||m.y===u-1}const ma=m=>({u_matrix:m});function Yo(m,i,u,a,f){if(f>0){const p=l.exported.now(),v=(p-m.timeAdded)/f,C=i?(p-i.timeAdded)/f:-1,D=u.getSource(),P=a.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),F=!i||Math.abs(i.tileID.overscaledZ-P)>Math.abs(m.tileID.overscaledZ-P),W=F&&m.refreshedUponExpiration?1:l.clamp(F?v:1-C,0,1);return m.refreshedUponExpiration&&v>=1&&(m.refreshedUponExpiration=!1),i?{opacity:1,mix:1-W}:{opacity:W,mix:0}}return{opacity:1,mix:0}}class wi extends l.SourceCache{constructor(i){const u={type:"raster-dem",maxzoom:i.transform.maxZoom},a=new yt(Wn(),null),f=At("mock-dem",u,a,i.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,u){i.state="loaded",u(null)}}class Sa extends l.SourceCache{constructor(i){const u=At("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new yt(Wn(),null),i.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,u,a){if(i.freezeTileCoverage)return;this.transform=i;const f=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((p,v)=>{if(p[v.key]="",!this._tiles[v.key]){const C=new l.Tile(v,this._source.tileSize*v.overscaleFactor(),i.tileZoom);C.state="loaded",this._tiles[v.key]=C}return p},{});for(const p in this._tiles)p in f||(this.freeFBO(p),this._tiles[p].unloadVectorData(),delete this._tiles[p])}freeFBO(i){const u=this.proxyCachedFBO[i];if(void 0!==u){const a=Object.values(u);this.renderCachePool.push(...a),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Aa extends l.OverscaledTileID{constructor(i,u,a){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=u,this.projMatrix=a}}class ds extends l.Elevation{constructor(i,u){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[a,f,p]=function(D){const P=new l.StructArrayLayout4i8,F=new l.StructArrayLayout3ui6,W=131;P.reserve(17161),F.reserve(33800);const ue=l.EXTENT/128,Te=l.EXTENT+ue/2,Re=Te+ue;for(let Le=-ue;Le<Re;Le+=ue)for(let Fe=-ue;Fe<Re;Fe+=ue){const qe=Fe<0||Fe>Te||Le<0||Le>Te?24575:0,Ze=l.clamp(Math.round(Fe),0,l.EXTENT),rt=l.clamp(Math.round(Le),0,l.EXTENT);P.emplaceBack(Ze+qe,rt,Ze,rt)}const je=(Le,Fe)=>{const qe=Fe*W+Le;F.emplaceBack(qe+1,qe,qe+W),F.emplaceBack(qe+W,qe+W+1,qe+1)};for(let Le=1;Le<129;Le++)for(let Fe=1;Fe<129;Fe++)je(Fe,Le);return[0,129].forEach(Le=>{for(let Fe=0;Fe<130;Fe++)je(Fe,Le),je(Le,Fe)}),[P,F,32768]}(),v=i.context;this.gridBuffer=v.createVertexBuffer(a,l.boundsAttributes.members),this.gridIndexBuffer=v.createIndexBuffer(f),this.gridSegments=l.SegmentVector.simpleSegment(0,0,a.length,f.length),this.gridNoSkirtSegments=l.SegmentVector.simpleSegment(0,0,a.length,p),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Sa(u.map),this.orthoMatrix=l.create(),l.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,l.EXTENT,0,l.EXTENT,0,1);const C=v.gl;this._overlapStencilMode=new l.StencilMode({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new wi(u.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,u,a){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const f=i.terrain.properties;this.sourceCache=0===i.terrain.drapeRenderMode?this._mockSourceCache:i._getSourceCache(f.get("source")),this._exaggeration=f.get("exaggeration");const p=()=>{this.sourceCache.used&&l.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const v=this.getScaledDemTileSize();this.sourceCache.update(u,v,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,p(),this._initializing=!0),p(),u.updateElevation(!0,a),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==i.efficiency&&l.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&"source"===i.dataType?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):"style"===i.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,a=this.painter.transform;this._initializing&&(this._initializing=0===a._centerAltitude&&-1===this.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(a.center),-1),this._emptyDEMTextureDirty=!this._initializing);const f=this.proxyCoords=u.getIds().map(D=>{const P=u.getTileByID(D).tileID;return P.projMatrix=a.calculateProjMatrix(P.toUnwrapped()),P});(function(D,P){const F=P.transform.pointCoordinate(P.transform.getCameraPoint()),W=new l.pointGeometry(F.x,F.y);D.sort((ue,Te)=>{if(Te.overscaledZ-ue.overscaledZ)return Te.overscaledZ-ue.overscaledZ;const Re=new l.pointGeometry(ue.canonical.x+(1<<ue.canonical.z)*ue.wrap,ue.canonical.y),je=new l.pointGeometry(Te.canonical.x+(1<<Te.canonical.z)*Te.wrap,Te.canonical.y),Le=W.mult(1<<ue.canonical.z);return Le.x-=.5,Le.y-=.5,Le.distSqr(Re)-Le.distSqr(je)})})(f,this.painter),this._previousZoom=a.zoom;const p=this.proxyToSource||{};this.proxyToSource={},f.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};const v=this._style._sourceCaches;for(const D in v){const P=v[D];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,i[D],p),P.usedForTerrain))continue;const F=i[D];P.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[u.id]=f.map(D=>new Aa(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(f),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(p),this.renderingToTexture=!1,this._updateTimestamp=l.exported.now();const C={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const P=this.terrainTileForTile[D.key];if(!P)continue;const F=P.tileID.key;F in C||(this._visibleDemTiles.push(P),C[F]=F)}}_assignTerrainTiles(i){this._initializing||i.forEach(u=>{if(this.terrainTileForTile[u.key])return;const a=this._findTileCoveringTileID(u,this.sourceCache);a&&(this.terrainTileForTile[u.key]=a)})}_prepareDEMTextures(){const i=this.painter.context,u=i.gl;for(const a in this.terrainTileForTile){const f=this.terrainTileForTile[a],p=f.dem;!p||f.demTexture&&!f.needsDEMTextureUpload||(i.activeTexture.set(u.TEXTURE1),Lo(this.painter,f,p))}}_prepareDemTileUniforms(i,u,a,f){if(!u||null==u.demTexture)return!1;const p=i.tileID.canonical,v=Math.pow(2,u.tileID.canonical.z-p.z),C=f||"";return a[`u_dem_tl${C}`]=[p.x*v%1,p.y*v%1],a[`u_dem_scale${C}`]=v,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,u=i.gl;if(!this._emptyDepthBufferTexture){const a=new l.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new l.Texture(i,a,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const u=this._visibleDemTiles.reduce((a,f)=>{if(!f.dem)return a;const p=f.dem.tree.minimums[0];return p>0&&i++,a+p},0);return i?u/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,u=i.gl;i.activeTexture.set(u.TEXTURE2);const a=this._getLoadedAreaMinimum(),f=new l.RGBAImage({width:1,height:1},new Uint8Array(l.DEMData.pack(a,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let p=this._emptyDEMTexture;return p?p.update(f,{premultiply:!1}):p=this._emptyDEMTexture=new l.Texture(i,f,u.RGBA,{premultiply:!1}),p}setupElevationDraw(i,u,a){const f=this.painter.context,p=f.gl,v=(C=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:l.DEMData.getUnpackVector(C),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var C;v.u_dem_size=this.sourceCache.getSource().tileSize,v.u_exaggeration=this.exaggeration();let D=null,P=null,F=1;if(a&&a.morphing&&this._useVertexMorphing){const W=a.morphing.srcDemTile,ue=a.morphing.dstDemTile;F=a.morphing.phase,W&&ue&&(this._prepareDemTileUniforms(i,W,v,"_prev")&&(P=W),this._prepareDemTileUniforms(i,ue,v)&&(D=ue))}if(P&&D?(f.activeTexture.set(p.TEXTURE2),D.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE,p.NEAREST),f.activeTexture.set(p.TEXTURE4),P.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE,p.NEAREST),v.u_dem_lerp=F):(D=this.terrainTileForTile[i.tileID.key],f.activeTexture.set(p.TEXTURE2),(this._prepareDemTileUniforms(i,D,v)?D.demTexture:this.emptyDEMTexture).bind(p.NEAREST,p.CLAMP_TO_EDGE)),f.activeTexture.set(p.TEXTURE3),a&&a.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE),this._depthFBO&&(v.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE),v.u_depth_size_inv=[1,1]),a&&a.useMeterToDem&&D){const W=(1<<D.tileID.canonical.z)*l.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;v.u_meter_to_dem=W}if(a&&a.labelPlaneMatrixInv&&(v.u_label_plane_matrix_inv=a.labelPlaneMatrixInv),u.setTerrainUniformValues(f,v),"globe"===this.painter.transform.projection.name){const W=this.globeUniformValues(this.painter.transform,i.tileID.canonical,a&&a.useDenormalizedUpVectorScale);u.setGlobeUniformValues(f,W)}}globeUniformValues(i,u,a){const f=i.projection;return{u_tile_tl_up:f.upVector(u,0,0),u_tile_tr_up:f.upVector(u,l.EXTENT,0),u_tile_br_up:f.upVector(u,l.EXTENT,l.EXTENT),u_tile_bl_up:f.upVector(u,0,l.EXTENT),u_tile_up_scale:a?l.GLOBE_METERS_TO_ECEF:f.upVectorScale(u,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const u=this.painter,a=this.painter.context;0!==i.length&&(a.bindFramebuffer.set(null),a.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(f,p,v,C,D){if("globe"===f.transform.projection.name)!function(P,F,W,ue,Te){const Re=P.context,je=Re.gl;let Le,Fe;const qe=P.options.showTerrainWireframe?2:0,Ze=P.transform,rt=l.globeUseCustomAntiAliasing(P,Re,Ze),_t=(An,ln)=>{if(Fe===An)return;const xn=[jo[An],"PROJECTION_GLOBE_VIEW"];rt&&xn.push("CUSTOM_ANTIALIASING"),ln&&xn.push(jo[qe]),Le=P.useProgram("globeRaster",null,xn),Fe=An},xt=P.colorModeForRenderPass(),Lt=new l.DepthMode(je.LEQUAL,l.DepthMode.ReadWrite,P.depthRangeFor3D);_o.update(Te);const en=l.calculateGlobeMercatorMatrix(Ze),Wt=[l.mercatorXfromLng(Ze.center.lng),l.mercatorYfromLat(Ze.center.lat)],Ut=qe?[!1,!0]:[!1],Ln=P.globeSharedBuffers,Ht=[Ze.width*l.exported.devicePixelRatio,Ze.height*l.exported.devicePixelRatio],fn=Float32Array.from(Ze.globeMatrix),tn={useDenormalizedUpVectorScale:!0};if(Ut.forEach(An=>{Fe=-1;const ln=An?je.LINES:je.TRIANGLES;for(const xn of ue){const kn=W.getTile(xn),$t=l.StencilMode.disabled,rn=F.prevTerrainTileForTile[xn.key],ni=F.terrainTileForTile[xn.key];uo(rn,ni)&&_o.newMorphing(xn.key,rn,ni,Te,250),Re.activeTexture.set(je.TEXTURE0),kn.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE);const hi=_o.getMorphValuesForProxy(xn.key),Qn=hi?1:0;hi&&l.extend$1(tn,{morphing:{srcDemTile:hi.from,dstDemTile:hi.to,phase:l.easeCubicInOut(hi.phase)}});const Ci=l.tileCornersToBounds(xn.canonical),Zi=l.getLatitudinalLod(Ci.getCenter().lat),ui=l.getGridMatrix(xn.canonical,Ci,Zi,Ze.worldSize/Ze._pixelsPerMercatorPixel),Xn=l.globeNormalizeECEF(l.globeTileBounds(xn.canonical)),Ir=qo(Ze.projMatrix,fn,en,Xn,l.globeToMercatorTransition(Ze.zoom),Wt,Ze.frustumCorners.TL,Ze.frustumCorners.TR,Ze.frustumCorners.BR,Ze.frustumCorners.BL,Ze.globeCenterInViewSpace,Ze.globeRadius,Ht,ui);if(_t(Qn,An),F.setupElevationDraw(kn,Le,tn),P.prepareDrawProgram(Re,Le,xn.toUnwrapped()),Ln){const[br,Br,Lr]=An?Ln.getWirefameBuffers(P.context,Zi):Ln.getGridBuffers(Zi);Le.draw(Re,ln,Lt,$t,xt,l.CullFaceMode.backCCW,Ir,"globe_raster",br,Br,Lr)}}}),Ln){const An=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];rt&&An.push("CUSTOM_ANTIALIASING"),Le=P.useProgram("globeRaster",null,An);for(const ln of ue){const{x:xn,y:kn,z:$t}=ln.canonical,rn=0===kn,ni=kn===(1<<$t)-1,[hi,Qn,Ci,Zi]=Ln.getPoleBuffers($t);if(Zi&&(rn||ni)){const ui=W.getTile(ln);Re.activeTexture.set(je.TEXTURE0),ui.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE);let Xn=l.globePoleMatrixForTile($t,xn,Ze);const Ir=l.globeNormalizeECEF(l.globeTileBounds(ln.canonical)),br=(Br,Lr)=>Br.draw(Re,je.TRIANGLES,Lt,l.StencilMode.disabled,xt,l.CullFaceMode.disabled,qo(Ze.projMatrix,Xn,Xn,Ir,0,Wt,Ze.frustumCorners.TL,Ze.frustumCorners.TR,Ze.frustumCorners.BR,Ze.frustumCorners.BL,Ze.globeCenterInViewSpace,Ze.globeRadius,Ht),"globe_pole_raster",Lr,Ci,Zi);F.setupElevationDraw(ui,Le,tn),P.prepareDrawProgram(Re,Le,ln.toUnwrapped()),rn&&br(Le,hi),ni&&(Xn=l.scale(l.create(),Xn,[1,-1,1]),br(Le,Qn))}}}}(f,p,v,C,D);else{const P=f.context,F=P.gl;let W,ue;const Te=f.options.showTerrainWireframe?2:0,Re=(Ze,rt)=>{if(ue===Ze)return;const _t=[jo[Ze]];rt&&_t.push(jo[Te]),W=f.useProgram("terrainRaster",null,_t),ue=Ze},je=f.colorModeForRenderPass(),Le=new l.DepthMode(F.LEQUAL,l.DepthMode.ReadWrite,f.depthRangeFor3D);_o.update(D);const Fe=f.transform,qe=6*Math.pow(1.5,22-Fe.zoom)*p.exaggeration();(Te?[!1,!0]:[!1]).forEach(Ze=>{ue=-1;const rt=Ze?F.LINES:F.TRIANGLES,[_t,xt]=Ze?p.getWirefameBuffer():[p.gridIndexBuffer,p.gridSegments];for(const Lt of C){const en=v.getTile(Lt),Wt=l.StencilMode.disabled,Ut=p.prevTerrainTileForTile[Lt.key],Ln=p.terrainTileForTile[Lt.key];uo(Ut,Ln)&&_o.newMorphing(Lt.key,Ut,Ln,D,250),P.activeTexture.set(F.TEXTURE0),en.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST);const Ht=_o.getMorphValuesForProxy(Lt.key),fn=Ht?1:0;let tn;Ht&&(tn={morphing:{srcDemTile:Ht.from,dstDemTile:Ht.to,phase:l.easeCubicInOut(Ht.phase)}});const An=us(Lt.projMatrix,Xr(Lt.canonical,Fe.renderWorldCopies)?qe/10:qe);Re(fn,Ze),p.setupElevationDraw(en,W,tn),f.prepareDrawProgram(P,W,Lt.toUnwrapped()),W.draw(P,rt,Le,Wt,je,l.CullFaceMode.backCCW,An,"terrain_raster",p.gridBuffer,_t,xt)}})}}(u,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;const u=this.painter,a=this.painter.context,f=this.proxySourceCache,p=this.proxiedCoords[f.id],v=this._drapedRenderBatches.shift(),C=[],D=u.style.order;let P=0;for(const F of p){const W=f.getTileByID(F.proxyTileKey),ue=f.proxyCachedFBO[F.key]?f.proxyCachedFBO[F.key][i]:void 0,Te=void 0!==ue?f.renderCache[ue]:this.pool[P++],Re=void 0!==ue;if(W.texture=Te.tex,Re&&!Te.dirty){C.push(W.tileID);continue}let je;a.bindFramebuffer.set(Te.fb.framebuffer),this.renderedToTile=!1,Te.dirty&&(a.clear({color:l.Color.transparent,stencil:0}),Te.dirty=!1);for(let Le=v.start;Le<=v.end;++Le){const Fe=u.style._layers[D[Le]];if(Fe.isHidden(u.transform.zoom))continue;const qe=u.style._getLayerSourceCache(Fe),Ze=qe?this.proxyToSource[F.key][qe.id]:[F];if(!Ze)continue;const rt=Ze;a.viewport.set([0,0,Te.fb.width,Te.fb.height]),je!==(qe?qe.id:null)&&(this._setupStencil(Te,Ze,Fe,qe),je=qe?qe.id:null),u.renderLayer(u,qe,Fe,rt)}this.renderedToTile?(Te.dirty=!0,C.push(W.tileID)):Re||--P,5===P&&(P=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,a.bindFramebuffer.set(null),a.viewport.set([0,0,u.width,u.height]),v.end+1}postRender(){}renderCacheEfficiency(i){const u=i.order.length;if(0===u)return{efficiency:100};let a,f=0,p=0,v=!1;for(let C=0;C<u;++C){const D=i._layers[i.order[C]];this._style.isLayerDraped(D)?(v&&++f,++p):v||(v=!0,a=D.id)}return 0===p?{efficiency:100}:{efficiency:100*(1-f/p),firstUndrapedLayer:a}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{i=Math.min(i,u.dem.tree.minimums[0])}),0===i?i:(i-30)*this._exaggeration}raycast(i,u,a){if(!this._visibleDemTiles)return null;const f=this._visibleDemTiles.filter(p=>p.dem).map(p=>{const v=p.tileID,C=1<<v.overscaledZ,{x:D,y:P}=v.canonical,F=D/C,W=(D+1)/C,ue=P/C,Te=(P+1)/C;return{minx:F,miny:ue,maxx:W,maxy:Te,t:p.dem.tree.raycastRoot(F,ue,W,Te,i,u,a),tile:p}});f.sort((p,v)=>(null!==p.t?p.t:Number.MAX_VALUE)-(null!==v.t?v.t:Number.MAX_VALUE));for(const p of f){if(null==p.t)return null;const v=p.tile.dem.tree.raycast(p.minx,p.miny,p.maxx,p.maxy,i,u,a);if(null!=v)return v}return null}_createFBO(){const i=this.painter.context,u=i.gl,a=this.drapeBufferSize;i.activeTexture.set(u.TEXTURE0);const f=new l.Texture(i,{width:a[0],height:a[1],data:null},u.RGBA);f.bind(u.LINEAR,u.CLAMP_TO_EDGE);const p=i.createFramebuffer(a[0],a[1],!1);return p.colorAttachment.set(f.texture),p.depthAttachment=new Ue(i,p.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,a[0],a[1]),this._stencilRef=0,p.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):p.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:p,tex:f,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const u=this._style._layers[i],a=u.isHidden(this.painter.transform.zoom);return"custom"!==u.type&&!a&&u.hasTransition()})}_clearRasterFadeFromRenderCache(){let i=!1;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u]._source instanceof z){i=!0;break}if(i)for(let u=0;u<this._style.order.length;++u){const a=this._style._layers[this._style.order[u]],f=a.isHidden(this.painter.transform.zoom),p=this._style._getLayerSourceCache(a);if("raster"!==a.type||f||!p)continue;const v=a.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const D=this.proxyToSource[C.key][p.id];if(D)for(const P of D){const F=Yo(p.getTile(P),p.findLoadedParent(P,0),p,this.painter.transform,v);(1!==F.opacity||0!==F.mix)&&this._clearRenderCacheForTile(p.id,P)}}}}_setupDrapedRenderBatches(){const i=this._style.order,u=i.length;if(0===u)return;const a=[];let f,p=0,v=this._style._layers[i[p]];for(;!this._style.isLayerDraped(v)&&v.isHidden(this.painter.transform.zoom)&&++p<u;)v=this._style._layers[i[p]];for(;p<u;++p){const C=this._style._layers[i[p]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?void 0===f&&(f=p):void 0!==f&&(a.push({start:f,end:p-1}),f=void 0))}void 0!==f&&a.push({start:f,end:p-1}),this._drapedRenderBatches=a}_setupRenderCache(i){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const v=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let C=0;C<v.length;++C){const D=Object.values(v[C]);u.renderCachePool.push(...D)}}return}this._clearRasterFadeFromRenderCache();const a=this.proxyCoords,f=this._tilesDirty;for(let v=a.length-1;v>=0;v--){const C=a[v];if(u.getTileByID(C.key),void 0!==u.proxyCachedFBO[C.key]){const D=i[C.key],P=this.proxyToSource[C.key];let F=0;for(const W in P){const ue=P[W],Te=D[W];if(!Te||Te.length!==ue.length||ue.some((Re,je)=>Re!==Te[je]||f[W]&&f[W].hasOwnProperty(Re.key))){F=-1;break}++F}for(const W in u.proxyCachedFBO[C.key])u.renderCache[u.proxyCachedFBO[C.key][W]].dirty=F<0||F!==Object.values(D).length}}const p=[...this._drapedRenderBatches];p.sort((v,C)=>C.end-C.start-(v.end-v.start));for(const v of p)for(const C of a){if(u.proxyCachedFBO[C.key])continue;let D=u.renderCachePool.pop();void 0===D&&u.renderCache.length<50&&(D=u.renderCache.length,u.renderCache.push(this._createFBO())),void 0!==D&&(u.proxyCachedFBO[C.key]={},u.proxyCachedFBO[C.key][v.start]=D,u.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(i,u,a,f){if(!f||!this._sourceTilesOverlap[f.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const p=this.painter.context,v=p.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let C;if(a.isTileClipped())C=u.length,this._overlapStencilMode.test={func:v.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:v.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(p.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,a.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):l.StencilMode.disabled}_renderTileClippingMasks(i,u){const a=this.painter,f=this.painter.context,p=f.gl;a._tileClippingMaskIDs={},f.setColorMode(l.ColorMode.disabled),f.setDepthMode(l.DepthMode.disabled);const v=a.useProgram("clippingMask");for(const C of i){const D=a._tileClippingMaskIDs[C.key]=--u;v.draw(f,p.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:p.ALWAYS,mask:0},D,255,p.KEEP,p.KEEP,p.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,ma(C.projMatrix),"$clipping",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments)}}pointCoordinate(i){const u=this.painter.transform;if(i.x<0||i.x>u.width||i.y<0||i.y>u.height)return null;const a=[i.x,i.y,1,1];l.transformMat4$1(a,a,u.pixelMatrixInverse),l.scale$1(a,a,1/a[3]),a[0]/=u.worldSize,a[1]/=u.worldSize;const f=u._camera.position,p=l.mercatorZfromAltitude(1,u.center.lat),v=[f[0],f[1],f[2]/p,0],C=l.subtract([],a.slice(0,3),v);l.normalize(C,C);const D=this.raycast(v,C,this._exaggeration);return null!==D&&D?(l.scaleAndAdd(v,v,C,D),v[3]=v[2],v[2]*=p,v):null}drawDepth(){const i=this.painter,u=i.context,a=this.proxySourceCache,f=Math.ceil(i.width),p=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===f&&this._depthFBO.height===p||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const v=u.gl,C=u.createFramebuffer(f,p,!0);u.activeTexture.set(v.TEXTURE0);const D=new l.Texture(u,{width:f,height:p,data:null},v.RGBA);D.bind(v.NEAREST,v.CLAMP_TO_EDGE),C.colorAttachment.set(D.texture);const P=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,f,p);C.depthAttachment.set(P),this._depthFBO=C,this._depthTexture=D}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,f,p]),function(v,C,D,P){if("globe"===v.transform.projection.name)return;const F=v.context,W=F.gl;F.clear({depth:1});const ue=v.useProgram("terrainDepth"),Te=new l.DepthMode(W.LESS,l.DepthMode.ReadWrite,v.depthRangeFor3D);for(const Re of P){const je=D.getTile(Re),Le=us(Re.projMatrix,0);C.setupElevationDraw(je,ue),ue.draw(F,W.TRIANGLES,Te,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.backCCW,Le,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(i,this,a,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,u,a){if(i.getSource()instanceof tt)return this._setupProxiedCoordsForImageSource(i,u,a);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const f=this.proxiedCoords[i.id]=[],p=this.proxyCoords;for(let C=0;C<p.length;C++){const D=p[C],P=this._findTileCoveringTileID(D,i);if(P){const F=this._createProxiedId(D,P,a[D.key]&&a[D.key][i.id]);f.push(F),this.proxyToSource[D.key][i.id]=[F]}}let v=!1;for(let C=0;C<u.length;C++){const D=i.getTile(u[C]);if(!D||!D.hasData())continue;const P=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==D.tileID.canonical.z){const F=this.proxyToSource[P.tileID.key][i.id],W=this._createProxiedId(P.tileID,D,a[P.tileID.key]&&a[P.tileID.key][i.id]);F?F.splice(F.length-1,0,W):this.proxyToSource[P.tileID.key][i.id]=[W],f.push(W),v=!0}}this._sourceTilesOverlap[i.id]=v}_setupProxiedCoordsForImageSource(i,u,a){if(!i.getSource().loaded())return;const f=this.proxiedCoords[i.id]=[],p=this.proxyCoords,v=i.getSource(),C=new l.pointGeometry(v.tileID.x,v.tileID.y)._div(1<<v.tileID.z),D=v.coordinates.map(l.MercatorCoordinate.fromLngLat).reduce((F,W)=>(F.min.x=Math.min(F.min.x,W.x-C.x),F.min.y=Math.min(F.min.y,W.y-C.y),F.max.x=Math.max(F.max.x,W.x-C.x),F.max.y=Math.max(F.max.y,W.y-C.y),F),{min:new l.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new l.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(F,W)=>{const ue=F.wrap+F.canonical.x/(1<<F.canonical.z),Te=F.canonical.y/(1<<F.canonical.z),Re=l.EXTENT/(1<<F.canonical.z),je=W.wrap+W.canonical.x/(1<<W.canonical.z),Le=W.canonical.y/(1<<W.canonical.z);return ue+Re<je+D.min.x||ue>je+D.max.x||Te+Re<Le+D.min.y||Te>Le+D.max.y};for(let F=0;F<p.length;F++){const W=p[F];for(let ue=0;ue<u.length;ue++){const Te=i.getTile(u[ue]);if(!Te||!Te.hasData()||P(W,Te.tileID))continue;const Re=this._createProxiedId(W,Te,a[W.key]&&a[W.key][i.id]),je=this.proxyToSource[W.key][i.id];je?je.push(Re):this.proxyToSource[W.key][i.id]=[Re],f.push(Re)}}}_createProxiedId(i,u,a){let f=this.orthoMatrix;if(a){const p=a.find(v=>v.key===u.tileID.key);if(p)return p}if(u.tileID.key!==i.key){const p=i.canonical.z-u.tileID.canonical.z;let v,C,D;f=l.create();const P=u.tileID.wrap-i.wrap<<i.overscaledZ;p>0?(v=l.EXTENT>>p,C=v*((u.tileID.canonical.x<<p)-i.canonical.x+P),D=v*((u.tileID.canonical.y<<p)-i.canonical.y)):(v=l.EXTENT<<-p,C=l.EXTENT*(u.tileID.canonical.x-(i.canonical.x+P<<-p)),D=l.EXTENT*(u.tileID.canonical.y-(i.canonical.y<<-p))),l.ortho(f,0,v,0,v,0,1),l.translate(f,f,[C,D,0])}return new Aa(u.tileID,i.key,f)}_findTileCoveringTileID(i,u){let a=u.getTile(i);if(a&&a.hasData())return a;const f=this._findCoveringTileCache[u.id],p=f[i.key];if(a=p?u.getTileByID(p):null,a&&a.hasData()||null===p)return a;let v=a?a.tileID:i,C=v.overscaledZ;const D=u.getSource().minzoom,P=[];if(!p){const W=u.getSource().maxzoom;if(i.canonical.z>=W){const ue=i.canonical.z-W;u.getSource().reparseOverscaled?(C=Math.max(i.canonical.z+2,u.transform.tileZoom),v=new l.OverscaledTileID(C,i.wrap,W,i.canonical.x>>ue,i.canonical.y>>ue)):0!==ue&&(C=W,v=new l.OverscaledTileID(C,i.wrap,W,i.canonical.x>>ue,i.canonical.y>>ue))}v.key!==i.key&&(P.push(v.key),a=u.getTile(v))}const F=W=>{P.forEach(ue=>{f[ue]=W}),P.length=0};for(C-=1;C>=D&&(!a||!a.hasData());C--){a&&F(a.tileID.key);const W=v.calculateScaledKey(C);if(a=u.getTileByID(W),a&&a.hasData())break;const ue=f[W];if(null===ue)break;void 0===ue?P.push(W):a=u.getTileByID(ue)}return F(a?a.tileID.key:null),a&&a.hasData()?a:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,u){let a=this._tilesDirty[i];a||(a=this._tilesDirty[i]={}),a[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(u){let a=0;const f=new l.StructArrayLayout2ui4,p=131;for(let v=1;v<129;v++){for(let C=1;C<129;C++)a=v*p+C,f.emplaceBack(a,a+1),f.emplaceBack(a,a+p),f.emplaceBack(a+1,a+p),128===v&&f.emplaceBack(a+p,a+p+1);f.emplaceBack(a+1,a+1+p)}return f}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=l.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Dr{static cacheKey(i,u,a,f){let p=`${u}${f?f.cacheKey:""}`;for(const v of a)i.usedDefines.includes(v)&&(p+=`/${v}`);return p}constructor(i,u,a,f,p,v){const C=i.gl;this.program=C.createProgram();const D=function(Le){const Fe=[];for(let qe=0;qe<Le.length;qe++){if(null===Le[qe])continue;const Ze=Le[qe].split(" ");Fe.push(Ze.pop())}return Fe}(a.staticAttributes),P=f?f.getBinderAttributes():[],F=D.concat(P);let W=f?f.defines():[];W=W.concat(v.map(Le=>`#define ${Le}`));const ue=W.concat(i.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(cs):cs,cs,Ma,cl.fragmentSource,fa.fragmentSource,a.fragmentSource).join("\n"),Te=W.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ma,cl.vertexSource,fa.vertexSource,ls.vertexSource,a.vertexSource).join("\n"),Re=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(Re,ue),C.compileShader(Re),C.attachShader(this.program,Re);const je=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(je,Te),C.compileShader(je),C.attachShader(this.program,je),this.attributes={},this.numAttributes=F.length;for(let Le=0;Le<this.numAttributes;Le++)F[Le]&&(C.bindAttribLocation(this.program,Le,F[Le]),this.attributes[F[Le]]=Le);C.linkProgram(this.program),C.deleteShader(je),C.deleteShader(Re),this.fixedUniforms=p(i),this.binderUniforms=f?f.getUniforms(i):[],v.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new l.Uniform1i(Le=i),u_dem_prev:new l.Uniform1i(Le),u_dem_unpack:new l.Uniform4f(Le),u_dem_tl:new l.Uniform2f(Le),u_dem_scale:new l.Uniform1f(Le),u_dem_tl_prev:new l.Uniform2f(Le),u_dem_scale_prev:new l.Uniform1f(Le),u_dem_size:new l.Uniform1f(Le),u_dem_lerp:new l.Uniform1f(Le),u_exaggeration:new l.Uniform1f(Le),u_depth:new l.Uniform1i(Le),u_depth_size_inv:new l.Uniform2f(Le),u_meter_to_dem:new l.Uniform1f(Le),u_label_plane_matrix_inv:new l.UniformMatrix4f(Le)}),v.includes("GLOBE")&&(this.globeUniforms=(Le=>({u_tile_tl_up:new l.Uniform3f(Le),u_tile_tr_up:new l.Uniform3f(Le),u_tile_br_up:new l.Uniform3f(Le),u_tile_bl_up:new l.Uniform3f(Le),u_tile_up_scale:new l.Uniform1f(Le)}))(i)),v.includes("FOG")&&(this.fogUniforms=(Le=>({u_fog_matrix:new l.UniformMatrix4f(Le),u_fog_range:new l.Uniform2f(Le),u_fog_color:new l.Uniform4f(Le),u_fog_horizon_blend:new l.Uniform1f(Le),u_fog_temporal_offset:new l.Uniform1f(Le),u_frustum_tl:new l.Uniform3f(Le),u_frustum_tr:new l.Uniform3f(Le),u_frustum_br:new l.Uniform3f(Le),u_frustum_bl:new l.Uniform3f(Le),u_globe_pos:new l.Uniform3f(Le),u_globe_radius:new l.Uniform1f(Le),u_globe_transition:new l.Uniform1f(Le),u_is_globe:new l.Uniform1i(Le),u_viewport:new l.Uniform2f(Le)}))(i))}var Le}setTerrainUniformValues(i,u){if(!this.terrainUniforms)return;const a=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const f in u)a[f]&&a[f].set(this.program,f,u[f])}}setGlobeUniformValues(i,u){if(!this.globeUniforms)return;const a=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const f in u)a[f]&&a[f].set(this.program,f,u[f])}}setFogUniformValues(i,u){if(!this.fogUniforms)return;const a=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const f in u)a[f].set(this.program,f,u[f])}}draw(i,u,a,f,p,v,C,D,P,F,W,ue,Te,Re,je){const Le=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(a),i.setStencilMode(f),i.setColorMode(p),i.setCullFace(v);for(const qe of Object.keys(this.fixedUniforms))this.fixedUniforms[qe].set(this.program,qe,C[qe]);Re&&Re.setUniforms(this.program,i,this.binderUniforms,ue,{zoom:Te});const Fe={[Le.LINES]:2,[Le.TRIANGLES]:3,[Le.LINE_STRIP]:1}[u];for(const qe of W.get()){const Ze=qe.vaos||(qe.vaos={});(Ze[D]||(Ze[D]=new qs)).bind(i,this,P,Re?Re.getPaintVertexBuffers():[],F,qe.vertexOffset,je||[]),Le.drawElements(u,qe.primitiveLength*Fe,Le.UNSIGNED_SHORT,qe.primitiveOffset*Fe*2)}}}function Js(m,i){const u=Math.pow(2,i.tileID.overscaledZ),a=i.tileSize*Math.pow(2,m.transform.tileZoom)/u,f=a*(i.tileID.canonical.x+i.tileID.wrap*u),p=a*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_tile_units_to_pixels:1/Mt(i,1,m.transform.tileZoom),u_pixel_coord_upper:[f>>16,p>>16],u_pixel_coord_lower:[65535&f,65535&p]}}const Jo=l.create(),qa=(m,i,u,a,f,p,v,C,D,P,F)=>{const W=i.style.light,ue=W.properties.get("position"),Te=[ue.x,ue.y,ue.z],Re=l.create$1();"viewport"===W.properties.get("anchor")&&(l.fromRotation(Re,-i.transform.angle),l.transformMat3(Te,Te,Re));const je=W.properties.get("color"),Le=i.transform,Fe={u_matrix:m,u_lightpos:Te,u_lightintensity:W.properties.get("intensity"),u_lightcolor:[je.r,je.g,je.b],u_vertical_gradient:+u,u_opacity:a,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Jo,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:f,u_edge_radius:p};return"globe"===Le.projection.name&&(Fe.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],Fe.u_zoom_transition=D,Fe.u_inv_rot_matrix=F,Fe.u_merc_center=P,Fe.u_up_dir=Le.projection.upVector(new l.CanonicalTileID(0,0,0),P[0]*l.EXTENT,P[1]*l.EXTENT),Fe.u_height_lift=C),Fe},K=(m,i,u,a,f,p,v,C,D,P,F,W)=>{const ue=qa(m,i,u,a,f,p,v,D,P,F,W),Te={u_height_factor:-Math.pow(2,v.overscaledZ)/C.tileSize/8};return l.extend(ue,Js(i,C),Te)},Y=m=>({u_matrix:m}),G=(m,i,u)=>l.extend(Y(m),Js(i,u)),Ie=(m,i)=>({u_matrix:m,u_world:i}),pn=(m,i,u,a)=>l.extend(G(m,i,u),{u_world:a}),ci=l.create(),dr=(m,i,u,a,f,p)=>{const v=m.transform,C="globe"===v.projection.name;let D;if("map"===p.paint.get("circle-pitch-alignment"))if(C){const F=l.globePixelsToTileUnits(v.zoom,i.canonical)*v._pixelsPerMercatorPixel;D=Float32Array.from([F,0,0,F])}else D=v.calculatePixelsToTileUnitsMatrix(u);else D=new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:v.cameraToCenterDistance,u_matrix:m.translatePosMatrix(i.projMatrix,u,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:l.exported.devicePixelRatio,u_extrude_scale:D,u_inv_rot_matrix:ci,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){P.u_inv_rot_matrix=a,P.u_merc_center=f,P.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],P.u_zoom_transition=l.globeToMercatorTransition(v.zoom);const F=f[0]*l.EXTENT,W=f[1]*l.EXTENT;P.u_up_dir=v.projection.upVector(new l.CanonicalTileID(0,0,0),F,W)}return P},hr=m=>{const i=[];return"map"===m.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===m.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i},Ts=(m,i,u,a)=>{const f=l.EXTENT/u.tileSize;return{u_matrix:m,u_camera_to_center_distance:i.getCameraToCenterDistance(a),u_extrude_scale:[i.pixelsToGLUnits[0]/f,i.pixelsToGLUnits[1]/f]}},So=(m,i,u=1)=>({u_matrix:m,u_color:i,u_overlay:0,u_overlay_scale:u}),Ya=l.create(),Al=(m,i,u,a,f,p,v)=>{const C=m.transform,D="globe"===C.projection.name,P=D?l.globePixelsToTileUnits(C.zoom,i.canonical)*C._pixelsPerMercatorPixel:Mt(u,1,p),F={u_matrix:i.projMatrix,u_extrude_scale:P,u_intensity:v,u_inv_rot_matrix:Ya,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){F.u_inv_rot_matrix=a,F.u_merc_center=f,F.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],F.u_zoom_transition=l.globeToMercatorTransition(C.zoom);const W=f[0]*l.EXTENT,ue=f[1]*l.EXTENT;F.u_up_dir=C.projection.upVector(new l.CanonicalTileID(0,0,0),W,ue)}return F},Sn=(m,i,u,a,f,p,v)=>{const C=m.transform,D=C.calculatePixelsToTileUnitsMatrix(i);return{u_matrix:ul(m,i,u,a),u_pixels_to_tile_units:D,u_device_pixel_ratio:p,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:ao(u)?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Pa(i,m.transform),u_alpha_discard_threshold:0,u_trim_offset:v}},Ri=(m,i,u,a,f)=>{const p=m.transform;return{u_matrix:ul(m,i,u,a),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:f,u_image:0,u_tile_units_to_pixels:Pa(i,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Pa(m,i){return 1/Mt(m,1,i.tileZoom)}function ul(m,i,u,a){return m.translatePosMatrix(a||i.tileID.projMatrix,i,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function ao(m){const i=m.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}const pc=(m,i,u,a,f,p)=>{return{u_matrix:m,u_tl_parent:i,u_scale_parent:u,u_fade_t:a.mix,u_opacity:a.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(C=f.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(v=f.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Xs(f.paint.get("raster-hue-rotate")),u_perspective_transform:p};var v,C};function Xs(m){m*=Math.PI/180;const i=Math.sin(m),u=Math.cos(m);return[(2*u+1)/3,(-Math.sqrt(3)*i-u+1)/3,(Math.sqrt(3)*i-u+1)/3]}const $o=l.create(),Es=(m,i,u,a,f,p,v,C,D,P,F,W,ue,Te,Re,je)=>{const Le=f.transform,Fe={u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Le.cameraToCenterDistance,u_rotate_symbol:+u,u_aspect_ratio:Le.width/Le.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:p,u_label_plane_matrix:v,u_coord_matrix:C,u_is_text:+D,u_pitch_with_map:+a,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$o,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:$o,u_up_vector:[0,-1,0]};return"globe"===je.name&&(Fe.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],Fe.u_zoom_transition=W,Fe.u_inv_rot_matrix=Te,Fe.u_merc_center=ue,Fe.u_camera_forward=Le._camera.forward(),Fe.u_ecef_origin=l.globeECEFOrigin(Le.globeMatrix,F.toUnwrapped()),Fe.u_tile_matrix=Float32Array.from(Le.globeMatrix),Fe.u_up_vector=Re),Fe},Xo=(m,i,u,a,f,p,v,C,D,P,F,W,ue,Te,Re,je,Le)=>l.extend(Es(m,i,u,a,f,p,v,C,D,P,W,ue,Te,Re,je,Le),{u_gamma_scale:a?f.transform.cameraToCenterDistance*Math.cos(f.terrain?0:f.transform._pitch):1,u_device_pixel_ratio:l.exported.devicePixelRatio,u_is_halo:+F}),Ks=(m,i,u,a,f,p,v,C,D,P,F,W,ue,Te,Re,je)=>l.extend(Xo(m,i,u,a,f,p,v,C,!0,D,!0,F,W,ue,Te,Re,je),{u_texsize_icon:P,u_texture_icon:1}),Du=(m,i,u)=>({u_matrix:m,u_opacity:i,u_color:u}),dl=(m,i,u,a,f)=>l.extend(function(p,v,C){const D=v.imageManager.getPattern(p.toString()),{width:P,height:F}=v.imageManager.getPixelSize(),W=Math.pow(2,C.tileID.overscaledZ),ue=C.tileSize*Math.pow(2,v.transform.tileZoom)/W,Te=ue*(C.tileID.canonical.x+C.tileID.wrap*W),Re=ue*C.tileID.canonical.y;return{u_image:0,u_pattern_tl:D.tl,u_pattern_br:D.br,u_texsize:[P,F],u_pattern_size:D.displaySize,u_tile_units_to_pixels:1/Mt(C,1,v.transform.tileZoom),u_pixel_coord_upper:[Te>>16,Re>>16],u_pixel_coord_lower:[65535&Te,65535&Re]}}(a,u,f),{u_matrix:m,u_opacity:i}),M={fillExtrusion:m=>({u_matrix:new l.UniformMatrix4f(m),u_lightpos:new l.Uniform3f(m),u_lightintensity:new l.Uniform1f(m),u_lightcolor:new l.Uniform3f(m),u_vertical_gradient:new l.Uniform1f(m),u_opacity:new l.Uniform1f(m),u_edge_radius:new l.Uniform1f(m),u_ao:new l.Uniform2f(m),u_tile_id:new l.Uniform3f(m),u_zoom_transition:new l.Uniform1f(m),u_inv_rot_matrix:new l.UniformMatrix4f(m),u_merc_center:new l.Uniform2f(m),u_up_dir:new l.Uniform3f(m),u_height_lift:new l.Uniform1f(m)}),fillExtrusionPattern:m=>({u_matrix:new l.UniformMatrix4f(m),u_lightpos:new l.Uniform3f(m),u_lightintensity:new l.Uniform1f(m),u_lightcolor:new l.Uniform3f(m),u_vertical_gradient:new l.Uniform1f(m),u_height_factor:new l.Uniform1f(m),u_edge_radius:new l.Uniform1f(m),u_ao:new l.Uniform2f(m),u_tile_id:new l.Uniform3f(m),u_zoom_transition:new l.Uniform1f(m),u_inv_rot_matrix:new l.UniformMatrix4f(m),u_merc_center:new l.Uniform2f(m),u_up_dir:new l.Uniform3f(m),u_height_lift:new l.Uniform1f(m),u_image:new l.Uniform1i(m),u_texsize:new l.Uniform2f(m),u_pixel_coord_upper:new l.Uniform2f(m),u_pixel_coord_lower:new l.Uniform2f(m),u_tile_units_to_pixels:new l.Uniform1f(m),u_opacity:new l.Uniform1f(m)}),fill:m=>({u_matrix:new l.UniformMatrix4f(m)}),fillPattern:m=>({u_matrix:new l.UniformMatrix4f(m),u_image:new l.Uniform1i(m),u_texsize:new l.Uniform2f(m),u_pixel_coord_upper:new l.Uniform2f(m),u_pixel_coord_lower:new l.Uniform2f(m),u_tile_units_to_pixels:new l.Uniform1f(m)}),fillOutline:m=>({u_matrix:new l.UniformMatrix4f(m),u_world:new l.Uniform2f(m)}),fillOutlinePattern:m=>({u_matrix:new l.UniformMatrix4f(m),u_world:new l.Uniform2f(m),u_image:new l.Uniform1i(m),u_texsize:new l.Uniform2f(m),u_pixel_coord_upper:new l.Uniform2f(m),u_pixel_coord_lower:new l.Uniform2f(m),u_tile_units_to_pixels:new l.Uniform1f(m)}),circle:m=>({u_camera_to_center_distance:new l.Uniform1f(m),u_extrude_scale:new l.UniformMatrix2f(m),u_device_pixel_ratio:new l.Uniform1f(m),u_matrix:new l.UniformMatrix4f(m),u_inv_rot_matrix:new l.UniformMatrix4f(m),u_merc_center:new l.Uniform2f(m),u_tile_id:new l.Uniform3f(m),u_zoom_transition:new l.Uniform1f(m),u_up_dir:new l.Uniform3f(m)}),collisionBox:m=>({u_matrix:new l.UniformMatrix4f(m),u_camera_to_center_distance:new l.Uniform1f(m),u_extrude_scale:new l.Uniform2f(m)}),collisionCircle:m=>({u_matrix:new l.UniformMatrix4f(m),u_inv_matrix:new l.UniformMatrix4f(m),u_camera_to_center_distance:new l.Uniform1f(m),u_viewport_size:new l.Uniform2f(m)}),debug:m=>({u_color:new l.UniformColor(m),u_matrix:new l.UniformMatrix4f(m),u_overlay:new l.Uniform1i(m),u_overlay_scale:new l.Uniform1f(m)}),clippingMask:m=>({u_matrix:new l.UniformMatrix4f(m)}),heatmap:m=>({u_extrude_scale:new l.Uniform1f(m),u_intensity:new l.Uniform1f(m),u_matrix:new l.UniformMatrix4f(m),u_inv_rot_matrix:new l.UniformMatrix4f(m),u_merc_center:new l.Uniform2f(m),u_tile_id:new l.Uniform3f(m),u_zoom_transition:new l.Uniform1f(m),u_up_dir:new l.Uniform3f(m)}),heatmapTexture:m=>({u_image:new l.Uniform1i(m),u_color_ramp:new l.Uniform1i(m),u_opacity:new l.Uniform1f(m)}),hillshade:m=>({u_matrix:new l.UniformMatrix4f(m),u_image:new l.Uniform1i(m),u_latrange:new l.Uniform2f(m),u_light:new l.Uniform2f(m),u_shadow:new l.UniformColor(m),u_highlight:new l.UniformColor(m),u_accent:new l.UniformColor(m)}),hillshadePrepare:m=>({u_matrix:new l.UniformMatrix4f(m),u_image:new l.Uniform1i(m),u_dimension:new l.Uniform2f(m),u_zoom:new l.Uniform1f(m),u_unpack:new l.Uniform4f(m)}),line:m=>({u_matrix:new l.UniformMatrix4f(m),u_pixels_to_tile_units:new l.UniformMatrix2f(m),u_device_pixel_ratio:new l.Uniform1f(m),u_units_to_pixels:new l.Uniform2f(m),u_dash_image:new l.Uniform1i(m),u_gradient_image:new l.Uniform1i(m),u_image_height:new l.Uniform1f(m),u_texsize:new l.Uniform2f(m),u_tile_units_to_pixels:new l.Uniform1f(m),u_alpha_discard_threshold:new l.Uniform1f(m),u_trim_offset:new l.Uniform2f(m)}),linePattern:m=>({u_matrix:new l.UniformMatrix4f(m),u_texsize:new l.Uniform2f(m),u_pixels_to_tile_units:new l.UniformMatrix2f(m),u_device_pixel_ratio:new l.Uniform1f(m),u_image:new l.Uniform1i(m),u_units_to_pixels:new l.Uniform2f(m),u_tile_units_to_pixels:new l.Uniform1f(m),u_alpha_discard_threshold:new l.Uniform1f(m)}),raster:m=>({u_matrix:new l.UniformMatrix4f(m),u_tl_parent:new l.Uniform2f(m),u_scale_parent:new l.Uniform1f(m),u_fade_t:new l.Uniform1f(m),u_opacity:new l.Uniform1f(m),u_image0:new l.Uniform1i(m),u_image1:new l.Uniform1i(m),u_brightness_low:new l.Uniform1f(m),u_brightness_high:new l.Uniform1f(m),u_saturation_factor:new l.Uniform1f(m),u_contrast_factor:new l.Uniform1f(m),u_spin_weights:new l.Uniform3f(m),u_perspective_transform:new l.Uniform2f(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new l.Uniform1i(m),u_is_size_feature_constant:new l.Uniform1i(m),u_size_t:new l.Uniform1f(m),u_size:new l.Uniform1f(m),u_camera_to_center_distance:new l.Uniform1f(m),u_rotate_symbol:new l.Uniform1i(m),u_aspect_ratio:new l.Uniform1f(m),u_fade_change:new l.Uniform1f(m),u_matrix:new l.UniformMatrix4f(m),u_label_plane_matrix:new l.UniformMatrix4f(m),u_coord_matrix:new l.UniformMatrix4f(m),u_is_text:new l.Uniform1i(m),u_pitch_with_map:new l.Uniform1i(m),u_texsize:new l.Uniform2f(m),u_tile_id:new l.Uniform3f(m),u_zoom_transition:new l.Uniform1f(m),u_inv_rot_matrix:new l.UniformMatrix4f(m),u_merc_center:new l.Uniform2f(m),u_camera_forward:new l.Uniform3f(m),u_tile_matrix:new l.UniformMatrix4f(m),u_up_vector:new l.Uniform3f(m),u_ecef_origin:new l.Uniform3f(m),u_texture:new l.Uniform1i(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new l.Uniform1i(m),u_is_size_feature_constant:new l.Uniform1i(m),u_size_t:new l.Uniform1f(m),u_size:new l.Uniform1f(m),u_camera_to_center_distance:new l.Uniform1f(m),u_rotate_symbol:new l.Uniform1i(m),u_aspect_ratio:new l.Uniform1f(m),u_fade_change:new l.Uniform1f(m),u_matrix:new l.UniformMatrix4f(m),u_label_plane_matrix:new l.UniformMatrix4f(m),u_coord_matrix:new l.UniformMatrix4f(m),u_is_text:new l.Uniform1i(m),u_pitch_with_map:new l.Uniform1i(m),u_texsize:new l.Uniform2f(m),u_texture:new l.Uniform1i(m),u_gamma_scale:new l.Uniform1f(m),u_device_pixel_ratio:new l.Uniform1f(m),u_tile_id:new l.Uniform3f(m),u_zoom_transition:new l.Uniform1f(m),u_inv_rot_matrix:new l.UniformMatrix4f(m),u_merc_center:new l.Uniform2f(m),u_camera_forward:new l.Uniform3f(m),u_tile_matrix:new l.UniformMatrix4f(m),u_up_vector:new l.Uniform3f(m),u_ecef_origin:new l.Uniform3f(m),u_is_halo:new l.Uniform1i(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new l.Uniform1i(m),u_is_size_feature_constant:new l.Uniform1i(m),u_size_t:new l.Uniform1f(m),u_size:new l.Uniform1f(m),u_camera_to_center_distance:new l.Uniform1f(m),u_rotate_symbol:new l.Uniform1i(m),u_aspect_ratio:new l.Uniform1f(m),u_fade_change:new l.Uniform1f(m),u_matrix:new l.UniformMatrix4f(m),u_label_plane_matrix:new l.UniformMatrix4f(m),u_coord_matrix:new l.UniformMatrix4f(m),u_is_text:new l.Uniform1i(m),u_pitch_with_map:new l.Uniform1i(m),u_texsize:new l.Uniform2f(m),u_texsize_icon:new l.Uniform2f(m),u_texture:new l.Uniform1i(m),u_texture_icon:new l.Uniform1i(m),u_gamma_scale:new l.Uniform1f(m),u_device_pixel_ratio:new l.Uniform1f(m),u_is_halo:new l.Uniform1i(m)}),background:m=>({u_matrix:new l.UniformMatrix4f(m),u_opacity:new l.Uniform1f(m),u_color:new l.UniformColor(m)}),backgroundPattern:m=>({u_matrix:new l.UniformMatrix4f(m),u_opacity:new l.Uniform1f(m),u_image:new l.Uniform1i(m),u_pattern_tl:new l.Uniform2f(m),u_pattern_br:new l.Uniform2f(m),u_texsize:new l.Uniform2f(m),u_pattern_size:new l.Uniform2f(m),u_pixel_coord_upper:new l.Uniform2f(m),u_pixel_coord_lower:new l.Uniform2f(m),u_tile_units_to_pixels:new l.Uniform1f(m)}),terrainRaster:Cs,terrainDepth:Cs,skybox:m=>({u_matrix:new l.UniformMatrix4f(m),u_sun_direction:new l.Uniform3f(m),u_cubemap:new l.Uniform1i(m),u_opacity:new l.Uniform1f(m),u_temporal_offset:new l.Uniform1f(m)}),skyboxGradient:m=>({u_matrix:new l.UniformMatrix4f(m),u_color_ramp:new l.Uniform1i(m),u_center_direction:new l.Uniform3f(m),u_radius:new l.Uniform1f(m),u_opacity:new l.Uniform1f(m),u_temporal_offset:new l.Uniform1f(m)}),skyboxCapture:m=>({u_matrix_3f:new l.UniformMatrix3f(m),u_sun_direction:new l.Uniform3f(m),u_sun_intensity:new l.Uniform1f(m),u_color_tint_r:new l.Uniform4f(m),u_color_tint_m:new l.Uniform4f(m),u_luminance:new l.Uniform1f(m)}),globeRaster:m=>({u_proj_matrix:new l.UniformMatrix4f(m),u_globe_matrix:new l.UniformMatrix4f(m),u_normalize_matrix:new l.UniformMatrix4f(m),u_merc_matrix:new l.UniformMatrix4f(m),u_zoom_transition:new l.Uniform1f(m),u_merc_center:new l.Uniform2f(m),u_image0:new l.Uniform1i(m),u_grid_matrix:new l.UniformMatrix3f(m),u_frustum_tl:new l.Uniform3f(m),u_frustum_tr:new l.Uniform3f(m),u_frustum_br:new l.Uniform3f(m),u_frustum_bl:new l.Uniform3f(m),u_globe_pos:new l.Uniform3f(m),u_globe_radius:new l.Uniform1f(m),u_viewport:new l.Uniform2f(m)}),globeAtmosphere:m=>({u_frustum_tl:new l.Uniform3f(m),u_frustum_tr:new l.Uniform3f(m),u_frustum_br:new l.Uniform3f(m),u_frustum_bl:new l.Uniform3f(m),u_horizon:new l.Uniform1f(m),u_transition:new l.Uniform1f(m),u_fadeout_range:new l.Uniform1f(m),u_color:new l.Uniform4f(m),u_high_color:new l.Uniform4f(m),u_space_color:new l.Uniform4f(m),u_star_intensity:new l.Uniform1f(m),u_star_density:new l.Uniform1f(m),u_star_size:new l.Uniform1f(m),u_temporal_offset:new l.Uniform1f(m),u_horizon_angle:new l.Uniform1f(m),u_rotation_matrix:new l.UniformMatrix4f(m)})};let j;function S(m,i,u,a,f,p,v){const C=m.context,D=C.gl,P=m.transform,F=m.useProgram("collisionBox"),W=[];let ue=0,Te=0;for(let rt=0;rt<a.length;rt++){const _t=a[rt],xt=i.getTile(_t),Lt=xt.getBucket(u);if(!Lt)continue;const en=Yn(_t,Lt,P);let Wt=en;0===f[0]&&0===f[1]||(Wt=m.translatePosMatrix(en,xt,f,p));const Ut=v?Lt.textCollisionBox:Lt.iconCollisionBox,Ln=Lt.collisionCircleArray;if(Ln.length>0){const Ht=l.create(),fn=Wt;l.mul(Ht,Lt.placementInvProjMatrix,P.glCoordMatrix),l.mul(Ht,Ht,Lt.placementViewportMatrix),W.push({circleArray:Ln,circleOffset:Te,transform:fn,invTransform:Ht,projection:Lt.getProjection()}),ue+=Ln.length/4,Te=ue}Ut&&(m.terrain&&m.terrain.setupElevationDraw(xt,F),F.draw(C,D.LINES,l.DepthMode.disabled,l.StencilMode.disabled,m.colorModeForRenderPass(),l.CullFaceMode.disabled,Ts(Wt,P,xt,Lt.getProjection()),u.id,Ut.layoutVertexBuffer,Ut.indexBuffer,Ut.segments,null,P.zoom,null,[Ut.collisionVertexBuffer,Ut.collisionVertexBufferExt]))}if(!v||!W.length)return;const Re=m.useProgram("collisionCircle"),je=new l.StructArrayLayout2f1f2i16;je.resize(4*ue),je._trim();let Le=0;for(const rt of W)for(let _t=0;_t<rt.circleArray.length/4;_t++){const xt=4*_t,Lt=rt.circleArray[xt+0],en=rt.circleArray[xt+1],Wt=rt.circleArray[xt+2],Ut=rt.circleArray[xt+3];je.emplace(Le++,Lt,en,Wt,Ut,0),je.emplace(Le++,Lt,en,Wt,Ut,1),je.emplace(Le++,Lt,en,Wt,Ut,2),je.emplace(Le++,Lt,en,Wt,Ut,3)}(!j||j.length<2*ue)&&(j=function(rt){const _t=2*rt,xt=new l.StructArrayLayout3ui6;xt.resize(_t),xt._trim();for(let Lt=0;Lt<_t;Lt++){const en=6*Lt;xt.uint16[en+0]=4*Lt+0,xt.uint16[en+1]=4*Lt+1,xt.uint16[en+2]=4*Lt+2,xt.uint16[en+3]=4*Lt+2,xt.uint16[en+4]=4*Lt+3,xt.uint16[en+5]=4*Lt+0}return xt}(ue));const Fe=C.createIndexBuffer(j,!0),qe=C.createVertexBuffer(je,l.collisionCircleLayout.members,!0);for(const rt of W){const _t={u_matrix:rt.transform,u_inv_matrix:rt.invTransform,u_camera_to_center_distance:(Ze=P).getCameraToCenterDistance(rt.projection),u_viewport_size:[Ze.width,Ze.height]};Re.draw(C,D.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,m.colorModeForRenderPass(),l.CullFaceMode.disabled,_t,u.id,qe,Fe,l.SegmentVector.simpleSegment(0,2*rt.circleOffset,rt.circleArray.length,rt.circleArray.length/2),null,P.zoom)}var Ze;qe.destroy(),Fe.destroy()}const V=l.create();function ve({width:m,height:i,anchor:u,textOffset:a,textScale:f},p){const{horizontalAlign:v,verticalAlign:C}=l.getAnchorAlignment(u),D=-(v-.5)*m,P=-(C-.5)*i,F=l.evaluateVariableOffset(u,a);return new l.pointGeometry((D/f+F[0])*p,(P/f+F[1])*p)}function Dt(m,i,u,a,f,p,v,C,D,P,F){const W=m.text.placedSymbolArray,ue=m.text.dynamicLayoutVertexArray,Te=m.icon.dynamicLayoutVertexArray,Re={},je=m.getProjection(),Le=Mi(C,je,p),Fe=p.elevation,qe=je.upVectorScale(C.canonical,p.center.lat,p.worldSize).metersToTile;ue.clear();for(let Ze=0;Ze<W.length;Ze++){const rt=W.get(Ze),{tileAnchorX:_t,tileAnchorY:xt,numGlyphs:Lt}=rt,Wt=rt.hidden||!rt.crossTileID||m.allowVerticalPlacement&&!rt.placedOrientation?null:a[rt.crossTileID];if(Wt){let Ut=0,Ln=0,Ht=0;if(Fe){const ni=Fe?Fe.getAtTileOffset(C,_t,xt):0,[hi,Qn,Ci]=je.upVector(C.canonical,_t,xt);Ut=ni*hi*qe,Ln=ni*Qn*qe,Ht=ni*Ci*qe}let[fn,tn,An,ln]=mr(rt.projectedAnchorX+Ut,rt.projectedAnchorY+Ln,rt.projectedAnchorZ+Ht,u?Le:v);const xn=Rn(p.getCameraToCenterDistance(je),ln);let kn=f.evaluateSizeForFeature(m.textSizeData,P,rt)*xn/l.ONE_EM;u&&(kn*=m.tilePixelRatio/D);const $t=ve(Wt,kn);u?(({x:fn,y:tn,z:An}=je.projectTilePoint(_t+$t.x,xt+$t.y,C.canonical)),[fn,tn,An]=mr(fn+Ut,tn+Ln,An+Ht,v)):(i&&$t._rotate(-p.angle),fn+=$t.x,tn+=$t.y,An=0);const rn=m.allowVerticalPlacement&&rt.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let ni=0;ni<Lt;ni++)l.addDynamicAttributes(ue,fn,tn,An,rn);F&&rt.associatedIconIndex>=0&&(Re[rt.associatedIconIndex]={x:fn,y:tn,z:An,angle:rn})}else ft(Lt,ue)}if(F){Te.clear();const Ze=m.icon.placedSymbolArray;for(let rt=0;rt<Ze.length;rt++){const _t=Ze.get(rt),{numGlyphs:xt}=_t,Lt=Re[rt];if(_t.hidden||!Lt)ft(xt,Te);else{const{x:en,y:Wt,z:Ut,angle:Ln}=Lt;for(let Ht=0;Ht<xt;Ht++)l.addDynamicAttributes(Te,en,Wt,Ut,Ln)}}m.icon.dynamicLayoutVertexBuffer.updateData(Te)}m.text.dynamicLayoutVertexBuffer.updateData(ue)}function wn(m,i,u){return u.iconsInText&&i?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function zn(m,i,u,a,f,p,v,C,D,P,F,W){const ue=m.context,Te=ue.gl,Re=m.transform,je="map"===C,Le="map"===D,Fe=je&&"point"!==u.layout.get("symbol-placement"),qe=je&&!Le&&!Fe,Ze=void 0!==u.layout.get("symbol-sort-key").constantOr(1);let rt=!1;const _t=m.depthModeForSublayer(0,l.DepthMode.ReadOnly),xt=[l.mercatorXfromLng(Re.center.lng),l.mercatorYfromLat(Re.center.lat)],Lt=u.layout.get("text-variable-anchor"),en="globe"===Re.projection.name,Wt=[],Ut=[0,-1,0];let Ln=Ut;!en&&!Re.mercatorFromTransition||je||(Ln=function(Ht){const fn=Ht._camera.getWorldToCamera(Ht.worldSize,1),tn=l.multiply([],fn,Ht.globeMatrix);l.invert(tn,tn);const An=[0,0,0],ln=[0,1,0,0];return l.transformMat4$1(ln,ln,tn),An[0]=ln[0],An[1]=ln[1],An[2]=ln[2],l.normalize(An,An),An}(Re));for(const Ht of a){const fn=i.getTile(Ht),tn=fn.getBucket(u);if(!tn||"mercator"===tn.projection.name&&en)continue;const An=f?tn.text:tn.icon;if(!An||tn.fullyClipped||!An.segments.get().length)continue;const ln=An.programConfigurations.get(u.id),xn=f||tn.sdfIcons,kn=f?tn.textSizeData:tn.iconSizeData,$t=Le||0!==Re.pitch,rn=l.evaluateSizeForZoom(kn,Re.zoom);let ni,hi,Qn,Ci,Zi=[0,0],ui=null;if(f)hi=fn.glyphAtlasTexture,Qn=Te.LINEAR,ni=fn.glyphAtlasTexture.size,tn.iconsInText&&(Zi=fn.imageAtlasTexture.size,ui=fn.imageAtlasTexture,Ci=$t||m.options.rotating||m.options.zooming||"composite"===kn.kind||"camera"===kn.kind?Te.LINEAR:Te.NEAREST);else{const ia=1!==u.layout.get("icon-size").constantOr(0)||tn.iconsNeedLinear;hi=fn.imageAtlasTexture,Qn=xn||m.options.rotating||m.options.zooming||ia||$t?Te.LINEAR:Te.NEAREST,ni=fn.imageAtlasTexture.size}const Xn="globe"===tn.projection.name,Ir=Xn?Ln:Ut,br=Xn?l.globeToMercatorTransition(Re.zoom):0,Br=Mi(Ht,tn.getProjection(),Re),Lr=Re.calculatePixelsToTileUnitsMatrix(fn),ps=mi(Br,fn.tileID.canonical,Le,je,Re,tn.getProjection(),Lr),ba=m.terrain&&Le&&Fe?l.invert(l.create(),ps):V,Us=Er(Br,fn.tileID.canonical,Le,je,Re,tn.getProjection(),Lr),wa=Lt&&tn.hasTextData(),Kr="none"!==u.layout.get("icon-text-fit")&&wa&&tn.hasIconData();if(Fe){const ia=Re.elevation,ko=ia?ia.getAtTileOffsetFunc(Ht,Re.center.lat,Re.worldSize,tn.getProjection()):null,tl=Qi(Br,fn.tileID.canonical,Le,je,Re,tn.getProjection(),Lr);Cn(tn,Br,m,f,tl,Us,Le,P,ko,Ht)}const Vr=Fe||f&&Lt||Kr,_r=m.translatePosMatrix(Br,fn,p,v),To=Vr?V:ps,Ss=m.translatePosMatrix(Us,fn,p,v,!0),jr=tn.getProjection().createInversionMatrix(Re,Ht.canonical),fs=[];m.terrainRenderModeElevated()&&Le&&fs.push("PITCH_WITH_MAP_TERRAIN"),Xn&&fs.push("PROJECTION_GLOBE_VIEW"),Vr&&fs.push("PROJECTED_POS_ON_VIEWPORT");const Kl=xn&&0!==u.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1);let el;el=xn?tn.iconsInText?Ks(kn.kind,rn,qe,Le,m,_r,To,Ss,ni,Zi,Ht,br,xt,jr,Ir,tn.getProjection()):Xo(kn.kind,rn,qe,Le,m,_r,To,Ss,f,ni,!0,Ht,br,xt,jr,Ir,tn.getProjection()):Es(kn.kind,rn,qe,Le,m,_r,To,Ss,f,ni,Ht,br,xt,jr,Ir,tn.getProjection());const es={program:m.useProgram(wn(xn,f,tn),ln,fs),buffers:An,uniformValues:el,atlasTexture:hi,atlasTextureIcon:ui,atlasInterpolation:Qn,atlasInterpolationIcon:Ci,isSDF:xn,hasHalo:Kl,tile:fn,labelPlaneMatrixInv:ba};if(Ze&&tn.canOverlap){rt=!0;const ia=An.segments.get();for(const ko of ia)Wt.push({segments:new l.SegmentVector([ko]),sortKey:ko.sortKey,state:es})}else Wt.push({segments:An.segments,sortKey:0,state:es})}rt&&Wt.sort((Ht,fn)=>Ht.sortKey-fn.sortKey);for(const Ht of Wt){const fn=Ht.state;if(m.terrain&&m.terrain.setupElevationDraw(fn.tile,fn.program,{useDepthForOcclusion:!en,labelPlaneMatrixInv:fn.labelPlaneMatrixInv}),ue.activeTexture.set(Te.TEXTURE0),fn.atlasTexture.bind(fn.atlasInterpolation,Te.CLAMP_TO_EDGE),fn.atlasTextureIcon&&(ue.activeTexture.set(Te.TEXTURE1),fn.atlasTextureIcon&&fn.atlasTextureIcon.bind(fn.atlasInterpolationIcon,Te.CLAMP_TO_EDGE)),fn.isSDF){const tn=fn.uniformValues;fn.hasHalo&&(tn.u_is_halo=1,xi(fn.buffers,Ht.segments,u,m,fn.program,_t,F,W,tn)),tn.u_is_halo=0}xi(fn.buffers,Ht.segments,u,m,fn.program,_t,F,W,fn.uniformValues)}}function xi(m,i,u,a,f,p,v,C,D){const P=a.context,F=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.globeExtVertexBuffer];f.draw(P,P.gl.TRIANGLES,p,v,C,l.CullFaceMode.disabled,D,u.id,m.layoutVertexBuffer,m.indexBuffer,i,u.paint,a.transform.zoom,m.programConfigurations.get(u.id),F)}function ti(m,i,u,a,f,p,v){const C=m.context.gl,D=u.paint.get("fill-pattern"),P=D&&D.constantOr(1);let F,W,ue,Te,Re;v?(W=P&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=C.LINES):(W=P?"fillPattern":"fill",F=C.TRIANGLES);for(const je of a){const Le=i.getTile(je);if(P&&!Le.patternsLoaded())continue;const Fe=Le.getBucket(u);if(!Fe)continue;m.prepareDrawTile();const qe=Fe.programConfigurations.get(u.id),Ze=m.useProgram(W,qe);P&&(m.context.activeTexture.set(C.TEXTURE0),Le.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),qe.updatePaintBuffers());const rt=D.constantOr(null);if(rt&&Le.imageAtlas){const xt=Le.imageAtlas.patternPositions[rt.toString()];xt&&qe.setConstantPatternPositions(xt)}const _t=m.translatePosMatrix(je.projMatrix,Le,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(v){Te=Fe.indexBuffer2,Re=Fe.segments2;const xt=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];ue="fillOutlinePattern"===W&&P?pn(_t,m,Le,xt):Ie(_t,xt)}else Te=Fe.indexBuffer,Re=Fe.segments,ue=P?G(_t,m,Le):Y(_t);m.prepareDrawProgram(m.context,Ze,je.toUnwrapped()),Ze.draw(m.context,F,f,m.stencilModeForClipping(je),p,l.CullFaceMode.disabled,ue,u.id,Fe.layoutVertexBuffer,Te,Re,u.paint,m.transform.zoom,qe)}}function Gi(m,i,u,a,f,p,v){const C=m.context,D=C.gl,P=m.transform,F=u.paint.get("fill-extrusion-pattern"),W=F.constantOr(1),ue=u.paint.get("fill-extrusion-opacity"),Te=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),u.paint.get("fill-extrusion-ambient-occlusion-radius")],Re=u.layout.get("fill-extrusion-edge-radius"),je="globe"===P.projection.name?l.fillExtrusionHeightLift():0,Le="globe"===P.projection.name,Fe=Le?l.globeToMercatorTransition(P.zoom):0,qe=[l.mercatorXfromLng(P.center.lng),l.mercatorYfromLat(P.center.lat)],Ze=[];Le&&(Ze.push("PROJECTION_GLOBE_VIEW"),m.style.terrainSetForDrapingOnly()&&Ze.push("TERRAIN")),Te[0]>0&&Ze.push("FAUX_AO");for(const rt of a){const _t=i.getTile(rt),xt=_t.getBucket(u);if(!xt||xt.projection.name!==P.projection.name)continue;const Lt=xt.programConfigurations.get(u.id),en=m.useProgram(W?"fillExtrusionPattern":"fillExtrusion",Lt,Ze);if(m.terrain){const An=m.terrain;if(m.style.terrainSetForDrapingOnly())An.setupElevationDraw(_t,en,{useMeterToDem:!0});else{if(!xt.enableTerrain)continue;if(An.setupElevationDraw(_t,en,{useMeterToDem:!0}),nr(C,i,rt,xt,u,An),!xt.centroidVertexBuffer){const ln=en.attributes.a_centroid_pos;void 0!==ln&&D.vertexAttrib2f(ln,0,0)}}}W&&(m.context.activeTexture.set(D.TEXTURE0),_t.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Lt.updatePaintBuffers());const Wt=F.constantOr(null);if(Wt&&_t.imageAtlas){const An=_t.imageAtlas.patternPositions[Wt.toString()];An&&Lt.setConstantPatternPositions(An)}const Ut=m.translatePosMatrix(rt.projMatrix,_t,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Ln=P.projection.createInversionMatrix(P,rt.canonical),Ht=u.paint.get("fill-extrusion-vertical-gradient"),fn=W?K(Ut,m,Ht,ue,Te,Re,rt,_t,je,Fe,qe,Ln):qa(Ut,m,Ht,ue,Te,Re,rt,je,Fe,qe,Ln);m.prepareDrawProgram(C,en,rt.toUnwrapped());const tn=[];m.terrain&&tn.push(xt.centroidVertexBuffer),Le&&tn.push(xt.layoutVertexExtBuffer),en.draw(C,C.gl.TRIANGLES,f,p,v,l.CullFaceMode.backCCW,fn,u.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,u.paint,m.transform.zoom,Lt,tn)}}function nr(m,i,u,a,f,p){const v=[Fe=>{let qe=Fe.canonical.x-1,Ze=Fe.wrap;return qe<0&&(qe=(1<<Fe.canonical.z)-1,Ze--),new l.OverscaledTileID(Fe.overscaledZ,Ze,Fe.canonical.z,qe,Fe.canonical.y)},Fe=>{let qe=Fe.canonical.x+1,Ze=Fe.wrap;return qe===1<<Fe.canonical.z&&(qe=0,Ze++),new l.OverscaledTileID(Fe.overscaledZ,Ze,Fe.canonical.z,qe,Fe.canonical.y)},Fe=>new l.OverscaledTileID(Fe.overscaledZ,Fe.wrap,Fe.canonical.z,Fe.canonical.x,(0===Fe.canonical.y?1<<Fe.canonical.z:Fe.canonical.y)-1),Fe=>new l.OverscaledTileID(Fe.overscaledZ,Fe.wrap,Fe.canonical.z,Fe.canonical.x,Fe.canonical.y===(1<<Fe.canonical.z)-1?0:Fe.canonical.y+1)],C=Fe=>{const qe=i.getSource().minzoom,Ze=_t=>{const xt=i.getTileByID(_t);if(xt&&xt.hasData())return xt.getBucket(f)},rt=[0,-1,1];for(const _t of rt){if(Fe.overscaledZ+_t<qe)continue;const xt=Ze(Fe.calculateScaledKey(Fe.overscaledZ+_t));if(xt)return xt}},D=[0,0,0],P=(Fe,qe)=>(D[0]=Math.min(Fe.min.y,qe.min.y),D[1]=Math.max(Fe.max.y,qe.max.y),D[2]=l.EXTENT-qe.min.x>Fe.max.x?qe.min.x-l.EXTENT:Fe.max.x,D),F=(Fe,qe)=>(D[0]=Math.min(Fe.min.x,qe.min.x),D[1]=Math.max(Fe.max.x,qe.max.x),D[2]=l.EXTENT-qe.min.y>Fe.max.y?qe.min.y-l.EXTENT:Fe.max.y,D),W=[(Fe,qe)=>P(Fe,qe),(Fe,qe)=>P(qe,Fe),(Fe,qe)=>F(Fe,qe),(Fe,qe)=>F(qe,Fe)],ue=new l.pointGeometry(0,0);let Te,Re,je;const Le=(Fe,qe,Ze,rt,_t)=>{const xt=[[rt?Ze:Fe,rt?Fe:Ze,0],[rt?Ze:qe,rt?qe:Ze,0]],Lt=_t<0?l.EXTENT+_t:_t,en=[rt?Lt:(Fe+qe)/2,rt?(Fe+qe)/2:Lt,0];return 0===Ze&&_t<0||0!==Ze&&_t>0?p.getForTilePoints(je,[en],!0,Re):xt.push(en),p.getForTilePoints(u,xt,!0,Te),Math.max(xt[0][2],xt[1][2],en[2])/p.exaggeration()};for(let Fe=0;Fe<4;Fe++){const qe=(Fe<2?1:5)-Fe,Ze=a.borders[Fe];if(0===Ze.length)continue;const rt=je=v[Fe](u),_t=C(rt);if(!(_t&&_t instanceof l.FillExtrusionBucket&&_t.enableTerrain)||a.borderDoneWithNeighborZ[Fe]===_t.canonical.z&&_t.borderDoneWithNeighborZ[qe]===a.canonical.z||(Re=p.findDEMTileFor(rt),!Re||!Re.dem))continue;if(!Te){const Wt=p.findDEMTileFor(u);if(!Wt||!Wt.dem)return;Te=Wt}const xt=_t.borders[qe];let Lt=0;const en=_t.borderDoneWithNeighborZ[qe]!==a.canonical.z;if(a.canonical.z===_t.canonical.z){for(let Wt=0;Wt<Ze.length;Wt++){const Ut=a.featuresOnBorder[Ze[Wt]],Ln=Ut.borders[Fe];let Ht;for(;Lt<xt.length&&(Ht=_t.featuresOnBorder[xt[Lt]],!(Ht.borders[qe][1]>Ln[0]+3));)en&&_t.encodeCentroid(void 0,Ht,!1),Lt++;if(Ht&&Lt<xt.length){const fn=Lt;let tn=0;for(;!(Ht.borders[qe][0]>Ln[1]-3)&&(tn++,++Lt!==xt.length);)Ht=_t.featuresOnBorder[xt[Lt]];if(Ht=_t.featuresOnBorder[xt[fn]],Ut.intersectsCount()>1||Ht.intersectsCount()>1||1!==tn){1!==tn&&(Lt=fn),a.encodeCentroid(void 0,Ut,!1),en&&_t.encodeCentroid(void 0,Ht,!1);continue}const An=W[Fe](Ut,Ht),ln=Fe%2?l.EXTENT-1:0;ue.x=Le(An[0],Math.min(l.EXTENT-1,An[1]),ln,Fe<2,An[2]),ue.y=0,a.encodeCentroid(ue,Ut,!1),en&&_t.encodeCentroid(ue,Ht,!1)}else a.encodeCentroid(void 0,Ut,!1)}a.borderDoneWithNeighborZ[Fe]=_t.canonical.z,a.needsCentroidUpdate=!0,en&&(_t.borderDoneWithNeighborZ[qe]=a.canonical.z,_t.needsCentroidUpdate=!0)}else{for(const Wt of Ze)a.encodeCentroid(void 0,a.featuresOnBorder[Wt],!1);if(en){for(const Wt of xt)_t.encodeCentroid(void 0,_t.featuresOnBorder[Wt],!1);_t.borderDoneWithNeighborZ[qe]=a.canonical.z,_t.needsCentroidUpdate=!0}a.borderDoneWithNeighborZ[Fe]=_t.canonical.z,a.needsCentroidUpdate=!0}}(a.needsCentroidUpdate||!a.centroidVertexBuffer&&0!==a.centroidVertexArray.length)&&a.uploadCentroid(m)}const cr=new l.Color(1,0,0,1),yo=new l.Color(0,1,0,1),vo=new l.Color(0,0,1,1),Ds=new l.Color(1,0,1,1),Ko=new l.Color(0,1,1,1);function ql(m,i,u){const a=m.context,f=m.transform,p=a.gl,v="globe"===f.projection.name,C=v?["PROJECTION_GLOBE_VIEW"]:null;let D=u.projMatrix;if(v&&l.globeToMercatorTransition(f.zoom)>0){const Ut=l.transitionTileAABBinECEF(u.canonical,f),Ln=l.globeDenormalizeECEF(Ut);D=l.multiply(new Float32Array(16),f.globeMatrix,Ln),l.multiply(D,f.projMatrix,D)}const P=m.useProgram("debug",null,C),F=i.getTileByID(u.key);m.terrain&&m.terrain.setupElevationDraw(F,P);const W=l.DepthMode.disabled,ue=l.StencilMode.disabled,Te=m.colorModeForRenderPass();a.activeTexture.set(p.TEXTURE0),m.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),v?F._makeGlobeTileDebugBuffers(m.context,f):F._makeDebugTileBoundsBuffers(m.context,f.projection);const je=F._tileDebugBuffer||m.debugBuffer,Le=F._tileDebugIndexBuffer||m.debugIndexBuffer,Fe=F._tileDebugSegments||m.debugSegments;P.draw(a,p.LINE_STRIP,W,ue,Te,l.CullFaceMode.disabled,So(D,l.Color.red),"$debug",je,Le,Fe,null,null,null,[F._globeTileDebugBorderBuffer]);const qe=F.latestRawTileData,Ze=Math.floor((qe&&qe.byteLength||0)/1024),rt=i.getTile(u).tileSize,_t=512/Math.min(rt,512)*(u.overscaledZ/f.zoom)*.5;let xt=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(xt+=` => ${u.overscaledZ}`),xt+=` ${Ze}kb`,function(Ut,Ln){Ut.initDebugOverlayCanvas();const Ht=Ut.debugOverlayCanvas,fn=Ut.context.gl,tn=Ut.debugOverlayCanvas.getContext("2d");tn.clearRect(0,0,Ht.width,Ht.height),tn.shadowColor="white",tn.shadowBlur=2,tn.lineWidth=1.5,tn.strokeStyle="white",tn.textBaseline="top",tn.font="bold 36px Open Sans, sans-serif",tn.fillText(Ln,5,5),tn.strokeText(Ln,5,5),Ut.debugOverlayTexture.update(Ht),Ut.debugOverlayTexture.bind(fn.LINEAR,fn.CLAMP_TO_EDGE)}(m,xt);const Lt=F._tileDebugTextBuffer||m.debugBuffer,en=F._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Wt=F._tileDebugTextSegments||m.debugSegments;P.draw(a,p.TRIANGLES,W,ue,l.ColorMode.alphaBlended,l.CullFaceMode.disabled,So(D,l.Color.transparent,_t),"$debug",Lt,en,Wt,null,null,null,[F._globeTileDebugTextBuffer])}function hl(m,i,u,a){Zo(m,0,i+u/2,m.transform.width,u,a)}function ga(m,i,u,a){Zo(m,i-u/2,0,u,m.transform.height,a)}function Zo(m,i,u,a,f,p){const v=m.context,C=v.gl;C.enable(C.SCISSOR_TEST),C.scissor(i*l.exported.devicePixelRatio,u*l.exported.devicePixelRatio,a*l.exported.devicePixelRatio,f*l.exported.devicePixelRatio),v.clear({color:p}),C.disable(C.SCISSOR_TEST)}const pl=l.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:fl}=pl;function Rr(m,i,u,a){m.emplaceBack(i,u,a)}class hs{constructor(i){this.vertexArray=new l.StructArrayLayout3f12,this.indices=new l.StructArrayLayout3ui6,Rr(this.vertexArray,-1,-1,1),Rr(this.vertexArray,1,-1,1),Rr(this.vertexArray,-1,1,1),Rr(this.vertexArray,1,1,1),Rr(this.vertexArray,-1,-1,-1),Rr(this.vertexArray,1,-1,-1),Rr(this.vertexArray,-1,1,-1),Rr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,fl),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=l.SegmentVector.simpleSegment(0,0,36,12)}}function Sr(m,i,u,a,f,p){const v=m.gl,C=i.paint.get("sky-atmosphere-color"),D=i.paint.get("sky-atmosphere-halo-color"),P=i.paint.get("sky-atmosphere-sun-intensity"),F={u_matrix_3f:l.fromMat4(l.create$1(),a),u_sun_direction:f,u_sun_intensity:P,u_color_tint_r:[(Re=C).r,Re.g,Re.b,Re.a],u_color_tint_m:[(je=D).r,je.g,je.b,je.a],u_luminance:5e-5};var Re,je;v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+p,i.skyboxTexture,0),u.draw(m,v.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.frontCW,F,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const fc=l.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ur{constructor(i){const u=new l.StructArrayLayout5f20;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const a=new l.StructArrayLayout3ui6;a.emplaceBack(0,1,2),a.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(u,fc.members),this.indexBuffer=i.createIndexBuffer(a),this.segments=l.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Pl={symbol:function(m,i,u,a,f){if("translucent"!==m.renderPass)return;const p=l.StencilMode.disabled,v=m.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(C,D,P,F,W,ue,Te){const Re=D.transform,je="map"===W,Le="map"===ue;for(const Fe of C){const qe=F.getTile(Fe),Ze=qe.getBucket(P);if(!Ze||!Ze.text||!Ze.text.segments.get().length)continue;const rt=l.evaluateSizeForZoom(Ze.textSizeData,Re.zoom),_t=Mi(Fe,Ze.getProjection(),Re),xt=Re.calculatePixelsToTileUnitsMatrix(qe),Lt=mi(_t,qe.tileID.canonical,Le,je,Re,Ze.getProjection(),xt),en="none"!==P.layout.get("icon-text-fit")&&Ze.hasIconData();if(rt){const Wt=Math.pow(2,Re.zoom-qe.tileID.overscaledZ);Dt(Ze,je,Le,Te,l.symbolSize,Re,Lt,Fe,Wt,rt,en)}}}(a,m,u,i,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),f),0!==u.paint.get("icon-opacity").constantOr(1)&&zn(m,i,u,a,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),p,v),0!==u.paint.get("text-opacity").constantOr(1)&&zn(m,i,u,a,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),p,v),i.map.showCollisionBoxes&&(S(m,i,u,a,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),S(m,i,u,a,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(m,i,u,a){if("translucent"!==m.renderPass)return;const f=u.paint.get("circle-opacity"),p=u.paint.get("circle-stroke-width"),v=u.paint.get("circle-stroke-opacity"),C=void 0!==u.layout.get("circle-sort-key").constantOr(1);if(0===f.constantOr(1)&&(0===p.constantOr(1)||0===v.constantOr(1)))return;const D=m.context,P=D.gl,F=m.transform,W=m.depthModeForSublayer(0,l.DepthMode.ReadOnly),ue=l.StencilMode.disabled,Te=m.colorModeForRenderPass(),Re="globe"===F.projection.name,je=[l.mercatorXfromLng(F.center.lng),l.mercatorYfromLat(F.center.lat)],Le=[];for(let qe=0;qe<a.length;qe++){const Ze=a[qe],rt=i.getTile(Ze),_t=rt.getBucket(u);if(!_t||_t.projection.name!==F.projection.name)continue;const xt=_t.programConfigurations.get(u.id),Lt=hr(u);Re&&Lt.push("PROJECTION_GLOBE_VIEW");const en=m.useProgram("circle",xt,Lt),Wt=_t.layoutVertexBuffer,Ut=_t.globeExtVertexBuffer,Ln=_t.indexBuffer,Ht=F.projection.createInversionMatrix(F,Ze.canonical),fn={programConfiguration:xt,program:en,layoutVertexBuffer:Wt,globeExtVertexBuffer:Ut,indexBuffer:Ln,uniformValues:dr(m,Ze,rt,Ht,je,u),tile:rt};if(C){const tn=_t.segments.get();for(const An of tn)Le.push({segments:new l.SegmentVector([An]),sortKey:An.sortKey,state:fn})}else Le.push({segments:_t.segments,sortKey:0,state:fn})}C&&Le.sort((qe,Ze)=>qe.sortKey-Ze.sortKey);const Fe={useDepthForOcclusion:!Re};for(const qe of Le){const{programConfiguration:Ze,program:rt,layoutVertexBuffer:_t,globeExtVertexBuffer:xt,indexBuffer:Lt,uniformValues:en,tile:Wt}=qe.state,Ut=qe.segments;m.terrain&&m.terrain.setupElevationDraw(Wt,rt,Fe),m.prepareDrawProgram(D,rt,Wt.tileID.toUnwrapped()),rt.draw(D,P.TRIANGLES,W,ue,Te,l.CullFaceMode.disabled,en,u.id,_t,Lt,Ut,u.paint,F.zoom,Ze,[xt])}},heatmap:function(m,i,u,a){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const f=m.context,p=f.gl,v=l.StencilMode.disabled,C=new l.ColorMode([p.ONE,p.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(Te,Re,je,Le){const Fe=Te.gl,qe=Re.width*Le,Ze=Re.height*Le;Te.activeTexture.set(Fe.TEXTURE1),Te.viewport.set([0,0,qe,Ze]);let rt=je.heatmapFbo;if(!rt||rt&&(rt.width!==qe||rt.height!==Ze)){rt&&rt.destroy();const _t=Fe.createTexture();Fe.bindTexture(Fe.TEXTURE_2D,_t),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_S,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_T,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MIN_FILTER,Fe.LINEAR),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MAG_FILTER,Fe.LINEAR),rt=je.heatmapFbo=Te.createFramebuffer(qe,Ze,!1),function(xt,Lt,en,Wt,Ut,Ln){const Ht=xt.gl;Ht.texImage2D(Ht.TEXTURE_2D,0,Ht.RGBA,Ut,Ln,0,Ht.RGBA,xt.extRenderToTextureHalfFloat?xt.extTextureHalfFloat.HALF_FLOAT_OES:Ht.UNSIGNED_BYTE,null),Wt.colorAttachment.set(en)}(Te,0,_t,rt,qe,Ze)}else Fe.bindTexture(Fe.TEXTURE_2D,rt.colorAttachment.get()),Te.bindFramebuffer.set(rt.framebuffer)})(f,m,u,"globe"===m.transform.projection.name?.5:.25),f.clear({color:l.Color.transparent});const D=m.transform,P="globe"===D.projection.name,F=P?["PROJECTION_GLOBE_VIEW"]:null,W=P?l.CullFaceMode.frontCCW:l.CullFaceMode.disabled,ue=[l.mercatorXfromLng(D.center.lng),l.mercatorYfromLat(D.center.lat)];for(let Te=0;Te<a.length;Te++){const Re=a[Te];if(i.hasRenderableParent(Re))continue;const je=i.getTile(Re),Le=je.getBucket(u);if(!Le||Le.projection.name!==D.projection.name)continue;const Fe=Le.programConfigurations.get(u.id),qe=m.useProgram("heatmap",Fe,F),{zoom:Ze}=m.transform;m.terrain&&m.terrain.setupElevationDraw(je,qe),m.prepareDrawProgram(f,qe,Re.toUnwrapped());const rt=D.projection.createInversionMatrix(D,Re.canonical);qe.draw(f,p.TRIANGLES,l.DepthMode.disabled,v,C,W,Al(m,Re,je,rt,ue,Ze,u.paint.get("heatmap-intensity")),u.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,u.paint,m.transform.zoom,Fe,P?[Le.globeExtVertexBuffer]:null)}f.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(f,p){const v=f.context,C=v.gl,D=p.heatmapFbo;if(!D)return;v.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,D.colorAttachment.get()),v.activeTexture.set(C.TEXTURE1);let P=p.colorRampTexture;P||(P=p.colorRampTexture=new l.Texture(v,p.colorRamp,C.RGBA)),P.bind(C.LINEAR,C.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(v,C.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,f.colorModeForRenderPass(),l.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:p.paint.get("heatmap-opacity")},p.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,p.paint,f.transform.zoom)}(m,u))},line:function(m,i,u,a){if("translucent"!==m.renderPass)return;const f=u.paint.get("line-opacity"),p=u.paint.get("line-width");if(0===f.constantOr(1)||0===p.constantOr(1))return;const v=m.depthModeForSublayer(0,l.DepthMode.ReadOnly),C=m.colorModeForRenderPass(),D=m.terrain&&m.terrain.renderingToTexture?1:l.exported.devicePixelRatio,P=u.paint.get("line-dasharray"),F=P.constantOr(1),W=u.layout.get("line-cap"),ue=u.paint.get("line-pattern"),Te=ue.constantOr(1),Re=u.paint.get("line-gradient"),je=Te?"linePattern":"line",Le=m.context,Fe=Le.gl,qe=(rt=>{const _t=[];ao(rt)&&_t.push("RENDER_LINE_DASH"),rt.paint.get("line-gradient")&&_t.push("RENDER_LINE_GRADIENT");const xt=rt.paint.get("line-trim-offset");0===xt[0]&&0===xt[1]||_t.push("RENDER_LINE_TRIM_OFFSET");const Lt=rt.paint.get("line-pattern").constantOr(1),en=1!==rt.paint.get("line-opacity").constantOr(1);return!Lt&&en&&_t.push("RENDER_LINE_ALPHA_DISCARD"),_t})(u);let Ze=qe.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(Ze=!1);for(const rt of a){const _t=i.getTile(rt);if(Te&&!_t.patternsLoaded())continue;const xt=_t.getBucket(u);if(!xt)continue;m.prepareDrawTile();const Lt=xt.programConfigurations.get(u.id),en=m.useProgram(je,Lt,qe),Wt=ue.constantOr(null);if(Wt&&_t.imageAtlas){const xn=_t.imageAtlas.patternPositions[Wt.toString()];xn&&Lt.setConstantPatternPositions(xn)}const Ut=P.constantOr(null),Ln=W.constantOr(null);if(!Te&&Ut&&Ln&&_t.lineAtlas){const xn=_t.lineAtlas.getDash(Ut,Ln);xn&&Lt.setConstantPatternPositions(xn)}let[Ht,fn]=u.paint.get("line-trim-offset");("round"===Ln||"square"===Ln)&&Ht!==fn&&(0===Ht&&(Ht-=1),1===fn&&(fn+=1));const tn=m.terrain?rt.projMatrix:null,An=Te?Ri(m,_t,u,tn,D):Sn(m,_t,u,tn,xt.lineClipsArray.length,D,[Ht,fn]);if(Re){const xn=xt.gradients[u.id];let kn=xn.texture;if(u.gradientVersion!==xn.version){let $t=256;if(u.stepInterpolant){const rn=i.getSource().maxzoom,ni=rt.canonical.z===rn?Math.ceil(1<<m.transform.maxZoom-rt.canonical.z):1;$t=l.clamp(l.nextPowerOfTwo(xt.maxLineLength/l.EXTENT*1024*ni),256,Le.maxTextureSize)}xn.gradient=l.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:$t,image:xn.gradient||void 0,clips:xt.lineClipsArray}),xn.texture?xn.texture.update(xn.gradient):xn.texture=new l.Texture(Le,xn.gradient,Fe.RGBA),xn.version=u.gradientVersion,kn=xn.texture}Le.activeTexture.set(Fe.TEXTURE1),kn.bind(u.stepInterpolant?Fe.NEAREST:Fe.LINEAR,Fe.CLAMP_TO_EDGE)}F&&(Le.activeTexture.set(Fe.TEXTURE0),_t.lineAtlasTexture.bind(Fe.LINEAR,Fe.REPEAT),Lt.updatePaintBuffers()),Te&&(Le.activeTexture.set(Fe.TEXTURE0),_t.imageAtlasTexture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),Lt.updatePaintBuffers()),m.prepareDrawProgram(Le,en,rt.toUnwrapped());const ln=xn=>{en.draw(Le,Fe.TRIANGLES,v,xn,C,l.CullFaceMode.disabled,An,u.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,u.paint,m.transform.zoom,Lt,[xt.layoutVertexBuffer2])};if(Ze){const xn=m.stencilModeForClipping(rt).ref;0===xn&&m.terrain&&Le.clear({stencil:0});const kn={func:Fe.EQUAL,mask:255};An.u_alpha_discard_threshold=.8,ln(new l.StencilMode(kn,xn,255,Fe.KEEP,Fe.KEEP,Fe.INVERT)),An.u_alpha_discard_threshold=0,ln(new l.StencilMode(kn,xn,255,Fe.KEEP,Fe.KEEP,Fe.KEEP))}else ln(m.stencilModeForClipping(rt))}Ze&&(m.resetStencilClippingMasks(),m.terrain&&Le.clear({stencil:0}))},fill:function(m,i,u,a){const f=u.paint.get("fill-color"),p=u.paint.get("fill-opacity");if(0===p.constantOr(1))return;const v=m.colorModeForRenderPass(),C=u.paint.get("fill-pattern"),D=m.opaquePassEnabledForLayer()&&!C.constantOr(1)&&1===f.constantOr(l.Color.transparent).a&&1===p.constantOr(0)?"opaque":"translucent";if(m.renderPass===D){const P=m.depthModeForSublayer(1,"opaque"===m.renderPass?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly);ti(m,i,u,a,P,v,!1)}if("translucent"===m.renderPass&&u.paint.get("fill-antialias")){const P=m.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,l.DepthMode.ReadOnly);ti(m,i,u,a,P,v,!0)}},"fill-extrusion":function(m,i,u,a){const f=u.paint.get("fill-extrusion-opacity");if(0!==f&&"translucent"===m.renderPass){const p=new l.DepthMode(m.context.gl.LEQUAL,l.DepthMode.ReadWrite,m.depthRangeFor3D);if(1!==f||u.paint.get("fill-extrusion-pattern").constantOr(1))Gi(m,i,u,a,p,l.StencilMode.disabled,l.ColorMode.disabled),Gi(m,i,u,a,p,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const v=m.colorModeForRenderPass();Gi(m,i,u,a,p,l.StencilMode.disabled,v)}}},hillshade:function(m,i,u,a){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass)return;const f=m.context,p=m.depthModeForSublayer(0,l.DepthMode.ReadOnly),v=m.colorModeForRenderPass(),C=m.terrain&&m.terrain.renderingToTexture,[D,P]="translucent"!==m.renderPass||C?[{},a]:m.stencilConfigForOverlap(a);for(const F of P){const W=i.getTile(F);if(W.needsHillshadePrepare&&"offscreen"===m.renderPass)ws(m,W,u,p,l.StencilMode.disabled,v);else if("translucent"===m.renderPass){const ue=C&&m.terrain?m.terrain.stencilModeForRTTOverlap(F):D[F.overscaledZ];Vo(m,F,W,u,p,ue,v)}}f.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,i,u,a,f,p){if("translucent"!==m.renderPass||0===u.paint.get("raster-opacity")||!a.length)return;const v=m.context,C=v.gl,D=i.getSource(),P=m.useProgram("raster"),F=m.colorModeForRenderPass(),W=m.terrain&&m.terrain.renderingToTexture,[ue,Te]=D instanceof tt||W?[{},a]:m.stencilConfigForOverlap(a),Re=Te[Te.length-1].overscaledZ,je=!m.options.moving;for(const Le of Te){const Fe=W?l.DepthMode.disabled:m.depthModeForSublayer(Le.overscaledZ-Re,1===u.paint.get("raster-opacity")?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly,C.LESS),qe=Le.toUnwrapped(),Ze=i.getTile(Le);if(W&&(!Ze||!Ze.hasData()))continue;const rt=W?Le.projMatrix:m.transform.calculateProjMatrix(qe,je),_t=m.terrain&&W?m.terrain.stencilModeForRTTOverlap(Le):ue[Le.overscaledZ],xt=p?0:u.paint.get("raster-fade-duration");Ze.registerFadeDuration(xt);const Lt=i.findLoadedParent(Le,0),en=Yo(Ze,Lt,i,m.transform,xt);let Wt,Ut;m.terrain&&m.terrain.prepareDrawTile();const Ln="nearest"===u.paint.get("raster-resampling")?C.NEAREST:C.LINEAR;v.activeTexture.set(C.TEXTURE0),Ze.texture.bind(Ln,C.CLAMP_TO_EDGE),v.activeTexture.set(C.TEXTURE1),Lt?(Lt.texture.bind(Ln,C.CLAMP_TO_EDGE),Wt=Math.pow(2,Lt.tileID.overscaledZ-Ze.tileID.overscaledZ),Ut=[Ze.tileID.canonical.x*Wt%1,Ze.tileID.canonical.y*Wt%1]):Ze.texture.bind(Ln,C.CLAMP_TO_EDGE);const Ht=pc(rt,Ut||[0,0],Wt||1,en,u,D instanceof tt?D.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(v,P,qe),D instanceof tt)D.boundsBuffer&&D.boundsSegments&&P.draw(v,C.TRIANGLES,Fe,l.StencilMode.disabled,F,l.CullFaceMode.disabled,Ht,u.id,D.boundsBuffer,m.quadTriangleIndexBuffer,D.boundsSegments);else{const{tileBoundsBuffer:fn,tileBoundsIndexBuffer:tn,tileBoundsSegments:An}=m.getTileBoundsBuffers(Ze);P.draw(v,C.TRIANGLES,Fe,_t,F,l.CullFaceMode.disabled,Ht,u.id,fn,tn,An)}}m.resetStencilClippingMasks()},background:function(m,i,u,a){const f=u.paint.get("background-color"),p=u.paint.get("background-opacity");if(0===p)return;const v=m.context,C=v.gl,D=m.transform,P=D.tileSize,F=u.paint.get("background-pattern");if(m.isPatternMissing(F))return;const W=!F&&1===f.a&&1===p&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==W)return;const ue=l.StencilMode.disabled,Te=m.depthModeForSublayer(0,"opaque"===W?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly),Re=m.colorModeForRenderPass(),je=m.useProgram(F?"backgroundPattern":"background");let Le,Fe=a;Fe||(Le=m.getBackgroundTiles(),Fe=Object.values(Le).map(qe=>qe.tileID)),F&&(v.activeTexture.set(C.TEXTURE0),m.imageManager.bind(m.context));for(const qe of Fe){const Ze=qe.toUnwrapped(),rt=a?qe.projMatrix:m.transform.calculateProjMatrix(Ze);m.prepareDrawTile();const _t=i?i.getTile(qe):Le?Le[qe.key]:new l.Tile(qe,P,D.zoom,m),xt=F?dl(rt,p,m,F,{tileID:qe,tileSize:P}):Du(rt,p,f);m.prepareDrawProgram(v,je,Ze);const{tileBoundsBuffer:Lt,tileBoundsIndexBuffer:en,tileBoundsSegments:Wt}=m.getTileBoundsBuffers(_t);je.draw(v,C.TRIANGLES,Te,ue,Re,l.CullFaceMode.disabled,xt,u.id,Lt,en,Wt)}},sky:function(m,i,u){const a=m.transform,f="mercator"===a.projection.name||"globe"===a.projection.name?1:l.smoothstep(7,8,a.zoom),p=u.paint.get("sky-opacity")*f;if(0===p)return;const v=m.context,C=u.paint.get("sky-type"),D=new l.DepthMode(v.gl.LEQUAL,l.DepthMode.ReadOnly,[0,1]),P=m.frameCounter/1e3%1;"atmosphere"===C?"offscreen"===m.renderPass?u.needsSkyboxCapture(m)&&(function(F,W,ue,Te){const Re=F.context,je=Re.gl;let Le=W.skyboxFbo;if(!Le){Le=W.skyboxFbo=Re.createFramebuffer(32,32,!1),W.skyboxGeometry=new hs(Re),W.skyboxTexture=Re.gl.createTexture(),je.bindTexture(je.TEXTURE_CUBE_MAP,W.skyboxTexture),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_WRAP_S,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_WRAP_T,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_MIN_FILTER,je.LINEAR),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_MAG_FILTER,je.LINEAR);for(let rt=0;rt<6;++rt)je.texImage2D(je.TEXTURE_CUBE_MAP_POSITIVE_X+rt,0,je.RGBA,32,32,0,je.RGBA,je.UNSIGNED_BYTE,null)}Re.bindFramebuffer.set(Le.framebuffer),Re.viewport.set([0,0,32,32]);const Fe=W.getCenter(F,!0),qe=F.useProgram("skyboxCapture"),Ze=new Float64Array(16);l.identity(Ze),l.rotateY(Ze,Ze,.5*-Math.PI),Sr(Re,W,qe,Ze,Fe,0),l.identity(Ze),l.rotateY(Ze,Ze,.5*Math.PI),Sr(Re,W,qe,Ze,Fe,1),l.identity(Ze),l.rotateX(Ze,Ze,.5*-Math.PI),Sr(Re,W,qe,Ze,Fe,2),l.identity(Ze),l.rotateX(Ze,Ze,.5*Math.PI),Sr(Re,W,qe,Ze,Fe,3),l.identity(Ze),Sr(Re,W,qe,Ze,Fe,4),l.identity(Ze),l.rotateY(Ze,Ze,Math.PI),Sr(Re,W,qe,Ze,Fe,5),Re.viewport.set([0,0,F.width,F.height])}(m,u),u.markSkyboxValid(m)):"sky"===m.renderPass&&function(F,W,ue,Te,Re){const je=F.context,Le=je.gl,Fe=F.transform,qe=F.useProgram("skybox");je.activeTexture.set(Le.TEXTURE0),Le.bindTexture(Le.TEXTURE_CUBE_MAP,W.skyboxTexture);const Ze={u_matrix:Fe.skyboxMatrix,u_sun_direction:W.getCenter(F,!1),u_cubemap:0,u_opacity:Te,u_temporal_offset:Re};F.prepareDrawProgram(je,qe),qe.draw(je,Le.TRIANGLES,ue,l.StencilMode.disabled,F.colorModeForRenderPass(),l.CullFaceMode.backCW,Ze,"skybox",W.skyboxGeometry.vertexBuffer,W.skyboxGeometry.indexBuffer,W.skyboxGeometry.segment)}(m,u,D,p,P):"gradient"===C&&"sky"===m.renderPass&&function(F,W,ue,Te,Re){const je=F.context,Le=je.gl,Fe=F.transform,qe=F.useProgram("skyboxGradient");W.skyboxGeometry||(W.skyboxGeometry=new hs(je)),je.activeTexture.set(Le.TEXTURE0);let Ze=W.colorRampTexture;Ze||(Ze=W.colorRampTexture=new l.Texture(je,W.colorRamp,Le.RGBA)),Ze.bind(Le.LINEAR,Le.CLAMP_TO_EDGE);const rt=(_t=Fe.skyboxMatrix,xt=W.getCenter(F,!1),Lt=W.paint.get("sky-gradient-radius"),en=Te,Wt=Re,{u_matrix:_t,u_color_ramp:0,u_center_direction:xt,u_radius:l.degToRad(Lt),u_opacity:en,u_temporal_offset:Wt});var _t,xt,Lt,en,Wt;F.prepareDrawProgram(je,qe),qe.draw(je,Le.TRIANGLES,ue,l.StencilMode.disabled,F.colorModeForRenderPass(),l.CullFaceMode.backCW,rt,"skyboxGradient",W.skyboxGeometry.vertexBuffer,W.skyboxGeometry.indexBuffer,W.skyboxGeometry.segment)}(m,u,D,p,P)},debug:function(m,i,u){for(let a=0;a<u.length;a++)ql(m,i,u[a])},custom:function(m,i,u){const a=m.context,f=u.implementation;if(m.transform.projection.unsupportedLayers&&m.transform.projection.unsupportedLayers.includes("custom"))l.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===m.renderPass){const p=f.prerender;p&&(m.setCustomLayerDefaults(),a.setColorMode(m.colorModeForRenderPass()),p.call(f,a.gl,m.transform.customLayerMatrix()),a.setDirty(),m.setBaseState())}else if("translucent"===m.renderPass){m.setCustomLayerDefaults(),a.setColorMode(m.colorModeForRenderPass()),a.setStencilMode(l.StencilMode.disabled);const p="3d"===f.renderingMode?new l.DepthMode(m.context.gl.LEQUAL,l.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,l.DepthMode.ReadOnly);a.setDepthMode(p),f.render(a.gl,m.transform.customLayerMatrix()),a.setDirty(),m.setBaseState(),a.bindFramebuffer.set(null)}}};class U{constructor(i,u){this.context=new R(i),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=l.SourceCache.maxUnderzooming+l.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new mo,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,u){const a=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(a||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ds(this,i));const f=this._terrain;this.transform.elevation=a?f:null,f.update(i,this.transform,u)}_updateFog(i){const u=i.fog;if(!u||"globe"===this.transform.projection.name||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[a,f]=u.getFovAdjustedRange(this.transform._fov);if(a>f)return void(this.transform.fogCullDistSq=null);const p=a+.78*(f-a);this.transform.fogCullDistSq=p*p}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,u){if(this.width=i*l.exported.devicePixelRatio,this.height=u*l.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const a of this.style.order)this.style._layers[a].resize()}setup(){const i=this.context,u=new l.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(l.EXTENT,0),u.emplaceBack(0,l.EXTENT),u.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(u,l.posAttributes.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const a=new l.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(l.EXTENT,0),a.emplaceBack(0,l.EXTENT),a.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=i.createVertexBuffer(a,l.posAttributes.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const f=new l.StructArrayLayout2i4;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(-1,1),f.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(f,l.posAttributes.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const p=new l.StructArrayLayout4i8;p.emplaceBack(0,0,0,0),p.emplaceBack(l.EXTENT,0,l.EXTENT,0),p.emplaceBack(0,l.EXTENT,0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(p,l.boundsAttributes.members),this.mercatorBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const v=new l.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(v);const C=new l.StructArrayLayout1ui2;for(const P of[0,1,3,2,0])C.emplaceBack(P);this.debugIndexBuffer=i.createIndexBuffer(C),this.emptyTexture=new l.Texture(i,new l.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=l.create();const D=this.context.gl;this.stencilClearMode=new l.StencilMode({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(l.window.performance.now()),this.atmosphereBuffer=new ur(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,u=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,u.TRIANGLES,l.DepthMode.disabled,this.stencilClearMode,l.ColorMode.disabled,l.CullFaceMode.disabled,ma(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,u,a){if(!u||this.currentStencilSource===u.id||!i.isTileClipped()||!a||0===a.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const D of a)if(void 0===this._tileClippingMaskIDs[D.key]){C=!0;break}if(!C)return}this.currentStencilSource=u.id;const f=this.context,p=f.gl;this.nextStencilID+a.length>256&&this.clearStencil(),f.setColorMode(l.ColorMode.disabled),f.setDepthMode(l.DepthMode.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of a){const D=u.getTile(C),P=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:W,tileBoundsSegments:ue}=this.getTileBoundsBuffers(D);v.draw(f,p.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:p.ALWAYS,mask:0},P,255,p.KEEP,p.KEEP,p.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,ma(C.projMatrix),"$clipping",F,W,ue)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,u=this.context.gl;return new l.StencilMode({func:u.NOTEQUAL,mask:255},i,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const u=this.context.gl;return new l.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(i){const u=this.context.gl,a=i.sort((v,C)=>C.overscaledZ-v.overscaledZ),f=a[a.length-1].overscaledZ,p=a[0].overscaledZ-f+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const v={};for(let C=0;C<p;C++)v[C+f]=new l.StencilMode({func:u.GEQUAL,mask:255},C+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=p,[v,a]}return[{[f]:l.StencilMode.disabled},a]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new l.ColorMode([i.CONSTANT_COLOR,i.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?l.ColorMode.unblended:l.ColorMode.alphaBlended}depthModeForSublayer(i,u,a){if(!this.opaquePassEnabledForLayer())return l.DepthMode.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new l.DepthMode(a||this.context.gl.LEQUAL,u,[f,f])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,u){this.style=i,this.options=u,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const a=this.style.order,f=this.style._sourceCaches;for(const D in f){const P=f[D];P.used&&P.prepare(this.context)}const p={},v={},C={};for(const D in f){const P=f[D];p[D]=P.getVisibleCoordinates(),v[D]=p[D].slice().reverse(),C[D]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<a.length;D++)if(this.style._layers[a[D]].is3D()){this.opaquePassCutoff=D;break}if(this.terrain&&(this.terrain.updateTileBinding(C),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new l.GlobeSharedBuffers(this.context)),l.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const D of a){const P=this.style._layers[D],F=i._getLayerSourceCache(P);if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const W=F?v[F.id]:void 0;("custom"===P.type||P.isSky()||W&&W.length)&&this.renderLayer(this,F,P,W)}if(this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:u.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[a[this.currentLayer]],P=i._getLayerSourceCache(D);if(D.isSky())continue;const F=P?v[P.id]:void 0;this._renderTileClippingMasks(D,P,F),this.renderLayer(this,P,D,F)}if(this.style.fog&&this.transform.projection.supportsFog&&function(D,P){const F=D.context,W=F.gl,ue=D.transform,Te=new l.DepthMode(W.LEQUAL,l.DepthMode.ReadOnly,[0,1]),Re=D.useProgram("globeAtmosphere",null,"globe"===ue.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),je=l.globeToMercatorTransition(ue.zoom),Le=P.properties.get("color").toArray01(),Fe=P.properties.get("high-color").toArray01(),qe=P.properties.get("space-color").toArray01PremultipliedAlpha(),Ze=l.identity$1([]);l.rotateY$1(Ze,Ze,-l.degToRad(ue._center.lng)),l.rotateX$1(Ze,Ze,l.degToRad(ue._center.lat)),l.rotateZ$1(Ze,Ze,ue.angle),l.rotateX$1(Ze,Ze,-ue._pitch);const rt=l.fromQuat(new Float32Array(16),Ze),_t=l.mapValue(P.properties.get("star-intensity"),0,1,0,.25),Lt=l.mapValue(P.properties.get("horizon-blend"),0,1,5e-4,.25),en=l.globeUseCustomAntiAliasing(D,F,ue)&&5e-4===Lt?ue.worldSize/(2*Math.PI*1.025)-1:ue.globeRadius,Wt=D.frameCounter/1e3%1,Ut=l.length(ue.globeCenterInViewSpace),Ln=Math.sqrt(Math.pow(Ut,2)-Math.pow(en,2)),Ht=Math.acos(Ln/Ut),fn={u_frustum_tl:ue.frustumCorners.TL,u_frustum_tr:ue.frustumCorners.TR,u_frustum_br:ue.frustumCorners.BR,u_frustum_bl:ue.frustumCorners.BL,u_horizon:ue.frustumCorners.horizon,u_transition:je,u_fadeout_range:Lt,u_color:Le,u_high_color:Fe,u_space_color:qe,u_star_intensity:_t,u_star_size:5*l.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Wt,u_horizon_angle:Ht,u_rotation_matrix:rt};D.prepareDrawProgram(F,Re);const tn=D.atmosphereBuffer;tn&&Re.draw(F,W.TRIANGLES,Te,l.StencilMode.disabled,l.ColorMode.alphaBlended,l.CullFaceMode.backCW,fn,"skybox",tn.vertexBuffer,tn.indexBuffer,tn.segments)}(this,this.style.fog),this.renderPass="sky",(l.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const D=this.style._layers[a[this.currentLayer]],P=i._getLayerSourceCache(D);D.isSky()&&this.renderLayer(this,P,D,P?v[P.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;){const D=this.style._layers[a[this.currentLayer]],P=i._getLayerSourceCache(D);if(D.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(D)){if(D.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const F=P?("symbol"===D.type?C:v)[P.id]:void 0;this._renderTileClippingMasks(D,P,P?p[P.id]:void 0),this.renderLayer(this,P,D,F),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let D=null;l.values(this.style._layers).forEach(P=>{const F=i._getLayerSourceCache(P);F&&!P.isHidden(this.transform.zoom)&&(!D||D.getSource().maxzoom<F.getSource().maxzoom)&&(D=F)}),D&&this.options.showTileBoundaries&&Pl.debug(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const P=D.transform.padding;hl(D,D.transform.height-(P.top||0),3,cr),hl(D,P.bottom||0,3,yo),ga(D,P.left||0,3,vo),ga(D,D.transform.width-(P.right||0),3,Ds);const F=D.transform.centerPoint;var W,ue,Te,Re;Zo(W=D,(ue=F.x)-1,(Te=D.transform.height-F.y)-10,2,20,Re=Ko),Zo(W,ue-10,Te-1,20,2,Re)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(l.window.performance.now()),this.saveCanvasCopy())}}renderLayer(i,u,a,f){a.isHidden(this.transform.zoom)||("background"===a.type||"sky"===a.type||"custom"===a.type||f&&f.length)&&(this.id=a.id,this.gpuTimingStart(a),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(a.type)||Pl[a.type](i,u,a,f,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let a=this.gpuTimers[i.id];a||(a=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),a.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,a.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,u=i.createQueryEXT();this.deferredRenderGpuTimeQueries.push(u),i.beginQueryEXT(i.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const u={};for(const a in i){const f=i[a],p=this.context.extTimerQuery,v=p.getQueryObjectEXT(f.query,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(f.query),u[a]=v}return u}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.extTimerQuery;let a=0;for(const f of i)a+=u.getQueryObjectEXT(f,u.QUERY_RESULT_EXT)/1e6,u.deleteQueryEXT(f);return a}translatePosMatrix(i,u,a,f,p){if(!a[0]&&!a[1])return i;const v=p?"map"===f?this.transform.angle:0:"viewport"===f?-this.transform.angle:0;if(v){const P=Math.sin(v),F=Math.cos(v);a=[a[0]*F-a[1]*P,a[0]*P+a[1]*F]}const C=[p?a[0]:Mt(u,a[0],this.transform.zoom),p?a[1]:Mt(u,a[1],this.transform.zoom),0],D=new Float32Array(16);return l.translate(D,i,C),D}saveTileTexture(i){const u=this._tileTextures[i.size[0]];u?u.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const u=this._tileTextures[i];return u&&u.length>0?u.pop():null}isPatternMissing(i){return null===i||void 0!==i&&!this.imageManager.getPattern(i.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,u=this.terrain&&0===this.terrain.exaggeration(),a=this.style&&this.style.fog,f=[];return this.terrainRenderModeElevated()&&f.push("TERRAIN"),"globe"===this.transform.projection.name&&f.push("GLOBE"),u&&f.push("ZERO_EXAGGERATION"),a&&!i&&0!==a.getOpacity(this.transform.pitch)&&f.push("FOG"),i&&f.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&f.push("OVERDRAW_INSPECTOR"),f}useProgram(i,u,a){this.cache=this.cache||{};const f=a||[],p=this.currentGlobalDefines().concat(f),v=Dr.cacheKey(Ro[i],i,p,u);return this.cache[v]||(this.cache[v]=new Dr(this.context,i,Ro[i],u,M[i],p)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=l.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(i,u,a){if(this.terrain&&this.terrain.renderingToTexture)return;const f=this.style.fog;if(f){const p=f.getOpacity(this.transform.pitch),v=((C,D,P,F,W,ue,Te,Re,je,Le,Fe)=>{const qe=C.transform,Ze=D.properties.get("color").toArray01();Ze[3]=F;const rt=C.frameCounter/1e3%1;return{u_fog_matrix:P?qe.calculateFogTileMatrix(P):C.identityMat,u_fog_range:D.getFovAdjustedRange(qe._fov),u_fog_color:Ze,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_temporal_offset:rt,u_frustum_tl:W,u_frustum_tr:ue,u_frustum_br:Te,u_frustum_bl:Re,u_globe_pos:je,u_globe_radius:Le,u_viewport:Fe,u_globe_transition:l.globeToMercatorTransition(qe.zoom),u_is_globe:+("globe"===qe.projection.name)}})(this,f,a,p,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*l.exported.devicePixelRatio,this.transform.height*l.exported.devicePixelRatio]);u.setFogUniformValues(i,v)}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,u=i.createTexture();return i.bindTexture(i.TEXTURE_2D,u),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&0!==i.getOpacity(this.transform.pitch)}getBackgroundTiles(){const i=this._backgroundTiles,u=this._backgroundTiles={},a=this.transform.coveringTiles({tileSize:512});for(const f of a)u[f.key]=i[f.key]||new l.Tile(f,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class ae{constructor(i=0,u=0,a=0,f=0){if(isNaN(i)||i<0||isNaN(u)||u<0||isNaN(a)||a<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=u,this.left=a,this.right=f}interpolate(i,u,a){return null!=u.top&&null!=i.top&&(this.top=l.number(i.top,u.top,a)),null!=u.bottom&&null!=i.bottom&&(this.bottom=l.number(i.bottom,u.bottom,a)),null!=u.left&&null!=i.left&&(this.left=l.number(i.left,u.left,a)),null!=u.right&&null!=i.right&&(this.right=l.number(i.right,u.right,a)),this}getCenter(i,u){const a=l.clamp((this.left+i-this.right)/2,0,i),f=l.clamp((this.top+u-this.bottom)/2,0,u);return new l.pointGeometry(a,f)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new ae(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function H(m,i){const u=l.getColumn(m,3);l.fromQuat(m,i),l.setColumn(m,3,u)}function Se(m,i){const u=l.identity$1([]);return l.rotateZ$1(u,u,-i),l.rotateX$1(u,u,-m),u}function ht(m,i){const u=[m[0],m[1],0],a=[i[0],i[1],0];if(l.length(u)>=1e-15){const v=l.normalize([],u);l.scale$2(a,v,l.dot(a,v)),i[0]=a[0],i[1]=a[1]}const f=l.cross([],i,m);if(l.len(f)<1e-15)return null;const p=Math.atan2(-f[1],f[0]);return Se(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),p)}class un{constructor(i,u){this.position=i,this.orientation=u}get position(){return this._position}set position(i){if(i){const u=i instanceof l.MercatorCoordinate?i:new l.MercatorCoordinate(i[0],i[1],i[2]);this._renderWorldCopies&&(u.x=l.wrap(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(i,u){if(this.orientation=null,!this.position)return;const a=this._elevation?this._elevation.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(i)):0,f=this.position,p=l.MercatorCoordinate.fromLngLat(i,a),v=[p.x-f.x,p.y-f.y,p.z-f.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=ht(v,u)}setPitchBearing(i,u){this.orientation=Se(l.degToRad(i),l.degToRad(-u))}}class Tn{constructor(i,u){this._transform=l.identity([]),this.orientation=u,this.position=i}get mercatorPosition(){const i=this.position;return new l.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=l.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var u;i&&l.setColumn(this._transform,3,[(u=i)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||l.identity$1([]),i&&H(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,u){this._orientation=Se(i,u),H(this._transform,this._orientation)}forward(){const i=l.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=l.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=l.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,u){const a=new Float64Array(16);return l.invert(a,this.getWorldToCamera(i,u)),a}getWorldToCameraPosition(i,u,a){const f=this.position;l.scale$2(f,f,-i);const p=new Float64Array(16);return l.fromScaling(p,[a,a,a]),l.translate(p,p,f),p[10]*=u,p}getWorldToCamera(i,u){const a=new Float64Array(16),f=new Float64Array(4),p=this.position;return l.conjugate(f,this._orientation),l.scale$2(p,p,-i),l.fromQuat(a,f),l.translate(a,a,p),a[1]*=-1,a[5]*=-1,a[9]*=-1,a[13]*=-1,a[8]*=u,a[9]*=u,a[10]*=u,a[11]*=u,a}getCameraToClipPerspective(i,u,a,f){const p=new Float64Array(16);return l.perspective(p,i,u,a,f),p}getDistanceToElevation(i,u=!1){const a=0===i?0:l.mercatorZfromAltitude(i,u?l.latFromMercatorY(this.position[1]):this.position[1]),f=this.forward();return(a-this.position[2])/f[2]}clone(){return new Tn([...this.position],[...this.orientation])}}function ai(m,i){const u=$i(m.projection,m.zoom,m.width,m.height),a=function(p,v,C,D,P){const F=new l.LngLat(C.lng-180*Hi,C.lat),W=new l.LngLat(C.lng+180*Hi,C.lat),ue=p.project(F.lng,F.lat),Te=p.project(W.lng,W.lat),Re=-Math.atan2(Te.y-ue.y,Te.x-ue.x),je=l.MercatorCoordinate.fromLngLat(C);je.y=l.clamp(je.y,-.999975,.999975);const Le=je.toLngLat(),Fe=p.project(Le.lng,Le.lat),qe=l.MercatorCoordinate.fromLngLat(Le);qe.x+=Hi;const Ze=qe.toLngLat(),rt=p.project(Ze.lng,Ze.lat),_t=ho(rt.x-Fe.x,rt.y-Fe.y,Re),xt=l.MercatorCoordinate.fromLngLat(Le);xt.y+=Hi;const Lt=xt.toLngLat(),en=p.project(Lt.lng,Lt.lat),Wt=ho(en.x-Fe.x,en.y-Fe.y,Re),Ut=Math.abs(_t.x)/Math.abs(Wt.y),Ln=l.identity([]);l.rotateZ(Ln,Ln,-Re*(1-(P?0:D)));const Ht=l.identity([]);return l.scale(Ht,Ht,[1,1-(1-Ut)*D,1]),Ht[4]=-Wt.x/Wt.y*D,l.rotateZ(Ht,Ht,Re),l.multiply(Ht,Ln,Ht),Ht}(m.projection,0,m.center,u,i),f=rr(m);return l.scale(a,a,[f,f,1]),a}function rr(m){const i=m.projection,u=$i(m.projection,m.zoom,m.width,m.height),a=Xi(i,m.center),f=Xi(i,l.LngLat.convert(i.center));return Math.pow(2,a*u+(1-u)*f)}function $i(m,i,u,a,f=1/0){const p=m.range;if(!p)return 0;const v=Math.min(f,Math.max(u,a)),C=Math.log(v/1024)/Math.LN2;return l.smoothstep(p[0]+C,p[1]+C,i)}const Hi=1/4e4;function Xi(m,i){const u=l.clamp(i.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),a=new l.LngLat(i.lng-180*Hi,u),f=new l.LngLat(i.lng+180*Hi,u),p=m.project(a.lng,u),v=m.project(f.lng,u),C=l.MercatorCoordinate.fromLngLat(a),D=l.MercatorCoordinate.fromLngLat(f),P=v.x-p.x,F=v.y-p.y,W=D.x-C.x,ue=D.y-C.y,Te=Math.sqrt((W*W+ue*ue)/(P*P+F*F));return Math.log(Te)/Math.LN2}function ho(m,i,u){const a=Math.cos(u),f=Math.sin(u);return{x:m*a-i*f,y:m*f+i*a}}class sr{constructor(i,u,a,f,p,v,C){this.tileSize=512,this._renderWorldCopies=void 0===p||p,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=a??0,this._maxPitch=f??60,this.setProjection(v),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ae,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Tn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const i=new sr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(i,u=!1){const a=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||a)&&this._updateCameraOnTerrain(),(i||a)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return l.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=l.getProjection(this.projectionOptions);const a=!q(u,this.getProjection());return a&&this._calcMatrices(),this.mercatorFromTransition=!1,a}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=l.getProjection({name:"mercator"});const u=i!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(i){void 0===i?i=!0:null===i&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return l.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return l.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const u=-i*Math.PI/180;var a,f,p,v,C,D,P,F,W,ue;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(a=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a),f=this.rotationMatrix,v=this.angle,C=(p=this.rotationMatrix)[0],D=p[1],P=p[2],F=p[3],W=Math.sin(v),ue=Math.cos(v),f[0]=C*ue+P*W,f[1]=D*ue+F*W,f[2]=C*-W+P*ue,f[3]=D*-W+F*ue)}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const u=l.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=l.degToRad(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const u=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;this._centerAltitude=i.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=i.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],a=this.horizonLineFromTop();let f=0,p=0;for(let v=0;v<u.length;v++){const C=new l.pointGeometry(u[v][0]*this.width,a+u[v][1]*(this.height-a)),D=i.pointCoordinate(C);if(!D)continue;const P=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);f+=D[3]*P,p+=P}return 0===p?NaN:f/p}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const i=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),a=this.pixelsPerMeter/this.worldSize*u,f=this._mercatorZfromZoom(i),p=this._mercatorZfromZoom(this._maxZoom),v=Math.max(f-a,p);this._setZoom(this._zoomFromMercatorZ(v))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let a;a=i.z<this._camera.position[2]?[u.x,u.y,u.z]:[i.x,i.y,i.z];const f=l.length(l.sub([],this._camera.position,a));return l.clamp(this._zoomFromMercatorZ(f),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let u=!1;if(i.orientation&&!l.exactEquals(i.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(i.orientation)),i.position){const a=[i.position.x,i.position.y,i.position.z];l.exactEquals$1(a,this._camera.position)||(this._setCameraPosition(a),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,u=new un;return u.position=new l.MercatorCoordinate(i[0],i[1],i[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(i){if(!l.length$1(i))return!1;l.normalize$1(i,i);const u=l.transformQuat([],[0,0,-1],i),a=l.transformQuat([],[0,-1,0],i);if(a[2]<0)return!1;const f=ht(u,a);return!!f&&(this._camera.orientation=f,!0)}_setCameraPosition(i){const u=this.zoomScale(this.minZoom)*this.tileSize,a=this.zoomScale(this.maxZoom)*this.tileSize,f=this.cameraToCenterDistance;i[2]=l.clamp(i[2],f/a,f/u),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,u,a){this._unmodified=!1,this._edgeInsets.interpolate(i,u,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const u=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(i){const u=[new l.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const a=this.pointCoordinate(new l.pointGeometry(0,0)),f=this.pointCoordinate(new l.pointGeometry(this.width,0)),p=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),v=this.pointCoordinate(new l.pointGeometry(0,this.height)),C=Math.floor(Math.min(a.x,f.x,p.x,v.x)),D=Math.floor(Math.max(a.x,f.x,p.x,v.x)),P=1;for(let F=C-P;F<=D+P;F++)0!==F&&u.push(new l.UnwrappedTileID(F,i))}return u}coveringTiles(i){let u=this.coveringZoomLevel(i);const a=u,f=this.elevation&&!i.isTerrainDEM,p="mercator"===this.projection.name;if(void 0!==i.minzoom&&u<i.minzoom)return[];void 0!==i.maxzoom&&u>i.maxzoom&&(u=i.maxzoom);const v=this.locationCoordinate(this.center),C=this.center.lat,D=1<<u,P=[D*v.x,D*v.y,0],F="globe"===this.projection.name,W=!F,ue=l.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,W),Te=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Re=D*l.mercatorZfromAltitude(1,this.center.lat),je=this._camera.position[2]/l.mercatorZfromAltitude(1,this.center.lat),Le=[D*Te.x,D*Te.y,je*(W?1:Re)],Fe=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),qe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,Ze=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,rt=i.isTerrainDEM?-Ze:this._elevation?this._elevation.getMinElevationBelowMSL():0,_t=this.projection.isReprojectedInTileSpace?rr(this):1,xt=ln=>{const kn=new l.MercatorCoordinate(ln.x+25e-6,ln.y,ln.z),$t=new l.MercatorCoordinate(ln.x,ln.y+25e-6,ln.z),rn=ln.toLngLat(),ni=kn.toLngLat(),hi=$t.toLngLat(),Qn=this.locationCoordinate(rn),Ci=this.locationCoordinate(ni),Zi=this.locationCoordinate(hi),ui=Math.hypot(Ci.x-Qn.x,Ci.y-Qn.y),Xn=Math.hypot(Zi.x-Qn.x,Zi.y-Qn.y);return Math.sqrt(ui*Xn)*_t/25e-6},Lt=ln=>{const xn=Ze,kn=rt;return{aabb:l.tileAABB(this,D,0,0,0,ln,kn,xn,this.projection),zoom:0,x:0,y:0,minZ:kn,maxZ:xn,wrap:ln,fullyVisible:!1}},en=[];let Wt=[];const Ut=u,Ln=i.reparseOverscaled?a:u,Ht=ln=>ln*ln,fn=Ht((je-this._centerAltitude)*Re),tn=ln=>{if(!this._elevation||!ln.tileID||!p)return;const xn=this._elevation.getMinMaxForTile(ln.tileID),kn=ln.aabb;xn?(kn.min[2]=xn.min,kn.max[2]=xn.max,kn.center[2]=(kn.min[2]+kn.max[2])/2):(ln.shouldSplit=An(ln),ln.shouldSplit||(kn.min[2]=kn.max[2]=kn.center[2]=this._centerAltitude))},An=ln=>{if(ln.zoom<qe)return!0;if(ln.zoom===Ut)return!1;if(null!=ln.shouldSplit)return ln.shouldSplit;const xn=ln.aabb.distanceX(Le),kn=ln.aabb.distanceY(Le);let $t=fn,rn=1;if(F){$t=Ht(ln.aabb.distanceZ(Le));const Qn=Math.pow(2,ln.zoom),Ci=l.latFromMercatorY((ln.y+1)/Qn),Zi=l.latFromMercatorY(ln.y/Qn),ui=Math.min(Math.max(C,Ci),Zi),Xn=l.circumferenceAtLatitude(ui)/l.circumferenceAtLatitude(C);if(rn=ui===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Xn/this._mercatorScaleRatio),this.zoom<=l.GLOBE_ZOOM_THRESHOLD_MIN&&ln.zoom===Ut-1&&Xn>=.9)return!0}else if(f&&($t=Ht(ln.aabb.distanceZ(Le)*Re)),this.projection.isReprojectedInTileSpace&&a<=5){const Qn=Math.pow(2,ln.zoom),Ci=xt(new l.MercatorCoordinate((ln.x+.5)/Qn,(ln.y+.5)/Qn));rn=Ci>.85?1:Ci}const ni=xn*xn+kn*kn+$t;return ni<Ht((1<<Ut-ln.zoom)*Fe*rn*((Qn,Ci)=>{if(Ci*Ht(.707)<Qn)return 1;const Zi=Math.sqrt(Ci/Qn);return Zi/(1.4144271570014144+(Math.pow(1.1,Zi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max($t,fn),ni))};if(this.renderWorldCopies)for(let ln=1;ln<=3;ln++)en.push(Lt(-ln)),en.push(Lt(ln));for(en.push(Lt(0));en.length>0;){const ln=en.pop(),xn=ln.x,kn=ln.y;let $t=ln.fullyVisible;if(!$t){const rn=ln.aabb.intersects(ue);if(0===rn)continue;$t=2===rn}if(ln.zoom!==Ut&&An(ln))for(let rn=0;rn<4;rn++){const ni=(xn<<1)+rn%2,hi=(kn<<1)+(rn>>1),Qn={aabb:p?ln.aabb.quadrant(rn):l.tileAABB(this,D,ln.zoom+1,ni,hi,ln.wrap,ln.minZ,ln.maxZ,this.projection),zoom:ln.zoom+1,x:ni,y:hi,wrap:ln.wrap,fullyVisible:$t,tileID:void 0,shouldSplit:void 0,minZ:ln.minZ,maxZ:ln.maxZ};f&&!F&&(Qn.tileID=new l.OverscaledTileID(ln.zoom+1===Ut?Ln:ln.zoom+1,ln.wrap,ln.zoom+1,ni,hi),tn(Qn)),en.push(Qn)}else{const rn=ln.zoom===Ut?Ln:ln.zoom;if(i.minzoom&&i.minzoom>rn)continue;const ni=P[0]-(.5+xn+(ln.wrap<<ln.zoom))*(1<<u-ln.zoom),hi=P[1]-.5-kn,Qn=ln.tileID?ln.tileID:new l.OverscaledTileID(rn,ln.wrap,ln.zoom,xn,kn);Wt.push({tileID:Qn,distanceSq:ni*ni+hi*hi})}}if(this.fogCullDistSq){const ln=this.fogCullDistSq,xn=this.horizonLineFromTop();Wt=Wt.filter(kn=>{const $t=[0,0,0,1],rn=[l.EXTENT,l.EXTENT,0,1],ni=this.calculateFogTileMatrix(kn.tileID.toUnwrapped());l.transformMat4$1($t,$t,ni),l.transformMat4$1(rn,rn,ni);const hi=l.getAABBPointSquareDist($t,rn);if(0===hi)return!0;let Qn=!1;const Ci=this._elevation;if(Ci&&hi>ln&&0!==xn){const Zi=this.calculateProjMatrix(kn.tileID.toUnwrapped());let ui;i.isTerrainDEM||(ui=Ci.getMinMaxForTile(kn.tileID)),ui||(ui={min:rt,max:Ze});const Xn=l.furthestTileCorner(this.rotation),Ir=[Xn[0]*l.EXTENT,Xn[1]*l.EXTENT,ui.max];l.transformMat4(Ir,Ir,Zi),Qn=(1-Ir[1])*this.height*.5<xn}return hi<ln||Qn})}return Wt.sort((ln,xn)=>ln.distanceSq-xn.distanceSq).map(ln=>ln.tileID)}resize(i,u){this.width=i,this.height=u,this.pixelsToGLUnits=[2/i,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const u=l.clamp(i.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),a=this.projection.project(i.lng,u);return new l.pointGeometry(a.x*this.worldSize,a.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,u){let a,f;const p=this.centerPoint;if("globe"===this.projection.name){const C=this.worldSize;a=(u.x-p.x)/C,f=(u.y-p.y)/C}else{const C=this.pointCoordinate(u),D=this.pointCoordinate(p);a=C.x-D.x,f=C.y-D.y}const v=this.locationCoordinate(i);this.setLocation(new l.MercatorCoordinate(v.x-a,v.y-f))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,u){const a=u?l.mercatorZfromAltitude(u,i.lat):void 0,f=this.projection.project(i.lng,i.lat);return new l.MercatorCoordinate(f.x,f.y,a)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,u){const a=u??this._centerAltitude,f=[i.x,i.y,0,1],p=[i.x,i.y,1,1];l.transformMat4$1(f,f,this.pixelMatrixInverse),l.transformMat4$1(p,p,this.pixelMatrixInverse);const v=p[3];l.scale$1(f,f,1/f[3]),l.scale$1(p,p,1/v);const C=f[2],D=p[2];return{p0:f,p1:p,t:C===D?0:(a-C)/(D-C)}}screenPointToMercatorRay(i){const u=[i.x,i.y,0,1],a=[i.x,i.y,1,1];return l.transformMat4$1(u,u,this.pixelMatrixInverse),l.transformMat4$1(a,a,this.pixelMatrixInverse),l.scale$1(u,u,1/u[3]),l.scale$1(a,a,1/a[3]),u[2]=l.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,a[2]=l.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,l.scale$1(u,u,1/this.worldSize),l.scale$1(a,a,1/this.worldSize),new l.Ray([u[0],u[1],u[2]],l.normalize([],l.sub([],a,u)))}rayIntersectionCoordinate(i){const{p0:u,p1:a,t:f}=i,p=l.mercatorZfromAltitude(u[2],this._center.lat),v=l.mercatorZfromAltitude(a[2],this._center.lat);return new l.MercatorCoordinate(l.number(u[0],a[0],f)/this.worldSize,l.number(u[1],a[1],f)/this.worldSize,l.number(p,v,f))}pointCoordinate(i,u=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,u)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let u=this.projection.pointCoordinate3D(this,i.x,i.y);if(u)return new l.MercatorCoordinate(u[0],u[1],u[2]);let a=0,f=this.horizonLineFromTop();if(i.y>f)return this.pointCoordinate(i);const p=.02*f,v=i.clone();for(let C=0;C<10&&f-a>p;C++){v.y=l.number(a,f,.66);const D=this.projection.pointCoordinate3D(this,v.x,v.y);D?(f=v.y,u=D):a=v.y}return u?new l.MercatorCoordinate(u[0],u[1],u[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}_coordinatePoint(i,u){const a=u&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,f=[i.x*this.worldSize,i.y*this.worldSize,a+i.toAltitude(),1];return l.transformMat4$1(f,f,this.pixelMatrix),f[3]>0?new l.pointGeometry(f[0]/f[3],f[1]/f[3]):new l.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:i,left:u}=this._edgeInsets,a=this.height-this._edgeInsets.bottom,f=this.width-this._edgeInsets.right,p=this.pointCoordinate3D(new l.pointGeometry(u,i)),v=this.pointCoordinate3D(new l.pointGeometry(f,i)),C=this.pointCoordinate3D(new l.pointGeometry(f,a)),D=this.pointCoordinate3D(new l.pointGeometry(u,a));let P=Math.min(p.x,D.x),F=Math.max(v.x,C.x),W=Math.min(p.y,v.y),ue=Math.max(D.y,C.y);const Te=Math.pow(2,-this.zoom)/16,Re=(xt,Lt,en,Wt)=>{const Ut=(xt+en)/2,Ln=(Lt+Wt)/2,Ht=new l.pointGeometry(Ut,Ln),fn=this.pointCoordinate3D(Ht),tn=Math.max(0,P-fn.x,W-fn.y,fn.x-F,fn.y-ue);P=Math.min(P,fn.x),F=Math.max(F,fn.x),W=Math.min(W,fn.y),ue=Math.max(ue,fn.y),tn>Te&&(Re(xt,Lt,Ut,Ln),Re(Ut,Ln,en,Wt))};Re(u,i,f,i),Re(f,i,f,a),Re(f,a,u,a),Re(u,a,u,i);const[je,Le]=l.polesInViewport(this),Fe=je||Le,qe=je?90:l.latFromMercatorY(W),Ze=Fe?180:l.lngFromMercatorX(F),rt=Le?-90:l.latFromMercatorY(ue),_t=Fe?-180:l.lngFromMercatorX(P);return new l.LngLatBounds(new l.LngLat(_t,rt),new l.LngLat(Ze,qe))}_getBounds(i,u){if("globe"===this.projection.name)return this._getGlobeBounds();const a=new l.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),f=new l.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),p=new l.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),v=new l.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let C=this.pointCoordinate(a,i),D=this.pointCoordinate(f,i);const P=this.pointCoordinate(p,u),F=this.pointCoordinate(v,u),W=(ue,Te)=>(Te.y-ue.y)/(Te.x-ue.x);return C.y>1&&D.y>=0?C=new l.MercatorCoordinate((1-F.y)/W(F,C)+F.x,1):C.y<0&&D.y<=1&&(C=new l.MercatorCoordinate(-F.y/W(F,C)+F.x,0)),D.y>1&&C.y>=0?D=new l.MercatorCoordinate((1-P.y)/W(P,D)+P.x,1):D.y<0&&C.y<=1&&(D=new l.MercatorCoordinate(-P.y/W(P,D)+P.x,0)),(new l.LngLatBounds).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(P))}_getBounds3D(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBounds(0,0);const u=i.visibleDemTiles.reduce((a,f)=>{if(f.dem){const p=f.dem.tree;a.min=Math.min(a.min,p.minimums[0]),a.max=Math.max(a.max,p.maximums[0])}return a},{min:Number.MAX_VALUE,max:0});return this._getBounds(u.min*i.exaggeration(),u.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,a=this.height/2-u*(1-this._horizonShift);return i?Math.max(0,a):a}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-l.MAX_MERCATOR_LATITUDE,this.maxLat=l.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=l.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=l.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=l.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=l.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,u){return this.projection.createTileMatrix(this,u,i)}calculateDistanceTileData(i){const u=i.key,a=this._distanceTileDataCache;if(a[u])return a[u];const f=i.canonical,p=1/this.height,v=this.cameraWorldSize,C=v/this.zoomScale(f.z),D=(f.x+Math.pow(2,f.z)*i.wrap)*C,P=f.y*C,F=this.point;F.x*=v/this.worldSize,F.y*=v/this.worldSize;const W=this.angle,ue=Math.sin(-W),Te=-Math.cos(-W);return a[u]={bearing:[ue,Te],center:[(F.x-D)*p,(F.y-P)*p],scale:C/l.EXTENT*p},a[u]}calculateFogTileMatrix(i){const u=i.key,a=this._fogTileMatrixCache;if(a[u])return a[u];const f=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return l.multiply(f,this.worldToFogMatrix,f),a[u]=new Float32Array(f),a[u]}calculateProjMatrix(i,u=!1){const a=i.key,f=u?this._alignedProjMatrixCache:this._projMatrixCache;if(f[a])return f[a];const p=this.calculatePosMatrix(i,this.worldSize);return l.multiply(p,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,p),f[a]=new Float32Array(p),f[a]}calculatePixelsToTileUnitsMatrix(i){const u=i.tileID.key,a=this._pixelsToTileUnitsCache;if(a[u])return a[u];const f=function(p,v){const{scale:C}=p.tileTransform,D=C*l.EXTENT/(p.tileSize*Math.pow(2,v.zoom-p.tileID.overscaledZ+p.tileID.canonical.z));return P=new Float32Array(4),ue=(F=v.inverseAdjustmentMatrix)[1],Te=F[2],Re=F[3],Le=(W=[D,D])[1],P[0]=F[0]*(je=W[0]),P[1]=ue*je,P[2]=Te*Le,P[3]=Re*Le,P;var P,F,W,ue,Te,Re,je,Le}(i,this);return a[u]=f,a[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const i=this._elevation;this._updateCameraState();const u=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,a=this._computeCameraPosition(u),f=this._camera.forward(),p=l.mercatorZfromAltitude(1,this._center.lat);a[2]/=p,f[2]/=p,l.normalize(f,f);const v=i.raycast(a,f,i.exaggeration());if(v){const C=l.scaleAndAdd([],a,f,v),D=new l.MercatorCoordinate(C[0],C[1],l.mercatorZfromAltitude(C[2],l.latFromMercatorY(C[1]))),P=(D.z+l.length([D.x-a[0],D.y-a[1],D.z-a[2]*p]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const u=this._elevation,a=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(a),p=u.getAtPointOrZero(new l.MercatorCoordinate(...f)),v=this.pixelsPerMeter/this.worldSize*p,C=this._minimumHeightOverTerrain(),D=f[2]-v;if(D<=C)if(D<0||i){const P=this.locationCoordinate(this._center,this._centerAltitude),F=[f[0],f[1],P.z-f[2]],W=l.length(F);F[2]-=(C-D)/this._pixelsPerMercatorPixel;const ue=l.length(F);if(0===ue)return;l.scale$2(F,F,W/ue*this._pixelsPerMercatorPixel),this._camera.position=[f[0],f[1],P.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const ue=this.center;return ue.lat=l.clamp(ue.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(ue.lng=l.clamp(ue.lng,this.minLng,this.maxLng)),this.center=ue,void(this._constraining=!1)}const u=this._unmodified,{x:a,y:f}=this.point;let p=0,v=a,C=f;const D=this.width/2,P=this.height/2,F=this.worldMinY*this.scale,W=this.worldMaxY*this.scale;if(f-P<F&&(C=F+P),f+P>W&&(C=W-P),W-F<this.height&&(p=Math.max(p,this.height/(W-F)),C=(W+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ue=this.worldMinX*this.scale,Te=this.worldMaxX*this.scale,Re=this.worldSize/2-(ue+Te)/2;v=(a+Re+this.worldSize)%this.worldSize-Re,v-D<ue&&(v=ue+D),v+D>Te&&(v=Te-D),Te-ue<this.width&&(p=Math.max(p,this.width/(Te-ue)),v=(Te+ue)/2)}v===a&&C===f||(this.center=this.unproject(new l.pointGeometry(v,C))),p&&(this.zoom+=this.scaleZoom(p)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,u=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=l.mercatorZfromAltitude(1,this.center.lat)/l.mercatorZfromAltitude(1,l.GLOBE_SCALE_MATCH_LATITUDE));const a=$i(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,a),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const f=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?u:1),p=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);p[8]=2*-i.x/this.width,p[9]=2*i.y/this.height;let v=l.mul([],p,f);if(this.projection.isReprojectedInTileSpace){const _t=this.locationCoordinate(this.center),xt=l.identity([]);l.translate(xt,xt,[_t.x*this.worldSize,_t.y*this.worldSize,0]),l.multiply(xt,xt,ai(this)),l.translate(xt,xt,[-_t.x*this.worldSize,-_t.y*this.worldSize,0]),l.multiply(v,v,xt),this.inverseAdjustmentMatrix=function(Lt){const en=ai(Lt,!0);return _e([],[en[0],en[1],en[4],en[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=l.scale([],v,[this.worldSize,this.worldSize,this.worldSize/u,1]),this.projMatrix=v,this.invProjMatrix=l.invert(new Float64Array(16),this.projMatrix);const C=l.invert([],p);this.frustumCorners=l.FrustumCorners.fromInvProjectionMatrix(C,this.horizonLineFromTop(),this.height);const D=new Float32Array(16);l.identity(D),l.scale(D,D,[1,-1,1]),l.rotateX(D,D,this._pitch),l.rotateZ(D,D,this.angle);const P=l.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),F=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-i.x/this.width,P[9]=2*(i.y+F)/this.height,this.skyboxMatrix=l.multiply(D,P,D);const W=this.point,ue=W.x,Te=W.y,Re=this.width%2/2,je=this.height%2/2,Le=Math.cos(this.angle),Fe=Math.sin(this.angle),qe=ue-Math.round(ue)+Le*Re+Fe*je,Ze=Te-Math.round(Te)+Le*je+Fe*Re,rt=new Float64Array(v);if(l.translate(rt,rt,[qe>.5?qe-1:qe,Ze>.5?Ze-1:Ze,0]),this.alignedProjMatrix=rt,v=l.create(),l.scale(v,v,[this.width/2,-this.height/2,1]),l.translate(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=l.create(),l.scale(v,v,[1,-1,1]),l.translate(v,v,[-1,-1,0]),l.scale(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v,this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},v=l.invert(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=v,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=l.calculateGlobeMatrix(this);const _t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=l.transformMat4(_t,_t,f),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=v;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,a=this._camera.position,f=1/this.height/this._pixelsPerMercatorPixel,p=[i,i,u];l.scale$2(p,p,f),l.scale$2(a,a,-1),l.multiply$2(a,a,p);const v=l.create();l.translate(v,v,a),l.scale(v,v,p),this.mercatorFogMatrix=v,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,u,f)}_computeCameraPosition(i){const u=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,a=this._camera.forward(),f=this.point,p=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-i/this.worldSize*this._centerAltitude;return[f.x/this.worldSize-a[0]*p,f.y/this.worldSize-a[1]*p,i/this.worldSize*this._centerAltitude-a[2]*p]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),a=this._camera.position[2],f=i[2];let p=1;this.projection.wrap&&(this.center=this.center.wrap()),f>0&&(p=Math.min((u-a)/f,1)),this._camera.position=l.scaleAndAdd([],this._camera.position,i,p),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,u=this._camera.forward(),{pitch:a,bearing:f}=this._camera.getPitchBearing(),p=l.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,v=this._mercatorZfromZoom(this._maxZoom)*Math.cos(l.degToRad(this._maxPitch)),C=Math.max((i[2]-p)/Math.cos(a),v),D=this._zoomFromMercatorZ(C);l.scaleAndAdd(i,i,u,C),this._pitch=l.clamp(a,l.degToRad(this.minPitch),l.degToRad(this.maxPitch)),this.angle=l.wrap(f,-Math.PI,Math.PI),this._setZoom(l.clamp(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new l.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){const u=v=>{const C=this.getCameraToCenterDistance(this.projection,v);return this.scaleZoom(C/(i*this.tileSize))};let a,f=u(this.zoom),p=Math.abs(f-u(f));for(;a!==p;)f=u(f),a=p,p=Math.abs(f-u(f));return f}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(l.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,u){const a=Math.min(i.x,u.x),f=Math.max(i.x,u.x),p=Math.min(i.y,u.y),v=Math.max(i.y,u.y);if(p<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const C=[new l.pointGeometry(a,p),new l.pointGeometry(f,v),new l.pointGeometry(a,v),new l.pointGeometry(f,p)],D=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const F of C){const W=this.pointRayIntersection(F);if(W.t<0)return!0;const ue=this.rayIntersectionCoordinate(W);if(ue.x<D||ue.y<0||ue.x>P||ue.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+l.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new l.pointGeometry(0,0),new l.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,u){const a=l.length(l.sub([],this._camera.position,i)),f=this._zoomFromMercatorZ(a)+u;return a-this._mercatorZfromZoom(f)}getCameraPoint(){if("globe"===this.projection.name){const i=function([u,a,f],p){const v=[u,a,f,1];l.transformMat4$1(v,v,p);const C=v[3]=Math.max(v[3],1e-6);return v[0]/=C,v[1]/=C,v[2]/=C,v}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new l.pointGeometry(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,i))}}getCameraToCenterDistance(i,u=this.zoom){const a=$i(i,u,this.width,this.height,1024),f=i.pixelSpaceConversion(this.center.lat,this.worldSize,a);return.5/Math.tan(.5*this._fov)*this.height*f}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&l.multiply(i,i,this.globeMatrix),i}}function io(m,i){let u=!1,a=null;const f=()=>{a=null,u&&(m(),a=setTimeout(f,i),u=!1)};return()=>(u=!0,a||f(),a)}class $n{constructor(i){this._hashName=i&&encodeURIComponent(i),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=io(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,l.window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),l.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const u=ro(i);if(this._hashName){const a=this._hashName;let f=!1;const p=l.window.location.hash.slice(1).split("&").map(v=>{const C=v.split("=")[0];return C===a?(f=!0,`${C}=${u}`):v}).filter(v=>v);return f||p.push(`${a}=${u}`),`#${p.join("&")}`}return`#${u}`}_getCurrentHash(){const i=l.window.location.hash.replace("#","");if(this._hashName){let u;return i.split("&").map(a=>a.split("=")).forEach(a=>{a[0]===this._hashName&&(u=a)}),(u&&u[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(a=>isNaN(a))){const a=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(u[3]||0):i.getBearing();return i.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:a,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=l.window.location.href.replace(/(#.+)?$/,this.getHashString());l.window.history.replaceState(l.window.history.state,null,i)}}function ro(m,i){const u=m.getCenter(),a=Math.round(100*m.getZoom())/100,f=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,f),v=Math.round(u.lng*p)/p,C=Math.round(u.lat*p)/p,D=m.getBearing(),P=m.getPitch();let F=i?`/${v}/${C}/${a}`:`${a}/${C}/${v}`;return(D||P)&&(F+="/"+Math.round(10*D)/10),P&&(F+=`/${Math.round(P)}`),F}const Bs={linearity:.3,easing:l.bezier(0,0,.3,1)},_a=l.extend({deceleration:2500,maxSpeed:1400},Bs),Oa=l.extend({deceleration:20,maxSpeed:1400},Bs),Qs=l.extend({deceleration:1e3,maxSpeed:360},Bs),ml=l.extend({deceleration:1e3,maxSpeed:90},Bs);class ya{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,u=l.exported.now();for(;i.length>0&&u-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)u.zoom+=p.zoomDelta||0,u.bearing+=p.bearingDelta||0,u.pitch+=p.pitchDelta||0,p.panDelta&&u.pan._add(p.panDelta),p.around&&(u.around=p.around),p.pinchAround&&(u.pinchAround=p.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(u.pan.mag()){const p=Ra(u.pan.mag(),a,l.extend({},_a,i||{}));f.offset=u.pan.mult(p.amount/u.pan.mag()),f.center=this._map.transform.center,gl(f,p)}if(u.zoom){const p=Ra(u.zoom,a,Oa);f.zoom=this._map.transform.zoom+p.amount,gl(f,p)}if(u.bearing){const p=Ra(u.bearing,a,Qs);f.bearing=this._map.transform.bearing+l.clamp(p.amount,-179,179),gl(f,p)}if(u.pitch){const p=Ra(u.pitch,a,ml);f.pitch=this._map.transform.pitch+p.amount,gl(f,p)}if(f.zoom||f.bearing){const p=void 0===u.pinchAround?u.around:u.pinchAround;f.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),f.noMoveStart=!0,f}}function gl(m,i){(!m.duration||m.duration<i.duration)&&(m.duration=i.duration,m.easing=i.easing)}function Ra(m,i,u){const{maxSpeed:a,linearity:f,deceleration:p}=u,v=l.clamp(m*f/(i/1e3),-a,a),C=Math.abs(v)/(p*f);return{easing:u.easing,duration:1e3*C,amount:v*(C/2)}}class lo extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,a,f={}){const p=Q(u.getCanvasContainer(),a),v=u.unproject(p);super(i,l.extend({point:p,lngLat:v,originalEvent:a},f)),this._defaultPrevented=!1,this.target=u}}class _l extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,a){const f="touchend"===i?a.changedTouches:a.touches,p=Ye(u.getCanvasContainer(),f),v=p.map(D=>u.unproject(D)),C=p.reduce((D,P,F,W)=>D.add(P.div(W.length)),new l.pointGeometry(0,0));super(i,{points:p,point:C,lngLats:v,lngLat:u.unproject(C),originalEvent:a}),this._defaultPrevented=!1}}class La extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,a){super(i,{originalEvent:a}),this._defaultPrevented=!1}}class mc{constructor(i,u){this._map=i,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new La(i.type,this._map,i))}mousedown(i,u){return this._mousedownPos=u,this._firePreventable(new lo(i.type,this._map,i))}mouseup(i){this._map.fire(new lo(i.type,this._map,i))}preclick(i){const u=l.extend({},i);u.type="preclick",this._map.fire(new lo(u.type,this._map,u))}click(i,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(i),this._map.fire(new lo(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new lo(i.type,this._map,i))}mouseover(i){this._map.fire(new lo(i.type,this._map,i))}mouseout(i){this._map.fire(new lo(i.type,this._map,i))}touchstart(i){return this._firePreventable(new _l(i.type,this._map,i))}touchmove(i){this._map.fire(new _l(i.type,this._map,i))}touchend(i){this._map.fire(new _l(i.type,this._map,i))}touchcancel(i){this._map.fire(new _l(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yl{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new lo(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new lo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new lo(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gc{constructor(i,u){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,u){this.isEnabled()&&i.shiftKey&&0===i.button&&(ze(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(i,u){if(!this._active)return;const a=u,f=this._startPos,p=this._lastPos;if(!f||!p||p.equals(a)||!this._box&&a.dist(f)<this._clickTolerance)return;this._lastPos=a,this._box||(this._box=Me("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const v=Math.min(f.x,a.x),C=Math.max(f.x,a.x),D=Math.min(f.y,a.y),P=Math.max(f.y,a.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${D}px)`,this._box.style.width=C-v+"px",this._box.style.height=P-D+"px")})}mouseupWindow(i,u){if(!this._active)return;const a=this._startPos,f=u;if(a&&0===i.button){if(this.reset(),Oe(),a.x!==f.x||a.y!==f.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:p=>p.fitScreenCoordinates(a,f,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&27===i.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),le(),delete this._startPos,delete this._lastPos}_fireEvent(i,u){return this._map.fire(new l.Event(i,{originalEvent:u}))}}function Ja(m,i){const u={};for(let a=0;a<m.length;a++)u[m[a].identifier]=i[a];return u}class Yl{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,u,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=i.timeStamp),a.length===this.numTouches&&(this.centroid=function(f){const p=new l.pointGeometry(0,0);for(const v of f)p._add(v);return p.div(f.length)}(u),this.touches=Ja(a,u)))}touchmove(i,u,a){if(this.aborted||!this.centroid)return;const f=Ja(a,u);for(const p in this.touches){const C=f[p];(!C||C.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(i,u,a){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),0===a.length){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class _c{constructor(i){this.singleTap=new Yl(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,u,a){this.singleTap.touchstart(i,u,a)}touchmove(i,u,a){this.singleTap.touchmove(i,u,a)}touchend(i,u,a){const f=this.singleTap.touchend(i,u,a);if(f){const p=i.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(f)<30;if(p&&v||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class Ns{constructor(){this._zoomIn=new _c({numTouches:1,numTaps:2}),this._zoomOut=new _c({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,u,a){this._zoomIn.touchstart(i,u,a),this._zoomOut.touchstart(i,u,a)}touchmove(i,u,a){this._zoomIn.touchmove(i,u,a),this._zoomOut.touchmove(i,u,a)}touchend(i,u,a){const f=this._zoomIn.touchend(i,u,a),p=this._zoomOut.touchend(i,u,a);return f?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(f)},{originalEvent:i})}):p?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(p)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const yc={0:1,2:2};class Xa{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,u){return!1}_move(i,u){return{}}mousedown(i,u){if(this._lastPoint)return;const a=St(i);this._correctButton(i,a)&&(this._lastPoint=u,this._eventButton=a)}mousemoveWindow(i,u){const a=this._lastPoint;if(a)if(i.preventDefault(),null!=this._eventButton&&function(f,p){const v=yc[p];return void 0===f.buttons||(f.buttons&v)!==v}(i,this._eventButton))this.reset();else if(this._moved||!(u.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(a,u)}mouseupWindow(i){this._lastPoint&&St(i)===this._eventButton&&(this._moved&&Oe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vc extends Xa{mousedown(i,u){super.mousedown(i,u),this._lastPoint&&(this._active=!0)}_correctButton(i,u){return 0===u&&!i.ctrlKey}_move(i,u){return{around:u,panDelta:u.sub(i)}}}class vl extends Xa{_correctButton(i,u){return 0===u&&i.ctrlKey||2===u}_move(i,u){const a=.8*(u.x-i.x);if(a)return this._active=!0,{bearingDelta:a}}contextmenu(i){i.preventDefault()}}class Jl extends Xa{_correctButton(i,u){return 0===u&&i.ctrlKey||2===u}_move(i,u){const a=-.5*(u.y-i.y);if(a)return this._active=!0,{pitchDelta:a}}contextmenu(i){i.preventDefault()}}class xc{constructor(i,u){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),l.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0)}touchstart(i,u,a){return this._calculateTransform(i,u,a)}touchmove(i,u,a){if(this._active&&!(a.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===a.length&&!l.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,u,a)}}touchend(i,u,a){this._calculateTransform(i,u,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,u,a){a.length>0&&(this._active=!0);const f=Ja(a,u),p=new l.pointGeometry(0,0),v=new l.pointGeometry(0,0);let C=0;for(const P in f){const F=f[P],W=this._touches[P];W&&(p._add(F),v._add(F.sub(W)),C++,f[P]=F)}if(this._touches=f,C<this._minTouches||!v.mag())return;const D=v.div(C);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(C),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Me("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Xl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,u,a){return{}}touchstart(i,u,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([u[0],u[1]]))}touchmove(i,u,a){const f=this._firstTwoTouches;if(!f)return;i.preventDefault();const[p,v]=f,C=va(a,u,p),D=va(a,u,v);if(!C||!D)return;const P=this._aroundCenter?null:C.add(D).div(2);return this._move([C,D],P,i)}touchend(i,u,a){if(!this._firstTwoTouches)return;const[f,p]=this._firstTwoTouches,v=va(a,u,f),C=va(a,u,p);v&&C||(this._active&&Oe(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function va(m,i,u){for(let a=0;a<m.length;a++)if(m[a].identifier===u)return i[a]}function bc(m,i){return Math.log(m/i)/Math.LN2}class Bc extends Xl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,u){const a=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(bc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:bc(this._distance,a),pinchAround:u}}}function Nc(m,i){return 180*m.angleWith(i)/Math.PI}class Qo extends Xl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,u){const a=this._vector;if(this._vector=i[0].sub(i[1]),a&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Nc(this._vector,a),pinchAround:u}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const u=25/(Math.PI*this._minDiameter)*360,a=this._startVector;if(!a)return!1;const f=Nc(i,a);return Math.abs(f)<u}}function xl(m){return Math.abs(m.y)>Math.abs(m.x)}class ea extends Xl{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,xl(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,u,a){const f=this._lastPoints;if(!f)return;const p=i[0].sub(f[0]),v=i[1].sub(f[1]);return this._map._cooperativeGestures&&!l.isFullscreen()&&a.touches.length<3||(this._valid=this.gestureBeginsVertically(p,v,a.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(p.y+v.y)/2*-.5})}gestureBeginsVertically(i,u,a){if(void 0!==this._valid)return this._valid;const f=i.mag()>=2,p=u.mag()>=2;if(!f&&!p)return;if(!f||!p)return null==this._firstMove&&(this._firstMove=a),a-this._firstMove<100&&void 0;const v=i.y>0==u.y>0;return xl(i)&&xl(u)&&v}}const Iu={panStep:100,bearingStep:15,pitchStep:10};class Fo{constructor(){const i=Iu;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let u=0,a=0,f=0,p=0,v=0;switch(i.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:i.shiftKey?a=-1:(i.preventDefault(),p=-1);break;case 39:i.shiftKey?a=1:(i.preventDefault(),p=1);break;case 38:i.shiftKey?f=1:(i.preventDefault(),v=-1);break;case 40:i.shiftKey?f=-1:(i.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(a=0,f=0),{cameraAnimation:C=>{const D=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:zc,zoom:u?Math.round(D)+u*(i.shiftKey?2:1):D,bearing:C.getBearing()+a*this._bearingStep,pitch:C.getPitch()+f*this._pitchStep,offset:[-p*this._panStep,-v*this._panStep],center:C.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function zc(m){return m*(2-m)}const bl=4.000244140625;class Xd{constructor(i,u){this._map=i,this._el=i.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||l.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=i.deltaMode===l.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const a=l.exported.now(),f=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,0!==u&&u%bl==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(f*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),i.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=i,this._delta-=u,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Q(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;"wheel"===this._type&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){const D="wheel"===this._type&&Math.abs(this._delta)>bl?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&0!==P&&(P=1/P);const F=u(),W=Math.pow(2,F),ue="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):W;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(ue*P))),"wheel"===this._type&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._delta=0}const a="number"==typeof this._targetZoom?this._targetZoom:u(),f=this._startZoom,p=this._easing;let v,C=!1;if("wheel"===this._type&&f&&p){const D=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),P=p(D);v=l.number(f,a,P),D<1?this._frameId||(this._frameId=!0):C=!0}else v=a,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:v-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let u=l.ease;if(this._prevEase){const a=this._prevEase,f=(l.exported.now()-a.start)/a.duration,p=a.easing(f+.01)-a.easing(f),v=.27/Math.sqrt(p*p+1e-4)*.01,C=Math.sqrt(.0729-v*v);u=l.bezier(v,C,.25,1)}return this._prevEase={start:l.exported.now(),duration:i,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Me("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(l.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Mu{constructor(i,u){this._clickZoom=i,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Is{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,u){return i.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:a.getZoom()+(i.shiftKey?-1:1),around:a.unproject(u)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uc{constructor(){this._tap=new _c({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,u,a){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=u[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(i,u,a))}touchmove(i,u,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const f=u[0],p=f.y-this._swipePoint.y;return this._swipePoint=f,i.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(i,u,a)}touchend(i,u,a){this._tapTime?this._swipePoint&&0===a.length&&this.reset():this._tap.touchend(i,u,a)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zs{constructor(i,u,a){this._el=i,this._mousePan=u,this._touchPan=a}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ta{constructor(i,u,a){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=u,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class xa{constructor(i,u,a,f){this._el=i,this._touchZoom=u,this._touchRotate=a,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Zn=m=>m.zoom||m.drag||m.pitch||m.rotate;class Fa extends l.Event{}class Vc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,u){const a=l.sub([],u,i);this.radius=l.length(a[2]<0?l.div([],a,this.constants):[a[0],a[1],0])}projectRay(i){l.div(i,i,this.constants),l.normalize(i,i),l.mul$1(i,i,this.constants);const u=l.scale$2([],i,this.radius);if(u[2]>0){const a=l.scale$2([],[0,0,1],l.dot(u,[0,0,1])),f=l.scale$2([],l.normalize([],[u[0],u[1],0]),this.radius),p=l.add([],u,l.scale$2([],l.sub([],l.add([],f,a),u),2));u[0]=p[0],u[1]=p[1]}return u}}function ka(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Ba{constructor(i,u){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ya(i),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Vc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),l.bindAll(["handleEvent","handleWindowEvent"],this);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[l.window.document,"mousemove",{capture:!0}],[l.window.document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[l.window,"blur",void 0]];for(const[f,p,v]of this._listeners)f.addEventListener(p,f===l.window.document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[i,u,a]of this._listeners)i.removeEventListener(u,i===l.window.document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(i){const u=this._map,a=u.getCanvasContainer();this._add("mapEvent",new mc(u,i));const f=u.boxZoom=new gc(u,i);this._add("boxZoom",f);const p=new Ns,v=new Is;u.doubleClickZoom=new Mu(v,p),this._add("tapZoom",p),this._add("clickZoom",v);const C=new Uc;this._add("tapDragZoom",C);const D=u.touchPitch=new ea(u);this._add("touchPitch",D);const P=new vl(i),F=new Jl(i);u.dragRotate=new ta(i,P,F),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const W=new vc(i),ue=new xc(u,i);u.dragPan=new zs(a,W,ue),this._add("mousePan",W),this._add("touchPan",ue,["touchZoom","touchRotate"]);const Te=new Qo,Re=new Bc;u.touchZoomRotate=new xa(a,Re,Te,C),this._add("touchRotate",Te,["touchPan","touchZoom"]),this._add("touchZoom",Re,["touchPan","touchRotate"]),this._add("blockableMapEvent",new yl(u));const je=u.scrollZoom=new Xd(u,this);this._add("scrollZoom",je,["mousePan"]);const Le=u.keyboard=new Fo;this._add("keyboard",Le);for(const Fe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[Fe]&&u[Fe].enable(i[Fe])}_add(i,u,a){this._handlers.push({handlerName:i,handler:u,allowed:a}),this._handlersById[i]=u}stop(i){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zn(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,u,a){for(const f in i)if(f!==a&&(!u||u.indexOf(f)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const u=[];for(const a of i)this._el.contains(a.target)&&u.push(a);return u}handleEvent(i,u){this._updatingCamera=!0;const a="renderFrame"===i.type,f=a?void 0:i,p={needsRenderFrame:!1},v={},C={},D=i.touches?this._getMapTouches(i.touches):void 0,P=D?Ye(this._el,D):a?void 0:Q(this._el,i);for(const{handlerName:ue,handler:Te,allowed:Re}of this._handlers){if(!Te.isEnabled())continue;let je;this._blockedByActive(C,Re,ue)?Te.reset():Te[u||i.type]&&(je=Te[u||i.type](i,P,D),this.mergeHandlerResult(p,v,je,ue,f),je&&je.needsRenderFrame&&this._triggerRenderFrame()),(je||Te.isActive())&&(C[ue]=Te)}const F={};for(const ue in this._previousActiveHandlers)C[ue]||(F[ue]=f);this._previousActiveHandlers=C,(Object.keys(F).length||ka(p))&&(this._changes.push([p,v,F]),this._triggerRenderFrame()),(Object.keys(C).length||ka(p))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=p;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))}mergeHandlerResult(i,u,a,f,p){if(!a)return;l.extend(i,a);const v={handlerName:f,originalEvent:a.originalEvent||p};void 0!==a.zoomDelta&&(u.zoom=v),void 0!==a.panDelta&&(u.drag=v),void 0!==a.pitchDelta&&(u.pitch=v),void 0!==a.bearingDelta&&(u.rotate=v)}_applyChanges(){const i={},u={},a={};for(const[f,p,v]of this._changes)f.panDelta&&(i.panDelta=(i.panDelta||new l.pointGeometry(0,0))._add(f.panDelta)),f.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+f.pitchDelta),void 0!==f.around&&(i.around=f.around),void 0!==f.aroundCoord&&(i.aroundCoord=f.aroundCoord),void 0!==f.pinchAround&&(i.pinchAround=f.pinchAround),f.noInertia&&(i.noInertia=f.noInertia),l.extend(u,p),l.extend(a,v);this._updateMapTransform(i,u,a),this._changes=[]}_updateMapTransform(i,u,a){const f=this._map,p=f.transform,v=qe=>[qe.x,qe.y,qe.z];if((qe=>{const Ze=this._eventsInProgress.drag;return Ze&&!this._handlersById[Ze.handlerName].isActive()})()&&!ka(i)){const qe=p.zoom;p.cameraElevationReference="sea",p.recenterOnTerrain(),p.cameraElevationReference="ground",qe!==p.zoom&&this._map._update(!0)}if(p._isCameraConstrained&&f._stop(!0),!ka(i))return void this._fireEvents(u,a,!0);let{panDelta:C,zoomDelta:D,bearingDelta:P,pitchDelta:F,around:W,aroundCoord:ue,pinchAround:Te}=i;p._isCameraConstrained&&(D>0&&(D=0),p._isCameraConstrained=!1),void 0!==Te&&(W=Te),(qe=>u.drag&&!this._eventsInProgress.drag)()&&W&&(this._dragOrigin=v(p.pointCoordinate3D(W)),this._trackingEllipsoid.setup(p._camera.position,this._dragOrigin)),p.cameraElevationReference="sea",f._stop(!0),W=W||f.transform.centerPoint,P&&(p.bearing+=P),F&&(p.pitch+=F),p._updateCameraState();const Re=[0,0,0];if(C)if("mercator"===p.projection.name){const qe=this._trackingEllipsoid.projectRay(p.screenPointToMercatorRay(W).dir),Ze=this._trackingEllipsoid.projectRay(p.screenPointToMercatorRay(W.sub(C)).dir);Re[0]=Ze[0]-qe[0],Re[1]=Ze[1]-qe[1]}else{const qe=p.pointCoordinate(W);if("globe"===p.projection.name){C=C.rotate(-p.angle);const Ze=p._pixelsPerMercatorPixel/p.worldSize;Re[0]=-C.x*l.mercatorScale(l.latFromMercatorY(qe.y))*Ze,Re[1]=-C.y*l.mercatorScale(p.center.lat)*Ze}else{const Ze=p.pointCoordinate(W.sub(C));qe&&Ze&&(Re[0]=Ze.x-qe.x,Re[1]=Ze.y-qe.y)}}const je=p.zoom,Le=[0,0,0];if(D){const qe=v(ue||p.pointCoordinate3D(W)),Ze={dir:l.normalize([],l.sub([],qe,p._camera.position))};if(Ze.dir[2]<0){const rt=p.zoomDeltaToMovement(qe,D);l.scale$2(Le,Ze.dir,rt)}}const Fe=l.add(Re,Re,Le);p._translateCameraConstrained(Fe),D&&Math.abs(p.zoom-je)>1e-4&&p.recenterOnTerrain(),p.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(u,a,!0)}_fireEvents(i,u,a){const f=Zn(this._eventsInProgress),p=Zn(i),v={};for(const F in i){const{originalEvent:W}=i[F];this._eventsInProgress[F]||(v[`${F}start`]=W),this._eventsInProgress[F]=i[F]}!f&&p&&this._fireEvent("movestart",p.originalEvent);for(const F in v)this._fireEvent(F,v[F]);p&&this._fireEvent("move",p.originalEvent);for(const F in i){const{originalEvent:W}=i[F];this._fireEvent(F,W)}const C={};let D;for(const F in this._eventsInProgress){const{handlerName:W,originalEvent:ue}=this._eventsInProgress[F];this._handlersById[W].isActive()||(delete this._eventsInProgress[F],D=u[W]||ue,C[`${F}end`]=D)}for(const F in C)this._fireEvent(F,C[F]);const P=Zn(this._eventsInProgress);if(a&&(f||p)&&!P){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),W=ue=>0!==ue&&-this._bearingSnap<ue&&ue<this._bearingSnap;F?(W(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:D})):(this._map.fire(new l.Event("moveend",{originalEvent:D})),W(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,u){this._map.fire(new l.Event(i,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Fa("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const jc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class $c extends l.Evented{constructor(i,u){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=u.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,u){return this.jumpTo({center:i},u)}panBy(i,u,a){return i=l.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,l.extend({offset:i},u),a)}panTo(i,u,a){return this.easeTo(l.extend({center:i},u),a)}getZoom(){return this.transform.zoom}setZoom(i,u){return this.jumpTo({zoom:i},u),this}zoomTo(i,u,a){return this.easeTo(l.extend({zoom:i},u),a)}zoomIn(i,u){return this.zoomTo(this.getZoom()+1,i,u),this}zoomOut(i,u){return this.zoomTo(this.getZoom()-1,i,u),this}getBearing(){return this.transform.bearing}setBearing(i,u){return this.jumpTo({bearing:i},u),this}getPadding(){return this.transform.padding}setPadding(i,u){return this.jumpTo({padding:i},u),this}rotateTo(i,u,a){return this.easeTo(l.extend({bearing:i},u),a)}resetNorth(i,u){return this.rotateTo(0,l.extend({duration:1e3},i),u),this}resetNorthPitch(i,u){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},i),u),this}snapToNorth(i,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,u):this}getPitch(){return this.transform.pitch}setPitch(i,u){return this.jumpTo({pitch:i},u),this}cameraForBounds(i,u){i=l.LngLatBounds.convert(i);const a=u&&u.bearing||0,f=u&&u.pitch||0,p=i.getNorthWest(),v=i.getSouthEast();return this._cameraForBounds(this.transform,p,v,a,f,u)}_extendCameraOptions(i){const u={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=l.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const a=i.padding;i.padding={top:a,bottom:a,right:a,left:a}}return i.padding=l.extend(u,i.padding),i}_minimumAABBFrustumDistance(i,u){const a=u.max[0]-u.min[0],f=u.max[1]-u.min[1];return a/f>i.aspect?a/(2*Math.tan(.5*i.fovX)*i.aspect):f/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,u,a,f,p,v){const C=i.clone(),D=this._extendCameraOptions(v);C.bearing=f,C.pitch=p;const P=l.LngLat.convert(u),F=l.LngLat.convert(a),W=.5*(P.lat+F.lat),ue=.5*(P.lng+F.lng),Te=l.latLngToECEF(W,ue),Re=l.normalize([],Te),je=l.normalize([],l.cross([],Re,[0,1,0])),Le=l.cross([],je,Re),Fe=[je[0],je[1],je[2],0,Le[0],Le[1],Le[2],0,Re[0],Re[1],Re[2],0,0,0,0,1],qe=[Te,l.latLngToECEF(P.lat,P.lng),l.latLngToECEF(F.lat,P.lng),l.latLngToECEF(F.lat,F.lng),l.latLngToECEF(P.lat,F.lng),l.latLngToECEF(W,P.lng),l.latLngToECEF(W,F.lng),l.latLngToECEF(P.lat,ue),l.latLngToECEF(F.lat,ue)];let Ze=l.Aabb.fromPoints(qe.map($t=>[l.dot(je,$t),l.dot(Le,$t),l.dot(Re,$t)]));const rt=l.transformMat4([],Ze.center,Fe);0===l.squaredLength(rt)&&l.set(rt,0,0,1),l.normalize(rt,rt),l.scale$2(rt,rt,l.GLOBE_RADIUS),C.center=l.ecefToLatLng(rt);const _t=C.getWorldToCameraMatrix(),xt=l.invert(new Float64Array(16),_t);Ze=l.Aabb.applyTransform(Ze,l.multiply([],_t,Fe)),l.transformMat4(rt,rt,_t);const Lt=.5*(Ze.max[2]-Ze.min[2]),en=this._minimumAABBFrustumDistance(C,Ze),Wt=l.scale$2([],[0,0,1],Lt),Ut=l.add(Wt,rt,Wt),Ln=en+(0===C.pitch?0:l.distance(rt,Ut)),Ht=C.globeCenterInViewSpace,fn=l.sub([],rt,[Ht[0],Ht[1],Ht[2]]);l.normalize(fn,fn),l.scale$2(fn,fn,Ln);const tn=l.add([],rt,fn);l.transformMat4(tn,tn,xt);const An=l.earthRadius/l.GLOBE_RADIUS,ln=l.length(tn),xn=l.mercatorZfromAltitude(ln*An-l.earthRadius,0),kn=Math.min(C.zoomFromMercatorZAdjusted(xn),D.maxZoom);return kn>.5*(l.GLOBE_ZOOM_THRESHOLD_MIN+l.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"mercator"}),C.zoom=kn,this._cameraForBounds(C,u,a,f,p,v)):{center:C.center,zoom:kn,bearing:f,pitch:p}}queryTerrainElevation(i,u){const a=this.transform.elevation;return a?(u=l.extend({},{exaggerated:!0},u),a.getAtPoint(l.MercatorCoordinate.fromLngLat(i),null,u.exaggerated)):null}_cameraForBounds(i,u,a,f,p,v){if("globe"===i.projection.name)return this._cameraForBoundsOnGlobe(i,u,a,f,p,v);const C=i.clone(),D=this._extendCameraOptions(v),P=C.padding;C.bearing=f,C.pitch=p;const F=l.LngLat.convert(u),W=l.LngLat.convert(a),ue=new l.LngLat(F.lng,W.lat),Te=new l.LngLat(W.lng,F.lat),Re=C.project(F),je=C.project(W),Le=this.queryTerrainElevation(F),Fe=this.queryTerrainElevation(W),qe=this.queryTerrainElevation(ue),Ze=this.queryTerrainElevation(Te),rt=[[Re.x,Re.y,Math.min(Le||0,Fe||0,qe||0,Ze||0)],[je.x,je.y,Math.max(Le||0,Fe||0,qe||0,Ze||0)]];let _t=l.Aabb.fromPoints(rt);const xt=C.getWorldToCameraMatrix(),Lt=l.invert(new Float64Array(16),xt);_t=l.Aabb.applyTransform(_t,xt);const en=l.sub([],_t.max,_t.min),Wt=P.left||0,Ut=P.right||0,Ln=P.bottom||0,Ht=P.top||0,{left:fn,right:tn,top:An,bottom:ln}=D.padding,xn=.5*(Wt+Ut),kn=.5*(Ht+Ln),$t=Math.min(C.scaleZoom(C.scale*Math.min((C.width-(Wt+Ut+fn+tn))/en[0],(C.height-(Ln+Ht+ln+An))/en[1])),D.maxZoom),rn=C.scale/C.zoomScale($t);_t=new l.Aabb([_t.min[0]-(fn+xn)*rn,_t.min[1]-(ln+kn)*rn,_t.min[2]],[_t.max[0]+(tn+xn)*rn,_t.max[1]+(An+kn)*rn,_t.max[2]]);const ni=.5*en[2],hi=this._minimumAABBFrustumDistance(C,_t),Qn=[0,0,1,0];l.transformMat4$1(Qn,Qn,xt),l.normalize$2(Qn,Qn);const Ci=l.scale$2([],Qn,hi+ni),Zi=l.add([],_t.center,Ci),ui=("number"==typeof D.offset.x&&"number"==typeof D.offset.y?new l.pointGeometry(D.offset.x,D.offset.y):l.pointGeometry.convert(D.offset)).rotate(-l.degToRad(f));_t.center[0]-=ui.x*rn,_t.center[1]+=ui.y*rn,l.transformMat4(_t.center,_t.center,Lt),l.transformMat4(Zi,Zi,Lt);const Xn=[_t.center[0],_t.center[1],Zi[2]*C.pixelsPerMeter];l.scale$2(Xn,Xn,1/C.worldSize);const Ir=l.lngFromMercatorX(Xn[0]),br=l.latFromMercatorY(Xn[1]),Br=Math.min(C._zoomFromMercatorZ(Xn[2]),D.maxZoom),Lr=new l.LngLat(Ir,br);return C.mercatorFromTransition&&Br<.5*(l.GLOBE_ZOOM_THRESHOLD_MIN+l.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"globe"}),C.zoom=Br,this._cameraForBounds(C,u,a,f,p,v)):{center:Lr,zoom:Br,bearing:f,pitch:p}}fitBounds(i,u,a){const f=this.cameraForBounds(i,u);return this._fitInternal(f,u,a)}fitScreenCoordinates(i,u,a,f,p){const v=l.pointGeometry.convert(i),C=l.pointGeometry.convert(u),D=new l.pointGeometry(Math.min(v.x,C.x),Math.min(v.y,C.y)),P=new l.pointGeometry(Math.max(v.x,C.x),Math.max(v.y,C.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(v,C))return this;const F=this.transform.pointLocation3D(D),W=this.transform.pointLocation3D(P),ue=this.transform.pointLocation3D(new l.pointGeometry(D.x,P.y)),Te=this.transform.pointLocation3D(new l.pointGeometry(P.x,D.y)),Re=[Math.min(F.lng,W.lng,ue.lng,Te.lng),Math.min(F.lat,W.lat,ue.lat,Te.lat)],je=[Math.max(F.lng,W.lng,ue.lng,Te.lng),Math.max(F.lat,W.lat,ue.lat,Te.lat)],Le=f&&f.pitch?f.pitch:this.getPitch(),Fe=this._cameraForBounds(this.transform,Re,je,a,Le,f);return this._fitInternal(Fe,f,p)}_fitInternal(i,u,a){return i?(delete(u=l.extend(i,u)).padding,u.linear?this.easeTo(u,a):this.flyTo(u,a)):this}jumpTo(i,u){this.stop();const a=i.preloadOnly?this.transform.clone():this.transform;let f=!1,p=!1,v=!1;return"zoom"in i&&a.zoom!==+i.zoom&&(f=!0,a.zoom=+i.zoom),void 0!==i.center&&(a.center=l.LngLat.convert(i.center)),"bearing"in i&&a.bearing!==+i.bearing&&(p=!0,a.bearing=+i.bearing),"pitch"in i&&a.pitch!==+i.pitch&&(v=!0,a.pitch=+i.pitch),null==i.padding||a.isPaddingEqual(i.padding)||(a.padding=i.padding),i.preloadOnly?(this._preloadTiles(a),this):(this.fire(new l.Event("movestart",u)).fire(new l.Event("move",u)),f&&this.fire(new l.Event("zoomstart",u)).fire(new l.Event("zoom",u)).fire(new l.Event("zoomend",u)),p&&this.fire(new l.Event("rotatestart",u)).fire(new l.Event("rotate",u)).fire(new l.Event("rotateend",u)),v&&this.fire(new l.Event("pitchstart",u)).fire(new l.Event("pitch",u)).fire(new l.Event("pitchend",u)),this.fire(new l.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||l.warnOnce(jc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,u){const a=this.transform;if(!a.projection.supportsFreeCamera)return l.warnOnce(jc),this;this.stop();const f=a.zoom,p=a.pitch,v=a.bearing;a.setFreeCameraOptions(i);const C=f!==a.zoom,D=p!==a.pitch,P=v!==a.bearing;return this.fire(new l.Event("movestart",u)).fire(new l.Event("move",u)),C&&this.fire(new l.Event("zoomstart",u)).fire(new l.Event("zoom",u)).fire(new l.Event("zoomend",u)),P&&this.fire(new l.Event("rotatestart",u)).fire(new l.Event("rotate",u)).fire(new l.Event("rotateend",u)),D&&this.fire(new l.Event("pitchstart",u)).fire(new l.Event("pitch",u)).fire(new l.Event("pitchend",u)),this.fire(new l.Event("moveend",u)),this}easeTo(i,u){this._stop(!1,i.easeId),(!1===(i=l.extend({offset:[0,0],duration:500,easing:l.ease},i)).animate||!i.essential&&l.exported.prefersReducedMotion)&&(i.duration=0);const a=this.transform,f=this.getZoom(),p=this.getBearing(),v=this.getPitch(),C=this.getPadding(),D="zoom"in i?+i.zoom:f,P="bearing"in i?this._normalizeBearing(i.bearing,p):p,F="pitch"in i?+i.pitch:v,W="padding"in i?i.padding:a.padding,ue=l.pointGeometry.convert(i.offset);let Te,Re,je;if("globe"===a.projection.name){const Wt=l.MercatorCoordinate.fromLngLat(a.center),Ut=ue.rotate(-a.angle);Wt.x+=Ut.x/a.worldSize,Wt.y+=Ut.y/a.worldSize;const Ln=Wt.toLngLat(),Ht=l.LngLat.convert(i.center||Ln);this._normalizeCenter(Ht),Te=a.centerPoint.add(Ut),Re=new l.pointGeometry(Wt.x,Wt.y).mult(a.worldSize),je=new l.pointGeometry(l.mercatorXfromLng(Ht.lng),l.mercatorYfromLat(Ht.lat)).mult(a.worldSize).sub(Re)}else{Te=a.centerPoint.add(ue);const Wt=a.pointLocation(Te),Ut=l.LngLat.convert(i.center||Wt);this._normalizeCenter(Ut),Re=a.project(Wt),je=a.project(Ut).sub(Re)}const Le=a.zoomScale(D-f);let Fe,qe;i.around&&(Fe=l.LngLat.convert(i.around),qe=a.locationPoint(Fe));const Ze=this._zooming||D!==f,rt=this._rotating||p!==P,_t=this._pitching||F!==v,xt=!a.isPaddingEqual(W),Lt=Wt=>Ut=>{if(Ze&&(Wt.zoom=l.number(f,D,Ut)),rt&&(Wt.bearing=l.number(p,P,Ut)),_t&&(Wt.pitch=l.number(v,F,Ut)),xt&&(Wt.interpolatePadding(C,W,Ut),Te=Wt.centerPoint.add(ue)),Fe)Wt.setLocationAtPoint(Fe,qe);else{const Ln=Wt.zoomScale(Wt.zoom-f),Ht=D>f?Math.min(2,Le):Math.max(.5,Le),fn=Math.pow(Ht,1-Ut),tn=Wt.unproject(Re.add(je.mult(Ut*fn)).mult(Ln));Wt.setLocationAtPoint(Wt.renderWorldCopies?tn.wrap():tn,Te)}return i.preloadOnly||this._fireMoveEvents(u),Wt};if(i.preloadOnly){const Wt=this._emulate(Lt,i.duration,a);return this._preloadTiles(Wt),this}const en={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ze,this._rotating=rt,this._pitching=_t,this._padding=xt,this._easeId=i.easeId,this._prepareEase(u,i.noMoveStart,en),this._ease(Lt(a),Wt=>{a.recenterOnTerrain(),this._afterEase(u,Wt)},i),this}_prepareEase(i,u,a={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||a.moving||this.fire(new l.Event("movestart",i)),this._zooming&&!a.zooming&&this.fire(new l.Event("zoomstart",i)),this._rotating&&!a.rotating&&this.fire(new l.Event("rotatestart",i)),this._pitching&&!a.pitching&&this.fire(new l.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new l.Event("move",i)),this._zooming&&this.fire(new l.Event("zoom",i)),this._rotating&&this.fire(new l.Event("rotate",i)),this._pitching&&this.fire(new l.Event("pitch",i))}_afterEase(i,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const a=this._zooming,f=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new l.Event("zoomend",i)),f&&this.fire(new l.Event("rotateend",i)),p&&this.fire(new l.Event("pitchend",i)),this.fire(new l.Event("moveend",i))}flyTo(i,u){if(!i.essential&&l.exported.prefersReducedMotion){const $t=l.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo($t,u)}this.stop(),i=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},i);const a=this.transform,f=this.getZoom(),p=this.getBearing(),v=this.getPitch(),C=this.getPadding(),D="zoom"in i?l.clamp(+i.zoom,a.minZoom,a.maxZoom):f,P="bearing"in i?this._normalizeBearing(i.bearing,p):p,F="pitch"in i?+i.pitch:v,W="padding"in i?i.padding:a.padding,ue=a.zoomScale(D-f),Te=l.pointGeometry.convert(i.offset);let Re=a.centerPoint.add(Te);const je=a.pointLocation(Re),Le=l.LngLat.convert(i.center||je);this._normalizeCenter(Le);const Fe=a.project(je),qe=a.project(Le).sub(Fe);let Ze=i.curve;const rt=Math.max(a.width,a.height),_t=rt/ue,xt=qe.mag();if("minZoom"in i){const $t=l.clamp(Math.min(i.minZoom,f,D),a.minZoom,a.maxZoom),rn=rt/a.zoomScale($t-f);Ze=Math.sqrt(rn/xt*2)}const Lt=Ze*Ze;function en($t){const rn=(_t*_t-rt*rt+($t?-1:1)*Lt*Lt*xt*xt)/(2*($t?_t:rt)*Lt*xt);return Math.log(Math.sqrt(rn*rn+1)-rn)}function Wt($t){return(Math.exp($t)-Math.exp(-$t))/2}function Ut($t){return(Math.exp($t)+Math.exp(-$t))/2}const Ln=en(0);let Ht=function($t){return Ut(Ln)/Ut(Ln+Ze*$t)},fn=function($t){return rt*((Ut(Ln)*(Wt(rn=Ln+Ze*$t)/Ut(rn))-Wt(Ln))/Lt)/xt;var rn},tn=(en(1)-Ln)/Ze;if(Math.abs(xt)<1e-6||!isFinite(tn)){if(Math.abs(rt-_t)<1e-6)return this.easeTo(i,u);const $t=_t<rt?-1:1;tn=Math.abs(Math.log(_t/rt))/Ze,fn=function(){return 0},Ht=function(rn){return Math.exp($t*Ze*rn)}}i.duration="duration"in i?+i.duration:1e3*tn/("screenSpeed"in i?+i.screenSpeed/Ze:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const An=p!==P,ln=F!==v,xn=!a.isPaddingEqual(W),kn=$t=>rn=>{const ni=rn*tn,hi=1/Ht(ni);$t.zoom=1===rn?D:f+$t.scaleZoom(hi),An&&($t.bearing=l.number(p,P,rn)),ln&&($t.pitch=l.number(v,F,rn)),xn&&($t.interpolatePadding(C,W,rn),Re=$t.centerPoint.add(Te));const Qn=1===rn?Le:$t.unproject(Fe.add(qe.mult(fn(ni))).mult(hi));return $t.setLocationAtPoint($t.renderWorldCopies?Qn.wrap():Qn,Re),$t._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(u),$t};if(i.preloadOnly){const $t=this._emulate(kn,i.duration,a);return this._preloadTiles($t),this}return this._zooming=!0,this._rotating=An,this._pitching=ln,this._padding=xn,this._prepareEase(u,!1),this._ease(kn(a),()=>this._afterEase(u),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const a=this._onEaseEnd;this._onEaseEnd=void 0,a.call(this,u)}if(!i){const a=this.handlers;a&&a.stop(!1)}return this}_ease(i,u,a){!1===a.animate||0===a.duration?(i(1),u()):(this._easeStart=l.exported.now(),this._easeOptions=a,this._onEaseFrame=i,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,u){i=l.wrap(i,-180,180);const a=Math.abs(i-u);return Math.abs(i-360-u)<a&&(i-=360),Math.abs(i+360-u)<a&&(i+=360),i}_normalizeCenter(i){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const a=i.lng-u.center.lng;i.lng+=a>180?-360:a<-180?360:0}_emulate(i,u,a){const f=Math.ceil(15*u/1e3),p=[],v=i(a.clone());for(let C=0;C<=f;C++){const D=v(C/f);p.push(D.clone())}return p}}class Ar{constructor(i={}){this.options=i,l.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const u=this.options&&this.options.compact;return this._map=i,this._container=Me("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Me("button","mapboxgl-ctrl-attrib-button",this._container),Me("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Me("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===u&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,u){const a=this._map._getUIString(`AttributionControl.${u}`);i.setAttribute("aria-label",a),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",a)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||l.config.ACCESS_TOKEN}];if(i){const a=u.reduce((f,p,v)=>(p.value&&(f+=`${p.key}=${p.value}${v<u.length-1?"&":""}`),f),"?");i.href=`${l.config.FEEDBACK_URL}/${a}#${ro(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||"metadata"!==i.sourceDataType&&"visibility"!==i.sourceDataType&&"style"!==i.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const u=this._map.style._sourceCaches;for(const f in u){const p=u[f];if(p.used){const v=p.getSource();v.attribution&&i.indexOf(v.attribution)<0&&i.push(v.attribution)}}i.sort((f,p)=>f.length-p.length),i=i.filter((f,p)=>{for(let v=p+1;v<i.length;v++)if(i[v].indexOf(f)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const a=i.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,i.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Su{constructor(){l.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=Me("div","mapboxgl-ctrl");const u=Me("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&"metadata"!==i.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(0===Object.entries(i).length)return!0;for(const u in i){const a=i[u].getSource();if(a.hasOwnProperty("mapbox_logo")&&!a.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const u=i[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Au{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const u=++this._id;return this._queue.push({callback:i,id:u,cancelled:!1}),u}remove(i){const u=this._currentlyRunning,a=u?this._queue.concat(u):this._queue;for(const f of a)if(f.id===i)return void(f.cancelled=!0)}run(i=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const a of u)if(!a.cancelled&&(a.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Pu(m,i,u){if(m=new l.LngLat(m.lng,m.lat),i){const a=new l.LngLat(m.lng-360,m.lat),f=new l.LngLat(m.lng+360,m.lat),p=360*Math.ceil(Math.abs(m.lng-u.center.lng)/360),v=u.locationPoint(m).distSqr(i),C=i.x<0||i.y<0||i.x>u.width||i.y>u.height;u.locationPoint(a).distSqr(i)<v&&(C||Math.abs(a.lng-u.center.lng)<p)?m=a:u.locationPoint(f).distSqr(i)<v&&(C||Math.abs(f.lng-u.center.lng)<p)&&(m=f)}for(;Math.abs(m.lng-u.center.lng)>180;){const a=u.locationPoint(m);if(a.x>=0&&a.y>=0&&a.x<=u.width&&a.y<=u.height)break;m.lng>u.center.lng?m.lng-=360:m.lng+=360}return m}const Ol={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class wc extends l.Evented{constructor(i,u){if(super(),(i instanceof l.window.HTMLElement||u)&&(i=l.extend({element:i},u)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=l.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Me("div");const f=41,p=27,v=Ve("svg",{display:"block",height:f*this._scale+"px",width:p*this._scale+"px",viewBox:`0 0 ${p} ${f}`},this._element),C=Ve("radialGradient",{id:"shadowGradient"},Ve("defs",{},v));Ve("stop",{offset:"10%","stop-opacity":.4},C),Ve("stop",{offset:"100%","stop-opacity":.05},C),Ve("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},v),Ve("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},v),Ve("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},v),Ve("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},v),this._offset=l.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()});const a=this._element.classList;for(const f in Ol)a.remove(`mapboxgl-marker-anchor-${f}`);a.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=l.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const f=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(24.6+f)],"bottom-right":[-f,-1*(24.6+f)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const u=i.code,a=i.charCode||i.keyCode;"Space"!==u&&"Enter"!==u&&32!==a&&13!==a||this.togglePopup()}_onMapClick(i){const u=i.originalEvent.target,a=this._element;this._popup&&(u===a||a.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,u=this._pos;if(!i||!u)return!1;const a=i.unproject(u),f=i.getFreeCameraOptions();if(!f.position)return!1;const p=f.position.toLngLat();return p.distanceTo(a)<.9*p.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const u=this._pos;if(!u||u.x<0||u.x>i.transform.width||u.y<0||u.y>i.transform.height)return void this._clearFadeTimer();const a=i.unproject(u);let f;i._showingGlobe()&&l.isLngLatBehindGlobe(i.transform,this._lngLat)?f=0:(f=1-i._queryFogOpacity(a),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(f*=this._occludedOpacity)),this._element.style.opacity=`${f}`,this._element.style.pointerEvents=f>0?"auto":"none",this._popup&&this._popup._setOpacity(f),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${i.x}px,${i.y}px)\n            ${Ol[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${u.x}px,${u.y}px)\n        `}_calculateXYTransform(){const i=this._pos,u=this._map,a=this.getPitchAlignment();if(!u||!i||"map"!==a)return"";if(!u._showingGlobe()){const D=u.getPitch();return D?`rotateX(${D}deg)`:""}const f=l.radToDeg(l.globeTiltAtLngLat(u.transform,this._lngLat)),p=i.sub(l.globeCenterToScreenPoint(u.transform)),v=Math.abs(p.x)+Math.abs(p.y);if(0===v)return"";const C=f/v;return`rotateX(${-p.y*C}deg) rotateY(${p.x*C}deg)`}_calculateZTransform(){const i=this._pos,u=this._map;if(!u||!i)return"";let a=0;const f=this.getRotationAlignment();if("map"===f)if(u._showingGlobe()){const p=u.project(new l.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),v=u.project(new l.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(p);a=l.radToDeg(Math.atan2(v.y,v.x))-90}else a=-u.getBearing();else if("horizon"===f){const p=l.smoothstep(4,6,u.getZoom()),v=l.globeCenterToScreenPoint(u.transform);v.y+=p*u.transform.height;const C=i.sub(v),D=l.radToDeg(Math.atan2(C.y,C.x));a=(D>90?D-270:D+90)*(1-p)}return a+=this._rotation,a?`rotateZ(${a}deg)`:""}_update(i){l.window.cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Pu(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),!0===i?this._updateFrameId=l.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=l.pointGeometry.convert(i),this._update(),this}_onMove(i){const u=this._map;if(!u)return;const a=this._pointerdownPos,f=this._positionDelta;if(a&&f){if(!this._isDragging){const p=this._clickTolerance||u._clickTolerance;if(i.point.dist(a)<p)return;this._isDragging=!0}this._pos=i.point.sub(f),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(i){const u=this._map,a=this._pos;u&&a&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(a),this._pointerdownPos=i.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const u=this._map;return u&&(i?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ou={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Kd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function na(m=new l.pointGeometry(0,0),i="bottom"){if("number"==typeof m){const u=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(i){case"top":return new l.pointGeometry(0,m);case"top-left":return new l.pointGeometry(u,u);case"top-right":return new l.pointGeometry(-u,u);case"bottom":return new l.pointGeometry(0,-m);case"bottom-left":return new l.pointGeometry(u,-u);case"bottom-right":return new l.pointGeometry(-u,-u);case"left":return new l.pointGeometry(m,0);case"right":return new l.pointGeometry(-m,0)}return new l.pointGeometry(0,0)}return m instanceof l.pointGeometry||Array.isArray(m)?l.pointGeometry.convert(m):l.pointGeometry.convert(m[i]||[0,0])}class Qd{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const u=l.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,u,a){this._start=this.getValue(u),this._end=i,this._startTime=u,this._endTime=u+a}}const Ru={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},xo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Cc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Rl{constructor(i,u,a=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new vl({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,a&&(this.mousePitch=new Jl({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(i,u){this.mouseRotate.mousedown(i,u),this.mousePitch&&this.mousePitch.mousedown(i,u),ze()}move(i,u){const a=this.map,f=this.mouseRotate.mousemoveWindow(i,u),p=f&&f.bearingDelta;if(p&&a.setBearing(a.getBearing()+p),this.mousePitch){const v=this.mousePitch.mousemoveWindow(i,u),C=v&&v.pitchDelta;C&&a.setPitch(a.getPitch()+C)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){le(),l.window.removeEventListener("mousemove",this.mousemove),l.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(l.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Q(this.element,i)),l.window.addEventListener("mousemove",this.mousemove),l.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Q(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){1!==i.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ye(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){1!==i.targetTouches.length?this.reset():(this._lastPos=Ye(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){0===i.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Zc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ms={maxWidth:100,unit:"metric"};function Ka(m,i,u){const a=Tc(i),f=a/i,p={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[u];this._map._requestDomTask(()=>{this._container.style.width=m*f+"px",this._container.innerHTML=`${a}&nbsp;${p}`})}function Tc(m){const i=Math.pow(10,`${Math.floor(m)}`.length-1);let u=m/i;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:u>=1?1:function(a){const f=Math.pow(10,Math.ceil(-Math.log(a)/Math.LN10));return Math.round(a*f)/f}(u),i*u}const Qa={version:l.version,supported:re,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends $c{constructor(m){if(l.LivePerformanceUtils.mark(l.PerformanceMarkers.create),null!=(m=l.extend({},xo,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&l.isSafariWithAntialiasingBug(l.window)&&(m.antialias=!1,l.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new sr(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Au,this._domRenderTaskQueue=new Au,this._controls=[],this._markers=[],this._popups=[],this._mapId=l.uniqueId(),this._locale=l.extend({},Ru,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Qd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new l.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,"string"==typeof m.container){if(this._container=l.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof l.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&l.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==l.window&&(l.window.addEventListener("online",this._onWindowOnline,!1),l.window.addEventListener("resize",this._onWindowResize,!1),l.window.addEventListener("orientationchange",this._onWindowResize,!1),l.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Ba(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new $n("string"==typeof m.hash&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,l.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new Ar({customAttribution:m.customAttribution})),this._logoControl=new Su,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update("style"===i.dataType),this.fire(new l.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new l.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(m,i){if(void 0===i&&(i=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=m.onAdd(this);this._controls.push(m);const a=this._controlPositions[i];return-1!==i.indexOf("bottom")?a.insertBefore(u,a.firstChild):a.appendChild(u),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(m);return i>-1&&this._controls.splice(i,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new l.Event("movestart",m)).fire(new l.Event("move",m)),this.fire(new l.Event("resize",m)),i&&this.fire(new l.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(l.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return"auto"===m?l.window.navigator.language:Array.isArray(m)?0===m.length?void 0:m.map(i=>"auto"===i?l.window.navigator.language:i):m}setLanguage(m){const i=this._parseLanguage(m);if(!this.style||i===this._language)return this;this._language=i,this.style._reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(m){return this._lazyInitEmptyStyle(),m?"string"==typeof m&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const m=this.transform,i=m.projection.name;let u;"globe"===i&&m.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX?(m.setMercatorFromTransition(),u=!0):"mercator"===i&&m.zoom<l.GLOBE_ZOOM_THRESHOLD_MAX&&(m.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,i){return this._updateProjection(m||i||{name:"mercator"})}_updateProjection(m){let i;if(i="globe"===m.name&&this.transform.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),i){this.painter.clearBackgroundTiles();for(const u in this.style._sourceCaches)this.style._sourceCaches[u].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(m){return this.transform.locationPoint3D(l.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(l.pointGeometry.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,i,u){if("mouseenter"===m||"mouseover"===m){let a=!1;const f=v=>{const C=i.filter(P=>this.getLayer(P)),D=C.length?this.queryRenderedFeatures(v.point,{layers:C}):[];D.length?a||(a=!0,u.call(this,new lo(m,this,v.originalEvent,{features:D}))):a=!1},p=()=>{a=!1};return{layers:new Set(i),listener:u,delegates:{mousemove:f,mouseout:p}}}if("mouseleave"===m||"mouseout"===m){let a=!1;const f=v=>{const C=i.filter(D=>this.getLayer(D));(C.length?this.queryRenderedFeatures(v.point,{layers:C}):[]).length?a=!0:a&&(a=!1,u.call(this,new lo(m,this,v.originalEvent)))},p=v=>{a&&(a=!1,u.call(this,new lo(m,this,v.originalEvent)))};return{layers:new Set(i),listener:u,delegates:{mousemove:f,mouseout:p}}}{const a=f=>{const p=i.filter(C=>this.getLayer(C)),v=p.length?this.queryRenderedFeatures(f.point,{layers:p}):[];v.length&&(f.features=v,u.call(this,f),delete f.features)};return{layers:new Set(i),listener:u,delegates:{[m]:a}}}}on(m,i,u){if(void 0===u)return super.on(m,i);Array.isArray(i)||(i=[i]);const a=this._createDelegatedListener(m,i,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(a);for(const f in a.delegates)this.on(f,a.delegates[f]);return this}once(m,i,u){if(void 0===u)return super.once(m,i);Array.isArray(i)||(i=[i]);const a=this._createDelegatedListener(m,i,u);for(const f in a.delegates)this.once(f,a.delegates[f]);return this}off(m,i,u){if(void 0===u)return super.off(m,i);i=new Set(Array.isArray(i)?i:[i]);const a=(p,v)=>{if(p.size!==v.size)return!1;for(const C of p)if(!v.has(C))return!1;return!0},f=this._delegatedListeners?this._delegatedListeners[m]:void 0;return f&&(p=>{for(let v=0;v<p.length;v++){const C=p[v];if(C.listener===u&&a(C.layers,i)){for(const D in C.delegates)this.off(D,C.delegates[D]);return p.splice(v,1),this}}})(f),this}queryRenderedFeatures(m,i){return this.style?(void 0!==i||void 0===m||m instanceof l.pointGeometry||Array.isArray(m)||(i=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(m,i){return this.style.querySourceFeatures(m,i)}setStyle(m,i){return!1!==(i=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(m,i))}_getUIString(m){const i=this._locale[m];if(null==i)throw new Error(`Missing UI string '${m}'`);return i}_updateStyle(m,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new so(this,i||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof m?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new so(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,i){if("string"==typeof m){const u=this._requestManager.normalizeStyleURL(m),a=this._requestManager.transformRequest(u,l.ResourceType.Style);l.getJSON(a,(f,p)=>{f?this.fire(new l.ErrorEvent(f)):p&&this._updateDiff(p,i)})}else"object"==typeof m&&this._updateDiff(m,i)}_updateDiff(m,i){try{this.style.setState(m)&&this._update(!0)}catch(u){l.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(m,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(l.warnOnce("There is no style added to the map."),!1)}addSource(m,i){return this._lazyInitEmptyStyle(),this.style.addSource(m,i),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const i in m){const u=m[i]._tiles;for(const a in u){const f=u[a];if("loaded"!==f.state&&"errored"!==f.state)return!1}}return!0}addSourceType(m,i,u){this._lazyInitEmptyStyle(),this.style.addSourceType(m,i,u)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,i,{pixelRatio:u=1,sdf:a=!1,stretchX:f,stretchY:p,content:v}={}){if(this._lazyInitEmptyStyle(),i instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&i instanceof l.window.ImageBitmap){const{width:C,height:D,data:P}=l.exported.getImageData(i);this.style.addImage(m,{data:new l.RGBAImage({width:C,height:D},P),pixelRatio:u,stretchX:f,stretchY:p,content:v,sdf:a,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:D}=i,P=i;this.style.addImage(m,{data:new l.RGBAImage({width:C,height:D},new Uint8Array(P.data)),pixelRatio:u,stretchX:f,stretchY:p,content:v,sdf:a,version:0,userImage:P}),P.onAdd&&P.onAdd(this,m)}}updateImage(m,i){const u=this.style.getImage(m);if(!u)return void this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=i instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&i instanceof l.window.ImageBitmap?l.exported.getImageData(i):i,{width:f,height:p}=a;void 0!==f&&void 0!==p?f===u.data.width&&p===u.data.height?(u.data.replace(a.data,!(i instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&i instanceof l.window.ImageBitmap)),this.style.updateImage(m,u)):this.fire(new l.ErrorEvent(new Error(`The width and height of the updated image (${f}, ${p})\n                must be that same as the previous version of the image\n                (${u.data.width}, ${u.data.height})`))):this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,i){l.getImage(this._requestManager.transformRequest(m,l.ResourceType.Image),(u,a)=>{i(u,a instanceof l.window.HTMLImageElement?l.exported.getImageData(a):a)})}listImages(){return this.style.listImages()}addLayer(m,i){return this._lazyInitEmptyStyle(),this.style.addLayer(m,i),this._update(!0)}moveLayer(m,i){return this.style.moveLayer(m,i),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,i,u){return this.style.setLayerZoomRange(m,i,u),this._update(!0)}setFilter(m,i,u={}){return this.style.setFilter(m,i,u),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,i,u,a={}){return this.style.setPaintProperty(m,i,u,a),this._update(!0)}getPaintProperty(m,i){return this.style.getPaintProperty(m,i)}setLayoutProperty(m,i,u,a={}){return this.style.setLayoutProperty(m,i,u,a),this._update(!0)}getLayoutProperty(m,i){return this.style.getLayoutProperty(m,i)}setLight(m,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(l.LngLat.convert(m),this.transform):0}setFeatureState(m,i){return this.style.setFeatureState(m,i),this._update()}removeFeatureState(m,i){return this.style.removeFeatureState(m,i),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let u,a,f,p=this._container;for(;p&&(!a||!f);){const v=l.window.getComputedStyle(p).transform;v&&"none"!==v&&(u=v.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&"0"!==u[0]&&"1"!==u[0]&&(a=u[0]),u[3]&&"0"!==u[3]&&"1"!==u[3]&&(f=u[3])),p=p.parentElement}this._containerWidth=a?Math.abs(m/a):m,this._containerHeight=f?Math.abs(i/f):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==l.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&l.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=Me("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=Me("div","mapboxgl-canvas-container",m);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=Me("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=Me("div","mapboxgl-control-container",m),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(f=>{a[f]=Me("div",`mapboxgl-ctrl-${f}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,i){const u=l.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(m),this._canvas.height=u*Math.ceil(i),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${i}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const i=this._markers.indexOf(m);-1!==i&&this._markers.splice(i,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const i=this._popups.indexOf(m);-1!==i&&this._popups.splice(i,1)}_setupPainter(){const m=l.extend({},re.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);i?(l.storeAuthState(i,!0),this.painter=new U(i,this.transform),this.on("data",u=>{"source"===u.dataType&&this.painter.setTileLoadedFlag(!0)}),l.exported$1.testSupport(i)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let i;const u=this.painter.context.extTimerQuery,a=l.exported.now();if(this.listens("gpu-timing-frame")&&(i=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],l.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],l.window.performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const f=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,D=this.transform.pitch,P=l.exported.now(),F=new l.EvaluationParameters(C,{now:P,fadeDuration:f,pitch:D,transition:this.style.getTransition()});this.style.update(F)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let p=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),p=this._updateAverageElevation(a),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):p=this._updateAverageElevation(a),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,f,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:f,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new l.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const C=l.exported.now()-a;u.endQueryEXT(u.TIME_ELAPSED_EXT,i),setTimeout(()=>{const D=u.getQueryObjectEXT(i,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(i),this.fire(new l.Event("gpu-timing-frame",{cpuTime:C,gpuTime:D})),l.window.performance.mark("frame-gpu",{startTime:a,detail:{gpuTime:D}})},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(C);this.fire(new l.Event("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(C);this.fire(new l.Event("gpu-timing-deferred-render",{gpuTime:D}))},50)}const v=this._sourcesDirty||this._styleDirty||this._placementDirty||p;if(v||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(p=this._updateAverageElevation(a,!0)),p)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new l.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new l.Event("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||v||(this._fullyLoaded=!0,l.LivePerformanceUtils.mark(l.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&l.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const i of this._markers)m&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!m||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(m,i=!1){const u=a=>(this.transform.averageElevation=a,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&u(0);if((i||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const a=this.transform.averageElevation;let f=this.transform.sampleAverageElevation(),p=!1;this.transform.elevation&&(p=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(f)?f=0:this._averageElevationLastSampledAt=m;const v=Math.abs(a-f);if(v>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(f),u(f);this._averageElevation.easeTo(f,m,300)}else if(v>1e-4)return this._averageElevation.jumpTo(f),u(f)}return!!this._averageElevation.isEasing(m)&&u(this._averageElevation.getValue(m))}_authenticate(){l.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===l.AUTH_ERR_MSG||401===m.status)){const i=this.painter.context.gl;l.storeAuthState(i,!1),this._logoControl instanceof Su&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new l.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),l.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const u=this.painter.context.gl,a=u.createFramebuffer();function f(p){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,p,0);const v=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,v),v}return u.bindFramebuffer(u.FRAMEBUFFER,a),this._canvasPixelComparison(f(m),i.canvasCopies.map(f),i.timeStamps)}_canvasPixelComparison(m,i,u){let a=u[1]-u[0];const f=m.length/4;for(let p=0;p<i.length;p++){const v=i[p];let C=0;for(let D=0;D<v.length;D+=4)v[D]===m[D]&&v[D+1]===m[D+1]&&v[D+2]===m[D+2]&&v[D+3]===m[D+3]&&(C+=1);a+=(u[p+2]-u[p+1])*(1-C/f)}return a}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==l.window&&(l.window.removeEventListener("resize",this._onWindowResize,!1),l.window.removeEventListener("orientationchange",this._onWindowResize,!1),l.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.removeEventListener("online",this._onWindowOnline,!1),l.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),l.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=l.exported.frame(i=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(i)}))}_preloadTiles(m){const i=this.style?Object.values(this.style._sourceCaches):[];return l.asyncAll(i,(u,a)=>u._preloadTiles(m,a),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){"hidden"===l.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,i){l.setCacheLimits(m,i)}get version(){return l.version}},NavigationControl:class{constructor(m){this.options=l.extend({},Cc,m),this._container=Me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),Me("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),Me("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:i}):u.resetNorth({},{originalEvent:i}))}),this._compassIcon=Me("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const i=m.getZoom(),u=i===m.getMaxZoom(),a=i===m.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Rl(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,i){const u=Me("button",m,this._container);return u.type="button",u.addEventListener("click",i),u}_setButtonTitle(m,i){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${i}`);m.setAttribute("aria-label",u),m.firstElementChild&&m.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends l.Evented{constructor(m){super(),this.options=l.extend({geolocation:l.window.navigator.geolocation},Zc,m),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=io(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=Me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const i=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,m(u)};void 0!==this._supportsGeolocation?m(this._supportsGeolocation):void 0!==l.window.navigator.permissions?l.window.navigator.permissions.query({name:"geolocation"}).then(u=>i("denied"!==u.state)).catch(()=>i()):i()}_isOutOfMapMaxBounds(m){const i=this._map.getMaxBounds(),u=m.coords;return!!i&&(u.longitude<i.getWest()||u.longitude>i.getEast()||u.latitude<i.getSouth()||u.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",m)),this._finish()}}_updateCamera(m){const i=new l.LngLat(m.coords.longitude,m.coords.latitude),u=m.coords.accuracy,a=this._map.getBearing(),f=l.extend({bearing:a},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(u),f,{geolocateSource:!0})}_updateMarker(m){if(m){const i=new l.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,i=l.mercatorZfromAltitude(1,m._center.lat)*m.worldSize,u=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=Me("button","mapboxgl-ctrl-geolocate",this._container),Me("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===m){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Me("div","mapboxgl-user-location"),this._dotElement.appendChild(Me("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Me("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new wc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Me("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new wc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||"ACTIVE_LOCK"!==this._watchState||i.originalEvent&&"resize"===i.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:!0===m.absolute&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{l.window.addEventListener("ondeviceorientationabsolute"in l.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==l.window.DeviceMotionEvent&&"function"==typeof l.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(i=>{"granted"===i&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),l.window.removeEventListener("deviceorientation",this._onDeviceOrientation),l.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ar,ScaleControl:class{constructor(m){this.options=l.extend({},Ms,m),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Ka.bind(this)),l.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,i=this._map,u=i._containerHeight/2,a=i._containerWidth/2-m/2,f=i.unproject([a,u]),p=i.unproject([a+m,u]),v=f.distanceTo(p);if("imperial"===this.options.unit){const C=3.2808*v;C>5280?this._setScale(m,C/5280,"mile"):this._setScale(m,C,"foot")}else"nautical"===this.options.unit?this._setScale(m,v/1852,"nautical-mile"):v>=1e3?this._setScale(m,v/1e3,"kilometer"):this._setScale(m,v,"meter")}_setScale(m,i,u){const a=Tc(i),f=a/i;this._map._requestDomTask(()=>{this._container.style.width=m*f+"px",this._container.innerHTML="nautical-mile"!==u?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:u}).format(a):`${a}&nbsp;nm`})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=Me("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof l.window.HTMLElement?this._container=m.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in l.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in l.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,l.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!l.window.document.fullscreenEnabled&&!l.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=Me("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Me("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),l.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(l.window.document.fullscreenElement||l.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?l.window.document.exitFullscreen?l.window.document.exitFullscreen():l.window.document.webkitCancelFullScreen&&l.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends l.Evented{constructor(m){super(),this.options=l.extend(Object.create(Ou),m),l.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=l.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(l.window.document.createTextNode(m))}setHTML(m){const i=l.window.document.createDocumentFragment(),u=l.window.document.createElement("body");let a;for(u.innerHTML=m;a=u.firstChild,a;)i.appendChild(a);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=Me("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(m),this.options.closeButton){const u=this._closeButton=Me("button","mapboxgl-popup-close-button",i);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let i;return this._classList.delete(m)?i=!1:(this._classList.add(m),i=!0),this._updateClassList(),i}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const i=this._map,u=this._container,a=this._pos;if(!i||!u||!a)return"bottom";const f=u.offsetWidth,p=u.offsetHeight,v=a.x<f/2,C=a.x>i.transform.width-f/2;if(a.y+m<p)return v?"top-left":C?"top-right":"top";if(a.y>i.transform.height-p){if(v)return"bottom-left";if(C)return"bottom-right"}return v?"left":C?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),m.className=i.join(" ")}_update(m){const i=this._map,u=this._content;if(!i||!this._lngLat&&!this._trackPointer||!u)return;let a=this._container;if(a||(a=this._container=Me("div","mapboxgl-popup",i.getContainer()),this._tip=Me("div","mapboxgl-popup-tip",a),a.appendChild(u)),this.options.maxWidth&&a.style.maxWidth!==this.options.maxWidth&&(a.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Pu(this._lngLat,this._pos,i.transform)),!this._trackPointer||m){const f=this._pos=this._trackPointer&&m?m:i.project(this._lngLat),p=na(this.options.offset),v=this._anchor=this._getAnchor(p.y),C=na(this.options.offset,v),D=f.add(C).round();i._requestDomTask(()=>{this._container&&v&&(this._container.style.transform=`${Ol[v]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&i._showingGlobe()){const f=l.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(f)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Kd);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:wc,Style:so,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,FreeCameraOptions:un,Evented:l.Evented,config:l.config,prewarm:function(){Wn().acquire(on)},clearPrewarmedResources:function(){const m=Nn;m&&(m.isPreloaded()&&1===m.numActive()?(m.release(on),Nn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return l.config.ACCESS_TOKEN},set accessToken(m){l.config.ACCESS_TOKEN=m},get baseApiUrl(){return l.config.API_URL},set baseApiUrl(m){l.config.API_URL=m},get workerCount(){return Dn.workerCount},set workerCount(m){Dn.workerCount=m},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){l.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){l.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:l.exported.setNow,restoreNow:l.exported.restoreNow};return Qa}),d}()},1135:(Pn,Et,k)=>{"use strict";k.d(Et,{X:()=>y});var d=k(7579);class y extends d.x{constructor(l){super(),this._value=l}get value(){return this.getValue()}_subscribe(l){const q=super._subscribe(l);return!q.closed&&l.next(this._value),q}getValue(){const{hasError:l,thrownError:q,_value:re}=this;if(l)throw q;return this._throwIfClosed(),re}next(l){super.next(this._value=l)}}},9751:(Pn,Et,k)=>{"use strict";k.d(Et,{y:()=>he});var d=k(2961),y=k(727),te=k(8822),l=k(9635),q=k(2416),re=k(576),b=k(2806);let he=(()=>{class xe{constructor(ze){ze&&(this._subscribe=ze)}lift(ze){const le=new xe;return le.source=this,le.operator=ze,le}subscribe(ze,le,Ke){const Oe=function X(xe){return xe&&xe instanceof d.Lv||function Ve(xe){return xe&&(0,re.m)(xe.next)&&(0,re.m)(xe.error)&&(0,re.m)(xe.complete)}(xe)&&(0,y.Nn)(xe)}(ze)?ze:new d.Hp(ze,le,Ke);return(0,b.x)(()=>{const{operator:Q,source:Ye}=this;Oe.add(Q?Q.call(Oe,Ye):Ye?this._subscribe(Oe):this._trySubscribe(Oe))}),Oe}_trySubscribe(ze){try{return this._subscribe(ze)}catch(le){ze.error(le)}}forEach(ze,le){return new(le=Me(le))((Ke,Oe)=>{const Q=new d.Hp({next:Ye=>{try{ze(Ye)}catch(St){Oe(St),Q.unsubscribe()}},error:Oe,complete:Ke});this.subscribe(Q)})}_subscribe(ze){var le;return null===(le=this.source)||void 0===le?void 0:le.subscribe(ze)}[te.L](){return this}pipe(...ze){return(0,l.U)(ze)(this)}toPromise(ze){return new(ze=Me(ze))((le,Ke)=>{let Oe;this.subscribe(Q=>Oe=Q,Q=>Ke(Q),()=>le(Oe))})}}return xe.create=fe=>new xe(fe),xe})();function Me(xe){var fe;return null!==(fe=xe??q.v.Promise)&&void 0!==fe?fe:Promise}},7579:(Pn,Et,k)=>{"use strict";k.d(Et,{x:()=>b});var d=k(9751),y=k(727);const l=(0,k(3888).d)(Me=>function(){Me(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var q=k(8737),re=k(2806);let b=(()=>{class Me extends d.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(X){const xe=new he(this,this);return xe.operator=X,xe}_throwIfClosed(){if(this.closed)throw new l}next(X){(0,re.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const xe of this.currentObservers)xe.next(X)}})}error(X){(0,re.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=X;const{observers:xe}=this;for(;xe.length;)xe.shift().error(X)}})}complete(){(0,re.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:X}=this;for(;X.length;)X.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var X;return(null===(X=this.observers)||void 0===X?void 0:X.length)>0}_trySubscribe(X){return this._throwIfClosed(),super._trySubscribe(X)}_subscribe(X){return this._throwIfClosed(),this._checkFinalizedStatuses(X),this._innerSubscribe(X)}_innerSubscribe(X){const{hasError:xe,isStopped:fe,observers:ze}=this;return xe||fe?y.Lc:(this.currentObservers=null,ze.push(X),new y.w0(()=>{this.currentObservers=null,(0,q.P)(ze,X)}))}_checkFinalizedStatuses(X){const{hasError:xe,thrownError:fe,isStopped:ze}=this;xe?X.error(fe):ze&&X.complete()}asObservable(){const X=new d.y;return X.source=this,X}}return Me.create=(Ve,X)=>new he(Ve,X),Me})();class he extends b{constructor(Ve,X){super(),this.destination=Ve,this.source=X}next(Ve){var X,xe;null===(xe=null===(X=this.destination)||void 0===X?void 0:X.next)||void 0===xe||xe.call(X,Ve)}error(Ve){var X,xe;null===(xe=null===(X=this.destination)||void 0===X?void 0:X.error)||void 0===xe||xe.call(X,Ve)}complete(){var Ve,X;null===(X=null===(Ve=this.destination)||void 0===Ve?void 0:Ve.complete)||void 0===X||X.call(Ve)}_subscribe(Ve){var X,xe;return null!==(xe=null===(X=this.source)||void 0===X?void 0:X.subscribe(Ve))&&void 0!==xe?xe:y.Lc}}},2961:(Pn,Et,k)=>{"use strict";k.d(Et,{Hp:()=>Ke,Lv:()=>xe});var d=k(576),y=k(727),te=k(2416),l=k(7849);function q(){}const re=Me("C",void 0,void 0);function Me(lt,_e,ke){return{kind:lt,value:_e,error:ke}}var Ve=k(3410),X=k(2806);class xe extends y.w0{constructor(_e){super(),this.isStopped=!1,_e?(this.destination=_e,(0,y.Nn)(_e)&&_e.add(this)):this.destination=St}static create(_e,ke,Ne){return new Ke(_e,ke,Ne)}next(_e){this.isStopped?Ye(function he(lt){return Me("N",lt,void 0)}(_e),this):this._next(_e)}error(_e){this.isStopped?Ye(function b(lt){return Me("E",void 0,lt)}(_e),this):(this.isStopped=!0,this._error(_e))}complete(){this.isStopped?Ye(re,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(_e){this.destination.next(_e)}_error(_e){try{this.destination.error(_e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const fe=Function.prototype.bind;function ze(lt,_e){return fe.call(lt,_e)}class le{constructor(_e){this.partialObserver=_e}next(_e){const{partialObserver:ke}=this;if(ke.next)try{ke.next(_e)}catch(Ne){Oe(Ne)}}error(_e){const{partialObserver:ke}=this;if(ke.error)try{ke.error(_e)}catch(Ne){Oe(Ne)}else Oe(_e)}complete(){const{partialObserver:_e}=this;if(_e.complete)try{_e.complete()}catch(ke){Oe(ke)}}}class Ke extends xe{constructor(_e,ke,Ne){let we;if(super(),(0,d.m)(_e)||!_e)we={next:_e??void 0,error:ke??void 0,complete:Ne??void 0};else{let Xe;this&&te.v.useDeprecatedNextContext?(Xe=Object.create(_e),Xe.unsubscribe=()=>this.unsubscribe(),we={next:_e.next&&ze(_e.next,Xe),error:_e.error&&ze(_e.error,Xe),complete:_e.complete&&ze(_e.complete,Xe)}):we=_e}this.destination=new le(we)}}function Oe(lt){te.v.useDeprecatedSynchronousErrorHandling?(0,X.O)(lt):(0,l.h)(lt)}function Ye(lt,_e){const{onStoppedNotification:ke}=te.v;ke&&Ve.z.setTimeout(()=>ke(lt,_e))}const St={closed:!0,next:q,error:function Q(lt){throw lt},complete:q}},727:(Pn,Et,k)=>{"use strict";k.d(Et,{Lc:()=>re,w0:()=>q,Nn:()=>b});var d=k(576);const te=(0,k(3888).d)(Me=>function(X){Me(this),this.message=X?`${X.length} errors occurred during unsubscription:\n${X.map((xe,fe)=>`${fe+1}) ${xe.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=X});var l=k(8737);class q{constructor(Ve){this.initialTeardown=Ve,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let Ve;if(!this.closed){this.closed=!0;const{_parentage:X}=this;if(X)if(this._parentage=null,Array.isArray(X))for(const ze of X)ze.remove(this);else X.remove(this);const{initialTeardown:xe}=this;if((0,d.m)(xe))try{xe()}catch(ze){Ve=ze instanceof te?ze.errors:[ze]}const{_finalizers:fe}=this;if(fe){this._finalizers=null;for(const ze of fe)try{he(ze)}catch(le){Ve=Ve??[],le instanceof te?Ve=[...Ve,...le.errors]:Ve.push(le)}}if(Ve)throw new te(Ve)}}add(Ve){var X;if(Ve&&Ve!==this)if(this.closed)he(Ve);else{if(Ve instanceof q){if(Ve.closed||Ve._hasParent(this))return;Ve._addParent(this)}(this._finalizers=null!==(X=this._finalizers)&&void 0!==X?X:[]).push(Ve)}}_hasParent(Ve){const{_parentage:X}=this;return X===Ve||Array.isArray(X)&&X.includes(Ve)}_addParent(Ve){const{_parentage:X}=this;this._parentage=Array.isArray(X)?(X.push(Ve),X):X?[X,Ve]:Ve}_removeParent(Ve){const{_parentage:X}=this;X===Ve?this._parentage=null:Array.isArray(X)&&(0,l.P)(X,Ve)}remove(Ve){const{_finalizers:X}=this;X&&(0,l.P)(X,Ve),Ve instanceof q&&Ve._removeParent(this)}}q.EMPTY=(()=>{const Me=new q;return Me.closed=!0,Me})();const re=q.EMPTY;function b(Me){return Me instanceof q||Me&&"closed"in Me&&(0,d.m)(Me.remove)&&(0,d.m)(Me.add)&&(0,d.m)(Me.unsubscribe)}function he(Me){(0,d.m)(Me)?Me():Me.unsubscribe()}},2416:(Pn,Et,k)=>{"use strict";k.d(Et,{v:()=>d});const d={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},7272:(Pn,Et,k)=>{"use strict";k.d(Et,{z:()=>q});var d=k(8189),te=k(7669),l=k(2076);function q(...re){return function y(){return(0,d.J)(1)}()((0,l.D)(re,(0,te.yG)(re)))}},9770:(Pn,Et,k)=>{"use strict";k.d(Et,{P:()=>te});var d=k(9751),y=k(8421);function te(l){return new d.y(q=>{(0,y.Xf)(l()).subscribe(q)})}},515:(Pn,Et,k)=>{"use strict";k.d(Et,{E:()=>y});const y=new(k(9751).y)(q=>q.complete())},4128:(Pn,Et,k)=>{"use strict";k.d(Et,{D:()=>he});var d=k(9751),y=k(4742),te=k(8421),l=k(7669),q=k(5403),re=k(3268),b=k(1810);function he(...Me){const Ve=(0,l.jO)(Me),{args:X,keys:xe}=(0,y.D)(Me),fe=new d.y(ze=>{const{length:le}=X;if(!le)return void ze.complete();const Ke=new Array(le);let Oe=le,Q=le;for(let Ye=0;Ye<le;Ye++){let St=!1;(0,te.Xf)(X[Ye]).subscribe((0,q.x)(ze,lt=>{St||(St=!0,Q--),Ke[Ye]=lt},()=>Oe--,void 0,()=>{(!Oe||!St)&&(Q||ze.next(xe?(0,b.n)(xe,Ke):Ke),ze.complete())}))}});return Ve?fe.pipe((0,re.Z)(Ve)):fe}},2076:(Pn,Et,k)=>{"use strict";k.d(Et,{D:()=>Ne});var d=k(8421),y=k(9672),te=k(4482),l=k(5403);function q(we,Xe=0){return(0,te.e)((We,ge)=>{We.subscribe((0,l.x)(ge,de=>(0,y.f)(ge,we,()=>ge.next(de),Xe),()=>(0,y.f)(ge,we,()=>ge.complete(),Xe),de=>(0,y.f)(ge,we,()=>ge.error(de),Xe)))})}function re(we,Xe=0){return(0,te.e)((We,ge)=>{ge.add(we.schedule(()=>We.subscribe(ge),Xe))})}var Me=k(9751),X=k(2202),xe=k(576);function ze(we,Xe){if(!we)throw new Error("Iterable cannot be null");return new Me.y(We=>{(0,y.f)(We,Xe,()=>{const ge=we[Symbol.asyncIterator]();(0,y.f)(We,Xe,()=>{ge.next().then(de=>{de.done?We.complete():We.next(de.value)})},0,!0)})})}var le=k(3670),Ke=k(8239),Oe=k(1144),Q=k(6495),Ye=k(2206),St=k(4532),lt=k(3260);function Ne(we,Xe){return Xe?function ke(we,Xe){if(null!=we){if((0,le.c)(we))return function b(we,Xe){return(0,d.Xf)(we).pipe(re(Xe),q(Xe))}(we,Xe);if((0,Oe.z)(we))return function Ve(we,Xe){return new Me.y(We=>{let ge=0;return Xe.schedule(function(){ge===we.length?We.complete():(We.next(we[ge++]),We.closed||this.schedule())})})}(we,Xe);if((0,Ke.t)(we))return function he(we,Xe){return(0,d.Xf)(we).pipe(re(Xe),q(Xe))}(we,Xe);if((0,Ye.D)(we))return ze(we,Xe);if((0,Q.T)(we))return function fe(we,Xe){return new Me.y(We=>{let ge;return(0,y.f)(We,Xe,()=>{ge=we[X.h](),(0,y.f)(We,Xe,()=>{let de,oe;try{({value:de,done:oe}=ge.next())}catch(Ee){return void We.error(Ee)}oe?We.complete():We.next(de)},0,!0)}),()=>(0,xe.m)(ge?.return)&&ge.return()})}(we,Xe);if((0,lt.L)(we))return function _e(we,Xe){return ze((0,lt.Q)(we),Xe)}(we,Xe)}throw(0,St.z)(we)}(we,Xe):(0,d.Xf)(we)}},4968:(Pn,Et,k)=>{"use strict";k.d(Et,{R:()=>Ve});var d=k(8421),y=k(9751),te=k(5577),l=k(1144),q=k(576),re=k(3268);const b=["addListener","removeListener"],he=["addEventListener","removeEventListener"],Me=["on","off"];function Ve(le,Ke,Oe,Q){if((0,q.m)(Oe)&&(Q=Oe,Oe=void 0),Q)return Ve(le,Ke,Oe).pipe((0,re.Z)(Q));const[Ye,St]=function ze(le){return(0,q.m)(le.addEventListener)&&(0,q.m)(le.removeEventListener)}(le)?he.map(lt=>_e=>le[lt](Ke,_e,Oe)):function xe(le){return(0,q.m)(le.addListener)&&(0,q.m)(le.removeListener)}(le)?b.map(X(le,Ke)):function fe(le){return(0,q.m)(le.on)&&(0,q.m)(le.off)}(le)?Me.map(X(le,Ke)):[];if(!Ye&&(0,l.z)(le))return(0,te.z)(lt=>Ve(lt,Ke,Oe))((0,d.Xf)(le));if(!Ye)throw new TypeError("Invalid event target");return new y.y(lt=>{const _e=(...ke)=>lt.next(1<ke.length?ke:ke[0]);return Ye(_e),()=>St(_e)})}function X(le,Ke){return Oe=>Q=>le[Oe](Ke,Q)}},8421:(Pn,Et,k)=>{"use strict";k.d(Et,{Xf:()=>fe});var d=k(5987),y=k(1144),te=k(8239),l=k(9751),q=k(3670),re=k(2206),b=k(4532),he=k(6495),Me=k(3260),Ve=k(576),X=k(7849),xe=k(8822);function fe(lt){if(lt instanceof l.y)return lt;if(null!=lt){if((0,q.c)(lt))return function ze(lt){return new l.y(_e=>{const ke=lt[xe.L]();if((0,Ve.m)(ke.subscribe))return ke.subscribe(_e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(lt);if((0,y.z)(lt))return function le(lt){return new l.y(_e=>{for(let ke=0;ke<lt.length&&!_e.closed;ke++)_e.next(lt[ke]);_e.complete()})}(lt);if((0,te.t)(lt))return function Ke(lt){return new l.y(_e=>{lt.then(ke=>{_e.closed||(_e.next(ke),_e.complete())},ke=>_e.error(ke)).then(null,X.h)})}(lt);if((0,re.D)(lt))return Q(lt);if((0,he.T)(lt))return function Oe(lt){return new l.y(_e=>{for(const ke of lt)if(_e.next(ke),_e.closed)return;_e.complete()})}(lt);if((0,Me.L)(lt))return function Ye(lt){return Q((0,Me.Q)(lt))}(lt)}throw(0,b.z)(lt)}function Q(lt){return new l.y(_e=>{(function St(lt,_e){var ke,Ne,we,Xe;return(0,d.mG)(this,void 0,void 0,function*(){try{for(ke=(0,d.KL)(lt);!(Ne=yield ke.next()).done;)if(_e.next(Ne.value),_e.closed)return}catch(We){we={error:We}}finally{try{Ne&&!Ne.done&&(Xe=ke.return)&&(yield Xe.call(ke))}finally{if(we)throw we.error}}_e.complete()})})(lt,_e).catch(ke=>_e.error(ke))})}},9646:(Pn,Et,k)=>{"use strict";k.d(Et,{of:()=>te});var d=k(7669),y=k(2076);function te(...l){const q=(0,d.yG)(l);return(0,y.D)(l,q)}},5403:(Pn,Et,k)=>{"use strict";k.d(Et,{x:()=>y});var d=k(2961);function y(l,q,re,b,he){return new te(l,q,re,b,he)}class te extends d.Lv{constructor(q,re,b,he,Me,Ve){super(q),this.onFinalize=Me,this.shouldUnsubscribe=Ve,this._next=re?function(X){try{re(X)}catch(xe){q.error(xe)}}:super._next,this._error=he?function(X){try{he(X)}catch(xe){q.error(xe)}finally{this.unsubscribe()}}:super._error,this._complete=b?function(){try{b()}catch(X){q.error(X)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var q;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:re}=this;super.unsubscribe(),!re&&(null===(q=this.onFinalize)||void 0===q||q.call(this))}}}},4351:(Pn,Et,k)=>{"use strict";k.d(Et,{b:()=>te});var d=k(5577),y=k(576);function te(l,q){return(0,y.m)(q)?(0,d.z)(l,q,1):(0,d.z)(l,1)}},9300:(Pn,Et,k)=>{"use strict";k.d(Et,{h:()=>te});var d=k(4482),y=k(5403);function te(l,q){return(0,d.e)((re,b)=>{let he=0;re.subscribe((0,y.x)(b,Me=>l.call(q,Me,he++)&&b.next(Me)))})}},4004:(Pn,Et,k)=>{"use strict";k.d(Et,{U:()=>te});var d=k(4482),y=k(5403);function te(l,q){return(0,d.e)((re,b)=>{let he=0;re.subscribe((0,y.x)(b,Me=>{b.next(l.call(q,Me,he++))}))})}},8189:(Pn,Et,k)=>{"use strict";k.d(Et,{J:()=>te});var d=k(5577),y=k(4671);function te(l=1/0){return(0,d.z)(y.y,l)}},5577:(Pn,Et,k)=>{"use strict";k.d(Et,{z:()=>he});var d=k(4004),y=k(8421),te=k(4482),l=k(9672),q=k(5403),b=k(576);function he(Me,Ve,X=1/0){return(0,b.m)(Ve)?he((xe,fe)=>(0,d.U)((ze,le)=>Ve(xe,ze,fe,le))((0,y.Xf)(Me(xe,fe))),X):("number"==typeof Ve&&(X=Ve),(0,te.e)((xe,fe)=>function re(Me,Ve,X,xe,fe,ze,le,Ke){const Oe=[];let Q=0,Ye=0,St=!1;const lt=()=>{St&&!Oe.length&&!Q&&Ve.complete()},_e=Ne=>Q<xe?ke(Ne):Oe.push(Ne),ke=Ne=>{ze&&Ve.next(Ne),Q++;let we=!1;(0,y.Xf)(X(Ne,Ye++)).subscribe((0,q.x)(Ve,Xe=>{fe?.(Xe),ze?_e(Xe):Ve.next(Xe)},()=>{we=!0},void 0,()=>{if(we)try{for(Q--;Oe.length&&Q<xe;){const Xe=Oe.shift();le?(0,l.f)(Ve,le,()=>ke(Xe)):ke(Xe)}lt()}catch(Xe){Ve.error(Xe)}}))};return Me.subscribe((0,q.x)(Ve,_e,()=>{St=!0,lt()})),()=>{Ke?.()}}(xe,fe,Me,X)))}},3099:(Pn,Et,k)=>{"use strict";k.d(Et,{B:()=>q});var d=k(8421),y=k(7579),te=k(2961),l=k(4482);function q(b={}){const{connector:he=(()=>new y.x),resetOnError:Me=!0,resetOnComplete:Ve=!0,resetOnRefCountZero:X=!0}=b;return xe=>{let fe,ze,le,Ke=0,Oe=!1,Q=!1;const Ye=()=>{ze?.unsubscribe(),ze=void 0},St=()=>{Ye(),fe=le=void 0,Oe=Q=!1},lt=()=>{const _e=fe;St(),_e?.unsubscribe()};return(0,l.e)((_e,ke)=>{Ke++,!Q&&!Oe&&Ye();const Ne=le=le??he();ke.add(()=>{Ke--,0===Ke&&!Q&&!Oe&&(ze=re(lt,X))}),Ne.subscribe(ke),!fe&&Ke>0&&(fe=new te.Hp({next:we=>Ne.next(we),error:we=>{Q=!0,Ye(),ze=re(St,Me,we),Ne.error(we)},complete:()=>{Oe=!0,Ye(),ze=re(St,Ve),Ne.complete()}}),(0,d.Xf)(_e).subscribe(fe))})(xe)}}function re(b,he,...Me){if(!0===he)return void b();if(!1===he)return;const Ve=new te.Hp({next:()=>{Ve.unsubscribe(),b()}});return(0,d.Xf)(he(...Me)).subscribe(Ve)}},3900:(Pn,Et,k)=>{"use strict";k.d(Et,{w:()=>l});var d=k(8421),y=k(4482),te=k(5403);function l(q,re){return(0,y.e)((b,he)=>{let Me=null,Ve=0,X=!1;const xe=()=>X&&!Me&&he.complete();b.subscribe((0,te.x)(he,fe=>{Me?.unsubscribe();let ze=0;const le=Ve++;(0,d.Xf)(q(fe,le)).subscribe(Me=(0,te.x)(he,Ke=>he.next(re?re(fe,Ke,le,ze++):Ke),()=>{Me=null,xe()}))},()=>{X=!0,xe()}))})}},5698:(Pn,Et,k)=>{"use strict";k.d(Et,{q:()=>l});var d=k(515),y=k(4482),te=k(5403);function l(q){return q<=0?()=>d.E:(0,y.e)((re,b)=>{let he=0;re.subscribe((0,te.x)(b,Me=>{++he<=q&&(b.next(Me),q<=he&&b.complete())}))})}},6063:(Pn,Et,k)=>{"use strict";k.d(Et,{l:()=>d});const d={now:()=>(d.delegate||Date).now(),delegate:void 0}},3410:(Pn,Et,k)=>{"use strict";k.d(Et,{z:()=>d});const d={setTimeout(y,te,...l){const{delegate:q}=d;return q?.setTimeout?q.setTimeout(y,te,...l):setTimeout(y,te,...l)},clearTimeout(y){const{delegate:te}=d;return(te?.clearTimeout||clearTimeout)(y)},delegate:void 0}},2202:(Pn,Et,k)=>{"use strict";k.d(Et,{h:()=>y});const y=function d(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},8822:(Pn,Et,k)=>{"use strict";k.d(Et,{L:()=>d});const d="function"==typeof Symbol&&Symbol.observable||"@@observable"},7669:(Pn,Et,k)=>{"use strict";k.d(Et,{_6:()=>re,jO:()=>l,yG:()=>q});var d=k(576);function te(b){return b[b.length-1]}function l(b){return(0,d.m)(te(b))?b.pop():void 0}function q(b){return function y(b){return b&&(0,d.m)(b.schedule)}(te(b))?b.pop():void 0}function re(b,he){return"number"==typeof te(b)?b.pop():he}},4742:(Pn,Et,k)=>{"use strict";k.d(Et,{D:()=>q});const{isArray:d}=Array,{getPrototypeOf:y,prototype:te,keys:l}=Object;function q(b){if(1===b.length){const he=b[0];if(d(he))return{args:he,keys:null};if(function re(b){return b&&"object"==typeof b&&y(b)===te}(he)){const Me=l(he);return{args:Me.map(Ve=>he[Ve]),keys:Me}}}return{args:b,keys:null}}},8737:(Pn,Et,k)=>{"use strict";function d(y,te){if(y){const l=y.indexOf(te);0<=l&&y.splice(l,1)}}k.d(Et,{P:()=>d})},3888:(Pn,Et,k)=>{"use strict";function d(y){const l=y(q=>{Error.call(q),q.stack=(new Error).stack});return l.prototype=Object.create(Error.prototype),l.prototype.constructor=l,l}k.d(Et,{d:()=>d})},1810:(Pn,Et,k)=>{"use strict";function d(y,te){return y.reduce((l,q,re)=>(l[q]=te[re],l),{})}k.d(Et,{n:()=>d})},2806:(Pn,Et,k)=>{"use strict";k.d(Et,{O:()=>l,x:()=>te});var d=k(2416);let y=null;function te(q){if(d.v.useDeprecatedSynchronousErrorHandling){const re=!y;if(re&&(y={errorThrown:!1,error:null}),q(),re){const{errorThrown:b,error:he}=y;if(y=null,b)throw he}}else q()}function l(q){d.v.useDeprecatedSynchronousErrorHandling&&y&&(y.errorThrown=!0,y.error=q)}},9672:(Pn,Et,k)=>{"use strict";function d(y,te,l,q=0,re=!1){const b=te.schedule(function(){l(),re?y.add(this.schedule(null,q)):this.unsubscribe()},q);if(y.add(b),!re)return b}k.d(Et,{f:()=>d})},4671:(Pn,Et,k)=>{"use strict";function d(y){return y}k.d(Et,{y:()=>d})},1144:(Pn,Et,k)=>{"use strict";k.d(Et,{z:()=>d});const d=y=>y&&"number"==typeof y.length&&"function"!=typeof y},2206:(Pn,Et,k)=>{"use strict";k.d(Et,{D:()=>y});var d=k(576);function y(te){return Symbol.asyncIterator&&(0,d.m)(te?.[Symbol.asyncIterator])}},576:(Pn,Et,k)=>{"use strict";function d(y){return"function"==typeof y}k.d(Et,{m:()=>d})},3670:(Pn,Et,k)=>{"use strict";k.d(Et,{c:()=>te});var d=k(8822),y=k(576);function te(l){return(0,y.m)(l[d.L])}},6495:(Pn,Et,k)=>{"use strict";k.d(Et,{T:()=>te});var d=k(2202),y=k(576);function te(l){return(0,y.m)(l?.[d.h])}},8239:(Pn,Et,k)=>{"use strict";k.d(Et,{t:()=>y});var d=k(576);function y(te){return(0,d.m)(te?.then)}},3260:(Pn,Et,k)=>{"use strict";k.d(Et,{L:()=>l,Q:()=>te});var d=k(5987),y=k(576);function te(q){return(0,d.FC)(this,arguments,function*(){const b=q.getReader();try{for(;;){const{value:he,done:Me}=yield(0,d.qq)(b.read());if(Me)return yield(0,d.qq)(void 0);yield yield(0,d.qq)(he)}}finally{b.releaseLock()}})}function l(q){return(0,y.m)(q?.getReader)}},4482:(Pn,Et,k)=>{"use strict";k.d(Et,{A:()=>y,e:()=>te});var d=k(576);function y(l){return(0,d.m)(l?.lift)}function te(l){return q=>{if(y(q))return q.lift(function(re){try{return l(re,this)}catch(b){this.error(b)}});throw new TypeError("Unable to lift unknown Observable type")}}},3268:(Pn,Et,k)=>{"use strict";k.d(Et,{Z:()=>l});var d=k(4004);const{isArray:y}=Array;function l(q){return(0,d.U)(re=>function te(q,re){return y(re)?q(...re):q(re)}(q,re))}},9635:(Pn,Et,k)=>{"use strict";k.d(Et,{U:()=>te,z:()=>y});var d=k(4671);function y(...l){return te(l)}function te(l){return 0===l.length?d.y:1===l.length?l[0]:function(re){return l.reduce((b,he)=>he(b),re)}}},7849:(Pn,Et,k)=>{"use strict";k.d(Et,{h:()=>te});var d=k(2416),y=k(3410);function te(l){y.z.setTimeout(()=>{const{onUnhandledError:q}=d.v;if(!q)throw l;q(l)})}},4532:(Pn,Et,k)=>{"use strict";function d(y){return new TypeError(`You provided ${null!==y&&"object"==typeof y?"an invalid object":`'${y}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}k.d(Et,{z:()=>d})},863:(Pn,Et,k)=>{var d={"./ion-accordion_2.entry.js":[9654,8592,9654],"./ion-action-sheet.entry.js":[3648,8592,3648],"./ion-alert.entry.js":[1118,8592,1118],"./ion-app_8.entry.js":[53,8592,3236],"./ion-avatar_3.entry.js":[4753,4753],"./ion-back-button.entry.js":[2073,8592,2073],"./ion-backdrop.entry.js":[8939,8939],"./ion-breadcrumb_2.entry.js":[7544,8592,7544],"./ion-button_2.entry.js":[5652,5652],"./ion-card_5.entry.js":[5929,388],"./ion-checkbox.entry.js":[9922,9922],"./ion-chip.entry.js":[657,657],"./ion-col_3.entry.js":[9824,9824],"./ion-datetime-button.entry.js":[9230,1435,9230],"./ion-datetime_3.entry.js":[4959,1435,8592,4959],"./ion-fab_3.entry.js":[5836,8592,5836],"./ion-img.entry.js":[1033,1033],"./ion-infinite-scroll_2.entry.js":[8034,8592,5817],"./ion-input.entry.js":[1217,8592,1217],"./ion-item-option_3.entry.js":[2933,8592,4651],"./ion-item_8.entry.js":[4711,8592,4711],"./ion-loading.entry.js":[9434,8592,9434],"./ion-menu_3.entry.js":[8136,8592,8136],"./ion-modal.entry.js":[2349,8592,2349],"./ion-nav_2.entry.js":[5349,8592,5349],"./ion-picker-column-internal.entry.js":[7602,8592,7602],"./ion-picker-internal.entry.js":[9016,9016],"./ion-popover.entry.js":[3804,8592,3804],"./ion-progress-bar.entry.js":[4174,4174],"./ion-radio_2.entry.js":[4432,4432],"./ion-range.entry.js":[1709,8592,1709],"./ion-refresher_2.entry.js":[3326,8592,2175],"./ion-reorder_2.entry.js":[3583,8592,1186],"./ion-ripple-effect.entry.js":[9958,9958],"./ion-route_4.entry.js":[4330,4330],"./ion-searchbar.entry.js":[8628,8592,8628],"./ion-segment_2.entry.js":[9325,8592,9325],"./ion-select_3.entry.js":[2773,2773],"./ion-slide_2.entry.js":[1650,1650],"./ion-spinner.entry.js":[4908,8592,4908],"./ion-split-pane.entry.js":[9536,9536],"./ion-tab-bar_2.entry.js":[438,8592,438],"./ion-tab_2.entry.js":[1536,8592,1536],"./ion-text.entry.js":[4376,4376],"./ion-textarea.entry.js":[6560,6560],"./ion-toast.entry.js":[6120,8592,6120],"./ion-toggle.entry.js":[5168,8592,5168],"./ion-virtual-scroll.entry.js":[2289,2289]};function y(te){if(!k.o(d,te))return Promise.resolve().then(()=>{var re=new Error("Cannot find module '"+te+"'");throw re.code="MODULE_NOT_FOUND",re});var l=d[te],q=l[0];return Promise.all(l.slice(1).map(k.e)).then(()=>k(q))}y.keys=()=>Object.keys(d),y.id=863,Pn.exports=y},5987:(Pn,Et,k)=>{"use strict";function he(ge,de,oe,Ee){return new(oe||(oe=Promise))(function(Tt,Gt){function Ot(gt){try{Mt(Ee.next(gt))}catch(it){Gt(it)}}function yt(gt){try{Mt(Ee.throw(gt))}catch(it){Gt(it)}}function Mt(gt){gt.done?Tt(gt.value):function vt(Tt){return Tt instanceof oe?Tt:new oe(function(Gt){Gt(Tt)})}(gt.value).then(Ot,yt)}Mt((Ee=Ee.apply(ge,de||[])).next())})}function Oe(ge){return this instanceof Oe?(this.v=ge,this):new Oe(ge)}function Q(ge,de,oe){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var vt,Ee=oe.apply(ge,de||[]),Tt=[];return vt={},Gt("next"),Gt("throw"),Gt("return"),vt[Symbol.asyncIterator]=function(){return this},vt;function Gt(at){Ee[at]&&(vt[at]=function(Ce){return new Promise(function(bt,kt){Tt.push([at,Ce,bt,kt])>1||Ot(at,Ce)})})}function Ot(at,Ce){try{!function yt(at){at.value instanceof Oe?Promise.resolve(at.value.v).then(Mt,gt):it(Tt[0][2],at)}(Ee[at](Ce))}catch(bt){it(Tt[0][3],bt)}}function Mt(at){Ot("next",at)}function gt(at){Ot("throw",at)}function it(at,Ce){at(Ce),Tt.shift(),Tt.length&&Ot(Tt[0][0],Tt[0][1])}}function St(ge){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var oe,de=ge[Symbol.asyncIterator];return de?de.call(ge):(ge=function xe(ge){var de="function"==typeof Symbol&&Symbol.iterator,oe=de&&ge[de],Ee=0;if(oe)return oe.call(ge);if(ge&&"number"==typeof ge.length)return{next:function(){return ge&&Ee>=ge.length&&(ge=void 0),{value:ge&&ge[Ee++],done:!ge}}};throw new TypeError(de?"Object is not iterable.":"Symbol.iterator is not defined.")}(ge),oe={},Ee("next"),Ee("throw"),Ee("return"),oe[Symbol.asyncIterator]=function(){return this},oe);function Ee(Tt){oe[Tt]=ge[Tt]&&function(Gt){return new Promise(function(Ot,yt){!function vt(Tt,Gt,Ot,yt){Promise.resolve(yt).then(function(Mt){Tt({value:Mt,done:Ot})},Gt)}(Ot,yt,(Gt=ge[Tt](Gt)).done,Gt.value)})}}}k.d(Et,{FC:()=>Q,KL:()=>St,mG:()=>he,qq:()=>Oe})},6895:(Pn,Et,k)=>{"use strict";k.d(Et,{Do:()=>Ye,EM:()=>Ma,HT:()=>l,JF:()=>qs,JJ:()=>Co,K0:()=>re,Mx:()=>wo,O5:()=>zt,S$:()=>Ke,V_:()=>Me,Ye:()=>St,b0:()=>Q,bD:()=>ks,ez:()=>so,q:()=>te,sg:()=>me,tP:()=>Ni,uU:()=>qr,w_:()=>q});var d=k(8274);let y=null;function te(){return y}function l(U){y||(y=U)}class q{}const re=new d.OlP("DocumentToken");let b=(()=>{class U{historyGo(H){throw new Error("Not implemented")}}return U.\u0275fac=function(H){return new(H||U)},U.\u0275prov=d.Yz7({token:U,factory:function(){return function he(){return(0,d.LFG)(Ve)}()},providedIn:"platform"}),U})();const Me=new d.OlP("Location Initialized");let Ve=(()=>{class U extends b{constructor(H){super(),this._doc=H,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return te().getBaseHref(this._doc)}onPopState(H){const Se=te().getGlobalEventTarget(this._doc,"window");return Se.addEventListener("popstate",H,!1),()=>Se.removeEventListener("popstate",H)}onHashChange(H){const Se=te().getGlobalEventTarget(this._doc,"window");return Se.addEventListener("hashchange",H,!1),()=>Se.removeEventListener("hashchange",H)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(H){this._location.pathname=H}pushState(H,Se,ht){X()?this._history.pushState(H,Se,ht):this._location.hash=ht}replaceState(H,Se,ht){X()?this._history.replaceState(H,Se,ht):this._location.hash=ht}forward(){this._history.forward()}back(){this._history.back()}historyGo(H=0){this._history.go(H)}getState(){return this._history.state}}return U.\u0275fac=function(H){return new(H||U)(d.LFG(re))},U.\u0275prov=d.Yz7({token:U,factory:function(){return function xe(){return new Ve((0,d.LFG)(re))}()},providedIn:"platform"}),U})();function X(){return!!window.history.pushState}function fe(U,ae){if(0==U.length)return ae;if(0==ae.length)return U;let H=0;return U.endsWith("/")&&H++,ae.startsWith("/")&&H++,2==H?U+ae.substring(1):1==H?U+ae:U+"/"+ae}function ze(U){const ae=U.match(/#|\?|$/),H=ae&&ae.index||U.length;return U.slice(0,H-("/"===U[H-1]?1:0))+U.slice(H)}function le(U){return U&&"?"!==U[0]?"?"+U:U}let Ke=(()=>{class U{historyGo(H){throw new Error("Not implemented")}}return U.\u0275fac=function(H){return new(H||U)},U.\u0275prov=d.Yz7({token:U,factory:function(){return(0,d.f3M)(Q)},providedIn:"root"}),U})();const Oe=new d.OlP("appBaseHref");let Q=(()=>{class U extends Ke{constructor(H,Se){super(),this._platformLocation=H,this._removeListenerFns=[],this._baseHref=Se??this._platformLocation.getBaseHrefFromDOM()??(0,d.f3M)(re).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(H){this._removeListenerFns.push(this._platformLocation.onPopState(H),this._platformLocation.onHashChange(H))}getBaseHref(){return this._baseHref}prepareExternalUrl(H){return fe(this._baseHref,H)}path(H=!1){const Se=this._platformLocation.pathname+le(this._platformLocation.search),ht=this._platformLocation.hash;return ht&&H?`${Se}${ht}`:Se}pushState(H,Se,ht,un){const Tn=this.prepareExternalUrl(ht+le(un));this._platformLocation.pushState(H,Se,Tn)}replaceState(H,Se,ht,un){const Tn=this.prepareExternalUrl(ht+le(un));this._platformLocation.replaceState(H,Se,Tn)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(H=0){this._platformLocation.historyGo?.(H)}}return U.\u0275fac=function(H){return new(H||U)(d.LFG(b),d.LFG(Oe,8))},U.\u0275prov=d.Yz7({token:U,factory:U.\u0275fac,providedIn:"root"}),U})(),Ye=(()=>{class U extends Ke{constructor(H,Se){super(),this._platformLocation=H,this._baseHref="",this._removeListenerFns=[],null!=Se&&(this._baseHref=Se)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(H){this._removeListenerFns.push(this._platformLocation.onPopState(H),this._platformLocation.onHashChange(H))}getBaseHref(){return this._baseHref}path(H=!1){let Se=this._platformLocation.hash;return null==Se&&(Se="#"),Se.length>0?Se.substring(1):Se}prepareExternalUrl(H){const Se=fe(this._baseHref,H);return Se.length>0?"#"+Se:Se}pushState(H,Se,ht,un){let Tn=this.prepareExternalUrl(ht+le(un));0==Tn.length&&(Tn=this._platformLocation.pathname),this._platformLocation.pushState(H,Se,Tn)}replaceState(H,Se,ht,un){let Tn=this.prepareExternalUrl(ht+le(un));0==Tn.length&&(Tn=this._platformLocation.pathname),this._platformLocation.replaceState(H,Se,Tn)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(H=0){this._platformLocation.historyGo?.(H)}}return U.\u0275fac=function(H){return new(H||U)(d.LFG(b),d.LFG(Oe,8))},U.\u0275prov=d.Yz7({token:U,factory:U.\u0275fac}),U})(),St=(()=>{class U{constructor(H){this._subject=new d.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=H;const Se=this._locationStrategy.getBaseHref();this._basePath=function Ne(U){if(new RegExp("^(https?:)?//").test(U)){const[,H]=U.split(/\/\/[^\/]+/);return H}return U}(ze(ke(Se))),this._locationStrategy.onPopState(ht=>{this._subject.emit({url:this.path(!0),pop:!0,state:ht.state,type:ht.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(H=!1){return this.normalize(this._locationStrategy.path(H))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(H,Se=""){return this.path()==this.normalize(H+le(Se))}normalize(H){return U.stripTrailingSlash(function _e(U,ae){return U&&new RegExp(`^${U}([/;?#]|$)`).test(ae)?ae.substring(U.length):ae}(this._basePath,ke(H)))}prepareExternalUrl(H){return H&&"/"!==H[0]&&(H="/"+H),this._locationStrategy.prepareExternalUrl(H)}go(H,Se="",ht=null){this._locationStrategy.pushState(ht,"",H,Se),this._notifyUrlChangeListeners(this.prepareExternalUrl(H+le(Se)),ht)}replaceState(H,Se="",ht=null){this._locationStrategy.replaceState(ht,"",H,Se),this._notifyUrlChangeListeners(this.prepareExternalUrl(H+le(Se)),ht)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(H=0){this._locationStrategy.historyGo?.(H)}onUrlChange(H){return this._urlChangeListeners.push(H),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(Se=>{this._notifyUrlChangeListeners(Se.url,Se.state)})),()=>{const Se=this._urlChangeListeners.indexOf(H);this._urlChangeListeners.splice(Se,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(H="",Se){this._urlChangeListeners.forEach(ht=>ht(H,Se))}subscribe(H,Se,ht){return this._subject.subscribe({next:H,error:Se,complete:ht})}}return U.normalizeQueryParams=le,U.joinWithSlash=fe,U.stripTrailingSlash=ze,U.\u0275fac=function(H){return new(H||U)(d.LFG(Ke))},U.\u0275prov=d.Yz7({token:U,factory:function(){return function lt(){return new St((0,d.LFG)(Ke))}()},providedIn:"root"}),U})();function ke(U){return U.replace(/\/index.html$/,"")}var Xe=(()=>((Xe=Xe||{})[Xe.Decimal=0]="Decimal",Xe[Xe.Percent=1]="Percent",Xe[Xe.Currency=2]="Currency",Xe[Xe.Scientific=3]="Scientific",Xe))(),ge=(()=>((ge=ge||{})[ge.Format=0]="Format",ge[ge.Standalone=1]="Standalone",ge))(),de=(()=>((de=de||{})[de.Narrow=0]="Narrow",de[de.Abbreviated=1]="Abbreviated",de[de.Wide=2]="Wide",de[de.Short=3]="Short",de))(),oe=(()=>((oe=oe||{})[oe.Short=0]="Short",oe[oe.Medium=1]="Medium",oe[oe.Long=2]="Long",oe[oe.Full=3]="Full",oe))(),Ee=(()=>((Ee=Ee||{})[Ee.Decimal=0]="Decimal",Ee[Ee.Group=1]="Group",Ee[Ee.List=2]="List",Ee[Ee.PercentSign=3]="PercentSign",Ee[Ee.PlusSign=4]="PlusSign",Ee[Ee.MinusSign=5]="MinusSign",Ee[Ee.Exponential=6]="Exponential",Ee[Ee.SuperscriptingExponent=7]="SuperscriptingExponent",Ee[Ee.PerMille=8]="PerMille",Ee[Ee.Infinity=9]="Infinity",Ee[Ee.NaN=10]="NaN",Ee[Ee.TimeSeparator=11]="TimeSeparator",Ee[Ee.CurrencyDecimal=12]="CurrencyDecimal",Ee[Ee.CurrencyGroup=13]="CurrencyGroup",Ee))();function at(U,ae){return pi((0,d.cg1)(U)[d.wAp.DateFormat],ae)}function Ce(U,ae){return pi((0,d.cg1)(U)[d.wAp.TimeFormat],ae)}function bt(U,ae){return pi((0,d.cg1)(U)[d.wAp.DateTimeFormat],ae)}function kt(U,ae){const H=(0,d.cg1)(U),Se=H[d.wAp.NumberSymbols][ae];if(typeof Se>"u"){if(ae===Ee.CurrencyDecimal)return H[d.wAp.NumberSymbols][Ee.Decimal];if(ae===Ee.CurrencyGroup)return H[d.wAp.NumberSymbols][Ee.Group]}return Se}function bn(U){if(!U[d.wAp.ExtraData])throw new Error(`Missing extra locale data for the locale "${U[d.wAp.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function pi(U,ae){for(let H=ae;H>-1;H--)if(typeof U[H]<"u")return U[H];throw new Error("Locale data API: locale data undefined")}function bi(U){const[ae,H]=U.split(":");return{hours:+ae,minutes:+H}}const Fi=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Yi={},Zt=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var It=(()=>((It=It||{})[It.Short=0]="Short",It[It.ShortGMT=1]="ShortGMT",It[It.Long=2]="Long",It[It.Extended=3]="Extended",It))(),He=(()=>((He=He||{})[He.FullYear=0]="FullYear",He[He.Month=1]="Month",He[He.Date=2]="Date",He[He.Hours=3]="Hours",He[He.Minutes=4]="Minutes",He[He.Seconds=5]="Seconds",He[He.FractionalSeconds=6]="FractionalSeconds",He[He.Day=7]="Day",He))(),ne=(()=>((ne=ne||{})[ne.DayPeriods=0]="DayPeriods",ne[ne.Days=1]="Days",ne[ne.Months=2]="Months",ne[ne.Eras=3]="Eras",ne))();function Je(U,ae,H,Se){let ht=function Be(U){if(Rt(U))return U;if("number"==typeof U&&!isNaN(U))return new Date(U);if("string"==typeof U){if(U=U.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(U)){const[ht,un=1,Tn=1]=U.split("-").map(ai=>+ai);return jt(ht,un-1,Tn)}const H=parseFloat(U);if(!isNaN(U-H))return new Date(H);let Se;if(Se=U.match(Fi))return function tt(U){const ae=new Date(0);let H=0,Se=0;const ht=U[8]?ae.setUTCFullYear:ae.setFullYear,un=U[8]?ae.setUTCHours:ae.setHours;U[9]&&(H=Number(U[9]+U[10]),Se=Number(U[9]+U[11])),ht.call(ae,Number(U[1]),Number(U[2])-1,Number(U[3]));const Tn=Number(U[4]||0)-H,ai=Number(U[5]||0)-Se,rr=Number(U[6]||0),$i=Math.floor(1e3*parseFloat("0."+(U[7]||0)));return un.call(ae,Tn,ai,rr,$i),ae}(Se)}const ae=new Date(U);if(!Rt(ae))throw new Error(`Unable to convert "${U}" into a date`);return ae}(U);ae=Qt(H,ae)||ae;let ai,Tn=[];for(;ae;){if(ai=Zt.exec(ae),!ai){Tn.push(ae);break}{Tn=Tn.concat(ai.slice(1));const Hi=Tn.pop();if(!Hi)break;ae=Hi}}let rr=ht.getTimezoneOffset();Se&&(rr=R(Se,rr),ht=function ce(U,ae,H){const Se=H?-1:1,ht=U.getTimezoneOffset();return function z(U,ae){return(U=new Date(U.getTime())).setMinutes(U.getMinutes()+ae),U}(U,Se*(R(ae,ht)-ht))}(ht,Se,!0));let $i="";return Tn.forEach(Hi=>{const Xi=function se(U){if(Ue[U])return Ue[U];let ae;switch(U){case"G":case"GG":case"GGG":ae=Ai(ne.Eras,de.Abbreviated);break;case"GGGG":ae=Ai(ne.Eras,de.Wide);break;case"GGGGG":ae=Ai(ne.Eras,de.Narrow);break;case"y":ae=fi(He.FullYear,1,0,!1,!0);break;case"yy":ae=fi(He.FullYear,2,0,!0,!0);break;case"yyy":ae=fi(He.FullYear,3,0,!1,!0);break;case"yyyy":ae=fi(He.FullYear,4,0,!1,!0);break;case"Y":ae=gn(1);break;case"YY":ae=gn(2,!0);break;case"YYY":ae=gn(3);break;case"YYYY":ae=gn(4);break;case"M":case"L":ae=fi(He.Month,1,1);break;case"MM":case"LL":ae=fi(He.Month,2,1);break;case"MMM":ae=Ai(ne.Months,de.Abbreviated);break;case"MMMM":ae=Ai(ne.Months,de.Wide);break;case"MMMMM":ae=Ai(ne.Months,de.Narrow);break;case"LLL":ae=Ai(ne.Months,de.Abbreviated,ge.Standalone);break;case"LLLL":ae=Ai(ne.Months,de.Wide,ge.Standalone);break;case"LLLLL":ae=Ai(ne.Months,de.Narrow,ge.Standalone);break;case"w":ae=Pt(1);break;case"ww":ae=Pt(2);break;case"W":ae=Pt(1,!0);break;case"d":ae=fi(He.Date,1);break;case"dd":ae=fi(He.Date,2);break;case"c":case"cc":ae=fi(He.Day,1);break;case"ccc":ae=Ai(ne.Days,de.Abbreviated,ge.Standalone);break;case"cccc":ae=Ai(ne.Days,de.Wide,ge.Standalone);break;case"ccccc":ae=Ai(ne.Days,de.Narrow,ge.Standalone);break;case"cccccc":ae=Ai(ne.Days,de.Short,ge.Standalone);break;case"E":case"EE":case"EEE":ae=Ai(ne.Days,de.Abbreviated);break;case"EEEE":ae=Ai(ne.Days,de.Wide);break;case"EEEEE":ae=Ai(ne.Days,de.Narrow);break;case"EEEEEE":ae=Ai(ne.Days,de.Short);break;case"a":case"aa":case"aaa":ae=Ai(ne.DayPeriods,de.Abbreviated);break;case"aaaa":ae=Ai(ne.DayPeriods,de.Wide);break;case"aaaaa":ae=Ai(ne.DayPeriods,de.Narrow);break;case"b":case"bb":case"bbb":ae=Ai(ne.DayPeriods,de.Abbreviated,ge.Standalone,!0);break;case"bbbb":ae=Ai(ne.DayPeriods,de.Wide,ge.Standalone,!0);break;case"bbbbb":ae=Ai(ne.DayPeriods,de.Narrow,ge.Standalone,!0);break;case"B":case"BB":case"BBB":ae=Ai(ne.DayPeriods,de.Abbreviated,ge.Format,!0);break;case"BBBB":ae=Ai(ne.DayPeriods,de.Wide,ge.Format,!0);break;case"BBBBB":ae=Ai(ne.DayPeriods,de.Narrow,ge.Format,!0);break;case"h":ae=fi(He.Hours,1,-12);break;case"hh":ae=fi(He.Hours,2,-12);break;case"H":ae=fi(He.Hours,1);break;case"HH":ae=fi(He.Hours,2);break;case"m":ae=fi(He.Minutes,1);break;case"mm":ae=fi(He.Minutes,2);break;case"s":ae=fi(He.Seconds,1);break;case"ss":ae=fi(He.Seconds,2);break;case"S":ae=fi(He.FractionalSeconds,1);break;case"SS":ae=fi(He.FractionalSeconds,2);break;case"SSS":ae=fi(He.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":ae=wr(It.Short);break;case"ZZZZZ":ae=wr(It.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":ae=wr(It.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":ae=wr(It.Long);break;default:return null}return Ue[U]=ae,ae}(Hi);$i+=Xi?Xi(ht,H,rr):"''"===Hi?"'":Hi.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),$i}function jt(U,ae,H){const Se=new Date(0);return Se.setFullYear(U,ae,H),Se.setHours(0,0,0),Se}function Qt(U,ae){const H=function Tt(U){return(0,d.cg1)(U)[d.wAp.LocaleId]}(U);if(Yi[H]=Yi[H]||{},Yi[H][ae])return Yi[H][ae];let Se="";switch(ae){case"shortDate":Se=at(U,oe.Short);break;case"mediumDate":Se=at(U,oe.Medium);break;case"longDate":Se=at(U,oe.Long);break;case"fullDate":Se=at(U,oe.Full);break;case"shortTime":Se=Ce(U,oe.Short);break;case"mediumTime":Se=Ce(U,oe.Medium);break;case"longTime":Se=Ce(U,oe.Long);break;case"fullTime":Se=Ce(U,oe.Full);break;case"short":const ht=Qt(U,"shortTime"),un=Qt(U,"shortDate");Se=li(bt(U,oe.Short),[ht,un]);break;case"medium":const Tn=Qt(U,"mediumTime"),ai=Qt(U,"mediumDate");Se=li(bt(U,oe.Medium),[Tn,ai]);break;case"long":const rr=Qt(U,"longTime"),$i=Qt(U,"longDate");Se=li(bt(U,oe.Long),[rr,$i]);break;case"full":const Hi=Qt(U,"fullTime"),Xi=Qt(U,"fullDate");Se=li(bt(U,oe.Full),[Hi,Xi])}return Se&&(Yi[H][ae]=Se),Se}function li(U,ae){return ae&&(U=U.replace(/\{([^}]+)}/g,function(H,Se){return null!=ae&&Se in ae?ae[Se]:H})),U}function Ii(U,ae,H="-",Se,ht){let un="";(U<0||ht&&U<=0)&&(ht?U=1-U:(U=-U,un=H));let Tn=String(U);for(;Tn.length<ae;)Tn="0"+Tn;return Se&&(Tn=Tn.slice(Tn.length-ae)),un+Tn}function fi(U,ae,H=0,Se=!1,ht=!1){return function(un,Tn){let ai=function yr(U,ae){switch(U){case He.FullYear:return ae.getFullYear();case He.Month:return ae.getMonth();case He.Date:return ae.getDate();case He.Hours:return ae.getHours();case He.Minutes:return ae.getMinutes();case He.Seconds:return ae.getSeconds();case He.FractionalSeconds:return ae.getMilliseconds();case He.Day:return ae.getDay();default:throw new Error(`Unknown DateType value "${U}".`)}}(U,un);if((H>0||ai>-H)&&(ai+=H),U===He.Hours)0===ai&&-12===H&&(ai=12);else if(U===He.FractionalSeconds)return function tr(U,ae){return Ii(U,3).substring(0,ae)}(ai,ae);const rr=kt(Tn,Ee.MinusSign);return Ii(ai,ae,rr,Se,ht)}}function Ai(U,ae,H=ge.Format,Se=!1){return function(ht,un){return function fr(U,ae,H,Se,ht,un){switch(H){case ne.Months:return function yt(U,ae,H){const Se=(0,d.cg1)(U),un=pi([Se[d.wAp.MonthsFormat],Se[d.wAp.MonthsStandalone]],ae);return pi(un,H)}(ae,ht,Se)[U.getMonth()];case ne.Days:return function Ot(U,ae,H){const Se=(0,d.cg1)(U),un=pi([Se[d.wAp.DaysFormat],Se[d.wAp.DaysStandalone]],ae);return pi(un,H)}(ae,ht,Se)[U.getDay()];case ne.DayPeriods:const Tn=U.getHours(),ai=U.getMinutes();if(un){const $i=function Kn(U){const ae=(0,d.cg1)(U);return bn(ae),(ae[d.wAp.ExtraData][2]||[]).map(Se=>"string"==typeof Se?bi(Se):[bi(Se[0]),bi(Se[1])])}(ae),Hi=function ri(U,ae,H){const Se=(0,d.cg1)(U);bn(Se);const un=pi([Se[d.wAp.ExtraData][0],Se[d.wAp.ExtraData][1]],ae)||[];return pi(un,H)||[]}(ae,ht,Se),Xi=$i.findIndex(ho=>{if(Array.isArray(ho)){const[sr,io]=ho,$n=Tn>=sr.hours&&ai>=sr.minutes,ro=Tn<io.hours||Tn===io.hours&&ai<io.minutes;if(sr.hours<io.hours){if($n&&ro)return!0}else if($n||ro)return!0}else if(ho.hours===Tn&&ho.minutes===ai)return!0;return!1});if(-1!==Xi)return Hi[Xi]}return function Gt(U,ae,H){const Se=(0,d.cg1)(U),un=pi([Se[d.wAp.DayPeriodsFormat],Se[d.wAp.DayPeriodsStandalone]],ae);return pi(un,H)}(ae,ht,Se)[Tn<12?0:1];case ne.Eras:return function Mt(U,ae){return pi((0,d.cg1)(U)[d.wAp.Eras],ae)}(ae,Se)[U.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${H}`)}}(ht,un,U,ae,H,Se)}}function wr(U){return function(ae,H,Se){const ht=-1*Se,un=kt(H,Ee.MinusSign),Tn=ht>0?Math.floor(ht/60):Math.ceil(ht/60);switch(U){case It.Short:return(ht>=0?"+":"")+Ii(Tn,2,un)+Ii(Math.abs(ht%60),2,un);case It.ShortGMT:return"GMT"+(ht>=0?"+":"")+Ii(Tn,1,un);case It.Long:return"GMT"+(ht>=0?"+":"")+Ii(Tn,2,un)+":"+Ii(Math.abs(ht%60),2,un);case It.Extended:return 0===Se?"Z":(ht>=0?"+":"")+Ii(Tn,2,un)+":"+Ii(Math.abs(ht%60),2,un);default:throw new Error(`Unknown zone width "${U}"`)}}}function wt(U){return jt(U.getFullYear(),U.getMonth(),U.getDate()+(4-U.getDay()))}function Pt(U,ae=!1){return function(H,Se){let ht;if(ae){const un=new Date(H.getFullYear(),H.getMonth(),1).getDay()-1,Tn=H.getDate();ht=1+Math.floor((Tn+un)/7)}else{const un=wt(H),Tn=function dn(U){const ae=jt(U,0,1).getDay();return jt(U,0,1+(ae<=4?4:11)-ae)}(un.getFullYear()),ai=un.getTime()-Tn.getTime();ht=1+Math.round(ai/6048e5)}return Ii(ht,U,kt(Se,Ee.MinusSign))}}function gn(U,ae=!1){return function(H,Se){return Ii(wt(H).getFullYear(),U,kt(Se,Ee.MinusSign),ae)}}const Ue={};function R(U,ae){U=U.replace(/:/g,"");const H=Date.parse("Jan 01, 1970 00:00:00 "+U)/6e4;return isNaN(H)?ae:H}function Rt(U){return U instanceof Date&&!isNaN(U.valueOf())}const At=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Or(U){const ae=parseInt(U);if(isNaN(ae))throw new Error("Invalid integer literal when parsing "+U);return ae}function wo(U,ae){ae=encodeURIComponent(ae);for(const H of U.split(";")){const Se=H.indexOf("="),[ht,un]=-1==Se?[H,""]:[H.slice(0,Se),H.slice(Se+1)];if(ht.trim()===ae)return decodeURIComponent(un)}return null}class Cn{constructor(ae,H,Se,ht){this.$implicit=ae,this.ngForOf=H,this.index=Se,this.count=ht}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let me=(()=>{class U{set ngForOf(H){this._ngForOf=H,this._ngForOfDirty=!0}set ngForTrackBy(H){this._trackByFn=H}get ngForTrackBy(){return this._trackByFn}constructor(H,Se,ht){this._viewContainer=H,this._template=Se,this._differs=ht,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(H){H&&(this._template=H)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const H=this._ngForOf;!this._differ&&H&&(this._differ=this._differs.find(H).create(this.ngForTrackBy))}if(this._differ){const H=this._differ.diff(this._ngForOf);H&&this._applyChanges(H)}}_applyChanges(H){const Se=this._viewContainer;H.forEachOperation((ht,un,Tn)=>{if(null==ht.previousIndex)Se.createEmbeddedView(this._template,new Cn(ht.item,this._ngForOf,-1,-1),null===Tn?void 0:Tn);else if(null==Tn)Se.remove(null===un?void 0:un);else if(null!==un){const ai=Se.get(un);Se.move(ai,Tn),Ge(ai,ht)}});for(let ht=0,un=Se.length;ht<un;ht++){const ai=Se.get(ht).context;ai.index=ht,ai.count=un,ai.ngForOf=this._ngForOf}H.forEachIdentityChange(ht=>{Ge(Se.get(ht.currentIndex),ht)})}static ngTemplateContextGuard(H,Se){return!0}}return U.\u0275fac=function(H){return new(H||U)(d.Y36(d.s_b),d.Y36(d.Rgc),d.Y36(d.ZZ4))},U.\u0275dir=d.lG2({type:U,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),U})();function Ge(U,ae){U.context.$implicit=ae.item}let zt=(()=>{class U{constructor(H,Se){this._viewContainer=H,this._context=new Yt,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=Se}set ngIf(H){this._context.$implicit=this._context.ngIf=H,this._updateView()}set ngIfThen(H){$e("ngIfThen",H),this._thenTemplateRef=H,this._thenViewRef=null,this._updateView()}set ngIfElse(H){$e("ngIfElse",H),this._elseTemplateRef=H,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(H,Se){return!0}}return U.\u0275fac=function(H){return new(H||U)(d.Y36(d.s_b),d.Y36(d.Rgc))},U.\u0275dir=d.lG2({type:U,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),U})();class Yt{constructor(){this.$implicit=null,this.ngIf=null}}function $e(U,ae){if(ae&&!ae.createEmbeddedView)throw new Error(`${U} must be a TemplateRef, but received '${(0,d.AaK)(ae)}'.`)}let Ni=(()=>{class U{constructor(H){this._viewContainerRef=H,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(H){if(H.ngTemplateOutlet||H.ngTemplateOutletInjector){const Se=this._viewContainerRef;if(this._viewRef&&Se.remove(Se.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:ht,ngTemplateOutletContext:un,ngTemplateOutletInjector:Tn}=this;this._viewRef=Se.createEmbeddedView(ht,un,Tn?{injector:Tn}:void 0)}else this._viewRef=null}else this._viewRef&&H.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return U.\u0275fac=function(H){return new(H||U)(d.Y36(d.s_b))},U.\u0275dir=d.lG2({type:U,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[d.TTD]}),U})();function ir(U,ae){return new d.vHH(2100,!1)}const Ur=new d.OlP("DATE_PIPE_DEFAULT_TIMEZONE"),ua=new d.OlP("DATE_PIPE_DEFAULT_OPTIONS");let qr=(()=>{class U{constructor(H,Se,ht){this.locale=H,this.defaultTimezone=Se,this.defaultOptions=ht}transform(H,Se,ht,un){if(null==H||""===H||H!=H)return null;try{return Je(H,Se??this.defaultOptions?.dateFormat??"mediumDate",un||this.locale,ht??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(Tn){throw ir()}}}return U.\u0275fac=function(H){return new(H||U)(d.Y36(d.soG,16),d.Y36(Ur,24),d.Y36(ua,24))},U.\u0275pipe=d.Yjl({name:"date",type:U,pure:!0,standalone:!0}),U})(),Co=(()=>{class U{constructor(H){this._locale=H}transform(H,Se,ht){if(!function vs(U){return!(null==U||""===U||U!=U)}(H))return null;ht=ht||this._locale;try{return function Hn(U,ae,H){return function Wn(U,ae,H,Se,ht,un,Tn=!1){let ai="",rr=!1;if(isFinite(U)){let $i=function Gr(U){let Se,ht,un,Tn,ai,ae=Math.abs(U)+"",H=0;for((ht=ae.indexOf("."))>-1&&(ae=ae.replace(".","")),(un=ae.search(/e/i))>0?(ht<0&&(ht=un),ht+=+ae.slice(un+1),ae=ae.substring(0,un)):ht<0&&(ht=ae.length),un=0;"0"===ae.charAt(un);un++);if(un===(ai=ae.length))Se=[0],ht=1;else{for(ai--;"0"===ae.charAt(ai);)ai--;for(ht-=un,Se=[],Tn=0;un<=ai;un++,Tn++)Se[Tn]=Number(ae.charAt(un))}return ht>22&&(Se=Se.splice(0,21),H=ht-1,ht=1),{digits:Se,exponent:H,integerLen:ht}}(U);Tn&&($i=function ki(U){if(0===U.digits[0])return U;const ae=U.digits.length-U.integerLen;return U.exponent?U.exponent+=2:(0===ae?U.digits.push(0,0):1===ae&&U.digits.push(0),U.integerLen+=2),U}($i));let Hi=ae.minInt,Xi=ae.minFrac,ho=ae.maxFrac;if(un){const _a=un.match(At);if(null===_a)throw new Error(`${un} is not a valid digit info`);const Oa=_a[1],Qs=_a[3],ml=_a[5];null!=Oa&&(Hi=Or(Oa)),null!=Qs&&(Xi=Or(Qs)),null!=ml?ho=Or(ml):null!=Qs&&Xi>ho&&(ho=Xi)}!function Tr(U,ae,H){if(ae>H)throw new Error(`The minimum number of digits after fraction (${ae}) is higher than the maximum (${H}).`);let Se=U.digits,ht=Se.length-U.integerLen;const un=Math.min(Math.max(ae,ht),H);let Tn=un+U.integerLen,ai=Se[Tn];if(Tn>0){Se.splice(Math.max(U.integerLen,Tn));for(let Xi=Tn;Xi<Se.length;Xi++)Se[Xi]=0}else{ht=Math.max(0,ht),U.integerLen=1,Se.length=Math.max(1,Tn=un+1),Se[0]=0;for(let Xi=1;Xi<Tn;Xi++)Se[Xi]=0}if(ai>=5)if(Tn-1<0){for(let Xi=0;Xi>Tn;Xi--)Se.unshift(0),U.integerLen++;Se.unshift(1),U.integerLen++}else Se[Tn-1]++;for(;ht<Math.max(0,un);ht++)Se.push(0);let rr=0!==un;const $i=ae+U.integerLen,Hi=Se.reduceRight(function(Xi,ho,sr,io){return io[sr]=(ho+=Xi)<10?ho:ho-10,rr&&(0===io[sr]&&sr>=$i?io.pop():rr=!1),ho>=10?1:0},0);Hi&&(Se.unshift(Hi),U.integerLen++)}($i,Xi,ho);let sr=$i.digits,io=$i.integerLen;const $n=$i.exponent;let ro=[];for(rr=sr.every(_a=>!_a);io<Hi;io++)sr.unshift(0);for(;io<0;io++)sr.unshift(0);io>0?ro=sr.splice(io,sr.length):(ro=sr,sr=[0]);const Bs=[];for(sr.length>=ae.lgSize&&Bs.unshift(sr.splice(-ae.lgSize,sr.length).join(""));sr.length>ae.gSize;)Bs.unshift(sr.splice(-ae.gSize,sr.length).join(""));sr.length&&Bs.unshift(sr.join("")),ai=Bs.join(kt(H,Se)),ro.length&&(ai+=kt(H,ht)+ro.join("")),$n&&(ai+=kt(H,Ee.Exponential)+"+"+$n)}else ai=kt(H,Ee.Infinity);return ai=U<0&&!rr?ae.negPre+ai+ae.negSuf:ae.posPre+ai+ae.posSuf,ai}(U,function Vi(U,ae="-"){const H={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},Se=U.split(";"),ht=Se[0],un=Se[1],Tn=-1!==ht.indexOf(".")?ht.split("."):[ht.substring(0,ht.lastIndexOf("0")+1),ht.substring(ht.lastIndexOf("0")+1)],ai=Tn[0],rr=Tn[1]||"";H.posPre=ai.substring(0,ai.indexOf("#"));for(let Hi=0;Hi<rr.length;Hi++){const Xi=rr.charAt(Hi);"0"===Xi?H.minFrac=H.maxFrac=Hi+1:"#"===Xi?H.maxFrac=Hi+1:H.posSuf+=Xi}const $i=ai.split(",");if(H.gSize=$i[1]?$i[1].length:0,H.lgSize=$i[2]||$i[1]?($i[2]||$i[1]).length:0,un){const Hi=ht.length-H.posPre.length-H.posSuf.length,Xi=un.indexOf("#");H.negPre=un.substring(0,Xi).replace(/'/g,""),H.negSuf=un.slice(Xi+Hi).replace(/'/g,"")}else H.negPre=ae+H.posPre,H.negSuf=H.posSuf;return H}(function Vt(U,ae){return(0,d.cg1)(U)[d.wAp.NumberFormats][ae]}(ae,Xe.Decimal),kt(ae,Ee.MinusSign)),ae,Ee.Group,Ee.Decimal,H)}(function as(U){if("string"==typeof U&&!isNaN(Number(U)-parseFloat(U)))return Number(U);if("number"!=typeof U)throw new Error(`${U} is not a number`);return U}(H),ht,Se)}catch(un){throw ir()}}}return U.\u0275fac=function(H){return new(H||U)(d.Y36(d.soG,16))},U.\u0275pipe=d.Yjl({name:"number",type:U,pure:!0,standalone:!0}),U})();let so=(()=>{class U{}return U.\u0275fac=function(H){return new(H||U)},U.\u0275mod=d.oAB({type:U}),U.\u0275inj=d.cJS({}),U})();const ks="browser";let Ma=(()=>{class U{}return U.\u0275prov=(0,d.Yz7)({token:U,providedIn:"root",factory:()=>new cs((0,d.LFG)(re),window)}),U})();class cs{constructor(ae,H){this.document=ae,this.window=H,this.offset=()=>[0,0]}setOffset(ae){this.offset=Array.isArray(ae)?()=>ae:ae}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(ae){this.supportsScrolling()&&this.window.scrollTo(ae[0],ae[1])}scrollToAnchor(ae){if(!this.supportsScrolling())return;const H=function Uo(U,ae){const H=U.getElementById(ae)||U.getElementsByName(ae)[0];if(H)return H;if("function"==typeof U.createTreeWalker&&U.body&&(U.body.createShadowRoot||U.body.attachShadow)){const Se=U.createTreeWalker(U.body,NodeFilter.SHOW_ELEMENT);let ht=Se.currentNode;for(;ht;){const un=ht.shadowRoot;if(un){const Tn=un.getElementById(ae)||un.querySelector(`[name="${ae}"]`);if(Tn)return Tn}ht=Se.nextNode()}}return null}(this.document,ae);H&&(this.scrollToElement(H),H.focus())}setHistoryScrollRestoration(ae){if(this.supportScrollRestoration()){const H=this.window.history;H&&H.scrollRestoration&&(H.scrollRestoration=ae)}}scrollToElement(ae){const H=ae.getBoundingClientRect(),Se=H.left+this.window.pageXOffset,ht=H.top+this.window.pageYOffset,un=this.offset();this.window.scrollTo(Se-un[0],ht-un[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const ae=Ro(this.window.history)||Ro(Object.getPrototypeOf(this.window.history));return!(!ae||!ae.writable&&!ae.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function Ro(U){return Object.getOwnPropertyDescriptor(U,"scrollRestoration")}class qs{}},529:(Pn,Et,k)=>{"use strict";k.d(Et,{JF:()=>wr,TP:()=>Mt,WM:()=>Ve,eN:()=>Tt});var d=k(6895),y=k(8274),te=k(9646),l=k(9751),q=k(4351),re=k(9300),b=k(4004);class he{}class Me{}class Ve{constructor(wt){this.normalizedNames=new Map,this.lazyUpdate=null,wt?this.lazyInit="string"==typeof wt?()=>{this.headers=new Map,wt.split("\n").forEach(Pt=>{const gn=Pt.indexOf(":");if(gn>0){const Ue=Pt.slice(0,gn),se=Ue.toLowerCase(),R=Pt.slice(gn+1).trim();this.maybeSetNormalizedName(Ue,se),this.headers.has(se)?this.headers.get(se).push(R):this.headers.set(se,[R])}})}:()=>{this.headers=new Map,Object.keys(wt).forEach(Pt=>{let gn=wt[Pt];const Ue=Pt.toLowerCase();"string"==typeof gn&&(gn=[gn]),gn.length>0&&(this.headers.set(Ue,gn),this.maybeSetNormalizedName(Pt,Ue))})}:this.headers=new Map}has(wt){return this.init(),this.headers.has(wt.toLowerCase())}get(wt){this.init();const Pt=this.headers.get(wt.toLowerCase());return Pt&&Pt.length>0?Pt[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(wt){return this.init(),this.headers.get(wt.toLowerCase())||null}append(wt,Pt){return this.clone({name:wt,value:Pt,op:"a"})}set(wt,Pt){return this.clone({name:wt,value:Pt,op:"s"})}delete(wt,Pt){return this.clone({name:wt,value:Pt,op:"d"})}maybeSetNormalizedName(wt,Pt){this.normalizedNames.has(Pt)||this.normalizedNames.set(Pt,wt)}init(){this.lazyInit&&(this.lazyInit instanceof Ve?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(wt=>this.applyUpdate(wt)),this.lazyUpdate=null))}copyFrom(wt){wt.init(),Array.from(wt.headers.keys()).forEach(Pt=>{this.headers.set(Pt,wt.headers.get(Pt)),this.normalizedNames.set(Pt,wt.normalizedNames.get(Pt))})}clone(wt){const Pt=new Ve;return Pt.lazyInit=this.lazyInit&&this.lazyInit instanceof Ve?this.lazyInit:this,Pt.lazyUpdate=(this.lazyUpdate||[]).concat([wt]),Pt}applyUpdate(wt){const Pt=wt.name.toLowerCase();switch(wt.op){case"a":case"s":let gn=wt.value;if("string"==typeof gn&&(gn=[gn]),0===gn.length)return;this.maybeSetNormalizedName(wt.name,Pt);const Ue=("a"===wt.op?this.headers.get(Pt):void 0)||[];Ue.push(...gn),this.headers.set(Pt,Ue);break;case"d":const se=wt.value;if(se){let R=this.headers.get(Pt);if(!R)return;R=R.filter(z=>-1===se.indexOf(z)),0===R.length?(this.headers.delete(Pt),this.normalizedNames.delete(Pt)):this.headers.set(Pt,R)}else this.headers.delete(Pt),this.normalizedNames.delete(Pt)}}forEach(wt){this.init(),Array.from(this.normalizedNames.keys()).forEach(Pt=>wt(this.normalizedNames.get(Pt),this.headers.get(Pt)))}}class xe{encodeKey(wt){return Ke(wt)}encodeValue(wt){return Ke(wt)}decodeKey(wt){return decodeURIComponent(wt)}decodeValue(wt){return decodeURIComponent(wt)}}const ze=/%(\d[a-f0-9])/gi,le={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Ke(dn){return encodeURIComponent(dn).replace(ze,(wt,Pt)=>le[Pt]??wt)}function Oe(dn){return`${dn}`}class Q{constructor(wt={}){if(this.updates=null,this.cloneFrom=null,this.encoder=wt.encoder||new xe,wt.fromString){if(wt.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function fe(dn,wt){const Pt=new Map;return dn.length>0&&dn.replace(/^\?/,"").split("&").forEach(Ue=>{const se=Ue.indexOf("="),[R,z]=-1==se?[wt.decodeKey(Ue),""]:[wt.decodeKey(Ue.slice(0,se)),wt.decodeValue(Ue.slice(se+1))],ce=Pt.get(R)||[];ce.push(z),Pt.set(R,ce)}),Pt}(wt.fromString,this.encoder)}else wt.fromObject?(this.map=new Map,Object.keys(wt.fromObject).forEach(Pt=>{const gn=wt.fromObject[Pt],Ue=Array.isArray(gn)?gn.map(Oe):[Oe(gn)];this.map.set(Pt,Ue)})):this.map=null}has(wt){return this.init(),this.map.has(wt)}get(wt){this.init();const Pt=this.map.get(wt);return Pt?Pt[0]:null}getAll(wt){return this.init(),this.map.get(wt)||null}keys(){return this.init(),Array.from(this.map.keys())}append(wt,Pt){return this.clone({param:wt,value:Pt,op:"a"})}appendAll(wt){const Pt=[];return Object.keys(wt).forEach(gn=>{const Ue=wt[gn];Array.isArray(Ue)?Ue.forEach(se=>{Pt.push({param:gn,value:se,op:"a"})}):Pt.push({param:gn,value:Ue,op:"a"})}),this.clone(Pt)}set(wt,Pt){return this.clone({param:wt,value:Pt,op:"s"})}delete(wt,Pt){return this.clone({param:wt,value:Pt,op:"d"})}toString(){return this.init(),this.keys().map(wt=>{const Pt=this.encoder.encodeKey(wt);return this.map.get(wt).map(gn=>Pt+"="+this.encoder.encodeValue(gn)).join("&")}).filter(wt=>""!==wt).join("&")}clone(wt){const Pt=new Q({encoder:this.encoder});return Pt.cloneFrom=this.cloneFrom||this,Pt.updates=(this.updates||[]).concat(wt),Pt}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(wt=>this.map.set(wt,this.cloneFrom.map.get(wt))),this.updates.forEach(wt=>{switch(wt.op){case"a":case"s":const Pt=("a"===wt.op?this.map.get(wt.param):void 0)||[];Pt.push(Oe(wt.value)),this.map.set(wt.param,Pt);break;case"d":if(void 0===wt.value){this.map.delete(wt.param);break}{let gn=this.map.get(wt.param)||[];const Ue=gn.indexOf(Oe(wt.value));-1!==Ue&&gn.splice(Ue,1),gn.length>0?this.map.set(wt.param,gn):this.map.delete(wt.param)}}}),this.cloneFrom=this.updates=null)}}class St{constructor(){this.map=new Map}set(wt,Pt){return this.map.set(wt,Pt),this}get(wt){return this.map.has(wt)||this.map.set(wt,wt.defaultValue()),this.map.get(wt)}delete(wt){return this.map.delete(wt),this}has(wt){return this.map.has(wt)}keys(){return this.map.keys()}}function _e(dn){return typeof ArrayBuffer<"u"&&dn instanceof ArrayBuffer}function ke(dn){return typeof Blob<"u"&&dn instanceof Blob}function Ne(dn){return typeof FormData<"u"&&dn instanceof FormData}class Xe{constructor(wt,Pt,gn,Ue){let se;if(this.url=Pt,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=wt.toUpperCase(),function lt(dn){switch(dn){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||Ue?(this.body=void 0!==gn?gn:null,se=Ue):se=gn,se&&(this.reportProgress=!!se.reportProgress,this.withCredentials=!!se.withCredentials,se.responseType&&(this.responseType=se.responseType),se.headers&&(this.headers=se.headers),se.context&&(this.context=se.context),se.params&&(this.params=se.params)),this.headers||(this.headers=new Ve),this.context||(this.context=new St),this.params){const R=this.params.toString();if(0===R.length)this.urlWithParams=Pt;else{const z=Pt.indexOf("?");this.urlWithParams=Pt+(-1===z?"?":z<Pt.length-1?"&":"")+R}}else this.params=new Q,this.urlWithParams=Pt}serializeBody(){return null===this.body?null:_e(this.body)||ke(this.body)||Ne(this.body)||function we(dn){return typeof URLSearchParams<"u"&&dn instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Q?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Ne(this.body)?null:ke(this.body)?this.body.type||null:_e(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Q?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(wt={}){const Pt=wt.method||this.method,gn=wt.url||this.url,Ue=wt.responseType||this.responseType,se=void 0!==wt.body?wt.body:this.body,R=void 0!==wt.withCredentials?wt.withCredentials:this.withCredentials,z=void 0!==wt.reportProgress?wt.reportProgress:this.reportProgress;let ce=wt.headers||this.headers,Be=wt.params||this.params;const tt=wt.context??this.context;return void 0!==wt.setHeaders&&(ce=Object.keys(wt.setHeaders).reduce((Rt,At)=>Rt.set(At,wt.setHeaders[At]),ce)),wt.setParams&&(Be=Object.keys(wt.setParams).reduce((Rt,At)=>Rt.set(At,wt.setParams[At]),Be)),new Xe(Pt,gn,se,{params:Be,headers:ce,context:tt,reportProgress:z,responseType:Ue,withCredentials:R})}}var We=(()=>((We=We||{})[We.Sent=0]="Sent",We[We.UploadProgress=1]="UploadProgress",We[We.ResponseHeader=2]="ResponseHeader",We[We.DownloadProgress=3]="DownloadProgress",We[We.Response=4]="Response",We[We.User=5]="User",We))();class ge{constructor(wt,Pt=200,gn="OK"){this.headers=wt.headers||new Ve,this.status=void 0!==wt.status?wt.status:Pt,this.statusText=wt.statusText||gn,this.url=wt.url||null,this.ok=this.status>=200&&this.status<300}}class de extends ge{constructor(wt={}){super(wt),this.type=We.ResponseHeader}clone(wt={}){return new de({headers:wt.headers||this.headers,status:void 0!==wt.status?wt.status:this.status,statusText:wt.statusText||this.statusText,url:wt.url||this.url||void 0})}}class oe extends ge{constructor(wt={}){super(wt),this.type=We.Response,this.body=void 0!==wt.body?wt.body:null}clone(wt={}){return new oe({body:void 0!==wt.body?wt.body:this.body,headers:wt.headers||this.headers,status:void 0!==wt.status?wt.status:this.status,statusText:wt.statusText||this.statusText,url:wt.url||this.url||void 0})}}class Ee extends ge{constructor(wt){super(wt,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${wt.url||"(unknown url)"}`:`Http failure response for ${wt.url||"(unknown url)"}: ${wt.status} ${wt.statusText}`,this.error=wt.error||null}}function vt(dn,wt){return{body:wt,headers:dn.headers,context:dn.context,observe:dn.observe,params:dn.params,reportProgress:dn.reportProgress,responseType:dn.responseType,withCredentials:dn.withCredentials}}let Tt=(()=>{class dn{constructor(Pt){this.handler=Pt}request(Pt,gn,Ue={}){let se;if(Pt instanceof Xe)se=Pt;else{let ce,Be;ce=Ue.headers instanceof Ve?Ue.headers:new Ve(Ue.headers),Ue.params&&(Be=Ue.params instanceof Q?Ue.params:new Q({fromObject:Ue.params})),se=new Xe(Pt,gn,void 0!==Ue.body?Ue.body:null,{headers:ce,context:Ue.context,params:Be,reportProgress:Ue.reportProgress,responseType:Ue.responseType||"json",withCredentials:Ue.withCredentials})}const R=(0,te.of)(se).pipe((0,q.b)(ce=>this.handler.handle(ce)));if(Pt instanceof Xe||"events"===Ue.observe)return R;const z=R.pipe((0,re.h)(ce=>ce instanceof oe));switch(Ue.observe||"body"){case"body":switch(se.responseType){case"arraybuffer":return z.pipe((0,b.U)(ce=>{if(null!==ce.body&&!(ce.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return ce.body}));case"blob":return z.pipe((0,b.U)(ce=>{if(null!==ce.body&&!(ce.body instanceof Blob))throw new Error("Response is not a Blob.");return ce.body}));case"text":return z.pipe((0,b.U)(ce=>{if(null!==ce.body&&"string"!=typeof ce.body)throw new Error("Response is not a string.");return ce.body}));default:return z.pipe((0,b.U)(ce=>ce.body))}case"response":return z;default:throw new Error(`Unreachable: unhandled observe type ${Ue.observe}}`)}}delete(Pt,gn={}){return this.request("DELETE",Pt,gn)}get(Pt,gn={}){return this.request("GET",Pt,gn)}head(Pt,gn={}){return this.request("HEAD",Pt,gn)}jsonp(Pt,gn){return this.request("JSONP",Pt,{params:(new Q).append(gn,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Pt,gn={}){return this.request("OPTIONS",Pt,gn)}patch(Pt,gn,Ue={}){return this.request("PATCH",Pt,vt(Ue,gn))}post(Pt,gn,Ue={}){return this.request("POST",Pt,vt(Ue,gn))}put(Pt,gn,Ue={}){return this.request("PUT",Pt,vt(Ue,gn))}}return dn.\u0275fac=function(Pt){return new(Pt||dn)(y.LFG(he))},dn.\u0275prov=y.Yz7({token:dn,factory:dn.\u0275fac}),dn})();function Gt(dn,wt){return wt(dn)}function Ot(dn,wt){return(Pt,gn)=>wt.intercept(Pt,{handle:Ue=>dn(Ue,gn)})}const Mt=new y.OlP("HTTP_INTERCEPTORS"),gt=new y.OlP("HTTP_INTERCEPTOR_FNS");function it(){let dn=null;return(wt,Pt)=>(null===dn&&(dn=((0,y.f3M)(Mt,{optional:!0})??[]).reduceRight(Ot,Gt)),dn(wt,Pt))}let at=(()=>{class dn extends he{constructor(Pt,gn){super(),this.backend=Pt,this.injector=gn,this.chain=null}handle(Pt){if(null===this.chain){const gn=Array.from(new Set(this.injector.get(gt)));this.chain=gn.reduceRight((Ue,se)=>function yt(dn,wt,Pt){return(gn,Ue)=>Pt.runInContext(()=>wt(gn,se=>dn(se,Ue)))}(Ue,se,this.injector),Gt)}return this.chain(Pt,gn=>this.backend.handle(gn))}}return dn.\u0275fac=function(Pt){return new(Pt||dn)(y.LFG(Me),y.LFG(y.lqb))},dn.\u0275prov=y.Yz7({token:dn,factory:dn.\u0275fac}),dn})();const ri=/^\)\]\}',?\n/;let pi=(()=>{class dn{constructor(Pt){this.xhrFactory=Pt}handle(Pt){if("JSONP"===Pt.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new l.y(gn=>{const Ue=this.xhrFactory.build();if(Ue.open(Pt.method,Pt.urlWithParams),Pt.withCredentials&&(Ue.withCredentials=!0),Pt.headers.forEach((ye,be)=>Ue.setRequestHeader(ye,be.join(","))),Pt.headers.has("Accept")||Ue.setRequestHeader("Accept","application/json, text/plain, */*"),!Pt.headers.has("Content-Type")){const ye=Pt.detectContentTypeHeader();null!==ye&&Ue.setRequestHeader("Content-Type",ye)}if(Pt.responseType){const ye=Pt.responseType.toLowerCase();Ue.responseType="json"!==ye?ye:"text"}const se=Pt.serializeBody();let R=null;const z=()=>{if(null!==R)return R;const ye=Ue.statusText||"OK",be=new Ve(Ue.getAllResponseHeaders()),De=function Bn(dn){return"responseURL"in dn&&dn.responseURL?dn.responseURL:/^X-Request-URL:/m.test(dn.getAllResponseHeaders())?dn.getResponseHeader("X-Request-URL"):null}(Ue)||Pt.url;return R=new de({headers:be,status:Ue.status,statusText:ye,url:De}),R},ce=()=>{let{headers:ye,status:be,statusText:De,url:dt}=z(),pt=null;204!==be&&(pt=typeof Ue.response>"u"?Ue.responseText:Ue.response),0===be&&(be=pt?200:0);let on=be>=200&&be<300;if("json"===Pt.responseType&&"string"==typeof pt){const Dn=pt;pt=pt.replace(ri,"");try{pt=""!==pt?JSON.parse(pt):null}catch(Nn){pt=Dn,on&&(on=!1,pt={error:Nn,text:pt})}}on?(gn.next(new oe({body:pt,headers:ye,status:be,statusText:De,url:dt||void 0})),gn.complete()):gn.error(new Ee({error:pt,headers:ye,status:be,statusText:De,url:dt||void 0}))},Be=ye=>{const{url:be}=z(),De=new Ee({error:ye,status:Ue.status||0,statusText:Ue.statusText||"Unknown Error",url:be||void 0});gn.error(De)};let tt=!1;const Rt=ye=>{tt||(gn.next(z()),tt=!0);let be={type:We.DownloadProgress,loaded:ye.loaded};ye.lengthComputable&&(be.total=ye.total),"text"===Pt.responseType&&Ue.responseText&&(be.partialText=Ue.responseText),gn.next(be)},At=ye=>{let be={type:We.UploadProgress,loaded:ye.loaded};ye.lengthComputable&&(be.total=ye.total),gn.next(be)};return Ue.addEventListener("load",ce),Ue.addEventListener("error",Be),Ue.addEventListener("timeout",Be),Ue.addEventListener("abort",Be),Pt.reportProgress&&(Ue.addEventListener("progress",Rt),null!==se&&Ue.upload&&Ue.upload.addEventListener("progress",At)),Ue.send(se),gn.next({type:We.Sent}),()=>{Ue.removeEventListener("error",Be),Ue.removeEventListener("abort",Be),Ue.removeEventListener("load",ce),Ue.removeEventListener("timeout",Be),Pt.reportProgress&&(Ue.removeEventListener("progress",Rt),null!==se&&Ue.upload&&Ue.upload.removeEventListener("progress",At)),Ue.readyState!==Ue.DONE&&Ue.abort()}})}}return dn.\u0275fac=function(Pt){return new(Pt||dn)(y.LFG(d.JF))},dn.\u0275prov=y.Yz7({token:dn,factory:dn.\u0275fac}),dn})();const bi=new y.OlP("XSRF_ENABLED"),vi="XSRF-TOKEN",Li=new y.OlP("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>vi}),Si="X-XSRF-TOKEN",Fi=new y.OlP("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>Si});class Yi{}let Zt=(()=>{class dn{constructor(Pt,gn,Ue){this.doc=Pt,this.platform=gn,this.cookieName=Ue,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Pt=this.doc.cookie||"";return Pt!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,d.Mx)(Pt,this.cookieName),this.lastCookieString=Pt),this.lastToken}}return dn.\u0275fac=function(Pt){return new(Pt||dn)(y.LFG(d.K0),y.LFG(y.Lbi),y.LFG(Li))},dn.\u0275prov=y.Yz7({token:dn,factory:dn.\u0275fac}),dn})();function It(dn,wt){const Pt=dn.url.toLowerCase();if(!(0,y.f3M)(bi)||"GET"===dn.method||"HEAD"===dn.method||Pt.startsWith("http://")||Pt.startsWith("https://"))return wt(dn);const gn=(0,y.f3M)(Yi).getToken(),Ue=(0,y.f3M)(Fi);return null!=gn&&!dn.headers.has(Ue)&&(dn=dn.clone({headers:dn.headers.set(Ue,gn)})),wt(dn)}var ne=(()=>((ne=ne||{})[ne.Interceptors=0]="Interceptors",ne[ne.LegacyInterceptors=1]="LegacyInterceptors",ne[ne.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",ne[ne.NoXsrfProtection=3]="NoXsrfProtection",ne[ne.JsonpSupport=4]="JsonpSupport",ne[ne.RequestsMadeViaParent=5]="RequestsMadeViaParent",ne))();function Je(dn,wt){return{\u0275kind:dn,\u0275providers:wt}}function jt(...dn){const wt=[Tt,pi,at,{provide:he,useExisting:at},{provide:Me,useExisting:pi},{provide:gt,useValue:It,multi:!0},{provide:bi,useValue:!0},{provide:Yi,useClass:Zt}];for(const Pt of dn)wt.push(...Pt.\u0275providers);return(0,y.MR2)(wt)}const li=new y.OlP("LEGACY_INTERCEPTOR_FN");function tr({cookieName:dn,headerName:wt}){const Pt=[];return void 0!==dn&&Pt.push({provide:Li,useValue:dn}),void 0!==wt&&Pt.push({provide:Fi,useValue:wt}),Je(ne.CustomXsrfConfiguration,Pt)}let wr=(()=>{class dn{}return dn.\u0275fac=function(Pt){return new(Pt||dn)},dn.\u0275mod=y.oAB({type:dn}),dn.\u0275inj=y.cJS({providers:[jt(Je(ne.LegacyInterceptors,[{provide:li,useFactory:it},{provide:gt,useExisting:li,multi:!0}]),tr({cookieName:vi,headerName:Si}))]}),dn})()},8274:(Pn,Et,k)=>{"use strict";k.d(Et,{tb:()=>f0,AFp:()=>d0,ip1:()=>u0,CZH:()=>Ug,hGG:()=>Db,z2F:()=>jg,sBO:()=>ub,Sil:()=>G1,_Vd:()=>Dd,EJc:()=>$1,Xts:()=>_h,SBq:()=>iu,lqb:()=>tu,qLn:()=>Vl,vpe:()=>kc,XFs:()=>Zt,OlP:()=>Ar,zs3:()=>Ac,ZZ4:()=>Ay,aQg:()=>Py,soG:()=>Vg,YKP:()=>mv,h0i:()=>ap,PXZ:()=>rb,R0b:()=>Wl,FiY:()=>Ze,Lbi:()=>U1,g9A:()=>p0,Qsj:()=>f_,FYo:()=>Id,JOm:()=>ko,tp0:()=>_t,Rgc:()=>Jf,dDg:()=>eb,eoX:()=>b0,GfV:()=>Em,s_b:()=>Bg,ifc:()=>dt,MMx:()=>oy,Lck:()=>Bx,eFA:()=>T0,G48:()=>cb,Gpc:()=>Ke,f3M:()=>se,$WT:()=>mr,MR2:()=>u_,_c5:()=>Eb,c2e:()=>V1,zSh:()=>zp,wAp:()=>Pi,vHH:()=>_e,lri:()=>v0,rWj:()=>x0,D6c:()=>Ib,cg1:()=>Hl,kL8:()=>Ag,dqk:()=>Qt,Z0I:()=>ri,CqO:()=>Sl,QGY:()=>ll,F4k:()=>uc,RDi:()=>Jc,AaK:()=>fe,qOj:()=>Bd,TTD:()=>ji,_Bn:()=>fv,jDz:()=>_v,xp6:()=>ed,uIk:()=>wf,ekj:()=>Z,Suo:()=>Uv,Xpm:()=>ki,lG2:()=>eo,Yz7:()=>ot,cJS:()=>bn,oAB:()=>Xt,Yjl:()=>wo,Y36:()=>td,_UZ:()=>If,GkF:()=>Xh,BQk:()=>Jh,ynx:()=>Wd,qZA:()=>Lc,TgZ:()=>Yh,EpF:()=>ja,n5z:()=>Mu,LFG:()=>gn,$8M:()=>ta,$Z:()=>Zm,NdJ:()=>Zl,CRH:()=>Vv,oxw:()=>vg,ALo:()=>Av,lcZ:()=>Pv,xi3:()=>Ov,Hsn:()=>Pf,F$t:()=>Af,Q6J:()=>Tf,s9C:()=>Qh,DdM:()=>Tv,iGM:()=>Nv,MAs:()=>_g,KtG:()=>ul,CHM:()=>Pa,LSH:()=>wd,P3R:()=>ym,Udp:()=>N,YNc:()=>Hd,_uU:()=>qn,Oqu:()=>ei,hij:()=>jn,AsE:()=>_i,lnq:()=>Ji,HOy:()=>Wi,Gf:()=>zv});var d=k(7579),y=k(727),te=k(9751),l=k(8189),q=k(8421),re=k(515),b=k(7669),he=k(2076),Ve=k(3099);function X(r){for(let o in r)if(r[o]===X)return o;throw Error("Could not find renamed property on target object.")}function xe(r,o){for(const c in o)o.hasOwnProperty(c)&&!r.hasOwnProperty(c)&&(r[c]=o[c])}function fe(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(fe).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const o=r.toString();if(null==o)return""+o;const c=o.indexOf("\n");return-1===c?o:o.substring(0,c)}function ze(r,o){return null==r||""===r?null===o?"":o:null==o||""===o?r:r+" "+o}const le=X({__forward_ref__:X});function Ke(r){return r.__forward_ref__=Ke,r.toString=function(){return fe(this())},r}function Oe(r){return Q(r)?r():r}function Q(r){return"function"==typeof r&&r.hasOwnProperty(le)&&r.__forward_ref__===Ke}function Ye(r){return r&&!!r.\u0275providers}const lt="https://g.co/ng/security#xss";class _e extends Error{constructor(o,c){super(function ke(r,o){return`NG0${Math.abs(r)}${o?": "+o.trim():""}`}(o,c)),this.code=o}}function Ne(r){return"string"==typeof r?r:null==r?"":String(r)}function de(r,o){throw new _e(-201,!1)}function kt(r,o){null==r&&function Vt(r,o,c,g){throw new Error(`ASSERTION ERROR: ${r}`+(null==g?"":` [Expected=> ${c} ${g} ${o} <=Actual]`))}(o,r,null,"!=")}function ot(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function bn(r){return{providers:r.providers||[],imports:r.imports||[]}}function Kn(r){return Bn(r,Li)||Bn(r,Fi)}function ri(r){return null!==Kn(r)}function Bn(r,o){return r.hasOwnProperty(o)?r[o]:null}function vi(r){return r&&(r.hasOwnProperty(Si)||r.hasOwnProperty(Yi))?r[Si]:null}const Li=X({\u0275prov:X}),Si=X({\u0275inj:X}),Fi=X({ngInjectableDef:X}),Yi=X({ngInjectorDef:X});var Zt=(()=>((Zt=Zt||{})[Zt.Default=0]="Default",Zt[Zt.Host=1]="Host",Zt[Zt.Self=2]="Self",Zt[Zt.SkipSelf=4]="SkipSelf",Zt[Zt.Optional=8]="Optional",Zt))();let It;function ne(r){const o=It;return It=r,o}function Je(r,o,c){const g=Kn(r);return g&&"root"==g.providedIn?void 0===g.value?g.value=g.factory():g.value:c&Zt.Optional?null:void 0!==o?o:void de(fe(r))}const Qt=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),fi={},yr="__NG_DI_FLAG__",Ai="ngTempTokenPath",wr=/\n/gm,si="__source";let dn;function wt(r){const o=dn;return dn=r,o}function Pt(r,o=Zt.Default){if(void 0===dn)throw new _e(-203,!1);return null===dn?Je(r,void 0,o):dn.get(r,o&Zt.Optional?null:void 0,o)}function gn(r,o=Zt.Default){return(function He(){return It}()||Pt)(Oe(r),o)}function se(r,o=Zt.Default){return gn(r,R(o))}function R(r){return typeof r>"u"||"number"==typeof r?r:0|(r.optional&&8)|(r.host&&1)|(r.self&&2)|(r.skipSelf&&4)}function z(r){const o=[];for(let c=0;c<r.length;c++){const g=Oe(r[c]);if(Array.isArray(g)){if(0===g.length)throw new _e(900,!1);let w,E=Zt.Default;for(let O=0;O<g.length;O++){const B=g[O],$=Be(B);"number"==typeof $?-1===$?w=B.token:E|=$:w=B}o.push(gn(w,E))}else o.push(gn(g))}return o}function ce(r,o){return r[yr]=o,r.prototype[yr]=o,r}function Be(r){return r[yr]}function At(r){return{toString:r}.toString()}var ye=(()=>((ye=ye||{})[ye.OnPush=0]="OnPush",ye[ye.Default=1]="Default",ye))(),dt=(()=>{return(r=dt||(dt={}))[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",dt;var r})();const pt={},on=[],Dn=X({\u0275cmp:X}),Nn=X({\u0275dir:X}),Wn=X({\u0275pipe:X}),Ei=X({\u0275mod:X}),di=X({\u0275fac:X}),Hn=X({__NG_ELEMENT_ID__:X});let Vi=0;function ki(r){return At(()=>{const c=!0===r.standalone,g={},w={type:r.type,providersResolver:null,decls:r.decls,vars:r.vars,factory:null,template:r.template||null,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:g,inputs:null,outputs:null,exportAs:r.exportAs||null,onPush:r.changeDetection===ye.OnPush,directiveDefs:null,pipeDefs:null,standalone:c,dependencies:c&&r.dependencies||null,getStandaloneInjector:null,selectors:r.selectors||on,viewQuery:r.viewQuery||null,features:r.features||null,data:r.data||{},encapsulation:r.encapsulation||dt.Emulated,id:"c"+Vi++,styles:r.styles||on,_:null,setInput:null,schemas:r.schemas||null,tView:null,findHostDirectiveDefs:null,hostDirectives:null},E=r.dependencies,O=r.features;return w.inputs=vr(r.inputs,g),w.outputs=vr(r.outputs),O&&O.forEach(B=>B(w)),w.directiveDefs=E?()=>("function"==typeof E?E():E).map(Tr).filter(Or):null,w.pipeDefs=E?()=>("function"==typeof E?E():E).map(Er).filter(Or):null,w})}function Tr(r){return mi(r)||Qi(r)}function Or(r){return null!==r}function Xt(r){return At(()=>({type:r.type,bootstrap:r.bootstrap||on,declarations:r.declarations||on,imports:r.imports||on,exports:r.exports||on,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function vr(r,o){if(null==r)return pt;const c={};for(const g in r)if(r.hasOwnProperty(g)){let w=r[g],E=w;Array.isArray(w)&&(E=w[1],w=w[0]),c[w]=g,o&&(o[w]=E)}return c}const eo=ki;function wo(r){return{type:r.type,name:r.name,factory:null,pure:!1!==r.pure,standalone:!0===r.standalone,onDestroy:r.type.prototype.ngOnDestroy||null}}function mi(r){return r[Dn]||null}function Qi(r){return r[Nn]||null}function Er(r){return r[Wn]||null}function mr(r){const o=mi(r)||Qi(r)||Er(r);return null!==o&&o.standalone}function Rn(r,o){const c=r[Ei]||null;if(!c&&!0===o)throw new Error(`Type ${fe(r)} does not have '\u0275mod' property.`);return c}function qr(r){return Array.isArray(r)&&"object"==typeof r[1]}function gr(r){return Array.isArray(r)&&!0===r[1]}function zo(r){return 0!=(4&r.flags)}function ys(r){return r.componentOffset>-1}function co(r){return 1==(1&r.flags)}function to(r){return null!==r.template}function Fs(r){return 0!=(256&r[2])}function Ro(r,o){return r.hasOwnProperty(di)?r[di]:null}class Uo{constructor(o,c,g){this.previousValue=o,this.currentValue=c,this.firstChange=g}isFirstChange(){return this.firstChange}}function ji(){return qs}function qs(r){return r.type.prototype.ngOnChanges&&(r.setInput=Vo),Ys}function Ys(){const r=ws(this),o=r?.current;if(o){const c=r.previous;if(c===pt)r.previous=o;else for(let g in o)c[g]=o[g];r.current=null,this.ngOnChanges(o)}}function Vo(r,o,c,g){const w=this.declaredInputs[c],E=ws(r)||function Cs(r,o){return r[Lo]=o}(r,{previous:pt,current:null}),O=E.current||(E.current={}),B=E.previous,$=B[w];O[w]=new Uo($&&$.currentValue,o,B===pt),r[g]=o}ji.ngInherit=!0;const Lo="__ngSimpleChanges__";function ws(r){return r[Lo]||null}function Xr(r){for(;Array.isArray(r);)r=r[0];return r}function Yo(r,o){return Xr(o[r])}function wi(r,o){return Xr(o[r.index])}function Aa(r,o){return r.data[o]}function ds(r,o){return r[o]}function Dr(r,o){const c=o[r];return qr(c)?c:c[0]}function Jo(r){return 64==(64&r[2])}function K(r,o){return null==o?null:r[o]}function Y(r){r[18]=0}function G(r,o){r[5]+=o;let c=r,g=r[3];for(;null!==g&&(1===o&&1===c[5]||-1===o&&0===c[5]);)g[5]+=o,c=g,g=g[3]}const Ie={lFrame:ql(null),bindingsEnabled:!0};function So(){return Ie.bindingsEnabled}function Sn(){return Ie.lFrame.lView}function Ri(){return Ie.lFrame.tView}function Pa(r){return Ie.lFrame.contextLView=r,r[8]}function ul(r){return Ie.lFrame.contextLView=null,r}function ao(){let r=pc();for(;null!==r&&64===r.type;)r=r.parent;return r}function pc(){return Ie.lFrame.currentTNode}function $o(r,o){const c=Ie.lFrame;c.currentTNode=r,c.isParent=o}function Es(){return Ie.lFrame.isParent}function Xo(){Ie.lFrame.isParent=!1}function M(){const r=Ie.lFrame;let o=r.bindingRootIndex;return-1===o&&(o=r.bindingRootIndex=r.tView.bindingStartIndex),o}function j(){return Ie.lFrame.bindingIndex}function V(){return Ie.lFrame.bindingIndex++}function ve(r){const o=Ie.lFrame,c=o.bindingIndex;return o.bindingIndex=o.bindingIndex+r,c}function zn(r,o){const c=Ie.lFrame;c.bindingIndex=c.bindingRootIndex=r,ti(o)}function ti(r){Ie.lFrame.currentDirectiveIndex=r}function nr(){return Ie.lFrame.currentQueryIndex}function cr(r){Ie.lFrame.currentQueryIndex=r}function yo(r){const o=r[1];return 2===o.type?o.declTNode:1===o.type?r[6]:null}function vo(r,o,c){if(c&Zt.SkipSelf){let w=o,E=r;for(;!(w=w.parent,null!==w||c&Zt.Host||(w=yo(E),null===w||(E=E[15],10&w.type))););if(null===w)return!1;o=w,r=E}const g=Ie.lFrame=Ko();return g.currentTNode=o,g.lView=r,!0}function Ds(r){const o=Ko(),c=r[1];Ie.lFrame=o,o.currentTNode=c.firstChild,o.lView=r,o.tView=c,o.contextLView=r,o.bindingIndex=c.bindingStartIndex,o.inI18n=!1}function Ko(){const r=Ie.lFrame,o=null===r?null:r.child;return null===o?ql(r):o}function ql(r){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=o),o}function hl(){const r=Ie.lFrame;return Ie.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const ga=hl;function Zo(){const r=hl();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function Rr(){return Ie.lFrame.selectedIndex}function hs(r){Ie.lFrame.selectedIndex=r}function Sr(){const r=Ie.lFrame;return Aa(r.tView,r.selectedIndex)}function Se(r,o){for(let c=o.directiveStart,g=o.directiveEnd;c<g;c++){const E=r.data[c].type.prototype,{ngAfterContentInit:O,ngAfterContentChecked:B,ngAfterViewInit:$,ngAfterViewChecked:ie,ngOnDestroy:Ae}=E;O&&(r.contentHooks||(r.contentHooks=[])).push(-c,O),B&&((r.contentHooks||(r.contentHooks=[])).push(c,B),(r.contentCheckHooks||(r.contentCheckHooks=[])).push(c,B)),$&&(r.viewHooks||(r.viewHooks=[])).push(-c,$),ie&&((r.viewHooks||(r.viewHooks=[])).push(c,ie),(r.viewCheckHooks||(r.viewCheckHooks=[])).push(c,ie)),null!=Ae&&(r.destroyHooks||(r.destroyHooks=[])).push(c,Ae)}}function ht(r,o,c){ai(r,o,3,c)}function un(r,o,c,g){(3&r[2])===c&&ai(r,o,c,g)}function Tn(r,o){let c=r[2];(3&c)===o&&(c&=2047,c+=1,r[2]=c)}function ai(r,o,c,g){const E=g??-1,O=o.length-1;let B=0;for(let $=void 0!==g?65535&r[18]:0;$<O;$++)if("number"==typeof o[$+1]){if(B=o[$],null!=g&&B>=g)break}else o[$]<0&&(r[18]+=65536),(B<E||-1==E)&&(rr(r,c,o,$),r[18]=(4294901760&r[18])+$+2),$++}function rr(r,o,c,g){const w=c[g]<0,E=c[g+1],B=r[w?-c[g]:c[g]];if(w){if(r[2]>>11<r[18]>>16&&(3&r[2])===o){r[2]+=2048;try{E.call(B)}finally{}}}else try{E.call(B)}finally{}}class Hi{constructor(o,c,g){this.factory=o,this.resolving=!1,this.canSeeViewProviders=c,this.injectImpl=g}}function Oa(r,o,c){let g=0;for(;g<c.length;){const w=c[g];if("number"==typeof w){if(0!==w)break;g++;const E=c[g++],O=c[g++],B=c[g++];r.setAttribute(o,O,B,E)}else{const E=w,O=c[++g];ml(E)?r.setProperty(o,E,O):r.setAttribute(o,E,O),g++}}return g}function Qs(r){return 3===r||4===r||6===r}function ml(r){return 64===r.charCodeAt(0)}function ya(r,o){if(null!==o&&0!==o.length)if(null===r||0===r.length)r=o.slice();else{let c=-1;for(let g=0;g<o.length;g++){const w=o[g];"number"==typeof w?c=w:0===c||gl(r,c,w,null,-1===c||2===c?o[++g]:null)}}return r}function gl(r,o,c,g,w){let E=0,O=r.length;if(-1===o)O=-1;else for(;E<r.length;){const B=r[E++];if("number"==typeof B){if(B===o){O=-1;break}if(B>o){O=E-1;break}}}for(;E<r.length;){const B=r[E];if("number"==typeof B)break;if(B===c){if(null===g)return void(null!==w&&(r[E+1]=w));if(g===r[E+1])return void(r[E+2]=w)}E++,null!==g&&E++,null!==w&&E++}-1!==O&&(r.splice(O,0,o),E=O+1),r.splice(E++,0,c),null!==g&&r.splice(E++,0,g),null!==w&&r.splice(E++,0,w)}function Ra(r){return-1!==r}function lo(r){return 32767&r}function La(r,o){let c=function _l(r){return r>>16}(r),g=o;for(;c>0;)g=g[15],c--;return g}let mc=!0;function yl(r){const o=mc;return mc=r,o}let _c=0;const Ns={};function Xa(r,o){const c=vl(r,o);if(-1!==c)return c;const g=o[1];g.firstCreatePass&&(r.injectorIndex=o.length,vc(g.data,r),vc(o,null),vc(g.blueprint,null));const w=Jl(r,o),E=r.injectorIndex;if(Ra(w)){const O=lo(w),B=La(w,o),$=B[1].data;for(let ie=0;ie<8;ie++)o[E+ie]=B[O+ie]|$[O+ie]}return o[E+8]=w,E}function vc(r,o){r.push(0,0,0,0,0,0,0,0,o)}function vl(r,o){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===o[r.injectorIndex+8]?-1:r.injectorIndex}function Jl(r,o){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let c=0,g=null,w=o;for(;null!==w;){if(g=zs(w),null===g)return-1;if(c++,w=w[15],-1!==g.injectorIndex)return g.injectorIndex|c<<16}return-1}function xc(r,o,c){!function yc(r,o,c){let g;"string"==typeof c?g=c.charCodeAt(0)||0:c.hasOwnProperty(Hn)&&(g=c[Hn]),null==g&&(g=c[Hn]=_c++);const w=255&g;o.data[r+(w>>5)]|=1<<w}(r,o,c)}function va(r,o,c){if(c&Zt.Optional||void 0!==r)return r;de()}function bc(r,o,c,g){if(c&Zt.Optional&&void 0===g&&(g=null),!(c&(Zt.Self|Zt.Host))){const w=r[9],E=ne(void 0);try{return w?w.get(o,g,c&Zt.Optional):Je(o,g,c&Zt.Optional)}finally{ne(E)}}return va(g,0,c)}function Bc(r,o,c,g=Zt.Default,w){if(null!==r){if(1024&o[2]){const O=function Uc(r,o,c,g,w){let E=r,O=o;for(;null!==E&&null!==O&&1024&O[2]&&!(256&O[2]);){const B=Nc(E,O,c,g|Zt.Self,Ns);if(B!==Ns)return B;let $=E.parent;if(!$){const ie=O[21];if(ie){const Ae=ie.get(c,Ns,g);if(Ae!==Ns)return Ae}$=zs(O),O=O[15]}E=$}return w}(r,o,c,g,Ns);if(O!==Ns)return O}const E=Nc(r,o,c,g,Ns);if(E!==Ns)return E}return bc(o,c,g,w)}function Nc(r,o,c,g,w){const E=function Iu(r){if("string"==typeof r)return r.charCodeAt(0)||0;const o=r.hasOwnProperty(Hn)?r[Hn]:void 0;return"number"==typeof o?o>=0?255&o:Xd:o}(c);if("function"==typeof E){if(!vo(o,r,g))return g&Zt.Host?va(w,0,g):bc(o,c,g,w);try{const O=E(g);if(null!=O||g&Zt.Optional)return O;de()}finally{ga()}}else if("number"==typeof E){let O=null,B=vl(r,o),$=-1,ie=g&Zt.Host?o[16][6]:null;for((-1===B||g&Zt.SkipSelf)&&($=-1===B?Jl(r,o):o[B+8],-1!==$&&zc(g,!1)?(O=o[1],B=lo($),o=La($,o)):B=-1);-1!==B;){const Ae=o[1];if(Fo(E,B,Ae.data)){const nt=Qo(B,o,c,O,g,ie);if(nt!==Ns)return nt}$=o[B+8],-1!==$&&zc(g,o[1].data[B+8]===ie)&&Fo(E,B,o)?(O=Ae,B=lo($),o=La($,o)):B=-1}}return w}function Qo(r,o,c,g,w,E){const O=o[1],B=O.data[r+8],Ae=xl(B,O,c,null==g?ys(B)&&mc:g!=O&&0!=(3&B.type),w&Zt.Host&&E===B);return null!==Ae?ea(o,O,Ae,B):Ns}function xl(r,o,c,g,w){const E=r.providerIndexes,O=o.data,B=1048575&E,$=r.directiveStart,Ae=E>>20,Bt=w?B+Ae:r.directiveEnd;for(let nn=g?B:B+Ae;nn<Bt;nn++){const En=O[nn];if(nn<$&&c===En||nn>=$&&En.type===c)return nn}if(w){const nn=O[$];if(nn&&to(nn)&&nn.type===c)return $}return null}function ea(r,o,c,g){let w=r[c];const E=o.data;if(function Xi(r){return r instanceof Hi}(w)){const O=w;O.resolving&&function Xe(r,o){const c=o?`. Dependency path: ${o.join(" > ")} > ${r}`:"";throw new _e(-200,`Circular dependency in DI detected for ${r}${c}`)}(function we(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():Ne(r)}(E[c]));const B=yl(O.canSeeViewProviders);O.resolving=!0;const $=O.injectImpl?ne(O.injectImpl):null;vo(r,g,Zt.Default);try{w=r[c]=O.factory(void 0,E,r,g),o.firstCreatePass&&c>=g.directiveStart&&function H(r,o,c){const{ngOnChanges:g,ngOnInit:w,ngDoCheck:E}=o.type.prototype;if(g){const O=qs(o);(c.preOrderHooks||(c.preOrderHooks=[])).push(r,O),(c.preOrderCheckHooks||(c.preOrderCheckHooks=[])).push(r,O)}w&&(c.preOrderHooks||(c.preOrderHooks=[])).push(0-r,w),E&&((c.preOrderHooks||(c.preOrderHooks=[])).push(r,E),(c.preOrderCheckHooks||(c.preOrderCheckHooks=[])).push(r,E))}(c,E[c],o)}finally{null!==$&&ne($),yl(B),O.resolving=!1,ga()}}return w}function Fo(r,o,c){return!!(c[o+(r>>5)]&1<<r)}function zc(r,o){return!(r&Zt.Self||r&Zt.Host&&o)}class bl{constructor(o,c){this._tNode=o,this._lView=c}get(o,c,g){return Bc(this._tNode,this._lView,o,R(g),c)}}function Xd(){return new bl(ao(),Sn())}function Mu(r){return At(()=>{const o=r.prototype.constructor,c=o[di]||Is(o),g=Object.prototype;let w=Object.getPrototypeOf(r.prototype).constructor;for(;w&&w!==g;){const E=w[di]||Is(w);if(E&&E!==c)return E;w=Object.getPrototypeOf(w)}return E=>new E})}function Is(r){return Q(r)?()=>{const o=Is(Oe(r));return o&&o()}:Ro(r)}function zs(r){const o=r[1],c=o.type;return 2===c?o.declTNode:1===c?r[6]:null}function ta(r){return function Xl(r,o){if("class"===o)return r.classes;if("style"===o)return r.styles;const c=r.attrs;if(c){const g=c.length;let w=0;for(;w<g;){const E=c[w];if(Qs(E))break;if(0===E)w+=2;else if("number"==typeof E)for(w++;w<g&&"string"==typeof c[w];)w++;else{if(E===o)return c[w+1];w+=2}}}return null}(ao(),r)}const Zn="__parameters__";function Ba(r,o,c){return At(()=>{const g=function ka(r){return function(...c){if(r){const g=r(...c);for(const w in g)this[w]=g[w]}}}(o);function w(...E){if(this instanceof w)return g.apply(this,E),this;const O=new w(...E);return B.annotation=O,B;function B($,ie,Ae){const nt=$.hasOwnProperty(Zn)?$[Zn]:Object.defineProperty($,Zn,{value:[]})[Zn];for(;nt.length<=Ae;)nt.push(null);return(nt[Ae]=nt[Ae]||[]).push(O),$}}return c&&(w.prototype=Object.create(c.prototype)),w.prototype.ngMetadataName=r,w.annotationCls=w,w})}class Ar{constructor(o,c){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof c?this.__NG_ELEMENT_ID__=c:void 0!==c&&(this.\u0275prov=ot({token:this,providedIn:c.providedIn||"root",factory:c.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Ka(r,o){r.forEach(c=>Array.isArray(c)?Ka(c,o):o(c))}function Tc(r,o,c){o>=r.length?r.push(c):r.splice(o,0,c)}function Qa(r,o){return o>=r.length-1?r.pop():r.splice(o,1)[0]}function m(r,o){const c=[];for(let g=0;g<r;g++)c.push(o);return c}function p(r,o,c){let g=C(r,o);return g>=0?r[1|g]=c:(g=~g,function a(r,o,c,g){let w=r.length;if(w==o)r.push(c,g);else if(1===w)r.push(g,r[0]),r[0]=c;else{for(w--,r.push(r[w-1],r[w]);w>o;)r[w]=r[w-2],w--;r[o]=c,r[o+1]=g}}(r,g,o,c)),g}function v(r,o){const c=C(r,o);if(c>=0)return r[1|c]}function C(r,o){return function P(r,o,c){let g=0,w=r.length>>c;for(;w!==g;){const E=g+(w-g>>1),O=r[E<<c];if(o===O)return E<<c;O>o?w=E:g=E+1}return~(w<<c)}(r,o,1)}const Ze=ce(Ba("Optional"),8),_t=ce(Ba("SkipSelf"),4);var ko=(()=>((ko=ko||{})[ko.Important=1]="Important",ko[ko.DashCase=2]="DashCase",ko))();const Hc=new Map;let eh=0;const nh="__ngContext__";function As(r,o){qr(o)?(r[nh]=o[20],function up(r){Hc.set(r[20],r)}(o)):r[nh]=o}function wl(r,o){return undefined(r,o)}function Bu(r){const o=r[3];return gr(o)?o[3]:o}function gp(r){return rh(r[13])}function _p(r){return rh(r[4])}function rh(r){for(;null!==r&&!gr(r);)r=r[4];return r}function Ll(r,o,c,g,w){if(null!=g){let E,O=!1;gr(g)?E=g:qr(g)&&(O=!0,g=g[0]);const B=Xr(g);0===r&&null!==c?null==w?ar(o,c,B):Bl(o,c,B,w||null,!0):1===r&&null!==c?Bl(o,c,B,w||null,!0):2===r?function Ep(r,o,c){const g=za(r,o);g&&function bp(r,o,c,g){r.removeChild(o,c,g)}(r,g,o,c)}(o,B,O):3===r&&o.destroyNode(B),null!=E&&function qc(r,o,c,g,w){const E=c[7];E!==Xr(c)&&Ll(o,r,g,E,w);for(let B=10;B<c.length;B++){const $=c[B];Uu($[1],$,r,o,g,E)}}(o,r,E,c,w)}}function kl(r,o,c){return r.createElement(o,c)}function yp(r,o){const c=r[9],g=c.indexOf(o),w=o[3];512&o[2]&&(o[2]&=-513,G(w,-1)),c.splice(g,1)}function Nu(r,o){if(r.length<=10)return;const c=10+o,g=r[c];if(g){const w=g[17];null!==w&&w!==r&&yp(w,g),o>0&&(r[c-1][4]=g[4]);const E=Qa(r,10+o);!function Ic(r,o){Uu(r,o,o[11],2,null,null),o[0]=null,o[6]=null}(g[1],g);const O=E[19];null!==O&&O.detachView(E[1]),g[3]=null,g[4]=null,g[2]&=-65}return g}function nl(r,o){if(!(128&o[2])){const c=o[11];c.destroyNode&&Uu(r,o,c,3,null,null),function Yg(r){let o=r[13];if(!o)return vp(r[1],r);for(;o;){let c=null;if(qr(o))c=o[13];else{const g=o[10];g&&(c=g)}if(!c){for(;o&&!o[4]&&o!==r;)qr(o)&&vp(o[1],o),o=o[3];null===o&&(o=r),qr(o)&&vp(o[1],o),c=o&&o[4]}o=c}}(o)}}function vp(r,o){if(!(128&o[2])){o[2]&=-65,o[2]|=128,function Ao(r,o){let c;if(null!=r&&null!=(c=r.destroyHooks))for(let g=0;g<c.length;g+=2){const w=o[c[g]];if(!(w instanceof Hi)){const E=c[g+1];if(Array.isArray(E))for(let O=0;O<E.length;O+=2){const B=w[E[O]],$=E[O+1];try{$.call(B)}finally{}}else try{E.call(w)}finally{}}}}(r,o),function Kg(r,o){const c=r.cleanup,g=o[7];let w=-1;if(null!==c)for(let E=0;E<c.length-1;E+=2)if("string"==typeof c[E]){const O=c[E+3];O>=0?g[w=O]():g[w=-O].unsubscribe(),E+=2}else{const O=g[w=c[E+1]];c[E].call(O)}if(null!==g){for(let E=w+1;E<g.length;E++)(0,g[E])();o[7]=null}}(r,o),1===o[1].type&&o[11].destroy();const c=o[17];if(null!==c&&gr(o[3])){c!==o[3]&&yp(c,o);const g=o[19];null!==g&&g.detachView(r)}!function Qf(r){Hc.delete(r[20])}(o)}}function Di(r,o,c){return function Ql(r,o,c){let g=o;for(;null!==g&&40&g.type;)g=(o=g).parent;if(null===g)return c[0];{const{componentOffset:w}=g;if(w>-1){const{encapsulation:E}=r.data[g.directiveStart+w];if(E===dt.None||E===dt.Emulated)return null}return wi(g,c)}}(r,o.parent,c)}function Bl(r,o,c,g,w){r.insertBefore(o,c,g,w)}function ar(r,o,c){r.appendChild(o,c)}function xp(r,o,c,g,w){null!==g?Bl(r,o,c,g,w):ar(r,o,c)}function za(r,o){return r.parentNode(o)}function Ca(r,o,c){return wp(r,o,c)}let uh,dh,wp=function ts(r,o,c){return 40&r.type?wi(r,c):null};function tc(r,o,c,g){const w=Di(r,g,o),E=o[11],B=Ca(g.parent||o[6],g,o);if(null!=w)if(Array.isArray(c))for(let $=0;$<c.length;$++)xp(E,w,c[$],B,!1);else xp(E,w,c,B,!1)}function zu(r,o){if(null!==o){const c=o.type;if(3&c)return wi(o,r);if(4&c)return _d(-1,r[o.index]);if(8&c){const g=o.child;if(null!==g)return zu(r,g);{const w=r[o.index];return gr(w)?_d(-1,w):Xr(w)}}if(32&c)return wl(o,r)()||Xr(r[o.index]);{const g=Tp(r,o);return null!==g?Array.isArray(g)?g[0]:zu(Bu(r[16]),g):zu(r,o.next)}}return null}function Tp(r,o){return null!==o?r[16][6].projection[o.projection]:null}function _d(r,o){const c=10+r+1;if(c<o.length){const g=o[c],w=g[1].firstChild;if(null!==w)return zu(g,w)}return o[7]}function yd(r,o,c,g,w,E,O){for(;null!=c;){const B=g[c.index],$=c.type;if(O&&0===o&&(B&&As(Xr(B),g),c.flags|=2),32!=(32&c.flags))if(8&$)yd(r,o,c.child,g,w,E,!1),Ll(o,r,w,B,E);else if(32&$){const ie=wl(c,g);let Ae;for(;Ae=ie();)Ll(o,r,w,Ae,E);Ll(o,r,w,B,E)}else 16&$?Nl(r,o,g,c,w,E):Ll(o,r,w,B,E);c=O?c.projectionNext:c.next}}function Uu(r,o,c,g,w,E){yd(c,g,r.firstChild,o,w,E,!1)}function Nl(r,o,c,g,w,E){const O=c[16],$=O[6].projection[g.projection];if(Array.isArray($))for(let ie=0;ie<$.length;ie++)Ll(o,r,w,$[ie],E);else yd(r,o,$,O[3],w,E,!0)}function ah(r,o,c){""===c?r.removeAttribute(o,"class"):r.setAttribute(o,"class",c)}function Dp(r,o,c){const{mergedAttrs:g,classes:w,styles:E}=c;null!==g&&Oa(r,o,g),null!==w&&ah(r,o,w),null!==E&&function sh(r,o,c){r.setAttribute(o,"style",c)}(r,o,E)}function Jc(r){uh=r}function Ap(r){return function Mc(){if(void 0===dh&&(dh=null,Qt.trustedTypes))try{dh=Qt.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:r=>r,createScript:r=>r,createScriptURL:r=>r})}catch{}return dh}()?.createScriptURL(r)||r}class lm{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${lt})`}}function ms(r){return r instanceof lm?r.changingThisBreaksApplicationSecurity:r}function Xc(r,o){const c=function Kc(r){return r instanceof lm&&r.getTypeName()||null}(r);if(null!=c&&c!==o){if("ResourceURL"===c&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${c} (see ${lt})`)}return c===o}const xd=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;var Bo=(()=>((Bo=Bo||{})[Bo.NONE=0]="NONE",Bo[Bo.HTML=1]="HTML",Bo[Bo.STYLE=2]="STYLE",Bo[Bo.SCRIPT=3]="SCRIPT",Bo[Bo.URL=4]="URL",Bo[Bo.RESOURCE_URL=5]="RESOURCE_URL",Bo))();function wd(r){const o=Gu();return o?o.sanitize(Bo.URL,r)||"":Xc(r,"URL")?ms(r):function Sc(r){return(r=String(r)).match(xd)?r:"unsafe:"+r}(Ne(r))}function gh(r){const o=Gu();if(o)return Ap(o.sanitize(Bo.RESOURCE_URL,r)||"");if(Xc(r,"ResourceURL"))return Ap(ms(r));throw new _e(904,!1)}function ym(r,o,c){return function _m(r,o){return"src"===o&&("embed"===r||"frame"===r||"iframe"===r||"media"===r||"script"===r)||"href"===o&&("base"===r||"link"===r)?gh:wd}(o,c)(r)}function Gu(){const r=Sn();return r&&r[12]}const _h=new Ar("ENVIRONMENT_INITIALIZER"),yh=new Ar("INJECTOR",-1),Ul=new Ar("INJECTOR_DEF_TYPES");class sa{get(o,c=fi){if(c===fi){const g=new Error(`NullInjectorError: No provider for ${fe(o)}!`);throw g.name="NullInjectorError",g}return c}}function u_(r){return{\u0275providers:r}}function Bp(...r){return{\u0275providers:vm(0,r),\u0275fromNgModule:!0}}function vm(r,...o){const c=[],g=new Set;let w;return Ka(o,E=>{const O=E;Np(O,c,[],g)&&(w||(w=[]),w.push(O))}),void 0!==w&&xm(w,c),c}function xm(r,o){for(let c=0;c<r.length;c++){const{providers:w}=r[c];Hu(w,E=>{o.push(E)})}}function Np(r,o,c,g){if(!(r=Oe(r)))return!1;let w=null,E=vi(r);const O=!E&&mi(r);if(E||O){if(O&&!O.standalone)return!1;w=r}else{const $=r.ngModule;if(E=vi($),!E)return!1;w=$}const B=g.has(w);if(O){if(B)return!1;if(g.add(w),O.dependencies){const $="function"==typeof O.dependencies?O.dependencies():O.dependencies;for(const ie of $)Np(ie,o,c,g)}}else{if(!E)return!1;{if(null!=E.imports&&!B){let ie;g.add(w);try{Ka(E.imports,Ae=>{Np(Ae,o,c,g)&&(ie||(ie=[]),ie.push(Ae))})}finally{}void 0!==ie&&xm(ie,o)}if(!B){const ie=Ro(w)||(()=>new w);o.push({provide:w,useFactory:ie,deps:on},{provide:Ul,useValue:w,multi:!0},{provide:_h,useValue:()=>gn(w),multi:!0})}const $=E.providers;null==$||B||Hu($,Ae=>{o.push(Ae)})}}return w!==r&&void 0!==r.providers}function Hu(r,o){for(let c of r)Ye(c)&&(c=c.\u0275providers),Array.isArray(c)?Hu(c,o):o(c)}const bm=X({provide:String,useValue:X});function nc(r){return null!==r&&"object"==typeof r&&bm in r}function eu(r){return"function"==typeof r}const zp=new Ar("Set Injector scope."),xh={},h_={};let Up;function qu(){return void 0===Up&&(Up=new sa),Up}class tu{}class nu extends tu{get destroyed(){return this._destroyed}constructor(o,c,g,w){super(),this.parent=c,this.source=g,this.scopes=w,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Ch(o,O=>this.processProvider(O)),this.records.set(yh,ic(void 0,this)),w.has("environment")&&this.records.set(tu,ic(void 0,this));const E=this.records.get(zp);null!=E&&"string"==typeof E.value&&this.scopes.add(E.value),this.injectorDefTypes=new Set(this.get(Ul.multi,on,Zt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const o of this._ngOnDestroyHooks)o.ngOnDestroy();for(const o of this._onDestroyHooks)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(o){this._onDestroyHooks.push(o)}runInContext(o){this.assertNotDestroyed();const c=wt(this),g=ne(void 0);try{return o()}finally{wt(c),ne(g)}}get(o,c=fi,g=Zt.Default){this.assertNotDestroyed(),g=R(g);const w=wt(this),E=ne(void 0);try{if(!(g&Zt.SkipSelf)){let B=this.records.get(o);if(void 0===B){const $=function Cm(r){return"function"==typeof r||"object"==typeof r&&r instanceof Ar}(o)&&Kn(o);B=$&&this.injectableDefInScope($)?ic(Vp(o),xh):null,this.records.set(o,B)}if(null!=B)return this.hydrate(o,B)}return(g&Zt.Self?qu():this.parent).get(o,c=g&Zt.Optional&&c===fi?null:c)}catch(O){if("NullInjectorError"===O.name){if((O[Ai]=O[Ai]||[]).unshift(fe(o)),w)throw O;return function tt(r,o,c,g){const w=r[Ai];throw o[si]&&w.unshift(o[si]),r.message=function Rt(r,o,c,g=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.slice(2):r;let w=fe(o);if(Array.isArray(o))w=o.map(fe).join(" -> ");else if("object"==typeof o){let E=[];for(let O in o)if(o.hasOwnProperty(O)){let B=o[O];E.push(O+":"+("string"==typeof B?JSON.stringify(B):fe(B)))}w=`{${E.join(", ")}}`}return`${c}${g?"("+g+")":""}[${w}]: ${r.replace(wr,"\n  ")}`}("\n"+r.message,w,c,g),r.ngTokenPath=w,r[Ai]=null,r}(O,o,"R3InjectorError",this.source)}throw O}finally{ne(E),wt(w)}}resolveInjectorInitializers(){const o=wt(this),c=ne(void 0);try{const g=this.get(_h.multi,on,Zt.Self);for(const w of g)w()}finally{wt(o),ne(c)}}toString(){const o=[],c=this.records;for(const g of c.keys())o.push(fe(g));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new _e(205,!1)}processProvider(o){let c=eu(o=Oe(o))?o:Oe(o&&o.provide);const g=function bh(r){return nc(r)?ic(void 0,r.useValue):ic(jp(r),xh)}(o);if(eu(o)||!0!==o.multi)this.records.get(c);else{let w=this.records.get(c);w||(w=ic(void 0,xh,!0),w.factory=()=>z(w.multi),this.records.set(c,w)),c=o,w.multi.push(o)}this.records.set(c,g)}hydrate(o,c){return c.value===xh&&(c.value=h_,c.value=c.factory()),"object"==typeof c.value&&c.value&&function Cd(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(c.value)&&this._ngOnDestroyHooks.add(c.value),c.value}injectableDefInScope(o){if(!o.providedIn)return!1;const c=Oe(o.providedIn);return"string"==typeof c?"any"===c||this.scopes.has(c):this.injectorDefTypes.has(c)}}function Vp(r){const o=Kn(r),c=null!==o?o.factory:Ro(r);if(null!==c)return c;if(r instanceof Ar)throw new _e(204,!1);if(r instanceof Function)return function Do(r){const o=r.length;if(o>0)throw m(o,"?"),new _e(204,!1);const c=function pi(r){const o=r&&(r[Li]||r[Fi]);if(o){const c=function bi(r){if(r.hasOwnProperty("name"))return r.name;const o=(""+r).match(/^function\s*([^\s(]+)/);return null===o?"":o[1]}(r);return console.warn(`DEPRECATED: DI is instantiating a token "${c}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${c}" class.`),o}return null}(r);return null!==c?()=>c.factory(r):()=>new r}(r);throw new _e(204,!1)}function jp(r,o,c){let g;if(eu(r)){const w=Oe(r);return Ro(w)||Vp(w)}if(nc(r))g=()=>Oe(r.useValue);else if(function wm(r){return!(!r||!r.useFactory)}(r))g=()=>r.useFactory(...z(r.deps||[]));else if(function Wu(r){return!(!r||!r.useExisting)}(r))g=()=>gn(Oe(r.useExisting));else{const w=Oe(r&&(r.useClass||r.provide));if(!function wh(r){return!!r.deps}(r))return Ro(w)||Vp(w);g=()=>new w(...z(r.deps))}return g}function ic(r,o,c=!1){return{factory:r,value:o,multi:c?[]:void 0}}function Ch(r,o){for(const c of r)Array.isArray(c)?Ch(c,o):c&&Ye(c)?Ch(c.\u0275providers,o):o(c)}class Td{}class Th{}class Ed{resolveComponentFactory(o){throw function $p(r){const o=Error(`No component factory found for ${fe(r)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=r,o}(o)}}let Dd=(()=>{class r{}return r.NULL=new Ed,r})();function Zp(){return Yu(ao(),Sn())}function Yu(r,o){return new iu(wi(r,o))}let iu=(()=>{class r{constructor(c){this.nativeElement=c}}return r.__NG_ELEMENT_ID__=Zp,r})();function Gp(r){return r instanceof iu?r.nativeElement:r}class Id{}let f_=(()=>{class r{}return r.__NG_ELEMENT_ID__=()=>function m_(){const r=Sn(),c=Dr(ao().index,r);return(qr(c)?c:r)[11]}(),r})(),g_=(()=>{class r{}return r.\u0275prov=ot({token:r,providedIn:"root",factory:()=>null}),r})();class Em{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const __=new Em("15.1.5"),Hp={};function Eh(r){return r.ngOriginalError}class Vl{constructor(){this._console=console}handleError(o){const c=this._findOriginalError(o);this._console.error("ERROR",o),c&&this._console.error("ORIGINAL ERROR",c)}_findOriginalError(o){let c=o&&Eh(o);for(;c&&Eh(c);)c=Eh(c);return c||null}}function El(r){return r instanceof Function?r():r}function Wp(r,o,c){let g=r.length;for(;;){const w=r.indexOf(o,c);if(-1===w)return w;if(0===w||r.charCodeAt(w-1)<=32){const E=o.length;if(w+E===g||r.charCodeAt(w+E)<=32)return w}c=w+1}}const Qu="ng-template";function Mm(r,o,c){let g=0;for(;g<r.length;){let w=r[g++];if(c&&"class"===w){if(w=r[g],-1!==Wp(w.toLowerCase(),o,0))return!0}else if(1===w){for(;g<r.length&&"string"==typeof(w=r[g++]);)if(w.toLowerCase()===o)return!0;return!1}}return!1}function Sm(r){return 4===r.type&&r.value!==Qu}function Am(r,o,c){return o===(4!==r.type||c?r.value:Qu)}function Pm(r,o,c){let g=4;const w=r.attrs||[],E=function T_(r){for(let o=0;o<r.length;o++)if(Qs(r[o]))return o;return r.length}(w);let O=!1;for(let B=0;B<o.length;B++){const $=o[B];if("number"!=typeof $){if(!O)if(4&g){if(g=2|1&g,""!==$&&!Am(r,$,c)||""===$&&1===o.length){if(sl(g))return!1;O=!0}}else{const ie=8&g?$:o[++B];if(8&g&&null!==r.attrs){if(!Mm(r.attrs,ie,c)){if(sl(g))return!1;O=!0}continue}const nt=Om(8&g?"class":$,w,Sm(r),c);if(-1===nt){if(sl(g))return!1;O=!0;continue}if(""!==ie){let Bt;Bt=nt>E?"":w[nt+1].toLowerCase();const nn=8&g?Bt:null;if(nn&&-1!==Wp(nn,ie,0)||2&g&&ie!==Bt){if(sl(g))return!1;O=!0}}}}else{if(!O&&!sl(g)&&!sl($))return!1;if(O&&sl($))continue;O=!1,g=$|1&g}}return sl(g)||O}function sl(r){return 0==(1&r)}function Om(r,o,c,g){if(null===o)return-1;let w=0;if(g||!c){let E=!1;for(;w<o.length;){const O=o[w];if(O===r)return w;if(3===O||6===O)E=!0;else{if(1===O||2===O){let B=o[++w];for(;"string"==typeof B;)B=o[++w];continue}if(4===O)break;if(0===O){w+=4;continue}}w+=E?1:2}return-1}return function E_(r,o){let c=r.indexOf(4);if(c>-1)for(c++;c<r.length;){const g=r[c];if("number"==typeof g)return-1;if(g===o)return c;c++}return-1}(o,r)}function qp(r,o,c=!1){for(let g=0;g<o.length;g++)if(Pm(r,o[g],c))return!0;return!1}function Lm(r,o){e:for(let c=0;c<o.length;c++){const g=o[c];if(r.length===g.length){for(let w=0;w<r.length;w++)if(r[w]!==g[w])continue e;return!0}}return!1}function Md(r,o){return r?":not("+o.trim()+")":o}function Fm(r){let o=r[0],c=1,g=2,w="",E=!1;for(;c<r.length;){let O=r[c];if("string"==typeof O)if(2&g){const B=r[++c];w+="["+O+(B.length>0?'="'+B+'"':"")+"]"}else 8&g?w+="."+O:4&g&&(w+=" "+O);else""!==w&&!sl(O)&&(o+=Md(E,w),w=""),g=O,E=E||!sl(g);c++}return""!==w&&(o+=Md(E,w)),o}const zi={};function ed(r){Yp(Ri(),Sn(),Rr()+r,!1)}function Yp(r,o,c,g){if(!g)if(3==(3&o[2])){const E=r.preOrderCheckHooks;null!==E&&ht(o,E,c)}else{const E=r.preOrderHooks;null!==E&&un(o,E,0,c)}hs(c)}function Xp(r,o=null,c=null,g){const w=Kp(r,o,c,g);return w.resolveInjectorInitializers(),w}function Kp(r,o=null,c=null,g,w=new Set){const E=[c||on,Bp(r)];return g=g||("object"==typeof r?void 0:fe(r)),new nu(E,o||qu(),g||null,w)}let Ac=(()=>{class r{static create(c,g){if(Array.isArray(c))return Xp({name:""},g,c,"");{const w=c.name??"";return Xp({name:w},c.parent,c.providers,w)}}}return r.THROW_IF_NOT_FOUND=fi,r.NULL=new sa,r.\u0275prov=ot({token:r,providedIn:"any",factory:()=>gn(yh)}),r.__NG_ELEMENT_ID__=-1,r})();function td(r,o=Zt.Default){const c=Sn();return null===c?gn(r,o):Bc(ao(),c,Oe(r),o)}function Zm(){throw new Error("invalid")}function Gm(r,o){const c=r.contentQueries;if(null!==c)for(let g=0;g<c.length;g+=2){const E=c[g+1];if(-1!==E){const O=r.data[E];cr(c[g]),O.contentQueries(2,o[E],E)}}}function rc(r,o,c,g,w,E,O,B,$,ie,Ae){const nt=o.blueprint.slice();return nt[0]=w,nt[2]=76|g,(null!==Ae||r&&1024&r[2])&&(nt[2]|=1024),Y(nt),nt[3]=nt[15]=r,nt[8]=c,nt[10]=O||r&&r[10],nt[11]=B||r&&r[11],nt[12]=$||r&&r[12]||null,nt[9]=ie||r&&r[9]||null,nt[6]=E,nt[20]=function Kf(){return eh++}(),nt[21]=Ae,nt[16]=2==o.type?r[16]:nt,nt}function ou(r,o,c,g,w){let E=r.data[o];if(null===E)E=function sf(r,o,c,g,w){const E=pc(),O=Es(),$=r.data[o]=function Hm(r,o,c,g,w,E){return{type:c,index:g,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:w,attrs:E,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,O?E:E&&E.parent,c,o,g,w);return null===r.firstChild&&(r.firstChild=$),null!==E&&(O?null==E.child&&null!==$.parent&&(E.child=$):null===E.next&&(E.next=$)),$}(r,o,c,g,w),function Dt(){return Ie.lFrame.inI18n}()&&(E.flags|=32);else if(64&E.type){E.type=c,E.value=g,E.attrs=w;const O=function Xs(){const r=Ie.lFrame,o=r.currentTNode;return r.isParent?o:o.parent}();E.injectorIndex=null===O?-1:O.injectorIndex}return $o(E,!0),E}function Pd(r,o,c,g){if(0===c)return-1;const w=o.length;for(let E=0;E<c;E++)o.push(g),r.blueprint.push(g),r.data.push(null);return w}function af(r,o,c){Ds(o);try{const g=r.viewQuery;null!==g&&mf(1,g,c);const w=r.template;null!==w&&Rh(r,o,w,1,c),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&Gm(r,o),r.staticViewQueries&&mf(2,r.viewQuery,c);const E=r.components;null!==E&&function Oh(r,o){for(let c=0;c<o.length;c++)rd(r,o[c])}(o,E)}catch(g){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),g}finally{o[2]&=-5,Zo()}}function nd(r,o,c,g){const w=o[2];if(128!=(128&w)){Ds(o);try{Y(o),function S(r){return Ie.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==c&&Rh(r,o,c,2,g);const O=3==(3&w);if(O){const ie=r.preOrderCheckHooks;null!==ie&&ht(o,ie,null)}else{const ie=r.preOrderHooks;null!==ie&&un(o,ie,0,null),Tn(o,0)}if(function V_(r){for(let o=gp(r);null!==o;o=_p(o)){if(!o[2])continue;const c=o[9];for(let g=0;g<c.length;g++){const w=c[g];512&w[2]||G(w[3],1),w[2]|=512}}}(o),function U_(r){for(let o=gp(r);null!==o;o=_p(o))for(let c=10;c<o.length;c++){const g=o[c],w=g[1];Jo(g)&&nd(w,g,w.template,g[8])}}(o),null!==r.contentQueries&&Gm(r,o),O){const ie=r.contentCheckHooks;null!==ie&&ht(o,ie)}else{const ie=r.contentHooks;null!==ie&&un(o,ie,1),Tn(o,1)}!function k_(r,o){const c=r.hostBindingOpCodes;if(null!==c)try{for(let g=0;g<c.length;g++){const w=c[g];if(w<0)hs(~w);else{const E=w,O=c[++g],B=c[++g];zn(O,E),B(2,o[E])}}}finally{hs(-1)}}(r,o);const B=r.components;null!==B&&function B_(r,o){for(let c=0;c<o.length;c++)j_(r,o[c])}(o,B);const $=r.viewQuery;if(null!==$&&mf(2,$,g),O){const ie=r.viewCheckHooks;null!==ie&&ht(o,ie)}else{const ie=r.viewHooks;null!==ie&&un(o,ie,2),Tn(o,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),o[2]&=-41,512&o[2]&&(o[2]&=-513,G(o[3],-1))}finally{Zo()}}}function Rh(r,o,c,g,w){const E=Rr(),O=2&g;try{hs(-1),O&&o.length>22&&Yp(r,o,22,!1),c(g,w)}finally{hs(E)}}function Lh(r,o,c){if(zo(o)){const w=o.directiveEnd;for(let E=o.directiveStart;E<w;E++){const O=r.data[E];O.contentQueries&&O.contentQueries(1,c[E],E)}}}function aa(r,o,c){So()&&(function z_(r,o,c,g){const w=c.directiveStart,E=c.directiveEnd;ys(c)&&function rg(r,o,c){const g=wi(o,r),w=au(c),E=r[10],O=Uh(r,rc(r,w,null,c.onPush?32:16,g,o,E,E.createRenderer(g,c),null,null,null));r[o.index]=O}(o,c,r.data[w+c.componentOffset]),r.firstCreatePass||Xa(c,o),As(g,o);const O=c.initialInputs;for(let B=w;B<E;B++){const $=r.data[B],ie=ea(o,r,B,c);As(ie,o),null!==O&&Nh(0,B-w,ie,$,0,O),to($)&&(Dr(c.index,o)[8]=ea(o,r,B,c))}}(r,o,c,wi(c,o)),64==(64&c.flags)&&Qm(r,o,c))}function su(r,o,c=wi){const g=o.localNames;if(null!==g){let w=o.index+1;for(let E=0;E<g.length;E+=2){const O=g[E+1],B=-1===O?c(o,r):r[O];r[w++]=B}}}function au(r){const o=r.tView;return null===o||o.incompleteFirstPass?r.tView=Od(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts):o}function Od(r,o,c,g,w,E,O,B,$,ie){const Ae=22+g,nt=Ae+w,Bt=function Fh(r,o){const c=[];for(let g=0;g<o;g++)c.push(g<r?null:zi);return c}(Ae,nt),nn="function"==typeof ie?ie():ie;return Bt[1]={type:r,blueprint:Bt,template:c,queries:null,viewQuery:B,declTNode:o,data:Bt.slice().fill(null,Ae),bindingStartIndex:Ae,expandoStartIndex:nt,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof E?E():E,pipeRegistry:"function"==typeof O?O():O,firstChild:null,schemas:$,consts:nn,incompleteFirstPass:!1}}function lf(r,o,c,g){const w=gf(o);null===c?w.push(g):(w.push(c),r.firstCreatePass&&_f(r).push(g,w.length-1))}function Wm(r,o,c,g){for(let w in r)if(r.hasOwnProperty(w)){c=null===c?{}:c;const E=r[w];null===g?cf(c,o,w,E):g.hasOwnProperty(w)&&cf(c,o,g[w],E)}return c}function cf(r,o,c,g){r.hasOwnProperty(c)?r[c].push(o,g):r[c]=[o,g]}function Da(r,o,c,g,w,E,O,B){const $=wi(o,c);let Ae,ie=o.inputs;!B&&null!=ie&&(Ae=ie[g])?(yf(r,c,Ae,g,w),ys(o)&&Ym(c,o.index)):3&o.type&&(g=function uf(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(g),w=null!=O?O(w,o.value||"",g):w,E.setProperty($,g,w))}function Ym(r,o){const c=Dr(o,r);16&c[2]||(c[2]|=32)}function kh(r,o,c,g){let w=!1;if(So()){const E=null===g?null:{"":-1},O=function tg(r,o){const c=r.directiveRegistry;let g=null,w=null;if(c)for(let E=0;E<c.length;E++){const O=c[E];if(qp(o,O.selectors,!1))if(g||(g=[]),to(O))if(null!==O.findHostDirectiveDefs){const B=[];w=w||new Map,O.findHostDirectiveDefs(O,B,w),g.unshift(...B,O),lu(r,o,B.length)}else g.unshift(O),lu(r,o,0);else w=w||new Map,O.findHostDirectiveDefs?.(O,g,w),g.push(O)}return null===g?null:[g,w]}(r,c);let B,$;null===O?B=$=null:[B,$]=O,null!==B&&(w=!0,df(r,o,c,B,E,$)),E&&function ng(r,o,c){if(o){const g=r.localNames=[];for(let w=0;w<o.length;w+=2){const E=c[o[w+1]];if(null==E)throw new _e(-301,!1);g.push(o[w],E)}}}(c,g,E)}return c.mergedAttrs=ya(c.mergedAttrs,c.attrs),w}function df(r,o,c,g,w,E){for(let ie=0;ie<g.length;ie++)xc(Xa(c,o),r,g[ie].type);!function hf(r,o,c){r.flags|=1,r.directiveStart=o,r.directiveEnd=o+c,r.providerIndexes=o}(c,r.data.length,g.length);for(let ie=0;ie<g.length;ie++){const Ae=g[ie];Ae.providersResolver&&Ae.providersResolver(Ae)}let O=!1,B=!1,$=Pd(r,o,g.length,null);for(let ie=0;ie<g.length;ie++){const Ae=g[ie];c.mergedAttrs=ya(c.mergedAttrs,Ae.hostAttrs),id(r,c,o,$,Ae),ig($,Ae,w),null!==Ae.contentQueries&&(c.flags|=4),(null!==Ae.hostBindings||null!==Ae.hostAttrs||0!==Ae.hostVars)&&(c.flags|=64);const nt=Ae.type.prototype;!O&&(nt.ngOnChanges||nt.ngOnInit||nt.ngDoCheck)&&((r.preOrderHooks||(r.preOrderHooks=[])).push(c.index),O=!0),!B&&(nt.ngOnChanges||nt.ngDoCheck)&&((r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(c.index),B=!0),$++}!function qm(r,o,c){const w=o.directiveEnd,E=r.data,O=o.attrs,B=[];let $=null,ie=null;for(let Ae=o.directiveStart;Ae<w;Ae++){const nt=E[Ae],Bt=c?c.get(nt):null,En=Bt?Bt.outputs:null;$=Wm(nt.inputs,Ae,$,Bt?Bt.inputs:null),ie=Wm(nt.outputs,Ae,ie,En);const Jn=null===$||null===O||Sm(o)?null:zh($,Ae,O);B.push(Jn)}null!==$&&($.hasOwnProperty("class")&&(o.flags|=8),$.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=B,o.inputs=$,o.outputs=ie}(r,c,E)}function Qm(r,o,c){const g=c.directiveStart,w=c.directiveEnd,E=c.index,O=function xi(){return Ie.lFrame.currentDirectiveIndex}();try{hs(E);for(let B=g;B<w;B++){const $=r.data[B],ie=o[B];ti(B),(null!==$.hostBindings||0!==$.hostVars||null!==$.hostAttrs)&&eg($,ie)}}finally{hs(-1),ti(O)}}function eg(r,o){null!==r.hostBindings&&r.hostBindings(1,o)}function lu(r,o,c){o.componentOffset=c,(r.components||(r.components=[])).push(o.index)}function ig(r,o,c){if(c){if(o.exportAs)for(let g=0;g<o.exportAs.length;g++)c[o.exportAs[g]]=r;to(o)&&(c[""]=r)}}function id(r,o,c,g,w){r.data[g]=w;const E=w.factory||(w.factory=Ro(w.type)),O=new Hi(E,to(w),td);r.blueprint[g]=O,c[g]=O,function Xm(r,o,c,g,w){const E=w.hostBindings;if(E){let O=r.hostBindingOpCodes;null===O&&(O=r.hostBindingOpCodes=[]);const B=~o.index;(function Km(r){let o=r.length;for(;o>0;){const c=r[--o];if("number"==typeof c&&c<0)return c}return 0})(O)!=B&&O.push(B),O.push(c,g,E)}}(r,o,g,Pd(r,c,w.hostVars,zi),w)}function Ua(r,o,c,g,w,E){const O=wi(r,o);!function Bh(r,o,c,g,w,E,O){if(null==E)r.removeAttribute(o,w,c);else{const B=null==O?Ne(E):O(E,g||"",w);r.setAttribute(o,w,B,c)}}(o[11],O,E,r.value,c,g,w)}function Nh(r,o,c,g,w,E){const O=E[o];if(null!==O){const B=g.setInput;for(let $=0;$<O.length;){const ie=O[$++],Ae=O[$++],nt=O[$++];null!==B?g.setInput(c,nt,ie,Ae):c[Ae]=nt}}}function zh(r,o,c){let g=null,w=0;for(;w<c.length;){const E=c[w];if(0!==E)if(5!==E){if("number"==typeof E)break;if(r.hasOwnProperty(E)){null===g&&(g=[]);const O=r[E];for(let B=0;B<O.length;B+=2)if(O[B]===o){g.push(E,O[B+1],c[w+1]);break}}w+=2}else w+=2;else w+=4}return g}function og(r,o,c,g){return[r,!0,!1,o,null,0,g,c,null,null]}function j_(r,o){const c=Dr(o,r);if(Jo(c)){const g=c[1];48&c[2]?nd(g,c,g.template,c[8]):c[5]>0&&pf(c)}}function pf(r){for(let g=gp(r);null!==g;g=_p(g))for(let w=10;w<g.length;w++){const E=g[w];if(Jo(E))if(512&E[2]){const O=E[1];nd(O,E,O.template,E[8])}else E[5]>0&&pf(E)}const c=r[1].components;if(null!==c)for(let g=0;g<c.length;g++){const w=Dr(c[g],r);Jo(w)&&w[5]>0&&pf(w)}}function rd(r,o){const c=Dr(o,r),g=c[1];(function ff(r,o){for(let c=o.length;c<r.blueprint.length;c++)o.push(r.blueprint[c])})(g,c),af(g,c,c[8])}function Uh(r,o){return r[13]?r[14][4]=o:r[13]=o,r[14]=o,o}function Vh(r){for(;r;){r[2]|=32;const o=Bu(r);if(Fs(r)&&!o)return r;r=o}return null}function jh(r,o,c,g=!0){const w=o[10];w.begin&&w.begin();try{nd(r,o,r.template,c)}catch(O){throw g&&$h(o,O),O}finally{w.end&&w.end()}}function mf(r,o,c){cr(0),o(r,c)}function gf(r){return r[7]||(r[7]=[])}function _f(r){return r.cleanup||(r.cleanup=[])}function $h(r,o){const c=r[9],g=c?c.get(Vl,null):null;g&&g.handleError(o)}function yf(r,o,c,g,w){for(let E=0;E<c.length;){const O=c[E++],B=c[E++],$=o[O],ie=r.data[O];null!==ie.setInput?ie.setInput($,w,g,B):$[B]=w}}function oc(r,o,c){const g=Yo(o,r);!function Fl(r,o,c){r.setValue(o,c)}(r[11],g,c)}function Ld(r,o,c){let g=c?r.styles:null,w=c?r.classes:null,E=0;if(null!==o)for(let O=0;O<o.length;O++){const B=o[O];"number"==typeof B?E=B:1==E?w=ze(w,B):2==E&&(g=ze(g,B+": "+o[++O]+";"))}c?r.styles=g:r.stylesWithoutHost=g,c?r.classes=w:r.classesWithoutHost=w}function Fd(r,o,c,g,w=!1){for(;null!==c;){const E=o[c.index];if(null!==E&&g.push(Xr(E)),gr(E))for(let B=10;B<E.length;B++){const $=E[B],ie=$[1].firstChild;null!==ie&&Fd($[1],$,ie,g)}const O=c.type;if(8&O)Fd(r,o,c.child,g);else if(32&O){const B=wl(c,o);let $;for(;$=B();)g.push($)}else if(16&O){const B=Tp(o,c);if(Array.isArray(B))g.push(...B);else{const $=Bu(o[16]);Fd($[1],$,B,g,!0)}}c=w?c.projectionNext:c.next}return g}class sc{get rootNodes(){const o=this._lView,c=o[1];return Fd(c,o,c.firstChild,[])}constructor(o,c){this._lView=o,this._cdRefInjectingView=c,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[8]}set context(o){this._lView[8]=o}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[3];if(gr(o)){const c=o[8],g=c?c.indexOf(this):-1;g>-1&&(Nu(o,g),Qa(c,g))}this._attachedToViewContainer=!1}nl(this._lView[1],this._lView)}onDestroy(o){lf(this._lView[1],this._lView,null,o)}markForCheck(){Vh(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){jh(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new _e(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function qg(r,o){Uu(r,o,o[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new _e(902,!1);this._appRef=o}}class ac extends sc{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;jh(o[1],o,o[8],!1)}checkNoChanges(){}get context(){return null}}class Zh extends Dd{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const c=mi(o);return new $s(c,this.ngModule)}}function uu(r){const o=[];for(let c in r)r.hasOwnProperty(c)&&o.push({propName:r[c],templateName:c});return o}class al{constructor(o,c){this.injector=o,this.parentInjector=c}get(o,c,g){g=R(g);const w=this.injector.get(o,Hp,g);return w!==Hp||c===Hp?w:this.parentInjector.get(o,c,g)}}class $s extends Th{get inputs(){return uu(this.componentDef.inputs)}get outputs(){return uu(this.componentDef.outputs)}constructor(o,c){super(),this.componentDef=o,this.ngModule=c,this.componentType=o.type,this.selector=function js(r){return r.map(Fm).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!c}create(o,c,g,w){let E=(w=w||this.ngModule)instanceof tu?w:w?.injector;E&&null!==this.componentDef.getStandaloneInjector&&(E=this.componentDef.getStandaloneInjector(E)||E);const O=E?new al(o,E):o,B=O.get(Id,null);if(null===B)throw new _e(407,!1);const $=O.get(g_,null),ie=B.createRenderer(null,this.componentDef),Ae=this.componentDef.selectors[0][0]||"div",nt=g?function N_(r,o,c){return r.selectRootElement(o,c===dt.ShadowDom)}(ie,g,this.componentDef.encapsulation):kl(ie,Ae,function od(r){const o=r.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(Ae)),Bt=this.componentDef.onPush?288:272,nn=Od(0,null,null,1,0,null,null,null,null,null),En=rc(null,nn,null,Bt,null,null,B,ie,$,O,null);let Jn,ii;Ds(En);try{const yi=this.componentDef;let Ui,Un=null;yi.findHostDirectiveDefs?(Ui=[],Un=new Map,yi.findHostDirectiveDefs(yi,Ui,Un),Ui.push(yi)):Ui=[yi];const er=function G_(r,o){const c=r[1];return r[22]=o,ou(c,22,2,"#host",null)}(En,nt),Oo=function vf(r,o,c,g,w,E,O,B){const $=w[1];!function $l(r,o,c,g){for(const w of r)o.mergedAttrs=ya(o.mergedAttrs,w.hostAttrs);null!==o.mergedAttrs&&(Ld(o,o.mergedAttrs,!0),null!==c&&Dp(g,c,o))}(g,r,o,O);const ie=E.createRenderer(o,c),Ae=rc(w,au(c),null,c.onPush?32:16,w[r.index],r,E,ie,B||null,null,null);return $.firstCreatePass&&lu($,r,g.length-1),Uh(w,Ae),w[r.index]=Ae}(er,nt,yi,Ui,En,B,ie);ii=Aa(nn,22),nt&&function ag(r,o,c,g){if(g)Oa(r,c,["ng-version",__.full]);else{const{attrs:w,classes:E}=function Sd(r){const o=[],c=[];let g=1,w=2;for(;g<r.length;){let E=r[g];if("string"==typeof E)2===w?""!==E&&o.push(E,r[++g]):8===w&&c.push(E);else{if(!sl(w))break;w=E}g++}return{attrs:o,classes:c}}(o.selectors[0]);w&&Oa(r,c,w),E&&E.length>0&&ah(r,c,E.join(" "))}}(ie,yi,nt,g),void 0!==c&&function lg(r,o,c){const g=r.projection=[];for(let w=0;w<o.length;w++){const E=c[w];g.push(null!=E?Array.from(E):null)}}(ii,this.ngContentSelectors,c),Jn=function du(r,o,c,g,w,E){const O=ao(),B=w[1],$=wi(O,w);df(B,w,O,c,null,g);for(let Ae=0;Ae<c.length;Ae++)As(ea(w,B,O.directiveStart+Ae,O),w);Qm(B,w,O),$&&As($,w);const ie=ea(w,B,O.directiveStart+O.componentOffset,O);if(r[8]=w[8]=ie,null!==E)for(const Ae of E)Ae(ie,o);return Lh(B,O,r),ie}(Oo,yi,Ui,Un,En,[H_]),af(nn,En,null)}finally{Zo()}return new $_(this.componentType,Jn,Yu(ii,En),En,ii)}}class $_ extends Td{constructor(o,c,g,w,E){super(),this.location=g,this._rootLView=w,this._tNode=E,this.instance=c,this.hostView=this.changeDetectorRef=new ac(w),this.componentType=o}setInput(o,c){const g=this._tNode.inputs;let w;if(null!==g&&(w=g[o])){const E=this._rootLView;yf(E[1],E,w,o,c),Ym(E,this._tNode.index)}}get injector(){return new bl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function H_(){const r=ao();Se(Sn()[1],r)}function Bd(r){let o=function kd(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),c=!0;const g=[r];for(;o;){let w;if(to(r))w=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new _e(903,!1);w=o.\u0275dir}if(w){if(c){g.push(w);const O=r;O.inputs=hu(r.inputs),O.declaredInputs=hu(r.declaredInputs),O.outputs=hu(r.outputs);const B=w.hostBindings;B&&cg(r,B);const $=w.viewQuery,ie=w.contentQueries;if($&&Nd(r,$),ie&&Gh(r,ie),xe(r.inputs,w.inputs),xe(r.declaredInputs,w.declaredInputs),xe(r.outputs,w.outputs),to(w)&&w.data.animation){const Ae=r.data;Ae.animation=(Ae.animation||[]).concat(w.data.animation)}}const E=w.features;if(E)for(let O=0;O<E.length;O++){const B=E[O];B&&B.ngInherit&&B(r),B===Bd&&(c=!1)}}o=Object.getPrototypeOf(o)}!function sd(r){let o=0,c=null;for(let g=r.length-1;g>=0;g--){const w=r[g];w.hostVars=o+=w.hostVars,w.hostAttrs=ya(w.hostAttrs,c=ya(c,w.hostAttrs))}}(g)}function hu(r){return r===pt?{}:r===on?[]:r}function Nd(r,o){const c=r.viewQuery;r.viewQuery=c?(g,w)=>{o(g,w),c(g,w)}:o}function Gh(r,o){const c=r.contentQueries;r.contentQueries=c?(g,w,E)=>{o(g,w,E),c(g,w,E)}:o}function cg(r,o){const c=r.hostBindings;r.hostBindings=c?(g,w)=>{o(g,w),c(g,w)}:o}let Ud=null;function Va(){if(!Ud){const r=Qt.Symbol;if(r&&r.iterator)Ud=r.iterator;else{const o=Object.getOwnPropertyNames(Map.prototype);for(let c=0;c<o.length;++c){const g=o[c];"entries"!==g&&"size"!==g&&Map.prototype[g]===Map.prototype.entries&&(Ud=g)}}}return Ud}function Ml(r){return!!pu(r)&&(Array.isArray(r)||!(r instanceof Map)&&Va()in r)}function pu(r){return null!==r&&("function"==typeof r||"object"==typeof r)}function Ia(r,o,c){return r[o]=c}function Zs(r,o,c){return!Object.is(r[o],c)&&(r[o]=c,!0)}function fu(r,o,c,g){const w=Zs(r,o,c);return Zs(r,o+1,g)||w}function wf(r,o,c,g){const w=Sn();return Zs(w,V(),o)&&(Ri(),Ua(Sr(),w,r,o,c,g)),wf}function gu(r,o,c,g){return Zs(r,V(),c)?o+Ne(c)+g:zi}function _u(r,o,c,g,w,E,O,B){const ie=function lc(r,o,c,g,w){const E=fu(r,o,c,g);return Zs(r,o+2,w)||E}(r,j(),c,w,O);return ve(3),ie?o+Ne(c)+g+Ne(w)+E+Ne(O)+B:zi}function cd(r,o,c,g,w,E,O,B,$,ie){const nt=function la(r,o,c,g,w,E){const O=fu(r,o,c,g);return fu(r,o+2,w,E)||O}(r,j(),c,w,O,$);return ve(4),nt?o+Ne(c)+g+Ne(w)+E+Ne(O)+B+Ne($)+ie:zi}function Hd(r,o,c,g,w,E,O,B){const $=Sn(),ie=Ri(),Ae=r+22,nt=ie.firstCreatePass?function gg(r,o,c,g,w,E,O,B,$){const ie=o.consts,Ae=ou(o,r,4,O||null,K(ie,B));kh(o,c,Ae,K(ie,$)),Se(o,Ae);const nt=Ae.tViews=Od(2,Ae,g,w,E,o.directiveRegistry,o.pipeRegistry,null,o.schemas,ie);return null!==o.queries&&(o.queries.template(o,Ae),nt.queries=o.queries.embeddedTView(Ae)),Ae}(Ae,ie,$,o,c,g,w,E,O):ie.data[Ae];$o(nt,!1);const Bt=$[11].createComment("");tc(ie,$,Bt,nt),As(Bt,$),Uh($,$[Ae]=og(Bt,$,Bt,nt)),co(nt)&&aa(ie,$,nt),null!=O&&su($,nt,B)}function _g(r){return ds(function Ks(){return Ie.lFrame.contextLView}(),22+r)}function Tf(r,o,c){const g=Sn();return Zs(g,V(),o)&&Da(Ri(),Sr(),g,r,o,g[11],c,!1),Tf}function Ef(r,o,c,g,w){const O=w?"class":"style";yf(r,c,o.inputs[O],O,g)}function Yh(r,o,c,g){const w=Sn(),E=Ri(),O=22+r,B=w[11],$=w[O]=kl(B,o,function ae(){return Ie.lFrame.currentNamespace}()),ie=E.firstCreatePass?function Df(r,o,c,g,w,E,O){const B=o.consts,ie=ou(o,r,2,w,K(B,E));return kh(o,c,ie,K(B,O)),null!==ie.attrs&&Ld(ie,ie.attrs,!1),null!==ie.mergedAttrs&&Ld(ie,ie.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,ie),ie}(O,E,w,0,o,c,g):E.data[O];return $o(ie,!0),Dp(B,$,ie),32!=(32&ie.flags)&&tc(E,w,$,ie),0===function dr(){return Ie.lFrame.elementDepthCount}()&&As($,w),function hr(){Ie.lFrame.elementDepthCount++}(),co(ie)&&(aa(E,w,ie),Lh(E,ie,w)),null!==g&&su(w,ie),Yh}function Lc(){let r=ao();Es()?Xo():(r=r.parent,$o(r,!1));const o=r;!function Ts(){Ie.lFrame.elementDepthCount--}();const c=Ri();return c.firstCreatePass&&(Se(c,r),zo(r)&&c.queries.elementEnd(r)),null!=o.classesWithoutHost&&function $n(r){return 0!=(8&r.flags)}(o)&&Ef(c,o,Sn(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function ro(r){return 0!=(16&r.flags)}(o)&&Ef(c,o,Sn(),o.stylesWithoutHost,!1),Lc}function If(r,o,c,g){return Yh(r,o,c,g),Lc(),If}function Wd(r,o,c){const g=Sn(),w=Ri(),E=r+22,O=w.firstCreatePass?function Y_(r,o,c,g,w){const E=o.consts,O=K(E,g),B=ou(o,r,8,"ng-container",O);return null!==O&&Ld(B,O,!0),kh(o,c,B,K(E,w)),null!==o.queries&&o.queries.elementStart(o,B),B}(E,w,g,o,c):w.data[E];$o(O,!0);const B=g[E]=g[11].createComment("");return tc(w,g,B,O),As(B,g),co(O)&&(aa(w,g,O),Lh(w,O,g)),null!=c&&su(g,O),Wd}function Jh(){let r=ao();const o=Ri();return Es()?Xo():(r=r.parent,$o(r,!1)),o.firstCreatePass&&(Se(o,r),zo(r)&&o.queries.elementEnd(r)),Jh}function Xh(r,o,c){return Wd(r,o,c),Jh(),Xh}function ja(){return Sn()}function ll(r){return!!r&&"function"==typeof r.then}function uc(r){return!!r&&"function"==typeof r.subscribe}const Sl=uc;function Zl(r,o,c,g){const w=Sn(),E=Ri(),O=ao();return function Mf(r,o,c,g,w,E,O){const B=co(g),ie=r.firstCreatePass&&_f(r),Ae=o[8],nt=gf(o);let Bt=!0;if(3&g.type||O){const Jn=wi(g,o),ii=O?O(Jn):Jn,yi=nt.length,Ui=O?er=>O(Xr(er[g.index])):g.index;let Un=null;if(!O&&B&&(Un=function yg(r,o,c,g){const w=r.cleanup;if(null!=w)for(let E=0;E<w.length-1;E+=2){const O=w[E];if(O===c&&w[E+1]===g){const B=o[7],$=w[E+2];return B.length>$?B[$]:null}"string"==typeof O&&(E+=2)}return null}(r,o,w,g.index)),null!==Un)(Un.__ngLastListenerFn__||Un).__ngNextListenerFn__=E,Un.__ngLastListenerFn__=E,Bt=!1;else{E=Kh(g,o,Ae,E,!1);const er=c.listen(ii,w,E);nt.push(E,er),ie&&ie.push(w,Ui,yi,yi+1)}}else E=Kh(g,o,Ae,E,!1);const nn=g.outputs;let En;if(Bt&&null!==nn&&(En=nn[w])){const Jn=En.length;if(Jn)for(let ii=0;ii<Jn;ii+=2){const Oo=o[En[ii]][En[ii+1]].subscribe(E),ss=nt.length;nt.push(E,Oo),ie&&ie.push(w,g.index,ss,-(ss+1))}}}(E,w,w[11],O,r,o,g),Zl}function Sf(r,o,c,g){try{return!1!==c(g)}catch(w){return $h(r,w),!1}}function Kh(r,o,c,g,w){return function E(O){if(O===Function)return g;Vh(r.componentOffset>-1?Dr(r.index,o):o);let $=Sf(o,0,g,O),ie=E.__ngNextListenerFn__;for(;ie;)$=Sf(o,0,ie,O)&&$,ie=ie.__ngNextListenerFn__;return w&&!1===$&&(O.preventDefault(),O.returnValue=!1),$}}function vg(r=1){return function pl(r){return(Ie.lFrame.contextLView=function fl(r,o){for(;r>0;)o=o[15],r--;return o}(r,Ie.lFrame.contextLView))[8]}(r)}function xg(r,o){let c=null;const g=function Rm(r){const o=r.attrs;if(null!=o){const c=o.indexOf(5);if(!(1&c))return o[c+1]}return null}(r);for(let w=0;w<o.length;w++){const E=o[w];if("*"!==E){if(null===g?qp(r,E,!0):Lm(g,E))return w}else c=w}return c}function Af(r){const o=Sn()[16][6];if(!o.projection){const g=o.projection=m(r?r.length:1,null),w=g.slice();let E=o.child;for(;null!==E;){const O=r?xg(E,r):0;null!==O&&(w[O]?w[O].projectionNext=E:g[O]=E,w[O]=E),E=E.next}}}function Pf(r,o=0,c){const g=Sn(),w=Ri(),E=ou(w,22+r,16,null,c||null);null===E.projection&&(E.projection=o),Xo(),32!=(32&E.flags)&&function Qg(r,o,c){Nl(o[11],0,o,c,Di(r,c,o),Ca(c.parent||o[6],c,o))}(w,g,E)}function Qh(r,o,c){return ep(r,"",o,"",c),Qh}function ep(r,o,c,g,w){const E=Sn(),O=gu(E,o,c,g);return O!==zi&&Da(Ri(),Sr(),E,r,O,E[11],w,!1),ep}function hd(r,o){return r<<17|o<<2}function Os(r){return r>>17&32767}function $a(r){return 2|r}function Za(r){return(131068&r)>>2}function np(r,o){return-131069&r|o<<2}function bu(r){return 1|r}function Nf(r,o,c,g,w){const E=r[c+1],O=null===o;let B=g?Os(E):Za(E),$=!1;for(;0!==B&&(!1===$||O);){const Ae=r[B+1];Tg(r[B],o)&&($=!0,r[B+1]=g?bu(Ae):$a(Ae)),B=g?Os(Ae):Za(Ae)}$&&(r[c+1]=g?$a(E):bu(E))}function Tg(r,o){return null===r||null==o||(Array.isArray(r)?r[1]:r)===o||!(!Array.isArray(r)||"string"!=typeof o)&&C(r,o)>=0}function N(r,o,c){return Qe(r,o,c,!1),N}function Z(r,o){return Qe(r,o,null,!0),Z}function Qe(r,o,c,g){const w=Sn(),E=Ri(),O=ve(2);E.firstUpdatePass&&function st(r,o,c,g){const w=r.data;if(null===w[c+1]){const E=w[Rr()],O=function et(r,o){return o>=r.expandoStartIndex}(r,c);(function gi(r,o){return 0!=(r.flags&(o?8:16))})(E,g)&&null===o&&!O&&(o=!1),o=function Ct(r,o,c,g){const w=function Gi(r){const o=Ie.lFrame.currentDirectiveIndex;return-1===o?null:r[o]}(r);let E=g?o.residualClasses:o.residualStyles;if(null===w)0===(g?o.classBindings:o.styleBindings)&&(c=Mn(c=mn(null,r,o,c,g),o.attrs,g),E=null);else{const O=o.directiveStylingLast;if(-1===O||r[O]!==w)if(c=mn(w,r,o,c,g),null===E){let $=function mt(r,o,c){const g=c?o.classBindings:o.styleBindings;if(0!==Za(g))return r[Os(g)]}(r,o,g);void 0!==$&&Array.isArray($)&&($=mn(null,r,o,$[1],g),$=Mn($,o.attrs,g),function Kt(r,o,c,g){r[Os(c?o.classBindings:o.styleBindings)]=g}(r,o,g,$))}else E=function qt(r,o,c){let g;const w=o.directiveEnd;for(let E=1+o.directiveStylingLast;E<w;E++)g=Mn(g,r[E].hostAttrs,c);return Mn(g,o.attrs,c)}(r,o,g)}return void 0!==E&&(g?o.residualClasses=E:o.residualStyles=E),c}(w,E,o,g),function Cg(r,o,c,g,w,E){let O=E?o.classBindings:o.styleBindings,B=Os(O),$=Za(O);r[g]=c;let Ae,ie=!1;if(Array.isArray(c)?(Ae=c[1],(null===Ae||C(c,Ae)>0)&&(ie=!0)):Ae=c,w)if(0!==$){const Bt=Os(r[B+1]);r[g+1]=hd(Bt,B),0!==Bt&&(r[Bt+1]=np(r[Bt+1],g)),r[B+1]=function kf(r,o){return 131071&r|o<<17}(r[B+1],g)}else r[g+1]=hd(B,0),0!==B&&(r[B+1]=np(r[B+1],g)),B=g;else r[g+1]=hd($,0),0===B?B=g:r[$+1]=np(r[$+1],g),$=g;ie&&(r[g+1]=$a(r[g+1])),Nf(r,Ae,g,!0),Nf(r,Ae,g,!1),function X_(r,o,c,g,w){const E=w?r.residualClasses:r.residualStyles;null!=E&&"string"==typeof o&&C(E,o)>=0&&(c[g+1]=bu(c[g+1]))}(o,Ae,r,g,E),O=hd(B,$),E?o.classBindings=O:o.styleBindings=O}(w,E,o,c,O,g)}}(E,r,O,g),o!==zi&&Zs(w,O,o)&&function In(r,o,c,g,w,E,O,B){if(!(3&o.type))return;const $=r.data,ie=$[B+1],Ae=function wg(r){return 1==(1&r)}(ie)?On($,o,c,w,Za(ie),O):void 0;sn(Ae)||(sn(E)||function Ff(r){return 2==(2&r)}(ie)&&(E=On($,null,c,w,B,O)),function oh(r,o,c,g,w){if(o)w?r.addClass(c,g):r.removeClass(c,g);else{let E=-1===g.indexOf("-")?void 0:ko.DashCase;null==w?r.removeStyle(c,g,E):("string"==typeof w&&w.endsWith("!important")&&(w=w.slice(0,-10),E|=ko.Important),r.setStyle(c,g,w,E))}}(g,O,Yo(Rr(),c),w,E))}(E,E.data[Rr()],w,w[11],r,w[O+1]=function Gn(r,o){return null==r||("string"==typeof o?r+=o:"object"==typeof r&&(r=fe(ms(r)))),r}(o,c),g,O)}function mn(r,o,c,g,w){let E=null;const O=c.directiveEnd;let B=c.directiveStylingLast;for(-1===B?B=c.directiveStart:B++;B<O&&(E=o[B],g=Mn(g,E.hostAttrs,w),E!==r);)B++;return null!==r&&(c.directiveStylingLast=B),g}function Mn(r,o,c){const g=c?1:2;let w=-1;if(null!==o)for(let E=0;E<o.length;E++){const O=o[E];"number"==typeof O?w=O:w===g&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),p(r,O,!!c||o[++E]))}return void 0===r?null:r}function On(r,o,c,g,w,E){const O=null===o;let B;for(;w>0;){const $=r[w],ie=Array.isArray($),Ae=ie?$[1]:$,nt=null===Ae;let Bt=c[w+1];Bt===zi&&(Bt=nt?on:void 0);let nn=nt?v(Bt,g):Ae===g?Bt:void 0;if(ie&&!sn(nn)&&(nn=v($,g)),sn(nn)&&(B=nn,O))return B;const En=r[w+1];w=O?Os(En):Za(En)}if(null!==o){let $=E?o.residualClasses:o.residualStyles;null!=$&&(B=v($,g))}return B}function sn(r){return void 0!==r}function qn(r,o=""){const c=Sn(),g=Ri(),w=r+22,E=g.firstCreatePass?ou(g,w,1,o,null):g.data[w],O=c[w]=function Dc(r,o){return r.createText(o)}(c[11],o);tc(g,c,O,E),$o(E,!1)}function ei(r){return jn("",r,""),ei}function jn(r,o,c){const g=Sn(),w=gu(g,r,o,c);return w!==zi&&oc(g,Rr(),w),jn}function _i(r,o,c,g,w){const E=Sn(),O=function ld(r,o,c,g,w,E){const B=fu(r,j(),c,w);return ve(2),B?o+Ne(c)+g+Ne(w)+E:zi}(E,r,o,c,g,w);return O!==zi&&oc(E,Rr(),O),_i}function Ji(r,o,c,g,w,E,O){const B=Sn(),$=_u(B,r,o,c,g,w,E,O);return $!==zi&&oc(B,Rr(),$),Ji}function Wi(r,o,c,g,w,E,O,B,$){const ie=Sn(),Ae=cd(ie,r,o,c,g,w,E,O,B,$);return Ae!==zi&&oc(ie,Rr(),Ae),Wi}const Gs=void 0;var Cu=["en",[["a","p"],["AM","PM"],Gs],[["AM","PM"],Gs,Gs],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Gs,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Gs,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Gs,"{1} 'at' {0}",Gs],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Ig(r){const c=Math.floor(Math.abs(r)),g=r.toString().replace(/^[^.]*\.?/,"").length;return 1===c&&0===g?1:5}];let Fc={};function Hl(r){const o=function jf(r){return r.toLowerCase().replace(/_/g,"-")}(r);let c=ca(o);if(c)return c;const g=o.split("-")[0];if(c=ca(g),c)return c;if("en"===g)return Cu;throw new _e(701,!1)}function Ag(r){return Hl(r)[Pi.PluralCase]}function ca(r){return r in Fc||(Fc[r]=Qt.ng&&Qt.ng.common&&Qt.ng.common.locales&&Qt.ng.common.locales[r]),Fc[r]}var Pi=(()=>((Pi=Pi||{})[Pi.LocaleId=0]="LocaleId",Pi[Pi.DayPeriodsFormat=1]="DayPeriodsFormat",Pi[Pi.DayPeriodsStandalone=2]="DayPeriodsStandalone",Pi[Pi.DaysFormat=3]="DaysFormat",Pi[Pi.DaysStandalone=4]="DaysStandalone",Pi[Pi.MonthsFormat=5]="MonthsFormat",Pi[Pi.MonthsStandalone=6]="MonthsStandalone",Pi[Pi.Eras=7]="Eras",Pi[Pi.FirstDayOfWeek=8]="FirstDayOfWeek",Pi[Pi.WeekendRange=9]="WeekendRange",Pi[Pi.DateFormat=10]="DateFormat",Pi[Pi.TimeFormat=11]="TimeFormat",Pi[Pi.DateTimeFormat=12]="DateTimeFormat",Pi[Pi.NumberSymbols=13]="NumberSymbols",Pi[Pi.NumberFormats=14]="NumberFormats",Pi[Pi.CurrencyCode=15]="CurrencyCode",Pi[Pi.CurrencySymbol=16]="CurrencySymbol",Pi[Pi.CurrencyName=17]="CurrencyName",Pi[Pi.Currencies=18]="Currencies",Pi[Pi.Directionality=19]="Directionality",Pi[Pi.PluralCase=20]="PluralCase",Pi[Pi.ExtraData=21]="ExtraData",Pi))();const sp="en-US";let jy=sp;function ey(r,o,c,g,w){if(r=Oe(r),Array.isArray(r))for(let E=0;E<r.length;E++)ey(r[E],o,c,g,w);else{const E=Ri(),O=Sn();let B=eu(r)?r:Oe(r.provide),$=jp(r);const ie=ao(),Ae=1048575&ie.providerIndexes,nt=ie.directiveStart,Bt=ie.providerIndexes>>20;if(eu(r)||!r.multi){const nn=new Hi($,w,td),En=ny(B,o,w?Ae:Ae+Bt,nt);-1===En?(xc(Xa(ie,O),E,B),ty(E,r,o.length),o.push(B),ie.directiveStart++,ie.directiveEnd++,w&&(ie.providerIndexes+=1048576),c.push(nn),O.push(nn)):(c[En]=nn,O[En]=nn)}else{const nn=ny(B,o,Ae+Bt,nt),En=ny(B,o,Ae,Ae+Bt),ii=En>=0&&c[En];if(w&&!ii||!w&&!(nn>=0&&c[nn])){xc(Xa(ie,O),E,B);const yi=function kx(r,o,c,g,w){const E=new Hi(r,c,td);return E.multi=[],E.index=o,E.componentProviders=0,pv(E,w,g&&!c),E}(w?Fx:Lx,c.length,w,g,$);!w&&ii&&(c[En].providerFactory=yi),ty(E,r,o.length,0),o.push(B),ie.directiveStart++,ie.directiveEnd++,w&&(ie.providerIndexes+=1048576),c.push(yi),O.push(yi)}else ty(E,r,nn>-1?nn:En,pv(c[w?En:nn],$,!w&&g));!w&&g&&ii&&c[En].componentProviders++}}}function ty(r,o,c,g){const w=eu(o),E=function d_(r){return!!r.useClass}(o);if(w||E){const $=(E?Oe(o.useClass):o).prototype.ngOnDestroy;if($){const ie=r.destroyHooks||(r.destroyHooks=[]);if(!w&&o.multi){const Ae=ie.indexOf(c);-1===Ae?ie.push(c,[g,$]):ie[Ae+1].push(g,$)}else ie.push(c,$)}}}function pv(r,o,c){return c&&r.componentProviders++,r.multi.push(o)-1}function ny(r,o,c,g){for(let w=c;w<g;w++)if(o[w]===r)return w;return-1}function Lx(r,o,c,g){return iy(this.multi,[])}function Fx(r,o,c,g){const w=this.multi;let E;if(this.providerFactory){const O=this.providerFactory.componentProviders,B=ea(c,c[1],this.providerFactory.index,g);E=B.slice(0,O),iy(w,E);for(let $=O;$<B.length;$++)E.push(B[$])}else E=[],iy(w,E);return E}function iy(r,o){for(let c=0;c<r.length;c++)o.push((0,r[c])());return o}function fv(r,o=[]){return c=>{c.providersResolver=(g,w)=>function Rx(r,o,c){const g=Ri();if(g.firstCreatePass){const w=to(r);ey(c,g.data,g.blueprint,w,!0),ey(o,g.data,g.blueprint,w,!1)}}(g,w?w(r):r,o)}}class ap{}class mv{}function Bx(r,o){return new gv(r,o??null)}class gv extends ap{constructor(o,c){super(),this._parent=c,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Zh(this);const g=Rn(o);this._bootstrapComponents=El(g.bootstrap),this._r3Injector=Kp(o,c,[{provide:ap,useValue:this},{provide:Dd,useValue:this.componentFactoryResolver}],fe(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(c=>c()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class ry extends mv{constructor(o){super(),this.moduleType=o}create(o){return new gv(this.moduleType,o)}}class Nx extends ap{constructor(o,c,g){super(),this.componentFactoryResolver=new Zh(this),this.instance=null;const w=new nu([...o,{provide:ap,useValue:this},{provide:Dd,useValue:this.componentFactoryResolver}],c||qu(),g,new Set(["environment"]));this.injector=w,w.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function oy(r,o,c=null){return new Nx(r,o,c).injector}let zx=(()=>{class r{constructor(c){this._injector=c,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(c){if(!c.standalone)return null;if(!this.cachedInjectors.has(c.id)){const g=vm(0,c.type),w=g.length>0?oy([g],this._injector,`Standalone[${c.type.name}]`):null;this.cachedInjectors.set(c.id,w)}return this.cachedInjectors.get(c.id)}ngOnDestroy(){try{for(const c of this.cachedInjectors.values())null!==c&&c.destroy()}finally{this.cachedInjectors.clear()}}}return r.\u0275prov=ot({token:r,providedIn:"environment",factory:()=>new r(gn(tu))}),r})();function _v(r){r.getStandaloneInjector=o=>o.get(zx).getOrCreateStandaloneInjector(r)}function Tv(r,o,c){const g=M()+r,w=Sn();return w[g]===zi?Ia(w,g,c?o.call(c):o()):function Rc(r,o){return r[o]}(w,g)}function qf(r,o){const c=r[o];return c===zi?void 0:c}function Av(r,o){const c=Ri();let g;const w=r+22;c.firstCreatePass?(g=function i1(r,o){if(o)for(let c=o.length-1;c>=0;c--){const g=o[c];if(r===g.name)return g}}(o,c.pipeRegistry),c.data[w]=g,g.onDestroy&&(c.destroyHooks||(c.destroyHooks=[])).push(w,g.onDestroy)):g=c.data[w];const E=g.factory||(g.factory=Ro(g.type)),O=ne(td);try{const B=yl(!1),$=E();return yl(B),function q_(r,o,c,g){c>=r.data.length&&(r.data[c]=null,r.blueprint[c]=null),o[c]=g}(c,Sn(),w,$),$}finally{ne(O)}}function Pv(r,o,c){const g=r+22,w=Sn(),E=ds(w,g);return Yf(w,g)?function Ev(r,o,c,g,w,E){const O=o+c;return Zs(r,O,w)?Ia(r,O+1,E?g.call(E,w):g(w)):qf(r,O+1)}(w,M(),o,E.transform,c,E):E.transform(c)}function Ov(r,o,c,g){const w=r+22,E=Sn(),O=ds(E,w);return Yf(E,w)?function Dv(r,o,c,g,w,E,O){const B=o+c;return fu(r,B,w,E)?Ia(r,B+2,O?g.call(O,w,E):g(w,E)):qf(r,B+2)}(E,M(),o,O.transform,c,g,O):O.transform(c,g)}function Yf(r,o){return r[1].data[o].pure}function ay(r){return o=>{setTimeout(r,void 0,o)}}const kc=class a1 extends d.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,c,g){let w=o,E=c||(()=>null),O=g;if(o&&"object"==typeof o){const $=o;w=$.next?.bind($),E=$.error?.bind($),O=$.complete?.bind($)}this.__isAsync&&(E=ay(E),w&&(w=ay(w)),O&&(O=ay(O)));const B=super.subscribe({next:w,error:E,complete:O});return o instanceof y.w0&&o.add(B),B}};function l1(){return this._results[Va()]()}class ly{get changes(){return this._changes||(this._changes=new kc)}constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const c=Va(),g=ly.prototype;g[c]||(g[c]=l1)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,c){return this._results.reduce(o,c)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,c){const g=this;g.dirty=!1;const w=function Ms(r){return r.flat(Number.POSITIVE_INFINITY)}(o);(this._changesDetected=!function Zc(r,o,c){if(r.length!==o.length)return!1;for(let g=0;g<r.length;g++){let w=r[g],E=o[g];if(c&&(w=c(w),E=c(E)),E!==w)return!1}return!0}(g._results,w,c))&&(g._results=w,g.length=w.length,g.last=w[this.length-1],g.first=w[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Jf=(()=>{class r{}return r.__NG_ELEMENT_ID__=d1,r})();const c1=Jf,u1=class extends c1{constructor(o,c,g){super(),this._declarationLView=o,this._declarationTContainer=c,this.elementRef=g}createEmbeddedView(o,c){const g=this._declarationTContainer.tViews,w=rc(this._declarationLView,g,o,16,null,g.declTNode,null,null,null,null,c||null);w[17]=this._declarationLView[this._declarationTContainer.index];const O=this._declarationLView[19];return null!==O&&(w[19]=O.createEmbeddedView(g)),af(g,w,o),new sc(w)}};function d1(){return kg(ao(),Sn())}function kg(r,o){return 4&r.type?new u1(o,r,Yu(r,o)):null}let Bg=(()=>{class r{}return r.__NG_ELEMENT_ID__=h1,r})();function h1(){return Fv(ao(),Sn())}const p1=Bg,Rv=class extends p1{constructor(o,c,g){super(),this._lContainer=o,this._hostTNode=c,this._hostLView=g}get element(){return Yu(this._hostTNode,this._hostLView)}get injector(){return new bl(this._hostTNode,this._hostLView)}get parentInjector(){const o=Jl(this._hostTNode,this._hostLView);if(Ra(o)){const c=La(o,this._hostLView),g=lo(o);return new bl(c[1].data[g+8],c)}return new bl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const c=Lv(this._lContainer);return null!==c&&c[o]||null}get length(){return this._lContainer.length-10}createEmbeddedView(o,c,g){let w,E;"number"==typeof g?w=g:null!=g&&(w=g.index,E=g.injector);const O=o.createEmbeddedView(c||{},E);return this.insert(O,w),O}createComponent(o,c,g,w,E){const O=o&&!function Rl(r){return"function"==typeof r}(o);let B;if(O)B=c;else{const nt=c||{};B=nt.index,g=nt.injector,w=nt.projectableNodes,E=nt.environmentInjector||nt.ngModuleRef}const $=O?o:new $s(mi(o)),ie=g||this.parentInjector;if(!E&&null==$.ngModule){const Bt=(O?ie:this.parentInjector).get(tu,null);Bt&&(E=Bt)}const Ae=$.create(ie,w,void 0,E);return this.insert(Ae.hostView,B),Ae}insert(o,c){const g=o._lView,w=g[1];if(function qa(r){return gr(r[3])}(g)){const Ae=this.indexOf(o);if(-1!==Ae)this.detach(Ae);else{const nt=g[3],Bt=new Rv(nt,nt[6],nt[3]);Bt.detach(Bt.indexOf(o))}}const E=this._adjustIndex(c),O=this._lContainer;!function Jg(r,o,c,g){const w=10+g,E=c.length;g>0&&(c[w-1][4]=o),g<E-10?(o[4]=c[w],Tc(c,10+g,o)):(c.push(o),o[4]=null),o[3]=c;const O=o[17];null!==O&&c!==O&&function Xg(r,o){const c=r[9];o[16]!==o[3][3][16]&&(r[2]=!0),null===c?r[9]=[o]:c.push(o)}(O,o);const B=o[19];null!==B&&B.insertView(r),o[2]|=64}(w,g,O,E);const B=_d(E,O),$=g[11],ie=za($,O[7]);return null!==ie&&function Wc(r,o,c,g,w,E){g[0]=w,g[6]=o,Uu(r,g,c,1,w,E)}(w,O[6],$,g,ie,B),o.attachToViewContainerRef(),Tc(cy(O),E,o),o}move(o,c){return this.insert(o,c)}indexOf(o){const c=Lv(this._lContainer);return null!==c?c.indexOf(o):-1}remove(o){const c=this._adjustIndex(o,-1),g=Nu(this._lContainer,c);g&&(Qa(cy(this._lContainer),c),nl(g[1],g))}detach(o){const c=this._adjustIndex(o,-1),g=Nu(this._lContainer,c);return g&&null!=Qa(cy(this._lContainer),c)?new sc(g):null}_adjustIndex(o,c=0){return o??this.length+c}};function Lv(r){return r[8]}function cy(r){return r[8]||(r[8]=[])}function Fv(r,o){let c;const g=o[r.index];if(gr(g))c=g;else{let w;if(8&r.type)w=Xr(g);else{const E=o[11];w=E.createComment("");const O=wi(r,o);Bl(E,za(E,O),w,function il(r,o){return r.nextSibling(o)}(E,O),!1)}o[r.index]=c=og(g,o,w,r),Uh(o,c)}return new Rv(c,r,o)}class uy{constructor(o){this.queryList=o,this.matches=null}clone(){return new uy(this.queryList)}setDirty(){this.queryList.setDirty()}}class dy{constructor(o=[]){this.queries=o}createEmbeddedView(o){const c=o.queries;if(null!==c){const g=null!==o.contentQueries?o.contentQueries[0]:c.length,w=[];for(let E=0;E<g;E++){const O=c.getByIndex(E);w.push(this.queries[O.indexInDeclarationView].clone())}return new dy(w)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let c=0;c<this.queries.length;c++)null!==Zv(o,c).matches&&this.queries[c].setDirty()}}class kv{constructor(o,c,g=null){this.predicate=o,this.flags=c,this.read=g}}class hy{constructor(o=[]){this.queries=o}elementStart(o,c){for(let g=0;g<this.queries.length;g++)this.queries[g].elementStart(o,c)}elementEnd(o){for(let c=0;c<this.queries.length;c++)this.queries[c].elementEnd(o)}embeddedTView(o){let c=null;for(let g=0;g<this.length;g++){const w=null!==c?c.length:0,E=this.getByIndex(g).embeddedTView(o,w);E&&(E.indexInDeclarationView=g,null!==c?c.push(E):c=[E])}return null!==c?new hy(c):null}template(o,c){for(let g=0;g<this.queries.length;g++)this.queries[g].template(o,c)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class py{constructor(o,c=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=c}elementStart(o,c){this.isApplyingToNode(c)&&this.matchTNode(o,c)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,c){this.elementStart(o,c)}embeddedTView(o,c){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,c),new py(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const c=this._declarationNodeIndex;let g=o.parent;for(;null!==g&&8&g.type&&g.index!==c;)g=g.parent;return c===(null!==g?g.index:-1)}return this._appliesToNextNode}matchTNode(o,c){const g=this.metadata.predicate;if(Array.isArray(g))for(let w=0;w<g.length;w++){const E=g[w];this.matchTNodeWithReadOption(o,c,f1(c,E)),this.matchTNodeWithReadOption(o,c,xl(c,o,E,!1,!1))}else g===Jf?4&c.type&&this.matchTNodeWithReadOption(o,c,-1):this.matchTNodeWithReadOption(o,c,xl(c,o,g,!1,!1))}matchTNodeWithReadOption(o,c,g){if(null!==g){const w=this.metadata.read;if(null!==w)if(w===iu||w===Bg||w===Jf&&4&c.type)this.addMatch(c.index,-2);else{const E=xl(c,o,w,!1,!1);null!==E&&this.addMatch(c.index,E)}else this.addMatch(c.index,g)}}addMatch(o,c){null===this.matches?this.matches=[o,c]:this.matches.push(o,c)}}function f1(r,o){const c=r.localNames;if(null!==c)for(let g=0;g<c.length;g+=2)if(c[g]===o)return c[g+1];return null}function g1(r,o,c,g){return-1===c?function m1(r,o){return 11&r.type?Yu(r,o):4&r.type?kg(r,o):null}(o,r):-2===c?function _1(r,o,c){return c===iu?Yu(o,r):c===Jf?kg(o,r):c===Bg?Fv(o,r):void 0}(r,o,g):ea(r,r[1],c,o)}function Bv(r,o,c,g){const w=o[19].queries[g];if(null===w.matches){const E=r.data,O=c.matches,B=[];for(let $=0;$<O.length;$+=2){const ie=O[$];B.push(ie<0?null:g1(o,E[ie],O[$+1],c.metadata.read))}w.matches=B}return w.matches}function fy(r,o,c,g){const w=r.queries.getByIndex(c),E=w.matches;if(null!==E){const O=Bv(r,o,w,c);for(let B=0;B<E.length;B+=2){const $=E[B];if($>0)g.push(O[B/2]);else{const ie=E[B+1],Ae=o[-$];for(let nt=10;nt<Ae.length;nt++){const Bt=Ae[nt];Bt[17]===Bt[3]&&fy(Bt[1],Bt,ie,g)}if(null!==Ae[9]){const nt=Ae[9];for(let Bt=0;Bt<nt.length;Bt++){const nn=nt[Bt];fy(nn[1],nn,ie,g)}}}}}return g}function Nv(r){const o=Sn(),c=Ri(),g=nr();cr(g+1);const w=Zv(c,g);if(r.dirty&&function Js(r){return 4==(4&r[2])}(o)===(2==(2&w.metadata.flags))){if(null===w.matches)r.reset([]);else{const E=w.crossesNgTemplate?fy(c,o,g,[]):Bv(c,o,w,g);r.reset(E,Gp),r.notifyOnChanges()}return!0}return!1}function zv(r,o,c){const g=Ri();g.firstCreatePass&&($v(g,new kv(r,o,c),-1),2==(2&o)&&(g.staticViewQueries=!0)),jv(g,Sn(),o)}function Uv(r,o,c,g){const w=Ri();if(w.firstCreatePass){const E=ao();$v(w,new kv(o,c,g),E.index),function v1(r,o){const c=r.contentQueries||(r.contentQueries=[]);o!==(c.length?c[c.length-1]:-1)&&c.push(r.queries.length-1,o)}(w,r),2==(2&c)&&(w.staticContentQueries=!0)}jv(w,Sn(),c)}function Vv(){return function y1(r,o){return r[19].queries[o].queryList}(Sn(),nr())}function jv(r,o,c){const g=new ly(4==(4&c));lf(r,o,g,g.destroy),null===o[19]&&(o[19]=new dy),o[19].queries.push(new uy(g))}function $v(r,o,c){null===r.queries&&(r.queries=new hy),r.queries.track(new py(o,c))}function Zv(r,o){return r.queries.getByIndex(o)}function zg(...r){}const u0=new Ar("Application Initializer");let Ug=(()=>{class r{constructor(c){this.appInits=c,this.resolve=zg,this.reject=zg,this.initialized=!1,this.done=!1,this.donePromise=new Promise((g,w)=>{this.resolve=g,this.reject=w})}runInitializers(){if(this.initialized)return;const c=[],g=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let w=0;w<this.appInits.length;w++){const E=this.appInits[w]();if(ll(E))c.push(E);else if(Sl(E)){const O=new Promise((B,$)=>{E.subscribe({complete:B,error:$})});c.push(O)}}Promise.all(c).then(()=>{g()}).catch(w=>{this.reject(w)}),0===c.length&&g(),this.initialized=!0}}return r.\u0275fac=function(c){return new(c||r)(gn(u0,8))},r.\u0275prov=ot({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const d0=new Ar("AppId",{providedIn:"root",factory:function h0(){return`${vy()}${vy()}${vy()}`}});function vy(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const p0=new Ar("Platform Initializer"),U1=new Ar("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),f0=new Ar("appBootstrapListener");let V1=(()=>{class r{log(c){console.log(c)}warn(c){console.warn(c)}}return r.\u0275fac=function(c){return new(c||r)},r.\u0275prov=ot({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();const Vg=new Ar("LocaleId",{providedIn:"root",factory:()=>se(Vg,Zt.Optional|Zt.SkipSelf)||function j1(){return typeof $localize<"u"&&$localize.locale||sp}()}),$1=new Ar("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class Z1{constructor(o,c){this.ngModuleFactory=o,this.componentFactories=c}}let G1=(()=>{class r{compileModuleSync(c){return new ry(c)}compileModuleAsync(c){return Promise.resolve(this.compileModuleSync(c))}compileModuleAndAllComponentsSync(c){const g=this.compileModuleSync(c),E=El(Rn(c).declarations).reduce((O,B)=>{const $=mi(B);return $&&O.push(new $s($)),O},[]);return new Z1(g,E)}compileModuleAndAllComponentsAsync(c){return Promise.resolve(this.compileModuleAndAllComponentsSync(c))}clearCache(){}clearCacheFor(c){}getModuleId(c){}}return r.\u0275fac=function(c){return new(c||r)},r.\u0275prov=ot({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const q1=(()=>Promise.resolve(0))();function xy(r){typeof Zone>"u"?q1.then(()=>{r&&r.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",r)}class Wl{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:c=!1,shouldCoalesceRunChangeDetection:g=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new kc(!1),this.onMicrotaskEmpty=new kc(!1),this.onStable=new kc(!1),this.onError=new kc(!1),typeof Zone>"u")throw new _e(908,!1);Zone.assertZonePatched();const w=this;w._nesting=0,w._outer=w._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(w._inner=w._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(w._inner=w._inner.fork(Zone.longStackTraceZoneSpec)),w.shouldCoalesceEventChangeDetection=!g&&c,w.shouldCoalesceRunChangeDetection=g,w.lastRequestAnimationFrameId=-1,w.nativeRequestAnimationFrame=function Y1(){let r=Qt.requestAnimationFrame,o=Qt.cancelAnimationFrame;if(typeof Zone<"u"&&r&&o){const c=r[Zone.__symbol__("OriginalDelegate")];c&&(r=c);const g=o[Zone.__symbol__("OriginalDelegate")];g&&(o=g)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function K1(r){const o=()=>{!function X1(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(Qt,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,wy(r),r.isCheckStableRunning=!0,by(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),wy(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(c,g,w,E,O,B)=>{try{return _0(r),c.invokeTask(w,E,O,B)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===E.type||r.shouldCoalesceRunChangeDetection)&&o(),y0(r)}},onInvoke:(c,g,w,E,O,B,$)=>{try{return _0(r),c.invoke(w,E,O,B,$)}finally{r.shouldCoalesceRunChangeDetection&&o(),y0(r)}},onHasTask:(c,g,w,E)=>{c.hasTask(w,E),g===w&&("microTask"==E.change?(r._hasPendingMicrotasks=E.microTask,wy(r),by(r)):"macroTask"==E.change&&(r.hasPendingMacrotasks=E.macroTask))},onHandleError:(c,g,w,E)=>(c.handleError(w,E),r.runOutsideAngular(()=>r.onError.emit(E)),!1)})}(w)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Wl.isInAngularZone())throw new _e(909,!1)}static assertNotInAngularZone(){if(Wl.isInAngularZone())throw new _e(909,!1)}run(o,c,g){return this._inner.run(o,c,g)}runTask(o,c,g,w){const E=this._inner,O=E.scheduleEventTask("NgZoneEvent: "+w,o,J1,zg,zg);try{return E.runTask(O,c,g)}finally{E.cancelTask(O)}}runGuarded(o,c,g){return this._inner.runGuarded(o,c,g)}runOutsideAngular(o){return this._outer.run(o)}}const J1={};function by(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function wy(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function _0(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function y0(r){r._nesting--,by(r)}class Q1{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new kc,this.onMicrotaskEmpty=new kc,this.onStable=new kc,this.onError=new kc}run(o,c,g){return o.apply(c,g)}runGuarded(o,c,g){return o.apply(c,g)}runOutsideAngular(o){return o()}runTask(o,c,g,w){return o.apply(c,g)}}const v0=new Ar(""),x0=new Ar("");let Cy,eb=(()=>{class r{constructor(c,g,w){this._ngZone=c,this.registry=g,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Cy||(function tb(r){Cy=r}(w),w.addToWindow(g)),this._watchAngularEvents(),c.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Wl.assertNotInAngularZone(),xy(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())xy(()=>{for(;0!==this._callbacks.length;){let c=this._callbacks.pop();clearTimeout(c.timeoutId),c.doneCb(this._didWork)}this._didWork=!1});else{let c=this.getPendingTasks();this._callbacks=this._callbacks.filter(g=>!g.updateCb||!g.updateCb(c)||(clearTimeout(g.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(c=>({source:c.source,creationLocation:c.creationLocation,data:c.data})):[]}addCallback(c,g,w){let E=-1;g&&g>0&&(E=setTimeout(()=>{this._callbacks=this._callbacks.filter(O=>O.timeoutId!==E),c(this._didWork,this.getPendingTasks())},g)),this._callbacks.push({doneCb:c,timeoutId:E,updateCb:w})}whenStable(c,g,w){if(w&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(c,g,w),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(c){this.registry.registerApplication(c,this)}unregisterApplication(c){this.registry.unregisterApplication(c)}findProviders(c,g,w){return[]}}return r.\u0275fac=function(c){return new(c||r)(gn(Wl),gn(b0),gn(x0))},r.\u0275prov=ot({token:r,factory:r.\u0275fac}),r})(),b0=(()=>{class r{constructor(){this._applications=new Map}registerApplication(c,g){this._applications.set(c,g)}unregisterApplication(c){this._applications.delete(c)}unregisterAllApplications(){this._applications.clear()}getTestability(c){return this._applications.get(c)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(c,g=!0){return Cy?.findTestabilityInTree(this,c,g)??null}}return r.\u0275fac=function(c){return new(c||r)},r.\u0275prov=ot({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})(),md=null;const w0=new Ar("AllowMultipleToken"),Ty=new Ar("PlatformDestroyListeners");class rb{constructor(o,c){this.name=o,this.token=c}}function T0(r,o,c=[]){const g=`Platform: ${o}`,w=new Ar(g);return(E=[])=>{let O=Ey();if(!O||O.injector.get(w0,!1)){const B=[...c,...E,{provide:w,useValue:!0}];r?r(B):function ob(r){if(md&&!md.get(w0,!1))throw new _e(400,!1);md=r;const o=r.get(D0);(function C0(r){const o=r.get(p0,null);o&&o.forEach(c=>c())})(r)}(function E0(r=[],o){return Ac.create({name:o,providers:[{provide:zp,useValue:"platform"},{provide:Ty,useValue:new Set([()=>md=null])},...r]})}(B,g))}return function ab(r){const o=Ey();if(!o)throw new _e(401,!1);return o}()}}function Ey(){return md?.get(D0)??null}let D0=(()=>{class r{constructor(c){this._injector=c,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(c,g){const w=function M0(r,o){let c;return c="noop"===r?new Q1:("zone.js"===r?void 0:r)||new Wl(o),c}(g?.ngZone,function I0(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!r||!r.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!r||!r.ngZoneRunCoalescing)||!1}}(g)),E=[{provide:Wl,useValue:w}];return w.run(()=>{const O=Ac.create({providers:E,parent:this.injector,name:c.moduleType.name}),B=c.create(O),$=B.injector.get(Vl,null);if(!$)throw new _e(402,!1);return w.runOutsideAngular(()=>{const ie=w.onError.subscribe({next:Ae=>{$.handleError(Ae)}});B.onDestroy(()=>{$g(this._modules,B),ie.unsubscribe()})}),function S0(r,o,c){try{const g=c();return ll(g)?g.catch(w=>{throw o.runOutsideAngular(()=>r.handleError(w)),w}):g}catch(g){throw o.runOutsideAngular(()=>r.handleError(g)),g}}($,w,()=>{const ie=B.injector.get(Ug);return ie.runInitializers(),ie.donePromise.then(()=>(function $y(r){kt(r,"Expected localeId to be defined"),"string"==typeof r&&(jy=r.toLowerCase().replace(/_/g,"-"))}(B.injector.get(Vg,sp)||sp),this._moduleDoBootstrap(B),B))})})}bootstrapModule(c,g=[]){const w=A0({},g);return function nb(r,o,c){const g=new ry(c);return Promise.resolve(g)}(0,0,c).then(E=>this.bootstrapModuleFactory(E,w))}_moduleDoBootstrap(c){const g=c.injector.get(jg);if(c._bootstrapComponents.length>0)c._bootstrapComponents.forEach(w=>g.bootstrap(w));else{if(!c.instance.ngDoBootstrap)throw new _e(-403,!1);c.instance.ngDoBootstrap(g)}this._modules.push(c)}onDestroy(c){this._destroyListeners.push(c)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new _e(404,!1);this._modules.slice().forEach(g=>g.destroy()),this._destroyListeners.forEach(g=>g());const c=this._injector.get(Ty,null);c&&(c.forEach(g=>g()),c.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return r.\u0275fac=function(c){return new(c||r)(gn(Ac))},r.\u0275prov=ot({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();function A0(r,o){return Array.isArray(o)?o.reduce(A0,r):{...r,...o}}let jg=(()=>{class r{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(c,g,w){this._zone=c,this._injector=g,this._exceptionHandler=w,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const E=new te.y(B=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{B.next(this._stable),B.complete()})}),O=new te.y(B=>{let $;this._zone.runOutsideAngular(()=>{$=this._zone.onStable.subscribe(()=>{Wl.assertNotInAngularZone(),xy(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,B.next(!0))})})});const ie=this._zone.onUnstable.subscribe(()=>{Wl.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{B.next(!1)}))});return()=>{$.unsubscribe(),ie.unsubscribe()}});this.isStable=function Me(...r){const o=(0,b.yG)(r),c=(0,b._6)(r,1/0),g=r;return g.length?1===g.length?(0,q.Xf)(g[0]):(0,l.J)(c)((0,he.D)(g,o)):re.E}(E,O.pipe((0,Ve.B)()))}bootstrap(c,g){const w=c instanceof Th;if(!this._injector.get(Ug).done)throw!w&&mr(c),new _e(405,false);let O;O=w?c:this._injector.get(Dd).resolveComponentFactory(c),this.componentTypes.push(O.componentType);const B=function ib(r){return r.isBoundToModule}(O)?void 0:this._injector.get(ap),ie=O.create(Ac.NULL,[],g||O.selector,B),Ae=ie.location.nativeElement,nt=ie.injector.get(v0,null);return nt?.registerApplication(Ae),ie.onDestroy(()=>{this.detachView(ie.hostView),$g(this.components,ie),nt?.unregisterApplication(Ae)}),this._loadComponent(ie),ie}tick(){if(this._runningTick)throw new _e(101,!1);try{this._runningTick=!0;for(let c of this._views)c.detectChanges()}catch(c){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(c))}finally{this._runningTick=!1}}attachView(c){const g=c;this._views.push(g),g.attachToAppRef(this)}detachView(c){const g=c;$g(this._views,g),g.detachFromAppRef()}_loadComponent(c){this.attachView(c.hostView),this.tick(),this.components.push(c);const g=this._injector.get(f0,[]);g.push(...this._bootstrapListeners),g.forEach(w=>w(c))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(c=>c()),this._views.slice().forEach(c=>c.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(c){return this._destroyListeners.push(c),()=>$g(this._destroyListeners,c)}destroy(){if(this._destroyed)throw new _e(406,!1);const c=this._injector;c.destroy&&!c.destroyed&&c.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return r.\u0275fac=function(c){return new(c||r)(gn(Wl),gn(tu),gn(Vl))},r.\u0275prov=ot({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function $g(r,o){const c=r.indexOf(o);c>-1&&r.splice(c,1)}function cb(){}let ub=(()=>{class r{}return r.__NG_ELEMENT_ID__=db,r})();function db(r){return function hb(r,o,c){if(ys(r)&&!c){const g=Dr(r.index,o);return new sc(g,g)}return 47&r.type?new sc(o[16],o):null}(ao(),Sn(),16==(16&r))}class F0{constructor(){}supports(o){return Ml(o)}create(o){return new yb(o)}}const _b=(r,o)=>o;class yb{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||_b}forEachItem(o){let c;for(c=this._itHead;null!==c;c=c._next)o(c)}forEachOperation(o){let c=this._itHead,g=this._removalsHead,w=0,E=null;for(;c||g;){const O=!g||c&&c.currentIndex<B0(g,w,E)?c:g,B=B0(O,w,E),$=O.currentIndex;if(O===g)w--,g=g._nextRemoved;else if(c=c._next,null==O.previousIndex)w++;else{E||(E=[]);const ie=B-w,Ae=$-w;if(ie!=Ae){for(let Bt=0;Bt<ie;Bt++){const nn=Bt<E.length?E[Bt]:E[Bt]=0,En=nn+Bt;Ae<=En&&En<ie&&(E[Bt]=nn+1)}E[O.previousIndex]=Ae-ie}}B!==$&&o(O,B,$)}}forEachPreviousItem(o){let c;for(c=this._previousItHead;null!==c;c=c._nextPrevious)o(c)}forEachAddedItem(o){let c;for(c=this._additionsHead;null!==c;c=c._nextAdded)o(c)}forEachMovedItem(o){let c;for(c=this._movesHead;null!==c;c=c._nextMoved)o(c)}forEachRemovedItem(o){let c;for(c=this._removalsHead;null!==c;c=c._nextRemoved)o(c)}forEachIdentityChange(o){let c;for(c=this._identityChangesHead;null!==c;c=c._nextIdentityChange)o(c)}diff(o){if(null==o&&(o=[]),!Ml(o))throw new _e(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let w,E,O,c=this._itHead,g=!1;if(Array.isArray(o)){this.length=o.length;for(let B=0;B<this.length;B++)E=o[B],O=this._trackByFn(B,E),null!==c&&Object.is(c.trackById,O)?(g&&(c=this._verifyReinsertion(c,E,O,B)),Object.is(c.item,E)||this._addIdentityChange(c,E)):(c=this._mismatch(c,E,O,B),g=!0),c=c._next}else w=0,function Vd(r,o){if(Array.isArray(r))for(let c=0;c<r.length;c++)o(r[c]);else{const c=r[Va()]();let g;for(;!(g=c.next()).done;)o(g.value)}}(o,B=>{O=this._trackByFn(w,B),null!==c&&Object.is(c.trackById,O)?(g&&(c=this._verifyReinsertion(c,B,O,w)),Object.is(c.item,B)||this._addIdentityChange(c,B)):(c=this._mismatch(c,B,O,w),g=!0),c=c._next,w++}),this.length=w;return this._truncate(c),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,c,g,w){let E;return null===o?E=this._itTail:(E=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(g,null))?(Object.is(o.item,c)||this._addIdentityChange(o,c),this._reinsertAfter(o,E,w)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(g,w))?(Object.is(o.item,c)||this._addIdentityChange(o,c),this._moveAfter(o,E,w)):o=this._addAfter(new vb(c,g),E,w),o}_verifyReinsertion(o,c,g,w){let E=null===this._unlinkedRecords?null:this._unlinkedRecords.get(g,null);return null!==E?o=this._reinsertAfter(E,o._prev,w):o.currentIndex!=w&&(o.currentIndex=w,this._addToMoves(o,w)),o}_truncate(o){for(;null!==o;){const c=o._next;this._addToRemovals(this._unlink(o)),o=c}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,c,g){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const w=o._prevRemoved,E=o._nextRemoved;return null===w?this._removalsHead=E:w._nextRemoved=E,null===E?this._removalsTail=w:E._prevRemoved=w,this._insertAfter(o,c,g),this._addToMoves(o,g),o}_moveAfter(o,c,g){return this._unlink(o),this._insertAfter(o,c,g),this._addToMoves(o,g),o}_addAfter(o,c,g){return this._insertAfter(o,c,g),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,c,g){const w=null===c?this._itHead:c._next;return o._next=w,o._prev=c,null===w?this._itTail=o:w._prev=o,null===c?this._itHead=o:c._next=o,null===this._linkedRecords&&(this._linkedRecords=new k0),this._linkedRecords.put(o),o.currentIndex=g,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const c=o._prev,g=o._next;return null===c?this._itHead=g:c._next=g,null===g?this._itTail=c:g._prev=c,o}_addToMoves(o,c){return o.previousIndex===c||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new k0),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,c){return o.item=c,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class vb{constructor(o,c){this.item=o,this.trackById=c,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class xb{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,c){let g;for(g=this._head;null!==g;g=g._nextDup)if((null===c||c<=g.currentIndex)&&Object.is(g.trackById,o))return g;return null}remove(o){const c=o._prevDup,g=o._nextDup;return null===c?this._head=g:c._nextDup=g,null===g?this._tail=c:g._prevDup=c,null===this._head}}class k0{constructor(){this.map=new Map}put(o){const c=o.trackById;let g=this.map.get(c);g||(g=new xb,this.map.set(c,g)),g.add(o)}get(o,c){const w=this.map.get(o);return w?w.get(o,c):null}remove(o){const c=o.trackById;return this.map.get(c).remove(o)&&this.map.delete(c),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function B0(r,o,c){const g=r.previousIndex;if(null===g)return g;let w=0;return c&&g<c.length&&(w=c[g]),g+o+w}class N0{constructor(){}supports(o){return o instanceof Map||pu(o)}create(){return new bb}}class bb{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let c;for(c=this._mapHead;null!==c;c=c._next)o(c)}forEachPreviousItem(o){let c;for(c=this._previousMapHead;null!==c;c=c._nextPrevious)o(c)}forEachChangedItem(o){let c;for(c=this._changesHead;null!==c;c=c._nextChanged)o(c)}forEachAddedItem(o){let c;for(c=this._additionsHead;null!==c;c=c._nextAdded)o(c)}forEachRemovedItem(o){let c;for(c=this._removalsHead;null!==c;c=c._nextRemoved)o(c)}diff(o){if(o){if(!(o instanceof Map||pu(o)))throw new _e(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let c=this._mapHead;if(this._appendAfter=null,this._forEach(o,(g,w)=>{if(c&&c.key===w)this._maybeAddToChanges(c,g),this._appendAfter=c,c=c._next;else{const E=this._getOrCreateRecordForKey(w,g);c=this._insertBeforeOrAppend(c,E)}}),c){c._prev&&(c._prev._next=null),this._removalsHead=c;for(let g=c;null!==g;g=g._nextRemoved)g===this._mapHead&&(this._mapHead=null),this._records.delete(g.key),g._nextRemoved=g._next,g.previousValue=g.currentValue,g.currentValue=null,g._prev=null,g._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,c){if(o){const g=o._prev;return c._next=o,c._prev=g,o._prev=c,g&&(g._next=c),o===this._mapHead&&(this._mapHead=c),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=c,c._prev=this._appendAfter):this._mapHead=c,this._appendAfter=c,null}_getOrCreateRecordForKey(o,c){if(this._records.has(o)){const w=this._records.get(o);this._maybeAddToChanges(w,c);const E=w._prev,O=w._next;return E&&(E._next=O),O&&(O._prev=E),w._next=null,w._prev=null,w}const g=new wb(o);return this._records.set(o,g),g.currentValue=c,this._addToAdditions(g),g}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,c){Object.is(c,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=c,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,c){o instanceof Map?o.forEach(c):Object.keys(o).forEach(g=>c(o[g],g))}}class wb{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function z0(){return new Ay([new F0])}let Ay=(()=>{class r{constructor(c){this.factories=c}static create(c,g){if(null!=g){const w=g.factories.slice();c=c.concat(w)}return new r(c)}static extend(c){return{provide:r,useFactory:g=>r.create(c,g||z0()),deps:[[r,new _t,new Ze]]}}find(c){const g=this.factories.find(w=>w.supports(c));if(null!=g)return g;throw new _e(901,!1)}}return r.\u0275prov=ot({token:r,providedIn:"root",factory:z0}),r})();function U0(){return new Py([new N0])}let Py=(()=>{class r{constructor(c){this.factories=c}static create(c,g){if(g){const w=g.factories.slice();c=c.concat(w)}return new r(c)}static extend(c){return{provide:r,useFactory:g=>r.create(c,g||U0()),deps:[[r,new _t,new Ze]]}}find(c){const g=this.factories.find(w=>w.supports(c));if(g)return g;throw new _e(901,!1)}}return r.\u0275prov=ot({token:r,providedIn:"root",factory:U0}),r})();const Eb=T0(null,"core",[]);let Db=(()=>{class r{constructor(c){}}return r.\u0275fac=function(c){return new(c||r)(gn(jg))},r.\u0275mod=Xt({type:r}),r.\u0275inj=bn({}),r})();function Ib(r){return"boolean"==typeof r?r:null!=r&&"false"!==r}},4006:(Pn,Et,k)=>{"use strict";k.d(Et,{Fd:()=>Mo,Fj:()=>ze,JJ:()=>pi,JU:()=>he,On:()=>Ni,a5:()=>bn,qQ:()=>Ma,u5:()=>Jo,wV:()=>Hr});var d=k(8274),y=k(6895),te=k(2076),l=k(4128),q=k(4004);let re=(()=>{class K{constructor(G,Ie){this._renderer=G,this._elementRef=Ie,this.onChange=pn=>{},this.onTouched=()=>{}}setProperty(G,Ie){this._renderer.setProperty(this._elementRef.nativeElement,G,Ie)}registerOnTouched(G){this.onTouched=G}registerOnChange(G){this.onChange=G}setDisabledState(G){this.setProperty("disabled",G)}}return K.\u0275fac=function(G){return new(G||K)(d.Y36(d.Qsj),d.Y36(d.SBq))},K.\u0275dir=d.lG2({type:K}),K})(),b=(()=>{class K extends re{}return K.\u0275fac=function(){let Y;return function(Ie){return(Y||(Y=d.n5z(K)))(Ie||K)}}(),K.\u0275dir=d.lG2({type:K,features:[d.qOj]}),K})();const he=new d.OlP("NgValueAccessor"),X={provide:he,useExisting:(0,d.Gpc)(()=>ze),multi:!0},fe=new d.OlP("CompositionEventMode");let ze=(()=>{class K extends re{constructor(G,Ie,pn){super(G,Ie),this._compositionMode=pn,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function xe(){const K=(0,y.q)()?(0,y.q)().getUserAgent():"";return/android (\d+)/.test(K.toLowerCase())}())}writeValue(G){this.setProperty("value",G??"")}_handleInput(G){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(G)}_compositionStart(){this._composing=!0}_compositionEnd(G){this._composing=!1,this._compositionMode&&this.onChange(G)}}return K.\u0275fac=function(G){return new(G||K)(d.Y36(d.Qsj),d.Y36(d.SBq),d.Y36(fe,8))},K.\u0275dir=d.lG2({type:K,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(G,Ie){1&G&&d.NdJ("input",function(ci){return Ie._handleInput(ci.target.value)})("blur",function(){return Ie.onTouched()})("compositionstart",function(){return Ie._compositionStart()})("compositionend",function(ci){return Ie._compositionEnd(ci.target.value)})},features:[d._Bn([X]),d.qOj]}),K})();function Ke(K){return null==K||("string"==typeof K||Array.isArray(K))&&0===K.length}const Q=new d.OlP("NgValidators"),Ye=new d.OlP("NgAsyncValidators");function oe(K){return null}function Ee(K){return null!=K}function vt(K){return(0,d.QGY)(K)?(0,te.D)(K):K}function Tt(K){let Y={};return K.forEach(G=>{Y=null!=G?{...Y,...G}:Y}),0===Object.keys(Y).length?null:Y}function Gt(K,Y){return Y.map(G=>G(K))}function yt(K){return K.map(Y=>function Ot(K){return!K.validate}(Y)?Y:G=>Y.validate(G))}function gt(K){return null!=K?function Mt(K){if(!K)return null;const Y=K.filter(Ee);return 0==Y.length?null:function(G){return Tt(Gt(G,Y))}}(yt(K)):null}function at(K){return null!=K?function it(K){if(!K)return null;const Y=K.filter(Ee);return 0==Y.length?null:function(G){const Ie=Gt(G,Y).map(vt);return(0,l.D)(Ie).pipe((0,q.U)(Tt))}}(yt(K)):null}function Ce(K,Y){return null===K?[Y]:Array.isArray(K)?[...K,Y]:[K,Y]}function Vt(K){return K?Array.isArray(K)?K:[K]:[]}function yn(K,Y){return Array.isArray(K)?K.includes(Y):K===Y}function Fn(K,Y){const G=Vt(Y);return Vt(K).forEach(pn=>{yn(G,pn)||G.push(pn)}),G}function cn(K,Y){return Vt(Y).filter(G=>!yn(K,G))}class ot{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(Y){this._rawValidators=Y||[],this._composedValidatorFn=gt(this._rawValidators)}_setAsyncValidators(Y){this._rawAsyncValidators=Y||[],this._composedAsyncValidatorFn=at(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(Y){this._onDestroyCallbacks.push(Y)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(Y=>Y()),this._onDestroyCallbacks=[]}reset(Y){this.control&&this.control.reset(Y)}hasError(Y,G){return!!this.control&&this.control.hasError(Y,G)}getError(Y,G){return this.control?this.control.getError(Y,G):null}}class Nt extends ot{get formDirective(){return null}get path(){return null}}class bn extends ot{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Kn{constructor(Y){this._cd=Y}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let pi=(()=>{class K extends Kn{constructor(G){super(G)}}return K.\u0275fac=function(G){return new(G||K)(d.Y36(bn,2))},K.\u0275dir=d.lG2({type:K,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(G,Ie){2&G&&d.ekj("ng-untouched",Ie.isUntouched)("ng-touched",Ie.isTouched)("ng-pristine",Ie.isPristine)("ng-dirty",Ie.isDirty)("ng-valid",Ie.isValid)("ng-invalid",Ie.isInvalid)("ng-pending",Ie.isPending)},features:[d.qOj]}),K})();const fr="VALID",wr="INVALID",Cr="PENDING",si="DISABLED";function Ue(K){return null!=K&&!Array.isArray(K)&&"object"==typeof K}class z{constructor(Y,G){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(Y),this._assignAsyncValidators(G)}get validator(){return this._composedValidatorFn}set validator(Y){this._rawValidators=this._composedValidatorFn=Y}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(Y){this._rawAsyncValidators=this._composedAsyncValidatorFn=Y}get parent(){return this._parent}get valid(){return this.status===fr}get invalid(){return this.status===wr}get pending(){return this.status==Cr}get disabled(){return this.status===si}get enabled(){return this.status!==si}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(Y){this._assignValidators(Y)}setAsyncValidators(Y){this._assignAsyncValidators(Y)}addValidators(Y){this.setValidators(Fn(Y,this._rawValidators))}addAsyncValidators(Y){this.setAsyncValidators(Fn(Y,this._rawAsyncValidators))}removeValidators(Y){this.setValidators(cn(Y,this._rawValidators))}removeAsyncValidators(Y){this.setAsyncValidators(cn(Y,this._rawAsyncValidators))}hasValidator(Y){return yn(this._rawValidators,Y)}hasAsyncValidator(Y){return yn(this._rawAsyncValidators,Y)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(Y={}){this.touched=!0,this._parent&&!Y.onlySelf&&this._parent.markAsTouched(Y)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(Y=>Y.markAllAsTouched())}markAsUntouched(Y={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(G=>{G.markAsUntouched({onlySelf:!0})}),this._parent&&!Y.onlySelf&&this._parent._updateTouched(Y)}markAsDirty(Y={}){this.pristine=!1,this._parent&&!Y.onlySelf&&this._parent.markAsDirty(Y)}markAsPristine(Y={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(G=>{G.markAsPristine({onlySelf:!0})}),this._parent&&!Y.onlySelf&&this._parent._updatePristine(Y)}markAsPending(Y={}){this.status=Cr,!1!==Y.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!Y.onlySelf&&this._parent.markAsPending(Y)}disable(Y={}){const G=this._parentMarkedDirty(Y.onlySelf);this.status=si,this.errors=null,this._forEachChild(Ie=>{Ie.disable({...Y,onlySelf:!0})}),this._updateValue(),!1!==Y.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...Y,skipPristineCheck:G}),this._onDisabledChange.forEach(Ie=>Ie(!0))}enable(Y={}){const G=this._parentMarkedDirty(Y.onlySelf);this.status=fr,this._forEachChild(Ie=>{Ie.enable({...Y,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:Y.emitEvent}),this._updateAncestors({...Y,skipPristineCheck:G}),this._onDisabledChange.forEach(Ie=>Ie(!1))}_updateAncestors(Y){this._parent&&!Y.onlySelf&&(this._parent.updateValueAndValidity(Y),Y.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(Y){this._parent=Y}getRawValue(){return this.value}updateValueAndValidity(Y={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===fr||this.status===Cr)&&this._runAsyncValidator(Y.emitEvent)),!1!==Y.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!Y.onlySelf&&this._parent.updateValueAndValidity(Y)}_updateTreeValidity(Y={emitEvent:!0}){this._forEachChild(G=>G._updateTreeValidity(Y)),this.updateValueAndValidity({onlySelf:!0,emitEvent:Y.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?si:fr}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(Y){if(this.asyncValidator){this.status=Cr,this._hasOwnPendingAsyncValidator=!0;const G=vt(this.asyncValidator(this));this._asyncValidationSubscription=G.subscribe(Ie=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(Ie,{emitEvent:Y})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(Y,G={}){this.errors=Y,this._updateControlsErrors(!1!==G.emitEvent)}get(Y){let G=Y;return null==G||(Array.isArray(G)||(G=G.split(".")),0===G.length)?null:G.reduce((Ie,pn)=>Ie&&Ie._find(pn),this)}getError(Y,G){const Ie=G?this.get(G):this;return Ie&&Ie.errors?Ie.errors[Y]:null}hasError(Y,G){return!!this.getError(Y,G)}get root(){let Y=this;for(;Y._parent;)Y=Y._parent;return Y}_updateControlsErrors(Y){this.status=this._calculateStatus(),Y&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(Y)}_initObservables(){this.valueChanges=new d.vpe,this.statusChanges=new d.vpe}_calculateStatus(){return this._allControlsDisabled()?si:this.errors?wr:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Cr)?Cr:this._anyControlsHaveStatus(wr)?wr:fr}_anyControlsHaveStatus(Y){return this._anyControls(G=>G.status===Y)}_anyControlsDirty(){return this._anyControls(Y=>Y.dirty)}_anyControlsTouched(){return this._anyControls(Y=>Y.touched)}_updatePristine(Y={}){this.pristine=!this._anyControlsDirty(),this._parent&&!Y.onlySelf&&this._parent._updatePristine(Y)}_updateTouched(Y={}){this.touched=this._anyControlsTouched(),this._parent&&!Y.onlySelf&&this._parent._updateTouched(Y)}_registerOnCollectionChange(Y){this._onCollectionChange=Y}_setUpdateStrategy(Y){Ue(Y)&&null!=Y.updateOn&&(this._updateOn=Y.updateOn)}_parentMarkedDirty(Y){return!Y&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(Y){return null}_assignValidators(Y){this._rawValidators=Array.isArray(Y)?Y.slice():Y,this._composedValidatorFn=function wt(K){return Array.isArray(K)?gt(K):K||null}(this._rawValidators)}_assignAsyncValidators(Y){this._rawAsyncValidators=Array.isArray(Y)?Y.slice():Y,this._composedAsyncValidatorFn=function gn(K){return Array.isArray(K)?at(K):K||null}(this._rawAsyncValidators)}}const ye=new d.OlP("CallSetDisabledState",{providedIn:"root",factory:()=>be}),be="always";function dt(K,Y,G=be){(function Nn(K,Y){const G=function bt(K){return K._rawValidators}(K);null!==Y.validator?K.setValidators(Ce(G,Y.validator)):"function"==typeof G&&K.setValidators([G]);const Ie=function kt(K){return K._rawAsyncValidators}(K);null!==Y.asyncValidator?K.setAsyncValidators(Ce(Ie,Y.asyncValidator)):"function"==typeof Ie&&K.setAsyncValidators([Ie]);const pn=()=>K.updateValueAndValidity();on(Y._rawValidators,pn),on(Y._rawAsyncValidators,pn)})(K,Y),Y.valueAccessor.writeValue(K.value),(K.disabled||"always"===G)&&Y.valueAccessor.setDisabledState?.(K.disabled),function Ei(K,Y){Y.valueAccessor.registerOnChange(G=>{K._pendingValue=G,K._pendingChange=!0,K._pendingDirty=!0,"change"===K.updateOn&&Hn(K,Y)})}(K,Y),function Vi(K,Y){const G=(Ie,pn)=>{Y.valueAccessor.writeValue(Ie),pn&&Y.viewToModelUpdate(Ie)};K.registerOnChange(G),Y._registerOnDestroy(()=>{K._unregisterOnChange(G)})}(K,Y),function di(K,Y){Y.valueAccessor.registerOnTouched(()=>{K._pendingTouched=!0,"blur"===K.updateOn&&K._pendingChange&&Hn(K,Y),"submit"!==K.updateOn&&K.markAsTouched()})}(K,Y),function Dn(K,Y){if(Y.valueAccessor.setDisabledState){const G=Ie=>{Y.valueAccessor.setDisabledState(Ie)};K.registerOnDisabledChange(G),Y._registerOnDestroy(()=>{K._unregisterOnDisabledChange(G)})}}(K,Y)}function on(K,Y){K.forEach(G=>{G.registerOnValidatorChange&&G.registerOnValidatorChange(Y)})}function Hn(K,Y){K._pendingDirty&&K.markAsDirty(),K.setValue(K._pendingValue,{emitModelToViewChange:!1}),Y.viewToModelUpdate(K._pendingValue),K._pendingChange=!1}function me(K,Y){const G=K.indexOf(Y);G>-1&&K.splice(G,1)}function Ge(K){return"object"==typeof K&&null!==K&&2===Object.keys(K).length&&"value"in K&&"disabled"in K}const ct=class extends z{constructor(Y=null,G,Ie){super(function dn(K){return(Ue(K)?K.validators:K)||null}(G),function Pt(K,Y){return(Ue(Y)?Y.asyncValidators:K)||null}(Ie,G)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(Y),this._setUpdateStrategy(G),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Ue(G)&&(G.nonNullable||G.initialValueIsDefault)&&(this.defaultValue=Ge(Y)?Y.value:Y)}setValue(Y,G={}){this.value=this._pendingValue=Y,this._onChange.length&&!1!==G.emitModelToViewChange&&this._onChange.forEach(Ie=>Ie(this.value,!1!==G.emitViewToModelChange)),this.updateValueAndValidity(G)}patchValue(Y,G={}){this.setValue(Y,G)}reset(Y=this.defaultValue,G={}){this._applyFormState(Y),this.markAsPristine(G),this.markAsUntouched(G),this.setValue(this.value,G),this._pendingChange=!1}_updateValue(){}_anyControls(Y){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(Y){this._onChange.push(Y)}_unregisterOnChange(Y){me(this._onChange,Y)}registerOnDisabledChange(Y){this._onDisabledChange.push(Y)}_unregisterOnDisabledChange(Y){me(this._onDisabledChange,Y)}_forEachChild(Y){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(Y){Ge(Y)?(this.value=this._pendingValue=Y.value,Y.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=Y}},Mi={provide:bn,useExisting:(0,d.Gpc)(()=>Ni)},Bi=(()=>Promise.resolve())();let Ni=(()=>{class K extends bn{constructor(G,Ie,pn,ci,dr,hr){super(),this._changeDetectorRef=dr,this.callSetDisabledState=hr,this.control=new ct,this._registered=!1,this.update=new d.vpe,this._parent=G,this._setValidators(Ie),this._setAsyncValidators(pn),this.valueAccessor=function Qi(K,Y){if(!Y)return null;let G,Ie,pn;return Array.isArray(Y),Y.forEach(ci=>{ci.constructor===ze?G=ci:function wo(K){return Object.getPrototypeOf(K.constructor)===b}(ci)?Ie=ci:pn=ci}),pn||Ie||G||null}(0,ci)}ngOnChanges(G){if(this._checkForErrors(),!this._registered||"name"in G){if(this._registered&&(this._checkName(),this.formDirective)){const Ie=G.name.previousValue;this.formDirective.removeControl({name:Ie,path:this._getPath(Ie)})}this._setUpControl()}"isDisabled"in G&&this._updateDisabled(G),function eo(K,Y){if(!K.hasOwnProperty("model"))return!1;const G=K.model;return!!G.isFirstChange()||!Object.is(Y,G.currentValue)}(G,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(G){this.viewModel=G,this.update.emit(G)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){dt(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(G){Bi.then(()=>{this.control.setValue(G,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(G){const Ie=G.isDisabled.currentValue,pn=0!==Ie&&(0,d.D6c)(Ie);Bi.then(()=>{pn&&!this.control.disabled?this.control.disable():!pn&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(G){return this._parent?function De(K,Y){return[...Y.path,K]}(G,this._parent):[G]}}return K.\u0275fac=function(G){return new(G||K)(d.Y36(Nt,9),d.Y36(Q,10),d.Y36(Ye,10),d.Y36(he,10),d.Y36(d.sBO,8),d.Y36(ye,8))},K.\u0275dir=d.lG2({type:K,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[d._Bn([Mi]),d.qOj,d.TTD]}),K})();const ir={provide:he,useExisting:(0,d.Gpc)(()=>Hr),multi:!0};let Hr=(()=>{class K extends b{writeValue(G){this.setProperty("value",G??"")}registerOnChange(G){this.onChange=Ie=>{G(""==Ie?null:parseFloat(Ie))}}}return K.\u0275fac=function(){let Y;return function(Ie){return(Y||(Y=d.n5z(K)))(Ie||K)}}(),K.\u0275dir=d.lG2({type:K,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(G,Ie){1&G&&d.NdJ("input",function(ci){return Ie.onChange(ci.target.value)})("blur",function(){return Ie.onTouched()})},features:[d._Bn([ir]),d.qOj]}),K})(),or=(()=>{class K{}return K.\u0275fac=function(G){return new(G||K)},K.\u0275mod=d.oAB({type:K}),K.\u0275inj=d.cJS({}),K})();function Ws(K){return"number"==typeof K?K:parseFloat(K)}let ls=(()=>{class K{constructor(){this._validator=oe}ngOnChanges(G){if(this.inputName in G){const Ie=this.normalizeInput(G[this.inputName].currentValue);this._enabled=this.enabled(Ie),this._validator=this._enabled?this.createValidator(Ie):oe,this._onChange&&this._onChange()}}validate(G){return this._validator(G)}registerOnValidatorChange(G){this._onChange=G}enabled(G){return null!=G}}return K.\u0275fac=function(G){return new(G||K)},K.\u0275dir=d.lG2({type:K,features:[d.TTD]}),K})();const fa={provide:Q,useExisting:(0,d.Gpc)(()=>Mo),multi:!0};let Mo=(()=>{class K extends ls{constructor(){super(...arguments),this.inputName="max",this.normalizeInput=G=>Ws(G),this.createValidator=G=>function ke(K){return Y=>{if(Ke(Y.value)||Ke(K))return null;const G=parseFloat(Y.value);return!isNaN(G)&&G>K?{max:{max:K,actual:Y.value}}:null}}(G)}}return K.\u0275fac=function(){let Y;return function(Ie){return(Y||(Y=d.n5z(K)))(Ie||K)}}(),K.\u0275dir=d.lG2({type:K,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(G,Ie){2&G&&d.uIk("max",Ie._enabled?Ie.max:null)},inputs:{max:"max"},features:[d._Bn([fa]),d.qOj]}),K})();const cl={provide:Q,useExisting:(0,d.Gpc)(()=>Ma),multi:!0};let Ma=(()=>{class K extends ls{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=G=>Ws(G),this.createValidator=G=>function _e(K){return Y=>{if(Ke(Y.value)||Ke(K))return null;const G=parseFloat(Y.value);return!isNaN(G)&&G<K?{min:{min:K,actual:Y.value}}:null}}(G)}}return K.\u0275fac=function(){let Y;return function(Ie){return(Y||(Y=d.n5z(K)))(Ie||K)}}(),K.\u0275dir=d.lG2({type:K,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(G,Ie){2&G&&d.uIk("min",Ie._enabled?Ie.min:null)},inputs:{min:"min"},features:[d._Bn([cl]),d.qOj]}),K})(),Xr=(()=>{class K{}return K.\u0275fac=function(G){return new(G||K)},K.\u0275mod=d.oAB({type:K}),K.\u0275inj=d.cJS({imports:[or]}),K})(),Jo=(()=>{class K{static withConfig(G){return{ngModule:K,providers:[{provide:ye,useValue:G.callSetDisabledState??be}]}}}return K.\u0275fac=function(G){return new(G||K)},K.\u0275mod=d.oAB({type:K}),K.\u0275inj=d.cJS({imports:[Xr]}),K})()},1481:(Pn,Et,k)=>{"use strict";k.d(Et,{Dx:()=>Yi,b2:()=>bi,q6:()=>Kn});var d=k(6895),y=k(8274);class te extends d.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class l extends te{static makeCurrent(){(0,d.HT)(new l)}onAndCancel(be,De,dt){return be.addEventListener(De,dt,!1),()=>{be.removeEventListener(De,dt,!1)}}dispatchEvent(be,De){be.dispatchEvent(De)}remove(be){be.parentNode&&be.parentNode.removeChild(be)}createElement(be,De){return(De=De||this.getDefaultDocument()).createElement(be)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(be){return be.nodeType===Node.ELEMENT_NODE}isShadowRoot(be){return be instanceof DocumentFragment}getGlobalEventTarget(be,De){return"window"===De?window:"document"===De?be:"body"===De?be.body:null}getBaseHref(be){const De=function re(){return q=q||document.querySelector("base"),q?q.getAttribute("href"):null}();return null==De?null:function he(ye){b=b||document.createElement("a"),b.setAttribute("href",ye);const be=b.pathname;return"/"===be.charAt(0)?be:`/${be}`}(De)}resetBaseElement(){q=null}getUserAgent(){return window.navigator.userAgent}getCookie(be){return(0,d.Mx)(document.cookie,be)}}let b,q=null;const Me=new y.OlP("TRANSITION_ID"),X=[{provide:y.ip1,useFactory:function Ve(ye,be,De){return()=>{De.get(y.CZH).donePromise.then(()=>{const dt=(0,d.q)(),pt=be.querySelectorAll(`style[ng-transition="${ye}"]`);for(let on=0;on<pt.length;on++)dt.remove(pt[on])})}},deps:[Me,d.K0,y.zs3],multi:!0}];let fe=(()=>{class ye{build(){return new XMLHttpRequest}}return ye.\u0275fac=function(De){return new(De||ye)},ye.\u0275prov=y.Yz7({token:ye,factory:ye.\u0275fac}),ye})();const ze=new y.OlP("EventManagerPlugins");let le=(()=>{class ye{constructor(De,dt){this._zone=dt,this._eventNameToPlugin=new Map,De.forEach(pt=>pt.manager=this),this._plugins=De.slice().reverse()}addEventListener(De,dt,pt){return this._findPluginFor(dt).addEventListener(De,dt,pt)}addGlobalEventListener(De,dt,pt){return this._findPluginFor(dt).addGlobalEventListener(De,dt,pt)}getZone(){return this._zone}_findPluginFor(De){const dt=this._eventNameToPlugin.get(De);if(dt)return dt;const pt=this._plugins;for(let on=0;on<pt.length;on++){const Dn=pt[on];if(Dn.supports(De))return this._eventNameToPlugin.set(De,Dn),Dn}throw new Error(`No event manager plugin found for event ${De}`)}}return ye.\u0275fac=function(De){return new(De||ye)(y.LFG(ze),y.LFG(y.R0b))},ye.\u0275prov=y.Yz7({token:ye,factory:ye.\u0275fac}),ye})();class Ke{constructor(be){this._doc=be}addGlobalEventListener(be,De,dt){const pt=(0,d.q)().getGlobalEventTarget(this._doc,be);if(!pt)throw new Error(`Unsupported event target ${pt} for event ${De}`);return this.addEventListener(pt,De,dt)}}let Oe=(()=>{class ye{constructor(){this._stylesSet=new Set}addStyles(De){const dt=new Set;De.forEach(pt=>{this._stylesSet.has(pt)||(this._stylesSet.add(pt),dt.add(pt))}),this.onStylesAdded(dt)}onStylesAdded(De){}getAllStyles(){return Array.from(this._stylesSet)}}return ye.\u0275fac=function(De){return new(De||ye)},ye.\u0275prov=y.Yz7({token:ye,factory:ye.\u0275fac}),ye})(),Q=(()=>{class ye extends Oe{constructor(De){super(),this._doc=De,this._hostNodes=new Map,this._hostNodes.set(De.head,[])}_addStylesToHost(De,dt,pt){De.forEach(on=>{const Dn=this._doc.createElement("style");Dn.textContent=on,pt.push(dt.appendChild(Dn))})}addHost(De){const dt=[];this._addStylesToHost(this._stylesSet,De,dt),this._hostNodes.set(De,dt)}removeHost(De){const dt=this._hostNodes.get(De);dt&&dt.forEach(Ye),this._hostNodes.delete(De)}onStylesAdded(De){this._hostNodes.forEach((dt,pt)=>{this._addStylesToHost(De,pt,dt)})}ngOnDestroy(){this._hostNodes.forEach(De=>De.forEach(Ye))}}return ye.\u0275fac=function(De){return new(De||ye)(y.LFG(d.K0))},ye.\u0275prov=y.Yz7({token:ye,factory:ye.\u0275fac}),ye})();function Ye(ye){(0,d.q)().remove(ye)}const St={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},lt=/%COMP%/g;function ge(ye,be){return be.flat(100).map(De=>De.replace(lt,ye))}function de(ye){return be=>{if("__ngUnwrap__"===be)return ye;!1===ye(be)&&(be.preventDefault(),be.returnValue=!1)}}let oe=(()=>{class ye{constructor(De,dt,pt){this.eventManager=De,this.sharedStylesHost=dt,this.appId=pt,this.rendererByCompId=new Map,this.defaultRenderer=new Ee(De)}createRenderer(De,dt){if(!De||!dt)return this.defaultRenderer;switch(dt.encapsulation){case y.ifc.Emulated:{let pt=this.rendererByCompId.get(dt.id);return pt||(pt=new Ot(this.eventManager,this.sharedStylesHost,dt,this.appId),this.rendererByCompId.set(dt.id,pt)),pt.applyToHost(De),pt}case y.ifc.ShadowDom:return new yt(this.eventManager,this.sharedStylesHost,De,dt);default:if(!this.rendererByCompId.has(dt.id)){const pt=ge(dt.id,dt.styles);this.sharedStylesHost.addStyles(pt),this.rendererByCompId.set(dt.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return ye.\u0275fac=function(De){return new(De||ye)(y.LFG(le),y.LFG(Q),y.LFG(y.AFp))},ye.\u0275prov=y.Yz7({token:ye,factory:ye.\u0275fac}),ye})();class Ee{constructor(be){this.eventManager=be,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(be,De){return De?document.createElementNS(St[De]||De,be):document.createElement(be)}createComment(be){return document.createComment(be)}createText(be){return document.createTextNode(be)}appendChild(be,De){(Gt(be)?be.content:be).appendChild(De)}insertBefore(be,De,dt){be&&(Gt(be)?be.content:be).insertBefore(De,dt)}removeChild(be,De){be&&be.removeChild(De)}selectRootElement(be,De){let dt="string"==typeof be?document.querySelector(be):be;if(!dt)throw new Error(`The selector "${be}" did not match any elements`);return De||(dt.textContent=""),dt}parentNode(be){return be.parentNode}nextSibling(be){return be.nextSibling}setAttribute(be,De,dt,pt){if(pt){De=pt+":"+De;const on=St[pt];on?be.setAttributeNS(on,De,dt):be.setAttribute(De,dt)}else be.setAttribute(De,dt)}removeAttribute(be,De,dt){if(dt){const pt=St[dt];pt?be.removeAttributeNS(pt,De):be.removeAttribute(`${dt}:${De}`)}else be.removeAttribute(De)}addClass(be,De){be.classList.add(De)}removeClass(be,De){be.classList.remove(De)}setStyle(be,De,dt,pt){pt&(y.JOm.DashCase|y.JOm.Important)?be.style.setProperty(De,dt,pt&y.JOm.Important?"important":""):be.style[De]=dt}removeStyle(be,De,dt){dt&y.JOm.DashCase?be.style.removeProperty(De):be.style[De]=""}setProperty(be,De,dt){be[De]=dt}setValue(be,De){be.nodeValue=De}listen(be,De,dt){return"string"==typeof be?this.eventManager.addGlobalEventListener(be,De,de(dt)):this.eventManager.addEventListener(be,De,de(dt))}}function Gt(ye){return"TEMPLATE"===ye.tagName&&void 0!==ye.content}class Ot extends Ee{constructor(be,De,dt,pt){super(be),this.component=dt;const on=ge(pt+"-"+dt.id,dt.styles);De.addStyles(on),this.contentAttr=function Xe(ye){return"_ngcontent-%COMP%".replace(lt,ye)}(pt+"-"+dt.id),this.hostAttr=function We(ye){return"_nghost-%COMP%".replace(lt,ye)}(pt+"-"+dt.id)}applyToHost(be){super.setAttribute(be,this.hostAttr,"")}createElement(be,De){const dt=super.createElement(be,De);return super.setAttribute(dt,this.contentAttr,""),dt}}class yt extends Ee{constructor(be,De,dt,pt){super(be),this.sharedStylesHost=De,this.hostEl=dt,this.shadowRoot=dt.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const on=ge(pt.id,pt.styles);for(let Dn=0;Dn<on.length;Dn++){const Nn=document.createElement("style");Nn.textContent=on[Dn],this.shadowRoot.appendChild(Nn)}}nodeOrShadowRoot(be){return be===this.hostEl?this.shadowRoot:be}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(be,De){return super.appendChild(this.nodeOrShadowRoot(be),De)}insertBefore(be,De,dt){return super.insertBefore(this.nodeOrShadowRoot(be),De,dt)}removeChild(be,De){return super.removeChild(this.nodeOrShadowRoot(be),De)}parentNode(be){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(be)))}}let Mt=(()=>{class ye extends Ke{constructor(De){super(De)}supports(De){return!0}addEventListener(De,dt,pt){return De.addEventListener(dt,pt,!1),()=>this.removeEventListener(De,dt,pt)}removeEventListener(De,dt,pt){return De.removeEventListener(dt,pt)}}return ye.\u0275fac=function(De){return new(De||ye)(y.LFG(d.K0))},ye.\u0275prov=y.Yz7({token:ye,factory:ye.\u0275fac}),ye})();const gt=["alt","control","meta","shift"],it={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},at={alt:ye=>ye.altKey,control:ye=>ye.ctrlKey,meta:ye=>ye.metaKey,shift:ye=>ye.shiftKey};let Ce=(()=>{class ye extends Ke{constructor(De){super(De)}supports(De){return null!=ye.parseEventName(De)}addEventListener(De,dt,pt){const on=ye.parseEventName(dt),Dn=ye.eventCallback(on.fullKey,pt,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,d.q)().onAndCancel(De,on.domEventName,Dn))}static parseEventName(De){const dt=De.toLowerCase().split("."),pt=dt.shift();if(0===dt.length||"keydown"!==pt&&"keyup"!==pt)return null;const on=ye._normalizeKey(dt.pop());let Dn="",Nn=dt.indexOf("code");if(Nn>-1&&(dt.splice(Nn,1),Dn="code."),gt.forEach(Ei=>{const di=dt.indexOf(Ei);di>-1&&(dt.splice(di,1),Dn+=Ei+".")}),Dn+=on,0!=dt.length||0===on.length)return null;const Wn={};return Wn.domEventName=pt,Wn.fullKey=Dn,Wn}static matchEventFullKeyCode(De,dt){let pt=it[De.key]||De.key,on="";return dt.indexOf("code.")>-1&&(pt=De.code,on="code."),!(null==pt||!pt)&&(pt=pt.toLowerCase()," "===pt?pt="space":"."===pt&&(pt="dot"),gt.forEach(Dn=>{Dn!==pt&&(0,at[Dn])(De)&&(on+=Dn+".")}),on+=pt,on===dt)}static eventCallback(De,dt,pt){return on=>{ye.matchEventFullKeyCode(on,De)&&pt.runGuarded(()=>dt(on))}}static _normalizeKey(De){return"esc"===De?"escape":De}}return ye.\u0275fac=function(De){return new(De||ye)(y.LFG(d.K0))},ye.\u0275prov=y.Yz7({token:ye,factory:ye.\u0275fac}),ye})();const Kn=(0,y.eFA)(y._c5,"browser",[{provide:y.Lbi,useValue:d.bD},{provide:y.g9A,useValue:function cn(){l.makeCurrent()},multi:!0},{provide:d.K0,useFactory:function Nt(){return(0,y.RDi)(document),document},deps:[]}]),ri=new y.OlP(""),Bn=[{provide:y.rWj,useClass:class xe{addToWindow(be){y.dqk.getAngularTestability=(dt,pt=!0)=>{const on=be.findTestabilityInTree(dt,pt);if(null==on)throw new Error("Could not find testability for element.");return on},y.dqk.getAllAngularTestabilities=()=>be.getAllTestabilities(),y.dqk.getAllAngularRootElements=()=>be.getAllRootElements(),y.dqk.frameworkStabilizers||(y.dqk.frameworkStabilizers=[]),y.dqk.frameworkStabilizers.push(dt=>{const pt=y.dqk.getAllAngularTestabilities();let on=pt.length,Dn=!1;const Nn=function(Wn){Dn=Dn||Wn,on--,0==on&&dt(Dn)};pt.forEach(function(Wn){Wn.whenStable(Nn)})})}findTestabilityInTree(be,De,dt){return null==De?null:be.getTestability(De)??(dt?(0,d.q)().isShadowRoot(De)?this.findTestabilityInTree(be,De.host,!0):this.findTestabilityInTree(be,De.parentElement,!0):null)}},deps:[]},{provide:y.lri,useClass:y.dDg,deps:[y.R0b,y.eoX,y.rWj]},{provide:y.dDg,useClass:y.dDg,deps:[y.R0b,y.eoX,y.rWj]}],pi=[{provide:y.zSh,useValue:"root"},{provide:y.qLn,useFactory:function ot(){return new y.qLn},deps:[]},{provide:ze,useClass:Mt,multi:!0,deps:[d.K0,y.R0b,y.Lbi]},{provide:ze,useClass:Ce,multi:!0,deps:[d.K0]},{provide:oe,useClass:oe,deps:[le,Q,y.AFp]},{provide:y.FYo,useExisting:oe},{provide:Oe,useExisting:Q},{provide:Q,useClass:Q,deps:[d.K0]},{provide:le,useClass:le,deps:[ze,y.R0b]},{provide:d.JF,useClass:fe,deps:[]},[]];let bi=(()=>{class ye{constructor(De){}static withServerTransition(De){return{ngModule:ye,providers:[{provide:y.AFp,useValue:De.appId},{provide:Me,useExisting:y.AFp},X]}}}return ye.\u0275fac=function(De){return new(De||ye)(y.LFG(ri,12))},ye.\u0275mod=y.oAB({type:ye}),ye.\u0275inj=y.cJS({providers:[...pi,...Bn],imports:[d.ez,y.hGG]}),ye})(),Yi=(()=>{class ye{constructor(De){this._doc=De}getTitle(){return this._doc.title}setTitle(De){this._doc.title=De||""}}return ye.\u0275fac=function(De){return new(De||ye)(y.LFG(d.K0))},ye.\u0275prov=y.Yz7({token:ye,factory:function(De){let dt=null;return dt=De?new De:function Fi(){return new Yi((0,y.LFG)(d.K0))}(),dt},providedIn:"root"}),ye})();typeof window<"u"&&window},4228:(Pn,Et,k)=>{"use strict";k.d(Et,{gz:()=>go,y6:()=>Vo,OD:()=>Mi,eC:()=>Bn,wN:()=>Ns,F0:()=>Qo,rH:()=>ea,Bz:()=>Rl,Hx:()=>Ue});var d=k(8274),y=k(2076),te=k(9646),l=k(1135);const re=(0,k(3888).d)(a=>function(){a(this),this.name="EmptyError",this.message="no elements in sequence"});var b=k(9751),he=k(4742),Me=k(4671),Ve=k(3268),X=k(7669),xe=k(1810),fe=k(5403),ze=k(9672);function le(...a){const f=(0,X.yG)(a),p=(0,X.jO)(a),{args:v,keys:C}=(0,he.D)(a);if(0===v.length)return(0,y.D)([],f);const D=new b.y(function Ke(a,f,p=Me.y){return v=>{Oe(f,()=>{const{length:C}=a,D=new Array(C);let P=C,F=C;for(let W=0;W<C;W++)Oe(f,()=>{const ue=(0,y.D)(a[W],f);let Te=!1;ue.subscribe((0,fe.x)(v,Re=>{D[W]=Re,Te||(Te=!0,F--),F||v.next(p(D.slice()))},()=>{--P||v.complete()}))},v)},v)}}(v,f,C?P=>(0,xe.n)(C,P):Me.y));return p?D.pipe((0,Ve.Z)(p)):D}function Oe(a,f,p){a?(0,ze.f)(p,a,f):f()}var Q=k(7272),Ye=k(9770),St=k(9635),lt=k(576);function _e(a,f){const p=(0,lt.m)(a)?a:()=>a,v=C=>C.error(p());return new b.y(f?C=>f.schedule(v,0,C):v)}var ke=k(515),Ne=k(727),we=k(4482);function Xe(){return(0,we.e)((a,f)=>{let p=null;a._refCount++;const v=(0,fe.x)(f,void 0,void 0,void 0,()=>{if(!a||a._refCount<=0||0<--a._refCount)return void(p=null);const C=a._connection,D=p;p=null,C&&(!D||C===D)&&C.unsubscribe(),f.unsubscribe()});a.subscribe(v),v.closed||(p=a.connect())})}class We extends b.y{constructor(f,p){super(),this.source=f,this.subjectFactory=p,this._subject=null,this._refCount=0,this._connection=null,(0,we.A)(f)&&(this.lift=f.lift)}_subscribe(f){return this.getSubject().subscribe(f)}getSubject(){const f=this._subject;return(!f||f.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:f}=this;this._subject=this._connection=null,f?.unsubscribe()}connect(){let f=this._connection;if(!f){f=this._connection=new Ne.w0;const p=this.getSubject();f.add(this.source.subscribe((0,fe.x)(p,void 0,()=>{this._teardown(),p.complete()},v=>{this._teardown(),p.error(v)},()=>this._teardown()))),f.closed&&(this._connection=null,f=Ne.w0.EMPTY)}return f}refCount(){return Xe()(this)}}var ge=k(7579),de=k(6895),oe=k(4004),Ee=k(3900),vt=k(5698),Gt=k(9300),Ot=k(5577);function yt(a){return(0,we.e)((f,p)=>{let v=!1;f.subscribe((0,fe.x)(p,C=>{v=!0,p.next(C)},()=>{v||p.next(a),p.complete()}))})}function Mt(a=gt){return(0,we.e)((f,p)=>{let v=!1;f.subscribe((0,fe.x)(p,C=>{v=!0,p.next(C)},()=>v?p.complete():p.error(a())))})}function gt(){return new re}function it(a,f){const p=arguments.length>=2;return v=>v.pipe(a?(0,Gt.h)((C,D)=>a(C,D,v)):Me.y,(0,vt.q)(1),p?yt(f):Mt(()=>new re))}var at=k(4351);function Ce(a,f,p){const v=(0,lt.m)(a)||f||p?{next:a,error:f,complete:p}:a;return v?(0,we.e)((C,D)=>{var P;null===(P=v.subscribe)||void 0===P||P.call(v);let F=!0;C.subscribe((0,fe.x)(D,W=>{var ue;null===(ue=v.next)||void 0===ue||ue.call(v,W),D.next(W)},()=>{var W;F=!1,null===(W=v.complete)||void 0===W||W.call(v),D.complete()},W=>{var ue;F=!1,null===(ue=v.error)||void 0===ue||ue.call(v,W),D.error(W)},()=>{var W,ue;F&&(null===(W=v.unsubscribe)||void 0===W||W.call(v)),null===(ue=v.finalize)||void 0===ue||ue.call(v)}))}):Me.y}var bt=k(8421);function kt(a){return(0,we.e)((f,p)=>{let D,v=null,C=!1;v=f.subscribe((0,fe.x)(p,void 0,void 0,P=>{D=(0,bt.Xf)(a(P,kt(a)(f))),v?(v.unsubscribe(),v=null,D.subscribe(p)):C=!0})),C&&(v.unsubscribe(),v=null,D.subscribe(p))})}function Vt(a,f,p,v,C){return(D,P)=>{let F=p,W=f,ue=0;D.subscribe((0,fe.x)(P,Te=>{const Re=ue++;W=F?a(W,Te,Re):(F=!0,Te),v&&P.next(W)},C&&(()=>{F&&P.next(W),P.complete()})))}}function yn(a,f){return(0,we.e)(Vt(a,f,arguments.length>=2,!0))}function Fn(a){return a<=0?()=>ke.E:(0,we.e)((f,p)=>{let v=[];f.subscribe((0,fe.x)(p,C=>{v.push(C),a<v.length&&v.shift()},()=>{for(const C of v)p.next(C);p.complete()},void 0,()=>{v=null}))})}function cn(a,f){const p=arguments.length>=2;return v=>v.pipe(a?(0,Gt.h)((C,D)=>a(C,D,v)):Me.y,Fn(1),p?yt(f):Mt(()=>new re))}function bn(a){return(0,we.e)((f,p)=>{try{f.subscribe(p)}finally{p.add(a)}})}var Kn=k(8189),ri=k(1481);const Bn="primary",pi=Symbol("RouteTitle");class bi{constructor(f){this.params=f||{}}has(f){return Object.prototype.hasOwnProperty.call(this.params,f)}get(f){if(this.has(f)){const p=this.params[f];return Array.isArray(p)?p[0]:p}return null}getAll(f){if(this.has(f)){const p=this.params[f];return Array.isArray(p)?p:[p]}return[]}get keys(){return Object.keys(this.params)}}function vi(a){return new bi(a)}function Li(a,f,p){const v=p.path.split("/");if(v.length>a.length||"full"===p.pathMatch&&(f.hasChildren()||v.length<a.length))return null;const C={};for(let D=0;D<v.length;D++){const P=v[D],F=a[D];if(P.startsWith(":"))C[P.substring(1)]=F;else if(P!==F.path)return null}return{consumed:a.slice(0,v.length),posParams:C}}function Fi(a,f){const p=a?Object.keys(a):void 0,v=f?Object.keys(f):void 0;if(!p||!v||p.length!=v.length)return!1;let C;for(let D=0;D<p.length;D++)if(C=p[D],!Yi(a[C],f[C]))return!1;return!0}function Yi(a,f){if(Array.isArray(a)&&Array.isArray(f)){if(a.length!==f.length)return!1;const p=[...a].sort(),v=[...f].sort();return p.every((C,D)=>v[D]===C)}return a===f}function Zt(a){return Array.prototype.concat.apply([],a)}function It(a){return a.length>0?a[a.length-1]:null}function ne(a,f){for(const p in a)a.hasOwnProperty(p)&&f(a[p],p)}function Je(a){return(0,d.CqO)(a)?a:(0,d.QGY)(a)?(0,y.D)(Promise.resolve(a)):(0,te.of)(a)}const jt=!1,Qt={exact:function fi(a,f,p){if(!Pt(a.segments,f.segments)||!wr(a.segments,f.segments,p)||a.numberOfChildren!==f.numberOfChildren)return!1;for(const v in f.children)if(!a.children[v]||!fi(a.children[v],f.children[v],p))return!1;return!0},subset:Ai},li={exact:function tr(a,f){return Fi(a,f)},subset:function yr(a,f){return Object.keys(f).length<=Object.keys(a).length&&Object.keys(f).every(p=>Yi(a[p],f[p]))},ignored:()=>!0};function Ii(a,f,p){return Qt[p.paths](a.root,f.root,p.matrixParams)&&li[p.queryParams](a.queryParams,f.queryParams)&&!("exact"===p.fragment&&a.fragment!==f.fragment)}function Ai(a,f,p){return fr(a,f,f.segments,p)}function fr(a,f,p,v){if(a.segments.length>p.length){const C=a.segments.slice(0,p.length);return!(!Pt(C,p)||f.hasChildren()||!wr(C,p,v))}if(a.segments.length===p.length){if(!Pt(a.segments,p)||!wr(a.segments,p,v))return!1;for(const C in f.children)if(!a.children[C]||!Ai(a.children[C],f.children[C],v))return!1;return!0}{const C=p.slice(0,a.segments.length),D=p.slice(a.segments.length);return!!(Pt(a.segments,C)&&wr(a.segments,C,v)&&a.children[Bn])&&fr(a.children[Bn],f,D,v)}}function wr(a,f,p){return f.every((v,C)=>li[p](a[C].parameters,v.parameters))}class Cr{constructor(f=new si([],{}),p={},v=null){this.root=f,this.queryParams=p,this.fragment=v}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=vi(this.queryParams)),this._queryParamMap}toString(){return R.serialize(this)}}class si{constructor(f,p){this.segments=f,this.children=p,this.parent=null,ne(p,(v,C)=>v.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return z(this)}}class dn{constructor(f,p){this.path=f,this.parameters=p}get parameterMap(){return this._parameterMap||(this._parameterMap=vi(this.parameters)),this._parameterMap}toString(){return De(this)}}function Pt(a,f){return a.length===f.length&&a.every((p,v)=>p.path===f[v].path)}let Ue=(()=>{class a{}return a.\u0275fac=function(p){return new(p||a)},a.\u0275prov=d.Yz7({token:a,factory:function(){return new se},providedIn:"root"}),a})();class se{parse(f){const p=new Hn(f);return new Cr(p.parseRootSegment(),p.parseQueryParams(),p.parseFragment())}serialize(f){const p=`/${ce(f.root,!0)}`,v=function pt(a){const f=Object.keys(a).map(p=>{const v=a[p];return Array.isArray(v)?v.map(C=>`${tt(p)}=${tt(C)}`).join("&"):`${tt(p)}=${tt(v)}`}).filter(p=>!!p);return f.length?`?${f.join("&")}`:""}(f.queryParams);return`${p}${v}${"string"==typeof f.fragment?`#${function Rt(a){return encodeURI(a)}(f.fragment)}`:""}`}}const R=new se;function z(a){return a.segments.map(f=>De(f)).join("/")}function ce(a,f){if(!a.hasChildren())return z(a);if(f){const p=a.children[Bn]?ce(a.children[Bn],!1):"",v=[];return ne(a.children,(C,D)=>{D!==Bn&&v.push(`${D}:${ce(C,!1)}`)}),v.length>0?`${p}(${v.join("//")})`:p}{const p=function gn(a,f){let p=[];return ne(a.children,(v,C)=>{C===Bn&&(p=p.concat(f(v,C)))}),ne(a.children,(v,C)=>{C!==Bn&&(p=p.concat(f(v,C)))}),p}(a,(v,C)=>C===Bn?[ce(a.children[Bn],!1)]:[`${C}:${ce(v,!1)}`]);return 1===Object.keys(a.children).length&&null!=a.children[Bn]?`${z(a)}/${p[0]}`:`${z(a)}/(${p.join("//")})`}}function Be(a){return encodeURIComponent(a).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function tt(a){return Be(a).replace(/%3B/gi,";")}function At(a){return Be(a).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function ye(a){return decodeURIComponent(a)}function be(a){return ye(a.replace(/\+/g,"%20"))}function De(a){return`${At(a.path)}${function dt(a){return Object.keys(a).map(f=>`;${At(f)}=${At(a[f])}`).join("")}(a.parameters)}`}const on=/^[^\/()?;=#]+/;function Dn(a){const f=a.match(on);return f?f[0]:""}const Nn=/^[^=?&#]+/,Ei=/^[^&#]+/;class Hn{constructor(f){this.url=f,this.remaining=f}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new si([],{}):new si([],this.parseChildren())}parseQueryParams(){const f={};if(this.consumeOptional("?"))do{this.parseQueryParam(f)}while(this.consumeOptional("&"));return f}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const f=[];for(this.peekStartsWith("(")||f.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),f.push(this.parseSegment());let p={};this.peekStartsWith("/(")&&(this.capture("/"),p=this.parseParens(!0));let v={};return this.peekStartsWith("(")&&(v=this.parseParens(!1)),(f.length>0||Object.keys(p).length>0)&&(v[Bn]=new si(f,p)),v}parseSegment(){const f=Dn(this.remaining);if(""===f&&this.peekStartsWith(";"))throw new d.vHH(4009,jt);return this.capture(f),new dn(ye(f),this.parseMatrixParams())}parseMatrixParams(){const f={};for(;this.consumeOptional(";");)this.parseParam(f);return f}parseParam(f){const p=Dn(this.remaining);if(!p)return;this.capture(p);let v="";if(this.consumeOptional("=")){const C=Dn(this.remaining);C&&(v=C,this.capture(v))}f[ye(p)]=ye(v)}parseQueryParam(f){const p=function Wn(a){const f=a.match(Nn);return f?f[0]:""}(this.remaining);if(!p)return;this.capture(p);let v="";if(this.consumeOptional("=")){const P=function di(a){const f=a.match(Ei);return f?f[0]:""}(this.remaining);P&&(v=P,this.capture(v))}const C=be(p),D=be(v);if(f.hasOwnProperty(C)){let P=f[C];Array.isArray(P)||(P=[P],f[C]=P),P.push(D)}else f[C]=D}parseParens(f){const p={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const v=Dn(this.remaining),C=this.remaining[v.length];if("/"!==C&&")"!==C&&";"!==C)throw new d.vHH(4010,jt);let D;v.indexOf(":")>-1?(D=v.slice(0,v.indexOf(":")),this.capture(D),this.capture(":")):f&&(D=Bn);const P=this.parseChildren();p[D]=1===Object.keys(P).length?P[Bn]:new si([],P),this.consumeOptional("//")}return p}peekStartsWith(f){return this.remaining.startsWith(f)}consumeOptional(f){return!!this.peekStartsWith(f)&&(this.remaining=this.remaining.substring(f.length),!0)}capture(f){if(!this.consumeOptional(f))throw new d.vHH(4011,jt)}}function Vi(a){return a.segments.length>0?new si([],{[Bn]:a}):a}function ki(a){const f={};for(const v of Object.keys(a.children)){const D=ki(a.children[v]);(D.segments.length>0||D.hasChildren())&&(f[v]=D)}return function Gr(a){if(1===a.numberOfChildren&&a.children[Bn]){const f=a.children[Bn];return new si(a.segments.concat(f.segments),f.children)}return a}(new si(a.segments,f))}function Tr(a){return a instanceof Cr}function eo(a,f,p,v,C){if(0===p.length)return Qi(f.root,f.root,f.root,v,C);const D=function Rn(a){if("string"==typeof a[0]&&1===a.length&&"/"===a[0])return new mr(!0,0,a);let f=0,p=!1;const v=a.reduce((C,D,P)=>{if("object"==typeof D&&null!=D){if(D.outlets){const F={};return ne(D.outlets,(W,ue)=>{F[ue]="string"==typeof W?W.split("/"):W}),[...C,{outlets:F}]}if(D.segmentPath)return[...C,D.segmentPath]}return"string"!=typeof D?[...C,D]:0===P?(D.split("/").forEach((F,W)=>{0==W&&"."===F||(0==W&&""===F?p=!0:".."===F?f++:""!=F&&C.push(F))}),C):[...C,D]},[]);return new mr(p,f,v)}(p);return D.toRoot()?Qi(f.root,f.root,new si([],{}),v,C):function P(W){const ue=function me(a,f,p,v){if(a.isAbsolute)return new oi(f.root,!0,0);if(-1===v)return new oi(p,p===f.root,0);return function Ge(a,f,p){let v=a,C=f,D=p;for(;D>C;){if(D-=C,v=v.parent,!v)throw new d.vHH(4005,!1);C=v.segments.length}return new oi(v,!1,C-D)}(p,v+(wo(a.commands[0])?0:1),a.numberOfDoubleDots)}(D,f,a.snapshot?._urlSegment,W),Te=ue.processChildren?Yt(ue.segmentGroup,ue.index,D.commands):zt(ue.segmentGroup,ue.index,D.commands);return Qi(f.root,ue.segmentGroup,Te,v,C)}(a.snapshot?._lastPathIndex)}function wo(a){return"object"==typeof a&&null!=a&&!a.outlets&&!a.segmentPath}function mi(a){return"object"==typeof a&&null!=a&&a.outlets}function Qi(a,f,p,v,C){let P,D={};v&&ne(v,(W,ue)=>{D[ue]=Array.isArray(W)?W.map(Te=>`${Te}`):`${W}`}),P=a===f?p:Er(a,f,p);const F=Vi(ki(P));return new Cr(F,D,C)}function Er(a,f,p){const v={};return ne(a.children,(C,D)=>{v[D]=C===f?p:Er(C,f,p)}),new si(a.segments,v)}class mr{constructor(f,p,v){if(this.isAbsolute=f,this.numberOfDoubleDots=p,this.commands=v,f&&v.length>0&&wo(v[0]))throw new d.vHH(4003,!1);const C=v.find(mi);if(C&&C!==It(v))throw new d.vHH(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class oi{constructor(f,p,v){this.segmentGroup=f,this.processChildren=p,this.index=v}}function zt(a,f,p){if(a||(a=new si([],{})),0===a.segments.length&&a.hasChildren())return Yt(a,f,p);const v=function $e(a,f,p){let v=0,C=f;const D={match:!1,pathIndex:0,commandIndex:0};for(;C<a.segments.length;){if(v>=p.length)return D;const P=a.segments[C],F=p[v];if(mi(F))break;const W=`${F}`,ue=v<p.length-1?p[v+1]:null;if(C>0&&void 0===W)break;if(W&&ue&&"object"==typeof ue&&void 0===ue.outlets){if(!Jt(W,ue,P))return D;v+=2}else{if(!Jt(W,{},P))return D;v++}C++}return{match:!0,pathIndex:C,commandIndex:v}}(a,f,p),C=p.slice(v.commandIndex);if(v.match&&v.pathIndex<a.segments.length){const D=new si(a.segments.slice(0,v.pathIndex),{});return D.children[Bn]=new si(a.segments.slice(v.pathIndex),a.children),Yt(D,0,C)}return v.match&&0===C.length?new si(a.segments,{}):v.match&&!a.hasChildren()?ft(a,f,p):v.match?Yt(a,0,C):ft(a,f,p)}function Yt(a,f,p){if(0===p.length)return new si(a.segments,{});{const v=function ct(a){return mi(a[0])?a[0].outlets:{[Bn]:a}}(p),C={};return!v[Bn]&&a.children[Bn]&&1===a.numberOfChildren&&0===a.children[Bn].segments.length?Yt(a.children[Bn],f,p):(ne(v,(D,P)=>{"string"==typeof D&&(D=[D]),null!==D&&(C[P]=zt(a.children[P],f,D))}),ne(a.children,(D,P)=>{void 0===v[P]&&(C[P]=D)}),new si(a.segments,C))}}function ft(a,f,p){const v=a.segments.slice(0,f);let C=0;for(;C<p.length;){const D=p[C];if(mi(D)){const W=Ft(D.outlets);return new si(v,W)}if(0===C&&wo(p[0])){v.push(new dn(a.segments[f].path,hn(p[0]))),C++;continue}const P=mi(D)?D.outlets[Bn]:`${D}`,F=C<p.length-1?p[C+1]:null;P&&F&&wo(F)?(v.push(new dn(P,hn(F))),C+=2):(v.push(new dn(P,{})),C++)}return new si(v,{})}function Ft(a){const f={};return ne(a,(p,v)=>{"string"==typeof p&&(p=[p]),null!==p&&(f[v]=ft(new si([],{}),0,p))}),f}function hn(a){const f={};return ne(a,(p,v)=>f[v]=`${p}`),f}function Jt(a,f,p){return a==p.path&&Fi(f,p.parameters)}const Vn="imperative";class Yn{constructor(f,p){this.id=f,this.url=p}}class Mi extends Yn{constructor(f,p,v="imperative",C=null){super(f,p),this.type=0,this.navigationTrigger=v,this.restoredState=C}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Bi extends Yn{constructor(f,p,v){super(f,p),this.urlAfterRedirects=v,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Ni extends Yn{constructor(f,p,v,C){super(f,p),this.reason=v,this.code=C,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Nr extends Yn{constructor(f,p,v,C){super(f,p),this.reason=v,this.code=C,this.type=16}}class ir extends Yn{constructor(f,p,v,C){super(f,p),this.error=v,this.target=C,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Hr extends Yn{constructor(f,p,v,C){super(f,p),this.urlAfterRedirects=v,this.state=C,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class zr extends Yn{constructor(f,p,v,C){super(f,p),this.urlAfterRedirects=v,this.state=C,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class lr extends Yn{constructor(f,p,v,C,D){super(f,p),this.urlAfterRedirects=v,this.state=C,this.shouldActivate=D,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class or extends Yn{constructor(f,p,v,C){super(f,p),this.urlAfterRedirects=v,this.state=C,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Wa extends Yn{constructor(f,p,v,C){super(f,p),this.urlAfterRedirects=v,this.state=C,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Wr{constructor(f){this.route=f,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class fo{constructor(f){this.route=f,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class _s{constructor(f){this.snapshot=f,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Wo{constructor(f){this.snapshot=f,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xr{constructor(f){this.snapshot=f,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ur{constructor(f){this.snapshot=f,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ua{constructor(f,p,v){this.routerEvent=f,this.position=p,this.anchor=v,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let zo=(()=>{class a{createUrlTree(p,v,C,D,P,F){return eo(p||v.root,C,D,P,F)}}return a.\u0275fac=function(p){return new(p||a)},a.\u0275prov=d.Yz7({token:a,factory:a.\u0275fac}),a})(),co=(()=>{class a{}return a.\u0275fac=function(p){return new(p||a)},a.\u0275prov=d.Yz7({token:a,factory:function(f){return zo.\u0275fac(f)},providedIn:"root"}),a})();class to{constructor(f){this._root=f}get root(){return this._root.value}parent(f){const p=this.pathFromRoot(f);return p.length>1?p[p.length-2]:null}children(f){const p=Fs(f,this._root);return p?p.children.map(v=>v.value):[]}firstChild(f){const p=Fs(f,this._root);return p&&p.children.length>0?p.children[0].value:null}siblings(f){const p=da(f,this._root);return p.length<2?[]:p[p.length-2].children.map(C=>C.value).filter(C=>C!==f)}pathFromRoot(f){return da(f,this._root).map(p=>p.value)}}function Fs(a,f){if(a===f.value)return f;for(const p of f.children){const v=Fs(a,p);if(v)return v}return null}function da(a,f){if(a===f.value)return[f];for(const p of f.children){const v=da(a,p);if(v.length)return v.unshift(f),v}return[]}class Co{constructor(f,p){this.value=f,this.children=p}toString(){return`TreeNode(${this.value})`}}function mo(a){const f={};return a&&a.children.forEach(p=>f[p.value.outlet]=p),f}class Hs extends to{constructor(f,p){super(f),this.snapshot=p,ha(this,f)}toString(){return this.snapshot.toString()}}function vs(a,f){const p=function as(a,f){const P=new ks([],{},{},"",{},Bn,f,null,a.root,-1,{});return new bs("",new Co(P,[]))}(a,f),v=new l.X([new dn("",{})]),C=new l.X({}),D=new l.X({}),P=new l.X({}),F=new l.X(""),W=new go(v,C,P,F,D,Bn,f,p.root);return W.snapshot=p.root,new Hs(new Co(W,[]),p)}class go{constructor(f,p,v,C,D,P,F,W){this.url=f,this.params=p,this.queryParams=v,this.fragment=C,this.data=D,this.outlet=P,this.component=F,this.title=this.data?.pipe((0,oe.U)(ue=>ue[pi]))??(0,te.of)(void 0),this._futureSnapshot=W}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,oe.U)(f=>vi(f)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,oe.U)(f=>vi(f)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function xs(a,f="emptyOnly"){const p=a.pathFromRoot;let v=0;if("always"!==f)for(v=p.length-1;v>=1;){const C=p[v],D=p[v-1];if(C.routeConfig&&""===C.routeConfig.path)v--;else{if(D.component)break;v--}}return function so(a){return a.reduce((f,p)=>({params:{...f.params,...p.params},data:{...f.data,...p.data},resolve:{...p.data,...f.resolve,...p.routeConfig?.data,...p._resolvedData}}),{params:{},data:{},resolve:{}})}(p.slice(v))}class ks{get title(){return this.data?.[pi]}constructor(f,p,v,C,D,P,F,W,ue,Te,Re){this.url=f,this.params=p,this.queryParams=v,this.fragment=C,this.data=D,this.outlet=P,this.component=F,this.routeConfig=W,this._urlSegment=ue,this._lastPathIndex=Te,this._resolve=Re}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=vi(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=vi(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(v=>v.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class bs extends to{constructor(f,p){super(p),this.url=f,ha(this,p)}toString(){return pa(this._root)}}function ha(a,f){f.value._routerState=a,f.children.forEach(p=>ha(a,p))}function pa(a){const f=a.children.length>0?` { ${a.children.map(pa).join(", ")} } `:"";return`${a.value}${f}`}function Ws(a){if(a.snapshot){const f=a.snapshot,p=a._futureSnapshot;a.snapshot=p,Fi(f.queryParams,p.queryParams)||a.queryParams.next(p.queryParams),f.fragment!==p.fragment&&a.fragment.next(p.fragment),Fi(f.params,p.params)||a.params.next(p.params),function Si(a,f){if(a.length!==f.length)return!1;for(let p=0;p<a.length;++p)if(!Fi(a[p],f[p]))return!1;return!0}(f.url,p.url)||a.url.next(p.url),Fi(f.data,p.data)||a.data.next(p.data)}else a.snapshot=a._futureSnapshot,a.data.next(a._futureSnapshot.data)}function ls(a,f){const p=Fi(a.params,f.params)&&function wt(a,f){return Pt(a,f)&&a.every((p,v)=>Fi(p.parameters,f[v].parameters))}(a.url,f.url);return p&&!(!a.parent!=!f.parent)&&(!a.parent||ls(a.parent,f.parent))}function Mo(a,f,p){if(p&&a.shouldReuseRoute(f.value,p.value.snapshot)){const v=p.value;v._futureSnapshot=f.value;const C=function cl(a,f,p){return f.children.map(v=>{for(const C of p.children)if(a.shouldReuseRoute(v.value,C.value.snapshot))return Mo(a,v,C);return Mo(a,v)})}(a,f,p);return new Co(v,C)}{if(a.shouldAttach(f.value)){const D=a.retrieve(f.value);if(null!==D){const P=D.route;return P.value._futureSnapshot=f.value,P.children=f.children.map(F=>Mo(a,F)),P}}const v=function Ma(a){return new go(new l.X(a.url),new l.X(a.params),new l.X(a.queryParams),new l.X(a.fragment),new l.X(a.data),a.outlet,a.component,a)}(f.value),C=f.children.map(D=>Mo(a,D));return new Co(v,C)}}const cs="ngNavigationCancelingError";function Ro(a,f){const{redirectTo:p,navigationBehaviorOptions:v}=Tr(f)?{redirectTo:f,navigationBehaviorOptions:void 0}:f,C=Uo(!1,0,f);return C.url=p,C.navigationBehaviorOptions=v,C}function Uo(a,f,p){const v=new Error("NavigationCancelingError: "+(a||""));return v[cs]=!0,v.cancellationCode=f,p&&(v.url=p),v}function ji(a){return qs(a)&&Tr(a.url)}function qs(a){return a&&a[cs]}class Ys{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Vo,this.attachRef=null}}let Vo=(()=>{class a{constructor(){this.contexts=new Map}onChildOutletCreated(p,v){const C=this.getOrCreateContext(p);C.outlet=v,this.contexts.set(p,C)}onChildOutletDestroyed(p){const v=this.getContext(p);v&&(v.outlet=null,v.attachRef=null)}onOutletDeactivated(){const p=this.contexts;return this.contexts=new Map,p}onOutletReAttached(p){this.contexts=p}getOrCreateContext(p){let v=this.getContext(p);return v||(v=new Ys,this.contexts.set(p,v)),v}getContext(p){return this.contexts.get(p)||null}}return a.\u0275fac=function(p){return new(p||a)},a.\u0275prov=d.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const Lo=!1;let ws=(()=>{class a{constructor(){this.activated=null,this._activatedRoute=null,this.name=Bn,this.activateEvents=new d.vpe,this.deactivateEvents=new d.vpe,this.attachEvents=new d.vpe,this.detachEvents=new d.vpe,this.parentContexts=(0,d.f3M)(Vo),this.location=(0,d.f3M)(d.s_b),this.changeDetector=(0,d.f3M)(d.sBO),this.environmentInjector=(0,d.f3M)(d.lqb)}ngOnChanges(p){if(p.name){const{firstChange:v,previousValue:C}=p.name;if(v)return;this.isTrackedInParentContexts(C)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(C)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(p){return this.parentContexts.getContext(p)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const p=this.parentContexts.getContext(this.name);p?.route&&(p.attachRef?this.attach(p.attachRef,p.route):this.activateWith(p.route,p.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new d.vHH(4012,Lo);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new d.vHH(4012,Lo);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new d.vHH(4012,Lo);this.location.detach();const p=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(p.instance),p}attach(p,v){this.activated=p,this._activatedRoute=v,this.location.insert(p.hostView),this.attachEvents.emit(p.instance)}deactivate(){if(this.activated){const p=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(p)}}activateWith(p,v){if(this.isActivated)throw new d.vHH(4013,Lo);this._activatedRoute=p;const C=this.location,P=p.snapshot.component,F=this.parentContexts.getOrCreateContext(this.name).children,W=new Cs(p,F,C.injector);if(v&&function us(a){return!!a.resolveComponentFactory}(v)){const ue=v.resolveComponentFactory(P);this.activated=C.createComponent(ue,C.length,W)}else this.activated=C.createComponent(P,{index:C.length,injector:W,environmentInjector:v??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return a.\u0275fac=function(p){return new(p||a)},a.\u0275dir=d.lG2({type:a,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[d.TTD]}),a})();class Cs{constructor(f,p,v){this.route=f,this.childContexts=p,this.parent=v}get(f,p){return f===go?this.route:f===Vo?this.childContexts:this.parent.get(f,p)}}let qo=(()=>{class a{}return a.\u0275fac=function(p){return new(p||a)},a.\u0275cmp=d.Xpm({type:a,selectors:[["ng-component"]],standalone:!0,features:[d.jDz],decls:1,vars:0,template:function(p,v){1&p&&d._UZ(0,"router-outlet")},dependencies:[ws],encapsulation:2}),a})();function uo(a,f){return a.providers&&!a._injector&&(a._injector=(0,d.MMx)(a.providers,f,`Route: ${a.path}`)),a._injector??f}function ds(a){const f=a.children&&a.children.map(ds),p=f?{...a,children:f}:{...a};return!p.component&&!p.loadComponent&&(f||p.loadChildren)&&p.outlet&&p.outlet!==Bn&&(p.component=qo),p}function Dr(a){return a.outlet||Bn}function Js(a,f){const p=a.filter(v=>Dr(v)===f);return p.push(...a.filter(v=>Dr(v)!==f)),p}function Jo(a){if(!a)return null;if(a.routeConfig?._injector)return a.routeConfig._injector;for(let f=a.parent;f;f=f.parent){const p=f.routeConfig;if(p?._loadedInjector)return p._loadedInjector;if(p?._injector)return p._injector}return null}class K{constructor(f,p,v,C){this.routeReuseStrategy=f,this.futureState=p,this.currState=v,this.forwardEvent=C}activate(f){const p=this.futureState._root,v=this.currState?this.currState._root:null;this.deactivateChildRoutes(p,v,f),Ws(this.futureState.root),this.activateChildRoutes(p,v,f)}deactivateChildRoutes(f,p,v){const C=mo(p);f.children.forEach(D=>{const P=D.value.outlet;this.deactivateRoutes(D,C[P],v),delete C[P]}),ne(C,(D,P)=>{this.deactivateRouteAndItsChildren(D,v)})}deactivateRoutes(f,p,v){const C=f.value,D=p?p.value:null;if(C===D)if(C.component){const P=v.getContext(C.outlet);P&&this.deactivateChildRoutes(f,p,P.children)}else this.deactivateChildRoutes(f,p,v);else D&&this.deactivateRouteAndItsChildren(p,v)}deactivateRouteAndItsChildren(f,p){f.value.component&&this.routeReuseStrategy.shouldDetach(f.value.snapshot)?this.detachAndStoreRouteSubtree(f,p):this.deactivateRouteAndOutlet(f,p)}detachAndStoreRouteSubtree(f,p){const v=p.getContext(f.value.outlet),C=v&&f.value.component?v.children:p,D=mo(f);for(const P of Object.keys(D))this.deactivateRouteAndItsChildren(D[P],C);if(v&&v.outlet){const P=v.outlet.detach(),F=v.children.onOutletDeactivated();this.routeReuseStrategy.store(f.value.snapshot,{componentRef:P,route:f,contexts:F})}}deactivateRouteAndOutlet(f,p){const v=p.getContext(f.value.outlet),C=v&&f.value.component?v.children:p,D=mo(f);for(const P of Object.keys(D))this.deactivateRouteAndItsChildren(D[P],C);v&&v.outlet&&(v.outlet.deactivate(),v.children.onOutletDeactivated(),v.attachRef=null,v.resolver=null,v.route=null)}activateChildRoutes(f,p,v){const C=mo(p);f.children.forEach(D=>{this.activateRoutes(D,C[D.value.outlet],v),this.forwardEvent(new Ur(D.value.snapshot))}),f.children.length&&this.forwardEvent(new Wo(f.value.snapshot))}activateRoutes(f,p,v){const C=f.value,D=p?p.value:null;if(Ws(C),C===D)if(C.component){const P=v.getOrCreateContext(C.outlet);this.activateChildRoutes(f,p,P.children)}else this.activateChildRoutes(f,p,v);else if(C.component){const P=v.getOrCreateContext(C.outlet);if(this.routeReuseStrategy.shouldAttach(C.snapshot)){const F=this.routeReuseStrategy.retrieve(C.snapshot);this.routeReuseStrategy.store(C.snapshot,null),P.children.onOutletReAttached(F.contexts),P.attachRef=F.componentRef,P.route=F.route.value,P.outlet&&P.outlet.attach(F.componentRef,F.route.value),Ws(F.route.value),this.activateChildRoutes(f,null,P.children)}else{const F=Jo(C.snapshot),W=F?.get(d._Vd)??null;P.attachRef=null,P.route=C,P.resolver=W,P.injector=F,P.outlet&&P.outlet.activateWith(C,P.injector),this.activateChildRoutes(f,null,P.children)}}else this.activateChildRoutes(f,null,v)}}class Y{constructor(f){this.path=f,this.route=this.path[this.path.length-1]}}class G{constructor(f,p){this.component=f,this.route=p}}function Ie(a,f,p){const v=a._root;return dr(v,f?f._root:null,p,[v.value])}function ci(a,f){const p=Symbol(),v=f.get(a,p);return v===p?"function"!=typeof a||(0,d.Z0I)(a)?f.get(a):a:v}function dr(a,f,p,v,C={canDeactivateChecks:[],canActivateChecks:[]}){const D=mo(f);return a.children.forEach(P=>{(function hr(a,f,p,v,C={canDeactivateChecks:[],canActivateChecks:[]}){const D=a.value,P=f?f.value:null,F=p?p.getContext(a.value.outlet):null;if(P&&D.routeConfig===P.routeConfig){const W=function Ts(a,f,p){if("function"==typeof p)return p(a,f);switch(p){case"pathParamsChange":return!Pt(a.url,f.url);case"pathParamsOrQueryParamsChange":return!Pt(a.url,f.url)||!Fi(a.queryParams,f.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!ls(a,f)||!Fi(a.queryParams,f.queryParams);default:return!ls(a,f)}}(P,D,D.routeConfig.runGuardsAndResolvers);W?C.canActivateChecks.push(new Y(v)):(D.data=P.data,D._resolvedData=P._resolvedData),dr(a,f,D.component?F?F.children:null:p,v,C),W&&F&&F.outlet&&F.outlet.isActivated&&C.canDeactivateChecks.push(new G(F.outlet.component,P))}else P&&So(f,F,C),C.canActivateChecks.push(new Y(v)),dr(a,null,D.component?F?F.children:null:p,v,C)})(P,D[P.value.outlet],p,v.concat([P.value]),C),delete D[P.value.outlet]}),ne(D,(P,F)=>So(P,p.getContext(F),C)),C}function So(a,f,p){const v=mo(a),C=a.value;ne(v,(D,P)=>{So(D,C.component?f?f.children.getContext(P):null:f,p)}),p.canDeactivateChecks.push(new G(C.component&&f&&f.outlet&&f.outlet.isActivated?f.outlet.component:null,C))}function Ya(a){return"function"==typeof a}function $o(a){return a instanceof re||"EmptyError"===a?.name}const Es=Symbol("INITIAL_VALUE");function Xo(){return(0,Ee.w)(a=>le(a.map(f=>f.pipe((0,vt.q)(1),function Tt(...a){const f=(0,X.yG)(a);return(0,we.e)((p,v)=>{(f?(0,Q.z)(a,p,f):(0,Q.z)(a,p)).subscribe(v)})}(Es)))).pipe((0,oe.U)(f=>{for(const p of f)if(!0!==p){if(p===Es)return Es;if(!1===p||p instanceof Cr)return p}return!0}),(0,Gt.h)(f=>f!==Es),(0,vt.q)(1)))}function wn(a){return(0,St.z)(Ce(f=>{if(Tr(f))throw Ro(0,f)}),(0,oe.U)(f=>!0===f))}const xi={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function ti(a,f,p,v,C){const D=Gi(a,f,p);return D.matched?function zn(a,f,p,v){const C=f.canMatch;if(!C||0===C.length)return(0,te.of)(!0);const D=C.map(P=>{const F=ci(P,a);return Je(function ao(a){return a&&Ya(a.canMatch)}(F)?F.canMatch(f,p):a.runInContext(()=>F(f,p)))});return(0,te.of)(D).pipe(Xo(),wn())}(v=uo(f,v),f,p).pipe((0,oe.U)(P=>!0===P?D:{...xi})):(0,te.of)(D)}function Gi(a,f,p){if(""===f.path)return"full"===f.pathMatch&&(a.hasChildren()||p.length>0)?{...xi}:{matched:!0,consumedSegments:[],remainingSegments:p,parameters:{},positionalParamSegments:{}};const C=(f.matcher||Li)(p,a,f);if(!C)return{...xi};const D={};ne(C.posParams,(F,W)=>{D[W]=F.path});const P=C.consumed.length>0?{...D,...C.consumed[C.consumed.length-1].parameters}:D;return{matched:!0,consumedSegments:C.consumed,remainingSegments:p.slice(C.consumed.length),parameters:P,positionalParamSegments:C.posParams??{}}}function nr(a,f,p,v){if(p.length>0&&function vo(a,f,p){return p.some(v=>Ko(a,f,v)&&Dr(v)!==Bn)}(a,p,v)){const D=new si(f,function yo(a,f,p,v){const C={};C[Bn]=v,v._sourceSegment=a,v._segmentIndexShift=f.length;for(const D of p)if(""===D.path&&Dr(D)!==Bn){const P=new si([],{});P._sourceSegment=a,P._segmentIndexShift=f.length,C[Dr(D)]=P}return C}(a,f,v,new si(p,a.children)));return D._sourceSegment=a,D._segmentIndexShift=f.length,{segmentGroup:D,slicedSegments:[]}}if(0===p.length&&function Ds(a,f,p){return p.some(v=>Ko(a,f,v))}(a,p,v)){const D=new si(a.segments,function cr(a,f,p,v,C){const D={};for(const P of v)if(Ko(a,p,P)&&!C[Dr(P)]){const F=new si([],{});F._sourceSegment=a,F._segmentIndexShift=f.length,D[Dr(P)]=F}return{...C,...D}}(a,f,p,v,a.children));return D._sourceSegment=a,D._segmentIndexShift=f.length,{segmentGroup:D,slicedSegments:p}}const C=new si(a.segments,a.children);return C._sourceSegment=a,C._segmentIndexShift=f.length,{segmentGroup:C,slicedSegments:p}}function Ko(a,f,p){return(!(a.hasChildren()||f.length>0)||"full"!==p.pathMatch)&&""===p.path}function ql(a,f,p,v){return!!(Dr(a)===v||v!==Bn&&Ko(f,p,a))&&("**"===a.path||Gi(f,a,p).matched)}function hl(a,f,p){return 0===f.length&&!a.children[p]}const ga=!1;class Zo{constructor(f){this.segmentGroup=f||null}}class pl{constructor(f){this.urlTree=f}}function fl(a){return _e(new Zo(a))}function Rr(a){return _e(new pl(a))}class ur{constructor(f,p,v,C,D){this.injector=f,this.configLoader=p,this.urlSerializer=v,this.urlTree=C,this.config=D,this.allowRedirects=!0}apply(){const f=nr(this.urlTree.root,[],[],this.config).segmentGroup,p=new si(f.segments,f.children);return this.expandSegmentGroup(this.injector,this.config,p,Bn).pipe((0,oe.U)(D=>this.createUrlTree(ki(D),this.urlTree.queryParams,this.urlTree.fragment))).pipe(kt(D=>{if(D instanceof pl)return this.allowRedirects=!1,this.match(D.urlTree);throw D instanceof Zo?this.noMatchError(D):D}))}match(f){return this.expandSegmentGroup(this.injector,this.config,f.root,Bn).pipe((0,oe.U)(C=>this.createUrlTree(ki(C),f.queryParams,f.fragment))).pipe(kt(C=>{throw C instanceof Zo?this.noMatchError(C):C}))}noMatchError(f){return new d.vHH(4002,ga)}createUrlTree(f,p,v){const C=Vi(f);return new Cr(C,p,v)}expandSegmentGroup(f,p,v,C){return 0===v.segments.length&&v.hasChildren()?this.expandChildren(f,p,v).pipe((0,oe.U)(D=>new si([],D))):this.expandSegment(f,v,p,v.segments,C,!0)}expandChildren(f,p,v){const C=[];for(const D of Object.keys(v.children))"primary"===D?C.unshift(D):C.push(D);return(0,y.D)(C).pipe((0,at.b)(D=>{const P=v.children[D],F=Js(p,D);return this.expandSegmentGroup(f,F,P,D).pipe((0,oe.U)(W=>({segment:W,outlet:D})))}),yn((D,P)=>(D[P.outlet]=P.segment,D),{}),cn())}expandSegment(f,p,v,C,D,P){return(0,y.D)(v).pipe((0,at.b)(F=>this.expandSegmentAgainstRoute(f,p,v,F,C,D,P).pipe(kt(ue=>{if(ue instanceof Zo)return(0,te.of)(null);throw ue}))),it(F=>!!F),kt((F,W)=>{if($o(F))return hl(p,C,D)?(0,te.of)(new si([],{})):fl(p);throw F}))}expandSegmentAgainstRoute(f,p,v,C,D,P,F){return ql(C,p,D,P)?void 0===C.redirectTo?this.matchSegmentAgainstRoute(f,p,C,D,P):F&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(f,p,v,C,D,P):fl(p):fl(p)}expandSegmentAgainstRouteUsingRedirect(f,p,v,C,D,P){return"**"===C.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(f,v,C,P):this.expandRegularSegmentAgainstRouteUsingRedirect(f,p,v,C,D,P)}expandWildCardWithParamsAgainstRouteUsingRedirect(f,p,v,C){const D=this.applyRedirectCommands([],v.redirectTo,{});return v.redirectTo.startsWith("/")?Rr(D):this.lineralizeSegments(v,D).pipe((0,Ot.z)(P=>{const F=new si(P,{});return this.expandSegment(f,F,p,P,C,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(f,p,v,C,D,P){const{matched:F,consumedSegments:W,remainingSegments:ue,positionalParamSegments:Te}=Gi(p,C,D);if(!F)return fl(p);const Re=this.applyRedirectCommands(W,C.redirectTo,Te);return C.redirectTo.startsWith("/")?Rr(Re):this.lineralizeSegments(C,Re).pipe((0,Ot.z)(je=>this.expandSegment(f,p,v,je.concat(ue),P,!1)))}matchSegmentAgainstRoute(f,p,v,C,D){return"**"===v.path?(f=uo(v,f),v.loadChildren?(v._loadedRoutes?(0,te.of)({routes:v._loadedRoutes,injector:v._loadedInjector}):this.configLoader.loadChildren(f,v)).pipe((0,oe.U)(F=>(v._loadedRoutes=F.routes,v._loadedInjector=F.injector,new si(C,{})))):(0,te.of)(new si(C,{}))):ti(p,v,C,f).pipe((0,Ee.w)(({matched:P,consumedSegments:F,remainingSegments:W})=>P?this.getChildConfig(f=v._injector??f,v,C).pipe((0,Ot.z)(Te=>{const Re=Te.injector??f,je=Te.routes,{segmentGroup:Le,slicedSegments:Fe}=nr(p,F,W,je),qe=new si(Le.segments,Le.children);if(0===Fe.length&&qe.hasChildren())return this.expandChildren(Re,je,qe).pipe((0,oe.U)(xt=>new si(F,xt)));if(0===je.length&&0===Fe.length)return(0,te.of)(new si(F,{}));const Ze=Dr(v)===D;return this.expandSegment(Re,qe,je,Fe,Ze?Bn:D,!0).pipe((0,oe.U)(_t=>new si(F.concat(_t.segments),_t.children)))})):fl(p)))}getChildConfig(f,p,v){return p.children?(0,te.of)({routes:p.children,injector:f}):p.loadChildren?void 0!==p._loadedRoutes?(0,te.of)({routes:p._loadedRoutes,injector:p._loadedInjector}):function Dt(a,f,p,v){const C=f.canLoad;if(void 0===C||0===C.length)return(0,te.of)(!0);const D=C.map(P=>{const F=ci(P,a);return Je(function Sn(a){return a&&Ya(a.canLoad)}(F)?F.canLoad(f,p):a.runInContext(()=>F(f,p)))});return(0,te.of)(D).pipe(Xo(),wn())}(f,p,v).pipe((0,Ot.z)(C=>C?this.configLoader.loadChildren(f,p).pipe(Ce(D=>{p._loadedRoutes=D.routes,p._loadedInjector=D.injector})):function Sr(a){return _e(Uo(ga,3))}())):(0,te.of)({routes:[],injector:f})}lineralizeSegments(f,p){let v=[],C=p.root;for(;;){if(v=v.concat(C.segments),0===C.numberOfChildren)return(0,te.of)(v);if(C.numberOfChildren>1||!C.children[Bn])return _e(new d.vHH(4e3,ga));C=C.children[Bn]}}applyRedirectCommands(f,p,v){return this.applyRedirectCreateUrlTree(p,this.urlSerializer.parse(p),f,v)}applyRedirectCreateUrlTree(f,p,v,C){const D=this.createSegmentGroup(f,p.root,v,C);return new Cr(D,this.createQueryParams(p.queryParams,this.urlTree.queryParams),p.fragment)}createQueryParams(f,p){const v={};return ne(f,(C,D)=>{if("string"==typeof C&&C.startsWith(":")){const F=C.substring(1);v[D]=p[F]}else v[D]=C}),v}createSegmentGroup(f,p,v,C){const D=this.createSegments(f,p.segments,v,C);let P={};return ne(p.children,(F,W)=>{P[W]=this.createSegmentGroup(f,F,v,C)}),new si(D,P)}createSegments(f,p,v,C){return p.map(D=>D.path.startsWith(":")?this.findPosParam(f,D,C):this.findOrReturn(D,v))}findPosParam(f,p,v){const C=v[p.path.substring(1)];if(!C)throw new d.vHH(4001,ga);return C}findOrReturn(f,p){let v=0;for(const C of p){if(C.path===f.path)return p.splice(v),C;v++}return f}}class ae{}class ht{constructor(f,p,v,C,D,P,F){this.injector=f,this.rootComponentType=p,this.config=v,this.urlTree=C,this.url=D,this.paramsInheritanceStrategy=P,this.urlSerializer=F}recognize(){const f=nr(this.urlTree.root,[],[],this.config.filter(p=>void 0===p.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,f,Bn).pipe((0,oe.U)(p=>{if(null===p)return null;const v=new ks([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Bn,this.rootComponentType,null,this.urlTree.root,-1,{}),C=new Co(v,p),D=new bs(this.url,C);return this.inheritParamsAndData(D._root),D}))}inheritParamsAndData(f){const p=f.value,v=xs(p,this.paramsInheritanceStrategy);p.params=Object.freeze(v.params),p.data=Object.freeze(v.data),f.children.forEach(C=>this.inheritParamsAndData(C))}processSegmentGroup(f,p,v,C){return 0===v.segments.length&&v.hasChildren()?this.processChildren(f,p,v):this.processSegment(f,p,v,v.segments,C)}processChildren(f,p,v){return(0,y.D)(Object.keys(v.children)).pipe((0,at.b)(C=>{const D=v.children[C],P=Js(p,C);return this.processSegmentGroup(f,P,D,C)}),yn((C,D)=>C&&D?(C.push(...D),C):null),function ot(a,f=!1){return(0,we.e)((p,v)=>{let C=0;p.subscribe((0,fe.x)(v,D=>{const P=a(D,C++);(P||f)&&v.next(D),!P&&v.complete()}))})}(C=>null!==C),yt(null),cn(),(0,oe.U)(C=>{if(null===C)return null;const D=rr(C);return function un(a){a.sort((f,p)=>f.value.outlet===Bn?-1:p.value.outlet===Bn?1:f.value.outlet.localeCompare(p.value.outlet))}(D),D}))}processSegment(f,p,v,C,D){return(0,y.D)(p).pipe((0,at.b)(P=>this.processSegmentAgainstRoute(P._injector??f,P,v,C,D)),it(P=>!!P),kt(P=>{if($o(P))return hl(v,C,D)?(0,te.of)([]):(0,te.of)(null);throw P}))}processSegmentAgainstRoute(f,p,v,C,D){if(p.redirectTo||!ql(p,v,C,D))return(0,te.of)(null);let P;if("**"===p.path){const F=C.length>0?It(C).parameters:{},W=Xi(v)+C.length,ue=new ks(C,F,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,sr(p),Dr(p),p.component??p._loadedComponent??null,p,Hi(v),W,io(p));P=(0,te.of)({snapshot:ue,consumedSegments:[],remainingSegments:[]})}else P=ti(v,p,C,f).pipe((0,oe.U)(({matched:F,consumedSegments:W,remainingSegments:ue,parameters:Te})=>{if(!F)return null;const Re=Xi(v)+W.length;return{snapshot:new ks(W,Te,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,sr(p),Dr(p),p.component??p._loadedComponent??null,p,Hi(v),Re,io(p)),consumedSegments:W,remainingSegments:ue}}));return P.pipe((0,Ee.w)(F=>{if(null===F)return(0,te.of)(null);const{snapshot:W,consumedSegments:ue,remainingSegments:Te}=F;f=p._injector??f;const Re=p._loadedInjector??f,je=function Tn(a){return a.children?a.children:a.loadChildren?a._loadedRoutes:[]}(p),{segmentGroup:Le,slicedSegments:Fe}=nr(v,ue,Te,je.filter(Ze=>void 0===Ze.redirectTo));if(0===Fe.length&&Le.hasChildren())return this.processChildren(Re,je,Le).pipe((0,oe.U)(Ze=>null===Ze?null:[new Co(W,Ze)]));if(0===je.length&&0===Fe.length)return(0,te.of)([new Co(W,[])]);const qe=Dr(p)===D;return this.processSegment(Re,je,Le,Fe,qe?Bn:D).pipe((0,oe.U)(Ze=>null===Ze?null:[new Co(W,Ze)]))}))}}function ai(a){const f=a.value.routeConfig;return f&&""===f.path&&void 0===f.redirectTo}function rr(a){const f=[],p=new Set;for(const v of a){if(!ai(v)){f.push(v);continue}const C=f.find(D=>v.value.routeConfig===D.value.routeConfig);void 0!==C?(C.children.push(...v.children),p.add(C)):f.push(v)}for(const v of p){const C=rr(v.children);f.push(new Co(v.value,C))}return f.filter(v=>!p.has(v))}function Hi(a){let f=a;for(;f._sourceSegment;)f=f._sourceSegment;return f}function Xi(a){let f=a,p=f._segmentIndexShift??0;for(;f._sourceSegment;)f=f._sourceSegment,p+=f._segmentIndexShift??0;return p-1}function sr(a){return a.data||{}}function io(a){return a.resolve||{}}function ml(a){return"string"==typeof a.title||null===a.title}function ya(a){return(0,Ee.w)(f=>{const p=a(f);return p?(0,y.D)(p).pipe((0,oe.U)(()=>f)):(0,te.of)(f)})}const lo=new d.OlP("ROUTES");let _l=(()=>{class a{constructor(p,v){this.injector=p,this.compiler=v,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(p){if(this.componentLoaders.get(p))return this.componentLoaders.get(p);if(p._loadedComponent)return(0,te.of)(p._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(p);const v=Je(p.loadComponent()).pipe((0,oe.U)(mc),Ce(D=>{this.onLoadEndListener&&this.onLoadEndListener(p),p._loadedComponent=D}),bn(()=>{this.componentLoaders.delete(p)})),C=new We(v,()=>new ge.x).pipe(Xe());return this.componentLoaders.set(p,C),C}loadChildren(p,v){if(this.childrenLoaders.get(v))return this.childrenLoaders.get(v);if(v._loadedRoutes)return(0,te.of)({routes:v._loadedRoutes,injector:v._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(v);const D=this.loadModuleFactoryOrRoutes(v.loadChildren).pipe((0,oe.U)(F=>{this.onLoadEndListener&&this.onLoadEndListener(v);let W,ue,Te=!1;Array.isArray(F)?ue=F:(W=F.create(p).injector,ue=Zt(W.get(lo,[],d.XFs.Self|d.XFs.Optional)));return{routes:ue.map(ds),injector:W}}),bn(()=>{this.childrenLoaders.delete(v)})),P=new We(D,()=>new ge.x).pipe(Xe());return this.childrenLoaders.set(v,P),P}loadModuleFactoryOrRoutes(p){return Je(p()).pipe((0,oe.U)(mc),(0,Ot.z)(C=>C instanceof d.YKP||Array.isArray(C)?(0,te.of)(C):(0,y.D)(this.compiler.compileModuleAsync(C))))}}return a.\u0275fac=function(p){return new(p||a)(d.LFG(d.zs3),d.LFG(d.Sil))},a.\u0275prov=d.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();function mc(a){return function La(a){return a&&"object"==typeof a&&"default"in a}(a)?a.default:a}let gc=(()=>{class a{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new ge.x,this.configLoader=(0,d.f3M)(_l),this.environmentInjector=(0,d.f3M)(d.lqb),this.urlSerializer=(0,d.f3M)(Ue),this.rootContexts=(0,d.f3M)(Vo),this.navigationId=0,this.afterPreactivation=()=>(0,te.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=C=>this.events.next(new fo(C)),this.configLoader.onLoadStartListener=C=>this.events.next(new Wr(C))}complete(){this.transitions?.complete()}handleNavigationRequest(p){const v=++this.navigationId;this.transitions?.next({...this.transitions.value,...p,id:v})}setupNavigations(p){return this.transitions=new l.X({id:0,targetPageId:0,currentUrlTree:p.currentUrlTree,currentRawUrl:p.currentUrlTree,extractedUrl:p.urlHandlingStrategy.extract(p.currentUrlTree),urlAfterRedirects:p.urlHandlingStrategy.extract(p.currentUrlTree),rawUrl:p.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Vn,restoredState:null,currentSnapshot:p.routerState.snapshot,targetSnapshot:null,currentRouterState:p.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,Gt.h)(v=>0!==v.id),(0,oe.U)(v=>({...v,extractedUrl:p.urlHandlingStrategy.extract(v.rawUrl)})),(0,Ee.w)(v=>{let C=!1,D=!1;return(0,te.of)(v).pipe(Ce(P=>{this.currentNavigation={id:P.id,initialUrl:P.rawUrl,extractedUrl:P.extractedUrl,trigger:P.source,extras:P.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,Ee.w)(P=>{const F=p.browserUrlTree.toString(),W=!p.navigated||P.extractedUrl.toString()!==F||F!==p.currentUrlTree.toString();if(!W&&"reload"!==(P.extras.onSameUrlNavigation??p.onSameUrlNavigation)){const Te="";return this.events.next(new Nr(P.id,p.serializeUrl(v.rawUrl),Te,0)),p.rawUrlTree=P.rawUrl,P.resolve(null),ke.E}if(p.urlHandlingStrategy.shouldProcessUrl(P.rawUrl))return Ja(P.source)&&(p.browserUrlTree=P.extractedUrl),(0,te.of)(P).pipe((0,Ee.w)(Te=>{const Re=this.transitions?.getValue();return this.events.next(new Mi(Te.id,this.urlSerializer.serialize(Te.extractedUrl),Te.source,Te.restoredState)),Re!==this.transitions?.getValue()?ke.E:Promise.resolve(Te)}),function Pl(a,f,p,v){return(0,Ee.w)(C=>function fc(a,f,p,v,C){return new ur(a,f,p,v,C).apply()}(a,f,p,C.extractedUrl,v).pipe((0,oe.U)(D=>({...C,urlAfterRedirects:D}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,p.config),Ce(Te=>{this.currentNavigation={...this.currentNavigation,finalUrl:Te.urlAfterRedirects},v.urlAfterRedirects=Te.urlAfterRedirects}),function $n(a,f,p,v,C){return(0,Ot.z)(D=>function Se(a,f,p,v,C,D,P="emptyOnly"){return new ht(a,f,p,v,C,P,D).recognize().pipe((0,Ee.w)(F=>null===F?function H(a){return new b.y(f=>f.error(a))}(new ae):(0,te.of)(F)))}(a,f,p,D.urlAfterRedirects,v.serialize(D.urlAfterRedirects),v,C).pipe((0,oe.U)(P=>({...D,targetSnapshot:P}))))}(this.environmentInjector,this.rootComponentType,p.config,this.urlSerializer,p.paramsInheritanceStrategy),Ce(Te=>{if(v.targetSnapshot=Te.targetSnapshot,"eager"===p.urlUpdateStrategy){if(!Te.extras.skipLocationChange){const je=p.urlHandlingStrategy.merge(Te.urlAfterRedirects,Te.rawUrl);p.setBrowserUrl(je,Te)}p.browserUrlTree=Te.urlAfterRedirects}const Re=new Hr(Te.id,this.urlSerializer.serialize(Te.extractedUrl),this.urlSerializer.serialize(Te.urlAfterRedirects),Te.targetSnapshot);this.events.next(Re)}));if(W&&p.urlHandlingStrategy.shouldProcessUrl(p.rawUrlTree)){const{id:Te,extractedUrl:Re,source:je,restoredState:Le,extras:Fe}=P,qe=new Mi(Te,this.urlSerializer.serialize(Re),je,Le);this.events.next(qe);const Ze=vs(Re,this.rootComponentType).snapshot;return v={...P,targetSnapshot:Ze,urlAfterRedirects:Re,extras:{...Fe,skipLocationChange:!1,replaceUrl:!1}},(0,te.of)(v)}{const Te="";return this.events.next(new Nr(P.id,p.serializeUrl(v.extractedUrl),Te,1)),p.rawUrlTree=P.rawUrl,P.resolve(null),ke.E}}),Ce(P=>{const F=new zr(P.id,this.urlSerializer.serialize(P.extractedUrl),this.urlSerializer.serialize(P.urlAfterRedirects),P.targetSnapshot);this.events.next(F)}),(0,oe.U)(P=>v={...P,guards:Ie(P.targetSnapshot,P.currentSnapshot,this.rootContexts)}),function Ks(a,f){return(0,Ot.z)(p=>{const{targetSnapshot:v,currentSnapshot:C,guards:{canActivateChecks:D,canDeactivateChecks:P}}=p;return 0===P.length&&0===D.length?(0,te.of)({...p,guardsResult:!0}):function Du(a,f,p,v){return(0,y.D)(a).pipe((0,Ot.z)(C=>function ve(a,f,p,v,C){const D=f&&f.routeConfig?f.routeConfig.canDeactivate:null;if(!D||0===D.length)return(0,te.of)(!0);const P=D.map(F=>{const W=Jo(f)??C,ue=ci(F,W);return Je(function ul(a){return a&&Ya(a.canDeactivate)}(ue)?ue.canDeactivate(a,f,p,v):W.runInContext(()=>ue(a,f,p,v))).pipe(it())});return(0,te.of)(P).pipe(Xo())}(C.component,C.route,p,f,v)),it(C=>!0!==C,!0))}(P,v,C,a).pipe((0,Ot.z)(F=>F&&function Al(a){return"boolean"==typeof a}(F)?function dl(a,f,p,v){return(0,y.D)(f).pipe((0,at.b)(C=>(0,Q.z)(function j(a,f){return null!==a&&f&&f(new _s(a)),(0,te.of)(!0)}(C.route.parent,v),function M(a,f){return null!==a&&f&&f(new xr(a)),(0,te.of)(!0)}(C.route,v),function V(a,f,p){const v=f[f.length-1],D=f.slice(0,f.length-1).reverse().map(P=>function pn(a){const f=a.routeConfig?a.routeConfig.canActivateChild:null;return f&&0!==f.length?{node:a,guards:f}:null}(P)).filter(P=>null!==P).map(P=>(0,Ye.P)(()=>{const F=P.guards.map(W=>{const ue=Jo(P.node)??p,Te=ci(W,ue);return Je(function Pa(a){return a&&Ya(a.canActivateChild)}(Te)?Te.canActivateChild(v,a):ue.runInContext(()=>Te(v,a))).pipe(it())});return(0,te.of)(F).pipe(Xo())}));return(0,te.of)(D).pipe(Xo())}(a,C.path,p),function S(a,f,p){const v=f.routeConfig?f.routeConfig.canActivate:null;if(!v||0===v.length)return(0,te.of)(!0);const C=v.map(D=>(0,Ye.P)(()=>{const P=Jo(f)??p,F=ci(D,P);return Je(function Ri(a){return a&&Ya(a.canActivate)}(F)?F.canActivate(f,a):P.runInContext(()=>F(f,a))).pipe(it())}));return(0,te.of)(C).pipe(Xo())}(a,C.route,p))),it(C=>!0!==C,!0))}(v,D,a,f):(0,te.of)(F)),(0,oe.U)(F=>({...p,guardsResult:F})))})}(this.environmentInjector,P=>this.events.next(P)),Ce(P=>{if(v.guardsResult=P.guardsResult,Tr(P.guardsResult))throw Ro(0,P.guardsResult);const F=new lr(P.id,this.urlSerializer.serialize(P.extractedUrl),this.urlSerializer.serialize(P.urlAfterRedirects),P.targetSnapshot,!!P.guardsResult);this.events.next(F)}),(0,Gt.h)(P=>!!P.guardsResult||(p.restoreHistory(P),this.cancelNavigationTransition(P,"",3),!1)),ya(P=>{if(P.guards.canActivateChecks.length)return(0,te.of)(P).pipe(Ce(F=>{const W=new or(F.id,this.urlSerializer.serialize(F.extractedUrl),this.urlSerializer.serialize(F.urlAfterRedirects),F.targetSnapshot);this.events.next(W)}),(0,Ee.w)(F=>{let W=!1;return(0,te.of)(F).pipe(function ro(a,f){return(0,Ot.z)(p=>{const{targetSnapshot:v,guards:{canActivateChecks:C}}=p;if(!C.length)return(0,te.of)(p);let D=0;return(0,y.D)(C).pipe((0,at.b)(P=>function Bs(a,f,p,v){const C=a.routeConfig,D=a._resolve;return void 0!==C?.title&&!ml(C)&&(D[pi]=C.title),function _a(a,f,p,v){const C=function Oa(a){return[...Object.keys(a),...Object.getOwnPropertySymbols(a)]}(a);if(0===C.length)return(0,te.of)({});const D={};return(0,y.D)(C).pipe((0,Ot.z)(P=>function Qs(a,f,p,v){const C=Jo(f)??v,D=ci(a,C);return Je(D.resolve?D.resolve(f,p):C.runInContext(()=>D(f,p)))}(a[P],f,p,v).pipe(it(),Ce(F=>{D[P]=F}))),Fn(1),function Nt(a){return(0,oe.U)(()=>a)}(D),kt(P=>$o(P)?ke.E:_e(P)))}(D,a,f,v).pipe((0,oe.U)(P=>(a._resolvedData=P,a.data=xs(a,p).resolve,C&&ml(C)&&(a.data[pi]=C.title),null)))}(P.route,v,a,f)),Ce(()=>D++),Fn(1),(0,Ot.z)(P=>D===C.length?(0,te.of)(p):ke.E))})}(p.paramsInheritanceStrategy,this.environmentInjector),Ce({next:()=>W=!0,complete:()=>{W||(p.restoreHistory(F),this.cancelNavigationTransition(F,"",2))}}))}),Ce(F=>{const W=new Wa(F.id,this.urlSerializer.serialize(F.extractedUrl),this.urlSerializer.serialize(F.urlAfterRedirects),F.targetSnapshot);this.events.next(W)}))}),ya(P=>{const F=W=>{const ue=[];W.routeConfig?.loadComponent&&!W.routeConfig._loadedComponent&&ue.push(this.configLoader.loadComponent(W.routeConfig).pipe(Ce(Te=>{W.component=Te}),(0,oe.U)(()=>{})));for(const Te of W.children)ue.push(...F(Te));return ue};return le(F(P.targetSnapshot.root)).pipe(yt(),(0,vt.q)(1))}),ya(()=>this.afterPreactivation()),(0,oe.U)(P=>{const F=function fa(a,f,p){const v=Mo(a,f._root,p?p._root:void 0);return new Hs(v,f)}(p.routeReuseStrategy,P.targetSnapshot,P.currentRouterState);return v={...P,targetRouterState:F}}),Ce(P=>{p.currentUrlTree=P.urlAfterRedirects,p.rawUrlTree=p.urlHandlingStrategy.merge(P.urlAfterRedirects,P.rawUrl),p.routerState=P.targetRouterState,"deferred"===p.urlUpdateStrategy&&(P.extras.skipLocationChange||p.setBrowserUrl(p.rawUrlTree,P),p.browserUrlTree=P.urlAfterRedirects)}),((a,f,p)=>(0,oe.U)(v=>(new K(f,v.targetRouterState,v.currentRouterState,p).activate(a),v)))(this.rootContexts,p.routeReuseStrategy,P=>this.events.next(P)),Ce({next:P=>{C=!0,this.lastSuccessfulNavigation=this.currentNavigation,p.navigated=!0,this.events.next(new Bi(P.id,this.urlSerializer.serialize(P.extractedUrl),this.urlSerializer.serialize(p.currentUrlTree))),p.titleStrategy?.updateTitle(P.targetRouterState.snapshot),P.resolve(!0)},complete:()=>{C=!0}}),bn(()=>{C||D||this.cancelNavigationTransition(v,"",1),this.currentNavigation?.id===v.id&&(this.currentNavigation=null)}),kt(P=>{if(D=!0,qs(P)){ji(P)||(p.navigated=!0,p.restoreHistory(v,!0));const F=new Ni(v.id,this.urlSerializer.serialize(v.extractedUrl),P.message,P.cancellationCode);if(this.events.next(F),ji(P)){const W=p.urlHandlingStrategy.merge(P.url,p.rawUrlTree),ue={skipLocationChange:v.extras.skipLocationChange,replaceUrl:"eager"===p.urlUpdateStrategy||Ja(v.source)};p.scheduleNavigation(W,Vn,null,ue,{resolve:v.resolve,reject:v.reject,promise:v.promise})}else v.resolve(!1)}else{p.restoreHistory(v,!0);const F=new ir(v.id,this.urlSerializer.serialize(v.extractedUrl),P,v.targetSnapshot??void 0);this.events.next(F);try{v.resolve(p.errorHandler(P))}catch(W){v.reject(W)}}return ke.E}))}))}cancelNavigationTransition(p,v,C){const D=new Ni(p.id,this.urlSerializer.serialize(p.extractedUrl),v,C);this.events.next(D),p.resolve(!1)}}return a.\u0275fac=function(p){return new(p||a)},a.\u0275prov=d.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();function Ja(a){return a!==Vn}let Yl=(()=>{class a{buildTitle(p){let v,C=p.root;for(;void 0!==C;)v=this.getResolvedTitleForRoute(C)??v,C=C.children.find(D=>D.outlet===Bn);return v}getResolvedTitleForRoute(p){return p.data[pi]}}return a.\u0275fac=function(p){return new(p||a)},a.\u0275prov=d.Yz7({token:a,factory:function(){return(0,d.f3M)(_c)},providedIn:"root"}),a})(),_c=(()=>{class a extends Yl{constructor(p){super(),this.title=p}updateTitle(p){const v=this.buildTitle(p);void 0!==v&&this.title.setTitle(v)}}return a.\u0275fac=function(p){return new(p||a)(d.LFG(ri.Dx))},a.\u0275prov=d.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})(),Ns=(()=>{class a{}return a.\u0275fac=function(p){return new(p||a)},a.\u0275prov=d.Yz7({token:a,factory:function(){return(0,d.f3M)(Xa)},providedIn:"root"}),a})();class yc{shouldDetach(f){return!1}store(f,p){}shouldAttach(f){return!1}retrieve(f){return null}shouldReuseRoute(f,p){return f.routeConfig===p.routeConfig}}let Xa=(()=>{class a extends yc{}return a.\u0275fac=function(){let f;return function(v){return(f||(f=d.n5z(a)))(v||a)}}(),a.\u0275prov=d.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const vl=new d.OlP("",{providedIn:"root",factory:()=>({})});let Jl=(()=>{class a{}return a.\u0275fac=function(p){return new(p||a)},a.\u0275prov=d.Yz7({token:a,factory:function(){return(0,d.f3M)(xc)},providedIn:"root"}),a})(),xc=(()=>{class a{shouldProcessUrl(p){return!0}extract(p){return p}merge(p,v){return p}}return a.\u0275fac=function(p){return new(p||a)},a.\u0275prov=d.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();function va(a){throw a}function bc(a,f,p){return f.parse("/")}const Bc={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Nc={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Qo=(()=>{class a{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,d.f3M)(d.c2e),this.isNgZoneEnabled=!1,this.options=(0,d.f3M)(vl,{optional:!0})||{},this.errorHandler=this.options.errorHandler||va,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||bc,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,d.f3M)(Jl),this.routeReuseStrategy=(0,d.f3M)(Ns),this.urlCreationStrategy=(0,d.f3M)(co),this.titleStrategy=(0,d.f3M)(Yl),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Zt((0,d.f3M)(lo,{optional:!0})??[]),this.navigationTransitions=(0,d.f3M)(gc),this.urlSerializer=(0,d.f3M)(Ue),this.location=(0,d.f3M)(de.Ye),this.isNgZoneEnabled=(0,d.f3M)(d.R0b)instanceof d.R0b&&d.R0b.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Cr,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=vs(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(p=>{this.lastSuccessfulId=p.id,this.currentPageId=p.targetPageId},p=>{this.console.warn(`Unhandled Navigation Error: ${p}`)})}resetRootComponentType(p){this.routerState.root.component=p,this.navigationTransitions.rootComponentType=p}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const p=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Vn,p)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(p=>{const v="popstate"===p.type?"popstate":"hashchange";"popstate"===v&&setTimeout(()=>{this.navigateToSyncWithBrowser(p.url,v,p.state)},0)}))}navigateToSyncWithBrowser(p,v,C){const D={replaceUrl:!0},P=C?.navigationId?C:null;if(C){const W={...C};delete W.navigationId,delete W.\u0275routerPageId,0!==Object.keys(W).length&&(D.state=W)}const F=this.parseUrl(p);this.scheduleNavigation(F,v,P,D)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(p){this.config=p.map(ds),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(p,v={}){const{relativeTo:C,queryParams:D,fragment:P,queryParamsHandling:F,preserveFragment:W}=v,ue=W?this.currentUrlTree.fragment:P;let Te=null;switch(F){case"merge":Te={...this.currentUrlTree.queryParams,...D};break;case"preserve":Te=this.currentUrlTree.queryParams;break;default:Te=D||null}return null!==Te&&(Te=this.removeEmptyProps(Te)),this.urlCreationStrategy.createUrlTree(C,this.routerState,this.currentUrlTree,p,Te,ue??null)}navigateByUrl(p,v={skipLocationChange:!1}){const C=Tr(p)?p:this.parseUrl(p),D=this.urlHandlingStrategy.merge(C,this.rawUrlTree);return this.scheduleNavigation(D,Vn,null,v)}navigate(p,v={skipLocationChange:!1}){return function xl(a){for(let f=0;f<a.length;f++){if(null==a[f])throw new d.vHH(4008,!1)}}(p),this.navigateByUrl(this.createUrlTree(p,v),v)}serializeUrl(p){return this.urlSerializer.serialize(p)}parseUrl(p){let v;try{v=this.urlSerializer.parse(p)}catch(C){v=this.malformedUriErrorHandler(C,this.urlSerializer,p)}return v}isActive(p,v){let C;if(C=!0===v?{...Bc}:!1===v?{...Nc}:v,Tr(p))return Ii(this.currentUrlTree,p,C);const D=this.parseUrl(p);return Ii(this.currentUrlTree,D,C)}removeEmptyProps(p){return Object.keys(p).reduce((v,C)=>{const D=p[C];return null!=D&&(v[C]=D),v},{})}scheduleNavigation(p,v,C,D,P){if(this.disposed)return Promise.resolve(!1);let F,W,ue,Te;return P?(F=P.resolve,W=P.reject,ue=P.promise):ue=new Promise((Re,je)=>{F=Re,W=je}),Te="computed"===this.canceledNavigationResolution?C&&C.\u0275routerPageId?C.\u0275routerPageId:D.replaceUrl||D.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:Te,source:v,restoredState:C,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:p,extras:D,resolve:F,reject:W,promise:ue,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),ue.catch(Re=>Promise.reject(Re))}setBrowserUrl(p,v){const C=this.urlSerializer.serialize(p),D={...v.extras.state,...this.generateNgRouterState(v.id,v.targetPageId)};this.location.isCurrentPathEqualTo(C)||v.extras.replaceUrl?this.location.replaceState(C,"",D):this.location.go(C,"",D)}restoreHistory(p,v=!1){if("computed"===this.canceledNavigationResolution){const C=this.currentPageId-p.targetPageId;"popstate"!==p.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.getCurrentNavigation()?.finalUrl||0===C?this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===C&&(this.resetState(p),this.browserUrlTree=p.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(C)}else"replace"===this.canceledNavigationResolution&&(v&&this.resetState(p),this.resetUrlToCurrentUrlTree())}resetState(p){this.routerState=p.currentRouterState,this.currentUrlTree=p.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,p.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(p,v){return"computed"===this.canceledNavigationResolution?{navigationId:p,\u0275routerPageId:v}:{navigationId:p}}}return a.\u0275fac=function(p){return new(p||a)},a.\u0275prov=d.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})(),ea=(()=>{class a{constructor(p,v,C,D,P,F){this.router=p,this.route=v,this.tabIndexAttribute=C,this.renderer=D,this.el=P,this.locationStrategy=F,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new ge.x;const W=P.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===W||"area"===W,this.isAnchorElement?this.subscription=p.events.subscribe(ue=>{ue instanceof Bi&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(p){this._preserveFragment=(0,d.D6c)(p)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(p){this._skipLocationChange=(0,d.D6c)(p)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(p){this._replaceUrl=(0,d.D6c)(p)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(p){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",p)}ngOnChanges(p){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(p){null!=p?(this.commands=Array.isArray(p)?p:[p],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(p,v,C,D,P){return!!(null===this.urlTree||this.isAnchorElement&&(0!==p||v||C||D||P||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const p=null===this.href?null:(0,d.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",p)}applyAttributeValue(p,v){const C=this.renderer,D=this.el.nativeElement;null!==v?C.setAttribute(D,p,v):C.removeAttribute(D,p)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return a.\u0275fac=function(p){return new(p||a)(d.Y36(Qo),d.Y36(go),d.$8M("tabindex"),d.Y36(d.Qsj),d.Y36(d.SBq),d.Y36(de.S$))},a.\u0275dir=d.lG2({type:a,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(p,v){1&p&&d.NdJ("click",function(D){return v.onClick(D.button,D.ctrlKey,D.shiftKey,D.altKey,D.metaKey)}),2&p&&d.uIk("target",v.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[d.TTD]}),a})();class zc{}let Mu=(()=>{class a{constructor(p,v,C,D,P){this.router=p,this.injector=C,this.preloadingStrategy=D,this.loader=P}setUpPreloading(){this.subscription=this.router.events.pipe((0,Gt.h)(p=>p instanceof Bi),(0,at.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(p,v){const C=[];for(const D of v){D.providers&&!D._injector&&(D._injector=(0,d.MMx)(D.providers,p,`Route: ${D.path}`));const P=D._injector??p,F=D._loadedInjector??P;D.loadChildren&&!D._loadedRoutes&&void 0===D.canLoad||D.loadComponent&&!D._loadedComponent?C.push(this.preloadConfig(P,D)):(D.children||D._loadedRoutes)&&C.push(this.processRoutes(F,D.children??D._loadedRoutes))}return(0,y.D)(C).pipe((0,Kn.J)())}preloadConfig(p,v){return this.preloadingStrategy.preload(v,()=>{let C;C=v.loadChildren&&void 0===v.canLoad?this.loader.loadChildren(p,v):(0,te.of)(null);const D=C.pipe((0,Ot.z)(P=>null===P?(0,te.of)(void 0):(v._loadedRoutes=P.routes,v._loadedInjector=P.injector,this.processRoutes(P.injector??p,P.routes))));if(v.loadComponent&&!v._loadedComponent){const P=this.loader.loadComponent(v);return(0,y.D)([D,P]).pipe((0,Kn.J)())}return D})}}return a.\u0275fac=function(p){return new(p||a)(d.LFG(Qo),d.LFG(d.Sil),d.LFG(d.lqb),d.LFG(zc),d.LFG(_l))},a.\u0275prov=d.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const Is=new d.OlP("");let Uc=(()=>{class a{constructor(p,v,C,D,P={}){this.urlSerializer=p,this.transitions=v,this.viewportScroller=C,this.zone=D,this.options=P,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},P.scrollPositionRestoration=P.scrollPositionRestoration||"disabled",P.anchorScrolling=P.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(p=>{p instanceof Mi?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=p.navigationTrigger,this.restoredId=p.restoredState?p.restoredState.navigationId:0):p instanceof Bi&&(this.lastId=p.id,this.scheduleScrollEvent(p,this.urlSerializer.parse(p.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(p=>{p instanceof ua&&(p.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(p.position):p.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(p.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(p,v){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new ua(p,"popstate"===this.lastSource?this.store[this.restoredId]:null,v))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return a.\u0275fac=function(p){d.$Z()},a.\u0275prov=d.Yz7({token:a,factory:a.\u0275fac}),a})();function Zn(a,f){return{\u0275kind:a,\u0275providers:f}}function jc(){const a=(0,d.f3M)(d.zs3);return f=>{const p=a.get(d.z2F);if(f!==p.components[0])return;const v=a.get(Qo),C=a.get($c);1===a.get(Ar)&&v.initialNavigation(),a.get(Ol,null,d.XFs.Optional)?.setUpPreloading(),a.get(Is,null,d.XFs.Optional)?.init(),v.resetRootComponentType(p.componentTypes[0]),C.closed||(C.next(),C.unsubscribe())}}const $c=new d.OlP("",{factory:()=>new ge.x}),Ar=new d.OlP("",{providedIn:"root",factory:()=>1});const Ol=new d.OlP("");function wc(a){return Zn(0,[{provide:Ol,useExisting:Mu},{provide:zc,useExisting:a}])}const Ru=new d.OlP("ROUTER_FORROOT_GUARD"),xo=[de.Ye,{provide:Ue,useClass:se},Qo,Vo,{provide:go,useFactory:function xa(a){return a.routerState.root},deps:[Qo]},_l,[]];function Cc(){return new d.PXZ("Router",Qo)}let Rl=(()=>{class a{constructor(p){}static forRoot(p,v){return{ngModule:a,providers:[xo,[],{provide:lo,multi:!0,useValue:p},{provide:Ru,useFactory:Tc,deps:[[Qo,new d.FiY,new d.tp0]]},{provide:vl,useValue:v||{}},v?.useHash?{provide:de.S$,useClass:de.Do}:{provide:de.S$,useClass:de.b0},{provide:Is,useFactory:()=>{const a=(0,d.f3M)(de.EM),f=(0,d.f3M)(d.R0b),p=(0,d.f3M)(vl),v=(0,d.f3M)(gc),C=(0,d.f3M)(Ue);return p.scrollOffset&&a.setOffset(p.scrollOffset),new Uc(C,v,a,f,p)}},v?.preloadingStrategy?wc(v.preloadingStrategy).\u0275providers:[],{provide:d.PXZ,multi:!0,useFactory:Cc},v?.initialNavigation?Qa(v):[],[{provide:m,useFactory:jc},{provide:d.tb,multi:!0,useExisting:m}]]}}static forChild(p){return{ngModule:a,providers:[{provide:lo,multi:!0,useValue:p}]}}}return a.\u0275fac=function(p){return new(p||a)(d.LFG(Ru,8))},a.\u0275mod=d.oAB({type:a}),a.\u0275inj=d.cJS({imports:[qo]}),a})();function Tc(a){return"guarded"}function Qa(a){return["disabled"===a.initialNavigation?Zn(3,[{provide:d.ip1,multi:!0,useFactory:()=>{const f=(0,d.f3M)(Qo);return()=>{f.setUpLocationChangeListener()}}},{provide:Ar,useValue:2}]).\u0275providers:[],"enabledBlocking"===a.initialNavigation?Zn(2,[{provide:Ar,useValue:0},{provide:d.ip1,multi:!0,deps:[d.zs3],useFactory:f=>{const p=f.get(de.V_,Promise.resolve());return()=>p.then(()=>new Promise(C=>{const D=f.get(Qo),P=f.get($c);(function v(C){f.get(Qo).events.pipe((0,Gt.h)(P=>P instanceof Bi||P instanceof Ni||P instanceof ir),(0,oe.U)(P=>P instanceof Bi||P instanceof Ni&&(0===P.code||1===P.code)&&null),(0,Gt.h)(P=>null!==P),(0,vt.q)(1)).subscribe(()=>{C()})})(()=>{C(!0)}),f.get(gc).afterPreactivation=()=>(C(!0),P.closed?(0,te.of)(void 0):P),D.initialNavigation()}))}}]).\u0275providers:[]]}const m=new d.OlP("")},4463:(Pn,Et,k)=>{"use strict";k.d(Et,{Zw:()=>Q,aw:()=>gt,X$:()=>Mt,sK:()=>Ot});var d=k(8274),y=k(9646),te=k(9751),l=k(576);function q(it){return!!it&&(it instanceof te.y||(0,l.m)(it.lift)&&(0,l.m)(it.subscribe))}var re=k(4128),b=k(7272),he=k(9770),Me=k(5698),Ve=k(7579),X=k(6063);class xe extends Ve.x{constructor(at=1/0,Ce=1/0,bt=X.l){super(),this._bufferSize=at,this._windowTime=Ce,this._timestampProvider=bt,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=Ce===1/0,this._bufferSize=Math.max(1,at),this._windowTime=Math.max(1,Ce)}next(at){const{isStopped:Ce,_buffer:bt,_infiniteTimeWindow:kt,_timestampProvider:Vt,_windowTime:yn}=this;Ce||(bt.push(at),!kt&&bt.push(Vt.now()+yn)),this._trimBuffer(),super.next(at)}_subscribe(at){this._throwIfClosed(),this._trimBuffer();const Ce=this._innerSubscribe(at),{_infiniteTimeWindow:bt,_buffer:kt}=this,Vt=kt.slice();for(let yn=0;yn<Vt.length&&!at.closed;yn+=bt?1:2)at.next(Vt[yn]);return this._checkFinalizedStatuses(at),Ce}_trimBuffer(){const{_bufferSize:at,_timestampProvider:Ce,_buffer:bt,_infiniteTimeWindow:kt}=this,Vt=(kt?1:2)*at;if(at<1/0&&Vt<bt.length&&bt.splice(0,bt.length-Vt),!kt){const yn=Ce.now();let Fn=0;for(let cn=1;cn<bt.length&&bt[cn]<=yn;cn+=2)Fn=cn;Fn&&bt.splice(0,Fn+1)}}}var fe=k(3099);function ze(it,at,Ce){let bt,kt=!1;return it&&"object"==typeof it?({bufferSize:bt=1/0,windowTime:at=1/0,refCount:kt=!1,scheduler:Ce}=it):bt=it??1/0,(0,fe.B)({connector:()=>new xe(bt,at,Ce),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:kt})}var le=k(4004),Ke=k(4351),Oe=k(3900);class Q{}let Ye=(()=>{class it extends Q{getTranslation(Ce){return(0,y.of)({})}}return it.\u0275fac=function(){let at;return function(bt){return(at||(at=d.n5z(it)))(bt||it)}}(),it.\u0275prov=d.Yz7({token:it,factory:it.\u0275fac}),it})();class St{}let lt=(()=>{class it{handle(Ce){return Ce.key}}return it.\u0275fac=function(Ce){return new(Ce||it)},it.\u0275prov=d.Yz7({token:it,factory:it.\u0275fac}),it})();function _e(it,at){if(it===at)return!0;if(null===it||null===at)return!1;if(it!=it&&at!=at)return!0;let kt,Vt,yn,Ce=typeof it;if(Ce==typeof at&&"object"==Ce){if(!Array.isArray(it)){if(Array.isArray(at))return!1;for(Vt in yn=Object.create(null),it){if(!_e(it[Vt],at[Vt]))return!1;yn[Vt]=!0}for(Vt in at)if(!(Vt in yn)&&typeof at[Vt]<"u")return!1;return!0}if(!Array.isArray(at))return!1;if((kt=it.length)==at.length){for(Vt=0;Vt<kt;Vt++)if(!_e(it[Vt],at[Vt]))return!1;return!0}}return!1}function ke(it){return typeof it<"u"&&null!==it}function Ne(it){return it&&"object"==typeof it&&!Array.isArray(it)}function we(it,at){let Ce=Object.assign({},it);return Ne(it)&&Ne(at)&&Object.keys(at).forEach(bt=>{Ne(at[bt])?bt in it?Ce[bt]=we(it[bt],at[bt]):Object.assign(Ce,{[bt]:at[bt]}):Object.assign(Ce,{[bt]:at[bt]})}),Ce}class Xe{}let We=(()=>{class it extends Xe{constructor(){super(...arguments),this.templateMatcher=/{{\s?([^{}\s]*)\s?}}/g}interpolate(Ce,bt){let kt;return kt="string"==typeof Ce?this.interpolateString(Ce,bt):"function"==typeof Ce?this.interpolateFunction(Ce,bt):Ce,kt}getValue(Ce,bt){let kt="string"==typeof bt?bt.split("."):[bt];bt="";do{bt+=kt.shift(),!ke(Ce)||!ke(Ce[bt])||"object"!=typeof Ce[bt]&&kt.length?kt.length?bt+=".":Ce=void 0:(Ce=Ce[bt],bt="")}while(kt.length);return Ce}interpolateFunction(Ce,bt){return Ce(bt)}interpolateString(Ce,bt){return bt?Ce.replace(this.templateMatcher,(kt,Vt)=>{let yn=this.getValue(bt,Vt);return ke(yn)?yn:kt}):Ce}}return it.\u0275fac=function(){let at;return function(bt){return(at||(at=d.n5z(it)))(bt||it)}}(),it.\u0275prov=d.Yz7({token:it,factory:it.\u0275fac}),it})();class ge{}let de=(()=>{class it extends ge{compile(Ce,bt){return Ce}compileTranslations(Ce,bt){return Ce}}return it.\u0275fac=function(){let at;return function(bt){return(at||(at=d.n5z(it)))(bt||it)}}(),it.\u0275prov=d.Yz7({token:it,factory:it.\u0275fac}),it})();class oe{constructor(){this.currentLang=this.defaultLang,this.translations={},this.langs=[],this.onTranslationChange=new d.vpe,this.onLangChange=new d.vpe,this.onDefaultLangChange=new d.vpe}}const Ee=new d.OlP("USE_STORE"),vt=new d.OlP("USE_DEFAULT_LANG"),Tt=new d.OlP("DEFAULT_LANGUAGE"),Gt=new d.OlP("USE_EXTEND");let Ot=(()=>{class it{constructor(Ce,bt,kt,Vt,yn,Fn=!0,cn=!1,ot=!1,Nt){this.store=Ce,this.currentLoader=bt,this.compiler=kt,this.parser=Vt,this.missingTranslationHandler=yn,this.useDefaultLang=Fn,this.isolate=cn,this.extend=ot,this.pending=!1,this._onTranslationChange=new d.vpe,this._onLangChange=new d.vpe,this._onDefaultLangChange=new d.vpe,this._langs=[],this._translations={},this._translationRequests={},Nt&&this.setDefaultLang(Nt)}get onTranslationChange(){return this.isolate?this._onTranslationChange:this.store.onTranslationChange}get onLangChange(){return this.isolate?this._onLangChange:this.store.onLangChange}get onDefaultLangChange(){return this.isolate?this._onDefaultLangChange:this.store.onDefaultLangChange}get defaultLang(){return this.isolate?this._defaultLang:this.store.defaultLang}set defaultLang(Ce){this.isolate?this._defaultLang=Ce:this.store.defaultLang=Ce}get currentLang(){return this.isolate?this._currentLang:this.store.currentLang}set currentLang(Ce){this.isolate?this._currentLang=Ce:this.store.currentLang=Ce}get langs(){return this.isolate?this._langs:this.store.langs}set langs(Ce){this.isolate?this._langs=Ce:this.store.langs=Ce}get translations(){return this.isolate?this._translations:this.store.translations}set translations(Ce){this.isolate?this._translations=Ce:this.store.translations=Ce}setDefaultLang(Ce){if(Ce===this.defaultLang)return;let bt=this.retrieveTranslations(Ce);typeof bt<"u"?(null==this.defaultLang&&(this.defaultLang=Ce),bt.pipe((0,Me.q)(1)).subscribe(kt=>{this.changeDefaultLang(Ce)})):this.changeDefaultLang(Ce)}getDefaultLang(){return this.defaultLang}use(Ce){if(Ce===this.currentLang)return(0,y.of)(this.translations[Ce]);let bt=this.retrieveTranslations(Ce);return typeof bt<"u"?(this.currentLang||(this.currentLang=Ce),bt.pipe((0,Me.q)(1)).subscribe(kt=>{this.changeLang(Ce)}),bt):(this.changeLang(Ce),(0,y.of)(this.translations[Ce]))}retrieveTranslations(Ce){let bt;return(typeof this.translations[Ce]>"u"||this.extend)&&(this._translationRequests[Ce]=this._translationRequests[Ce]||this.getTranslation(Ce),bt=this._translationRequests[Ce]),bt}getTranslation(Ce){this.pending=!0;const bt=this.currentLoader.getTranslation(Ce).pipe(ze(1),(0,Me.q)(1));return this.loadingTranslations=bt.pipe((0,le.U)(kt=>this.compiler.compileTranslations(kt,Ce)),ze(1),(0,Me.q)(1)),this.loadingTranslations.subscribe({next:kt=>{this.translations[Ce]=this.extend&&this.translations[Ce]?{...kt,...this.translations[Ce]}:kt,this.updateLangs(),this.pending=!1},error:kt=>{this.pending=!1}}),bt}setTranslation(Ce,bt,kt=!1){bt=this.compiler.compileTranslations(bt,Ce),this.translations[Ce]=(kt||this.extend)&&this.translations[Ce]?we(this.translations[Ce],bt):bt,this.updateLangs(),this.onTranslationChange.emit({lang:Ce,translations:this.translations[Ce]})}getLangs(){return this.langs}addLangs(Ce){Ce.forEach(bt=>{-1===this.langs.indexOf(bt)&&this.langs.push(bt)})}updateLangs(){this.addLangs(Object.keys(this.translations))}getParsedResult(Ce,bt,kt){let Vt;if(bt instanceof Array){let yn={},Fn=!1;for(let cn of bt)yn[cn]=this.getParsedResult(Ce,cn,kt),q(yn[cn])&&(Fn=!0);if(Fn){const cn=bt.map(ot=>q(yn[ot])?yn[ot]:(0,y.of)(yn[ot]));return(0,re.D)(cn).pipe((0,le.U)(ot=>{let Nt={};return ot.forEach((bn,Kn)=>{Nt[bt[Kn]]=bn}),Nt}))}return yn}if(Ce&&(Vt=this.parser.interpolate(this.parser.getValue(Ce,bt),kt)),typeof Vt>"u"&&null!=this.defaultLang&&this.defaultLang!==this.currentLang&&this.useDefaultLang&&(Vt=this.parser.interpolate(this.parser.getValue(this.translations[this.defaultLang],bt),kt)),typeof Vt>"u"){let yn={key:bt,translateService:this};typeof kt<"u"&&(yn.interpolateParams=kt),Vt=this.missingTranslationHandler.handle(yn)}return typeof Vt<"u"?Vt:bt}get(Ce,bt){if(!ke(Ce)||!Ce.length)throw new Error('Parameter "key" required');if(this.pending)return this.loadingTranslations.pipe((0,Ke.b)(kt=>q(kt=this.getParsedResult(kt,Ce,bt))?kt:(0,y.of)(kt)));{let kt=this.getParsedResult(this.translations[this.currentLang],Ce,bt);return q(kt)?kt:(0,y.of)(kt)}}getStreamOnTranslationChange(Ce,bt){if(!ke(Ce)||!Ce.length)throw new Error('Parameter "key" required');return(0,b.z)((0,he.P)(()=>this.get(Ce,bt)),this.onTranslationChange.pipe((0,Oe.w)(kt=>{const Vt=this.getParsedResult(kt.translations,Ce,bt);return"function"==typeof Vt.subscribe?Vt:(0,y.of)(Vt)})))}stream(Ce,bt){if(!ke(Ce)||!Ce.length)throw new Error('Parameter "key" required');return(0,b.z)((0,he.P)(()=>this.get(Ce,bt)),this.onLangChange.pipe((0,Oe.w)(kt=>{const Vt=this.getParsedResult(kt.translations,Ce,bt);return q(Vt)?Vt:(0,y.of)(Vt)})))}instant(Ce,bt){if(!ke(Ce)||!Ce.length)throw new Error('Parameter "key" required');let kt=this.getParsedResult(this.translations[this.currentLang],Ce,bt);if(q(kt)){if(Ce instanceof Array){let Vt={};return Ce.forEach((yn,Fn)=>{Vt[Ce[Fn]]=Ce[Fn]}),Vt}return Ce}return kt}set(Ce,bt,kt=this.currentLang){this.translations[kt][Ce]=this.compiler.compile(bt,kt),this.updateLangs(),this.onTranslationChange.emit({lang:kt,translations:this.translations[kt]})}changeLang(Ce){this.currentLang=Ce,this.onLangChange.emit({lang:Ce,translations:this.translations[Ce]}),null==this.defaultLang&&this.changeDefaultLang(Ce)}changeDefaultLang(Ce){this.defaultLang=Ce,this.onDefaultLangChange.emit({lang:Ce,translations:this.translations[Ce]})}reloadLang(Ce){return this.resetLang(Ce),this.getTranslation(Ce)}resetLang(Ce){this._translationRequests[Ce]=void 0,this.translations[Ce]=void 0}getBrowserLang(){if(typeof window>"u"||typeof window.navigator>"u")return;let Ce=window.navigator.languages?window.navigator.languages[0]:null;return Ce=Ce||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,typeof Ce>"u"?void 0:(-1!==Ce.indexOf("-")&&(Ce=Ce.split("-")[0]),-1!==Ce.indexOf("_")&&(Ce=Ce.split("_")[0]),Ce)}getBrowserCultureLang(){if(typeof window>"u"||typeof window.navigator>"u")return;let Ce=window.navigator.languages?window.navigator.languages[0]:null;return Ce=Ce||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,Ce}}return it.\u0275fac=function(Ce){return new(Ce||it)(d.LFG(oe),d.LFG(Q),d.LFG(ge),d.LFG(Xe),d.LFG(St),d.LFG(vt),d.LFG(Ee),d.LFG(Gt),d.LFG(Tt))},it.\u0275prov=d.Yz7({token:it,factory:it.\u0275fac}),it})(),Mt=(()=>{class it{constructor(Ce,bt){this.translate=Ce,this._ref=bt,this.value="",this.lastKey=null,this.lastParams=[]}updateValue(Ce,bt,kt){let Vt=yn=>{this.value=void 0!==yn?yn:Ce,this.lastKey=Ce,this._ref.markForCheck()};if(kt){let yn=this.translate.getParsedResult(kt,Ce,bt);q(yn.subscribe)?yn.subscribe(Vt):Vt(yn)}this.translate.get(Ce,bt).subscribe(Vt)}transform(Ce,...bt){if(!Ce||!Ce.length)return Ce;if(_e(Ce,this.lastKey)&&_e(bt,this.lastParams))return this.value;let kt;if(ke(bt[0])&&bt.length)if("string"==typeof bt[0]&&bt[0].length){let Vt=bt[0].replace(/(\')?([a-zA-Z0-9_]+)(\')?(\s)?:/g,'"$2":').replace(/:(\s)?(\')(.*?)(\')/g,':"$3"');try{kt=JSON.parse(Vt)}catch{throw new SyntaxError(`Wrong parameter in TranslatePipe. Expected a valid Object, received: ${bt[0]}`)}}else"object"==typeof bt[0]&&!Array.isArray(bt[0])&&(kt=bt[0]);return this.lastKey=Ce,this.lastParams=bt,this.updateValue(Ce,kt),this._dispose(),this.onTranslationChange||(this.onTranslationChange=this.translate.onTranslationChange.subscribe(Vt=>{this.lastKey&&Vt.lang===this.translate.currentLang&&(this.lastKey=null,this.updateValue(Ce,kt,Vt.translations))})),this.onLangChange||(this.onLangChange=this.translate.onLangChange.subscribe(Vt=>{this.lastKey&&(this.lastKey=null,this.updateValue(Ce,kt,Vt.translations))})),this.onDefaultLangChange||(this.onDefaultLangChange=this.translate.onDefaultLangChange.subscribe(()=>{this.lastKey&&(this.lastKey=null,this.updateValue(Ce,kt))})),this.value}_dispose(){typeof this.onTranslationChange<"u"&&(this.onTranslationChange.unsubscribe(),this.onTranslationChange=void 0),typeof this.onLangChange<"u"&&(this.onLangChange.unsubscribe(),this.onLangChange=void 0),typeof this.onDefaultLangChange<"u"&&(this.onDefaultLangChange.unsubscribe(),this.onDefaultLangChange=void 0)}ngOnDestroy(){this._dispose()}}return it.\u0275fac=function(Ce){return new(Ce||it)(d.Y36(Ot,16),d.Y36(d.sBO,16))},it.\u0275pipe=d.Yjl({name:"translate",type:it,pure:!1}),it.\u0275prov=d.Yz7({token:it,factory:it.\u0275fac}),it})(),gt=(()=>{class it{static forRoot(Ce={}){return{ngModule:it,providers:[Ce.loader||{provide:Q,useClass:Ye},Ce.compiler||{provide:ge,useClass:de},Ce.parser||{provide:Xe,useClass:We},Ce.missingTranslationHandler||{provide:St,useClass:lt},oe,{provide:Ee,useValue:Ce.isolate},{provide:vt,useValue:Ce.useDefaultLang},{provide:Gt,useValue:Ce.extend},{provide:Tt,useValue:Ce.defaultLanguage},Ot]}}static forChild(Ce={}){return{ngModule:it,providers:[Ce.loader||{provide:Q,useClass:Ye},Ce.compiler||{provide:ge,useClass:de},Ce.parser||{provide:Xe,useClass:We},Ce.missingTranslationHandler||{provide:St,useClass:lt},{provide:Ee,useValue:Ce.isolate},{provide:vt,useValue:Ce.useDefaultLang},{provide:Gt,useValue:Ce.extend},{provide:Tt,useValue:Ce.defaultLanguage},Ot]}}}return it.\u0275fac=function(Ce){return new(Ce||it)},it.\u0275mod=d.oAB({type:it}),it.\u0275inj=d.cJS({}),it})()},5861:(Pn,Et,k)=>{"use strict";function d(te,l,q,re,b,he,Me){try{var Ve=te[he](Me),X=Ve.value}catch(xe){return void q(xe)}Ve.done?l(X):Promise.resolve(X).then(re,b)}function y(te){return function(){var l=this,q=arguments;return new Promise(function(re,b){var he=te.apply(l,q);function Me(X){d(he,re,b,Me,Ve,"next",X)}function Ve(X){d(he,re,b,Me,Ve,"throw",X)}Me(void 0)})}}k.d(Et,{Z:()=>y})}},Pn=>{Pn(Pn.s=659)}]);