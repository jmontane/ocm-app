(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8792],{5083:(vi,Vt,B)=>{"use strict";B.d(Vt,{E_:()=>He,F3:()=>We});var g=B(467);typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"&&global;var Ce=function($e){return $e.Unimplemented="UNIMPLEMENTED",$e.Unavailable="UNAVAILABLE",$e}(Ce||{});class De extends Error{constructor(Et,cn,fn){super(Et),this.message=Et,this.code=cn,this.data=fn}}const re=$e=>{var Et,cn,fn,Kn,Kt;const at=$e.CapacitorCustomPlatform||null,ve=$e.Capacitor||{},Me=ve.Plugins=ve.Plugins||{},fe=$e.CapacitorPlatforms,_n=(null===(Et=fe?.currentPlatform)||void 0===Et?void 0:Et.getPlatform)||(()=>null!==at?at.name:($e=>{var Et,cn;return $e?.androidBridge?"android":null!==(cn=null===(Et=$e?.webkit)||void 0===Et?void 0:Et.messageHandlers)&&void 0!==cn&&cn.bridge?"ios":"web"})($e)),wn=(null===(cn=fe?.currentPlatform)||void 0===cn?void 0:cn.isNativePlatform)||(()=>"web"!==_n()),tn=(null===(fn=fe?.currentPlatform)||void 0===fn?void 0:fn.isPluginAvailable)||(pn=>{const An=ut.get(pn);return!(!An?.platforms.has(_n())&&!Jn(pn))}),Jn=(null===(Kn=fe?.currentPlatform)||void 0===Kn?void 0:Kn.getPluginHeader)||(pn=>{var An;return null===(An=ve.PluginHeaders)||void 0===An?void 0:An.find(Ct=>Ct.name===pn)}),ut=new Map,ui=(null===(Kt=fe?.currentPlatform)||void 0===Kt?void 0:Kt.registerPlugin)||((pn,An={})=>{const Ct=ut.get(pn);if(Ct)return console.warn(`Capacitor plugin "${pn}" already registered. Cannot register plugins twice.`),Ct.proxy;const Qt=_n(),Se=Jn(pn);let Bt;const Nt=function(){var mr=(0,g.A)(function*(){return!Bt&&Qt in An?Bt=Bt="function"==typeof An[Qt]?yield An[Qt]():An[Qt]:null!==at&&!Bt&&"web"in An&&(Bt=Bt="function"==typeof An.web?yield An.web():An.web),Bt});return function(){return mr.apply(this,arguments)}}(),Ci=mr=>{let $n;const ar=(...gn)=>{const ii=Nt().then(oi=>{const Yi=((mr,$n)=>{var ar,gn;if(!Se){if(mr)return null===(gn=mr[$n])||void 0===gn?void 0:gn.bind(mr);throw new De(`"${pn}" plugin is not implemented on ${Qt}`,Ce.Unimplemented)}{const ii=Se?.methods.find(oi=>$n===oi.name);if(ii)return"promise"===ii.rtype?oi=>ve.nativePromise(pn,$n.toString(),oi):(oi,Yi)=>ve.nativeCallback(pn,$n.toString(),oi,Yi);if(mr)return null===(ar=mr[$n])||void 0===ar?void 0:ar.bind(mr)}})(oi,mr);if(Yi){const pr=Yi(...gn);return $n=pr?.remove,pr}throw new De(`"${pn}.${mr}()" is not implemented on ${Qt}`,Ce.Unimplemented)});return"addListener"===mr&&(ii.remove=(0,g.A)(function*(){return $n()})),ii};return ar.toString=()=>`${mr.toString()}() { [capacitor code] }`,Object.defineProperty(ar,"name",{value:mr,writable:!1,configurable:!1}),ar},Oi=Ci("addListener"),ei=Ci("removeListener"),no=(mr,$n)=>{const ar=Oi({eventName:mr},$n),gn=function(){var oi=(0,g.A)(function*(){const Yi=yield ar;ei({eventName:mr,callbackId:Yi},$n)});return function(){return oi.apply(this,arguments)}}(),ii=new Promise(oi=>ar.then(()=>oi({remove:gn})));return ii.remove=(0,g.A)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield gn()}),ii},mo=new Proxy({},{get(mr,$n){switch($n){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return Se?no:Oi;case"removeListener":return ei;default:return Ci($n)}}});return Me[pn]=mo,ut.set(pn,{name:pn,proxy:mo,platforms:new Set([...Object.keys(An),...Se?[Qt]:[]])}),mo});return ve.convertFileSrc||(ve.convertFileSrc=pn=>pn),ve.getPlatform=_n,ve.handleError=pn=>$e.console.error(pn),ve.isNativePlatform=wn,ve.isPluginAvailable=tn,ve.pluginMethodNoop=(pn,An,Ct)=>Promise.reject(`${Ct} does not have an implementation of "${An}".`),ve.registerPlugin=ui,ve.Exception=De,ve.DEBUG=!!ve.DEBUG,ve.isLoggingEnabled=!!ve.isLoggingEnabled,ve.platform=ve.getPlatform(),ve.isNative=ve.isNativePlatform(),ve},je=($e=>$e.Capacitor=re($e))(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),We=je.registerPlugin;class He{constructor(Et){this.listeners={},this.retainedEventArguments={},this.windowListeners={},Et&&(console.warn(`Capacitor WebPlugin "${Et.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=Et)}addListener(Et,cn){var fn=this;let Kn=!1;this.listeners[Et]||(this.listeners[Et]=[],Kn=!0),this.listeners[Et].push(cn);const at=this.windowListeners[Et];at&&!at.registered&&this.addWindowListener(at),Kn&&this.sendRetainedArgumentsForEvent(Et);const ve=function(){var fe=(0,g.A)(function*(){return fn.removeListener(Et,cn)});return function(){return fe.apply(this,arguments)}}();return Promise.resolve({remove:ve})}removeAllListeners(){var Et=this;return(0,g.A)(function*(){Et.listeners={};for(const cn in Et.windowListeners)Et.removeWindowListener(Et.windowListeners[cn]);Et.windowListeners={}})()}notifyListeners(Et,cn,fn){const Kn=this.listeners[Et];if(Kn)Kn.forEach(Kt=>Kt(cn));else if(fn){let Kt=this.retainedEventArguments[Et];Kt||(Kt=[]),Kt.push(cn),this.retainedEventArguments[Et]=Kt}}hasListeners(Et){return!!this.listeners[Et].length}registerWindowListener(Et,cn){this.windowListeners[cn]={registered:!1,windowEventName:Et,pluginEventName:cn,handler:fn=>{this.notifyListeners(cn,fn)}}}unimplemented(Et="not implemented"){return new je.Exception(Et,Ce.Unimplemented)}unavailable(Et="not available"){return new je.Exception(Et,Ce.Unavailable)}removeListener(Et,cn){var fn=this;return(0,g.A)(function*(){const Kn=fn.listeners[Et];if(!Kn)return;const Kt=Kn.indexOf(cn);fn.listeners[Et].splice(Kt,1),fn.listeners[Et].length||fn.removeWindowListener(fn.windowListeners[Et])})()}addWindowListener(Et){window.addEventListener(Et.windowEventName,Et.handler),Et.registered=!0}removeWindowListener(Et){Et&&(window.removeEventListener(Et.windowEventName,Et.handler),Et.registered=!1)}sendRetainedArgumentsForEvent(Et){const cn=this.retainedEventArguments[Et];cn&&(delete this.retainedEventArguments[Et],cn.forEach(fn=>{this.notifyListeners(Et,fn)}))}}const Ye=$e=>encodeURIComponent($e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Le=$e=>$e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class ot extends He{getCookies(){return(0,g.A)(function*(){const Et=document.cookie,cn={};return Et.split(";").forEach(fn=>{if(fn.length<=0)return;let[Kn,Kt]=fn.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");Kn=Le(Kn).trim(),Kt=Le(Kt).trim(),cn[Kn]=Kt}),cn})()}setCookie(Et){return(0,g.A)(function*(){try{const cn=Ye(Et.key),fn=Ye(Et.value),Kn=`; expires=${(Et.expires||"").replace("expires=","")}`,Kt=(Et.path||"/").replace("path=",""),at=null!=Et.url&&Et.url.length>0?`domain=${Et.url}`:"";document.cookie=`${cn}=${fn||""}${Kn}; path=${Kt}; ${at};`}catch(cn){return Promise.reject(cn)}})()}deleteCookie(Et){return(0,g.A)(function*(){try{document.cookie=`${Et.key}=; Max-Age=0`}catch(cn){return Promise.reject(cn)}})()}clearCookies(){return(0,g.A)(function*(){try{const Et=document.cookie.split(";")||[];for(const cn of Et)document.cookie=cn.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(Et){return Promise.reject(Et)}})()}clearAllCookies(){var Et=this;return(0,g.A)(function*(){try{yield Et.clearCookies()}catch(cn){return Promise.reject(cn)}})()}}We("CapacitorCookies",{web:()=>new ot});const Ue=function(){var $e=(0,g.A)(function*(Et){return new Promise((cn,fn)=>{const Kn=new FileReader;Kn.onload=()=>{const Kt=Kn.result;cn(Kt.indexOf(",")>=0?Kt.split(",")[1]:Kt)},Kn.onerror=Kt=>fn(Kt),Kn.readAsDataURL(Et)})});return function(cn){return $e.apply(this,arguments)}}();class ct extends He{request(Et){return(0,g.A)(function*(){const cn=(($e,Et={})=>{const cn=Object.assign({method:$e.method||"GET",headers:$e.headers},Et),Kn=(($e={})=>{const Et=Object.keys($e);return Object.keys($e).map(Kn=>Kn.toLocaleLowerCase()).reduce((Kn,Kt,at)=>(Kn[Kt]=$e[Et[at]],Kn),{})})($e.headers)["content-type"]||"";if("string"==typeof $e.data)cn.body=$e.data;else if(Kn.includes("application/x-www-form-urlencoded")){const Kt=new URLSearchParams;for(const[at,ve]of Object.entries($e.data||{}))Kt.set(at,ve);cn.body=Kt.toString()}else if(Kn.includes("multipart/form-data")||$e.data instanceof FormData){const Kt=new FormData;if($e.data instanceof FormData)$e.data.forEach((ve,Me)=>{Kt.append(Me,ve)});else for(const ve of Object.keys($e.data))Kt.append(ve,$e.data[ve]);cn.body=Kt;const at=new Headers(cn.headers);at.delete("content-type"),cn.headers=at}else(Kn.includes("application/json")||"object"==typeof $e.data)&&(cn.body=JSON.stringify($e.data));return cn})(Et,Et.webFetchExtra),fn=(($e,Et=!0)=>$e?Object.entries($e).reduce((fn,Kn)=>{const[Kt,at]=Kn;let ve,Me;return Array.isArray(at)?(Me="",at.forEach(fe=>{ve=Et?encodeURIComponent(fe):fe,Me+=`${Kt}=${ve}&`}),Me.slice(0,-1)):(ve=Et?encodeURIComponent(at):at,Me=`${Kt}=${ve}`),`${fn}&${Me}`},"").substr(1):null)(Et.params,Et.shouldEncodeUrlParams),Kn=fn?`${Et.url}?${fn}`:Et.url,Kt=yield fetch(Kn,cn),at=Kt.headers.get("content-type")||"";let Me,fe,{responseType:ve="text"}=Kt.ok?Et:{};switch(at.includes("application/json")&&(ve="json"),ve){case"arraybuffer":case"blob":fe=yield Kt.blob(),Me=yield Ue(fe);break;case"json":Me=yield Kt.json();break;default:Me=yield Kt.text()}const vt={};return Kt.headers.forEach((_n,Re)=>{vt[Re]=_n}),{data:Me,headers:vt,status:Kt.status,url:Kt.url}})()}get(Et){var cn=this;return(0,g.A)(function*(){return cn.request(Object.assign(Object.assign({},Et),{method:"GET"}))})()}post(Et){var cn=this;return(0,g.A)(function*(){return cn.request(Object.assign(Object.assign({},Et),{method:"POST"}))})()}put(Et){var cn=this;return(0,g.A)(function*(){return cn.request(Object.assign(Object.assign({},Et),{method:"PUT"}))})()}patch(Et){var cn=this;return(0,g.A)(function*(){return cn.request(Object.assign(Object.assign({},Et),{method:"PATCH"}))})()}delete(Et){var cn=this;return(0,g.A)(function*(){return cn.request(Object.assign(Object.assign({},Et),{method:"DELETE"}))})()}}We("CapacitorHttp",{web:()=>new ct})},4442:(vi,Vt,B)=>{"use strict";B.d(Vt,{L:()=>Z,a:()=>ie,b:()=>T,c:()=>Ce,d:()=>De,g:()=>Kt}),B(5531);const Z="ionViewWillEnter",ie="ionViewDidEnter",T="ionViewWillLeave",Ce="ionViewDidLeave",De="ionViewWillUnload",Kt=at=>at.classList.contains("ion-page")?at:at.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")||at},5531:(vi,Vt,B)=>{"use strict";B.d(Vt,{a:()=>Je,c:()=>v,g:()=>De});class g{constructor(){this.m=new Map}reset(at){this.m=new Map(Object.entries(at))}get(at,ve){const Me=this.m.get(at);return void 0!==Me?Me:ve}getBoolean(at,ve=!1){const Me=this.m.get(at);return void 0===Me?ve:"string"==typeof Me?"true"===Me:!!Me}getNumber(at,ve){const Me=parseFloat(this.m.get(at));return isNaN(Me)?void 0!==ve?ve:NaN:Me}set(at,ve){this.m.set(at,ve)}}const v=new g,De=Kt=>re(Kt),Je=(Kt,at)=>("string"==typeof Kt&&(at=Kt,Kt=void 0),De(Kt).includes(at)),re=(Kt=window)=>{if(typeof Kt>"u")return[];Kt.Ionic=Kt.Ionic||{};let at=Kt.Ionic.platforms;return null==at&&(at=Kt.Ionic.platforms=ze(Kt),at.forEach(ve=>Kt.document.documentElement.classList.add(`plt-${ve}`))),at},ze=Kt=>{const at=v.get("platform");return Object.keys(Et).filter(ve=>{const Me=at?.[ve];return"function"==typeof Me?Me(Kt):Et[ve](Kt)})},We=Kt=>!!(Mt(Kt,/iPad/i)||Mt(Kt,/Macintosh/i)&&ot(Kt)),He=Kt=>Mt(Kt,/android|sink/i),ot=Kt=>$e(Kt,"(any-pointer:coarse)"),Ue=Kt=>$t(Kt)||nt(Kt),$t=Kt=>!!(Kt.cordova||Kt.phonegap||Kt.PhoneGap),nt=Kt=>{const at=Kt.Capacitor;return!!at?.isNative},Mt=(Kt,at)=>at.test(Kt.navigator.userAgent),$e=(Kt,at)=>{var ve;return null===(ve=Kt.matchMedia)||void 0===ve?void 0:ve.call(Kt,at).matches},Et={ipad:We,iphone:Kt=>Mt(Kt,/iPhone/i),ios:Kt=>Mt(Kt,/iPhone|iPod/i)||We(Kt),android:He,phablet:Kt=>{const at=Kt.innerWidth,ve=Kt.innerHeight,Me=Math.min(at,ve),fe=Math.max(at,ve);return Me>390&&Me<520&&fe>620&&fe<800},tablet:Kt=>{const at=Kt.innerWidth,ve=Kt.innerHeight,Me=Math.min(at,ve),fe=Math.max(at,ve);return We(Kt)||(Kt=>He(Kt)&&!Mt(Kt,/mobile/i))(Kt)||Me>460&&Me<820&&fe>780&&fe<1400},cordova:$t,capacitor:nt,electron:Kt=>Mt(Kt,/electron/i),pwa:Kt=>{var at;return!!(null!==(at=Kt.matchMedia)&&void 0!==at&&at.call(Kt,"(display-mode: standalone)").matches||Kt.navigator.standalone)},mobile:ot,mobileweb:Kt=>ot(Kt)&&!Ue(Kt),desktop:Kt=>!ot(Kt),hybrid:Ue}},9986:(vi,Vt,B)=>{"use strict";B.d(Vt,{c:()=>ie});var g=B(8476);let v;const a=(T,Ce,De)=>{const Je=Ce.startsWith("animation")?(T=>(void 0===v&&(v=void 0===T.style.animationName&&void 0!==T.style.webkitAnimationName?"-webkit-":""),v))(T):"";T.style.setProperty(Je+Ce,De)},Z=(T=[],Ce)=>{if(void 0!==Ce){const De=Array.isArray(Ce)?Ce:[Ce];return[...T,...De]}return T},ie=T=>{let Ce,De,Je,re,ze,je,be,xt,ct,Mt,fn,We=[],Ne=[],ht=[],He=!1,Ye={},Le=[],ot=[],Ve={},Ue=0,$t=!1,nt=!1,$e=!0,Et=!1,cn=!0,Kn=!1;const Kt=T,at=[],ve=[],Me=[],fe=[],vt=[],_n=[],Re=[],wn=[],it=[],tn=[],bn=[],Jn="function"==typeof AnimationEffect||void 0!==g.w&&"function"==typeof g.w.AnimationEffect,jn="function"==typeof Element&&"function"==typeof Element.prototype.animate&&Jn,_i=()=>bn,An=(Be,we)=>{const Fe=we.findIndex(Gt=>Gt.c===Be);Fe>-1&&we.splice(Fe,1)},Qt=(Be,we)=>((we?.oneTimeCallback?ve:at).push({c:Be,o:we}),fn),Bt=()=>{jn&&(bn.forEach(Be=>{Be.cancel()}),bn.length=0)},Nt=()=>{_n.forEach(Be=>{Be?.parentNode&&Be.parentNode.removeChild(Be)}),_n.length=0},Yi=()=>void 0!==ze?ze:be?be.getFill():"both",pr=()=>void 0!==xt?xt:void 0!==je?je:be?be.getDirection():"normal",io=()=>$t?"linear":void 0!==Je?Je:be?be.getEasing():"linear",ao=()=>nt?0:void 0!==ct?ct:void 0!==De?De:be?be.getDuration():0,ro=()=>void 0!==re?re:be?be.getIterations():1,co=()=>void 0!==Mt?Mt:void 0!==Ce?Ce:be?be.getDelay():0,wt=()=>{0!==Ue&&(Ue--,0===Ue&&((()=>{it.forEach(vn=>vn()),tn.forEach(vn=>vn());const Be=$e?1:0,we=Le,Fe=ot,Gt=Ve;fe.forEach(vn=>{const Ie=vn.classList;we.forEach(mt=>Ie.add(mt)),Fe.forEach(mt=>Ie.remove(mt));for(const mt in Gt)Gt.hasOwnProperty(mt)&&a(vn,mt,Gt[mt])}),ct=void 0,xt=void 0,Mt=void 0,at.forEach(vn=>vn.c(Be,fn)),ve.forEach(vn=>vn.c(Be,fn)),ve.length=0,cn=!0,$e&&(Et=!0),$e=!0})(),be&&be.animationFinish()))},ue=()=>{(()=>{Re.forEach(Gt=>Gt()),wn.forEach(Gt=>Gt());const Be=Ne,we=ht,Fe=Ye;fe.forEach(Gt=>{const vn=Gt.classList;Be.forEach(Ie=>vn.add(Ie)),we.forEach(Ie=>vn.remove(Ie));for(const Ie in Fe)Fe.hasOwnProperty(Ie)&&a(Gt,Ie,Fe[Ie])})})(),We.length>0&&jn&&(fe.forEach(Be=>{const we=Be.animate(We,{id:Kt,delay:co(),duration:ao(),easing:io(),iterations:ro(),fill:Yi(),direction:pr()});we.pause(),bn.push(we)}),bn.length>0&&(bn[0].onfinish=()=>{wt()})),He=!0},Ge=Be=>{Be=Math.min(Math.max(Be,0),.9999),jn&&bn.forEach(we=>{we.currentTime=we.effect.getComputedTiming().delay+ao()*Be,we.pause()})},bt=Be=>{bn.forEach(we=>{we.effect.updateTiming({delay:co(),duration:ao(),easing:io(),iterations:ro(),fill:Yi(),direction:pr()})}),void 0!==Be&&Ge(Be)},gt=(Be=!1,we=!0,Fe)=>(Be&&vt.forEach(Gt=>{Gt.update(Be,we,Fe)}),jn&&bt(Fe),fn),on=()=>{He&&(jn?bn.forEach(Be=>{Be.pause()}):fe.forEach(Be=>{a(Be,"animation-play-state","paused")}),Kn=!0)},qi=Be=>new Promise(we=>{Be?.sync&&(nt=!0,Qt(()=>nt=!1,{oneTimeCallback:!0})),He||ue(),Et&&(jn&&(Ge(0),bt()),Et=!1),cn&&(Ue=vt.length+1,cn=!1);const Fe=()=>{An(Gt,ve),we()},Gt=()=>{An(Fe,Me),we()};Qt(Gt,{oneTimeCallback:!0}),((Be,we)=>{Me.push({c:Be,o:{oneTimeCallback:!0}})})(Fe),vt.forEach(vn=>{vn.play()}),jn?(bn.forEach(Be=>{Be.play()}),(0===We.length||0===fe.length)&&wt()):wt(),Kn=!1}),Gi=(Be,we)=>{const Fe=We[0];return void 0===Fe||void 0!==Fe.offset&&0!==Fe.offset?We=[{offset:0,[Be]:we},...We]:Fe[Be]=we,fn};return fn={parentAnimation:be,elements:fe,childAnimations:vt,id:Kt,animationFinish:wt,from:Gi,to:(Be,we)=>{const Fe=We[We.length-1];return void 0===Fe||void 0!==Fe.offset&&1!==Fe.offset?We=[...We,{offset:1,[Be]:we}]:Fe[Be]=we,fn},fromTo:(Be,we,Fe)=>Gi(Be,we).to(Be,Fe),parent:Be=>(be=Be,fn),play:qi,pause:()=>(vt.forEach(Be=>{Be.pause()}),on(),fn),stop:()=>{vt.forEach(Be=>{Be.stop()}),He&&(Bt(),He=!1),$t=!1,nt=!1,cn=!0,xt=void 0,ct=void 0,Mt=void 0,Ue=0,Et=!1,$e=!0,Kn=!1,Me.forEach(Be=>Be.c(0,fn)),Me.length=0},destroy:Be=>(vt.forEach(we=>{we.destroy(Be)}),(Be=>{Bt(),Be&&Nt()})(Be),fe.length=0,vt.length=0,We.length=0,at.length=0,ve.length=0,He=!1,cn=!0,fn),keyframes:Be=>{const we=We!==Be;return We=Be,we&&(Be=>{jn&&_i().forEach(we=>{const Fe=we.effect;if(Fe.setKeyframes)Fe.setKeyframes(Be);else{const Gt=new KeyframeEffect(Fe.target,Be,Fe.getTiming());we.effect=Gt}})})(We),fn},addAnimation:Be=>{if(null!=Be)if(Array.isArray(Be))for(const we of Be)we.parent(fn),vt.push(we);else Be.parent(fn),vt.push(Be);return fn},addElement:Be=>{if(null!=Be)if(1===Be.nodeType)fe.push(Be);else if(Be.length>=0)for(let we=0;we<Be.length;we++)fe.push(Be[we]);else console.error("Invalid addElement value");return fn},update:gt,fill:Be=>(ze=Be,gt(!0),fn),direction:Be=>(je=Be,gt(!0),fn),iterations:Be=>(re=Be,gt(!0),fn),duration:Be=>(!jn&&0===Be&&(Be=1),De=Be,gt(!0),fn),easing:Be=>(Je=Be,gt(!0),fn),delay:Be=>(Ce=Be,gt(!0),fn),getWebAnimations:_i,getKeyframes:()=>We,getFill:Yi,getDirection:pr,getDelay:co,getIterations:ro,getEasing:io,getDuration:ao,afterAddRead:Be=>(it.push(Be),fn),afterAddWrite:Be=>(tn.push(Be),fn),afterClearStyles:(Be=[])=>{for(const we of Be)Ve[we]="";return fn},afterStyles:(Be={})=>(Ve=Be,fn),afterRemoveClass:Be=>(ot=Z(ot,Be),fn),afterAddClass:Be=>(Le=Z(Le,Be),fn),beforeAddRead:Be=>(Re.push(Be),fn),beforeAddWrite:Be=>(wn.push(Be),fn),beforeClearStyles:(Be=[])=>{for(const we of Be)Ye[we]="";return fn},beforeStyles:(Be={})=>(Ye=Be,fn),beforeRemoveClass:Be=>(ht=Z(ht,Be),fn),beforeAddClass:Be=>(Ne=Z(Ne,Be),fn),onFinish:Qt,isRunning:()=>0!==Ue&&!Kn,progressStart:(Be=!1,we)=>(vt.forEach(Fe=>{Fe.progressStart(Be,we)}),on(),$t=Be,He||ue(),gt(!1,!0,we),fn),progressStep:Be=>(vt.forEach(we=>{we.progressStep(Be)}),Ge(Be),fn),progressEnd:(Be,we,Fe)=>($t=!1,vt.forEach(Gt=>{Gt.progressEnd(Be,we,Fe)}),void 0!==Fe&&(ct=Fe),Et=!1,$e=!0,0===Be?(xt="reverse"===pr()?"normal":"reverse","reverse"===xt&&($e=!1),jn?(gt(),Ge(1-we)):(Mt=(1-we)*ao()*-1,gt(!1,!1))):1===Be&&(jn?(gt(),Ge(we)):(Mt=we*ao()*-1,gt(!1,!1))),void 0!==Be&&!be&&qi(),fn)}}},464:(vi,Vt,B)=>{"use strict";B.d(Vt,{E:()=>Je,a:()=>g,s:()=>Ce});const g=re=>{try{if(re instanceof T)return re.value;if(!a()||"string"!=typeof re||""===re)return re;if(re.includes("onload="))return"";const ze=document.createDocumentFragment(),je=document.createElement("div");ze.appendChild(je),je.innerHTML=re,ie.forEach(He=>{const be=ze.querySelectorAll(He);for(let Ye=be.length-1;Ye>=0;Ye--){const Le=be[Ye];Le.parentNode?Le.parentNode.removeChild(Le):ze.removeChild(Le);const ot=me(Le);for(let Ve=0;Ve<ot.length;Ve++)v(ot[Ve])}});const We=me(ze);for(let He=0;He<We.length;He++)v(We[He]);const Ne=document.createElement("div");Ne.appendChild(ze);const ht=Ne.querySelector("div");return null!==ht?ht.innerHTML:Ne.innerHTML}catch(ze){return console.error(ze),""}},v=re=>{if(re.nodeType&&1!==re.nodeType)return;if(typeof NamedNodeMap<"u"&&!(re.attributes instanceof NamedNodeMap))return void re.remove();for(let je=re.attributes.length-1;je>=0;je--){const We=re.attributes.item(je),Ne=We.name;if(!Z.includes(Ne.toLowerCase())){re.removeAttribute(Ne);continue}const ht=We.value,He=re[Ne];(null!=ht&&ht.toLowerCase().includes("javascript:")||null!=He&&He.toLowerCase().includes("javascript:"))&&re.removeAttribute(Ne)}const ze=me(re);for(let je=0;je<ze.length;je++)v(ze[je])},me=re=>null!=re.children?re.children:re.childNodes,a=()=>{var re;const ze=window,je=null===(re=ze?.Ionic)||void 0===re?void 0:re.config;return!je||(je.get?je.get("sanitizerEnabled",!0):!0===je.sanitizerEnabled||void 0===je.sanitizerEnabled)},Z=["class","id","href","src","name","slot"],ie=["script","style","iframe","meta","link","object","embed"];class T{constructor(ze){this.value=ze}}const Ce=re=>{const ze=window,je=ze.Ionic;if(!je||!je.config||"Object"===je.config.constructor.name)return ze.Ionic=ze.Ionic||{},ze.Ionic.config=Object.assign(Object.assign({},ze.Ionic.config),re),ze.Ionic.config},Je=!1},8621:(vi,Vt,B)=>{"use strict";B.d(Vt,{C:()=>Z,a:()=>me,d:()=>a});var g=B(467),v=B(4920);const me=function(){var ie=(0,g.A)(function*(T,Ce,De,Je,re,ze){var je;if(T)return T.attachViewToDom(Ce,De,re,Je);if(!(ze||"string"==typeof De||De instanceof HTMLElement))throw new Error("framework delegate is missing");const We="string"==typeof De?null===(je=Ce.ownerDocument)||void 0===je?void 0:je.createElement(De):De;return Je&&Je.forEach(Ne=>We.classList.add(Ne)),re&&Object.assign(We,re),Ce.appendChild(We),yield new Promise(Ne=>(0,v.c)(We,Ne)),We});return function(Ce,De,Je,re,ze,je){return ie.apply(this,arguments)}}(),a=(ie,T)=>{if(T){if(ie)return ie.removeViewFromDom(T.parentElement,T);T.remove()}return Promise.resolve()},Z=()=>{let ie,T;return{attachViewToDom:function(){var Je=(0,g.A)(function*(re,ze,je={},We=[]){var Ne,ht;let He;if(ie=re,ze){const Ye="string"==typeof ze?null===(Ne=ie.ownerDocument)||void 0===Ne?void 0:Ne.createElement(ze):ze;We.forEach(Le=>Ye.classList.add(Le)),Object.assign(Ye,je),ie.appendChild(Ye),He=Ye,yield new Promise(Le=>(0,v.c)(Ye,Le))}else if(ie.children.length>0&&("ION-MODAL"===ie.tagName||"ION-POPOVER"===ie.tagName)&&!(He=ie.children[0]).classList.contains("ion-delegate-host")){const Le=null===(ht=ie.ownerDocument)||void 0===ht?void 0:ht.createElement("div");Le.classList.add("ion-delegate-host"),We.forEach(ot=>Le.classList.add(ot)),Le.append(...ie.children),ie.appendChild(Le),He=Le}const be=document.querySelector("ion-app")||document.body;return T=document.createComment("ionic teleport"),ie.parentNode.insertBefore(T,ie),be.appendChild(ie),He??ie});return function(ze,je){return Je.apply(this,arguments)}}(),removeViewFromDom:()=>(ie&&T&&(T.parentNode.insertBefore(ie,T),T.remove()),Promise.resolve())}}},1970:(vi,Vt,B)=>{"use strict";B.d(Vt,{B:()=>a,G:()=>Z});class v{constructor(T,Ce,De,Je,re){this.id=Ce,this.name=De,this.disableScroll=re,this.priority=1e6*Je+Ce,this.ctrl=T}canStart(){return!!this.ctrl&&this.ctrl.canStart(this.name)}start(){return!!this.ctrl&&this.ctrl.start(this.name,this.id,this.priority)}capture(){if(!this.ctrl)return!1;const T=this.ctrl.capture(this.name,this.id,this.priority);return T&&this.disableScroll&&this.ctrl.disableScroll(this.id),T}release(){this.ctrl&&(this.ctrl.release(this.id),this.disableScroll&&this.ctrl.enableScroll(this.id))}destroy(){this.release(),this.ctrl=void 0}}class me{constructor(T,Ce,De,Je){this.id=Ce,this.disable=De,this.disableScroll=Je,this.ctrl=T}block(){if(this.ctrl){if(this.disable)for(const T of this.disable)this.ctrl.disableGesture(T,this.id);this.disableScroll&&this.ctrl.disableScroll(this.id)}}unblock(){if(this.ctrl){if(this.disable)for(const T of this.disable)this.ctrl.enableGesture(T,this.id);this.disableScroll&&this.ctrl.enableScroll(this.id)}}destroy(){this.unblock(),this.ctrl=void 0}}const a="backdrop-no-scroll",Z=new class g{constructor(){this.gestureId=0,this.requestedStart=new Map,this.disabledGestures=new Map,this.disabledScroll=new Set}createGesture(T){var Ce;return new v(this,this.newID(),T.name,null!==(Ce=T.priority)&&void 0!==Ce?Ce:0,!!T.disableScroll)}createBlocker(T={}){return new me(this,this.newID(),T.disable,!!T.disableScroll)}start(T,Ce,De){return this.canStart(T)?(this.requestedStart.set(Ce,De),!0):(this.requestedStart.delete(Ce),!1)}capture(T,Ce,De){if(!this.start(T,Ce,De))return!1;const Je=this.requestedStart;let re=-1e4;if(Je.forEach(ze=>{re=Math.max(re,ze)}),re===De){this.capturedId=Ce,Je.clear();const ze=new CustomEvent("ionGestureCaptured",{detail:{gestureName:T}});return document.dispatchEvent(ze),!0}return Je.delete(Ce),!1}release(T){this.requestedStart.delete(T),this.capturedId===T&&(this.capturedId=void 0)}disableGesture(T,Ce){let De=this.disabledGestures.get(T);void 0===De&&(De=new Set,this.disabledGestures.set(T,De)),De.add(Ce)}enableGesture(T,Ce){const De=this.disabledGestures.get(T);void 0!==De&&De.delete(Ce)}disableScroll(T){this.disabledScroll.add(T),1===this.disabledScroll.size&&document.body.classList.add(a)}enableScroll(T){this.disabledScroll.delete(T),0===this.disabledScroll.size&&document.body.classList.remove(a)}canStart(T){return!(void 0!==this.capturedId||this.isDisabled(T))}isCaptured(){return void 0!==this.capturedId}isScrollDisabled(){return this.disabledScroll.size>0}isDisabled(T){const Ce=this.disabledGestures.get(T);return!!(Ce&&Ce.size>0)}newID(){return this.gestureId++,this.gestureId}}},8669:(vi,Vt,B)=>{"use strict";B.r(Vt),B.d(Vt,{MENU_BACK_BUTTON_PRIORITY:()=>De,OVERLAY_BACK_BUTTON_PRIORITY:()=>Ce,blockHardwareBackButton:()=>ie,shouldUseCloseWatcher:()=>Z,startHardwareBackButton:()=>T});var g=B(467),v=B(8476),me=B(4921);B(8393);const Z=()=>me.c.get("experimentalCloseWatcher",!1)&&void 0!==v.w&&"CloseWatcher"in v.w,ie=()=>{document.addEventListener("backbutton",()=>{})},T=()=>{const Je=document;let re=!1;const ze=()=>{if(re)return;let je=0,We=[];const Ne=new CustomEvent("ionBackButton",{bubbles:!1,detail:{register(be,Ye){We.push({priority:be,handler:Ye,id:je++})}}});Je.dispatchEvent(Ne);const ht=function(){var be=(0,g.A)(function*(Ye){try{if(Ye?.handler){const Le=Ye.handler(He);null!=Le&&(yield Le)}}catch(Le){console.error(Le)}});return function(Le){return be.apply(this,arguments)}}(),He=()=>{if(We.length>0){let be={priority:Number.MIN_SAFE_INTEGER,handler:()=>{},id:-1};We.forEach(Ye=>{Ye.priority>=be.priority&&(be=Ye)}),re=!0,We=We.filter(Ye=>Ye.id!==be.id),ht(be).then(()=>re=!1)}};He()};if(Z()){let je;const We=()=>{je?.destroy(),je=new v.w.CloseWatcher,je.onclose=()=>{ze(),We()}};We()}else Je.addEventListener("backbutton",ze)},Ce=100,De=99},4920:(vi,Vt,B)=>{"use strict";B.d(Vt,{a:()=>Ce,b:()=>De,c:()=>me,d:()=>We,e:()=>Ye,f:()=>je,g:()=>Je,h:()=>Z,i:()=>T,j:()=>Ne,k:()=>a,l:()=>ze,m:()=>ht,n:()=>be,o:()=>Le,p:()=>He,r:()=>re,s:()=>ot,t:()=>g});const g=(Ve,Ue=0)=>new Promise($t=>{v(Ve,Ue,$t)}),v=(Ve,Ue=0,$t)=>{let nt,xt;const ct={passive:!0},$e=()=>{nt&&nt()},Et=cn=>{(void 0===cn||Ve===cn.target)&&($e(),$t(cn))};return Ve&&(Ve.addEventListener("webkitTransitionEnd",Et,ct),Ve.addEventListener("transitionend",Et,ct),xt=setTimeout(Et,Ue+500),nt=()=>{void 0!==xt&&(clearTimeout(xt),xt=void 0),Ve.removeEventListener("webkitTransitionEnd",Et,ct),Ve.removeEventListener("transitionend",Et,ct)}),$e},me=(Ve,Ue)=>{Ve.componentOnReady?Ve.componentOnReady().then($t=>Ue($t)):re(()=>Ue(Ve))},a=Ve=>void 0!==Ve.componentOnReady,Z=(Ve,Ue=[])=>{const $t={};return Ue.forEach(nt=>{Ve.hasAttribute(nt)&&(null!==Ve.getAttribute(nt)&&($t[nt]=Ve.getAttribute(nt)),Ve.removeAttribute(nt))}),$t},ie=["role","aria-activedescendant","aria-atomic","aria-autocomplete","aria-braillelabel","aria-brailleroledescription","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colindextext","aria-colspan","aria-controls","aria-current","aria-describedby","aria-description","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowindextext","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext"],T=(Ve,Ue)=>{let $t=ie;return Ue&&Ue.length>0&&($t=$t.filter(nt=>!Ue.includes(nt))),Z(Ve,$t)},Ce=(Ve,Ue,$t,nt)=>{var xt;if(typeof window<"u"){const ct=window,Mt=null===(xt=ct?.Ionic)||void 0===xt?void 0:xt.config;if(Mt){const $e=Mt.get("_ael");if($e)return $e(Ve,Ue,$t,nt);if(Mt._ael)return Mt._ael(Ve,Ue,$t,nt)}}return Ve.addEventListener(Ue,$t,nt)},De=(Ve,Ue,$t,nt)=>{var xt;if(typeof window<"u"){const ct=window,Mt=null===(xt=ct?.Ionic)||void 0===xt?void 0:xt.config;if(Mt){const $e=Mt.get("_rel");if($e)return $e(Ve,Ue,$t,nt);if(Mt._rel)return Mt._rel(Ve,Ue,$t,nt)}}return Ve.removeEventListener(Ue,$t,nt)},Je=(Ve,Ue=Ve)=>Ve.shadowRoot||Ue,re=Ve=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(Ve):"function"==typeof requestAnimationFrame?requestAnimationFrame(Ve):setTimeout(Ve),ze=Ve=>!!Ve.shadowRoot&&!!Ve.attachShadow,je=Ve=>{if(Ve.focus(),Ve.classList.contains("ion-focusable")){const Ue=Ve.closest("ion-app");Ue&&Ue.setFocus([Ve])}},We=(Ve,Ue,$t,nt,xt)=>{if(Ve||ze(Ue)){let ct=Ue.querySelector("input.aux-input");ct||(ct=Ue.ownerDocument.createElement("input"),ct.type="hidden",ct.classList.add("aux-input"),Ue.appendChild(ct)),ct.disabled=xt,ct.name=$t,ct.value=nt||""}},Ne=(Ve,Ue,$t)=>Math.max(Ve,Math.min(Ue,$t)),ht=(Ve,Ue)=>{if(!Ve){const $t="ASSERT: "+Ue;throw console.error($t),new Error($t)}},He=Ve=>{if(Ve){const Ue=Ve.changedTouches;if(Ue&&Ue.length>0){const $t=Ue[0];return{x:$t.clientX,y:$t.clientY}}if(void 0!==Ve.pageX)return{x:Ve.pageX,y:Ve.pageY}}return{x:0,y:0}},be=Ve=>{const Ue="rtl"===document.dir;switch(Ve){case"start":return Ue;case"end":return!Ue;default:throw new Error(`"${Ve}" is not a valid value for [side]. Use "start" or "end" instead.`)}},Ye=(Ve,Ue)=>{const $t=Ve._original||Ve;return{_original:Ve,emit:Le($t.emit.bind($t),Ue)}},Le=(Ve,Ue=0)=>{let $t;return(...nt)=>{clearTimeout($t),$t=setTimeout(Ve,Ue,...nt)}},ot=(Ve,Ue)=>{if(Ve??(Ve={}),Ue??(Ue={}),Ve===Ue)return!0;const $t=Object.keys(Ve);if($t.length!==Object.keys(Ue).length)return!1;for(const nt of $t)if(!(nt in Ue)||Ve[nt]!==Ue[nt])return!1;return!0}},8607:(vi,Vt,B)=>{"use strict";B.r(Vt),B.d(Vt,{GESTURE_CONTROLLER:()=>g.G,createGesture:()=>De});var g=B(1970);const v=(je,We,Ne,ht)=>{const He=me(je)?{capture:!!ht.capture,passive:!!ht.passive}:!!ht.capture;let be,Ye;return je.__zone_symbol__addEventListener?(be="__zone_symbol__addEventListener",Ye="__zone_symbol__removeEventListener"):(be="addEventListener",Ye="removeEventListener"),je[be](We,Ne,He),()=>{je[Ye](We,Ne,He)}},me=je=>{if(void 0===a)try{const We=Object.defineProperty({},"passive",{get:()=>{a=!0}});je.addEventListener("optsTest",()=>{},We)}catch{a=!1}return!!a};let a;const T=je=>je instanceof Document?je:je.ownerDocument,De=je=>{let We=!1,Ne=!1,ht=!0,He=!1;const be=Object.assign({disableScroll:!1,direction:"x",gesturePriority:0,passive:!0,maxAngle:40,threshold:10},je),Ye=be.canStart,Le=be.onWillStart,ot=be.onStart,Ve=be.onEnd,Ue=be.notCaptured,$t=be.onMove,nt=be.threshold,xt=be.passive,ct=be.blurOnStart,Mt={type:"pan",startX:0,startY:0,startTime:0,currentX:0,currentY:0,velocityX:0,velocityY:0,deltaX:0,deltaY:0,currentTime:0,event:void 0,data:void 0},$e=((je,We,Ne)=>{const ht=Ne*(Math.PI/180),He="x"===je,be=Math.cos(ht),Ye=We*We;let Le=0,ot=0,Ve=!1,Ue=0;return{start($t,nt){Le=$t,ot=nt,Ue=0,Ve=!0},detect($t,nt){if(!Ve)return!1;const xt=$t-Le,ct=nt-ot,Mt=xt*xt+ct*ct;if(Mt<Ye)return!1;const $e=Math.sqrt(Mt),Et=(He?xt:ct)/$e;return Ue=Et>be?1:Et<-be?-1:0,Ve=!1,!0},isGesture:()=>0!==Ue,getDirection:()=>Ue}})(be.direction,be.threshold,be.maxAngle),Et=g.G.createGesture({name:je.gestureName,priority:je.gesturePriority,disableScroll:je.disableScroll}),Kn=()=>{We&&(He=!1,$t&&$t(Mt))},Kt=()=>!!Et.capture()&&(We=!0,ht=!1,Mt.startX=Mt.currentX,Mt.startY=Mt.currentY,Mt.startTime=Mt.currentTime,Le?Le(Mt).then(ve):ve(),!0),ve=()=>{ct&&(()=>{if(typeof document<"u"){const Re=document.activeElement;Re?.blur&&Re.blur()}})(),ot&&ot(Mt),ht=!0},Me=()=>{We=!1,Ne=!1,He=!1,ht=!0,Et.release()},fe=Re=>{const wn=We,it=ht;if(Me(),it){if(Je(Mt,Re),wn)return void(Ve&&Ve(Mt));Ue&&Ue(Mt)}},vt=((je,We,Ne,ht,He)=>{let be,Ye,Le,ot,Ve,Ue,$t,nt=0;const xt=at=>{nt=Date.now()+2e3,We(at)&&(!Ye&&Ne&&(Ye=v(je,"touchmove",Ne,He)),Le||(Le=v(at.target,"touchend",Mt,He)),ot||(ot=v(at.target,"touchcancel",Mt,He)))},ct=at=>{nt>Date.now()||We(at)&&(!Ue&&Ne&&(Ue=v(T(je),"mousemove",Ne,He)),$t||($t=v(T(je),"mouseup",$e,He)))},Mt=at=>{Et(),ht&&ht(at)},$e=at=>{cn(),ht&&ht(at)},Et=()=>{Ye&&Ye(),Le&&Le(),ot&&ot(),Ye=Le=ot=void 0},cn=()=>{Ue&&Ue(),$t&&$t(),Ue=$t=void 0},fn=()=>{Et(),cn()},Kn=(at=!0)=>{at?(be||(be=v(je,"touchstart",xt,He)),Ve||(Ve=v(je,"mousedown",ct,He))):(be&&be(),Ve&&Ve(),be=Ve=void 0,fn())};return{enable:Kn,stop:fn,destroy:()=>{Kn(!1),ht=Ne=We=void 0}}})(be.el,Re=>{const wn=ze(Re);return!(Ne||!ht||(re(Re,Mt),Mt.startX=Mt.currentX,Mt.startY=Mt.currentY,Mt.startTime=Mt.currentTime=wn,Mt.velocityX=Mt.velocityY=Mt.deltaX=Mt.deltaY=0,Mt.event=Re,Ye&&!1===Ye(Mt))||(Et.release(),!Et.start()))&&(Ne=!0,0===nt?Kt():($e.start(Mt.startX,Mt.startY),!0))},Re=>{We?!He&&ht&&(He=!0,Je(Mt,Re),requestAnimationFrame(Kn)):(Je(Mt,Re),$e.detect(Mt.currentX,Mt.currentY)&&(!$e.isGesture()||!Kt())&&_n())},fe,{capture:!1,passive:xt}),_n=()=>{Me(),vt.stop(),Ue&&Ue(Mt)};return{enable(Re=!0){Re||(We&&fe(void 0),Me()),vt.enable(Re)},destroy(){Et.destroy(),vt.destroy()}}},Je=(je,We)=>{if(!We)return;const Ne=je.currentX,ht=je.currentY,He=je.currentTime;re(We,je);const be=je.currentX,Ye=je.currentY,ot=(je.currentTime=ze(We))-He;if(ot>0&&ot<100){const Ue=(Ye-ht)/ot;je.velocityX=(be-Ne)/ot*.7+.3*je.velocityX,je.velocityY=.7*Ue+.3*je.velocityY}je.deltaX=be-je.startX,je.deltaY=Ye-je.startY,je.event=We},re=(je,We)=>{let Ne=0,ht=0;if(je){const He=je.changedTouches;if(He&&He.length>0){const be=He[0];Ne=be.clientX,ht=be.clientY}else void 0!==je.pageX&&(Ne=je.pageX,ht=je.pageY)}We.currentX=Ne,We.currentY=ht},ze=je=>je.timeStamp||Date.now()},6073:(vi,Vt,B)=>{"use strict";B.d(Vt,{m:()=>je});var g=B(467),v=B(8476),me=B(8669),a=B(4929),Z=B(4920),ie=B(4921),T=B(9986);const Ce=We=>(0,T.c)().duration(We?400:300),De=We=>{let Ne,ht;const He=We.width+8,be=(0,T.c)(),Ye=(0,T.c)();We.isEndSide?(Ne=He+"px",ht="0px"):(Ne=-He+"px",ht="0px"),be.addElement(We.menuInnerEl).fromTo("transform",`translateX(${Ne})`,`translateX(${ht})`);const ot="ios"===(0,ie.b)(We),Ve=ot?.2:.25;return Ye.addElement(We.backdropEl).fromTo("opacity",.01,Ve),Ce(ot).addAnimation([be,Ye])},Je=We=>{let Ne,ht;const He=(0,ie.b)(We),be=We.width;We.isEndSide?(Ne=-be+"px",ht=be+"px"):(Ne=be+"px",ht=-be+"px");const Ye=(0,T.c)().addElement(We.menuInnerEl).fromTo("transform",`translateX(${ht})`,"translateX(0px)"),Le=(0,T.c)().addElement(We.contentEl).fromTo("transform","translateX(0px)",`translateX(${Ne})`),ot=(0,T.c)().addElement(We.backdropEl).fromTo("opacity",.01,.32);return Ce("ios"===He).addAnimation([Ye,Le,ot])},re=We=>{const Ne=(0,ie.b)(We),ht=We.width*(We.isEndSide?-1:1)+"px",He=(0,T.c)().addElement(We.contentEl).fromTo("transform","translateX(0px)",`translateX(${ht})`);return Ce("ios"===Ne).addAnimation(He)},je=(()=>{const We=new Map,Ne=[],ht=function(){var Me=(0,g.A)(function*(fe){const vt=yield Ue(fe,!0);return!!vt&&vt.open()});return function(vt){return Me.apply(this,arguments)}}(),He=function(){var Me=(0,g.A)(function*(fe){const vt=yield void 0!==fe?Ue(fe,!0):$t();return void 0!==vt&&vt.close()});return function(vt){return Me.apply(this,arguments)}}(),be=function(){var Me=(0,g.A)(function*(fe){const vt=yield Ue(fe,!0);return!!vt&&vt.toggle()});return function(vt){return Me.apply(this,arguments)}}(),Ye=function(){var Me=(0,g.A)(function*(fe,vt){const _n=yield Ue(vt);return _n&&(_n.disabled=!fe),_n});return function(vt,_n){return Me.apply(this,arguments)}}(),Le=function(){var Me=(0,g.A)(function*(fe,vt){const _n=yield Ue(vt);return _n&&(_n.swipeGesture=fe),_n});return function(vt,_n){return Me.apply(this,arguments)}}(),ot=function(){var Me=(0,g.A)(function*(fe){if(null!=fe){const vt=yield Ue(fe);return void 0!==vt&&vt.isOpen()}return void 0!==(yield $t())});return function(vt){return Me.apply(this,arguments)}}(),Ve=function(){var Me=(0,g.A)(function*(fe){const vt=yield Ue(fe);return!!vt&&!vt.disabled});return function(vt){return Me.apply(this,arguments)}}(),Ue=function(){var Me=(0,g.A)(function*(fe,vt=!1){if(yield ve(),"start"===fe||"end"===fe){const Re=Ne.filter(it=>it.side===fe&&!it.disabled);if(Re.length>=1)return Re.length>1&&vt&&(0,a.p)(`menuController queried for a menu on the "${fe}" side, but ${Re.length} menus were found. The first menu reference will be used. If this is not the behavior you want then pass the ID of the menu instead of its side.`,Re.map(it=>it.el)),Re[0].el;const wn=Ne.filter(it=>it.side===fe);if(wn.length>=1)return wn.length>1&&vt&&(0,a.p)(`menuController queried for a menu on the "${fe}" side, but ${wn.length} menus were found. The first menu reference will be used. If this is not the behavior you want then pass the ID of the menu instead of its side.`,wn.map(it=>it.el)),wn[0].el}else if(null!=fe)return at(Re=>Re.menuId===fe);return at(Re=>!Re.disabled)||(Ne.length>0?Ne[0].el:void 0)});return function(vt){return Me.apply(this,arguments)}}(),$t=function(){var Me=(0,g.A)(function*(){return yield ve(),fn()});return function(){return Me.apply(this,arguments)}}(),nt=function(){var Me=(0,g.A)(function*(){return yield ve(),Kn()});return function(){return Me.apply(this,arguments)}}(),xt=function(){var Me=(0,g.A)(function*(){return yield ve(),Kt()});return function(){return Me.apply(this,arguments)}}(),ct=(Me,fe)=>{We.set(Me,fe)},Et=function(){var Me=(0,g.A)(function*(fe,vt,_n){if(Kt())return!1;if(vt){const Re=yield $t();Re&&fe.el!==Re&&(yield Re.setOpen(!1,!1))}return fe._setOpen(vt,_n)});return function(vt,_n,Re){return Me.apply(this,arguments)}}(),fn=()=>at(Me=>Me._isOpen),Kn=()=>Ne.map(Me=>Me.el),Kt=()=>Ne.some(Me=>Me.isAnimating),at=Me=>{const fe=Ne.find(Me);if(void 0!==fe)return fe.el},ve=()=>Promise.all(Array.from(document.querySelectorAll("ion-menu")).map(Me=>new Promise(fe=>(0,Z.c)(Me,fe))));return ct("reveal",re),ct("push",Je),ct("overlay",De),null==v.d||v.d.addEventListener("ionBackButton",Me=>{const fe=fn();fe&&Me.detail.register(me.MENU_BACK_BUTTON_PRIORITY,()=>fe.close())}),{registerAnimation:ct,get:Ue,getMenus:nt,getOpen:$t,isEnabled:Ve,swipeGesture:Le,isAnimating:xt,isOpen:ot,enable:Ye,toggle:be,close:He,open:ht,_getOpenSync:fn,_createAnimation:(Me,fe)=>{const vt=We.get(Me);if(!vt)throw new Error("animation not registered");return vt(fe)},_register:Me=>{Ne.indexOf(Me)<0&&Ne.push(Me)},_unregister:Me=>{const fe=Ne.indexOf(Me);fe>-1&&Ne.splice(fe,1)},_setOpen:Et}})()},8393:(vi,Vt,B)=>{"use strict";B.d(Vt,{B:()=>ie,a:()=>cn,b:()=>Y,c:()=>Yi,d:()=>ro,e:()=>it,f:()=>ei,g:()=>pr,h:()=>Ci,i:()=>ao,j:()=>vr,k:()=>bn,r:()=>De,w:()=>tn});var g=B(467);var a=Object.defineProperty,ie={isDev:!1,isBrowser:!0,isServer:!1,isTesting:!1},T=new WeakMap,Ce=he=>T.get(he),De=(he,qe)=>T.set(qe.$lazyInstance$=he,qe),re=(he,qe)=>qe in he,ze=(he,qe)=>(0,console.error)(he,qe),je=new Map,Ne=new Map,ht=[],ot="s-id",Ve="sty-id",nt="slot-fb{display:contents}slot-fb[hidden]{display:none}",xt="http://www.w3.org/1999/xlink",ct=typeof window<"u"?window:{},Mt=ct.document||{head:{}},Et={$flags$:0,$resourcesUrl$:"",jmp:he=>he(),raf:he=>requestAnimationFrame(he),ael:(he,qe,Pt,Ht)=>he.addEventListener(qe,Pt,Ht),rel:(he,qe,Pt,Ht)=>he.removeEventListener(qe,Pt,Ht),ce:(he,qe)=>new CustomEvent(he,qe)},cn=he=>{Object.assign(Et,he)},Kn=(()=>{let he=!1;try{Mt.addEventListener("e",null,Object.defineProperty({},"passive",{get(){he=!0}}))}catch{}return he})(),at=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replaceSync}catch{}return!1})(),ve=!1,Me=[],fe=[],vt=(he,qe)=>Pt=>{he.push(Pt),ve||(ve=!0,qe&&4&Et.$flags$?wn(Re):Et.raf(Re))},_n=he=>{for(let qe=0;qe<he.length;qe++)try{he[qe](performance.now())}catch(Pt){ze(Pt)}he.length=0},Re=()=>{_n(Me),_n(fe),(ve=Me.length>0)&&Et.raf(Re)},wn=he=>Promise.resolve(void 0).then(he),it=vt(Me,!1),tn=vt(fe,!0),bn=he=>{const qe=new URL(he,Et.$resourcesUrl$);return qe.origin!==ct.location.origin?qe.href:qe.pathname},Jn={},nn=he=>"object"==(he=typeof he)||"function"===he;function ui(he){var qe,Pt,Ht;return null!=(Ht=null==(Pt=null==(qe=he.head)?void 0:qe.querySelector('meta[name="csp-nonce"]'))?void 0:Pt.getAttribute("content"))?Ht:void 0}((he,qe)=>{for(var Pt in qe)a(he,Pt,{get:qe[Pt],enumerable:!0})})({},{err:()=>Ct,map:()=>Qt,ok:()=>An,unwrap:()=>Se,unwrapErr:()=>Bt});var An=he=>({isOk:!0,isErr:!1,value:he}),Ct=he=>({isOk:!1,isErr:!0,value:he});function Qt(he,qe){if(he.isOk){const Pt=qe(he.value);return Pt instanceof Promise?Pt.then(Ht=>An(Ht)):An(Pt)}if(he.isErr)return Ct(he.value);throw"should never get here"}var Se=he=>{if(he.isOk)return he.value;throw he.value},Bt=he=>{if(he.isErr)return he.value;throw he.value},Ci=(he,qe,...Pt)=>{let Ht=null,Ut=null,ln=null,qn=!1,ti=!1;const mi=[],ai=Vi=>{for(let er=0;er<Vi.length;er++)Ht=Vi[er],Array.isArray(Ht)?ai(Ht):null!=Ht&&"boolean"!=typeof Ht&&((qn="function"!=typeof he&&!nn(Ht))&&(Ht=String(Ht)),qn&&ti?mi[mi.length-1].$text$+=Ht:mi.push(qn?Oi(null,Ht):Ht),ti=qn)};if(ai(Pt),qe){qe.key&&(Ut=qe.key),qe.name&&(ln=qe.name);{const Vi=qe.className||qe.class;Vi&&(qe.class="object"!=typeof Vi?Vi:Object.keys(Vi).filter(er=>Vi[er]).join(" "))}}if("function"==typeof he)return he(null===qe?{}:qe,mi,mo);const Hi=Oi(he,null);return Hi.$attrs$=qe,mi.length>0&&(Hi.$children$=mi),Hi.$key$=Ut,Hi.$name$=ln,Hi},Oi=(he,qe)=>({$flags$:0,$tag$:he,$text$:qe,$elm$:null,$children$:null,$attrs$:null,$key$:null,$name$:null}),ei={},mo={forEach:(he,qe)=>he.map(mr).forEach(qe),map:(he,qe)=>he.map(mr).map(qe).map($n)},mr=he=>({vattrs:he.$attrs$,vchildren:he.$children$,vkey:he.$key$,vname:he.$name$,vtag:he.$tag$,vtext:he.$text$}),$n=he=>{if("function"==typeof he.vtag){const Pt={...he.vattrs};return he.vkey&&(Pt.key=he.vkey),he.vname&&(Pt.name=he.vname),Ci(he.vtag,Pt,...he.vchildren||[])}const qe=Oi(he.vtag,he.vtext);return qe.$attrs$=he.vattrs,qe.$children$=he.vchildren,qe.$key$=he.vkey,qe.$name$=he.vname,qe},gn=(he,qe,Pt,Ht,Ut,ln,qn)=>{let ti,mi,ai,Hi;if(1===ln.nodeType){for(ti=ln.getAttribute("c-id"),ti&&(mi=ti.split("."),(mi[0]===qn||"0"===mi[0])&&(ai={$flags$:0,$hostId$:mi[0],$nodeId$:mi[1],$depth$:mi[2],$index$:mi[3],$tag$:ln.tagName.toLowerCase(),$elm$:ln,$attrs$:null,$children$:null,$key$:null,$name$:null,$text$:null},qe.push(ai),ln.removeAttribute("c-id"),he.$children$||(he.$children$=[]),he.$children$[ai.$index$]=ai,he=ai,Ht&&"0"===ai.$depth$&&(Ht[ai.$index$]=ai.$elm$))),Hi=ln.childNodes.length-1;Hi>=0;Hi--)gn(he,qe,Pt,Ht,Ut,ln.childNodes[Hi],qn);if(ln.shadowRoot)for(Hi=ln.shadowRoot.childNodes.length-1;Hi>=0;Hi--)gn(he,qe,Pt,Ht,Ut,ln.shadowRoot.childNodes[Hi],qn)}else if(8===ln.nodeType)mi=ln.nodeValue.split("."),(mi[1]===qn||"0"===mi[1])&&(ti=mi[0],ai={$flags$:0,$hostId$:mi[1],$nodeId$:mi[2],$depth$:mi[3],$index$:mi[4],$elm$:ln,$attrs$:null,$children$:null,$key$:null,$name$:null,$tag$:null,$text$:null},"t"===ti?(ai.$elm$=ln.nextSibling,ai.$elm$&&3===ai.$elm$.nodeType&&(ai.$text$=ai.$elm$.textContent,qe.push(ai),ln.remove(),he.$children$||(he.$children$=[]),he.$children$[ai.$index$]=ai,Ht&&"0"===ai.$depth$&&(Ht[ai.$index$]=ai.$elm$))):ai.$hostId$===qn&&("s"===ti?(ai.$tag$="slot",ln["s-sn"]=mi[5]?ai.$name$=mi[5]:"",ln["s-sr"]=!0,Ht&&(ai.$elm$=Mt.createElement(ai.$tag$),ai.$name$&&ai.$elm$.setAttribute("name",ai.$name$),ln.parentNode.insertBefore(ai.$elm$,ln),ln.remove(),"0"===ai.$depth$&&(Ht[ai.$index$]=ai.$elm$)),Pt.push(ai),he.$children$||(he.$children$=[]),he.$children$[ai.$index$]=ai):"r"===ti&&(Ht?ln.remove():(Ut["s-cr"]=ln,ln["s-cn"]=!0))));else if(he&&"style"===he.$tag$){const Vi=Oi(null,ln.textContent);Vi.$elm$=ln,Vi.$index$="0",he.$children$=[Vi]}},ii=(he,qe)=>{if(1===he.nodeType){let Pt=0;for(;Pt<he.childNodes.length;Pt++)ii(he.childNodes[Pt],qe);if(he.shadowRoot)for(Pt=0;Pt<he.shadowRoot.childNodes.length;Pt++)ii(he.shadowRoot.childNodes[Pt],qe)}else if(8===he.nodeType){const Pt=he.nodeValue.split(".");"o"===Pt[0]&&(qe.set(Pt[1]+"."+Pt[2],he),he.nodeValue="",he["s-en"]=Pt[3])}},Yi=he=>ht.push(he),pr=he=>Ce(he).$modeName$,ao=he=>Ce(he).$hostElement$,ro=(he,qe,Pt)=>{const Ht=ao(he);return{emit:Ut=>co(Ht,qe,{bubbles:!!(4&Pt),composed:!!(2&Pt),cancelable:!!(1&Pt),detail:Ut})}},co=(he,qe,Pt)=>{const Ht=Et.ce(qe,Pt);return he.dispatchEvent(Ht),Ht},Po=new WeakMap,go=(he,qe,Pt)=>{let Ht=Ne.get(he);at&&Pt?(Ht=Ht||new CSSStyleSheet,"string"==typeof Ht?Ht=qe:Ht.replaceSync(qe)):Ht=qe,Ne.set(he,Ht)},bo=(he,qe,Pt)=>{var Ht;const Ut=Cn(qe,Pt),ln=Ne.get(Ut);if(he=11===he.nodeType?he:Mt,ln)if("string"==typeof ln){let ti,qn=Po.get(he=he.head||he);if(qn||Po.set(he,qn=new Set),!qn.has(Ut)){if(he.host&&(ti=he.querySelector(`[${Ve}="${Ut}"]`)))ti.innerHTML=ln;else{ti=Mt.createElement("style"),ti.innerHTML=ln;const mi=null!=(Ht=Et.$nonce$)?Ht:ui(Mt);null!=mi&&ti.setAttribute("nonce",mi),he.insertBefore(ti,he.querySelector("link"))}4&qe.$flags$&&(ti.innerHTML+=nt),qn&&qn.add(Ut)}}else he.adoptedStyleSheets.includes(ln)||(he.adoptedStyleSheets=[...he.adoptedStyleSheets,ln]);return Ut},Cn=(he,qe)=>"sc-"+(qe&&32&he.$flags$?he.$tagName$+"-"+qe:he.$tagName$),At=he=>he.replace(/\/\*!@([^\/]+)\*\/[^\{]+\{/g,"$1{"),an=(he,qe,Pt,Ht,Ut,ln)=>{if(Pt!==Ht){let qn=re(he,qe),ti=qe.toLowerCase();if("class"===qe){const mi=he.classList,ai=On(Pt),Hi=On(Ht);mi.remove(...ai.filter(Vi=>Vi&&!Hi.includes(Vi))),mi.add(...Hi.filter(Vi=>Vi&&!ai.includes(Vi)))}else if("style"===qe){for(const mi in Pt)(!Ht||null==Ht[mi])&&(mi.includes("-")?he.style.removeProperty(mi):he.style[mi]="");for(const mi in Ht)(!Pt||Ht[mi]!==Pt[mi])&&(mi.includes("-")?he.style.setProperty(mi,Ht[mi]):he.style[mi]=Ht[mi])}else if("key"!==qe)if("ref"===qe)Ht&&Ht(he);else if(qn||"o"!==qe[0]||"n"!==qe[1]){const mi=nn(Ht);if((qn||mi&&null!==Ht)&&!Ut)try{if(he.tagName.includes("-"))he[qe]=Ht;else{const Hi=Ht??"";"list"===qe?qn=!1:(null==Pt||he[qe]!=Hi)&&(he[qe]=Hi)}}catch{}let ai=!1;ti!==(ti=ti.replace(/^xlink\:?/,""))&&(qe=ti,ai=!0),null==Ht||!1===Ht?(!1!==Ht||""===he.getAttribute(qe))&&(ai?he.removeAttributeNS(xt,qe):he.removeAttribute(qe)):(!qn||4&ln||Ut)&&!mi&&(Ht=!0===Ht?"":Ht,ai?he.setAttributeNS(xt,qe,Ht):he.setAttribute(qe,Ht))}else if(qe="-"===qe[2]?qe.slice(3):re(ct,ti)?ti.slice(2):ti[2]+qe.slice(3),Pt||Ht){const mi=qe.endsWith(Ze);qe=qe.replace(Ln,""),Pt&&Et.rel(he,qe,Pt,mi),Ht&&Et.ael(he,qe,Ht,mi)}}},pt=/\s/,On=he=>he?he.split(pt):[],Ze="Capture",Ln=new RegExp(Ze+"$"),Dn=(he,qe,Pt)=>{const Ht=11===qe.$elm$.nodeType&&qe.$elm$.host?qe.$elm$.host:qe.$elm$,Ut=he&&he.$attrs$||Jn,ln=qe.$attrs$||Jn;for(const qn of ki(Object.keys(Ut)))qn in ln||an(Ht,qn,Ut[qn],void 0,Pt,qe.$flags$);for(const qn of ki(Object.keys(ln)))an(Ht,qn,Ut[qn],ln[qn],Pt,qe.$flags$)};function ki(he){return he.includes("ref")?[...he.filter(qe=>"ref"!==qe),"ref"]:he}var Fi,wt,te,ue=!1,Ge=!1,bt=!1,gt=!1,jt=(he,qe,Pt,Ht)=>{var Ut;const ln=qe.$children$[Pt];let ti,mi,ai,qn=0;if(ue||(bt=!0,"slot"===ln.$tag$&&(Fi&&Ht.classList.add(Fi+"-s"),ln.$flags$|=ln.$children$?2:1)),null!==ln.$text$)ti=ln.$elm$=Mt.createTextNode(ln.$text$);else if(1&ln.$flags$)ti=ln.$elm$=Mt.createTextNode("");else{if(gt||(gt="svg"===ln.$tag$),ti=ln.$elm$=Mt.createElementNS(gt?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",!ue&&2&ln.$flags$?"slot-fb":ln.$tag$),gt&&"foreignObject"===ln.$tag$&&(gt=!1),Dn(null,ln,gt),(he=>null!=he)(Fi)&&ti["s-si"]!==Fi&&ti.classList.add(ti["s-si"]=Fi),vn(ti,Ht),ln.$children$)for(qn=0;qn<ln.$children$.length;++qn)mi=jt(he,ln,qn,ti),mi&&ti.appendChild(mi);"svg"===ln.$tag$?gt=!1:"foreignObject"===ti.tagName&&(gt=!0)}return ti["s-hn"]=te,3&ln.$flags$&&(ti["s-sr"]=!0,ti["s-cr"]=wt,ti["s-sn"]=ln.$name$||"",ti["s-rf"]=null==(Ut=ln.$attrs$)?void 0:Ut.ref,ai=he&&he.$children$&&he.$children$[Pt],ai&&ai.$tag$===ln.$tag$&&he.$elm$&&rn(he.$elm$)),ti},rn=he=>{Et.$flags$|=1;const qe=he.closest(te.toLowerCase());if(null!=qe){const Pt=Array.from(qe.childNodes).find(Ut=>Ut["s-cr"]),Ht=Array.from(he.childNodes);for(const Ut of Pt?Ht.reverse():Ht)null!=Ut["s-sh"]&&(Fe(qe,Ut,Pt??null),Ut["s-sh"]=void 0,bt=!0)}Et.$flags$&=-2},Ft=(he,qe)=>{Et.$flags$|=1;const Pt=Array.from(he.childNodes);if(he["s-sr"]){let Ht=he;for(;Ht=Ht.nextSibling;)Ht&&Ht["s-sn"]===he["s-sn"]&&Ht["s-sh"]===te&&Pt.push(Ht)}for(let Ht=Pt.length-1;Ht>=0;Ht--){const Ut=Pt[Ht];Ut["s-hn"]!==te&&Ut["s-ol"]&&(Fe(qi(Ut),Ut,Ui(Ut)),Ut["s-ol"].remove(),Ut["s-ol"]=void 0,Ut["s-sh"]=void 0,bt=!0),qe&&Ft(Ut,qe)}Et.$flags$&=-2},on=(he,qe,Pt,Ht,Ut,ln)=>{let ti,qn=he["s-cr"]&&he["s-cr"].parentNode||he;for(qn.shadowRoot&&qn.tagName===te&&(qn=qn.shadowRoot);Ut<=ln;++Ut)Ht[Ut]&&(ti=jt(null,Pt,Ut,he),ti&&(Ht[Ut].$elm$=ti,Fe(qn,ti,Ui(qe))))},Un=(he,qe,Pt)=>{for(let Ht=qe;Ht<=Pt;++Ht){const Ut=he[Ht];if(Ut){const ln=Ut.$elm$;we(Ut),ln&&(Ge=!0,ln["s-ol"]?ln["s-ol"].remove():Ft(ln,!0),ln.remove())}}},Ei=(he,qe,Pt=!1)=>he.$tag$===qe.$tag$&&("slot"===he.$tag$?he.$name$===qe.$name$:!!Pt||he.$key$===qe.$key$),Ui=he=>he&&he["s-ol"]||he,qi=he=>(he["s-ol"]?he["s-ol"]:he).parentNode,Ki=(he,qe,Pt=!1)=>{const Ht=qe.$elm$=he.$elm$,Ut=he.$children$,ln=qe.$children$,qn=qe.$tag$,ti=qe.$text$;let mi;null===ti?(gt="svg"===qn||"foreignObject"!==qn&&gt,"slot"!==qn||ue?Dn(he,qe,gt):he.$name$!==qe.$name$&&(qe.$elm$["s-sn"]=qe.$name$||"",rn(qe.$elm$.parentElement)),null!==Ut&&null!==ln?((he,qe,Pt,Ht,Ut=!1)=>{let Fo,wo,ln=0,qn=0,ti=0,mi=0,ai=qe.length-1,Hi=qe[0],Vi=qe[ai],er=Ht.length-1,ur=Ht[0],To=Ht[er];for(;ln<=ai&&qn<=er;)if(null==Hi)Hi=qe[++ln];else if(null==Vi)Vi=qe[--ai];else if(null==ur)ur=Ht[++qn];else if(null==To)To=Ht[--er];else if(Ei(Hi,ur,Ut))Ki(Hi,ur,Ut),Hi=qe[++ln],ur=Ht[++qn];else if(Ei(Vi,To,Ut))Ki(Vi,To,Ut),Vi=qe[--ai],To=Ht[--er];else if(Ei(Hi,To,Ut))("slot"===Hi.$tag$||"slot"===To.$tag$)&&Ft(Hi.$elm$.parentNode,!1),Ki(Hi,To,Ut),Fe(he,Hi.$elm$,Vi.$elm$.nextSibling),Hi=qe[++ln],To=Ht[--er];else if(Ei(Vi,ur,Ut))("slot"===Hi.$tag$||"slot"===To.$tag$)&&Ft(Vi.$elm$.parentNode,!1),Ki(Vi,ur,Ut),Fe(he,Vi.$elm$,Hi.$elm$),Vi=qe[--ai],ur=Ht[++qn];else{for(ti=-1,mi=ln;mi<=ai;++mi)if(qe[mi]&&null!==qe[mi].$key$&&qe[mi].$key$===ur.$key$){ti=mi;break}ti>=0?(wo=qe[ti],wo.$tag$!==ur.$tag$?Fo=jt(qe&&qe[qn],Pt,ti,he):(Ki(wo,ur,Ut),qe[ti]=void 0,Fo=wo.$elm$),ur=Ht[++qn]):(Fo=jt(qe&&qe[qn],Pt,qn,he),ur=Ht[++qn]),Fo&&Fe(qi(Hi.$elm$),Fo,Ui(Hi.$elm$))}ln>ai?on(he,null==Ht[er+1]?null:Ht[er+1].$elm$,Pt,Ht,qn,er):qn>er&&Un(qe,ln,ai)})(Ht,Ut,qe,ln,Pt):null!==ln?(null!==he.$text$&&(Ht.textContent=""),on(Ht,null,qe,ln,0,ln.length-1)):null!==Ut&&Un(Ut,0,Ut.length-1),gt&&"svg"===qn&&(gt=!1)):(mi=Ht["s-cr"])?mi.parentNode.textContent=ti:he.$text$!==ti&&(Ht.data=ti)},Gi=he=>{const qe=he.childNodes;for(const Pt of qe)if(1===Pt.nodeType){if(Pt["s-sr"]){const Ht=Pt["s-sn"];Pt.hidden=!1;for(const Ut of qe)if(Ut!==Pt)if(Ut["s-hn"]!==Pt["s-hn"]||""!==Ht){if(1===Ut.nodeType&&(Ht===Ut.getAttribute("slot")||Ht===Ut["s-sn"])||3===Ut.nodeType&&Ht===Ut["s-sn"]){Pt.hidden=!0;break}}else if(1===Ut.nodeType||3===Ut.nodeType&&""!==Ut.textContent.trim()){Pt.hidden=!0;break}}Gi(Pt)}},nr=[],lt=he=>{let qe,Pt,Ht;for(const Ut of he.childNodes){if(Ut["s-sr"]&&(qe=Ut["s-cr"])&&qe.parentNode){Pt=qe.parentNode.childNodes;const ln=Ut["s-sn"];for(Ht=Pt.length-1;Ht>=0;Ht--)if(qe=Pt[Ht],!(qe["s-cn"]||qe["s-nr"]||qe["s-hn"]===Ut["s-hn"]||qe["s-sh"]&&qe["s-sh"]===Ut["s-hn"]))if(Be(qe,ln)){let qn=nr.find(ti=>ti.$nodeToRelocate$===qe);Ge=!0,qe["s-sn"]=qe["s-sn"]||ln,qn?(qn.$nodeToRelocate$["s-sh"]=Ut["s-hn"],qn.$slotRefNode$=Ut):(qe["s-sh"]=Ut["s-hn"],nr.push({$slotRefNode$:Ut,$nodeToRelocate$:qe})),qe["s-sr"]&&nr.map(ti=>{Be(ti.$nodeToRelocate$,qe["s-sn"])&&(qn=nr.find(mi=>mi.$nodeToRelocate$===qe),qn&&!ti.$slotRefNode$&&(ti.$slotRefNode$=qn.$slotRefNode$))})}else nr.some(qn=>qn.$nodeToRelocate$===qe)||nr.push({$nodeToRelocate$:qe})}1===Ut.nodeType&&lt(Ut)}},Be=(he,qe)=>1===he.nodeType?null===he.getAttribute("slot")&&""===qe||he.getAttribute("slot")===qe:he["s-sn"]===qe||""===qe,we=he=>{he.$attrs$&&he.$attrs$.ref&&he.$attrs$.ref(null),he.$children$&&he.$children$.map(we)},Fe=(he,qe,Pt)=>{const Ht=he?.insertBefore(qe,Pt);return vn(qe,he),Ht},Gt=he=>{const qe=[];return he&&qe.push(...he["s-scs"]||[],he["s-si"],he["s-sc"],...Gt(he.parentElement)),qe},vn=(he,qe,Pt=!1)=>{var Ht;if(he&&qe&&1===he.nodeType){const Ut=new Set(Gt(qe).filter(Boolean));if(Ut.size&&(null==(Ht=he.classList)||Ht.add(...he["s-scs"]=[...Ut]),he["s-ol"]||Pt))for(const ln of Array.from(he.childNodes))vn(ln,he,!0)}},mt=(he,qe)=>{qe&&!he.$onRenderResolve$&&qe["s-p"]&&qe["s-p"].push(new Promise(Pt=>he.$onRenderResolve$=Pt))},Tt=(he,qe)=>{if(he.$flags$|=16,!(4&he.$flags$))return mt(he,he.$ancestorComponent$),tn(()=>En(he,qe));he.$flags$|=512},En=(he,qe)=>{const Ut=he.$lazyInstance$;if(!Ut)throw new Error(`Can't render component <${he.$hostElement$.tagName.toLowerCase()} /> with invalid Stencil runtime! Make sure this imported component is compiled with a \`externalRuntime: true\` flag. For more information, please refer to https://stenciljs.com/docs/custom-elements#externalruntime`);let ln;return qe&&(he.$flags$|=256,he.$queuedListeners$&&(he.$queuedListeners$.map(([qn,ti])=>gr(Ut,qn,ti)),he.$queuedListeners$=void 0),ln=gr(Ut,"componentWillLoad")),ln=si(ln,()=>gr(Ut,"componentWillRender")),si(ln,()=>Ri(he,Ut,qe))},si=(he,qe)=>Ai(he)?he.then(qe).catch(Pt=>{console.error(Pt),qe()}):qe(),Ai=he=>he instanceof Promise||he&&he.then&&"function"==typeof he.then,Ri=function(){var he=(0,g.A)(function*(qe,Pt,Ht){var Ut;const ln=qe.$hostElement$,ti=ln["s-rc"];Ht&&(he=>{const qe=he.$cmpMeta$,Pt=he.$hostElement$,Ht=qe.$flags$,ln=bo(Pt.shadowRoot?Pt.shadowRoot:Pt.getRootNode(),qe,he.$modeName$);10&Ht&&(Pt["s-sc"]=ln,Pt.classList.add(ln+"-h"),2&Ht&&Pt.classList.add(ln+"-s"))})(qe);pi(qe,Pt,ln,Ht),ti&&(ti.map(ai=>ai()),ln["s-rc"]=void 0);{const ai=null!=(Ut=ln["s-p"])?Ut:[],Hi=()=>Ti(qe);0===ai.length?Hi():(Promise.all(ai).then(Hi),qe.$flags$|=4,ai.length=0)}});return function(Pt,Ht,Ut){return he.apply(this,arguments)}}(),pi=(he,qe,Pt,Ht)=>{try{qe=qe.render&&qe.render(),he.$flags$&=-17,he.$flags$|=2,((he,qe,Pt=!1)=>{var Ht,Ut,ln,qn,ti;const mi=he.$hostElement$,ai=he.$cmpMeta$,Hi=he.$vnode$||Oi(null,null),Vi=(he=>he&&he.$tag$===ei)(qe)?qe:Ci(null,null,qe);if(te=mi.tagName,ai.$attrsToReflect$&&(Vi.$attrs$=Vi.$attrs$||{},ai.$attrsToReflect$.map(([er,ur])=>Vi.$attrs$[ur]=mi[er])),Pt&&Vi.$attrs$)for(const er of Object.keys(Vi.$attrs$))mi.hasAttribute(er)&&!["key","ref","style","class"].includes(er)&&(Vi.$attrs$[er]=mi[er]);if(Vi.$tag$=null,Vi.$flags$|=4,he.$vnode$=Vi,Vi.$elm$=Hi.$elm$=mi.shadowRoot||mi,Fi=mi["s-sc"],ue=!!(1&ai.$flags$),wt=mi["s-cr"],Ge=!1,Ki(Hi,Vi,Pt),Et.$flags$|=1,bt){lt(Vi.$elm$);for(const er of nr){const ur=er.$nodeToRelocate$;if(!ur["s-ol"]){const To=Mt.createTextNode("");To["s-nr"]=ur,Fe(ur.parentNode,ur["s-ol"]=To,ur)}}for(const er of nr){const ur=er.$nodeToRelocate$,To=er.$slotRefNode$;if(To){const Fo=To.parentNode;let wo=To.nextSibling;if(wo&&1===wo.nodeType){let Di=null==(Ht=ur["s-ol"])?void 0:Ht.previousSibling;for(;Di;){let Oo=null!=(Ut=Di["s-nr"])?Ut:null;if(Oo&&Oo["s-sn"]===ur["s-sn"]&&Fo===Oo.parentNode){for(Oo=Oo.nextSibling;Oo===ur||Oo?.["s-sr"];)Oo=Oo?.nextSibling;if(!Oo||!Oo["s-nr"]){wo=Oo;break}}Di=Di.previousSibling}}(!wo&&Fo!==ur.parentNode||ur.nextSibling!==wo)&&ur!==wo&&(Fe(Fo,ur,wo),1===ur.nodeType&&(ur.hidden=null!=(ln=ur["s-ih"])&&ln)),ur&&"function"==typeof To["s-rf"]&&To["s-rf"](ur)}else 1===ur.nodeType&&(Pt&&(ur["s-ih"]=null!=(qn=ur.hidden)&&qn),ur.hidden=!0)}}if(Ge&&Gi(Vi.$elm$),Et.$flags$&=-2,nr.length=0,2&ai.$flags$)for(const er of Vi.$elm$.childNodes)er["s-hn"]!==te&&!er["s-sh"]&&(Pt&&null==er["s-ih"]&&(er["s-ih"]=null!=(ti=er.hidden)&&ti),er.hidden=!0);wt=void 0})(he,qe,Ht)}catch(Ut){ze(Ut,he.$hostElement$)}return null},Ti=he=>{const Pt=he.$hostElement$,Ut=he.$lazyInstance$,ln=he.$ancestorComponent$;gr(Ut,"componentDidRender"),64&he.$flags$?gr(Ut,"componentDidUpdate"):(he.$flags$|=64,Nr(Pt),gr(Ut,"componentDidLoad"),he.$onReadyResolve$(Pt),ln||Io()),he.$onInstanceResolve$(Pt),he.$onRenderResolve$&&(he.$onRenderResolve$(),he.$onRenderResolve$=void 0),512&he.$flags$&&wn(()=>Tt(he,!1)),he.$flags$&=-517},vr=he=>{{const qe=Ce(he),Pt=qe.$hostElement$.isConnected;return Pt&&2==(18&qe.$flags$)&&Tt(qe,!1),Pt}},Io=he=>{Nr(Mt.documentElement),wn(()=>co(ct,"appload",{detail:{namespace:"ionic"}}))},gr=(he,qe,Pt)=>{if(he&&he[qe])try{return he[qe](Pt)}catch(Ht){ze(Ht)}},Nr=he=>he.classList.add(("hydrated","hydrated")),Vr=(he,qe,Pt)=>{var Ht,Ut;const ln=he.prototype;if(qe.$members$||qe.$watchers$||he.watchers){he.watchers&&!qe.$watchers$&&(qe.$watchers$=he.watchers);const qn=Object.entries(null!=(Ht=qe.$members$)?Ht:{});if(qn.map(([ti,[mi]])=>{31&mi||2&Pt&&32&mi?Object.defineProperty(ln,ti,{get(){return((he,qe)=>Ce(this).$instanceValues$.get(qe))(0,ti)},set(ai){((he,qe,Pt,Ht)=>{const Ut=Ce(he);if(!Ut)throw new Error(`Couldn't find host element for "${Ht.$tagName$}" as it is unknown to this Stencil runtime. This usually happens when integrating a 3rd party Stencil component with another Stencil component or application. Please reach out to the maintainers of the 3rd party Stencil component or report this on the Stencil Discord server (https://chat.stenciljs.com) or comment on this similar [GitHub issue](https://github.com/ionic-team/stencil/issues/5457).`);const ln=Ut.$hostElement$,qn=Ut.$instanceValues$.get(qe),ti=Ut.$flags$,mi=Ut.$lazyInstance$;Pt=((he,qe)=>null==he||nn(he)?he:4&qe?"false"!==he&&(""===he||!!he):2&qe?parseFloat(he):1&qe?String(he):he)(Pt,Ht.$members$[qe][0]);const ai=Number.isNaN(qn)&&Number.isNaN(Pt);if((!(8&ti)||void 0===qn)&&Pt!==qn&&!ai&&(Ut.$instanceValues$.set(qe,Pt),mi)){if(Ht.$watchers$&&128&ti){const Vi=Ht.$watchers$[qe];Vi&&Vi.map(er=>{try{mi[er](Pt,qn,qe)}catch(ur){ze(ur,ln)}})}2==(18&ti)&&Tt(Ut,!1)}})(this,ti,ai,qe)},configurable:!0,enumerable:!0}):1&Pt&&64&mi&&Object.defineProperty(ln,ti,{value(...ai){var Hi;const Vi=Ce(this);return null==(Hi=Vi?.$onInstancePromise$)?void 0:Hi.then(()=>{var er;return null==(er=Vi.$lazyInstance$)?void 0:er[ti](...ai)})}})}),1&Pt){const ti=new Map;ln.attributeChangedCallback=function(mi,ai,Hi){Et.jmp(()=>{var Vi;const er=ti.get(mi);if(this.hasOwnProperty(er))Hi=this[er],delete this[er];else{if(ln.hasOwnProperty(er)&&"number"==typeof this[er]&&this[er]==Hi)return;if(null==er){const ur=Ce(this),To=ur?.$flags$;if(To&&!(8&To)&&128&To&&Hi!==ai){const Fo=ur.$lazyInstance$,wo=null==(Vi=qe.$watchers$)?void 0:Vi[mi];wo?.forEach(Di=>{null!=Fo[Di]&&Fo[Di].call(Fo,Hi,ai,mi)})}return}}this[er]=(null!==Hi||"boolean"!=typeof this[er])&&Hi})},he.observedAttributes=Array.from(new Set([...Object.keys(null!=(Ut=qe.$watchers$)?Ut:{}),...qn.filter(([mi,ai])=>15&ai[0]).map(([mi,ai])=>{var Hi;const Vi=ai[1]||mi;return ti.set(Vi,mi),512&ai[0]&&(null==(Hi=qe.$attrsToReflect$)||Hi.push([mi,Vi])),Vi})]))}}return he},uo=function(){var he=(0,g.A)(function*(qe,Pt,Ht,Ut){let ln;if(!(32&Pt.$flags$)){if(Pt.$flags$|=32,Ht.$lazyBundleId$){const ai=((he,qe,Pt)=>{const Ht=he.$tagName$.replace(/-/g,"_"),Ut=he.$lazyBundleId$;if(!Ut)return;const ln=je.get(Ut);return ln?ln[Ht]:B(8996)(`./${Ut}.entry.js`).then(qn=>(je.set(Ut,qn),qn[Ht]),ze)})(Ht);if(ai&&"then"in ai){const Vi=()=>{};ln=yield ai,Vi()}else ln=ai;if(!ln)throw new Error(`Constructor for "${Ht.$tagName$}#${Pt.$modeName$}" was not found`);ln.isProxied||(Ht.$watchers$=ln.watchers,Vr(ln,Ht,2),ln.isProxied=!0);const Hi=()=>{};Pt.$flags$|=8;try{new ln(Pt)}catch(Vi){ze(Vi)}Pt.$flags$&=-9,Pt.$flags$|=128,Hi(),ko(Pt.$lazyInstance$)}else ln=qe.constructor,customElements.whenDefined(qe.localName).then(()=>Pt.$flags$|=128);if(ln&&ln.style){let ai;"string"==typeof ln.style?ai=ln.style:"string"!=typeof ln.style&&(Pt.$modeName$=(he=>ht.map(qe=>qe(he)).find(qe=>!!qe))(qe),Pt.$modeName$&&(ai=ln.style[Pt.$modeName$]));const Hi=Cn(Ht,Pt.$modeName$);if(!Ne.has(Hi)){const Vi=()=>{};go(Hi,ai,!!(1&Ht.$flags$)),Vi()}}}const qn=Pt.$ancestorComponent$,ti=()=>Tt(Pt,!0);qn&&qn["s-rc"]?qn["s-rc"].push(ti):ti()});return function(Pt,Ht,Ut,ln){return he.apply(this,arguments)}}(),ko=he=>{gr(he,"connectedCallback")},Gr=he=>{const qe=he["s-cr"]=Mt.createComment("");qe["s-cn"]=!0,Fe(he,qe,he.firstChild)},xs=he=>{gr(he,"disconnectedCallback")},Qs=function(){var he=(0,g.A)(function*(qe){if(!(1&Et.$flags$)){const Pt=Ce(qe);Pt.$rmListeners$&&(Pt.$rmListeners$.map(Ht=>Ht()),Pt.$rmListeners$=void 0),Pt?.$lazyInstance$?xs(Pt.$lazyInstance$):Pt?.$onReadyPromise$&&Pt.$onReadyPromise$.then(()=>xs(Pt.$lazyInstance$))}});return function(Pt){return he.apply(this,arguments)}}(),Sa=he=>{const qe=he.cloneNode;he.cloneNode=function(Pt){const Ht=this,Ut=Ht.shadowRoot&&true,ln=qe.call(Ht,!!Ut&&Pt);if(!Ut&&Pt){let ti,mi,qn=0;const ai=["s-id","s-cr","s-lr","s-rc","s-sc","s-p","s-cn","s-sr","s-sn","s-hn","s-ol","s-nr","s-si","s-rf","s-scs"];for(;qn<Ht.childNodes.length;qn++)ti=Ht.childNodes[qn]["s-nr"],mi=ai.every(Hi=>!Ht.childNodes[qn][Hi]),ti&&(ln.__appendChild?ln.__appendChild(ti.cloneNode(!0)):ln.appendChild(ti.cloneNode(!0))),mi&&ln.appendChild(Ht.childNodes[qn].cloneNode(!0))}return ln}},ma=he=>{he.__appendChild=he.appendChild,he.appendChild=function(qe){const Pt=qe["s-sn"]=pe(qe),Ht=kr(this.childNodes,Pt,this.tagName);if(Ht){const Ut=Te(Ht,Pt),ln=Ut[Ut.length-1],qn=Fe(ln.parentNode,qe,ln.nextSibling);return Gi(this),qn}return this.__appendChild(qe)}},Fl=he=>{he.__removeChild=he.removeChild,he.removeChild=function(qe){if(qe&&typeof qe["s-sn"]<"u"){const Pt=kr(this.childNodes,qe["s-sn"],this.tagName);if(Pt){const Ut=Te(Pt,qe["s-sn"]).find(ln=>ln===qe);if(Ut)return Ut.remove(),void Gi(this)}}return this.__removeChild(qe)}},ks=he=>{const qe=he.prepend;he.prepend=function(...Pt){Pt.forEach(Ht=>{"string"==typeof Ht&&(Ht=this.ownerDocument.createTextNode(Ht));const Ut=Ht["s-sn"]=pe(Ht),ln=kr(this.childNodes,Ut,this.tagName);if(ln){const qn=document.createTextNode("");qn["s-nr"]=Ht,ln["s-cr"].parentNode.__appendChild(qn),Ht["s-ol"]=qn;const mi=Te(ln,Ut)[0];return Fe(mi.parentNode,Ht,mi.nextSibling)}return 1===Ht.nodeType&&Ht.getAttribute("slot")&&(Ht.hidden=!0),qe.call(this,Ht)})}},xr=he=>{he.append=function(...qe){qe.forEach(Pt=>{"string"==typeof Pt&&(Pt=this.ownerDocument.createTextNode(Pt)),this.appendChild(Pt)})}},Nl=he=>{const qe=he.insertAdjacentHTML;he.insertAdjacentHTML=function(Pt,Ht){if("afterbegin"!==Pt&&"beforeend"!==Pt)return qe.call(this,Pt,Ht);const Ut=this.ownerDocument.createElement("_");let ln;if(Ut.innerHTML=Ht,"afterbegin"===Pt)for(;ln=Ut.firstChild;)this.prepend(ln);else if("beforeend"===Pt)for(;ln=Ut.firstChild;)this.append(ln)}},ol=he=>{he.insertAdjacentText=function(qe,Pt){this.insertAdjacentHTML(qe,Pt)}},Wa=he=>{const qe=he.insertAdjacentElement;he.insertAdjacentElement=function(Pt,Ht){return"afterbegin"!==Pt&&"beforeend"!==Pt?qe.call(this,Pt,Ht):"afterbegin"===Pt?(this.prepend(Ht),Ht):("beforeend"===Pt&&this.append(Ht),Ht)}},bl=he=>{const qe=Object.getOwnPropertyDescriptor(Node.prototype,"textContent");Object.defineProperty(he,"__textContent",qe),Object.defineProperty(he,"textContent",{get(){return" "+sl(this.childNodes).map(Ut=>{var ln,qn;const ti=[];let mi=Ut.nextSibling;for(;mi&&mi["s-sn"]===Ut["s-sn"];)(3===mi.nodeType||1===mi.nodeType)&&ti.push(null!=(qn=null==(ln=mi.textContent)?void 0:ln.trim())?qn:""),mi=mi.nextSibling;return ti.filter(ai=>""!==ai).join(" ")}).filter(Ut=>""!==Ut).join(" ")+" "},set(Pt){sl(this.childNodes).forEach(Ut=>{let ln=Ut.nextSibling;for(;ln&&ln["s-sn"]===Ut["s-sn"];){const qn=ln;ln=ln.nextSibling,qn.remove()}if(""===Ut["s-sn"]){const qn=this.ownerDocument.createTextNode(Pt);qn["s-sn"]="",Fe(Ut.parentElement,qn,Ut.nextSibling)}else Ut.remove()})}})},Vs=(he,qe)=>{class Pt extends Array{item(Ut){return this[Ut]}}if(8&qe.$flags$){const Ht=he.__lookupGetter__("childNodes");Object.defineProperty(he,"children",{get(){return this.childNodes.map(Ut=>1===Ut.nodeType)}}),Object.defineProperty(he,"childElementCount",{get:()=>he.children.length}),Object.defineProperty(he,"childNodes",{get(){const Ut=Ht.call(this);if(!(1&Et.$flags$)&&2&Ce(this).$flags$){const ln=new Pt;for(let qn=0;qn<Ut.length;qn++){const ti=Ut[qn]["s-nr"];ti&&ln.push(ti)}return ln}return Pt.from(Ut)}})}},sl=he=>{const qe=[];for(const Pt of Array.from(he))Pt["s-sr"]&&qe.push(Pt),qe.push(...sl(Pt.childNodes));return qe},pe=he=>he["s-sn"]||1===he.nodeType&&he.getAttribute("slot")||"",kr=(he,qe,Pt)=>{let Ut,Ht=0;for(;Ht<he.length;Ht++)if(Ut=he[Ht],Ut["s-sr"]&&Ut["s-sn"]===qe&&Ut["s-hn"]===Pt||(Ut=kr(Ut.childNodes,qe,Pt),Ut))return Ut;return null},Te=(he,qe)=>{const Pt=[he];for(;(he=he.nextSibling)&&he["s-sn"]===qe;)Pt.push(he);return Pt},Y=(he,qe={})=>{var Pt;const Ut=[],ln=qe.exclude||[],qn=ct.customElements,ti=Mt.head,mi=ti.querySelector("meta[charset]"),ai=Mt.createElement("style"),Hi=[],Vi=Mt.querySelectorAll(`[${Ve}]`);let er,ur=!0,To=0;for(Object.assign(Et,qe),Et.$resourcesUrl$=new URL(qe.resourcesUrl||"./",Mt.baseURI).href,Et.$flags$|=2;To<Vi.length;To++)go(Vi[To].getAttribute(Ve),At(Vi[To].innerHTML),!0);let Fo=!1;if(he.map(wo=>{wo[1].map(Di=>{var Oo;const eo={$flags$:Di[0],$tagName$:Di[1],$members$:Di[2],$listeners$:Di[3]};4&eo.$flags$&&(Fo=!0),eo.$members$=Di[2],eo.$listeners$=Di[3],eo.$attrsToReflect$=[],eo.$watchers$=null!=(Oo=Di[4])?Oo:{};const ga=eo.$tagName$,Do=class extends HTMLElement{constructor(Wr){if(super(Wr),this.hasRegisteredEventListeners=!1,((he,qe)=>{const Pt={$flags$:0,$hostElement$:he,$cmpMeta$:qe,$instanceValues$:new Map};Pt.$onInstancePromise$=new Promise(Ht=>Pt.$onInstanceResolve$=Ht),Pt.$onReadyPromise$=new Promise(Ht=>Pt.$onReadyResolve$=Ht),he["s-p"]=[],he["s-rc"]=[],T.set(he,Pt)})(Wr=this,eo),1&eo.$flags$)if(Wr.shadowRoot){if("open"!==Wr.shadowRoot.mode)throw new Error(`Unable to re-use existing shadow root for ${eo.$tagName$}! Mode is set to ${Wr.shadowRoot.mode} but Stencil only supports open shadow roots.`)}else Wr.attachShadow({mode:"open",delegatesFocus:!!(16&eo.$flags$)})}connectedCallback(){const Wr=Ce(this);this.hasRegisteredEventListeners||(this.hasRegisteredEventListeners=!0,Ae(this,Wr,eo.$listeners$)),er&&(clearTimeout(er),er=null),ur?Hi.push(this):Et.jmp(()=>(he=>{if(!(1&Et.$flags$)){const qe=Ce(he),Pt=qe.$cmpMeta$,Ht=()=>{};if(1&qe.$flags$)Ae(he,qe,Pt.$listeners$),qe?.$lazyInstance$?ko(qe.$lazyInstance$):qe?.$onReadyPromise$&&qe.$onReadyPromise$.then(()=>ko(qe.$lazyInstance$));else{let Ut;if(qe.$flags$|=1,Ut=he.getAttribute(ot),Ut){if(1&Pt.$flags$){const ln=bo(he.shadowRoot,Pt,he.getAttribute("s-mode"));he.classList.remove(ln+"-h",ln+"-s")}((he,qe,Pt,Ht)=>{const ln=he.shadowRoot,qn=[],mi=ln?[]:null,ai=Ht.$vnode$=Oi(qe,null);Et.$orgLocNodes$||ii(Mt.body,Et.$orgLocNodes$=new Map),he[ot]=Pt,he.removeAttribute(ot),gn(ai,qn,[],mi,he,he,Pt),qn.map(Hi=>{const Vi=Hi.$hostId$+"."+Hi.$nodeId$,er=Et.$orgLocNodes$.get(Vi),ur=Hi.$elm$;er&&""===er["s-en"]&&er.parentNode.insertBefore(ur,er.nextSibling),ln||(ur["s-hn"]=qe,er&&(ur["s-ol"]=er,ur["s-ol"]["s-nr"]=ur)),Et.$orgLocNodes$.delete(Vi)}),ln&&mi.map(Hi=>{Hi&&ln.appendChild(Hi)})})(he,Pt.$tagName$,Ut,qe)}Ut||12&Pt.$flags$&&Gr(he);{let ln=he;for(;ln=ln.parentNode||ln.host;)if(1===ln.nodeType&&ln.hasAttribute("s-id")&&ln["s-p"]||ln["s-p"]){mt(qe,qe.$ancestorComponent$=ln);break}}Pt.$members$&&Object.entries(Pt.$members$).map(([ln,[qn]])=>{if(31&qn&&he.hasOwnProperty(ln)){const ti=he[ln];delete he[ln],he[ln]=ti}}),uo(he,qe,Pt)}Ht()}})(this))}disconnectedCallback(){Et.jmp(()=>Qs(this))}componentOnReady(){return Ce(this).$onReadyPromise$}};2&eo.$flags$&&((he,qe)=>{Sa(he),ma(he),xr(he),ks(he),Wa(he),Nl(he),ol(he),bl(he),Vs(he,qe),Fl(he)})(Do.prototype,eo),eo.$lazyBundleId$=wo[0],!ln.includes(ga)&&!qn.get(ga)&&(Ut.push(ga),qn.define(ga,Vr(Do,eo,1)))})}),Ut.length>0&&(Fo&&(ai.textContent+=nt),ai.textContent+=Ut.sort()+"{visibility:hidden}.hydrated{visibility:inherit}",ai.innerHTML.length)){ai.setAttribute("data-styles","");const wo=null!=(Pt=Et.$nonce$)?Pt:ui(Mt);null!=wo&&ai.setAttribute("nonce",wo),ti.insertBefore(ai,mi?mi.nextSibling:ti.firstChild)}ur=!1,Hi.length?Hi.map(wo=>wo.connectedCallback()):Et.jmp(()=>er=setTimeout(Io,30))},Ae=(he,qe,Pt,Ht)=>{Pt&&Pt.map(([Ut,ln,qn])=>{const ti=ho(he,Ut),mi=jr(qe,qn),ai=Zi(Ut);Et.ael(ti,ln,mi,ai),(qe.$rmListeners$=qe.$rmListeners$||[]).push(()=>Et.rel(ti,ln,mi,ai))})},jr=(he,qe)=>Pt=>{var Ht;try{256&he.$flags$?null==(Ht=he.$lazyInstance$)||Ht[qe](Pt):(he.$queuedListeners$=he.$queuedListeners$||[]).push([qe,Pt])}catch(Ut){ze(Ut)}},ho=(he,qe)=>4&qe?Mt:8&qe?ct:16&qe?Mt.body:he,Zi=he=>Kn?{passive:!!(1&he),capture:!!(2&he)}:!!(2&he)},1331:(vi,Vt,B)=>{"use strict";B.d(Vt,{b:()=>Ce,c:()=>De,d:()=>Je,e:()=>fn,g:()=>at,l:()=>Et,s:()=>Kn,t:()=>be,w:()=>cn});var g=B(467),v=B(4921),me=B(8393),a=B(4929),Z=B(4920);const Ce="ionViewWillLeave",De="ionViewDidLeave",Je="ionViewWillUnload",re=ve=>{ve.tabIndex=-1,ve.focus()},ze=ve=>null!==ve.offsetParent,We="ion-last-focus",He_saveViewFocus=fe=>{if(v.c.get("focusManagerPriority",!1)){const _n=document.activeElement;null!==_n&&fe?.contains(_n)&&_n.setAttribute(We,"true")}},He_setViewFocus=fe=>{const vt=v.c.get("focusManagerPriority",!1);if(Array.isArray(vt)&&!fe.contains(document.activeElement)){const _n=fe.querySelector(`[${We}]`);if(_n&&ze(_n))return void re(_n);for(const Re of vt)switch(Re){case"content":const wn=fe.querySelector('main, [role="main"]');if(wn&&ze(wn))return void re(wn);break;case"heading":const it=fe.querySelector('h1, [role="heading"][aria-level="1"]');if(it&&ze(it))return void re(it);break;case"banner":const tn=fe.querySelector('header, [role="banner"]');if(tn&&ze(tn))return void re(tn);break;default:(0,a.p)(`Unrecognized focus manager priority value ${Re}`)}re(fe)}},be=ve=>new Promise((Me,fe)=>{(0,me.w)(()=>{Ye(ve),Le(ve).then(vt=>{vt.animation&&vt.animation.destroy(),ot(ve),Me(vt)},vt=>{ot(ve),fe(vt)})})}),Ye=ve=>{const Me=ve.enteringEl,fe=ve.leavingEl;He_saveViewFocus(fe),Kt(Me,fe,ve.direction),ve.showGoBack?Me.classList.add("can-go-back"):Me.classList.remove("can-go-back"),Kn(Me,!1),Me.style.setProperty("pointer-events","none"),fe&&(Kn(fe,!1),fe.style.setProperty("pointer-events","none"))},Le=function(){var ve=(0,g.A)(function*(Me){const fe=yield Ve(Me);return fe&&me.B.isBrowser?Ue(fe,Me):$t(Me)});return function(fe){return ve.apply(this,arguments)}}(),ot=ve=>{const Me=ve.enteringEl,fe=ve.leavingEl;Me.classList.remove("ion-page-invisible"),Me.style.removeProperty("pointer-events"),void 0!==fe&&(fe.classList.remove("ion-page-invisible"),fe.style.removeProperty("pointer-events")),He_setViewFocus(Me)},Ve=function(){var ve=(0,g.A)(function*(Me){return Me.leavingEl&&Me.animated&&0!==Me.duration?Me.animationBuilder?Me.animationBuilder:"ios"===Me.mode?(yield Promise.resolve().then(B.bind(B,9856))).iosTransitionAnimation:(yield Promise.resolve().then(B.bind(B,361))).mdTransitionAnimation:void 0});return function(fe){return ve.apply(this,arguments)}}(),Ue=function(){var ve=(0,g.A)(function*(Me,fe){yield nt(fe,!0);const vt=Me(fe.baseEl,fe);Mt(fe.enteringEl,fe.leavingEl);const _n=yield ct(vt,fe);return fe.progressCallback&&fe.progressCallback(void 0),_n&&$e(fe.enteringEl,fe.leavingEl),{hasCompleted:_n,animation:vt}});return function(fe,vt){return ve.apply(this,arguments)}}(),$t=function(){var ve=(0,g.A)(function*(Me){const fe=Me.enteringEl,vt=Me.leavingEl,_n=v.c.get("focusManagerPriority",!1);return yield nt(Me,_n),Mt(fe,vt),$e(fe,vt),{hasCompleted:!0}});return function(fe){return ve.apply(this,arguments)}}(),nt=function(){var ve=(0,g.A)(function*(Me,fe){(void 0!==Me.deepWait?Me.deepWait:fe)&&(yield Promise.all([fn(Me.enteringEl),fn(Me.leavingEl)])),yield xt(Me.viewIsReady,Me.enteringEl)});return function(fe,vt){return ve.apply(this,arguments)}}(),xt=function(){var ve=(0,g.A)(function*(Me,fe){Me&&(yield Me(fe))});return function(fe,vt){return ve.apply(this,arguments)}}(),ct=(ve,Me)=>{const fe=Me.progressCallback,vt=new Promise(_n=>{ve.onFinish(Re=>_n(1===Re))});return fe?(ve.progressStart(!0),fe(ve)):ve.play(),vt},Mt=(ve,Me)=>{Et(Me,Ce),Et(ve,"ionViewWillEnter")},$e=(ve,Me)=>{Et(ve,"ionViewDidEnter"),Et(Me,De)},Et=(ve,Me)=>{if(ve){const fe=new CustomEvent(Me,{bubbles:!1,cancelable:!1});ve.dispatchEvent(fe)}},cn=()=>new Promise(ve=>(0,Z.r)(()=>(0,Z.r)(()=>ve()))),fn=function(){var ve=(0,g.A)(function*(Me){const fe=Me;if(fe){if(null!=fe.componentOnReady){if(null!=(yield fe.componentOnReady()))return}else if(null!=fe.__registerHost)return void(yield new Promise(_n=>(0,Z.r)(_n)));yield Promise.all(Array.from(fe.children).map(fn))}});return function(fe){return ve.apply(this,arguments)}}(),Kn=(ve,Me)=>{Me?(ve.setAttribute("aria-hidden","true"),ve.classList.add("ion-page-hidden")):(ve.hidden=!1,ve.removeAttribute("aria-hidden"),ve.classList.remove("ion-page-hidden"))},Kt=(ve,Me,fe)=>{void 0!==ve&&(ve.style.zIndex="back"===fe?"99":"101"),void 0!==Me&&(Me.style.zIndex="100")},at=ve=>ve.classList.contains("ion-page")?ve:ve.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")||ve},4929:(vi,Vt,B)=>{"use strict";B.d(Vt,{a:()=>v,b:()=>me,p:()=>g});const g=(a,...Z)=>console.warn(`[Ionic Warning]: ${a}`,...Z),v=(a,...Z)=>console.error(`[Ionic Error]: ${a}`,...Z),me=(a,...Z)=>console.error(`<${a.tagName.toLowerCase()}> must be used inside ${Z.join(" or ")}.`)},8476:(vi,Vt,B)=>{"use strict";B.d(Vt,{d:()=>v,w:()=>g});const g=typeof window<"u"?window:void 0,v=typeof document<"u"?document:void 0},4921:(vi,Vt,B)=>{"use strict";B.d(Vt,{a:()=>re,b:()=>Kn,c:()=>me,i:()=>Kt});var g=B(8393);class v{constructor(){this.m=new Map}reset(ve){this.m=new Map(Object.entries(ve))}get(ve,Me){const fe=this.m.get(ve);return void 0!==fe?fe:Me}getBoolean(ve,Me=!1){const fe=this.m.get(ve);return void 0===fe?Me:"string"==typeof fe?"true"===fe:!!fe}getNumber(ve,Me){const fe=parseFloat(this.m.get(ve));return isNaN(fe)?void 0!==Me?Me:NaN:fe}set(ve,Me){this.m.set(ve,Me)}}const me=new v,De="ionic-persist-config",re=(at,ve)=>("string"==typeof at&&(ve=at,at=void 0),(at=>ze(at))(at).includes(ve)),ze=(at=window)=>{if(typeof at>"u")return[];at.Ionic=at.Ionic||{};let ve=at.Ionic.platforms;return null==ve&&(ve=at.Ionic.platforms=je(at),ve.forEach(Me=>at.document.documentElement.classList.add(`plt-${Me}`))),ve},je=at=>{const ve=me.get("platform");return Object.keys(cn).filter(Me=>{const fe=ve?.[Me];return"function"==typeof fe?fe(at):cn[Me](at)})},Ne=at=>!!($e(at,/iPad/i)||$e(at,/Macintosh/i)&&Ve(at)),be=at=>$e(at,/android|sink/i),Ve=at=>Et(at,"(any-pointer:coarse)"),$t=at=>nt(at)||xt(at),nt=at=>!!(at.cordova||at.phonegap||at.PhoneGap),xt=at=>{const ve=at.Capacitor;return!!ve?.isNative},$e=(at,ve)=>ve.test(at.navigator.userAgent),Et=(at,ve)=>{var Me;return null===(Me=at.matchMedia)||void 0===Me?void 0:Me.call(at,ve).matches},cn={ipad:Ne,iphone:at=>$e(at,/iPhone/i),ios:at=>$e(at,/iPhone|iPod/i)||Ne(at),android:be,phablet:at=>{const ve=at.innerWidth,Me=at.innerHeight,fe=Math.min(ve,Me),vt=Math.max(ve,Me);return fe>390&&fe<520&&vt>620&&vt<800},tablet:at=>{const ve=at.innerWidth,Me=at.innerHeight,fe=Math.min(ve,Me),vt=Math.max(ve,Me);return Ne(at)||(at=>be(at)&&!$e(at,/mobile/i))(at)||fe>460&&fe<820&&vt>780&&vt<1400},cordova:nt,capacitor:xt,electron:at=>$e(at,/electron/i),pwa:at=>{var ve;return!!(null!==(ve=at.matchMedia)&&void 0!==ve&&ve.call(at,"(display-mode: standalone)").matches||at.navigator.standalone)},mobile:Ve,mobileweb:at=>Ve(at)&&!$t(at),desktop:at=>!Ve(at),hybrid:$t};let fn;const Kn=at=>at&&(0,g.g)(at)||fn,Kt=(at={})=>{if(typeof window>"u")return;const ve=window.document,Me=window,fe=Me.Ionic=Me.Ionic||{},vt={};at._ael&&(vt.ael=at._ael),at._rel&&(vt.rel=at._rel),at._ce&&(vt.ce=at._ce),(0,g.a)(vt);const _n=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},(at=>{try{const ve=at.sessionStorage.getItem(De);return null!==ve?JSON.parse(ve):{}}catch{return{}}})(Me)),{persistConfig:!1}),fe.config),(at=>{const ve={};return at.location.search.slice(1).split("&").map(Me=>Me.split("=")).map(([Me,fe])=>{try{return[decodeURIComponent(Me),decodeURIComponent(fe)]}catch{return["",""]}}).filter(([Me])=>((at,ve)=>at.substr(0,ve.length)===ve)(Me,"ionic:")).map(([Me,fe])=>[Me.slice(6),fe]).forEach(([Me,fe])=>{ve[Me]=fe}),ve})(Me)),at);me.reset(_n),me.getBoolean("persistConfig")&&((at,ve)=>{try{at.sessionStorage.setItem(De,JSON.stringify(ve))}catch{return}})(Me,_n),ze(Me),fe.config=me,fe.mode=fn=me.get("mode",ve.documentElement.getAttribute("mode")||(re(Me,"ios")?"ios":"md")),me.set("mode",fn),ve.documentElement.setAttribute("mode",fn),ve.documentElement.classList.add(fn),me.getBoolean("_testing")&&me.set("animated",!1);const Re=it=>{var tn;return null===(tn=it.tagName)||void 0===tn?void 0:tn.startsWith("ION-")},wn=it=>["ios","md"].includes(it);(0,g.c)(it=>{for(;it;){const tn=it.mode||it.getAttribute("mode");if(tn){if(wn(tn))return tn;Re(it)&&console.warn('Invalid ionic mode: "'+tn+'", expected: "ios" or "md"')}it=it.parentElement}return fn})}},9856:(vi,Vt,B)=>{"use strict";B.r(Vt),B.d(Vt,{iosTransitionAnimation:()=>We,shadow:()=>Ce});var g=B(9986),v=B(1331);B(8476),B(4921),B(8393);const T=ht=>document.querySelector(`${ht}.ion-cloned-element`),Ce=ht=>ht.shadowRoot||ht,De=ht=>{const He="ION-TABS"===ht.tagName?ht:ht.querySelector("ion-tabs"),be="ion-content ion-header:not(.header-collapse-condense-inactive) ion-title.title-large";if(null!=He){const Ye=He.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");return null!=Ye?Ye.querySelector(be):null}return ht.querySelector(be)},Je=(ht,He)=>{const be="ION-TABS"===ht.tagName?ht:ht.querySelector("ion-tabs");let Ye=[];if(null!=be){const Le=be.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");null!=Le&&(Ye=Le.querySelectorAll("ion-buttons"))}else Ye=ht.querySelectorAll("ion-buttons");for(const Le of Ye){const ot=Le.closest("ion-header"),Ve=ot&&!ot.classList.contains("header-collapse-condense-inactive"),Ue=Le.querySelector("ion-back-button"),$t=Le.classList.contains("buttons-collapse");if(null!==Ue&&("start"===Le.slot||""===Le.slot)&&($t&&Ve&&He||!$t))return Ue}return null},ze=(ht,He,be,Ye,Le,ot,Ve,Ue,$t)=>{var nt,xt;const ct=He?`calc(100% - ${Le.right+4}px)`:Le.left-4+"px",Mt=He?"right":"left",$e=He?"left":"right",Et=He?"right":"left";let cn=1,fn=1,Kn=`scale(${fn})`;const Kt="scale(1)";if(ot&&Ve){const Se=(null===(nt=ot.textContent)||void 0===nt?void 0:nt.trim())===(null===(xt=Ue.textContent)||void 0===xt?void 0:xt.trim());cn=$t.width/Ve.width,fn=($t.height-Ne)/Ve.height,Kn=Se?`scale(${cn}, ${fn})`:`scale(${fn})`}const ve=Ce(Ye).querySelector("ion-icon").getBoundingClientRect(),Me=He?ve.width/2-(ve.right-Le.right)+"px":Le.left-ve.width/2+"px",fe=He?`-${window.innerWidth-Le.right}px`:`${Le.left}px`,vt=`${$t.top}px`,_n=`${Le.top}px`,it=be?[{offset:0,transform:`translate3d(${fe}, ${_n}, 0)`},{offset:1,transform:`translate3d(${Me}, ${vt}, 0)`}]:[{offset:0,transform:`translate3d(${Me}, ${vt}, 0)`},{offset:1,transform:`translate3d(${fe}, ${_n}, 0)`}],Jn=be?[{offset:0,opacity:1,transform:Kt},{offset:1,opacity:0,transform:Kn}]:[{offset:0,opacity:0,transform:Kn},{offset:1,opacity:1,transform:Kt}],ut=be?[{offset:0,opacity:1,transform:"scale(1)"},{offset:.2,opacity:0,transform:"scale(0.6)"},{offset:1,opacity:0,transform:"scale(0.6)"}]:[{offset:0,opacity:0,transform:"scale(0.6)"},{offset:.6,opacity:0,transform:"scale(0.6)"},{offset:1,opacity:1,transform:"scale(1)"}],nn=(0,g.c)(),ui=(0,g.c)(),pn=(0,g.c)(),An=T("ion-back-button"),Ct=Ce(An).querySelector(".button-text"),Qt=Ce(An).querySelector("ion-icon");An.text=Ye.text,An.mode=Ye.mode,An.icon=Ye.icon,An.color=Ye.color,An.disabled=Ye.disabled,An.style.setProperty("display","block"),An.style.setProperty("position","fixed"),ui.addElement(Qt),nn.addElement(Ct),pn.addElement(An),pn.beforeStyles({position:"absolute",top:"0px",[Et]:"0px"}).beforeAddWrite(()=>{Ye.style.setProperty("display","none"),An.style.setProperty(Mt,ct)}).afterAddWrite(()=>{Ye.style.setProperty("display",""),An.style.setProperty("display","none"),An.style.removeProperty(Mt)}).keyframes(it),nn.beforeStyles({"transform-origin":`${Mt} top`}).keyframes(Jn),ui.beforeStyles({"transform-origin":`${$e} center`}).keyframes(ut),ht.addAnimation([nn,ui,pn])},je=(ht,He,be,Ye,Le,ot,Ve,Ue,$t)=>{var nt,xt;const ct=He?"right":"left",Mt=He?`calc(100% - ${Le.right}px)`:`${Le.left}px`,Et=`${Le.top}px`;let fn=He?`-${window.innerWidth-Ve.right-8}px`:`${Ve.x+8}px`,Kn=.5;const Kt="scale(1)";let at=`scale(${Kn})`;if(Ue&&$t){fn=He?`-${window.innerWidth-$t.right-8}px`:$t.x-8+"px";const tn=(null===(nt=Ue.textContent)||void 0===nt?void 0:nt.trim())===(null===(xt=Ye.textContent)||void 0===xt?void 0:xt.trim());Kn=$t.height/(ot.height-Ne),at=tn?`scale(${$t.width/ot.width}, ${Kn})`:`scale(${Kn})`}const fe=Ve.top+Ve.height/2-Le.height*Kn/2+"px",Re=be?[{offset:0,opacity:0,transform:`translate3d(${fn}, ${fe}, 0) ${at}`},{offset:.1,opacity:0},{offset:1,opacity:1,transform:`translate3d(0px, ${Et}, 0) ${Kt}`}]:[{offset:0,opacity:.99,transform:`translate3d(0px, ${Et}, 0) ${Kt}`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${fn}, ${fe}, 0) ${at}`}],wn=T("ion-title"),it=(0,g.c)();wn.innerText=Ye.innerText,wn.size=Ye.size,wn.color=Ye.color,it.addElement(wn),it.beforeStyles({"transform-origin":`${ct} top`,height:`${Le.height}px`,display:"",position:"relative",[ct]:Mt}).beforeAddWrite(()=>{Ye.style.setProperty("opacity","0")}).afterAddWrite(()=>{Ye.style.setProperty("opacity",""),wn.style.setProperty("display","none")}).keyframes(Re),ht.addAnimation(it)},We=(ht,He)=>{var be;try{const Ye="cubic-bezier(0.32,0.72,0,1)",Le="opacity",ot="transform",Ve="0%",$t="rtl"===ht.ownerDocument.dir,nt=$t?"-99.5%":"99.5%",xt=$t?"33%":"-33%",ct=He.enteringEl,Mt=He.leavingEl,$e="back"===He.direction,Et=ct.querySelector(":scope > ion-content"),cn=ct.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *"),fn=ct.querySelectorAll(":scope > ion-header > ion-toolbar"),Kn=(0,g.c)(),Kt=(0,g.c)();if(Kn.addElement(ct).duration((null!==(be=He.duration)&&void 0!==be?be:0)||540).easing(He.easing||Ye).fill("both").beforeRemoveClass("ion-page-invisible"),Mt&&null!=ht){const fe=(0,g.c)();fe.addElement(ht),Kn.addAnimation(fe)}if(Et||0!==fn.length||0!==cn.length?(Kt.addElement(Et),Kt.addElement(cn)):Kt.addElement(ct.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),Kn.addAnimation(Kt),$e?Kt.beforeClearStyles([Le]).fromTo("transform",`translateX(${xt})`,`translateX(${Ve})`).fromTo(Le,.8,1):Kt.beforeClearStyles([Le]).fromTo("transform",`translateX(${nt})`,`translateX(${Ve})`),Et){const fe=Ce(Et).querySelector(".transition-effect");if(fe){const vt=fe.querySelector(".transition-cover"),_n=fe.querySelector(".transition-shadow"),Re=(0,g.c)(),wn=(0,g.c)(),it=(0,g.c)();Re.addElement(fe).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),wn.addElement(vt).beforeClearStyles([Le]).fromTo(Le,0,.1),it.addElement(_n).beforeClearStyles([Le]).fromTo(Le,.03,.7),Re.addAnimation([wn,it]),Kt.addAnimation([Re])}}const at=ct.querySelector("ion-header.header-collapse-condense"),{forward:ve,backward:Me}=((ht,He,be,Ye,Le)=>{const ot=Je(Ye,be),Ve=De(Le),Ue=De(Ye),$t=Je(Le,be),nt=null!==ot&&null!==Ve&&!be,xt=null!==Ue&&null!==$t&&be;if(nt){const ct=Ve.getBoundingClientRect(),Mt=ot.getBoundingClientRect(),$e=Ce(ot).querySelector(".button-text"),Et=$e?.getBoundingClientRect(),fn=Ce(Ve).querySelector(".toolbar-title").getBoundingClientRect();je(ht,He,be,Ve,ct,fn,Mt,$e,Et),ze(ht,He,be,ot,Mt,$e,Et,Ve,fn)}else if(xt){const ct=Ue.getBoundingClientRect(),Mt=$t.getBoundingClientRect(),$e=Ce($t).querySelector(".button-text"),Et=$e?.getBoundingClientRect(),fn=Ce(Ue).querySelector(".toolbar-title").getBoundingClientRect();je(ht,He,be,Ue,ct,fn,Mt,$e,Et),ze(ht,He,be,$t,Mt,$e,Et,Ue,fn)}return{forward:nt,backward:xt}})(Kn,$t,$e,ct,Mt);if(fn.forEach(fe=>{const vt=(0,g.c)();vt.addElement(fe),Kn.addAnimation(vt);const _n=(0,g.c)();_n.addElement(fe.querySelector("ion-title"));const Re=(0,g.c)(),wn=Array.from(fe.querySelectorAll("ion-buttons,[menuToggle]")),it=fe.closest("ion-header"),tn=it?.classList.contains("header-collapse-condense-inactive");let bn;bn=wn.filter($e?nn=>{const ui=nn.classList.contains("buttons-collapse");return ui&&!tn||!ui}:nn=>!nn.classList.contains("buttons-collapse")),Re.addElement(bn);const Jn=(0,g.c)();Jn.addElement(fe.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])"));const jn=(0,g.c)();jn.addElement(Ce(fe).querySelector(".toolbar-background"));const _i=(0,g.c)(),ut=fe.querySelector("ion-back-button");if(ut&&_i.addElement(ut),vt.addAnimation([_n,Re,Jn,jn,_i]),Re.fromTo(Le,.01,1),Jn.fromTo(Le,.01,1),$e)tn||_n.fromTo("transform",`translateX(${xt})`,`translateX(${Ve})`).fromTo(Le,.01,1),Jn.fromTo("transform",`translateX(${xt})`,`translateX(${Ve})`),_i.fromTo(Le,.01,1);else if(at||_n.fromTo("transform",`translateX(${nt})`,`translateX(${Ve})`).fromTo(Le,.01,1),Jn.fromTo("transform",`translateX(${nt})`,`translateX(${Ve})`),jn.beforeClearStyles([Le,"transform"]),it?.translucent?jn.fromTo("transform",$t?"translateX(-100%)":"translateX(100%)","translateX(0px)"):jn.fromTo(Le,.01,"var(--opacity)"),ve||_i.fromTo(Le,.01,1),ut&&!ve){const ui=(0,g.c)();ui.addElement(Ce(ut).querySelector(".button-text")).fromTo("transform",$t?"translateX(-100px)":"translateX(100px)","translateX(0px)"),vt.addAnimation(ui)}}),Mt){const fe=(0,g.c)(),vt=Mt.querySelector(":scope > ion-content"),_n=Mt.querySelectorAll(":scope > ion-header > ion-toolbar"),Re=Mt.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *");if(vt||0!==_n.length||0!==Re.length?(fe.addElement(vt),fe.addElement(Re)):fe.addElement(Mt.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),Kn.addAnimation(fe),$e){fe.beforeClearStyles([Le]).fromTo("transform",`translateX(${Ve})`,$t?"translateX(-100%)":"translateX(100%)");const wn=(0,v.g)(Mt);Kn.afterAddWrite(()=>{"normal"===Kn.getDirection()&&wn.style.setProperty("display","none")})}else fe.fromTo("transform",`translateX(${Ve})`,`translateX(${xt})`).fromTo(Le,1,.8);if(vt){const wn=Ce(vt).querySelector(".transition-effect");if(wn){const it=wn.querySelector(".transition-cover"),tn=wn.querySelector(".transition-shadow"),bn=(0,g.c)(),Jn=(0,g.c)(),jn=(0,g.c)();bn.addElement(wn).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),Jn.addElement(it).beforeClearStyles([Le]).fromTo(Le,.1,0),jn.addElement(tn).beforeClearStyles([Le]).fromTo(Le,.7,.03),bn.addAnimation([Jn,jn]),fe.addAnimation([bn])}}_n.forEach(wn=>{const it=(0,g.c)();it.addElement(wn);const tn=(0,g.c)();tn.addElement(wn.querySelector("ion-title"));const bn=(0,g.c)(),Jn=wn.querySelectorAll("ion-buttons,[menuToggle]"),jn=wn.closest("ion-header"),_i=jn?.classList.contains("header-collapse-condense-inactive"),ut=Array.from(Jn).filter(Qt=>{const Se=Qt.classList.contains("buttons-collapse");return Se&&!_i||!Se});bn.addElement(ut);const nn=(0,g.c)(),ui=wn.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])");ui.length>0&&nn.addElement(ui);const pn=(0,g.c)();pn.addElement(Ce(wn).querySelector(".toolbar-background"));const An=(0,g.c)(),Ct=wn.querySelector("ion-back-button");if(Ct&&An.addElement(Ct),it.addAnimation([tn,bn,nn,An,pn]),Kn.addAnimation(it),An.fromTo(Le,.99,0),bn.fromTo(Le,.99,0),nn.fromTo(Le,.99,0),$e){if(_i||tn.fromTo("transform",`translateX(${Ve})`,$t?"translateX(-100%)":"translateX(100%)").fromTo(Le,.99,0),nn.fromTo("transform",`translateX(${Ve})`,$t?"translateX(-100%)":"translateX(100%)"),pn.beforeClearStyles([Le,"transform"]),jn?.translucent?pn.fromTo("transform","translateX(0px)",$t?"translateX(-100%)":"translateX(100%)"):pn.fromTo(Le,"var(--opacity)",0),Ct&&!Me){const Se=(0,g.c)();Se.addElement(Ce(Ct).querySelector(".button-text")).fromTo("transform",`translateX(${Ve})`,`translateX(${($t?-124:124)+"px"})`),it.addAnimation(Se)}}else _i||tn.fromTo("transform",`translateX(${Ve})`,`translateX(${xt})`).fromTo(Le,.99,0).afterClearStyles([ot,Le]),nn.fromTo("transform",`translateX(${Ve})`,`translateX(${xt})`).afterClearStyles([ot,Le]),An.afterClearStyles([Le]),tn.afterClearStyles([Le]),bn.afterClearStyles([Le])})}return Kn}catch(Ye){throw Ye}},Ne=10},361:(vi,Vt,B)=>{"use strict";B.r(Vt),B.d(Vt,{mdTransitionAnimation:()=>ie});var g=B(9986),v=B(1331);B(8476),B(4921),B(8393);const ie=(T,Ce)=>{var De,Je,re;const We="back"===Ce.direction,ht=Ce.leavingEl,He=(0,v.g)(Ce.enteringEl),be=He.querySelector("ion-toolbar"),Ye=(0,g.c)();if(Ye.addElement(He).fill("both").beforeRemoveClass("ion-page-invisible"),We?Ye.duration((null!==(De=Ce.duration)&&void 0!==De?De:0)||200).easing("cubic-bezier(0.47,0,0.745,0.715)"):Ye.duration((null!==(Je=Ce.duration)&&void 0!==Je?Je:0)||280).easing("cubic-bezier(0.36,0.66,0.04,1)").fromTo("transform","translateY(40px)","translateY(0px)").fromTo("opacity",.01,1),be){const Le=(0,g.c)();Le.addElement(be),Ye.addAnimation(Le)}if(ht&&We){Ye.duration((null!==(re=Ce.duration)&&void 0!==re?re:0)||200).easing("cubic-bezier(0.47,0,0.745,0.715)");const Le=(0,g.c)();Le.addElement((0,v.g)(ht)).onFinish(ot=>{1===ot&&Le.elements.length>0&&Le.elements[0].style.setProperty("display","none")}).fromTo("transform","translateY(0px)","translateY(40px)").fromTo("opacity",1,0),Ye.addAnimation(Le)}return Ye}},1070:(vi,Vt,B)=>{"use strict";B.d(Vt,{B:()=>Jn,F:()=>An,G:()=>jn,O:()=>_i,a:()=>He,b:()=>be,c:()=>Ve,d:()=>ut,e:()=>nn,f:()=>ve,g:()=>fe,h:()=>Re,i:()=>it,j:()=>$t,k:()=>nt,l:()=>Ye,m:()=>Le,n:()=>Je,o:()=>Kt,q:()=>re,s:()=>bn,t:()=>Ue});var g=B(467),v=B(8476),me=B(4920),a=B(8669),Z=B(4921),ie=B(8621),T=B(1970),Ce=B(4929);const De='[tabindex]:not([tabindex^="-"]):not([hidden]):not([disabled]), input:not([type=hidden]):not([tabindex^="-"]):not([hidden]):not([disabled]), textarea:not([tabindex^="-"]):not([hidden]):not([disabled]), button:not([tabindex^="-"]):not([hidden]):not([disabled]), select:not([tabindex^="-"]):not([hidden]):not([disabled]), .ion-focusable:not([tabindex^="-"]):not([hidden]):not([disabled]), .ion-focusable[disabled="false"]:not([tabindex^="-"]):not([hidden])',Je=(Ct,Qt)=>{const Se=Ct.querySelector(De);ze(Se,Qt??Ct)},re=(Ct,Qt)=>{const Se=Array.from(Ct.querySelectorAll(De));ze(Se.length>0?Se[Se.length-1]:null,Qt??Ct)},ze=(Ct,Qt)=>{let Se=Ct;const Bt=Ct?.shadowRoot;Bt&&(Se=Bt.querySelector(De)||Ct),Se?(0,me.f)(Se):Qt.focus()};let je=0,We=0;const Ne=new WeakMap,ht=Ct=>({create:Qt=>xt(Ct,Qt),dismiss:(Qt,Se,Bt)=>cn(document,Qt,Se,Ct,Bt),getTop:()=>(0,g.A)(function*(){return Kt(document,Ct)})()}),He=ht("ion-alert"),be=ht("ion-action-sheet"),Ye=ht("ion-loading"),Le=ht("ion-modal"),Ve=ht("ion-popover"),Ue=ht("ion-toast"),$t=Ct=>{typeof document<"u"&&Et(document);const Qt=je++;Ct.overlayIndex=Qt},nt=Ct=>(Ct.hasAttribute("id")||(Ct.id="ion-overlay-"+ ++We),Ct.id),xt=(Ct,Qt)=>typeof window<"u"&&typeof window.customElements<"u"?window.customElements.whenDefined(Ct).then(()=>{const Se=document.createElement(Ct);return Se.classList.add("overlay-hidden"),Object.assign(Se,Object.assign(Object.assign({},Qt),{hasController:!0})),vt(document).appendChild(Se),new Promise(Bt=>(0,me.c)(Se,Bt))}):Promise.resolve(),Mt=(Ct,Qt)=>{let Se=Ct;const Bt=Ct?.shadowRoot;Bt&&(Se=Bt.querySelector(De)||Ct),Se?(0,me.f)(Se):Qt.focus()},Et=Ct=>{0===je&&(je=1,Ct.addEventListener("focus",Qt=>{((Ct,Qt)=>{const Se=Kt(Qt,"ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker-legacy,ion-popover"),Bt=Ct.target;Se&&Bt&&!Se.classList.contains(An)&&(Se.shadowRoot?(()=>{if(Se.contains(Bt))Se.lastFocus=Bt;else if("ION-TOAST"===Bt.tagName)Mt(Se.lastFocus,Se);else{const Ci=Se.lastFocus;Je(Se),Ci===Qt.activeElement&&re(Se),Se.lastFocus=Qt.activeElement}})():(()=>{if(Se===Bt)Se.lastFocus=void 0;else if("ION-TOAST"===Bt.tagName)Mt(Se.lastFocus,Se);else{const Ci=(0,me.g)(Se);if(!Ci.contains(Bt))return;const Oi=Ci.querySelector(".ion-overlay-wrapper");if(!Oi)return;if(Oi.contains(Bt)||Bt===Ci.querySelector("ion-backdrop"))Se.lastFocus=Bt;else{const ei=Se.lastFocus;Je(Oi,Se),ei===Qt.activeElement&&re(Oi,Se),Se.lastFocus=Qt.activeElement}}})())})(Qt,Ct)},!0),Ct.addEventListener("ionBackButton",Qt=>{const Se=Kt(Ct);Se?.backdropDismiss&&Qt.detail.register(a.OVERLAY_BACK_BUTTON_PRIORITY,()=>{Se.dismiss(void 0,Jn)})}),(0,a.shouldUseCloseWatcher)()||Ct.addEventListener("keydown",Qt=>{if("Escape"===Qt.key){const Se=Kt(Ct);Se?.backdropDismiss&&Se.dismiss(void 0,Jn)}}))},cn=(Ct,Qt,Se,Bt,Nt)=>{const Rn=Kt(Ct,Bt,Nt);return Rn?Rn.dismiss(Qt,Se):Promise.reject("overlay does not exist")},Kn=(Ct,Qt)=>((Ct,Qt)=>(void 0===Qt&&(Qt="ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker-legacy,ion-popover,ion-toast"),Array.from(Ct.querySelectorAll(Qt)).filter(Se=>Se.overlayIndex>0)))(Ct,Qt).filter(Se=>!(Ct=>Ct.classList.contains("overlay-hidden"))(Se)),Kt=(Ct,Qt,Se)=>{const Bt=Kn(Ct,Qt);return void 0===Se?Bt[Bt.length-1]:Bt.find(Nt=>Nt.id===Se)},at=(Ct=!1)=>{const Se=vt(document).querySelector("ion-router-outlet, ion-nav, #ion-view-container-root");Se&&(Ct?Se.setAttribute("aria-hidden","true"):Se.removeAttribute("aria-hidden"))},ve=function(){var Ct=(0,g.A)(function*(Qt,Se,Bt,Nt,Rn){var Ci,Oi;if(Qt.presented)return;at(!0),document.body.classList.add(T.B),ui(Qt.el),Qt.presented=!0,Qt.willPresent.emit(),null===(Ci=Qt.willPresentShorthand)||void 0===Ci||Ci.emit();const ei=(0,Z.b)(Qt),no=Qt.enterAnimation?Qt.enterAnimation:Z.c.get(Se,"ios"===ei?Bt:Nt);(yield _n(Qt,no,Qt.el,Rn))&&(Qt.didPresent.emit(),null===(Oi=Qt.didPresentShorthand)||void 0===Oi||Oi.emit()),"ION-TOAST"!==Qt.el.tagName&&Me(Qt.el),Qt.keyboardClose&&(null===document.activeElement||!Qt.el.contains(document.activeElement))&&Qt.el.focus(),Qt.el.removeAttribute("aria-hidden")});return function(Se,Bt,Nt,Rn,Ci){return Ct.apply(this,arguments)}}(),Me=function(){var Ct=(0,g.A)(function*(Qt){let Se=document.activeElement;if(!Se)return;const Bt=Se?.shadowRoot;Bt&&(Se=Bt.querySelector(De)||Se),yield Qt.onDidDismiss(),(null===document.activeElement||document.activeElement===document.body)&&Se.focus()});return function(Se){return Ct.apply(this,arguments)}}(),fe=function(){var Ct=(0,g.A)(function*(Qt,Se,Bt,Nt,Rn,Ci,Oi){var ei,no;if(!Qt.presented)return!1;void 0!==v.d&&1===Kn(v.d).length&&(at(!1),document.body.classList.remove(T.B)),Qt.presented=!1;try{Qt.el.style.setProperty("pointer-events","none"),Qt.willDismiss.emit({data:Se,role:Bt}),null===(ei=Qt.willDismissShorthand)||void 0===ei||ei.emit({data:Se,role:Bt});const mr=(0,Z.b)(Qt),$n=Qt.leaveAnimation?Qt.leaveAnimation:Z.c.get(Nt,"ios"===mr?Rn:Ci);Bt!==jn&&(yield _n(Qt,$n,Qt.el,Oi)),Qt.didDismiss.emit({data:Se,role:Bt}),null===(no=Qt.didDismissShorthand)||void 0===no||no.emit({data:Se,role:Bt}),(Ne.get(Qt)||[]).forEach(gn=>gn.destroy()),Ne.delete(Qt),Qt.el.classList.add("overlay-hidden"),Qt.el.style.removeProperty("pointer-events"),void 0!==Qt.el.lastFocus&&(Qt.el.lastFocus=void 0)}catch(mr){console.error(mr)}return Qt.el.remove(),pn(),!0});return function(Se,Bt,Nt,Rn,Ci,Oi,ei){return Ct.apply(this,arguments)}}(),vt=Ct=>Ct.querySelector("ion-app")||Ct.body,_n=function(){var Ct=(0,g.A)(function*(Qt,Se,Bt,Nt){Bt.classList.remove("overlay-hidden");const Ci=Se(Qt.el,Nt);(!Qt.animated||!Z.c.getBoolean("animated",!0))&&Ci.duration(0),Qt.keyboardClose&&Ci.beforeAddWrite(()=>{const ei=Bt.ownerDocument.activeElement;ei?.matches("input,ion-input, ion-textarea")&&ei.blur()});const Oi=Ne.get(Qt)||[];return Ne.set(Qt,[...Oi,Ci]),yield Ci.play(),!0});return function(Se,Bt,Nt,Rn){return Ct.apply(this,arguments)}}(),Re=(Ct,Qt)=>{let Se;const Bt=new Promise(Nt=>Se=Nt);return wn(Ct,Qt,Nt=>{Se(Nt.detail)}),Bt},wn=(Ct,Qt,Se)=>{const Bt=Nt=>{(0,me.b)(Ct,Qt,Bt),Se(Nt)};(0,me.a)(Ct,Qt,Bt)},it=Ct=>"cancel"===Ct||Ct===Jn,tn=Ct=>Ct(),bn=(Ct,Qt)=>{if("function"==typeof Ct)return Z.c.get("_zoneGate",tn)(()=>{try{return Ct(Qt)}catch(Bt){throw Bt}})},Jn="backdrop",jn="gesture",_i=39,ut=Ct=>{let Se,Qt=!1;const Bt=(0,ie.C)(),Nt=(Oi=!1)=>{if(Se&&!Oi)return{delegate:Se,inline:Qt};const{el:ei,hasController:no,delegate:mo}=Ct;return Qt=null!==ei.parentNode&&!no,Se=Qt?mo||Bt:mo,{inline:Qt,delegate:Se}};return{attachViewToDom:function(){var Oi=(0,g.A)(function*(ei){const{delegate:no}=Nt(!0);if(no)return yield no.attachViewToDom(Ct.el,ei);const{hasController:mo}=Ct;if(mo&&void 0!==ei)throw new Error("framework delegate is missing");return null});return function(no){return Oi.apply(this,arguments)}}(),removeViewFromDom:()=>{const{delegate:Oi}=Nt();Oi&&void 0!==Ct.el&&Oi.removeViewFromDom(Ct.el.parentElement,Ct.el)}}},nn=()=>{let Ct;const Qt=()=>{Ct&&(Ct(),Ct=void 0)};return{addClickListener:(Bt,Nt)=>{Qt();const Rn=void 0!==Nt?document.getElementById(Nt):null;Rn?Ct=((Oi,ei)=>{const no=()=>{ei.present()};return Oi.addEventListener("click",no),()=>{Oi.removeEventListener("click",no)}})(Rn,Bt):(0,Ce.p)(`A trigger element with the ID "${Nt}" was not found in the DOM. The trigger element must be in the DOM when the "trigger" property is set on an overlay component.`,Bt)},removeClickListener:Qt}},ui=Ct=>{var Qt;if(void 0===v.d)return;const Se=Kn(v.d);for(let Bt=Se.length-1;Bt>=0;Bt--){const Nt=Se[Bt],Rn=null!==(Qt=Se[Bt+1])&&void 0!==Qt?Qt:Ct;(Rn.hasAttribute("aria-hidden")||"ION-TOAST"!==Rn.tagName)&&Nt.setAttribute("aria-hidden","true")}},pn=()=>{if(void 0===v.d)return;const Ct=Kn(v.d);for(let Qt=Ct.length-1;Qt>=0;Qt--){const Se=Ct[Qt];if(Se.removeAttribute("aria-hidden"),"ION-TOAST"!==Se.tagName)break}},An="ion-disable-focus-trap"},8280:(vi,Vt,B)=>{"use strict";B.d(Vt,{o:()=>ze});var g=B(3953),v=B(5517),me=B(177),a=B(9465);function Z(je,We){if(1&je&&(g.j41(0,"ion-badge",7),g.EFF(1),g.k0s()),2&je){const Ne=g.XpG().$implicit;g.R7$(),g.SpI("",Ne.Quantity," x")}}function ie(je,We){if(1&je&&(g.j41(0,"strong"),g.EFF(1),g.k0s()),2&je){const Ne=g.XpG().$implicit;g.R7$(),g.SpI("",Ne.PowerKW," kW ")}}function T(je,We){if(1&je&&(g.j41(0,"div"),g.EFF(1),g.k0s()),2&je){const Ne=g.XpG().$implicit;g.R7$(),g.SpI("",null==Ne.CurrentType?null:Ne.CurrentType.Title," ")}}function Ce(je,We){if(1&je&&(g.j41(0,"span"),g.EFF(1),g.k0s()),2&je){const Ne=g.XpG().$implicit;g.R7$(),g.SpI("",Ne.Amps,"A ")}}function De(je,We){if(1&je&&(g.j41(0,"span"),g.EFF(1),g.k0s()),2&je){const Ne=g.XpG().$implicit;g.R7$(),g.SpI("",Ne.Voltage,"V ")}}function Je(je,We){if(1&je){const Ne=g.RV6();g.j41(0,"ion-col")(1,"ion-button",8),g.bIt("click",function(){g.eBV(Ne);const He=g.XpG().$implicit,be=g.XpG();return g.Njj(be.editConnection(He))}),g.nrm(2,"ion-icon",9),g.k0s(),g.nrm(3,"br"),g.j41(4,"ion-button",10),g.bIt("click",function(){g.eBV(Ne);const He=g.XpG().$implicit,be=g.XpG();return g.Njj(be.deleteConnection(He))}),g.nrm(5,"ion-icon",11),g.k0s()()}}function re(je,We){if(1&je&&(g.j41(0,"ion-row")(1,"ion-col")(2,"ion-row")(3,"ion-col",1),g.nrm(4,"div",2),g.DNE(5,Z,2,1,"ion-badge",3),g.j41(6,"div",4),g.EFF(7),g.k0s()(),g.j41(8,"ion-col")(9,"ion-row")(10,"ion-col")(11,"ion-note")(12,"div")(13,"strong",5),g.EFF(14),g.k0s()(),g.DNE(15,ie,2,1,"strong",6)(16,T,2,1,"div",6),g.k0s(),g.j41(17,"ion-note"),g.DNE(18,Ce,2,1,"span",6)(19,De,2,1,"span",6),g.k0s()()(),g.j41(20,"ion-row")(21,"ion-col",4),g.EFF(22),g.k0s(),g.j41(23,"ion-col",4),g.EFF(24),g.k0s()()(),g.DNE(25,Je,6,0,"ion-col",6),g.k0s()()()),2&je){const Ne=We.$implicit,ht=g.XpG();g.R7$(4),g.xc7("mask-image","url("+ht.getConnectorTypeIcon(Ne.ConnectionTypeID)+")"),g.R7$(),g.Y8G("ngIf",Ne.Quantity),g.R7$(2),g.JRh(null==Ne.StatusType?null:Ne.StatusType.Title),g.R7$(6),g.FS9("title",null==Ne.ConnectionType?null:Ne.ConnectionType.FormalName),g.R7$(),g.SpI("",null==Ne.ConnectionType?null:Ne.ConnectionType.Title," "),g.R7$(),g.Y8G("ngIf",Ne.PowerKW),g.R7$(),g.Y8G("ngIf",Ne.CurrentTypeID),g.R7$(2),g.Y8G("ngIf",Ne.Amps),g.R7$(),g.Y8G("ngIf",Ne.Voltage),g.R7$(3),g.JRh(Ne.Reference),g.R7$(2),g.JRh(Ne.Comments),g.R7$(),g.Y8G("ngIf",ht.enableEdit)}}let ze=(()=>{class je{item;enableEdit=!1;onEdit=new g.bkB;onDelete=new g.bkB;constructor(){}ngOnInit(){}editConnection(Ne){this.onEdit.emit(Ne)}deleteConnection(Ne){this.onDelete.emit(Ne)}getConnectorTypeIcon(Ne){return v.A.getIconForConnector(Ne)}static \u0275fac=function(ht){return new(ht||je)};static \u0275cmp=g.VBU({type:je,selectors:[["app-equipment-details"]],inputs:{item:"item",enableEdit:"enableEdit"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],["size","3"],[1,"connector-icon"],["color","primary",4,"ngIf"],[1,"info"],[3,"title"],[4,"ngIf"],["color","primary"],["size","small","color","secondary",3,"click"],["name","create","slot","icon-only"],["size","small","color","danger",3,"click"],["name","trash","slot","icon-only"]],template:function(ht,He){1&ht&&(g.j41(0,"ion-grid"),g.DNE(1,re,26,13,"ion-row",0),g.k0s()),2&ht&&(g.R7$(),g.Y8G("ngForOf",He.item.Connections))},dependencies:[me.Sq,me.bT,a.In,a.Jm,a.hU,a.lO,a.iq,a.JI,a.ln],styles:[".connector-icon[_ngcontent-%COMP%]{mask-size:100%;mask-repeat:no-repeat;mask-position:center;width:64px;height:64px;background-color:currentColor;mask-image:none}"]})}return je})()},6509:(vi,Vt,B)=>{"use strict";B.d(Vt,{O:()=>ht});var g=B(467),v=B(3953),me=B(3371),a=B(177),Z=B(9465),ie=B(9417);function T(He,be){if(1&He&&(v.j41(0,"ion-select-option",5),v.EFF(1),v.k0s()),2&He){const Ye=be.$implicit;v.Y8G("value",Ye.ID),v.R7$(),v.JRh(Ye.Title)}}function Ce(He,be){1&He&&(v.j41(0,"ion-select-option",6),v.EFF(1,"Other..."),v.k0s())}function De(He,be){if(1&He){const Ye=v.RV6();v.j41(0,"ion-item")(1,"ion-label",1),v.EFF(2,"Network Operator"),v.k0s(),v.j41(3,"ion-select",2),v.mxI("ngModelChange",function(ot){v.eBV(Ye);const Ve=v.XpG();return v.DH7(Ve.operatorId,ot)||(Ve.operatorId=ot),v.Njj(ot)}),v.bIt("ionChange",function(){v.eBV(Ye);const ot=v.XpG();return v.Njj(ot.onOperatorChange())}),v.DNE(4,T,2,2,"ion-select-option",3)(5,Ce,2,0,"ion-select-option",4),v.k0s()()}if(2&He){const Ye=v.XpG();v.R7$(3),v.R50("ngModel",Ye.operatorId),v.R7$(),v.Y8G("ngForOf",Ye.operators),v.R7$(),v.Y8G("ngIf",Ye.useFilteredOperators)}}function Je(He,be){if(1&He){const Ye=v.RV6();v.j41(0,"ion-item")(1,"ion-searchbar",7),v.bIt("ionCancel",function(){v.eBV(Ye);const ot=v.XpG();return v.Njj(ot.cancelOperatorLookup())}),v.mxI("ngModelChange",function(ot){v.eBV(Ye);const Ve=v.XpG();return v.DH7(Ve.operatorSearchKeyword,ot)||(Ve.operatorSearchKeyword=ot),v.Njj(ot)}),v.bIt("ionInput",function(ot){v.eBV(Ye);const Ve=v.XpG();return v.Njj(Ve.searchOperators(ot))}),v.k0s()()}if(2&He){const Ye=v.XpG();v.R7$(),v.R50("ngModel",Ye.operatorSearchKeyword)}}function re(He,be){if(1&He){const Ye=v.RV6();v.j41(0,"ion-item",9),v.bIt("click",function(){const ot=v.eBV(Ye).$implicit,Ve=v.XpG(2);return v.Njj(Ve.onOperatorChange(ot))}),v.j41(1,"ion-avatar",10),v.nrm(2,"ion-icon",11),v.k0s(),v.j41(3,"ion-label")(4,"p"),v.EFF(5),v.k0s(),v.j41(6,"p"),v.EFF(7),v.k0s()()()}if(2&He){const Ye=be.$implicit;v.R7$(5),v.JRh(Ye.Title),v.R7$(2),v.JRh(Ye.WebsiteURL)}}function ze(He,be){if(1&He&&(v.qex(0),v.j41(1,"ion-list"),v.DNE(2,re,8,2,"ion-item",8),v.k0s(),v.bVm()),2&He){const Ye=v.XpG();v.R7$(2),v.Y8G("ngForOf",Ye.operatorSearchResults)}}function je(He,be){if(1&He){const Ye=v.RV6();v.qex(0),v.j41(1,"ion-item")(2,"ion-avatar",10),v.nrm(3,"ion-icon",12),v.k0s(),v.j41(4,"ion-label")(5,"p"),v.EFF(6),v.k0s(),v.j41(7,"p"),v.EFF(8),v.k0s(),v.j41(9,"ion-button",9),v.bIt("click",function(){v.eBV(Ye);const ot=v.XpG();return v.Njj(ot.selectedOperator=null)}),v.EFF(10,"Change"),v.k0s()()(),v.bVm()}if(2&He){const Ye=v.XpG();v.R7$(6),v.JRh(Ye.selectedOperator.Title),v.R7$(2),v.JRh(Ye.selectedOperator.WebsiteURL)}}function We(He,be){if(1&He){const Ye=v.RV6();v.j41(0,"ion-chip")(1,"ion-label"),v.EFF(2),v.k0s(),v.j41(3,"ion-icon",14),v.bIt("click",function(){const ot=v.eBV(Ye).$implicit,Ve=v.XpG(2);return v.Njj(Ve.removeOperator(ot))}),v.k0s()()}if(2&He){const Ye=be.$implicit,Le=v.XpG(2);v.R7$(2),v.JRh(Le.getOperatorInfo(Ye).Title)}}function Ne(He,be){if(1&He&&(v.qex(0),v.DNE(1,We,4,1,"ion-chip",13),v.bVm()),2&He){const Ye=v.XpG();v.R7$(),v.Y8G("ngForOf",Ye.operatorList)}}let ht=(()=>{class He{referenceDataManager;changeDetector;operatorId=null;operatorList=null;mode="single";useFilteredOperators=null;operatorChanged=new v.bkB;operatorRemoved=new v.bkB;operatorCache=[];operatorSearchResults=[];operatorSearchKeyword="";selectedOperator=null;get operators(){return this.referenceDataManager.getNetworkOperators(this.useFilteredOperators)}constructor(Ye,Le){this.referenceDataManager=Ye,this.changeDetector=Le}ngOnInit(){this.operatorCache=this.referenceDataManager.getNetworkOperators(!1),null!=this.operatorId&&(this.selectedOperator=this.operatorCache.find(Ye=>Ye.ID==this.operatorId))}searchOperators(){this.operatorSearchResults=[],0!=this.operatorSearchKeyword.length&&(this.operatorSearchResults=this.operatorCache?this.operatorCache.filter(Ye=>Ye.Title.toLowerCase().startsWith(this.operatorSearchKeyword.toLowerCase())||Ye.Title.toLowerCase().startsWith("("+this.operatorSearchKeyword.toLowerCase())).slice(0,10):[])}getOperatorInfo(Ye){if(this.operatorCache)return this.operatorCache.find(Le=>Le.ID==Ye)}onOperatorChange(Ye=null){var Le=this;return(0,g.A)(function*(){null==Ye&&Le.operatorId&&(Ye=Le.operatorCache.find(ot=>ot.ID==Le.operatorId)),null!=Ye&&(Le.operatorSearchResults=[],Le.selectedOperator=Ye,Le.operatorId=Ye.ID),Le.operatorId?(Le.operatorChanged.emit(Le.selectedOperator),"single"!=Le.mode&&(Le.selectedOperator=null,Le.operatorSearchKeyword="")):Le.useFilteredOperators=!1})()}removeOperator(Ye){var Le=this;return(0,g.A)(function*(){Le.operatorId=null,Le.operatorRemoved.emit(Ye)})()}cancelOperatorLookup(){this.selectedOperator=null}static \u0275fac=function(Le){return new(Le||He)(v.rXU(me.r),v.rXU(v.gRc))};static \u0275cmp=v.VBU({type:He,selectors:[["app-operator-lookup"]],inputs:{operatorId:"operatorId",operatorList:"operatorList",mode:"mode",useFilteredOperators:"useFilteredOperators"},outputs:{operatorChanged:"operatorChanged",operatorRemoved:"operatorRemoved"},decls:5,vars:5,consts:[[4,"ngIf"],["position","floating"],[3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["value","",4,"ngIf"],[3,"value"],["value",""],["placeholder","Search network operators","showCancelButton","focus","autocomplete","on",3,"ionCancel","ngModelChange","ionInput","ngModel"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["item-left",""],["name","card"],["name","locate"],[4,"ngFor","ngForOf"],["name","close-circle",3,"click"]],template:function(Le,ot){1&Le&&v.DNE(0,De,6,3,"ion-item",0)(1,Je,2,1,"ion-item",0)(2,ze,3,1,"ng-container",0)(3,je,11,2,"ng-container",0)(4,Ne,2,1,"ng-container",0),2&Le&&(v.Y8G("ngIf",ot.useFilteredOperators&&!ot.selectedOperator),v.R7$(),v.Y8G("ngIf",!ot.useFilteredOperators&&!ot.selectedOperator),v.R7$(),v.Y8G("ngIf",ot.operatorSearchResults.length>0),v.R7$(),v.Y8G("ngIf",null!=ot.selectedOperator),v.R7$(),v.Y8G("ngIf",(null==ot.operatorList?null:ot.operatorList.length)>0))},dependencies:[a.Sq,a.bT,Z.mC,Z.Jm,Z.ZB,Z.iq,Z.uz,Z.he,Z.nf,Z.S1,Z.Nm,Z.Ip,Z.Je,Z.Gw,ie.BC,ie.vS]})}return He})()},4390:(vi,Vt,B)=>{"use strict";B.d(Vt,{Q:()=>Ne});var g=B(467),v=B(3118),me=B(5390),a=B(3953),Z=B(184),ie=B(9394),T=B(3656),Ce=B(9465),De=B(1626),Je=B(3458),re=B(177);function ze(ht,He){1&ht&&(a.j41(0,"div"),a.nrm(1,"ion-spinner"),a.k0s())}function je(ht,He){if(1&ht){const be=a.RV6();a.j41(0,"ion-item",5),a.bIt("click",function(){const Le=a.eBV(be).$implicit,ot=a.XpG(2);return a.Njj(ot.placeSelected(Le))}),a.j41(1,"ion-avatar",6),a.nrm(2,"ion-icon",7),a.k0s(),a.j41(3,"ion-label")(4,"p"),a.EFF(5),a.k0s()()()}if(2&ht){const be=He.$implicit;a.R7$(5),a.JRh(be.Address)}}function We(ht,He){if(1&ht&&(a.j41(0,"div",1),a.DNE(1,ze,2,0,"div",2),a.j41(2,"ion-list"),a.DNE(3,je,6,1,"ion-item",3),a.j41(4,"ion-item")(5,"p",4),a.EFF(6),a.k0s()()()()),2&ht){const be=a.XpG();a.R7$(),a.Y8G("ngIf",be.searchInProgress),a.R7$(2),a.Y8G("ngForOf",be.placeList),a.R7$(3),a.SpI(" ",be.placeAttribution," ")}}let Ne=(()=>{class ht{logging;changeDetector;platform;http;events;placeSearchType;placeList;searchInProgress=!1;searchKeyword;placeSearchFocused;placeSearchActive=!1;placeAttribution="";selectedPlace;placeChanged=new a.bkB;mapService;constructor(be,Ye,Le,ot,Ve){this.logging=be,this.changeDetector=Ye,this.platform=Le,this.http=ot,this.events=Ve,this.searchKeyword="",this.searchInProgress=!1,this.mapService=new Z.$(Ve,be,ot)}ngOnInit(){var be=this;return(0,g.A)(function*(){yield be.platform.ready(),be.mapService.initAPI()})()}onSearchFocus(){this.placeSearchFocused=!0}onSearchBlur(){this.placeSearchFocused=!1}onSearchCancel(){}getPlacesAutoComplete(be,Ye){var Le=this;return(0,g.A)(function*(){Le.placeSearchType=Ye;let ot=be.target.value;if(ot&&ot.length>3){Le.logging.log("Starting place lookup for:"+ot),Le.placeSearchActive=!0,Le.searchInProgress=!0,Le.searchInProgress=!1,Le.placeSearchActive=!0;try{Le.placeList=yield Le.mapService.placeSearch(ot),Le.placeList&&Le.placeList.length>0&&(Le.placeAttribution=Le.placeList[0].Attribution);let Ve=yield Le.detectAlternativeSearchResultType(ot);Ve&&Le.placeList.unshift(Ve)}catch{}Le.searchInProgress=!1,Le.placeSearchActive=!0}else Le.searchInProgress=!1,Le.placeSearchActive=!1})()}ConvertDMSToDD(be,Ye,Le,ot){var Ve=Number(be)+Number(Ye)/60+Number(Le)/3600;return("S"==ot||"W"==ot)&&(Ve*=-1),Ve}ParseDMS(be){try{var Ye=be.split(/[^\d\w\.]+/),Le=this.ConvertDMSToDD(Ye[0],Ye[1],Ye[2],Ye[3]),ot=this.ConvertDMSToDD(Ye[4],Ye[5],Ye[6],Ye[7]);return new ie.cW(Le,ot)}catch{return null}}detectAlternativeSearchResultType(be){var Ye=this;return(0,g.A)(function*(){if((be=be.trim()).startsWith("OCM-")&&(be=be.replace("OCM-","")),Number.isInteger(Number(be))){let Ve=new me.J;return Ve.Title="Go to OCM ID",Ve.Address="OCM-"+be,Ve.ReferenceID="OCM-"+be,Ve}let Le=be.match(/^\s*((lat|latitude)(:)?)?\s*((\-)?[0-9]+\.[0-9]+)\s*(,?)\s*((lng|lon|longitude)(:)?)?\s*((\-)?[0-9]+\.[0-9]+)\s*$/gi);if(Le&&Le.length>0){const Ue=(""+be.match(/((\-)?[0-9]+\.[0-9]+)+/g)).split(",");let $t=new me.J;return $t.Title="Go to Lat/Lng",$t.Address="Lat:"+Ue[0]+", Lng:"+Ue[1],$t.Location=new ie.cW(parseFloat(Ue[0]),parseFloat(Ue[1])),$t}var ot=Ye.ParseDMS(be);if(!ot||isNaN(ot.latitude)||isNaN(ot.longitude))return null;{let Ve=new me.J;return Ve.Title="Go to Lat/Lng",Ve.Address="Lat:"+ot.latitude+", Lng:"+ot.longitude,Ve.Location=ot,Ve}})()}placeSelected(be){this.logging.log("Looking up place details:"+be.Title+"::"+be.ReferenceID),this.selectedPlace=be,this.placeChanged.emit(be),this.placeSearchActive=!1}static \u0275fac=function(Ye){return new(Ye||ht)(a.rXU(v.y),a.rXU(a.gRc),a.rXU(T.OD),a.rXU(De.Qq),a.rXU(Je.s))};static \u0275cmp=a.VBU({type:ht,selectors:[["place-search"]],inputs:{searchKeyword:"searchKeyword"},outputs:{selectedPlace:"selectedPlace",placeChanged:"placeChanged"},decls:1,vars:1,consts:[["class","place-search",4,"ngIf"],[1,"place-search"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],[1,"place-attribution"],[3,"click"],["item-left",""],["name","locate"]],template:function(Ye,Le){1&Ye&&a.DNE(0,We,7,3,"div",0),2&Ye&&a.Y8G("ngIf",Le.placeSearchActive)},dependencies:[re.Sq,re.bT,Ce.mC,Ce.iq,Ce.uz,Ce.he,Ce.nf,Ce.w2],styles:[".place-search[_ngcontent-%COMP%]{position:absolute;z-index:1000}.place-attribution[_ngcontent-%COMP%]{font-size:9px;color:#dcdcdc;max-width:100%}"]})}return ht})()},7192:(vi,Vt,B)=>{"use strict";B.d(Vt,{k:()=>Ce});var g=B(3953),v=B(5517),me=B(177),a=B(9465);function Z(De,Je){if(1&De){const re=g.RV6();g.j41(0,"ion-button",5),g.bIt("click",function(){g.eBV(re);const je=g.XpG().$implicit,We=g.XpG();return g.Njj(We.onCopyCommand(je))}),g.EFF(1,"Copy"),g.k0s()}}function ie(De,Je){if(1&De){const re=g.RV6();g.j41(0,"ion-button",5),g.bIt("click",function(){g.eBV(re);const je=g.XpG().$implicit,We=g.XpG();return g.Njj(We.onEditCommand(je))}),g.EFF(1,"Edit"),g.k0s()}}function T(De,Je){if(1&De&&(g.j41(0,"ion-item",1)(1,"ion-grid")(2,"ion-row")(3,"ion-col"),g.EFF(4),g.k0s()(),g.j41(5,"ion-row")(6,"ion-col",2)(7,"p"),g.nrm(8,"img",3),g.k0s(),g.j41(9,"ion-note"),g.EFF(10),g.k0s(),g.DNE(11,Z,2,0,"ion-button",4)(12,ie,2,0,"ion-button",4),g.k0s(),g.j41(13,"ion-col")(14,"ion-row")(15,"ion-col")(16,"p"),g.EFF(17),g.k0s(),g.j41(18,"ion-note"),g.EFF(19),g.k0s()()(),g.j41(20,"ion-row")(21,"ion-col"),g.EFF(22),g.k0s(),g.j41(23,"ion-col"),g.EFF(24),g.k0s()()()()()()),2&De){const re=Je.$implicit,ze=g.XpG();g.R7$(4),g.SpI(" ",re.AddressInfo.Title," "),g.R7$(4),g.Y8G("src",ze.getIconForPOI(re),g.B4B),g.R7$(2),g.SpI(" ",ze.getFormattedDistance(re)," "),g.R7$(),g.Y8G("ngIf",ze.enableCopyOption),g.R7$(),g.Y8G("ngIf",ze.enableEditOption),g.R7$(5),g.SpI(" ",ze.getFormattedAddress(re)," "),g.R7$(2),g.SpI(" ",ze.getFormattedConnectorList(re)," "),g.R7$(3),g.SpI(" ",null==re.UsageType?null:re.UsageType.Title," "),g.R7$(2),g.SpI(" ",null==re.OperatorInfo?null:re.OperatorInfo.Title," ")}}let Ce=(()=>{class De{enableCopyOption=!1;enableEditOption=!1;poiList=[];onCopy=new g.bkB;onEdit=new g.bkB;constructor(){}ngOnInit(){}onCopyCommand(re){this.onCopy.emit(re)}onEditCommand(re){this.onEdit.emit(re)}getFormattedAddress(re){let ze="";return ze+=re.AddressInfo.Title!=re.AddressInfo.AddressLine1?re.AddressInfo.Title:re.AddressInfo.Town,ze}getFormattedConnectorList(re){if(!re.Connections)return;let ze=[];for(let je of re.Connections)null!=je.ConnectionType&&(ze.find(We=>We==je.ConnectionType.Title)||ze.push(je.ConnectionType.Title));return ze.join(", ")}getIconForPOI(re){return v.A.getIconForPOI(re)}getFormattedDistance(re){return v.A.getFormattedDistance(re)}static \u0275fac=function(ze){return new(ze||De)};static \u0275cmp=g.VBU({type:De,selectors:[["app-poi-list"]],inputs:{enableCopyOption:"enableCopyOption",enableEditOption:"enableEditOption",poiList:"poiList"},outputs:{onCopy:"onCopy",onEdit:"onEdit"},decls:2,vars:1,consts:[["style","max-width:400px;",4,"ngFor","ngForOf"],[2,"max-width","400px"],["size","3"],[2,"width","24px",3,"src"],["size","small",3,"click",4,"ngIf"],["size","small",3,"click"]],template:function(ze,je){1&ze&&(g.j41(0,"ion-list"),g.DNE(1,T,25,9,"ion-item",0),g.k0s()),2&ze&&(g.R7$(),g.Y8G("ngForOf",je.poiList))},dependencies:[me.Sq,me.bT,a.Jm,a.hU,a.lO,a.uz,a.nf,a.JI,a.ln]})}return De})()},7606:(vi,Vt,B)=>{"use strict";B.d(Vt,{F:()=>ie});var g=B(177),v=B(9465),me=B(9417),a=B(4842),Z=B(3953);let ie=(()=>{class T{static \u0275fac=function(Je){return new(Je||T)};static \u0275mod=Z.$C({type:T});static \u0275inj=Z.G2t({providers:[g.QX],imports:[g.MD,v.bv,me.YN,a.h]})}return T})()},9025:(vi,Vt,B)=>{"use strict";B.d(Vt,{o:()=>v});var g=B(5312);class v{baseURL;loginProviderRedirectBaseURL;loginProviderRedirectURL;enableLiveMapQuerying;googleMapsAPIKey;enableStaticMaps;constructor(){this.baseURL="https://map.openchargemap.io",this.loginProviderRedirectBaseURL="https://openchargemap.org/site/loginprovider/?_mode=silent&_forceLogin=true&_redirectURL=",this.loginProviderRedirectURL=this.loginProviderRedirectBaseURL+this.baseURL,this.enableLiveMapQuerying=!0,this.googleMapsAPIKey=g.c.googleMapsKey,this.enableStaticMaps=g.c.enableStaticMaps}}},5517:(vi,Vt,B)=>{"use strict";B.d(Vt,{A:()=>v});var g=B(5312);let v=(()=>{class me{static isFeatureEnabled(Z){return!!g.c.enabledFeatures.find(ie=>ie===Z)}static getClientHeight(){const Z=document.body,ie=document.documentElement;return Math.max(Z.scrollHeight,Z.offsetHeight,ie.clientHeight,ie.scrollHeight,ie.offsetHeight)}static getClientWidth(){const Z=document.body,ie=document.documentElement;return Math.max(Z.scrollWidth,Z.offsetWidth,ie.clientWidth,ie.scrollWidth,ie.offsetWidth)}static getMaxLevelOfPOI(Z){let ie=0;if(150==Z.StatusTypeID)return 0;if(null!=Z.Connections)for(let T=0;T<Z.Connections.length;T++)null!=Z.Connections[T].Level&&Z.Connections[T].Level.ID>ie&&(ie=Z.Connections[T].Level.ID);return 4===ie&&(ie=2),ie>4&&(ie=3),ie}static getIconForPOI(Z){let T="assets/images/icons/map/level"+me.getMaxLevelOfPOI(Z);return null!=Z.UsageType&&Z.UsageType.Title.indexOf("Private")>-1?T+="_private":T+=null!=Z.StatusType&&!0!==Z.StatusType.IsOperational?"_nonoperational":"_operational",T+="_icon.png",T}static getColorForPOI(Z){const ie=me.getMaxLevelOfPOI(Z);let T="#c0c0c0";return null!=Z.UsageType&&Z.UsageType.Title.indexOf("Private")>-1?T="#FF0000":null!=Z.StatusType&&!0!==Z.StatusType.IsOperational?T="#a0a0a0":2==ie?T="#72EB0D":3==ie&&(T="#EB800D"),T}static getIconForConnector(Z){let ie="assets/images/icons/connectors/";return ie+=1===Z?"Type1_J1772.svg":2===Z?"Chademo_type4.svg":25===Z?"Type2_socket.svg":32===Z?"Type1_CCS.svg":33===Z?"Type2_CCS.svg":1036===Z?"Type2_tethered.svg":26===Z?"Type3c.svg":28===Z?"schuko.svg":"Unknown.svg",ie}static getFormattedDistance(Z){return Z&&Z.AddressInfo&&Z.AddressInfo.Distance?Z.AddressInfo.Distance.toFixed(1)+" "+(1===Z.AddressInfo.DistanceUnit?"km":"miles"):""}static fixJSONDate(Z){if(null==Z)return null;if(0==Z.indexOf("/")){let T=/Date\(([^)]+)\)/.exec(Z);Z=new Date(parseFloat(T[1]))}else Z=new Date(Z);return Z}static formatMapLinkFromPosition(Z,ie,T,Ce,De){return'<a href="https://maps.google.com/maps?saddr='+ie+","+T+"&daddr="+Z.AddressInfo.Latitude+","+Z.AddressInfo.Longitude+'">Map ('+Math.ceil(Ce)+" "+De+")</a>"}static formatSystemWebLink(Z,ie){return"<a href='#' onclick=\"window.open('"+Z+"', '_system');return false;\">"+ie+"</a>"}static formatMapLink(Z,ie,T){return T?device&&"WinCE"==device.platform?this.formatSystemWebLink("maps:"+Z.AddressInfo.Latitude+","+Z.AddressInfo.Longitude,ie):device&&"iOS"===device.platform?this.formatSystemWebLink("https://maps.apple.com/?q="+Z.AddressInfo.Latitude+","+Z.AddressInfo.Longitude,ie):this.formatSystemWebLink("https://maps.google.com/maps?q="+Z.AddressInfo.Latitude+","+Z.AddressInfo.Longitude,ie):'<a target="_blank"  href="https://maps.google.com/maps?q='+Z.AddressInfo.Latitude+","+Z.AddressInfo.Longitude+'">'+ie+"</a>"}static formatURL(Z,ie=null){return null==Z||""==Z?"":(-1==Z.indexOf("http")&&(Z="https://"+Z),'<a target="_blank" href="'+Z+'">'+(ie??Z)+"</a>")}static formatPOIAddress=function(Z,ie=!0){let T="";return T=ie?""+this.formatTextField(Z.AddressInfo.AddressLine1)+this.formatTextField(Z.AddressInfo.AddressLine2)+this.formatTextField(Z.AddressInfo.Town)+this.formatTextField(Z.AddressInfo.StateOrProvince)+this.formatTextField(Z.AddressInfo.Postcode)+(null!=Z.AddressInfo.Country?this.formatTextField(Z.AddressInfo.Country.Title):""):this.formatStringArray([Z.AddressInfo.AddressLine1,Z.AddressInfo.AddressLine2,Z.AddressInfo.Town,Z.AddressInfo.StateOrProvince,Z.AddressInfo.Postcode,null!=Z.AddressInfo.Country?Z.AddressInfo.Country.Title:""]),T};static formatStringArray=function(Z,ie=", "){if(null==Z)return"";let T="";for(let Ce=0;Ce<Z.length;Ce++)null!=Z[Ce]&&""!=Z[Ce].trim()&&(T+=Ce==Z.length-1?Z[Ce]:Z[Ce]+ie);return T};static formatString(Z){return null==Z?"":Z.toString()}static formatTextField(Z,ie=null,T=!1,Ce=!1,De=null){if(null==Z||""==Z||null==Z)return"";let Je=(null!=ie?"<strong class='ocm-label' "+(null!=De?"data-localize='"+De+"' ":"")+">"+ie+"</strong>: ":"")+(T?"<br/>":"")+Z.toString().replace("\n","<br/>")+"<br/>";return 1==Ce&&(Je="<p>"+Je+"</p>"),Je}static formatEmailAddress(Z){return null!=Z&&null!=Z&&""!=Z?"<i class='fa fa-envelope fa-fw'></i> <a href=\"mailto:"+Z+'">'+Z+"</a><br/>":""}static formatPhone(Z,ie=null){return null!=Z&&null!=Z&&""!=Z?(null==ie?ie="<i class='fa fa-phone fa-fw '></i> ":ie+=": ",ie+'<a href="tel:'+Z+'">'+Z+"</a><br/>"):""}static formatPOIDetails(Z,ie){let Ce=new Date;null==ie&&(ie=!1);let De=this.formatPOIAddress(Z,!1),Je="";Je+=this.formatPhone(Z.AddressInfo.ContactTelephone1),Je+=this.formatPhone(Z.AddressInfo.ContactTelephone2),Je+=this.formatEmailAddress(Z.AddressInfo.ContactEmail);let re="";if(null!=Z.AddressInfo.Distance){let He="https://maps.google.com/maps?saddr=&daddr="+Z.AddressInfo.Latitude+","+Z.AddressInfo.Longitude;re+="<strong id='addr_distance'><span data-localize='details.approxDistance'>Distance</span>: "+Z.AddressInfo.Distance.toFixed(1)+" "+(2==Z.AddressInfo.DistanceUnit?"Miles":"KM")+"</strong>",re+="<p>"+this.formatSystemWebLink(He,"Get Directions")+"</p>"}if(null!=Z.AddressInfo.RelatedURL&&""!=Z.AddressInfo.RelatedURL){let He=Z.AddressInfo.RelatedURL;He=He.replace(/.*?:\/\//g,""),He.length>40&&(He=He.substr(0,40)+".."),Je+="<i class='fa fa-fw fa-external-link'></i>  "+this.formatSystemWebLink(Z.AddressInfo.RelatedURL,"<span data-localize='details.addressRelatedURL'>"+He+"</span>")}Je+="</p>";const ze=this.formatTextField(Z.GeneralComments,null,!1,!0)+this.formatTextField(Z.AddressInfo.AccessComments,"Access",!0,!0,"details.accessComments");let je="";null!=Z.NumberOfPoints&&(je+=this.formatTextField(Z.NumberOfPoints,"Bays",!1,!0,"details.numberOfPoints")),null!=Z.UsageType&&(je+=this.formatTextField(Z.UsageType.Title,"Usage",!1,!0,"details.usageType")),null!=Z.UsageCost&&(je+=this.formatTextField(Z.UsageCost,"Usage Cost",!1,!0,"details.usageCost")),null!=Z.OperatorInfo&&1!=Z.OperatorInfo.ID&&(je+=this.formatTextField(Z.OperatorInfo.Title,"Operator",!1,!0,"details.operatorTitle"),null!=Z.OperatorInfo.WebsiteURL&&(je+=this.formatTextField(this.formatURL(Z.OperatorInfo.WebsiteURL),"Operator Website",!0,!0,"details.operatorWebsite")));let We="";if(null!=Z.StatusType&&(We+=this.formatTextField(Z.StatusType.Title,"Status",!1,!0,"details.operationalStatus"),null!=Z.DateLastStatusUpdate&&(We+=this.formatTextField(Math.round((Ce-this.fixJSONDate(Z.DateLastStatusUpdate))/864e5)+" days ago","Last Updated",!1,!0,"details.lastUpdated"))),null!=Z.Connections&&Z.Connections.length>0){We+="<table class='table table-striped'>",We+="<tr><th data-localize='details.equipment.connectionType'>Connection</th><th data-localize='details.equipment.powerLevel'>Power Level</th><th data-localize='details.operationalStatus'>Status</th></tr>";for(let He=0;He<Z.Connections.length;He++){let be=Z.Connections[He];""==be.Amps&&(be.Amps=null),""==be.Voltage&&(be.Voltage=null),""==be.Quantity&&(be.Quantity=null),""==be.PowerKW&&(be.PowerKW=null),We+="<tr><td>"+(null!=be.ConnectionType?be.ConnectionType.Title:"")+"</td><td>"+(null!=be.Level?"<strong>"+be.Level.Title+"</strong><br/>":"")+(null!=be.Amps?this.formatString(be.Amps)+"A/ ":"")+(null!=be.Voltage?this.formatString(be.Voltage)+"V/ ":"")+(null!=be.PowerKW?this.formatString(be.PowerKW)+"kW <br/>":"")+(null!=be.CurrentType?be.CurrentType.Title:"")+"<br/>"+(null!=be.Quantity?this.formatString(be.Quantity):"1")+" Present</td><td>"+(null!=be.StatusType?be.StatusType.Title:"-")+"</td></tr>"}We+="</table>"}let Ne="";return Ne+=this.formatTextField("<a target='_blank' href='https://openchargemap.org/site/poi/details/"+Z.ID+"'>OCM-"+Z.ID+"</a>","OpenChargeMap Ref",!1,!0,"details.refNumber"),null!=Z.DataProvider&&(Ne+=this.formatTextField(Z.DataProvider.Title,"Data Provider",!1,!0,"details.dataProviderTitle"),null!=Z.DataProvider.WebsiteURL&&(Ne+=this.formatTextField(this.formatURL(Z.DataProvider.WebsiteURL),"Website",!1,!0,"details.dataProviderWebsite")),Ne+=this.formatTextField(Z.AddressInfo.Latitude,"Latitude",!1,!0,null),Ne+=this.formatTextField(Z.AddressInfo.Longitude,"Longitude",!1,!0,null)),{address:De,drivingInfo:re,contactInfo:Je,additionalInfo:ze+je+We,advancedInfo:Ne}}static debounce(Z,ie,T){let Ce;return function(){let De=this,Je=arguments,ze=T&&!Ce;clearTimeout(Ce),Ce=setTimeout(function(){Ce=null,T||Z.apply(De,Je)},ie),ze&&Z.apply(De,Je)}}static getRandomInt(Z){return Math.floor(Math.random()*Math.floor(Z))}}return me})()},9093:(vi,Vt,B)=>{"use strict";B.d(Vt,{CS:()=>me.CS,cW:()=>Z.cW,Bk:()=>Z.Bk,L_:()=>me.L_,dx:()=>me.dx,te:()=>T.t,Jm:()=>a.J,ig:()=>ie.i,r:()=>g,NA:()=>v,gu:()=>me.gu});class g{ID;SubmissionType;Data;Attempts;DateQueued;IsSubmitted;IsInProgress;IsCancelled;IsFailure;FailureReason;constructor(De,Je){this.SubmissionType=De,this.Data=Je,this.DateQueued=new Date,this.IsSubmitted=!1,this.IsInProgress=!1,this.IsCancelled=!1,this.IsFailure=!1,this.Attempts=0,this.ID=new Date+"_"+100*Math.random()}}var v=function(Ce){return Ce[Ce.POI=0]="POI",Ce[Ce.Comment=1]="Comment",Ce[Ce.Media=2]="Media",Ce}(v||{}),me=B(4851),a=B(5390),Z=B(9394),ie=B(8139),T=B(1918)},9394:(vi,Vt,B)=>{"use strict";B.d(Vt,{Bk:()=>v,cW:()=>g,zG:()=>me});class g{altitudeAccuracy;longitude;latitude;speed;heading;altitude;accuracy;constructor(Z=null,ie=null){this.latitude=Z,this.longitude=ie}}class v{coords;timestamp;attribution;constructor(Z=null,ie=null){this.coords=new g,this.coords.latitude=Z,this.coords.longitude=ie}static fromPosition(Z){return new v(Z.coords.latitude,Z.coords.longitude)}}class me{northEast;southWest;constructor(Z,ie){this.northEast=Z,this.southWest=ie}}},4851:(vi,Vt,B)=>{"use strict";B.d(Vt,{CS:()=>me,L_:()=>ie,C_:()=>Ce,A$:()=>T,dx:()=>Z,gu:()=>a});class g{itemType;itemId;version;schemaVersion;syncTimeStamp;constructor(Je,re){this.itemType=Je,this.itemId=g.getNewItemId(),this.version=1,this.schemaVersion=re,this.syncTimeStamp=g.getNewSyncTimeStamp()}static getNewSyncTimeStamp(){return Date.now().toString()}static getNewItemId(){return"_syncitem_"+Date.now().toString()}}class v{Title;Notes;_sync;constructor(Je,re){this._sync=new g(Je,re)}}class me extends v{PoiID;Type;Poi;Photos}class a extends v{Stage;Position;PoiIDs;PoiList;constructor(){super("waypoint",1)}}class Z extends v{WayPoints;constructor(){super("journey_stage",1),this.WayPoints=[]}}class ie extends v{ID;Stages;constructor(){super("journey",1),this.ID=""+Date.now(),this.Stages=[]}}class T{Title;DistanceKM;DurationMinutes;StartElevation;EndElevation;EnergyConsumptionkWh}class Ce{Title;JourneyRouteLegs;TotalDistanceKM;TotalDurationMinutes;TotalEnergykWh}},1918:(vi,Vt,B)=>{"use strict";B.d(Vt,{t:()=>g});class g{poiIdList=null;countryCode=null;latitude=null;longitude=null;locationTitle=null;distance=null;distanceUnit=null;connectionTypeIdList=null;operatorIdList=null;levelIdList=null;countryIdList=null;usageTypeIdList=null;statusTypeIdList=null;minPowerKW=null;maxPowerKW=null;submissionStatusTypeIdList=null;maxResults=500;additionalParams=null;includeComments=!1;compact=!0;enableCaching=!0;levelOfDetail=1;polyline=null;boundingbox=null}},5390:(vi,Vt,B)=>{"use strict";B.d(Vt,{J:()=>g});class g{Location;Title;Address;Type;ReferenceID;Attribution;AddressInfo}},8139:(vi,Vt,B)=>{"use strict";B.d(Vt,{d:()=>g,i:()=>v});const g=1e3;class v{OperatorList;ConnectionTypeList;CountryList;UsageTypeList;StatusTypeList;MinPowerKW;MaxPowerKW;UseDistanceInKM;HasActiveFilters;LastSearchPosition;StartSearchPosition;StartViewPoiId;Language;FilterOptionsByCountryId;MapType;EnableAdvancedEditorFeatures;EnablePOIPendingApproval;MaxResults;constructor(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MaxPowerKW=null,this.MinPowerKW=null,this.HasActiveFilters=!1,this.FilterOptionsByCountryId=null,this.UseDistanceInKM=!0,this.MapType="ROADMAP",this.EnableAdvancedEditorFeatures=!1,this.EnablePOIPendingApproval=!1,this.MaxResults=500}LoadSettings(){}SaveSettings(){}ClearActiveFilters(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MinPowerKW=null,this.MaxPowerKW=null}CheckForActiveFilters(){return this.HasActiveFilters=this.OperatorList.length>0||this.ConnectionTypeList.length>0||this.CountryList.length>0||this.UsageTypeList.length>0||this.StatusTypeList.length>0||this.MinPowerKW>0||this.MaxPowerKW>0||null!=this.MaxPowerKW&&this.MaxPowerKW<g,this.HasActiveFilters}}},8145:(vi,Vt,B)=>{"use strict";B.r(Vt),B.d(Vt,{AboutPageModule:()=>Je});var g=B(177),v=B(9417),me=B(9465),a=B(1470),Z=B(6625),ie=B(3953);const T=[{path:"",component:Z.j}];let Ce=(()=>{class re{static \u0275fac=function(We){return new(We||re)};static \u0275mod=ie.$C({type:re});static \u0275inj=ie.G2t({imports:[a.iI.forChild(T),a.iI]})}return re})();var De=B(4842);let Je=(()=>{class re{static \u0275fac=function(We){return new(We||re)};static \u0275mod=ie.$C({type:re});static \u0275inj=ie.G2t({imports:[g.MD,v.YN,me.bv,De.h,Ce]})}return re})()},6625:(vi,Vt,B)=>{"use strict";B.d(Vt,{j:()=>Z});var g=B(5312),v=B(3953),me=B(9465),a=B(4842);let Z=(()=>{class ie{modalController;constructor(Ce){this.modalController=Ce}get appVersion(){return g.c.version}get apiUrl(){return g.c.apiBase}ngOnInit(){}close(){this.modalController.dismiss()}static \u0275fac=function(De){return new(De||ie)(v.rXU(me.W3))};static \u0275cmp=v.VBU({type:ie,selectors:[["app-about"]],decls:46,vars:5,consts:[[1,"ion-padding"],["size","2"],["src","assets/images/icons/branding/AppIcon_128x128.png"],["href","https://openchargemap.org","target","_blank"],["href","https://community.openchargemap.org","target","_blank"],["href","https://webprofusion.com","target","_blank"],["href","https://openchargemap.org/site/about/datasharing","target","_blank"],["slot","end"],[3,"click"],["name","close","slot","start"]],template:function(De,Je){1&De&&(v.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),v.EFF(3),v.nI1(4,"translate"),v.k0s()()(),v.j41(5,"ion-content",0)(6,"ion-grid")(7,"ion-row")(8,"ion-col",1),v.nrm(9,"img",2),v.k0s(),v.j41(10,"ion-col")(11,"h1"),v.EFF(12,"Open Charge Map"),v.k0s()()()(),v.j41(13,"p")(14,"strong"),v.EFF(15,"Open Charge Map is the worlds largest Open Data registry of electric vehicle charging locations."),v.k0s(),v.EFF(16," By adding and editing the information within Open Charge Map you are improving the data for an unlimited amount of other apps and services which can use the data for free. "),v.k0s(),v.j41(17,"p")(18,"a",3),v.EFF(19,"openchargemap.org"),v.k0s()(),v.j41(20,"p"),v.EFF(21,"Join our community discussions: "),v.j41(22,"a",4),v.EFF(23,"community.openchargemap.org"),v.k0s()(),v.j41(24,"p"),v.EFF(25,"Software development and service hosting by "),v.j41(26,"a",5),v.EFF(27,"webprofusion.com"),v.k0s()(),v.j41(28,"p"),v.EFF(29,"Our service is run by volunteers, our data is largely crowdsourced by you. Some data is imported from public Open Data sources."),v.k0s(),v.j41(30,"p"),v.EFF(31,"Network operators can "),v.j41(32,"a",6),v.EFF(33,"provide us with an OCPI data feed"),v.k0s(),v.EFF(34," to freely promote their network and ensure information accuracy. "),v.k0s(),v.j41(35,"ion-note")(36,"p"),v.EFF(37),v.k0s(),v.j41(38,"p"),v.EFF(39),v.k0s()()(),v.j41(40,"ion-footer")(41,"ion-toolbar")(42,"ion-buttons",7)(43,"ion-button",8),v.bIt("click",function(){return Je.close()}),v.nrm(44,"ion-icon",9),v.EFF(45," Close "),v.k0s()()()()),2&De&&(v.R7$(3),v.SpI("",v.bMT(4,3,"ocm.general.about")," Open Charge Map"),v.R7$(34),v.SpI("App Version: ",Je.appVersion,""),v.R7$(2),v.SpI("API: ",Je.apiUrl,""))},dependencies:[me.Jm,me.QW,me.hU,me.W9,me.M0,me.lO,me.eU,me.iq,me.JI,me.ln,me.BC,me.ai,a.D9]})}return ie})()},7142:(vi,Vt,B)=>{"use strict";B.r(Vt),B.d(Vt,{JourneysModule:()=>De});var g=B(6918),v=B(7606),me=B(4842),a=B(177),Z=B(9417),ie=B(9465),T=B(1470),Ce=B(3953);let De=(()=>{class Je{static \u0275fac=function(je){return new(je||Je)};static \u0275mod=Ce.$C({type:Je});static \u0275inj=Ce.G2t({imports:[a.MD,Z.YN,ie.bv,me.h,v.F,T.iI.forChild([{path:"",component:g.Z}])]})}return Je})()},6918:(vi,Vt,B)=>{"use strict";B.d(Vt,{Z:()=>Le});var g=B(5044),v=B(6320),me=B(4296),a=B(9093),Z=B(38),ie=B(3953),T=B(9465),Ce=B(177);function De(ot,Ve){1&ot&&(ie.j41(0,"p"),ie.EFF(1," You have no journeys yet. Start by browsing to a charging location, then add it as Favourite to start a new Journey. "),ie.k0s())}function Je(ot,Ve){if(1&ot&&(ie.j41(0,"p"),ie.EFF(1),ie.k0s()),2&ot){const Ue=ie.XpG(2).$implicit;ie.R7$(),ie.SpI(" ",Ue.Poi.AddressInfo.AddressLine1,"")}}function re(ot,Ve){if(1&ot&&(ie.j41(0,"p"),ie.EFF(1),ie.k0s()),2&ot){const Ue=ie.XpG(2).$implicit;ie.R7$(),ie.SpI(" ",Ue.Poi.AddressInfo.AddressLine2,"")}}function ze(ot,Ve){if(1&ot&&(ie.j41(0,"p"),ie.EFF(1),ie.k0s()),2&ot){const Ue=ie.XpG(2).$implicit;ie.R7$(),ie.SpI(" ",Ue.Poi.AddressInfo.Town,"")}}function je(ot,Ve){if(1&ot&&(ie.j41(0,"p"),ie.EFF(1),ie.k0s()),2&ot){const Ue=ie.XpG(2).$implicit;ie.R7$(),ie.SpI(" ",Ue.Poi.AddressInfo.StateOrProvince,"")}}function We(ot,Ve){if(1&ot&&(ie.j41(0,"p"),ie.EFF(1),ie.k0s()),2&ot){const Ue=ie.XpG(2).$implicit;ie.R7$(),ie.SpI(" ",Ue.Poi.AddressInfo.Postcode,"")}}function Ne(ot,Ve){if(1&ot){const Ue=ie.RV6();ie.j41(0,"div")(1,"div",18),ie.bIt("click",function(){ie.eBV(Ue);const nt=ie.XpG().$implicit,xt=ie.XpG(4);return ie.Njj(xt.viewPOIDetails(nt.Poi))}),ie.DNE(2,Je,2,1,"p",4)(3,re,2,1,"p",4)(4,ze,2,1,"p",4)(5,je,2,1,"p",4)(6,We,2,1,"p",4),ie.k0s(),ie.j41(7,"ion-button",19),ie.bIt("click",function(){ie.eBV(Ue);const nt=ie.XpG().$implicit,xt=ie.XpG(4);return ie.Njj(xt.launchNavigation(nt.Poi))}),ie.nrm(8,"ion-icon",20),ie.EFF(9," Navigate "),ie.k0s()()}if(2&ot){const Ue=ie.XpG().$implicit;ie.R7$(2),ie.Y8G("ngIf",Ue.Poi.AddressInfo.AddressLine1),ie.R7$(),ie.Y8G("ngIf",Ue.Poi.AddressInfo.AddressLine2),ie.R7$(),ie.Y8G("ngIf",Ue.Poi.AddressInfo.Town),ie.R7$(),ie.Y8G("ngIf",Ue.Poi.AddressInfo.StateOrProvince),ie.R7$(),ie.Y8G("ngIf",Ue.Poi.AddressInfo.Postcode)}}function ht(ot,Ve){if(1&ot&&(ie.j41(0,"div",17),ie.DNE(1,Ne,10,5,"div",4),ie.k0s()),2&ot){const Ue=Ve.$implicit;ie.R7$(),ie.Y8G("ngIf",Ue.Poi)}}function He(ot,Ve){if(1&ot&&(ie.j41(0,"ion-item")(1,"h2"),ie.EFF(2),ie.k0s(),ie.j41(3,"ion-thumbnail",0),ie.nrm(4,"ion-icon",15),ie.k0s(),ie.j41(5,"p"),ie.EFF(6),ie.k0s(),ie.DNE(7,ht,2,1,"div",16),ie.k0s()),2&ot){const Ue=Ve.$implicit;ie.R7$(2),ie.JRh(Ue.Title),ie.R7$(4),ie.JRh(Ue.Notes),ie.R7$(),ie.Y8G("ngForOf",Ue.PoiList)}}function be(ot,Ve){if(1&ot&&(ie.j41(0,"ion-list")(1,"ion-list-header",11),ie.EFF(2),ie.nrm(3,"ion-icon",12),ie.EFF(4," -- "),ie.nrm(5,"ion-icon",13),ie.EFF(6," -- "),ie.nrm(7,"ion-icon",14),ie.EFF(8," -- "),ie.k0s(),ie.DNE(9,He,8,3,"ion-item",5),ie.k0s()),2&ot){const Ue=Ve.$implicit;ie.R7$(2),ie.SpI(" ",Ue.Title," "),ie.R7$(7),ie.Y8G("ngForOf",Ue.WayPoints)}}function Ye(ot,Ve){if(1&ot){const Ue=ie.RV6();ie.j41(0,"ion-card")(1,"ion-card-content")(2,"ion-toolbar",8)(3,"ion-title"),ie.EFF(4),ie.k0s(),ie.j41(5,"ion-buttons",9)(6,"ion-button",1),ie.bIt("click",function(){const nt=ie.eBV(Ue).$implicit,xt=ie.XpG();return ie.Njj(xt.deleteJourney(nt.ID))}),ie.nrm(7,"ion-icon",10),ie.k0s()()(),ie.j41(8,"p"),ie.EFF(9),ie.k0s(),ie.DNE(10,be,10,2,"ion-list",5),ie.k0s()()}if(2&ot){const Ue=Ve.$implicit;ie.R7$(4),ie.SpI(" ",Ue.Title,""),ie.R7$(5),ie.JRh(Ue.Notes),ie.R7$(),ie.Y8G("ngForOf",Ue.Stages)}}let Le=(()=>{class ot{appManager;journeyManager;api;modalController;alertController;constructor(Ue,$t,nt,xt,ct){this.appManager=Ue,this.journeyManager=$t,this.api=nt,this.modalController=xt,this.alertController=ct}dismiss(){this.modalController.dismiss()}discoverImages(){this.journeyManager.journeys.forEach(Ue=>{Ue.Stages.forEach($t=>{$t.WayPoints.forEach(nt=>{null!=nt.PoiList&&nt.PoiList.forEach(xt=>{xt.Poi&&this.api.getPanoramioLocationPhotos(new a.cW(xt.Poi.AddressInfo.Latitude,xt.Poi.AddressInfo.Longitude)).then(ct=>{xt.Photos=ct})})})})})}getJson(Ue){return JSON.stringify(Ue,null,4)}viewPOIDetails(Ue){this.modalController.create({component:Z.I,componentProps:{item:Ue}}).then($t=>$t.present())}get staticMapSize(){return"60x60"}getStaticMapURL(Ue){return"https://maps.googleapis.com/maps/api/staticmap?center="+Ue.AddressInfo.Latitude+","+Ue.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+Ue.AddressInfo.Latitude+","+Ue.AddressInfo.Longitude}deleteJourney(Ue){this.alertController.create({header:"Delete this Journey?",message:"Are you sure you want to delete this Journey?",buttons:[{text:"No",handler:()=>{}},{text:"Delete",handler:()=>{this.journeyManager.deleteJourney(Ue)}}]}).then($t=>$t.present())}launchNavigation(Ue){let $t="https://maps.google.com/?q="+Ue.AddressInfo.Latitude+","+Ue.AddressInfo.Longitude;this.appManager.platform.is("ios")&&($t="https://maps.apple.com?q="+Ue.AddressInfo.Latitude+","+Ue.AddressInfo.Longitude),window.open($t,"_system")}static \u0275fac=function($t){return new($t||ot)(ie.rXU(me.r),ie.rXU(g.K),ie.rXU(v.Q),ie.rXU(T.W3),ie.rXU(T.hG))};static \u0275cmp=ie.VBU({type:ot,selectors:[["ng-component"]],decls:18,vars:2,consts:[["slot","start"],[3,"click"],[1,"journeys-page"],[1,"ion-padding"],[4,"ngIf"],[4,"ngFor","ngForOf"],["slot","end"],["name","close","slot","start"],["primary",""],["slot","primary"],["name","close","slot","icon-only"],[2,"font-size","1.5rem"],["name","car"],["name","time"],["name","flash"],["name","caret-down",2,"font-size","4rem"],["style","text-align:right;width:100%;",4,"ngFor","ngForOf"],[2,"text-align","right","width","100%"],["tappable","",3,"click"],["clear","","item-right","",3,"click"],["name","navigate","slot","start"]],template:function($t,nt){1&$t&&(ie.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-back-button",1),ie.bIt("click",function(){return nt.dismiss()}),ie.k0s()(),ie.j41(4,"ion-title"),ie.EFF(5," Journeys "),ie.k0s()()(),ie.j41(6,"ion-content",2)(7,"div",3)(8,"p"),ie.EFF(9," You can create and plan journeys to group your favourite charging routes together. "),ie.k0s(),ie.DNE(10,De,2,0,"p",4),ie.k0s(),ie.DNE(11,Ye,11,3,"ion-card",5),ie.k0s(),ie.j41(12,"ion-footer")(13,"ion-toolbar")(14,"ion-buttons",6)(15,"ion-button",1),ie.bIt("click",function(){return nt.dismiss()}),ie.nrm(16,"ion-icon",7),ie.EFF(17," Close "),ie.k0s()()()()),2&$t&&(ie.R7$(10),ie.Y8G("ngIf",null==nt.journeyManager.journeys||0==nt.journeyManager.journeys.length),ie.R7$(),ie.Y8G("ngForOf",nt.journeyManager.journeys))},dependencies:[Ce.Sq,Ce.bT,T.Jm,T.QW,T.b_,T.I9,T.W9,T.M0,T.eU,T.iq,T.uz,T.nf,T.AF,T.Zx,T.BC,T.ai,T.el],encapsulation:2})}return ot})()},9950:(vi,Vt,B)=>{"use strict";B.r(Vt),B.d(Vt,{LayerEditorPageModule:()=>Je});var g=B(177),v=B(9417),me=B(9465),a=B(1470),Z=B(2745),ie=B(3953);const T=[{path:"",component:Z.W}];let Ce=(()=>{class re{static \u0275fac=function(We){return new(We||re)};static \u0275mod=ie.$C({type:re});static \u0275inj=ie.G2t({imports:[a.iI.forChild(T),a.iI]})}return re})();var De=B(7606);let Je=(()=>{class re{static \u0275fac=function(We){return new(We||re)};static \u0275mod=ie.$C({type:re});static \u0275inj=ie.G2t({imports:[g.MD,v.YN,me.bv,Ce,De.F]})}return re})()},2745:(vi,Vt,B)=>{"use strict";B.d(Vt,{W:()=>Ce});var g=B(467),v=B(3371),me=B(3953),a=B(9465),Z=B(177),ie=B(7192);function T(De,Je){if(1&De&&(me.j41(0,"div"),me.EFF(1),me.nrm(2,"app-poi-list",10),me.k0s()),2&De){const re=me.XpG();me.R7$(),me.SpI(" Items Parsed: ",re.fileData.length," "),me.R7$(),me.Y8G("poiList",re.fileData)}}let Ce=(()=>{class De{modalController;refData;fileData;constructor(re,ze){this.modalController=re,this.refData=ze}ngOnInit(){}previewFile(){var re=this;return(0,g.A)(function*(){yield re.loadFile(!1)})()}cancel(){var re=this;return(0,g.A)(function*(){yield re.modalController.dismiss(re.fileData)})()}loadFile(re=!0){var ze=this;return(0,g.A)(function*(){const je=new FileReader;je.onload=()=>{let Ne=JSON.parse(je.result),ht=5e6;for(let He of Ne)(null==He.ID||""==He.ID)&&(He.ID=ht.toString()),He.ID="imp_"+He.ID,ht++;ze.fileData=ze.refData.hydrateCompactPOIList(Ne),re&&ze.modalController.dismiss(ze.fileData)},je.onerror=()=>{},je.readAsText(document.getElementById("file-upload").files[0])})()}add(){var re=this;return(0,g.A)(function*(){re.modalController.dismiss(re.fileData)})()}static \u0275fac=function(ze){return new(ze||De)(me.rXU(a.W3),me.rXU(v.r))};static \u0275cmp=me.VBU({type:De,selectors:[["app-layer-editor"]],decls:27,vars:1,consts:[[1,"ion-padding"],[1,"upload"],["name","file","aria-label","file","slot","start"],["type","file","required","","id","file-upload",3,"change"],[4,"ngIf"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","checkmark-circle-outline","slot","end"],[3,"poiList"]],template:function(ze,je){1&ze&&(me.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),me.EFF(3," Edit Layer "),me.k0s()()(),me.j41(4,"ion-content",0)(5,"p"),me.EFF(6,"POI layers are used to preview data from other Open Data sources. "),me.k0s(),me.j41(7,"p"),me.EFF(8,"Select a POI layer JSON file: "),me.k0s(),me.j41(9,"div")(10,"label",1)(11,"ion-button"),me.nrm(12,"ion-icon",2),me.j41(13,"ion-label"),me.EFF(14,"Choose File.."),me.k0s()(),me.j41(15,"input",3),me.bIt("change",function(){return je.previewFile()}),me.k0s()()(),me.DNE(16,T,3,2,"div",4),me.k0s(),me.j41(17,"ion-footer")(18,"ion-toolbar")(19,"ion-buttons",5)(20,"ion-button",6),me.bIt("click",function(){return je.cancel()}),me.nrm(21,"ion-icon",7),me.EFF(22," Cancel "),me.k0s()(),me.j41(23,"ion-buttons",8)(24,"ion-button",6),me.bIt("click",function(){return je.add()}),me.EFF(25," Add "),me.nrm(26,"ion-icon",9),me.k0s()()()()),2&ze&&(me.R7$(16),me.Y8G("ngIf",je.fileData&&je.fileData.length>0))},dependencies:[Z.bT,a.Jm,a.QW,a.W9,a.M0,a.eU,a.iq,a.he,a.BC,a.ai,ie.k],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]})}return De})()},38:(vi,Vt,B)=>{"use strict";B.d(Vt,{I:()=>an});var g=B(4296),v=B(3953),me=B(9465),a=B(3656),Z=B(467),ie=B(5044),T=B(4851),Ce=B(177),De=B(9417);function Je(pt,On){if(1&pt&&(v.j41(0,"ion-select-option",13),v.EFF(1),v.k0s()),2&pt){const Ze=On.$implicit;v.Y8G("value",Ze.ID),v.R7$(),v.JRh(Ze.Title)}}function re(pt,On){if(1&pt&&(v.j41(0,"ion-select-option",16),v.EFF(1),v.k0s()),2&pt){const Ze=On.$implicit;v.Y8G("value",On.index),v.R7$(),v.JRh(Ze.Title)}}function ze(pt,On){if(1&pt){const Ze=v.RV6();v.j41(0,"ion-item")(1,"ion-label",2),v.EFF(2,"Journey Stage"),v.k0s(),v.j41(3,"ion-select",3),v.mxI("ngModelChange",function(Dn){v.eBV(Ze);const ki=v.XpG();return v.DH7(ki.selectedStageIndex,Dn)||(ki.selectedStageIndex=Dn),v.Njj(Dn)}),v.j41(4,"ion-select-option",14),v.EFF(5,"Create a Journey Stage"),v.k0s(),v.DNE(6,re,2,2,"ion-select-option",15),v.k0s()()}if(2&pt){const Ze=v.XpG();v.R7$(3),v.R50("ngModel",Ze.selectedStageIndex),v.R7$(3),v.Y8G("ngForOf",Ze.journeyManager.getJourneyStages(Ze.selectedJourneyID))}}function je(pt,On){if(1&pt){const Ze=v.RV6();v.j41(0,"ion-item")(1,"ion-label",2),v.EFF(2,"New Journey Name"),v.k0s(),v.j41(3,"ion-input",7),v.mxI("ngModelChange",function(Dn){v.eBV(Ze);const ki=v.XpG();return v.DH7(ki.newJourneyName,Dn)||(ki.newJourneyName=Dn),v.Njj(Dn)}),v.k0s()()}if(2&pt){const Ze=v.XpG();v.R7$(3),v.R50("ngModel",Ze.newJourneyName)}}let We=(()=>{class pt{appManager;navParams;journeyManager;modalController;selectedJourneyID;selectedStageIndex;newJourneyName;waypoint;poi;constructor(Ze,Ln,Dn,ki){this.appManager=Ze,this.navParams=Ln,this.journeyManager=Dn,this.modalController=ki,this.poi=this.navParams.get("poi"),this.waypoint=new T.gu,this.waypoint.Title=this.poi.AddressInfo.Title,this.waypoint.PoiIDs=[this.poi.ID],this.waypoint.PoiList=[];const Fi=new T.CS("charging",1);Fi.Poi=this.poi,Fi.PoiID=this.poi.ID,this.waypoint.PoiList.push(Fi),this.newJourneyName="Trip to "+this.poi.AddressInfo.Title}cancel(){this.modalController.dismiss()}add(){if(null!=this.selectedJourneyID&&""!==this.selectedJourneyID)this.journeyManager.addJourneyWaypoint(this.selectedJourneyID,this.selectedStageIndex,this.waypoint);else{const Ze=new T.L_;Ze.ID=Date.now().toString(),""===this.newJourneyName&&(this.newJourneyName="New Journey"),Ze.Title=this.newJourneyName,this.journeyManager.addJourney(Ze,this.waypoint)}this.journeyManager.saveJourneys(),this.modalController.dismiss()}static \u0275fac=function(Ln){return new(Ln||pt)(v.rXU(g.r),v.rXU(a.y8),v.rXU(ie.K),v.rXU(me.W3))};static \u0275cmp=v.VBU({type:pt,selectors:[["ng-component"]],decls:39,vars:8,consts:[[1,"journeys-page","ion-padding"],[1,"banner"],["position","stacked"],[3,"ngModelChange","ngModel"],["value","","checked",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","text",3,"ngModelChange","ngModel"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","add","slot","end"],[3,"value"],["value",""],["checked","",3,"value",4,"ngFor","ngForOf"],["checked","",3,"value"]],template:function(Ln,Dn){1&Ln&&(v.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),v.EFF(3," Edit Favourite "),v.k0s()()(),v.j41(4,"ion-content",0)(5,"div",1)(6,"h1"),v.EFF(7),v.k0s(),v.j41(8,"p"),v.EFF(9),v.k0s()(),v.j41(10,"p"),v.EFF(11," Add Charging Location as a Journey Waypoint "),v.k0s(),v.j41(12,"ion-item")(13,"ion-label",2),v.EFF(14,"Add to a Journey"),v.k0s(),v.j41(15,"ion-select",3),v.mxI("ngModelChange",function(Fi){return v.DH7(Dn.selectedJourneyID,Fi)||(Dn.selectedJourneyID=Fi),Fi}),v.j41(16,"ion-select-option",4),v.EFF(17,"Create a New Journey"),v.k0s(),v.DNE(18,Je,2,2,"ion-select-option",5),v.k0s()(),v.DNE(19,ze,7,2,"ion-item",6)(20,je,4,1,"ion-item",6),v.j41(21,"ion-item")(22,"ion-label",2),v.EFF(23,"Name for this step of your journey"),v.k0s(),v.j41(24,"ion-input",7),v.mxI("ngModelChange",function(Fi){return v.DH7(Dn.waypoint.Title,Fi)||(Dn.waypoint.Title=Fi),Fi}),v.k0s()(),v.j41(25,"ion-item")(26,"ion-label",2),v.EFF(27,"Other Notes"),v.k0s(),v.j41(28,"ion-textarea",3),v.mxI("ngModelChange",function(Fi){return v.DH7(Dn.waypoint.Notes,Fi)||(Dn.waypoint.Notes=Fi),Fi}),v.k0s()()(),v.j41(29,"ion-footer")(30,"ion-toolbar")(31,"ion-buttons",8)(32,"ion-button",9),v.bIt("click",function(){return Dn.cancel()}),v.nrm(33,"ion-icon",10),v.EFF(34," Cancel "),v.k0s()(),v.j41(35,"ion-buttons",11)(36,"ion-button",9),v.bIt("click",function(){return Dn.add()}),v.EFF(37," Add "),v.nrm(38,"ion-icon",12),v.k0s()()()()),2&Ln&&(v.R7$(7),v.JRh(Dn.poi.AddressInfo.Title),v.R7$(2),v.JRh(Dn.poi.AddressInfo.AddressLine1),v.R7$(6),v.R50("ngModel",Dn.selectedJourneyID),v.R7$(3),v.Y8G("ngForOf",Dn.journeyManager.journeys),v.R7$(),v.Y8G("ngIf",Dn.selectedJourneyID),v.R7$(),v.Y8G("ngIf",!Dn.selectedJourneyID),v.R7$(4),v.R50("ngModel",Dn.waypoint.Title),v.R7$(4),v.R50("ngModel",Dn.waypoint.Notes))},dependencies:[Ce.Sq,Ce.bT,De.BC,De.vS,me.Jm,me.QW,me.W9,me.M0,me.eU,me.iq,me.$w,me.uz,me.he,me.Nm,me.Ip,me.nc,me.BC,me.ai,me.Je,me.Gw],encapsulation:2})}return pt})();var Ne=B(3118);function ht(pt,On){if(1&pt){const Ze=v.RV6();v.j41(0,"ion-card")(1,"ion-toolbar")(2,"ion-title",14),v.EFF(3,"Preview"),v.k0s(),v.j41(4,"ion-buttons",15)(5,"ion-button",5),v.bIt("click",function(){v.eBV(Ze);const Dn=v.XpG();return v.Njj(Dn.rotateImage())}),v.nrm(6,"ion-icon",16),v.j41(7,"ion-label"),v.EFF(8,"Rotate"),v.k0s()()()(),v.j41(9,"ion-card-content")(10,"ion-list")(11,"ion-item")(12,"ion-label",17),v.EFF(13,"Comment"),v.k0s(),v.j41(14,"ion-input",18),v.mxI("ngModelChange",function(Dn){v.eBV(Ze);const ki=v.XpG();return v.DH7(ki.comment,Dn)||(ki.comment=Dn),v.Njj(Dn)}),v.k0s()()(),v.nrm(15,"img",19),v.k0s()()}if(2&pt){const Ze=v.XpG();v.R7$(14),v.R50("ngModel",Ze.comment)}}let He=(()=>{class pt{navParams;appManager;nav;modalController;logging;mode;processingQuality;imgData;targetWidth;targetHeight;comment;chargePointId;poi;constructor(Ze,Ln,Dn,ki,Fi){this.navParams=Ze,this.appManager=Ln,this.nav=Dn,this.modalController=ki,this.logging=Fi,this.processingQuality=.8,this.targetWidth=1024,this.targetHeight=800,this.mode=Ln.platformMode,this.chargePointId=this.navParams.get("id"),this.poi=this.navParams.get("poi"),this.comment=""}processNativeImageSource(Ze){let Ln=Ze;const Dn=document.getElementById("img-upload-canvas"),ki=Dn.getContext("2d"),Fi=new Image;Fi.onload=()=>{this.logging.log("img load:"+Fi.width),Dn.width=Fi.width,Dn.height=Fi.height,ki.fillStyle="rgb(0,0,0)",ki.fillRect(0,0,Dn.width,Dn.height),ki.drawImage(Fi,0,0,Dn.width,Dn.height),this.imgData=Dn.toDataURL("image/png"),this.processImage()},Fi.src=Ln}loadCameraOrLibraryImage(Ze=!1){this.logging.log("PWA mode: fetching image");const Ln=new FileReader;Ln.onload=()=>{this.imgData=Ln.result,this.processImage()},Ln.onerror=()=>{},Ln.readAsDataURL(document.getElementById("img-upload-media").files[0])}isBrowserMode(){return this.appManager.isPlatform("desktop")||this.appManager.isPlatform("hybrid")}processImage(){if(null!=this.imgData){const Ln=document.getElementById("img-upload-canvas"),Dn=Ln.getContext("2d"),ki=new Image;ki.onload=()=>{Ln.width=ki.width,Ln.height=ki.height,Dn.fillStyle="rgb(0,0,0)",Dn.fillRect(0,0,Ln.width,Ln.height),Dn.drawImage(ki,0,0,Ln.width,Ln.height),this.refreshImageFromCanvas()},ki.src=this.imgData}else this.logging.log("processImage: nothing to process.")}refreshImageFromCanvas(){const Ze=document.getElementById("img-upload-canvas");this.imgData=Ze.toDataURL("image/jpeg",.8),document.getElementById("preview").src=this.imgData}rotateImage(){const Ze=document.getElementById("img-upload-canvas");let Ln=new Image;Ln.src=Ze.toDataURL(),Ln.onload=()=>{let Dn=Ze.height,ki=Ze.width;Ze.width=Dn,Ze.height=ki,Dn=Ze.height,ki=Ze.width;const Fi=Ze.getContext("2d");Fi.save(),Fi.translate(ki,Dn/ki),Fi.rotate(Math.PI/2),Fi.drawImage(Ln,0,0),Fi.restore(),Ln=null,this.refreshImageFromCanvas()}}performUpload(){var Ze=this;return(0,Z.A)(function*(){if(!Ze.imgData)return void(yield Ze.appManager.showToastNotification("Select an image to upload."));const Ln={chargePointID:Ze.chargePointId,comment:Ze.comment,imageDataBase64:Ze.imgData};yield Ze.appManager.showLoadingProgress("Uploading photo..");try{yield Ze.appManager.submitMediaItem(Ln),Ze.appManager.dismissLoadingProgress().then(()=>{Ze.appManager.showToastNotification("Upload completed"),Ze.modalController.dismiss()}),Ze.appManager.analytics.appEvent("MediaUpload","Completed")}catch{yield Ze.appManager.dismissLoadingProgress(),yield Ze.appManager.showToastNotification("Upload failed, please try again."),Ze.appManager.analytics.appEvent("MediaUpload","Failed")}})()}cancel(){var Ze=this;return(0,Z.A)(function*(){yield Ze.modalController.dismiss()})()}static \u0275fac=function(Ln){return new(Ln||pt)(v.rXU(a.y8),v.rXU(g.r),v.rXU(a.q9),v.rXU(me.W3),v.rXU(Ne.y))};static \u0275cmp=v.VBU({type:pt,selectors:[["ng-component"]],decls:32,vars:3,consts:[["inputFile",""],[1,"media-upload"],[1,"ion-padding"],[1,"banner"],[1,"upload"],[3,"click"],["name","camera","aria-label","camera","slot","start"],["type","file","required","","id","img-upload-media",3,"change"],["id","img-upload-canvas",2,"display","none","width","500","height","500","border","1px solid red"],[4,"ngIf"],["slot","secondary"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],["slot","start"],["slot","end"],["name","refresh","slot","start"],["position","floating"],["type","text","placeholder","(optional comment)",3,"ngModelChange","ngModel"],["id","preview",2,"max-width","500px"]],template:function(Ln,Dn){if(1&Ln){const ki=v.RV6();v.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),v.EFF(3," Share Photo "),v.k0s()()(),v.j41(4,"ion-content",1)(5,"div",2)(6,"div",3)(7,"h1"),v.EFF(8),v.k0s(),v.j41(9,"p"),v.EFF(10),v.k0s()(),v.j41(11,"p"),v.EFF(12,"You can upload a photo from your device or take a new photo: "),v.k0s(),v.j41(13,"div",4)(14,"ion-button",5),v.bIt("click",function(){v.eBV(ki);const wt=v.sdS(19);return v.Njj(wt.click())}),v.nrm(15,"ion-icon",6),v.j41(16,"ion-label"),v.EFF(17,"Choose Photo.."),v.k0s()(),v.j41(18,"input",7,0),v.bIt("change",function(){return v.eBV(ki),v.Njj(Dn.loadCameraOrLibraryImage())}),v.k0s()(),v.nrm(20,"canvas",8),v.DNE(21,ht,16,1,"ion-card",9),v.k0s()(),v.j41(22,"ion-footer")(23,"ion-toolbar")(24,"ion-buttons",10)(25,"ion-button",5),v.bIt("click",function(){return v.eBV(ki),v.Njj(Dn.cancel())}),v.nrm(26,"ion-icon",11),v.EFF(27," Cancel "),v.k0s()(),v.j41(28,"ion-buttons",12)(29,"ion-button",5),v.bIt("click",function(){return v.eBV(ki),v.Njj(Dn.performUpload())}),v.EFF(30," Upload "),v.nrm(31,"ion-icon",13),v.k0s()()()()}2&Ln&&(v.R7$(8),v.JRh(Dn.poi.AddressInfo.Title),v.R7$(2),v.JRh(Dn.poi.AddressInfo.AddressLine1),v.R7$(11),v.Y8G("ngIf",null!=Dn.imgData))},dependencies:[Ce.bT,De.BC,De.vS,me.Jm,me.QW,me.b_,me.I9,me.W9,me.M0,me.eU,me.iq,me.$w,me.uz,me.he,me.nf,me.BC,me.ai,me.Gw],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]})}return pt})();var be=B(1470);function Ye(pt,On){if(1&pt&&(v.j41(0,"ion-select-option",19),v.EFF(1),v.k0s()),2&pt){const Ze=On.$implicit;v.Y8G("value",Ze.ID),v.R7$(),v.JRh(Ze.Title)}}function Le(pt,On){if(1&pt&&(v.j41(0,"ion-select-option",19),v.EFF(1),v.k0s()),2&pt){const Ze=On.$implicit;v.Y8G("value",Ze.ID),v.R7$(),v.JRh(Ze.Title)}}let ot=(()=>{class pt{navParams;appManager;nav;zone;loadingController;modalController;logging;router;commentModel;poi;commentTypes;checkinTypes;constructor(Ze,Ln,Dn,ki,Fi,wt,te,ue){this.navParams=Ze,this.appManager=Ln,this.nav=Dn,this.zone=ki,this.loadingController=Fi,this.modalController=wt,this.logging=te,this.router=ue,this.commentModel={ChargePointID:this.navParams.get("id"),Comment:"",CheckinStatusTypeID:10,CommentTypeID:10,Rating:null},this.poi=this.navParams.get("poi"),this.commentTypes=Ln.referenceDataManager.getCommentTypes(!0,!0),this.checkinTypes=Ln.referenceDataManager.getCheckinStatusTypes(!0,!0)}onPageWillEnter(){}cancel(){this.modalController.dismiss()}add(){var Ze=this;return(0,Z.A)(function*(){const Ln=yield Ze.loadingController.create({message:"Sending .."});yield Ln.present(),(yield Ze.appManager.submitComment(Ze.commentModel).catch(ki=>{Ze.appManager.showToastNotification("There was a problem submitting your comment."),Ze.loadingController.dismiss(),Ze.appManager.analytics.appEvent("Comment","Failed")}))&&(Ze.logging.log("Comment submitted"),yield Ln.dismiss(),yield Ze.modalController.dismiss(),Ze.appManager.analytics.appEvent("Comment","Submitted"))})()}static \u0275fac=function(Ln){return new(Ln||pt)(v.rXU(a.y8),v.rXU(g.r),v.rXU(a.q9),v.rXU(v.SKi),v.rXU(me.Xi),v.rXU(me.W3),v.rXU(Ne.y),v.rXU(be.Ix))};static \u0275cmp=v.VBU({type:pt,selectors:[["ng-component"]],decls:53,vars:8,consts:[["color","primary"],[1,"comment-page","ion-padding"],[1,"banner"],[1,"ion-padding"],["position","stacked"],[3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","(optional comment)",3,"ngModelChange","ngModel"],["value","5"],["value","4"],["value","3"],["value","2"],["value","1"],["value",""],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],[3,"value"]],template:function(Ln,Dn){1&Ln&&(v.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),v.EFF(3," Add Comment "),v.k0s()()(),v.j41(4,"ion-content",1)(5,"div",2)(6,"h1"),v.EFF(7),v.k0s(),v.j41(8,"p"),v.EFF(9),v.k0s()(),v.j41(10,"p",3),v.EFF(11,"Recent Check-ins are a big help to other drivers when planning their journey. Tell everyone what you thought about this charging location. "),v.k0s(),v.j41(12,"ion-list")(13,"ion-item")(14,"ion-label",4),v.EFF(15,"Comment Type"),v.k0s(),v.j41(16,"ion-select",5),v.mxI("ngModelChange",function(Fi){return v.DH7(Dn.commentModel.CommentTypeID,Fi)||(Dn.commentModel.CommentTypeID=Fi),Fi}),v.DNE(17,Ye,2,2,"ion-select-option",6),v.k0s()(),v.j41(18,"ion-item")(19,"ion-label",4),v.EFF(20,"What Did You Think?"),v.k0s(),v.j41(21,"ion-input",7),v.mxI("ngModelChange",function(Fi){return v.DH7(Dn.commentModel.Comment,Fi)||(Dn.commentModel.Comment=Fi),Fi}),v.k0s()(),v.j41(22,"ion-item")(23,"ion-label",4),v.EFF(24,"Did You Successfully Charge?"),v.k0s(),v.j41(25,"ion-select",5),v.mxI("ngModelChange",function(Fi){return v.DH7(Dn.commentModel.CheckinStatusTypeID,Fi)||(Dn.commentModel.CheckinStatusTypeID=Fi),Fi}),v.DNE(26,Le,2,2,"ion-select-option",6),v.k0s()(),v.j41(27,"ion-item")(28,"ion-label",4),v.EFF(29,"Your Rating"),v.k0s(),v.j41(30,"ion-select",5),v.mxI("ngModelChange",function(Fi){return v.DH7(Dn.commentModel.Rating,Fi)||(Dn.commentModel.Rating=Fi),Fi}),v.j41(31,"ion-select-option",8),v.EFF(32,"5 - Excellent"),v.k0s(),v.j41(33,"ion-select-option",9),v.EFF(34,"4 - Good"),v.k0s(),v.j41(35,"ion-select-option",10),v.EFF(36,"3 - Average"),v.k0s(),v.j41(37,"ion-select-option",11),v.EFF(38,"2 - Not Good"),v.k0s(),v.j41(39,"ion-select-option",12),v.EFF(40,"1 - Bad"),v.k0s(),v.j41(41,"ion-select-option",13),v.EFF(42,"Not Rated"),v.k0s()()()()(),v.j41(43,"ion-footer")(44,"ion-toolbar")(45,"ion-buttons",14)(46,"ion-button",15),v.bIt("click",function(){return Dn.cancel()}),v.nrm(47,"ion-icon",16),v.EFF(48," Cancel "),v.k0s()(),v.j41(49,"ion-buttons",17)(50,"ion-button",15),v.bIt("click",function(){return Dn.add()}),v.EFF(51," Submit "),v.nrm(52,"ion-icon",18),v.k0s()()()()),2&Ln&&(v.R7$(7),v.JRh(Dn.poi.AddressInfo.Title),v.R7$(2),v.JRh(Dn.poi.AddressInfo.AddressLine1),v.R7$(7),v.R50("ngModel",Dn.commentModel.CommentTypeID),v.R7$(),v.Y8G("ngForOf",Dn.commentTypes),v.R7$(4),v.R50("ngModel",Dn.commentModel.Comment),v.R7$(4),v.R50("ngModel",Dn.commentModel.CheckinStatusTypeID),v.R7$(),v.Y8G("ngForOf",Dn.checkinTypes),v.R7$(4),v.R50("ngModel",Dn.commentModel.Rating))},dependencies:[Ce.Sq,De.BC,De.vS,me.Jm,me.QW,me.W9,me.M0,me.eU,me.iq,me.$w,me.uz,me.he,me.nf,me.Nm,me.Ip,me.BC,me.ai,me.Je,me.Gw],encapsulation:2})}return pt})();var Ve=B(9025),Ue=B(5040),$t=B(4740),nt=B(8927),xt=B(5517),ct=B(4842),Mt=B(8280);function $e(pt,On){if(1&pt&&(v.j41(0,"div")(1,"small"),v.EFF(2),v.k0s()()),2&pt){const Ze=v.XpG(2);v.R7$(2),v.JRh(Ze.connectionSummary)}}function Et(pt,On){if(1&pt&&(v.j41(0,"div")(1,"small"),v.EFF(2),v.k0s()()),2&pt){const Ze=v.XpG(2);v.R7$(2),v.JRh(Ze.poi.OperatorInfo.Title)}}function cn(pt,On){1&pt&&(v.j41(0,"div")(1,"small"),v.EFF(2,"[Submission Awaiting Review]"),v.k0s()())}function fn(pt,On){if(1&pt){const Ze=v.RV6();v.qex(0),v.j41(1,"ion-button",30),v.bIt("click",function(){v.eBV(Ze);const Dn=v.XpG(2);return v.Njj(Dn.addFavourite())}),v.nrm(2,"ion-icon",31),v.j41(3,"ion-label"),v.EFF(4,"Favourite"),v.k0s()(),v.j41(5,"ion-button",32),v.bIt("click",function(){v.eBV(Ze);const Dn=v.XpG(2);return v.Njj(Dn.edit())}),v.nrm(6,"ion-icon",33),v.j41(7,"ion-label"),v.EFF(8,"Edit"),v.k0s()(),v.bVm()}}function Kn(pt,On){if(1&pt){const Ze=v.RV6();v.qex(0),v.j41(1,"ion-button",34),v.bIt("click",function(){v.eBV(Ze);const Dn=v.XpG(2);return v.Njj(Dn.launchNavigation())}),v.nrm(2,"ion-icon",35),v.j41(3,"ion-label"),v.EFF(4,"Navigate"),v.k0s()(),v.bVm()}}function Kt(pt,On){if(1&pt){const Ze=v.RV6();v.qex(0),v.j41(1,"ion-button",36),v.bIt("click",function(){v.eBV(Ze);const Dn=v.XpG(2);return v.Njj(Dn.addComment())}),v.nrm(2,"ion-icon",37),v.j41(3,"ion-label"),v.EFF(4,"Add Comment"),v.k0s()(),v.bVm()}}function at(pt,On){if(1&pt){const Ze=v.RV6();v.qex(0),v.j41(1,"ion-button",38),v.bIt("click",function(){v.eBV(Ze);const Dn=v.XpG(2);return v.Njj(Dn.addMedia())}),v.nrm(2,"ion-icon",39),v.j41(3,"ion-label"),v.EFF(4," Add Photo"),v.k0s()(),v.bVm()}}function ve(pt,On){if(1&pt&&(v.j41(0,"div"),v.EFF(1),v.k0s()),2&pt){const Ze=v.XpG(4);v.R7$(),v.SpI(" ",Ze.poi.AddressInfo.AddressLine1,"")}}function Me(pt,On){if(1&pt&&(v.j41(0,"div"),v.EFF(1),v.k0s()),2&pt){const Ze=v.XpG(4);v.R7$(),v.SpI(" ",Ze.poi.AddressInfo.AddressLine2,"")}}function fe(pt,On){if(1&pt&&(v.j41(0,"div"),v.EFF(1),v.k0s()),2&pt){const Ze=v.XpG(4);v.R7$(),v.SpI(" ",Ze.poi.AddressInfo.Town,"")}}function vt(pt,On){if(1&pt&&(v.j41(0,"div"),v.EFF(1),v.k0s()),2&pt){const Ze=v.XpG(4);v.R7$(),v.SpI(" ",Ze.poi.AddressInfo.StateOrProvince,"")}}function _n(pt,On){if(1&pt&&(v.j41(0,"div"),v.EFF(1),v.k0s()),2&pt){const Ze=v.XpG(4);v.R7$(),v.SpI(" ",Ze.poi.AddressInfo.Postcode,"")}}function Re(pt,On){if(1&pt&&(v.j41(0,"div"),v.EFF(1),v.k0s()),2&pt){const Ze=v.XpG(4);v.R7$(),v.SpI(" ",Ze.poi.AddressInfo.Country.Title,"")}}function wn(pt,On){if(1&pt&&(v.j41(0,"p"),v.EFF(1),v.k0s()),2&pt){const Ze=v.XpG(4);v.R7$(),v.SpI(" ",Ze.poi.AddressInfo.AccessComments," ")}}function it(pt,On){if(1&pt&&(v.j41(0,"p"),v.nrm(1,"ion-icon",44),v.j41(2,"span",42),v.EFF(3),v.k0s()()),2&pt){const Ze=v.XpG(4);v.R7$(3),v.JRh(Ze.poi.AddressInfo.ContactTelephone1)}}function tn(pt,On){if(1&pt&&(v.j41(0,"p"),v.nrm(1,"ion-icon",44),v.j41(2,"span",42),v.EFF(3),v.k0s()()),2&pt){const Ze=v.XpG(4);v.R7$(3),v.JRh(Ze.poi.AddressInfo.ContactTelephone2)}}function bn(pt,On){if(1&pt&&(v.j41(0,"p"),v.nrm(1,"ion-icon",45),v.j41(2,"span",42),v.EFF(3),v.k0s()()),2&pt){const Ze=v.XpG(4);v.R7$(3),v.JRh(Ze.poi.AddressInfo.ContactEmail)}}function Jn(pt,On){if(1&pt&&(v.j41(0,"p"),v.nrm(1,"ion-icon",46),v.j41(2,"span",42)(3,"a",47),v.EFF(4),v.k0s()()()),2&pt){const Ze=v.XpG(4);v.R7$(3),v.FS9("href",Ze.poi.AddressInfo.RelatedURL,v.B4B),v.R7$(),v.JRh(Ze.poi.AddressInfo.RelatedURL)}}function jn(pt,On){if(1&pt&&(v.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-subtitle"),v.EFF(3),v.nI1(4,"translate"),v.k0s()(),v.j41(5,"ion-card-content")(6,"ion-grid")(7,"ion-row")(8,"ion-col")(9,"ion-label"),v.EFF(10),v.nI1(11,"translate"),v.k0s(),v.j41(12,"div",42),v.DNE(13,ve,2,1,"div",0)(14,Me,2,1,"div",0)(15,fe,2,1,"div",0)(16,vt,2,1,"div",0)(17,_n,2,1,"div",0)(18,Re,2,1,"div",0),v.k0s()(),v.j41(19,"ion-col"),v.DNE(20,wn,2,1,"p",0)(21,it,4,1,"p",0)(22,tn,4,1,"p",0)(23,bn,4,1,"p",0)(24,Jn,5,2,"p",0),v.k0s()(),v.j41(25,"ion-row")(26,"ion-col")(27,"ion-label",43),v.EFF(28),v.nI1(29,"number"),v.nI1(30,"number"),v.k0s()()()()()()),2&pt){const Ze=v.XpG(3);v.R7$(3),v.SpI(" ",v.bMT(4,15,"ocm.details.location.sectionTitle")," "),v.R7$(7),v.SpI(" ",v.bMT(11,17,"ocm.details.location.address"),""),v.R7$(3),v.Y8G("ngIf",Ze.poi.AddressInfo.AddressLine1),v.R7$(),v.Y8G("ngIf",Ze.poi.AddressInfo.AddressLine2),v.R7$(),v.Y8G("ngIf",Ze.poi.AddressInfo.Town),v.R7$(),v.Y8G("ngIf",Ze.poi.AddressInfo.StateOrProvince),v.R7$(),v.Y8G("ngIf",Ze.poi.AddressInfo.Postcode),v.R7$(),v.Y8G("ngIf",Ze.poi.AddressInfo.Country),v.R7$(2),v.Y8G("ngIf",Ze.poi.AddressInfo.AccessComments),v.R7$(),v.Y8G("ngIf",Ze.poi.AddressInfo.ContactTelephone1),v.R7$(),v.Y8G("ngIf",Ze.poi.AddressInfo.ContactTelephone2),v.R7$(),v.Y8G("ngIf",Ze.poi.AddressInfo.ContactEmail),v.R7$(),v.Y8G("ngIf",Ze.poi.AddressInfo.RelatedURL),v.R7$(4),v.Lme(" Lat/Long: ",v.i5U(29,19,Ze.poi.AddressInfo.Latitude,"1.1-6")," , ",v.i5U(30,22,Ze.poi.AddressInfo.Longitude,"1.1-6")," ")}}function _i(pt,On){if(1&pt&&(v.j41(0,"p")(1,"span",48),v.EFF(2),v.nI1(3,"translate"),v.k0s(),v.j41(4,"span",42),v.EFF(5),v.k0s()()),2&pt){const Ze=v.XpG(3);v.R7$(2),v.SpI("",v.bMT(3,2,"ocm.details.numberOfPoints"),":"),v.R7$(3),v.JRh(Ze.poi.NumberOfPoints)}}function ut(pt,On){if(1&pt&&(v.j41(0,"p")(1,"span",48),v.EFF(2),v.nI1(3,"translate"),v.k0s(),v.j41(4,"span",42),v.EFF(5),v.k0s()()),2&pt){const Ze=v.XpG(3);v.R7$(2),v.SpI("",v.bMT(3,2,"ocm.details.operationalStatus"),":"),v.R7$(3),v.SpI(" ",Ze.poi.StatusType.Title," ")}}function nn(pt,On){if(1&pt&&(v.j41(0,"p")(1,"span",48),v.EFF(2),v.nI1(3,"translate"),v.k0s(),v.j41(4,"span",42),v.EFF(5),v.k0s()()),2&pt){const Ze=v.XpG(3);v.R7$(2),v.SpI("",v.bMT(3,2,"ocm.details.usageType"),":"),v.R7$(3),v.JRh(Ze.poi.UsageType.Title)}}function ui(pt,On){if(1&pt&&(v.j41(0,"p")(1,"span",48),v.EFF(2),v.nI1(3,"translate"),v.k0s(),v.j41(4,"span",42),v.EFF(5),v.k0s()()),2&pt){const Ze=v.XpG(3);v.R7$(2),v.SpI("",v.bMT(3,2,"ocm.details.usageCost"),":"),v.R7$(3),v.SpI(" ",Ze.poi.UsageCost,"")}}function pn(pt,On){if(1&pt&&(v.j41(0,"p"),v.nrm(1,"br"),v.EFF(2),v.nI1(3,"translate"),v.nrm(4,"br"),v.j41(5,"span",42),v.EFF(6),v.k0s()()),2&pt){const Ze=v.XpG(3);v.R7$(2),v.SpI("",v.bMT(3,2,"ocm.details.generalComments"),": "),v.R7$(4),v.JRh(Ze.poi.GeneralComments)}}function An(pt,On){if(1&pt&&(v.j41(0,"p"),v.nrm(1,"ion-icon",50),v.EFF(2),v.k0s()),2&pt){const Ze=v.XpG(4);v.R7$(2),v.SpI(" ",Ze.poi.OperatorInfo.WebsiteURL," ")}}function Ct(pt,On){if(1&pt&&(v.j41(0,"p"),v.nrm(1,"ion-icon",45),v.EFF(2),v.k0s()),2&pt){const Ze=v.XpG(4);v.R7$(2),v.SpI(" ",Ze.poi.OperatorInfo.ContactEmail," ")}}function Qt(pt,On){if(1&pt&&(v.j41(0,"p"),v.nrm(1,"ion-icon",45),v.EFF(2),v.k0s()),2&pt){const Ze=v.XpG(4);v.R7$(2),v.SpI(" ",Ze.poi.OperatorInfo.FaultReportEmail," ")}}function Se(pt,On){if(1&pt&&(v.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-subtitle"),v.EFF(3),v.nI1(4,"translate"),v.k0s()(),v.j41(5,"ion-card-content")(6,"div",42)(7,"p",49),v.EFF(8),v.k0s(),v.DNE(9,An,3,1,"p",0)(10,Ct,3,1,"p",0)(11,Qt,3,1,"p",0),v.k0s()()()),2&pt){const Ze=v.XpG(3);v.R7$(3),v.SpI(" ",v.bMT(4,5,"ocm.details.operator.sectionTitle")," "),v.R7$(5),v.SpI(" ",Ze.poi.OperatorInfo.Title," "),v.R7$(),v.Y8G("ngIf",Ze.poi.OperatorInfo.WebsiteURL),v.R7$(),v.Y8G("ngIf",null!=Ze.poi.OperatorInfo.ContactEmail),v.R7$(),v.Y8G("ngIf",null!=Ze.poi.OperatorInfo.FaultReportEmail&&Ze.poi.OperatorInfo.FaultReportEmail!=Ze.poi.OperatorInfo.ContactEmail)}}function Bt(pt,On){if(1&pt){const Ze=v.RV6();v.j41(0,"a",52),v.bIt("click",function(){v.eBV(Ze);const Dn=v.XpG(4);return v.Njj(Dn.launchURL(Dn.poi.DataProvider.WebsiteURL))}),v.EFF(1),v.k0s()}if(2&pt){const Ze=v.XpG(4);v.R7$(),v.JRh(Ze.poi.DataProvider.WebsiteURL)}}function Nt(pt,On){if(1&pt&&(v.j41(0,"div",42)(1,"h3"),v.EFF(2),v.nI1(3,"translate"),v.k0s(),v.j41(4,"p"),v.EFF(5),v.k0s(),v.DNE(6,Bt,2,1,"a",51),v.j41(7,"p"),v.EFF(8),v.k0s()()),2&pt){const Ze=v.XpG(3);v.R7$(2),v.SpI(" ",v.bMT(3,4,"ocm.details.dataProvider.sectionTitle")," "),v.R7$(3),v.JRh(null==Ze.poi.DataProvider?null:Ze.poi.DataProvider.Title),v.R7$(),v.Y8G("ngIf",Ze.poi.DataProvider.WebsiteURL),v.R7$(2),v.JRh(null==Ze.poi.DataProvider?null:Ze.poi.DataProvider.License)}}function Rn(pt,On){if(1&pt&&(v.j41(0,"div"),v.DNE(1,jn,31,25,"ion-card",0),v.j41(2,"ion-card")(3,"ion-card-header")(4,"ion-card-subtitle"),v.EFF(5),v.nI1(6,"translate"),v.k0s()(),v.j41(7,"ion-card-content"),v.DNE(8,_i,6,4,"p",0),v.nrm(9,"app-equipment-details",40),v.k0s()(),v.j41(10,"ion-card")(11,"ion-card-header")(12,"ion-card-subtitle"),v.EFF(13,"Usage Restrictions"),v.k0s()(),v.j41(14,"ion-card-content"),v.DNE(15,ut,6,4,"p",0)(16,nn,6,4,"p",0)(17,ui,6,4,"p",0)(18,pn,7,4,"p",0),v.k0s()(),v.DNE(19,Se,12,7,"ion-card",0),v.j41(20,"ion-card")(21,"ion-card-header"),v.EFF(22),v.nI1(23,"translate"),v.k0s(),v.j41(24,"ion-card-content"),v.DNE(25,Nt,9,6,"div",41),v.k0s()()()),2&pt){const Ze=v.XpG(2);v.R7$(),v.Y8G("ngIf",Ze.poi.AddressInfo),v.R7$(4),v.SpI(" ",v.bMT(6,11,"ocm.details.equipment.sectionTitle")," "),v.R7$(3),v.Y8G("ngIf",null!=Ze.poi.NumberOfPoints),v.R7$(),v.Y8G("item",Ze.poi),v.R7$(6),v.Y8G("ngIf",null!=Ze.poi.StatusType),v.R7$(),v.Y8G("ngIf",null!=Ze.poi.UsageType),v.R7$(),v.Y8G("ngIf",null!=Ze.poi.UsageCost),v.R7$(),v.Y8G("ngIf",null!=Ze.poi.GeneralComments),v.R7$(),v.Y8G("ngIf",Ze.poi.OperatorInfo),v.R7$(3),v.SpI(" ",v.bMT(23,13,"ocm.details.advancedDetails")," "),v.R7$(3),v.Y8G("ngIf",Ze.poi.DataProvider)}}function Ci(pt,On){if(1&pt&&v.nrm(0,"img",55),2&pt){const Ze=v.XpG().$implicit;v.FS9("src",null==Ze.User?null:Ze.User.ProfileImageURL,v.B4B)}}function Oi(pt,On){if(1&pt&&(v.j41(0,"span"),v.EFF(1),v.k0s()),2&pt){const Ze=v.XpG().$implicit;v.R7$(),v.JRh(Ze.User.Username)}}function ei(pt,On){if(1&pt&&(v.j41(0,"span"),v.EFF(1),v.k0s()),2&pt){const Ze=v.XpG().$implicit;v.R7$(),v.JRh(Ze.Username)}}function no(pt,On){if(1&pt&&(v.j41(0,"p",42),v.EFF(1),v.k0s()),2&pt){const Ze=v.XpG().$implicit;v.R7$(),v.SpI(" ",null==Ze.CommentType?null:Ze.CommentType.Title," ")}}function mo(pt,On){if(1&pt&&(v.j41(0,"p")(1,"span",48),v.EFF(2,"Rating:"),v.k0s(),v.j41(3,"span",42),v.EFF(4),v.k0s()()),2&pt){const Ze=v.XpG().$implicit;v.R7$(4),v.SpI("",Ze.Rating," out of 5")}}function mr(pt,On){1&pt&&(v.qex(0),v.nrm(1,"ion-icon",56),v.bVm())}function $n(pt,On){1&pt&&(v.qex(0),v.nrm(1,"ion-icon",57),v.bVm())}function ar(pt,On){if(1&pt&&(v.j41(0,"p"),v.DNE(1,mr,2,0,"ng-container",0)(2,$n,2,0,"ng-container",0),v.EFF(3),v.k0s()),2&pt){const Ze=v.XpG().$implicit;v.R7$(),v.Y8G("ngIf",!0===Ze.CheckinStatusType.IsPositive),v.R7$(),v.Y8G("ngIf",!1===Ze.CheckinStatusType.IsPositive),v.R7$(),v.SpI(" ",Ze.CheckinStatusType.Title," ")}}function gn(pt,On){if(1&pt&&(v.j41(0,"ion-card")(1,"ion-item")(2,"ion-avatar",23),v.DNE(3,Ci,1,1,"img",54),v.k0s(),v.j41(4,"ion-label"),v.DNE(5,Oi,2,1,"span",0)(6,ei,2,1,"span",0),v.k0s(),v.j41(7,"ion-label",24),v.EFF(8),v.nI1(9,"date"),v.k0s()(),v.j41(10,"ion-card-content")(11,"p"),v.EFF(12),v.k0s(),v.DNE(13,no,2,1,"p",41)(14,mo,5,1,"p",0)(15,ar,4,3,"p",0),v.k0s()()),2&pt){const Ze=On.$implicit;v.R7$(3),v.Y8G("ngIf",Ze.User&&Ze.User.ProfileImageURL),v.R7$(2),v.Y8G("ngIf",Ze.User),v.R7$(),v.Y8G("ngIf",!Ze.User),v.R7$(2),v.SpI(" ",v.bMT(9,8,Ze.DateCreated)," "),v.R7$(4),v.JRh(Ze.Comment),v.R7$(),v.Y8G("ngIf",10!=Ze.CommentTypeID),v.R7$(),v.Y8G("ngIf",Ze.Rating),v.R7$(),v.Y8G("ngIf",Ze.CheckinStatusType)}}function ii(pt,On){if(1&pt&&(v.qex(0),v.DNE(1,gn,16,10,"ion-card",53),v.bVm()),2&pt){const Ze=v.XpG(3);v.R7$(),v.Y8G("ngForOf",Ze.poi.UserComments)}}function oi(pt,On){1&pt&&(v.qex(0),v.j41(1,"ion-card")(2,"ion-card-content")(3,"p"),v.EFF(4),v.nI1(5,"translate"),v.k0s()()(),v.bVm()),2&pt&&(v.R7$(4),v.SpI(" ",v.bMT(5,1,"ocm.details.commentsAndRatings.addPrompt")," "))}function Yi(pt,On){if(1&pt&&(v.j41(0,"div"),v.DNE(1,ii,2,1,"ng-container",0)(2,oi,6,3,"ng-container",0),v.k0s()),2&pt){const Ze=v.XpG(2);v.R7$(),v.Y8G("ngIf",1==Ze.poi._hasComments),v.R7$(),v.Y8G("ngIf",0==Ze.poi._hasComments)}}function pr(pt,On){if(1&pt&&v.nrm(0,"img",55),2&pt){const Ze=v.XpG().$implicit;v.FS9("src",null==Ze.User?null:Ze.User.ProfileImageURL,v.B4B)}}function io(pt,On){if(1&pt&&(v.j41(0,"span"),v.EFF(1),v.k0s()),2&pt){const Ze=v.XpG().$implicit;v.R7$(),v.JRh(Ze.User.Username)}}function ao(pt,On){if(1&pt&&(v.j41(0,"span"),v.EFF(1),v.k0s()),2&pt){const Ze=v.XpG().$implicit;v.R7$(),v.JRh(Ze.Username)}}function ro(pt,On){if(1&pt&&(v.j41(0,"ion-card"),v.nrm(1,"img",55),v.j41(2,"ion-item")(3,"ion-avatar",23),v.DNE(4,pr,1,1,"img",54),v.k0s(),v.j41(5,"ion-label"),v.DNE(6,io,2,1,"span",0)(7,ao,2,1,"span",0),v.k0s(),v.j41(8,"ion-label",24),v.EFF(9),v.nI1(10,"date"),v.k0s()(),v.j41(11,"ion-card-content")(12,"p"),v.EFF(13),v.k0s()()()),2&pt){const Ze=On.$implicit;v.R7$(),v.FS9("src",Ze.ItemMediumURL,v.B4B),v.R7$(3),v.Y8G("ngIf",Ze.User&&Ze.User.ProfileImageURL),v.R7$(2),v.Y8G("ngIf",Ze.User),v.R7$(),v.Y8G("ngIf",!Ze.User),v.R7$(2),v.SpI(" ",v.bMT(10,6,Ze.DateCreated)," "),v.R7$(4),v.JRh(Ze.Comment)}}function co(pt,On){if(1&pt&&(v.j41(0,"div"),v.DNE(1,ro,14,8,"ion-card",53),v.k0s()),2&pt){const Ze=v.XpG(3);v.R7$(),v.Y8G("ngForOf",Ze.poi.MediaItems)}}function Po(pt,On){1&pt&&(v.qex(0),v.j41(1,"ion-card")(2,"ion-card-content")(3,"p"),v.EFF(4),v.nI1(5,"translate"),v.k0s()()(),v.bVm()),2&pt&&(v.R7$(4),v.SpI(" ",v.bMT(5,1,"ocm.details.mediaItems.addPrompt")," "))}function go(pt,On){if(1&pt&&(v.j41(0,"div"),v.DNE(1,co,2,1,"div",0)(2,Po,6,3,"ng-container",0),v.k0s()),2&pt){const Ze=v.XpG(2);v.R7$(),v.Y8G("ngIf",Ze.poi._hasPhotos),v.R7$(),v.Y8G("ngIf",0==Ze.poi._hasPhotos)}}function bo(pt,On){if(1&pt&&(v.j41(0,"p",58),v.EFF(1),v.k0s()),2&pt){const Ze=v.XpG(2);v.R7$(),v.SpI(" ",Ze.json,"")}}function Bn(pt,On){if(1&pt){const Ze=v.RV6();v.j41(0,"div")(1,"div",1)(2,"div",2)(3,"h2"),v.EFF(4),v.k0s(),v.j41(5,"div")(6,"small"),v.EFF(7),v.k0s()(),v.DNE(8,$e,3,1,"div",0)(9,Et,3,1,"div",0)(10,cn,3,0,"div",0),v.j41(11,"ion-badge",3),v.EFF(12),v.nI1(13,"number"),v.k0s()(),v.j41(14,"ion-fab",4)(15,"ion-fab-button",5),v.bIt("click",function(){v.eBV(Ze);const Dn=v.XpG();return v.Njj(Dn.close())}),v.nrm(16,"ion-icon",6),v.k0s()(),v.j41(17,"ion-fab",7)(18,"ion-fab-button",8),v.nrm(19,"ion-icon",9),v.k0s(),v.j41(20,"ion-fab-list",10)(21,"ion-fab-button",11),v.bIt("click",function(){v.eBV(Ze);const Dn=v.XpG();return v.Njj(Dn.addComment())}),v.nrm(22,"ion-icon",12),v.k0s(),v.j41(23,"ion-fab-button",13),v.bIt("click",function(){v.eBV(Ze);const Dn=v.XpG();return v.Njj(Dn.addMedia())}),v.nrm(24,"ion-icon",14),v.k0s(),v.j41(25,"ion-fab-button",15),v.bIt("click",function(){v.eBV(Ze);const Dn=v.XpG();return v.Njj(Dn.addFavourite())}),v.nrm(26,"ion-icon",16),v.k0s(),v.j41(27,"ion-fab-button",17),v.bIt("click",function(){v.eBV(Ze);const Dn=v.XpG();return v.Njj(Dn.edit())}),v.nrm(28,"ion-icon",18),v.k0s(),v.j41(29,"ion-fab-button",19),v.bIt("click",function(){v.eBV(Ze);const Dn=v.XpG();return v.Njj(Dn.refresh())}),v.nrm(30,"ion-icon",20),v.k0s()()()(),v.j41(31,"ion-refresher",21),v.bIt("ionRefresh",function(Dn){v.eBV(Ze);const ki=v.XpG();return v.Njj(ki.refresh(Dn))}),v.nrm(32,"ion-refresher-content",22),v.k0s(),v.j41(33,"ion-toolbar")(34,"ion-buttons",23),v.DNE(35,fn,9,0,"ng-container",0),v.k0s(),v.j41(36,"ion-buttons",24),v.DNE(37,Kn,5,0,"ng-container",0)(38,Kt,5,0,"ng-container",0)(39,at,5,0,"ng-container",0),v.k0s()(),v.j41(40,"ion-segment",25),v.mxI("ngModelChange",function(Dn){v.eBV(Ze);const ki=v.XpG();return v.DH7(ki.selectedTab,Dn)||(ki.selectedTab=Dn),v.Njj(Dn)}),v.j41(41,"ion-segment-button",26)(42,"ion-label"),v.EFF(43," Details "),v.k0s()(),v.j41(44,"ion-segment-button",27)(45,"ion-label"),v.EFF(46),v.k0s()(),v.j41(47,"ion-segment-button",28)(48,"ion-label"),v.EFF(49),v.k0s()()(),v.DNE(50,Rn,26,15,"div",0)(51,Yi,3,2,"div",0)(52,go,3,2,"div",0)(53,bo,2,1,"p",29),v.k0s()}if(2&pt){const Ze=v.XpG();v.R7$(),v.xc7("background-image",Ze.backdropImage?"url("+Ze.backdropImage+")":""),v.R7$(3),v.SpI(" ",Ze.poi.AddressInfo.Title," "),v.R7$(3),v.SpI("OCM-",Ze.poi.ID,""),v.R7$(),v.Y8G("ngIf",Ze.connectionSummary),v.R7$(),v.Y8G("ngIf",Ze.poi.OperatorInfo),v.R7$(),v.Y8G("ngIf",1==Ze.poi.SubmissionStatusTypeID),v.R7$(2),v.JRh(v.i5U(13,19,Ze.avgRating,"1.1-1")),v.R7$(23),v.Y8G("ngIf","location"==Ze.selectedTab),v.R7$(2),v.Y8G("ngIf","location"==Ze.selectedTab),v.R7$(),v.Y8G("ngIf","comments"==Ze.selectedTab),v.R7$(),v.Y8G("ngIf","media"==Ze.selectedTab),v.R7$(),v.R50("ngModel",Ze.selectedTab),v.R7$(6),v.SpI("Comments (",Ze.poi.UserComments?Ze.poi.UserComments.length:0,")"),v.R7$(3),v.SpI(" Photos (",Ze.poi.MediaItems?Ze.poi.MediaItems.length:0,")"),v.R7$(),v.Y8G("ngIf","location"==Ze.selectedTab),v.R7$(),v.Y8G("ngIf","comments"==Ze.selectedTab),v.R7$(),v.Y8G("ngIf","media"==Ze.selectedTab),v.R7$(),v.Y8G("ngIf",1==Ze.appManager.isDebugMode)}}function Cn(pt,On){1&pt&&(v.j41(0,"div")(1,"h2"),v.EFF(2,"POI Not Found"),v.k0s(),v.j41(3,"p"),v.EFF(4,"The POI details could not be loaded."),v.k0s()())}let At=(()=>{class pt{appManager;nav;translate;logging;modalController;actionSheetController;poiManager;router;poi;selectedTab;json;hasNavBar=!1;backdropImage;avgRating;connectionSummary;constructor(Ze,Ln,Dn,ki,Fi,wt,te,ue){this.appManager=Ze,this.nav=Ln,this.translate=Dn,this.logging=ki,this.modalController=Fi,this.actionSheetController=wt,this.poiManager=te,this.router=ue}ngOnChanges(Ze){if(this.logging.log("In ngOnChanges of POI Details"),null!=this.poi&&null!=this.poi.AddressInfo){if(this.selectedTab="location",null!=this.poi.MediaItems&&this.poi.MediaItems.length>0){this.poi._hasPhotos=!0;for(let Ln of this.poi.MediaItems)Ln.ItemMediumURL=Ln.ItemThumbnailURL.replace(".thmb.",".medi.");this.backdropImage=this.poi.MediaItems[this.poi.MediaItems.length-1].ItemThumbnailURL.replace(".thmb.",".medi.")}else this.poi._hasPhotos=!1,this.backdropImage=null;if(null!=this.poi.UserComments&&this.poi.UserComments.length>0){this.poi._hasComments=!0;try{let Ln=this.poi.UserComments.filter(Dn=>Dn.Rating>0);if(Ln.length>0){let Dn=0;for(let ki of Ln)Dn+=ki.Rating;this.avgRating=Dn/Ln.length}else this.avgRating=null}catch{}}else this.poi._hasComments=!1;if(this.poi.Connections&&this.poi.Connections.length>0){let Ln="";for(let Dn of this.poi.Connections)-1==Ln.indexOf(Dn.ConnectionType.Title)&&(Ln+=(""!=Ln?", ":"")+Dn.ConnectionType.Title);this.connectionSummary=Ln}}}ngOnInit(){this.logging.log("In ngInit of POI Details")}get staticMapURL(){return"https://maps.googleapis.com/maps/api/staticmap?key="+(new Ve.o).googleMapsAPIKey+"&center="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude}get staticMapSize(){return 0===this.appManager.clientWidth?"240x100":this.appManager.clientWidth>=800?"640x100":this.appManager.clientWidth>=400?"400x100":"240x100"}continueAddComment(){var Ze=this;return(0,Z.A)(function*(){const Ln=yield Ze.modalController.create({component:ot,componentProps:{id:Ze.poi.ID,poi:Ze.poi}});setTimeout(()=>{Ze.refresh()},1e3),yield Ln.present()})()}addComment(){var Ze=this;return(0,Z.A)(function*(){if(Ze.appManager.isUserAuthenticated(!0))yield Ze.continueAddComment();else{const Ln=yield Ze.modalController.create({component:$t.q});Ln.onDidDismiss().then((0,Z.A)(function*(){Ze.appManager.isUserAuthenticated(!0)&&(yield Ze.continueAddComment())})),yield Ln.present()}})()}continueAddMedia(){var Ze=this;return(0,Z.A)(function*(){const Ln=yield Ze.modalController.create({component:He,componentProps:{id:Ze.poi.ID,poi:Ze.poi}});Ln.onDidDismiss().then(()=>{setTimeout(()=>{Ze.refresh()},1e3)}),yield Ln.present()})()}addMedia(){var Ze=this;return(0,Z.A)(function*(){if(Ze.appManager.isUserAuthenticated(!0))yield Ze.continueAddMedia();else{const Ln=yield Ze.modalController.create({component:$t.q});Ln.onDidDismiss().then((0,Z.A)(function*(){Ze.appManager.isUserAuthenticated(!0)&&(yield Ze.continueAddMedia())})),yield Ln.present()}})()}addFavourite(){var Ze=this;return(0,Z.A)(function*(){yield(yield Ze.actionSheetController.create({header:"Add Favourite",buttons:[{text:"Add to Journey",handler:()=>{Ze.modalController.create({component:We,componentProps:{poi:Ze.poi}}).then(Dn=>Dn.present())}},{text:"Cancel",role:"cancel",handler:()=>{}}]})).present()})()}launchNavigation(){this.appManager.isPlatform("ios")?this.appManager.launchWebPage("https://maps.apple.com/?ll="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude):this.appManager.launchWebPage("https://maps.google.com/?q="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude)}launchURL(Ze){this.appManager.launchWebPage(Ze)}continueEdit(){var Ze=this;return(0,Z.A)(function*(){const Ln=yield Ze.modalController.create({component:nt.r,componentProps:{id:Ze.poi.ID}});return Ln.onDidDismiss().then(Dn=>{Ze.refresh()}),yield Ln.present()})()}edit(){var Ze=this;return(0,Z.A)(function*(){if(xt.A.isFeatureEnabled("EDIT_POI"))if(Ze.appManager.isUserAuthenticated(!0))yield Ze.continueEdit();else{const Ln=yield Ze.modalController.create({component:$t.q});Ln.onDidDismiss().then((0,Z.A)(function*(){Ze.appManager.isUserAuthenticated(!0)&&(yield Ze.continueEdit())})),yield Ln.present()}else Ze.appManager.launchOCMWebPage("/poi/edit/"+Ze.poi.ID)})()}refresh(Ze=null){this.poi&&this.poiManager.getPOIById(this.poi.ID,!0,!0).then(Ln=>{Ln&&(this.poi=Ln,this.ngOnChanges(null)),Ze&&Ze.target.complete()})}close(){this.modalController.dismiss()}static \u0275fac=function(Ln){return new(Ln||pt)(v.rXU(g.r),v.rXU(a.q9),v.rXU(ct.c$),v.rXU(Ne.y),v.rXU(me.W3),v.rXU(me.GD),v.rXU(Ue.U),v.rXU(be.Ix))};static \u0275cmp=v.VBU({type:pt,selectors:[["poi-details"]],inputs:{poi:"poi"},features:[v.OA$],decls:2,vars:2,consts:[[4,"ngIf"],[1,"banner"],[1,"banner-content"],["color","primary","title","Average User Rating"],["vertical","top","horizontal","start","slot","fixed"],["size","small","color","medium",3,"click"],["name","close"],["vertical","top","horizontal","end","slot","fixed"],["size","small","color","success"],["name","add"],["side","bottom"],["title","Add a comment or charging check-in",3,"click"],["name","chatbubbles"],["title","Add a Photo",3,"click"],["name","camera"],["title","Add to Favourites",3,"click"],["name","star"],["title","Submit an Edit",3,"click"],["name","create"],["title","Refresh",3,"click"],["name","refresh"],["slot","fixed",3,"ionRefresh"],["pullingIcon","caret-down","pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refreshing..."],["slot","start"],["slot","end"],[3,"ngModelChange","ngModel"],["value","location","selected",""],["value","comments"],["value","media"],["style","white-space: pre-wrap;",4,"ngIf"],["size","small","title","Add to Favourites",3,"click"],["name","star","slot","start"],["size","small","title","Submit an Edit",3,"click"],["name","create","slot","start"],["size","small","title","Navigate to this location",3,"click"],["name","navigate","slot","start"],["size","small","title","Add a comment or charging check-in",3,"click"],["name","chatbubbles","slot","start"],["size","small","title","Add a Photo",3,"click"],["name","camera","slot","start"],[3,"item"],["class","details",4,"ngIf"],[1,"details"],[1,"details-minor"],["name","call"],["name","mail"],["name","globe"],["target","_system",3,"href"],[1,"label"],[1,"ion-padding-left"],["name","link"],["href","javascript:void(0)",3,"click",4,"ngIf"],["href","javascript:void(0)",3,"click"],[4,"ngFor","ngForOf"],[3,"src",4,"ngIf"],[3,"src"],["name","checkmark-circle","color","success",2,"font-size","2em"],["name","close-circle","color","danger"],[2,"white-space","pre-wrap"]],template:function(Ln,Dn){1&Ln&&v.DNE(0,Bn,54,22,"div",0)(1,Cn,5,0,"div",0),2&Ln&&(v.Y8G("ngIf",null!=Dn.poi&&null!=Dn.poi.AddressInfo),v.R7$(),v.Y8G("ngIf",null==Dn.poi||null==Dn.poi.AddressInfo))},dependencies:[Ce.Sq,Ce.bT,me.mC,me.In,me.Jm,me.QW,me.b_,me.I9,me.ME,me.HW,me.hU,me.Q8,me.YW,me.OL,me.lO,me.iq,me.uz,me.he,me.To,me.Ki,me.ln,me.Gp,me.eP,me.ai,me.Je,De.BC,De.vS,Mt.o,Ce.QX,Ce.vh,ct.D9],styles:[".banner[_ngcontent-%COMP%]{background-color:#4f712f;color:#ffffffec;padding:1em 3em 1em 6em;text-shadow:#000 1px 1px 1px;min-height:180px;background-size:cover}.banner[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.banner-content[_ngcontent-%COMP%]{padding-right:48px}p[_ngcontent-%COMP%]{display:block;padding:4px}"]})}return pt})(),an=(()=>{class pt{modalController;navParams;appManager;poi;hasNavbar=!1;constructor(Ze,Ln,Dn){this.modalController=Ze,this.navParams=Ln,this.appManager=Dn,this.poi=this.navParams.get("item"),this.appManager.analytics.viewEvent("POIDetails")}close(){this.modalController.dismiss()}static \u0275fac=function(Ln){return new(Ln||pt)(v.rXU(me.W3),v.rXU(a.y8),v.rXU(g.r))};static \u0275cmp=v.VBU({type:pt,selectors:[["ng-component"]],decls:2,vars:1,consts:[[1,"poi-details"],[3,"poi"]],template:function(Ln,Dn){1&Ln&&(v.j41(0,"ion-content",0),v.nrm(1,"poi-details",1),v.k0s()),2&Ln&&(v.R7$(),v.Y8G("poi",Dn.poi))},dependencies:[me.W9,At],styles:[".address-details[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:200px;width:auto}ion-label[_ngcontent-%COMP%]{overflow:inherit}ion-title[_ngcontent-%COMP%] > small[_ngcontent-%COMP%]{color:var(--ion-color-favorite)}"]})}return pt})()},4096:(vi,Vt,B)=>{"use strict";B.r(Vt),B.d(Vt,{PoiEditorPageModule:()=>Je});var g=B(177),v=B(9417),me=B(1470),a=B(9465),Z=B(8927),ie=B(4842),T=B(7606),Ce=B(3953);const De=[{path:"",component:Z.r}];let Je=(()=>{class re{static \u0275fac=function(We){return new(We||re)};static \u0275mod=Ce.$C({type:re});static \u0275inj=Ce.G2t({imports:[g.MD,v.YN,a.bv,ie.h,T.F,me.iI.forChild(De)]})}return re})()},8927:(vi,Vt,B)=>{"use strict";B.d(Vt,{r:()=>An});var g=B(467),v=B(4296),me=B(9093),a=B(5517),Z=B(5040),ie=B(6714),T=B(3953),Ce=B(3229),De=B(184),Je=B(3118),re=B(3458),ze=B(1626),je=B(177),We=B(9465);function Ne(Ct,Qt){if(1&Ct){const Se=T.RV6();T.qex(0),T.j41(1,"ion-note")(2,"p"),T.EFF(3," The closest address to this position is: "),T.k0s(),T.j41(4,"p")(5,"strong"),T.EFF(6),T.k0s(),T.nrm(7,"br"),T.EFF(8),T.nrm(9,"br"),T.j41(10,"ion-button",3),T.bIt("click",function(){T.eBV(Se);const Nt=T.XpG();return T.Njj(Nt.useAddressSelection())}),T.EFF(11,"Use this address below "),T.nrm(12,"ion-icon",4),T.k0s()()(),T.bVm()}if(2&Ct){const Se=T.XpG();T.R7$(6),T.JRh(Se.suggestedAddress.AddressLine1),T.R7$(2),T.LHq(" ",Se.suggestedAddress.AddressLine2," ",Se.suggestedAddress.Town," ",Se.suggestedAddress.StateOrProvince," ",Se.suggestedAddress.Postcode," ")}}let ht=(()=>{class Ct{mapping;events;logging;http;appManager;latitude;latitudeChange=new T.bkB;longitude;longitudeChange=new T.bkB;suggestedAddress=null;suggestedAddressChange=new T.bkB;onUseSuggestedAddress=new T.bkB;suggestedAddressAttribution=null;suggestedAddressAttributionChange=new T.bkB;originalMarkerPos;mapService;mapOptions;debouncedGecode;isMapInitialised=!1;constructor(Se,Bt,Nt,Rn,Ci){this.mapping=Se,this.events=Bt,this.logging=Nt,this.http=Rn,this.appManager=Ci}ngOnInit(){this.mapService=new De.$(this.events,this.logging,this.http),this.mapService.initAPI(),this.mapOptions=new Ce.v,this.mapOptions.mapType=this.appManager.searchSettings.MapType,this.mapOptions.onMapMoveCompleted=()=>{let Se;Se=this.mapService.getMapCenter(),Se.subscribe(Bt=>{Bt&&(this.latitude=Bt.coords.latitude,this.longitude=Bt.coords.longitude,this.latitudeChange.emit(this.latitude),this.longitudeChange.emit(this.longitude),this.getAddressForCurrentLatLng())})}}ngAfterContentInit(){this.focusMap()}ngOnDestroy(){this.mapService.disposeMap()}focusMap(){0==this.isMapInitialised&&this.mapService&&0!=this.latitude&&0!=this.longitude&&(this.isMapInitialised=!0,this.mapService.initMap("editor-map",this.mapOptions,null),this.mapService.setMapCenter(new me.Bk(this.latitude,this.longitude)),this.originalMarkerPos=new me.cW(this.latitude,this.longitude))}ngOnChanges(Se){this.focusMap()}getAddressForCurrentLatLng(){var Se=this;return(0,g.A)(function*(){Se.latitude&&Se.longitude&&Se.appManager.api.fetchReverseGeocodeResult(Se.latitude,Se.longitude).then(Bt=>{Bt.AddressInfo&&(Se.suggestedAddress=Bt.AddressInfo)})})()}useAddressSelection(){this.onUseSuggestedAddress.emit({suggestedAddress:this.suggestedAddress,attribution:this.suggestedAddressAttribution}),this.suggestedAddress=null,this.suggestedAddressAttribution=null}static \u0275fac=function(Bt){return new(Bt||Ct)(T.rXU(ie.X),T.rXU(re.s),T.rXU(Je.y),T.rXU(ze.Qq),T.rXU(v.r))};static \u0275cmp=T.VBU({type:Ct,selectors:[["app-poi-location-editor"]],inputs:{latitude:"latitude",longitude:"longitude"},outputs:{latitudeChange:"latitudeChange",longitudeChange:"longitudeChange",suggestedAddressChange:"suggestedAddressChange",onUseSuggestedAddress:"onUseSuggestedAddress",suggestedAddressAttributionChange:"suggestedAddressAttributionChange"},features:[T.OA$],decls:4,vars:1,consts:[[1,"instruction"],["id","editor-map"],[4,"ngIf"],["size","small",3,"click"],["slot","end","name","copy"]],template:function(Bt,Nt){1&Bt&&(T.j41(0,"p",0),T.EFF(1,"Drag the map to center the marker on the charging location:"),T.k0s(),T.nrm(2,"div",1),T.DNE(3,Ne,13,5,"ng-container",2)),2&Bt&&(T.R7$(3),T.Y8G("ngIf",Nt.suggestedAddress))},dependencies:[je.bT,We.Jm,We.iq,We.JI],styles:["#editor-map[_ngcontent-%COMP%]{border:1px solid gainsboro;background-color:gray;width:100%;height:128px}"]})}return Ct})();var He=B(3371),be=B(9417);function Ye(Ct,Qt){if(1&Ct&&(T.j41(0,"ion-select-option",18),T.EFF(1),T.k0s()),2&Ct){const Se=Qt.$implicit;T.Y8G("value",Se.ID),T.R7$(),T.JRh(Se.Title)}}function Le(Ct,Qt){if(1&Ct&&(T.j41(0,"ion-select-option",18),T.EFF(1),T.k0s()),2&Ct){const Se=Qt.$implicit;T.Y8G("value",Se.ID),T.R7$(),T.JRh(Se.Title)}}function ot(Ct,Qt){if(1&Ct&&(T.j41(0,"ion-select-option",18),T.EFF(1),T.k0s()),2&Ct){const Se=Qt.$implicit;T.Y8G("value",Se.ID),T.R7$(),T.JRh(Se.Title)}}let Ve=(()=>{class Ct{modalController;referenceDataManager;conn;useFilteredConnectionTypes=!0;useFilteredOperators=!0;constructor(Se,Bt){this.modalController=Se,this.referenceDataManager=Bt}get isAddMode(){return!(null!=this.conn&&this.conn.ID>0)}get connectionTypes(){return this.referenceDataManager.getConnectionTypes(this.useFilteredConnectionTypes)}get currentTypes(){return this.referenceDataManager.getOutputCurrentTypes()}get statusTypes(){return this.referenceDataManager.getStatusTypes().filter(Se=>1==Se.IsUserSelectable)}ngOnInit(){}save(){var Se=!0;null!=this.conn.Quantity&&(this.conn.Quantity<0||this.conn.Quantity>100||!Number.isInteger(this.conn.Quantity))&&(alert("Quantity must be a whole number, or leave it blank."),Se=!1),Se&&this.modalController.dismiss({item:this.conn})}cancel(){this.modalController.dismiss()}static \u0275fac=function(Bt){return new(Bt||Ct)(T.rXU(We.W3),T.rXU(He.r))};static \u0275cmp=T.VBU({type:Ct,selectors:[["app-poi-equipment-editor"]],decls:42,vars:13,consts:[[1,"ion-padding"],["label","Connection Type","label-placement","floating",3,"ngModelChange","ngModel"],["value","0"],[3,"value",4,"ngFor","ngForOf"],["label","Supply Type","label-placement","floating",3,"ngModelChange","ngModel"],["label","Power (kW)","label-placement","floating","type","number",3,"ngModelChange","ngModel"],["label","Amps","label-placement","floating","type","number",3,"ngModelChange","ngModel"],["label","Voltage","label-placement","floating","type","number",3,"ngModelChange","ngModel"],["label","Status","label-placement","floating",3,"ngModelChange","ngModel"],["label","Quantity Available","label-placement","floating","type","number",3,"ngModelChange","ngModel"],["label","Comment","label-placement","floating","type","text","placeholder","(optional) other comments",3,"ngModelChange","ngModel"],["label","Operators Reference","label-placement","floating","type","text","placeholder","(optional)",3,"ngModelChange","ngModel"],["slot","start"],[3,"click"],["name","close","slot","start"],["slot","end"],["color","success",3,"click"],["name","send","slot","end"],[3,"value"]],template:function(Bt,Nt){1&Bt&&(T.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),T.EFF(3),T.k0s()()(),T.j41(4,"ion-content",0)(5,"p"),T.EFF(6,"Please provide as much information as you can about the equipment. If you don't know then leave the field blank. At a minimum you should include the Connection Type and approximate Power kW (max)."),T.k0s(),T.j41(7,"ion-item")(8,"ion-select",1),T.mxI("ngModelChange",function(Ci){return T.DH7(Nt.conn.ConnectionTypeID,Ci)||(Nt.conn.ConnectionTypeID=Ci),Ci}),T.j41(9,"ion-select-option",2),T.EFF(10,"Unknown"),T.k0s(),T.DNE(11,Ye,2,2,"ion-select-option",3),T.k0s()(),T.j41(12,"ion-item")(13,"ion-select",4),T.mxI("ngModelChange",function(Ci){return T.DH7(Nt.conn.CurrentTypeID,Ci)||(Nt.conn.CurrentTypeID=Ci),Ci}),T.j41(14,"ion-select-option",2),T.EFF(15,"Unknown"),T.k0s(),T.DNE(16,Le,2,2,"ion-select-option",3),T.k0s()(),T.j41(17,"ion-item")(18,"ion-input",5),T.mxI("ngModelChange",function(Ci){return T.DH7(Nt.conn.PowerKW,Ci)||(Nt.conn.PowerKW=Ci),Ci}),T.k0s()(),T.j41(19,"ion-item")(20,"ion-input",6),T.mxI("ngModelChange",function(Ci){return T.DH7(Nt.conn.Amps,Ci)||(Nt.conn.Amps=Ci),Ci}),T.k0s()(),T.j41(21,"ion-item")(22,"ion-input",7),T.mxI("ngModelChange",function(Ci){return T.DH7(Nt.conn.Voltage,Ci)||(Nt.conn.Voltage=Ci),Ci}),T.k0s()(),T.j41(23,"ion-item")(24,"ion-select",8),T.mxI("ngModelChange",function(Ci){return T.DH7(Nt.conn.StatusTypeID,Ci)||(Nt.conn.StatusTypeID=Ci),Ci}),T.DNE(25,ot,2,2,"ion-select-option",3),T.k0s()(),T.j41(26,"ion-item")(27,"ion-input",9),T.mxI("ngModelChange",function(Ci){return T.DH7(Nt.conn.Quantity,Ci)||(Nt.conn.Quantity=Ci),Ci}),T.k0s()(),T.j41(28,"ion-item")(29,"ion-input",10),T.mxI("ngModelChange",function(Ci){return T.DH7(Nt.conn.Comments,Ci)||(Nt.conn.Comments=Ci),Ci}),T.k0s()(),T.j41(30,"ion-item")(31,"ion-input",11),T.mxI("ngModelChange",function(Ci){return T.DH7(Nt.conn.Reference,Ci)||(Nt.conn.Reference=Ci),Ci}),T.k0s()()(),T.j41(32,"ion-footer")(33,"ion-toolbar")(34,"ion-buttons",12)(35,"ion-button",13),T.bIt("click",function(){return Nt.cancel()}),T.nrm(36,"ion-icon",14),T.EFF(37," Cancel "),T.k0s()(),T.j41(38,"ion-buttons",15)(39,"ion-button",16),T.bIt("click",function(){return Nt.save()}),T.EFF(40," OK "),T.nrm(41,"ion-icon",17),T.k0s()()()()),2&Bt&&(T.R7$(3),T.JRh(Nt.isAddMode?"Add Equipment":"Edit Equipment"),T.R7$(5),T.R50("ngModel",Nt.conn.ConnectionTypeID),T.R7$(3),T.Y8G("ngForOf",Nt.connectionTypes),T.R7$(2),T.R50("ngModel",Nt.conn.CurrentTypeID),T.R7$(3),T.Y8G("ngForOf",Nt.currentTypes),T.R7$(2),T.R50("ngModel",Nt.conn.PowerKW),T.R7$(2),T.R50("ngModel",Nt.conn.Amps),T.R7$(2),T.R50("ngModel",Nt.conn.Voltage),T.R7$(2),T.R50("ngModel",Nt.conn.StatusTypeID),T.R7$(),T.Y8G("ngForOf",Nt.statusTypes),T.R7$(2),T.R50("ngModel",Nt.conn.Quantity),T.R7$(2),T.R50("ngModel",Nt.conn.Comments),T.R7$(2),T.R50("ngModel",Nt.conn.Reference))},dependencies:[je.Sq,We.Jm,We.QW,We.W9,We.M0,We.eU,We.iq,We.$w,We.uz,We.Nm,We.Ip,We.BC,We.ai,We.su,We.Je,We.Gw,be.BC,be.vS]})}return Ct})();var Ue=function(Ct){return Ct[Ct.Unknown=0]="Unknown",Ct[Ct.CurrentlyAvailable=10]="CurrentlyAvailable",Ct[Ct.CurrentlyInUse=20]="CurrentlyInUse",Ct[Ct.TemporarilyUnavailable=30]="TemporarilyUnavailable",Ct[Ct.Operational=50]="Operational",Ct[Ct.PartlyOperational=75]="PartlyOperational",Ct[Ct.NotOperational=100]="NotOperational",Ct[Ct.PlannedForFutureDate=150]="PlannedForFutureDate",Ct[Ct.RemovedDecomissioned=200]="RemovedDecomissioned",Ct}(Ue||{}),$t=function(Ct){return Ct[Ct.UnknownOperator=1]="UnknownOperator",Ct[Ct.SiteOwner=45]="SiteOwner",Ct}($t||{}),ct=B(7192),Mt=B(8280),$e=B(6509);function Et(Ct,Qt){1&Ct&&T.nrm(0,"ion-icon",14)}function cn(Ct,Qt){1&Ct&&T.nrm(0,"ion-icon",14)}function fn(Ct,Qt){1&Ct&&T.nrm(0,"ion-icon",14)}function Kn(Ct,Qt){if(1&Ct&&(T.j41(0,"ion-select-option",26),T.EFF(1),T.k0s()),2&Ct){const Se=Qt.$implicit;T.Y8G("value",Se.ID),T.R7$(),T.JRh(Se.Title)}}function Kt(Ct,Qt){if(1&Ct){const Se=T.RV6();T.qex(0),T.j41(1,"app-poi-location-editor",15,0),T.mxI("latitudeChange",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.DH7(Rn.item.AddressInfo.Latitude,Nt)||(Rn.item.AddressInfo.Latitude=Nt),T.Njj(Nt)})("longitudeChange",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.DH7(Rn.item.AddressInfo.Longitude,Nt)||(Rn.item.AddressInfo.Longitude=Nt),T.Njj(Nt)}),T.bIt("onUseSuggestedAddress",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.Njj(Rn.useSuggestedAddress(Nt))}),T.k0s(),T.j41(3,"ion-list")(4,"ion-item")(5,"ion-input",16),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.DH7(Rn.item.AddressInfo.Title,Nt)||(Rn.item.AddressInfo.Title=Nt),T.Njj(Nt)}),T.k0s()(),T.j41(6,"ion-item")(7,"ion-input",17),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.DH7(Rn.item.AddressInfo.AddressLine1,Nt)||(Rn.item.AddressInfo.AddressLine1=Nt),T.Njj(Nt)}),T.k0s()(),T.j41(8,"ion-item")(9,"ion-input",18),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.DH7(Rn.item.AddressInfo.AddressLine2,Nt)||(Rn.item.AddressInfo.AddressLine2=Nt),T.Njj(Nt)}),T.k0s()(),T.j41(10,"ion-item")(11,"ion-input",19),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.DH7(Rn.item.AddressInfo.Town,Nt)||(Rn.item.AddressInfo.Town=Nt),T.Njj(Nt)}),T.k0s()(),T.j41(12,"ion-item")(13,"ion-input",20),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.DH7(Rn.item.AddressInfo.StateOrProvince,Nt)||(Rn.item.AddressInfo.StateOrProvince=Nt),T.Njj(Nt)}),T.k0s()(),T.j41(14,"ion-item")(15,"ion-input",21),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.DH7(Rn.item.AddressInfo.Postcode,Nt)||(Rn.item.AddressInfo.Postcode=Nt),T.Njj(Nt)}),T.k0s()(),T.j41(16,"ion-item")(17,"ion-select",22),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.DH7(Rn.item.AddressInfo.CountryID,Nt)||(Rn.item.AddressInfo.CountryID=Nt),T.Njj(Nt)}),T.bIt("ionChange",function(){T.eBV(Se);const Nt=T.XpG(2);return T.Njj(Nt.onCountryChange())}),T.DNE(18,Kn,2,2,"ion-select-option",23),T.k0s()(),T.j41(19,"ion-item")(20,"ion-input",24),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.DH7(Rn.item.AddressInfo.Latitude,Nt)||(Rn.item.AddressInfo.Latitude=Nt),T.Njj(Nt)}),T.k0s()(),T.j41(21,"ion-item")(22,"ion-input",25),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.DH7(Rn.item.AddressInfo.Longitude,Nt)||(Rn.item.AddressInfo.Longitude=Nt),T.Njj(Nt)}),T.k0s()()(),T.bVm()}if(2&Ct){const Se=T.XpG(2);T.R7$(),T.R50("latitude",Se.item.AddressInfo.Latitude)("longitude",Se.item.AddressInfo.Longitude),T.R7$(4),T.R50("ngModel",Se.item.AddressInfo.Title),T.R7$(2),T.R50("ngModel",Se.item.AddressInfo.AddressLine1),T.R7$(2),T.R50("ngModel",Se.item.AddressInfo.AddressLine2),T.R7$(2),T.R50("ngModel",Se.item.AddressInfo.Town),T.R7$(2),T.R50("ngModel",Se.item.AddressInfo.StateOrProvince),T.R7$(2),T.R50("ngModel",Se.item.AddressInfo.Postcode),T.R7$(2),T.R50("ngModel",Se.item.AddressInfo.CountryID),T.R7$(),T.Y8G("ngForOf",Se.countries),T.R7$(2),T.R50("ngModel",Se.item.AddressInfo.Latitude),T.R7$(2),T.R50("ngModel",Se.item.AddressInfo.Longitude)}}function at(Ct,Qt){if(1&Ct){const Se=T.RV6();T.qex(0),T.j41(1,"h3"),T.EFF(2,"Locations Nearby"),T.k0s(),T.j41(3,"p")(4,"strong"),T.EFF(5,"The following locations already exist nearby."),T.k0s()(),T.j41(6,"div",27)(7,"p"),T.EFF(8,"Ensure you are not adding a duplicate site unless it is for different equipment from another network operator."),T.k0s(),T.j41(9,"p"),T.EFF(10,"You can edit any of these listings if required instead:"),T.k0s()(),T.j41(11,"app-poi-list",28),T.bIt("onEdit",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.Njj(Rn.editPOI(Nt))}),T.k0s(),T.bVm()}if(2&Ct){const Se=T.XpG(2);T.R7$(11),T.Y8G("poiList",Se.nearbySites)("enableEditOption",!0)}}function ve(Ct,Qt){if(1&Ct&&(T.qex(0),T.DNE(1,Kt,23,12,"ng-container",10)(2,at,12,2,"ng-container",10),T.bVm()),2&Ct){const Se=T.XpG();T.R7$(),T.Y8G("ngIf","location"==Se.step),T.R7$(),T.Y8G("ngIf","poi-nearby"==Se.step)}}function Me(Ct,Qt){if(1&Ct){const Se=T.RV6();T.qex(0),T.j41(1,"p"),T.EFF(2,"Copied the equipment configuration from:"),T.k0s(),T.j41(3,"ion-item")(4,"ion-label"),T.EFF(5),T.nrm(6,"br"),T.EFF(7),T.nrm(8,"br"),T.EFF(9),T.nrm(10,"br"),T.EFF(11),T.nrm(12,"br"),T.EFF(13),T.k0s(),T.j41(14,"ion-button",30),T.bIt("click",function(){T.eBV(Se);const Nt=T.XpG(5);return T.Njj(Nt.changeTemplatePOI())}),T.EFF(15,"Change.."),T.k0s()(),T.bVm()}if(2&Ct){const Se=T.XpG(5);T.R7$(5),T.SpI(" ",Se.selectedTemplatePOI.AddressInfo.Title," "),T.R7$(2),T.SpI(" ",Se.selectedTemplatePOI.AddressInfo.AddressLine1," "),T.R7$(2),T.SpI(" ",null==Se.selectedTemplatePOI.Connections[0].ConnectionType?null:Se.selectedTemplatePOI.Connections[0].ConnectionType.Title," "),T.R7$(2),T.SpI(" ",Se.selectedTemplatePOI.Connections[0].PowerKW," "),T.R7$(2),T.SpI(" ",Se.selectedTemplatePOI.DateCreated," ")}}function fe(Ct,Qt){if(1&Ct){const Se=T.RV6();T.qex(0),T.j41(1,"h4"),T.EFF(2,"Similar Sites"),T.k0s(),T.j41(3,"app-poi-list",31),T.bIt("onCopy",function(Nt){T.eBV(Se);const Rn=T.XpG(6);return T.Njj(Rn.useTemplatePOI(Nt))}),T.k0s(),T.bVm()}if(2&Ct){const Se=T.XpG(6);T.R7$(3),T.Y8G("enableCopyOption",!0)("poiList",Se.templateSites)}}function vt(Ct,Qt){1&Ct&&(T.qex(0),T.j41(1,"p"),T.EFF(2," There are no suggested sites to copy for this network operator. "),T.k0s(),T.bVm())}function _n(Ct,Qt){if(1&Ct&&(T.qex(0),T.DNE(1,fe,4,2,"ng-container",10)(2,vt,3,0,"ng-container",10),T.bVm()),2&Ct){const Se=T.XpG(5);T.R7$(),T.Y8G("ngIf",Se.templateSites.length>0),T.R7$(),T.Y8G("ngIf",0==Se.templateSites.length)}}function Re(Ct,Qt){if(1&Ct&&(T.qex(0),T.DNE(1,Me,16,5,"ng-container",10)(2,_n,3,2,"ng-container",10),T.bVm()),2&Ct){const Se=T.XpG(4);T.R7$(),T.Y8G("ngIf",Se.selectedTemplatePOI),T.R7$(),T.Y8G("ngIf",!Se.selectedTemplatePOI)}}function wn(Ct,Qt){if(1&Ct){const Se=T.RV6();T.qex(0),T.j41(1,"p",27),T.EFF(2,"You can copy the equipment settings from other sites operated by the same network operator or choose 'Next' to skip this step: "),T.k0s(),T.j41(3,"app-operator-lookup",29),T.bIt("operatorChanged",function(Nt){T.eBV(Se);const Rn=T.XpG(3);return T.Njj(Rn.onOperatorChange(Nt))}),T.k0s(),T.DNE(4,Re,3,2,"ng-container",10),T.bVm()}if(2&Ct){const Se=T.XpG(3);T.R7$(3),T.Y8G("operatorId",Se.item.OperatorID),T.R7$(),T.Y8G("ngIf",Se.item.AddressInfo.CountryID&&Se.item.OperatorID)}}function it(Ct,Qt){if(1&Ct&&(T.qex(0),T.DNE(1,wn,5,2,"ng-container",10),T.bVm()),2&Ct){const Se=T.XpG(2);T.R7$(),T.Y8G("ngIf",!Se.skipPOICopy)}}function tn(Ct,Qt){if(1&Ct){const Se=T.RV6();T.qex(0),T.j41(1,"app-operator-lookup",32),T.bIt("operatorChanged",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.Njj(Rn.onOperatorChange(Nt))}),T.k0s(),T.j41(2,"ion-item")(3,"ion-input",33),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.DH7(Rn.item.NumberOfPoints,Nt)||(Rn.item.NumberOfPoints=Nt),T.Njj(Nt)}),T.k0s()(),T.j41(4,"h4"),T.EFF(5,"Equipment"),T.k0s(),T.j41(6,"ion-button",34),T.bIt("click",function(){T.eBV(Se);const Nt=T.XpG(2);return T.Njj(Nt.addConnection())}),T.nrm(7,"ion-icon",35),T.k0s(),T.j41(8,"app-equipment-details",36),T.bIt("onEdit",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.Njj(Rn.editConnection(Nt))})("onDelete",function(Nt){T.eBV(Se);const Rn=T.XpG(2);return T.Njj(Rn.deleteConnection(Nt))}),T.k0s(),T.bVm()}if(2&Ct){const Se=T.XpG(2);T.R7$(),T.Y8G("operatorId",Se.item.OperatorID)("useFilteredOperators",!1),T.R7$(2),T.R50("ngModel",Se.item.NumberOfPoints),T.R7$(5),T.Y8G("item",Se.item)("enableEdit",!0)}}function bn(Ct,Qt){if(1&Ct&&(T.qex(0),T.DNE(1,it,2,1,"ng-container",10)(2,tn,9,5,"ng-container",10),T.bVm()),2&Ct){const Se=T.XpG();T.R7$(),T.Y8G("ngIf","copy-equipment"==Se.step),T.R7$(),T.Y8G("ngIf","edit-equipment"==Se.step)}}function Jn(Ct,Qt){if(1&Ct&&(T.j41(0,"p",46)(1,"strong"),T.EFF(2,"Your changes cannot be saved until the following issues are resolved:"),T.k0s(),T.j41(3,"ion-label",47),T.EFF(4),T.k0s()()),2&Ct){const Se=T.XpG(2);T.R7$(4),T.SpI(" ",Se.validationMsg,"")}}function jn(Ct,Qt){if(1&Ct&&(T.j41(0,"ion-select-option",26),T.EFF(1),T.k0s()),2&Ct){const Se=Qt.$implicit;T.Y8G("value",Se.ID),T.R7$(),T.JRh(Se.Title)}}function _i(Ct,Qt){if(1&Ct&&(T.j41(0,"ion-select-option",26),T.EFF(1),T.k0s()),2&Ct){const Se=Qt.$implicit;T.Y8G("value",Se.ID),T.R7$(),T.JRh(Se.Title)}}function ut(Ct,Qt){if(1&Ct){const Se=T.RV6();T.qex(0),T.DNE(1,Jn,5,1,"p",37),T.j41(2,"p"),T.EFF(3,"Please provide any other facts related to this site. Additional comments (your charging experiences etc) can be added as check-in comments once the site is listed."),T.k0s(),T.j41(4,"ion-item")(5,"ion-select",38),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG();return T.DH7(Rn.item.StatusTypeID,Nt)||(Rn.item.StatusTypeID=Nt),T.Njj(Nt)}),T.DNE(6,jn,2,2,"ion-select-option",23),T.k0s()(),T.j41(7,"ion-item")(8,"ion-select",39),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG();return T.DH7(Rn.item.UsageTypeID,Nt)||(Rn.item.UsageTypeID=Nt),T.Njj(Nt)}),T.DNE(9,_i,2,2,"ion-select-option",23),T.k0s()(),T.j41(10,"ion-item")(11,"ion-input",40),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG();return T.DH7(Rn.item.UsageCost,Nt)||(Rn.item.UsageCost=Nt),T.Njj(Nt)}),T.k0s()(),T.j41(12,"ion-item")(13,"ion-input",41),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG();return T.DH7(Rn.item.GeneralComments,Nt)||(Rn.item.GeneralComments=Nt),T.Njj(Nt)}),T.k0s()(),T.j41(14,"ion-item")(15,"ion-input",42),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG();return T.DH7(Rn.item.AddressInfo.ContactTelephone1,Nt)||(Rn.item.AddressInfo.ContactTelephone1=Nt),T.Njj(Nt)}),T.k0s()(),T.j41(16,"ion-item")(17,"ion-input",43),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG();return T.DH7(Rn.item.AddressInfo.ContactTelephone2,Nt)||(Rn.item.AddressInfo.ContactTelephone2=Nt),T.Njj(Nt)}),T.k0s()(),T.j41(18,"ion-item")(19,"ion-input",44),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG();return T.DH7(Rn.item.AddressInfo.AccessComments,Nt)||(Rn.item.AddressInfo.AccessComments=Nt),T.Njj(Nt)}),T.k0s()(),T.j41(20,"ion-item")(21,"ion-input",45),T.mxI("ngModelChange",function(Nt){T.eBV(Se);const Rn=T.XpG();return T.DH7(Rn.item.AddressInfo.RelatedURL,Nt)||(Rn.item.AddressInfo.RelatedURL=Nt),T.Njj(Nt)}),T.k0s()(),T.bVm()}if(2&Ct){const Se=T.XpG();T.R7$(),T.Y8G("ngIf",Se.validationMsg),T.R7$(4),T.R50("ngModel",Se.item.StatusTypeID),T.R7$(),T.Y8G("ngForOf",Se.statusTypes),T.R7$(2),T.R50("ngModel",Se.item.UsageTypeID),T.R7$(),T.Y8G("ngForOf",Se.usageTypes),T.R7$(2),T.R50("ngModel",Se.item.UsageCost),T.R7$(2),T.R50("ngModel",Se.item.GeneralComments),T.R7$(2),T.R50("ngModel",Se.item.AddressInfo.ContactTelephone1),T.R7$(2),T.R50("ngModel",Se.item.AddressInfo.ContactTelephone2),T.R7$(2),T.R50("ngModel",Se.item.AddressInfo.AccessComments),T.R7$(2),T.R50("ngModel",Se.item.AddressInfo.RelatedURL)}}function nn(Ct,Qt){if(1&Ct){const Se=T.RV6();T.j41(0,"ion-button",2),T.bIt("click",function(){T.eBV(Se);const Nt=T.XpG();return T.Njj(Nt.previous())}),T.EFF(1," Previous "),T.nrm(2,"ion-icon",48),T.k0s()}}function ui(Ct,Qt){if(1&Ct){const Se=T.RV6();T.j41(0,"ion-button",2),T.bIt("click",function(){T.eBV(Se);const Nt=T.XpG();return T.Njj(Nt.next())}),T.EFF(1," Next "),T.nrm(2,"ion-icon",49),T.k0s()}}function pn(Ct,Qt){if(1&Ct){const Se=T.RV6();T.j41(0,"ion-button",50),T.bIt("click",function(){T.eBV(Se);const Nt=T.XpG();return T.Njj(Nt.save())}),T.EFF(1," Submit "),T.nrm(2,"ion-icon",51),T.k0s()}}let An=(()=>{class Ct{appManager;modalController;poiManager;mapping;loadingController;alertController;id;item;step;selectedTab;startPos;useFilteredConnectionTypes=!0;templateSites=[];nearbySites=[];selectedTemplatePOI=null;suggestedAddress=null;suggestedAddressAttribution=null;isNonDuplicateConfirmed=!1;skipPOICopy=!1;validationMsg=null;loading;editorMap;get countries(){return this.appManager.referenceDataManager.getCountries()}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes()}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes().filter(Se=>1==Se.IsUserSelectable)}get isAddMode(){return this.item.ID<=0}constructor(Se,Bt,Nt,Rn,Ci,Oi){this.appManager=Se,this.modalController=Bt,this.poiManager=Nt,this.mapping=Rn,this.loadingController=Ci,this.alertController=Oi,this.initNewItem()}initNewItem(){this.item={ID:-1,DataProviderID:1,DataProvidersReference:null,OperatorsReference:null,OperatorID:1,UsageCost:null,UsageTypeID:4,NumberOfPoints:1,GeneralComments:null,DatePlanned:null,StatusTypeID:50,SubmissionStatusTypeID:null,Connections:[],MetadataValues:[],AddressInfo:{ID:-1,CountryID:18,Title:"",AddressLine1:"",Latitude:0,Longitude:0}},this.step="location",this.selectedTab="location"}get isReadyToSubmit(){return this.validate().isValid&&"info"==this.step}ngOnInit(){}presentLoadingUI(){var Se=this;return(0,g.A)(function*(){Se.loading=yield Se.loadingController.create({message:"Please Wait.."}),yield Se.loading.present()})()}dismissLoadingUI(){var Se=this;return(0,g.A)(function*(){Se.loading&&(yield Se.loading.dismiss())})()}ionViewDidEnter(){if(null!=this.id)this.editExistingPOI(this.id);else{let Se=localStorage.getItem("_editor-operatorid");Se&&(this.item.OperatorID=parseInt(Se,10)),this.startPos?(this.item.AddressInfo.Latitude=this.startPos.latitude,this.item.AddressInfo.Longitude=this.startPos.longitude):this.mapping&&this.mapping.getMapCenter().subscribe(Bt=>{Bt&&(this.item.AddressInfo.Latitude=Bt.coords.latitude,this.item.AddressInfo.Longitude=Bt.coords.longitude)})}this.refreshFilteredReferenceData()}previous(){var Se=this;return(0,g.A)(function*(){switch(Se.step){case"info":Se.step="edit-equipment";break;case"edit-equipment":Se.step=Se.isAddMode?"copy-equipment":"location";break;case"copy-equipment":case"poi-nearby":Se.step="location"}yield Se.initCurrentStep(!1)})()}next(){var Se=this;return(0,g.A)(function*(){if("poi-nearby"==Se.step&&Se.nearbySites.length>0&&!Se.isNonDuplicateConfirmed)return void(yield Se.alertController.create({header:"Confirm",message:"Please confirm you are not adding a duplicate site.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:Rn=>{}},{text:"Confirm",handler:()=>{Se.isNonDuplicateConfirmed=!0,Se.next()}}]})).present();const Bt=Se.validate(Se.step);if(Bt.isValid){switch(Se.step){case"location":Se.step=Se.isAddMode?"poi-nearby":"edit-equipment";break;case"poi-nearby":Se.step=Se.isAddMode?"copy-equipment":"edit-equipment";break;case"copy-equipment":Se.step="edit-equipment";break;case"edit-equipment":Se.step="info"}yield Se.initCurrentStep(!0)}else(yield Se.alertController.create({message:Bt.msg})).present()})()}initCurrentStep(Se){var Bt=this;return(0,g.A)(function*(){"poi-nearby"==Bt.step?(Bt.selectedTab="location",0==(yield Bt.refreshNearbySites())&&(Se?yield Bt.next():yield Bt.previous())):"location"==Bt.step?Bt.selectedTab="location":"copy-equipment"==Bt.step?(Bt.selectedTab="equipment",yield Bt.refreshTemplateSites()):"edit-equipment"==Bt.step?Bt.selectedTab="equipment":"info"==Bt.step&&(Bt.selectedTab="info")})()}onCountryChange(){var Se=this;return(0,g.A)(function*(){Se.refreshFilteredReferenceData()})()}onOperatorChange(Se=null){var Bt=this;return(0,g.A)(function*(){null!=Se&&Bt.item.OperatorID!=Se.ID&&(Bt.item.OperatorID=Se.ID,localStorage.setItem("_editor-operatorid",Bt.item.OperatorID.toString()),yield Bt.refreshTemplateSites())})()}useSuggestedAddress(Se=null){Se&&(this.suggestedAddress=Se.suggestedAddress,this.suggestedAddressAttribution=Se.suggestedAddressAttribution),Object.assign(this.item.AddressInfo,this.suggestedAddress),this.suggestedAddressAttribution&&(this.item.MetadataValues.find(Bt=>4==Bt.MetadataFieldID)||this.item.MetadataValues.push({ID:-1,MetadataFieldID:4,ItemValue:this.suggestedAddressAttribution,MetadataFieldOptionID:null,MetadataFieldOption:null}))}editConnection(Se){var Bt=this;return(0,g.A)(function*(){const Nt=Bt.item.Connections.find(Oi=>Oi.ID==Se.ID),Rn=Object.assign({},Nt),Ci=yield Bt.modalController.create({component:Ve,componentProps:{conn:Rn}});return Ci.onWillDismiss().then(Oi=>{Oi&&Oi.data&&Oi.data.item&&Bt.updateConnection(Oi.data.item)}),yield Ci.present()})()}deleteConnection(Se){var Bt=this;return(0,g.A)(function*(){const Nt=Bt.item.Connections.find(Ci=>Ci.ID==Se.ID);(yield Bt.alertController.create({header:"Confirm Delete",message:"Are you sure you want to delete this connection information?",buttons:[{text:"No",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Yes",handler:()=>{Bt.item.Connections=Bt.item.Connections.filter(Ci=>Ci.ID!=Nt.ID),Bt.appManager.referenceDataManager.hydrateCompactPOI(Bt.item,!0)}}]})).present()})()}addConnection(){var Se=this;return(0,g.A)(function*(){const Bt={ID:-a.A.getRandomInt(1e4),ConnectionTypeID:null,StatusTypeID:50,PowerKW:null,Quantity:1},Nt=yield Se.modalController.create({component:Ve,componentProps:{conn:Bt}});return Nt.onWillDismiss().then(Rn=>{Rn&&Rn.data&&Rn.data.item&&Se.updateConnection(Rn.data.item)}),yield Nt.present()})()}refreshFilteredReferenceData(){this.appManager.referenceDataManager.refreshFilteredReferenceData(this.appManager.api,{CountryIds:[this.item.AddressInfo.CountryID]})}updateConnection(Se){if(Se){let Bt=this.item.Connections.find(Nt=>Nt.ID==Se.ID);Bt?Object.assign(Bt,Se):this.item.Connections.push(Se)}this.appManager.referenceDataManager.hydrateCompactPOI(this.item,!0)}validate(Se="all"){let Bt=null;return("all"==Se||"location"==Se)&&((!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(Bt="Location is required"),""==this.item.AddressInfo.Title&&(Bt="A location title is required"),!this.item.AddressInfo.AddressLine1&&!this.item.AddressInfo.AddressLine2&&(Bt="An approximate address is required."),this.item.AddressInfo.CountryID||(Bt="A country selection is required"),(!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(Bt="A location latitude and longitude is required")),("all"==Se||"poi-nearby"==Se)&&this.nearbySites.length>0&&!this.isNonDuplicateConfirmed&&(Bt="Please confirm that the site is not a duplicate"),("all"==Se||"equipment"==Se)&&(this.item.OperatorID||(Bt="Please confirm the charging network or equipment operator."),0==this.item.Connections.length&&(Bt="Equipment information is required")),Bt?(this.validationMsg=Bt,{isValid:!1,msg:Bt}):(this.validationMsg=null,{isValid:!0,msg:null})}save(){var Se=this;return(0,g.A)(function*(){let Bt=Se.validate();if(Bt.isValid){yield Se.presentLoadingUI();try{yield Se.appManager.submitPOI(Se.item),yield Se.dismissLoadingUI(),Se.appManager.showToastNotification("You submission will be reviewed (if required) and published shortly."),Se.modalController.dismiss()}catch(Nt){yield Se.dismissLoadingUI(),Nt.error&&alert("Sorry, your submission could not be completed at this time. Please try again later.")}}else alert(Bt.msg)})()}cancel(){var Se=this;return(0,g.A)(function*(){Se.modalController.dismiss()})()}refreshTemplateSites(){var Se=this;return(0,g.A)(function*(){if(Se.item.AddressInfo.CountryID&&Se.item.OperatorID){yield Se.presentLoadingUI(),Se.templateSites=[];let Bt=new me.te;Bt.countryIdList=[Se.item.AddressInfo.CountryID],Bt.minPowerKW=1,Bt.operatorIdList=[Se.item.OperatorID],Bt.maxResults=10;let Nt=yield Se.poiManager.fetchPOIList(Bt);Nt.sort((Rn,Ci)=>new Date(Rn.DateCreated).getTime()-new Date(Ci.DateCreated).getTime()),Se.templateSites=Nt,Se.dismissLoadingUI()}})()}refreshNearbySites(){var Se=this;return(0,g.A)(function*(){if(Se.item.AddressInfo.Latitude&&Se.item.AddressInfo.Longitude){yield Se.presentLoadingUI(),Se.nearbySites=[];let Bt=new me.te;Bt.latitude=Se.item.AddressInfo.Latitude,Bt.longitude=Se.item.AddressInfo.Longitude,Bt.distance=5,Bt.distanceUnit="km",Bt.maxResults=10;let Nt=yield Se.poiManager.fetchPOIList(Bt);return Nt.sort((Rn,Ci)=>Rn.Distance-Ci.Distance),Se.nearbySites=Nt,Se.dismissLoadingUI(),Nt.length}return 0})()}confirmNonDuplicate(){this.isNonDuplicateConfirmed=!0,this.next()}changeTemplatePOI(){this.selectedTemplatePOI=null}editPOI(Se){this.editExistingPOI(Se.ID)}editExistingPOI(Se){var Bt=this;return(0,g.A)(function*(){Bt.skipPOICopy=!0,Bt.isNonDuplicateConfirmed=!0,yield Bt.presentLoadingUI(),Bt.poiManager.getPOIById(Se,!0,!0).then(Nt=>{Bt.item=Object.assign({},Nt),null==Bt.item.OperatorID&&(Bt.item.OperatorID=$t.UnknownOperator),Bt.refreshFilteredReferenceData(),Bt.dismissLoadingUI()})})()}useTemplatePOI(Se){this.selectedTemplatePOI=Se,Object.assign(this.item.Connections,Se.Connections);for(let Bt of this.item.Connections)Bt.ID=-a.A.getRandomInt(1e4),Bt.Reference=null,Bt.Comments=null,Bt.StatusTypeID=Ue.Operational;this.item.UsageCost=Se.UsageCost,this.item.UsageTypeID=Se.UsageTypeID,this.appManager.referenceDataManager.hydrateCompactPOI(this.item)}skipCopyingPOI(){this.skipPOICopy=!0}static \u0275fac=function(Bt){return new(Bt||Ct)(T.rXU(v.r),T.rXU(We.W3),T.rXU(Z.U),T.rXU(ie.X),T.rXU(We.Xi),T.rXU(We.hG))};static \u0275cmp=T.VBU({type:Ct,selectors:[["app-poi-editor"]],viewQuery:function(Bt,Nt){if(1&Bt&&T.GBs(ht,5),2&Bt){let Rn;T.mGM(Rn=T.lsd())&&(Nt.editorMap=Rn.first)}},decls:33,vars:14,consts:[["editorMap",""],["slot","end"],[3,"click"],["name","close","slot","start"],[1,"ion-padding"],[3,"ngModel"],["value","location","layout","icon-start",3,"disabled"],["name","caret-forward",4,"ngIf"],["value","equipment","layout","icon-start",3,"disabled"],["value","info","layout","icon-start",3,"disabled"],[4,"ngIf"],["slot","start"],[3,"click",4,"ngIf"],["color","success",3,"click",4,"ngIf"],["name","caret-forward"],[3,"latitudeChange","longitudeChange","onUseSuggestedAddress","latitude","longitude"],["label","Location Name","label-placement","floating","type","text","autocapitalize","words","placeholder","A title for this location",3,"ngModelChange","ngModel"],["label","Address Line 1","label-placement","floating","type","text","autocapitalize","words","placeholder","The nearest street address",3,"ngModelChange","ngModel"],["label","Address Line 2","label-placement","floating","type","text","autocapitalize","words","placeholder","Optional",3,"ngModelChange","ngModel"],["label","Town","label-placement","floating","type","text","autocapitalize","words","placeholder","Town or City",3,"ngModelChange","ngModel"],["label","State or Province","label-placement","floating","type","text",3,"ngModelChange","ngModel"],["label","Postal Code","label-placement","floating","type","text","autocapitalize","words","placeholder","Optional Postal Code",3,"ngModelChange","ngModel"],["label","Country","label-placement","floating",3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["label","Latitude","labelPlacement","floating","type","number","placeholder","Latitude (if entering manually)",3,"ngModelChange","ngModel"],["label","Longitude","labelPlacement","floating","type","number","placeholder","Longitude (if entering manually)",3,"ngModelChange","ngModel"],[3,"value"],[1,"instruction"],[3,"onEdit","poiList","enableEditOption"],[3,"operatorChanged","operatorId"],["slot","start","size","small",3,"click"],[3,"onCopy","enableCopyOption","poiList"],[3,"operatorChanged","operatorId","useFilteredOperators"],["label","Number of Stations or Parking Bays","labelPlacement","floating","min","1","type","number",3,"ngModelChange","ngModel"],["size","small",3,"click"],["name","add","slot","icon-only"],[3,"onEdit","onDelete","item","enableEdit"],["color","warning",4,"ngIf"],["label","Operational Status (All Equipment)","label-placement","floating",3,"ngModelChange","ngModel"],["label","Usage Type","label-placement","floating",3,"ngModelChange","ngModel"],["label","Usage Cost","label-placement","floating","type","text",3,"ngModelChange","ngModel"],["label","General Comments","label-placement","floating","type","text","autocapitalize","sentences",3,"ngModelChange","ngModel"],["label","Main Telephone Number","label-placement","floating","type","tel","placeholder","",3,"ngModelChange","ngModel"],["label","Other Telephone Number","label-placement","floating","type","tel","placeholder","",3,"ngModelChange","ngModel"],["label","Access Comments","label-placement","floating","type","text","autocapitalize","sentences","placeholder","Instructions for access or tips for finding charging location",3,"ngModelChange","ngModel"],["label","Related Website","label-placement","floating","type","url","placeholder","Website related to this site",3,"ngModelChange","ngModel"],["color","warning"],["color","danger"],["name","caret-back","slot","start"],["name","caret-forward","slot","end"],["color","success",3,"click"],["name","send","slot","end"]],template:function(Bt,Nt){1&Bt&&(T.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),T.EFF(3),T.k0s(),T.j41(4,"ion-buttons",1)(5,"ion-button",2),T.bIt("click",function(){return Nt.cancel()}),T.nrm(6,"ion-icon",3),T.EFF(7," Cancel "),T.k0s()()()(),T.j41(8,"ion-content",4),T.qex(9),T.j41(10,"ion-segment",5)(11,"ion-segment-button",6),T.DNE(12,Et,1,0,"ion-icon",7),T.j41(13,"ion-label"),T.EFF(14,"Location"),T.k0s()(),T.j41(15,"ion-segment-button",8),T.DNE(16,cn,1,0,"ion-icon",7),T.j41(17,"ion-label"),T.EFF(18,"Equipment"),T.k0s()(),T.j41(19,"ion-segment-button",9),T.DNE(20,fn,1,0,"ion-icon",7),T.j41(21,"ion-label"),T.EFF(22,"Info"),T.k0s()()(),T.DNE(23,ve,3,2,"ng-container",10)(24,bn,3,2,"ng-container",10)(25,ut,22,11,"ng-container",10),T.bVm(),T.k0s(),T.j41(26,"ion-footer")(27,"ion-toolbar")(28,"ion-buttons",11),T.DNE(29,nn,3,0,"ion-button",12),T.k0s(),T.j41(30,"ion-buttons",1),T.DNE(31,ui,3,0,"ion-button",12)(32,pn,3,0,"ion-button",13),T.k0s()()()),2&Bt&&(T.R7$(3),T.JRh(Nt.isAddMode?"Add Location":"Edit Location"),T.R7$(7),T.Y8G("ngModel",Nt.selectedTab),T.R7$(),T.Y8G("disabled",!0),T.R7$(),T.Y8G("ngIf","location"==Nt.selectedTab),T.R7$(3),T.Y8G("disabled",!0),T.R7$(),T.Y8G("ngIf","equipment"==Nt.selectedTab),T.R7$(3),T.Y8G("disabled",!0),T.R7$(),T.Y8G("ngIf","info"==Nt.selectedTab),T.R7$(3),T.Y8G("ngIf","location"==Nt.selectedTab),T.R7$(),T.Y8G("ngIf","equipment"==Nt.selectedTab),T.R7$(),T.Y8G("ngIf","info"==Nt.selectedTab),T.R7$(4),T.Y8G("ngIf","location"!=Nt.step),T.R7$(2),T.Y8G("ngIf",!Nt.isReadyToSubmit&&"info"!=Nt.step),T.R7$(),T.Y8G("ngIf",Nt.isReadyToSubmit))},dependencies:[je.Sq,je.bT,be.BC,be.vS,We.Jm,We.QW,We.W9,We.M0,We.eU,We.iq,We.$w,We.uz,We.he,We.nf,We.Gp,We.eP,We.Nm,We.Ip,We.BC,We.ai,We.su,We.Je,We.Gw,We.T6,ct.k,Mt.o,ht,$e.O],styles:['ul.breadcrumb[_ngcontent-%COMP%]{display:inline-flex;margin:0;padding:0}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-flex;margin-right:6px;color:var(--ion-color-light-shade);font-size:10px}ul.breadcrumb[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{color:var(--ion-color-dark-shade)}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:">";padding-right:4px}']})}return Ct})()},3471:(vi,Vt,B)=>{"use strict";B.d(Vt,{B:()=>$t});var g=B(3953),v=B(9465),me=B(9394),a=B(5044),Z=B(3118),ie=B(4851),T=B(1626);let Ce=(()=>{class nt{http;journeyManager;constructor(ct,Mt){this.http=ct,this.journeyManager=Mt}getDirections(ct,Mt){return new Promise(($e,Et)=>{(new google.maps.DirectionsService).route({origin:ct,destination:Mt,travelMode:google.maps.TravelMode.DRIVING},(fn,Kn)=>{Kn===google.maps.DirectionsStatus.OK?$e(fn):Et(Kn)})})}analyseRoutes(ct,Mt){const $e=new Array;return ct.routes.forEach(Et=>{const cn=new ie.C_;cn.Title=""+$e.length+1,cn.JourneyRouteLegs=new Array,cn.TotalDistanceKM=0,cn.TotalDurationMinutes=0,cn.TotalEnergykWh=0,Et.legs.forEach(fn=>{const Kn=fn.duration.value,Kt=fn.distance.value/1e3,at=this.journeyManager.calculateEnergyConsumptionkWh(Kt,0,null,Mt),ve=new ie.A$;ve.DistanceKM=Kt,ve.DurationMinutes=Kn/60,ve.EnergyConsumptionkWh=at,cn.JourneyRouteLegs.push(ve),cn.TotalDistanceKM+=ve.DistanceKM,cn.TotalDurationMinutes+=ve.DurationMinutes,cn.TotalEnergykWh=ve.EnergyConsumptionkWh}),$e.push(cn)}),$e}static \u0275fac=function(Mt){return new(Mt||nt)(g.KVO(T.Qq),g.KVO(a.K))};static \u0275prov=g.jDH({token:nt,factory:nt.\u0275fac,providedIn:"root"})}return nt})();var De=B(6714),Je=B(177),re=B(9417),ze=B(4390);function je(nt,xt){if(1&nt){const ct=g.RV6();g.j41(0,"ion-item"),g.nrm(1,"ion-icon",12),g.j41(2,"ion-searchbar",13),g.mxI("ngModelChange",function($e){g.eBV(ct);const Et=g.XpG();return g.DH7(Et.routeStart,$e)||(Et.routeStart=$e),g.Njj($e)}),g.bIt("ionInput",function($e){g.eBV(ct),g.XpG();const Et=g.sdS(18);return g.Njj(Et.getPlacesAutoComplete($e,"routeStart"))})("ionCancel",function($e){g.eBV(ct);const Et=g.XpG();return g.Njj(Et.onPlaceSearchCancel($e))}),g.k0s()()}if(2&nt){const ct=g.XpG();g.R7$(2),g.R50("ngModel",ct.routeStart),g.Y8G("debounce",500)}}function We(nt,xt){if(1&nt){const ct=g.RV6();g.j41(0,"ion-item",14),g.bIt("click",function(){g.eBV(ct);const $e=g.XpG();return g.Njj($e.clearRouteStart())}),g.nrm(1,"ion-icon",12),g.j41(2,"h2"),g.EFF(3),g.k0s()()}if(2&nt){g.XpG();const ct=g.sdS(18);g.R7$(3),g.JRh(null==ct.selectedPlace?null:ct.selectedPlace.name)}}function Ne(nt,xt){if(1&nt){const ct=g.RV6();g.j41(0,"ion-item"),g.nrm(1,"ion-icon",15),g.j41(2,"ion-searchbar",16),g.mxI("ngModelChange",function($e){g.eBV(ct);const Et=g.XpG();return g.DH7(Et.routeDestination,$e)||(Et.routeDestination=$e),g.Njj($e)}),g.bIt("ionInput",function($e){g.eBV(ct),g.XpG();const Et=g.sdS(20);return g.Njj(Et.getPlacesAutoComplete($e,"routeDestination"))})("ionCancel",function($e){g.eBV(ct);const Et=g.XpG();return g.Njj(Et.onPlaceSearchCancel($e))}),g.k0s()()}if(2&nt){const ct=g.XpG();g.R7$(2),g.R50("ngModel",ct.routeDestination),g.Y8G("debounce",500)}}function ht(nt,xt){if(1&nt){const ct=g.RV6();g.j41(0,"ion-item",14),g.bIt("click",function(){g.eBV(ct);const $e=g.XpG();return g.Njj($e.clearRouteDestination())}),g.nrm(1,"ion-icon",15),g.j41(2,"h2"),g.EFF(3),g.k0s()()}if(2&nt){g.XpG();const ct=g.sdS(20);g.R7$(3),g.JRh(null==ct.selectedPlace?null:ct.selectedPlace.name)}}function He(nt,xt){if(1&nt){const ct=g.RV6();g.j41(0,"ion-button",14),g.bIt("click",function(){g.eBV(ct);const $e=g.XpG();return g.Njj($e.clearRoute())}),g.nrm(1,"ion-icon",17),g.EFF(2," Clear Route "),g.k0s()}}function be(nt,xt){if(1&nt){const ct=g.RV6();g.j41(0,"ion-button",14),g.bIt("click",function(){g.eBV(ct);const $e=g.XpG();return g.Njj($e.showSettings())}),g.EFF(1," Show Settings "),g.nrm(2,"ion-icon",18),g.k0s()}}function Ye(nt,xt){if(1&nt){const ct=g.RV6();g.j41(0,"ion-button",14),g.bIt("click",function(){g.eBV(ct);const $e=g.XpG();return g.Njj($e.hideSettings())}),g.EFF(1," Hide Settings "),g.nrm(2,"ion-icon",18),g.k0s()}}function Le(nt,xt){1&nt&&(g.j41(0,"p",19),g.nrm(1,"ion-spinner",19),g.EFF(2," Calculating Route.. "),g.k0s())}function ot(nt,xt){if(1&nt&&(g.j41(0,"ion-list")(1,"ion-list-header"),g.EFF(2),g.nI1(3,"number"),g.nI1(4,"number"),g.k0s()()),2&nt){const ct=g.XpG();g.R7$(2),g.E5c(" Total Distance ",g.i5U(3,3,ct.selectedJourneyRoute.TotalDistanceKM,"1.0-2")," km, ",ct.formatDuration(ct.selectedJourneyRoute.TotalDurationMinutes),", ",g.i5U(4,6,ct.selectedJourneyRoute.TotalEnergykWh,"1.0-2")," kWh ")}}function Ve(nt,xt){if(1&nt){const ct=g.RV6();g.j41(0,"div")(1,"ion-list")(2,"ion-list-header"),g.nrm(3,"ion-icon",20),g.EFF(4," Route Settings "),g.k0s(),g.j41(5,"ion-item")(6,"ion-label",21),g.EFF(7),g.k0s(),g.j41(8,"ion-range",22),g.mxI("ngModelChange",function($e){g.eBV(ct);const Et=g.XpG();return g.DH7(Et.routeSearchDistance,$e)||(Et.routeSearchDistance=$e),g.Njj($e)}),g.nrm(9,"ion-icon",23)(10,"ion-icon",24),g.k0s()(),g.j41(11,"ion-item")(12,"ion-label",21),g.EFF(13,"Energy Efficiency (kWh Per km)"),g.k0s(),g.j41(14,"ion-input",25),g.mxI("ngModelChange",function($e){g.eBV(ct);const Et=g.XpG();return g.DH7(Et.kWhPerKM,$e)||(Et.kWhPerKM=$e),g.Njj($e)}),g.k0s()()()()}if(2&nt){const ct=g.XpG();g.R7$(7),g.SpI("Search Distance (",ct.routeSearchDistance,")"),g.R7$(),g.R50("ngModel",ct.routeSearchDistance),g.R7$(6),g.R50("ngModel",ct.kWhPerKM)}}let Ue=(()=>{class nt{mapping;logging;directions;journeyManager;changeDetector;numberPipe;routeSearchDistance=5;journeyRoutes;selectedJourneyRoute;routePolyline;kWhPerKM;routeStartPlace;routeDestinationPlace;routeCalcInProgress=!1;advancedSettingsMode=!1;routeStart="";routeDestination="";constructor(ct,Mt,$e,Et,cn,fn){this.mapping=ct,this.logging=Mt,this.directions=$e,this.journeyManager=Et,this.changeDetector=cn,this.numberPipe=fn,this.kWhPerKM=.212}get isRouteSet(){return null!=this.routeStartPlace&&null!=this.routeDestinationPlace}showSettings(){this.advancedSettingsMode=!0}hideSettings(){this.advancedSettingsMode=!1}routeStartSelected(ct){this.routeStartPlace=ct,this.calculateRoute(),this.changeDetector.detectChanges()}routeDestinationSelected(ct){this.routeDestinationPlace=ct,this.calculateRoute(),this.changeDetector.detectChanges()}clearRouteStart(){this.routeStartPlace=null,this.changeDetector.detectChanges()}clearRouteDestination(){this.routeDestinationPlace=null,this.changeDetector.detectChanges()}clearRoute(){this.routeStartPlace=null,this.routeDestinationPlace=null,this.journeyManager.setRoutePolyline(null),this.mapping.clearPolyline()}formatDuration(ct){if(ct<=60)return this.numberPipe.transform(ct,"1.0-2")+" mins";{const Mt=Math.round(ct/60),$e=Math.floor(ct-60*Mt);return Mt+" hours "+($e>0?$e+" mins":"")}}calculateRoute(){null!=this.routeStartPlace&&null!=this.routeDestinationPlace&&(this.logging.log("Fetching route directions.."),this.routeCalcInProgress=!0,this.directions.getDirections(this.routeStartPlace.Location.latitude+","+this.routeStartPlace.Location.longitude,this.routeDestinationPlace.Location.latitude+","+this.routeDestinationPlace.Location.longitude).then(ct=>{if(null!=ct.routes&&ct.routes.length>0){this.logging.log("Got route directions, analysing.."),this.routePolyline=ct.routes[0].overview_polyline;const Mt=ct.routes[0].bounds.getSouthWest(),$e=ct.routes[0].bounds.getNorthEast(),Et=new me.cW($e.lat(),$e.lng()),cn=new me.cW(Mt.lat(),Mt.lng()),fn=new me.zG(Et,cn);this.journeyRoutes=this.directions.analyseRoutes(ct,this.kWhPerKM),this.journeyRoutes.length>0&&(this.selectedJourneyRoute=this.journeyRoutes[0]),this.journeyManager.setRoutePolyline(this.routePolyline),this.mapping.renderPolyline(this.routePolyline),this.mapping.moveToMapBounds(fn)}else this.logging.log("No route returned..");this.routeCalcInProgress=!1}))}static \u0275fac=function(Mt){return new(Mt||nt)(g.rXU(De.X),g.rXU(Z.y),g.rXU(Ce),g.rXU(a.K),g.rXU(g.gRc),g.rXU(Je.QX))};static \u0275cmp=g.VBU({type:nt,selectors:[["route-planner"]],decls:24,vars:10,consts:[["placeSearchRouteStart",""],["placeSearchRouteDestination",""],[1,"route"],[1,"route-places"],["name","map","slot","start"],[4,"ngIf"],[3,"click",4,"ngIf"],["primary",""],["slot","secondary"],["slot","primary"],[3,"placeChanged"],["class","ion-padding",4,"ngIf"],["name","ionic","item-left",""],["placeholder","Starting Point",3,"ngModelChange","ionInput","ionCancel","ngModel","debounce"],[3,"click"],["name","pin","item-left",""],["placeholder","Destination",3,"ngModelChange","ionInput","ionCancel","ngModel","debounce"],["name","close","slot","start"],["name","cog","slot","end"],[1,"ion-padding"],["name","cog"],["position","stacked"],["min","1","max","200","step","5","snaps","true","pin","true","light","",3,"ngModelChange","ngModel"],["slot","start","small","","name","map"],["slot","end","large","","name","map"],["type","number","min","0.1","max","1",3,"ngModelChange","ngModel"]],template:function(Mt,$e){if(1&Mt){const Et=g.RV6();g.j41(0,"div",2)(1,"div",3)(2,"ion-list")(3,"ion-list-header"),g.nrm(4,"ion-icon",4),g.j41(5,"ion-label"),g.EFF(6,"Plan Your Journey"),g.k0s()(),g.DNE(7,je,3,2,"ion-item",5)(8,We,4,1,"ion-item",6)(9,Ne,3,2,"ion-item",5)(10,ht,4,1,"ion-item",6),g.k0s(),g.j41(11,"ion-toolbar",7)(12,"ion-buttons",8),g.DNE(13,He,3,0,"ion-button",6),g.k0s(),g.j41(14,"ion-buttons",9),g.DNE(15,be,3,0,"ion-button",6)(16,Ye,3,0,"ion-button",6),g.k0s()()(),g.j41(17,"place-search",10,0),g.bIt("placeChanged",function(fn){return g.eBV(Et),g.Njj($e.routeStartSelected(fn))}),g.k0s(),g.j41(19,"place-search",10,1),g.bIt("placeChanged",function(fn){return g.eBV(Et),g.Njj($e.routeDestinationSelected(fn))}),g.k0s(),g.DNE(21,Le,3,0,"p",11)(22,ot,5,9,"ion-list",5)(23,Ve,15,3,"div",5),g.k0s()}2&Mt&&(g.R7$(7),g.Y8G("ngIf",null==$e.routeStartPlace),g.R7$(),g.Y8G("ngIf",null!=$e.routeStartPlace),g.R7$(),g.Y8G("ngIf",null==$e.routeDestinationPlace),g.R7$(),g.Y8G("ngIf",null!=$e.routeDestinationPlace),g.R7$(3),g.Y8G("ngIf",$e.isRouteSet),g.R7$(2),g.Y8G("ngIf",!$e.advancedSettingsMode),g.R7$(),g.Y8G("ngIf",$e.advancedSettingsMode),g.R7$(5),g.Y8G("ngIf",$e.routeCalcInProgress),g.R7$(),g.Y8G("ngIf",null!=$e.selectedJourneyRoute),g.R7$(),g.Y8G("ngIf",$e.advancedSettingsMode))},dependencies:[Je.bT,v.Jm,v.QW,v.iq,v.$w,v.uz,v.he,v.nf,v.AF,v.Ob,v.S1,v.w2,v.ai,v.su,v.Gw,v.T6,v.jL,re.BC,re.vS,ze.Q,Je.QX],encapsulation:2})}return nt})(),$t=(()=>{class nt{modalController;hasNavbar=!1;constructor(ct){this.modalController=ct}close(){this.modalController.dismiss()}static \u0275fac=function(Mt){return new(Mt||nt)(g.rXU(v.W3))};static \u0275cmp=g.VBU({type:nt,selectors:[["ng-component"]],decls:10,vars:0,consts:[["slot","end"],[3,"click"],["name","close","slot","end"],[1,"route-planner","ion-padding"]],template:function(Mt,$e){1&Mt&&(g.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),g.EFF(3," Route Planner "),g.k0s(),g.j41(4,"ion-buttons",0)(5,"ion-button",1),g.bIt("click",function(){return $e.close()}),g.nrm(6,"ion-icon",2),g.EFF(7," Close "),g.k0s()()()(),g.j41(8,"ion-content",3),g.nrm(9,"route-planner"),g.k0s())},dependencies:[v.Jm,v.QW,v.W9,v.eU,v.iq,v.BC,v.ai,Ue],encapsulation:2})}return nt})()},9325:(vi,Vt,B)=>{"use strict";B.r(Vt),B.d(Vt,{SearchPageModule:()=>Jn});var g=B(7606),v=B(4842),me=B(177),a=B(9417),Z=B(9465),ie=B(1470),T=B(467),Ce=B(5312),De=B(9025),Je=B(4359),re=B(3471),ze=B(38),je=B(9394),We=B(1918),Ne=B(5517),ht=B(3118),He=B(5044),be=B(6714),Ye=B(5040),Le=B(4296),ot=B(4390),Ve=B(3726),Ue=B(8359);class $t extends Ue.yU{constructor(_i,ut){super()}schedule(_i,ut=0){return this}}const nt={setInterval(jn,_i,...ut){const{delegate:nn}=nt;return nn?.setInterval?nn.setInterval(jn,_i,...ut):setInterval(jn,_i,...ut)},clearInterval(jn){const{delegate:_i}=nt;return(_i?.clearInterval||clearInterval)(jn)},delegate:void 0};var xt=B(7908),Mt=B(6129);class $e{constructor(_i,ut=$e.now){this.schedulerActionCtor=_i,this.now=ut}schedule(_i,ut=0,nn){return new this.schedulerActionCtor(this,_i).schedule(nn,ut)}}$e.now=Mt.U.now;const cn=new class Et extends $e{constructor(_i,ut=$e.now){super(_i,ut),this.actions=[],this._active=!1}flush(_i){const{actions:ut}=this;if(this._active)return void ut.push(_i);let nn;this._active=!0;do{if(nn=_i.execute(_i.state,_i.delay))break}while(_i=ut.shift());if(this._active=!1,nn){for(;_i=ut.shift();)_i.unsubscribe();throw nn}}}(class ct extends $t{constructor(_i,ut){super(_i,ut),this.scheduler=_i,this.work=ut,this.pending=!1}schedule(_i,ut=0){var nn;if(this.closed)return this;this.state=_i;const ui=this.id,pn=this.scheduler;return null!=ui&&(this.id=this.recycleAsyncId(pn,ui,ut)),this.pending=!0,this.delay=ut,this.id=null!==(nn=this.id)&&void 0!==nn?nn:this.requestAsyncId(pn,this.id,ut),this}requestAsyncId(_i,ut,nn=0){return nt.setInterval(_i.flush.bind(_i,this),nn)}recycleAsyncId(_i,ut,nn=0){if(null!=nn&&this.delay===nn&&!1===this.pending)return ut;null!=ut&&nt.clearInterval(ut)}execute(_i,ut){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const nn=this._execute(_i,ut);if(nn)return nn;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(_i,ut){let ui,nn=!1;try{this.work(_i)}catch(pn){nn=!0,ui=pn||new Error("Scheduled action threw falsy error")}if(nn)return this.unsubscribe(),ui}unsubscribe(){if(!this.closed){const{id:_i,scheduler:ut}=this,{actions:nn}=ut;this.work=this.state=this.scheduler=null,this.pending=!1,(0,xt.o)(nn,this),null!=_i&&(this.id=this.recycleAsyncId(ut,_i,null)),this.delay=null,super.unsubscribe()}}});var Kn=B(9974),Kt=B(4360);const Me=(0,B(5083).F3)("Geolocation",{web:()=>B.e(2920).then(B.bind(B,2920)).then(jn=>new jn.GeolocationWeb)});var fe=B(3953),vt=B(3656),_n=B(3458);function Re(jn,_i){1&jn&&fe.nrm(0,"ion-icon",13)}function wn(jn,_i){1&jn&&fe.nrm(0,"ion-spinner")}function it(jn,_i){if(1&jn){const ut=fe.RV6();fe.j41(0,"ion-button",4),fe.bIt("click",function(){fe.eBV(ut);const ui=fe.XpG();return fe.Njj(ui.openSideView())}),fe.nrm(1,"ion-icon",14),fe.k0s()}}function tn(jn,_i){1&jn&&(fe.qex(0),fe.j41(1,"div",15)(2,"p"),fe.EFF(3,"There was a problem communicating with Open Charge Map. Please check your data connection."),fe.k0s()(),fe.bVm())}let bn=(()=>{class jn{appManager;nav;events;translate;platform;poiManager;mapping;journeyManager;zone;modalController;alertController;logging;mapDisplayed=!1;debouncedRefreshMapResults;mapCanvasID;initialResultsShown=!1;searchOnDemand=!1;poiViewMode="modal";sideViewAvailable=!1;searchPolyline;routePlanningMode=!0;searchKeyword="";selectedPOI;appConfig=new De.o;defaultMapZoom=15;defaultStartPos=new je.cW(37.415328,-122.076575);placeSearchMapPOI;constructor(ut,nn,ui,pn,An,Ct,Qt,Se,Bt,Nt,Rn,Ci){this.appManager=ut,this.nav=nn,this.events=ui,this.translate=pn,this.platform=An,this.poiManager=Ct,this.mapping=Qt,this.journeyManager=Se,this.zone=Bt,this.modalController=Nt,this.alertController=Rn,this.logging=Ci,this.mapCanvasID="map-canvas",this.mapping.setMapType(ut.searchSettings.MapType),this.mapping.setMapAPI(Ce.c.defaultMapProvider),(0,Ve.R)(window,"resize").pipe(function at(jn,_i=cn){return(0,Kn.N)((ut,nn)=>{let ui=null,pn=null,An=null;const Ct=()=>{if(ui){ui.unsubscribe(),ui=null;const Se=pn;pn=null,nn.next(Se)}};function Qt(){const Se=An+jn,Bt=_i.now();if(Bt<Se)return ui=this.schedule(void 0,Se-Bt),void nn.add(ui);Ct()}ut.subscribe((0,Kt._)(nn,Se=>{pn=Se,An=_i.now(),ui||(ui=_i.schedule(Qt,jn),nn.add(ui))},()=>{Ct(),nn.complete()},void 0,()=>{pn=ui=null}))})}(500)).subscribe(ei=>{let no={width:Ne.A.getClientHeight(),height:Ne.A.getClientWidth()};this.events.publish("ocm:window:resized",[no])})}ionViewDidEnter(){this.logging.log("Entered search page.",ht.$.VERBOSE),this.mapping.focusMap(),this.mapping.updateMapSize()}ionViewWillLeave(){this.logging.log("Leaving search page.",ht.$.VERBOSE),this.mapping.unfocusMap()}getPreferredMapHeight(ut){return null==ut&&(ut=Ne.A.getClientHeight()),ut-56}enforceMapHeight(ut){this.logging.log("Would resize map:"+ut.width+" "+ut.height,ht.$.VERBOSE);const nn=this.getPreferredMapHeight(ut[0]);document.getElementById(this.mapCanvasID).offsetHeight!==nn&&(document.getElementById(this.mapCanvasID).style.height=nn+"px"),this.mapping&&(this.logging.log("Map height:"+nn,ht.$.VERBOSE),this.mapping.updateMapSize())}initialiseMapping(){var ut=this;return(0,T.A)(function*(){yield ut.platform.ready(),ut.debouncedRefreshMapResults=Ne.A.debounce(ut.refreshMapResults,1e3,!1),ut.events.subscribe("ocm:mapping:ready",(0,T.A)(function*(){if(ut.logging.log("init map: mapping ready"),ut.mapping&&ut.mapping.updateMapSize(),!ut.initialResultsShown)if(ut.appManager.searchSettings.StartSearchPosition&&!ut.appManager.searchSettings.StartViewPoiId)ut.searchOnDemand=!0,ut.mapping.updateMapCentrePos(ut.appManager.searchSettings.StartSearchPosition.latitude,ut.appManager.searchSettings.StartSearchPosition.longitude,!0,ut.defaultMapZoom);else{let nn=localStorage.getItem("_locationEnabled");1==ut.appManager.isEmbeddedMode&&"true"!=nn?yield(yield ut.alertController.create({header:"Search using your location?",message:"Select OK to continue.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:(pn=(0,T.A)(function*(){yield ut.useFallbackPosition()}),function(){return pn.apply(this,arguments)})},{text:"OK",handler:function(){var pn=(0,T.A)(function*(){yield ut.locateUser()});return function(){return pn.apply(this,arguments)}}()}]})).present():(yield ut.locateUser(),ut.mapping&&ut.mapping.updateMapSize())}var pn})),ut.events.subscribe("ocm:mapping:zoom",()=>{ut.debouncedRefreshMapResults()}),ut.events.subscribe("ocm:mapping:dragend",()=>{ut.debouncedRefreshMapResults()}),ut.events.subscribe("ocm:poiList:updated",nn=>{ut.showPOIListOnMap(nn)}),ut.events.subscribe("ocm:poiList:cleared",()=>{ut.mapping.clearMarkers(),setTimeout(()=>{ut.debouncedRefreshMapResults()},500)}),ut.events.subscribe("ocm:window:resized",nn=>{null!=nn&&nn.length>0&&ut.enforceMapHeight(nn[0])}),ut.events.subscribe("ocm:poi:selected",nn=>{nn.poi?ut.viewPOIDetails(nn,nn.poi):ut.viewPOIDetails(nn,null,!0)}),ut.mapping.initMap(ut.mapCanvasID)})()}ngAfterViewInit(){var ut=this;return(0,T.A)(function*(){yield ut.initialiseMapping()})()}ngOnInit(){var ut=this;return(0,T.A)(function*(){ut.logging.log("Refreshing reference data ..",ht.$.VERBOSE),(yield ut.appManager.referenceDataManager.refreshReferenceData(ut.appManager.api))||(ut.appManager.isOffline=!0)})()}showPOIListOnMap(ut){const nn=this.getPreferredMapHeight(null);this.mapping.refreshMapView(nn,this.poiManager.poiList,null),this.mapDisplayed||(this.mapDisplayed=!0)}getIconForPOI(ut){return Ne.A.getIconForPOI(ut)}getPOIByID(ut){const nn=this.poiManager.poiList;for(let ui=0;ui<nn.length;ui++)if(nn[ui].ID===ut)return nn[ui];return null}refreshMapResults(){var ut=this;return(0,T.A)(function*(){if(!ut.searchOnDemand)return void ut.logging.log("Skipping refresh, search on demand disabled..",ht.$.VERBOSE);ut.logging.log("Refreshing Results..",ht.$.VERBOSE);const nn=new We.t;let ui=null;if(ut.appManager.searchSettings.StartViewPoiId){let An=ut.appManager.searchSettings.StartViewPoiId;ut.appManager.searchSettings.StartViewPoiId=null;let Ct=yield ut.poiManager.getPOIById(An,!0);Ct&&(ut.events.publish("ocm:poi:selected",{poiId:Ct.ID,poi:Ct}),ut.mapping.updateMapCentrePos(Ct.AddressInfo.Latitude,Ct.AddressInfo.Longitude,!0,ut.defaultMapZoom))}if(ut.appManager.searchSettings.StartSearchPosition&&(ui=new je.Bk(ut.appManager.searchSettings.StartSearchPosition.latitude,ut.appManager.searchSettings.StartSearchPosition.longitude),ut.appManager.searchSettings.StartSearchPosition=null),ui&&0==ui.coords.latitude&&0==ui.coords.longitude)return void ut.logging.log("Map center is zero. No query will be performed",ht.$.WARNING);if(null!=ui)nn.latitude=ui.coords.latitude,nn.longitude=ui.coords.longitude,nn.distance=25,nn.boundingbox=null,ut.appManager.searchSettings.LastSearchPosition=new je.cW(ui.coords.latitude,ui.coords.longitude);else{nn.latitude=null,nn.longitude=null;let An=yield ut.mapping.getMapBounds().toPromise();nn.boundingbox="("+An[0].latitude+","+An[0].longitude+"),("+An[1].latitude+","+An[1].longitude+")",ut.logging.log(JSON.stringify(An),ht.$.VERBOSE)}nn.includeComments=!0,nn.enableCaching=!0,null!=ut.appManager.searchSettings&&(null!=ut.appManager.searchSettings.ConnectionTypeList&&(nn.connectionTypeIdList=ut.appManager.searchSettings.ConnectionTypeList),null!=ut.appManager.searchSettings.UsageTypeList&&(nn.usageTypeIdList=ut.appManager.searchSettings.UsageTypeList),null!=ut.appManager.searchSettings.StatusTypeList&&(nn.statusTypeIdList=ut.appManager.searchSettings.StatusTypeList),null!=ut.appManager.searchSettings.OperatorList&&(nn.operatorIdList=ut.appManager.searchSettings.OperatorList),null!=ut.appManager.searchSettings.MinPowerKW&&ut.appManager.searchSettings.MinPowerKW>0&&(nn.minPowerKW=ut.appManager.searchSettings.MinPowerKW),null!=ut.appManager.searchSettings.MaxPowerKW&&ut.appManager.searchSettings.MaxPowerKW>0&&(nn.maxPowerKW=ut.appManager.searchSettings.MaxPowerKW),null!=ut.appManager.searchSettings.MaxResults&&ut.appManager.searchSettings.MaxResults>0&&ut.appManager.searchSettings.MaxResults<=1e4&&(nn.maxResults=ut.appManager.searchSettings.MaxResults),null!=ut.journeyManager.getRoutePolyline()&&(nn.polyline=ut.journeyManager.getRoutePolyline(),nn.boundingbox=null,nn.levelOfDetail=null,nn.latitude=null,nn.longitude=null)),ut.appManager.searchSettings.EnablePOIPendingApproval&&(nn.submissionStatusTypeIdList=[1,100,200]),ut.appManager.isRequestInProgress=!0;let pn=yield ut.poiManager.refreshPOIList(nn);ut.appManager.isRequestInProgress=!1,ut.initialResultsShown=!0,pn>=nn.maxResults&&ut.appManager.showToastNotification("A maximum of "+pn+" results are returned per search. Zoom in for details.")})()}viewPOIDetails(ut,nn,ui=!1){this.logging.log("Viewing/fetching ["+this.poiViewMode+"] POI Details "+ut.poiId),null!=nn?(this.mapping.unfocusMap(),this.modalController.create({component:ze.I,componentProps:{item:nn}}).then(pn=>{pn.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),pn.present()}),ui&&this.mapping.updateMapCentrePos(nn.AddressInfo.Latitude,nn.AddressInfo.Longitude,!0,this.defaultMapZoom)):this.poiManager.getPOIById(ut.poiId,!0).then(pn=>{this.logging.log("Got POI Details "+pn.ID),"modal"===this.poiViewMode&&(this.searchOnDemand=!1,this.modalController.create({component:ze.I,componentProps:{item:pn}}).then(An=>{An.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),An.present()}),this.mapping.unfocusMap(),ui&&this.mapping.updateMapCentrePos(pn.AddressInfo.Latitude,pn.AddressInfo.Longitude,!0,this.defaultMapZoom)),"side"===this.poiViewMode&&(this.selectedPOI=pn)},pn=>{this.appManager.showToastNotification("POI Details not available")})}closePOIDetails(){this.selectedPOI=null}openRoutePlannerModal(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:re.B}).then(ut=>{ut.onDidDismiss().then(nn=>{this.logging.log("Dismissing Route Planner Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),ut.present()})}openSearchOptions(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:Je.R}).then(ut=>{ut.onDidDismiss().then(nn=>{this.mapping.focusMap(),this.searchOnDemand=!0}),ut.present()})}openSideView(){this.poiViewMode="side",this.mapping.updateMapSize()}closeSideView(){this.poiViewMode="modal",this.mapping.updateMapSize()}planRoute(){this.routePlanningMode=!0}search(ut){this.placeSearchMapPOI.getPlacesAutoComplete(ut,"poiSearch")}useFallbackPosition(){let ut=this.defaultStartPos;null!=this.appManager.searchSettings.LastSearchPosition&&(ut=this.appManager.searchSettings.LastSearchPosition),this.appManager.searchSettings.StartSearchPosition=ut,this.appManager.searchSettings.LastSearchPosition=null,this.searchOnDemand=!0,this.mapping.updateMapCentrePos(ut.latitude,ut.longitude,!0,this.defaultMapZoom)}_watchId=null;getPosition(ut={}){var nn=this;return(0,T.A)(function*(){return new Promise((ui,pn)=>{nn._watchId=Me.watchPosition(ut,(An,Ct)=>{nn._watchId&&Me.clearWatch({id:nn._watchId}),Ct?pn(Ct):ui(An)})})})()}locateUser(){var ut=this;return(0,T.A)(function*(){ut.useFallbackPosition();try{ut.logging.log("Attempting to locate user..");const nn=yield ut.getPosition({timeout:1e4});if(!nn)throw"Failed to get user location.";return ut.logging.log("Got user location."),ut.appManager.searchSettings.StartSearchPosition=new je.cW(nn.coords.latitude,nn.coords.longitude),ut.searchOnDemand=!0,ut.mapping.updateMapCentrePos(nn.coords.latitude,nn.coords.longitude,!0,ut.defaultMapZoom),localStorage.setItem("_locationEnabled","true"),!0}catch(nn){return ut.logging.log("Failed to get user location. Searching using default or last position."+nn),ut.appManager.showToastNotification("Your location could not be determined."),ut.useFallbackPosition(),!1}})()}placeSelected(ut){if(this.searchKeyword=ut.Address,this.logging.log("Got place details:"+ut.Address),this.mapping.focusMap(),null!=ut.Location)this.mapping.updateMapCentrePos(ut.Location.latitude,ut.Location.longitude,!0);else if(null!=ut.ReferenceID&&ut.ReferenceID.startsWith("OCM-")){let nn=ut.ReferenceID.replace("OCM-","");this.events.publish("ocm:poi:selected",{poiId:nn,poi:null})}this.debouncedRefreshMapResults()}static \u0275fac=function(nn){return new(nn||jn)(fe.rXU(Le.r),fe.rXU(vt.q9),fe.rXU(_n.s),fe.rXU(v.c$),fe.rXU(vt.OD),fe.rXU(Ye.U),fe.rXU(be.X),fe.rXU(He.K),fe.rXU(fe.SKi),fe.rXU(Z.W3),fe.rXU(Z.hG),fe.rXU(ht.y))};static \u0275cmp=fe.VBU({type:jn,selectors:[["ng-component"]],viewQuery:function(nn,ui){if(1&nn&&fe.GBs(ot.Q,7),2&nn){let pn;fe.mGM(pn=fe.lsd())&&(ui.placeSearchMapPOI=pn.first)}},decls:18,vars:10,consts:[["placeSearchMapPOI",""],["slot","start"],["autocapitalize","on","autocomplete","on",3,"ngModelChange","ionInput","ngModel","placeholder","debounce"],["slot","end"],[3,"click"],["name","locate","slot","start",4,"ngIf"],[4,"ngIf"],[3,"click","color"],["name","options","slot","end"],[3,"click",4,"ngIf"],[1,"search-page"],[3,"placeChanged"],["id","map-canvas",2,"height","100%","width","100%","min-height","300px"],["name","locate","slot","start"],["name","car","title","Route","slot","end"],[2,"position","absolute"]],template:function(nn,ui){if(1&nn){const pn=fe.RV6();fe.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),fe.nrm(3,"ion-menu-button"),fe.k0s(),fe.j41(4,"ion-searchbar",2),fe.nI1(5,"translate"),fe.mxI("ngModelChange",function(Ct){return fe.eBV(pn),fe.DH7(ui.searchKeyword,Ct)||(ui.searchKeyword=Ct),fe.Njj(Ct)}),fe.bIt("ionInput",function(Ct){return fe.eBV(pn),fe.Njj(ui.search(Ct))}),fe.k0s(),fe.j41(6,"ion-buttons",3)(7,"ion-button",4),fe.bIt("click",function(){return fe.eBV(pn),fe.Njj(ui.locateUser())}),fe.DNE(8,Re,1,0,"ion-icon",5)(9,wn,1,0,"ion-spinner",6),fe.k0s(),fe.j41(10,"ion-button",7),fe.bIt("click",function(){return fe.eBV(pn),fe.Njj(ui.openSearchOptions())}),fe.nrm(11,"ion-icon",8),fe.k0s(),fe.DNE(12,it,2,0,"ion-button",9),fe.k0s()()(),fe.j41(13,"ion-content",10)(14,"place-search",11,0),fe.bIt("placeChanged",function(Ct){return fe.eBV(pn),fe.Njj(ui.placeSelected(Ct))}),fe.k0s(),fe.DNE(16,tn,4,0,"ng-container",6),fe.nrm(17,"div",12),fe.k0s()}2&nn&&(fe.R7$(4),fe.R50("ngModel",ui.searchKeyword),fe.Y8G("placeholder",fe.bMT(5,8,"ocm.search.performSearch"))("debounce",500),fe.R7$(4),fe.Y8G("ngIf",!ui.appManager.isRequestInProgress),fe.R7$(),fe.Y8G("ngIf",ui.appManager.isRequestInProgress),fe.R7$(),fe.Y8G("color",ui.appManager.searchSettings.HasActiveFilters?"danger":"default"),fe.R7$(2),fe.Y8G("ngIf",1==ui.sideViewAvailable&&"modal"==ui.poiViewMode),fe.R7$(4),fe.Y8G("ngIf",ui.appManager.isOffline))},dependencies:[me.bT,a.BC,a.vS,Z.Jm,Z.QW,Z.W9,Z.eU,Z.iq,Z.MC,Z.S1,Z.w2,Z.ai,Z.Gw,ot.Q,v.D9],styles:[".search-page[_ngcontent-%COMP%]   #map-canvas[_ngcontent-%COMP%]{width:100%;height:98%}.search-page[_ngcontent-%COMP%]   #place-search[_ngcontent-%COMP%]{min-height:300px;position:absolute;z-index:100;width:100%}.search-page[_ngcontent-%COMP%]   scroll-content[_ngcontent-%COMP%]{overflow-y:hidden}.search-page[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]{padding-left:2em}.search-page[_ngcontent-%COMP%]   .sideview[_ngcontent-%COMP%]{background:#eee;background:linear-gradient(to bottom,#eee,#fff)}"]})}return jn})(),Jn=(()=>{class jn{static \u0275fac=function(nn){return new(nn||jn)};static \u0275mod=fe.$C({type:jn});static \u0275inj=fe.G2t({imports:[me.MD,a.YN,Z.bv,v.h,g.F,ie.iI.forChild([{path:"",component:bn}])]})}return jn})()},4359:(vi,Vt,B)=>{"use strict";B.d(Vt,{R:()=>Ve});var g=B(467),v=B(5040),me=B(4296),a=B(8139),Z=B(5517),ie=B(6714),T=B(3953),Ce=B(9465),De=B(3458),Je=B(177),re=B(9417),ze=B(6509),je=B(4842);let We=(()=>{class Ue extends je.D9{constructor(nt,xt){super(nt,xt)}transform(nt,...xt){let ct=super.transform(nt,...xt);return ct==nt?null!=xt&&xt[0].default?xt[0].default:xt[0].Title?xt[0].Title:ct:ct}static \u0275fac=function(xt){return new(xt||Ue)(T.rXU(je.c$,16),T.rXU(T.gRc,16))};static \u0275pipe=T.EJ8({name:"nullableTranslate",type:Ue,pure:!0});static \u0275prov=T.jDH({token:Ue,factory:Ue.\u0275fac})}return Ue})();function Ne(Ue,$t){if(1&Ue){const nt=T.RV6();T.j41(0,"p",21),T.nrm(1,"ion-icon",22),T.EFF(2," One or more filters are currently being applied. "),T.j41(3,"ion-button",23),T.bIt("click",function(){T.eBV(nt);const ct=T.XpG();return T.Njj(ct.clearFilters())}),T.nrm(4,"ion-icon",24),T.j41(5,"ion-label"),T.EFF(6,"Clear"),T.k0s()()()}}function ht(Ue,$t){if(1&Ue&&(T.j41(0,"ion-select-option",27),T.EFF(1),T.k0s()),2&Ue){const nt=$t.$implicit;T.Y8G("value",nt.ID),T.R7$(),T.JRh(nt.Title)}}function He(Ue,$t){if(1&Ue){const nt=T.RV6();T.j41(0,"ion-item")(1,"ion-select",25),T.nI1(2,"translate"),T.mxI("ngModelChange",function(ct){T.eBV(nt);const Mt=T.XpG();return T.DH7(Mt.searchSettings.FilterOptionsByCountryId,ct)||(Mt.searchSettings.FilterOptionsByCountryId=ct),T.Njj(ct)}),T.bIt("ionChange",function(){T.eBV(nt);const ct=T.XpG();return T.Njj(ct.onCountryChange())}),T.j41(3,"ion-select",26),T.EFF(4,"(All Countries)"),T.k0s(),T.DNE(5,ht,2,2,"ion-select-option",5),T.k0s()()}if(2&Ue){const nt=T.XpG();T.R7$(),T.Y8G("label",T.bMT(2,3,"ocm.search.countries")),T.R50("ngModel",nt.searchSettings.FilterOptionsByCountryId),T.R7$(4),T.Y8G("ngForOf",nt.countries)}}function be(Ue,$t){if(1&Ue&&(T.j41(0,"ion-select-option",27),T.EFF(1),T.nI1(2,"nullableTranslate"),T.k0s()),2&Ue){const nt=$t.$implicit;T.Y8G("value",nt.ID),T.R7$(),T.JRh(T.i5U(2,2,"ocm.reference.usageType.value_"+nt.ID,nt))}}function Ye(Ue,$t){if(1&Ue&&(T.j41(0,"ion-select-option",27),T.EFF(1),T.nI1(2,"nullableTranslate"),T.k0s()),2&Ue){const nt=$t.$implicit;T.Y8G("value",nt.ID),T.R7$(),T.JRh(T.i5U(2,2,"ocm.reference.statusType.value_"+nt.ID,nt))}}function Le(Ue,$t){if(1&Ue&&(T.j41(0,"ion-select-option",27),T.EFF(1),T.nI1(2,"nullableTranslate"),T.k0s()),2&Ue){const nt=$t.$implicit;T.Y8G("value",nt.ID),T.R7$(),T.JRh(T.i5U(2,2,"ocm.reference.connectionType.value_"+nt.ID,nt))}}function ot(Ue,$t){if(1&Ue&&(T.j41(0,"ion-select-option",27),T.EFF(1),T.k0s()),2&Ue){const nt=$t.$implicit;T.Y8G("value",nt.code),T.R7$(),T.JRh(nt.title)}}let Ve=(()=>{class Ue{appManager;poiManager;mapping;modalController;events;searchSettings;maxPower=a.d;powerRange={lower:0,upper:this.maxPower};constructor(nt,xt,ct,Mt,$e){this.appManager=nt,this.poiManager=xt,this.mapping=ct,this.modalController=Mt,this.events=$e,this.searchSettings=nt.searchSettings}ngOnInit(){var nt=this;return(0,g.A)(function*(){null!=nt.searchSettings.MinPowerKW&&(nt.powerRange.lower=nt.searchSettings.MinPowerKW),null!=nt.searchSettings.MaxPowerKW&&(nt.powerRange.upper=nt.searchSettings.MaxPowerKW),0==nt.powerRange.upper&&(nt.powerRange.upper=nt.maxPower),nt.appManager.analytics.viewEvent("Settings"),nt.useFilteredOptions&&(yield nt.onCountryChange())})()}get useFilteredOptions(){return this.searchSettings.FilterOptionsByCountryId>0}clearFilters(){this.searchSettings.ClearActiveFilters(),this.powerRange={lower:0,upper:this.maxPower},this.searchSettings.CheckForActiveFilters()}get operators(){return this.appManager.referenceDataManager.getNetworkOperators(this.useFilteredOptions)}get connectionTypes(){return this.appManager.referenceDataManager.getConnectionTypes(this.useFilteredOptions)}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes(this.useFilteredOptions)}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes(this.useFilteredOptions)}get countries(){return this.appManager.referenceDataManager.getCountries(this.useFilteredOptions)}get isCountryFilterFeatureEnabled(){return Z.A.isFeatureEnabled("FILTER_OPTIONS_BY_COUNTRY")}_languages=[];get languages(){return this._languages.length>0||(this._languages=this.appManager.getLanguages()),this._languages}ionViewWillLeave(){null!=this.searchSettings.Language&&this.appManager.setLanguage(this.searchSettings.Language),this.searchSettings.MinPowerKW=this.powerRange.lower,this.searchSettings.MaxPowerKW=this.powerRange.upper,1==this.searchSettings.MinPowerKW&&(this.searchSettings.MinPowerKW=null),this.searchSettings.MaxPowerKW==this.maxPower&&(this.searchSettings.MaxPowerKW=null),this.appManager.searchSettings=this.searchSettings,this.appManager.saveSearchSettings(),this.events.publish("ocm:poiList:cleared")}onLanguageChange(){null!=this.searchSettings.Language&&""!=this.searchSettings.Language&&this.appManager.setLanguage(this.searchSettings.Language)}onCountryChange(){var nt=this;return(0,g.A)(function*(){nt.appManager.referenceDataManager.refreshFilteredReferenceData(nt.appManager.api,{CountryIds:[nt.searchSettings.FilterOptionsByCountryId]})})()}onMapTypeChange(){var nt=this;return(0,g.A)(function*(){nt.mapping.setMapType(nt.searchSettings.MapType)})()}onOperatorSelected(nt=null){var xt=this;return(0,g.A)(function*(){null!=nt&&(xt.searchSettings.OperatorList.find(ct=>ct==nt.ID)||xt.searchSettings.OperatorList.push(nt.ID))})()}onOperatorRemoved(nt){var xt=this;return(0,g.A)(function*(){xt.searchSettings.OperatorList=xt.searchSettings.OperatorList.filter(ct=>ct!=nt)})()}close(){this.modalController.dismiss()}static \u0275fac=function(xt){return new(xt||Ue)(T.rXU(me.r),T.rXU(v.U),T.rXU(ie.X),T.rXU(Ce.W3),T.rXU(De.s))};static \u0275cmp=T.VBU({type:Ue,selectors:[["ng-component"]],decls:60,vars:41,consts:[[1,"settings-page","ion-padding"],["danger","",4,"ngIf"],[4,"ngIf"],["mode","multi",3,"operatorRemoved","operatorChanged","operatorList","useFilteredOperators"],["multiple","true","cancelText","Cancel","okText","OK","placeholder","All",3,"ngModelChange","label","ngModel"],[3,"value",4,"ngFor","ngForOf"],["labelPlacement","start","label","Power (kW)","dualKnobs","true","pin","true",3,"ngModelChange","ngModel","ticks","snaps","min","max"],["slot","start","size","small","name","flash"],["slot","end","name","flash"],["lines","none"],["slot","start","type","number","labelPlacement","stacked","label","Min. kW","min","0",3,"ngModelChange","ngModel","max"],["slot","end","type","number","labelPlacement","stacked","label","Max. kW",3,"ngModelChange","ngModel","min","max"],["label","Language","multiple","false","placeholder","Select",3,"ngModelChange","ionChange","ngModel"],["multiple","false","cancelText","Cancel","okText","OK","placeholder","Select",3,"ngModelChange","ionChange","label","ngModel"],["value","ROADMAP"],["value","SATELLITE"],[3,"ngModelChange","ngModel"],["label","Max Results","type","number","placeholder","500","min","100","max","10000",3,"ngModelChange","ngModel"],["slot","end"],[3,"click"],["name","close","slot","start"],["danger",""],["name","alert"],["size","small","color","light",3,"click"],["slot","start","name","close"],["multiple","false","cancelText","Cancel","okText","OK","placeholder","All",3,"ngModelChange","ionChange","label","ngModel"],["value",""],[3,"value"]],template:function(xt,ct){1&xt&&(T.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),T.EFF(3),T.nI1(4,"translate"),T.k0s()()(),T.j41(5,"ion-content",0)(6,"h2"),T.EFF(7,"Search Filters"),T.k0s(),T.j41(8,"p"),T.EFF(9,"Note: Filters will remove usable charging locations from your search results if we do not have complete data (i.e Operator or Power Levels)."),T.k0s(),T.DNE(10,Ne,7,0,"p",1),T.j41(11,"ion-list"),T.DNE(12,He,6,5,"ion-item",2),T.j41(13,"app-operator-lookup",3),T.bIt("operatorRemoved",function($e){return ct.onOperatorRemoved($e)})("operatorChanged",function($e){return ct.onOperatorSelected($e)}),T.k0s(),T.j41(14,"ion-item")(15,"ion-select",4),T.nI1(16,"translate"),T.mxI("ngModelChange",function($e){return T.DH7(ct.searchSettings.UsageTypeList,$e)||(ct.searchSettings.UsageTypeList=$e),$e}),T.DNE(17,be,3,5,"ion-select-option",5),T.k0s()(),T.j41(18,"ion-item")(19,"ion-select",4),T.nI1(20,"translate"),T.mxI("ngModelChange",function($e){return T.DH7(ct.searchSettings.StatusTypeList,$e)||(ct.searchSettings.StatusTypeList=$e),$e}),T.DNE(21,Ye,3,5,"ion-select-option",5),T.k0s()(),T.j41(22,"ion-item")(23,"ion-select",4),T.nI1(24,"translate"),T.mxI("ngModelChange",function($e){return T.DH7(ct.searchSettings.ConnectionTypeList,$e)||(ct.searchSettings.ConnectionTypeList=$e),$e}),T.DNE(25,Le,3,5,"ion-select-option",5),T.k0s()(),T.j41(26,"ion-item")(27,"ion-range",6),T.mxI("ngModelChange",function($e){return T.DH7(ct.powerRange,$e)||(ct.powerRange=$e),$e}),T.j41(28,"ion-icon",7),T.EFF(29,"0"),T.k0s(),T.nrm(30,"ion-icon",8),T.k0s()(),T.j41(31,"ion-item",9)(32,"ion-input",10),T.mxI("ngModelChange",function($e){return T.DH7(ct.powerRange.lower,$e)||(ct.powerRange.lower=$e),$e}),T.k0s(),T.j41(33,"ion-input",11),T.mxI("ngModelChange",function($e){return T.DH7(ct.powerRange.upper,$e)||(ct.powerRange.upper=$e),$e}),T.k0s()()(),T.j41(34,"h2"),T.EFF(35," General Settings "),T.k0s(),T.j41(36,"ion-item")(37,"ion-select",12),T.mxI("ngModelChange",function($e){return T.DH7(ct.searchSettings.Language,$e)||(ct.searchSettings.Language=$e),$e}),T.bIt("ionChange",function(){return ct.onLanguageChange()}),T.DNE(38,ot,2,2,"ion-select-option",5),T.k0s()(),T.j41(39,"ion-item")(40,"ion-select",13),T.nI1(41,"translate"),T.mxI("ngModelChange",function($e){return T.DH7(ct.searchSettings.MapType,$e)||(ct.searchSettings.MapType=$e),$e}),T.bIt("ionChange",function(){return ct.onMapTypeChange()}),T.j41(42,"ion-select-option",14),T.EFF(43,"Road Map"),T.k0s(),T.j41(44,"ion-select-option",15),T.EFF(45,"Satellite"),T.k0s()()(),T.j41(46,"ion-item")(47,"ion-toggle",16),T.mxI("ngModelChange",function($e){return T.DH7(ct.searchSettings.EnableAdvancedEditorFeatures,$e)||(ct.searchSettings.EnableAdvancedEditorFeatures=$e),$e}),T.EFF(48,"Enable Advanced Editor Options"),T.k0s()(),T.j41(49,"ion-item")(50,"ion-toggle",16),T.mxI("ngModelChange",function($e){return T.DH7(ct.searchSettings.EnablePOIPendingApproval,$e)||(ct.searchSettings.EnablePOIPendingApproval=$e),$e}),T.EFF(51,"Show POIs Pending Approval"),T.k0s()(),T.j41(52,"ion-item")(53,"ion-input",17),T.mxI("ngModelChange",function($e){return T.DH7(ct.searchSettings.MaxResults,$e)||(ct.searchSettings.MaxResults=$e),$e}),T.k0s()()(),T.j41(54,"ion-footer")(55,"ion-toolbar")(56,"ion-buttons",18)(57,"ion-button",19),T.bIt("click",function(){return ct.close()}),T.nrm(58,"ion-icon",20),T.EFF(59," Close "),T.k0s()()()()),2&xt&&(T.R7$(3),T.SpI(" ",T.bMT(4,31,"ocm.general.settings")," "),T.R7$(7),T.Y8G("ngIf",1==ct.searchSettings.HasActiveFilters),T.R7$(2),T.Y8G("ngIf",ct.isCountryFilterFeatureEnabled),T.R7$(),T.Y8G("operatorList",ct.searchSettings.OperatorList)("useFilteredOperators",!1),T.R7$(2),T.Y8G("label",T.bMT(16,33,"ocm.search.usageTypes")),T.R50("ngModel",ct.searchSettings.UsageTypeList),T.R7$(2),T.Y8G("ngForOf",ct.usageTypes),T.R7$(2),T.Y8G("label",T.bMT(20,35,"ocm.search.operationalStatusTypes")),T.R50("ngModel",ct.searchSettings.StatusTypeList),T.R7$(2),T.Y8G("ngForOf",ct.statusTypes),T.R7$(2),T.Y8G("label",T.bMT(24,37,"ocm.search.connectionTypes")),T.R50("ngModel",ct.searchSettings.ConnectionTypeList),T.R7$(2),T.Y8G("ngForOf",ct.connectionTypes),T.R7$(2),T.R50("ngModel",ct.powerRange),T.Y8G("ticks",!1)("snaps",!1)("min",0)("max",ct.maxPower),T.R7$(5),T.R50("ngModel",ct.powerRange.lower),T.Y8G("max",ct.powerRange.upper),T.R7$(),T.R50("ngModel",ct.powerRange.upper),T.Y8G("min",ct.powerRange.lower)("max",ct.maxPower),T.R7$(4),T.R50("ngModel",ct.searchSettings.Language),T.R7$(),T.Y8G("ngForOf",ct.languages),T.R7$(2),T.Y8G("label",T.bMT(41,39,"ocm.details.location.map")),T.R50("ngModel",ct.searchSettings.MapType),T.R7$(7),T.R50("ngModel",ct.searchSettings.EnableAdvancedEditorFeatures),T.R7$(3),T.R50("ngModel",ct.searchSettings.EnablePOIPendingApproval),T.R7$(3),T.R50("ngModel",ct.searchSettings.MaxResults))},dependencies:[Je.Sq,Je.bT,re.BC,re.vS,Ce.Jm,Ce.QW,Ce.W9,Ce.M0,Ce.eU,Ce.iq,Ce.$w,Ce.uz,Ce.he,Ce.nf,Ce.Ob,Ce.Nm,Ce.Ip,Ce.BC,Ce.BY,Ce.ai,Ce.hB,Ce.su,Ce.Je,Ce.T6,Ce.jL,ze.O,je.D9,We],encapsulation:2})}return Ue})()},4552:(vi,Vt,B)=>{"use strict";B.r(Vt),B.d(Vt,{SignInModule:()=>De});var g=B(4740),v=B(7606),me=B(4842),a=B(177),Z=B(9417),ie=B(9465),T=B(1470),Ce=B(3953);let De=(()=>{class Je{static \u0275fac=function(je){return new(je||Je)};static \u0275mod=Ce.$C({type:Je});static \u0275inj=Ce.G2t({imports:[a.MD,Z.YN,ie.bv,me.h,v.F,T.iI.forChild([{path:"",component:g.q}])]})}return Je})()},4740:(vi,Vt,B)=>{"use strict";B.d(Vt,{q:()=>ze});var g=B(467),v=B(3118),me=B(4296),a=B(3953),Z=B(9465),ie=B(4842),T=B(1470),Ce=B(177),De=B(9417);function Je(je,We){if(1&je){const Ne=a.RV6();a.qex(0),a.j41(1,"p",13),a.EFF(2," Sign in using your Open Charge Map account. "),a.k0s(),a.j41(3,"ion-list")(4,"ion-item")(5,"ion-input",14),a.mxI("ngModelChange",function(He){a.eBV(Ne);const be=a.XpG();return a.DH7(be.email,He)||(be.email=He),a.Njj(He)}),a.k0s()(),a.j41(6,"ion-item")(7,"ion-input",15),a.mxI("ngModelChange",function(He){a.eBV(Ne);const be=a.XpG();return a.DH7(be.password,He)||(be.password=He),a.Njj(He)}),a.k0s()()(),a.j41(8,"p")(9,"a",8),a.bIt("click",function(){a.eBV(Ne);const He=a.XpG();return a.Njj(He.appManager.launchWebPage("https://openchargemap.org/site/loginprovider/passwordreset"))}),a.EFF(10,"Reset your password"),a.k0s()(),a.bVm()}if(2&je){const Ne=a.XpG();a.R7$(5),a.R50("ngModel",Ne.email),a.R7$(2),a.R50("ngModel",Ne.password)}}function re(je,We){if(1&je){const Ne=a.RV6();a.qex(0),a.j41(1,"p",13),a.EFF(2," Create a new Open Charge Map account. "),a.k0s(),a.j41(3,"ion-list")(4,"ion-item")(5,"ion-label",16),a.EFF(6,"Email"),a.k0s(),a.j41(7,"ion-input",17),a.mxI("ngModelChange",function(He){a.eBV(Ne);const be=a.XpG();return a.DH7(be.email,He)||(be.email=He),a.Njj(He)}),a.k0s()(),a.j41(8,"ion-item")(9,"ion-label",16),a.EFF(10,"Display Name or Nickname"),a.k0s(),a.j41(11,"ion-input",17),a.mxI("ngModelChange",function(He){a.eBV(Ne);const be=a.XpG();return a.DH7(be.username,He)||(be.username=He),a.Njj(He)}),a.k0s()(),a.j41(12,"ion-item")(13,"ion-label",16),a.EFF(14,"Password"),a.k0s(),a.j41(15,"ion-input",18),a.mxI("ngModelChange",function(He){a.eBV(Ne);const be=a.XpG();return a.DH7(be.password,He)||(be.password=He),a.Njj(He)}),a.k0s()(),a.j41(16,"ion-item")(17,"ion-label",16),a.EFF(18,"Confirm Password"),a.k0s(),a.j41(19,"ion-input",18),a.mxI("ngModelChange",function(He){a.eBV(Ne);const be=a.XpG();return a.DH7(be.confirmpassword,He)||(be.confirmpassword=He),a.Njj(He)}),a.k0s()()(),a.bVm()}if(2&je){const Ne=a.XpG();a.R7$(7),a.R50("ngModel",Ne.email),a.R7$(4),a.R50("ngModel",Ne.username),a.R7$(4),a.R50("ngModel",Ne.password),a.R7$(4),a.R50("ngModel",Ne.confirmpassword)}}let ze=(()=>{class je{appManager;modalController;translate;alertController;loadingController;logging;router;location;email;password;username;confirmpassword;mode="signin";constructor(Ne,ht,He,be,Ye,Le,ot,Ve){this.appManager=Ne,this.modalController=ht,this.translate=He,this.alertController=be,this.loadingController=Ye,this.logging=Le,this.router=ot,this.location=Ve,this.email=""}cancelSignIn(){this.modalController.dismiss()}performRegister(){var Ne=this;return(0,g.A)(function*(){if(Ne.password!=Ne.confirmpassword)return void alert("Your password and the confirmed password do not match, please try again.");if(Ne.password.length<6)return void alert("Your password should be at least 6 characters.");const ht=yield Ne.loadingController.create({message:"Registering .."});yield ht.present();let He=!1;try{yield Ne.appManager.api.performRegister(Ne.username,Ne.email,Ne.password),ht.dismiss(),localStorage.setItem("authResponse",JSON.stringify(Ne.appManager.api.authResponse)),Ne.appManager.isUserAuthenticated(!0),Ne.modalController.dismiss(),Ne.appManager.analytics.appEvent("Profile","SignedIn")}catch(be){He=!0,ht.dismiss(),yield(yield Ne.alertController.create({header:"Open Charge Map",subHeader:"Email or Password not recognised",buttons:["Ok"]})).present(),Ne.logging.log("Error logging in:"+be)}})()}performSignIn(){var Ne=this;return(0,g.A)(function*(){if("register"==Ne.mode)return Ne.performRegister();const ht=yield Ne.loadingController.create({message:"Signing In.."});yield ht.present();let He=!1;try{yield Ne.appManager.api.performSignIn(Ne.email,Ne.password),ht.dismiss(),localStorage.setItem("authResponse",JSON.stringify(Ne.appManager.api.authResponse)),Ne.appManager.isUserAuthenticated(!0),Ne.modalController.dismiss(),Ne.appManager.analytics.appEvent("Profile","SignedIn")}catch(be){He=!0,ht.dismiss(),yield(yield Ne.alertController.create({header:"Open Charge Map",subHeader:"Email or Password not recognised",buttons:["Ok"]})).present(),Ne.logging.log("Error logging in:"+be)}})()}static \u0275fac=function(ht){return new(ht||je)(a.rXU(me.r),a.rXU(Z.W3),a.rXU(ie.c$),a.rXU(Z.hG),a.rXU(Z.Xi),a.rXU(v.y),a.rXU(T.Ix),a.rXU(Ce.aZ))};static \u0275cmp=a.VBU({type:je,selectors:[["ng-component"]],decls:28,vars:9,consts:[[1,"signin-page","ion-padding"],["item-left",""],["src","assets/images/icons/branding/AppIcon_128x128.png"],[3,"ngModelChange","ngModel"],["value","signin"],["value","register"],[4,"ngIf"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["type","submit","color","primary",3,"click"],["name","log-in","slot","start"],[1,"ion-padding"],["label","Email","label-placement","floating","type","text",3,"ngModelChange","ngModel"],["label","Password","label-placement","floating","type","password",3,"ngModelChange","ngModel"],["position","floating"],["type","text",3,"ngModelChange","ngModel"],["type","password",3,"ngModelChange","ngModel"]],template:function(ht,He){1&ht&&(a.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),a.EFF(3),a.nI1(4,"translate"),a.k0s()()(),a.j41(5,"ion-content",0)(6,"ion-avatar",1),a.nrm(7,"img",2),a.k0s(),a.j41(8,"ion-segment",3),a.mxI("ngModelChange",function(Ye){return a.DH7(He.mode,Ye)||(He.mode=Ye),Ye}),a.j41(9,"ion-segment-button",4)(10,"ion-label"),a.EFF(11,"Sign In"),a.k0s()(),a.j41(12,"ion-segment-button",5)(13,"ion-label"),a.EFF(14,"Create Account"),a.k0s()()(),a.DNE(15,Je,11,2,"ng-container",6)(16,re,20,4,"ng-container",6),a.k0s(),a.j41(17,"ion-footer")(18,"ion-toolbar")(19,"ion-buttons",7)(20,"ion-button",8),a.bIt("click",function(){return He.cancelSignIn()}),a.nrm(21,"ion-icon",9),a.EFF(22," Cancel"),a.k0s()(),a.j41(23,"ion-buttons",10)(24,"ion-button",11),a.bIt("click",function(){return He.performSignIn()}),a.nrm(25,"ion-icon",12),a.EFF(26),a.nI1(27,"translate"),a.k0s()()()()),2&ht&&(a.R7$(3),a.SpI(" ",a.bMT(4,5,"ocm.general.signIn")," "),a.R7$(5),a.R50("ngModel",He.mode),a.R7$(7),a.Y8G("ngIf","signin"==He.mode),a.R7$(),a.Y8G("ngIf","register"==He.mode),a.R7$(10),a.SpI(" ",a.bMT(27,7,"ocm.general.signIn"),""))},dependencies:[Ce.bT,De.BC,De.vS,Z.mC,Z.Jm,Z.QW,Z.W9,Z.M0,Z.eU,Z.iq,Z.$w,Z.uz,Z.he,Z.nf,Z.Gp,Z.eP,Z.BC,Z.ai,Z.Je,Z.Gw,ie.D9],encapsulation:2})}return je})()},6320:(vi,Vt,B)=>{"use strict";B.d(Vt,{Q:()=>Ce});var g=B(467),v=B(3118),me=B(3371),a=B(9093),Z=B(1626),ie=B(5312),T=B(3953);let Ce=(()=>{class De{http;refData;logging;serviceBase="https://api.openchargemap.io";serviceBaseURL=this.serviceBase+"/v4";hasAuthorizationError=!1;ATTRIBUTION_METADATAFIELDID=4;authResponse;clientName="ocm.api.default";authorizationErrorCallback;generalErrorCallback;allowMirror=!1;lastPOIApiCallURL="";constructor(re,ze,je){this.http=re,this.refData=ze,this.logging=je,this.serviceBaseURL=ie.c.apiBase+"/v3"}getNumberListString(re){let ze="";for(let je=0;je<re.length;je++)ze+=re[je],je<re.length&&(ze+=",");return ze}fetchPOIListByParam(re){var ze=this;return(0,g.A)(function*(){const je=ze.serviceBaseURL+"/poi/?client="+ze.clientName+(ze.allowMirror?" &allowmirror=true":"")+"&verbose=false&output=json";re.compact=!0;let We="";null!=re.countryCode&&(We+="&countrycode="+re.countryCode),null!=re.latitude&&(We+="&latitude="+re.latitude),null!=re.longitude&&(We+="&longitude="+re.longitude),null!=re.distance&&(We+="&distance="+re.distance),null!=re.distanceUnit&&(We+="&distanceunit="+re.distanceUnit),null!=re.includeComments&&(We+="&includecomments="+re.includeComments),null!=re.maxResults&&(We+="&maxresults="+re.maxResults),null!=re.countryIdList&&(We+="&countryid="+ze.getNumberListString(re.countryIdList)),null!=re.levelIdList&&(We+="&levelid="+ze.getNumberListString(re.levelIdList)),null!=re.connectionTypeIdList&&re.connectionTypeIdList.length>0&&(We+="&connectiontypeid="+ze.getNumberListString(re.connectionTypeIdList)),null!=re.operatorIdList&&re.operatorIdList.length>0&&(We+="&operatorid="+ze.getNumberListString(re.operatorIdList)),null!=re.usageTypeIdList&&re.usageTypeIdList.length>0&&(We+="&usagetypeid="+ze.getNumberListString(re.usageTypeIdList)),null!=re.statusTypeIdList&&re.statusTypeIdList.length>0&&(We+="&statustypeid="+ze.getNumberListString(re.statusTypeIdList)),null!=re.locationTitle&&(We+="&locationtitle="+re.locationTitle),null!=re.minPowerKW&&re.minPowerKW>0&&(We+="&minpowerkw="+re.minPowerKW),null!=re.maxPowerKW&&re.maxPowerKW>0&&(We+="&maxpowerkw="+re.maxPowerKW),null!=re.submissionStatusTypeIdList&&(We+="&submissionstatustypeid="+ze.getNumberListString(re.submissionStatusTypeIdList)),null!=re.poiIdList&&re.poiIdList.length>0&&(We+="&chargepointid="+ze.getNumberListString(re.poiIdList)),0==re.enableCaching&&(We+="&enablecaching=false"),null!=re.compact&&(We+="&compact="+re.compact),re.levelOfDetail>1&&(We+="&levelofdetail="+re.levelOfDetail),null!=re.polyline&&(We+="&polyline="+re.polyline),null!=re.boundingbox&&(We+="&boundingbox="+re.boundingbox),null!=re.additionalParams&&(We+="&"+re.additionalParams);const Ne=je+We;if(ze.lastPOIApiCallURL===Ne&&0!=re.enableCaching)return ze.logging.log("Skipped API call due to same query being repeated."),[];ze.lastPOIApiCallURL=Ne,ze.logging.log("API Call:"+Ne,v.$.VERBOSE);try{let ht=yield ze.http.get(Ne,ze.getHttpRequestOptions()).toPromise();return ze.refData.hydrateCompactPOIList(ht)}catch(ht){const He=ht.message||"Could not fetch POI list from server.";throw ze.logging.log("API Client: "+JSON.stringify(ht),v.$.ERROR),He}})()}getHttpRequestOptions(re=!0){let ze=new Z.Lr;return re&&(ze=ze.append("Content-Type","application/json")),this.authResponse&&this.authResponse.Data&&this.authResponse.Data.access_token&&(ze=ze.append("Authorization","Bearer "+this.authResponse.Data.access_token)),ze=ze.append("X-API-Key",ie.c.apiKey),{headers:ze}}fetchCoreReferenceData(re){let ze=this.serviceBaseURL+"/referencedata/?client="+this.clientName+"&output=json"+(this.allowMirror?"&allowmirror=true":"")+"&verbose=false&compact=true";return null!=re&&null!=re.CountryIds&&(ze+="&countryid="+this.getNumberListString(re.CountryIds)),this.logging.log("API Call:"+ze,v.$.VERBOSE),this.http.get(ze,this.getHttpRequestOptions())}performSignIn(re,ze){return this.http.post(this.serviceBaseURL+"/profile/authenticate/",JSON.stringify({emailaddress:re,password:ze}),this.getHttpRequestOptions()).toPromise().then(Ne=>(this.authResponse=Ne,this.authResponse))}performRegister(re,ze,je){return this.http.post(this.serviceBaseURL+"/profile/register/",JSON.stringify({username:re,emailaddress:ze,password:je}),this.getHttpRequestOptions()).toPromise().then(ht=>(this.authResponse=ht,this.authResponse))}performSubmission(re,ze){return re===a.NA.POI?this.submitPOI(ze):re===a.NA.Comment?this.submitUserComment(ze):re===a.NA.Media?this.submitMediaItem(ze):void 0}submitUserComment(re){const ze=JSON.stringify(re);return this.logging.log("[api] Submitting user comment"),this.http.post(this.serviceBaseURL+"/comment/",ze,this.getHttpRequestOptions()).toPromise()}submitMediaItem(re){const ze=JSON.stringify(re);return this.http.post(this.serviceBaseURL+"/mediaitem/",ze,this.getHttpRequestOptions()).toPromise()}submitPOI(re){const ze=JSON.stringify(re);return this.http.post(this.serviceBaseURL+"/poi/",ze,this.getHttpRequestOptions()).toPromise()}getPanoramioLocationPhotos(re){return new Promise(ze=>{const We="https://www.panoramio.com/map/get_panoramas.php?set=public&from=0&to=2&minx="+(re.longitude-.001)+"&miny="+(re.latitude-.001)+"&maxx="+(re.longitude+.001)+"maxy="+(re.latitude+.001)+"&size=medium&mapfilter=true&callback=?";return console.log(We),this.http.get(We).toPromise()})}fetchReverseGeocodeResult(re,ze){return this.http.get(this.serviceBaseURL+"/geocode/?client="+this.clientName+"&output=json&camelcase=false&latitude="+re+"&longitude="+ze,this.getHttpRequestOptions()).toPromise()}isLocalStorageAvailable(){return typeof window.localStorage<"u"}setCachedDataObject(re,ze){this.isLocalStorageAvailable()&&(typeof ze>"u"&&(ze=null),null===ze?localStorage.removeItem(re):localStorage.setItem(re,JSON.stringify(ze)))}getCachedDataObject(re){if(this.isLocalStorageAvailable()){const ze=localStorage.getItem(re);if(null!=ze&&ze.length>0)return JSON.parse(ze)}return null}static \u0275fac=function(ze){return new(ze||De)(T.KVO(Z.Qq),T.KVO(me.r),T.KVO(v.y))};static \u0275prov=T.jDH({token:De,factory:De.\u0275fac,providedIn:"root"})}return De})()},543:(vi,Vt,B)=>{"use strict";B.d(Vt,{j:()=>Z});var g=B(467),v=B(3118),me=B(3953),a=B(3656);let Z=(()=>{class ie{logger;platform;isCordova=!1;ga=null;constructor(Ce,De){this.logger=Ce,this.platform=De,this.isCordova=!(!De.is("cordova")&&!De.is("capacitor"))}init(Ce){var De=this;return(0,g.A)(function*(){De.isCordova&&De.ga?yield De.ga.startTrackerWithId(Ce):De.logger.log("Could not initialise analytics")})()}setAppVersion(Ce){var De=this;return(0,g.A)(function*(){if(De.isCordova&&De.ga)return De.ga.setAppVersion(Ce);De.logger.log(Ce)})()}appEvent(Ce,De){var Je=this;return(0,g.A)(function*(){if(Je.isCordova&&Je.ga)return Je.ga.trackEvent(Ce,De);Je.logger.log(De)})()}viewEvent(Ce){var De=this;return(0,g.A)(function*(){if(De.isCordova&&De.ga)return De.ga.trackView(Ce);De.logger.log(Ce)})()}static \u0275fac=function(De){return new(De||ie)(me.KVO(v.y),me.KVO(a.OD))};static \u0275prov=me.jDH({token:ie,factory:ie.\u0275fac,providedIn:"root"})}return ie})()},4296:(vi,Vt,B)=>{"use strict";B.d(Vt,{r:()=>He});var g=B(467),v=B(3118),me=B(6320),a=B(9093),Z=B(3953),ie=B(3458);let T=(()=>{class be{events;isQueueProcessing;appManager;constructor(Le){this.events=Le,this.isQueueProcessing=!1}setAppManager(Le){this.appManager=Le}add(Le,ot){let Ve=this.getQueueItems();Ve.push(new a.r(Le,ot)),this.saveQueueItems(Ve)}update(Le){let ot=this.getQueueItems(),Ve=new Array;return ot.forEach(Ue=>{Ve.push(Ue.ID==Le.ID?Le:Ue)}),Ve}processNextQueueItem(){let Le=this.getNextQueueItem();null!=Le&&null!=this.appManager&&this.appManager.api.performSubmission(Le.SubmissionType,Le.Data).then(()=>{Le.IsSubmitted=!0,Le.Attempts++,this.update(Le),this.clear()})}getNextQueueItem(){let Le=this.getQueueItems(),ot=null;return Le.forEach(Ve=>{null==ot&&!Ve.IsCancelled&&!Ve.IsInProgress&&!Ve.IsSubmitted&&(ot=Ve)}),ot}hasPendingItems(){let Le=!1;return this.getQueueItems().forEach(Ve=>{!Ve.IsFailure&&!Ve.IsCancelled&&!Ve.IsSubmitted&&(Le=!0)}),Le}isCompleted(){let Le=this.getQueueItems(),ot=!0;return Le.forEach(Ve=>{(Ve.IsInProgress||Ve.IsFailure)&&(ot=!1)}),ot}clear(Le=!1){let ot=this.getQueueItems(),Ve=new Array;Le||ot.forEach(Ue=>{(Ue.IsInProgress||Ue.IsFailure)&&Ve.push(Ue)}),this.saveQueueItems(Ve)}saveQueueItems(Le){localStorage.setItem("submissionQueue",JSON.stringify(Le))}getQueueItems(){let Le=localStorage.getItem("submissionQueue");return null!=Le?JSON.parse(Le):new Array}static \u0275fac=function(ot){return new(ot||be)(Z.KVO(ie.s))};static \u0275prov=Z.jDH({token:be,factory:be.\u0275fac,providedIn:"root"})}return be})();var Ce=B(3371),De=B(5044),Je=B(543),re=B(5312),ze=B(1626),je=B(3656),We=B(9465),Ne=B(4842),ht=B(7552);let He=(()=>{class be{http;events;api;submissionQueue;platform;referenceDataManager;journeyManager;translateService;toastController;loadingController;jwtHelper;logging;analytics;enableSubmissionQueue;searchSettings;platformMode;journeys;isDebugMode;clientWidth;clientHeight;isRequestInProgress=!1;title="Open Charge Map";_isUserAuthenticated=null;isEmbeddedMode=!1;isOffline=!1;constructor(Le,ot,Ve,Ue,$t,nt,xt,ct,Mt,$e,Et,cn,fn){this.http=Le,this.events=ot,this.api=Ve,this.submissionQueue=Ue,this.platform=$t,this.referenceDataManager=nt,this.journeyManager=xt,this.translateService=ct,this.toastController=Mt,this.loadingController=$e,this.jwtHelper=Et,this.logging=cn,this.analytics=fn,this.api.clientName="ocm.app.ionic."+re.c.version,this.isDebugMode=!1,this.enableSubmissionQueue=!1,this.submissionQueue.setAppManager(this),this.platformMode=$t.is("cordova")?"cordova":"web",this.initAppManager(),this.searchSettings=new a.ig,this.loadSearchSettings(),this.applyURLQueryStringOptions(),this.searchSettings.CheckForActiveFilters(),this.journeyManager.loadJourneys()}loadSearchSettings(){if(null!=localStorage.getItem("searchSettings")){this.searchSettings=new a.ig;try{let Le=JSON.parse(localStorage.getItem("searchSettings"));Object.assign(this.searchSettings,Le)}catch{}}}savePushRegistration(Le){localStorage.setItem("_pushToken",Le.toString())}getPushRegistration(){localStorage.getItem("_pushToken")}getQueryVariable(Le){let Ve=window.location.search.substring(1).split("&");for(let Ue=0;Ue<Ve.length;Ue++){let $t=Ve[Ue].split("=");if(decodeURIComponent($t[0])==Le)return $t[1].split(",").map(ct=>decodeURIComponent(ct))}return null}applyURLQueryStringOptions(){if(this.getQueryVariable("mode")&&"embedded"==this.getQueryVariable("mode")[0]&&(this.isEmbeddedMode=!0),this.getQueryVariable("operatorid")){let Le=this.getQueryVariable("operatorid");for(let ot of Le)this.searchSettings.OperatorList.unshift(parseInt(ot,10))}if(this.getQueryVariable("latitude")&&this.getQueryVariable("longitude")){let Le=this.getQueryVariable("latitude")[0],ot=this.getQueryVariable("longitude")[0];this.searchSettings.StartSearchPosition=new a.cW(parseFloat(Le),parseFloat(ot))}this.getQueryVariable("title")&&(this.title=this.getQueryVariable("title")[0]),this.getQueryVariable("languagecode")&&this.setLanguage(this.getQueryVariable("languagecode")[0]),this.getQueryVariable("id")&&(this.searchSettings.StartViewPoiId=this.getQueryVariable("id")[0])}saveSearchSettings(){this.searchSettings.CheckForActiveFilters(),localStorage.setItem("searchSettings",JSON.stringify(this.searchSettings))}getLanguages(){return[{code:"ar",title:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629 / Arabic"},{code:"bg",title:"Bulgarian / \u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438"},{code:"cs",title:"Czech / \u010ce\u0161tina"},{code:"de",title:"German / Deutsch"},{code:"el",title:"Greek / \u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ae"},{code:"en",title:"English"},{code:"es",title:"Spanish / Espa\xf1ol"},{code:"et",title:"Estonian / Eesti"},{code:"fi",title:"Finnish / Suomi"},{code:"fr",title:"French / Fran\xe7ais"},{code:"fy",title:"West Frisian / Frysk"},{code:"hu",title:"Hungarian / Magyar"},{code:"it",title:"Italian / Italiano"},{code:"ja",title:"Japanese / \u65e5\u672c\u8a9e"},{code:"lt",title:"Lithuanian / Lietuvi\u0173"},{code:"nl",title:"Dutch / Nederlands"},{code:"pt",title:"Portuguese / portugu\xeas"},{code:"ro",title:"Romanian / Rom\xe2n\u0103"},{code:"ru",title:"Russian / P\u0443\u0441\u0441\u043a\u0438\u0439"},{code:"sk",title:"Slovak / Sloven\u010dina"},{code:"tr",title:"Turkish / T\xfcrk\xe7e"},{code:"zh",title:"Chinese / \u4e2d\u56fd\u7684"}]}setLanguage(Le){(null==Le||""==Le)&&(Le="en"),this.logging.log("Changing language: "+Le),this.translateService.use(Le)}initAppManager(){this.initAuthFromStorage(),this.isUserAuthenticated(!0)&&this.enableSubmissionQueue&&null!=this.submissionQueue&&this.submissionQueue.hasPendingItems()&&this.submissionQueue.processNextQueueItem()}initAuthFromStorage(){let Le=localStorage.getItem("authResponse");if(null!=Le){let ot=JSON.parse(Le);null!=ot?.Data&&null!=ot?.Data?.access_token?(this.jwtHelper.decodeToken(ot.Data.access_token),this.jwtHelper.isTokenExpired(ot.Data.access_token)?localStorage.removeItem("authResponse"):(this.api.authResponse=ot,this.logging.log("User has valid auth token in local storage",v.$.VERBOSE))):(this.logging.log("User has invalid auth token in local storage",v.$.VERBOSE),localStorage.removeItem("authResponse"))}}isUserAuthenticated(Le=!1){return!1===Le&&null!=this._isUserAuthenticated||(this._isUserAuthenticated=!1,null!=this.api.authResponse&&(this.jwtHelper.isTokenExpired(this.api.authResponse.Data.access_token)||(this._isUserAuthenticated=!0))),this._isUserAuthenticated}getCurrentAuthToken(){return null!=this.api.authResponse?this.api.authResponse.Data.access_token:null}getUserProfile(){return null!=this.api.authResponse?this.api.authResponse.Data.UserProfile:null}signOutCurrentUser(){localStorage.removeItem("authResponse"),this.api.authResponse=null,this._isUserAuthenticated=!1}submitComment(Le){if(!this.enableSubmissionQueue)return this.api.performSubmission(a.NA.Comment,Le);this.submissionQueue.add(a.NA.Comment,Le),this.submissionQueue.processNextQueueItem()}submitMediaItem(Le){if(!this.enableSubmissionQueue)return this.api.performSubmission(a.NA.Media,Le);this.submissionQueue.add(a.NA.Media,Le),this.submissionQueue.processNextQueueItem()}submitPOI(Le){if(!this.enableSubmissionQueue)return this.api.performSubmission(a.NA.POI,Le);this.submissionQueue.add(a.NA.POI,Le),this.submissionQueue.processNextQueueItem()}showToastNotification(Le){var ot=this;return(0,g.A)(function*(){yield(yield ot.toastController.create({message:Le,duration:3e3})).present()})()}showLoadingProgress(Le){var ot=this;return(0,g.A)(function*(){yield(yield ot.loadingController.create({message:Le})).present()})()}dismissLoadingProgress(){var Le=this;return(0,g.A)(function*(){return Le.loadingController.dismiss()})()}launchOCMWebPage(Le){this.isUserAuthenticated(!0)&&(-1===Le.indexOf("?")&&(Le+="?"),Le+="&auth="+this.getCurrentAuthToken()),Le="https://openchargemap.org/site"+Le,window.open(Le,"_system")}launchWebPage(Le){window.open(Le,"_system")}isPlatform(Le){return this.platform.is(Le)}static \u0275fac=function(ot){return new(ot||be)(Z.KVO(ze.Qq),Z.KVO(ie.s),Z.KVO(me.Q),Z.KVO(T),Z.KVO(je.OD),Z.KVO(Ce.r),Z.KVO(De.K),Z.KVO(Ne.c$),Z.KVO(We.K_),Z.KVO(We.Xi),Z.KVO(ht.X7),Z.KVO(v.y),Z.KVO(Je.j))};static \u0275prov=Z.jDH({token:be,factory:be.\u0275fac,providedIn:"root"})}return be})()},3458:(vi,Vt,B)=>{"use strict";B.d(Vt,{s:()=>v});var g=B(3953);let v=(()=>{class me{c=new Map;constructor(){}subscribe(Z,...ie){let T=this.c.get(Z);T||this.c.set(Z,T=[]),T.push(...ie)}unsubscribe(Z,ie){if(!ie)return this.c.delete(Z);const T=this.c.get(Z);if(!T)return!1;const Ce=T.indexOf(ie);return!(Ce<0||(T.splice(Ce,1),0===T.length&&this.c.delete(Z),0))}publish(Z,...ie){const T=this.c.get(Z);return T?T.map(Ce=>{try{return Ce(...ie)}catch(De){return console.error(De),null}}):null}static \u0275fac=function(ie){return new(ie||me)};static \u0275prov=g.jDH({token:me,factory:me.\u0275fac,providedIn:"root"})}return me})()},5044:(vi,Vt,B)=>{"use strict";B.d(Vt,{K:()=>ie});var g=B(3118),v=B(6320),me=B(5040),a=B(9093),Z=B(3953);let ie=(()=>{class T{api;poiManager;logging;journeys;favourites;routePolyline;constructor(De,Je,re){this.api=De,this.poiManager=Je,this.logging=re,this.journeys=[],this.favourites=[]}loadJourneys(){let De=localStorage.getItem("journeys");if(null!=De&&(this.journeys=JSON.parse(De)),null!=this.journeys)for(let Je of this.journeys)this.fetchAllJourneyPOIDetails(Je)}fetchAllJourneyPOIDetails(De){this.logging.log("Journeys - fetching poi details for Journey "+De.Title);let Je=new a.te;Je.poiIdList=[];for(let re of De.Stages)for(let ze of re.WayPoints)for(let je of ze.PoiIDs)Je.poiIdList.push(je);this.api.fetchPOIListByParam(Je).then(re=>{for(let ze of re)this.updateStoredPOI(ze)})}updateStoredPOI(De){if(this.journeys.forEach(Je=>{Je.Stages.forEach(re=>{re.WayPoints.forEach(ze=>{ze.PoiIDs.forEach(je=>{if(je==De.ID)if(null==ze.PoiList){ze.PoiList=[];let We=new a.CS("charging",1);We.Poi=De,We.PoiID=De.ID,ze.PoiList.push(We)}else for(let We of ze.PoiList)We.PoiID==De.ID&&(We.Poi=De)})})})}),null!=this.favourites)for(let Je of this.favourites)"charging"==Je.Type&&Je.PoiID==De.ID&&(Je.Poi=De)}saveJourneys(){let De=JSON.parse(JSON.stringify(this.journeys));for(let re of De)for(const ze of re.Stages)for(let je of ze.WayPoints)for(let We of je.PoiList)We.Poi=null,We.Photos=null;const Je=JSON.stringify(De);localStorage.setItem("journeys",Je)}addJourney(De,Je){let re=new a.dx;re.Title="Stage 1",null!=Je&&re.WayPoints.push(Je),De.Stages.push(re),this.journeys.push(De)}deleteJourney(De){this.journeys=this.journeys.filter(Je=>Je.ID!=De),this.saveJourneys()}getJourney(De){let Je=this.journeys.filter(re=>re.ID==De);return Je.length>0?Je[0]:null}getJourneyStages(De){return this.getJourney(De).Stages}addJourneyWaypoint(De,Je,re){let ze=this.getJourney(De);if(null==Je){let je=new a.dx;je.Title="Stage "+(ze.Stages.length+1),je.WayPoints.push(re),ze.Stages.push(je)}else{let je=ze.Stages[Je];null==je.WayPoints&&(je.WayPoints=[]),je.WayPoints.push(re)}}addJourneyStage(De,Je){return this.getJourney(De).Stages.push(Je)-1}setupTestJourneys(){this.journeys=[];let De=new a.L_;De.Title="New York to Brooklyn",De.Notes="A little jaunt to Brooklyn",De.Stages=[];let Je=new a.dx,re=new a.gu;re.Notes="Starting point",re.Position=new a.cW(40,1.2),re.Title="Start",Je.WayPoints.push(re);let ze=new a.gu;ze.Notes="Middle point",ze.Position=new a.cW(40,1.33),ze.Title="Middle",Je.WayPoints.push(ze);let je=new a.gu;je.Notes="End point",je.Position=new a.cW(40,1.33),je.Title="End",Je.WayPoints.push(je),De.Stages.push(Je),this.journeys.push(De);let We=new a.L_;We.Title="Aberdeen to London",We.Notes="Roadtrip",We.Stages=[],this.journeys.push(We)}calculateEnergyConsumptionkWh(De,Je,re=0,ze){return De*ze}setRoutePolyline(De){this.routePolyline=De}getRoutePolyline(){return this.routePolyline}static \u0275fac=function(Je){return new(Je||T)(Z.KVO(v.Q),Z.KVO(me.U),Z.KVO(g.y))};static \u0275prov=Z.jDH({token:T,factory:T.\u0275fac,providedIn:"root"})}return T})()},3118:(vi,Vt,B)=>{"use strict";B.d(Vt,{$:()=>me,y:()=>a});var g=B(5312),v=B(3953),me=function(Z){return Z[Z.VERBOSE=0]="VERBOSE",Z[Z.INFO=1]="INFO",Z[Z.WARNING=2]="WARNING",Z[Z.ERROR=3]="ERROR",Z}(me||{});let a=(()=>{class Z{logLevel;constructor(){this.logLevel=me.VERBOSE,g.c.production&&(this.logLevel=me.INFO)}log(T,Ce=me.VERBOSE){console&&console.log&&Ce>=this.logLevel&&console.log("["+me[Ce]+"] {"+(new Date).toLocaleTimeString()+"} "+T)}static \u0275fac=function(Ce){return new(Ce||Z)};static \u0275prov=v.jDH({token:Z,factory:Z.\u0275fac,providedIn:"root"})}return Z})()},5040:(vi,Vt,B)=>{"use strict";B.d(Vt,{U:()=>T});var g=B(467),v=B(3118),me=B(6320),a=B(543),Z=B(3953),ie=B(3458);let T=(()=>{class Ce{api;events;logging;analytics;poiList;isRequestInProgress=!1;constructor(Je,re,ze,je){this.api=Je,this.events=re,this.logging=ze,this.analytics=je}refreshPOIList(Je){var re=this;return(0,g.A)(function*(){try{return re.poiList=yield re.fetchPOIList(Je),re.events.publish("ocm:poiList:updated"),re.analytics.appEvent("Search","Fetched Results"),re.poiList.length}catch{return 0}})()}fetchPOIList(Je){var re=this;return(0,g.A)(function*(){re.isRequestInProgress=!0;try{let ze=yield re.api.fetchPOIListByParam(Je);return re.isRequestInProgress=!1,ze&&ze.length&&re.logging.log("fetched POI list ["+ze.length+"]"),ze}catch{return re.isRequestInProgress=!1,[]}})()}clearResults(){this.poiList=[],this.events.publish("ocm:poiList:cleared"),this.logging.log("clearing results after settings change",v.$.VERBOSE)}getPOIById(Je,re=!1,ze=!1){var je=this;return(0,g.A)(function*(){if(!ze&&null!=je.poiList){const ht=je.poiList.find(He=>He.ID==Je);if(ht)return ht}const We={poiIdList:[Je],enableCaching:!ze,includeComments:!0},Ne=yield je.api.fetchPOIListByParam(We);return Ne&&Ne.length>0?(je.poiList&&Ne[0].ID==Je&&(je.poiList=je.poiList.filter(ht=>ht.ID!=Je),je.poiList.push(Ne[0]),je.logging.log("POI refreshed in cache "+Je)),Ne[0]):null})()}static \u0275fac=function(re){return new(re||Ce)(Z.KVO(me.Q),Z.KVO(ie.s),Z.KVO(v.y),Z.KVO(a.j))};static \u0275prov=Z.jDH({token:Ce,factory:Ce.\u0275fac,providedIn:"root"})}return Ce})()},3371:(vi,Vt,B)=>{"use strict";B.d(Vt,{r:()=>Z});var g=B(467),v=B(3118),me=B(3953),a=B(1626);let Z=(()=>{class ie{http;logging;referenceData;filteredReferenceData;constructor(Ce,De){this.http=Ce,this.logging=De,this.loadCachedRefData()}refreshReferenceData(Ce){var De=this;return(0,g.A)(function*(){try{const Je=yield Ce.fetchCoreReferenceData(null).toPromise();return De.setCoreReferenceData(Je),De.setFilteredReferenceData(Je),De.logging.log("Got refreshed core ref data.",v.$.VERBOSE),De.sortCoreReferenceData(),De.cacheCurrentRefData(),!0}catch(Je){return De.logging.log("Error fetching core ref data:"+Je),!1}})()}refreshFilteredReferenceData(Ce,De){Ce.fetchCoreReferenceData(De).subscribe(Je=>{this.setFilteredReferenceData(Je),this.sortCoreReferenceData(),this.logging.log("Got refreshed filtered reference data.",v.$.VERBOSE)},Je=>{this.logging.log("Error fetching filtered reference data:"+Je)})}setCoreReferenceData(Ce){this.referenceData=Ce}setFilteredReferenceData(Ce){this.filteredReferenceData=Ce}referenceDataLoaded(){return null!=this.referenceData}getCountries(Ce=!1){return 1==Ce?this.filteredReferenceData.Countries:this.referenceData.Countries}getCountryByID(Ce){return this.getRefDataByID(this.referenceData.Countries,Ce)}getConnectionTypes(Ce=!1){return 1==Ce?this.filteredReferenceData.ConnectionTypes:this.referenceData.ConnectionTypes}getConnectionTypeByID(Ce){return this.getRefDataByID(this.referenceData.ConnectionTypes,Ce)}getUsageTypes(Ce=!1){return 1==Ce?this.filteredReferenceData.UsageTypes:this.referenceData.UsageTypes.filter(De=>De.ID>0)}getUsageTypeByID(Ce){return this.getRefDataByID(this.referenceData.UsageTypes,Ce)}getStatusTypes(Ce=!1){return 1==Ce?this.filteredReferenceData.StatusTypes:this.referenceData.StatusTypes.filter(De=>De.ID>0)}getStatusTypeByID(Ce){return this.getRefDataByID(this.referenceData.StatusTypes,Ce)}getNetworkOperators(Ce=!1){return 1==Ce?this.filteredReferenceData.Operators:this.referenceData.Operators}getNetworkOperatorByID(Ce){return this.getRefDataByID(this.referenceData.Operators,Ce)}getDataProviders(Ce=!1){return 1==Ce?this.filteredReferenceData.DataProviders:this.referenceData.DataProviders}getDataProviderByID(Ce){return this.getRefDataByID(this.referenceData.DataProviders,Ce)}getCheckinStatusTypes(Ce=!1,De=!0){let Je=null;return Je=1==Ce?this.filteredReferenceData.CheckinStatusTypes:this.referenceData.CheckinStatusTypes,De&&(Je=Je.filter(re=>!1===re.IsAutomatedCheckin)),Je}getCheckinStatusTypeByID(Ce){return this.getRefDataByID(this.referenceData.CheckinStatusTypes,Ce)}getCommentTypes(Ce=!1,De=!0){let Je;return Je=1==Ce?this.filteredReferenceData.UserCommentTypes:this.referenceData.UserCommentTypes,De&&(Je=Je.filter(re=>100!==re.ID&&110!==re.ID)),Je}getCommentTypeByID(Ce){return this.getRefDataByID(this.referenceData.UserCommentTypes,Ce)}getSubmissionStatusTypes(Ce=!1){return 1==Ce?this.filteredReferenceData.SubmissionStatusTypes:this.referenceData.SubmissionStatusTypes}getSubmissionStatusTypesByID(Ce){return this.getRefDataByID(this.referenceData.SubmissionStatusTypes,Ce)}getChargingLevelTypes(Ce=!1){return 1==Ce?this.filteredReferenceData.ChargerTypes:this.referenceData.ChargerTypes}getChargingLevelTypeByID(Ce){return this.getRefDataByID(this.referenceData.ChargerTypes,Ce)}getOutputCurrentTypes(Ce=!1){return Ce?this.referenceData.CurrentTypes:this.filteredReferenceData.CurrentTypes}getOutputCurrentTypeByID(Ce){return this.getRefDataByID(this.referenceData.CurrentTypes,Ce)}loadCachedRefData(){const Ce=localStorage.getItem("referenceData");if(null==Ce)this.http.get("./assets/data/CoreReferenceData.json").subscribe(De=>{this.logging.log("Using bundled reference data as cached ref data."),this.setCoreReferenceData(De),this.setFilteredReferenceData(De)});else{let De=JSON.parse(Ce);this.setCoreReferenceData(De)}this.setFilteredReferenceData(this.referenceData)}cacheCurrentRefData(){null!=this.referenceData&&(this.referenceData.CacheDate=new Date,localStorage.setItem("referenceData",JSON.stringify(this.referenceData)))}getRefDataByID(Ce,De){if(""!==De&&(De=parseInt(De,10)),null!=Ce)for(let Je=0;Je<Ce.length;Je++)if(Ce[Je].ID===De)return Ce[Je];return null}sortCoreReferenceData(){this.sortReferenceData(this.referenceData.ConnectionTypes),this.sortReferenceData(this.referenceData.Countries),this.sortReferenceData(this.referenceData.Operators),this.sortReferenceData(this.referenceData.DataProviders),this.sortReferenceData(this.referenceData.UsageTypes),this.sortReferenceData(this.referenceData.StatusTypes),this.sortReferenceData(this.referenceData.CheckinStatusTypes),this.sortReferenceData(this.referenceData.SubmissionStatusTypes),this.filteredReferenceData&&(this.sortReferenceData(this.filteredReferenceData.ConnectionTypes),this.sortReferenceData(this.filteredReferenceData.Operators))}sortReferenceData(Ce){Ce.sort(this.sortListByTitle)}sortListByTitle(Ce,De){return Ce.Title<De.Title?-1:Ce.Title>De.Title?1:0}getMetadataValueByMetadataFieldID(Ce,De){if(""!==De&&(De=parseInt(De,10)),null!=Ce)for(let Je=0;Je<Ce.length;Je++)if(Ce[Je].ID===De)return Ce[Je];return null}hydrateCompactPOI(Ce,De=!1){const Je=this;if(null!=Ce.DataProviderID&&(De||null==Ce.DataProvider)&&(Ce.DataProvider=Je.getDataProviderByID(Ce.DataProviderID)),null!=Ce.OperatorID&&(De||null==Ce.OperatorInfo)&&(Ce.OperatorInfo=Je.getNetworkOperatorByID(Ce.OperatorID)),null!=Ce.UsageTypeID&&(De||null==Ce.UsageType)&&(Ce.UsageType=Je.getUsageTypeByID(Ce.UsageTypeID)),null!=Ce.AddressInfo.CountryID&&(De||null==Ce.AddressInfo.Country)&&(Ce.AddressInfo.Country=Je.getCountryByID(Ce.AddressInfo.CountryID)),null!=Ce.StatusTypeID&&(De||null==Ce.StatusType)&&(Ce.StatusType=Je.getStatusTypeByID(Ce.StatusTypeID)),null!=Ce.SubmissionStatusTypeID&&(De||null==Ce.SubmissionStatusType)&&(Ce.SubmissionStatusType=Je.getSubmissionStatusTypesByID(Ce.SubmissionStatusTypeID)),null!=Ce.Connections)for(let re=0;re<Ce.Connections.length;re++){const ze=Ce.Connections[re];null!=ze.ConnectionTypeID&&(De||null==ze.ConnectionType)&&(ze.ConnectionType=Je.getConnectionTypeByID(ze.ConnectionTypeID)),null!=ze.LevelID&&(De||null==ze.Level)&&(ze.Level=Je.getChargingLevelTypeByID(ze.LevelID)),null!=ze.CurrentTypeID&&(De||null==ze.CurrentType)&&(ze.CurrentType=Je.getOutputCurrentTypeByID(ze.CurrentTypeID)),null!=ze.StatusTypeID&&(De||null==ze.StatusType)&&(ze.StatusType=Je.getStatusTypeByID(ze.StatusTypeID)),Ce.Connections[re]=ze}if(null!=Ce.UserComments)for(let re=0;re<Ce.UserComments.length;re++){const ze=Ce.UserComments[re];null!=ze.CommentTypeID&&(De||null==ze.CommentType)&&(ze.CommentType=Je.getCommentTypeByID(ze.CommentTypeID)),null!=ze.CheckinStatusTypeID&&(De||null==ze.CheckinStatusType)&&(ze.CheckinStatusType=Je.getCheckinStatusTypeByID(ze.CheckinStatusTypeID)),Ce.UserComments[re]=ze}return Ce}hydrateCompactPOIList(Ce){for(let De=0;De<Ce.length;De++)Ce[De]=this.hydrateCompactPOI(Ce[De]);return Ce}static \u0275fac=function(De){return new(De||ie)(me.KVO(a.Qq),me.KVO(v.y))};static \u0275prov=me.jDH({token:ie,factory:ie.\u0275fac,providedIn:"root"})}return ie})()},6714:(vi,Vt,B)=>{"use strict";B.d(Vt,{X:()=>ht});var g=B(184),v=B(3229),me=B(5517),a=B(3118),Z=B(467),ie=B(1985),T=B(9394),Ce=B(5312),De=B(9093);class Je{events;logging;mapAPIType;mapReady;providerError;mapCanvasID;map;markerList;polylinePath;mapkitUtils;constructor(be,Ye){this.events=be,this.logging=Ye,this.events=be,this.mapAPIType=v.j.MAPKIT_JS,this.mapReady=!1,this.markerList=new Map,this.mapkitUtils=new re}initAPI(){mapkit&&mapkit.init({authorizationCallback:function(be){be(Ce.c.mapKitToken)}})}disposeMap(){}initMap(be,Ye,Le){this.mapCanvasID=be;let ot=!0;if(ot=!(typeof mapkit>"u"),!ot)return this.logging.log("Call to initMap before API is ready:"+v.j[this.mapAPIType],a.$.ERROR),this.mapReady=!1,!1;this.initAPI(),null==this.map&&(document.getElementById(be),this.map=new mapkit.Map(be),this.map.annotationForCluster=function(Ue){"poi"===Ue.clusteringIdentifier&&(Ue.title="Charging Location",Ue.subtitle=Ue.memberAnnotations.reduce(($t,nt)=>$t+nt.population,0))},this.mapReady=!0,mapkit.addEventListener("configuration-change",Ue=>{this.events.publish("ocm:mapping:ready")}),this.map.addEventListener("scroll-end",Ue=>{this.events.publish("ocm:mapping:dragend")}),this.map.addEventListener("zoom-end",Ue=>{this.events.publish("ocm:mapping:zoom")}))}clearMarkers(){null!=this.markerList&&this.markerList.forEach((be,Ye)=>{try{this.map.removeAnnotation(Ye)}catch{}}),this.markerList=new Map}showPOIListOnMap(be,Ye){let Ue=0,nt=0==this.markerList.size;if(null!=be){let ct=[];for(let Mt=0;Mt<be.length;Mt++)if(null!=be[Mt].AddressInfo&&null!=be[Mt].AddressInfo.Latitude&&null!=be[Mt].AddressInfo.Longitude){let $e=be[Mt],Et=!0;if(null!=this.markerList&&this.markerList.has($e.ID)&&(Et=!1),Et){let cn=null;cn=me.A.getIconForPOI($e);let at="OCM-"+$e.ID+": "+$e.AddressInfo.Title+":";null!=$e.UsageType&&(at+=" "+$e.UsageType.Title),null!=$e.StatusType&&(at+=" "+$e.StatusType.Title);const ve=new mapkit.Coordinate($e.AddressInfo.Latitude,$e.AddressInfo.Longitude);let Me=new mapkit.ImageAnnotation(ve,{title:at,size:{width:34,height:50},url:{1:cn},clusteringIdentifier:"poi"});Me.poi=$e,Me.addEventListener("select",fe=>{const vt=fe.target.poi;this.events.publish("ocm:poi:selected",{poi:vt,poiId:vt.ID})}),this.markerList.set($e.ID,Me),ct.push(Me),Ue++}}ct.length>0&&(this.map.addAnnotations(ct),nt&&this.map.showItems(ct,{animate:!0,padding:new mapkit.Padding(60,25,60,25)})),this.logging.log(Ue+" new map markers added out of a total "+this.markerList.size)}}refreshMapLayout(){null!=this.map&&setTimeout(()=>{this.logging.log("MapKit: refreshMapLayout",a.$.VERBOSE)},200)}setMapCenter(be,Ye){this.map&&(this.map.setCenterAnimated(new mapkit.Coordinate(be.coords.latitude,be.coords.longitude),!1),Ye&&this.setMapZoom(Ye))}getMapCenter(){return new ie.c(Ye=>{if(null!=this.map){let Le=this.map.center;null!=Le&&(Ye.next(new T.Bk(Le.latitude,Le.longitude)),Ye.complete())}})}setMapZoom(be){const Ye=Math.min(be,28),Le=this.mapkitUtils.deltaFromZoomLevel(this.map,this.map.center,Math.round(Ye)),ot=new mapkit.CoordinateSpan(111*Le.latitudeDelta,111*Le.longitudeDelta),Ve=new mapkit.CoordinateRegion(this.map.center,ot);this.map.setRegionAnimated(Ve)}getMapZoom(){return new ie.c(Ye=>{this.logging.log("MapKit: getMapZoom not supported",a.$.VERBOSE),Ye.next(this.map._impl.zoomLevel),Ye.complete()})}setMapType(be){this.logging.log("MapKit: skipped setting Map Type :"+be)}getMapBounds(){return new ie.c(Ye=>{let Le=new Array,ot=this.map.region.toBoundingRegion();Le.push(new T.cW(ot.southLatitude,ot.westLongitude)),Le.push(new T.cW(ot.northLatitude,ot.eastLongitude)),Ye.next(Le),Ye.complete()})}moveToMapBounds(be){this.logging.log("MapKit: map bounds not implemented")}renderMap(be,Ye,Le){return document.getElementById(this.mapCanvasID).style.height=Ye+"px",this.mapReady&&this.showPOIListOnMap(be,Le),!0}renderPolyline(be){this.clearPolyline()}clearPolyline(){null!=this.polylinePath&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(be){return(0,Z.A)(function*(){let Ye=new mapkit.Search({getsUserLocation:!0});return new Promise(function(){var Le=(0,Z.A)(function*(ot,Ve){let Ue=[];Ye.search(be,function(){var $t=(0,Z.A)(function*(nt,xt){nt&&Ve(nt),Ue=[],xt.places.map(ct=>{let Mt=new De.Jm;Mt.Title=ct.name,Mt.Address=ct.formattedAddress,Mt.Type="place",Mt.Location=new T.cW(ct.coordinate.latitude,ct.coordinate.longitude),Ue.push(Mt)}),ot(Ue)});return function(nt,xt){return $t.apply(this,arguments)}}())});return function(ot,Ve){return Le.apply(this,arguments)}}())})()}addPOILayer(be){this.logging.log("Add POI Layer not implemented in this provider.")}}class re{mercatorRadius=85445659.44705395;mercatorOffset=268435456;longitudeToPixelSpaceX(be){return Math.round(this.mercatorOffset+this.mercatorRadius*be*Math.PI/180)}latitudeToPixelSpaceY(be){return Math.round(this.mercatorOffset-this.mercatorRadius*Math.log((1+Math.sin(be*Math.PI/180))/(1-Math.sin(be*Math.PI/180)))/2)}pixelSpaceXToLongitude(be){return(Math.round(be)-this.mercatorOffset)/this.mercatorRadius*180/Math.PI}pixelSpaceYToLatitude(be){return 180*(Math.PI/2-2*Math.atan(Math.exp((Math.round(be)-this.mercatorOffset)/this.mercatorRadius)))/Math.PI}deltaFromZoomLevel(be,Ye,Le){let ot=this.longitudeToPixelSpaceX(Ye.longitude),Ve=this.latitudeToPixelSpaceY(Ye.latitude),$t=Math.pow(2,20-Le),nt=be.visibleMapRect.size,xt=nt.width*$t,ct=nt.height*$t,Mt=ot-xt/2,$e=Ve-ct/2,Et=this.pixelSpaceXToLongitude(Mt),fn=this.pixelSpaceXToLongitude(Mt+xt)-Et,Kn=this.pixelSpaceYToLatitude($e);return{latitudeDelta:-1*(this.pixelSpaceYToLatitude($e+ct)-Kn),longitudeDelta:fn}}}var ze=B(3953),je=B(3458),We=B(1626);let Ne=(()=>{class He extends g.${constructor(Ye,Le,ot){super(Ye,Le,ot),this.mapAPIType=v.j.MAPTILER,this.mapTileSet="https://maps.tilehosting.com/styles/streets/style.json?key=Gs9z7krALe3CGI60d5cL"}initAPI(){}static \u0275fac=function(Le){return new(Le||He)(ze.KVO(je.s),ze.KVO(a.y),ze.KVO(We.Qq))};static \u0275prov=ze.jDH({token:He,factory:He.\u0275fac})}return He})(),ht=(()=>{class He{logging;http;map;mapCentreMarker;mapsInitialised;mapAPIReady;mapOptions;searchMarker;errorMessage;parentAppContext;mapProvider;debouncedMapPositionUpdate;events;isFocused=!1;constructor(Ye,Le,ot){this.logging=Le,this.http=ot,this.events=Ye,this.mapOptions=new v.v,this.mapAPIReady=!1,this.mapsInitialised=!1,this.setMapAPI(this.mapOptions.mapAPI);let Ve=this;this.debouncedMapPositionUpdate=me.A.debounce(()=>{this.logging.log("signaling map position change:"),Ve.mapProvider.mapReady&&Ve.getMapCenter().subscribe(Ue=>{null!=Ue?(this.logging.log("Map centre/zoom changed, updating search position:"+Ue),this.updateMapCentrePos(Ue.coords.latitude,Ue.coords.longitude,!1)):this.logging.log("Map centre/zoom changed - map not ready to change centre pos:")})},300,!1)}setParentAppContext(Ye){this.parentAppContext=Ye}setMapAPI(Ye){this.mapOptions.mapAPI=Ye,this.mapOptions.mapAPI==v.j.MAPBOX&&(this.mapProvider=new g.$(this.events,this.logging,this.http)),this.mapOptions.mapAPI==v.j.MAPKIT_JS&&(this.mapProvider=new Je(this.events,this.logging)),this.mapOptions.mapAPI==v.j.MAPTILER&&(this.mapProvider=new Ne(this.events,this.logging,this.http))}isMapReady(){return null!=this.mapProvider&&this.mapProvider.mapReady}externalAPILoaded(Ye){this.mapAPIReady=!0,this.logging.log("Mapping API Loaded: "+v.j[Ye])}initMap(Ye){if(!this.isMapReady())if(null!=this.mapProvider)this.mapsInitialised&&this.logging.log("initMap: Map provider already initialised"),this.logging.log("Mapping Manager: Init "+v.j[this.mapProvider.mapAPIType]),this.mapProvider.initMap(Ye,this.mapOptions,this);else{if(this.mapsInitialised)return void this.logging.log("initMap: map already initialised");this.logging.log("initMap: "+this.mapOptions.mapAPI)}}mapManipulationPerformed(Ye){this.logging.log("map manipulated:"+Ye),("drag"==Ye||"zoom"==Ye)&&this.debouncedMapPositionUpdate()}updateMapSize(){this.mapProvider&&this.mapProvider.refreshMapLayout()}updateMapCentrePos(Ye,Le,ot,Ve){ot&&null!=this.mapProvider&&this.mapProvider.setMapCenter(new T.Bk(Ye,Le),Ve),this.mapOptions.mapCentre=new T.Bk(Ye,Le)}moveToMapBounds(Ye){this.mapProvider.moveToMapBounds(Ye)}refreshMapView(Ye,Le,ot){return null!=this.mapProvider?(this.logging.log("Mapping Manager: renderMap "+v.j[this.mapProvider.mapAPIType]),this.isMapReady()?this.mapProvider.renderMap(Le,Ye,this.parentAppContext):this.logging.log("refreshMapView: map provider not initialised..")):this.logging.log("Unsupported Map API: refreshMapView",a.$.ERROR),!0}setMapType(Ye){this.mapOptions.mapType!=Ye&&(this.mapOptions.mapType=Ye,this.isMapReady()&&null!=this.mapProvider?(this.logging.log("Changing map type:"+Ye),this.mapProvider.setMapType(Ye)):this.logging.log("Map type set, maps not initialised yet."))}unfocusMap(){this.logging.log("[mapping] Unfocus Map."),this.isFocused=!1,this.mapProvider.unfocusMap()}focusMap(){this.logging.log("[mapping] Focus Map."),this.isFocused=!0,this.mapProvider.focusMap()}getMapBounds(){return this.mapProvider.getMapBounds()}getMapZoom(){return this.mapProvider.getMapZoom()}setMapZoom(Ye){this.mapProvider.setMapZoom(Ye)}getMapCenter(){return this.mapProvider.getMapCenter()}showPOIOnStaticMap(Ye,Le,ot=!1,Ve=!1,Ue=200,$t=200){let nt=document.getElementById(Ye);if(null!=nt){let ct=Le.AddressInfo.Latitude,Mt=Le.AddressInfo.Longitude;Ue>640&&(Ue=640),$t>640&&($t=640);let $e=Ue,Et=$t,cn="https://maps.googleapis.com/maps/api/staticmap?center="+ct+","+Mt+"&zoom=14&size="+$e+"x"+Et+"&maptype=roadmap&markers=color:blue%7Clabel:A%7C"+ct+","+Mt+"&sensor=false",fn="";fn+=1==ot?"<div>"+me.A.formatMapLink(Le,'<div><img width="'+$e+'" height="'+Et+'" src="'+cn+'" /></div>',Ve)+"</div>":'<div><img width="'+$e+'" height="'+Et+'" src="'+cn+'" /></div>',nt.innerHTML=fn}}renderPolyline(Ye){this.mapProvider.renderPolyline(Ye)}clearPolyline(){this.mapProvider.clearPolyline()}clearMarkers(){this.logging.log("mapping: clearing markers"),this.mapProvider.clearMarkers()}addPOILayer(Ye){this.mapProvider.addPOILayer(Ye)}static \u0275fac=function(Le){return new(Le||He)(ze.KVO(je.s),ze.KVO(a.y),ze.KVO(We.Qq))};static \u0275prov=ze.jDH({token:He,factory:He.\u0275fac,providedIn:"root"})}return He})()},3229:(vi,Vt,B)=>{"use strict";B.d(Vt,{j:()=>v,v:()=>me});var g=B(5312),v=function(a){return a[a.GOOGLE_WEB=1]="GOOGLE_WEB",a[a.GOOGLE_NATIVE=2]="GOOGLE_NATIVE",a[a.LEAFLET=3]="LEAFLET",a[a.MAPBOX=4]="MAPBOX",a[a.MAPKIT_JS=5]="MAPKIT_JS",a[a.MAPTILER=6]="MAPTILER",a}(v||{});class me{enableClustering;resultBatchID;useMarkerIcons;useMarkerAnimation;enableTrackingMapCentre;enableSearchByWatchingLocation;mapCentre;searchDistanceKM;iconSet;mapAPI;mapMoveQueryRefreshMS;requestSearchUpdate;enableSearchRadiusIndicator;mapType;minZoomLevel;onMapMoveCompleted;constructor(){this.enableClustering=!1,this.resultBatchID=-1,this.useMarkerIcons=!0,this.useMarkerAnimation=!0,this.enableTrackingMapCentre=!1,this.enableSearchByWatchingLocation=!1,this.mapCentre=null,this.mapAPI=g.c.defaultMapProvider,this.mapType="ROADMAP",this.searchDistanceKM=1e5,this.mapMoveQueryRefreshMS=300,this.enableSearchRadiusIndicator=!1,this.minZoomLevel=2}}},184:(vi,Vt,B)=>{"use strict";B.d(Vt,{$:()=>Ne});var g=B(467),v=B(5517),me=B(3229),a=B(1985),Z=B(9394),ie=B(3118),T=B(1247),De=B(5312),Je=B(9093),re=B(3953),ze=B(3458),je=B(1626);let Ne=(()=>{class ht{events;logging;http;mapAPIType;mapReady;providerError;mapCanvasID;map;markerList;polylinePath;_isMapAnimating=!1;searchMarker;mapTileSet;constructor(be,Ye,Le){this.events=be,this.logging=Ye,this.http=Le,this.events=be,this.mapAPIType=me.j.MAPBOX,this.mapReady=!1,this.markerList=new Map}initAPI(){T&&Object.getOwnPropertyDescriptor(T,"accessToken").set(De.c.mapBoxToken)}disposeMap(){this.map&&(this.logging.log("Disposing map",ie.$.INFO),this.map.remove())}getCurrentMapTileSet(be){return"SATELLITE"==be?"mapbox://styles/mapbox/satellite-streets-v12?optimize=true":"mapbox://styles/mapbox/streets-v12?optimize=true"}flyAroundPoint(be){if(this._isMapAnimating){this.map.rotateTo(be/100%360,{duration:0});const Ye=this;requestAnimationFrame(function(Le){Ye.flyAroundPoint(Le)})}}initMap(be,Ye,Le){this.mapCanvasID=be;let ot=!0;if(ot=!(typeof T>"u"),!ot)return this.logging.log("Call to initMap before API is ready:"+me.j[this.mapAPIType],ie.$.ERROR),this.mapReady=!1,!1;if(null==this.map){let nt=function(ct){return ct*(2-ct)};document.getElementById(be),this.initAPI(),this.map=new T.Map({container:be,zoom:15,attributionControl:!1}),this.map.addControl(new T.AttributionControl({compact:!0,customAttribution:["Open Charge Map Contributors"]})),this.map.addControl(new T.NavigationControl),this.mapReady=!0,this.map.getCanvas().focus();let Ue=100,$t=25;this.map.getCanvas().addEventListener("keydown",ct=>{ct.preventDefault(),38===ct.which?this.map.panBy([0,-Ue],{easing:nt}):40===ct.which?this.map.panBy([0,Ue],{easing:nt}):37===ct.which?this.map.easeTo({bearing:this.map.getBearing()-$t,easing:nt}):39===ct.which?this.map.easeTo({bearing:this.map.getBearing()+$t,easing:nt}):32===ct.which&&(this._isMapAnimating?this._isMapAnimating=!1:(this._isMapAnimating=!0,this.flyAroundPoint(0)))},!0),this.map.on("load",()=>{this.events.publish("ocm:mapping:ready")});let xt=v.A.debounce(()=>{this.getMapCenter().subscribe(ct=>{this.searchMarker.setLngLat(new T.LngLat(ct.coords.longitude,ct.coords.latitude))})},500,!1);this.map.on("move",()=>{this.searchMarker&&xt()}),this.map.on("moveend",()=>{this.events.publish("ocm:mapping:dragend"),Ye.onMapMoveCompleted&&Ye.onMapMoveCompleted()}),this.map.on("zoomend",()=>{this.events.publish("ocm:mapping:zoom")})}}clearMarkers(){null!=this.markerList&&this.markerList.forEach((be,Ye)=>{be.remove()}),this.markerList=new Map}showPOIListOnMap(be,Ye,Le=!0){let Ve=this.map,Ue=new T.LngLatBounds,$t=0;if(Ve.getZoom(),null!=be){for(let $e=0;$e<be.length;$e++)if(null!=be[$e].AddressInfo&&null!=be[$e].AddressInfo.Latitude&&null!=be[$e].AddressInfo.Longitude){let Et=be[$e],cn=!0;if(null!=this.markerList&&this.markerList.has(Et.ID)){cn=!1;let fn=this.markerList.get(Et.ID);fn&&fn.poi&&fn.poi.DateLastStatusUpdate!=Et.DateLastStatusUpdate&&(fn.remove(),cn=!0)}if(cn){let fn=null,Kn=null;Le?(fn=document.createElement("img"),fn.src=v.A.getIconForPOI(Et),fn.width=34,fn.height=50):(fn=null,Kn=v.A.getColorForPOI(Et));let at=(Le?"OCM-":"EXT-")+Et.ID+": "+Et.AddressInfo.Title+":";null!=Et.UsageType&&(at+=" "+Et.UsageType.Title),null!=Et.StatusType&&(at+=" "+Et.StatusType.Title);let ve=new T.Marker({element:fn,color:Kn,anchor:"bottom"}).setLngLat([Et.AddressInfo.Longitude,Et.AddressInfo.Latitude]).addTo(Ve);ve.poi=Et;let Me=ve.getElement();Me.poi=Et,Me.addEventListener("click",fe=>{const vt=fe.currentTarget.poi;this.events.publish("ocm:poi:selected",{poiId:vt.ID,poi:vt})}),Ue.extend(ve.getLngLat()),this.markerList.set(Et.ID,ve),$t++}}this.logging.log($t+" new map markers added out of a total "+this.markerList.size)}if(null!=be&&be.length>0)if(null==Ye||Ye.appConfig.enableLiveMapQuerying)null==Ve.getCenter()&&Ve.setCenter(Ue.getCenter());else{this.logging.log("Fitting to marker bounds:"+Ue),Ve.setCenter(Ue.getCenter()),this.logging.log("zoom before fit bounds:"+Ve.getZoom()),Ve.fitBounds(Ue);let Mt=Ve.getZoom();Ve.setZoom(Mt<6?6:Mt)}}refreshMapLayout(){null!=this.map&&setTimeout(()=>{this.logging.log("MapBoxGL: refreshMapLayout",ie.$.VERBOSE),this.map.resize()},200)}setMapCenter(be){this.mapReady&&(this.map.setCenter(new T.LngLat(be.coords.longitude,be.coords.latitude)),this.searchMarker||(this.searchMarker=new T.Marker({color:"#99ccff",anchor:"bottom"}).setLngLat(new T.LngLat(be.coords.longitude,be.coords.latitude)).addTo(this.map),this.searchMarker.getElement().addEventListener("click",()=>{let Ye=this.searchMarker.getLngLat();this.events.publish("ocm:mapping:addpoi",new Z.cW(Ye.lat,Ye.lng))})))}getMapCenter(){return new a.c(Ye=>{if(null!=this.map){let Le=this.map.getCenter();null!=Le&&(Ye.next(new Z.Bk(Le.lat,Le.lng)),Ye.complete())}})}setMapZoom(be){this.map.setZoom(be)}getMapZoom(){return new a.c(Ye=>{let Le=this.map.getZoom();Ye.next(Le),Ye.complete()})}setMapType(be){this.map.setStyle(this.getCurrentMapTileSet(be))}getMapBounds(){return new a.c(Ye=>{let Le=new Array,ot=this.map.getBounds();Le.push(new Z.cW(ot.getSouthWest().lat,ot.getSouthWest().lng)),Le.push(new Z.cW(ot.getNorthEast().lat,ot.getNorthEast().lng)),Ye.next(Le),Ye.complete()})}moveToMapBounds(be){this.map.fitBounds(new T.LngLatBounds(new T.LngLat(be.southWest.longitude,be.southWest.latitude),new T.LngLat(be.northEast.longitude,be.northEast.latitude)))}renderMap(be,Ye,Le){return document.getElementById(this.mapCanvasID).style.height=Ye+"px",this.mapReady&&this.showPOIListOnMap(be,Le),!0}renderPolyline(be){this.clearPolyline()}clearPolyline(){null!=this.polylinePath&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(be,Ye,Le){var ot=this;return(0,g.A)(function*(){let Ve=`https://api.mapbox.com/geocoding/v5/mapbox.places/${be||Le+","+Ye}.json?access_token=${De.c.mapBoxToken}`;return new Promise(function(){var Ue=(0,g.A)(function*($t,nt){ot.http.get(Ve).toPromise().then(xt=>{let ct=[];ct=[],xt.features&&xt.features.map(Mt=>{let $e=new Je.Jm;$e.Title=Mt.place_name,$e.Address=Mt.place_name,$e.Type="place",$e.Location=new Z.cW(Mt.center[1],Mt.center[0]),$e.Attribution=xt.attribution,ct.push($e)}),$t(ct)})});return function($t,nt){return Ue.apply(this,arguments)}}())})()}addPOILayer(be){this.logging.log("Add POI Layer not implemented in this provider."),this.showPOIListOnMap(be,null,!1)}static \u0275fac=function(Ye){return new(Ye||ht)(re.KVO(ze.s),re.KVO(ie.y),re.KVO(je.Qq))};static \u0275prov=re.jDH({token:ht,factory:ht.\u0275fac})}return ht})()},5312:(vi,Vt,B)=>{"use strict";B.d(Vt,{c:()=>g});const g={name:"prod",version:"8.7.0",production:!0,analyticsId:"",googleMapsKey:"",mapBoxToken:"pk.eyJ1Ijoid2VicHJvZnVzaW9uIiwiYSI6ImNrdHZlc2N5dTI5Zjcydm8zYWFwc2JnbTMifQ.M7b5SOzbPcg_8XAHCOeP0w",mapKitToken:"",enableStaticMaps:!1,defaultMapProvider:4,apiBase:"https://api.openchargemap.io",apiKey:"9bb03e5b-0fb2-4916-9b2b-26c6bd27a56a",enabledFeatures:["MAP","ADD_COMMENT","ADD_PHOTO","FAVOURITES","FILTER_OPTIONS_BY_COUNTRY","ADD_POI","EDIT_POI","LAYERS"]}},9796:(vi,Vt,B)=>{"use strict";var g=B(345),v=B(3953),me=B(7606),a=B(4842),Z=B(177),ie=B(9417),T=B(9465);let Ce=(()=>{class $n{static \u0275fac=function(ii){return new(ii||$n)};static \u0275mod=v.$C({type:$n});static \u0275inj=v.G2t({imports:[Z.MD,ie.YN,T.bv,a.h,me.F]})}return $n})(),De=(()=>{class $n{static \u0275fac=function(ii){return new(ii||$n)};static \u0275mod=v.$C({type:$n});static \u0275inj=v.G2t({imports:[Z.MD,ie.YN,T.bv,a.h,me.F]})}return $n})(),Je=(()=>{class $n{static \u0275fac=function(ii){return new(ii||$n)};static \u0275mod=v.$C({type:$n});static \u0275inj=v.G2t({imports:[Z.MD,ie.YN,T.bv,a.h,me.F]})}return $n})();var re=B(9325),ze=B(1626),je=B(1470),We=B(7552),Ne=B(3656);class ht{http;prefix;suffix;constructor(ar,gn="/assets/i18n/",ii=".json"){this.http=ar,this.prefix=gn,this.suffix=ii}getTranslation(ar){return this.http.get(`${this.prefix}${ar}${this.suffix}`)}}var He=B(467),be=B(6714),Ye=B(3471),Le=B(4740),ot=B(6918),Ve=B(4296);function Ue($n,ar){if(1&$n){const gn=v.RV6();v.j41(0,"div"),v.EFF(1," You are not signed in. "),v.j41(2,"button",5),v.bIt("click",function(){v.eBV(gn);const oi=v.XpG();return v.Njj(oi.showSignInModal())}),v.EFF(3),v.nI1(4,"translate"),v.k0s()()}2&$n&&(v.R7$(3),v.JRh(v.bMT(4,1,"ocm.general.signIn")))}function $t($n,ar){if(1&$n&&(v.j41(0,"div")(1,"ion-card")(2,"ion-item")(3,"ion-avatar",6),v.nrm(4,"img",7),v.k0s(),v.j41(5,"h2"),v.EFF(6),v.k0s()(),v.j41(7,"ion-card-content")(8,"p"),v.EFF(9),v.k0s(),v.j41(10,"p"),v.EFF(11),v.k0s()(),v.j41(12,"ion-item")(13,"ion-note",8),v.nrm(14,"ion-icon",9),v.EFF(15),v.k0s()()()()),2&$n){const gn=v.XpG();v.R7$(4),v.FS9("src",gn.userProfile.ProfileImageURL,v.B4B),v.R7$(2),v.JRh(gn.userProfile.Username),v.R7$(3),v.SpI(" ",gn.userProfile.Profile,""),v.R7$(2),v.SpI(" Date Joined: ",gn.userProfile.DateCreated," "),v.R7$(4),v.SpI(" ",gn.userProfile.ReputationPoints," Contributor Points ")}}let nt=(()=>{class $n{appManager;nav;translate;modalController;userProfile;constructor(gn,ii,oi,Yi){this.appManager=gn,this.nav=ii,this.translate=oi,this.modalController=Yi}ionViewDidEnter(){this.userProfile=this.appManager.getUserProfile(),null!=this.userProfile&&this.appManager.isUserAuthenticated(!0)?this.refreshProfileView():this.showSignInModal(),this.appManager.analytics.viewEvent("Profile")}refreshProfileView(){this.userProfile=this.appManager.getUserProfile()}showSignInModal(){this.modalController.create({component:Le.q,componentProps:{Profile:this.userProfile}}).then(gn=>{gn.onDidDismiss().then(()=>{this.refreshProfileView()}),gn.present()})}close(){this.modalController.dismiss()}static \u0275fac=function(ii){return new(ii||$n)(v.rXU(Ve.r),v.rXU(Ne.q9),v.rXU(a.c$),v.rXU(T.W3))};static \u0275cmp=v.VBU({type:$n,selectors:[["ng-component"]],decls:14,vars:5,consts:[[1,"profile-page","ion-padding"],[4,"ngIf"],["slot","end"],[3,"click"],["name","close","slot","start"],["ion-button","",3,"click"],["slot","start"],[3,"src"],["item-left",""],["name","star"]],template:function(ii,oi){1&ii&&(v.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),v.EFF(3),v.nI1(4,"translate"),v.k0s()()(),v.j41(5,"ion-content",0),v.DNE(6,Ue,5,3,"div",1)(7,$t,16,5,"div",1),v.k0s(),v.j41(8,"ion-footer")(9,"ion-toolbar")(10,"ion-buttons",2)(11,"ion-button",3),v.bIt("click",function(){return oi.close()}),v.nrm(12,"ion-icon",4),v.EFF(13," Close "),v.k0s()()()()),2&ii&&(v.R7$(3),v.SpI(" ",v.bMT(4,3,"ocm.navigation.profile.sectionTitle")," "),v.R7$(3),v.Y8G("ngIf",null==oi.userProfile),v.R7$(),v.Y8G("ngIf",null!=oi.userProfile))},dependencies:[Z.bT,T.mC,T.Jm,T.QW,T.b_,T.I9,T.W9,T.M0,T.eU,T.iq,T.uz,T.JI,T.BC,T.ai,a.D9],encapsulation:2})}return $n})();var xt=B(3118),ct=B(5312),Mt=B(8927),$e=B(543),Et=B(5517),cn=B(6625),fn=B(2745),Kn=B(5083);const Kt=(0,Kn.F3)("PushNotifications",{}),vt=(0,Kn.F3)("StatusBar"),_n=(0,Kn.F3)("SplashScreen",{web:()=>B.e(4292).then(B.bind(B,4292)).then($n=>new $n.SplashScreenWeb)}),Re=(0,Kn.F3)("App",{web:()=>B.e(9303).then(B.bind(B,9303)).then($n=>new $n.AppWeb)});var wn=B(3458);const it=()=>["/search"];function tn($n,ar){if(1&$n){const gn=v.RV6();v.j41(0,"ion-item",9),v.bIt("click",function(){v.eBV(gn);const oi=v.XpG();return v.Njj(oi.openRoutePlannerModal())}),v.nrm(1,"ion-icon",12),v.j41(2,"ion-label"),v.EFF(3," Route Planner "),v.k0s()()}}function bn($n,ar){if(1&$n){const gn=v.RV6();v.j41(0,"ion-item",9),v.bIt("click",function(){v.eBV(gn);const oi=v.XpG();return v.Njj(oi.add())}),v.nrm(1,"ion-icon",13),v.j41(2,"ion-label"),v.EFF(3),v.nI1(4,"translate"),v.k0s()()}2&$n&&(v.R7$(3),v.SpI(" ",v.bMT(4,1,"ocm.general.addLocation")," "))}function Jn($n,ar){if(1&$n){const gn=v.RV6();v.j41(0,"ion-item",9),v.bIt("click",function(){v.eBV(gn);const oi=v.XpG();return v.Njj(oi.journeys())}),v.nrm(1,"ion-icon",12),v.j41(2,"ion-label"),v.EFF(3," Journeys "),v.k0s()()}}function jn($n,ar){if(1&$n){const gn=v.RV6();v.j41(0,"ion-item",9),v.bIt("click",function(){v.eBV(gn);const oi=v.XpG();return v.Njj(oi.addLayer())}),v.nrm(1,"ion-icon",14),v.j41(2,"ion-label"),v.EFF(3," Add Layer "),v.k0s()()}}function _i($n,ar){if(1&$n){const gn=v.RV6();v.qex(0),v.j41(1,"ion-item",9),v.bIt("click",function(){v.eBV(gn);const oi=v.XpG();return v.Njj(oi.signIn())}),v.nrm(2,"ion-icon",15),v.j41(3,"ion-label"),v.EFF(4),v.nI1(5,"translate"),v.k0s()(),v.bVm()}2&$n&&(v.R7$(4),v.SpI(" ",v.bMT(5,1,"ocm.general.signIn")," "))}function ut($n,ar){if(1&$n){const gn=v.RV6();v.qex(0),v.j41(1,"ion-item",9),v.bIt("click",function(){v.eBV(gn);const oi=v.XpG();return v.Njj(oi.profile())}),v.nrm(2,"ion-icon",15),v.j41(3,"ion-label"),v.EFF(4),v.nI1(5,"translate"),v.k0s()(),v.j41(6,"ion-item",9),v.bIt("click",function(){v.eBV(gn);const oi=v.XpG();return v.Njj(oi.signOut())}),v.nrm(7,"ion-icon",16),v.j41(8,"ion-label"),v.EFF(9),v.nI1(10,"translate"),v.nrm(11,"br"),v.j41(12,"small",17),v.EFF(13),v.k0s()()(),v.bVm()}if(2&$n){const gn=v.XpG();v.R7$(4),v.SpI(" ",v.bMT(5,3,"ocm.navigation.profile.sectionTitle")," "),v.R7$(5),v.SpI(" ",v.bMT(10,5,"ocm.general.signOut")," "),v.R7$(4),v.SpI(" ",gn.getUserName(),"")}}let nn=(()=>{class $n{platform;translate;mapping;modalController;appManager;logger;analytics;events;enabledFeatures;constructor(gn,ii,oi,Yi,pr,io,ao,ro){this.platform=gn,this.translate=ii,this.mapping=oi,this.modalController=Yi,this.appManager=pr,this.logger=io,this.analytics=ao,this.events=ro,this.logger.log("Environment: "+ct.c.name),this.initializeApp(),this.enabledFeatures=ct.c.enabledFeatures,1!=pr.searchSettings.EnableAdvancedEditorFeatures&&(this.enabledFeatures=this.enabledFeatures.filter(co=>"LAYERS"!=co))}configurePushNotifications(){Kt.register(),Kt.addListener("registration",gn=>{this.logger.log("Push registration success, token: "+gn.value),this.appManager.savePushRegistration(gn.value)}),Kt.addListener("registrationError",gn=>{this.logger.log("Error on registration: "+JSON.stringify(gn))}),Kt.addListener("pushNotificationReceived",gn=>{this.logger.log("Push received: "+JSON.stringify(gn),xt.$.INFO)}),Kt.addListener("pushNotificationActionPerformed",gn=>{this.logger.log("Push action performed: "+JSON.stringify(gn))})}isUserAuthenticated(){return this.appManager.isUserAuthenticated()}getUserName(){let gn=this.appManager.getUserProfile();return gn?gn.EmailAddress?gn.EmailAddress:gn.Username:"Not Signed In"}initializeApp(){var gn=this;this.platform.ready().then(()=>{this.platform.is("capacitor")&&(vt.show(),_n.hide()),this.translate.addLangs(this.appManager.getLanguages().map(ii=>ii.code)),this.translate.setDefaultLang("en"),null!=this.appManager.searchSettings.Language?this.translate.use(this.appManager.searchSettings.Language):this.translate.currentLang||this.translate.use("en"),this.translate.get("ocm.search.performSearch").toPromise().then(ii=>{}),this.analytics.init(ct.c.analyticsId).then(()=>{this.analytics.setAppVersion(ct.c.version),this.analytics.appEvent("Startup","App Loaded")}).catch(ii=>this.logger.log("Error starting analytics")),this.events.subscribe("ocm:mapping:addpoi",function(){var ii=(0,He.A)(function*(oi){Et.A.isFeatureEnabled("ADD_POI")&&gn.add(oi)});return function(oi){return ii.apply(this,arguments)}}()),(this.platform.is("ios")||this.platform.is("android"))&&(this.configurePushNotifications(),this.checkForAppOpenUrl())})}checkForAppOpenUrl(){return(0,He.A)(function*(){Re.addListener("appUrlOpen",ii=>{alert("App (re)opened with URL: "+ii.url)});let gn=yield Re.getLaunchUrl();gn&&gn.url&&alert("App opened with URL: "+gn.url)})()}openRoutePlannerModal(){var gn=this;return(0,He.A)(function*(){gn.mapping.unfocusMap();const ii=yield gn.modalController.create({component:Ye.B});ii.onDidDismiss().then(oi=>{gn.mapping.focusMap()}),yield ii.present()})()}continueAdd(gn){var ii=this;return(0,He.A)(function*(){const oi=yield ii.modalController.create({component:Mt.r,componentProps:{startPos:gn}});oi.onDidDismiss().then(Yi=>{ii.mapping.focusMap()}),yield oi.present()})()}add(gn){var ii=this;return(0,He.A)(function*(){if(ii.mapping.unfocusMap(),!ii.appManager.isUserAuthenticated(!0)){const oi=yield ii.modalController.create({component:Le.q});return oi.onDidDismiss().then(function(){var Yi=(0,He.A)(function*(pr){ii.mapping.focusMap(),ii.appManager.isUserAuthenticated(!0)&&(yield ii.continueAdd(gn))});return function(pr){return Yi.apply(this,arguments)}}()),yield oi.present()}yield ii.continueAdd(gn)})()}signIn(){var gn=this;return(0,He.A)(function*(){gn.mapping.unfocusMap();const ii=yield gn.modalController.create({component:Le.q});return ii.onDidDismiss().then(oi=>{gn.mapping.focusMap(),gn.appManager.isUserAuthenticated(!0)}),yield ii.present()})()}signOut(){var gn=this;return(0,He.A)(function*(){gn.appManager.signOutCurrentUser()})()}profile(){var gn=this;return(0,He.A)(function*(){gn.mapping.unfocusMap();const ii=yield gn.modalController.create({component:nt});ii.onDidDismiss().then(oi=>{gn.mapping.focusMap()}),yield ii.present()})()}journeys(){var gn=this;return(0,He.A)(function*(){gn.mapping.unfocusMap();const ii=yield gn.modalController.create({component:ot.Z});ii.onDidDismiss().then(oi=>{gn.mapping.focusMap()}),yield ii.present()})()}addLayer(){var gn=this;return(0,He.A)(function*(){const ii=yield gn.modalController.create({component:fn.W});yield ii.present();const{data:oi}=yield ii.onWillDismiss();oi&&gn.mapping.addPOILayer(oi)})()}about(){var gn=this;return(0,He.A)(function*(){gn.mapping.unfocusMap();const ii=yield gn.modalController.create({component:cn.j});ii.onDidDismiss().then(oi=>{gn.mapping.focusMap()}),yield ii.present()})()}static \u0275fac=function(ii){return new(ii||$n)(v.rXU(Ne.OD),v.rXU(a.c$),v.rXU(be.X),v.rXU(T.W3),v.rXU(Ve.r),v.rXU(xt.y),v.rXU($e.j),v.rXU(wn.s))};static \u0275cmp=v.VBU({type:$n,selectors:[["app-root"]],decls:29,vars:17,consts:[["contentId","main-content",3,"disabled"],["contentId","main-content","swipeGesture","false"],["slot","start"],["src","assets/images/icons/branding/AppIcon_128x128.png"],["auto-hide","false"],[3,"routerDirection","routerLink"],["slot","start","name","home"],[3,"click",4,"ngIf"],[4,"ngIf"],[3,"click"],["slot","start","name","information-circle-outline"],["id","main-content"],["slot","start","name","map"],["slot","start","name","add-circle-outline"],["slot","start","name","albums"],["slot","start","name","person"],["slot","start","name","log-out"],[2,"color","#c0c0c0"]],template:function(ii,oi){1&ii&&(v.j41(0,"ion-app")(1,"ion-split-pane",0)(2,"ion-menu",1)(3,"ion-header")(4,"ion-toolbar")(5,"ion-thumbnail",2),v.nrm(6,"img",3),v.k0s(),v.j41(7,"ion-title"),v.EFF(8),v.k0s()()(),v.j41(9,"ion-content")(10,"ion-list")(11,"ion-menu-toggle",4)(12,"ion-item",5),v.nrm(13,"ion-icon",6),v.j41(14,"ion-label"),v.EFF(15),v.nI1(16,"translate"),v.k0s()(),v.DNE(17,tn,4,0,"ion-item",7)(18,bn,5,3,"ion-item",7)(19,Jn,4,0,"ion-item",7)(20,jn,4,0,"ion-item",7)(21,_i,6,3,"ng-container",8)(22,ut,14,7,"ng-container",8),v.j41(23,"ion-item",9),v.bIt("click",function(){return oi.about()}),v.nrm(24,"ion-icon",10),v.j41(25,"ion-label"),v.EFF(26),v.nI1(27,"translate"),v.k0s()()()()()(),v.nrm(28,"ion-router-outlet",11),v.k0s()()),2&ii&&(v.R7$(),v.Y8G("disabled",!0),v.R7$(7),v.JRh(oi.appManager.title),v.R7$(4),v.Y8G("routerDirection","root")("routerLink",v.lJ4(16,it)),v.R7$(3),v.SpI(" ",v.bMT(16,12,"ocm.search.sectionTitle")," "),v.R7$(2),v.Y8G("ngIf",oi.enabledFeatures.includes("ROUTE_PLANNER")),v.R7$(),v.Y8G("ngIf",oi.enabledFeatures.includes("ADD_POI")),v.R7$(),v.Y8G("ngIf",oi.enabledFeatures.includes("FAVOURITES")),v.R7$(),v.Y8G("ngIf",oi.enabledFeatures.includes("LAYERS")),v.R7$(),v.Y8G("ngIf",!oi.isUserAuthenticated()),v.R7$(),v.Y8G("ngIf",oi.isUserAuthenticated()),v.R7$(4),v.SpI(" ",v.bMT(27,14,"ocm.general.about")," "))},dependencies:[Z.bT,T.U1,T.W9,T.eU,T.iq,T.uz,T.he,T.nf,T.oS,T.cA,T.HP,T.Zx,T.BC,T.ai,T.Rg,T.N7,je.Wk,a.D9],encapsulation:2})}return $n})();const ui=[{path:"",redirectTo:"search",pathMatch:"full"},{path:"search",loadChildren:()=>Promise.resolve().then(B.bind(B,9325)).then($n=>$n.SearchPageModule)},{path:"journeys",loadChildren:()=>Promise.resolve().then(B.bind(B,7142)).then($n=>$n.JourneysModule)},{path:"signin",loadChildren:()=>Promise.resolve().then(B.bind(B,4552)).then($n=>$n.SignInModule)},{path:"poi-editor/:id",loadChildren:()=>Promise.resolve().then(B.bind(B,4096)).then($n=>$n.PoiEditorPageModule)},{path:"about",loadChildren:()=>Promise.resolve().then(B.bind(B,8145)).then($n=>$n.AboutPageModule)},{path:"layer-editor",loadChildren:()=>Promise.resolve().then(B.bind(B,9950)).then($n=>$n.LayerEditorPageModule)}];let pn=(()=>{class $n{static \u0275fac=function(ii){return new(ii||$n)};static \u0275mod=v.$C({type:$n});static \u0275inj=v.G2t({imports:[je.iI.forRoot(ui,{useHash:!0}),je.iI]})}return $n})(),An=(()=>{class $n{static \u0275fac=function(ii){return new(ii||$n)};static \u0275mod=v.$C({type:$n});static \u0275inj=v.G2t({imports:[Z.MD,ie.YN,T.bv,a.h,me.F]})}return $n})();var Ct=B(4552);let Qt=(()=>{class $n{static \u0275fac=function(ii){return new(ii||$n)};static \u0275mod=v.$C({type:$n});static \u0275inj=v.G2t({imports:[Z.MD,ie.YN,T.bv,a.h,me.F,je.iI.forChild([{path:"",component:nt}])]})}return $n})();var Se=B(4359);let Bt=(()=>{class $n{static \u0275fac=function(ii){return new(ii||$n)};static \u0275mod=v.$C({type:$n});static \u0275inj=v.G2t({imports:[Z.MD,ie.YN,T.bv,a.h,me.F,je.iI.forChild([{path:"",component:Se.R}])]})}return $n})();var Nt=B(7142),Rn=B(4096),Ci=B(8145),Oi=B(9950);function ei(){return localStorage.getItem("access_token")}function no($n){return new ht($n,"/assets/i18n/",".json")}let mr=(()=>{class $n{static \u0275fac=function(ii){return new(ii||$n)};static \u0275mod=v.$C({type:$n,bootstrap:[nn]});static \u0275inj=v.G2t({providers:[{provide:je.b,useClass:Ne.jM}],imports:[g.Bb,ze.q1,a.h.forRoot({loader:{provide:a.Wr,useFactory:no,deps:[ze.Qq]}}),T.bv.forRoot(),pn,We.QU.forRoot({config:{tokenGetter:ei}}),re.SearchPageModule,An,Nt.JourneysModule,Ct.SignInModule,Je,Ce,De,Rn.PoiEditorPageModule,Qt,Bt,Ci.AboutPageModule,Oi.LayerEditorPageModule]})}return $n})();ct.c.production&&(0,v.SmG)(),g.sG().bootstrapModule(mr).catch($n=>console.log($n))},1247:function(vi){vi.exports=function(){"use strict";var Vt,B,g;function v(a,Z){if(Vt)if(B){var ie="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Vt+")(sharedChunk); ("+B+")(sharedChunk); self.onerror = null;",T={};Vt(T),g=Z(T),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(g.workerUrl=window.URL.createObjectURL(new Blob([ie],{type:"text/javascript"})))}else B=Z;else Vt=Z}return v(0,function(a){var Z="3.5.2";let ie;const T={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ie){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ie=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{ie=t}}return ie},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!T.API_URL)return null;try{const t=new URL(T.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ce(t){return T.API_URL_REGEX.test(t)}function De(t){return 0===t.indexOf("mapbox:")}function Je(t){return T.API_CDN_URL_REGEX.test(t)}function re(t){return T.API_SPRITE_REGEX.test(t)}function ze(t){return T.API_STYLE_REGEX.test(t)&&!re(t)}const je={create:"create",load:"load",fullLoad:"fullLoad"},We={mark(t){performance.mark(t)},measure(t,e,n){performance.measure(t,e,n)}};function Ne(t){const e=t.name.split("?")[0];return Je(e)&&e.includes("mapbox-gl.js")?"javascript":Je(e)&&e.includes("mapbox-gl.css")?"css":T.API_FONTS_REGEX.test(e)?"fontRange":re(e)?"sprite":ze(e)?"style":T.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}function ht(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var He={},be={};Object.defineProperty(be,"__esModule",{value:!0}),be.setMatrixArrayType=function(t){be.ARRAY_TYPE=Le=t},be.toRadian=function(t){return t*Ve},be.equals=function(t,e){return Math.abs(t-e)<=Ye*Math.max(1,Math.abs(t),Math.abs(e))},be.RANDOM=be.ARRAY_TYPE=be.EPSILON=void 0;var Ye=1e-6;be.EPSILON=Ye;var Le=typeof Float32Array<"u"?Float32Array:Array;be.ARRAY_TYPE=Le;var ot=Math.random;be.RANDOM=ot;var Ve=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Ue={};function $t(t){return($t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.create=function(){var t=new nt.ARRAY_TYPE(4);return nt.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Ue.clone=function(t){var e=new nt.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ue.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ue.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Ue.fromValues=function(t,e,n,s){var c=new nt.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=s,c},Ue.set=function(t,e,n,s,c){return t[0]=e,t[1]=n,t[2]=s,t[3]=c,t},Ue.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Ue.invert=function(t,e){var n=e[0],s=e[1],c=e[2],d=e[3],f=n*d-c*s;return f?(t[0]=d*(f=1/f),t[1]=-s*f,t[2]=-c*f,t[3]=n*f,t):null},Ue.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},Ue.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Ue.multiply=ct,Ue.rotate=function(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(n),x=Math.cos(n);return t[0]=s*x+d*_,t[1]=c*x+f*_,t[2]=s*-_+d*x,t[3]=c*-_+f*x,t},Ue.scale=function(t,e,n){var s=e[1],c=e[2],d=e[3],f=n[0],_=n[1];return t[0]=e[0]*f,t[1]=s*f,t[2]=c*_,t[3]=d*_,t},Ue.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=-n,t[3]=s,t},Ue.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Ue.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Ue.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Ue.LDU=function(t,e,n,s){return t[2]=s[2]/s[0],n[0]=s[0],n[1]=s[1],n[3]=s[3]-t[2]*n[1],[t,e,n]},Ue.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Ue.subtract=Mt,Ue.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Ue.equals=function(t,e){var n=t[0],s=t[1],c=t[2],d=t[3],f=e[0],_=e[1],x=e[2],E=e[3];return Math.abs(n-f)<=nt.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-_)<=nt.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(c-x)<=nt.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(d-E)<=nt.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))},Ue.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Ue.multiplyScalarAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t},Ue.sub=Ue.mul=void 0;var nt=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==$t(t)&&"function"!=typeof t)return{default:t};var n=xt(void 0);if(n&&n.has(t))return n.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if("default"!==d&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(s,d,f):s[d]=t[d]}return s.default=t,n&&n.set(t,s),s}(be);function xt(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(xt=function(s){return s?n:e})(t)}function ct(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3],_=n[0],x=n[1],E=n[2],D=n[3];return t[0]=s*_+d*x,t[1]=c*_+f*x,t[2]=s*E+d*D,t[3]=c*E+f*D,t}function Mt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}Ue.mul=ct,Ue.sub=Mt;var $e={};function Et(t){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty($e,"__esModule",{value:!0}),$e.create=function(){var t=new cn.ARRAY_TYPE(6);return cn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},$e.clone=function(t){var e=new cn.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},$e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},$e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},$e.fromValues=function(t,e,n,s,c,d){var f=new cn.ARRAY_TYPE(6);return f[0]=t,f[1]=e,f[2]=n,f[3]=s,f[4]=c,f[5]=d,f},$e.set=function(t,e,n,s,c,d,f){return t[0]=e,t[1]=n,t[2]=s,t[3]=c,t[4]=d,t[5]=f,t},$e.invert=function(t,e){var n=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],x=n*d-s*c;return x?(t[0]=d*(x=1/x),t[1]=-s*x,t[2]=-c*x,t[3]=n*x,t[4]=(c*_-d*f)*x,t[5]=(s*f-n*_)*x,t):null},$e.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},$e.multiply=Kn,$e.rotate=function(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3],_=e[4],x=e[5],E=Math.sin(n),D=Math.cos(n);return t[0]=s*D+d*E,t[1]=c*D+f*E,t[2]=s*-E+d*D,t[3]=c*-E+f*D,t[4]=_,t[5]=x,t},$e.scale=function(t,e,n){var s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],x=n[0],E=n[1];return t[0]=e[0]*x,t[1]=s*x,t[2]=c*E,t[3]=d*E,t[4]=f,t[5]=_,t},$e.translate=function(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3],_=e[4],x=e[5],E=n[0],D=n[1];return t[0]=s,t[1]=c,t[2]=d,t[3]=f,t[4]=s*E+d*D+_,t[5]=c*E+f*D+x,t},$e.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=-n,t[3]=s,t[4]=0,t[5]=0,t},$e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},$e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},$e.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},$e.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},$e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},$e.subtract=Kt,$e.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},$e.multiplyScalarAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t[4]=e[4]+n[4]*s,t[5]=e[5]+n[5]*s,t},$e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},$e.equals=function(t,e){var n=t[0],s=t[1],c=t[2],d=t[3],f=t[4],_=t[5],x=e[0],E=e[1],D=e[2],S=e[3],P=e[4],F=e[5];return Math.abs(n-x)<=cn.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-E)<=cn.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(c-D)<=cn.EPSILON*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(d-S)<=cn.EPSILON*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(f-P)<=cn.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(_-F)<=cn.EPSILON*Math.max(1,Math.abs(_),Math.abs(F))},$e.sub=$e.mul=void 0;var cn=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Et(t)&&"function"!=typeof t)return{default:t};var n=fn(void 0);if(n&&n.has(t))return n.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if("default"!==d&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(s,d,f):s[d]=t[d]}return s.default=t,n&&n.set(t,s),s}(be);function fn(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(fn=function(s){return s?n:e})(t)}function Kn(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3],_=e[4],x=e[5],E=n[0],D=n[1],S=n[2],P=n[3],F=n[4],z=n[5];return t[0]=s*E+d*D,t[1]=c*E+f*D,t[2]=s*S+d*P,t[3]=c*S+f*P,t[4]=s*F+d*z+_,t[5]=c*F+f*z+x,t}function Kt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}$e.mul=Kn,$e.sub=Kt;var at={};function ve(t){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(at,"__esModule",{value:!0}),at.create=function(){var t=new Me.ARRAY_TYPE(9);return Me.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},at.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},at.clone=function(t){var e=new Me.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},at.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},at.fromValues=function(t,e,n,s,c,d,f,_,x){var E=new Me.ARRAY_TYPE(9);return E[0]=t,E[1]=e,E[2]=n,E[3]=s,E[4]=c,E[5]=d,E[6]=f,E[7]=_,E[8]=x,E},at.set=function(t,e,n,s,c,d,f,_,x,E){return t[0]=e,t[1]=n,t[2]=s,t[3]=c,t[4]=d,t[5]=f,t[6]=_,t[7]=x,t[8]=E,t},at.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},at.transpose=function(t,e){if(t===e){var n=e[1],s=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=s,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},at.invert=function(t,e){var n=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],x=e[6],E=e[7],D=e[8],S=D*f-_*E,P=-D*d+_*x,F=E*d-f*x,z=n*S+s*P+c*F;return z?(t[0]=S*(z=1/z),t[1]=(-D*s+c*E)*z,t[2]=(_*s-c*f)*z,t[3]=P*z,t[4]=(D*n-c*x)*z,t[5]=(-_*n+c*d)*z,t[6]=F*z,t[7]=(-E*n+s*x)*z,t[8]=(f*n-s*d)*z,t):null},at.adjoint=function(t,e){var n=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],x=e[6],E=e[7],D=e[8];return t[0]=f*D-_*E,t[1]=c*E-s*D,t[2]=s*_-c*f,t[3]=_*x-d*D,t[4]=n*D-c*x,t[5]=c*d-n*_,t[6]=d*E-f*x,t[7]=s*x-n*E,t[8]=n*f-s*d,t},at.determinant=function(t){var e=t[3],n=t[4],s=t[5],c=t[6],d=t[7],f=t[8];return t[0]*(f*n-s*d)+t[1]*(-f*e+s*c)+t[2]*(d*e-n*c)},at.multiply=vt,at.translate=function(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3],_=e[4],x=e[5],E=e[6],D=e[7],S=e[8],P=n[0],F=n[1];return t[0]=s,t[1]=c,t[2]=d,t[3]=f,t[4]=_,t[5]=x,t[6]=P*s+F*f+E,t[7]=P*c+F*_+D,t[8]=P*d+F*x+S,t},at.rotate=function(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3],_=e[4],x=e[5],E=e[6],D=e[7],S=e[8],P=Math.sin(n),F=Math.cos(n);return t[0]=F*s+P*f,t[1]=F*c+P*_,t[2]=F*d+P*x,t[3]=F*f-P*s,t[4]=F*_-P*c,t[5]=F*x-P*d,t[6]=E,t[7]=D,t[8]=S,t},at.scale=function(t,e,n){var s=n[0],c=n[1];return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=c*e[3],t[4]=c*e[4],t[5]=c*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},at.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},at.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=0,t[3]=-n,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},at.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},at.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},at.fromQuat=function(t,e){var n=e[0],s=e[1],c=e[2],d=e[3],f=n+n,_=s+s,x=c+c,E=n*f,D=s*f,S=s*_,P=c*f,F=c*_,z=c*x,$=d*f,H=d*_,ee=d*x;return t[0]=1-S-z,t[3]=D-ee,t[6]=P+H,t[1]=D+ee,t[4]=1-E-z,t[7]=F-$,t[2]=P-H,t[5]=F+$,t[8]=1-E-S,t},at.normalFromMat4=function(t,e){var n=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],x=e[6],E=e[7],D=e[8],S=e[9],P=e[10],F=e[11],z=e[12],$=e[13],H=e[14],ee=e[15],Pe=n*_-s*f,Oe=n*x-c*f,ke=n*E-d*f,dt=s*x-c*_,st=s*E-d*_,Dt=c*E-d*x,kt=D*$-S*z,Yt=D*H-P*z,yn=D*ee-F*z,dn=S*H-P*$,Fn=S*ee-F*$,Yn=P*ee-F*H,Sn=Pe*Yn-Oe*Fn+ke*dn+dt*yn-st*Yt+Dt*kt;return Sn?(t[0]=(_*Yn-x*Fn+E*dn)*(Sn=1/Sn),t[1]=(x*yn-f*Yn-E*Yt)*Sn,t[2]=(f*Fn-_*yn+E*kt)*Sn,t[3]=(c*Fn-s*Yn-d*dn)*Sn,t[4]=(n*Yn-c*yn+d*Yt)*Sn,t[5]=(s*yn-n*Fn-d*kt)*Sn,t[6]=($*Dt-H*st+ee*dt)*Sn,t[7]=(H*ke-z*Dt-ee*Oe)*Sn,t[8]=(z*st-$*ke+ee*Pe)*Sn,t):null},at.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},at.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},at.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},at.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},at.subtract=_n,at.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},at.multiplyScalarAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t[4]=e[4]+n[4]*s,t[5]=e[5]+n[5]*s,t[6]=e[6]+n[6]*s,t[7]=e[7]+n[7]*s,t[8]=e[8]+n[8]*s,t},at.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},at.equals=function(t,e){var n=t[0],s=t[1],c=t[2],d=t[3],f=t[4],_=t[5],x=t[6],E=t[7],D=t[8],S=e[0],P=e[1],F=e[2],z=e[3],$=e[4],H=e[5],ee=e[6],Pe=e[7],Oe=e[8];return Math.abs(n-S)<=Me.EPSILON*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(s-P)<=Me.EPSILON*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(c-F)<=Me.EPSILON*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(d-z)<=Me.EPSILON*Math.max(1,Math.abs(d),Math.abs(z))&&Math.abs(f-$)<=Me.EPSILON*Math.max(1,Math.abs(f),Math.abs($))&&Math.abs(_-H)<=Me.EPSILON*Math.max(1,Math.abs(_),Math.abs(H))&&Math.abs(x-ee)<=Me.EPSILON*Math.max(1,Math.abs(x),Math.abs(ee))&&Math.abs(E-Pe)<=Me.EPSILON*Math.max(1,Math.abs(E),Math.abs(Pe))&&Math.abs(D-Oe)<=Me.EPSILON*Math.max(1,Math.abs(D),Math.abs(Oe))},at.sub=at.mul=void 0;var Me=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==ve(t)&&"function"!=typeof t)return{default:t};var n=fe(void 0);if(n&&n.has(t))return n.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if("default"!==d&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(s,d,f):s[d]=t[d]}return s.default=t,n&&n.set(t,s),s}(be);function fe(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(fe=function(s){return s?n:e})(t)}function vt(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3],_=e[4],x=e[5],E=e[6],D=e[7],S=e[8],P=n[0],F=n[1],z=n[2],$=n[3],H=n[4],ee=n[5],Pe=n[6],Oe=n[7],ke=n[8];return t[0]=P*s+F*f+z*E,t[1]=P*c+F*_+z*D,t[2]=P*d+F*x+z*S,t[3]=$*s+H*f+ee*E,t[4]=$*c+H*_+ee*D,t[5]=$*d+H*x+ee*S,t[6]=Pe*s+Oe*f+ke*E,t[7]=Pe*c+Oe*_+ke*D,t[8]=Pe*d+Oe*x+ke*S,t}function _n(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}at.mul=vt,at.sub=_n;var Re={};function wn(t){return(wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Re,"__esModule",{value:!0}),Re.create=function(){var t=new it.ARRAY_TYPE(16);return it.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Re.clone=function(t){var e=new it.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Re.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Re.fromValues=function(t,e,n,s,c,d,f,_,x,E,D,S,P,F,z,$){var H=new it.ARRAY_TYPE(16);return H[0]=t,H[1]=e,H[2]=n,H[3]=s,H[4]=c,H[5]=d,H[6]=f,H[7]=_,H[8]=x,H[9]=E,H[10]=D,H[11]=S,H[12]=P,H[13]=F,H[14]=z,H[15]=$,H},Re.set=function(t,e,n,s,c,d,f,_,x,E,D,S,P,F,z,$,H){return t[0]=e,t[1]=n,t[2]=s,t[3]=c,t[4]=d,t[5]=f,t[6]=_,t[7]=x,t[8]=E,t[9]=D,t[10]=S,t[11]=P,t[12]=F,t[13]=z,t[14]=$,t[15]=H,t},Re.identity=bn,Re.transpose=function(t,e){if(t===e){var n=e[1],s=e[2],c=e[3],d=e[6],f=e[7],_=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=s,t[9]=d,t[11]=e[14],t[12]=c,t[13]=f,t[14]=_}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Re.invert=function(t,e){var n=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],x=e[6],E=e[7],D=e[8],S=e[9],P=e[10],F=e[11],z=e[12],$=e[13],H=e[14],ee=e[15],Pe=n*_-s*f,Oe=n*x-c*f,ke=n*E-d*f,dt=s*x-c*_,st=s*E-d*_,Dt=c*E-d*x,kt=D*$-S*z,Yt=D*H-P*z,yn=D*ee-F*z,dn=S*H-P*$,Fn=S*ee-F*$,Yn=P*ee-F*H,Sn=Pe*Yn-Oe*Fn+ke*dn+dt*yn-st*Yt+Dt*kt;return Sn?(t[0]=(_*Yn-x*Fn+E*dn)*(Sn=1/Sn),t[1]=(c*Fn-s*Yn-d*dn)*Sn,t[2]=($*Dt-H*st+ee*dt)*Sn,t[3]=(P*st-S*Dt-F*dt)*Sn,t[4]=(x*yn-f*Yn-E*Yt)*Sn,t[5]=(n*Yn-c*yn+d*Yt)*Sn,t[6]=(H*ke-z*Dt-ee*Oe)*Sn,t[7]=(D*Dt-P*ke+F*Oe)*Sn,t[8]=(f*Fn-_*yn+E*kt)*Sn,t[9]=(s*yn-n*Fn-d*kt)*Sn,t[10]=(z*st-$*ke+ee*Pe)*Sn,t[11]=(S*ke-D*st-F*Pe)*Sn,t[12]=(_*Yt-f*dn-x*kt)*Sn,t[13]=(n*dn-s*Yt+c*kt)*Sn,t[14]=($*Oe-z*dt-H*Pe)*Sn,t[15]=(D*dt-S*Oe+P*Pe)*Sn,t):null},Re.adjoint=function(t,e){var n=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],x=e[6],E=e[7],D=e[8],S=e[9],P=e[10],F=e[11],z=e[12],$=e[13],H=e[14],ee=e[15];return t[0]=_*(P*ee-F*H)-S*(x*ee-E*H)+$*(x*F-E*P),t[1]=-(s*(P*ee-F*H)-S*(c*ee-d*H)+$*(c*F-d*P)),t[2]=s*(x*ee-E*H)-_*(c*ee-d*H)+$*(c*E-d*x),t[3]=-(s*(x*F-E*P)-_*(c*F-d*P)+S*(c*E-d*x)),t[4]=-(f*(P*ee-F*H)-D*(x*ee-E*H)+z*(x*F-E*P)),t[5]=n*(P*ee-F*H)-D*(c*ee-d*H)+z*(c*F-d*P),t[6]=-(n*(x*ee-E*H)-f*(c*ee-d*H)+z*(c*E-d*x)),t[7]=n*(x*F-E*P)-f*(c*F-d*P)+D*(c*E-d*x),t[8]=f*(S*ee-F*$)-D*(_*ee-E*$)+z*(_*F-E*S),t[9]=-(n*(S*ee-F*$)-D*(s*ee-d*$)+z*(s*F-d*S)),t[10]=n*(_*ee-E*$)-f*(s*ee-d*$)+z*(s*E-d*_),t[11]=-(n*(_*F-E*S)-f*(s*F-d*S)+D*(s*E-d*_)),t[12]=-(f*(S*H-P*$)-D*(_*H-x*$)+z*(_*P-x*S)),t[13]=n*(S*H-P*$)-D*(s*H-c*$)+z*(s*P-c*S),t[14]=-(n*(_*H-x*$)-f*(s*H-c*$)+z*(s*x-c*_)),t[15]=n*(_*P-x*S)-f*(s*P-c*S)+D*(s*x-c*_),t},Re.determinant=function(t){var e=t[0],n=t[1],s=t[2],c=t[3],d=t[4],f=t[5],_=t[6],x=t[7],E=t[8],D=t[9],S=t[10],P=t[11],F=t[12],z=t[13],$=t[14],H=t[15];return(e*f-n*d)*(S*H-P*$)-(e*_-s*d)*(D*H-P*z)+(e*x-c*d)*(D*$-S*z)+(n*_-s*f)*(E*H-P*F)-(n*x-c*f)*(E*$-S*F)+(s*x-c*_)*(E*z-D*F)},Re.multiply=Jn,Re.translate=function(t,e,n){var s,c,d,f,_,x,E,D,S,P,F,z,$=n[0],H=n[1],ee=n[2];return e===t?(t[12]=e[0]*$+e[4]*H+e[8]*ee+e[12],t[13]=e[1]*$+e[5]*H+e[9]*ee+e[13],t[14]=e[2]*$+e[6]*H+e[10]*ee+e[14],t[15]=e[3]*$+e[7]*H+e[11]*ee+e[15]):(c=e[1],d=e[2],f=e[3],_=e[4],x=e[5],E=e[6],D=e[7],S=e[8],P=e[9],F=e[10],z=e[11],t[0]=s=e[0],t[1]=c,t[2]=d,t[3]=f,t[4]=_,t[5]=x,t[6]=E,t[7]=D,t[8]=S,t[9]=P,t[10]=F,t[11]=z,t[12]=s*$+_*H+S*ee+e[12],t[13]=c*$+x*H+P*ee+e[13],t[14]=d*$+E*H+F*ee+e[14],t[15]=f*$+D*H+z*ee+e[15]),t},Re.scale=function(t,e,n){var s=n[0],c=n[1],d=n[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*d,t[9]=e[9]*d,t[10]=e[10]*d,t[11]=e[11]*d,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Re.rotate=function(t,e,n,s){var c,d,f,_,x,E,D,S,P,F,z,$,H,ee,Pe,Oe,ke,dt,st,Dt,kt,Yt,yn,dn,Fn=s[0],Yn=s[1],Sn=s[2],Wn=Math.hypot(Fn,Yn,Sn);return Wn<it.EPSILON?null:(Fn*=Wn=1/Wn,Yn*=Wn,Sn*=Wn,c=Math.sin(n),d=Math.cos(n),x=e[1],E=e[2],D=e[3],P=e[5],F=e[6],z=e[7],H=e[9],ee=e[10],Pe=e[11],Oe=Fn*Fn*(f=1-d)+d,st=Fn*Yn*f-Sn*c,Dt=Yn*Yn*f+d,kt=Sn*Yn*f+Fn*c,Yt=Fn*Sn*f+Yn*c,yn=Yn*Sn*f-Fn*c,dn=Sn*Sn*f+d,t[0]=(_=e[0])*Oe+(S=e[4])*(ke=Yn*Fn*f+Sn*c)+($=e[8])*(dt=Sn*Fn*f-Yn*c),t[1]=x*Oe+P*ke+H*dt,t[2]=E*Oe+F*ke+ee*dt,t[3]=D*Oe+z*ke+Pe*dt,t[4]=_*st+S*Dt+$*kt,t[5]=x*st+P*Dt+H*kt,t[6]=E*st+F*Dt+ee*kt,t[7]=D*st+z*Dt+Pe*kt,t[8]=_*Yt+S*yn+$*dn,t[9]=x*Yt+P*yn+H*dn,t[10]=E*Yt+F*yn+ee*dn,t[11]=D*Yt+z*yn+Pe*dn,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Re.rotateX=function(t,e,n){var s=Math.sin(n),c=Math.cos(n),d=e[4],f=e[5],_=e[6],x=e[7],E=e[8],D=e[9],S=e[10],P=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=d*c+E*s,t[5]=f*c+D*s,t[6]=_*c+S*s,t[7]=x*c+P*s,t[8]=E*c-d*s,t[9]=D*c-f*s,t[10]=S*c-_*s,t[11]=P*c-x*s,t},Re.rotateY=function(t,e,n){var s=Math.sin(n),c=Math.cos(n),d=e[0],f=e[1],_=e[2],x=e[3],E=e[8],D=e[9],S=e[10],P=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*c-E*s,t[1]=f*c-D*s,t[2]=_*c-S*s,t[3]=x*c-P*s,t[8]=d*s+E*c,t[9]=f*s+D*c,t[10]=_*s+S*c,t[11]=x*s+P*c,t},Re.rotateZ=function(t,e,n){var s=Math.sin(n),c=Math.cos(n),d=e[0],f=e[1],_=e[2],x=e[3],E=e[4],D=e[5],S=e[6],P=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*c+E*s,t[1]=f*c+D*s,t[2]=_*c+S*s,t[3]=x*c+P*s,t[4]=E*c-d*s,t[5]=D*c-f*s,t[6]=S*c-_*s,t[7]=P*c-x*s,t},Re.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Re.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Re.fromRotation=function(t,e,n){var s,c,d,f=n[0],_=n[1],x=n[2],E=Math.hypot(f,_,x);return E<it.EPSILON?null:(f*=E=1/E,_*=E,x*=E,s=Math.sin(e),c=Math.cos(e),t[0]=f*f*(d=1-c)+c,t[1]=_*f*d+x*s,t[2]=x*f*d-_*s,t[3]=0,t[4]=f*_*d-x*s,t[5]=_*_*d+c,t[6]=x*_*d+f*s,t[7]=0,t[8]=f*x*d+_*s,t[9]=_*x*d-f*s,t[10]=x*x*d+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Re.fromXRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Re.fromYRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Re.fromZRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Re.fromRotationTranslation=jn,Re.fromQuat2=function(t,e){var n=new it.ARRAY_TYPE(3),s=-e[0],c=-e[1],d=-e[2],f=e[3],_=e[4],x=e[5],E=e[6],D=e[7],S=s*s+c*c+d*d+f*f;return S>0?(n[0]=2*(_*f+D*s+x*d-E*c)/S,n[1]=2*(x*f+D*c+E*s-_*d)/S,n[2]=2*(E*f+D*d+_*c-x*s)/S):(n[0]=2*(_*f+D*s+x*d-E*c),n[1]=2*(x*f+D*c+E*s-_*d),n[2]=2*(E*f+D*d+_*c-x*s)),jn(t,e,n),t},Re.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Re.getScaling=_i,Re.getRotation=function(t,e){var n=new it.ARRAY_TYPE(3);_i(n,e);var s=1/n[0],c=1/n[1],d=1/n[2],f=e[0]*s,_=e[1]*c,x=e[2]*d,E=e[4]*s,D=e[5]*c,S=e[6]*d,P=e[8]*s,F=e[9]*c,z=e[10]*d,$=f+D+z,H=0;return $>0?(H=2*Math.sqrt($+1),t[3]=.25*H,t[0]=(S-F)/H,t[1]=(P-x)/H,t[2]=(_-E)/H):f>D&&f>z?(H=2*Math.sqrt(1+f-D-z),t[3]=(S-F)/H,t[0]=.25*H,t[1]=(_+E)/H,t[2]=(P+x)/H):D>z?(H=2*Math.sqrt(1+D-f-z),t[3]=(P-x)/H,t[0]=(_+E)/H,t[1]=.25*H,t[2]=(S+F)/H):(H=2*Math.sqrt(1+z-f-D),t[3]=(_-E)/H,t[0]=(P+x)/H,t[1]=(S+F)/H,t[2]=.25*H),t},Re.fromRotationTranslationScale=function(t,e,n,s){var c=e[0],d=e[1],f=e[2],_=e[3],x=c+c,E=d+d,D=f+f,S=c*x,P=c*E,F=c*D,z=d*E,$=d*D,H=f*D,ee=_*x,Pe=_*E,Oe=_*D,ke=s[0],dt=s[1],st=s[2];return t[0]=(1-(z+H))*ke,t[1]=(P+Oe)*ke,t[2]=(F-Pe)*ke,t[3]=0,t[4]=(P-Oe)*dt,t[5]=(1-(S+H))*dt,t[6]=($+ee)*dt,t[7]=0,t[8]=(F+Pe)*st,t[9]=($-ee)*st,t[10]=(1-(S+z))*st,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Re.fromRotationTranslationScaleOrigin=function(t,e,n,s,c){var d=e[0],f=e[1],_=e[2],x=e[3],E=d+d,D=f+f,S=_+_,P=d*E,F=d*D,z=d*S,$=f*D,H=f*S,ee=_*S,Pe=x*E,Oe=x*D,ke=x*S,dt=s[0],st=s[1],Dt=s[2],kt=c[0],Yt=c[1],yn=c[2],dn=(1-($+ee))*dt,Fn=(F+ke)*dt,Yn=(z-Oe)*dt,Sn=(F-ke)*st,Wn=(1-(P+ee))*st,xn=(H+Pe)*st,Hn=(z+Oe)*Dt,ni=(H-Pe)*Dt,Zn=(1-(P+$))*Dt;return t[0]=dn,t[1]=Fn,t[2]=Yn,t[3]=0,t[4]=Sn,t[5]=Wn,t[6]=xn,t[7]=0,t[8]=Hn,t[9]=ni,t[10]=Zn,t[11]=0,t[12]=n[0]+kt-(dn*kt+Sn*Yt+Hn*yn),t[13]=n[1]+Yt-(Fn*kt+Wn*Yt+ni*yn),t[14]=n[2]+yn-(Yn*kt+xn*Yt+Zn*yn),t[15]=1,t},Re.fromQuat=function(t,e){var n=e[0],s=e[1],c=e[2],d=e[3],f=n+n,_=s+s,x=c+c,E=n*f,D=s*f,S=s*_,P=c*f,F=c*_,z=c*x,$=d*f,H=d*_,ee=d*x;return t[0]=1-S-z,t[1]=D+ee,t[2]=P-H,t[3]=0,t[4]=D-ee,t[5]=1-E-z,t[6]=F+$,t[7]=0,t[8]=P+H,t[9]=F-$,t[10]=1-E-S,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Re.frustum=function(t,e,n,s,c,d,f){var _=1/(n-e),x=1/(c-s),E=1/(d-f);return t[0]=2*d*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*d*x,t[6]=0,t[7]=0,t[8]=(n+e)*_,t[9]=(c+s)*x,t[10]=(f+d)*E,t[11]=-1,t[12]=0,t[13]=0,t[14]=f*d*2*E,t[15]=0,t},Re.perspectiveNO=ut,Re.perspectiveZO=function(t,e,n,s,c){var d,f=1/Math.tan(e/2);return t[0]=f/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=c&&c!==1/0?(t[10]=c*(d=1/(s-c)),t[14]=c*s*d):(t[10]=-1,t[14]=-s),t},Re.perspectiveFromFieldOfView=function(t,e,n,s){var c=Math.tan(e.upDegrees*Math.PI/180),d=Math.tan(e.downDegrees*Math.PI/180),f=Math.tan(e.leftDegrees*Math.PI/180),_=Math.tan(e.rightDegrees*Math.PI/180),x=2/(f+_),E=2/(c+d);return t[0]=x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=E,t[6]=0,t[7]=0,t[8]=-(f-_)*x*.5,t[9]=(c-d)*E*.5,t[10]=s/(n-s),t[11]=-1,t[12]=0,t[13]=0,t[14]=s*n/(n-s),t[15]=0,t},Re.orthoNO=nn,Re.orthoZO=function(t,e,n,s,c,d,f){var _=1/(e-n),x=1/(s-c),E=1/(d-f);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=E,t[11]=0,t[12]=(e+n)*_,t[13]=(c+s)*x,t[14]=d*E,t[15]=1,t},Re.lookAt=function(t,e,n,s){var c,d,f,_,x,E,D,S,P,F,z=e[0],$=e[1],H=e[2],ee=s[0],Pe=s[1],Oe=s[2],ke=n[0],dt=n[1],st=n[2];return Math.abs(z-ke)<it.EPSILON&&Math.abs($-dt)<it.EPSILON&&Math.abs(H-st)<it.EPSILON?bn(t):(D=z-ke,S=$-dt,P=H-st,c=Pe*(P*=F=1/Math.hypot(D,S,P))-Oe*(S*=F),d=Oe*(D*=F)-ee*P,f=ee*S-Pe*D,(F=Math.hypot(c,d,f))?(c*=F=1/F,d*=F,f*=F):(c=0,d=0,f=0),_=S*f-P*d,x=P*c-D*f,E=D*d-S*c,(F=Math.hypot(_,x,E))?(_*=F=1/F,x*=F,E*=F):(_=0,x=0,E=0),t[0]=c,t[1]=_,t[2]=D,t[3]=0,t[4]=d,t[5]=x,t[6]=S,t[7]=0,t[8]=f,t[9]=E,t[10]=P,t[11]=0,t[12]=-(c*z+d*$+f*H),t[13]=-(_*z+x*$+E*H),t[14]=-(D*z+S*$+P*H),t[15]=1,t)},Re.targetTo=function(t,e,n,s){var c=e[0],d=e[1],f=e[2],_=s[0],x=s[1],E=s[2],D=c-n[0],S=d-n[1],P=f-n[2],F=D*D+S*S+P*P;F>0&&(D*=F=1/Math.sqrt(F),S*=F,P*=F);var z=x*P-E*S,$=E*D-_*P,H=_*S-x*D;return(F=z*z+$*$+H*H)>0&&(z*=F=1/Math.sqrt(F),$*=F,H*=F),t[0]=z,t[1]=$,t[2]=H,t[3]=0,t[4]=S*H-P*$,t[5]=P*z-D*H,t[6]=D*$-S*z,t[7]=0,t[8]=D,t[9]=S,t[10]=P,t[11]=0,t[12]=c,t[13]=d,t[14]=f,t[15]=1,t},Re.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Re.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Re.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Re.subtract=ui,Re.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Re.multiplyScalarAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t[4]=e[4]+n[4]*s,t[5]=e[5]+n[5]*s,t[6]=e[6]+n[6]*s,t[7]=e[7]+n[7]*s,t[8]=e[8]+n[8]*s,t[9]=e[9]+n[9]*s,t[10]=e[10]+n[10]*s,t[11]=e[11]+n[11]*s,t[12]=e[12]+n[12]*s,t[13]=e[13]+n[13]*s,t[14]=e[14]+n[14]*s,t[15]=e[15]+n[15]*s,t},Re.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Re.equals=function(t,e){var n=t[0],s=t[1],c=t[2],d=t[3],f=t[4],_=t[5],x=t[6],E=t[7],D=t[8],S=t[9],P=t[10],F=t[11],z=t[12],$=t[13],H=t[14],ee=t[15],Pe=e[0],Oe=e[1],ke=e[2],dt=e[3],st=e[4],Dt=e[5],kt=e[6],Yt=e[7],yn=e[8],dn=e[9],Fn=e[10],Yn=e[11],Sn=e[12],Wn=e[13],xn=e[14],Hn=e[15];return Math.abs(n-Pe)<=it.EPSILON*Math.max(1,Math.abs(n),Math.abs(Pe))&&Math.abs(s-Oe)<=it.EPSILON*Math.max(1,Math.abs(s),Math.abs(Oe))&&Math.abs(c-ke)<=it.EPSILON*Math.max(1,Math.abs(c),Math.abs(ke))&&Math.abs(d-dt)<=it.EPSILON*Math.max(1,Math.abs(d),Math.abs(dt))&&Math.abs(f-st)<=it.EPSILON*Math.max(1,Math.abs(f),Math.abs(st))&&Math.abs(_-Dt)<=it.EPSILON*Math.max(1,Math.abs(_),Math.abs(Dt))&&Math.abs(x-kt)<=it.EPSILON*Math.max(1,Math.abs(x),Math.abs(kt))&&Math.abs(E-Yt)<=it.EPSILON*Math.max(1,Math.abs(E),Math.abs(Yt))&&Math.abs(D-yn)<=it.EPSILON*Math.max(1,Math.abs(D),Math.abs(yn))&&Math.abs(S-dn)<=it.EPSILON*Math.max(1,Math.abs(S),Math.abs(dn))&&Math.abs(P-Fn)<=it.EPSILON*Math.max(1,Math.abs(P),Math.abs(Fn))&&Math.abs(F-Yn)<=it.EPSILON*Math.max(1,Math.abs(F),Math.abs(Yn))&&Math.abs(z-Sn)<=it.EPSILON*Math.max(1,Math.abs(z),Math.abs(Sn))&&Math.abs($-Wn)<=it.EPSILON*Math.max(1,Math.abs($),Math.abs(Wn))&&Math.abs(H-xn)<=it.EPSILON*Math.max(1,Math.abs(H),Math.abs(xn))&&Math.abs(ee-Hn)<=it.EPSILON*Math.max(1,Math.abs(ee),Math.abs(Hn))},Re.sub=Re.mul=Re.ortho=Re.perspective=void 0;var it=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==wn(t)&&"function"!=typeof t)return{default:t};var n=tn(void 0);if(n&&n.has(t))return n.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if("default"!==d&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(s,d,f):s[d]=t[d]}return s.default=t,n&&n.set(t,s),s}(be);function tn(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(tn=function(s){return s?n:e})(t)}function bn(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Jn(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3],_=e[4],x=e[5],E=e[6],D=e[7],S=e[8],P=e[9],F=e[10],z=e[11],$=e[12],H=e[13],ee=e[14],Pe=e[15],Oe=n[0],ke=n[1],dt=n[2],st=n[3];return t[0]=Oe*s+ke*_+dt*S+st*$,t[1]=Oe*c+ke*x+dt*P+st*H,t[2]=Oe*d+ke*E+dt*F+st*ee,t[3]=Oe*f+ke*D+dt*z+st*Pe,t[4]=(Oe=n[4])*s+(ke=n[5])*_+(dt=n[6])*S+(st=n[7])*$,t[5]=Oe*c+ke*x+dt*P+st*H,t[6]=Oe*d+ke*E+dt*F+st*ee,t[7]=Oe*f+ke*D+dt*z+st*Pe,t[8]=(Oe=n[8])*s+(ke=n[9])*_+(dt=n[10])*S+(st=n[11])*$,t[9]=Oe*c+ke*x+dt*P+st*H,t[10]=Oe*d+ke*E+dt*F+st*ee,t[11]=Oe*f+ke*D+dt*z+st*Pe,t[12]=(Oe=n[12])*s+(ke=n[13])*_+(dt=n[14])*S+(st=n[15])*$,t[13]=Oe*c+ke*x+dt*P+st*H,t[14]=Oe*d+ke*E+dt*F+st*ee,t[15]=Oe*f+ke*D+dt*z+st*Pe,t}function jn(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3],_=s+s,x=c+c,E=d+d,D=s*_,S=s*x,P=s*E,F=c*x,z=c*E,$=d*E,H=f*_,ee=f*x,Pe=f*E;return t[0]=1-(F+$),t[1]=S+Pe,t[2]=P-ee,t[3]=0,t[4]=S-Pe,t[5]=1-(D+$),t[6]=z+H,t[7]=0,t[8]=P+ee,t[9]=z-H,t[10]=1-(D+F),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function _i(t,e){var n=e[4],s=e[5],c=e[6],d=e[8],f=e[9],_=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,s,c),t[2]=Math.hypot(d,f,_),t}function ut(t,e,n,s,c){var d,f=1/Math.tan(e/2);return t[0]=f/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=c&&c!==1/0?(t[10]=(c+s)*(d=1/(s-c)),t[14]=2*c*s*d):(t[10]=-1,t[14]=-2*s),t}function nn(t,e,n,s,c,d,f){var _=1/(e-n),x=1/(s-c),E=1/(d-f);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*E,t[11]=0,t[12]=(e+n)*_,t[13]=(c+s)*x,t[14]=(f+d)*E,t[15]=1,t}function ui(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Re.perspective=ut,Re.ortho=nn,Re.mul=Jn,Re.sub=ui;var pn={},An={};function Ct(t){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(An,"__esModule",{value:!0}),An.create=Bt,An.clone=function(t){var e=new Qt.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},An.length=Nt,An.fromValues=function(t,e,n){var s=new Qt.ARRAY_TYPE(3);return s[0]=t,s[1]=e,s[2]=n,s},An.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},An.set=function(t,e,n,s){return t[0]=e,t[1]=n,t[2]=s,t},An.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},An.subtract=Rn,An.multiply=Ci,An.divide=Oi,An.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},An.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},An.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},An.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},An.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},An.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},An.scaleAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t},An.distance=ei,An.squaredDistance=no,An.squaredLength=mo,An.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},An.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},An.normalize=function(t,e){var n=e[0],s=e[1],c=e[2],d=n*n+s*s+c*c;return d>0&&(d=1/Math.sqrt(d)),t[0]=e[0]*d,t[1]=e[1]*d,t[2]=e[2]*d,t},An.dot=mr,An.cross=function(t,e,n){var s=e[0],c=e[1],d=e[2],f=n[0],_=n[1],x=n[2];return t[0]=c*x-d*_,t[1]=d*f-s*x,t[2]=s*_-c*f,t},An.lerp=function(t,e,n,s){var c=e[0],d=e[1],f=e[2];return t[0]=c+s*(n[0]-c),t[1]=d+s*(n[1]-d),t[2]=f+s*(n[2]-f),t},An.hermite=function(t,e,n,s,c,d){var f=d*d,_=f*(2*d-3)+1,x=f*(d-2)+d,E=f*(d-1),D=f*(3-2*d);return t[0]=e[0]*_+n[0]*x+s[0]*E+c[0]*D,t[1]=e[1]*_+n[1]*x+s[1]*E+c[1]*D,t[2]=e[2]*_+n[2]*x+s[2]*E+c[2]*D,t},An.bezier=function(t,e,n,s,c,d){var f=1-d,_=f*f,x=d*d,E=_*f,D=3*d*_,S=3*x*f,P=x*d;return t[0]=e[0]*E+n[0]*D+s[0]*S+c[0]*P,t[1]=e[1]*E+n[1]*D+s[1]*S+c[1]*P,t[2]=e[2]*E+n[2]*D+s[2]*S+c[2]*P,t},An.random=function(t,e){e=e||1;var n=2*Qt.RANDOM()*Math.PI,s=2*Qt.RANDOM()-1,c=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(n)*c,t[1]=Math.sin(n)*c,t[2]=s*e,t},An.transformMat4=function(t,e,n){var s=e[0],c=e[1],d=e[2],f=n[3]*s+n[7]*c+n[11]*d+n[15];return t[0]=(n[0]*s+n[4]*c+n[8]*d+n[12])/(f=f||1),t[1]=(n[1]*s+n[5]*c+n[9]*d+n[13])/f,t[2]=(n[2]*s+n[6]*c+n[10]*d+n[14])/f,t},An.transformMat3=function(t,e,n){var s=e[0],c=e[1],d=e[2];return t[0]=s*n[0]+c*n[3]+d*n[6],t[1]=s*n[1]+c*n[4]+d*n[7],t[2]=s*n[2]+c*n[5]+d*n[8],t},An.transformQuat=function(t,e,n){var s=n[0],c=n[1],d=n[2],f=e[0],_=e[1],x=e[2],E=c*x-d*_,D=d*f-s*x,S=s*_-c*f,P=c*S-d*D,F=d*E-s*S,z=s*D-c*E,$=2*n[3];return D*=$,S*=$,F*=2,z*=2,t[0]=f+(E*=$)+(P*=2),t[1]=_+D+F,t[2]=x+S+z,t},An.rotateX=function(t,e,n,s){var c=[],d=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],d[0]=c[0],d[1]=c[1]*Math.cos(s)-c[2]*Math.sin(s),d[2]=c[1]*Math.sin(s)+c[2]*Math.cos(s),t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},An.rotateY=function(t,e,n,s){var c=[],d=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],d[0]=c[2]*Math.sin(s)+c[0]*Math.cos(s),d[1]=c[1],d[2]=c[2]*Math.cos(s)-c[0]*Math.sin(s),t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},An.rotateZ=function(t,e,n,s){var c=[],d=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],d[0]=c[0]*Math.cos(s)-c[1]*Math.sin(s),d[1]=c[0]*Math.sin(s)+c[1]*Math.cos(s),d[2]=c[2],t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},An.angle=function(t,e){var n=t[0],s=t[1],c=t[2],d=e[0],f=e[1],_=e[2],x=Math.sqrt(n*n+s*s+c*c)*Math.sqrt(d*d+f*f+_*_),E=x&&mr(t,e)/x;return Math.acos(Math.min(Math.max(E,-1),1))},An.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},An.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},An.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},An.equals=function(t,e){var n=t[0],s=t[1],c=t[2],d=e[0],f=e[1],_=e[2];return Math.abs(n-d)<=Qt.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(s-f)<=Qt.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(c-_)<=Qt.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))},An.forEach=An.sqrLen=An.len=An.sqrDist=An.dist=An.div=An.mul=An.sub=void 0;var Qt=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Ct(t)&&"function"!=typeof t)return{default:t};var n=Se(void 0);if(n&&n.has(t))return n.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if("default"!==d&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(s,d,f):s[d]=t[d]}return s.default=t,n&&n.set(t,s),s}(be);function Se(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(Se=function(s){return s?n:e})(t)}function Bt(){var t=new Qt.ARRAY_TYPE(3);return Qt.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Nt(t){return Math.hypot(t[0],t[1],t[2])}function Rn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Ci(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Oi(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function ei(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function no(t,e){var n=e[0]-t[0],s=e[1]-t[1],c=e[2]-t[2];return n*n+s*s+c*c}function mo(t){var e=t[0],n=t[1],s=t[2];return e*e+n*n+s*s}function mr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}An.sub=Rn,An.mul=Ci,An.div=Oi,An.dist=ei,An.sqrDist=no,An.len=Nt,An.sqrLen=mo;var $n,ar=($n=Bt(),function(t,e,n,s,c,d){var f,_;for(e||(e=3),n||(n=0),_=s?Math.min(s*e+n,t.length):t.length,f=n;f<_;f+=e)$n[0]=t[f],$n[1]=t[f+1],$n[2]=t[f+2],c($n,$n,d),t[f]=$n[0],t[f+1]=$n[1],t[f+2]=$n[2];return t});An.forEach=ar;var gn={};function ii(t){return(ii="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(gn,"__esModule",{value:!0}),gn.create=pr,gn.clone=function(t){var e=new oi.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},gn.fromValues=function(t,e,n,s){var c=new oi.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=s,c},gn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},gn.set=function(t,e,n,s,c){return t[0]=e,t[1]=n,t[2]=s,t[3]=c,t},gn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},gn.subtract=io,gn.multiply=ao,gn.divide=ro,gn.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},gn.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},gn.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},gn.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},gn.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},gn.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},gn.scaleAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t},gn.distance=co,gn.squaredDistance=Po,gn.length=go,gn.squaredLength=bo,gn.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},gn.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},gn.normalize=function(t,e){var n=e[0],s=e[1],c=e[2],d=e[3],f=n*n+s*s+c*c+d*d;return f>0&&(f=1/Math.sqrt(f)),t[0]=n*f,t[1]=s*f,t[2]=c*f,t[3]=d*f,t},gn.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},gn.cross=function(t,e,n,s){var c=n[0]*s[1]-n[1]*s[0],d=n[0]*s[2]-n[2]*s[0],f=n[0]*s[3]-n[3]*s[0],_=n[1]*s[2]-n[2]*s[1],x=n[1]*s[3]-n[3]*s[1],E=n[2]*s[3]-n[3]*s[2],D=e[0],S=e[1],P=e[2],F=e[3];return t[0]=S*E-P*x+F*_,t[1]=-D*E+P*f-F*d,t[2]=D*x-S*f+F*c,t[3]=-D*_+S*d-P*c,t},gn.lerp=function(t,e,n,s){var c=e[0],d=e[1],f=e[2],_=e[3];return t[0]=c+s*(n[0]-c),t[1]=d+s*(n[1]-d),t[2]=f+s*(n[2]-f),t[3]=_+s*(n[3]-_),t},gn.random=function(t,e){var n,s,c,d,f,_;e=e||1;do{f=(n=2*oi.RANDOM()-1)*n+(s=2*oi.RANDOM()-1)*s}while(f>=1);do{_=(c=2*oi.RANDOM()-1)*c+(d=2*oi.RANDOM()-1)*d}while(_>=1);var x=Math.sqrt((1-f)/_);return t[0]=e*n,t[1]=e*s,t[2]=e*c*x,t[3]=e*d*x,t},gn.transformMat4=function(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3];return t[0]=n[0]*s+n[4]*c+n[8]*d+n[12]*f,t[1]=n[1]*s+n[5]*c+n[9]*d+n[13]*f,t[2]=n[2]*s+n[6]*c+n[10]*d+n[14]*f,t[3]=n[3]*s+n[7]*c+n[11]*d+n[15]*f,t},gn.transformQuat=function(t,e,n){var s=e[0],c=e[1],d=e[2],f=n[0],_=n[1],x=n[2],E=n[3],D=E*s+_*d-x*c,S=E*c+x*s-f*d,P=E*d+f*c-_*s,F=-f*s-_*c-x*d;return t[0]=D*E+F*-f+S*-x-P*-_,t[1]=S*E+F*-_+P*-f-D*-x,t[2]=P*E+F*-x+D*-_-S*-f,t[3]=e[3],t},gn.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},gn.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},gn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},gn.equals=function(t,e){var n=t[0],s=t[1],c=t[2],d=t[3],f=e[0],_=e[1],x=e[2],E=e[3];return Math.abs(n-f)<=oi.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-_)<=oi.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(c-x)<=oi.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(d-E)<=oi.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))},gn.forEach=gn.sqrLen=gn.len=gn.sqrDist=gn.dist=gn.div=gn.mul=gn.sub=void 0;var oi=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==ii(t)&&"function"!=typeof t)return{default:t};var n=Yi(void 0);if(n&&n.has(t))return n.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if("default"!==d&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(s,d,f):s[d]=t[d]}return s.default=t,n&&n.set(t,s),s}(be);function Yi(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(Yi=function(s){return s?n:e})(t)}function pr(){var t=new oi.ARRAY_TYPE(4);return oi.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function io(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function ao(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function ro(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function co(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Po(t,e){var n=e[0]-t[0],s=e[1]-t[1],c=e[2]-t[2],d=e[3]-t[3];return n*n+s*s+c*c+d*d}function go(t){return Math.hypot(t[0],t[1],t[2],t[3])}function bo(t){var e=t[0],n=t[1],s=t[2],c=t[3];return e*e+n*n+s*s+c*c}gn.sub=io,gn.mul=ao,gn.div=ro,gn.dist=co,gn.sqrDist=Po,gn.len=go,gn.sqrLen=bo;var t,Bn=(t=pr(),function(e,n,s,c,d,f){var _,x;for(n||(n=4),s||(s=0),x=c?Math.min(c*n+s,e.length):e.length,_=s;_<x;_+=n)t[0]=e[_],t[1]=e[_+1],t[2]=e[_+2],t[3]=e[_+3],d(t,t,f),e[_]=t[0],e[_+1]=t[1],e[_+2]=t[2],e[_+3]=t[3];return e});function Cn(t){return(Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}gn.forEach=Bn,Object.defineProperty(pn,"__esModule",{value:!0}),pn.create=Dn,pn.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},pn.setAxisAngle=ki,pn.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),s=Math.sin(n/2);return s>At.EPSILON?(t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s):(t[0]=1,t[1]=0,t[2]=0),n},pn.getAngle=function(t,e){var n=gt(t,e);return Math.acos(2*n*n-1)},pn.multiply=Fi,pn.rotateX=function(t,e,n){n*=.5;var s=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(n),x=Math.cos(n);return t[0]=s*x+f*_,t[1]=c*x+d*_,t[2]=d*x-c*_,t[3]=f*x-s*_,t},pn.rotateY=function(t,e,n){n*=.5;var s=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(n),x=Math.cos(n);return t[0]=s*x-d*_,t[1]=c*x+f*_,t[2]=d*x+s*_,t[3]=f*x-c*_,t},pn.rotateZ=function(t,e,n){n*=.5;var s=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(n),x=Math.cos(n);return t[0]=s*x+c*_,t[1]=c*x-s*_,t[2]=d*x+f*_,t[3]=f*x-d*_,t},pn.calculateW=function(t,e){var n=e[0],s=e[1],c=e[2];return t[0]=n,t[1]=s,t[2]=c,t[3]=Math.sqrt(Math.abs(1-n*n-s*s-c*c)),t},pn.exp=wt,pn.ln=te,pn.pow=function(t,e,n){return te(t,e),bt(t,t,n),wt(t,t),t},pn.slerp=ue,pn.random=function(t){var e=At.RANDOM(),n=At.RANDOM(),s=At.RANDOM(),c=Math.sqrt(1-e),d=Math.sqrt(e);return t[0]=c*Math.sin(2*Math.PI*n),t[1]=c*Math.cos(2*Math.PI*n),t[2]=d*Math.sin(2*Math.PI*s),t[3]=d*Math.cos(2*Math.PI*s),t},pn.invert=function(t,e){var n=e[0],s=e[1],c=e[2],d=e[3],f=n*n+s*s+c*c+d*d,_=f?1/f:0;return t[0]=-n*_,t[1]=-s*_,t[2]=-c*_,t[3]=d*_,t},pn.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},pn.fromMat3=Ge,pn.fromEuler=function(t,e,n,s){var c=.5*Math.PI/180;e*=c,n*=c,s*=c;var d=Math.sin(e),f=Math.cos(e),_=Math.sin(n),x=Math.cos(n),E=Math.sin(s),D=Math.cos(s);return t[0]=d*x*D-f*_*E,t[1]=f*_*D+d*x*E,t[2]=f*x*E-d*_*D,t[3]=f*x*D+d*_*E,t},pn.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},pn.setAxes=pn.sqlerp=pn.rotationTo=pn.equals=pn.exactEquals=pn.normalize=pn.sqrLen=pn.squaredLength=pn.len=pn.length=pn.lerp=pn.dot=pn.scale=pn.mul=pn.add=pn.set=pn.copy=pn.fromValues=pn.clone=void 0;var At=Ln(be),an=Ln(at),pt=Ln(An),On=Ln(gn);function Ze(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(Ze=function(s){return s?n:e})(t)}function Ln(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Cn(t)&&"function"!=typeof t)return{default:t};var n=Ze(e);if(n&&n.has(t))return n.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if("default"!==d&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(s,d,f):s[d]=t[d]}return s.default=t,n&&n.set(t,s),s}function Dn(){var t=new At.ARRAY_TYPE(4);return At.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function ki(t,e,n){n*=.5;var s=Math.sin(n);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(n),t}function Fi(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3],_=n[0],x=n[1],E=n[2],D=n[3];return t[0]=s*D+f*_+c*E-d*x,t[1]=c*D+f*x+d*_-s*E,t[2]=d*D+f*E+s*x-c*_,t[3]=f*D-s*_-c*x-d*E,t}function wt(t,e){var n=e[0],s=e[1],c=e[2],d=e[3],f=Math.sqrt(n*n+s*s+c*c),_=Math.exp(d),x=f>0?_*Math.sin(f)/f:0;return t[0]=n*x,t[1]=s*x,t[2]=c*x,t[3]=_*Math.cos(f),t}function te(t,e){var n=e[0],s=e[1],c=e[2],d=e[3],f=Math.sqrt(n*n+s*s+c*c),_=f>0?Math.atan2(f,d)/f:0;return t[0]=n*_,t[1]=s*_,t[2]=c*_,t[3]=.5*Math.log(n*n+s*s+c*c+d*d),t}function ue(t,e,n,s){var c,d,f,_,x,E=e[0],D=e[1],S=e[2],P=e[3],F=n[0],z=n[1],$=n[2],H=n[3];return(d=E*F+D*z+S*$+P*H)<0&&(d=-d,F=-F,z=-z,$=-$,H=-H),1-d>At.EPSILON?(c=Math.acos(d),f=Math.sin(c),_=Math.sin((1-s)*c)/f,x=Math.sin(s*c)/f):(_=1-s,x=s),t[0]=_*E+x*F,t[1]=_*D+x*z,t[2]=_*S+x*$,t[3]=_*P+x*H,t}function Ge(t,e){var n,s=e[0]+e[4]+e[8];if(s>0)n=Math.sqrt(s+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var c=0;e[4]>e[0]&&(c=1),e[8]>e[3*c+c]&&(c=2);var d=(c+1)%3,f=(c+2)%3;n=Math.sqrt(e[3*c+c]-e[3*d+d]-e[3*f+f]+1),t[c]=.5*n,t[3]=(e[3*d+f]-e[3*f+d])*(n=.5/n),t[d]=(e[3*d+c]+e[3*c+d])*n,t[f]=(e[3*f+c]+e[3*c+f])*n}return t}pn.clone=On.clone,pn.fromValues=On.fromValues,pn.copy=On.copy,pn.set=On.set,pn.add=On.add,pn.mul=Fi;var bt=On.scale;pn.scale=bt;var gt=On.dot;pn.dot=gt,pn.lerp=On.lerp;var jt=On.length;pn.length=jt,pn.len=jt;var rn=On.squaredLength;pn.squaredLength=rn,pn.sqrLen=rn;var Ft=On.normalize;pn.normalize=Ft,pn.exactEquals=On.exactEquals,pn.equals=On.equals;var on,Un,zn,Ei=(on=pt.create(),Un=pt.fromValues(1,0,0),zn=pt.fromValues(0,1,0),function(t,e,n){var s=pt.dot(e,n);return s<-.999999?(pt.cross(on,Un,e),pt.len(on)<1e-6&&pt.cross(on,zn,e),pt.normalize(on,on),ki(t,on,Math.PI),t):s>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(pt.cross(on,e,n),t[0]=on[0],t[1]=on[1],t[2]=on[2],t[3]=1+s,Ft(t,t))});pn.rotationTo=Ei;var Ui,qi,Ki=(Ui=Dn(),qi=Dn(),function(t,e,n,s,c,d){return ue(Ui,e,c,d),ue(qi,n,s,d),ue(t,Ui,qi,2*d*(1-d)),t});pn.sqlerp=Ki;var Gi,nr=(Gi=an.create(),function(t,e,n,s){return Gi[0]=n[0],Gi[3]=n[1],Gi[6]=n[2],Gi[1]=s[0],Gi[4]=s[1],Gi[7]=s[2],Gi[2]=-e[0],Gi[5]=-e[1],Gi[8]=-e[2],Ft(t,Ge(t,Gi))});pn.setAxes=nr;var lt={};function Be(t){return(Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(lt,"__esModule",{value:!0}),lt.create=function(){var t=new we.ARRAY_TYPE(8);return we.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},lt.clone=function(t){var e=new we.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},lt.fromValues=function(t,e,n,s,c,d,f,_){var x=new we.ARRAY_TYPE(8);return x[0]=t,x[1]=e,x[2]=n,x[3]=s,x[4]=c,x[5]=d,x[6]=f,x[7]=_,x},lt.fromRotationTranslationValues=function(t,e,n,s,c,d,f){var _=new we.ARRAY_TYPE(8);_[0]=t,_[1]=e,_[2]=n,_[3]=s;var x=.5*c,E=.5*d,D=.5*f;return _[4]=x*s+E*n-D*e,_[5]=E*s+D*t-x*n,_[6]=D*s+x*e-E*t,_[7]=-x*t-E*e-D*n,_},lt.fromRotationTranslation=mt,lt.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},lt.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},lt.fromMat4=function(t,e){var n=Fe.create();Gt.getRotation(n,e);var s=new we.ARRAY_TYPE(3);return Gt.getTranslation(s,e),mt(t,n,s),t},lt.copy=Tt,lt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},lt.set=function(t,e,n,s,c,d,f,_,x){return t[0]=e,t[1]=n,t[2]=s,t[3]=c,t[4]=d,t[5]=f,t[6]=_,t[7]=x,t},lt.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},lt.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},lt.getTranslation=function(t,e){var n=e[4],s=e[5],c=e[6],d=e[7],f=-e[0],_=-e[1],x=-e[2],E=e[3];return t[0]=2*(n*E+d*f+s*x-c*_),t[1]=2*(s*E+d*_+c*f-n*x),t[2]=2*(c*E+d*x+n*_-s*f),t},lt.translate=function(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3],_=.5*n[0],x=.5*n[1],E=.5*n[2],D=e[4],S=e[5],P=e[6],F=e[7];return t[0]=s,t[1]=c,t[2]=d,t[3]=f,t[4]=f*_+c*E-d*x+D,t[5]=f*x+d*_-s*E+S,t[6]=f*E+s*x-c*_+P,t[7]=-s*_-c*x-d*E+F,t},lt.rotateX=function(t,e,n){var s=-e[0],c=-e[1],d=-e[2],f=e[3],_=e[4],x=e[5],E=e[6],D=e[7],S=_*f+D*s+x*d-E*c,P=x*f+D*c+E*s-_*d,F=E*f+D*d+_*c-x*s,z=D*f-_*s-x*c-E*d;return Fe.rotateX(t,e,n),t[4]=S*(f=t[3])+z*(s=t[0])+P*(d=t[2])-F*(c=t[1]),t[5]=P*f+z*c+F*s-S*d,t[6]=F*f+z*d+S*c-P*s,t[7]=z*f-S*s-P*c-F*d,t},lt.rotateY=function(t,e,n){var s=-e[0],c=-e[1],d=-e[2],f=e[3],_=e[4],x=e[5],E=e[6],D=e[7],S=_*f+D*s+x*d-E*c,P=x*f+D*c+E*s-_*d,F=E*f+D*d+_*c-x*s,z=D*f-_*s-x*c-E*d;return Fe.rotateY(t,e,n),t[4]=S*(f=t[3])+z*(s=t[0])+P*(d=t[2])-F*(c=t[1]),t[5]=P*f+z*c+F*s-S*d,t[6]=F*f+z*d+S*c-P*s,t[7]=z*f-S*s-P*c-F*d,t},lt.rotateZ=function(t,e,n){var s=-e[0],c=-e[1],d=-e[2],f=e[3],_=e[4],x=e[5],E=e[6],D=e[7],S=_*f+D*s+x*d-E*c,P=x*f+D*c+E*s-_*d,F=E*f+D*d+_*c-x*s,z=D*f-_*s-x*c-E*d;return Fe.rotateZ(t,e,n),t[4]=S*(f=t[3])+z*(s=t[0])+P*(d=t[2])-F*(c=t[1]),t[5]=P*f+z*c+F*s-S*d,t[6]=F*f+z*d+S*c-P*s,t[7]=z*f-S*s-P*c-F*d,t},lt.rotateByQuatAppend=function(t,e,n){var s=n[0],c=n[1],d=n[2],f=n[3],_=e[0],x=e[1],E=e[2],D=e[3];return t[0]=_*f+D*s+x*d-E*c,t[1]=x*f+D*c+E*s-_*d,t[2]=E*f+D*d+_*c-x*s,t[3]=D*f-_*s-x*c-E*d,t[4]=(_=e[4])*f+(D=e[7])*s+(x=e[5])*d-(E=e[6])*c,t[5]=x*f+D*c+E*s-_*d,t[6]=E*f+D*d+_*c-x*s,t[7]=D*f-_*s-x*c-E*d,t},lt.rotateByQuatPrepend=function(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3],_=n[0],x=n[1],E=n[2],D=n[3];return t[0]=s*D+f*_+c*E-d*x,t[1]=c*D+f*x+d*_-s*E,t[2]=d*D+f*E+s*x-c*_,t[3]=f*D-s*_-c*x-d*E,t[4]=s*(D=n[7])+f*(_=n[4])+c*(E=n[6])-d*(x=n[5]),t[5]=c*D+f*x+d*_-s*E,t[6]=d*D+f*E+s*x-c*_,t[7]=f*D-s*_-c*x-d*E,t},lt.rotateAroundAxis=function(t,e,n,s){if(Math.abs(s)<we.EPSILON)return Tt(t,e);var c=Math.hypot(n[0],n[1],n[2]);s*=.5;var d=Math.sin(s),f=d*n[0]/c,_=d*n[1]/c,x=d*n[2]/c,E=Math.cos(s),D=e[0],S=e[1],P=e[2],F=e[3];t[0]=D*E+F*f+S*x-P*_,t[1]=S*E+F*_+P*f-D*x,t[2]=P*E+F*x+D*_-S*f,t[3]=F*E-D*f-S*_-P*x;var z=e[4],$=e[5],H=e[6],ee=e[7];return t[4]=z*E+ee*f+$*x-H*_,t[5]=$*E+ee*_+H*f-z*x,t[6]=H*E+ee*x+z*_-$*f,t[7]=ee*E-z*f-$*_-H*x,t},lt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},lt.multiply=En,lt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},lt.lerp=function(t,e,n,s){var c=1-s;return si(e,n)<0&&(s=-s),t[0]=e[0]*c+n[0]*s,t[1]=e[1]*c+n[1]*s,t[2]=e[2]*c+n[2]*s,t[3]=e[3]*c+n[3]*s,t[4]=e[4]*c+n[4]*s,t[5]=e[5]*c+n[5]*s,t[6]=e[6]*c+n[6]*s,t[7]=e[7]*c+n[7]*s,t},lt.invert=function(t,e){var n=Ri(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},lt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},lt.normalize=function(t,e){var n=Ri(e);if(n>0){n=Math.sqrt(n);var s=e[0]/n,c=e[1]/n,d=e[2]/n,f=e[3]/n,_=e[4],x=e[5],E=e[6],D=e[7],S=s*_+c*x+d*E+f*D;t[0]=s,t[1]=c,t[2]=d,t[3]=f,t[4]=(_-s*S)/n,t[5]=(x-c*S)/n,t[6]=(E-d*S)/n,t[7]=(D-f*S)/n}return t},lt.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},lt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},lt.equals=function(t,e){var n=t[0],s=t[1],c=t[2],d=t[3],f=t[4],_=t[5],x=t[6],E=t[7],D=e[0],S=e[1],P=e[2],F=e[3],z=e[4],$=e[5],H=e[6],ee=e[7];return Math.abs(n-D)<=we.EPSILON*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(s-S)<=we.EPSILON*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(c-P)<=we.EPSILON*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(d-F)<=we.EPSILON*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(f-z)<=we.EPSILON*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(_-$)<=we.EPSILON*Math.max(1,Math.abs(_),Math.abs($))&&Math.abs(x-H)<=we.EPSILON*Math.max(1,Math.abs(x),Math.abs(H))&&Math.abs(E-ee)<=we.EPSILON*Math.max(1,Math.abs(E),Math.abs(ee))},lt.sqrLen=lt.squaredLength=lt.len=lt.length=lt.dot=lt.mul=lt.setReal=lt.getReal=void 0;var we=Ie(be),Fe=Ie(pn),Gt=Ie(Re);function vn(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(vn=function(s){return s?n:e})(t)}function Ie(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Be(t)&&"function"!=typeof t)return{default:t};var n=vn(e);if(n&&n.has(t))return n.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if("default"!==d&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(s,d,f):s[d]=t[d]}return s.default=t,n&&n.set(t,s),s}function mt(t,e,n){var s=.5*n[0],c=.5*n[1],d=.5*n[2],f=e[0],_=e[1],x=e[2],E=e[3];return t[0]=f,t[1]=_,t[2]=x,t[3]=E,t[4]=s*E+c*x-d*_,t[5]=c*E+d*f-s*x,t[6]=d*E+s*_-c*f,t[7]=-s*f-c*_-d*x,t}function Tt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function En(t,e,n){var s=e[0],c=e[1],d=e[2],f=e[3],_=n[4],x=n[5],E=n[6],D=n[7],S=e[4],P=e[5],F=e[6],z=e[7],$=n[0],H=n[1],ee=n[2],Pe=n[3];return t[0]=s*Pe+f*$+c*ee-d*H,t[1]=c*Pe+f*H+d*$-s*ee,t[2]=d*Pe+f*ee+s*H-c*$,t[3]=f*Pe-s*$-c*H-d*ee,t[4]=s*D+f*_+c*E-d*x+S*Pe+z*$+P*ee-F*H,t[5]=c*D+f*x+d*_-s*E+P*Pe+z*H+F*$-S*ee,t[6]=d*D+f*E+s*x-c*_+F*Pe+z*ee+S*H-P*$,t[7]=f*D-s*_-c*x-d*E+z*Pe-S*$-P*H-F*ee,t}lt.getReal=Fe.copy,lt.setReal=Fe.copy,lt.mul=En;var si=Fe.dot;lt.dot=si;var Ai=Fe.length;lt.length=Ai,lt.len=Ai;var Ri=Fe.squaredLength;lt.squaredLength=Ri,lt.sqrLen=Ri;var pi={};function Ti(t){return(Ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(pi,"__esModule",{value:!0}),pi.create=gr,pi.clone=function(t){var e=new vr.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},pi.fromValues=function(t,e){var n=new vr.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},pi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},pi.set=function(t,e,n){return t[0]=e,t[1]=n,t},pi.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},pi.subtract=Nr,pi.multiply=_o,pi.divide=yo,pi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},pi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},pi.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},pi.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},pi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},pi.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},pi.scaleAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t},pi.distance=Vr,pi.squaredDistance=uo,pi.length=ko,pi.squaredLength=Ls,pi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},pi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},pi.normalize=function(t,e){var n=e[0],s=e[1],c=n*n+s*s;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t},pi.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},pi.cross=function(t,e,n){var s=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=s,t},pi.lerp=function(t,e,n,s){var c=e[0],d=e[1];return t[0]=c+s*(n[0]-c),t[1]=d+s*(n[1]-d),t},pi.random=function(t,e){e=e||1;var n=2*vr.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},pi.transformMat2=function(t,e,n){var s=e[0],c=e[1];return t[0]=n[0]*s+n[2]*c,t[1]=n[1]*s+n[3]*c,t},pi.transformMat2d=function(t,e,n){var s=e[0],c=e[1];return t[0]=n[0]*s+n[2]*c+n[4],t[1]=n[1]*s+n[3]*c+n[5],t},pi.transformMat3=function(t,e,n){var s=e[0],c=e[1];return t[0]=n[0]*s+n[3]*c+n[6],t[1]=n[1]*s+n[4]*c+n[7],t},pi.transformMat4=function(t,e,n){var s=e[0],c=e[1];return t[0]=n[0]*s+n[4]*c+n[12],t[1]=n[1]*s+n[5]*c+n[13],t},pi.rotate=function(t,e,n,s){var c=e[0]-n[0],d=e[1]-n[1],f=Math.sin(s),_=Math.cos(s);return t[0]=c*_-d*f+n[0],t[1]=c*f+d*_+n[1],t},pi.angle=function(t,e){var n=t[0],s=t[1],c=e[0],d=e[1],f=Math.sqrt(n*n+s*s)*Math.sqrt(c*c+d*d);return Math.acos(Math.min(Math.max(f&&(n*c+s*d)/f,-1),1))},pi.zero=function(t){return t[0]=0,t[1]=0,t},pi.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},pi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},pi.equals=function(t,e){var n=t[0],s=t[1],c=e[0],d=e[1];return Math.abs(n-c)<=vr.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-d)<=vr.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))},pi.forEach=pi.sqrLen=pi.sqrDist=pi.dist=pi.div=pi.mul=pi.sub=pi.len=void 0;var vr=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Ti(t)&&"function"!=typeof t)return{default:t};var n=Io(void 0);if(n&&n.has(t))return n.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if("default"!==d&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(s,d,f):s[d]=t[d]}return s.default=t,n&&n.set(t,s),s}(be);function Io(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(Io=function(s){return s?n:e})(t)}function gr(){var t=new vr.ARRAY_TYPE(2);return vr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Nr(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function _o(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function yo(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function Vr(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function uo(t,e){var n=e[0]-t[0],s=e[1]-t[1];return n*n+s*s}function ko(t){return Math.hypot(t[0],t[1])}function Ls(t){var e=t[0],n=t[1];return e*e+n*n}pi.len=ko,pi.sub=Nr,pi.mul=_o,pi.div=yo,pi.dist=Vr,pi.sqrDist=uo,pi.sqrLen=Ls;var Gr=function(){var t=gr();return function(e,n,s,c,d,f){var _,x;for(n||(n=2),s||(s=0),x=c?Math.min(c*n+s,e.length):e.length,_=s;_<x;_+=n)t[0]=e[_],t[1]=e[_+1],d(t,t,f),e[_]=t[0],e[_+1]=t[1];return e}}();function xs(t){return(xs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}pi.forEach=Gr,Object.defineProperty(He,"__esModule",{value:!0}),a.aA=He.vec4=a._=He.vec3=He.vec2=He.quat2=a.av=He.quat=a.ad=He.mat4=a.bC=He.mat3=He.mat2d=a.aC=He.mat2=He.glMatrix=void 0;var Qs=Vs(be);He.glMatrix=Qs;var Ss=Vs(Ue);a.aC=He.mat2=Ss;var Sa=Vs($e);He.mat2d=Sa;var ma=Vs(at);a.bC=He.mat3=ma;var Fl=Vs(Re);a.ad=He.mat4=Fl;var ks=Vs(pn);a.av=He.quat=ks;var xr=Vs(lt);He.quat2=xr;var Nl=Vs(pi);He.vec2=Nl;var ol=Vs(An);a._=He.vec3=ol;var Wa=Vs(gn);function bl(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(bl=function(s){return s?n:e})(t)}function Vs(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==xs(t)&&"function"!=typeof t)return{default:t};var n=bl(e);if(n&&n.has(t))return n.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if("default"!==d&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(s,d,f):s[d]=t[d]}return s.default=t,n&&n.set(t,s),s}a.aA=He.vec4=Wa;var sl=pe;function pe(t,e,n,s){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=s}pe.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,s=0;s<8;s++){var c=this.sampleCurveX(n)-t;if(Math.abs(c)<e)return n;var d=this.sampleCurveDerivativeX(n);if(Math.abs(d)<1e-6)break;n-=c/d}var f=0,_=1;for(n=t,s=0;s<20&&(c=this.sampleCurveX(n),!(Math.abs(c-t)<e));s++)t>c?f=n:_=n,n=.5*(_-f)+f;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var kr=ht(sl),Te=Y;function Y(t,e){this.x=t,this.y=e}Y.prototype={clone:function(){return new Y(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(t,e){var n=Math.cos(t),s=Math.sin(t),c=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Y.convert=function(t){return t instanceof Y?t:Array.isArray(t)?new Y(t[0],t[1]):t};var Ae=ht(Te);const jr=Math.PI/180,ho=180/Math.PI;function Zi(t){return t*jr}function Ro(t){return t*ho}const he=[[0,0],[1,0],[1,1],[0,1]];function qe(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Pt(t,e,n,s){const c=new kr(t,e,n,s);return function(d){return c.solve(d)}}const Ht=Pt(.25,.1,.25,1);function Ut(t,e,n){return Math.min(n,Math.max(e,t))}function ln(t,e,n){return(n=Ut((n-t)/(e-t),0,1))*n*(3-2*n)}function qn(t,e,n){const s=n-e,c=((t-e)%s+s)%s+e;return c===e?n:c}function ti(t,e,n){if(!t.length)return n(null,[]);let s=t.length;const c=new Array(t.length);let d=null;t.forEach((f,_)=>{e(f,(x,E)=>{x&&(d=x),c[_]=E,0==--s&&n(d,c)})})}function mi(t){const e=[];for(const n in t)e.push(t[n]);return e}function ai(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}let Hi=1;function Vi(){return Hi++}function er(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function ur(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function To(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Fo(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function wo(t,e){return-1!==t.indexOf(e,t.length-e.length)}function Di(t,e,n){const s={};for(const c in t)s[c]=e.call(this,t[c],c,t);return s}function Oo(t,e,n){const s={};for(const c in t)e.call(this,t[c],c,t)&&(s[c]=t[c]);return s}function eo(t){return Array.isArray(t)?t.map(eo):"object"==typeof t&&t?Di(t,eo):t}const ga={};function Do(t){ga[t]||(typeof console<"u"&&console.warn(t),ga[t]=!0)}function Wr(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function ea(t){let e=0;for(let n,s,c=0,d=t.length,f=d-1;c<d;f=c++)n=t[c],s=t[f],e+=(s.x-n.x)*(n.y+s.y);return e}function Zo([t,e,n]){const s=Zi(e+90),c=Zi(n);return{x:t*Math.cos(s)*Math.sin(c),y:t*Math.sin(s)*Math.sin(c),z:t*Math.cos(c),azimuthal:e,polar:n}}function Fs(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function _a(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,c,d)=>{const f=c||d;return e[s]=!f||f.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Xa,Aa,Ka,Ns,Za,jo,qa=null;function ku(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function fo(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Fu(t,e,n,s){for(;e<n;){const c=e+n>>1;t[c]<s?e=c+1:n=c}return e}function ss(t,e,n,s){for(;e<n;){const c=e+n>>1;t[c]<=s?e=c+1:n=c}return e}function al(t){return t>0?1/(1.001-t):1+t}function Bl(t){return t>0?1-1/(1.001-t):-t}function rc(){return null==Xa&&(Xa=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),Xa}const Vo={now:()=>void 0!==Ns?Ns:performance.now(),setNow(t){Ns=t},restoreNow(){Ns=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:s}=t;Za||(Za=document.createElement("canvas"));const c=Za.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(n>Za.width||s>Za.height)&&(Za.width=n,Za.height=s),c.clearRect(-e,-e,n+2*e,s+2*e),c.drawImage(t,0,0,n,s),c.getImageData(-e,-e,n+2*e,s+2*e)},resolveURL:t=>(Aa||(Aa=document.createElement("a")),Aa.href=t,Aa.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==Ka&&(Ka=window.matchMedia("(prefers-reduced-motion: reduce)")),Ka.matches)},hasCanvasFingerprintNoise(){if(void 0!==jo)return jo;if(!rc())return jo=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let n=0;for(let c=0;c<t.width;++c)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(c,0,1,1);const s=e.getImageData(0,0,t.width,t.height);n=0;for(let c=0;c<s.data.length;++c)if(c%4!=3&&n++!==s.data[c])return jo=!0,!0;return jo=!1,!1}};function br(t,e){const n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(t.slice(n));for(const c in e)s.set(c,e[c]);return`${t.slice(0,n)}?${s.toString()}`}function oc(t,e={persistentParams:[]}){const n=t.indexOf("?");if(n<0)return t;const s=new URLSearchParams,c=new URLSearchParams(t.slice(n));for(const f of e.persistentParams){const _=c.get(f);_&&s.set(f,_)}const d=s.toString();return`${t.slice(0,n)}${d.length>0?`?${d}`:""}`}const Bs="mapbox-tiles";let wl,ta,zl=500,Ul=50;function Nu(){try{return caches}catch{}}function se(){const t=Nu();t&&!wl&&(wl=t.open(Bs))}let ye=1/0;const q={supported:!1,testSupport:function(t){!sr&&qt&&(Zr?_r(t):rt=t)}};let rt,qt,sr=!1,Zr=!1;const as=typeof self<"u"?self:{};function _r(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,qt),t.isContextLost())return;q.supported=!0}catch{}t.deleteTexture(e),sr=!0}as.document&&(qt=as.document.createElement("img"),qt.onload=function(){rt&&_r(rt),rt=null,Zr=!0},qt.onerror=function(){sr=!0,rt=null},qt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const sc={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(sc);class Sd extends Error{constructor(e,n,s){401===n&&Ce(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const _h=Fs()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Dc=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(_h())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,c){const d=new AbortController,f=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:_h(),referrerPolicy:s.referrerPolicy,signal:d.signal});let _=!1,x=!1;const E=(D=f.url).indexOf("sku=")>0&&Ce(D);var D;"json"===s.type&&f.headers.set("Accept","application/json");const S=(F,z,$)=>{if(x)return;if(F&&"SecurityError"!==F.message&&Do(F.toString()),z&&$)return P(z);const H=Date.now();fetch(f).then(ee=>{if(ee.ok){const Pe=E?ee.clone():null;return P(ee,Pe,H)}return c(new Sd(ee.statusText,ee.status,s.url))}).catch(ee=>{"AbortError"!==ee.name&&c(new Error(`${ee.message} ${s.url}`))})},P=(F,z,$)=>{("arrayBuffer"===s.type?F.arrayBuffer():"json"===s.type?F.json():F.text()).then(H=>{x||(z&&$&&function(ee,Pe,Oe){if(se(),!wl)return;const ke=_a(Pe.headers.get("Cache-Control")||"");if(ke["no-store"])return;const dt={status:Pe.status,statusText:Pe.statusText,headers:new Headers};Pe.headers.forEach((kt,Yt)=>dt.headers.set(Yt,kt)),ke["max-age"]&&dt.headers.set("Expires",new Date(Oe+1e3*ke["max-age"]).toUTCString());const st=dt.headers.get("Expires");if(!st||new Date(st).getTime()-Oe<42e4)return;let Dt=oc(ee.url,{persistentParams:["language","worldview"]});if(206===Pe.status){const kt=ee.headers.get("Range");if(!kt)return;dt.status=200,Dt=br(Dt,{range:kt})}!function(kt,Yt){if(void 0===ta)try{new Response(new ReadableStream),ta=!0}catch{ta=!1}ta?Yt(kt.body):kt.blob().then(Yt)}(Pe,kt=>{const Yt=new Response(200!==(yn=Pe.status)&&404!==yn&&[101,103,204,205,304].includes(yn)?null:kt,dt);var yn;se(),wl&&wl.then(dn=>dn.put(Dt,Yt)).catch(dn=>Do(dn.message))})}(f,z,$),_=!0,c(null,H,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(H=>{x||c(new Error(H.message))})};return E?function(F,z){if(se(),!wl)return z(null);wl.then($=>{let H=oc(F.url,{persistentParams:["language","worldview"]});const ee=F.headers.get("Range");ee&&(H=br(H,{range:ee})),$.match(H).then(Pe=>{const Oe=function(ke){if(!ke)return!1;const dt=new Date(ke.headers.get("Expires")||0),st=_a(ke.headers.get("Cache-Control")||"");return dt>Date.now()&&!st["no-cache"]}(Pe);$.delete(H),Oe&&$.put(H,Pe.clone()),z(null,Pe,Oe)}).catch(z)}).catch(z)}(f,S):S(null,null),{cancel:()=>{x=!0,_||d.abort()}}}(t,e);if(Fs()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(s,c){const d=new XMLHttpRequest;d.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(d.responseType="arraybuffer");for(const f in s.headers)d.setRequestHeader(f,s.headers[f]);return"json"===s.type&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials="include"===s.credentials,d.onerror=()=>{c(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||0===d.status)&&null!==d.response){let f=d.response;if("json"===s.type)try{f=JSON.parse(d.response)}catch(_){return c(_)}c(null,f,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else c(new Sd(d.statusText,d.status,s.url))},d.send(s.body),{cancel:()=>d.abort()}}(t,e)},jl=function(t,e){return Dc(ai(t,{type:"arrayBuffer"}),e)};function zo(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const nu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ya,va;ya=[],va=0;const iu=function(t,e){if(q.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),va>=T.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ya.push(d),d}va++;let n=!1;const s=()=>{if(!n)for(n=!0,va--;ya.length&&va<T.MAX_PARALLEL_IMAGE_REQUESTS;){const d=ya.shift(),{requestParameters:f,callback:_,cancelled:x}=d;x||(d.cancel=iu(f,_).cancel)}},c=jl(t,(d,f,_,x)=>{s(),d?e(d):f&&(self.createImageBitmap?function(E,D){const S=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(S).then(P=>{D(null,P)}).catch(P=>{D(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(E,D)=>e(E,D,_,x)):function(E,D){const S=new Image;S.onload=()=>{D(null,S),URL.revokeObjectURL(S.src),S.onload=null,requestAnimationFrame(()=>{S.src=nu})},S.onerror=()=>D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(E)],{type:"image/png"});S.src=E.byteLength?URL.createObjectURL(P):nu}(f,(E,D)=>e(E,D,_,x)))});return{cancel:()=>{c.cancel(),s()}}},El="01",ll="NO_ACCESS_TOKEN",Bu=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function aa(t){const e=t.match(Bu);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Cl(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Mc="mapbox.eventData";function Sc(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Sr{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=Sc(T.ACCESS_TOKEN);let s="";return s=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,d)=>String.fromCharCode(+("0x"+d)))):T.ACCESS_TOKEN||"",e?`${Mc}.${e}:${s}`:`${Mc}:${s}`}fetchEventData(){const e=ku("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const c=localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));const d=localStorage.getItem(s);d&&(this.anonId=d)}catch{Do("Unable to read from LocalStorage")}}saveEventData(){const e=ku("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid"),c=this.anonId;if(e&&c)try{localStorage.setItem(s,c),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Do("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,s,c){if(!T.EVENTS_URL)return;const d=aa(T.EVENTS_URL);d.params.push(`access_token=${c||T.ACCESS_TOKEN||""}`);const f={event:this.type,created:new Date(e).toISOString()},_=n?ai(f,n):f,x={url:Cl(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};var D;this.pendingRequest=(D=E=>{this.pendingRequest=null,s(E),this.saveEventData(),this.processRequests(c)},Dc(ai(x,{method:"POST"}),D))}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const Il=new class extends Sr{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){T.EVENTS_URL&&T.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>De(n)||Ce(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Sc(T.ACCESS_TOKEN),n=e?e.u:T.ACCESS_TOKEN;let s=n!==this.eventData.tokenU;To(this.anonId)||(this.anonId=er(),s=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),f=new Date(c),_=(c-this.eventData.lastSuccess)/864e5;s=s||_>=1||_<-1||d.getDate()!==f.getDate()}else s=!0;s?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Z,skuId:El,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},t):this.processRequests()}},ac=Il.postTurnstileEvent.bind(Il),Pa=new class extends Sr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,s){this.skuToken=e,this.errorCb=s,T.EVENTS_URL&&(n||T.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(ll)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),To(this.anonId)||(this.anonId=er()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Z,skuId:El,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},Ad=Pa.postMapLoadEvent.bind(Pa),yh=new class extends Sr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=er(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){const e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){const{map:n,style:s,importedStyles:c}=e;if(!T.EVENTS_URL||!t&&!T.ACCESS_TOKEN)return;const d=this.getMapInstanceId(n),f={mapInstanceId:d,eventId:this.getEventId(d),style:s};c.length&&(f.importedStyles=c),this.queueRequest({timestamp:Date.now(),payload:f},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},t)}},ru=yh.postStyleLoadEvent.bind(yh),gf=new class extends Sr{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){T.EVENTS_URL&&(t||T.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:n}=this.queue.shift(),s=function(c){const d=performance.getEntriesByType("resource"),f=performance.getEntriesByType("mark"),_=function(F){const z={};if(F)for(const $ in F)if("other"!==$)for(const H of F[$]){const ee=`${$}ResolveRangeMin`,Pe=`${$}ResolveRangeMax`,Oe=`${$}RequestCount`,ke=`${$}RequestCachedCount`;z[ee]=Math.min(z[ee]||1/0,H.startTime),z[Pe]=Math.max(z[Pe]||-1/0,H.responseEnd);const dt=st=>{void 0===z[st]&&(z[st]=0),++z[st]};void 0!==H.transferSize&&0===H.transferSize&&dt(ke),dt(Oe)}return z}(function(F,z){const $={};if(F)for(const H of F){const ee=z(H);void 0===$[ee]&&($[ee]=[]),$[ee].push(H)}return $}(d,Ne)),x=window.devicePixelRatio,E=navigator.connection||navigator.mozConnection||navigator.webkitConnection,D=E?E.effectiveType:void 0,S={counters:[],metadata:[],attributes:[]},P=(F,z,$)=>{null!=$&&F.push({name:z,value:$.toString()})};for(const F in _)P(S.counters,F,_[F]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(P(S.counters,"interactionRangeMin",c.interactionRange[0]),P(S.counters,"interactionRangeMax",c.interactionRange[1])),f)for(const F of Object.keys(je)){const z=je[F],$=f.find(H=>H.name===z);$&&P(S.counters,z,$.startTime)}return P(S.counters,"visibilityHidden",c.visibilityHidden),P(S.attributes,"style",function(F){if(F)for(const z of F){const $=z.name.split("?")[0];if(ze($)){const H=$.split("/").slice(-2);if(2===H.length)return`mapbox://styles/${H[0]}/${H[1]}`}}}(d)),P(S.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),P(S.attributes,"fogEnabled",c.fogEnabled?"true":"false"),P(S.attributes,"projection",c.projection),P(S.attributes,"zoom",c.zoom),P(S.metadata,"devicePixelRatio",x),P(S.metadata,"connectionEffectiveType",D),P(S.metadata,"navigatorUserAgent",navigator.userAgent),P(S.metadata,"screenWidth",window.screen.width),P(S.metadata,"screenHeight",window.screen.height),P(S.metadata,"windowWidth",window.innerWidth),P(S.metadata,"windowHeight",window.innerHeight),P(S.metadata,"mapWidth",c.width/x),P(S.metadata,"mapHeight",c.height/x),P(S.metadata,"webglRenderer",c.renderer),P(S.metadata,"webglVendor",c.vendor),P(S.metadata,"sdkVersion",Z),P(S.metadata,"sdkIdentifier","mapbox-gl-js"),S}(n);for(const c of s.metadata);for(const c of s.counters);for(const c of s.attributes);this.postEvent(e,s,()=>{},t)}},Ac=gf.postPerformanceEvent.bind(gf),ou=new class extends Sr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,s){if(!T.API_URL||!T.SESSION_PATH)return;const c=aa(T.API_URL+T.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${s||T.ACCESS_TOKEN||""}`);const d={url:Cl(c),headers:{"Content-Type":"text/plain"}};var _;this.pendingRequest=(_=f=>{this.pendingRequest=null,n(f),this.saveEventData(),this.processRequests(s)},Dc(ai(d,{method:"GET"}),_))}getSessionAPI(t,e,n,s){this.skuToken=e,this.errorCb=s,T.SESSION_PATH&&T.API_URL&&(n||T.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(ll)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},_f=ou.getSessionAPI.bind(ou),Tl=new Set;var cl={exports:{}},su=function(t,e){var n,s,c,d,f,_,x,E;for(s=t.length-(n=3&t.length),c=e,f=3432918353,_=461845907,E=0;E<s;)x=255&t.charCodeAt(E)|(255&t.charCodeAt(++E))<<8|(255&t.charCodeAt(++E))<<16|(255&t.charCodeAt(++E))<<24,++E,c=27492+(65535&(d=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*f+(((x>>>16)*f&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&t.charCodeAt(E+2))<<16;case 2:x^=(255&t.charCodeAt(E+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&t.charCodeAt(E)))*f+(((x>>>16)*f&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295}return c^=t.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0},Ra=function(t,e){for(var n,s=t.length,c=e^s,d=0;s>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(d)|(255&t.charCodeAt(++d))<<8|(255&t.charCodeAt(++d))<<16|(255&t.charCodeAt(++d))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++d;switch(s){case 3:c^=(255&t.charCodeAt(d+2))<<16;case 2:c^=(255&t.charCodeAt(d+1))<<8;case 1:c=1540483477*(65535&(c^=255&t.charCodeAt(d)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};cl.exports=su,cl.exports.murmur3=su,cl.exports.murmur2=Ra;var ul=ht(cl.exports);class la{constructor(e,...n){ai(this,n[0]||{}),this.type=e}}class wr extends la{constructor(e,n={}){super("error",ai({error:e},n))}}function So(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function vh(t,e,n){if(n&&n[t]){const s=n[t].indexOf(e);-1!==s&&n[t].splice(s,1)}}class lc{on(e,n){return this._listeners=this._listeners||{},So(e,n,this._listeners),this}off(e,n){return vh(e,n,this._listeners),vh(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},So(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){const s="string"==typeof e?new la(e,n):e,c=s.type;if(this.listens(c)){s.target=this;const d=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of d)x.call(this,s);const f=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of f)vh(c,x,this._oneTimeListeners),x.call(this,s);const _=this._eventedParent;_&&(ai(s,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(s))}else s instanceof wr&&console.error(s.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}a.F=void 0;var Pd={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Rd(t){return(t=Math.round(t))<0?0:t>255?255:t}function ju(t){return Rd("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function Vl(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function qr(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{a.F={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Pd)return Pd[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=n.indexOf("("),c=n.indexOf(")");if(-1!==s&&c+1===n.length){var d=n.substr(0,s),f=n.substr(s+1,c-(s+1)).split(","),_=1;switch(d){case"rgba":if(4!==f.length)return null;_=Vl(f.pop());case"rgb":return 3!==f.length?null:[ju(f[0]),ju(f[1]),ju(f[2]),_];case"hsla":if(4!==f.length)return null;_=Vl(f.pop());case"hsl":if(3!==f.length)return null;var x=(parseFloat(f[0])%360+360)%360/360,E=Vl(f[1]),D=Vl(f[2]),S=D<=.5?D*(E+1):D+E-D*E,P=2*D-S;return[Rd(255*qr(P,S,x+1/3)),Rd(255*qr(P,S,x)),Rd(255*qr(P,S,x-1/3)),_];default:return null}}return null}}catch{}class Br{constructor(e,n,s,c=1){this.r=e,this.g=n,this.b=s,this.a=c}static parse(e){if(!e)return;if(e instanceof Br)return e;if("string"!=typeof e)return;const n=a.F(e);return n?new Br(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,s,c]=0===this.a?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${c})`}toRenderColor(e){const{r:n,g:s,b:c,a:d}=this;return new xh(e,n,s,c,d)}}class xh{constructor(e,n,s,c,d){if(e){const f=e.image.height,_=f*f;n=0===d?0:n/d*(f-1),s=0===d?0:s/d*(f-1),c=0===d?0:c/d*(f-1);const x=Math.floor(n),E=Math.floor(s),D=Math.floor(c),S=Math.ceil(n),P=Math.ceil(s),F=Math.ceil(c),z=n-x,$=s-E,H=c-D,ee=e.image.data,Pe=4*(x+E*_+D*f),Oe=4*(x+E*_+F*f),ke=4*(x+P*_+D*f),dt=4*(x+P*_+F*f),st=4*(S+E*_+D*f),Dt=4*(S+E*_+F*f),kt=4*(S+P*_+D*f),Yt=4*(S+P*_+F*f);if(Pe<0||Yt>=ee.length)throw new Error("out of range");this.r=zi(zi(zi(ee[Pe],ee[Oe],H),zi(ee[ke],ee[dt],H),$),zi(zi(ee[st],ee[Dt],H),zi(ee[kt],ee[Yt],H),$),z)/255*d,this.g=zi(zi(zi(ee[Pe+1],ee[Oe+1],H),zi(ee[ke+1],ee[dt+1],H),$),zi(zi(ee[st+1],ee[Dt+1],H),zi(ee[kt+1],ee[Yt+1],H),$),z)/255*d,this.b=zi(zi(zi(ee[Pe+2],ee[Oe+2],H),zi(ee[ke+2],ee[dt+2],H),$),zi(zi(ee[st+2],ee[Dt+2],H),zi(ee[kt+2],ee[Yt+2],H),$),z)/255*d,this.a=d}else this.r=n,this.g=s,this.b=c,this.a=d}toArray(){const{r:e,g:n,b:s,a:c}=this;return 0===c?[0,0,0,0]:[255*e/c,255*n/c,255*s/c,c]}toArray01(){const{r:e,g:n,b:s,a:c}=this;return 0===c?[0,0,0,0]:[e/c,n/c,s/c,c]}toArray01Scaled(e){const{r:n,g:s,b:c,a:d}=this;return 0===d?[0,0,0]:[n/d*e,s/d*e,c/d*e]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:s,a:c}=this;return[e,n,s,c]}toArray01Linear(){const{r:e,g:n,b:s,a:c}=this;return 0===c?[0,0,0,0]:[Math.pow(e/c,2.2),Math.pow(n/c,2.2),Math.pow(s/c,2.2),c]}}function zi(t,e,n){return t*(1-n)+e*n}function cc(t,e,n){return t.map((s,c)=>zi(s,e[c],n))}Br.black=new Br(0,0,0,1),Br.white=new Br(1,1,1,1),Br.transparent=new Br(0,0,0,0),Br.red=new Br(1,0,0,1),Br.blue=new Br(0,0,1,1);var au=Object.freeze({__proto__:null,array:cc,color:function(t,e,n){return new Br(zi(t.r,e.r,n),zi(t.g,e.g,n),zi(t.b,e.b,n),zi(t.a,e.a,n))},number:zi});function Ya(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}class $s extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class lu{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,c]of n)this.bindings[s]=c}concat(e){return new lu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const V={kind:"null"},oe={kind:"number"},K={kind:"string"},ae={kind:"boolean"},Ot={kind:"color"},Nn={kind:"object"},kn={kind:"value"},Xi={kind:"collator"},vo={kind:"formatted"},Ar={kind:"resolvedImage"};function Xr(t,e){return{kind:"array",itemType:t,N:e}}function gi(t){if("array"===t.kind){const e=gi(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const qo=[V,oe,K,ae,Ot,vo,Nn,Xr(kn),Ar];function Eo(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Eo(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const n of qo)if(!Eo(n,e))return null}return`Expected ${gi(t)} but found ${gi(e)} instead.`}function Go(t,e){return e.some(n=>n.kind===t.kind)}function na(t,e){return e.some(n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t)}class Is{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Oa{constructor(e,n,s,c,d){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=s,this.fontStack=c,this.textColor=d}}class Yo{constructor(e){this.sections=e}static fromString(e){return new Yo([new Oa(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length)}static factory(e){return e instanceof Yo?e:Yo.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);const s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(s)}return e}}class ds{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new ds({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Ds(t,e,n,s){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[t,e,n,s]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ts(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Br||t instanceof Is||t instanceof Yo||t instanceof ds)return!0;if(Array.isArray(t)){for(const e of t)if(!ts(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!ts(t[e]))return!1;return!0}return!1}function Jo(t){if(null===t)return V;if("string"==typeof t)return K;if("boolean"==typeof t)return ae;if("number"==typeof t)return oe;if(t instanceof Br)return Ot;if(t instanceof Is)return Xi;if(t instanceof Yo)return vo;if(t instanceof ds)return Ar;if(Array.isArray(t)){const e=t.length;let n;for(const s of t){const c=Jo(s);if(n){if(n===c)continue;n=kn;break}n=c}return Xr(n||kn,e)}return Nn}function Gs(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Br||t instanceof Yo||t instanceof ds?t.toString():JSON.stringify(t)}class Ja{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ts(e[1]))return n.error("invalid value");const s=e[1];let c=Jo(s);const d=n.expectedType;return"array"!==c.kind||0!==c.N||!d||"array"!==d.kind||"number"==typeof d.N&&0!==d.N||(c=d),new Ja(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Br?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Yo?this.value.serialize():this.value}}class Lo{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const uc={string:K,number:oe,boolean:ae,object:Nn};class La{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,c=1;const d=e[0];if("array"===d){let _,x;if(e.length>2){const E=e[1];if("string"!=typeof E||!(E in uc)||"object"===E)return n.error('The item type argument of "array" must be one of string, number, boolean',1);_=uc[E],c++}else _=kn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=e[2],c++}s=Xr(_,x)}else s=uc[d];const f=[];for(;c<e.length;c++){const _=n.parse(e[c],c,kn);if(!_)return null;f.push(_)}return new La(s,f)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!Eo(this.type,Jo(s)))return s;if(n===this.args.length-1)throw new Lo(`Expected value to be of type ${gi(this.type)}, but found ${gi(Jo(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){n.push(s.kind);const c=e.N;("number"==typeof c||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(s=>s.serialize()))}}class Pc{constructor(e){this.type=vo,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return n.error("First argument must be an image or text section.");const c=[];let d=!1;for(let f=1;f<=e.length-1;++f){const _=e[f];if(d&&"object"==typeof _&&!Array.isArray(_)){d=!1;let x=null;if(_["font-scale"]&&(x=n.parse(_["font-scale"],1,oe),!x))return null;let E=null;if(_["text-font"]&&(E=n.parse(_["text-font"],1,Xr(K)),!E))return null;let D=null;if(_["text-color"]&&(D=n.parse(_["text-color"],1,Ot),!D))return null;const S=c[c.length-1];S.scale=x,S.font=E,S.textColor=D}else{const x=n.parse(e[f],1,kn);if(!x)return null;const E=x.type.kind;if("string"!==E&&"value"!==E&&"null"!==E&&"resolvedImage"!==E)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new Pc(c)}evaluate(e){return new Yo(this.sections.map(n=>{const s=n.content.evaluate(e);return Jo(s)===Ar?new Oa("",s,null,null,null):new Oa(Gs(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),e.push(s)}return e}}class Rc{constructor(e,n){this.type=Ar,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");const s=n.parse(e[1],1,K);if(!s)return n.error("No image name provided.");if(2===e.length)return new Rc(s);const c=n.parse(e[2],1,K);return c?new Rc(s,c):n.error("Secondary image variant is not a string.")}evaluate(e){const n=ds.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function $l(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}const Od={"to-boolean":ae,"to-color":Ot,"to-number":oe,"to-string":K};class Qa{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0],c=[];let d=V;if("to-array"===s){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(n.expectedType){if("array"!==n.expectedType.kind)return n.error(`Expected ${n.expectedType.kind} but found array.`);d=Xr(n.expectedType.itemType,f)}else{if(!(f>0&&ts(e[1][0])))return null;d=Xr(Jo(e[1][0]),f)}for(let _=0;_<f;_++){const x=e[1][_];let E;if("array"===$l(x))E=n.parse(x,void 0,d.itemType);else{const D=$l(x);if(D!==d.itemType.kind)return n.error(`Expected ${d.itemType.kind} but found ${D}.`);E=n.registry.literal.parse(["literal",void 0===x?null:x],n)}if(!E)return null;c.push(E)}}else{if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return n.error("Expected one argument.");d=Od[s];for(let f=1;f<e.length;f++){const _=n.parse(e[f],f,kn);if(!_)return null;c.push(_)}}return new Qa(d,c)}evaluate(e){if("boolean"===this.type.kind)return!!this.args[0].evaluate(e);if("color"===this.type.kind){let n,s;for(const c of this.args){if(n=c.evaluate(e),s=null,n instanceof Br)return n;if("string"==typeof n){const d=e.parseColor(n);if(d)return d}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ds(n[0],n[1],n[2],n[3]),!s))return new Br(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Lo(s||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const s of this.args){if(n=s.evaluate(e),null===n)return 0;const c=Number(n);if(!isNaN(c))return c}throw new Lo(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?Yo.fromString(Gs(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?ds.fromString(Gs(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map(n=>n.evaluate(e)):Gs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Pc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Rc(this.args[0]).serialize();const e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const ny=["Unknown","Point","LineString","Polygon"];class Hs{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ny[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:s,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*n-e[0])+this.featureDistanceData.bearing[1]*(c*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Br.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Qo{constructor(e,n,s,c,d){this.name=e,this.type=n,this._evaluate=s,this.args=c,this._overloadIndex=d}evaluate(e){if(!this._evaluate){const n=Qo.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const s=e[0],c=Qo.definitions[s];if(!c)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,f=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=[];let x=null,E=-1;for(const[D,S]of f){if(Array.isArray(D)&&D.length!==e.length-1)continue;_.push(D),E++,x=new Cf(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);const P=[];let F=!1;for(let z=1;z<e.length;z++){const $=e[z],H=Array.isArray(D)?D[z-1]:D.type,ee=x.parse($,1+P.length,H);if(!ee){F=!0;break}P.push(ee)}if(!F)if(Array.isArray(D)&&D.length!==P.length)x.error(`Expected ${D.length} arguments, but found ${P.length} instead.`);else{for(let z=0;z<P.length;z++){const $=Array.isArray(D)?D[z]:D.type,H=P[z];x.concat(z+1).checkSubtype($,H.type)}if(0===x.errors.length)return new Qo(s,d,S,P,E)}}if(1===_.length)n.errors.push(...x.errors);else{const D=(_.length?_:f.map(([P])=>P)).map(Dl).join(" | "),S=[];for(let P=1;P<e.length;P++){const F=n.parse(e[P],1+S.length);if(!F)return null;S.push(gi(F.type))}n.error(`Expected arguments of type ${D}, but found (${S.join(", ")}) instead.`)}return null}static register(e,n){Qo.definitions=n;for(const s in n)e[s]=Qo}}function Dl(t){return Array.isArray(t)?`(${t.map(gi).join(", ")})`:`(${gi(t.type)}...)`}class bh{constructor(e,n,s){this.type=Xi,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return n.error("Collator options argument must be an object.");const c=n.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,ae);if(!c)return null;const d=n.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,ae);if(!d)return null;let f=null;return s.locale&&(f=n.parse(s.locale,1,K),!f)?null:new bh(c,d,f)}evaluate(e){return new Is(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function yf(t,e,n=0,s=t.length-1,c=Ao){for(;s>n;){if(s-n>600){const x=s-n+1,E=e-n+1,D=Math.log(x),S=.5*Math.exp(2*D/3),P=.5*Math.sqrt(D*S*(x-S)/x)*(E-x/2<0?-1:1);yf(t,e,Math.max(n,Math.floor(e-E*S/x+P)),Math.min(s,Math.floor(e+(x-E)*S/x+P)),c)}const d=t[e];let f=n,_=s;for(ka(t,n,e),c(t[s],d)>0&&ka(t,n,s);f<_;){for(ka(t,f,_),f++,_--;c(t[f],d)<0;)f++;for(;c(t[_],d)>0;)_--}0===c(t[n],d)?ka(t,n,_):(_++,ka(t,_,s)),_<=e&&(n=_+1),e<=_&&(s=_-1)}}function ka(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function Ao(t,e){return t<e?-1:t>e?1:0}function Fa(t){let e=0;for(let n,s,c=0,d=t.length,f=d-1;c<d;f=c++)n=t[c],s=t[f],e+=(s.x-n.x)*(n.y+s.y);return e}function dc(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Oc(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Vu(t,e,n){const s=t[0]-e[0],c=t[1]-e[1],d=t[0]-n[0],f=t[1]-n[1];return s*f-d*c==0&&s*d<=0&&c*f<=0}function Lr(t,e,n=!1){let s=!1;for(let _=0,x=e.length;_<x;_++){const E=e[_];for(let D=0,S=E.length,P=S-1;D<S;P=D++){const F=E[P],z=E[D];if(Vu(t,F,z))return n;(d=F)[1]>(c=t)[1]!=(f=z)[1]>c[1]&&c[0]<(f[0]-d[0])*(c[1]-d[1])/(f[1]-d[1])+d[0]&&(s=!s)}}var c,d,f;return s}function dl(t,e,n,s){const c=s[0]-n[0],d=s[1]-n[1],f=(t[0]-n[0])*d-c*(t[1]-n[1]),_=(e[0]-n[0])*d-c*(e[1]-n[1]);return f>0&&_<0||f<0&&_>0}function el(t,e,n,s){return(c=[s[0]-n[0],s[1]-n[1]])[0]*(d=[e[0]-t[0],e[1]-t[1]])[1]-c[1]*d[0]!=0&&!(!dl(t,e,n,s)||!dl(n,s,t,e));var c,d}const Lc=8192;function vf(t,e){const n=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*Lc),Math.round(s*c*Lc)]}function Ld(t,e){for(let n=0;n<e.length;n++)if(Lr(t,e[n]))return!0;return!1}function $u(t,e,n){for(const s of n)for(let c=0,d=s.length,f=d-1;c<d;f=c++)if(el(t,e,s[f],s[c]))return!0;return!1}function Gl(t,e){for(let n=0;n<t.length;++n)if(!Lr(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if($u(t[n],t[n+1],e))return!1;return!0}function Ip(t,e){for(let n=0;n<e.length;n++)if(Gl(t,e[n]))return!0;return!1}function cu(t,e,n){const s=[];for(let c=0;c<t.length;c++){const d=[];for(let f=0;f<t[c].length;f++){const _=vf(t[c][f],n);dc(e,_),d.push(_)}s.push(d)}return s}function hl(t,e,n){const s=[];for(let c=0;c<t.length;c++){const d=cu(t[c],e,n);s.push(d)}return s}function kd(t,e,n,s){if(t[0]<n[0]||t[0]>n[2]){const c=.5*s;let d=t[0]-n[0]>c?-s:n[0]-t[0]>c?s:0;0===d&&(d=t[0]-n[2]>c?-s:n[2]-t[0]>c?s:0),t[0]+=d}dc(e,t)}function wh(t,e,n,s){const c=Math.pow(2,s.z)*Lc,d=[s.x*Lc,s.y*Lc],f=[];if(!t)return f;for(const _ of t)for(const x of _){const E=[x.x+d[0],x.y+d[1]];kd(E,e,n,c),f.push(E)}return f}function uu(t,e,n,s){const c=Math.pow(2,s.z)*Lc,d=[s.x*Lc,s.y*Lc],f=[];if(!t)return f;for(const x of t){const E=[];for(const D of x){const S=[D.x+d[0],D.y+d[1]];dc(e,S),E.push(S)}f.push(E)}if(e[2]-e[0]<=c/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const x of f)for(const E of x)kd(E,e,n,c)}var _;return f}class As{constructor(e,n){this.type=ae,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ts(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let c=0;c<s.features.length;++c){const d=s.features[c].geometry.type;if("Polygon"===d||"MultiPolygon"===d)return new As(s,s.features[c].geometry)}else if("Feature"===s.type){const c=s.geometry.type;if("Polygon"===c||"MultiPolygon"===c)return new As(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new As(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(n,s){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(!f)return!1;if("Polygon"===s.type){const _=cu(s.coordinates,d,f),x=wh(n.geometry(),c,d,f);if(!Oc(c,d))return!1;for(const E of x)if(!Lr(E,_))return!1}if("MultiPolygon"===s.type){const _=hl(s.coordinates,d,f),x=wh(n.geometry(),c,d,f);if(!Oc(c,d))return!1;for(const E of x)if(!Ld(E,_))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(n,s){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(!f)return!1;if("Polygon"===s.type){const _=cu(s.coordinates,d,f),x=uu(n.geometry(),c,d,f);if(!Oc(c,d))return!1;for(const E of x)if(!Gl(E,_))return!1}if("MultiPolygon"===s.type){const _=hl(s.coordinates,d,f),x=uu(n.geometry(),c,d,f);if(!Oc(c,d))return!1;for(const E of x)if(!Ip(E,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Fd={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Eh=1/298.257223563,Ch=Eh*(2-Eh),du=Math.PI/180;class hu{static fromTile(e,n,s){const c=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),d=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/du;return new hu(d,s)}static get units(){return Fd}constructor(e,n){if(void 0===e)throw new Error("No latitude given.");if(n&&!Fd[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(Fd).join(", ")}`);const s=6378.137*du*(n?Fd[n]:1),c=Math.cos(e*du),d=1/(1-Ch*(1-c*c)),f=Math.sqrt(d);this.kx=s*f*c,this.ky=s*f*d*(1-Ch)}distance(e,n){const s=fl(e[0]-n[0])*this.kx,c=(e[1]-n[1])*this.ky;return Math.sqrt(s*s+c*c)}bearing(e,n){const s=fl(n[0]-e[0])*this.kx;return Math.atan2(s,(n[1]-e[1])*this.ky)/du}destination(e,n,s){const c=s*du;return this.offset(e,Math.sin(c)*n,Math.cos(c)*n)}offset(e,n,s){return[e[0]+n/this.kx,e[1]+s/this.ky]}lineDistance(e){let n=0;for(let s=0;s<e.length-1;s++)n+=this.distance(e[s],e[s+1]);return n}area(e){let n=0;for(let s=0;s<e.length;s++){const c=e[s];for(let d=0,f=c.length,_=f-1;d<f;_=d++)n+=fl(c[d][0]-c[_][0])*(c[d][1]+c[_][1])*(s?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let s=0;if(n<=0)return e[0];for(let c=0;c<e.length-1;c++){const d=e[c],f=e[c+1],_=this.distance(d,f);if(s+=_,s>n)return fu(d,f,(n-(s-_))/_)}return e[e.length-1]}pointToSegmentDistance(e,n,s){let[c,d]=n,f=fl(s[0]-c)*this.kx,_=(s[1]-d)*this.ky;if(0!==f||0!==_){const x=(fl(e[0]-c)*this.kx*f+(e[1]-d)*this.ky*_)/(f*f+_*_);x>1?(c=s[0],d=s[1]):x>0&&(c+=f/this.kx*x,d+=_/this.ky*x)}return f=fl(e[0]-c)*this.kx,_=(e[1]-d)*this.ky,Math.sqrt(f*f+_*_)}pointOnLine(e,n){let s=1/0,c=e[0][0],d=e[0][1],f=0,_=0;for(let x=0;x<e.length-1;x++){let E=e[x][0],D=e[x][1],S=fl(e[x+1][0]-E)*this.kx,P=(e[x+1][1]-D)*this.ky,F=0;0===S&&0===P||(F=(fl(n[0]-E)*this.kx*S+(n[1]-D)*this.ky*P)/(S*S+P*P),F>1?(E=e[x+1][0],D=e[x+1][1]):F>0&&(E+=S/this.kx*F,D+=P/this.ky*F)),S=fl(n[0]-E)*this.kx,P=(n[1]-D)*this.ky;const z=S*S+P*P;z<s&&(s=z,c=E,d=D,f=x,_=F)}return{point:[c,d],index:f,t:Math.max(0,Math.min(1,_))}}lineSlice(e,n,s){let c=this.pointOnLine(s,e),d=this.pointOnLine(s,n);if(c.index>d.index||c.index===d.index&&c.t>d.t){const E=c;c=d,d=E}const f=[c.point],_=c.index+1,x=d.index;!Tp(s[_],f[0])&&_<=x&&f.push(s[_]);for(let E=_+1;E<=x;E++)f.push(s[E]);return Tp(s[x],d.point)||f.push(d.point),f}lineSliceAlong(e,n,s){let c=0;const d=[];for(let f=0;f<s.length-1;f++){const _=s[f],x=s[f+1],E=this.distance(_,x);if(c+=E,c>e&&0===d.length&&d.push(fu(_,x,(e-(c-E))/E)),c>=n)return d.push(fu(_,x,(n-(c-E))/E)),d;c>e&&d.push(x)}return d}bufferPoint(e,n){const s=n/this.ky,c=n/this.kx;return[e[0]-c,e[1]-s,e[0]+c,e[1]+s]}bufferBBox(e,n){const s=n/this.ky,c=n/this.kx;return[e[0]-c,e[1]-s,e[2]+c,e[3]+s]}insideBBox(e,n){return fl(e[0]-n[0])>=0&&fl(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function Tp(t,e){return t[0]===e[0]&&t[1]===e[1]}function fu(t,e,n){const s=fl(e[0]-t[0]);return[t[0]+s*n,t[1]+(e[1]-t[1])*n]}function fl(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}class xf{constructor(e=[],n=((s,c)=>s<c?-1:s>c?1:0)){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:s}=this,c=n[e];for(;e>0;){const d=e-1>>1,f=n[d];if(s(c,f)>=0)break;n[e]=f,e=d}n[e]=c}_down(e){const{data:n,compare:s}=this,c=this.length>>1,d=n[e];for(;e<c;){let f=1+(e<<1);const _=f+1;if(_<this.length&&s(n[_],n[f])<0&&(f=_),s(n[f],d)>=0)break;n[e]=n[f],e=f}n[e]=d}}var hi=8192;function k(t,e){return e.dist-t.dist}const W=100,N=50;function X(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ce(t){return t[1]-t[0]+1}function Xe(t,e){const n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Rt(t,e){if(t[0]>t[1])return[null,null];const n=ce(t);if(e){if(2===n)return[t,null];const s=Math.floor(n/2);return[[t[0],t[0]+s],[t[0]+s,t[1]]]}{if(1===n)return[t,null];const s=Math.floor(n/2)-1;return[[t[0],t[0]+s],[t[0]+s+1,t[1]]]}}function un(t,e){const n=[1/0,1/0,-1/0,-1/0];if(!Xe(e,t.length))return n;for(let s=e[0];s<=e[1];++s)dc(n,t[s]);return n}function en(t){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)dc(e,t[n][s]);return e}function wi(t,e,n){if(X(t)||X(e))return NaN;let s=0,c=0;return t[2]<e[0]&&(s=e[0]-t[2]),t[0]>e[2]&&(s=t[0]-e[2]),t[1]>e[3]&&(c=t[1]-e[3]),t[3]<e[1]&&(c=e[1]-t[3]),n.distance([0,0],[s,c])}function yr(t){return 360*t-180}function dr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Ho(t,e){const n=Math.pow(2,e.z),s=(t.y/hi+e.y)/n;return[yr((t.x/hi+e.x)/n),dr(s)]}function pl(t,e){const n=[];for(let s=0;s<t.length;++s)n.push(Ho(t[s],e));return n}function ls(t,e,n){const s=n.pointOnLine(e,t).point;return n.distance(t,s)}function Hl(t,e,n,s,c){const d=n.slice(s[0],s[1]+1);let f=1/0;for(let _=e[0];_<=e[1];++_)if(0===(f=Math.min(f,ls(t[_],d,c))))return 0;return f}function Na(t,e,n,s,c){const d=Math.min(c.pointToSegmentDistance(t,n,s),c.pointToSegmentDistance(e,n,s)),f=Math.min(c.pointToSegmentDistance(n,t,e),c.pointToSegmentDistance(s,t,e));return Math.min(d,f)}function Ml(t,e,n,s,c){if(!Xe(e,t.length)||!Xe(s,n.length))return NaN;let d=1/0;for(let f=e[0];f<e[1];++f)for(let _=s[0];_<s[1];++_){if(el(t[f],t[f+1],n[_],n[_+1]))return 0;d=Math.min(d,Na(t[f],t[f+1],n[_],n[_+1],c))}return d}function bf(t,e,n,s,c){if(!Xe(e,t.length)||!Xe(s,n.length))return NaN;let d=1/0;for(let f=e[0];f<=e[1];++f)for(let _=s[0];_<=s[1];++_)if(0===(d=Math.min(d,c.distance(t[f],n[_]))))return d;return d}function ia(t,e,n){if(Lr(t,e,!0))return 0;let s=1/0;for(const c of e){const d=c.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[d-1]&&0===(s=Math.min(s,n.pointToSegmentDistance(t,c[d-1],c[0])))||0===(s=Math.min(s,ls(t,c,n))))return s}return s}function Dp(t,e,n,s){if(!Xe(e,t.length))return NaN;for(let d=e[0];d<=e[1];++d)if(Lr(t[d],n,!0))return 0;let c=1/0;for(let d=e[0];d<e[1];++d)for(const f of n)for(let _=0,x=f.length,E=x-1;_<x;E=_++){if(el(t[d],t[d+1],f[E],f[_]))return 0;c=Math.min(c,Na(t[d],t[d+1],f[E],f[_],s))}return c}function Ih(t,e){for(const n of t)for(let s=0;s<=n.length-1;++s)if(Lr(n[s],e,!0))return!0;return!1}function iy(t,e,n,s=1/0){const c=en(t),d=en(e);if(s!==1/0&&wi(c,d,n)>=s)return s;if(Oc(c,d)){if(Ih(t,e))return 0}else if(Ih(e,t))return 0;let f=s;for(const _ of t)for(let x=0,E=_.length,D=E-1;x<E;D=x++)for(const S of e)for(let P=0,F=S.length,z=F-1;P<F;z=P++){if(el(_[D],_[x],S[z],S[P]))return 0;f=Math.min(f,Na(_[D],_[x],S[z],S[P],n))}return f}function kc(t,e,n,s,c,d,f){if(null===d||null===f)return;const _=wi(un(s,d),un(c,f),n);_<e&&t.push({dist:_,range1:d,range2:f})}function ry(t,e,n,s,c=1/0){let d=Math.min(s.distance(t[0],n[0][0]),c);if(0===d)return d;const f=new xf([{dist:0,range1:[0,t.length-1],range2:[0,0]}],k),_=e?N:W,x=en(n);for(;f.length;){const E=f.pop();if(E.dist>=d)continue;const D=E.range1;if(ce(D)<=_){if(!Xe(D,t.length))return NaN;if(e){const S=Dp(t,D,n,s);if(0===(d=Math.min(d,S)))return d}else for(let S=D[0];S<=D[1];++S){const P=ia(t[S],n,s);if(0===(d=Math.min(d,P)))return d}}else{const S=Rt(D,e);if(null!==S[0]){const P=wi(un(t,S[0]),x,s);P<d&&f.push({dist:P,range1:S[0],range2:[0,0]})}if(null!==S[1]){const P=wi(un(t,S[1]),x,s);P<d&&f.push({dist:P,range1:S[1],range2:[0,0]})}}}return d}function wf(t,e,n,s,c,d=1/0){let f=Math.min(d,c.distance(t[0],n[0]));if(0===f)return f;const _=new xf([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],k),x=e?N:W,E=s?N:W;for(;_.length;){const D=_.pop();if(D.dist>=f)continue;const S=D.range1,P=D.range2;if(ce(S)<=x&&ce(P)<=E){if(!Xe(S,t.length)||!Xe(P,n.length))return NaN;if(e&&s?f=Math.min(f,Ml(t,S,n,P,c)):e||s?e&&!s?f=Math.min(f,Hl(n,P,t,S,c)):!e&&s&&(f=Math.min(f,Hl(t,S,n,P,c))):f=Math.min(f,bf(t,S,n,P,c)),0===f)return f}else{const F=Rt(S,e),z=Rt(P,s);kc(_,f,c,t,n,F[0],z[0]),kc(_,f,c,t,n,F[0],z[1]),kc(_,f,c,t,n,F[1],z[0]),kc(_,f,c,t,n,F[1],z[1])}}return f}function Ef(t,e,n,s,c=1/0){let d=c;const f=un(t,[0,t.length-1]);for(const _ of n)if(!(d!==1/0&&wi(f,un(_,[0,_.length-1]),s)>=d)&&(d=Math.min(d,wf(t,e,_,!0,s,d)),0===d))return d;return d}function Th(t,e,n,s,c=1/0){let d=c;const f=un(t,[0,t.length-1]);for(const _ of n){if(d!==1/0&&wi(f,en(_),s)>=d)continue;const x=ry(t,e,_,s,d);if(isNaN(x))return x;if(0===(d=Math.min(d,x)))return d}return d}function Fc(t){return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}class hc{constructor(e,n){this.type=oe,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ts(e[1])){const s=e[1];if("FeatureCollection"===s.type){for(let c=0;c<s.features.length;++c)if(Fc(s.features[c].geometry.type))return new hc(s,s.features[c].geometry)}else if("Feature"===s.type){if(Fc(s.geometry.type))return new hc(s,s.geometry)}else if(Fc(s.type))return new hc(s,s)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),s=e.canonicalID();if(null!=n&&null!=s){if("Point"===e.geometryType())return function(c,d,f){const _=[];for(const E of c)for(const D of E)_.push(Ho(D,d));const x=new hu(_[0][1],"meters");return"Point"===f.type||"MultiPoint"===f.type||"LineString"===f.type?wf(_,!1,"Point"===f.type?[f.coordinates]:f.coordinates,"LineString"===f.type,x):"MultiLineString"===f.type?Ef(_,!1,f.coordinates,x):"Polygon"===f.type||"MultiPolygon"===f.type?Th(_,!1,"Polygon"===f.type?[f.coordinates]:f.coordinates,x):null}(n,s,this.geometries);if("LineString"===e.geometryType())return function(c,d,f){const _=[];for(const E of c){const D=[];for(const S of E)D.push(Ho(S,d));_.push(D)}const x=new hu(_[0][0][1],"meters");if("Point"===f.type||"MultiPoint"===f.type||"LineString"===f.type)return Ef("Point"===f.type?[f.coordinates]:f.coordinates,"LineString"===f.type,_,x);if("MultiLineString"===f.type){let E=1/0;for(let D=0;D<f.coordinates.length;D++){const S=Ef(f.coordinates[D],!0,_,x,E);if(isNaN(S))return S;if(0===(E=Math.min(E,S)))return E}return E}if("Polygon"===f.type||"MultiPolygon"===f.type){let E=1/0;for(let D=0;D<_.length;D++){const S=Th(_[D],!0,"Polygon"===f.type?[f.coordinates]:f.coordinates,x,E);if(isNaN(S))return S;if(0===(E=Math.min(E,S)))return E}return E}return null}(n,s,this.geometries);if("Polygon"===e.geometryType())return function(c,d,f){const _=[];for(const E of function(D,S){const P=D.length;if(P<=1)return[D];const F=[];let z,$;for(let H=0;H<P;H++){const ee=Fa(D[H]);0!==ee&&(D[H].area=Math.abs(ee),void 0===$&&($=ee<0),$===ee<0?(z&&F.push(z),z=[D[H]]):z.push(D[H]))}return z&&F.push(z),F}(c)){const D=[];for(let S=0;S<E.length;++S)D.push(pl(E[S],d));_.push(D)}const x=new hu(_[0][0][0][1],"meters");if("Point"===f.type||"MultiPoint"===f.type||"LineString"===f.type)return Th("Point"===f.type?[f.coordinates]:f.coordinates,"LineString"===f.type,_,x);if("MultiLineString"===f.type){let E=1/0;for(let D=0;D<f.coordinates.length;D++){const S=Th(f.coordinates[D],!0,_,x,E);if(isNaN(S))return S;if(0===(E=Math.min(E,S)))return E}return E}return"Polygon"===f.type||"MultiPolygon"===f.type?function(E,D,S){let P=1/0;for(const F of E)for(const z of D){const $=iy(F,z,S,P);if(isNaN($))return $;if(0===(P=Math.min(P,$)))return P}return P}("Polygon"===f.type?[f.coordinates]:f.coordinates,_,x):null}(n,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function pu(t,e){switch(t){case"string":return Gs(e);case"number":return+e;case"boolean":return!!e;case"color":return Br.parse(e);case"formatted":return Yo.fromString(Gs(e));case"resolvedImage":return ds.fromString(Gs(e))}return e}function ca(t,e,n,s){return void 0!==s&&(t=s*Math.round(t/s)),void 0!==e&&t<e&&(t=e),void 0!==n&&t>n&&(t=n),t}class Nc{constructor(e,n,s){this.type=e,this.key=n,this.scope=s}static parse(e,n){let s=n.expectedType;if(null==s&&(s=kn),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");const c=n.parse(e[1],1);if(!(c instanceof Ja))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const d=n.parse(e[2],2);return d instanceof Ja?new Nc(s,Gs(c.value),Gs(d.value)):n.error("Scope of 'config' expression must be a string literal.")}return new Nc(s,Gs(c.value))}evaluate(e){const n=[this.key,this.scope,e.scope].filter(Boolean).join("\x1f"),s=e.getConfig(n);if(!s)return null;const{type:c,value:d,values:f,minValue:_,maxValue:x,stepValue:E}=s,D=s.default.evaluate(e);let S=D;if(d){const P=e.scope;e.scope=(P||"").split("\x1f").slice(1).join("\x1f"),S=d.evaluate(e),e.scope=P}return c&&(S=pu(c,S)),void 0===S||void 0===_&&void 0===x&&void 0===E||("number"==typeof S?S=ca(S,_,x,E):Array.isArray(S)&&(S=S.map(P=>"number"==typeof P?ca(P,_,x,E):P))),void 0!==d&&void 0!==S&&f&&!f.includes(S)&&(S=D,c&&(S=pu(c,S))),(c&&c!==this.type||void 0!==S&&Jo(S)!==this.type)&&(S=pu(this.type.kind,S)),S}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Gu(t){if(t instanceof Qo&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof As||t instanceof hc)return!1;let e=!0;return t.eachChild(n=>{e&&!Gu(n)&&(e=!1)}),e}function Hu(t){if(t instanceof Qo&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!Hu(n)&&(e=!1)}),e}function tl(t){if(t instanceof Nc)return!1;let e=!0;return t.eachChild(n=>{e&&!tl(n)&&(e=!1)}),e}function fc(t,e){if(t instanceof Qo&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(s=>{n&&!fc(s,e)&&(n=!1)}),n}class mu{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new mu(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Mp{constructor(e,n=[],s,c=new lu,d=[],f,_){this.registry=e,this.path=n,this.key=n.map(x=>`[${x}]`).join(""),this.scope=c,this.errors=d,this.expectedType=s,this._scope=f,this.options=_}parse(e,n,s,c,d={}){return n||s?this.concat(n,s,c)._parse(e,d):this._parse(e,d)}_parse(e,n){function s(c,d,f){return"assert"===f?new La(d,[c]):"coerce"===f?new Qa(d,[c]):c}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c="string"==typeof e[0]?this.registry[e[0]]:void 0;if(c){let d=c.parse(e,this);if(!d)return null;if(this.expectedType){const f=this.expectedType,_=d.type;if("string"!==f.kind&&"number"!==f.kind&&"boolean"!==f.kind&&"object"!==f.kind&&"array"!==f.kind||"value"!==_.kind)if("color"!==f.kind&&"formatted"!==f.kind&&"resolvedImage"!==f.kind||"value"!==_.kind&&"string"!==_.kind){if(this.checkSubtype(f,_))return null}else d=s(d,f,n.typeAnnotation||"coerce");else d=s(d,f,n.typeAnnotation||"assert")}if(!(d instanceof Ja)&&"resolvedImage"!==d.type.kind&&If(d)){const f=new Hs(this._scope,this.options);try{d=new Ja(d.type,d.evaluate(f))}catch(_){return this.error(_.message),null}}return d}return Qa.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const c="number"==typeof e?this.path.concat(e):this.path,d=s?this.scope.concat(s):this.scope;return new Mp(this.registry,c,n||null,d,this.errors,this._scope,this.options)}error(e,...n){const s=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new $s(s,e))}checkSubtype(e,n){const s=Eo(e,n);return s&&this.error(s),s}}var Cf=Mp;function If(t){if(t instanceof mu)return If(t.boundExpression);if(t instanceof Qo&&"error"===t.name||t instanceof bh||t instanceof As||t instanceof hc||t instanceof Nc)return!1;const e=t instanceof Qa||t instanceof La;let n=!0;return t.eachChild(s=>{n=e?n&&If(s):n&&s instanceof Ja}),!!n&&Gu(t)&&fc(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Bc(t,e){const n=t.length-1;let s,c,d=0,f=n,_=0;for(;d<=f;)if(_=Math.floor((d+f)/2),s=t[_],c=t[_+1],s<=e){if(_===n||e<c)return _;d=_+1}else{if(!(s>e))throw new Lo("Input is not a number.");f=_-1}return 0}class Wu{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,d]of s)this.labels.push(c),this.outputs.push(d)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,oe);if(!s)return null;const c=[];let d=null;n.expectedType&&"value"!==n.expectedType.kind&&(d=n.expectedType);for(let f=1;f<e.length;f+=2){const _=1===f?-1/0:e[f],x=e[f+1],E=f,D=f+1;if("number"!=typeof _)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(c.length&&c[c.length-1][0]>=_)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const S=n.parse(x,D,d);if(!S)return null;d=d||S.type,c.push([_,S])}return new Wu(d,s,c)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return s[0].evaluate(e);const d=n.length;return c>=n[d-1]?s[d-1].evaluate(e):s[Bc(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}const Dh=4/29,Xu=6/29,Mh=3*Xu*Xu,Ku=Xu*Xu*Xu,Zu=Math.PI/180,oy=180/Math.PI;function Tf(t){return t>Ku?Math.pow(t,1/3):t/Mh+Dh}function Ps(t){return t>Xu?t*t*t:Mh*(t-Dh)}function Nd(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ap(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Bd(t){const e=Ap(t.r),n=Ap(t.g),s=Ap(t.b),c=Tf((.4124564*e+.3575761*n+.1804375*s)/.95047),d=Tf((.2126729*e+.7151522*n+.072175*s)/1);return{l:116*d-16,a:500*(c-d),b:200*(d-Tf((.0193339*e+.119192*n+.9503041*s)/1.08883)),alpha:t.a}}function ig(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*Ps(e),n=.95047*Ps(n),s=1.08883*Ps(s),new Br(Nd(3.2404542*n-1.5371385*e-.4985314*s),Nd(-.969266*n+1.8760108*e+.041556*s),Nd(.0556434*n-.2040259*e+1.0572252*s),t.alpha)}function sy(t,e,n){const s=e-t;return t+n*(s>180||s<-180?s-360*Math.round(s/360):s)}const zd={forward:Bd,reverse:ig,interpolate:function(t,e,n){return{l:zi(t.l,e.l,n),a:zi(t.a,e.a,n),b:zi(t.b,e.b,n),alpha:zi(t.alpha,e.alpha,n)}}},Sh={forward:function(t){const{l:e,a:n,b:s}=Bd(t),c=Math.atan2(s,n)*oy;return{h:c<0?c+360:c,c:Math.sqrt(n*n+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Zu,n=t.c;return ig({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:sy(t.h,e.h,n),c:zi(t.c,e.c,n),l:zi(t.l,e.l,n),alpha:zi(t.alpha,e.alpha,n)}}};var rg=Object.freeze({__proto__:null,hcl:Sh,lab:zd});class ml{constructor(e,n,s,c,d){this.type=e,this.operator=n,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[f,_]of d)this.labels.push(f),this.outputs.push(_)}static interpolationFactor(e,n,s,c){let d=0;if("exponential"===e.name)d=Ah(n,e.base,s,c);else if("linear"===e.name)d=Ah(n,1,s,c);else if("cubic-bezier"===e.name){const f=e.controlPoints;d=new kr(f[0],f[1],f[2],f[3]).solve(Ah(n,1,s,c))}return d}static parse(e,n){let[s,c,d,...f]=e;if(!Array.isArray(c)||0===c.length)return n.error("Expected an interpolation type expression.",1);if("linear"===c[0])c={name:"linear"};else if("exponential"===c[0]){const E=c[1];if("number"!=typeof E)return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:E}}else{if("cubic-bezier"!==c[0])return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const E=c.slice(1);if(4!==E.length||E.some(D=>"number"!=typeof D||D<0||D>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(d=n.parse(d,2,oe),!d)return null;const _=[];let x=null;"interpolate-hcl"===s||"interpolate-lab"===s?x=Ot:n.expectedType&&"value"!==n.expectedType.kind&&(x=n.expectedType);for(let E=0;E<f.length;E+=2){const D=f[E],S=f[E+1],P=E+3,F=E+4;if("number"!=typeof D)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(_.length&&_[_.length-1][0]>=D)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const z=n.parse(S,F,x);if(!z)return null;x=x||z.type,_.push([D,z])}return"number"===x.kind||"color"===x.kind||"array"===x.kind&&"number"===x.itemType.kind&&"number"==typeof x.N?new ml(x,s,c,d,_):n.error(`Type ${gi(x)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return s[0].evaluate(e);const d=n.length;if(c>=n[d-1])return s[d-1].evaluate(e);const f=Bc(n,c),_=ml.interpolationFactor(this.interpolation,c,n[f],n[f+1]),x=s[f].evaluate(e),E=s[f+1].evaluate(e);return"interpolate"===this.operator?au[this.type.kind.toLowerCase()](x,E,_):"interpolate-hcl"===this.operator?Sh.reverse(Sh.interpolate(Sh.forward(x),Sh.forward(E),_)):zd.reverse(zd.interpolate(zd.forward(x),zd.forward(E),_))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function Ah(t,e,n,s){const c=s-n,d=t-n;return 0===c?0:1===e?d/c:(Math.pow(e,d)-1)/(Math.pow(e,c)-1)}class qu{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const c=n.expectedType;c&&"value"!==c.kind&&(s=c);const d=[];for(const _ of e.slice(1)){const x=n.parse(_,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!x)return null;s=s||x.type,d.push(x)}const f=c&&d.some(_=>Eo(c,_.type));return new qu(f?kn:s,d)}evaluate(e){let n,s=null,c=0;for(const d of this.args){if(c++,s=d.evaluate(e),s&&s instanceof ds&&!s.available&&(n||(n=s),s=null,c===this.args.length))return n;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class cs{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let d=1;d<e.length-1;d+=2){const f=e[d];if("string"!=typeof f)return n.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return n.error("Variable names must contain only alphanumeric characters or '_'.",d);const _=n.parse(e[d+1],d+1);if(!_)return null;s.push([f,_])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return c?new cs(s,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,s]of this.bindings)e.push(n,s.serialize());return e.push(this.result.serialize()),e}}class Ni{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,oe),c=n.parse(e[2],2,Xr(n.expectedType||kn));return s&&c?new Ni(c.type.itemType,s,c):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new Lo(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new Lo(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new Lo(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Cr{constructor(e,n){this.type=ae,this.needle=e,this.haystack=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,kn),c=n.parse(e[2],2,kn);return s&&c?Go(s.type,[ae,K,oe,V,kn])?new Cr(s,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${gi(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!na(n,["boolean","string","number","null"]))throw new Lo(`Expected first argument to be of type boolean, string, number or null, but found ${gi(Jo(n))} instead.`);if(!na(s,["string","array"]))throw new Lo(`Expected second argument to be of type array or string, but found ${gi(Jo(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class hs{constructor(e,n,s){this.type=oe,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,kn),c=n.parse(e[2],2,kn);if(!s||!c)return null;if(!Go(s.type,[ae,K,oe,V,kn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${gi(s.type)} instead`);if(4===e.length){const d=n.parse(e[3],3,oe);return d?new hs(s,c,d):null}return new hs(s,c)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!na(n,["boolean","string","number","null"]))throw new Lo(`Expected first argument to be of type boolean, string, number or null, but found ${gi(Jo(n))} instead.`);if(!na(s,["string","array"]))throw new Lo(`Expected second argument to be of type array or string, but found ${gi(Jo(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(n,c)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class gl{constructor(e,n,s,c,d,f){this.inputType=e,this.type=n,this.input=s,this.cases=c,this.outputs=d,this.otherwise=f}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,c;n.expectedType&&"value"!==n.expectedType.kind&&(c=n.expectedType);const d={},f=[];for(let E=2;E<e.length-1;E+=2){let D=e[E];const S=e[E+1];Array.isArray(D)||(D=[D]);const P=n.concat(E);if(0===D.length)return P.error("Expected at least one branch label.");for(const z of D){if("number"!=typeof z&&"string"!=typeof z)return P.error("Branch labels must be numbers or strings.");if("number"==typeof z&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof z&&Math.floor(z)!==z)return P.error("Numeric branch labels must be integer values.");if(s){if(P.checkSubtype(s,Jo(z)))return null}else s=Jo(z);if(void 0!==d[String(z)])return P.error("Branch labels must be unique.");d[String(z)]=f.length}const F=n.parse(S,E,c);if(!F)return null;c=c||F.type,f.push(F)}const _=n.parse(e[1],1,kn);if(!_)return null;const x=n.parse(e[e.length-1],e.length-1,c);return x?"value"!==_.type.kind&&n.concat(1).checkSubtype(s,_.type)?null:new gl(s,c,_,d,f,x):null}evaluate(e){const n=this.input.evaluate(e);return(Jo(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],c={};for(const f of n){const _=c[this.cases[f]];void 0===_?(c[this.cases[f]]=s.length,s.push([this.cases[f],[f]])):s[_][1].push(f)}const d=f=>"number"===this.inputType.kind?Number(f):f;for(const[f,_]of s)e.push(1===_.length?d(_[0]):_.map(d)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class Ws{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&"value"!==n.expectedType.kind&&(s=n.expectedType);const c=[];for(let f=1;f<e.length-1;f+=2){const _=n.parse(e[f],f,ae);if(!_)return null;const x=n.parse(e[f+1],f+1,s);if(!x)return null;c.push([_,x]),s=s||x.type}const d=n.parse(e[e.length-1],e.length-1,s);return d?new Ws(s,c,d):null}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Rs{constructor(e,n,s,c){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,kn),c=n.parse(e[2],2,oe);if(!s||!c)return null;if(!Go(s.type,[Xr(kn),K,kn]))return n.error(`Expected first argument to be of type array or string, but found ${gi(s.type)} instead`);if(4===e.length){const d=n.parse(e[3],3,oe);return d?new Rs(s.type,s,c,d):null}return new Rs(s.type,s,c)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!na(n,["string","array"]))throw new Lo(`Expected first argument to be of type array or string, but found ${gi(Jo(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(s,c)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Yu(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function ns(t,e,n,s){return 0===s.compare(e,n)}function gs(t,e,n){const s="=="!==t&&"!="!==t;return class dA{constructor(d,f,_){this.type=ae,this.lhs=d,this.rhs=f,this.collator=_,this.hasUntypedArgument="value"===d.type.kind||"value"===f.type.kind}static parse(d,f){if(3!==d.length&&4!==d.length)return f.error("Expected two or three arguments.");const _=d[0];let x=f.parse(d[1],1,kn);if(!x)return null;if(!Yu(_,x.type))return f.concat(1).error(`"${_}" comparisons are not supported for type '${gi(x.type)}'.`);let E=f.parse(d[2],2,kn);if(!E)return null;if(!Yu(_,E.type))return f.concat(2).error(`"${_}" comparisons are not supported for type '${gi(E.type)}'.`);if(x.type.kind!==E.type.kind&&"value"!==x.type.kind&&"value"!==E.type.kind)return f.error(`Cannot compare types '${gi(x.type)}' and '${gi(E.type)}'.`);s&&("value"===x.type.kind&&"value"!==E.type.kind?x=new La(E.type,[x]):"value"!==x.type.kind&&"value"===E.type.kind&&(E=new La(x.type,[E])));let D=null;if(4===d.length){if("string"!==x.type.kind&&"string"!==E.type.kind&&"value"!==x.type.kind&&"value"!==E.type.kind)return f.error("Cannot use collator to compare non-string types.");if(D=f.parse(d[3],3,Xi),!D)return null}return new dA(x,E,D)}evaluate(d){const f=this.lhs.evaluate(d),_=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const x=Jo(f),E=Jo(_);if(x.kind!==E.kind||"string"!==x.kind&&"number"!==x.kind)throw new Lo(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${x.kind}, ${E.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const x=Jo(f),E=Jo(_);if("string"!==x.kind||"string"!==E.kind)return e(d,f,_)}return this.collator?n(d,f,_,this.collator.evaluate(d)):e(d,f,_)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[t];return this.eachChild(f=>{d.push(f.serialize())}),d}}}const Wl=gs("==",function(t,e,n){return e===n},ns),zr=gs("!=",function(t,e,n){return e!==n},function(t,e,n,s){return!ns(0,e,n,s)}),Ud=gs("<",function(t,e,n){return e<n},function(t,e,n,s){return s.compare(e,n)<0}),Pp=gs(">",function(t,e,n){return e>n},function(t,e,n,s){return s.compare(e,n)>0}),gu=gs("<=",function(t,e,n){return e<=n},function(t,e,n,s){return s.compare(e,n)<=0}),fs=gs(">=",function(t,e,n){return e>=n},function(t,e,n,s){return s.compare(e,n)>=0});class zc{constructor(e,n,s,c,d,f){this.type=K,this.number=e,this.locale=n,this.currency=s,this.unit=c,this.minFractionDigits=d,this.maxFractionDigits=f}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,oe);if(!s)return null;const c=e[2];if("object"!=typeof c||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=n.parse(c.locale,1,K),!d))return null;let f=null;if(c.currency&&(f=n.parse(c.currency,1,K),!f))return null;let _=null;if(c.unit&&(_=n.parse(c.unit,1,K),!_))return null;let x=null;if(c["min-fraction-digits"]&&(x=n.parse(c["min-fraction-digits"],1,oe),!x))return null;let E=null;return c["max-fraction-digits"]&&(E=n.parse(c["max-fraction-digits"],1,oe),!E)?null:new zc(s,d,f,_,x,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class _u{constructor(e){this.type=oe,this.input=e}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?n.error(`Expected argument of type string or array, but found ${gi(s.type)} instead.`):new _u(s):null}evaluate(e){const n=this.input.evaluate(e);if("string"==typeof n||Array.isArray(n))return n.length;throw new Lo(`Expected value to be of type string or array, but found ${gi(Jo(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function Xl(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Kl={"==":Wl,"!=":zr,">":Pp,"<":Ud,">=":fs,"<=":gu,array:La,at:Ni,boolean:La,case:Ws,coalesce:qu,collator:bh,format:Pc,image:Rc,in:Cr,"index-of":hs,interpolate:ml,"interpolate-hcl":ml,"interpolate-lab":ml,length:_u,let:cs,literal:Ja,match:gl,number:La,"number-format":zc,object:La,slice:Rs,step:Wu,string:La,"to-boolean":Qa,"to-color":Qa,"to-number":Qa,"to-string":Qa,var:mu,within:As,distance:hc,config:Nc};function Rp(t,[e,n,s,c]){e=e.evaluate(t),n=n.evaluate(t),s=s.evaluate(t);const d=c?c.evaluate(t):1,f=Ds(e,n,s,d);if(f)throw new Lo(f);return new Br(e/255*d,n/255*d,s/255*d,d)}function Uc(t,[e,n,s,c]){e=e.evaluate(t),n=n.evaluate(t),s=s.evaluate(t);const d=c?c.evaluate(t):1,f=(D=n,S=s,P=d,"number"==typeof(E=e)&&E>=0&&E<=360?"number"==typeof D&&D>=0&&D<=100&&"number"==typeof S&&S>=0&&S<=100?void 0===P||"number"==typeof P&&P>=0&&P<=1?null:`Invalid hsla value [${[E,D,S,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof P?[E,D,S,P]:[E,D,S]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof P?[E,D,S,P]:[E,D,S]).join(", ")}]: 'h' must be between 0 and 360.`);var E,D,S,P;if(f)throw new Lo(f);const _=`hsla(${e}, ${n}%, ${s}%, ${d})`,x=Br.parse(_);if(!x)throw new Lo(`Failed to parse HSLA color: ${_}`);return x}function Ph(t,e){return t in e}function nl(t,e){const n=e[t];return void 0===n?null:n}function lr(t){return{type:t}}function Df(t){return{result:"success",value:t}}function Zl(t){return{result:"error",value:t}}function ql(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function jd(t){return"data-driven"===t["property-type"]}function p(t){return ql(t.expression,"measure-light")}function r(t){return ql(t.expression,"zoom")}function u(t){return!!t.expression&&t.expression.interpolated}function m(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function b(t){return t}function w(t,e){const n="color"===e.type,s=t.stops&&"object"==typeof t.stops[0][0],c=s||!(s||void 0!==t.property),d=t.type||(u(e)?"exponential":"interval");if(n&&((t=Ya({},t)).stops&&(t.stops=t.stops.map(E=>[E[0],Br.parse(E[1])])),t.default=Br.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!rg[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let f,_,x;if("exponential"===d)f=L;else if("interval"===d)f=R;else if("categorical"===d){f=M,_=Object.create(null);for(const E of t.stops)_[E[0]]=E[1];x=typeof t.stops[0][0]}else{if("identity"!==d)throw new Error(`Unknown function type "${d}"`);f=U}if(s){const E={},D=[];for(let F=0;F<t.stops.length;F++){const z=t.stops[F],$=z[0].zoom;void 0===E[$]&&(E[$]={zoom:$,type:t.type,property:t.property,default:t.default,stops:[]},D.push($)),E[$].stops.push([z[0].value,z[1]])}const S=[];for(const F of D)S.push([E[F].zoom,w(E[F],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:ml.interpolationFactor.bind(void 0,P),zoomStops:S.map(F=>F[0]),evaluate:({zoom:F},z)=>L({stops:S,base:t.base},e,F).evaluate(F,z)}}if(c){const E="exponential"===d?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:ml.interpolationFactor.bind(void 0,E),zoomStops:t.stops.map(D=>D[0]),evaluate:({zoom:D})=>f(t,e,D,_,x)}}return{kind:"source",evaluate(E,D){const S=D&&D.properties?D.properties[t.property]:void 0;return void 0===S?I(t.default,e.default):f(t,e,S,_,x)}}}function I(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function M(t,e,n,s,c){return I(typeof n===c?s[n]:void 0,t.default,e.default)}function R(t,e,n){if("number"!==$l(n))return I(t.default,e.default);const s=t.stops.length;if(1===s||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];const c=Bc(t.stops.map(d=>d[0]),n);return t.stops[c][1]}function L(t,e,n){const s=void 0!==t.base?t.base:1;if("number"!==$l(n))return I(t.default,e.default);const c=t.stops.length;if(1===c||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[c-1][0])return t.stops[c-1][1];const d=Bc(t.stops.map(D=>D[0]),n),f=function(D,S,P,F){const z=F-P,$=D-P;return 0===z?0:1===S?$/z:(Math.pow(S,$)-1)/(Math.pow(S,z)-1)}(n,s,t.stops[d][0],t.stops[d+1][0]),_=t.stops[d][1],x=t.stops[d+1][1];let E=au[e.type]||b;if(t.colorSpace&&"rgb"!==t.colorSpace){const D=rg[t.colorSpace];E=(S,P)=>D.reverse(D.interpolate(D.forward(S),D.forward(P),f))}return"function"==typeof _.evaluate?{evaluate(...D){const S=_.evaluate.apply(void 0,D),P=x.evaluate.apply(void 0,D);if(void 0!==S&&void 0!==P)return E(S,P,f)}}:E(_,x,f)}function U(t,e,n){return"color"===e.type?n=Br.parse(n):"formatted"===e.type?n=Yo.fromString(n.toString()):"resolvedImage"===e.type?n=ds.fromString(n.toString()):$l(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),I(n,t.default,e.default)}Qo.register(Kl,{error:[{kind:"error"},[K],(t,[e])=>{throw new Lo(e.evaluate(t))}],typeof:[K,[kn],(t,[e])=>gi(Jo(e.evaluate(t)))],"to-rgba":[Xr(oe,4),[Ot],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[Ot,[oe,oe,oe],Rp],rgba:[Ot,[oe,oe,oe,oe],Rp],hsl:[Ot,[oe,oe,oe],Uc],hsla:[Ot,[oe,oe,oe,oe],Uc],has:{type:ae,overloads:[[[K],(t,[e])=>Ph(e.evaluate(t),t.properties())],[[K,Nn],(t,[e,n])=>Ph(e.evaluate(t),n.evaluate(t))]]},get:{type:kn,overloads:[[[K],(t,[e])=>nl(e.evaluate(t),t.properties())],[[K,Nn],(t,[e,n])=>nl(e.evaluate(t),n.evaluate(t))]]},"feature-state":[kn,[K],(t,[e])=>nl(e.evaluate(t),t.featureState||{})],properties:[Nn,[],t=>t.properties()],"geometry-type":[K,[],t=>t.geometryType()],id:[kn,[],t=>t.id()],zoom:[oe,[],t=>t.globals.zoom],pitch:[oe,[],t=>t.globals.pitch||0],"distance-from-center":[oe,[],t=>t.distanceFromCenter()],"measure-light":[oe,[K],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[oe,[],t=>t.globals.heatmapDensity||0],"line-progress":[oe,[],t=>t.globals.lineProgress||0],"raster-value":[oe,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[oe,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[oe,[],t=>t.globals.skyRadialProgress||0],accumulated:[kn,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[oe,lr(oe),(t,e)=>{let n=0;for(const s of e)n+=s.evaluate(t);return n}],"*":[oe,lr(oe),(t,e)=>{let n=1;for(const s of e)n*=s.evaluate(t);return n}],"-":{type:oe,overloads:[[[oe,oe],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[oe],(t,[e])=>-e.evaluate(t)]]},"/":[oe,[oe,oe],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[oe,[oe,oe],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[oe,[],()=>Math.LN2],pi:[oe,[],()=>Math.PI],e:[oe,[],()=>Math.E],"^":[oe,[oe,oe],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[oe,[oe],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[oe,[oe],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[oe,[oe],(t,[e])=>Math.log(e.evaluate(t))],log2:[oe,[oe],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[oe,[oe],(t,[e])=>Math.sin(e.evaluate(t))],cos:[oe,[oe],(t,[e])=>Math.cos(e.evaluate(t))],tan:[oe,[oe],(t,[e])=>Math.tan(e.evaluate(t))],asin:[oe,[oe],(t,[e])=>Math.asin(e.evaluate(t))],acos:[oe,[oe],(t,[e])=>Math.acos(e.evaluate(t))],atan:[oe,[oe],(t,[e])=>Math.atan(e.evaluate(t))],min:[oe,lr(oe),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[oe,lr(oe),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[oe,[oe],(t,[e])=>Math.abs(e.evaluate(t))],round:[oe,[oe],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[oe,[oe],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[oe,[oe],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ae,[K,kn],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[ae,[kn],(t,[e])=>t.id()===e.value],"filter-type-==":[ae,[K],(t,[e])=>t.geometryType()===e.value],"filter-<":[ae,[K,kn],(t,[e,n])=>{const s=t.properties()[e.value],c=n.value;return typeof s==typeof c&&s<c}],"filter-id-<":[ae,[kn],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[ae,[K,kn],(t,[e,n])=>{const s=t.properties()[e.value],c=n.value;return typeof s==typeof c&&s>c}],"filter-id->":[ae,[kn],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[ae,[K,kn],(t,[e,n])=>{const s=t.properties()[e.value],c=n.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[ae,[kn],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[ae,[K,kn],(t,[e,n])=>{const s=t.properties()[e.value],c=n.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[ae,[kn],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[ae,[kn],(t,[e])=>e.value in t.properties()],"filter-has-id":[ae,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[ae,[Xr(K)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ae,[Xr(kn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ae,[K,Xr(kn)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ae,[K,Xr(kn)],(t,[e,n])=>function(s,c,d,f){for(;d<=f;){const _=d+f>>1;if(c[_]===s)return!0;c[_]>s?f=_-1:d=_+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:ae,overloads:[[[ae,ae],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[lr(ae),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:ae,overloads:[[[ae,ae],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[lr(ae),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[ae,[ae],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ae,[K],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[K,[K],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[K,[K],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[K,lr(kn),(t,e)=>e.map(n=>Gs(n.evaluate(t))).join("")],"resolved-locale":[K,[Xi],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[oe,[oe,oe,kn],(t,e)=>{const[n,s,c]=e.map(f=>f.evaluate(t));if(n>s||n===s)return n;let d;if("string"==typeof c)d=function(f){let _=0;if(0===f.length)return _;for(let x=0;x<f.length;x++)_=(_<<5)-_+f.charCodeAt(x),_|=0;return _}(c);else{if("number"!=typeof c)throw new Lo(`Invalid seed input: ${c}`);d=c}return n+Xl(d)()*(s-n)}]});class G{constructor(e,n,s,c){var d;this.expression=e,this._warningHistory={},this._evaluator=new Hs(s,c),this._defaultValue=n?"color"===(d=n).type&&(m(d.default)||Array.isArray(d.default))?new Br(0,0,0,0):"color"===d.type?Br.parse(d.default)||null:void 0===d.default?null:d.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(e,n,s,c,d,f,_,x){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,c,d,f,_,x){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null;try{const E=this.expression.evaluate(this._evaluator);if(null==E||"number"==typeof E&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Lo(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function J(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Kl}function Q(t,e,n,s){const c=new Cf(Kl,[],e?function(f){const _={color:Ot,string:K,number:oe,enum:K,boolean:ae,formatted:vo,resolvedImage:Ar};return"array"===f.type?Xr(_[f.value]||kn,f.length):_[f.type]}(e):void 0,void 0,void 0,n,s),d=c.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return d?Df(new G(d,e,n,s)):Zl(c.errors)}class le{constructor(e,n,s){this.kind=e,this._styleExpression=n,this.isLightConstant=s,this.isStateDependent="constant"!==e&&!Hu(n.expression),this.isConfigDependent=!tl(n.expression)}evaluateWithoutErrorHandling(e,n,s,c,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,c,d,f)}evaluate(e,n,s,c,d,f){return this._styleExpression.evaluate(e,n,s,c,d,f)}}class de{constructor(e,n,s,c,d){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent="camera"!==e&&!Hu(n.expression),this.isLightConstant=d,this.isConfigDependent=!tl(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,s,c,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,c,d,f)}evaluate(e,n,s,c,d,f){return this._styleExpression.evaluate(e,n,s,c,d,f)}interpolationFactor(e,n,s){return this.interpolationType?ml.interpolationFactor(this.interpolationType,e,n,s):0}}function ge(t,e,n,s){if("error"===(t=Q(t,e,n,s)).result)return t;const c=t.value.expression,d=Gu(c);if(!d&&!jd(e))return Zl([new $s("","data expressions not supported")]);const f=fc(c,["zoom","pitch","distance-from-center"]);if(!f&&!r(e))return Zl([new $s("","zoom expressions not supported")]);const _=fc(c,["measure-light"]);if(!_&&!p(e))return Zl([new $s("","measure-light expression not supported")]);const x=e.expression&&e.expression.relaxZoomRestriction,E=Ke(c);return E||f||x?E instanceof $s?Zl([E]):E instanceof ml&&!u(e)?Zl([new $s("",'"interpolate" expressions cannot be used with this property')]):Df(E?new de(d?"camera":"composite",t.value,E.labels,E instanceof ml?E.interpolation:void 0,_):new le(d?"constant":"source",t.value,_)):Zl([new $s("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class xe{constructor(e,n){this._parameters=e,this._specification=n,Ya(this,w(this._parameters,this._specification))}static deserialize(e){return new xe(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ke(t){let e=null;if(t instanceof cs)e=Ke(t.result);else if(t instanceof qu){for(const n of t.args)if(e=Ke(n),e)break}else(t instanceof Wu||t instanceof ml)&&t.input instanceof Qo&&"zoom"===t.input.name&&(e=t);return e instanceof $s||t.eachChild(n=>{const s=Ke(n);s instanceof $s?e=s:e&&s&&e!==s&&(e=new $s("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Qe=yt,et=3;function yt(t,e,n){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var d=0;d<this.d*this.d;d++){var f=c[et+d],_=c[et+d+1];s.push(f===_?null:c.subarray(f,_))}var x=c[et+s.length+1];this.keys=c.subarray(c[et+s.length],x),this.bboxes=c.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var E=0;E<this.d*this.d;E++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var D=n/e*t;this.min=-D,this.max=t+D}yt.prototype.insert=function(t,e,n,s,c){this._forEachCell(e,n,s,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(c)},yt.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},yt.prototype._insertCell=function(t,e,n,s,c,d){this.cells[c].push(d)},yt.prototype.query=function(t,e,n,s,c){var d=this.min,f=this.max;if(t<=d&&e<=d&&f<=n&&f<=s&&!c)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(t,e,n,s,this._queryCell,_,{},c),_},yt.prototype._queryCell=function(t,e,n,s,c,d,f,_){var x=this.cells[c];if(null!==x)for(var E=this.keys,D=this.bboxes,S=0;S<x.length;S++){var P=x[S];if(void 0===f[P]){var F=4*P;(_?_(D[F+0],D[F+1],D[F+2],D[F+3]):t<=D[F+2]&&e<=D[F+3]&&n>=D[F+0]&&s>=D[F+1])?(f[P]=!0,d.push(E[P])):f[P]=!1}}},yt.prototype._forEachCell=function(t,e,n,s,c,d,f,_){for(var x=this._convertToCellCoord(t),E=this._convertToCellCoord(e),D=this._convertToCellCoord(n),S=this._convertToCellCoord(s),P=x;P<=D;P++)for(var F=E;F<=S;F++){var z=this.d*F+P;if((!_||_(this._convertFromCellCoord(P),this._convertFromCellCoord(F),this._convertFromCellCoord(P+1),this._convertFromCellCoord(F+1)))&&c.call(this,t,e,n,s,z,d,f,_))return}},yt.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},yt.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},yt.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=et+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var d=e,f=0;f<t.length;f++){var _=t[f];c[et+f]=d,c.set(_,d),d+=_.length}return c[et+t.length]=d,c.set(this.keys,d),c[et+t.length+1]=d+=this.keys.length,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer};var _t=ht(Qe);const St={};function Ee(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),St[e]={klass:t,omit:n.omit||[]}}Ee(Object,"Object"),_t.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},_t.deserialize=function(t){return new _t(t.buffer)},Object.defineProperty(_t,"name",{value:"Grid"}),Ee(_t,"Grid"),Ee(Br,"Color"),Ee(Error,"Error"),Ee(Yo,"Formatted"),Ee(Oa,"FormattedSection"),Ee(Sd,"AJAXError"),Ee(ds,"ResolvedImage"),Ee(xe,"StylePropertyFunction"),Ee(G,"StyleExpression",{omit:["_evaluator"]}),Ee(de,"ZoomDependentExpression"),Ee(le,"ZoomConstantExpression"),Ee(Qo,"CompoundExpression",{omit:["_evaluate"]});for(const t in Kl)St[Kl[t]._classRegistryKey]||Ee(Kl[t],`Expression${t}`);function tt(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Lt(t){return self.ImageBitmap&&t instanceof ImageBitmap}function sn(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(tt(t)||Lt(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const s of t)n.push(sn(s,e));return n}if(t instanceof Map){const n={$name:"Map"};for(const[s,c]of t.entries())n[s]=sn(c);return n}if("object"==typeof t){const n=t.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const c=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const d in t)t.hasOwnProperty(d)&&(St[s].omit.indexOf(d)>=0||(c[d]=sn(t[d],e)));t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof t)}function zt(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||tt(t)||Lt(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(zt);if("object"==typeof t){const e=t.$name||"Object";if("Map"===e){const c=new Map;for(const d of Object.keys(t))"$name"!==d&&c.set(d,zt(t[d]));return c}const{klass:n}=St[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const s=Object.create(n.prototype);for(const c of Object.keys(t))"$name"!==c&&(s[c]=zt(t[c]));return s}throw new Error("can't deserialize object of type "+typeof t)}const It={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function hn(t){for(const e of t)if(Vn(e.charCodeAt(0)))return!0;return!1}function Gn(t){for(const e of t)if(!Xn(e.charCodeAt(0)))return!1;return!0}function Xn(t){return!(It.Arabic(t)||It["Arabic Supplement"](t)||It["Arabic Extended-A"](t)||It["Arabic Presentation Forms-A"](t)||It["Arabic Presentation Forms-B"](t))}function Vn(t){return!(746!==t&&747!==t&&(t<4352||!(It["Bopomofo Extended"](t)||It.Bopomofo(t)||It["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||It["CJK Compatibility Ideographs"](t)||It["CJK Compatibility"](t)||It["CJK Radicals Supplement"](t)||It["CJK Strokes"](t)||!(!It["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||It["CJK Unified Ideographs Extension A"](t)||It["CJK Unified Ideographs"](t)||It["Enclosed CJK Letters and Months"](t)||It["Hangul Compatibility Jamo"](t)||It["Hangul Jamo Extended-A"](t)||It["Hangul Jamo Extended-B"](t)||It["Hangul Jamo"](t)||It["Hangul Syllables"](t)||It.Hiragana(t)||It["Ideographic Description Characters"](t)||It.Kanbun(t)||It["Kangxi Radicals"](t)||It["Katakana Phonetic Extensions"](t)||It.Katakana(t)&&12540!==t||!(!It["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!It["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||It["Unified Canadian Aboriginal Syllabics"](t)||It["Unified Canadian Aboriginal Syllabics Extended"](t)||It["Vertical Forms"](t)||It["Yijing Hexagram Symbols"](t)||It["Yi Syllables"](t)||It["Yi Radicals"](t))))}function Xt(t){return!(Vn(t)||(e=t,It["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||It["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||It["Letterlike Symbols"](e)||It["Number Forms"](e)||It["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||It["Control Pictures"](e)&&9251!==e||It["Optical Character Recognition"](e)||It["Enclosed Alphanumerics"](e)||It["Geometric Shapes"](e)||It["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||It["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||It["CJK Symbols and Punctuation"](e)||It.Katakana(e)||It["Private Use Area"](e)||It["CJK Compatibility Forms"](e)||It["Small Form Variants"](e)||It["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function mn(t){return t>=1424&&t<=2303||It["Arabic Presentation Forms-A"](t)||It["Arabic Presentation Forms-B"](t)}function Pn(t,e){return!(!e&&mn(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||It.Khmer(t))}function yi(t){for(const e of t)if(mn(e.charCodeAt(0)))return!0;return!1}const bi="deferred",Mi="loading",xi="loaded";let di=null,In="unavailable",Li=null;const Ir=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(In="error"),di&&di(t)};function Ji(){hr.fire(new la("pluginStateChange",{pluginStatus:In,pluginURL:Li}))}const hr=new lc,Fr=function(){return In},fr=function(){if(In!==bi||!Li)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");In=Mi,Ji(),Li&&jl({url:Li},t=>{t?Ir(t):(In=xi,Ji())})},Rr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>In===xi||null!=Rr.applyArabicShaping,isLoading:()=>In===Mi,setState(t){In=t.pluginStatus,Li=t.pluginURL},isParsed:()=>null!=Rr.applyArabicShaping&&null!=Rr.processBidirectionalText&&null!=Rr.processStyledBidirectionalText,getPluginURL:()=>Li};class rr{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,s){for(const c of n)if(!Pn(c.charCodeAt(0),s))return!1;return!0}(e,Rr.isLoaded())}}class Ur{constructor(e,n,s,c){this.property=e,this.value=n,this.expression=function(d,f,_,x){if(m(d))return new xe(d,f);if(J(d)||Array.isArray(d)&&d.length>0){const E=ge(d,f,_,x);if("error"===E.result)throw new Error(E.value.map(D=>`${D.key}: ${D.message}`).join(", "));return E.value}{let E=d;return"string"==typeof d&&"color"===f.type&&(E=Br.parse(d)),{kind:"constant",isConfigDependent:!1,evaluate:()=>E}}}(void 0===n?e.specification.default:n,e.specification,s,c)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class po{constructor(e,n,s){this.property=e,this.value=new Ur(e,void 0,n,s)}transitioned(e,n){return new cr(this.property,this.value,n,ai({},e.transition,this.transition),e.now)}untransitioned(){return new cr(this.property,this.value,null,{},0)}}class Pr{constructor(e,n,s){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=s,this.isConfigDependent=!1}getValue(e){return eo(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new po(this._values[e].property,this._scope,this._options)),this._values[e].value=new Ur(this._values[e].property,null===n?void 0:eo(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);const s=this._properties.properties;if(e)for(const c in e){const d=e[c];if(wo(c,"-transition")){const f=c.slice(0,-11);s[f]&&this.setTransition(f,d)}else s.hasOwnProperty(c)&&this.setValue(c,d)}}getTransition(e){return eo(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new po(this._values[e].property)),this._values[e].transition=eo(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s);const c=this.getTransition(n);void 0!==c&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const s=new Kr(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,n._values[c]);return s}untransitioned(){const e=new Kr(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class cr{constructor(e,n,s,c,d){const f=c.delay||0,_=c.duration||0;d=d||0,this.property=e,this.value=n,this.begin=d+f,this.end=this.begin+_,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const c=e.now||0,d=this.value.possiblyEvaluate(e,n,s),f=this.prior;if(f){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return f.possiblyEvaluate(e,n,s);{const _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,n,s),d,qe(_))}}return d}}class Kr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const c=new No(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,n,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ps{constructor(e,n,s){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=s,this.isConfigDependent=!1}getValue(e){return eo(this._values[e].value)}setValue(e,n){this._values[e]=new Ur(this._values[e].property,null===n?void 0:eo(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const c=new No(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,n,s);return c}}class xo{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,n,s,c){return this.property.evaluate(this.value,this.parameters,e,n,s,c)}}class No{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Mn{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,s){const c=au[this.specification.type];return c?c(e,n,s):e}}class Pi{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,c){return new xo(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(n,null,{},s,c)}:e.expression,n)}interpolate(e,n,s){if("constant"!==e.value.kind||"constant"!==n.value.kind)return e;if(void 0===e.value.value||void 0===n.value.value)return new xo(this,{kind:"constant",value:void 0},e.parameters);const c=au[this.specification.type];return c?new xo(this,{kind:"constant",value:c(e.value.value,n.value.value,s)},e.parameters):e}evaluate(e,n,s,c,d,f){return"constant"===e.kind?e.value:e.evaluate(n,s,c,d,f)}}class zs{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,c){return!!e.expression.evaluate(n,null,{},s,c)}interpolate(){return!1}}class to{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new rr(0,{});for(const s in e){const c=e[s];c.specification.overridable&&this.overridableProperties.push(s);const d=this.defaultPropertyValues[s]=new Ur(c,void 0),f=this.defaultTransitionablePropertyValues[s]=new po(c);this.defaultTransitioningPropertyValues[s]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate(n)}}}Ee(Pi,"DataDrivenProperty"),Ee(Mn,"DataConstantProperty"),Ee(zs,"ColorRampProperty");var Jt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ra(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Us(t){if(Array.isArray(t))return t.map(Us);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=Us(t[n]);return e}return ra(t)}function Ms(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Ms(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Xs(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ms(t)||(t=mc(t));const n=t;let s=!0;try{s=function(E){if(!xa(E))return E;let D=Us(E);return Tr(D),D=Ks(D),D}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const c=Jt[`filter_${e}`],d=Q(s,c);let f=null;if("error"===d.result)throw new Error(d.value.map(E=>`${E.key}: ${E.message}`).join(", "));f=(E,D,S)=>d.value.evaluate(E,D,{},S);let _=null,x=null;if(s!==n){const E=Q(n,c);if("error"===E.result)throw new Error(E.value.map(D=>`${D.key}: ${D.message}`).join(", "));_=(D,S,P,F,z)=>E.value.evaluate(D,S,{},P,void 0,void 0,F,z),x=!Gu(E.value.expression)}return{filter:f,dynamicFilter:_||void 0,needGeometry:Ju(s),needFeature:!!x}}function Ks(t){if(!Array.isArray(t))return t;const e=function(n){if(pc.has(n[0]))for(let s=1;s<n.length;s++)if(xa(n[s]))return!0;return n}(t);return!0===e?e:e.map(n=>Ks(n))}function Tr(t){let e=!1;const n=[];if("case"===t[0]){for(let s=1;s<t.length-1;s+=2)e=e||xa(t[s]),n.push(t[s+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||xa(t[1]);for(let s=2;s<t.length-1;s+=2)n.push(t[s+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||xa(t[1]);for(let s=1;s<t.length-1;s+=2)n.push(t[s+1])}e&&(t.length=0,t.push("any",...n));for(let s=1;s<t.length;s++)Tr(t[s])}function xa(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let n=1;n<t.length;n++)if(xa(t[n]))return!0;return!1}const pc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function jc(t,e){return t<e?-1:t>e?1:0}function Ju(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(Ju(t[e]))return!0;return!1}function mc(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Qu(t[1],t[2],"=="):"!="===e?Sl(Qu(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Qu(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(mc))):"all"===e?["all"].concat(t.slice(1).map(mc)):"none"===e?["all"].concat(t.slice(1).map(mc).map(Sl)):"in"===e?Vd(t[1],t.slice(2)):"!in"===e?Sl(Vd(t[1],t.slice(2))):"has"===e?$d(t[1]):"!has"!==e||Sl($d(t[1]));var n}function Qu(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Vd(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(jc)]]:["filter-in-small",t,["literal",e]]}}function $d(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Sl(t){return["!",t]}function Mf(t,e){return e?`${t}\x1f${e}`:t}const Sf="-transition",ed=new Set(["fill","line","background","hillshade","raster"]);class ua extends lc{constructor(e,n,s,c,d){if(super(),this.id=e.id,this.fqid=Mf(this.id,s),this.type=e.type,this.scope=s,this.lut=c,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new ps(n.layout,this.scope,d),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new Pr(n.paint,this.scope,d);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new No(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return ed.has(this.type)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if("custom"===this.type&&"visibility"===e)return void(this.visibility=n);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,n),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return wo(e,Sf)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){const s=this._transitionablePaint,c=s._properties.properties;if(wo(e,Sf)){const S=e.slice(0,-11);return c[S]&&s.setTransition(S,n||void 0),!1}if(!c[e])return!1;const d=s._values[e],f=d.value.isDataDriven(),_=d.value;s.setValue(e,n),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const x=s._values[e].value,E=x.isDataDriven(),D=wo(e,"pattern")||"line-dasharray"===e;return E||f||D||this._handleOverridablePaintPropertyUpdate(e,_,x)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,s){return null}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Oo({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(void 0===e||"layout"===n&&!Object.keys(e).length||"paint"===n&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof xo&&jd(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Xs(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,s,c,d,f,_,x,E){}queryIntersectsMatchingFeature(e,n,s,c){}}const li={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class lo{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Wo{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function oo(t,e=1){let n=0,s=0;return{members:t.map(c=>{const d=li[c.type].BYTES_PER_ELEMENT,f=n=is(n,Math.max(e,d)),_=c.components||1;return s=Math.max(s,d),n+=d*_,{name:c.name,type:c.type,components:_,offset:f}}),size:is(n,Math.max(s,e)),alignment:e}}function is(t,e){return Math.ceil(t/e)*e}class gc extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=s,e}}gc.prototype.bytesPerElement=4,Ee(gc,"StructArrayLayout2i4");class Hd extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s)}emplace(e,n,s,c){const d=3*e;return this.int16[d+0]=n,this.int16[d+1]=s,this.int16[d+2]=c,e}}Hd.prototype.bytesPerElement=6,Ee(Hd,"StructArrayLayout3i6");class ba extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,s,c)}emplace(e,n,s,c,d){const f=4*e;return this.int16[f+0]=n,this.int16[f+1]=s,this.int16[f+2]=c,this.int16[f+3]=d,e}}ba.prototype.bytesPerElement=8,Ee(ba,"StructArrayLayout4i8");class Op extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,c,d)}emplace(e,n,s,c,d,f){const _=5*e;return this.int16[_+0]=n,this.int16[_+1]=s,this.int16[_+2]=c,this.int16[_+3]=d,this.int16[_+4]=f,e}}Op.prototype.bytesPerElement=10,Ee(Op,"StructArrayLayout5i10");class Lp extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,s,c,d,f,_)}emplace(e,n,s,c,d,f,_,x){const E=6*e,D=12*e,S=3*e;return this.int16[E+0]=n,this.int16[E+1]=s,this.uint8[D+4]=c,this.uint8[D+5]=d,this.uint8[D+6]=f,this.uint8[D+7]=_,this.float32[S+2]=x,e}}Lp.prototype.bytesPerElement=12,Ee(Lp,"StructArrayLayout2i4ub1f12");class td extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,s,c)}emplace(e,n,s,c,d){const f=4*e;return this.float32[f+0]=n,this.float32[f+1]=s,this.float32[f+2]=c,this.float32[f+3]=d,e}}td.prototype.bytesPerElement=16,Ee(td,"StructArrayLayout4f16");class Rh extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s)}emplace(e,n,s,c){const d=3*e;return this.float32[d+0]=n,this.float32[d+1]=s,this.float32[d+2]=c,e}}Rh.prototype.bytesPerElement=12,Ee(Rh,"StructArrayLayout3f12");class Oh extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,c,d)}emplace(e,n,s,c,d,f){const _=6*e,x=3*e;return this.uint16[_+0]=n,this.uint16[_+1]=s,this.uint16[_+2]=c,this.uint16[_+3]=d,this.float32[x+2]=f,e}}Oh.prototype.bytesPerElement=12,Ee(Oh,"StructArrayLayout4ui1f12");class kp extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,s,c)}emplace(e,n,s,c,d){const f=4*e;return this.uint16[f+0]=n,this.uint16[f+1]=s,this.uint16[f+2]=c,this.uint16[f+3]=d,e}}kp.prototype.bytesPerElement=8,Ee(kp,"StructArrayLayout4ui8");class Fp extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,c,d,f)}emplace(e,n,s,c,d,f,_){const x=6*e;return this.int16[x+0]=n,this.int16[x+1]=s,this.int16[x+2]=c,this.int16[x+3]=d,this.int16[x+4]=f,this.int16[x+5]=_,e}}Fp.prototype.bytesPerElement=12,Ee(Fp,"StructArrayLayout6i12");class og extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d,f,_,x,E,D,S,P){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,s,c,d,f,_,x,E,D,S,P)}emplace(e,n,s,c,d,f,_,x,E,D,S,P,F){const z=12*e;return this.int16[z+0]=n,this.int16[z+1]=s,this.int16[z+2]=c,this.int16[z+3]=d,this.uint16[z+4]=f,this.uint16[z+5]=_,this.uint16[z+6]=x,this.uint16[z+7]=E,this.int16[z+8]=D,this.int16[z+9]=S,this.int16[z+10]=P,this.int16[z+11]=F,e}}og.prototype.bytesPerElement=24,Ee(og,"StructArrayLayout4i4ui4i24");class Ba extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,c,d,f)}emplace(e,n,s,c,d,f,_){const x=10*e,E=5*e;return this.int16[x+0]=n,this.int16[x+1]=s,this.int16[x+2]=c,this.float32[E+2]=d,this.float32[E+3]=f,this.float32[E+4]=_,e}}Ba.prototype.bytesPerElement=20,Ee(Ba,"StructArrayLayout3i3f20");class Vc extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Vc.prototype.bytesPerElement=4,Ee(Vc,"StructArrayLayout1ul4");class Wd extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Wd.prototype.bytesPerElement=4,Ee(Wd,"StructArrayLayout1f4");class wa extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=s,e}}wa.prototype.bytesPerElement=4,Ee(wa,"StructArrayLayout2ui4");class $c extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d,f,_,x,E,D,S,P,F){const z=this.length;return this.resize(z+1),this.emplace(z,e,n,s,c,d,f,_,x,E,D,S,P,F)}emplace(e,n,s,c,d,f,_,x,E,D,S,P,F,z){const $=20*e,H=10*e;return this.int16[$+0]=n,this.int16[$+1]=s,this.int16[$+2]=c,this.int16[$+3]=d,this.int16[$+4]=f,this.float32[H+3]=_,this.float32[H+4]=x,this.float32[H+5]=E,this.float32[H+6]=D,this.int16[$+14]=S,this.uint32[H+8]=P,this.uint16[$+18]=F,this.uint16[$+19]=z,e}}$c.prototype.bytesPerElement=40,Ee($c,"StructArrayLayout5i4f1i1ul2ui40");class sg extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,s,c,d,f,_)}emplace(e,n,s,c,d,f,_,x){const E=8*e;return this.int16[E+0]=n,this.int16[E+1]=s,this.int16[E+2]=c,this.int16[E+4]=d,this.int16[E+5]=f,this.int16[E+6]=_,this.int16[E+7]=x,e}}sg.prototype.bytesPerElement=16,Ee(sg,"StructArrayLayout3i2i2i16");class ag extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,c,d)}emplace(e,n,s,c,d,f){const _=4*e,x=8*e;return this.float32[_+0]=n,this.float32[_+1]=s,this.float32[_+2]=c,this.int16[x+6]=d,this.int16[x+7]=f,e}}ag.prototype.bytesPerElement=16,Ee(ag,"StructArrayLayout2f1f2i16");class ay extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,s,c)}emplace(e,n,s,c,d){const f=12*e,_=3*e;return this.uint8[f+0]=n,this.uint8[f+1]=s,this.float32[_+1]=c,this.float32[_+2]=d,e}}ay.prototype.bytesPerElement=12,Ee(ay,"StructArrayLayout2ub2f12");class Zs extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s)}emplace(e,n,s,c){const d=3*e;return this.uint16[d+0]=n,this.uint16[d+1]=s,this.uint16[d+2]=c,e}}Zs.prototype.bytesPerElement=6,Ee(Zs,"StructArrayLayout3ui6");class Np extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d,f,_,x,E,D,S,P,F,z,$,H,ee,Pe,Oe,ke,dt){const st=this.length;return this.resize(st+1),this.emplace(st,e,n,s,c,d,f,_,x,E,D,S,P,F,z,$,H,ee,Pe,Oe,ke,dt)}emplace(e,n,s,c,d,f,_,x,E,D,S,P,F,z,$,H,ee,Pe,Oe,ke,dt,st){const Dt=30*e,kt=15*e,Yt=60*e;return this.int16[Dt+0]=n,this.int16[Dt+1]=s,this.int16[Dt+2]=c,this.float32[kt+2]=d,this.float32[kt+3]=f,this.uint16[Dt+8]=_,this.uint16[Dt+9]=x,this.uint32[kt+5]=E,this.uint32[kt+6]=D,this.uint32[kt+7]=S,this.uint16[Dt+16]=P,this.uint16[Dt+17]=F,this.uint16[Dt+18]=z,this.float32[kt+10]=$,this.float32[kt+11]=H,this.uint8[Yt+48]=ee,this.uint8[Yt+49]=Pe,this.uint8[Yt+50]=Oe,this.uint32[kt+13]=ke,this.int16[Dt+28]=dt,this.uint8[Yt+58]=st,e}}Np.prototype.bytesPerElement=60,Ee(Np,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Bp extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d,f,_,x,E,D,S,P,F,z,$,H,ee,Pe,Oe,ke,dt,st,Dt,kt,Yt,yn,dn,Fn,Yn,Sn,Wn,xn,Hn,ni){const Zn=this.length;return this.resize(Zn+1),this.emplace(Zn,e,n,s,c,d,f,_,x,E,D,S,P,F,z,$,H,ee,Pe,Oe,ke,dt,st,Dt,kt,Yt,yn,dn,Fn,Yn,Sn,Wn,xn,Hn,ni)}emplace(e,n,s,c,d,f,_,x,E,D,S,P,F,z,$,H,ee,Pe,Oe,ke,dt,st,Dt,kt,Yt,yn,dn,Fn,Yn,Sn,Wn,xn,Hn,ni,Zn){const Si=22*e,Qn=44*e,ci=88*e;return this.float32[Si+0]=n,this.float32[Si+1]=s,this.int16[Qn+4]=c,this.int16[Qn+5]=d,this.int16[Qn+6]=f,this.int16[Qn+7]=_,this.int16[Qn+8]=x,this.int16[Qn+9]=E,this.int16[Qn+10]=D,this.int16[Qn+11]=S,this.int16[Qn+12]=P,this.uint16[Qn+13]=F,this.uint16[Qn+14]=z,this.uint16[Qn+15]=$,this.uint16[Qn+16]=H,this.uint16[Qn+17]=ee,this.uint16[Qn+18]=Pe,this.uint16[Qn+19]=Oe,this.uint16[Qn+20]=ke,this.uint16[Qn+21]=dt,this.uint16[Qn+22]=st,this.uint16[Qn+23]=Dt,this.uint16[Qn+24]=kt,this.uint16[Qn+25]=Yt,this.uint16[Qn+26]=yn,this.uint16[Qn+27]=dn,this.uint32[Si+14]=Fn,this.float32[Si+15]=Yn,this.float32[Si+16]=Sn,this.float32[Si+17]=Wn,this.float32[Si+18]=xn,this.float32[Si+19]=Hn,this.float32[Si+20]=ni,this.uint8[ci+84]=Zn,e}}Bp.prototype.bytesPerElement=88,Ee(Bp,"StructArrayLayout2f9i15ui1ul6f1ub88");class nd extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,c,d)}emplace(e,n,s,c,d,f){const _=5*e;return this.float32[_+0]=n,this.float32[_+1]=s,this.float32[_+2]=c,this.float32[_+3]=d,this.float32[_+4]=f,e}}nd.prototype.bytesPerElement=20,Ee(nd,"StructArrayLayout5f20");class Af extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,s,c,d,f,_)}emplace(e,n,s,c,d,f,_,x){const E=7*e;return this.float32[E+0]=n,this.float32[E+1]=s,this.float32[E+2]=c,this.float32[E+3]=d,this.float32[E+4]=f,this.float32[E+5]=_,this.float32[E+6]=x,e}}Af.prototype.bytesPerElement=28,Ee(Af,"StructArrayLayout7f28");class Pf extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=s,e}}Pf.prototype.bytesPerElement=8,Ee(Pf,"StructArrayLayout2f8");class lg extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,s,c)}emplace(e,n,s,c,d){const f=6*e;return this.uint32[3*e+0]=n,this.uint16[f+2]=s,this.uint16[f+3]=c,this.uint16[f+4]=d,e}}lg.prototype.bytesPerElement=12,Ee(lg,"StructArrayLayout1ul3ui12");class Lh extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Lh.prototype.bytesPerElement=2,Ee(Lh,"StructArrayLayout1ui2");class cg extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d,f,_,x,E,D,S,P,F,z,$,H){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,n,s,c,d,f,_,x,E,D,S,P,F,z,$,H)}emplace(e,n,s,c,d,f,_,x,E,D,S,P,F,z,$,H,ee){const Pe=16*e;return this.float32[Pe+0]=n,this.float32[Pe+1]=s,this.float32[Pe+2]=c,this.float32[Pe+3]=d,this.float32[Pe+4]=f,this.float32[Pe+5]=_,this.float32[Pe+6]=x,this.float32[Pe+7]=E,this.float32[Pe+8]=D,this.float32[Pe+9]=S,this.float32[Pe+10]=P,this.float32[Pe+11]=F,this.float32[Pe+12]=z,this.float32[Pe+13]=$,this.float32[Pe+14]=H,this.float32[Pe+15]=ee,e}}cg.prototype.bytesPerElement=64,Ee(cg,"StructArrayLayout16f64");class zp extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,d,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,s,c,d,f,_)}emplace(e,n,s,c,d,f,_,x){const E=10*e,D=5*e;return this.uint16[E+0]=n,this.uint16[E+1]=s,this.uint16[E+2]=c,this.uint16[E+3]=d,this.float32[D+2]=f,this.float32[D+3]=_,this.float32[D+4]=x,e}}zp.prototype.bytesPerElement=20,Ee(zp,"StructArrayLayout4ui3f20");class ug extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}ug.prototype.bytesPerElement=2,Ee(ug,"StructArrayLayout1i2");class dg extends Wo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}dg.prototype.bytesPerElement=1,Ee(dg,"StructArrayLayout1ub1");class hg extends lo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}hg.prototype.size=40;class ly extends $c{get(e){return new hg(this,e)}}Ee(ly,"CollisionBoxArray");class Ea extends lo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ea.prototype.size=60;class Xd extends Np{get(e){return new Ea(this,e)}}Ee(Xd,"PlacedSymbolArray");class _s extends lo{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}_s.prototype.size=88;class T0 extends Bp{get(e){return new _s(this,e)}}Ee(T0,"SymbolInstanceArray");class D0 extends Wd{getoffsetX(e){return this.float32[1*e+0]}}Ee(D0,"GlyphOffsetArray");class M0 extends gc{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ee(M0,"SymbolLineVertexArray");class S0 extends lo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}S0.prototype.size=12;class cy extends lg{get(e){return new S0(this,e)}}Ee(cy,"FeatureIndexArray");class uy extends wa{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ee(uy,"FillExtrusionCentroidArray");const Up=oo([{name:"a_pos",components:2,type:"Int16"}],4),yu=oo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class rs{constructor(e=[]){this.segments=e}_prepareSegment(e,n,s,c){let d=this.segments[this.segments.length-1];return e>rs.MAX_VERTEX_ARRAY_LENGTH&&Do(`Max vertices per segment is ${rs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>rs.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c)&&(d={vertexOffset:n,primitiveOffset:s,vertexLength:0,primitiveLength:0},void 0!==c&&(d.sortKey=c),this.segments.push(d)),d}prepareSegment(e,n,s,c){return this._prepareSegment(e,n.length,s.length,c)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,c){return new rs([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}function jp(t,e){return 256*(t=Ut(Math.floor(t),0,255))+Ut(Math.floor(e),0,255)}rs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ee(rs,"SegmentVector");const fg=oo([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),pg=oo([{name:"a_dash",components:4,type:"Uint16"}]);class kh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,s,c){this.ids.push(dy(e)),this.positions.push(n,s,c)}eachPosition(e,n){const s=dy(e);let c=0,d=this.ids.length-1;for(;c<d;){const f=c+d>>1;this.ids[f]>=s?d=f:c=f+1}for(;this.ids[c]===s;)n(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,n){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return mg(s,c,0,s.length-1),n&&(n.add(s.buffer),n.add(c.buffer)),{ids:s,positions:c}}static deserialize(e){const n=new kh;let s;n.ids=e.ids,n.positions=e.positions;for(const c of n.ids)c!==s&&n.uniqueIds.push(c),s=c;return n.indexed=!0,n}}function dy(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ul(String(t))}function mg(t,e,n,s){for(;n<s;){const c=t[n+s>>1];let d=n-1,f=s+1;for(;;){do{d++}while(t[d]<c);do{f--}while(t[f]>c);if(d>=f)break;gg(t,d,f),gg(e,3*d,3*f),gg(e,3*d+1,3*f+1),gg(e,3*d+2,3*f+2)}f-n<s-f?(mg(t,e,n,f),n=f+1):(mg(t,e,f+1,s),s=f)}}function gg(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}Ee(kh,"FeaturePositionMap");class Al{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Kd extends Al{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class il extends Al{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Gc extends Al{constructor(e){super(e),this.current=[0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class _g extends Al{constructor(e){super(e),this.current=[0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class hy extends Al{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class A0 extends Al{constructor(e){super(e),this.current=Br.transparent.toRenderColor(null)}set(e,n,s){this.fetchUniformLocation(e,n)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const tT=new Float32Array(16);class yg extends Al{constructor(e){super(e),this.current=tT}set(e,n,s){if(this.fetchUniformLocation(e,n)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let c=1;c<16;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const fy=new Float32Array(9),Fh=new Float32Array(4);class Vp extends Al{constructor(e){super(e),this.current=Fh}set(e,n,s){if(this.fetchUniformLocation(e,n))for(let c=0;c<4;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}function Nh(t){return[jp(255*t.r,255*t.g),jp(255*t.b,255*t.a)]}class $p{constructor(e,n,s,c){this.value=e,this.uniformNames=n.map(d=>`u_${d}`),this.type=s,this.context=c}setUniform(e,n,s,c,d){const f=c.constantOr(this.value);n.set(e,d,f instanceof Br?f.toRenderColor(this.context.lut):f)}getBinding(e,n){return"color"===this.type?new A0(e):new il(e)}}class vu{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,s,c,d){const f="u_pattern"===d||"u_dash"===d?this.pattern:"u_pixel_ratio"===d?this.pixelRatio:null;f&&n.set(e,d,f)}getBinding(e,n){return"u_pattern"===n||"u_dash"===n?new hy(e):new il(e)}}class id{constructor(e,n,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,s,c,d,f,_){const x=this.paintVertexArray.length,E=this.expression.evaluate(new rr(0,{brightness:f}),n,{},d,c,_);this.paintVertexArray.resize(e),this._setPaintValue(x,e,E,this.context)}updatePaintArray(e,n,s,c,d,f,_){const x=this.expression.evaluate({zoom:0,brightness:_},s,c,void 0,d);this._setPaintValue(e,n,x,this.context)}_setPaintValue(e,n,s,c){if("color"===this.type){const d=Nh(s.toRenderColor(c.lut));for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,d[0],d[1])}else{for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Yl{constructor(e,n,s,c,d,f){this.expression=e,this.uniformNames=n.map(_=>`u_${_}_t`),this.type=s,this.useIntegerZoom=c,this.context=d,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,n,s,c,d,f,_){const x=this.expression.evaluate(new rr(this.context.zoom,{brightness:f}),n,{},d,c,_),E=this.expression.evaluate(new rr(this.context.zoom+1,{brightness:f}),n,{},d,c,_),D=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(D,e,x,E,this.context)}updatePaintArray(e,n,s,c,d,f,_){const x=this.expression.evaluate({zoom:this.context.zoom,brightness:_},s,c,void 0,d),E=this.expression.evaluate({zoom:this.context.zoom+1,brightness:_},s,c,void 0,d);this._setPaintValue(e,n,x,E,this.context)}_setPaintValue(e,n,s,c,d){if("color"===this.type){const f=Nh(s.toRenderColor(d.lut)),_=Nh(s.toRenderColor(d.lut));for(let x=e;x<n;x++)this.paintVertexArray.emplace(x,f[0],f[1],_[0],_[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,s,c,d){const f=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,_=Ut(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);n.set(e,d,_)}getBinding(e,n){return new il(e)}}class Hc{constructor(e,n,s,c,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=("array"===s?pg:fg).members;for(let f=0;f<n.length;++f);this.paintVertexArray=new c}populatePaintArray(e,n,s,c){const d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(d,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,c,d,f,_){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],f)}_setPaintValues(e,n,s,c){if(!c||!s)return;const d=c[s];if(!d)return;const{tl:f,br:_,pixelRatio:x}=d;for(let E=e;E<n;E++)this.paintVertexArray.emplace(E,f[0],f[1],_[0],_[1],x)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Rf{constructor(e,n,s=(()=>!0)){this.binders={},this._buffers=[],this.context=n;const c=[];for(const d in e.paint._values){const f=e.paint.get(d);if(!s(d)||!(f instanceof xo&&jd(f.property.specification)))continue;const _=_b(d,e.type),x=f.value,E=f.property.specification.type,D=!!f.property.useIntegerZoom,S="line-dasharray"===d||d.endsWith("pattern"),P="line-dasharray"===d&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==x.kind||P)if("source"===x.kind||P||S){const F=Gp(d,E,"source");this.binders[d]=S?new Hc(x,_,E,F,e.id):new id(x,_,E,F),c.push(`/a_${d}`)}else{const F=Gp(d,E,"composite");this.binders[d]=new Yl(x,_,E,D,n,F),c.push(`/z_${d}`)}else this.binders[d]=S?new vu(x.value,_):new $p(x.value,_,E,n),c.push(`/u_${d}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof id||n instanceof Yl?n.maxValue:0}populatePaintArrays(e,n,s,c,d,f,_){for(const x in this.binders){const E=this.binders[x];E.context=this.context,(E instanceof id||E instanceof Yl||E instanceof Hc)&&E.populatePaintArray(e,n,s,c,d,f,_)}}setConstantPatternPositions(e){for(const n in this.binders){const s=this.binders[n];s instanceof vu&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,n,s,c,d,f,_,x){let E=!1;const D=Object.keys(e),S=0!==D.length,P=S?D:n.uniqueIds;this.context.lut=d.lut;for(const F in this.binders){const z=this.binders[F];if(z.context=this.context,(z instanceof id||z instanceof Yl||z instanceof Hc)&&(!0===z.expression.isStateDependent||!1===z.expression.isLightConstant)){const $=d.paint.get(F);z.expression=$.value;for(const H of P){const ee=e[H.toString()];n.eachPosition(H,(Pe,Oe,ke)=>{const dt=c.feature(Pe);z.updatePaintArray(Oe,ke,dt,ee,f,_,x)})}if(!S)for(const H of s.uniqueIds){const ee=e[H.toString()];s.eachPosition(H,(Pe,Oe,ke)=>{const dt=c.feature(Pe);z.updatePaintArray(Oe,ke,dt,ee,f,_,x)})}E=!0}}return E}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof $p||s instanceof vu)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof id||s instanceof Yl||s instanceof Hc)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof $p||s instanceof vu||s instanceof Yl)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof $p||c instanceof vu||c instanceof Yl)for(const d of c.uniformNames)n.push({name:d,property:s,binding:c.getBinding(e,d)})}return n}setUniforms(e,n,s,c,d){for(const{name:f,property:_,binding:x}of s)this.binders[_].setUniform(e,x,d,c.get(_),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof id||n instanceof Yl||n instanceof Hc)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof id||s instanceof Yl||s instanceof Hc)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof id||n instanceof Yl||n instanceof Hc)&&n.destroy()}}}class rd{constructor(e,n,s=(()=>!0)){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Rf(c,n,s);this.needsUpload=!1,this._featureMap=new kh,this._featureMapWithoutIds=new kh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,s,c,d,f,_,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(e,n,c,d,f,_,x);void 0!==n.id?this._featureMap.add(n.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,c,d,f){for(const _ of s)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,_,c,d,f||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const P0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function _b(t,e){return P0[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const xu={"line-pattern":{source:Oh,composite:Oh},"fill-pattern":{source:Oh,composite:Oh},"fill-extrusion-pattern":{source:Oh,composite:Oh},"line-dasharray":{source:kp,composite:kp}},yb={color:{source:Pf,composite:td},number:{source:Wd,composite:Pf}};function Gp(t,e,n){const s=xu[t];return s&&s[n]||yb[e][n]}Ee($p,"ConstantBinder"),Ee(vu,"PatternConstantBinder"),Ee(id,"SourceExpressionBinder"),Ee(Hc,"PatternCompositeBinder"),Ee(Yl,"CompositeExpressionBinder"),Ee(Rf,"ProgramConfiguration",{omit:["_buffers"]}),Ee(rd,"ProgramConfigurationSet");const Ca=hi/Math.PI/2,vg=5,Hp=6,py=16383,xg=[64,32,16],Jl=-Ca,Ql=Ca;function Bh(t,e,n,s=Ca){return n=Zi(n),[t*Math.sin(n)*s,-e*s,t*Math.cos(n)*s]}function zh(t,e,n){return Bh(Math.cos(Zi(t)),Math.sin(Zi(t)),e,n)}const od=6371008.8,sd=2*Math.PI*od;class Yr{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Yr(qn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,c=e.lat*n,d=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return od*Math.acos(Math.min(d,1))}toBounds(e=0){const n=360*e/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new ad({lng:this.lng-s,lat:this.lat-n},{lng:this.lng+s,lat:this.lat+n})}toEcef(e){return zh(this.lat,this.lng,Ca+e*Ca/od)}static convert(e){if(e instanceof Yr)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Yr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Yr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ad{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(4===e.length){const s=e;this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]])}else{const s=e;this.setSouthWest(s[0]).setNorthEast(s[1])}}setNorthEast(e){return this._ne=e instanceof Yr?new Yr(e.lng,e.lat):Yr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Yr?new Yr(e.lng,e.lat):Yr.convert(e),this}extend(e){const n=this._sw,s=this._ne;let c,d;if(e instanceof Yr)c=e,d=e;else{if(!(e instanceof ad))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(ad.convert(e)):this.extend(Yr.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Yr.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return n||s?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),s.lng=Math.max(d.lng,s.lng),s.lat=Math.max(d.lat,s.lat)):(this._sw=new Yr(c.lng,c.lat),this._ne=new Yr(d.lng,d.lat)),this}getCenter(){return new Yr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Yr(this.getWest(),this.getNorth())}getSouthEast(){return new Yr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:s}=Yr.convert(e);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){return!e||e instanceof ad?e:new ad(e)}}var my={};!function(n){function s(d,f,_){var x=c(256*d,256*(f=Math.pow(2,_)-f-1),_),E=c(256*(d+1),256*(f+1),_);return x[0]+","+x[1]+","+E[0]+","+E[1]}function c(d,f,_){var x=2*Math.PI*6378137/256/Math.pow(2,_);return[d*x-2*Math.PI*6378137/2,f*x-2*Math.PI*6378137/2]}n.getURL=function(d,f,_,x,E,D){return D=D||{},d+"?"+["bbox="+s(_,x,E),"format="+(D.format||"image/png"),"service="+(D.service||"WMS"),"version="+(D.version||"1.1.1"),"request="+(D.request||"GetMap"),"srs="+(D.srs||"EPSG:3857"),"width="+(D.width||256),"height="+(D.height||256),"layers="+f].join("&")},n.getTileBBox=s,n.getMercCoords=c,Object.defineProperty(n,"__esModule",{value:!0})}(my);var Lf=my;class _c{constructor(e,n,s){this.z=e,this.x=n,this.y=s,this.key=kf(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const s=Lf.getTileBBox(this.x,this.y,this.z),c=function(d,f,_){let x,E="";for(let D=d;D>0;D--)x=1<<D-1,E+=(f&x?1:0)+(_&x?2:0);return E}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class oa{constructor(e,n){this.wrap=e,this.canonical=n,this.key=kf(e,n.z,n.z,n.x,n.y)}}class Os{constructor(e,n,s,c,d){this.overscaledZ=e,this.wrap=n,this.canonical=new _c(s,+c,+d),this.key=0===n&&e===s?this.canonical.key:kf(n,e,s,c,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new Os(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Os(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return kf(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return kf(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Os(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new Os(n,this.wrap,n,s,c),new Os(n,this.wrap,n,s+1,c),new Os(n,this.wrap,n,s,c+1),new Os(n,this.wrap,n,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Os(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Os(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new oa(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function kf(t,e,n,s,c){const d=1<<Math.min(n,22);let f=d*(c%d)+s%d;return t&&n<22&&(f+=d*d*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*f+n)+(e-n)}const gy=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new Os(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new Os(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new Os(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new Os(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Ee(_c,"CanonicalTileID"),Ee(Os,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const vb=0,R0=25.5;function Ff(t){return sd*Math.cos(t*Math.PI/180)}function bu(t){return(180+t)/360}function Wc(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Ia(t,e){return t/Ff(e)}function Ta(t){return 360*t-180}function qs(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function O0(t,e){return t*Ff(qs(e))}const bs=85.051129;function L0(t){return Math.cos(Zi(Ut(t,-bs,bs)))}function Zd(t,e){const n=Ut(e,vb,R0),s=Math.pow(2,n);return L0(t)*sd/(512*s)}function k0(t){return 1/Math.cos(t*Math.PI/180)}function Wp(t,e=0){const n=Math.exp(Math.PI*(1-(t.y+e/hi)/(1<<t.z)*2));return 80150034*n/(n*n+1)/hi/(1<<t.z)}class Da{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=Yr.convert(e);return new Da(bu(s.lng),Wc(s.lat),Ia(n,s.lat))}toLngLat(){return new Yr(Ta(this.x),qs(this.y))}toAltitude(){return O0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/sd*k0(qs(this.y))}}function _y(t,e,n,s,c,d,f,_,x){const E=(e+s)/2,D=(n+c)/2,S=new Ae(E,D);_(S),function(P,F,z,$,H,ee){const Pe=z-H,Oe=$-ee;return Math.abs(($-F)*Pe-(z-P)*Oe)/Math.hypot(Pe,Oe)}(S.x,S.y,d.x,d.y,f.x,f.y)>=x?(_y(t,e,n,E,D,d,S,_,x),_y(t,E,D,s,c,S,f,_,x)):t.push(f)}function xb(t,e,n){let s=t[0],c=s.x,d=s.y;e(s);const f=[s];for(let _=1;_<t.length;_++){const x=t[_],{x:E,y:D}=x;e(x),_y(f,c,d,E,D,s,x,e,n),c=E,d=D,s=x}return f}function bg(t,e,n,s){if(s(e,n)){const c=e.add(n)._mult(.5);bg(t,e,c,s),bg(t,c,n,s)}else t.push(n)}function F0(t,e){let n=t[0];const s=[n];for(let c=1;c<t.length;c++){const d=t[c];bg(s,n,d,e),n=d}return s}const Ys=Math.pow(2,14)-1,bb=-Ys-1;function wb(t,e){const n=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=Ut(n,bb,Ys),t.y=Ut(s,bb,Ys),(n<t.x||n>t.x+1||s<t.y||s>t.y+1)&&Do("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function wu(t,e,n){const s=t.loadGeometry(),c=t.extent,d=hi/c;if(e&&n&&n.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:_,x,y:E,projection:D}=n,S=P=>{const F=Ta((e.x+P.x/c)/f),z=qs((e.y+P.y/c)/f),$=D.project(F,z);P.x=($.x*_-x)*c,P.y=($.y*_-E)*c};for(let P=0;P<s.length;P++)if(1!==t.type)s[P]=xb(s[P],S,1);else{const F=[];for(const z of s[P])z.x<0||z.x>=c||z.y<0||z.y>=c||(S(z),F.push(z));s[P]=F}}for(const f of s)for(const _ of f)wb(_,d);return s}function Eu(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?wu(t):[]}}function yy(t,e,n,s,c){t.emplaceBack(2*e+(s+1)/2,2*n+(c+1)/2)}function Nf(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class ec{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new gc,this.indexArray=new Zs,this.segments=new rs,this.programConfigurations=new rd(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,s,c){const d=this.layers[0],f=[];let _=null;"circle"===d.type&&(_=d.layout.get("circle-sort-key"));for(const{feature:E,id:D,index:S,sourceLayerIndex:P}of e){const F=this.layers[0]._featureFilter.needGeometry,z=Eu(E,F);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),z,s))continue;const $=_?_.evaluate(z,{},s):void 0,H={id:D,properties:E.properties,type:E.type,sourceLayerIndex:P,index:S,geometry:F?z.geometry:wu(E,s,c),patterns:{},sortKey:$};f.push(H)}_&&f.sort((E,D)=>E.sortKey-D.sortKey);let x=null;"globe"===c.projection.name&&(this.globeExtVertexArray=new Fp,x=c.projection);for(const E of f){const{geometry:D,index:S,sourceLayerIndex:P}=E,F=e[S].feature;this.addFeature(E,D,S,n.availableImages,s,x,n.brightness),n.featureIndex.insert(F,D,S,P,this.index)}}update(e,n,s,c,d){const f=0!==Object.keys(e).length;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,f?this.stateDependentLayers:this.layers,s,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Up.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,yu.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,s,c,d,f,_){for(const x of n)for(const E of x){const D=E.x,S=E.y;if(D<0||D>=hi||S<0||S>=hi)continue;if(f){const z=f.projectTilePoint(D,S,d),$=f.upVector(d,D,S),H=this.globeExtVertexArray;Nf(H,z,$),Nf(H,z,$),Nf(H,z,$),Nf(H,z,$)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),F=P.vertexLength;yy(this.layoutVertexArray,D,S,-1,-1),yy(this.layoutVertexArray,D,S,1,-1),yy(this.layoutVertexArray,D,S,1,1),yy(this.layoutVertexArray,D,S,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+2,F+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c,d,_)}}function wg(t,e){for(let n=0;n<t.length;n++)if(Uh(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Uh(t,e[n]))return!0;return!!Eg(t,e)}function Xp(t,e,n){return!!Uh(t,e)||!!B0(e,t,n)}function N0(t,e){if(1===t.length)return Ib(e,t[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let c=0;c<s.length;c++)if(Uh(t,s[c]))return!0}for(let n=0;n<t.length;n++)if(Ib(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Eg(t,e[n]))return!0;return!1}function Eb(t,e,n){if(t.length>1){if(Eg(t,e))return!0;for(let s=0;s<e.length;s++)if(B0(e[s],t,n))return!0}for(let s=0;s<t.length;s++)if(B0(t[s],e,n))return!0;return!1}function Eg(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const s=t[n],c=t[n+1];for(let d=0;d<e.length-1;d++)if(nT(s,c,e[d],e[d+1]))return!0}return!1}function nT(t,e,n,s){return Wr(t,n,s)!==Wr(e,n,s)&&Wr(t,e,n)!==Wr(t,e,s)}function B0(t,e,n){const s=n*n;if(1===e.length)return t.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(Cb(t,e[c-1],e[c])<s)return!0;return!1}function Cb(t,e,n){const s=e.distSqr(n);if(0===s)return t.distSqr(e);const c=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/s;return t.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function Ib(t,e){let n,s,c,d=!1;for(let f=0;f<t.length;f++){n=t[f];for(let _=0,x=n.length-1;_<n.length;x=_++)s=n[_],c=n[x],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(d=!d)}return d}function Uh(t,e){let n=!1;for(let s=0,c=t.length-1;s<t.length;c=s++){const d=t[s],f=t[c];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(n=!n)}return n}function z0(t,e,n,s,c){for(const f of t)if(e<=f.x&&n<=f.y&&s>=f.x&&c>=f.y)return!0;const d=[new Ae(e,n),new Ae(e,c),new Ae(s,c),new Ae(s,n)];if(t.length>2)for(const f of d)if(Uh(t,f))return!0;for(let f=0;f<t.length-1;f++)if(Bf(t[f],t[f+1],d))return!0;return!1}function Bf(t,e,n){const s=n[0],c=n[2];if(t.x<s.x&&e.x<s.x||t.x>c.x&&e.x>c.x||t.y<s.y&&e.y<s.y||t.y>c.y&&e.y>c.y)return!1;const d=Wr(t,e,n[0]);return d!==Wr(t,e,n[1])||d!==Wr(t,e,n[2])||d!==Wr(t,e,n[3])}function Cu(t,e,n,s,c,d){let f=e.y-t.y,_=t.x-e.x;if(d=d||0){const x=f*f+_*_;if(0===x)return!0;const E=Math.sqrt(x);f/=E,_/=E}return!((n.x-t.x)*f+(n.y-t.y)*_-d<0||(s.x-t.x)*f+(s.y-t.y)*_-d<0||(c.x-t.x)*f+(c.y-t.y)*_-d<0)}function Cg(t,e,n,s,c,d,f){return!(Cu(t,e,s,c,d,f)||Cu(e,n,s,c,d,f)||Cu(n,t,s,c,d,f)||Cu(s,c,t,e,n,f)||Cu(c,d,t,e,n,f)||Cu(d,s,t,e,n,f))}function yc(t,e,n){const s=e.paint.get(t).value;return"constant"===s.kind?s.value:n.programConfigurations.get(e.id).getMaxValue(t)}function vy(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function U0(t,e,n,s,c){if(!e[0]&&!e[1])return t;const d=Ae.convert(e)._mult(c);"viewport"===n&&d._rotate(-s);const f=[];for(let _=0;_<t.length;_++)f.push(t[_].sub(d));return f}function Xc(t,e,n,s){const c=Ae.convert(t)._mult(s);return"viewport"===e&&c._rotate(-n),c}Ee(ec,"CircleBucket",{omit:["layers"]});const Tb=new to({"circle-sort-key":new Pi(Jt.layout_circle["circle-sort-key"]),visibility:new Mn(Jt.layout_circle.visibility)});var xy={paint:new to({"circle-radius":new Pi(Jt.paint_circle["circle-radius"]),"circle-color":new Pi(Jt.paint_circle["circle-color"]),"circle-blur":new Pi(Jt.paint_circle["circle-blur"]),"circle-opacity":new Pi(Jt.paint_circle["circle-opacity"]),"circle-translate":new Mn(Jt.paint_circle["circle-translate"]),"circle-translate-anchor":new Mn(Jt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mn(Jt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mn(Jt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Pi(Jt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Pi(Jt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Pi(Jt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Mn(Jt.paint_circle["circle-emissive-strength"])}),layout:Tb};class jh{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,s){const c=a._.dot(n,this.dir);if(Math.abs(c)<1e-6)return!1;const d=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/c;return s[0]=this.pos[0]+this.dir[0]*d,s[1]=this.pos[1]+this.dir[1]*d,s[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,n,s){if(a._.equals(this.pos,e)||0===n)return s[0]=s[1]=s[2]=0,!1;const[c,d,f]=this.dir,_=this.pos[0]-e[0],x=this.pos[1]-e[1],E=this.pos[2]-e[2],D=c*c+d*d+f*f,S=2*(_*c+x*d+E*f),P=S*S-4*D*(_*_+x*x+E*E-n*n);if(P<0){const F=Math.max(-S/2,0),z=_+c*F,$=x+d*F,H=E+f*F,ee=Math.hypot(z,$,H);return s[0]=z*n/ee,s[1]=$*n/ee,s[2]=H*n/ee,!1}{const F=(-S-Math.sqrt(P))/(2*D);if(F<0){const z=Math.hypot(_,x,E);return s[0]=_*n/z,s[1]=x*n/z,s[2]=E*n/z,!1}return s[0]=_+c*F,s[1]=x+d*F,s[2]=E+f*F,!0}}}class by{constructor(e,n,s,c,d){this.TL=e,this.TR=n,this.BR=s,this.BL=c,this.horizon=d}static fromInvProjectionMatrix(e,n,s){const c=[-1,1,1],d=[1,1,1],f=[1,-1,1],_=[-1,-1,1],x=a._.transformMat4(c,c,e),E=a._.transformMat4(d,d,e),D=a._.transformMat4(f,f,e),S=a._.transformMat4(_,_,e);return new by(x,E,D,S,n/s)}}function zf(t,e,n){let s=1/0,c=-1/0;const d=[];for(const f of t){a._.sub(d,f,e);const _=a._.dot(d,n);s=Math.min(s,_),c=Math.max(c,_)}return[s,c]}function wy(t,e){let n=!0;for(let s=0;s<t.planes.length;s++){const c=t.planes[s];let d=0;for(let f=0;f<e.length;f++)d+=a._.dot(c,e[f])+c[3]>=0;if(0===d)return 0;d!==e.length&&(n=!1)}return n?2:1}function Kp(t,e){for(const n of t.projections){const s=zf(e,t.points[0],n.axis);if(n.projection[1]<s[0]||n.projection[0]>s[1])return 0}return 1}function Zp(t,e){let n=0;const s=[0,0,0,0];for(let c=0;c<t.length;c++)s[0]=t[c][0],s[1]=t[c][1],s[2]=t[c][2],s[3]=1,a.aA.dot(s,e)>=0&&n++;return n}class qp{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=es.fromPoints(this.points),this.projections=[],this.frustumEdges=[a._.sub([],this.points[2],this.points[3]),a._.sub([],this.points[0],this.points[3]),a._.sub([],this.points[4],this.points[0]),a._.sub([],this.points[5],this.points[1]),a._.sub([],this.points[6],this.points[2]),a._.sub([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const c=[0,-s[2],s[1]],d=[s[2],0,-s[0]];this.projections.push({axis:c,projection:zf(this.points,this.points[0],c)}),this.projections.push({axis:d,projection:zf(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,n,s,c){const d=Math.pow(2,s),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const D=a.aA.transformMat4([],E,e),S=1/D[3]/n*d;return a.aA.mul(D,D,[S,S,c?1/D[3]:S,S])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const D=a._.sub([],f[E[0]],f[E[1]]),S=a._.sub([],f[E[2]],f[E[1]]),P=a._.normalize([],a._.cross([],D,S)),F=-a._.dot(P,f[E[1]]);return P.concat(F)}),x=[];for(let E=0;E<f.length;E++)x.push([f[E][0],f[E][1],f[E][2]]);return new qp(x,_)}intersectsPrecise(e,n,s){for(let c=0;c<n.length;c++)if(!Zp(e,n[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!Zp(e,this.planes[c]))return 0;for(const c of s)for(const d of this.frustumEdges){const f=a._.cross([],c,d),_=a._.length(f);if(0===_)continue;a._.scale(f,f,1/_);const x=zf(this.points,this.points[0],f),E=zf(e,this.points[0],f);if(x[0]>E[1]||E[0]>x[1])return 0}return 1}}class es{static fromPoints(e){const n=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const c of e)a._.min(n,n,c),a._.max(s,s,c);return new es(n,s)}static fromTileIdAndHeight(e,n,s){const c=1<<e.canonical.z,d=e.canonical.x,f=e.canonical.y;return new es([d/c,f/c,n],[(d+1)/c,(f+1)/c,s])}static applyTransform(e,n){const s=e.getCorners();for(let c=0;c<s.length;++c)a._.transformMat4(s[c],s[c],n);return es.fromPoints(s)}static applyTransformFast(e,n){const s=[n[12],n[13],n[14]],c=[...s];for(let d=0;d<3;d++)for(let f=0;f<3;f++){const _=n[4*f+d],x=_*e.min[f],E=_*e.max[f];s[d]+=Math.min(x,E),c[d]+=Math.max(x,E)}return new es(s,c)}static projectAabbCorners(e,n){const s=e.getCorners();for(let c=0;c<s.length;++c)a._.transformMat4(s[c],s[c],n);return s}constructor(e,n){this.min=e,this.max=n,this.center=a._.scale([],a._.add([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],s=a._.clone(this.min),c=a._.clone(this.max);for(let d=0;d<n.length;d++)s[d]=n[d]?this.min[d]:this.center[d],c[d]=n[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new es(s,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?wy(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?wy(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?Kp(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?Kp(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Ee(es,"Aabb");const Db=oo([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ig}=Db,Ey=oo([{name:"a_pos_3",components:3,type:"Int16"}]);var Yp=oo([{name:"a_pos",type:"Int16",components:2}]);function Tg(t){return t*Ca/od}const Pl=[new es([Jl,Jl,Jl],[Ql,Ql,Ql]),new es([Jl,Jl,Jl],[0,0,Ql]),new es([0,Jl,Jl],[Ql,0,Ql]),new es([Jl,0,Jl],[0,Ql,Ql]),new es([0,0,Jl],[Ql,Ql,Ql])];function Dg(t,e,n,s=!0){const c=a._.scale([],t._camera.position,t.worldSize),d=[e,n,1,1];a.aA.transformMat4(d,d,t.pixelMatrixInverse),a.aA.scale(d,d,1/d[3]);const f=a._.sub([],d,c),_=a._.normalize([],f),x=t.globeMatrix,E=[x[12],x[13],x[14]],D=a._.sub([],E,c),S=a._.length(D),P=a._.normalize([],D),F=t.worldSize/(2*Math.PI),z=a._.dot(P,_),$=Math.asin(F/S);if($<Math.acos(z)){if(!s)return null;const dn=[],Fn=[];a._.scale(dn,_,S/z),a._.normalize(Fn,a._.sub(Fn,dn,D)),a._.normalize(_,a._.add(_,D,a._.scale(_,Fn,Math.tan($)*S)))}const H=[];new jh(c,_).closestPointOnSphere(E,F,H);const ee=a._.normalize([],fo(x,0)),Pe=a._.normalize([],fo(x,1)),Oe=a._.normalize([],fo(x,2)),ke=a._.dot(ee,H),dt=a._.dot(Pe,H),st=a._.dot(Oe,H),Dt=Ro(Math.asin(-dt/F));let kt=Ro(Math.atan2(ke,st));kt=t.center.lng+function(dn,Fn){const Yn=(Fn-dn+180)%360-180;return Yn<-180?Yn+360:Yn}(t.center.lng,kt);const Yt=bu(kt),yn=Ut(Wc(Dt),0,1);return new Da(Yt,yn)}class j0{constructor(e,n,s){this.a=a._.sub([],e,s),this.b=a._.sub([],n,s),this.center=s;const c=a._.normalize([],this.a),d=a._.normalize([],this.b);this.angle=Math.acos(a._.dot(c,d))}}function Uf(t,e){if(0===t.angle)return null;let n;return n=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(s,c,d,f){const _=Math.sin(d);return s*(Math.sin((1-f)*d)/_)+c*(Math.sin(f*d)/_)}(t.a[e],t.b[e],t.angle,Ut(n,0,1))+t.center[e]}function ld(t){if(t.z<=1)return Pl[t.z+2*t.y+t.x];const e=Iy(Jp(t));return es.fromPoints(e)}function qd(t,e,n){return a._.scale(t,t,1-n),a._.scaleAndAdd(t,t,e,n)}function za(t,e){const n=cd(e.zoom);if(0===n)return ld(t);const s=Jp(t),c=Iy(s),d=bu(s.getWest())*e.worldSize,f=bu(s.getEast())*e.worldSize,_=Wc(s.getNorth())*e.worldSize,x=Wc(s.getSouth())*e.worldSize,E=[d,_,0],D=[f,_,0],S=[d,x,0],P=[f,x,0],F=a.ad.invert([],e.globeMatrix);return a._.transformMat4(E,E,F),a._.transformMat4(D,D,F),a._.transformMat4(S,S,F),a._.transformMat4(P,P,F),c[0]=qd(c[0],S,n),c[1]=qd(c[1],P,n),c[2]=qd(c[2],D,n),c[3]=qd(c[3],E,n),es.fromPoints(c)}function Vh(t,e,n){for(const s of t)a._.transformMat4(s,s,e),a._.scale(s,s,n)}function Cy(t,e,n,s){const c=e/t.worldSize,d=t.globeMatrix;if(n.z<=1){const Yt=ld(n).getCorners();return Vh(Yt,d,c),es.fromPoints(Yt)}const f=Jp(n,s),_=Iy(f,Ca+Tg(t._tileCoverLift));Vh(_,d,c);const x=Number.MAX_VALUE,E=[-x,-x,-x],D=[x,x,x];if(f.contains(t.center)){for(const dn of _)a._.min(D,D,dn),a._.max(E,E,dn);E[2]=0;const Yt=t.point,yn=[Yt.x*c,Yt.y*c,0];return a._.min(D,D,yn),a._.max(E,E,yn),new es(D,E)}if(t._tileCoverLift>0){for(const Yt of _)a._.min(D,D,Yt),a._.max(E,E,Yt);return new es(D,E)}const S=[d[12]*c,d[13]*c,d[14]*c],P=f.getCenter(),F=Ut(t.center.lat,-bs,bs),z=Ut(P.lat,-bs,bs),$=bu(t.center.lng),H=Wc(F);let ee=$-bu(P.lng);const Pe=H-Wc(z);ee>.5?ee-=1:ee<-.5&&(ee+=1);let Oe=0;if(Math.abs(ee)>Math.abs(Pe))Oe=ee>=0?1:3;else{Oe=Pe>=0?0:2;const Yt=[d[4]*c,d[5]*c,d[6]*c],yn=-Math.sin(Zi(Pe>=0?f.getSouth():f.getNorth()))*Ca;a._.scaleAndAdd(S,S,Yt,yn)}const ke=_[Oe],dt=_[(Oe+1)%4],st=new j0(ke,dt,S),Dt=[Uf(st,0)||ke[0],Uf(st,1)||ke[1],Uf(st,2)||ke[2]],kt=cd(t.zoom);if(kt>0){const Yt=function({x:dn,y:Fn,z:Yn},Sn,Wn,xn,Hn){const ni=1/(1<<Yn);let Zn=dn*ni,Si=Zn+ni,Qn=Fn*ni,ci=Qn+ni,Qi=0;const $i=(Zn+Si)/2-xn;return $i>.5?Qi=-1:$i<-.5&&(Qi=1),Zn=((Zn+Qi)*Sn-(xn*=Sn))*Wn+xn,Si=((Si+Qi)*Sn-xn)*Wn+xn,Qn=(Qn*Sn-(Hn*=Sn))*Wn+Hn,ci=(ci*Sn-Hn)*Wn+Hn,[[Zn,ci,0],[Si,ci,0],[Si,Qn,0],[Zn,Qn,0]]}(n,e,t._pixelsPerMercatorPixel,$,H);for(let dn=0;dn<_.length;dn++)qd(_[dn],Yt[dn],kt);const yn=a._.add([],Yt[Oe],Yt[(Oe+1)%4]);a._.scale(yn,yn,.5),qd(Dt,yn,kt)}for(const Yt of _)a._.min(D,D,Yt),a._.max(E,E,Yt);return D[2]=Math.min(ke[2],dt[2]),a._.min(D,D,Dt),a._.max(E,E,Dt),new es(D,E)}function Jp({x:t,y:e,z:n},s=!1){const c=1/(1<<n),d=new Yr(Ta(t*c),e===(1<<n)-1&&s?-90:qs((e+1)*c)),f=new Yr(Ta((t+1)*c),0===e&&s?90:qs(e*c));return new ad(d,f)}function Iy(t,e=Ca){const n=Zi(t.getNorth()),s=Zi(t.getSouth()),c=Math.cos(n),d=Math.cos(s),f=Math.sin(n),_=Math.sin(s),x=t.getWest(),E=t.getEast();return[Bh(d,_,x,e),Bh(d,_,E,e),Bh(c,f,E,e),Bh(c,f,x,e)]}function jf(t,e,n,s){const c=1<<n.z,d=(t/hi+n.x)/c;return zh(qs((e/hi+n.y)/c),Ta(d),s)}function Mg({min:t,max:e}){return py/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Ty=new Float64Array(16);function Qp(t){const e=Mg(t),n=a.ad.fromScaling(Ty,[e,e,e]);return a.ad.translate(n,n,a._.negate([],t.min))}function Sg(t){const e=a.ad.fromTranslation(Ty,t.min),n=1/Mg(t);return a.ad.scale(e,e,[n,n,n])}function Dy(t){const e=hi/(2*Math.PI);return t/(2*Math.PI)/e}function V0(t,e){return hi/(512*Math.pow(2,t))*Mg(ld(e))}function $0(t,e,n,s,c){const d=Dy(n),f=[t,e,-n/(2*Math.PI)],_=a.ad.identity(new Float64Array(16));return a.ad.translate(_,_,f),a.ad.scale(_,_,[d,d,d]),a.ad.rotateX(_,_,Zi(-c)),a.ad.rotateY(_,_,Zi(-s)),_}function cd(t){return ln(vg,Hp,t)}function My(t,e){const n=zh(e.lat,e.lng),s=function(d){const f=zh(d._center.lat,d._center.lng),_=a._.fromValues(0,1,0);let x=a._.cross([],_,f);const E=a.ad.fromRotation([],-d.angle,f);x=a._.transformMat4(x,x,E),a.ad.fromRotation(E,-d._pitch,x);const D=a._.normalize([],f);return a._.scale(D,D,Tg(d.cameraToCenterDistance/d.pixelsPerMeter)),a._.transformMat4(D,D,E),a._.add([],f,D)}(t),c=a._.subtract([],s,n);return a._.angle(c,n)}function Ag(t,e){return My(t,e)>Math.PI/2*1.01}const Sy=Zi(85),Pg=Math.cos(Sy),G0=Math.sin(Sy),H0=a.ad.create(),Ay=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e};function Py(t,e,n,s,c,d,f,_,x){if(d&&t.queryGeometry.isAboveHorizon)return!1;d&&(x*=t.pixelToTileUnitsFactor);const E=t.tileID.canonical,D=n.projection.upVectorScale(E,n.center.lat,n.worldSize).metersToTile;for(const S of e)for(const P of S){const F=P.add(_),z=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(F.x,F.y,!0):0,$=n.projection.projectTilePoint(F.x,F.y,E);if(z>0){const Oe=n.projection.upVector(E,F.x,F.y);$.x+=Oe[0]*D*z,$.y+=Oe[1]*D*z,$.z+=Oe[2]*D*z}const H=d?F:Mb($.x,$.y,$.z,s),ee=d?t.tilespaceRays.map(Oe=>Ab(Oe,z)):t.queryGeometry.screenGeometry,Pe=a.aA.transformMat4([],[$.x,$.y,$.z,1],s);if(!f&&d?x*=Pe[3]/n.cameraToCenterDistance:f&&!d&&(x*=n.cameraToCenterDistance/Pe[3]),d){const Oe=qs((P.y/hi+E.y)/(1<<E.z));x/=n.projection.pixelsPerMeter(Oe,1)/Ia(1,Oe)}if(Xp(ee,H,x))return!0}return!1}function Mb(t,e,n,s){const c=a.aA.transformMat4([],[t,e,n,1],s);return new Ae(c[0]/c[3],c[1]/c[3])}const W0=a._.fromValues(0,0,0),Sb=a._.fromValues(0,0,1);function Ab(t,e){const n=a._.create();return W0[2]=e,t.intersectsPlane(W0,Sb,n),new Ae(n[0],n[1])}class Ry extends ec{}function Pb(t,{width:e,height:n},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*s)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*s);return t.width=e,t.height=n,t.data=c,t}function Oy(t,e,n){const{width:s,height:c}=e;s===t.width&&c===t.height||(Ly(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,c)},n,null),t.width=s,t.height=c,t.data=e.data)}function Ly(t,e,n,s,c,d,f,_){if(0===c.width||0===c.height)return e;if(c.width>t.width||c.height>t.height||n.x>t.width-c.width||n.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const x=t.data,E=e.data,D=4===d&&_;for(let S=0;S<c.height;S++){const P=((n.y+S)*t.width+n.x)*d,F=((s.y+S)*e.width+s.x)*d;if(D)for(let z=0;z<c.width;z++){const $=P+z*d+3,H=F+z*d;E[H+0]=255,E[H+1]=255,E[H+2]=255,E[H+3]=x[$]}else if(f)for(let z=0;z<c.width;z++){const $=P+z*d,H=F+z*d,ee=x[$+3],Pe=new Br(x[$+0]/255*ee,x[$+1]/255*ee,x[$+2]/255*ee,ee).toRenderColor(f).toArray();E[H+0]=Pe[0],E[H+1]=Pe[1],E[H+2]=Pe[2],E[H+3]=Pe[3]}else for(let z=0;z<c.width*d;z++)E[F+z]=x[P+z]}return e}Ee(Ry,"HeatmapBucket",{omit:["layers"]});class Yd{constructor(e,n){Pb(this,e,1,n)}resize(e){Oy(this,new Yd(e),1)}clone(){return new Yd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,c,d){Ly(e,n,s,c,d,1,null)}}class vc{constructor(e,n){Pb(this,e,4,n)}resize(e){Oy(this,new vc(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new vc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,c,d,f,_){Ly(e,n,s,c,d,4,f,_)}}class X0{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}Ee(Yd,"AlphaImage"),Ee(vc,"RGBAImage");const K0=new to({visibility:new Mn(Jt.layout_heatmap.visibility)});var ky={paint:new to({"heatmap-radius":new Pi(Jt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Pi(Jt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mn(Jt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zs(Jt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mn(Jt.paint_heatmap["heatmap-opacity"])}),layout:K0};function em(t){const e={},n=t.resolution||256,s=t.clips?t.clips.length:1,c=t.image||new vc({width:n,height:s}),d=(f,_,x)=>{e[t.evaluationKey]=x;const E=t.expression.evaluate(e);E&&(c.data[f+_+0]=Math.floor(255*E.r/E.a),c.data[f+_+1]=Math.floor(255*E.g/E.a),c.data[f+_+2]=Math.floor(255*E.b/E.a),c.data[f+_+3]=Math.floor(255*E.a))};if(t.clips)for(let f=0,_=0;f<s;++f,_+=4*n)for(let x=0,E=0;x<n;x++,E+=4){const D=x/(n-1),{start:S,end:P}=t.clips[f];d(_,E,S*(1-D)+P*D)}else for(let f=0,_=0;f<n;f++,_+=4)d(0,_,f/(n-1));return c}const Jd=new to({visibility:new Mn(Jt.layout_hillshade.visibility)});var Rg={paint:new to({"hillshade-illumination-direction":new Mn(Jt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Mn(Jt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mn(Jt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mn(Jt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mn(Jt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mn(Jt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Mn(Jt.paint_hillshade["hillshade-emissive-strength"])}),layout:Jd};const Rb=oo([{name:"a_pos",components:2,type:"Int16"}],4),{members:Z0}=Rb;function $h(t,e,n=2){const s=e&&e.length,c=s?e[0]*n:t.length;let d=Ob(t,0,c,n,!0);const f=[];if(!d||d.next===d.prev)return f;let _,x,E;if(s&&(d=function(D,S,P,F){const z=[];for(let $=0,H=S.length;$<H;$++){const ee=Ob(D,S[$]*F,$<H-1?S[$+1]*F:D.length,F,!1);ee===ee.next&&(ee.steiner=!0),z.push($f(ee))}z.sort(Og);for(let $=0;$<z.length;$++)P=Fb(z[$],P);return P}(t,e,d,n)),t.length>80*n){_=1/0,x=1/0;let D=-1/0,S=-1/0;for(let P=n;P<c;P+=n){const F=t[P],z=t[P+1];F<_&&(_=F),z<x&&(x=z),F>D&&(D=F),z>S&&(S=z)}E=Math.max(D-_,S-x),E=0!==E?32767/E:0}return tm(d,f,n,_,x,E,0),f}function Ob(t,e,n,s,c){let d;if(c===function(f,_,x,E){let D=0;for(let S=_,P=x-E;S<x;S+=E)D+=(f[P]-f[S])*(f[S+1]+f[P+1]),P=S;return D}(t,e,n,s)>0)for(let f=e;f<n;f+=s)d=Nb(f/s|0,t[f],t[f+1],d);else for(let f=n-s;f>=e;f-=s)d=Nb(f/s|0,t[f],t[f+1],d);return d&&Gh(d,d.next)&&(Xh(d),d=d.next),d}function Vf(t,e){if(!t)return t;e||(e=t);let n,s=t;do{if(n=!1,s.steiner||!Gh(s,s.next)&&0!==ys(s.prev,s,s.next))s=s.next;else{if(Xh(s),s=e=s.prev,s===s.next)break;n=!0}}while(n||s!==e);return e}function tm(t,e,n,s,c,d,f){if(!t)return;!f&&d&&function(x,E,D,S){let P=x;do{0===P.z&&(P.z=nm(P.x,P.y,E,D,S)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next}while(P!==x);P.prevZ.nextZ=null,P.prevZ=null,function(F){let z,$=1;do{let H,ee=F;F=null;let Pe=null;for(z=0;ee;){z++;let Oe=ee,ke=0;for(let st=0;st<$&&(ke++,Oe=Oe.nextZ,Oe);st++);let dt=$;for(;ke>0||dt>0&&Oe;)0!==ke&&(0===dt||!Oe||ee.z<=Oe.z)?(H=ee,ee=ee.nextZ,ke--):(H=Oe,Oe=Oe.nextZ,dt--),Pe?Pe.nextZ=H:F=H,H.prevZ=Pe,Pe=H;ee=Oe}Pe.nextZ=null,$*=2}while(z>1)}(P)}(t,s,c,d);let _=t;for(;t.prev!==t.next;){const x=t.prev,E=t.next;if(d?kb(t,s,c,d):Lb(t))e.push(x.i,t.i,E.i),Xh(t),t=E.next,_=E.next;else if((t=E)===_){f?1===f?tm(t=iT(Vf(t),e),e,n,s,c,d,2):2===f&&rT(t,e,n,s,c,d):tm(Vf(t),e,n,s,c,d,1);break}}}function Lb(t){const e=t.prev,n=t,s=t.next;if(ys(e,n,s)>=0)return!1;const c=e.x,d=n.x,f=s.x,_=e.y,x=n.y,E=s.y,D=c<d?c<f?c:f:d<f?d:f,S=_<x?_<E?_:E:x<E?x:E,P=c>d?c>f?c:f:d>f?d:f,F=_>x?_>E?_:E:x>E?x:E;let z=s.next;for(;z!==e;){if(z.x>=D&&z.x<=P&&z.y>=S&&z.y<=F&&ud(c,_,d,x,f,E,z.x,z.y)&&ys(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function kb(t,e,n,s){const c=t.prev,d=t,f=t.next;if(ys(c,d,f)>=0)return!1;const _=c.x,x=d.x,E=f.x,D=c.y,S=d.y,P=f.y,F=_<x?_<E?_:E:x<E?x:E,z=D<S?D<P?D:P:S<P?S:P,$=_>x?_>E?_:E:x>E?x:E,H=D>S?D>P?D:P:S>P?S:P,ee=nm(F,z,e,n,s),Pe=nm($,H,e,n,s);let Oe=t.prevZ,ke=t.nextZ;for(;Oe&&Oe.z>=ee&&ke&&ke.z<=Pe;){if(Oe.x>=F&&Oe.x<=$&&Oe.y>=z&&Oe.y<=H&&Oe!==c&&Oe!==f&&ud(_,D,x,S,E,P,Oe.x,Oe.y)&&ys(Oe.prev,Oe,Oe.next)>=0||(Oe=Oe.prevZ,ke.x>=F&&ke.x<=$&&ke.y>=z&&ke.y<=H&&ke!==c&&ke!==f&&ud(_,D,x,S,E,P,ke.x,ke.y)&&ys(ke.prev,ke,ke.next)>=0))return!1;ke=ke.nextZ}for(;Oe&&Oe.z>=ee;){if(Oe.x>=F&&Oe.x<=$&&Oe.y>=z&&Oe.y<=H&&Oe!==c&&Oe!==f&&ud(_,D,x,S,E,P,Oe.x,Oe.y)&&ys(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.prevZ}for(;ke&&ke.z<=Pe;){if(ke.x>=F&&ke.x<=$&&ke.y>=z&&ke.y<=H&&ke!==c&&ke!==f&&ud(_,D,x,S,E,P,ke.x,ke.y)&&ys(ke.prev,ke,ke.next)>=0)return!1;ke=ke.nextZ}return!0}function iT(t,e){let n=t;do{const s=n.prev,c=n.next.next;!Gh(s,c)&&Hh(s,n,n.next,c)&&dd(s,c)&&dd(c,s)&&(e.push(s.i,n.i,c.i),Xh(n),Xh(n.next),n=t=c),n=n.next}while(n!==t);return Vf(n)}function rT(t,e,n,s,c,d){let f=t;do{let _=f.next.next;for(;_!==f.prev;){if(f.i!==_.i&&Ny(f,_)){let x=Lg(f,_);return f=Vf(f,f.next),x=Vf(x,x.next),tm(f,e,n,s,c,d,0),void tm(x,e,n,s,c,d,0)}_=_.next}f=f.next}while(f!==t)}function Og(t,e){return t.x-e.x}function Fb(t,e){const n=function(c,d){let f=d;const _=c.x,x=c.y;let E,D=-1/0;do{if(x<=f.y&&x>=f.next.y&&f.next.y!==f.y){const $=f.x+(x-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if($<=_&&$>D&&(D=$,E=f.x<f.next.x?f:f.next,$===_))return E}f=f.next}while(f!==d);if(!E)return null;const S=E,P=E.x,F=E.y;let z=1/0;f=E;do{if(_>=f.x&&f.x>=P&&_!==f.x&&ud(x<F?_:D,x,P,F,x<F?D:_,x,f.x,f.y)){const $=Math.abs(x-f.y)/(_-f.x);dd(f,c)&&($<z||$===z&&(f.x>E.x||f.x===E.x&&Fy(E,f)))&&(E=f,z=$)}f=f.next}while(f!==S);return E}(t,e);if(!n)return e;const s=Lg(n,t);return Vf(s,s.next),Vf(n,n.next)}function Fy(t,e){return ys(t.prev,t,e.prev)<0&&ys(e.next,t,t.next)<0}function nm(t,e,n,s,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $f(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function ud(t,e,n,s,c,d,f,_){return(c-f)*(e-_)>=(t-f)*(d-_)&&(t-f)*(s-_)>=(n-f)*(e-_)&&(n-f)*(d-_)>=(c-f)*(s-_)}function Ny(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,s){let c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==s.i&&c.next.i!==s.i&&Hh(c,c.next,n,s))return!0;c=c.next}while(c!==n);return!1}(t,e)&&(dd(t,e)&&dd(e,t)&&function(n,s){let c=n,d=!1;const f=(n.x+s.x)/2,_=(n.y+s.y)/2;do{c.y>_!=c.next.y>_&&c.next.y!==c.y&&f<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next}while(c!==n);return d}(t,e)&&(ys(t.prev,t,e.prev)||ys(t,e.prev,e))||Gh(t,e)&&ys(t.prev,t,t.next)>0&&ys(e.prev,e,e.next)>0)}function ys(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Gh(t,e){return t.x===e.x&&t.y===e.y}function Hh(t,e,n,s){const c=Wh(ys(t,e,n)),d=Wh(ys(t,e,s)),f=Wh(ys(n,s,t)),_=Wh(ys(n,s,e));return c!==d&&f!==_||!(0!==c||!Gf(t,n,e))||!(0!==d||!Gf(t,s,e))||!(0!==f||!Gf(n,t,s))||!(0!==_||!Gf(n,e,s))}function Gf(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Wh(t){return t>0?1:t<0?-1:0}function dd(t,e){return ys(t.prev,t,t.next)<0?ys(t,e,t.next)>=0&&ys(t,t.prev,e)>=0:ys(t,e,t.prev)<0||ys(t,t.next,e)<0}function Lg(t,e){const n=Kh(t.i,t.x,t.y),s=Kh(e.i,e.x,e.y),c=t.next,d=e.prev;return t.next=e,e.prev=t,n.next=c,c.prev=n,s.next=n,n.prev=s,d.next=s,s.prev=d,s}function Nb(t,e,n,s){const c=Kh(t,e,n);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function Xh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Kh(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function kg(t,e){const n=t.length;if(n<=1)return[t];const s=[];let c,d;for(let f=0;f<n;f++){const _=ea(t[f]);0!==_&&(t[f].area=Math.abs(_),void 0===d&&(d=_<0),d===_<0?(c&&s.push(c),c=[t[f]]):c.push(t[f]))}if(c&&s.push(c),e>1)for(let f=0;f<s.length;f++)s[f].length<=e||(yf(s[f],e,1,s[f].length-1,q0),s[f]=s[f].slice(0,e));return s}function q0(t,e){return e.area-t.area}function By(t,e,n){const s=n.patternDependencies;let c=!1;for(const d of e){const f=d.paint.get(`${t}-pattern`);f.isConstant()||(c=!0);const _=f.constantOr(null);_&&(c=!0,s[_]=!0)}return c}function zy(t,e,n,s,c){const d=c.patternDependencies;for(const f of e){const _=f.paint.get(`${t}-pattern`).value;if("constant"!==_.kind){let x=_.evaluate({zoom:s},n,{},c.availableImages);x=x&&x.name?x.name:x,d[x]=!0,n.patterns[f.id]=x}}return n}class Hf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new gc,this.indexArray=new Zs,this.indexArray2=new wa,this.programConfigurations=new rd(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new rs,this.segments2=new rs,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,s,c){this.hasPattern=By("fill",this.layers,n);const d=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:_,id:x,index:E,sourceLayerIndex:D}of e){const S=this.layers[0]._featureFilter.needGeometry,P=Eu(_,S);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),P,s))continue;const F=d?d.evaluate(P,{},s,n.availableImages):void 0,z={id:x,properties:_.properties,type:_.type,sourceLayerIndex:D,index:E,geometry:S?P.geometry:wu(_,s,c),patterns:{},sortKey:F};f.push(z)}d&&f.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of f){const{geometry:x,index:E,sourceLayerIndex:D}=_;if(this.hasPattern){const S=zy("fill",this.layers,_,this.zoom,n);this.patternFeatures.push(S)}else this.addFeature(_,x,E,s,{},n.availableImages,n.brightness);n.featureIndex.insert(e[E].feature,x,E,D,this.index)}}update(e,n,s,c,d){const f=0!==Object.keys(e).length;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,f?this.stateDependentLayers:this.layers,s,c,d)}addFeatures(e,n,s,c,d,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,s,c,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Z0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,c,d,f=[],_){for(const x of kg(n,500)){let E=0;for(const $ of x)E+=$.length;const D=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),S=D.vertexLength,P=[],F=[];for(const $ of x){if(0===$.length)continue;$!==x[0]&&F.push(P.length/2);const H=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),ee=H.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(ee+$.length-1,ee),P.push($[0].x),P.push($[0].y);for(let Pe=1;Pe<$.length;Pe++)this.layoutVertexArray.emplaceBack($[Pe].x,$[Pe].y),this.indexArray2.emplaceBack(ee+Pe-1,ee+Pe),P.push($[Pe].x),P.push($[Pe].y);H.vertexLength+=$.length,H.primitiveLength+=$.length}const z=$h(P,F);for(let $=0;$<z.length;$+=3)this.indexArray.emplaceBack(S+z[$],S+z[$+1],S+z[$+2]);D.vertexLength+=E,D.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,f,c,_)}}Ee(Hf,"FillBucket",{omit:["layers","patternFeatures"]});const Y0=new to({"fill-sort-key":new Pi(Jt.layout_fill["fill-sort-key"]),visibility:new Mn(Jt.layout_fill.visibility)});var Bb={paint:new to({"fill-antialias":new Mn(Jt.paint_fill["fill-antialias"]),"fill-opacity":new Pi(Jt.paint_fill["fill-opacity"]),"fill-color":new Pi(Jt.paint_fill["fill-color"]),"fill-outline-color":new Pi(Jt.paint_fill["fill-outline-color"]),"fill-translate":new Mn(Jt.paint_fill["fill-translate"]),"fill-translate-anchor":new Mn(Jt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Pi(Jt.paint_fill["fill-pattern"]),"fill-emissive-strength":new Mn(Jt.paint_fill["fill-emissive-strength"])}),layout:Y0};class Uy{constructor(e,n,s,c){if(this.triangleCount=n.length/3,this.min=new Ae(0,0),this.max=new Ae(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length)return;const[d,f]=[e[0].clone(),e[0].clone()];for(let S=1;S<e.length;++S){const P=e[S];d.x=Math.min(d.x,P.x),d.y=Math.min(d.y,P.y),f.x=Math.max(f.x,P.x),f.y=Math.max(f.y,P.y)}if(c){const S=Math.ceil(Math.max(f.x-d.x,f.y-d.y)/c);s=Math.max(s,S)}if(0===s)return;this.min=d,this.max=f;const _=this.max.sub(this.min);_.x=Math.max(_.x,1),_.y=Math.max(_.y,1);const x=Math.max(_.x,_.y)/s;this.cellsX=Math.max(1,Math.ceil(_.x/x)),this.cellsY=Math.max(1,Math.ceil(_.y/x)),this.xScale=1/x,this.yScale=1/x;const E=[];for(let S=0;S<this.triangleCount;S++){const P=e[n[3*S+0]].sub(this.min),F=e[n[3*S+1]].sub(this.min),z=e[n[3*S+2]].sub(this.min),$=Rl(Math.floor(Math.min(P.x,F.x,z.x)),this.xScale,this.cellsX),H=Rl(Math.floor(Math.max(P.x,F.x,z.x)),this.xScale,this.cellsX),ee=Rl(Math.floor(Math.min(P.y,F.y,z.y)),this.yScale,this.cellsY),Pe=Rl(Math.floor(Math.max(P.y,F.y,z.y)),this.yScale,this.cellsY),Oe=new Ae(0,0),ke=new Ae(0,0),dt=new Ae(0,0),st=new Ae(0,0);for(let Dt=ee;Dt<=Pe;++Dt){Oe.y=ke.y=Dt*x,dt.y=st.y=(Dt+1)*x;for(let kt=$;kt<=H;++kt)Oe.x=dt.x=kt*x,ke.x=st.x=(kt+1)*x,(Cg(P,F,z,Oe,ke,st)||Cg(P,F,z,Oe,st,dt))&&E.push({cellIdx:Dt*this.cellsX+kt,triIdx:S})}}if(0===E.length)return;E.sort((S,P)=>S.cellIdx-P.cellIdx||S.triIdx-P.triIdx);let D=0;for(;D<E.length;){const S=E[D].cellIdx,P={start:this.payload.length,len:0};for(;D<E.length&&E[D].cellIdx===S;)++P.len,this.payload.push(E[D++].triIdx);this.cells[S]=P}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(0===this.triangleCount||0===this.cells.length||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const s=Rl(e.x-this.min.x,this.xScale,this.cellsX),c=Rl(e.y-this.min.y,this.yScale,this.cellsY),d=this.cells[c*this.cellsX+s];if(d){this._lazyInitLookup();for(let f=0;f<d.len;f++){const _=this.payload[d.start+f],x=Math.floor(_/8),E=1<<_%8;if(!(this.lookup[x]&E)&&(this.lookup[x]|=E,n.push(_),n.length===this.triangleCount))return}}}query(e,n,s){if(0===this.triangleCount||0===this.cells.length||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();const c=Rl(e.x-this.min.x,this.xScale,this.cellsX),d=Rl(n.x-this.min.x,this.xScale,this.cellsX),f=Rl(e.y-this.min.y,this.yScale,this.cellsY),_=Rl(n.y-this.min.y,this.yScale,this.cellsY);for(let x=f;x<=_;x++)for(let E=c;E<=d;E++){const D=this.cells[x*this.cellsX+E];if(D)for(let S=0;S<D.len;S++){const P=this.payload[D.start+S],F=Math.floor(P/8),z=1<<P%8;if(!(this.lookup[F]&z)&&(this.lookup[F]|=z,s.push(P),s.length===this.triangleCount))return}}}}function Rl(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}Ee(Uy,"TriangleGridIndex");class jy{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(const s of this.footprints)n.push({footprint:s,id:e})}populate(e,n,s,c){const d=[];for(const{feature:f,id:_,index:x,sourceLayerIndex:E}of e){const D=this.layers[0]._featureFilter.needGeometry,S=Eu(f,D);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),S,s))continue;const P={id:_,properties:f.properties,type:f.type,sourceLayerIndex:E,index:x,geometry:D?S.geometry:wu(f,s,c),patterns:{}};d.push(P)}for(const f of d){const{geometry:_,index:x,sourceLayerIndex:E}=f;this.addFeature(f,_,x,s,{},n.availableImages,n.brightness),n.featureIndex.insert(e[x].feature,_,x,E,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(e){}update(e,n,s,c,d){}destroy(){}addFeature(e,n,s,c,d,f=[],_){for(const x of kg(n,2)){const E=[],D=[],S=[],P=new Ae(1/0,1/0),F=new Ae(-1/0,-1/0);for(const H of x)if(0!==H.length){H!==x[0]&&S.push(D.length/2);for(let ee=0;ee<H.length;ee++)D.push(H[ee].x),D.push(H[ee].y),E.push(H[ee]),P.x=Math.min(P.x,H[ee].x),P.y=Math.min(P.y,H[ee].y),F.x=Math.max(F.x,H[ee].x),F.y=Math.max(F.y,H[ee].y)}const z=$h(D,S),$=new Uy(E,z,8,256);this.footprints.push({vertices:E,indices:z,grid:$,min:P,max:F})}}}Ee(jy,"ClipBucket",{omit:["layers"]});const Vy=new to({"clip-layer-types":new Mn(Jt.layout_clip["clip-layer-types"])});var zb={paint:new to({}),layout:Vy};const oT=oo([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),sT=oo([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),im=oo([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Ub=oo([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Fg=oo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:$y}=oT;var rm={},jb=Te,Gy=Qd;function Qd(t,e,n,s,c){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=c,t.readFields(J0,this,e)}function J0(t,e,n){1==t?e.id=n.readVarint():2==t?function(s,c){for(var d=s.readVarint()+s.pos;s.pos<d;){var f=c._keys[s.readVarint()],_=c._values[s.readVarint()];c.properties[f]=_}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function om(t){for(var e,n,s=0,c=0,d=t.length,f=d-1;c<d;f=c++)s+=((n=t[f]).x-(e=t[c]).x)*(e.y+n.y);return s}Qd.types=["Unknown","Point","LineString","Polygon"],Qd.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,s=1,c=0,d=0,f=0,_=[];t.pos<n;){if(c<=0){var x=t.readVarint();s=7&x,c=x>>3}if(c--,1===s||2===s)d+=t.readSVarint(),f+=t.readSVarint(),1===s&&(e&&_.push(e),e=[]),e.push(new jb(d,f));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&_.push(e),_},Qd.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,s=0,c=0,d=0,f=1/0,_=-1/0,x=1/0,E=-1/0;t.pos<e;){if(s<=0){var D=t.readVarint();n=7&D,s=D>>3}if(s--,1===n||2===n)(c+=t.readSVarint())<f&&(f=c),c>_&&(_=c),(d+=t.readSVarint())<x&&(x=d),d>E&&(E=d);else if(7!==n)throw new Error("unknown command "+n)}return[f,x,_,E]},Qd.prototype.toGeoJSON=function(t,e,n){var s,c,d=this.extent*Math.pow(2,n),f=this.extent*t,_=this.extent*e,x=this.loadGeometry(),E=Qd.types[this.type];function D(F){for(var z=0;z<F.length;z++){var $=F[z];F[z]=[360*($.x+f)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+_)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(s=0;s<x.length;s++)S[s]=x[s][0];D(x=S);break;case 2:for(s=0;s<x.length;s++)D(x[s]);break;case 3:for(x=function(F){var z=F.length;if(z<=1)return[F];for(var $,H,ee=[],Pe=0;Pe<z;Pe++){var Oe=om(F[Pe]);0!==Oe&&(void 0===H&&(H=Oe<0),H===Oe<0?($&&ee.push($),$=[F[Pe]]):$.push(F[Pe]))}return $&&ee.push($),ee}(x),s=0;s<x.length;s++)for(c=0;c<x[s].length;c++)D(x[s][c])}1===x.length?x=x[0]:E="Multi"+E;var P={type:"Feature",geometry:{type:E,coordinates:x},properties:this.properties};return"id"in this&&(P.id=this.id),P};var Q0=Gy,sm=Hy;function Hy(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(e1,this,e),this.length=this._features.length}function e1(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(s){for(var c=null,d=s.readVarint()+s.pos;s.pos<d;){var f=s.readVarint()>>3;c=1===f?s.readString():2===f?s.readFloat():3===f?s.readDouble():4===f?s.readVarint64():5===f?s.readVarint():6===f?s.readSVarint():7===f?s.readBoolean():null}return c}(n))}Hy.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Q0(this._pbf,e,this.extent,this._keys,this._values)};var t1=sm;function Ng(t,e,n){if(3===t){var s=new t1(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}var am=rm.VectorTile=function(t,e){this.layers=t.readFields(Ng,{},e)},lm=rm.VectorTileFeature=Gy;rm.VectorTileLayer=sm;class Iu extends Ae{constructor(e,n,s){super(e,n),this.z=s}}class Bg extends Iu{constructor(e,n,s,c){super(e,n,s),this.w=c}}function hd(t,e,n,s){const c=[],d=0===s?(f,_,x,E,D,S)=>{f.push(new Ae(S,x+(S-_)/(E-_)*(D-x)))}:(f,_,x,E,D,S)=>{f.push(new Ae(_+(S-x)/(D-x)*(E-_),S))};for(const f of t){const _=[];for(const x of f){if(x.length<=2)continue;const E=[];for(let P=0;P<x.length-1;P++){const F=x[P].x,z=x[P].y,$=x[P+1].x,H=x[P+1].y,ee=0===s?F:z,Pe=0===s?$:H;ee<e?Pe>e&&d(E,F,z,$,H,e):ee>n?Pe<n&&d(E,F,z,$,H,n):E.push(x[P]),Pe<e&&ee>=e&&d(E,F,z,$,H,e),Pe>n&&ee<=n&&d(E,F,z,$,H,n)}let D=x[x.length-1];const S=0===s?D.x:D.y;S>=e&&S<=n&&E.push(D),E.length&&(D=E[E.length-1],E[0].x===D.x&&E[0].y===D.y||E.push(E[0]),_.push(E))}_.length&&c.push(_)}return c}function n1(t,e,n,s){const c="x"===n?"y":"x",d=(s-t[n])/(e[n]-t[n]);t[c]=t[c]+(e[c]-t[c])*d,t[n]=s,t.hasOwnProperty("z")&&(t.z=zi(t.z,e.z,d)),t.hasOwnProperty("w")&&(t.w=zi(t.w,e.w,d))}function i1(t,e,n,s){const c=n,d=s;for(const f of["x","y"]){let _=t,x=e;_[f]>=x[f]&&(_=e,x=t),_[f]<c&&x[f]>c&&n1(_,x,f,c),_[f]<d&&x[f]>d&&n1(x,_,f,d)}}function Wy(t,e){return t.x-e.x||t.y-e.y}function cm(t,e){return 0===Wy(t.min,e.min)&&0===Wy(t.max,e.max)}function um(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function zg(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n].sourceId!==e[n].sourceId||!cm(t[n],e[n])||t[n].order!==e[n].order||t[n].clipMask!==e[n].clipMask)return!1;return!0}function Xy(t,e,n){const s=1/hi,c=1/(1<<n.canonical.z),d=(e.x*s+n.canonical.x)*c+n.wrap,f=(e.y*s+n.canonical.y)*c;return{min:new Ae((t.x*s+n.canonical.x)*c+n.wrap,(t.y*s+n.canonical.y)*c),max:new Ae(d,f)}}function r1(t,e,n){const s=1<<n.canonical.z,c=((e.x-n.wrap)*s-n.canonical.x)*hi,d=(e.y*s-n.canonical.y)*hi;return{min:new Ae(((t.x-n.wrap)*s-n.canonical.x)*hi,(t.y*s-n.canonical.y)*hi),max:new Ae(c,d)}}function Ky(t,e,n,s,c,d,f){const _=t.indices,x=t.vertices,E=[];for(let D=s;D<s+c;D+=3){const S=e[n[D+0]+d],P=e[n[D+1]+d],F=e[n[D+2]+d],z=Math.min(S.x,P.x,F.x),$=Math.max(S.x,P.x,F.x),H=Math.min(S.y,P.y,F.y),ee=Math.max(S.y,P.y,F.y);E.length=0,t.grid.query(new Ae(z,H),new Ae($,ee),E);for(let Pe=0;Pe<E.length;Pe++){const Oe=E[Pe];if(Cg(x[_[3*Oe+0]],x[_[3*Oe+1]],x[_[3*Oe+2]],S,P,F,f))return!0}}return!1}function o1(t,e,n,s){if(!t||!n)return!1;let c=t.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(n.vertices.length<t.vertices.length)return o1(n,s,t,e);const d=e.canonical,f=s.canonical,_=Math.pow(2,f.z-d.z);c=t.vertices.map(x=>new Ae((x.x+d.x*hi)*_-f.x*hi,(x.y+d.y*hi)*_-f.y*hi))}return Ky(n,c,t.indices,0,t.indices.length,0,0)}function s1(t,e,n,s){const c=Math.pow(2,s.z-n.z);return new Ae((t+n.x*hi)*c-s.x*hi,(e+n.y*hi)*c-s.y*hi)}function a1(t,e){const n=[];e.footprint.grid.queryPoint(t,n);const s=e.footprint.indices,c=e.footprint.vertices;for(let d=0;d<n.length;d++){const f=n[d];if(Uh([c[s[3*f+0]],c[s[3*f+1]],c[s[3*f+2]]],t))return!0}return!1}class l1{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const s=this.toIdx(e,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function c1(t,e,n,s){let c=0,d=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(s[f])<1e-15){if(n[f]<t[f]||n[f]>e[f])return null}else{const _=1/s[f];let x=(t[f]-n[f])*_,E=(e[f]-n[f])*_;if(x>E){const D=x;x=E,E=D}if(x>c&&(c=x),E<d&&(d=E),c>d)return null}return c}function fd(t,e,n,s,c,d,f,_,x,E,D){const S=s-t,P=c-e,F=d-n,z=f-t,$=_-e,H=x-n,ee=D[1]*H-D[2]*$,Pe=D[2]*z-D[0]*H,Oe=D[0]*$-D[1]*z,ke=S*ee+P*Pe+F*Oe;if(Math.abs(ke)<1e-15)return null;const dt=1/ke,st=E[0]-t,Dt=E[1]-e,kt=E[2]-n,Yt=(st*ee+Dt*Pe+kt*Oe)*dt;if(Yt<0||Yt>1)return null;const yn=Dt*F-kt*P,dn=kt*S-st*F,Fn=st*P-Dt*S,Yn=(D[0]*yn+D[1]*dn+D[2]*Fn)*dt;return Yn<0||Yt+Yn>1?null:(z*yn+$*dn+H*Fn)*dt}function Wf(t,e,n){return(t-e)/(n-e)}function u1(t,e,n,s,c,d,f,_,x){const E=1<<n,D=d-s,S=f-c,P=(t+1)/E*D+s,F=(e+0)/E*S+c,z=(e+1)/E*S+c;_[0]=(t+0)/E*D+s,_[1]=F,x[0]=P,x[1]=z}class Vb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(d){const f=Math.ceil(Math.log2(d.dim/8)),_=[];let x=Math.ceil(Math.pow(2,f));const E=1/x,D=(F,z,$,H,ee)=>{const Pe=H?1:0,Oe=(F+1)*$-Pe,ke=z*$,dt=(z+1)*$-Pe;ee[0]=F*$,ee[1]=ke,ee[2]=Oe,ee[3]=dt};let S=new l1(x);const P=[];for(let F=0;F<x*x;F++){D(F%x,Math.floor(F/x),E,!1,P);const z=Zh(P[0],P[1],d),$=Zh(P[2],P[1],d),H=Zh(P[2],P[3],d),ee=Zh(P[0],P[3],d);S.minimums.push(Math.min(z,$,H,ee)),S.maximums.push(Math.max(z,$,H,ee)),S.leaves.push(1)}for(_.push(S),x/=2;x>=1;x/=2){const F=_[_.length-1];S=new l1(x);for(let z=0;z<x*x;z++){D(z%x,Math.floor(z/x),2,!0,P);const $=F.getElevation(P[0],P[1]),H=F.getElevation(P[2],P[1]),ee=F.getElevation(P[2],P[3]),Pe=F.getElevation(P[0],P[3]),Oe=F.isLeaf(P[0],P[1]),ke=F.isLeaf(P[2],P[1]),dt=F.isLeaf(P[2],P[3]),st=F.isLeaf(P[0],P[3]),Dt=Math.min($.min,H.min,ee.min,Pe.min),kt=Math.max($.max,H.max,ee.max,Pe.max),Yt=Oe&&ke&&dt&&st;S.maximums.push(kt),S.minimums.push(Dt),S.leaves.push(kt-Dt<=5&&Yt?1:0)}_.push(S)}return _}(this.dem),s=n.length-1,c=n[s];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(e,n,s,c,d,f,_=1){return c1([e,n,-100],[s,c,this.maximums[0]*_],d,f)}raycast(e,n,s,c,d,f,_=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,n,s,c,d,f,_);if(null==x)return null;const E=[],D=[],S=[],P=[],F=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:z,t:$,nodex:H,nodey:ee,depth:Pe}=F.pop();if(this.leaves[z]){u1(H,ee,Pe,e,n,s,c,S,P);const ke=1<<Pe,dt=(H+0)/ke,st=(H+1)/ke,Dt=(ee+0)/ke,kt=(ee+1)/ke,Yt=Zh(dt,Dt,this.dem)*_,yn=Zh(st,Dt,this.dem)*_,dn=Zh(st,kt,this.dem)*_,Fn=Zh(dt,kt,this.dem)*_,Yn=fd(S[0],S[1],Yt,P[0],S[1],yn,P[0],P[1],dn,d,f),Sn=fd(P[0],P[1],dn,S[0],P[1],Fn,S[0],S[1],Yt,d,f),Wn=Math.min(null!==Yn?Yn:Number.MAX_VALUE,null!==Sn?Sn:Number.MAX_VALUE);if(Wn!==Number.MAX_VALUE)return Wn;{const xn=a._.scaleAndAdd([],d,f,$);if($b(Yt,yn,Fn,dn,Wf(xn[0],S[0],P[0]),Wf(xn[1],S[1],P[1]))>=xn[2])return $}continue}let Oe=0;for(let ke=0;ke<this._siblingOffset.length;ke++){u1((H<<1)+this._siblingOffset[ke][0],(ee<<1)+this._siblingOffset[ke][1],Pe+1,e,n,s,c,S,P),S[2]=-100,P[2]=this.maximums[this.childOffsets[z]+ke]*_;const dt=c1(S,P,d,f);if(null!=dt){const st=dt;E[ke]=st;let Dt=!1;for(let kt=0;kt<Oe&&!Dt;kt++)st>=E[D[kt]]&&(D.splice(kt,0,ke),Dt=!0);Dt||(D[Oe]=ke),Oe++}}for(let ke=0;ke<Oe;ke++){const dt=D[ke];F.push({idx:this.childOffsets[z]+dt,t:E[dt],nodex:(H<<1)+this._siblingOffset[dt][0],nodey:(ee<<1)+this._siblingOffset[dt][1],depth:Pe+1})}}return null}_addNode(e,n,s){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,s,c,d){if(1===e[c].isLeaf(n,s))return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const f=c-1,_=e[f];let x=0,E=0;for(let D=0;D<this._siblingOffset.length;D++){const S=2*n+this._siblingOffset[D][0],P=2*s+this._siblingOffset[D][1],F=_.getElevation(S,P),z=_.isLeaf(S,P),$=this._addNode(F.min,F.max,z);z&&(x|=1<<D),E||(E=$)}for(let D=0;D<this._siblingOffset.length;D++)x&1<<D||this._construct(e,2*n+this._siblingOffset[D][0],2*s+this._siblingOffset[D][1],f,E+D)}}function $b(t,e,n,s,c,d){return zi(zi(t,n,d),zi(e,s,d),c)}function Zh(t,e,n){const s=n.dim,c=Ut(t*s-.5,0,s-1),d=Ut(e*s-.5,0,s-1),f=Math.floor(c),_=Math.floor(d),x=Math.min(f+1,s-1),E=Math.min(_+1,s-1);return $b(n.get(f,_),n.get(x,_),n.get(f,E),n.get(x,E),c-f,d-_)}const aT={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function lT(t,e,n){return(256*t*256+256*e+n)/10-1e4}function d1(t,e,n){return 256*t+e+n/256-32768}class Ug{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,s,c=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return Do(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const d=this.dim=n.height-2,f=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let x=0;x<d;x++)f[this._idx(-1,x)]=f[this._idx(0,x)],f[this._idx(d,x)]=f[this._idx(d-1,x)],f[this._idx(x,-1)]=f[this._idx(x,0)],f[this._idx(x,d)]=f[this._idx(x,d-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(d,-1)]=f[this._idx(d-1,0)],f[this._idx(-1,d)]=f[this._idx(0,d-1)],f[this._idx(d,d)]=f[this._idx(d-1,d-1)]}const _="terrarium"===s?d1:lT;for(let x=0;x<f.length;++x){const E=4*x;this.floatView[x]=_(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=Vo.now()}_buildQuadTree(){this._tree=new Vb(this)}get(e,n,s=!1){s&&(e=Ut(e,-1,this.dim),n=Ut(n,-1,this.dim));const c=this._idx(e,n);return this.floatView[c]}set(e,n,s){const c=this._idx(e,n),d=this.floatView[c];return this.floatView[c]=s,s-d}static getUnpackVector(e){return aT[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const s=[0,0,0,0],c=Ug.getUnpackVector(n);let d=Math.floor((e+c[3])/c[2]);return s[2]=d%256,d=Math.floor(d/256),s[1]=d%256,d=Math.floor(d/256),s[0]=d,s}getPixels(){return new X0({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,d=n*this.dim+this.dim,f=s*this.dim,_=s*this.dim+this.dim;switch(n){case-1:c=d-1;break;case 1:d=c+1}switch(s){case-1:f=_-1;break;case 1:_=f+1}const x=-n*this.dim,E=-s*this.dim;for(let D=f;D<_;D++)for(let S=c;S<d;S++){const P=4*this._idx(S,D),F=4*this._idx(S+x,D+E);this.pixels[P+0]=e.pixels[F+0],this.pixels[P+1]=e.pixels[F+1],this.pixels[P+2]=e.pixels[F+2],this.pixels[P+3]=e.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ee(Ug,"DEMData"),Ee(Vb,"DemMinMaxQuadTree",{omit:["dem"]});class Xf{constructor(e,n,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(e,n,s){const c=s||e.findDEMTileFor(n);if(!c||!c.dem)return;const d=c.dem,f=c.tileID,_=1<<n.canonical.z-f.canonical.z;return new Xf(c,d.dim/hi/_,[(n.canonical.x/_-f.canonical.x)*d.dim,(n.canonical.y/_-f.canonical.y)*d.dim])}tileCoordToPixel(e,n){const s=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(s);return new Ae(c,d)}getElevationAt(e,n,s,c){const d=e*this._scale+this._offset[0],f=n*this._scale+this._offset[1],_=Math.floor(d),x=Math.floor(f),E=this._dem;return c=!!c,s?zi(zi(E.get(_,x,c),E.get(_,x+1,c),f-x),zi(E.get(_+1,x,c),E.get(_+1,x+1,c),f-x),d-_):E.get(_,x,c)}getElevationAtPixel(e,n,s){return this._dem.get(e,n,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ia(1,e)*this._dem.stride}}const h1={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},Gb=lm.types,Zy=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],pd=["fill-extrusion-flood-light-ground-radius"],dm=Math.pow(2,13),f1=Math.pow(2,15)-1,qy=new Ae(0,1),md=2147483648;function jg(t,e,n,s,c,d,f,_){t.emplaceBack((e<<1)+f,(n<<1)+d,(Math.floor(s*dm)<<1)+c,Math.round(_))}function Yy(t,e,n,s,c,d){t.emplaceBack(e.x,e.y,(n.x<<1)+s,(n.y<<1)+c,d)}function Vg(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class $g{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Gg{constructor(){this.centroidXY=new Ae(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ae(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ae(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ae(this.max.x-this.min.x,this.max.y-this.min.y)}}class Hb{constructor(){this.acc=new Ae(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,s){this.accCount++,this.acc._add(n);let c=!!this.borders;n.x<e.min.x?(e.min.x=n.x,c=!0):n.x>e.max.x&&(e.max.x=n.x,c=!0),n.y<e.min.y?(e.min.y=n.y,c=!0):n.y>e.max.y&&(e.max.y=n.y,c=!0),((0===n.x||n.x===hi)&&n.x===s.x)!=((0===n.y||n.y===hi)&&n.y===s.y)&&this.processBorderOverlap(n,s),c&&this.checkBorderIntersection(n,s)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,zi(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>hi!=e.x>hi&&this.addBorderIntersection(1,zi(n.y,e.y,(hi-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,zi(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>hi!=e.y>hi&&this.addBorderIntersection(3,zi(n.x,e.x,(hi-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,e.x)}}centroid(){return 0===this.accCount?new Ae(0,0):new Ae(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function Wb(t,e){const n=t.add(e)._unit(),s=Ut(t.x*n.x+t.y*n.y,-1,1);var c,d,f;return c=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(c)))/4*f1*((d=t).x*(f=e).y-d.y*f.x<0?-1:1)}const p1=[t=>t.x<0,t=>t.x>hi,t=>t.y<0,t=>t.y>hi];function Xb(t,e,n,s){const c=[4];if(0===s)return c;n._mult(s);const d=t.sub(n),f=e.sub(n),_=[t,e,d,f];for(let x=0;x<4;x++)for(const E of _)if(p1[x](E)){c.push(x);break}return c}class m1{constructor(e){this.vertexArray=new Op,this.indexArray=new Zs,this.programConfigurations=new rd(e.layers,{zoom:e.zoom,lut:e.lut},n=>pd.includes(n)),this._segments=new rs,this.hiddenByLandmarkVertexArray=new dg,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new rs}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,n,s,c=!1){const d=e.length;if(d>2){let f=Math.max(0,this._segments.get().length-1);const _=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let x;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const E=e[0],D=e[1];x=Wb(E.sub(e[d-1])._perp()._unit(),D.sub(E)._perp()._unit())}for(let E=0;E<d;E++){const D=E===d-1?0:E+1,S=e[E],P=e[D],F=e[D===d-1?0:D+1],z=P.sub(S)._perp()._unit(),$=Wb(z,F.sub(P)._perp()._unit()),H=x,ee=$;if(Wg(S,P,n)||c&&_1(S,n)&&_1(P,n)){x=$;continue}const Pe=_.vertexLength;Yy(this.vertexArray,S,P,1,1,H),Yy(this.vertexArray,S,P,1,0,H),Yy(this.vertexArray,S,P,0,1,ee),Yy(this.vertexArray,S,P,0,0,ee),_.vertexLength+=4;const Oe=Xb(S,P,z,s);for(const ke of Oe)this._segmentToGroundQuads[f].push({id:Pe,region:ke}),this._segmentToRegionTriCounts[f][ke]+=2,_.primitiveLength+=2;x=$}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let s=0;s<n;s++)this._segmentToGroundQuads[s].sort((c,d)=>c.region-d.region);for(let s=0;s<n;s++){const c=this._segmentToGroundQuads[s],d=e[s],f=this._segmentToRegionTriCounts[s];f.reduce((x,E)=>x+E,0);let _=0;for(let x=0;x<=4;x++){const E=f[x];if(0!==E){let D=this.regionSegments[x];D||(D=this.regionSegments[x]=new rs);const S={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+_,vertexLength:d.vertexLength,primitiveLength:E};D.get().push(S)}_+=E}for(let x=0;x<c.length;x++){const E=c[x].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,s,c,d,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,s,c,d,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,sT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,s,c,d,f){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,s,c,d,f)}updateHiddenByLandmark(e){if(!this.hasData())return;const n=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const s=e.flags&md?1:0;for(let c=e.groundVertexArrayOffset;c<n;++c)this.hiddenByLandmarkVertexArray.emplace(c,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Ub.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class Hg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Zs,this.footprintVertices=new gc,this.footprintSegments=[],this.layoutVertexArray=new ba,this.centroidVertexArray=new uy,this.indexArray=new Zs,this.programConfigurations=new rd(e.layers,{zoom:e.zoom,lut:e.lut},n=>Zy.includes(n)),this.segments=new rs,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new m1(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,s,c){this.features=[],this.hasPattern=By("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Wp(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:d,id:f,index:_,sourceLayerIndex:x}of e){const E=this.layers[0]._featureFilter.needGeometry,D=Eu(d,E);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),D,s))continue;const S={id:f,sourceLayerIndex:x,index:_,geometry:E?D.geometry:wu(d,s,c),properties:d.properties,type:d.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(zy("fill-extrusion",this.layers,S,this.zoom,n)):this.addFeature(S,S.geometry,_,s,{},n.availableImages,c,n.brightness),n.featureIndex.insert(d,S.geometry,_,x,this.index,P)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,s,c,d,f){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,n,s,c,d,f)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,n,s,c,d){const f=0!==Object.keys(e).length;if(f&&!this.stateDependentLayers.length)return;const _=f?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,_,s,c,d),this.groundEffect.update(e,n,_,s,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$y),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Fg.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,im.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,c,d,f,_,x){const E=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,D=[new Ae(0,0),new Ae(hi,hi)],S=_.projection,P="globe"===S.name,F="Polygon"===Gb[e.type],z=new Hb;z.centroidDataIndex=this.centroidData.length;const $=new Gg,H=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,ee=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);$.height=ee,$.vertexArrayOffset=this.layoutVertexArray.length,$.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Fp);const Pe=kg(n,500);for(let kt=Pe.length-1;kt>=0;kt--){const Yt=Pe[kt];(0===Yt.length||(Oe=Yt[0]).every(yn=>yn.x<=0)||Oe.every(yn=>yn.x>=hi)||Oe.every(yn=>yn.y<=0)||Oe.every(yn=>yn.y>=hi))&&Pe.splice(kt,1)}var Oe;let ke;if(P)ke=v1(Pe,D,c);else{ke=[];for(const kt of Pe)ke.push({polygon:kt,bounds:D})}const dt=F?this.edgeRadius:0,st=dt>0&&this.zoom<17,Dt=(kt,Yt)=>{if(0===kt.length)return!1;const yn=kt[kt.length-1];return Yt.x===yn.x&&Yt.y===yn.y};for(const{polygon:kt,bounds:Yt}of ke){let yn=0,dn=0;for(const Wn of kt)F&&!Wn[0].equals(Wn[Wn.length-1])&&Wn.push(Wn[0]),dn+=F?Wn.length-1:Wn.length;const Fn=this.segments.prepareSegment((F?5:4)*dn,this.layoutVertexArray,this.indexArray);$.footprintSegIdx<0&&($.footprintSegIdx=this.footprintSegments.length),$.polygonSegIdx<0&&($.polygonSegIdx=this.polygonSegments.length);const Yn={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Sn=new $g;if(Sn.vertexOffset=this.footprintVertices.length,Sn.indexOffset=3*this.footprintIndices.length,Sn.ringIndices=[],F){const Wn=[],xn=[];yn=Fn.vertexLength;for(let ni=0;ni<kt.length;ni++){const Zn=kt[ni];Zn.length&&0!==ni&&xn.push(Wn.length/2);const Si=[];let Qn,ci;Qn=Zn[1].sub(Zn[0])._perp()._unit(),Sn.ringIndices.push(Zn.length-1);for(let Qi=1;Qi<Zn.length;Qi++){const $i=Zn[Qi],ji=Zn[Qi===Zn.length-1?1:Qi+1],ri=$i.clone();if(dt){ci=ji.sub($i)._perp()._unit();const tr=Qn.add(ci)._unit(),Dr=dt*Math.min(4,1/(Qn.x*tr.x+Qn.y*tr.y));ri.x+=Dr*tr.x,ri.y+=Dr*tr.y,ri.x=Math.round(ri.x),ri.y=Math.round(ri.y),Qn=ci}!H||0!==dt&&!st||Dt(Si,ri)||Si.push(ri),jg(this.layoutVertexArray,ri.x,ri.y,0,0,1,1,0),Fn.vertexLength++,this.footprintVertices.emplaceBack($i.x,$i.y),Wn.push($i.x,$i.y),P&&Vg(this.layoutVertexExtArray,S.projectTilePoint(ri.x,ri.y,c),S.upVector(c,ri.x,ri.y))}H&&(0===dt||st)&&(0!==Si.length&&Dt(Si,Si[0])&&Si.pop(),this.groundEffect.addData(Si,Yt,E))}const Hn=$h(Wn,xn);for(let ni=0;ni<Hn.length;ni+=3)this.footprintIndices.emplaceBack(Sn.vertexOffset+Hn[ni+0],Sn.vertexOffset+Hn[ni+1],Sn.vertexOffset+Hn[ni+2]),this.indexArray.emplaceBack(yn+Hn[ni],yn+Hn[ni+2],yn+Hn[ni+1]),Fn.primitiveLength++;Sn.indexCount+=Hn.length,Sn.vertexCount+=this.footprintVertices.length-Sn.vertexOffset}for(let Wn=0;Wn<kt.length;Wn++){const xn=kt[Wn];z.startRing($,xn[0]);let Hn=xn.length>4&&y1(xn[xn.length-2],xn[0],xn[1]),ni=dt?Kb(xn[xn.length-2],xn[0],xn[1],dt):0;const Zn=[];let Si,Qn,ci;Qn=xn[1].sub(xn[0])._perp()._unit();let Qi=!0;for(let $i=1,ji=0;$i<xn.length;$i++){let ri=xn[$i-1],tr=xn[$i];const Dr=xn[$i===xn.length-1?1:$i+1];if(z.appendEdge($,tr,ri),Wg(tr,ri,Yt)){dt&&(Qn=Dr.sub(tr)._perp()._unit(),Qi=!Qi);continue}const or=tr.sub(ri)._perp(),Mr=or.x/(Math.abs(or.x)+Math.abs(or.y)),Er=or.y>0?1:0,Or=ri.dist(tr);if(ji+Or>32768&&(ji=0),dt){ci=Dr.sub(tr)._perp()._unit();let Qr=Jy(ri,tr,Dr,g1(Qn,ci),dt);isNaN(Qr)&&(Qr=0);const Hr=tr.sub(ri)._unit();ri=ri.add(Hr.mult(ni))._round(),tr=tr.add(Hr.mult(-Qr))._round(),ni=Qr,Qn=ci,H&&this.zoom>=17&&(Dt(Zn,ri)||Zn.push(ri),Dt(Zn,tr)||Zn.push(tr))}const ir=Fn.vertexLength,Mo=xn.length>4&&y1(ri,tr,Dr);let Co=Qy(ji,Hn,Qi);if(jg(this.layoutVertexArray,ri.x,ri.y,Mr,Er,0,0,Co),jg(this.layoutVertexArray,ri.x,ri.y,Mr,Er,0,1,Co),ji+=Or,Co=Qy(ji,Mo,!Qi),Hn=Mo,jg(this.layoutVertexArray,tr.x,tr.y,Mr,Er,0,0,Co),jg(this.layoutVertexArray,tr.x,tr.y,Mr,Er,0,1,Co),Fn.vertexLength+=4,this.indexArray.emplaceBack(ir+0,ir+1,ir+2),this.indexArray.emplaceBack(ir+1,ir+3,ir+2),Fn.primitiveLength+=2,dt){const Qr=yn+(1===$i?xn.length-2:$i-2),Hr=1===$i?yn:Qr+1;if(this.indexArray.emplaceBack(ir+1,Qr,ir+3),this.indexArray.emplaceBack(Qr,Hr,ir+3),Fn.primitiveLength+=2,void 0===Si&&(Si=ir),!Wg(Dr,xn[$i],Yt)){const so=$i===xn.length-1?Si:Fn.vertexLength;this.indexArray.emplaceBack(ir+2,ir+3,so),this.indexArray.emplaceBack(ir+3,so+1,so),this.indexArray.emplaceBack(ir+3,Hr,so+1),Fn.primitiveLength+=3}Qi=!Qi}if(P){const Qr=this.layoutVertexExtArray,Hr=S.projectTilePoint(ri.x,ri.y,c),so=S.projectTilePoint(tr.x,tr.y,c),$o=S.upVector(c,ri.x,ri.y),Bo=S.upVector(c,tr.x,tr.y);Vg(Qr,Hr,$o),Vg(Qr,Hr,$o),Vg(Qr,so,Bo),Vg(Qr,so,Bo)}}F&&(yn+=xn.length-1),H&&dt&&this.zoom>=17&&(0!==Zn.length&&Dt(Zn,Zn[0])&&Zn.pop(),this.groundEffect.addData(Zn,Yt,E,dt>0))}this.footprintSegments.push(Sn),Yn.triangleCount=this.indexArray.length-Yn.triangleArrayOffset,this.polygonSegments.push(Yn),++$.footprintSegLen,++$.polygonSegLen}if($.vertexCount=this.layoutVertexArray.length-$.vertexArrayOffset,$.groundVertexCount=this.groundEffect.vertexArray.length-$.groundVertexArrayOffset,0!==$.vertexCount){if($.centroidXY=z.borders?qy:this.encodeCentroid(z,$),this.centroidData.push($),z.borders){this.featuresOnBorder.push(z);const kt=this.featuresOnBorder.length-1;for(let Yt=0;Yt<z.borders.length;Yt++)z.borders[Yt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Yt].push(kt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,f,c,x),this.groundEffect.addPaintPropertiesData(e,s,d,f,c,x),this.maxHeight=Math.max(this.maxHeight,ee)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,s)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){const e=[];for(let _=0;_<this.centroidData.length;_++){const x=this.centroidData[_],E=+(x.min.y+x.max.y>hi),D=2*E+(+(x.min.x+x.max.x>hi)^E);for(let S=0;S<x.polygonSegLen;S++){const P=x.polygonSegIdx+S;e.push({centroidIdx:_,subtile:D,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const n=new Zs;e.sort((_,x)=>_.triangleSegmentIdx===x.triangleSegmentIdx?_.subtile-x.subtile:_.triangleSegmentIdx-x.triangleSegmentIdx);let s=0,c=0,d=0;for(const _ of e){if(_.triangleSegmentIdx!==s)break;d++}const f=e.length;for(;c!==e.length;){s=e[c].triangleSegmentIdx;let _=0,x=c,E=c;for(let D=x;D<d&&e[D].subtile===_;D++)E++;for(;x!==d;){const D=e[x];_=D.subtile;const S=this.centroidData[D.centroidIdx].min.clone(),P=this.centroidData[D.centroidIdx].max.clone(),F={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let z=x;z<E;z++){const $=e[z],H=this.polygonSegments[$.polygonSegmentIdx],ee=this.centroidData[$.centroidIdx].min,Pe=this.centroidData[$.centroidIdx].max,Oe=this.indexArray.uint16;for(let ke=H.triangleArrayOffset;ke<H.triangleArrayOffset+H.triangleCount;ke++)n.emplaceBack(Oe[3*ke],Oe[3*ke+1],Oe[3*ke+2]);F.primitiveLength+=H.triangleCount,S.x=Math.min(S.x,ee.x),S.y=Math.min(S.y,ee.y),P.x=Math.max(P.x,Pe.x),P.y=Math.max(P.y,Pe.y)}F.primitiveLength>0&&this.triangleSubSegments.push({segment:F,min:S,max:P}),x=E;for(let z=x;z<d&&e[z].subtile===e[x].subtile;z++)E++}c=d;for(let D=c;D<f&&e[D].triangleSegmentIdx===e[c].triangleSegmentIdx;D++)d++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,s){let c=0,d=0;const f=1<<e.canonical.z;if(n){const $=n.getMinMaxForTile(e);$&&(c=$.min,d=$.max)}d+=this.maxHeight;const _=e.toUnwrapped();let x;const E=[_.canonical.x/f+_.wrap,_.canonical.y/f],D=[(_.canonical.x+1)/f+_.wrap,(_.canonical.y+1)/f],S=new rs,P=($,H,ee)=>[$[0]*(1-ee[0])+H[0]*ee[0],$[1]*(1-ee[1])+H[1]*ee[1]],F=[],z=[];for(const $ of this.triangleSubSegments){F[0]=$.min.x/hi,F[1]=$.min.y/hi,z[0]=$.max.x/hi,z[1]=$.max.y/hi;const H=P(E,D,F),ee=P(E,D,z);if(0===new es([H[0],H[1],c],[ee[0],ee[1],d]).intersectsPrecise(s)){x&&(S.segments.push(x),x=void 0);continue}const Pe=$.segment;x&&x.vertexOffset!==Pe.vertexOffset&&(S.segments.push(x),x=void 0),x?(x.vertexLength+=Pe.vertexLength,x.primitiveLength+=Pe.primitiveLength):x={vertexOffset:Pe.vertexOffset,primitiveLength:Pe.primitiveLength,vertexLength:Pe.vertexLength,primitiveOffset:Pe.primitiveOffset,sortKey:void 0,vaos:{}}}return x&&S.segments.push(x),S}encodeCentroid(e,n){const s=e.centroid(),c=n.span(),d=Math.min(7,Math.round(c.x*this.tileToMeter/10)),f=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new Ae(Ut(s.x,1,hi-1)<<3|d,Ut(s.y,1,hi-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new Ae(0,0);const n=e.borders,s=Number.MAX_VALUE;if(n[0][0]!==s||n[1][0]!==s){const c=n[0][0]!==s?0:1;return new Ae(6|(n[0][0]!==s?0:65528),(n[c][0]+n[c][1])/2<<3|6)}{const c=n[2][0]!==s?2:3;return new Ae((n[c][0]+n[c][1])/2<<3|6,6|(n[2][0]!==s?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=md,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,c=e.flags&md?qy:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==c.y||d!==c.x){for(let f=n;f<s;++f)this.centroidVertexArray.emplace(f,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,s){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const c=n.getReplacementRegionsForTile(e.toUnwrapped());if(zg(this.activeReplacements,c))return;if(this.activeReplacements=c,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const d=[];for(const f of this.activeReplacements){if(f.order<s)continue;const _=Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z);for(const x of this.centroidData)if(!(x.flags&md||f.min.x>x.max.x||x.min.x>f.max.x||f.min.y>x.max.y||x.min.y>f.max.y))for(let E=0;E<x.footprintSegLen;E++){const D=this.footprintSegments[x.footprintSegIdx+E];if(d.length=0,ev(this.footprintVertices,D.vertexOffset,D.vertexCount,f.footprintTileId.canonical,e.canonical,d),Ky(f.footprint,d,this.footprintIndices.uint16,D.indexOffset,D.indexCount,-D.vertexOffset,-_)){x.flags|=md;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,s){let c=!1;for(let d=0;d<s.footprintSegLen;d++){const f=this.footprintSegments[s.footprintSegIdx+d];let _=0;for(const x of f.ringIndices){for(let E=_,D=x+_-1;E<x+_;D=E++){const S=this.footprintVertices.int16[2*(E+f.vertexOffset)+0],P=this.footprintVertices.int16[2*(E+f.vertexOffset)+1],F=this.footprintVertices.int16[2*(D+f.vertexOffset)+1];P>n!=F>n&&e<(this.footprintVertices.int16[2*(D+f.vertexOffset)+0]-S)*(n-P)/(F-P)+S&&(c=!c)}_=x}}return c}getHeightAtTileCoord(e,n){let s=Number.NEGATIVE_INFINITY,c=!0;const d=4*(e+hi)*hi+(n+hi);if(this.partLookup.hasOwnProperty(d)){const f=this.partLookup[d];return f?{height:f.height,hidden:!!(f.flags&md)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||n>f.max.y||f.min.y>n||this.footprintContainsPoint(e,n,f)&&f&&f.height>s&&(s=f.height,this.partLookup[d]=f,c=!!(f.flags&md));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:c};this.partLookup[d]=void 0}}function g1(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function Kb(t,e,n,s){const c=e.sub(t)._perp()._unit(),d=n.sub(e)._perp()._unit();return Jy(t,e,n,g1(c,d),s)}function Jy(t,e,n,s,c){const d=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(n)/3,c*d/s)}function Wg(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function _1(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function y1(t,e,n){if(t.x<0||t.x>=hi||e.x<0||e.x>=hi||n.x<0||n.x>=hi)return!1;const s=n.sub(e),c=s.perp(),d=t.sub(e);return(s.x*d.x+s.y*d.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(d.x*d.x+d.y*d.y))>-.866&&c.x*d.x+c.y*d.y<0}function Qy(t,e,n){const s=e?2|t:-3&t;return n?1|s:-2&s}function hm(){const t=Math.PI/32,e=Math.tan(t),n=od;return n*Math.sqrt(1+2*e*e)-n}function v1(t,e,n){const s=1<<n.z,c=Ta(n.x/s),d=Ta((n.x+1)/s),f=qs(n.y/s),_=qs((n.y+1)/s);return function(x,E,D,S,P=0,F){const z=[];if(!x.length||!D||!S)return z;const $=(st,Dt)=>{for(const kt of st)z.push({polygon:kt,bounds:Dt})},H=Math.ceil(Math.log2(D)),ee=Math.ceil(Math.log2(S)),Pe=H-ee,Oe=[];for(let st=0;st<Math.abs(Pe);st++)Oe.push(Pe>0?0:1);for(let st=0;st<Math.min(H,ee);st++)Oe.push(0),Oe.push(1);let ke=x;if(ke=hd(ke,E[0].y-P,E[1].y+P,1),ke=hd(ke,E[0].x-P,E[1].x+P,0),!ke.length)return z;const dt=[];for(Oe.length?dt.push({polygons:ke,bounds:E,depth:0}):$(ke,E);dt.length;){const st=dt.pop(),Dt=st.depth,kt=Oe[Dt],Yt=st.bounds[0],yn=st.bounds[1],dn=0===kt?Yt.x:Yt.y,Fn=0===kt?yn.x:yn.y,Yn=F?F(kt,dn,Fn):.5*(dn+Fn),Sn=hd(st.polygons,dn-P,Yn+P,kt),Wn=hd(st.polygons,Yn-P,Fn+P,kt);if(Sn.length){const xn=[Yt,new Ae(0===kt?Yn:yn.x,1===kt?Yn:yn.y)];Oe.length>Dt+1?dt.push({polygons:Sn,bounds:xn,depth:Dt+1}):$(Sn,xn)}if(Wn.length){const xn=[new Ae(0===kt?Yn:Yt.x,1===kt?Yn:Yt.y),yn];Oe.length>Dt+1?dt.push({polygons:Wn,bounds:xn,depth:Dt+1}):$(Wn,xn)}}return z}(t,e,Math.ceil((d-c)/11.25),Math.ceil((f-_)/11.25),1,(x,E,D)=>{if(0===x)return.5*(E+D);{const S=qs((n.y+E/hi)/s);return(Wc(.5*(qs((n.y+D/hi)/s)+S))*s-n.y)*hi}})}function ev(t,e,n,s,c,d){const f=Math.pow(2,s.z-c.z);for(let _=0;_<n;_++){let x=t.int16[2*(_+e)+0],E=t.int16[2*(_+e)+1];x=(x+c.x*hi)*f-s.x*hi,E=(E+c.y*hi)*f-s.y*hi,d.push(new Ae(x,E))}}Ee(Hg,"FillExtrusionBucket",{omit:["layers","features"]}),Ee(Gg,"PartData"),Ee($g,"FootprintSegment"),Ee(Hb,"BorderCentroidData"),Ee(m1,"GroundEffect");const Zb=new to({visibility:new Mn(Jt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Mn(Jt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Kf={paint:new to({"fill-extrusion-opacity":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Pi(Jt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Pi(Jt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Pi(Jt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Pi(Jt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Pi(Jt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Pi(Jt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Mn(Jt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:Zb};function fm(t,e){return t.x*e.x+t.y*e.y}function x1(t,e){if(1===t.length){let n=0;const s=e[n++];let c;for(;!c||s.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const d=e[n],f=t[0],_=c.sub(s),x=d.sub(s),E=f.sub(s),D=fm(_,_),S=fm(_,x),P=fm(x,x),F=fm(E,_),z=fm(E,x),$=D*P-S*S,H=(P*F-S*z)/$,ee=(D*z-S*F)/$,Pe=s.z*(1-H-ee)+c.z*H+d.z*ee;if(isFinite(Pe))return Pe}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}function Xg(t,e,n,s,c,d,f,_){const x=f*c.getElevationAt(t,e,!0,!0),E=0!==d[0],D=E?0===d[1]?f*(d[0]/7-450):f*function(S,P,F){const z=Math.floor(P[0]/8),$=Math.floor(P[1]/8),H=10*(P[0]-8*z),ee=10*(P[1]-8*$),Pe=S.getElevationAt(z,$,!0,!0),Oe=S.getMeterToDEM(F),ke=Math.floor(.5*(H*Oe-1)),dt=Math.floor(.5*(ee*Oe-1)),st=S.tileCoordToPixel(z,$),Dt=2*ke+1,kt=2*dt+1,Yt=(ni=Dt,Zn=kt,[(Wn=S).getElevationAtPixel(xn=st.x-ke,Hn=st.y-dt,!0),Wn.getElevationAtPixel(xn+Zn,Hn,!0),Wn.getElevationAtPixel(xn,Hn+Zn,!0),Wn.getElevationAtPixel(xn+ni,Hn+Zn,!0)]),yn=Math.abs(Yt[0]-Yt[1]),dn=Math.abs(Yt[2]-Yt[3]),Fn=Math.abs(Yt[0]-Yt[2])+Math.abs(Yt[1]-Yt[3]),Yn=Math.min(.25,.5*Oe*(yn+dn)/Dt),Sn=Math.min(.25,.5*Oe*Fn/kt);var Wn,xn,Hn,ni,Zn;return Pe+Math.max(Yn*H,Sn*ee)}(c,d,_):x;return{base:x+(0===n)?-1:n,top:E?Math.max(D+s,x+n+2):x+s}}const b1=oo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:qb}=b1,Yb=oo([{name:"a_packed",components:4,type:"Float32"}]),{members:Jb}=Yb,Qb=oo([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:w1}=Qb,cT=oo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),uT=oo([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),pm=oo([{name:"a_projected_pos",components:4,type:"Float32"}],4);oo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tv=oo([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),E1=oo([{name:"a_z_offset",components:1,type:"Float32"}],4),ew=oo([{name:"a_texb",components:2,type:"Uint16"}]),C1=oo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),tw=oo([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);oo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const I1=oo([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nw=oo([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);oo([{name:"triangle",components:3,type:"Uint16"}]),oo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),oo([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),oo([{type:"Float32",name:"offsetX"}]),oo([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class T1{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Yd({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const s=this.getKey(e,n);return this.positions[s]}trim(){const e=this.width,n=this.height=ur(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,s){const c=[];let d=e.length%2==1?-e[e.length-1]*s:0,f=e[0]*s,_=!0;c.push({left:d,right:f,isDash:_,zeroLength:0===e[0]});let x=e[0];for(let E=1;E<e.length;E++){_=!_;const D=e[E];d=x*s,x+=D,f=x*s,c.push({left:d,right:f,isDash:_,zeroLength:0===D})}return c}addRoundDash(e,n,s){const c=n/2;for(let d=-s;d<=s;d++){const f=this.width*(this.nextRow+s+d);let _=0,x=e[_];for(let E=0;E<this.width;E++){E/x.right>1&&(x=e[++_]);const D=Math.abs(E-x.left),S=Math.abs(E-x.right),P=Math.min(D,S);let F;const z=d/s*(c+1);if(x.isDash){const $=c-Math.abs(z);F=Math.sqrt(P*P+$*$)}else F=c-Math.sqrt(P*P+z*z);this.image.data[f+E]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e,n){for(let x=e.length-1;x>=0;--x){const E=e[x],D=e[x+1];E.zeroLength?e.splice(x,1):D&&D.isDash===E.isDash&&(D.left=E.left,e.splice(x,1))}const s=e[0],c=e[e.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const d=this.width*this.nextRow;let f=0,_=e[f];for(let x=0;x<this.width;x++){x/_.right>1&&(_=e[++f]);const E=Math.abs(x-_.left),D=Math.abs(x-_.right),S=Math.min(E,D);this.image.data[d+x]=Math.max(0,Math.min(255,(_.isDash?S:-S)+n+128))}}addDash(e,n){const s=this.getKey(e,n);if(this.positions[s])return this.positions[s];const c="round"===n,d=c?7:0,f=2*d+1;if(this.nextRow+f>this.height)return Do("LineAtlas out of space"),null;0===e.length&&e.push(1);let _=0;for(let D=0;D<e.length;D++)e[D]<0&&(Do("Negative value is found in line dasharray, replacing values with 0"),e[D]=0),_+=e[D];if(0!==_){const D=this.width/_,S=this.getDashRanges(e,this.width,D);c?this.addRoundDash(S,D,d):this.addRegularDash(S,"square"===n?.5*D:0)}const x=this.nextRow+d;this.nextRow+=f;const E={tl:[x,d],br:[_,0]};return this.positions[s]=E,E}}Ee(T1,"LineAtlas");const iw=lm.types,rw=Math.cos(Math.PI/180*37.5),nv=Math.cos(Math.PI/180*5);class iv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Lp,this.layoutVertexArray2=new td,this.patternVertexArray=new Rh,this.indexArray=new Zs,this.programConfigurations=new rd(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new rs,this.maxLineLength=0,this.zOffsetVertexArray=new Wd,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:hi/64}updateFootprints(e,n){}populate(e,n,s,c){this.hasPattern=By("line",this.layers,n);const d=this.layers[0].layout.get("line-sort-key"),f=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!f.isConstant()||!!f.constantOr(0);const _=[];for(const{feature:S,id:P,index:F,sourceLayerIndex:z}of e){const $=this.layers[0]._featureFilter.needGeometry,H=Eu(S,$);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),H,s))continue;const ee=d?d.evaluate(H,{},s):void 0,Pe={id:P,properties:S.properties,type:S.type,sourceLayerIndex:z,index:F,geometry:$?H.geometry:wu(S,s,c),patterns:{},sortKey:ee};_.push(Pe)}d&&_.sort((S,P)=>S.sortKey-P.sortKey);const{lineAtlas:x,featureIndex:E}=n,D=this.addConstantDashes(x);for(const S of _){const{geometry:P,index:F,sourceLayerIndex:z}=S;if(D&&this.addFeatureDashes(S,x),this.hasPattern){const $=zy("line",this.layers,S,this.zoom,n);this.patternFeatures.push($)}else this.addFeature(S,P,F,s,x.positions,n.availableImages,n.brightness);E.insert(e[F].feature,P,F,z,this.index)}}addConstantDashes(e){let n=!1;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,d=s.layout.get("line-cap").value;if("constant"!==c.kind||"constant"!==d.kind)n=!0;else{const f=d.value,_=c.value;if(!_)continue;e.addDash(_,f)}}return n}addFeatureDashes(e,n){const s=this.zoom;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,f=c.layout.get("line-cap").value;if("constant"===d.kind&&"constant"===f.kind)continue;let _,x;if("constant"===d.kind){if(_=d.value,!_)continue}else _=d.evaluate({zoom:s},e);x="constant"===f.kind?f.value:f.evaluate({zoom:s},e),n.addDash(_,x),e.patterns[c.id]=n.getKey(_,x)}}update(e,n,s,c,d){const f=0!==Object.keys(e).length;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,f?this.stateDependentLayers:this.layers,s,c,d)}addFeatures(e,n,s,c,d,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,s,c,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Jb)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,w1)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,E1.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qb),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,c,d,f,_){const x=this.layers[0].layout,E=x.get("line-join").evaluate(e,{}),D=x.get("line-cap").evaluate(e,{}),S=x.get("line-miter-limit"),P=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of n)this.addLine(F,e,c,E,D,S,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,f,c,_)}addLine(e,n,s,c,d,f,_){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const x={zoom:this.zoom,lineProgress:void 0},E=this.layers[0].layout,D="none"===c;if(this.patternJoinNone=this.hasPattern&&D,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let st=0;st<e.length-1;st++)this.totalDistance+=e[st].dist(e[st+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S="Polygon"===iw[n.type];let P=e.length;for(;P>=2&&e[P-1].equals(e[P-2]);)P--;let F=0;for(;F<P-1&&e[F].equals(e[F+1]);)F++;if(P<(S?3:2))return;"bevel"===c&&(f=1.05);const z=this.overscaling<=16?15*hi/(512*this.overscaling):0,$=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let H,ee,Pe,Oe,ke,dt;this.e1=this.e2=-1,S&&(H=e[P-2],ke=e[F].sub(H)._unit()._perp());for(let st=F;st<P;st++){if(Pe=st===P-1?S?e[F+1]:void 0:e[st+1],Pe&&e[st].equals(Pe))continue;if(ke&&(Oe=ke),H&&(ee=H),H=e[st],this.hasZOffset){const xn=E.get("line-z-offset").value;if("constant"===xn.kind)dt=xn.value;else{if(this.lineClips){const Hn=this.totalDistance/(this.lineClips.end-this.lineClips.start);x.lineProgress=(Hn*this.lineClips.start+this.distance+(ee?ee.dist(H):0))/Hn}else Do(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),x.lineProgress=0;dt=xn.evaluate(x,n)}dt=dt||0}ke=Pe?Pe.sub(H)._unit()._perp():Oe,Oe=Oe||ke;const Dt=ee&&Pe;let kt=Dt?c:S||D?"butt":d;const Yt=Oe.x*ke.x+Oe.y*ke.y;if(D){const xn=function(Hn){if(Hn.patternJoinNone){const ni=Hn.segmentPoints.length/2,Zn=Hn.lineSoFar-Hn.segmentStart;for(let Si=0;Si<ni;++Si){const Qn=Hn.segmentPoints[2*Si+1],ci=Math.round(Hn.segmentPoints[2*Si])+.5+.25*Qn;Hn.patternVertexArray.emplaceBack(ci,Zn,Hn.segmentStart),Hn.patternVertexArray.emplaceBack(ci,Zn,Hn.segmentStart)}Hn.segmentPoints.length=0}Hn.e1=Hn.e2=-1};if(Dt&&Yt<nv){this.updateDistance(ee,H),this.addCurrentVertex(H,Oe,1,1,$,dt),xn(this),this.addCurrentVertex(H,ke,-1,-1,$,dt);continue}if(ee){if(!Pe){this.updateDistance(ee,H),this.addCurrentVertex(H,Oe,1,1,$,dt),xn(this);continue}kt="miter"}}let yn=Oe.add(ke);0===yn.x&&0===yn.y||yn._unit();const dn=yn.x*ke.x+yn.y*ke.y,Fn=0!==dn?1/dn:1/0,Yn=2*Math.sqrt(2-2*dn),Sn=dn<rw&&ee&&Pe,Wn=Oe.x*ke.y-Oe.y*ke.x>0;if(Sn&&st>F){const xn=H.dist(ee);if(xn>2*z){const Hn=H.sub(H.sub(ee)._mult(z/xn)._round());this.updateDistance(ee,Hn),this.addCurrentVertex(Hn,Oe,0,0,$,dt),ee=Hn}}if(Dt&&"round"===kt&&(Fn<_?kt="miter":Fn<=2&&(kt="fakeround")),"miter"===kt&&Fn>f&&(kt="bevel"),"bevel"===kt&&(Fn>2&&(kt="flipbevel"),Fn<f&&(kt="miter")),ee&&this.updateDistance(ee,H),"miter"===kt)yn._mult(Fn),this.addCurrentVertex(H,yn,0,0,$,dt);else if("flipbevel"===kt){if(Fn>100)yn=ke.mult(-1);else{const xn=Fn*Oe.add(ke).mag()/Oe.sub(ke).mag();yn._perp()._mult(xn*(Wn?-1:1))}this.addCurrentVertex(H,yn,0,0,$,dt),this.addCurrentVertex(H,yn.mult(-1),0,0,$,dt)}else if("bevel"===kt||"fakeround"===kt){const xn=-Math.sqrt(Fn*Fn-1),Hn=Wn?xn:0,ni=Wn?0:xn;if(ee&&this.addCurrentVertex(H,Oe,Hn,ni,$,dt),"fakeround"===kt){const Zn=Math.round(180*Yn/Math.PI/20);for(let Si=1;Si<Zn;Si++){let Qn=Si/Zn;if(.5!==Qn){const Qi=Qn-.5;Qn+=Qn*Qi*(Qn-1)*((1.0904+Yt*(Yt*(3.55645-1.43519*Yt)-3.2452))*Qi*Qi+(.848013+Yt*(.215638*Yt-1.06021)))}const ci=ke.sub(Oe)._mult(Qn)._add(Oe)._unit()._mult(Wn?-1:1);this.addHalfVertex(H,ci.x,ci.y,!1,Wn,0,$,dt)}}Pe&&this.addCurrentVertex(H,ke,-Hn,-ni,$,dt)}else"butt"===kt?this.addCurrentVertex(H,yn,0,0,$,dt):"square"===kt?(ee||this.addCurrentVertex(H,yn,-1,-1,$,dt),this.addCurrentVertex(H,yn,0,0,$,dt),ee&&this.addCurrentVertex(H,yn,1,1,$,dt)):"round"===kt&&(ee&&(this.addCurrentVertex(H,Oe,0,0,$,dt),this.addCurrentVertex(H,Oe,1,1,$,dt,!0)),Pe&&(this.addCurrentVertex(H,ke,-1,-1,$,dt,!0),this.addCurrentVertex(H,ke,0,0,$,dt)));if(Sn&&st<P-1){const xn=H.dist(Pe);if(xn>2*z){const Hn=H.add(Pe.sub(H)._mult(z/xn)._round());this.updateDistance(H,Hn),this.addCurrentVertex(Hn,ke,0,0,$,dt),H=Hn}}}}addVerticesTo(e,n,s,c,d,f,_,x,E,D){const S=(n.w-e.w)/this.tessellationStep|0;if(S>1){this.lineSoFar=e.w;const P=(n.x-e.x)/S,F=(n.y-e.y)/S,z=(n.z-e.z)/S,$=(n.w-e.w)/S;for(let H=1;H<S;++H)e.x+=P,e.y+=F,e.z+=z,this.lineSoFar+=$,this.addHalfVertex(e,s,c,D,!1,_,E,e.z),this.addHalfVertex(e,d,f,D,!0,-x,E,e.z)}this.lineSoFar=n.w,this.addHalfVertex(n,s,c,D,!1,_,E,n.z),this.addHalfVertex(n,d,f,D,!0,-x,E,n.z)}addCurrentVertex(e,n,s,c,d,f,_=!1){const x=n.x+n.y*s,E=n.y-n.x*s,D=n.y*c-n.x,S=-n.y-n.x*c;if(null!=f){const F=hi+10,z=f,$=new Bg(e.x,e.y,z,this.lineSoFar),H=ow(e,-10,F),ee=this.lineSoFar;if(this.currentVertex)if(H){const Pe=this.currentVertexIsOutside,Oe=this.currentVertex,ke=new Bg(e.x,e.y,z,this.lineSoFar);i1(Oe,ke,-10,F),ow(ke,-10,F)||(Pe&&(this.e1=this.e2=-1,this.lineSoFar=Oe.w,this.addHalfVertex(Oe,x,E,_,!1,s,d,Oe.z),this.addHalfVertex(Oe,D,S,_,!0,-c,d,Oe.z)),this.addVerticesTo(Oe,ke,x,E,D,S,s,c,d,_))}else{const Pe=this.currentVertex;this.currentVertexIsOutside&&(i1(Pe,$,-10,F),this.e1=this.e2=-1,this.lineSoFar=Pe.w,this.addHalfVertex(Pe,x,E,_,!1,s,d,Pe.z),this.addHalfVertex(Pe,D,S,_,!0,-c,d,Pe.z)),this.addVerticesTo(Pe,$,x,E,D,S,s,c,d,_)}else H||(this.addHalfVertex(e,x,E,_,!1,s,d,f),this.addHalfVertex(e,D,S,_,!0,-c,d,f));this.currentVertex=$,this.currentVertexIsOutside=H,this.lineSoFar=ee}else this.addHalfVertex(e,x,E,_,!1,s,d,f),this.addHalfVertex(e,D,S,_,!0,-c,d,f)}addHalfVertex({x:e,y:n},s,c,d,f,_,x,E){this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,_)),this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(n<<1)+(f?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(0===_?0:_<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const D=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),x.primitiveLength++),f?this.e2=D:this.e1=D,null!=E&&this.zOffsetVertexArray.emplaceBack(E)}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}function ow(t,e,n){return t.x<e||t.x>n||t.y<e||t.y>n}Ee(iv,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const rv=new to({"line-cap":new Pi(Jt.layout_line["line-cap"]),"line-join":new Pi(Jt.layout_line["line-join"]),"line-miter-limit":new Mn(Jt.layout_line["line-miter-limit"]),"line-round-limit":new Mn(Jt.layout_line["line-round-limit"]),"line-sort-key":new Pi(Jt.layout_line["line-sort-key"]),"line-z-offset":new Pi(Jt.layout_line["line-z-offset"]),visibility:new Mn(Jt.layout_line.visibility)});var ov={paint:new to({"line-opacity":new Pi(Jt.paint_line["line-opacity"]),"line-color":new Pi(Jt.paint_line["line-color"]),"line-translate":new Mn(Jt.paint_line["line-translate"]),"line-translate-anchor":new Mn(Jt.paint_line["line-translate-anchor"]),"line-width":new Pi(Jt.paint_line["line-width"]),"line-gap-width":new Pi(Jt.paint_line["line-gap-width"]),"line-offset":new Pi(Jt.paint_line["line-offset"]),"line-blur":new Pi(Jt.paint_line["line-blur"]),"line-dasharray":new Pi(Jt.paint_line["line-dasharray"]),"line-pattern":new Pi(Jt.paint_line["line-pattern"]),"line-gradient":new zs(Jt.paint_line["line-gradient"]),"line-trim-offset":new Mn(Jt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Mn(Jt.paint_line["line-trim-fade-range"]),"line-trim-color":new Mn(Jt.paint_line["line-trim-color"]),"line-emissive-strength":new Mn(Jt.paint_line["line-emissive-strength"]),"line-border-width":new Pi(Jt.paint_line["line-border-width"]),"line-border-color":new Pi(Jt.paint_line["line-border-color"]),"line-occlusion-opacity":new Mn(Jt.paint_line["line-occlusion-opacity"])}),layout:rv};function sw(t,e,n){return e*(hi/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function aw(t,e){return 1/sw(t,1,e.tileZoom)}function lw(t,e,n,s){return t.translatePosMatrix(s||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const cw=t=>{const e=[];D1(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=t.paint.get("line-trim-offset");0===n[0]&&0===n[1]||e.push("RENDER_LINE_TRIM_OFFSET"),0!==t.paint.get("line-border-width").constantOr(1)&&e.push("RENDER_LINE_BORDER");const s="none"===t.layout.get("line-join").constantOr("miter"),c=!!t.paint.get("line-pattern").constantOr(1);return s&&c&&e.push("LINE_JOIN_NONE"),e};function D1(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}class mm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var Kg={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(t,e,n,s,c){var d,f,_=8*c-s-1,x=(1<<_)-1,E=x>>1,D=-7,S=n?c-1:0,P=n?-1:1,F=t[e+S];for(S+=P,d=F&(1<<-D)-1,F>>=-D,D+=_;D>0;d=256*d+t[e+S],S+=P,D-=8);for(f=d&(1<<-D)-1,d>>=-D,D+=s;D>0;f=256*f+t[e+S],S+=P,D-=8);if(0===d)d=1-E;else{if(d===x)return f?NaN:1/0*(F?-1:1);f+=Math.pow(2,s),d-=E}return(F?-1:1)*f*Math.pow(2,d-s)},write:function(t,e,n,s,c,d){var f,_,x,E=8*d-c-1,D=(1<<E)-1,S=D>>1,P=23===c?Math.pow(2,-24)-Math.pow(2,-77):0,F=s?0:d-1,z=s?1:-1,$=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,f=D):(f=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-f))<1&&(f--,x*=2),(e+=f+S>=1?P/x:P*Math.pow(2,1-S))*x>=2&&(f++,x/=2),f+S>=D?(_=0,f=D):f+S>=1?(_=(e*x-1)*Math.pow(2,c),f+=S):(_=e*Math.pow(2,S-1)*Math.pow(2,c),f=0));c>=8;t[n+F]=255&_,F+=z,_/=256,c-=8);for(f=f<<c|_,E+=c;E>0;t[n+F]=255&f,F+=z,f/=256,E-=8);t[n+F-z]|=128*$}},sv=Xo,gm=Kg;function Xo(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Xo.Varint=0,Xo.Fixed64=1,Xo.Bytes=2,Xo.Fixed32=5;var av=4294967296,M1=1/av,lv=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ol(t){return t.type===Xo.Bytes?t.readVarint()+t.pos:t.pos+1}function _l(t,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var c=n.pos-1;c>=t;c--)n.buf[c+s]=n.buf[c]}function S1(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function dT(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function uw(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function hT(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function fT(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function A1(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function P1(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function pT(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function Zg(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Zf(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function eh(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function R1(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Xo.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),c=s>>3,d=this.pos;this.type=7&s,t(c,e,this),this.pos===d&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Zf(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=R1(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Zf(this.buf,this.pos)+Zf(this.buf,this.pos+4)*av;return this.pos+=8,t},readSFixed64:function(){var t=Zf(this.buf,this.pos)+R1(this.buf,this.pos+4)*av;return this.pos+=8,t},readFloat:function(){var t=gm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=gm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(c,d,f){var _,x,E=f.buf;if(_=(112&(x=E[f.pos++]))>>4,x<128||(_|=(127&(x=E[f.pos++]))<<3,x<128)||(_|=(127&(x=E[f.pos++]))<<10,x<128)||(_|=(127&(x=E[f.pos++]))<<17,x<128)||(_|=(127&(x=E[f.pos++]))<<24,x<128)||(_|=(1&(x=E[f.pos++]))<<31,x<128))return function Ma(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(c,_,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&lv?lv.decode(this.buf.subarray(e,t)):function(n,s,c){for(var d="",f=s;f<c;){var _,x,E,D=n[f],S=null,P=D>239?4:D>223?3:D>191?2:1;if(f+P>c)break;1===P?D<128&&(S=D):2===P?128==(192&(_=n[f+1]))&&(S=(31&D)<<6|63&_)<=127&&(S=null):3===P?(x=n[f+2],128==(192&(_=n[f+1]))&&128==(192&x)&&((S=(15&D)<<12|(63&_)<<6|63&x)<=2047||S>=55296&&S<=57343)&&(S=null)):4===P&&(x=n[f+2],E=n[f+3],128==(192&(_=n[f+1]))&&128==(192&x)&&128==(192&E)&&((S=(15&D)<<18|(63&_)<<12|(63&x)<<6|63&E)<=65535||S>=1114112)&&(S=null)),null===S?(S=65533,P=1):S>65535&&(S-=65536,d+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),d+=String.fromCharCode(S),f+=P}return d}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Xo.Bytes)return t.push(this.readVarint(e));var n=Ol(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Xo.Bytes)return t.push(this.readSVarint());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Xo.Bytes)return t.push(this.readBoolean());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Xo.Bytes)return t.push(this.readFloat());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Xo.Bytes)return t.push(this.readDouble());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Xo.Bytes)return t.push(this.readFixed32());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Xo.Bytes)return t.push(this.readSFixed32());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Xo.Bytes)return t.push(this.readFixed64());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Xo.Bytes)return t.push(this.readSFixed64());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Xo.Varint)for(;this.buf[this.pos++]>127;);else if(e===Xo.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Xo.Fixed32)this.pos+=4;else{if(e!==Xo.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),eh(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),eh(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),eh(this.buf,-1&t,this.pos),eh(this.buf,Math.floor(t*M1),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),eh(this.buf,-1&t,this.pos),eh(this.buf,Math.floor(t*M1),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var s,c,d,_;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,c=c+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),d=s,(_=n).buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,_.buf[_.pos]=127&(d>>>=7),function(d,f){var _=(7&d)<<4;f.buf[f.pos++]|=_|((d>>>=3)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d)))))}(c,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,c,d){for(var f,_,x=0;x<c.length;x++){if((f=c.charCodeAt(x))>55295&&f<57344){if(!_){f>56319||x+1===c.length?(s[d++]=239,s[d++]=191,s[d++]=189):_=f;continue}if(f<56320){s[d++]=239,s[d++]=191,s[d++]=189,_=f;continue}f=_-55296<<10|f-56320|65536,_=null}else _&&(s[d++]=239,s[d++]=191,s[d++]=189,_=null);f<128?s[d++]=f:(f<2048?s[d++]=f>>6|192:(f<65536?s[d++]=f>>12|224:(s[d++]=f>>18|240,s[d++]=f>>12&63|128),s[d++]=f>>6&63|128),s[d++]=63&f|128)}return d}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&_l(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),gm.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),gm.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var s=this.pos-n;s>=128&&_l(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,n){this.writeTag(t,Xo.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,S1,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,dT,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,fT,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,uw,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,hT,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,A1,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,P1,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,pT,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Zg,e)},writeBytesField:function(t,e){this.writeTag(t,Xo.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Xo.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Xo.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Xo.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Xo.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Xo.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Xo.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Xo.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Xo.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Xo.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Kc=ht(sv);const cv=["id","tile","layer","source","sourceLayer","state"];class uv{constructor(e,n,s,c,d){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=s,this._y=c,this.properties=e.properties,this.id=d}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const n of cv)void 0!==this[n]&&(e[n]=this[n]);return e}}class dv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,s){const c=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},ai(this.stateChanges[e][c],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const d in this.state[e])d!==c&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][c]){this.deletedStates[e][c]={};for(const d in this.state[e][c])s[d]||(this.deletedStates[e][c][d]=null)}else for(const d in s)this.deletedStates[e]&&this.deletedStates[e][c]&&null===this.deletedStates[e][c][d]&&delete this.deletedStates[e][c][d]}removeFeatureState(e,n,s){if(null===this.deletedStates[e])return;const c=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==n)null!==this.deletedStates[e][c]&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][s]=null);else if(void 0!==n)if(this.stateChanges[e]&&this.stateChanges[e][c])for(s in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][s]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,n){const s=String(n),c=ai({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const d=this.deletedStates[e][n];if(null===d)return{};for(const f in d)delete c[f]}return c}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const s={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const f in this.stateChanges[c])this.state[c][f]||(this.state[c][f]={}),ai(this.state[c][f],this.stateChanges[c][f]),d[f]=this.state[c][f];s[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(null===this.deletedStates[c])for(const f in this.state[c])d[f]={},this.state[c][f]={};else for(const f in this.deletedStates[c]){if(null===this.deletedStates[c][f])this.state[c][f]={};else if(this.state[c][f])for(const _ of Object.keys(this.deletedStates[c][f]))delete this.state[c][f][_];d[f]=this.state[c][f]}s[c]=s[c]||{},ai(s[c],d)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const c in e)e[c].setFeatureState(s,n)}}class _m{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new _t(hi,16,0),this.featureIndexArray=new cy,this.promoteId=n,this.is3DTile=!1}insert(e,n,s,c,d,f=0,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,d,f);const E=this.grid;for(let D=0;D<n.length;D++){const S=n[D],P=[1/0,1/0,-1/0,-1/0];for(let F=0;F<S.length;F++){const z=S[F];P[0]=Math.min(P[0],z.x),P[1]=Math.min(P[1],z.y),P[2]=Math.max(P[2],z.x),P[3]=Math.max(P[3],z.y)}0!==_&&(P[0]-=_,P[1]-=_,P[2]+=_,P[3]+=_),P[0]<hi&&P[1]<hi&&P[2]>=0&&P[3]>=0&&E.insert(x,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new am(new Kc(this.rawTileData)).layers,this.sourceLayerCoder=new mm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,s,c){this.loadVTLayers();const d=e.params||{},f=Xs(d.filter),_=e.tileResult,x=e.transform,E=_.bufferedTilespaceBounds,D=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(z,$,H,ee)=>z0(_.bufferedTilespaceGeometry,z,$,H,ee));D.sort(dw);let S=null;x.elevation&&D.length>0&&(S=Xf.create(x.elevation,this.tileID));const P={};let F;for(let z=0;z<D.length;z++){const $=D[z];if($===F)continue;F=$;const H=this.featureIndexArray.get($);let ee=null;if(this.is3DTile){const Pe=this.bucketLayerIDs[0][0],Oe=n[Pe];if("model"!==Oe.type)continue;const{queryFeature:ke,intersectionZ:dt}=Oe.queryIntersectsMatchingFeature(_,H.featureIndex,f,x);ke&&this.appendToResult(P,Pe,H.featureIndex,ke,dt)}else this.loadMatchingFeature(P,H,f,d.layers,d.availableImages,n,s,c,(Pe,Oe,ke,dt=0)=>(ee||(ee=wu(Pe,this.tileID.canonical,e.tileTransform)),Oe.queryIntersectsFeature(_,Pe,ke,ee,this.z,e.transform,e.pixelPosMatrix,S,dt)))}return P}loadMatchingFeature(e,n,s,c,d,f,_,x,E){const{featureIndex:D,bucketIndex:S,sourceLayerIndex:P,layoutVertexArrayOffset:F}=n,z=this.bucketLayerIDs[S];if(c&&!function(Pe,Oe){for(let ke=0;ke<Pe.length;ke++)if(Oe.indexOf(Pe[ke])>=0)return!0;return!1}(c,z))return;const $=this.sourceLayerCoder.decode(P),H=this.vtLayers[$].feature(D);if(s.needGeometry){const Pe=Eu(H,!0);if(!s.filter(new rr(this.tileID.overscaledZ),Pe,this.tileID.canonical))return}else if(!s.filter(new rr(this.tileID.overscaledZ),H))return;const ee=this.getId(H,$);for(let Pe=0;Pe<z.length;Pe++){const Oe=z[Pe];if(c&&c.indexOf(Oe)<0)continue;const ke=f[Oe];if(!ke)continue;let dt={};void 0!==ee&&x&&(dt=x.getState(ke.sourceLayer||"_geojsonTileLayer",ee));const st=!E||E(H,ke,dt,F);if(!st)continue;const Dt=new uv(H,this.z,this.x,this.y,ee),kt=ai({},_[Oe]);kt.paint=O1(kt.paint,ke.paint,H,dt,d),kt.layout=O1(kt.layout,ke.layout,H,dt,d),Dt.layer=kt,this.appendToResult(e,Oe,D,Dt,st)}}appendToResult(e,n,s,c,d){let f=e[n];void 0===f&&(f=e[n]=[]),f.push({featureIndex:s,feature:c,intersectionZ:d})}lookupSymbolFeatures(e,n,s,c,d,f,_,x){const E={};this.loadVTLayers();const D=Xs(d);for(const S of e)this.loadMatchingFeature(E,{bucketIndex:s,sourceLayerIndex:c,featureIndex:S,layoutVertexArrayOffset:0},D,f,_,x,n);return E}loadFeature(e){const{featureIndex:n,sourceLayerIndex:s}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(s),d=this.vtFeatures[c];if(d[n])return d[n];const f=this.vtLayers[c].feature(n);return d[n]=f,f}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;if(this.promoteId){const c="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=c&&(s=e.properties[c]),"boolean"==typeof s&&(s=Number(s))}return s}}function O1(t,e,n,s,c){return Di(t,(d,f)=>{const _=e instanceof No?e.get(f):null;return _&&_.evaluate?_.evaluate(n,s,c):_})}function dw(t,e){return e-t}Ee(_m,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var sa=24;const Zc=128;function hv(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new rr(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:c}=n;let d=0;for(;d<s.length&&s[d]<=t;)d++;d=Math.max(0,d-1);let f=d;for(;f<s.length&&s[f]<t+1;)f++;f=Math.min(s.length-1,f);const _=s[d],x=s[f];return"composite"===n.kind?{kind:"composite",minZoom:_,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:x,minSize:n.evaluate(new rr(_)),maxSize:n.evaluate(new rr(x)),interpolationType:c}}}function ym(t,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:c}){return"source"===t.kind?s/Zc:"composite"===t.kind?zi(s/Zc,c/Zc,n):e}function th(t,e){let n=0,s=0;if("constant"===t.kind)s=t.layoutSize;else if("source"!==t.kind){const{interpolationType:c,minZoom:d,maxZoom:f}=t,_=c?Ut(ml.interpolationFactor(c,e,d,f),0,1):0;"camera"===t.kind?s=zi(t.minSize,t.maxSize,_):n=_}return{uSizeT:n,uSize:s}}var vm=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Zc,evaluateSizeForFeature:ym,evaluateSizeForZoom:th,getSizeData:hv});function qg(t,e,n){return t.sections.forEach(s=>{s.text=function(c,d,f){const _=d.layout.get("text-transform").evaluate(f,{});return"uppercase"===_?c=c.toLocaleUpperCase():"lowercase"===_&&(c=c.toLocaleLowerCase()),Rr.applyArabicShaping&&(c=Rr.applyArabicShaping(c)),c}(s.text,e,n)}),t}const qh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function hw(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function fw(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}const xm=3;function L1(t,e,n){e.glyphs=[],1===t&&n.readMessage(Yh,e)}function Yh(t,e,n){if(3===t){const{id:s,bitmap:c,width:d,height:f,left:_,top:x,advance:E}=n.readMessage(k1,{});e.glyphs.push({id:s,bitmap:new Yd({width:d+2*xm,height:f+2*xm},c),metrics:{width:d,height:f,left:_,top:x,advance:E}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function k1(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}const fv=xm,tc={horizontal:1,vertical:2,horizontalOnly:3};class Yg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new Yg;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new Yg;return n.imageName=e,n}}class gd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new gd;for(let c=0;c<e.sections.length;c++){const d=e.sections[c];d.image?s.addImageSection(d):s.addTextSection(d,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,s){let c="";for(let d=0;d<n.length;d++){const f=n.charCodeAt(d+1)||null,_=n.charCodeAt(d-1)||null;c+=!s&&(f&&Xt(f)&&!qh[n[d+1]]||_&&Xt(_)&&!qh[n[d-1]])||!qh[n[d]]?n[d]:qh[n[d]]}return c}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&bm[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&bm[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new gd;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Yg.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.namePrimary:"";if(0===n.length)return void Do("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(Yg.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Do("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function pv(t,e,n,s,c,d,f,_,x,E,D,S,P,F,z){const $=gd.fromFeature(t,c);S===tc.vertical&&$.verticalizePunctuation(P);let H=[];const ee=function(st,Dt,kt,Yt,yn,dn){if(!st)return[];const Fn=[],Yn=function(Hn,ni,Zn,Si,Qn,ci){let Qi=0;for(let $i=0;$i<Hn.length();$i++){const ji=Hn.getSection($i);Qi+=mv(Hn.getCodePoint($i),ji,Si,Qn,ni,ci)}return Qi/Math.max(1,Math.ceil(Qi/Zn))}(st,Dt,kt,Yt,yn,dn),Sn=st.text.indexOf("\u200b")>=0;let Wn=0;for(let Hn=0;Hn<st.length();Hn++){const ni=st.getSection(Hn),Zn=st.getCodePoint(Hn);if(bm[Zn]||(Wn+=mv(Zn,ni,Yt,yn,Dt,dn)),Hn<st.length()-1){const Si=!((xn=Zn)<11904||!(It["Bopomofo Extended"](xn)||It.Bopomofo(xn)||It["CJK Compatibility Forms"](xn)||It["CJK Compatibility Ideographs"](xn)||It["CJK Compatibility"](xn)||It["CJK Radicals Supplement"](xn)||It["CJK Strokes"](xn)||It["CJK Symbols and Punctuation"](xn)||It["CJK Unified Ideographs Extension A"](xn)||It["CJK Unified Ideographs"](xn)||It["Enclosed CJK Letters and Months"](xn)||It["Halfwidth and Fullwidth Forms"](xn)||It.Hiragana(xn)||It["Ideographic Description Characters"](xn)||It["Kangxi Radicals"](xn)||It["Katakana Phonetic Extensions"](xn)||It.Katakana(xn)||It["Vertical Forms"](xn)||It["Yi Radicals"](xn)||It["Yi Syllables"](xn)));(F1[Zn]||Si||ni.imageName)&&Fn.push(wm(Hn+1,Wn,Yn,Fn,N1(Zn,st.getCodePoint(Hn+1),Si&&Sn),!1))}}var xn;return Jh(wm(st.length(),Wn,Yn,Fn,0,!0))}($,E,d,e,s,F),{processBidirectionalText:Pe,processStyledBidirectionalText:Oe}=Rr;if(Pe&&1===$.sections.length){const st=Pe($.toString(),ee);for(const Dt of st){const kt=new gd;kt.text=Dt,kt.sections=$.sections;for(let Yt=0;Yt<Dt.length;Yt++)kt.sectionIndex.push(0);H.push(kt)}}else if(Oe){const st=Oe($.text,$.sectionIndex,ee);for(const Dt of st){const kt=new gd;kt.text=Dt[0],kt.sectionIndex=Dt[1],kt.sections=$.sections,H.push(kt)}}else H=function(st,Dt){const kt=[],Yt=st.text;let yn=0;for(const dn of Dt)kt.push(st.substring(yn,dn)),yn=dn;return yn<Yt.length&&kt.push(st.substring(yn,Yt.length)),kt}($,ee);const ke=[],dt={positionedLines:ke,text:$.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(st,Dt,kt,Yt,yn,dn,Fn,Yn,Sn,Wn,xn,Hn){let ni=0,Zn=0,Si=0;const Qn="right"===Yn?1:"left"===Yn?0:.5;let ci=!1;for(const Dr of yn){const or=Dr.getSections();for(const Mr of or){if(Mr.imageName)continue;const Er=Dt[Mr.fontStack];if(Er&&(ci=void 0!==Er.ascender&&void 0!==Er.descender,!ci))break}if(!ci)break}let Qi=0;for(const Dr of yn){Dr.trim();const or=Dr.getMaxScale(),Mr=(or-1)*sa,Er={positionedGlyphs:[],lineOffset:0};st.positionedLines[Qi]=Er;const Or=Er.positionedGlyphs;let ir=0;if(!Dr.length()){Zn+=dn,++Qi;continue}let Mo=0,Co=0;for(let Hr=0;Hr<Dr.length();Hr++){const so=Dr.getSection(Hr),$o=Dr.getSectionIndex(Hr),Bo=Dr.getCodePoint(Hr);let ms=so.scale,us=null,Va=null,Es=null,os=sa,Ts=0;const Js=!(Sn===tc.horizontal||!xn&&!Vn(Bo)||xn&&(bm[Bo]||($i=Bo,It.Arabic($i)||It["Arabic Supplement"]($i)||It["Arabic Extended-A"]($i)||It["Arabic Presentation Forms-A"]($i)||It["Arabic Presentation Forms-B"]($i))));if(so.imageName){const da=Yt[so.imageName];if(!da)continue;Es=so.imageName,st.iconsInText=st.iconsInText||!0,Va=da.paddedRect;const Uo=da.displaySize;ms=ms*sa/Hn,us={width:Uo[0],height:Uo[1],left:0,top:-fv,advance:Js?Uo[1]:Uo[0],localGlyph:!1},Ts=ci?-us.height*ms:or*sa-17-Uo[1]*ms,os=us.advance;const vl=(Js?Uo[0]:Uo[1])*ms-sa*or;vl>0&&vl>ir&&(ir=vl)}else{const da=kt[so.fontStack];if(!da)continue;da[Bo]&&(Va=da[Bo]);const Uo=Dt[so.fontStack];if(!Uo)continue;const vl=Uo.glyphs[Bo];if(!vl)continue;if(us=vl.metrics,os=8203!==Bo?sa:0,ci){const hh=void 0!==Uo.ascender?Math.abs(Uo.ascender):0,eu=void 0!==Uo.descender?Math.abs(Uo.descender):0,Pu=(hh+eu)*ms;Mo<Pu&&(Mo=Pu,Co=(hh-eu)/2*ms),Ts=-hh*ms}else Ts=(or-ms)*sa-17}Js?(st.verticalizable=!0,Or.push({glyph:Bo,imageName:Es,x:ni,y:Zn+Ts,vertical:Js,scale:ms,localGlyph:us.localGlyph,fontStack:so.fontStack,sectionIndex:$o,metrics:us,rect:Va}),ni+=os*ms+Wn):(Or.push({glyph:Bo,imageName:Es,x:ni,y:Zn+Ts,vertical:Js,scale:ms,localGlyph:us.localGlyph,fontStack:so.fontStack,sectionIndex:$o,metrics:us,rect:Va}),ni+=us.advance*ms+Wn)}0!==Or.length&&(Si=Math.max(ni-Wn,Si),ci?e_(Or,Qn,ir,Co,dn*or/2):e_(Or,Qn,ir,0,dn/2)),ni=0;const Qr=dn*or+ir;Er.lineOffset=Math.max(ir,Mr),Zn+=Qr,++Qi}var $i;const ji=Zn,{horizontalAlign:ri,verticalAlign:tr}=Qg(Fn);(function(Dr,or,Mr,Er,Or,ir){const Mo=(or-Mr)*Or,Co=-ir*Er;for(const Qr of Dr)for(const Hr of Qr.positionedGlyphs)Hr.x+=Mo,Hr.y+=Co})(st.positionedLines,Qn,ri,tr,Si,ji),st.top+=-tr*ji,st.bottom=st.top+ji,st.left+=-ri*Si,st.right=st.left+Si,st.hasBaseline=ci}(dt,e,n,s,H,f,_,x,S,E,P,z),!function(st){for(const Dt of st)if(0!==Dt.positionedGlyphs.length)return!1;return!0}(ke)&&dt}const bm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},F1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function mv(t,e,n,s,c,d){if(e.imageName){const f=s[e.imageName];return f?f.displaySize[0]*e.scale*sa/d+c:0}{const f=n[e.fontStack],_=f&&f.glyphs[t];return _?_.metrics.advance*e.scale+c:0}}function Jg(t,e,n,s){const c=Math.pow(t-e,2);return s?t<e?c/2:2*c:c+Math.abs(n)*n}function N1(t,e,n){let s=0;return 10===t&&(s-=1e4),n&&(s+=150),40!==t&&65288!==t||(s+=50),41!==e&&65289!==e||(s+=50),s}function wm(t,e,n,s,c,d){let f=null,_=Jg(e,n,c,d);for(const x of s){const E=Jg(e-x.x,n,c,d)+x.badness;E<=_&&(f=x,_=E)}return{index:t,x:e,priorBreak:f,badness:_}}function Jh(t){return t?Jh(t.priorBreak).concat(t.index):[]}function Qg(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function e_(t,e,n,s,c){if(!(e||n||s||c))return;const d=t.length-1,f=t[d],_=(f.x+f.metrics.advance*f.scale)*e;for(let x=0;x<=d;x++)t[x].x-=_,t[x].y+=n+s+c}function Em(t,e,n,s){const{horizontalAlign:c,verticalAlign:d}=Qg(s),f=n[0]-t.displaySize[0]*c,_=n[1]-t.displaySize[1]*d;return{imagePrimary:t,imageSecondary:e,top:_,bottom:_+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function gv(t,e,n,s,c,d){const f=t.imagePrimary;let _;if(f.content){const H=f.content,ee=f.pixelRatio||1;_=[H[0]/ee,H[1]/ee,f.displaySize[0]-H[2]/ee,f.displaySize[1]-H[3]/ee]}const x=e.left*d,E=e.right*d;let D,S,P,F;"width"===n||"both"===n?(F=c[0]+x-s[3],S=c[0]+E+s[1]):(F=c[0]+(x+E-f.displaySize[0])/2,S=F+f.displaySize[0]);const z=e.top*d,$=e.bottom*d;return"height"===n||"both"===n?(D=c[1]+z-s[0],P=c[1]+$+s[2]):(D=c[1]+(z+$-f.displaySize[1])/2,P=D+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:D,right:S,bottom:P,left:F,collisionPadding:_}}class qc extends Ae{constructor(e,n,s,c,d){super(e,n),this.angle=c,this.z=s,void 0!==d&&(this.segment=d)}clone(){return new qc(this.x,this.y,this.z,this.angle,this.segment)}}function Cm(t,e,n,s,c){if(void 0===e.segment)return!0;let d=e,f=e.segment+1,_=0;for(;_>-n/2;){if(f--,f<0)return!1;_-=t[f].dist(d),d=t[f]}_+=t[f].dist(t[f+1]),f++;const x=[];let E=0;for(;_<n/2;){const D=t[f],S=t[f+1];if(!S)return!1;let P=t[f-1].angleTo(D)-D.angleTo(S);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:P}),E+=P;_-x[0].distance>s;)E-=x.shift().angleDelta;if(E>c)return!1;f++,_+=D.dist(S)}return!0}function B1(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function _v(t,e,n){return t?.6*e*n:0}function z1(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function pw(t,e,n,s,c,d){const f=_v(n,c,d),_=z1(n,s)*d;let x=0;const E=B1(t)/2;for(let D=0;D<t.length-1;D++){const S=t[D],P=t[D+1],F=S.dist(P);if(x+F>E){const z=(E-x)/F,$=zi(S.x,P.x,z),H=zi(S.y,P.y,z),ee=new qc($,H,0,P.angleTo(S),D);return!f||Cm(t,ee,_,f,e)?ee:void 0}x+=F}}function mw(t,e,n,s,c,d,f,_,x){const E=_v(s,d,f),D=z1(s,c),S=D*f,P=0===t[0].x||t[0].x===x||0===t[0].y||t[0].y===x;return e-S<e/4&&(e=S+e/4),yv(t,P?e/2*_%e:(D/2+2*d)*f*_%e,e,E,n,S,P,!1,x)}function yv(t,e,n,s,c,d,f,_,x){const E=d/2,D=B1(t);let S=0,P=e-n,F=[];for(let z=0;z<t.length-1;z++){const $=t[z],H=t[z+1],ee=$.dist(H),Pe=H.angleTo($);for(;P+n<S+ee;){P+=n;const Oe=(P-S)/ee,ke=zi($.x,H.x,Oe),dt=zi($.y,H.y,Oe);if(ke>=0&&ke<x&&dt>=0&&dt<x&&P-E>=0&&P+E<=D){const st=new qc(ke,dt,0,Pe,z);s&&!Cm(t,st,d,s,c)||F.push(st)}}S+=ee}return _||F.length||f||(F=yv(t,S/2,n,s,c,d,f,!0,x)),F}function vv(t,e,n,s,c){const d=[];for(let f=0;f<t.length;f++){const _=t[f];let x;for(let E=0;E<_.length-1;E++){let D=_[E],S=_[E+1];D.x<e&&S.x<e||(D.x<e?D=new Ae(e,D.y+(e-D.x)/(S.x-D.x)*(S.y-D.y))._round():S.x<e&&(S=new Ae(e,D.y+(e-D.x)/(S.x-D.x)*(S.y-D.y))._round()),D.y<n&&S.y<n||(D.y<n?D=new Ae(D.x+(n-D.y)/(S.y-D.y)*(S.x-D.x),n)._round():S.y<n&&(S=new Ae(D.x+(n-D.y)/(S.y-D.y)*(S.x-D.x),n)._round()),D.x>=s&&S.x>=s||(D.x>=s?D=new Ae(s,D.y+(s-D.x)/(S.x-D.x)*(S.y-D.y))._round():S.x>=s&&(S=new Ae(s,D.y+(s-D.x)/(S.x-D.x)*(S.y-D.y))._round()),D.y>=c&&S.y>=c||(D.y>=c?D=new Ae(D.x+(c-D.y)/(S.y-D.y)*(S.x-D.x),c)._round():S.y>=c&&(S=new Ae(D.x+(c-D.y)/(S.y-D.y)*(S.x-D.x),c)._round()),x&&D.equals(x[x.length-1])||(x=[D],d.push(x)),x.push(S)))))}}return d}function Jr(t){let e=0,n=0;for(const f of t)e+=f.w*f.h,n=Math.max(n,f.w);t.sort((f,_)=>_.h-f.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,d=0;for(const f of t)for(let _=s.length-1;_>=0;_--){const x=s[_];if(!(f.w>x.w||f.h>x.h)){if(f.x=x.x,f.y=x.y,d=Math.max(d,f.y+f.h),c=Math.max(c,f.x+f.w),f.w===x.w&&f.h===x.h){const E=s.pop();_<s.length&&(s[_]=E)}else f.h===x.h?(x.x+=f.w,x.w-=f.w):f.w===x.w?(x.y+=f.h,x.h-=f.h):(s.push({x:x.x+f.w,y:x.y,w:x.w-f.w,h:f.h}),x.y+=f.h,x.h-=f.h);break}}return{w:c,h:d,fill:e/(c*d)||0}}Ee(qc,"Anchor");const yl=1;class t_{constructor(e,{pixelRatio:n,version:s,stretchX:c,stretchY:d,content:f}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=d,this.content=f,this.version=s}get tl(){return[this.paddedRect.x+yl,this.paddedRect.y+yl]}get br(){return[this.paddedRect.x+this.paddedRect.w-yl,this.paddedRect.y+this.paddedRect.h-yl]}get displaySize(){return[(this.paddedRect.w-2*yl)/this.pixelRatio,(this.paddedRect.h-2*yl)/this.pixelRatio]}}class Qh{constructor(e,n,s){const c={},d={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,c,f),this.addImages(n,d,f);const{w:_,h:x}=Jr(f),E=new vc({width:_||1,height:x||1});for(const D in e){const S=e[D],P=c[D].paddedRect;vc.copy(S.data,E,{x:0,y:0},{x:P.x+yl,y:P.y+yl},S.data,s,S.sdf)}for(const D in n){const S=n[D],P=d[D].paddedRect,F=P.x+yl,z=P.y+yl,$=S.data.width,H=S.data.height;vc.copy(S.data,E,{x:0,y:0},{x:F,y:z},S.data,s),vc.copy(S.data,E,{x:0,y:H-1},{x:F,y:z-1},{width:$,height:1},s),vc.copy(S.data,E,{x:0,y:0},{x:F,y:z+H},{width:$,height:1},s),vc.copy(S.data,E,{x:$-1,y:0},{x:F-1,y:z},{width:1,height:H},s),vc.copy(S.data,E,{x:0,y:0},{x:F+$,y:z},{width:1,height:H},s)}this.image=E,this.iconPositions=c,this.patternPositions=d}addImages(e,n,s){for(const c in e){const d=e[c],f={x:0,y:0,w:d.data.width+2*yl,h:d.data.height+2*yl};s.push(f),n[c]=new t_(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const c in e.getUpdatedImages(s))this.patchUpdatedImage(this.iconPositions[c],e.getImage(c,s),n),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c,s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[c,d]=e.tl,f=!!Object.keys(this.patternPositions).length;s.update(n.data,{useMipmap:f},{x:c,y:d})}}Ee(t_,"ImagePosition"),Ee(Qh,"ImageAtlas");const qf=1e20;function xv(t,e,n,s,c,d,f,_,x){for(let E=e;E<e+s;E++)U1(t,n*d+E,d,c,f,_,x);for(let E=n;E<n+c;E++)U1(t,E*d+e,1,s,f,_,x)}function U1(t,e,n,s,c,d,f){d[0]=0,f[0]=-qf,f[1]=qf,c[0]=t[e];for(let _=1,x=0,E=0;_<s;_++){c[_]=t[e+_*n];const D=_*_;do{const S=d[x];E=(c[_]-c[S]+D-S*S)/(_-S)/2}while(E<=f[x]&&--x>-1);x++,d[x]=_,f[x]=E,f[x+1]=qf}for(let _=0,x=0;_<s;_++){for(;f[x+1]<_;)x++;const E=d[x],D=_-E;t[e+_*n]=c[E]+D*D}}const Ll=2,_d={none:0,ideographs:1,all:2};class nh{constructor(e,n,s){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,s){const c=[],d=this.urls[n]||T.GLYPHS_URL;for(const f in e)for(const _ of e[f])c.push({stack:f,id:_});ti(c,({stack:f,id:_},x)=>{let E=this.entries[f];E||(E=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=E.glyphs[_];if(void 0!==D)return void x(null,{stack:f,id:_,glyph:D});if(D=this._tinySDF(E,f,_),D)return E.glyphs[_]=D,void x(null,{stack:f,id:_,glyph:D});const S=Math.floor(_/256);if(256*S>65535)return void x(new Error("glyphs > 65535 not supported"));if(E.ranges[S])return void x(null,{stack:f,id:_,glyph:D});let P=E.requests[S];P||(P=E.requests[S]=[],nh.loadGlyphRange(f,S,d,this.requestManager,(F,z)=>{if(z){E.ascender=z.ascender,E.descender=z.descender;for(const $ in z.glyphs)this._doesCharSupportLocalGlyph(+$)||(E.glyphs[+$]=z.glyphs[+$]);E.ranges[S]=!0}for(const $ of P)$(F,z);delete E.requests[S]})),P.push((F,z)=>{F?x(F):z&&x(null,{stack:f,id:_,glyph:z.glyphs[_]||null})})},(f,_)=>{if(f)s(f);else if(_){const x={};for(const{stack:E,id:D,glyph:S}of _)void 0===x[E]&&(x[E]={}),void 0===x[E].glyphs&&(x[E].glyphs={}),x[E].glyphs[D]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},x[E].ascender=this.entries[E].ascender,x[E].descender=this.entries[E].descender;s(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==_d.none&&(this.localGlyphMode===_d.all?!!this.localFontFamily:!!this.localFontFamily&&(It["CJK Unified Ideographs"](e)||It["Hangul Syllables"](e)||It.Hiragana(e)||It.Katakana(e)||It["CJK Symbols and Punctuation"](e)||It["CJK Unified Ideographs Extension A"](e)||It["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,s){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let d=e.tinySDF;if(!d){let $="400";/bold/i.test(n)?$="900":/medium/i.test(n)?$="500":/light/i.test(n)&&($="200"),d=e.tinySDF=new nh.TinySDF({fontFamily:c,fontWeight:$,fontSize:24*Ll,buffer:3*Ll,radius:8*Ll}),d.fontWeight=$}if(this.localGlyphs[d.fontWeight][s])return this.localGlyphs[d.fontWeight][s];const f=String.fromCodePoint(s),{data:_,width:x,height:E,glyphWidth:D,glyphHeight:S,glyphLeft:P,glyphTop:F,glyphAdvance:z}=d.draw(f);return this.localGlyphs[d.fontWeight][s]={id:s,bitmap:new Yd({width:x,height:E},_),metrics:{width:D/Ll,height:S/Ll,left:P/Ll,top:F/Ll-27,advance:z/Ll,localGlyph:!0}}}}nh.loadGlyphRange=function(t,e,n,s,c){const d=256*e,f=d+255,_=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${d}-${f}`),sc.Glyphs);jl(_,(x,E)=>{if(x)c(x);else if(E){const D={},S=new Kc(E).readFields(L1,{});for(const P of S.glyphs)D[P.id]=P;c(null,{glyphs:D,ascender:S.ascender,descender:S.descender})}})},nh.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=n;const _=this.size=t+4*e,x=this._createCanvas(_),E=this.ctx=x.getContext("2d",{willReadFrequently:!0});E.font=`${f} ${d} ${t}px ${c}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(t),f=Math.ceil(n),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),x=Math.min(this.size-this.buffer,f+Math.ceil(s)),E=_+2*this.buffer,D=x+2*this.buffer,S=Math.max(E*D,0),P=new Uint8ClampedArray(S),F={data:P,width:E,height:D,glyphWidth:_,glyphHeight:x,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(0===_||0===x)return F;const{ctx:z,buffer:$,gridInner:H,gridOuter:ee}=this;z.clearRect($,$,_,x),z.fillText(t,$,$+f);const Pe=z.getImageData($,$,_,x);ee.fill(qf,0,S),H.fill(0,0,S);for(let Oe=0;Oe<x;Oe++)for(let ke=0;ke<_;ke++){const dt=Pe.data[4*(Oe*_+ke)+3]/255;if(0===dt)continue;const st=(Oe+$)*E+ke+$;if(1===dt)ee[st]=0,H[st]=qf;else{const Dt=.5-dt;ee[st]=Dt>0?Dt*Dt:0,H[st]=Dt<0?Dt*Dt:0}}xv(ee,0,0,E,D,E,this.f,this.v,this.z),xv(H,$,$,_,x,E,this.f,this.v,this.z);for(let Oe=0;Oe<S;Oe++){const ke=Math.sqrt(ee[Oe])-Math.sqrt(H[Oe]);P[Oe]=Math.round(255-255*(ke/this.radius+this.cutoff))}return F}};const xc=yl;function bv(t,e,n,s){const c=[],d=t.imagePrimary,f=d.pixelRatio,_=d.paddedRect.w-2*xc,x=d.paddedRect.h-2*xc,E=t.right-t.left,D=t.bottom-t.top,S=d.stretchX||[[0,_]],P=d.stretchY||[[0,x]],F=(dn,Fn)=>dn+Fn[1]-Fn[0],z=S.reduce(F,0),$=P.reduce(F,0),H=_-z,ee=x-$;let Pe=0,Oe=z,ke=0,dt=$,st=0,Dt=H,kt=0,Yt=ee;if(d.content&&s){const dn=d.content;Pe=Yf(S,0,dn[0]),ke=Yf(P,0,dn[1]),Oe=Yf(S,dn[0],dn[2]),dt=Yf(P,dn[1],dn[3]),st=dn[0]-Pe,kt=dn[1]-ke,Dt=dn[2]-dn[0]-Oe,Yt=dn[3]-dn[1]-dt}const yn=(dn,Fn,Yn,Sn)=>{const Wn=Jf(dn.stretch-Pe,Oe,E,t.left),xn=Im(dn.fixed-st,Dt,dn.stretch,z),Hn=Jf(Fn.stretch-ke,dt,D,t.top),ni=Im(Fn.fixed-kt,Yt,Fn.stretch,$),Zn=Jf(Yn.stretch-Pe,Oe,E,t.left),Si=Im(Yn.fixed-st,Dt,Yn.stretch,z),Qn=Jf(Sn.stretch-ke,dt,D,t.top),ci=Im(Sn.fixed-kt,Yt,Sn.stretch,$),Qi=new Ae(Wn,Hn),$i=new Ae(Zn,Hn),ji=new Ae(Zn,Qn),ri=new Ae(Wn,Qn),tr=new Ae(xn/f,ni/f),Dr=new Ae(Si/f,ci/f),or=e*Math.PI/180;if(or){const Co=Math.sin(or),Qr=Math.cos(or),Hr=[Qr,-Co,Co,Qr];Qi._matMult(Hr),$i._matMult(Hr),ri._matMult(Hr),ji._matMult(Hr)}const Mr=dn.stretch+dn.fixed,Er=Yn.stretch+Yn.fixed,Or=Fn.stretch+Fn.fixed,ir=Sn.stretch+Sn.fixed,Mo=t.imageSecondary;return{tl:Qi,tr:$i,bl:ri,br:ji,texPrimary:{x:d.paddedRect.x+xc+Mr,y:d.paddedRect.y+xc+Or,w:Er-Mr,h:ir-Or},texSecondary:Mo?{x:Mo.paddedRect.x+xc+Mr,y:Mo.paddedRect.y+xc+Or,w:Er-Mr,h:ir-Or}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:tr,pixelOffsetBR:Dr,minFontScaleX:Dt/f/E,minFontScaleY:Yt/f/D,isSDF:n}};if(s&&(d.stretchX||d.stretchY)){const dn=n_(S,H,z),Fn=n_(P,ee,$);for(let Yn=0;Yn<dn.length-1;Yn++){const Sn=dn[Yn],Wn=dn[Yn+1];for(let xn=0;xn<Fn.length-1;xn++)c.push(yn(Sn,Fn[xn],Wn,Fn[xn+1]))}}else c.push(yn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:x+1}));return c}function Yf(t,e,n){let s=0;for(const c of t)s+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return s}function n_(t,e,n){const s=[{fixed:-xc,stretch:0}];for(const[c,d]of t){const f=s[s.length-1];s.push({fixed:c-f.stretch,stretch:f.stretch}),s.push({fixed:c-f.stretch,stretch:f.stretch+(d-c)})}return s.push({fixed:e+xc,stretch:n}),s}function Jf(t,e,n,s){return t/e*n+s}function Im(t,e,n,s){return t-e*n/s}function wv(t,e,n,s){const c=e+t.positionedLines[s].lineOffset;return 0===s?n+c/2:n+(c+(e+t.positionedLines[s-1].lineOffset))/2}function gw(t,e=1,n=!1){let s=1/0,c=1/0,d=-1/0,f=-1/0;const _=t[0];for(let F=0;F<_.length;F++){const z=_[F];(!F||z.x<s)&&(s=z.x),(!F||z.y<c)&&(c=z.y),(!F||z.x>d)&&(d=z.x),(!F||z.y>f)&&(f=z.y)}const x=Math.min(d-s,f-c);let E=x/2;const D=new xf([],_w);if(0===x)return new Ae(s,c);for(let F=s;F<d;F+=x)for(let z=c;z<f;z+=x)D.push(new Qf(F+E,z+E,E,t));let S=function(F){let z=0,$=0,H=0;const ee=F[0];for(let Pe=0,Oe=ee.length,ke=Oe-1;Pe<Oe;ke=Pe++){const dt=ee[Pe],st=ee[ke],Dt=dt.x*st.y-st.x*dt.y;$+=(dt.x+st.x)*Dt,H+=(dt.y+st.y)*Dt,z+=3*Dt}return new Qf($/z,H/z,0,F)}(t),P=D.length;for(;D.length;){const F=D.pop();(F.d>S.d||!S.d)&&(S=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,P)),F.max-S.d<=e||(E=F.h/2,D.push(new Qf(F.p.x-E,F.p.y-E,E,t)),D.push(new Qf(F.p.x+E,F.p.y-E,E,t)),D.push(new Qf(F.p.x-E,F.p.y+E,E,t)),D.push(new Qf(F.p.x+E,F.p.y+E,E,t)),P+=4)}return n&&(console.log(`num probes: ${P}`),console.log(`best distance: ${S.d}`)),S.p}function _w(t,e){return e.max-t.max}class Qf{constructor(e,n,s,c){this.p=new Ae(e,n),this.h=s,this.d=function(d,f){let _=!1,x=1/0;for(let E=0;E<f.length;E++){const D=f[E];for(let S=0,P=D.length,F=P-1;S<P;F=S++){const z=D[S],$=D[F];z.y>d.y!=$.y>d.y&&d.x<($.x-z.x)*(d.y-z.y)/($.y-z.y)+z.x&&(_=!_),x=Math.min(x,Cb(d,z,$))}}return(_?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const i_=Number.POSITIVE_INFINITY,yw=Math.sqrt(2);function j1(t,[e,n]){let s=0,c=0;if(n===i_){e<0&&(e=0);const d=e/yw;switch(t){case"top-right":case"top-left":c=d-7;break;case"bottom-right":case"bottom-left":c=7-d;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(t){case"top-right":case"bottom-right":s=-d;break;case"top-left":case"bottom-left":s=d;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":c=n-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-n}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,c]}function Ev(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function vw(t,e,n,s,c,d,f,_,x,E,D,S,P,F,z){let $=d.textMaxSize.evaluate(e,{},S);void 0===$&&($=f);const H=t.layers[0].layout,ee=H.get("icon-offset").evaluate(e,{},S),Pe=$1(n.horizontal)||n.vertical,Oe="globe"===P.name,ke=sa,dt=f/ke,st=t.tilePixelRatio*$/ke,Dt=(Wn=t.overscaling,t.zoom>18&&Wn>2&&(Wn>>=1),Math.max(hi/(512*Wn),1)*H.get("symbol-spacing")),kt=H.get("text-padding")*t.tilePixelRatio,Yt=H.get("icon-padding")*t.tilePixelRatio,yn=Zi(H.get("text-max-angle")),dn="map"===H.get("text-rotation-alignment")&&"point"!==H.get("symbol-placement"),Fn="map"===H.get("icon-rotation-alignment")&&"point"!==H.get("symbol-placement"),Yn=H.get("symbol-placement"),Sn=Dt/2;var Wn;const xn=H.get("icon-text-fit").evaluate(e,{},S),Hn=H.get("icon-text-fit-padding").evaluate(e,{},S),ni="none"!==xn;let Zn;!1===t.hasAnyIconTextFit&&ni&&(t.hasAnyIconTextFit=!0),s&&ni&&(t.allowVerticalPlacement&&n.vertical&&(Zn=gv(s,n.vertical,xn,Hn,ee,dt)),Pe&&(s=gv(s,Pe,xn,Hn,ee,dt)));const Si=(Qn,ci,Qi)=>{if(ci.x<0||ci.x>=hi||ci.y<0||ci.y>=hi)return;let $i=null;if(Oe){const{x:ji,y:ri,z:tr}=P.projectTilePoint(ci.x,ci.y,Qi);$i={anchor:new qc(ji,ri,tr,0,void 0),up:P.upVector(Qi,ci.x,ci.y)}}!function(ji,ri,tr,Dr,or,Mr,Er,Or,ir,Mo,Co,Qr,Hr,so,$o,Bo,ms,us,Va,Es,os,Ts,Js,da,Uo,vl,hh){const eu=ji.addToLineVertexArray(ri,Dr);let Pu,df,hf,xp,Ax,ff,bp,Px=0,lE=0,r0=0,Rx=0,Ox=-1,o0=-1;const Ru={};let Lx=ul("");const Ou=tr?tr.anchor:ri,A_="none"!==ir.layout.get("icon-text-fit").evaluate(os,{},Uo);let s0=0,P_=0;if(void 0===ir._unevaluatedLayout.getValue("text-radial-offset")?[s0,P_]=ir.layout.get("text-offset").evaluate(os,{},Uo).map(kl=>kl*sa):(s0=ir.layout.get("text-radial-offset").evaluate(os,{},Uo)*sa,P_=i_),ji.allowVerticalPlacement&&or.vertical){const kl=or.vertical;if($o)ff=Cv(kl),Or&&(bp=Cv(Or));else{const xl=ir.layout.get("text-rotate").evaluate(os,{},Uo)+90;hf=Ua(Mo,Ou,ri,Co,Qr,Hr,kl,so,xl,Bo),Or&&(xp=Ua(Mo,Ou,ri,Co,Qr,Hr,Or,us,xl))}}if(Mr){const kl=ir.layout.get("icon-rotate").evaluate(os,{},Uo),xl=bv(Mr,kl,Js,A_),fh=Or?bv(Or,kl,Js,A_):void 0;df=Ua(Mo,Ou,ri,Co,Qr,Hr,Mr,us,kl),Px=4*xl.length;const kx=ji.iconSizeData;let mf=null;"source"===kx.kind?(mf=[Zc*ir.layout.get("icon-size").evaluate(os,{},Uo)],mf[0]>yd&&Do(`${ji.layerIds[0]}: Value for "icon-size" is >= ${ep}. Reduce your "icon-size".`)):"composite"===kx.kind&&(mf=[Zc*Ts.compositeIconSizes[0].evaluate(os,{},Uo),Zc*Ts.compositeIconSizes[1].evaluate(os,{},Uo)],(mf[0]>yd||mf[1]>yd)&&Do(`${ji.layerIds[0]}: Value for "icon-size" is >= ${ep}. Reduce your "icon-size".`)),ji.addSymbols(ji.icon,xl,mf,Es,Va,os,!1,tr,ri,eu.lineStartIndex,eu.lineLength,-1,da,Uo,vl,hh),Ox=ji.icon.placedSymbolArray.length-1,fh&&(lE=4*fh.length,ji.addSymbols(ji.icon,fh,mf,Es,Va,os,tc.vertical,tr,ri,eu.lineStartIndex,eu.lineLength,-1,da,Uo,vl,hh),o0=ji.icon.placedSymbolArray.length-1)}for(const kl in or.horizontal){const xl=or.horizontal[kl];Pu||(Lx=ul(xl.text),$o?Ax=Cv(xl):Pu=Ua(Mo,Ou,ri,Co,Qr,Hr,xl,so,ir.layout.get("text-rotate").evaluate(os,{},Uo),Bo));const fh=1===xl.positionedLines.length;if(r0+=V1(ji,tr,ri,xl,Er,ir,$o,os,Bo,eu,or.vertical?tc.horizontal:tc.horizontalOnly,fh?Object.keys(or.horizontal):[kl],Ru,Ox,Ts,da,Uo,vl),fh)break}or.vertical&&(Rx+=V1(ji,tr,ri,or.vertical,Er,ir,$o,os,Bo,eu,tc.vertical,["vertical"],Ru,o0,Ts,da,Uo,vl));let pf=-1;const R_=(kl,xl)=>kl?Math.max(kl,xl):xl;pf=R_(Ax,pf),pf=R_(ff,pf),pf=R_(bp,pf);const gT=pf>-1?1:0;ji.glyphOffsetArray.length>=65535&&Do("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==os.sortKey&&ji.addToSortKeyRanges(ji.symbolInstances.length,os.sortKey),ji.symbolInstances.emplaceBack(ri.x,ri.y,Ou.x,Ou.y,Ou.z,Ru.right>=0?Ru.right:-1,Ru.center>=0?Ru.center:-1,Ru.left>=0?Ru.left:-1,Ru.vertical>=0?Ru.vertical:-1,Ox,o0,Lx,void 0!==Pu?Pu:ji.collisionBoxArray.length,void 0!==Pu?Pu+1:ji.collisionBoxArray.length,void 0!==hf?hf:ji.collisionBoxArray.length,void 0!==hf?hf+1:ji.collisionBoxArray.length,void 0!==df?df:ji.collisionBoxArray.length,void 0!==df?df+1:ji.collisionBoxArray.length,xp||ji.collisionBoxArray.length,xp?xp+1:ji.collisionBoxArray.length,Co,r0,Rx,Px,lE,gT,0,s0,P_,pf,0,1,1,A_?1:0)}(t,ci,$i,Qn,n,s,c,Zn,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,kt,dn,x,0,Yt,Fn,ee,e,d,E,D,S,F,z)};if("line"===Yn)for(const Qn of vv(e.geometry,0,0,hi,hi)){const ci=mw(Qn,Dt,yn,n.vertical||Pe,s,ke,st,t.overscaling,hi);for(const Qi of ci)Pe&&xw(t,Pe.text,Sn,Qi)||Si(Qn,Qi,S)}else if("line-center"===Yn){for(const Qn of e.geometry)if(Qn.length>1){const ci=pw(Qn,yn,n.vertical||Pe,s,ke,st);ci&&Si(Qn,ci,S)}}else if("Polygon"===e.type)for(const Qn of kg(e.geometry,0)){const ci=gw(Qn,16);Si(Qn[0],new qc(ci.x,ci.y,0,0,void 0),S)}else if("LineString"===e.type)for(const Qn of e.geometry)Si(Qn,new qc(Qn[0].x,Qn[0].y,0,0,void 0),S);else if("Point"===e.type)for(const Qn of e.geometry)for(const ci of Qn)Si([ci],new qc(ci.x,ci.y,0,0,void 0),S)}const ep=255,yd=ep*Zc;function V1(t,e,n,s,c,d,f,_,x,E,D,S,P,F,z,$,H,ee){const Pe=function(dt,st,Dt,kt,Yt,yn,dn,Fn){const Yn=[];if(0===st.positionedLines.length)return Yn;const Sn=kt.layout.get("text-rotate").evaluate(yn,{})*Math.PI/180,Wn=function(Si){const Qn=Si[0],ci=Si[1],Qi=Qn*ci;return Qi>0?[Qn,-ci]:Qi<0?[-Qn,ci]:0===Qn?[ci,Qn]:[ci,-Qn]}(Dt);let xn=Math.abs(st.top-st.bottom);for(const Si of st.positionedLines)xn-=Si.lineOffset;const Hn=st.positionedLines.length,ni=xn/Hn;let Zn=st.top-Dt[1];for(let Si=0;Si<Hn;++Si){const Qn=st.positionedLines[Si];Zn=wv(st,ni,Zn,Si);for(const ci of Qn.positionedGlyphs){if(!ci.rect)continue;const Qi=ci.rect||{};let $i=fv+1,ji=!0,ri=1,tr=0;if(ci.imageName){const Es=dn[ci.imageName];if(!Es)continue;if(Es.sdf){Do("SDF images are not supported in formatted text and will be ignored.");continue}ji=!1,ri=Es.pixelRatio,$i=yl/ri}const Dr=(Yt||Fn)&&ci.vertical,or=ci.metrics.advance*ci.scale/2,Mr=ci.metrics,Er=ci.rect;if(null===Er)continue;Fn&&st.verticalizable&&(tr=ci.imageName?or-ci.metrics.width*ci.scale/2:0);const Or=Yt?[ci.x+or,ci.y]:[0,0];let ir=[0,0],Mo=[0,0],Co=!1;Yt||(Dr?(Mo=[ci.x+or+Wn[0],ci.y+Wn[1]-tr],Co=!0):ir=[ci.x+or+Dt[0],ci.y+Dt[1]-tr]);const Qr=Er.w*ci.scale/(ri*(ci.localGlyph?Ll:1)),Hr=Er.h*ci.scale/(ri*(ci.localGlyph?Ll:1));let so,$o,Bo,ms;if(Dr){const Es=ci.y-Zn,os=new Ae(-or,or-Es),Ts=-Math.PI/2,Js=new Ae(...Mo);so=new Ae(-or+ir[0],ir[1]),so._rotateAround(Ts,os)._add(Js),so.x+=-Es+or,so.y-=(Mr.left-$i)*ci.scale;const da=ci.imageName?Mr.advance*ci.scale:sa*ci.scale,Uo=String.fromCodePoint(ci.glyph);hw(Uo)?so.x+=(1-$i)*ci.scale:fw(Uo)?so.x+=da-Mr.height*ci.scale+(-$i-1)*ci.scale:so.x+=ci.imageName||Mr.width+2*$i===Er.w&&Mr.height+2*$i===Er.h?(da-Hr)/2:(da-(Mr.height+2*$i)*ci.scale)/2,$o=new Ae(so.x,so.y-Qr),Bo=new Ae(so.x+Hr,so.y),ms=new Ae(so.x+Hr,so.y-Qr)}else{const Es=(Mr.left-$i)*ci.scale-or+ir[0],os=(-Mr.top-$i)*ci.scale+ir[1],Ts=Es+Qr,Js=os+Hr;so=new Ae(Es,os),$o=new Ae(Ts,os),Bo=new Ae(Es,Js),ms=new Ae(Ts,Js)}if(Sn){let Es;Es=Yt?new Ae(0,0):Co?new Ae(Wn[0],Wn[1]):new Ae(Dt[0],Dt[1]),so._rotateAround(Sn,Es),$o._rotateAround(Sn,Es),Bo._rotateAround(Sn,Es),ms._rotateAround(Sn,Es)}const us=new Ae(0,0),Va=new Ae(0,0);Yn.push({tl:so,tr:$o,bl:Bo,br:ms,texPrimary:Qi,texSecondary:void 0,writingMode:st.writingMode,glyphOffset:Or,sectionIndex:ci.sectionIndex,isSDF:ji,pixelOffsetTL:us,pixelOffsetBR:Va,minFontScaleX:0,minFontScaleY:0})}}return Yn}(0,s,x,d,f,_,c,t.allowVerticalPlacement),Oe=t.textSizeData;let ke=null;"source"===Oe.kind?(ke=[Zc*d.layout.get("text-size").evaluate(_,{},H)],ke[0]>yd&&Do(`${t.layerIds[0]}: Value for "text-size" is >= ${ep}. Reduce your "text-size".`)):"composite"===Oe.kind&&(ke=[Zc*z.compositeTextSizes[0].evaluate(_,{},H),Zc*z.compositeTextSizes[1].evaluate(_,{},H)],(ke[0]>yd||ke[1]>yd)&&Do(`${t.layerIds[0]}: Value for "text-size" is >= ${ep}. Reduce your "text-size".`)),t.addSymbols(t.text,Pe,ke,x,f,_,D,e,n,E.lineStartIndex,E.lineLength,F,$,H,ee,!1);for(const dt of S)P[dt]=t.text.placedSymbolArray.length-1;return 4*Pe.length}function $1(t){for(const e in t)return t[e];return null}function Ua(t,e,n,s,c,d,f,_,x,E){let D=f.top,S=f.bottom,P=f.left,F=f.right;const z=f.collisionPadding;if(z&&(P-=z[0],D-=z[1],F+=z[2],S+=z[3]),x){const $=new Ae(P,D),H=new Ae(F,D),ee=new Ae(P,S),Pe=new Ae(F,S),Oe=Zi(x);let ke=new Ae(0,0);E&&(ke=new Ae(E[0],E[1])),$._rotateAround(Oe,ke),H._rotateAround(Oe,ke),ee._rotateAround(Oe,ke),Pe._rotateAround(Oe,ke),P=Math.min($.x,H.x,ee.x,Pe.x),F=Math.max($.x,H.x,ee.x,Pe.x),D=Math.min($.y,H.y,ee.y,Pe.y),S=Math.max($.y,H.y,ee.y,Pe.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,P,D,F,S,_,s,c,d),t.length-1}function Cv(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function xw(t,e,n,s){const c=t.compareText;if(e in c){const d=c[e];for(let f=d.length-1;f>=0;f--)if(s.dist(d[f])<n)return!0}else c[e]=[];return c[e].push(s),!1}function bw(t,e){const n=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),d=Math.sin(n)*c/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),f=Math.sin(t._pitch)*d+c;return Math.min(1.01*f,c*(1/t._horizonShift))}function vd(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),s=t.x*n,c=(t.x+1)*n,d=t.y*n,f=(t.y+1)*n,_=Ta(s),x=Ta(c),E=qs(d),D=qs(f),S=e.project(_,E),P=e.project(x,E),F=e.project(x,D),z=e.project(_,D);let $=Math.min(S.x,P.x,F.x,z.x),H=Math.min(S.y,P.y,F.y,z.y),ee=Math.max(S.x,P.x,F.x,z.x),Pe=Math.max(S.y,P.y,F.y,z.y);const Oe=n/16;function ke(st,Dt,kt,Yt,yn,dn){const Fn=(kt+yn)/2,Yn=(Yt+dn)/2,Sn=e.project(Ta(Fn),qs(Yn)),Wn=Math.max(0,$-Sn.x,H-Sn.y,Sn.x-ee,Sn.y-Pe);$=Math.min($,Sn.x),ee=Math.max(ee,Sn.x),H=Math.min(H,Sn.y),Pe=Math.max(Pe,Sn.y),Wn>Oe&&(ke(st,Sn,kt,Yt,Fn,Yn),ke(Sn,Dt,Fn,Yn,yn,dn))}ke(S,P,s,d,c,d),ke(P,F,c,d,c,f),ke(F,z,c,f,s,f),ke(z,S,s,f,s,d),$-=Oe,H-=Oe,ee+=Oe,Pe+=Oe;const dt=1/Math.max(ee-$,Pe-H);return{scale:dt,x:$*dt,y:H*dt,x2:ee*dt,y2:Pe*dt,projection:e}}function Iv(t,{x:e,y:n},s=0){return new Ae(((e-s)*t.scale-t.x)*hi,(n*t.scale-t.y)*hi)}const ww=a.ad.identity(new Float32Array(16));class ih{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Yr(0,0)}projectTilePoint(e,n,s){return{x:e,y:n,z:0}}locationPoint(e,n,s=!0){return e._coordinatePoint(e.locationCoordinate(n),s)}pixelsPerMeter(e,n){return Ia(1,e)*n}pixelSpaceConversion(e,n,s){return 1}farthestPixelDistance(e){return bw(e,e.pixelsPerMeter)}pointCoordinate(e,n,s,c){const d=e.horizonLineFromTop(!1),f=new Ae(n,Math.max(d,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,c))}pointCoordinate3D(e,n,s){const c=new Ae(n,s);if(e.elevation)return e.elevation.pointCoordinate(c);{const d=this.pointCoordinate(e,c.x,c.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);const s=e.horizonLineFromTop();return n.y<s}createInversionMatrix(e,n){return ww}createTileMatrix(e,n,s){let c,d,f;const _=s.canonical,x=a.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=vd(_,this);c=1,d=E.x+s.wrap*E.scale,f=E.y,a.ad.scale(x,x,[c/E.scale,c/E.scale,e.pixelsPerMeter/n])}else c=n/e.zoomScale(_.z),d=(_.x+Math.pow(2,_.z)*s.wrap)*c,f=_.y*c;return a.ad.translate(x,x,[d,f,0]),a.ad.scale(x,x,[c/hi,c/hi,1]),x}upVector(e,n,s){return[0,0,1]}upVectorScale(e,n,s){return{metersToTile:1}}}class Ew extends ih{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,s]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(Zi(n));this.n=(c+Math.sin(Zi(s)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:s,c,r0:d}=this,f=Zi(e-this.center[0]),_=Zi(n),x=Math.sqrt(c-2*s*Math.sin(_))/s;return{x:x*Math.sin(f*s),y:x*Math.cos(f*s)-d,z:0}}unproject(e,n){const{n:s,c,r0:d}=this,f=d+n;let _=Math.atan2(e,Math.abs(f))*Math.sign(f);f*s<0&&(_-=Math.PI*Math.sign(e)*Math.sign(f));const x=Zi(this.center[0])*s;_=qn(_,-Math.PI-x,Math.PI-x);const E=Ut(Ro(_/s)+this.center[0],-180,180),D=Math.asin(Ut((c-(e*e+f*f)*s*s)/(2*s),-1,1)),S=Ut(Ro(D),-bs,bs);return new Yr(E,S)}}const tp=1.340264,Tm=-.081106,Dm=893e-6,ef=.003796,r_=Math.sqrt(3)/2;class Cw extends ih{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(r_*Math.sin(n)),c=s*s,d=c*c*c;return{x:.5*(e*Math.cos(s)/(r_*(tp+3*Tm*c+d*(7*Dm+9*ef*c)))/Math.PI+.5),y:1-.5*(s*(tp+Tm*c+d*(Dm+ef*c))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,c=s*s,d=c*c*c;for(let D,S,P,F=0;F<12&&(S=s*(tp+Tm*c+d*(Dm+ef*c))-n,P=tp+3*Tm*c+d*(7*Dm+9*ef*c),D=S/P,s=Ut(s-D,-Math.PI/3,Math.PI/3),c=s*s,d=c*c*c,!(Math.abs(D)<1e-12));++F);const f=r_*e*(tp+3*Tm*c+d*(7*Dm+9*ef*c))/Math.cos(s),_=Math.asin(Math.sin(s)/r_),x=Ut(180*f/Math.PI,-180,180),E=Ut(180*_/Math.PI,-bs,bs);return new Yr(x,E)}}class Iw extends ih{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const s=360*(e-.5),c=Ut(360*(.5-n),-bs,bs);return new Yr(s,c)}}const np=Math.PI/2;function o_(t){return Math.tan((np+t)/2)}class Tu extends ih{constructor(e){super(e),this.center=e.center||[0,30];const[n,s]=this.parallels=e.parallels||[30,30];let c=Zi(n),d=Zi(s);this.southernCenter=c+d<0,this.southernCenter&&(c=-c,d=-d);const f=Math.cos(c),_=o_(c);this.n=c===d?Math.sin(c):Math.log(f/Math.cos(d))/Math.log(o_(d)/_),this.f=f*Math.pow(o_(c),this.n)/this.n}project(e,n){n=Zi(n),this.southernCenter&&(n=-n),e=Zi(e-this.center[0]);const s=1e-6,{n:c,f:d}=this;d>0?n<-np+s&&(n=-np+s):n>np-s&&(n=np-s);const f=d/Math.pow(o_(n),c);let _=f*Math.sin(c*e),x=d-f*Math.cos(c*e);return _=.5*(_/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:_,y:this.southernCenter?x:1-x,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:s,f:c}=this,d=c-n,f=Math.sign(d),_=Math.sign(s)*Math.sqrt(e*e+d*d);let x=Math.atan2(e,Math.abs(d))*f;d*s<0&&(x-=Math.PI*Math.sign(e)*f);const E=Ut(Ro(x/s)+this.center[0],-180,180),D=Ut(Ro(2*Math.atan(Math.pow(c/_,1/s))-np),-bs,bs);return new Yr(E,this.southernCenter?-D:D)}}class s_ extends ih{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:bu(e),y:Wc(n),z:0}}unproject(e,n){const s=Ta(e),c=qs(n);return new Yr(s,c)}}const G1=Zi(bs);class Tw extends ih{project(e,n){const s=(n=Zi(n))*n,c=s*s;return{x:.5*((e=Zi(e))*(.8707-.131979*s+c*(c*(.003971*s-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+c*(.028874*s-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,c=25,d=0,f=s*s;do{f=s*s;const E=f*f;d=(s*(1.007226+f*(.015085+E*(.028874*f-.044475-.005916*E)))-n)/(1.007226+f*(.045255+E*(.259866*f-.311325-.005916*11*E))),s=Ut(s-d,-G1,G1)}while(Math.abs(d)>1e-6&&--c>0);f=s*s;const _=Ut(Ro(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=Ro(s);return new Yr(_,x)}}const Tv=Zi(bs);class H1 extends ih{project(e,n){n=Zi(n),e=Zi(e);const s=Math.cos(n),c=2/Math.PI,d=Math.acos(s*Math.cos(e/2)),f=Math.sin(d)/d,_=.5*(e*c+2*s*Math.sin(e/2)/f)||0,x=.5*(n+Math.sin(n)/f)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,n){let s=e=(2*e-.5)*Math.PI,c=n=(2*(1-n)-1)*Math.PI,d=25;const f=1e-6;let _=0,x=0;do{const E=Math.cos(c),D=Math.sin(c),S=2*D*E,P=D*D,F=E*E,z=Math.cos(s/2),$=Math.sin(s/2),H=2*z*$,ee=$*$,Pe=1-F*z*z,Oe=Pe?1/Pe:0,ke=Pe?Math.acos(E*z)*Math.sqrt(1/Pe):0,dt=.5*(2*ke*E*$+2*s/Math.PI)-e,st=.5*(ke*D+c)-n,Dt=.5*Oe*(F*ee+ke*E*z*P)+1/Math.PI,kt=Oe*(H*S/4-ke*D*$),Yt=.125*Oe*(S*$-ke*D*F*H),yn=.5*Oe*(P*z+ke*ee*E)+.5,dn=kt*Yt-yn*Dt;_=(st*kt-dt*yn)/dn,x=(dt*Yt-st*Dt)/dn,s=Ut(s-_,-Math.PI,Math.PI),c=Ut(c-x,-Tv,Tv)}while((Math.abs(_)>f||Math.abs(x)>f)&&--d>0);return new Yr(Ro(s),Ro(c))}}class Mm extends ih{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Zi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:s,cosPhi:c}=this;return{x:Zi(e)*c*s+.5,y:-Math.sin(Zi(n))/c*s+.5,z:0}}unproject(e,n){const{scale:s,cosPhi:c}=this,d=-(n-.5)/s,f=Ut(Ro((e-.5)/s)/c,-180,180),_=Math.asin(Ut(d*c,-1,1)),x=Ut(Ro(_),-bs,bs);return new Yr(f,x)}}class Dv extends s_{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,s){const c=jf(e,n,s),d=Qp(ld(s));return a._.transformMat4(c,c,d),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,n){const s=zh(n.lat,n.lng),c=a._.normalize([],s),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,f=Ia(1,0)*hi*d;a._.scaleAndAdd(s,s,c,f);const _=a.ad.identity(new Float64Array(16));return a.ad.multiply(_,e.pixelMatrix,e.globeMatrix),a._.transformMat4(s,s,_),new Ae(s[0],s[1])}pixelsPerMeter(e,n){return Ia(1,0)*n}pixelSpaceConversion(e,n,s){const c=Ia(1,e)*n,d=zi(Ia(1,45)*n,c,s);return this.pixelsPerMeter(e,n)/d}createTileMatrix(e,n,s){const c=Sg(ld(s.canonical));return a.ad.multiply(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,n){const{center:s}=e,c=Qp(ld(n));return a.ad.rotateY(c,c,Zi(s.lng)),a.ad.rotateX(c,c,Zi(s.lat)),a.ad.scale(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,n,s,c){return Dg(e,n,s,!0)||new Da(0,0)}pointCoordinate3D(e,n,s){const c=this.pointCoordinate(e,n,s,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,n){return!Dg(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(c,d){const f=c.cameraToCenterDistance,_=c._centerAltitude*d,x=c._camera,E=c._camera.forward(),D=a._.add([],a._.scale([],E,-f),[0,0,_]),S=c.worldSize/(2*Math.PI),P=[0,0,-S],F=c.width/c.height,z=Math.tan(c.fovAboveCenter),$=a._.scale([],x.up(),z),H=a._.scale([],x.right(),z*F),ee=a._.normalize([],a._.add([],a._.add([],E,$),H)),Pe=[];let Oe;if(new jh(D,ee).closestPointOnSphere(P,S,Pe)){const ke=a._.add([],Pe,P),dt=a._.sub([],ke,D);Oe=Math.cos(c.fovAboveCenter)*a._.length(dt)}else{const ke=a._.sub([],D,P),dt=a._.sub([],P,D);a._.normalize(dt,dt);const st=a._.length(ke)-S;Oe=Math.sqrt(st*(st+2*S));const Dt=Math.acos(Oe/(S+st))-Math.acos(a._.dot(E,dt));Oe*=Math.cos(Dt)}return 1.01*Oe}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=cd(e.zoom);if(s>0){const c=bw(e,Ia(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return zi(n,c+d*(1-Math.cos(f)),Math.pow(s,10))}return n}upVector(e,n,s){return jf(n,s,e,1)}upVectorScale(e){return{metersToTile:Tg(Mg(ld(e)))}}}function Dw(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new s_(t);case"equirectangular":return new Iw(t);case"naturalEarth":return new Tw(t);case"equalEarth":return new Cw(t);case"winkelTripel":return new H1(t);case"albers":return n?new Mm(t):new Ew(t);case"lambertConformalConic":return n?new Mm(t):new Tu(t);case"globe":return new Dv(t)}throw new Error(`Invalid projection name: ${t.name}`)}let W1=(()=>{class t{constructor(n,s,c,d){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;const f=n.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||d||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();class tf{constructor(e,n,s){this.func=e,this.mask=n,this.range=s}}tf.ReadOnly=!1,tf.ReadWrite=!0,tf.disabled=new tf(519,tf.ReadOnly,[0,1]);class ip{constructor(e,n,s,c,d,f){this.test=e,this.ref=n,this.mask=s,this.fail=c,this.depthFail=d,this.pass=f}}ip.disabled=new ip({func:519,mask:0},0,0,7680,7680,7680);class js{constructor(e,n,s,c){this.blendFunction=e,this.blendColor=n,this.mask=s,this.blendEquation=c}}js.Replace=[1,0,1,0],js.disabled=new js(js.Replace,Br.transparent,[!1,!1,!1,!1]),js.unblended=new js(js.Replace,Br.transparent,[!0,!0,!0,!0]),js.alphaBlended=new js([1,771,1,771],Br.transparent,[!0,!0,!0,!0]),js.alphaBlendedNonPremultiplied=new js([770,771,770,771],Br.transparent,[!0,!0,!0,!0]),js.multiply=new js([774,0,774,0],Br.transparent,[!0,!0,!0,!0]);class nc{constructor(e,n,s){this.enable=e,this.mode=n,this.frontFace=s}}nc.disabled=new nc(!1,1029,2305),nc.backCCW=new nc(!0,1029,2305),nc.backCW=new nc(!0,1029,2304),nc.frontCW=new nc(!0,1028,2304),nc.frontCCW=new nc(!0,1028,2305);const Mw=lm.types,rp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sm(t,e,n,s,c,d,f,_,x,E,D,S,P){const F=_?Math.min(yd,Math.round(_[0])):0,z=_?Math.min(yd,Math.round(_[1])):0;t.emplaceBack(e,n,Math.round(32*s),Math.round(32*c),d,f,(F<<1)+(x?1:0),z,16*E,16*D,256*S,256*P)}function Du(t,e,n){t.emplaceBack(e,n)}function xd(t,e,n,s,c,d,f){t.emplaceBack(e,n,s,c,d,f)}function op(t,e,n,s,c){t.emplaceBack(e,n,s,c),t.emplaceBack(e,n,s,c),t.emplaceBack(e,n,s,c),t.emplaceBack(e,n,s,c)}function Am(t){for(const e of t.sections)if(yi(e.text))return!0;return!1}class l_{constructor(e){this.layoutVertexArray=new og,this.indexArray=new Zs,this.programConfigurations=e,this.segments=new rs,this.dynamicLayoutVertexArray=new td,this.opacityVertexArray=new Vc,this.occlusionQueryOpacityVertexArray=new Wd,this.placedSymbolArray=new Xd,this.iconTransitioningVertexArray=new wa,this.globeExtVertexArray=new Ba,this.zOffsetVertexArray=new Wd}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,n,s,c,d){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,pm.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,rp,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,tv.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,ew.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,uT.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,E1.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ee(l_,"SymbolBuffers");class c_{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new rs,this.collisionVertexArray=new ay,this.collisionVertexArrayExt=new td}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,C1.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,tw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ee(c_,"CollisionBuffers");class sp{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=a.ad.identity([]),this.placementViewportMatrix=a.ad.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hv(this.zoom,n["text-size"]),this.iconSizeData=hv(this.zoom,n["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==d&&void 0!==c.constantOr(1),this.sortFeaturesByY=("viewport-y"===d||"auto"===d&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(f=>tc[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=s.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new l_(new rd(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new l_(new rd(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new D0,this.lineVertexArray=new M0,this.symbolInstances=new T0}calculateGlyphDependencies(e,n,s,c,d){for(let f=0;f<e.length;f++){const _=e.codePointAt(f);if(void 0===_)break;if(n[_]=!0,c&&d&&_<=65535){const x=qh[e.charAt(f)];x&&(n[x.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const s=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!zg(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}populate(e,n,s,c){const d=this.layers[0],f=d.layout,_="globe"===this.projection.name,x=f.get("text-font"),E=f.get("text-field"),D=f.get("icon-image"),S=("constant"!==E.value.kind||E.value.value instanceof Yo&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),P="constant"!==D.value.kind||!!D.value.value||Object.keys(D.parameters).length>0,F=f.get("symbol-sort-key");if(this.features=[],!S&&!P)return;const z=n.iconDependencies,$=n.glyphDependencies,H=n.availableImages,ee=new rr(this.zoom);for(const{feature:Pe,id:Oe,index:ke,sourceLayerIndex:dt}of e){const st=d._featureFilter.needGeometry,Dt=Eu(Pe,st);if(!d._featureFilter.filter(ee,Dt,s))continue;if(st||(Dt.geometry=wu(Pe,s,c)),_&&1!==Pe.type&&s.z<=5){const dn=Dt.geometry,Fn=.98078528056,Yn=(Sn,Wn)=>{const xn=jf(Sn.x,Sn.y,s,1),Hn=jf(Wn.x,Wn.y,s,1);return a._.dot(xn,Hn)<Fn};for(let Sn=0;Sn<dn.length;Sn++)dn[Sn]=F0(dn[Sn],Yn)}let kt,Yt;if(S){const dn=d.getValueAndResolveTokens("text-field",Dt,s,H),Fn=Yo.factory(dn);Am(Fn)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Fr()||this.hasRTLText&&Rr.isParsed())&&(kt=qg(Fn,d,Dt))}if(P){const dn=d.getValueAndResolveTokens("icon-image",Dt,s,H);Yt=dn instanceof ds?dn:ds.fromString(dn)}if(!kt&&!Yt)continue;const yn=this.sortFeaturesByKey?F.evaluate(Dt,{},s):void 0;if(this.features.push({id:Oe,text:kt,icon:Yt,index:ke,sourceLayerIndex:dt,geometry:Dt.geometry,properties:Pe.properties,type:Mw[Pe.type],sortKey:yn}),Yt&&(z[Yt.namePrimary]=!0,Yt.nameSecondary&&(z[Yt.nameSecondary]=!0)),kt){const dn=x.evaluate(Dt,{},s).join(","),Fn="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(tc.vertical)>=0;for(const Yn of kt.sections)if(Yn.image)z[Yn.image.namePrimary]=!0;else{const Sn=hn(kt.toString()),Wn=Yn.fontStack||dn,xn=$[Wn]=$[Wn]||{};this.calculateGlyphDependencies(Yn.text,xn,Fn,this.allowVerticalPlacement,Sn)}}}"line"===f.get("symbol-placement")&&(this.features=function(Pe){const Oe={},ke={},dt=[];let st=0;function Dt(dn){dt.push(Pe[dn]),st++}function kt(dn,Fn,Yn){const Sn=ke[dn];return delete ke[dn],ke[Fn]=Sn,dt[Sn].geometry[0].pop(),dt[Sn].geometry[0]=dt[Sn].geometry[0].concat(Yn[0]),Sn}function Yt(dn,Fn,Yn){const Sn=Oe[Fn];return delete Oe[Fn],Oe[dn]=Sn,dt[Sn].geometry[0].shift(),dt[Sn].geometry[0]=Yn[0].concat(dt[Sn].geometry[0]),Sn}function yn(dn,Fn,Yn){const Sn=Yn?Fn[0][Fn[0].length-1]:Fn[0][0];return`${dn}:${Sn.x}:${Sn.y}`}for(let dn=0;dn<Pe.length;dn++){const Fn=Pe[dn],Yn=Fn.geometry,Sn=Fn.text?Fn.text.toString():null;if(!Sn){Dt(dn);continue}const Wn=yn(Sn,Yn),xn=yn(Sn,Yn,!0);if(Wn in ke&&xn in Oe&&ke[Wn]!==Oe[xn]){const Hn=Yt(Wn,xn,Yn),ni=kt(Wn,xn,dt[Hn].geometry);delete Oe[Wn],delete ke[xn],ke[yn(Sn,dt[ni].geometry,!0)]=ni,dt[Hn].geometry=null}else Wn in ke?kt(Wn,xn,Yn):xn in Oe?Yt(Wn,xn,Yn):(Dt(dn),Oe[Wn]=st-1,ke[xn]=st-1)}return dt.filter(dn=>dn.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Pe,Oe)=>Pe.sortKey-Oe.sortKey)}update(e,n,s,c,d){const f=0!==Object.keys(e).length;if(f&&!this.stateDependentLayers.length)return;const _=f?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,_,s,c,d),this.icon.programConfigurations.updatePaintArrays(e,n,_,s,c,d)}updateOcclusionOpacities(e,n,s){if(!n.useOcclusionQueries)return!1;const c=this;if("globe"===c.projection.name)return!1;let d=!1;c.hasTextData()&&(d=d||0!==c.text.occlusionQueryOpacityVertexArray.length),c.hasIconData()&&(d=d||0!==c.icon.occlusionQueryOpacityVertexArray.length);const f=c.layers[0].paint,_=f.get("icon-occlusion-opacity").constantOr(0),x=f.get("text-occlusion-opacity").constantOr(0);if(!c.layers[0].hasInitialOcclusionOpacityProperties||1===_&&1===x)return!1;let E=!d;for(let F=0;F<c.symbolInstances.length;F++){const z=c.symbolInstances.get(F),$=z.occlusionOpacity;z.occlusionOpacity+=(z.occlusionState>.5?1:-1)*n.fadeSpeed*s*.001,z.occlusionOpacity=Ut(z.occlusionOpacity,0,1),E=E||z.occlusionOpacity!==$}if(!E)return!1;let D=0,S=0;const P=(F,z,$,H)=>{let ee=0,Pe=0;$?(ee=S,S+=H,Pe=S):(ee=D,D+=H,Pe=D),Pe>z.occlusionQueryOpacityVertexArray.length&&z.occlusionQueryOpacityVertexArray.resize(Pe);const Oe=F.occlusionOpacity;for(let ke=0;ke<H;ke++)z.occlusionQueryOpacityVertexArray.emplace(ke+ee,Oe)};for(let F=0;F<c.symbolInstances.length;F++){const z=c.symbolInstances.get(F),{numHorizontalGlyphVertices:$,numVerticalGlyphVertices:H,numIconVertices:ee}=z,Pe=ee>0;if(($>0||H>0)&&(P(z,c.text,!1,$),P(z,c.text,!1,H)),Pe){const{placedIconSymbolIndex:Oe,verticalPlacedIconSymbolIndex:ke}=z;Oe>=0&&P(z,c.icon,!0,ee),ke>=0&&P(z,c.icon,!0,z.numVerticalIconVertices)}}return c.hasTextData()&&c.text.occlusionQueryOpacityVertexBuffer&&(c.text.occlusionQueryOpacityVertexBuffer.length<c.text.occlusionQueryOpacityVertexArray.length?c.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(c.text.occlusionQueryOpacityVertexArray,tv.members,!0):c.text.occlusionQueryOpacityVertexBuffer.updateData(c.text.occlusionQueryOpacityVertexArray)),c.hasIconData()&&c.icon.occlusionQueryOpacityVertexBuffer&&(c.icon.occlusionQueryOpacityVertexBuffer.length<c.icon.occlusionQueryOpacityVertexArray.length?c.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(c.icon.occlusionQueryOpacityVertexArray,tv.members,!0):c.icon.occlusionQueryOpacityVertexBuffer.updateData(c.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){const e=(d,f,_)=>{s+=f,s>d.length&&d.resize(s);for(let x=-f;x<0;x++)d.emplace(x+s,_)},n=(d,f,_)=>{c+=f,c>d.length&&d.resize(c);for(let x=-f;x<0;x++)d.emplace(x+c,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,c=0;for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:x,numIconVertices:E}=f,D=f.zOffset,S=E>0;if((_>0||x>0)&&(e(this.text.zOffsetVertexArray,_,D),e(this.text.zOffsetVertexArray,x,D)),S){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:F}=f;P>=0&&n(this.icon.zOffsetVertexArray,E,D),F>=0&&n(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,D)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Dw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(const e of this.queries.values())e.destroy()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:c,y:d}of n)this.lineVertexArray.emplaceBack(c,d);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,c,d,f,_,x,E,D,S,P,F,z,$,H){const ee=e.indexArray,Pe=e.layoutVertexArray,Oe=e.globeExtVertexArray,ke=e.segments.prepareSegment(4*n.length,Pe,ee,this.canOverlap?f.sortKey:void 0),dt=this.glyphOffsetArray.length,st=ke.vertexLength,Dt=this.allowVerticalPlacement&&_===tc.vertical?Math.PI/2:0,kt=f.text&&f.text.sections;for(let yn=0;yn<n.length;yn++){const{tl:dn,tr:Fn,bl:Yn,br:Sn,texPrimary:Wn,texSecondary:xn,pixelOffsetTL:Hn,pixelOffsetBR:ni,minFontScaleX:Zn,minFontScaleY:Si,glyphOffset:Qn,isSDF:ci,sectionIndex:Qi}=n[yn],$i=ke.vertexLength,ji=Qn[1];if(Sm(Pe,E.x,E.y,dn.x,ji+dn.y,Wn.x,Wn.y,s,ci,Hn.x,Hn.y,Zn,Si),Sm(Pe,E.x,E.y,Fn.x,ji+Fn.y,Wn.x+Wn.w,Wn.y,s,ci,ni.x,Hn.y,Zn,Si),Sm(Pe,E.x,E.y,Yn.x,ji+Yn.y,Wn.x,Wn.y+Wn.h,s,ci,Hn.x,ni.y,Zn,Si),Sm(Pe,E.x,E.y,Sn.x,ji+Sn.y,Wn.x+Wn.w,Wn.y+Wn.h,s,ci,ni.x,ni.y,Zn,Si),x){const{x:ri,y:tr,z:Dr}=x.anchor,[or,Mr,Er]=x.up;xd(Oe,ri,tr,Dr,or,Mr,Er),xd(Oe,ri,tr,Dr,or,Mr,Er),xd(Oe,ri,tr,Dr,or,Mr,Er),xd(Oe,ri,tr,Dr,or,Mr,Er),op(e.dynamicLayoutVertexArray,ri,tr,Dr,Dt)}else op(e.dynamicLayoutVertexArray,E.x,E.y,E.z,Dt);if(H){const ri=xn||Wn;Du(e.iconTransitioningVertexArray,ri.x,ri.y),Du(e.iconTransitioningVertexArray,ri.x+ri.w,ri.y),Du(e.iconTransitioningVertexArray,ri.x,ri.y+ri.h),Du(e.iconTransitioningVertexArray,ri.x+ri.w,ri.y+ri.h)}ee.emplaceBack($i,$i+1,$i+2),ee.emplaceBack($i+1,$i+2,$i+3),ke.vertexLength+=4,ke.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qn[0]),yn!==n.length-1&&Qi===n[yn+1].sectionIndex||e.programConfigurations.populatePaintArrays(Pe.length,f,f.index,{},F,z,$,kt&&kt[Qi])}const Yt=x?x.anchor:E;e.placedSymbolArray.emplaceBack(Yt.x,Yt.y,Yt.z,E.x,E.y,dt,this.glyphOffsetArray.length-dt,st,D,S,E.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],_,0,!1,0,P,0)}_commitLayoutVertex(e,n,s,c,d,f,_){e.emplaceBack(n,s,c,d,f,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,n,s,c,d,f,_){const x=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),E=x.vertexLength,D=_.tileAnchorX,S=_.tileAnchorY;for(let F=0;F<4;F++)s.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,n,e.padding,_.zOffset),this._commitLayoutVertex(s.layoutVertexArray,c,d,f,D,S,new Ae(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,d,f,D,S,new Ae(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,d,f,D,S,new Ae(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,c,d,f,D,S,new Ae(e.x1,e.y2)),x.vertexLength+=4;const P=s.indexArray;P.emplaceBack(E,E+1),P.emplaceBack(E+1,E+2),P.emplaceBack(E+2,E+3),P.emplaceBack(E+3,E),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,s,c,d,f){for(let _=c;_<d;_++){const x=s.get(_),E=this.getSymbolInstanceTextSize(e,f,n,_);this._addCollisionDebugVertices(x,E,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,n,s,c,d,f){for(let _=c;_<d;_++){const x=s.get(_),E=this.getSymbolInstanceIconSize(e,n,f.placedIconSymbolIndex);this._addCollisionDebugVertices(x,E,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new c_(sg,I1.members,wa),this.iconCollisionBox=new c_(sg,I1.members,wa);const s=th(this.iconSizeData,e),c=th(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(c,e,n,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(c,e,n,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(s,e,n,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(s,e,n,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,n,s,c){const d=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),f=ym(this.textSizeData,e,d)/sa;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,n,s){const c=this.icon.placedSymbolArray.get(s),d=ym(this.iconSizeData,e,c);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,n,s,c){e.emplaceBack(n,-s,-s,c),e.emplaceBack(n,s,-s,c),e.emplaceBack(n,s,s,c),e.emplaceBack(n,-s,s,c)}_updateTextDebugCollisionBoxes(e,n,s,c,d,f){for(let _=c;_<d;_++){const x=s.get(_),E=this.getSymbolInstanceTextSize(e,f,n,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,x.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,n,s,c,d,f){for(let _=c;_<d;_++){const x=s.get(_),E=this.getSymbolInstanceIconSize(e,n,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,x.padding,f.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=th(this.iconSizeData,e),c=th(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(c,e,n,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(c,e,n,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(s,e,n,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._updateIconDebugCollisionBoxes(s,e,n,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,s,c,d,f,_,x,E){const D={};if(n<s){const{x1:S,y1:P,x2:F,y2:z,padding:$,projectedAnchorX:H,projectedAnchorY:ee,projectedAnchorZ:Pe,tileAnchorX:Oe,tileAnchorY:ke,featureIndex:dt}=e.get(n);D.textBox={x1:S,y1:P,x2:F,y2:z,padding:$,projectedAnchorX:H,projectedAnchorY:ee,projectedAnchorZ:Pe,tileAnchorX:Oe,tileAnchorY:ke},D.textFeatureIndex=dt}if(c<d){const{x1:S,y1:P,x2:F,y2:z,padding:$,projectedAnchorX:H,projectedAnchorY:ee,projectedAnchorZ:Pe,tileAnchorX:Oe,tileAnchorY:ke,featureIndex:dt}=e.get(c);D.verticalTextBox={x1:S,y1:P,x2:F,y2:z,padding:$,projectedAnchorX:H,projectedAnchorY:ee,projectedAnchorZ:Pe,tileAnchorX:Oe,tileAnchorY:ke},D.verticalTextFeatureIndex=dt}if(f<_){const{x1:S,y1:P,x2:F,y2:z,padding:$,projectedAnchorX:H,projectedAnchorY:ee,projectedAnchorZ:Pe,tileAnchorX:Oe,tileAnchorY:ke,featureIndex:dt}=e.get(f);D.iconBox={x1:S,y1:P,x2:F,y2:z,padding:$,projectedAnchorX:H,projectedAnchorY:ee,projectedAnchorZ:Pe,tileAnchorX:Oe,tileAnchorY:ke},D.iconFeatureIndex=dt}if(x<E){const{x1:S,y1:P,x2:F,y2:z,padding:$,projectedAnchorX:H,projectedAnchorY:ee,projectedAnchorZ:Pe,tileAnchorX:Oe,tileAnchorY:ke,featureIndex:dt}=e.get(x);D.verticalIconBox={x1:S,y1:P,x2:F,y2:z,padding:$,projectedAnchorX:H,projectedAnchorY:ee,projectedAnchorZ:Pe,tileAnchorX:Oe,tileAnchorY:ke},D.verticalIconFeatureIndex=dt}return D}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),c=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),c=[],d=[],f=[];for(let _=0;_<this.symbolInstances.length;++_){f.push(_);const x=this.symbolInstances.get(_);c.push(0|Math.round(n*x.tileAnchorX+s*x.tileAnchorY)),d.push(x.featureIndex)}return f.sort((_,x)=>c[_]-c[x]||d[x]-d[_]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:E}=s;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&this.addIndicesForPlacedSymbol(this.text,d),f>=0&&f!==d&&f!==c&&this.addIndicesForPlacedSymbol(this.text,f),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ee(sp,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),sp.addDynamicAttributes=op;class bc{constructor(e,n,s,c){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,s){const{width:c,height:d}=e,{context:f}=this,{gl:_}=f;if(_.bindTexture(_.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!n||!1!==n.premultiply)),this.useMipmap=!(!n||!n.useMipmap),s||this.size&&this.size[0]===c&&this.size[1]===d){const{x,y:E}=s||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)_.texSubImage2D(_.TEXTURE_2D,0,x,E,_.RGBA,_.UNSIGNED_BYTE,e);else{let D=this.format,S=_.UNSIGNED_BYTE;this.format===_.R32F&&(D=_.RED,S=_.FLOAT),_.texSubImage2D(_.TEXTURE_2D,0,x,E,c,d,D,S,e.data)}}else if(this.size=[c,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let x=this.format;this.format===_.R8&&(x=_.RED),_.texImage2D(_.TEXTURE_2D,0,this.format,x,_.UNSIGNED_BYTE,e)}else{let x=this.format,E=this.format,D=_.UNSIGNED_BYTE,S=!1;this.format===_.DEPTH_COMPONENT&&(x=_.DEPTH_COMPONENT16,D=_.UNSIGNED_SHORT),this.format===_.DEPTH_STENCIL&&(x=_.DEPTH24_STENCIL8,D=_.UNSIGNED_INT_24_8,S=!0),this.format===_.R8&&(E=_.RED),this.format===_.R32F&&(D=_.FLOAT,E=_.RED),!this.useMipmap&&S?_.texStorage2D(_.TEXTURE_2D,1,x,c,d):_.texImage2D(_.TEXTURE_2D,0,x,c,d,0,E,D,e.data)}this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,n,s=!1){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,s,c){const{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),n!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),this.wrapS=s),c!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class u_{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrapS=n)}}const rh=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,s=0,c=0,d=0,f=0,_=0;for(1&e?c=d=f=32:n=s=_=32;(e>>=1)>1;){const E=n+c>>1,D=s+d>>1;1&e?(c=n,d=s,n=f,s=_):(n=c,s=d,c=f,d=_),f=E,_=D}const x=4*t;rh[x+0]=n,rh[x+1]=s,rh[x+2]=c,rh[x+3]=d}const Yc=new Uint16Array(2178),oh=new Uint8Array(1089),rf=new Uint16Array(1089);function X1(t){return 0===t?-.03125:32===t?.03125:0}var Pm=oo([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Sw=oo([{name:"a_index",type:"Int16",components:1}]);const Av={type:2,extent:hi,loadGeometry:()=>[[new Ae(0,0),new Ae(hi+1,0),new Ae(hi+1,hi+1),new Ae(0,hi+1),new Ae(0,0)]]};class d_{constructor(e,n,s,c,d){this.tileID=e,this.uid=Vi(),this.uses=0,this.tileSize=n,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,c&&c.style&&(this._lastUpdatedBrightness=c.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<Vo.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=vd(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,d){const f={};if(!d)return f;for(const _ of c){const x=_.layerIds.map(E=>d.getLayer(E)).filter(Boolean);if(0!==x.length){_.layers=x,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(E=>x.filter(D=>D.id===E)[0]));for(const E of x)f[E.fqid]=_}}return f}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof sp){if(this.hasSymbolBuckets=!0,!s)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof sp&&d.hasRTLText){this.hasRTLText=!0,Rr.isLoading()||Rr.isLoaded()||"deferred"!==Fr()||fr();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c],f=n.style.getOwnLayer(c);if(!f)continue;const _=f.queryRadius(d);this.queryPadding=Math.max(this.queryPadding,_)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new ly}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const c in this.buckets){const d=this.buckets[c];d.uploadPending()&&d.upload(e)}const n=e.gl,s=this.imageAtlas;if(s&&!s.uploaded){const c=!!Object.keys(s.patternPositions).length;this.imageAtlasTexture=new bc(e,s.image,n.RGBA,{useMipmap:c}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new bc(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new bc(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,s){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,s),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const c=n.style.getBrightness();(this._lastUpdatedBrightness||c)&&(this._lastUpdatedBrightness&&c&&Math.abs(this._lastUpdatedBrightness-c)<.001||(this._lastUpdatedBrightness=c,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,s,c,d,f,_,x){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:_,transform:f,params:d,tileTransform:this.tileTransform},e,n,s):{}}querySourceFeatures(e,n){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const c=s.loadVTLayers(),d=n?n.sourceLayer:"",f=c._geojsonTileLayer||c[d];if(!f)return;const _=Xs(n&&n.filter),{z:x,x:E,y:D}=this.tileID.canonical,S={z:x,x:E,y:D};for(let P=0;P<f.length;P++){const F=f.feature(P);if(_.needGeometry){const H=Eu(F,!0);if(!_.filter(new rr(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!_.filter(new rr(this.tileID.overscaledZ),F))continue;const z=s.getId(F,d),$=new uv(F,x,E,D,z);$.tile=S,e.push($)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const s=_a(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let c=!1;if(this.expirationTime>s)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{const d=this.expirationTime-n;d?this.expirationTime=s+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;const s=this.latestFeatureIndex.loadVTLayers(),c=n.style.listImages(),d=n.style.getBrightness();for(const f in this.buckets){if(!n.style.hasLayer(f))continue;const _=this.buckets[f],x=_.layers[0].sourceLayer||"_geojsonTileLayer",E=s[x];let D={};if(e&&(D=e[x],!E||!D||0===Object.keys(D).length))continue;if(_.update(D,E,c,this.imageAtlas&&this.imageAtlas.patternPositions||{},d),_ instanceof iv||_ instanceof Hf){const P=n.style.getOwnSourceCache(_.layers[0].source);n._terrain&&n._terrain.enabled&&P&&_.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(P.id,this.tileID)}const S=n&&n.style&&n.style.getOwnLayer(f);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Vo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Vo.now()+e}setTexture(e,n){const s=n.context,c=s.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof bc?this.texture.update(e,{useMipmap:!0}):(this.texture=new bc(s,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE))}setDependencies(e,n){const s={};for(const c of n)s[c]=!0;this.dependencies[e]=s}hasDependency(e,n){for(const s of e){const c=this.dependencies[s];if(c)for(const d of n)if(c[d])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const s=wu(Av,this.tileID.canonical,this.tileTransform)[0],c=new gc,d=new Lh;for(let f=0;f<s.length;f++){const{x:_,y:x}=s[f];c.emplaceBack(_,x),d.emplaceBack(f)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(c,Yp.members),this._tileDebugSegments=rs.simpleSegment(0,0,c.length,d.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const s=wu(Av,this.tileID.canonical,this.tileTransform)[0];let c,d;if(this.isRaster){const f=function(_,x){const E=vd(_,x),D=Math.pow(2,_.z);for(let H=0;H<33;H++)for(let ee=0;ee<33;ee++){const Pe=Ta((_.x+(ee+X1(ee))/32)/D),Oe=qs((_.y+(H+X1(H))/32)/D),ke=x.project(Pe,Oe),dt=33*H+ee;Yc[2*dt+0]=Math.round((ke.x*E.scale-E.x)*hi),Yc[2*dt+1]=Math.round((ke.y*E.scale-E.y)*hi)}oh.fill(0),rf.fill(0);for(let H=2045;H>=0;H--){const ee=4*H,Pe=rh[ee+0],Oe=rh[ee+1],ke=rh[ee+2],dt=rh[ee+3],st=Pe+ke>>1,Dt=Oe+dt>>1,kt=st+Dt-Oe,Yt=Dt+Pe-st,yn=33*Oe+Pe,dn=33*dt+ke,Fn=33*Dt+st,Yn=Math.hypot((Yc[2*yn+0]+Yc[2*dn+0])/2-Yc[2*Fn+0],(Yc[2*yn+1]+Yc[2*dn+1])/2-Yc[2*Fn+1])>=16;oh[Fn]=oh[Fn]||(Yn?1:0),H<1022&&(oh[Fn]=oh[Fn]||oh[33*(Oe+Yt>>1)+(Pe+kt>>1)]||oh[33*(dt+Yt>>1)+(ke+kt>>1)])}const S=new ba,P=new Zs;let F=0;function z(H,ee){const Pe=33*ee+H;return 0===rf[Pe]&&(S.emplaceBack(Yc[2*Pe+0],Yc[2*Pe+1],H*hi/32,ee*hi/32),rf[Pe]=++F),rf[Pe]-1}function $(H,ee,Pe,Oe,ke,dt){const st=H+Pe>>1,Dt=ee+Oe>>1;if(Math.abs(H-ke)+Math.abs(ee-dt)>1&&oh[33*Dt+st])$(ke,dt,H,ee,st,Dt),$(Pe,Oe,ke,dt,st,Dt);else{const kt=z(H,ee),Yt=z(Pe,Oe),yn=z(ke,dt);P.emplaceBack(kt,Yt,yn)}}return $(0,0,32,32,32,0),$(32,32,0,0,0,32),{vertices:S,indices:P}}(this.tileID.canonical,n);c=f.vertices,d=f.indices}else{c=new ba,d=new Zs;for(const{x:_,y:x}of s)c.emplaceBack(_,x,0,0);const f=$h(c.int16,void 0,4);for(let _=0;_<f.length;_+=3)d.emplaceBack(f[_],f[_+1],f[_+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,Pm.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=rs.simpleSegment(0,0,c.length,d.length)}_makeGlobeTileDebugBuffers(e,n){const s=n.projection;if(!s||"globe"!==s.name||n.freezeTileCoverage)return;const c=this.tileID.canonical,d=Qp(za(c,n)),f=cd(n.zoom);let _;f>0&&(_=a.ad.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,c,n,d,_,f),this._makeGlobeTileDebugTextBuffer(e,c,n,d,_,f)}_globePoint(e,n,s,c,d,f,_){let x=jf(e,n,s);if(f){const E=1<<s.z,D=bu(c.center.lng),S=Wc(c.center.lat),P=(s.x+.5)/E-D;let F=0;P>.5?F=-1:P<-.5&&(F=1);let z=(e/hi+s.x)/E+F,$=(n/hi+s.y)/E;z=(z-D)*c._pixelsPerMercatorPixel+D,$=($-S)*c._pixelsPerMercatorPixel+S;const H=[z*c.worldSize,$*c.worldSize,0];a._.transformMat4(H,H,f),x=qd(x,H,_)}return a._.transformMat4(x,x,d)}_makeGlobeTileDebugBorderBuffer(e,n,s,c,d,f){const _=new gc,x=new Lh,E=new Hd,D=(P,F,z,$,H)=>{const ee=(z-P)/(H-1),Pe=($-F)/(H-1),Oe=_.length;for(let ke=0;ke<H;ke++){const dt=P+ke*ee,st=F+ke*Pe;_.emplaceBack(dt,st);const Dt=this._globePoint(dt,st,n,s,c,d,f);E.emplaceBack(Dt[0],Dt[1],Dt[2]),x.emplaceBack(Oe+ke)}},S=hi;D(0,0,S,0,16),D(S,0,S,S,16),D(S,S,0,S,16),D(0,S,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(x),this._tileDebugBuffer=e.createVertexBuffer(_,Yp.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(E,Ey.members),this._tileDebugSegments=rs.simpleSegment(0,0,_.length,x.length)}_makeGlobeTileDebugTextBuffer(e,n,s,c,d,f){const _=hi/4,x=new gc,E=new Zs,D=new Hd,S=25;E.reserve(32),x.reserve(S),D.reserve(S);const P=(F,z)=>S*F+z;for(let F=0;F<S;F++){const z=F*_;for(let $=0;$<S;$++){const H=$*_;x.emplaceBack(H,z);const ee=this._globePoint(H,z,n,s,c,d,f);D.emplaceBack(ee[0],ee[1],ee[2])}}for(let F=0;F<4;F++)for(let z=0;z<4;z++){const $=P(F,z),H=P(F,z+1),ee=P(F+1,z),Pe=P(F+1,z+1);E.emplaceBack($,H,ee),E.emplaceBack(ee,H,Pe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(E),this._tileDebugTextBuffer=e.createVertexBuffer(x,Yp.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(D,Ey.members),this._tileDebugTextSegments=rs.simpleSegment(0,0,S,32)}destroy(e=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof bc&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function Aw(t,e,n){var s,c;1===t?e.header_length=n.readFixed32():2===t?e.x=n.readVarint():3===t?e.y=n.readVarint():4===t?e.z=n.readVarint():5===t&&e.layers.push((s=n,c=n.readVarint()+n.pos,s.readFields(Om,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},c)))}function K1(t,e,n){var s,c;1===t?(e.delta_filter=(s=n,c=n.readVarint()+n.pos,s.readFields(Pv,{block_size:0},c)),e.filter="delta_filter"):2===t?(n.readVarint(),e.filter="zigzag_filter"):3===t?(n.readVarint(),e.filter="bitshuffle_filter"):4===t&&(n.readVarint(),e.filter="byteshuffle_filter")}function Pv(t,e,n){1===t&&(e.block_size=n.readVarint())}function Z1(t,e,n){1===t?(n.readVarint(),e.codec="gzip_data"):2===t?(n.readVarint(),e.codec="jpeg_image"):3===t?(n.readVarint(),e.codec="webp_image"):4===t&&(n.readVarint(),e.codec="png_image")}function Rm(t,e,n){var s,c;1===t?e.first_byte=n.readFixed64():2===t?e.last_byte=n.readFixed64():3===t?e.filters.push((s=n,c=n.readVarint()+n.pos,s.readFields(K1,{},c))):4===t?e.codec=function(s,c){return s.readFields(Z1,{},c)}(n,n.readVarint()+n.pos):5===t?e.offset=n.readFloat():6===t?e.scale=n.readFloat():7===t&&e.bands.push(n.readString())}function Om(t,e,n){var s,c;1===t?e.version=n.readVarint():2===t?e.name=n.readString():3===t?e.units=n.readString():4===t?e.tilesize=n.readVarint():5===t?e.buffer=n.readVarint():6===t?e.pixel_format=n.readVarint():7===t&&e.data_index.push((s=n,c=n.readVarint()+n.pos,s.readFields(Rm,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},c)))}function Lm(t,e,n){if(2===t)s=n,c=n.readVarint()+n.pos,s.readFields(Pw,e,c);else if(3===t)throw new Error("Not implemented");var s,c}function Pw(t,e,n){if(1===t){let s=0;const c=n.readVarint()+n.pos;for(;n.pos<c;)e[s++]=n.readVarint()}}class Rw{constructor(e=0,n=0,s=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=s,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const n=this.items[e];delete this.items[e],this.size--,null!==n.prev&&(n.prev.next=n.next),null!==n.next&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){const n=this.first;delete this.items[n.key],0==--this.size?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){const s=this.items[e];this.ttl>0&&s.expiry<=Date.now()?this.delete(e):(n=s.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){const e=[];let n=this.first;for(;null!==n;)e.push(n.key),n=n.next;return e}set(e,n,s=!1,c=this.resetTtl){let d;if(s||this.has(e)){if(d=this.items[e],d.value=n,!1===s&&c&&(d.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==d){const f=this.last,_=d.next,x=d.prev;this.first===d&&(this.first=d.next),d.next=null,d.prev=this.last,f.next=d,null!==x&&(x.next=_),null!==_&&(_.prev=x)}}else this.max>0&&this.size===this.max&&this.evict(!0),d=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},1==++this.size?this.first=d:this.last.next=d;return this.last=d,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function Ow(t,e){if(4!==e.length)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let s=2;s>=1;s--){const c=1===s?1:0,d=2===s?1:0;for(let f=0;f<e[0];f++){const _=e[1]*f;for(let x=c;x<e[1];x++){const E=e[2]*(x+_);for(let D=d;D<e[2];D++){const S=e[3]*(D+E);for(let P=0;P<e[3];P++){const F=S+P;t[F]+=t[F-n]}}}}n*=e[s]}return t}function h_(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function Rv(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){const s=t[n],c=t[n+1];t[n]=(240&s)>>4|(61440&s)>>8|(240&c)<<4|61440&c,t[n+1]=15&s|(3840&s)>>4|(15&c)<<8|(3840&c)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){const s=t[n],c=t[n+1],d=t[n+2],f=t[n+3];t[n+0]=(192&s)>>6|(192&c)>>4|(192&d)>>2|192&f,t[n+1]=(48&s)>>4|(48&c)>>2|48&d|(48&f)<<2,t[n+2]=(12&s)>>2|12&c|(12&d)<<2|(12&f)<<4,t[n+3]=3&s|(3&c)<<2|(3&d)<<4|(3&f)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class sh extends Error{constructor(e){super(e),this.name="MRTError"}}var Ec=Uint8Array,km=Uint16Array,Lw=Int32Array,q1=new Ec([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),kw=new Ec([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Fw=new Ec([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Nw=function(t,e){for(var n=new km(31),s=0;s<31;++s)n[s]=e+=1<<t[s-1];var c=new Lw(n[30]);for(s=1;s<30;++s)for(var d=n[s];d<n[s+1];++d)c[d]=d-n[s]<<5|s;return{b:n,r:c}},Y1=Nw(q1,2),J1=Y1.b,Bw=Y1.r;J1[28]=258,Bw[258]=28;for(var Ov=Nw(kw,0).b,sf=new km(32768),vs=0;vs<32768;++vs){var bd=(43690&vs)>>1|(21845&vs)<<1;sf[vs]=((65280&(bd=(61680&(bd=(52428&bd)>>2|(13107&bd)<<2))>>4|(3855&bd)<<4))>>8|(255&bd)<<8)>>1}var ap=function(t,e,n){for(var s=t.length,c=0,d=new km(e);c<s;++c)t[c]&&++d[t[c]-1];var f,_=new km(e);for(c=1;c<e;++c)_[c]=_[c-1]+d[c-1]<<1;if(n){f=new km(1<<e);var x=15-e;for(c=0;c<s;++c)if(t[c])for(var E=c<<4|t[c],D=e-t[c],S=_[t[c]-1]++<<D,P=S|(1<<D)-1;S<=P;++S)f[sf[S]>>x]=E}else for(f=new km(s),c=0;c<s;++c)t[c]&&(f[c]=sf[_[t[c]-1]++]>>15-t[c]);return f},wd=new Ec(288);for(vs=0;vs<144;++vs)wd[vs]=8;for(vs=144;vs<256;++vs)wd[vs]=9;for(vs=256;vs<280;++vs)wd[vs]=7;for(vs=280;vs<288;++vs)wd[vs]=8;var Lv=new Ec(32);for(vs=0;vs<32;++vs)Lv[vs]=5;var zw=ap(wd,9,1),Fm=ap(Lv,5,1),f_=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},Cc=function(t,e,n){var s=e/8|0;return(t[s]|t[s+1]<<8)>>(7&e)&n},p_=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},Q1=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Jc=function(t,e,n){var s=new Error(e||Q1[t]);if(s.code=t,Error.captureStackTrace&&Error.captureStackTrace(s,Jc),!n)throw s;return s},Uw=new Ec(0),jw=typeof TextDecoder<"u"&&new TextDecoder;try{jw.decode(Uw,{stream:!0})}catch{}const Nm={gzip_data:"gzip"},Vw={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},$w={uint32:1,uint16:2,uint8:4},Gw={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class lp{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const n=new Uint8Array(e),s=new DataView(e);if(13!==n[0])throw new sh("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const n=new Uint8Array(e),s=this.getHeaderLength(e);if(n.length<s)throw new sh(`Expected header with length >= ${s} but got buffer of length ${n.length}`);const c=new Kc(n.subarray(0,s)).readFields(Aw,{header_length:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==c.x||this.y!==c.y||this.z!==c.z))throw new sh(`Invalid attempt to parse header ${c.z}/${c.x}/${c.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=c.x,this.y=c.y,this.z=c.z;for(const d of c.layers)this.layers[d.name]=new ex(d,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const n=[],s=this.getLayer(e.layerName);for(let c=0;c<s.dataIndex.length;c++){const d=s.dataIndex[c],f=d.first_byte-e.firstByte,_=d.last_byte+1-e.firstByte;if(c<e.firstBlock||c>e.lastBlock||s._blocksInProgress.has(c))continue;const x={layerName:s.name,firstByte:f,lastByte:_,pixelFormat:s.pixelFormat,blockIndex:c,blockShape:[d.bands.length].concat(s.bandShape),buffer:s.buffer,codec:d.codec.codec,filters:d.filters.map(E=>E.filter)};s._blocksInProgress.add(c),n.push(x)}return new kv(n,()=>{n.forEach(c=>s._blocksInProgress.delete(c.blockIndex))},(c,d)=>{if(n.forEach(f=>s._blocksInProgress.delete(f.blockIndex)),c)throw c;d.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class ex{constructor({version:e,name:n,units:s,tilesize:c,pixel_format:d,buffer:f,data_index:_},x){if(this.version=e,1!==this.version)throw new sh(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=s,this.tileSize=c,this.buffer=f,this.pixelFormat=Vw[d],this.dataIndex=_,this.bandShape=[c+2*f,c+2*f,$w[this.pixelFormat]],this._decodedBlocks=function(E=1e3,D=0,S=!1){if(isNaN(E)||E<0)throw new TypeError("Invalid max value");if(isNaN(D)||D<0)throw new TypeError("Invalid ttl value");if("boolean"!=typeof S)throw new TypeError("Invalid resetTtl value");return new Rw(E,D,S)}(x?x.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(const[s,c]of this.dataIndex.entries()){for(const[d,f]of c.bands.entries())if(f===e)return{bandIndex:n+d,blockIndex:s,blockBandIndex:d};n+=c.bands.length}break;case"number":for(const[s,c]of this.dataIndex.entries()){if(e>=n&&e<n+c.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-n};n+=c.bands.length}break;default:throw new sh(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new sh(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,s=-1/0,c=1/0,d=-1/0;for(const f of e){const{blockIndex:_}=this.getBlockForBand(f);if(_<0)throw new sh(`Invalid band: ${JSON.stringify(f)}`);const x=this.dataIndex[_];c=Math.min(c,_),d=Math.max(d,_),n=Math.min(n,x.first_byte),s=Math.max(s,x.last_byte)}return{layerName:this.name,firstByte:n,lastByte:s,firstBlock:c,lastBlock:d}}hasBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){const{blockIndex:n,blockBandIndex:s}=this.getBlockForBand(e),c=this._decodedBlocks.get(n.toString());if(!c)throw new sh(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const d=this.dataIndex[n],f=this.bandShape.reduce((E,D)=>E*D,1),_=s*f,x=c.subarray(_,_+f);return{data:x,bytes:new Uint8Array(x.buffer).subarray(x.byteOffset,x.byteOffset+x.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:d.offset,scale:d.scale}}}class kv{constructor(e,n,s){this.tasks=e,this._onCancel=n,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}lp.performDecoding=function(t,e){return Promise.all(e.tasks.map(n=>{const{layerName:s,firstByte:c,lastByte:d,pixelFormat:f,blockShape:_,blockIndex:x,filters:E,codec:D}=n,S=new Uint8Array(t).subarray(c,d+1),P=new Uint32Array(_[0]*_[1]*_[2]);let F;if("gzip_data"!==D)throw new Error(`Unhandled codec: ${D}`);return F=function(z,$){if(!globalThis.DecompressionStream&&"gzip_data"===$)return Promise.resolve(((Oe=function(st){31==st[0]&&139==st[1]&&8==st[2]||Jc(6,"invalid gzip data");var Dt=st[3],kt=10;4&Dt&&(kt+=2+(st[10]|st[11]<<8));for(var Yt=(Dt>>3&1)+(Dt>>4&1);Yt>0;Yt-=!st[kt++]);return kt+(2&Dt)}(Pe=z))+8>Pe.length&&Jc(6,"invalid gzip data"),function(st,Dt,kt,Yt){var yn=st.length;if(!yn||Dt.f&&!Dt.l)return kt||new Ec(0);var dn=!kt,Fn=dn||2!=Dt.i,Yn=Dt.i;dn&&(kt=new Ec(3*yn));var Sn,Wn,xn=function(df){var hf=kt.length;if(df>hf){var xp=new Ec(Math.max(2*hf,df));xp.set(kt),kt=xp}},Hn=Dt.f||0,ni=Dt.p||0,Zn=Dt.b||0,Si=Dt.l,Qn=Dt.d,ci=Dt.m,Qi=Dt.n,$i=8*yn;do{if(!Si){Hn=Cc(st,ni,1);var ji=Cc(st,ni+1,3);if(ni+=3,!ji){var ri=st[(Hr=4+((ni+7)/8|0))-4]|st[Hr-3]<<8,tr=Hr+ri;if(tr>yn){Yn&&Jc(0);break}Fn&&xn(Zn+ri),kt.set(st.subarray(Hr,tr),Zn),Dt.b=Zn+=ri,Dt.p=ni=8*tr,Dt.f=Hn;continue}if(1==ji)Si=zw,Qn=Fm,ci=9,Qi=5;else if(2==ji){var Dr=Cc(st,ni,31)+257,or=Cc(st,ni+10,15)+4,Mr=Dr+Cc(st,ni+5,31)+1;ni+=14;for(var Er=new Ec(Mr),Or=new Ec(19),ir=0;ir<or;++ir)Or[Fw[ir]]=Cc(st,ni+3*ir,7);ni+=3*or;var Mo=f_(Or),Co=(1<<Mo)-1,Qr=ap(Or,Mo,1);for(ir=0;ir<Mr;){var Hr,so=Qr[Cc(st,ni,Co)];if(ni+=15&so,(Hr=so>>4)<16)Er[ir++]=Hr;else{var $o=0,Bo=0;for(16==Hr?(Bo=3+Cc(st,ni,3),ni+=2,$o=Er[ir-1]):17==Hr?(Bo=3+Cc(st,ni,7),ni+=3):18==Hr&&(Bo=11+Cc(st,ni,127),ni+=7);Bo--;)Er[ir++]=$o}}var ms=Er.subarray(0,Dr),us=Er.subarray(Dr);ci=f_(ms),Qi=f_(us),Si=ap(ms,ci,1),Qn=ap(us,Qi,1)}else Jc(1);if(ni>$i){Yn&&Jc(0);break}}Fn&&xn(Zn+131072);for(var Va=(1<<ci)-1,Es=(1<<Qi)-1,os=ni;;os=ni){var Ts=($o=Si[p_(st,ni)&Va])>>4;if((ni+=15&$o)>$i){Yn&&Jc(0);break}if($o||Jc(2),Ts<256)kt[Zn++]=Ts;else{if(256==Ts){os=ni,Si=null;break}var Js=Ts-254;Ts>264&&(Js=Cc(st,ni,(1<<(vl=q1[ir=Ts-257]))-1)+J1[ir],ni+=vl);var da=Qn[p_(st,ni)&Es],Uo=da>>4;if(da||Jc(3),ni+=15&da,us=Ov[Uo],Uo>3){var vl=kw[Uo];us+=p_(st,ni)&(1<<vl)-1,ni+=vl}if(ni>$i){Yn&&Jc(0);break}Fn&&xn(Zn+131072);var hh=Zn+Js;if(Zn<us){var eu=0-us,Pu=Math.min(us,hh);for(eu+Zn<0&&Jc(3);Zn<Pu;++Zn)kt[Zn]=(void 0)[eu+Zn]}for(;Zn<hh;++Zn)kt[Zn]=kt[Zn-us]}}Dt.l=Si,Dt.p=os,Dt.b=Zn,Dt.f=Hn,Si&&(Hn=1,Dt.m=ci,Dt.d=Qn,Dt.n=Qi)}while(!Hn);return Zn!=kt.length&&dn?(Sn=kt,(null==(Wn=Zn)||Wn>Sn.length)&&(Wn=Sn.length),new Ec(Sn.subarray(0,Wn))):kt.subarray(0,Zn)}(Pe.subarray(Oe,-8),{i:2},new Ec(((H=Pe)[(ee=H.length)-4]|H[ee-3]<<8|H[ee-2]<<16|H[ee-1]<<24)>>>0))));var H,ee,Pe,Oe;const ke=Nm[$];if(!ke)throw new Error(`Unhandled codec: ${$}`);const dt=new globalThis.DecompressionStream(ke);return new Response(new Blob([z]).stream().pipeThrough(dt)).arrayBuffer().then(st=>new Uint8Array(st))}(S,D).then(z=>(new Kc(z).readFields(Lm,P),new Gw[f](P.buffer))),F.then(z=>{for(let $=E.length-1;$>=0;$--)switch(E[$]){case"delta_filter":Ow(z,_);break;case"zigzag_filter":h_(z);break;case"bitshuffle_filter":Rv(z,f);break;default:throw new Error(`Unhandled filter "${E[$]}"`)}return{layerName:s,blockIndex:x,data:z}}).catch(z=>{throw z})}))};class Fv extends d_{constructor(e,n,s,c,d){super(e,n,s,c,d),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,n){const s=n.context,c=s.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof bc?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new bc(s,e,c.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,n){const s=this._mrt=new lp(30),c=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=jl(c,(d,f,_,x)=>{if(d)n(d);else try{const E=s.getHeaderLength(f);if(E>e)return void(this.request=this.fetchHeader(E,n));s.parseHeader(f),this._isHeaderLoaded=!0;let D=0;for(const S of Object.values(s.layers))D=Math.max(D,S.dataIndex[S.dataIndex.length-1].last_byte);f.byteLength>=D&&(this.entireBuffer=f),n(null,this.entireBuffer||f,_,x)}catch(E){n(E)}}),this.request}fetchBand(e,n,s){const c=this._mrt;if(!this._isHeaderLoaded||!c)return void s(new Error("Tile header is not ready"));const d=this.actor;if(!d)return void s(new Error("Can't fetch tile band without an actor"));let f;const _=(S,P)=>{f.complete(S,P),S?s(S):(this.updateTextureDescriptor(e,n),s(null,this.textureDescriptor&&this.textureDescriptor.img))},x=(S,P)=>{if(S)return s(S);const F=d.send("decodeRasterArray",{buffer:P,task:f},_,void 0,!0);this._workQueue.push(()=>{F&&F.cancel(),f.cancel()})},E=c.getLayer(e);if(!E)return void s(new Error(`Unknown sourceLayer "${e}"`));if(E.hasDataForBand(n))return this.updateTextureDescriptor(e,n),void s(null,this.textureDescriptor?this.textureDescriptor.img:null);const D=E.getDataRange([n]);if(f=c.createDecodingTask(D),!f||f.tasks.length)if(this.flushQueues(),this.entireBuffer)x(null,this.entireBuffer.slice(D.firstByte,D.lastByte+1));else{const S=Object.assign({},this.requestParams,{headers:{Range:`bytes=${D.firstByte}-${D.lastByte}`}}),P=jl(S,x);this._fetchQueue.push(()=>{P.cancel(),f.cancel()})}else s(null)}updateNeeded(e,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==e)&&"errored"!==this.state}updateTextureDescriptor(e,n){if(!this._mrt)return;const s=this._mrt.getLayer(e);if(!s||!s.hasBand(n)||!s.hasDataForBand(n))return;const{bytes:c,tileSize:d,buffer:f,offset:_,scale:x}=s.getBandView(n),E=d+2*f,D={data:c,width:E,height:E},S=this.texture;S&&S instanceof bc&&S.update(D,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:n,img:D,buffer:f,offset:_,tileSize:d,format:s.pixelFormat,mix:[x,256*x,65536*x,16777216*x]}}}class Hw{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,s){const c=e.wrapped().key;void 0===this.data[c]&&(this.data[c]=[]);const d={value:n,timeout:void 0};if(void 0!==s&&(d.timeout=setTimeout(()=>{this.remove(e,d)},s)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const s=e.wrapped().key,c=void 0===n?0:this.data[s].indexOf(n),d=this.data[s][c];return this.data[s].splice(c,1),d.timeout&&clearTimeout(d.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(d.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const s in this.data)for(const c of this.data[s])e(c.value)||n.push(c);for(const s of n)this.remove(s.value.tileID,s)}}class ah extends lc{constructor(e,n,s){super(),this.id=e,this._onlySymbols=s,n.on("data",c=>{"source"===c.dataType&&"metadata"===c.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===c.dataType&&"content"===c.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Hw(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new dv,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if("errored"!==n.state&&("loaded"!==n.state||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const s=this._tiles[n];s.upload(e),s.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return mi(this._tiles).map(e=>e.tileID).sort(m_).map(e=>e.key)}getRenderableIds(e,n){const s=[];for(const c in this._tiles)this._isIdRenderable(+c,e,n)&&s.push(this._tiles[c]);return e?s.sort((c,d)=>{const f=c.tileID,_=d.tileID,x=new Ae(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),E=new Ae(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-_.overscaledZ||E.y-x.y||E.x-x.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(m_).map(c=>c.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(s||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,e,n)))}_tileLoaded(e,n,s,c){if(c)if(e.state="errored",404!==c.status)this._source.fire(new wr(c,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new la("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Vo.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new la("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let c=0;c<n.length;c++){const d=n[c];if(e.neighboringTiles&&e.neighboringTiles[d]){const f=this.getTileByID(d);s(e,f),s(f,e)}}function s(c,d){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let f=d.tileID.canonical.x-c.tileID.canonical.x;const _=d.tileID.canonical.y-c.tileID.canonical.y,x=Math.pow(2,c.tileID.canonical.z),E=d.tileID.key;0===f&&0===_||Math.abs(_)>1||(Math.abs(f)>1&&(1===Math.abs(f+x)?f+=x:1===Math.abs(f-x)&&(f-=x)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,f,_),c.neighboringTiles&&c.neighboringTiles[E]&&(c.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,s,c){for(const d in this._tiles){let f=this._tiles[d];if(c[d]||!f.hasData()||f.tileID.overscaledZ<=n||f.tileID.overscaledZ>s)continue;let _=f.tileID;for(;f&&f.tileID.overscaledZ>n+1;){const E=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[E.key],f&&f.hasData()&&(_=E)}let x=_;for(;x.overscaledZ>n;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){c[_.key]=_;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=e.overscaledZ-1;s>=n;s--){const c=e.scaledTo(s),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const s=Math.ceil(e.width/n)+1,c=Math.ceil(e.height/n)+1,d=Math.floor(s*c*5),f="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,d):d,_="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(_)}handleWrapJump(e){const n=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,n){const s={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),s[d.tileID.key]=d}this._tiles=s;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,n,s,c){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let d;if(this.updateCacheSize(e,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Os(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y));else if(0!==this.tileCoverLift){const x=e.clone();x.tileCoverLift=this.tileCoverLift,d=x.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&"globe"===e.projection.name&&(d.push(new Os(1,0,1,0,0)),d.push(new Os(1,0,1,1,0)),d.push(new Os(1,0,1,0,1)),d.push(new Os(1,0,1,1,1)))}else if(d=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){const x=this._source.hasTile.bind(this._source);d=d.filter(E=>x(E))}}else d=[];if(d.length>0&&this.castsShadows&&c&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!cp(this._source.type)){const x=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!s}),E=Math.min(x,this._source.maxzoom),D=e.extendTileCoverForShadows(d,c,E);for(const S of D)this._shadowCasterTiles[S.key]=!0,d.push(S)}const f=this._updateRetainedTiles(d);if(cp(this._source.type)&&0!==d.length){const x={},E={},D=Object.keys(f);for(const P of D){const F=f[P],z=this._tiles[P];if(!z||z.fadeEndTime&&z.fadeEndTime<=Vo.now())continue;const $=this.findLoadedParent(F,Math.max(F.overscaledZ-ah.maxOverzooming,this._source.minzoom));$&&(this._addTile($.tileID),x[$.tileID.key]=$.tileID),E[P]=F}const S=d[d.length-1].overscaledZ;for(const P in this._tiles){const F=this._tiles[P];if(f[P]||!F.hasData())continue;let z=F.tileID;for(;z.overscaledZ>S;){z=z.scaledTo(z.overscaledZ-1);const $=this._tiles[z.key];if($&&$.hasData()&&E[z.key]){f[P]=F.tileID;break}}}for(const P in x)f[P]||(this._coveredTiles[P]=!0,f[P]=x[P])}for(const x in f)this._tiles[x].clearFadeHold();const _=function(x,E){const D=[];for(const S in x)S in E||D.push(S);return D}(this._tiles,f);for(const x of _){const E=this._tiles[x];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(0===e.length)return n;const s={},c=e.reduce((E,D)=>Math.min(E,D.overscaledZ),1/0),d=e[0].overscaledZ,f=Math.max(d-ah.maxOverzooming,this._source.minzoom),_=Math.max(d+ah.maxUnderzooming,this._source.minzoom),x={};for(const E of e){const D=this._addTile(E);n[E.key]=E,D.hasData()||c<this._source.maxzoom&&(x[E.key]=E)}this._retainLoadedChildren(x,c,_,n);for(const E of e){let D=this._tiles[E.key];if(D.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const P=E.children(this._source.maxzoom)[0],F=this.getTile(P);if(F&&F.hasData()){n[P.key]=P;continue}}else{const P=E.children(this._source.maxzoom);if(n[P[0].key]&&n[P[1].key]&&n[P[2].key]&&n[P[3].key])continue}let S=D.wasRequested();for(let P=E.overscaledZ-1;P>=f;--P){const F=E.scaledTo(P);if(s[F.key]||(s[F.key]=!0,D=this.getTile(F),!D&&S&&(D=this._addTile(F)),D&&(n[F.key]=F,S=D.wasRequested(),D.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let s,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){s=this._loadedParentTiles[c.key];break}n.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(s=this._getLoadedTile(d),s)break;c=d}for(const d of n)this._loadedParentTiles[d]=s}}_addTile(e){let n=this._tiles[e.key];if(n)return!0!==n.isExtraShadowCaster||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const s=!!n;if(!s){const c=this.map?this.map.painter:null,d=this._source.tileSize*e.overscaleFactor();n="raster-array"===this._source.type?new Fv(e,d,this.transform.tileZoom,c,this._isRaster):new d_(e,d,this.transform.tileZoom,c,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,s||this._source.fire(new la("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=n.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&"reloading"!==n.state||"empty"===n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,s){const c=[],d=this.transform;if(!d)return c;const f="globe"===d.projection.name,_=bu(d.center.lng);for(const x in this._tiles){const E=this._tiles[x];if(s&&E.clearQueryDebugViz(),E.holdingForFade())continue;let D;if(f){const S=E.tileID.canonical;if(0===S.z){const P=[Math.abs(Ut(_,...Bm(S,-1))-_),Math.abs(Ut(_,...Bm(S,1))-_)];D=[0,2*P.indexOf(Math.min(...P))-1]}else{const P=[Math.abs(Ut(_,...Bm(S,-1))-_),Math.abs(Ut(_,...Bm(S,0))-_),Math.abs(Ut(_,...Bm(S,1))-_)];D=[P.indexOf(Math.min(...P))-1]}}else D=[0];for(const S of D){const P=e.containsTile(E,d,n,S);P&&c.push(P)}}return c}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){const s=this.getRenderableIds(e,n).map(d=>this._tiles[d].tileID),c="globe"===this.transform.projection.name;for(const d of s)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped()),d.expandedProjMatrix=c?this.transform.calculateProjMatrix(d.toUnwrapped(),!1,!0):d.projMatrix;return s}sortCoordinatesByDistance(e){const n=e.slice(),s=this.transform._camera.position,c=this.transform._camera.forward(),d={};for(const f of n){const _=1/(1<<f.canonical.z);d[f.key]=((f.canonical.x+.5)*_+f.wrap-s[0])*c[0]+((f.canonical.y+.5)*_-s[1])*c[1]-s[2]*c[2]}return n.sort((f,_)=>d[f.key]-d[_.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(cp(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=Vo.now())return!0}return!1}setFeatureState(e,n,s){this._state.updateState(e=e||"_geojsonTileLayer",n,s)}removeFeatureState(e,n,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,s)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,s){const c=this._tiles[e];c&&c.setDependencies(n,s)}reloadTilesForDependencies(e,n){for(const s in this._tiles)this._tiles[s].hasDependency(e,n)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){const _=()=>{this._sourceLoaded&&(this._source.off("data",_),this._preloadTiles(e,n))};return void this._source.on("data",_)}const s=new Map,c=Array.isArray(e)?e:[e],d=this.map.painter.terrain,f=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const _ of c){const x=_.coveringTiles({tileSize:f,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of x)s.set(E.key,E);this.usedForTerrain&&_.updateElevation(!1)}ti(Array.from(s.values()),(_,x)=>{const E=new d_(_,this._source.tileSize*_.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,D=>{"raster-dem"===this._source.type&&E.dem&&this._backfillDEM(E),x(D,E)})},n)}}function m_(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function cp(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function Bm(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}ah.maxOverzooming=10,ah.maxUnderzooming=3;const tx=new class extends Pi{possiblyEvaluate(t,e){return e=new rr(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,s){return e=ai({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,s)}}(ov.paint.properties["line-width"].specification);function nx(t,e){return e>0?e+2*t:t}tx.useIntegerZoom=!0;const Ww=new to({"symbol-placement":new Mn(Jt.layout_symbol["symbol-placement"]),"symbol-spacing":new Mn(Jt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mn(Jt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Pi(Jt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mn(Jt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Mn(Jt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Mn(Jt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Mn(Jt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mn(Jt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mn(Jt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Pi(Jt.layout_symbol["icon-size"]),"icon-text-fit":new Pi(Jt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pi(Jt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Pi(Jt.layout_symbol["icon-image"]),"icon-rotate":new Pi(Jt.layout_symbol["icon-rotate"]),"icon-padding":new Mn(Jt.layout_symbol["icon-padding"]),"icon-keep-upright":new Mn(Jt.layout_symbol["icon-keep-upright"]),"icon-offset":new Pi(Jt.layout_symbol["icon-offset"]),"icon-anchor":new Pi(Jt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mn(Jt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mn(Jt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mn(Jt.layout_symbol["text-rotation-alignment"]),"text-field":new Pi(Jt.layout_symbol["text-field"]),"text-font":new Pi(Jt.layout_symbol["text-font"]),"text-size":new Pi(Jt.layout_symbol["text-size"]),"text-max-width":new Pi(Jt.layout_symbol["text-max-width"]),"text-line-height":new Pi(Jt.layout_symbol["text-line-height"]),"text-letter-spacing":new Pi(Jt.layout_symbol["text-letter-spacing"]),"text-justify":new Pi(Jt.layout_symbol["text-justify"]),"text-radial-offset":new Pi(Jt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mn(Jt.layout_symbol["text-variable-anchor"]),"text-anchor":new Pi(Jt.layout_symbol["text-anchor"]),"text-max-angle":new Mn(Jt.layout_symbol["text-max-angle"]),"text-writing-mode":new Mn(Jt.layout_symbol["text-writing-mode"]),"text-rotate":new Pi(Jt.layout_symbol["text-rotate"]),"text-padding":new Mn(Jt.layout_symbol["text-padding"]),"text-keep-upright":new Mn(Jt.layout_symbol["text-keep-upright"]),"text-transform":new Pi(Jt.layout_symbol["text-transform"]),"text-offset":new Pi(Jt.layout_symbol["text-offset"]),"text-allow-overlap":new Mn(Jt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Mn(Jt.layout_symbol["text-ignore-placement"]),"text-optional":new Mn(Jt.layout_symbol["text-optional"]),visibility:new Mn(Jt.layout_symbol.visibility)});var Nv={paint:new to({"icon-opacity":new Pi(Jt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Pi(Jt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Pi(Jt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Pi(Jt.paint_symbol["text-emissive-strength"]),"icon-color":new Pi(Jt.paint_symbol["icon-color"]),"icon-halo-color":new Pi(Jt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Pi(Jt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Pi(Jt.paint_symbol["icon-halo-blur"]),"icon-translate":new Mn(Jt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mn(Jt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Pi(Jt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Pi(Jt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Pi(Jt.paint_symbol["text-occlusion-opacity"]),"text-color":new Pi(Jt.paint_symbol["text-color"],{runtimeType:Ot,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Pi(Jt.paint_symbol["text-halo-color"]),"text-halo-width":new Pi(Jt.paint_symbol["text-halo-width"]),"text-halo-blur":new Pi(Jt.paint_symbol["text-halo-blur"]),"text-translate":new Mn(Jt.paint_symbol["text-translate"]),"text-translate-anchor":new Mn(Jt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Mn(Jt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Mn(Jt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Mn(Jt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Mn(Jt.paint_symbol["icon-color-brightness-max"])}),layout:Ww};class ix{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:V,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ee(ix,"FormatSectionOverride",{omit:["defaultValue"]});class up extends ua{constructor(e,n,s,c){super(e,Nv,n,s,c),this._colorAdjustmentMatrix=a.ad.identity([]),this.hasInitialOcclusionOpacityProperties=void 0!==e.paint&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,n){super.recalculate(e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const d of s)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,s,c){return this._saturation===e&&this._contrast===n&&this._brightnessMin===s&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(d,f,_,x){d=Bl(d),f=al(f);const E=a.ad.create(),D=d/3,S=1-2*D,P=[S,D,D,0,D,S,D,0,D,D,S,0,0,0,0,1],F=.5-.5*f,z=x-_;return a.ad.multiply(E,[z,0,0,0,0,z,0,0,0,0,z,0,_,_,_,1],[f,0,0,0,0,f,0,0,0,0,f,0,F,F,F,1]),a.ad.multiply(E,E,P),E}(e,n,s,c),this._saturation=e,this._contrast=n,this._brightnessMin=s,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,s,c){const d=this.layout.get(e).evaluate(n,{},s,c),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||J(f.value)||!d?d:(_=n.properties,d.replace(/{([^{}]+)}/g,(E,D)=>D in _?String(_[D]):""));var _}createBucket(e){return new sp(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Nv.paint.overridableProperties){if(!up.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new ix(n),c=new G(s,n.property.specification,this.scope,this.options);let d=null;d="constant"===n.value.kind||"source"===n.value.kind?new le("source",c):new de("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new xo(n.property,d,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&up.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),c=Nv.paint.properties[n];let d=!1;const f=_=>{for(const x of _)if(c.overrides&&c.overrides.hasOverride(x))return void(d=!0)};if("constant"===s.value.kind&&s.value.value instanceof Yo)f(s.value.value.sections);else if("source"===s.value.kind){const _=E=>{d||(E instanceof Ja&&Jo(E.value)===vo?f(E.value.sections):E instanceof Pc?f(E.sections):E.eachChild(_))},x=s.value;x._styleExpression&&_(x._styleExpression.expression)}return d}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),n=0!==this.paint.get("text-opacity").constantOr(1),s=[];return e&&s.push("symbolIcon"),n&&s.push("symbolSDF"),s}getDefaultProgramParams(e,n,s){return{config:new Rf(this,{zoom:n,lut:s}),overrideFog:!1}}}const zm=new to({visibility:new Mn(Jt.layout_background.visibility)});var rx={paint:new to({"background-color":new Mn(Jt.paint_background["background-color"]),"background-pattern":new Mn(Jt.paint_background["background-pattern"]),"background-opacity":new Mn(Jt.paint_background["background-opacity"]),"background-emissive-strength":new Mn(Jt.paint_background["background-emissive-strength"])}),layout:zm};const ox=new to({visibility:new Mn(Jt.layout_raster.visibility)});var Xw={paint:new to({"raster-opacity":new Mn(Jt.paint_raster["raster-opacity"]),"raster-color":new zs(Jt.paint_raster["raster-color"]),"raster-color-mix":new Mn(Jt.paint_raster["raster-color-mix"]),"raster-color-range":new Mn(Jt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Mn(Jt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mn(Jt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mn(Jt.paint_raster["raster-brightness-max"]),"raster-saturation":new Mn(Jt.paint_raster["raster-saturation"]),"raster-contrast":new Mn(Jt.paint_raster["raster-contrast"]),"raster-resampling":new Mn(Jt.paint_raster["raster-resampling"]),"raster-fade-duration":new Mn(Jt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Mn(Jt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Mn(Jt.paint_raster["raster-array-band"]),"raster-elevation":new Mn(Jt.paint_raster["raster-elevation"])}),layout:ox};function lh(t,e,n,s,c,d,f,_){const x=[t,e,1,n,s,1,c,d,1],E=[f,_,1],D=a.bC.adjoint([],x),[S,P,F]=a._.transformMat3(E,E,D);return a.bC.multiply(x,x,[S,0,0,0,P,0,0,0,F])}function Um(t,e,n,s,c,d,f,_){const x=function(E,D,S,P,F,z,$,H){const ee=lh(0,0,1,0,1,1,0,1),Pe=lh(E,D,S,P,F,z,$,H),Oe=a.bC.adjoint([],ee);return a.bC.multiply(Pe,Pe,Oe)}(t,e,n,s,c,d,f,_);return[x[2]/x[8]/hi,x[5]/x[8]/hi]}function Bv(t){return[t[0],Math.min(Math.max(t[1],-bs),bs)]}class sx extends lc{constructor(e,n,s,c){super(),this.id=e,this.dispatcher=s,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new la("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=iu(this.map._requestManager.transformRequest(this.url,sc.Image),(s,c)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new wr(s)):c&&(this.image=c instanceof HTMLImageElement?Vo.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new u_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new la("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof u_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],s=e[0][1];for(const d of e)d[1]>s&&(s=d[1]),d[1]<n&&(n=d[1]);const c=(s+n)/2;if(c>bs?this.onNorthPole=!0:c<-bs&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=e.map(Da.fromLngLat);this.tileID=function(f){let _=1/0,x=1/0,E=-1/0,D=-1/0;for(const $ of f)_=Math.min(_,$.x),x=Math.min(x,$.y),E=Math.max(E,$.x),D=Math.max(D,$.y);const S=Math.max(E-_,D-x),P=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),F=Math.pow(2,P);let z=Math.floor((_+E)/2*F);return z>1&&(z-=1),new _c(P,z,Math.floor((x+D)/2*F))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new la("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const H in this.tiles){const ee=this.tiles[H];"loaded"!==ee.state&&(ee.state="loaded",ee.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=vd(new _c(0,0,0),this.map.transform.projection),s=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(H){const ee=H[1].x-H[0].x,Pe=H[1].y-H[0].y,Oe=H[2].x-H[1].x,ke=H[2].y-H[1].y,dt=H[3].x-H[2].x,st=H[3].y-H[2].y,Dt=H[0].x-H[3].x,kt=H[0].y-H[3].y,Yt=ee*ke-Oe*Pe,yn=Oe*st-dt*ke,dn=dt*kt-Dt*st,Fn=Dt*Pe-ee*kt;return Yt>0&&yn>0&&dn>0&&Fn>0||Yt<0&&yn<0&&dn<0&&Fn<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const c=vd(this.tileID,this.map.transform.projection),[d,f,_,x]=this.coordinates.map(H=>{const ee=c.projection.project(H[0],H[1]);return Iv(c,ee)._round()});this.perspectiveTransform=Um(d.x,d.y,f.x,f.y,_.x,_.y,x.x,x.y);const E=this._boundsArray=new ba;E.emplaceBack(d.x,d.y,0,0),E.emplaceBack(f.x,f.y,hi,0),E.emplaceBack(x.x,x.y,0,hi),E.emplaceBack(_.x,_.y,hi,hi),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(E,Pm.members),this.boundsSegments=rs.simpleSegment(0,0,4,2);const D=[],S=[Bv((H=this.coordinates)[0]),Bv(H[1]),Bv(H[2]),Bv(H[3])],[P,F,z,$]=function(H){let ee=H[0][0],Pe=ee,Oe=H[0][1],ke=Oe;for(let dt=1;dt<H.length;dt++)H[dt][0]<ee?ee=H[dt][0]:H[dt][0]>Pe&&(Pe=H[dt][0]),H[dt][1]<Oe?Oe=H[dt][1]:H[dt][1]>ke&&(ke=H[dt][1]);return[ee,Oe,Pe-ee,ke-Oe]}(S);var H;{const H=new ba,[ee,Pe,Oe,ke]=function(xn){let Hn=xn[0].x,ni=Hn,Zn=xn[0].y,Si=Zn;for(let Qn=1;Qn<xn.length;Qn++)xn[Qn].x<Hn?Hn=xn[Qn].x:xn[Qn].x>ni&&(ni=xn[Qn].x),xn[Qn].y<Zn?Zn=xn[Qn].y:xn[Qn].y>Si&&(Si=xn[Qn].y);return[Hn,Zn,ni-Hn,Si-Zn]}(s),dt=xn=>[(xn.x-ee)/Oe,(xn.y-Pe)/ke],[st,Dt,kt,Yt]=s.map(dt),yn=function(xn,Hn,ni,Zn,Si,Qn,ci,Qi){const $i=lh(0,0,1,0,1,1,0,1),ji=lh(xn,Hn,ni,Zn,Si,Qn,ci,Qi),ri=a.bC.adjoint([],ji);return a.bC.multiply($i,$i,ri)}(st[0],st[1],Dt[0],Dt[1],kt[0],kt[1],Yt[0],Yt[1]);this.elevatedGlobePerspectiveTransform=Um(st[0],st[1],Dt[0],Dt[1],kt[0],kt[1],Yt[0],Yt[1]);const dn=(xn,Hn)=>{D.push(xn.lng);const ni=Math.round((xn.lng-P)/z*hi),Zn=Math.round((xn.lat-F)/$*hi),Si=dt(Hn),Qn=a._.transformMat3([],[Si[0],Si[1],1],yn),ci=Math.round(Qn[0]/Qn[2]*hi),Qi=Math.round(Qn[1]/Qn[2]*hi);H.emplaceBack(ni,Zn,ci,Qi)},Fn=s[3].x-s[0].x,Yn=s[3].y-s[0].y,Sn=s[2].x-s[1].x,Wn=s[2].y-s[1].y;for(let xn=0;xn<65;xn++){const Hn=xn/64,ni=[s[0].x+Hn*Fn,s[0].y+Hn*Yn],Zn=[s[1].x+Hn*Sn,s[1].y+Hn*Wn],Si=Zn[0]-ni[0],Qn=Zn[1]-ni[1];for(let ci=0;ci<65;ci++){const Qi=ci/64,$i={x:ni[0]+Si*Qi,y:ni[1]+Qn*Qi,z:0};dn(n.projection.unproject($i.x,$i.y),$i)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(H,Pm.members)}{this.maxLongitudeTriangleSize=0;let H=[],ee=new Zs;const Pe=(Oe,ke,dt)=>{ee.emplaceBack(Oe,ke,dt);const st=D[Oe],Dt=D[ke],kt=D[dt],Yt=Math.min(Math.min(st,Dt),kt),yn=Math.max(Math.max(st,Dt),kt)-Yt;yn>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=yn),H.push(Yt+yn/2)};for(let Oe=0;Oe<64;Oe++)for(let ke=0;ke<64;ke++){const dt=65*Oe+ke,st=dt+1,Dt=dt+65,kt=Dt+1;Pe(dt,Dt,st),Pe(st,Dt,kt)}[H,ee]=function(Oe,ke){const dt=Array.from({length:Oe.length},(kt,Yt)=>Yt);dt.sort((kt,Yt)=>Oe[kt]-Oe[Yt]);const st=[],Dt=new Zs;for(let kt=0;kt<dt.length;kt++){const Yt=dt[kt];st.push(Oe[Yt]);const yn=3*Yt,dn=yn+1;Dt.emplaceBack(ke.uint16[yn],ke.uint16[dn],ke.uint16[dn+1])}return[st,Dt]}(H,ee),this.elevatedGlobeTrianglesCenterLongitudes=H,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ee)}this.elevatedGlobeSegments=rs.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,z/hi,0,$/hi,0,0,F,P,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const n=this.map.painter.context,s=n.gl;!this._dirty||this.texture instanceof u_||(this.texture?this.texture.update(this.image):(this.texture=new bc(n,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let c=(d=e+180)+360*Math.round((s[0]-d)/360);var d;const f=new rs,_=(S,P)=>{f.segments.push({vertexOffset:0,primitiveOffset:S,vertexLength:n.segments[0].vertexLength,primitiveLength:P,sortKey:void 0,vaos:{}})},x=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-c)<=x){const S=ss(s,0,s.length,c+x);return S===s.length||_(S,Fu(s,S+1,s.length,c+360-x)-S),f}c<s[0]&&(c+=360);const E=Fu(s,0,s.length,c-x);if(E===s.length)return _(0,s.length),f;_(0,E-0);const D=ss(s,E+1,s.length,c+x);return D!==s.length&&_(D,s.length-D),f}}const ax=(Math.pow(256,2)-1)/16907520;class g_ extends ua{constructor(e,n,s,c){super(e,Xw,n,s,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof sx&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[s,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(c)||s===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=em({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,c])}}const Kw=new to({visibility:new Mn(Jt["layout_raster-particle"].visibility)});var lx={paint:new to({"raster-particle-array-band":new Mn(Jt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Mn(Jt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new zs(Jt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Mn(Jt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Mn(Jt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Mn(Jt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Mn(Jt["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:Kw};class cx extends ua{constructor(e,n,s,c){super(e,lx,n,s,c),this._updateColorRamp(),this.lastInvalidatedAt=Vo.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=em({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Vo.now()}}class ux extends ua{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const dx=new to({visibility:new Mn(Jt.layout_sky.visibility)});var hx={paint:new to({"sky-type":new Mn(Jt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Mn(Jt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Mn(Jt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Mn(Jt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Mn(Jt.paint_sky["sky-gradient-radius"]),"sky-gradient":new zs(Jt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Mn(Jt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Mn(Jt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Mn(Jt.paint_sky["sky-opacity"])}),layout:dx};function jm(t,e,n){const s=[0,0,1],c=a.av.identity([]);return a.av.rotateY(c,c,n?-Zi(t)+Math.PI:Zi(t)),a.av.rotateX(c,c,-Zi(e)),a._.transformQuat(s,s,c),a._.normalize(s,s)}var Zw={paint:new to({})};function fx(t,e){const n=__(t.projection,t.zoom,t.width,t.height),s=function(d,f,_,x,E){const D=new Yr(_.lng-180*ch,_.lat),S=new Yr(_.lng+180*ch,_.lat),P=d.project(D.lng,D.lat),F=d.project(S.lng,S.lat),z=-Math.atan2(F.y-P.y,F.x-P.x),$=Da.fromLngLat(_);$.y=Ut($.y,-1+ch,1-ch);const H=$.toLngLat(),ee=d.project(H.lng,H.lat),Pe=Da.fromLngLat(H);Pe.x+=ch;const Oe=Pe.toLngLat(),ke=d.project(Oe.lng,Oe.lat),dt=y_(ke.x-ee.x,ke.y-ee.y,z),st=Da.fromLngLat(H);st.y+=ch;const Dt=st.toLngLat(),kt=d.project(Dt.lng,Dt.lat),Yt=y_(kt.x-ee.x,kt.y-ee.y,z),yn=Math.abs(dt.x)/Math.abs(Yt.y),dn=a.ad.identity([]);a.ad.rotateZ(dn,dn,-z*(1-(E?0:x)));const Fn=a.ad.identity([]);return a.ad.scale(Fn,Fn,[1,1-(1-yn)*x,1]),Fn[4]=-Yt.x/Yt.y*x,a.ad.rotateZ(Fn,Fn,z),a.ad.multiply(Fn,dn,Fn),Fn}(t.projection,0,t.center,n,e),c=px(t);return a.ad.scale(s,s,[c,c,1]),s}function px(t){const e=t.projection,n=__(t.projection,t.zoom,t.width,t.height),s=mx(e,t.center),c=mx(e,Yr.convert(e.center));return Math.pow(2,s*n+(1-n)*c)}function __(t,e,n,s,c=1/0){const d=t.range;if(!d)return 0;const f=Math.min(c,Math.max(n,s)),_=Math.log(f/1024)/Math.LN2;return ln(d[0]+_,d[1]+_,e)}const ch=1/4e4;function mx(t,e){const n=Ut(e.lat,-bs,bs),s=new Yr(e.lng-180*ch,n),c=new Yr(e.lng+180*ch,n),d=t.project(s.lng,n),f=t.project(c.lng,n),_=Da.fromLngLat(s),x=Da.fromLngLat(c),E=f.x-d.x,D=f.y-d.y,S=x.x-_.x,P=x.y-_.y,F=Math.sqrt((S*S+P*P)/(E*E+D*D));return Math.log(F)/Math.LN2}function y_(t,e,n){const s=Math.cos(n),c=Math.sin(n);return{x:t*s-e*c,y:t*c+e*s}}function gx(t,e,n){a.ad.identity(t),a.ad.rotateZ(t,t,Zi(e[2])),a.ad.rotateX(t,t,Zi(e[0])),a.ad.rotateY(t,t,Zi(e[1])),a.ad.scale(t,t,n),a.ad.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function v_(t,e,n,s,c,d,f,_){const x=[n[0]-e[0],n[1]-e[1],0],E=[s[0]-e[0],s[1]-e[1],0];if(a._.length(x)<1e-12||a._.length(E)<1e-12)return a.av.identity(t);const D=a._.cross([],x,E);a._.normalize(D,D),a._.subtract(E,s,e),x[2]=(d-c)*_,E[2]=(f-c)*_;const S=x;return a._.cross(S,x,E),a._.normalize(S,S),a.av.rotationTo(t,D,S)}function zv(t,e,n=!1){const s=cd(e.zoom),c=function(d,f,_){const x=f.worldSize,E=[d[12],d[13],d[14]],D=qs(E[1]/x),S=Ta(E[0]/x),P=a.ad.identity([]),F=Ia(1,D)*x,z=Ia(1,0)*x*Zd(D,f.zoom),$=1/Dy(x);let H=z*$;if(_){const ke=__(f.projection,f.zoom,f.width,f.height,1024);H=$*f.projection.pixelSpaceConversion(f.center.lat,x,ke)}const ee=zh(D,S);a._.add(ee,ee,a._.scale([],a._.normalize([],ee),F*H*E[2]));const Pe=function(ke){const dt=[ke[0],ke[1],ke[2]];let st=[0,1,0];const Dt=a._.cross([],st,dt);return a._.cross(st,dt,Dt),0===a._.squaredLength(st)&&(st=[0,1,0],a._.cross(Dt,dt,st)),a._.normalize(Dt,Dt),a._.normalize(st,st),a._.normalize(dt,dt),[Dt[0],Dt[1],Dt[2],0,st[0],st[1],st[2],0,dt[0],dt[1],dt[2],0,ke[0],ke[1],ke[2],1]}(ee);a.ad.scale(P,P,[H,H,H*F]),a.ad.translate(P,P,[-E[0],-E[1],-E[2]]);const Oe=a.ad.multiply([],f.globeMatrix,Pe);return a.ad.multiply(Oe,Oe,P),a.ad.multiply(Oe,Oe,d),Oe}(t,e,n);return s>0?function(f,_,x){const E=(z,$,H)=>{const ee=a._.length(z),Pe=a._.length($),Oe=qd(z,$,H);return a._.scale(Oe,Oe,1/a._.length(Oe)*zi(ee,Pe,H))},D=E([f[0],f[1],f[2]],[_[0],_[1],_[2]],x),S=E([f[4],f[5],f[6]],[_[4],_[5],_[6]],x),P=E([f[8],f[9],f[10]],[_[8],_[9],_[10]],x),F=qd([f[12],f[13],f[14]],[_[12],_[13],_[14]],x);return[D[0],D[1],D[2],0,S[0],S[1],S[2],0,P[0],P[1],P[2],0,F[0],F[1],F[2],1]}(c,function(f,_){const x=_.worldSize,E=Ia(1,0)*x*Zd(_.center.lat,_.zoom)/Dy(x),D=Ia(1,_.center.lat)*x,S=a.ad.identity([]);return a.ad.rotateY(S,S,Zi(_.center.lng)),a.ad.rotateX(S,S,Zi(_.center.lat)),a.ad.translate(S,S,[0,0,Ca]),a.ad.scale(S,S,[E,E,E*D]),a.ad.translate(S,S,[_.point.x-.5*x,_.point.y-.5*x,0]),a.ad.multiply(S,S,f),a.ad.multiply(S,_.globeMatrix,S)}(t,e),s):c}function uh(t,e,n,s){const c=es.projectAabbCorners(s,n);let d=Number.MAX_VALUE,f=-1;for(let E=0;E<c.length;++E){const D=c[E];D[0]=(.5*D[0]+.5)*e.width,D[1]=(.5-.5*D[1])*e.height,D[2]<d&&(f=E,d=D[2])}const _=E=>new Ae(c[E][0],c[E][1]);let x;switch(f){case 0:case 6:x=[_(1),_(5),_(4),_(7),_(3),_(2),_(1)];break;case 1:case 7:x=[_(0),_(4),_(5),_(6),_(2),_(3),_(0)];break;case 3:case 5:x=[_(1),_(0),_(4),_(7),_(6),_(2),_(1)];break;default:x=[_(1),_(5),_(6),_(7),_(3),_(0),_(1)]}if(wg(t,x))return d}const Vm=oo([{name:"a_pos_3f",components:3,type:"Float32"}]),Uv=oo([{name:"a_color_3f",components:3,type:"Float32"}]),jv=oo([{name:"a_color_4f",components:4,type:"Float32"}]),qw=oo([{name:"a_uv_2f",components:2,type:"Float32"}]),dp=oo([{name:"a_normal_3f",components:3,type:"Float32"}]),_x=oo([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Yw=oo([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class x_{constructor(e,n,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),null!=n&&n.__line__&&(this.line=n.__line__)}}function yx(t,e){const n=-1===t.indexOf("://");try{return new URL(t,n&&e?"http://example.com":void 0),!0}catch{return!1}}class vx{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class xx{constructor(){this.instancedDataArray=new cg,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class b_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,s,c){this.tileToMeter=Wp(s);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:_,index:x,sourceLayerIndex:E}of e){const D=_??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),S=Eu(f,d);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),S,s))continue;const P={id:D,sourceLayerIndex:E,index:x,geometry:d?S.geometry:wu(f,s,c),properties:f.properties,type:f.type,patterns:{}},F=this.addFeature(P,P.geometry,S);F&&n.featureIndex.insert(f,P.geometry,x,E,this.index,this.instancesPerModel[F].instancedDataArray.length,hi/32)}this.lookup=null}update(e,n,s,c){for(const d in this.instancesPerModel){const f=this.instancesPerModel[d];for(const _ in e)f.idToFeaturesIndex.hasOwnProperty(_)&&(this.evaluate(f.features[f.idToFeaturesIndex[_]],e[_],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const s=this.instancesPerModel[n];for(const c of s.features){const d=this.layers[0],f=c.feature,_=this.canonical,x=d.paint.get("model-rotation").evaluate(f,{},_),E=d.paint.get("model-scale").evaluate(f,{},_),D=d.paint.get("model-translation").evaluate(f,{},_);a._.exactEquals(c.rotation,x)&&a._.exactEquals(c.scale,E)&&a._.exactEquals(c.translation,D)||(this.evaluate(c,c.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,n,s){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const c=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(zg(this.activeReplacements,c))return!1;this.activeReplacements=c;let d=!1;for(const f in this.instancesPerModel){const _=this.instancesPerModel[f],x=_.instancedDataArray;for(const E of _.features){const D=E.instancedDataOffset,S=E.instancedDataCount;for(let P=0;P<S;P++){const F=16*(P+D);let z=x.float32[F+0];z=z>hi?z-hi:z;const $=Math.floor(z),H=x.float32[F+1];let ee=!1;for(const Pe of this.activeReplacements)if(!(Pe.order<s||Pe.order===1/0)&&Pe.clipMask&h1.Model&&!(Pe.min.x>$||$>Pe.max.x||Pe.min.y>H||H>Pe.max.y)&&(ee=a1(s1($,H,e.canonical,Pe.footprintTileId.canonical),Pe),ee))break;x.float32[F]=ee?z+hi:z,d=d||ee}}}return d}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const s=this.instancesPerModel[n];s.instancedDataArray.length<0||0===s.instancedDataArray.length||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,_x.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const n in this.instancesPerModel){const s=this.instancesPerModel[n];0!==s.instancedDataArray.length&&s.instancedDataBuffer&&s.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,s){const c=this.layers[0],d=c.layout.get("model-id").evaluate(s,{},this.canonical);if(!d)return Do(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),d;yx(d,!1)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new xx);const f=this.instancesPerModel[d],_=f.instancedDataArray,x=new vx(s,_.length);for(const E of n)for(const D of E){if(D.x<0||D.x>=hi||D.y<0||D.y>=hi)continue;const S=(this.lookupDim-1)/hi,P=this.lookupDim*(D.y*S|0)+D.x*S|0;if(this.lookup){if(0!==this.lookup[P])continue;this.lookup[P]=1}this.instanceCount++;const F=_.length;_.resize(F+1),f.instancesEvaluatedElevation.push(0),_.float32[16*F]=D.x,_.float32[16*F+1]=D.y}return x.instancedDataCount=f.instancedDataArray.length-x.instancedDataOffset,x.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(x),this.evaluate(x,{},f,!1)),d}getModelUris(){return this.modelUris}evaluate(e,n,s,c){const d=this.layers[0],f=e.feature,_=this.canonical,x=e.rotation=d.paint.get("model-rotation").evaluate(f,n,_),E=e.scale=d.paint.get("model-scale").evaluate(f,n,_),D=e.translation=d.paint.get("model-translation").evaluate(f,n,_),S=d.paint.get("model-color").evaluate(f,n,_);S.a=d.paint.get("model-color-mix-intensity").evaluate(f,n,_);const P=[];this.maxVerticalOffset<D[2]&&(this.maxVerticalOffset=D[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),gx(P,x,E);const F=Math.round(100*S.a)+S.b/1.05;for(let z=0;z<e.instancedDataCount;++z){const $=e.instancedDataOffset+z,H=16*$,ee=s.instancedDataArray.float32;let Pe=0;c&&(Pe=ee[H+6]-s.instancesEvaluatedElevation[$]);const Oe=0|ee[H+1];ee[H]=(0|ee[H])+S.r/1.05,ee[H+1]=Oe+S.g/1.05,ee[H+2]=F,ee[H+3]=1/(_.z>10?this.tileToMeter:Wp(_,Oe)),ee[H+4]=D[0],ee[H+5]=D[1],ee[H+6]=D[2]+Pe,ee[H+7]=P[0],ee[H+8]=P[1],ee[H+9]=P[2],ee[H+10]=P[4],ee[H+11]=P[5],ee[H+12]=P[6],ee[H+13]=P[8],ee[H+14]=P[9],ee[H+15]=P[10],s.instancesEvaluatedElevation[$]=D[2]}}}Ee(b_,"ModelBucket",{omit:["layers"]}),Ee(xx,"PerModelAttributes"),Ee(vx,"ModelFeature");const Jw=new to({visibility:new Mn(Jt.layout_model.visibility),"model-id":new Pi(Jt.layout_model["model-id"])});var bx={paint:new to({"model-opacity":new Mn(Jt.paint_model["model-opacity"]),"model-rotation":new Pi(Jt.paint_model["model-rotation"]),"model-scale":new Pi(Jt.paint_model["model-scale"]),"model-translation":new Pi(Jt.paint_model["model-translation"]),"model-color":new Pi(Jt.paint_model["model-color"]),"model-color-mix-intensity":new Pi(Jt.paint_model["model-color-mix-intensity"]),"model-type":new Mn(Jt.paint_model["model-type"]),"model-cast-shadows":new Mn(Jt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Mn(Jt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Mn(Jt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Pi(Jt.paint_model["model-emissive-strength"]),"model-roughness":new Pi(Jt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Pi(Jt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Mn(Jt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Mn(Jt.paint_model["model-front-cutoff"])}),layout:Jw};const hp={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function wx(t,e,n,s,c,d,f,_,x,E=!1){const D=n.zoom,S=n.project(s),P=Zd(s.lat,D),F=1/P;a.ad.identity(t),a.ad.translate(t,t,[S.x+f[0]*F,S.y+f[1]*F,f[2]]);let z=1,$=1;const H=n.worldSize;if(E){if("mercator"===n.projection.name){let ke=0;n.elevation&&(ke=n.elevation.getAtPointOrZero(new Da(S.x/H,S.y/H),0));const dt=a.aA.transformMat4([],[S.x,S.y,ke,1],n.projMatrix)[3]/n.cameraToCenterDistance;z=dt,$=dt*Zd(n.center.lat,D)}else if("globe"===n.projection.name){const ke=zv(t,n),dt=a.ad.multiply([],n.projMatrix,ke),st=[0,0,0,1];a.aA.transformMat4(st,st,dt);const Dt=st[3]/n.cameraToCenterDistance,kt=cd(D),Yt=n.projection.pixelsPerMeter(s.lat,H)*Zd(s.lat,D),yn=n.projection.pixelsPerMeter(n.center.lat,H)*Zd(n.center.lat,D);z=Dt/zi(Yt,L0(n.center.lat),kt),$=Dt*P/Yt,z*=yn,$*=yn}}else z=F;a.ad.scale(t,t,[z,z,$]);const ee=[...t],Pe=e.orientation,Oe=[];if(gx(Oe,[Pe[0]+c[0],Pe[1]+c[1],Pe[2]+c[2]],d),a.ad.multiply(t,ee,Oe),_&&n.elevation){let ke=0;const dt=[];if(x&&n.elevation){ke=function(kt,Yt,yn,dn,Fn){const Yn=Yt.elevation;if(!Yn)return 0;const Sn=es.projectAabbCorners(yn,dn),Wn=Ia(1,Fn.lat)*Yt.worldSize,xn=function(tr,Dr){const or=[0,0,1],Mr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Er of Mr){const Or=tr[Er.corners[0]],ir=tr[Er.corners[1]],Mo=tr[Er.corners[2]],Co=[ir[0]-Or[0],ir[1]-Or[1],Dr*(ir[2]-Or[2])],Qr=a._.cross(Co,Co,[Mo[0]-Or[0],Mo[1]-Or[1],Dr*(Mo[2]-Or[2])]);a._.normalize(Qr,Qr),Er.dotProductWithUp=a._.dot(Qr,or)}return Mr.sort((Er,Or)=>Er.dotProductWithUp-Or.dotProductWithUp),Mr[0].corners}(Sn,Wn),Hn=Sn[xn[0]],ni=Sn[xn[1]],Zn=Sn[xn[2]],Si=Sn[xn[3]],Qn=Yn.getAtPointOrZero(new Da(Hn[0]/Yt.worldSize,Hn[1]/Yt.worldSize),0),ci=Yn.getAtPointOrZero(new Da(ni[0]/Yt.worldSize,ni[1]/Yt.worldSize),0),Qi=Yn.getAtPointOrZero(new Da(Zn[0]/Yt.worldSize,Zn[1]/Yt.worldSize),0),$i=Yn.getAtPointOrZero(new Da(Si[0]/Yt.worldSize,Si[1]/Yt.worldSize),0),ji=(Qn+$i)/2,ri=(ci+Qi)/2;return ji>ri?ci<Qi?v_(kt,ni,Si,Hn,ci,$i,Qn,Wn):v_(kt,Zn,Hn,Si,Qi,Qn,$i,Wn):Qn<$i?v_(kt,Hn,ni,Zn,Qn,ci,Qi,Wn):v_(kt,Si,Zn,ni,$i,Qi,ci,Wn),Math.max(ji,ri)}(dt,n,e.aabb,t,s);const st=a.ad.fromQuat([],dt),Dt=a.ad.multiply([],st,Oe);a.ad.multiply(t,ee,Dt)}else ke=n.elevation.getAtPointOrZero(new Da(S.x/H,S.y/H),0);0!==ke&&(t[14]+=ke)}}function fp(t,e,n=!1){t.uploaded||(t.gfxTexture=new bc(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function Qw(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,Vm.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,dp.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,qw.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(12===t.colorArray.bytesPerElement?Uv:jv).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,Yw.members,!0)),t.segments=rs.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const s=t.material;s.pbrMetallicRoughness.baseColorTexture&&fp(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&fp(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&fp(s.normalTexture,e),s.occlusionTexture&&fp(s.occlusionTexture,e,n),s.emissionTexture&&fp(s.emissionTexture,e)}function Vv(t,e,n){if(t.meshes)for(const s of t.meshes)Qw(s,e,n);if(t.children)for(const s of t.children)Vv(s,e,n)}function Au(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)Au(e)}function dh(t){if(t.meshes)for(const n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const n of t.children)dh(n)}class $m{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class mT{constructor(){this.tasks={},this.taskQueue=[],Fo(["process"],this),this.invoker=new $m(this.process),this.nextId=0}add(e,n){const s=this.nextId++,c=function({type:d,isSymbolTile:f,zoom:_}){return _=_||0,"message"===d?0:"maybePrepare"!==d||f?"parseTile"!==d||f?"parseTile"===d&&f?300-_:"maybePrepare"===d&&f?400-_:500:200-_:100-_}(n);if(0===c){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:n,priority:c,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){const d=this.tasks[this.taskQueue[c]];d.priority<n&&(n=d.priority,e=c)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class $v{constructor(e,n,s){this.target=e,this.parent=n,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Fo(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new mT}send(e,n,s,c,d=!1,f){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=f,this.callbacks[_]=s);const x=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!s,targetMapId:c,mustQueue:d,sourceMapId:this.mapId,data:sn(n,x)},x),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){const n=e.data,s=n.id;if(s&&(!n.targetMapId||this.mapId===n.targetMapId))if("<cancel>"===n.type){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(n.mustQueue||Fs()){const c=this.callbacks[s],d=this.scheduler.add(()=>this.processTask(s,n),c&&c.metadata||{type:"message"});d&&(this.cancelCallbacks[s]=d)}else this.processTask(s,n)}processTask(e,n){if(delete this.cancelCallbacks[e],"<response>"===n.type){const s=this.callbacks[e];delete this.callbacks[e],s&&(n.error?s(zt(n.error)):s(null,zt(n.data)))}else{const s=new Set,c=n.hasCallback?(f,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?sn(f):null,data:sn(_,s)},s)}:f=>{},d=zt(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,d,c);else if(this.parent.getWorkerSource){const f=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,f[0],d.source,d.scope)[f[1]](d,c)}else c(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let Gv=(()=>{class t{constructor(n,s){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Vi();const c=this.workerPool.acquire(this.id);for(let d=0;d<c.length;d++){const f=new t.Actor(c[d],s,this.id);f.name=`Worker ${d}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,s,c){ti(this.actors,(d,f)=>{d.send(n,s,f)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=$v,t})();var pp={workerUrl:"",workerClass:null,workerParams:void 0};function eE(){return null!=pp.workerClass?new pp.workerClass:new self.Worker(pp.workerUrl,pp.workerParams)}const w_="mapboxgl_preloaded_worker_pool";class E_{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<E_.workerCount;)this.workers.push(new eE);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[w_]}numActive(){return Object.keys(this.active).length}}let Gm;function af(){return Gm||(Gm=new E_),Gm}E_.workerCount=2;let mp,Hv,Qc,gp,Ex,lf=null;function rl(){return Fs()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Hv||T.DRACO_URL}function Wv(){if(Fs()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(gp)return gp;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return gp=WebAssembly.validate(t)?T.MESHOPT_SIMD_URL:T.MESHOPT_URL,gp}const Hm={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Cx={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},C_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function ws(t,e,n){const s=n.json.bufferViews.length,c=n.buffers.length;e.bufferView=s,n.json.bufferViews[s]={buffer:c,byteLength:t.byteLength},n.buffers[c]=t}const Xv="KHR_draco_mesh_compression";function Kv(t,e){const n=t.extensions&&t.extensions[Xv];if(!n)return;const s=new Qc.Decoder,c=Ix(e,n.bufferView),d=new Qc.Mesh;if(!s.DecodeArrayToMesh(c,c.byteLength,d))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[t.indices],_=Hm[f.componentType],x=f.count*_.BYTES_PER_ELEMENT,E=Qc._malloc(x);_===Uint16Array?s.GetTrianglesUInt16Array(d,x,E):s.GetTrianglesUInt32Array(d,x,E),ws(Qc.memory.buffer.slice(E,E+x),f,e),Qc._free(E);for(const D of Object.keys(n.attributes)){const S=s.GetAttributeByUniqueId(d,n.attributes[D]),P=e.json.accessors[t.attributes[D]],F=Cx[P.componentType],z=P.count*C_[P.type]*Hm[P.componentType].BYTES_PER_ELEMENT,$=Qc._malloc(z);s.GetAttributeDataArrayForAllPoints(d,S,Qc[F],z,$),ws(Qc.memory.buffer.slice($,$+z),P,e),Qc._free($)}s.destroy(),d.destroy(),delete t.extensions[Xv]}const I_="EXT_meshopt_compression";function tE(t,e){if(!t.extensions||!t.extensions[I_])return;const n=t.extensions[I_],s=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),c=new Uint8Array(n.count*n.byteStride);Ex.decodeGltfBuffer(c,n.count,n.byteStride,s,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=c.buffer,delete t.extensions[I_]}const T_=1179937895,Zv=new TextDecoder("utf8");function qv(t,e){return new URL(t,e).href}function Yv(t,e,n,s){return fetch(qv(t.uri,s)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[n]=c})}function Ix(t,e){const n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function nE(t,e,n,s){if(t.uri){const c=qv(t.uri,s);return fetch(c).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[n]=d})}if(void 0!==t.bufferView){const c=Ix(e,t.bufferView),d=new Blob([c],{type:t.mimeType});return createImageBitmap(d).then(f=>{e.images[n]=f})}}function Jv(t,e=0,n){const s={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===T_){const D=new Uint32Array(t,e);let S=2;const P=(D[S++]>>2)-3,F=D[S++]>>2;if(S++,s.json=JSON.parse(Zv.decode(D.subarray(S,S+F))),S+=F,S<P){const z=D[S++];S++;const $=e+(S<<2);s.buffers[0]=t.slice($,$+z)}}else s.json=JSON.parse(Zv.decode(new Uint8Array(t,e)));const{buffers:c,images:d,meshes:f,extensionsUsed:_,bufferViews:x}=s.json;let E=Promise.resolve();if(c){const D=[];for(let S=0;S<c.length;S++){const P=c[S];P.uri?D.push(Yv(P,s,S,n)):s.buffers[S]||(s.buffers[S]=null)}E=Promise.all(D)}return E.then(()=>{const D=[],S=_&&_.includes(Xv),P=_&&_.includes(I_);if(S&&D.push(function(){if(!Qc)return mp||(mp=function(F){let z,$=null;function H(){z=new Uint8Array($.buffer)}function ee(){throw new Error("Unexpected Draco error.")}const Pe={a:{a:ee,d:function(Oe,ke,dt){return z.copyWithin(Oe,ke,ke+dt)},c:function(Oe){const ke=z.length,dt=Math.max(Oe>>>0,Math.ceil(1.2*ke)),st=Math.ceil((dt-ke)/65536);try{return $.grow(st),H(),!0}catch{return!1}},b:ee}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(F,Pe):F.then(Oe=>Oe.arrayBuffer()).then(Oe=>WebAssembly.instantiate(Oe,Pe))).then(Oe=>{const{Rb:ke,Qb:dt,P:st,T:Dt,X:kt,Ja:Yt,La:yn,Qa:dn,Va:Fn,Wa:Yn,eb:Sn,jb:Wn,f:xn,e:Hn,yb:ni,zb:Zn,Ab:Si,Bb:Qn,Db:ci,Gb:Qi}=Oe.instance.exports;$=Hn;const $i=(()=>{let ji=0,ri=0,tr=0,Dr=0;return or=>{tr&&(ke(Dr),ke(ji),ri+=tr,tr=ji=0),ji||(ri+=128,ji=dt(ri));const Mr=or.length+7&-8;let Er=ji;Mr>=ri&&(tr=Mr,Er=Dr=dt(Mr));for(let Or=0;Or<or.length;Or++)z[Er+Or]=or[Or];return Er}})();return H(),xn(),{memory:Hn,_free:ke,_malloc:dt,Mesh:class{constructor(){this.ptr=st()}destroy(){Dt(this.ptr)}},Decoder:class{constructor(){this.ptr=Yt()}destroy(){Wn(this.ptr)}DecodeArrayToMesh(ji,ri,tr){const Dr=$i(ji),or=yn(this.ptr,Dr,ri,tr.ptr);return!!kt(or)}GetAttributeByUniqueId(ji,ri){return{ptr:dn(this.ptr,ji.ptr,ri)}}GetTrianglesUInt16Array(ji,ri,tr){Fn(this.ptr,ji.ptr,ri,tr)}GetTrianglesUInt32Array(ji,ri,tr){Yn(this.ptr,ji.ptr,ri,tr)}GetAttributeDataArrayForAllPoints(ji,ri,tr,Dr,or){Sn(this.ptr,ji.ptr,ri.ptr,tr,Dr,or)}},DT_INT8:ni(),DT_UINT8:Zn(),DT_INT16:Si(),DT_UINT16:Qn(),DT_UINT32:ci(),DT_FLOAT32:Qi()}})}(fetch(rl())),mp.then(F=>{Qc=F,mp=void 0}))}()),P&&D.push(function(){if(Ex)return;const F=function(z){let $;const H=WebAssembly.instantiateStreaming(z,{}).then(Oe=>{$=Oe.instance,$.exports.__wasm_call_ctors()}),ee={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Pe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:H,supported:!0,decodeGltfBuffer(Oe,ke,dt,st,Dt,kt){!function(Yt,yn,dn,Fn,Yn,Sn,Wn){const xn=Yt.exports.sbrk,Hn=Fn+3&-4,ni=xn(Hn*Yn),Zn=xn(Sn.length),Si=new Uint8Array(Yt.exports.memory.buffer);Si.set(Sn,Zn);const Qn=yn(ni,Fn,Yn,Zn,Sn.length);if(0===Qn&&Wn&&Wn(ni,Hn,Yn),dn.set(Si.subarray(ni,ni+Fn*Yn)),xn(ni-xn(0)),0!==Qn)throw new Error(`Malformed buffer data: ${Qn}`)}($,$.exports[Pe[Dt]],Oe,ke,dt,st,$.exports[ee[kt]])}}}(fetch(Wv()));return F.ready.then(()=>{Ex=F})}()),d)for(let F=0;F<d.length;F++)D.push(nE(d[F],s,F,n));return(D.length?Promise.all(D):Promise.resolve()).then(()=>{if(S&&f)for(const{primitives:F}of f)for(const z of F)Kv(z,s);if(P&&f&&x)for(const F of x)tE(F,s);return s})})}function cf(t,e){const n=t.json.bufferViews[e.bufferView],s=Hm[e.componentType];return new s(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==C_[e.type]*s.BYTES_PER_ELEMENT?n.byteStride/s.BYTES_PER_ELEMENT:C_[e.type]))}function ja(t,e,n,s){const c=Hm[e.componentType],d=function(D){switch(D){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),f=t.json.bufferViews[e.bufferView],_=f.byteStride?f.byteStride/c.BYTES_PER_ELEMENT:C_[e.type],x=n.float32,E=x.length/n.capacity;for(let D=0,S=0;D<e.count*_;D+=_,S+=E)for(let P=0;P<E;P++)x[S+P]=s[D+P]*d;n._trim()}function Tx(t,e,n){const s=t.indices,c=t.attributes,d={};d.indexArray=new Zs;const f=e.json.accessors[s],_=f.count/3;d.indexArray.reserve(_);const x=cf(e,f);for(let P=0;P<_;P++)d.indexArray.emplaceBack(x[3*P],x[3*P+1],x[3*P+2]);d.indexArray._trim(),d.vertexArray=new Rh;const E=e.json.accessors[c.POSITION];d.vertexArray.reserve(E.count);const D=cf(e,E);for(let P=0;P<E.count;P++)d.vertexArray.emplaceBack(D[3*P],D[3*P+1],D[3*P+2]);if(d.vertexArray._trim(),d.aabb=new es(E.min,E.max),d.centroid=function(P,F){const z=[0,0,0],$=P.length;if($>0){for(let H=0;H<$;H++){const ee=3*P[H];z[0]+=F[ee],z[1]+=F[ee+1],z[2]+=F[ee+2]}z[0]/=$,z[1]/=$,z[2]/=$}return z}(x,D),void 0!==c.COLOR_0){const P=e.json.accessors[c.COLOR_0],F=C_[P.type],z=cf(e,P);d.colorArray=3===F?new Rh:new td,d.colorArray.resize(P.count),ja(e,P,d.colorArray,z)}if(void 0!==c.NORMAL){d.normalArray=new Rh;const P=e.json.accessors[c.NORMAL];d.normalArray.resize(P.count);const F=cf(e,P);ja(e,P,d.normalArray,F)}if(void 0!==c.TEXCOORD_0&&n.length>0){d.texcoordArray=new Pf;const P=e.json.accessors[c.TEXCOORD_0];d.texcoordArray.resize(P.count);const F=cf(e,P);ja(e,P,d.texcoordArray,F)}if(void 0!==c._FEATURE_ID_RGBA4444){const P=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=cf(e,P))}void 0!==c._FEATURE_RGBA4444&&(d.featureData=new Uint32Array(cf(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));const S=t.material;return d.material=function(P,F){const{emissiveFactor:z=[0,0,0],alphaMode:$="OPAQUE",alphaCutoff:H=.5,normalTexture:ee,occlusionTexture:Pe,emissiveTexture:Oe,doubleSided:ke}=P,{baseColorFactor:dt=[1,1,1,1],metallicFactor:st=1,roughnessFactor:Dt=1,baseColorTexture:kt,metallicRoughnessTexture:Yt}=P.pbrMetallicRoughness||{},yn=Pe?F[Pe.index]:void 0;if(Pe&&Pe.extensions&&Pe.extensions.KHR_texture_transform&&yn){const dn=Pe.extensions.KHR_texture_transform;yn.offsetScale=[dn.offset[0],dn.offset[1],dn.scale[0],dn.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Br(...dt),metallicFactor:st,roughnessFactor:Dt,baseColorTexture:kt?F[kt.index]:void 0,metallicRoughnessTexture:Yt?F[Yt.index]:void 0},doubleSided:ke,emissiveFactor:z,alphaMode:$,alphaCutoff:H,normalTexture:ee?F[ee.index]:void 0,occlusionTexture:yn,emissionTexture:Oe?F[Oe.index]:void 0,defined:void 0===P.defined}}(void 0!==S?e.json.materials[S]:{defined:!1},n),d}function D_(t,e,n){const{matrix:s,rotation:c,translation:d,scale:f,mesh:_,extras:x,children:E}=t,D={};if(D.matrix=s||a.ad.fromRotationTranslationScale([],c||[0,0,0,1],d||[0,0,0],f||[1,1,1]),void 0!==_){D.meshes=n[_];const S=D.anchor=[0,0];for(const P of D.meshes){const{min:F,max:z}=P.aabb;S[0]+=F[0]+z[0],S[1]+=F[1]+z[1]}S[0]=Math.floor(S[0]/D.meshes.length/2),S[1]=Math.floor(S[1]/D.meshes.length/2)}if(x&&(x.id&&(D.id=x.id),x.lights&&(D.lights=function(S){if(!S.length)return[];const P=function(ee){const Pe=atob(ee),Oe=new Uint8Array(Pe.length);for(let ke=0;ke<Pe.length;ke++)Oe[ke]=Pe.codePointAt(ke);return Oe}(S),F=[],z=P.length/24,$=new Uint16Array(P.buffer),H=new Float32Array(P.buffer);for(let ee=0;ee<z;ee++){const Pe=$[2*ee*6]/30,Oe=$[2*ee*6+1]/30,ke=$[2*ee*6+10]/100,dt=H[6*ee+1],st=H[6*ee+2],Dt=H[6*ee+3],kt=H[6*ee+4],Yt=Dt-dt,yn=kt-st,dn=Math.hypot(Yt,yn);F.push({pos:[dt+.5*Yt,st+.5*yn,Oe],normal:[yn/dn,-Yt/dn,0],width:dn,height:Pe,depth:ke,points:[dt,st,Dt,kt]})}return F}(x.lights))),E){const S=[];for(const P of E)S.push(D_(e.json.nodes[P],e,n));D.children=S}return D}function iE(t){if(0===t.vertices.length||0===t.indices.length)return null;const e=new Uy(t.vertices,t.indices,8,256),[n,s]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:n,max:s}}function Dx(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||0===e.length)return null;const n=e[0];if(!n||!Array.isArray(n)||0===n.length)return null;const s=[];for(const f of n){if(!Array.isArray(f)||2!==f.length)continue;const _=f[0],x=f[1];"number"==typeof _&&"number"==typeof x&&s.push(new Ae(_,x))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let c=0;for(let f=0;f<s.length;f++){const _=s[f],x=s[(f+1)%s.length],E=s[(f+2)%s.length];c+=(_.x-x.x)*(E.y-x.y)-(E.x-x.x)*(_.y-x.y)}c>0&&s.reverse();const d=$h(s.flatMap(f=>[f.x,f.y]),[]);return 0===d.length?null:{vertices:s,indices:d}}function rE(t,e){const n=[],s=[];let c=0;const d=[];for(const f of t){c=n.length;const _=f.vertexArray.float32,x=f.indexArray.uint16;for(let E=0;E<f.vertexArray.length;E++)d[0]=_[3*E+0],d[1]=_[3*E+1],d[2]=_[3*E+2],a._.transformMat4(d,d,e),n.push(new Ae(d[0],d[1]));for(let E=0;E<3*f.indexArray.length;E++)s.push(x[E]+c)}if(s.length%3!=0)return null;for(let f=0;f<s.length;f+=3){const _=n[s[f+0]],x=n[s[f+1]],E=n[s[f+2]];(_.x-x.x)*(E.y-x.y)-(E.x-x.x)*(_.y-x.y)>0&&([s[f+1],s[f+2]]=[s[f+2],s[f+1]])}return{vertices:n,indices:s}}function Qv(t){const n=function(x,E){const D=[];for(const S of x.json.meshes){const P=[];for(const F of S.primitives)P.push(Tx(F,x,E));D.push(P)}return D}(t,function(x,E){const D=[],S=WebGL2RenderingContext;if(x.json.textures)for(const P of x.json.textures){const F={magFilter:S.LINEAR,minFilter:S.NEAREST,wrapS:S.REPEAT,wrapT:S.REPEAT};void 0!==P.sampler&&Object.assign(F,x.json.samplers[P.sampler]),D.push({image:E[P.source],sampler:F,uploaded:!1})}return D}(t,t.images)),{scenes:s,scene:c,nodes:d}=t.json,f=s?s[c||0].nodes:d,_=[];for(const x of f)_.push(D_(d[x],t,n));return function(x,E,D){const S={},P=new Set;for(let F=0;F<x.length;F++){const z=D[E[F]];if(!z.extras)continue;const $=z.extras["mapbox:footprint:version"],H=z.extras["mapbox:footprint:id"];($||H)&&P.add(F),"1.0.0"===$&&H&&(S[H]=F)}for(let F=0;F<x.length;F++){if(P.has(F))continue;const z=x[F],$=D[E[F]];if(!$.extras)continue;let H=null;z.id in S&&(H=rE(x[S[z.id]].meshes,z.matrix)),H||(H=Dx($)),H&&(z.footprint=iE(H))}if(P.size>0){const F=Array.from(P.values()).sort((z,$)=>z-$);for(let z=F.length-1;z>=0;z--)x.splice(F[z],1)}}(_,f,t.json.nodes),_}function oE(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,n=t.aabb.min[0]-1,s=t.aabb.min[1]-1,c=64/(t.aabb.max[0]-n+2),d=64/(t.aabb.max[1]-s+2);for(let f=0;f<e.length;f+=3){const _=e[f+2],x=(e[f+0]-n)*c|0,E=(e[f+1]-s)*d|0;_>t.heightmap[64*E+x]&&(t.heightmap[64*E+x]=_)}}function sE(t,e){const n={};n.indexArray=new Zs,n.indexArray.reserve(4*t.length),n.vertexArray=new Rh,n.vertexArray.reserve(10*t.length),n.colorArray=new td,n.vertexArray.reserve(10*t.length);let s=0;for(const f of t){const _=Math.min(10,Math.max(4,1.3*f.height))*e,x=[-f.normal[1],f.normal[0],0],E=Math.min(.29,.1*f.width/f.depth),D=f.width-2*f.depth*e*(E+.01),S=a._.scaleAndAdd([],f.pos,x,D/2),P=a._.scaleAndAdd([],f.pos,x,-D/2),F=[S[0],S[1],S[2]+f.height],z=[P[0],P[1],P[2]+f.height],$=a._.scaleAndAdd([],f.normal,x,E);a._.scale($,$,_);const H=a._.scaleAndAdd([],f.normal,x,-E);a._.scale(H,H,_),a._.add($,S,$),a._.add(H,P,H),S[2]+=.1,P[2]+=.1,n.vertexArray.emplaceBack($[0],$[1],$[2]),n.vertexArray.emplaceBack(H[0],H[1],H[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(P[0],P[1],P[2]),n.vertexArray.emplaceBack(F[0],F[1],F[2]),n.vertexArray.emplaceBack(z[0],z[1],z[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(P[0],P[1],P[2]),n.vertexArray.emplaceBack($[0],$[1],$[2]),n.vertexArray.emplaceBack(H[0],H[1],H[2]);const ee=D/_/2;n.colorArray.emplaceBack(-ee-E,-1,ee,.8),n.colorArray.emplaceBack(ee+E,-1,ee,.8),n.colorArray.emplaceBack(-ee,0,ee,1.3),n.colorArray.emplaceBack(ee,0,ee,1.3),n.colorArray.emplaceBack(ee+E,-.8,ee,.7),n.colorArray.emplaceBack(ee+E,-.8,ee,.7),n.colorArray.emplaceBack(0,0,ee,1.3),n.colorArray.emplaceBack(0,0,ee,1.3),n.colorArray.emplaceBack(ee+E,-1.2,ee,.8),n.colorArray.emplaceBack(ee+E,-1.2,ee,.8),n.indexArray.emplaceBack(6+s,4+s,8+s),n.indexArray.emplaceBack(7+s,9+s,5+s),n.indexArray.emplaceBack(0+s,1+s,2+s),n.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const c={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=Br.white,c.pbrMetallicRoughness=d,n.material=c,n.aabb=new es([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}const _p=new Float32Array(262144),Ed=new Uint8Array(262144);function Cd(t){let e=0;if(t.meshes)for(const n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(const n of t.children)e=Math.max(e,Cd(n));return e}function Wm(t,e,n){if(t.meshes)for(const s of t.meshes)s.aabb.min[0]!==1/0&&n.insert(e,s.aabb.min[0],s.aabb.min[1],s.aabb.max[0],s.aabb.max[1]);if(t.children)for(const s of t.children)Wm(s,e,n)}const e0=["","wall","door","roof","window","lamp","logo"];class yp{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Cd(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new es([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const n=new es([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=es.applyTransformFast(s.aabb,this.node.matrix),n.encapsulate(s.transformedAabb)),e++;this.aabb=n}return this.aabb}}class M_{constructor(e,n,s,c,d,f){this.id=n,this.modelTraits|=hp.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,s&&(this.modelTraits|=hp.HasMapboxMeshFeatures),c&&(this.modelTraits|=hp.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const _ of e)this.nodesInfo.push(new yp(_)),Wm(_,f.featureIndexArray.length,f.grid),f.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,f.bucketLayerIDs.length-1,0)}updateFootprints(e,n){for(const s of this.getNodesInfo()){const c=s.node;c.footprint&&n.push({footprint:c.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const s of n){const c=s.node;this.uploaded?this.updatePbrBuffer(c):Vv(c,e,!0)}for(const s of n)Au(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),n=!0);return n}needsReEvaluation(e,n,s){const c=e.transform.projectionOptions,d=e.style.getBrightness(),f=this.brightness!==d;return!!(!this.uploaded||this.dirty||c.name!==this.projection.name||Xm(s.paint.get("model-color").value,f)||Xm(s.paint.get("model-color-mix-intensity").value,f)||Xm(s.paint.get("model-roughness").value,f)||Xm(s.paint.get("model-emissive-strength").value,f)||Xm(s.paint.get("model-height-based-emissive-strength-multiplier").value,f))&&(this.projection=c,this.brightness=d,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),c=this.id.canonical;for(const d of s){const f=d.feature;d.evaluatedScale=n.paint.get("model-scale").evaluate(f,{},c)}}evaluate(e){const n=this.getNodesInfo();for(const s of n){if(!s.node.meshes)continue;const c=s.feature,d=s.node.meshes&&s.node.meshes[0].featureData,f=s.evaluatedColor[2],_=s.evaluatedRMEA[2],x=this.id.canonical;if(s.hasTranslucentParts=!1,d){for(let E=0;E<e0.length;E++){const D=e0[E];D.length&&(c.properties.part=D);const S=e.paint.get("model-color").evaluate(c,{},x).toRenderColor(null),P=e.paint.get("model-color-mix-intensity").evaluate(c,{},x);s.evaluatedColor[E]=[S.r,S.g,S.b,P],s.evaluatedRMEA[E][0]=e.paint.get("model-roughness").evaluate(c,{},x),s.evaluatedRMEA[E][2]=e.paint.get("model-emissive-strength").evaluate(c,{},x),s.evaluatedRMEA[E][3]=S.a,s.emissionHeightBasedParams[E]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,{},x),!s.hasTranslucentParts&&S.a<1&&(s.hasTranslucentParts=!0)}delete c.properties.part,Mx(s,f!==s.evaluatedColor[2]||_!==s.evaluatedRMEA[2],this.modelTraits)}else s.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,{},x);s.evaluatedScale=e.paint.get("model-scale").evaluate(c,{},x),this.updatePbrBuffer(s.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,s,c){const d=e.findDEMTileFor(s);if(d&&(d.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const f=Xf.create(e,s,d);if(!f)return;this.modelTraits&hp.HasMapboxMeshFeatures&&this.updateDEM(e,f,s,c);for(const _ of this.getNodesInfo()){const x=_.node;if(!x.footprint||!x.footprint.vertices||!x.footprint.vertices.length)continue;const E=x.footprint.vertices;let D=f.getElevationAt(E[0].x,E[0].y,!0,!0);for(let S=1;S<E.length;S++)D=Math.min(D,f.getElevationAt(E[S].x,E[S].y,!0,!0));x.elevation=D}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,s,c){let d=n._dem._modifiedForSources[c];if(void 0===d&&(n._dem._modifiedForSources[c]=[],d=n._dem._modifiedForSources[c]),d.includes(s.canonical))return;const f=n._dem.dim;d.push(s.canonical);let _=!1;for(const x of this.getNodesInfo()){const E=x.node;if(!E.footprint||!E.footprint.grid)continue;const D=E.footprint.grid,S=n.tileCoordToPixel(D.min.x,D.min.y),P=n.tileCoordToPixel(D.max.x,D.max.y),F=Math.min(Math.min(f-P.y,S.x),Math.min(S.y,f-P.x));if(F<0)continue;const z=Ut(F,2,5);let $=Math.max(0,S.x-z),H=Math.max(0,S.y-z),ee=Math.min(P.x+z,f-1),Pe=Math.min(P.y+z,f-1);for(let st=H;st<=Pe;++st)for(let Dt=$;Dt<=ee;++Dt)Ed[st*f+Dt]=255;let Oe=0,ke=0;for(let st=0;st<D.cellsY;++st)for(let Dt=0;Dt<D.cellsX;++Dt){if(!D.cells[st*D.cellsX+Dt])continue;const kt=n.tileCoordToPixel(D.min.x+Dt/D.xScale,D.min.y+st/D.yScale),Yt=n.tileCoordToPixel(D.min.x+(Dt+1)/D.xScale,D.min.y+(st+1)/D.yScale);for(let yn=kt.y;yn<=Math.min(Yt.y+1,f-1);++yn)for(let dn=kt.x;dn<=Math.min(Yt.x+1,f-1);++dn)255===Ed[yn*f+dn]&&(Ed[yn*f+dn]=0,Oe+=n.getElevationAtPixel(dn,yn),ke++)}const dt=Oe/ke;$=Math.max(1,S.x-z),H=Math.max(1,S.y-z),ee=Math.min(P.x+z,f-2),Pe=Math.min(P.y+z,f-2),_=!0;for(let st=H;st<=Pe;++st)for(let Dt=$;Dt<=ee;++Dt)0===Ed[st*f+Dt]&&(_p[st*f+Dt]=n._dem.set(Dt,st,dt));for(let st=1;st<z;++st){$=Math.max(1,S.x-st),H=Math.max(1,S.y-st),ee=Math.min(P.x+st,f-2),Pe=Math.min(P.y+st,f-2);for(let Dt=H;Dt<=Pe;++Dt)for(let kt=$;kt<=ee;++kt){const Yt=Dt*f+kt;if(255===Ed[Yt]){let yn=0,dn=0,Fn=-1,Yn=-1;for(let Sn=-1;Sn<=1;++Sn)for(let Wn=-1;Wn<=1;++Wn){const xn=(Dt+Sn)*f+kt+Wn;if(Ed[xn]>=st)continue;const Hn=_p[xn],ni=Math.abs(Hn);ni>dn&&(yn=Hn,dn=ni,Fn=Wn,Yn=Sn)}if(dn>.1){const Sn=1-(st+.5*Math.abs(Fn*Yn))/z;let Wn=n._dem.get(kt,Dt)+yn*Sn;const xn=n._dem.get(kt+Fn,Dt+Yn),Hn=n._dem.get(kt-Fn,Dt-Yn,!0);(Wn-xn)*(Wn-Hn)>0&&(Wn=(xn+Hn)/2),_p[Yt]=n._dem.set(kt,Dt,Wn),Ed[Yt]=st}}}}}_&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Vo.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const n of e)Au(n.node),dh(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const s=n.getReplacementRegionsForTile(e.toUnwrapped()),c=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){const f=c[d].node;c[d].hiddenByReplacement=!!f.footprint&&!s.find(_=>_.footprint===f.footprint)}}getHeightAtTileCoord(e,n){const s=this.getNodesInfo(),c=[],d=[0,0,0],f=a.ad.identity([]);for(let _=0;_<this.nodesInfo.length;_++){const x=s[_],E=x.node.meshes[0],D=E.transformedAabb;if(e<D.min[0]||n<D.min[1]||e>D.max[0]||n>D.max[1])continue;if(!0===x.node.hidden)return{height:0,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};a.ad.invert(f,x.node.matrix),d[0]=e,d[1]=n,a._.transformMat4(d,d,f);const S=(d[0]-E.aabb.min[0])/(E.aabb.max[0]-E.aabb.min[0])*64|0,P=64*Math.min(63,(d[1]-E.aabb.min[1])/(E.aabb.max[1]-E.aabb.min[1])*64|0)+Math.min(63,S),F=E.heightmap[P];if(!(F<0&&x.node.footprint))return x.hiddenByReplacement?void 0:{height:F,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};if(x.node.footprint.grid.query(new Ae(e,n),new Ae(e,n),c),c.length>0)return{height:void 0,maxHeight:x.feature.properties.height,hidden:x.hiddenByReplacement,verticalScale:x.evaluatedScale[2]}}}}function Xm(t,e){return!t.isLightConstant&&e}function t0(t,e,n,s,c,d,f,_){let x=(61440&e|(61440&e)>>4)>>8,E=(3840&e|(3840&e)>>4)>>4,D=240&e|(240&e)>>4;n[3]>0&&(x=zi(x,255*n[0],n[3]),E=zi(E,255*n[1],n[3]),D=zi(D,255*n[2],n[3]));const S=x<<8|E,P=D<<8|Math.floor(255*s[3]),F=function(st){const Dt=Ut(st,0,2);return Math.min(Math.round(.5*Dt*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],z=Ut(c[0],0,1),$=Ut(c[1],0,1),H=Ut(c[2],0,1),ee=Ut(c[3],0,1);let Pe,Oe,ke,dt;if(z!==$&&f!==d&&$!==z){const st=f-d;Oe=1/(st*($-z)),ke=-(d+st*z)/(st*($-z));const Dt=Ut(c[4],-1,1);dt=Math.pow(10,Dt),Pe=255*H<<8|255*ee}else Pe=65535,Oe=0,ke=1,dt=1;if(t.emplaceBack(S,P,F,Pe,Oe,ke,dt),_){const st=_.length;_.clear();for(let Dt=0;Dt<st;Dt++)_.emplaceBack(S,P,F,Pe,Oe,ke,dt)}}function Mx(t,e,n){const s=t.node;let c=0;const d=n&hp.HasMeshoptCompression;for(const f of s.meshes){if(s.lights&&s.lightMeshIndex===c||!f.featureData)continue;f.featureArray=new zp,f.featureArray.reserve(f.featureData.length);let _=e;for(const x of f.featureData){const E=d?65535&x:x>>16&65535,D=d?x>>16&65535:65535&x,S=(15&D)<8?15&D:0,P=t.evaluatedRMEA[S],F=t.evaluatedColor[S],z=t.emissionHeightBasedParams[S];let $;if(_&&2===S&&s.lights&&($=new zp,$.resize(10*s.lights.length)),t0(f.featureArray,E,F,P,z,f.aabb.min[2],f.aabb.max[2],$),$&&_){_=!1;const H=s.meshes[s.lightMeshIndex];H.featureArray=$,H.featureArray._trim()}}f.featureArray._trim(),c++}}function Id(t,e,n,s){const c=1<<t.z;e.lat=qs((s/hi+t.y)/c),e.lng=Ta((n/hi+t.x)/c)}Ee(M_,"Tiled3dModelBucket",{omit:["layers"]}),Ee(yp,"Tiled3dModelFeature");const Km={circle:class extends ua{constructor(t,e,n,s){super(t,xy,e,n,s)}createBucket(t){return new ec(t)}queryRadius(t){const e=t;return yc("circle-radius",this,e)+yc("circle-stroke-width",this,e)+vy(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,s,c,d,f,_){const x=Xc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return Py(t,s,d,f,_,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),x,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,n){const s=Ay(this);return{config:new Rf(this,{zoom:e,lut:n}),defines:s,overrideFog:!1}}},heatmap:class extends ua{createBucket(t){return new Ry(t)}constructor(t,e,n,s){super(t,ky,e,n,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=em({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return yc("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,s,c,d,f,_){const x=this.paint.get("heatmap-radius").evaluate(e,n);return Py(t,s,d,f,_,!0,!0,new Ae(0,0),x)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,n){return"heatmap"===t?{config:new Rf(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends ua{constructor(t,e,n,s){super(t,Rg,e,n,s)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},fill:class extends ua{constructor(t,e,n,s){super(t,Bb,e,n,s)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e,n){return{config:new Rf(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Hf(t)}queryRadius(){return vy(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,s,c,d){return!t.queryGeometry.isAboveHorizon&&N0(U0(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends ua{constructor(t,e,n,s){super(t,Kf,e,n,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Hg(t)}queryRadius(){return vy(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,s,c,d,f,_,x){const E=Xc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),D=this.paint.get("fill-extrusion-height").evaluate(e,n),S=this.paint.get("fill-extrusion-base").evaluate(e,n),P=[0,0],F=_&&d.elevation,z=d.elevation?d.elevation.exaggeration():1,$=t.tile.getBucket(this);if(F&&$ instanceof Hg){const ke=$.centroidVertexArray,dt=x+1;dt<ke.length&&(P[0]=ke.geta_centroid_pos0(dt),P[1]=ke.geta_centroid_pos1(dt))}if(0===P[0]&&1===P[1])return!1;"globe"===d.projection.name&&(s=v1([s],[new Ae(0,0),new Ae(hi,hi)],t.tileID.canonical).map(ke=>ke.polygon).flat());const H=F?_:null,[ee,Pe]=(dt=s,st=S,Dt=D,kt=E,Yt=f,yn=H,dn=P,Fn=z,Yn=d.center.lat,"globe"===(ke=d).projection.name?function(Wn,xn,Hn,ni,Zn,Si,Qn,ci,Qi,$i,ji){const ri=[],tr=[],Dr=Wn.projection.upVectorScale(ji,Wn.center.lat,Wn.worldSize).metersToTile,or=[0,0,0,1],Mr=[0,0,0,1],Er=(ir,Mo,Co,Qr)=>{ir[0]=Mo,ir[1]=Co,ir[2]=Qr,ir[3]=1},Or=hm();Hn>0&&(Hn+=Or),ni+=Or;for(const ir of xn){const Mo=[],Co=[];for(const Qr of ir){const Hr=Qr.x+Zn.x,so=Qr.y+Zn.y,$o=Wn.projection.projectTilePoint(Hr,so,ji),Bo=Wn.projection.upVector(ji,Qr.x,Qr.y);let ms=Hn,us=ni;if(Qn){const Va=Xg(Hr,so,Hn,ni,Qn,ci,Qi,$i);ms+=Va.base,us+=Va.top}0!==Hn?Er(or,$o.x+Bo[0]*Dr*ms,$o.y+Bo[1]*Dr*ms,$o.z+Bo[2]*Dr*ms):Er(or,$o.x,$o.y,$o.z),Er(Mr,$o.x+Bo[0]*Dr*us,$o.y+Bo[1]*Dr*us,$o.z+Bo[2]*Dr*us),a._.transformMat4(or,or,Si),a._.transformMat4(Mr,Mr,Si),Mo.push(new Iu(or[0],or[1],or[2])),Co.push(new Iu(Mr[0],Mr[1],Mr[2]))}ri.push(Mo),tr.push(Co)}return[ri,tr]}(ke,dt,st,Dt,kt,Yt,yn,dn,Fn,Yn,t.tileID.canonical):yn?function(Wn,xn,Hn,ni,Zn,Si,Qn,ci,Qi){const $i=[],ji=[],ri=[0,0,0,1];for(const tr of Wn){const Dr=[],or=[];for(const Mr of tr){const Er=Mr.x+ni.x,Or=Mr.y+ni.y,ir=Xg(Er,Or,xn,Hn,Si,Qn,ci,Qi);ri[0]=Er,ri[1]=Or,ri[2]=ir.base,ri[3]=1,a.aA.transformMat4(ri,ri,Zn),ri[3]=Math.max(ri[3],1e-5);const Mo=new Iu(ri[0]/ri[3],ri[1]/ri[3],ri[2]/ri[3]);ri[0]=Er,ri[1]=Or,ri[2]=ir.top,ri[3]=1,a.aA.transformMat4(ri,ri,Zn),ri[3]=Math.max(ri[3],1e-5);const Co=new Iu(ri[0]/ri[3],ri[1]/ri[3],ri[2]/ri[3]);Dr.push(Mo),or.push(Co)}$i.push(Dr),ji.push(or)}return[$i,ji]}(dt,st,Dt,kt,Yt,yn,dn,Fn,Yn):function(Wn,xn,Hn,ni,Zn){const Si=[],Qn=[],ci=Zn[8]*xn,Qi=Zn[9]*xn,$i=Zn[10]*xn,ji=Zn[11]*xn,ri=Zn[8]*Hn,tr=Zn[9]*Hn,Dr=Zn[10]*Hn,or=Zn[11]*Hn;for(const Mr of Wn){const Er=[],Or=[];for(const ir of Mr){const Mo=ir.x+ni.x,Co=ir.y+ni.y,Qr=Zn[0]*Mo+Zn[4]*Co+Zn[12],Hr=Zn[1]*Mo+Zn[5]*Co+Zn[13],so=Zn[2]*Mo+Zn[6]*Co+Zn[14],$o=Zn[3]*Mo+Zn[7]*Co+Zn[15],Bo=Qr+ci,ms=Hr+Qi,us=so+$i,Va=Math.max($o+ji,1e-5),Es=Qr+ri,os=Hr+tr,Ts=so+Dr,Js=Math.max($o+or,1e-5);Er.push(new Iu(Bo/Va,ms/Va,us/Va)),Or.push(new Iu(Es/Js,os/Js,Ts/Js))}Si.push(Er),Qn.push(Or)}return[Si,Qn]}(dt,st,Dt,kt,Yt)),Oe=t.queryGeometry;var ke,dt,st,Dt,kt,Yt,yn,dn,Fn,Yn;return function(ke,dt,st){let Dt=1/0;N0(st,dt)&&(Dt=x1(st,dt[0]));for(let kt=0;kt<dt.length;kt++){const Yt=dt[kt],yn=ke[kt];for(let dn=0;dn<Yt.length-1;dn++){const Fn=Yt[dn],Yn=[Fn,Yt[dn+1],yn[dn+1],yn[dn],Fn];wg(st,Yn)&&(Dt=Math.min(Dt,x1(st,Yn)))}}return Dt!==1/0&&Dt}(ee,Pe,Oe.isPointQuery()?Oe.screenBounds:Oe.screenGeometry)}},line:class extends ua{constructor(t,e,n,s){super(t,ov,e,n,s),ov.layout&&(this.layout=new No(ov.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Wu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=tx.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new iv(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,n){const s=cw(this);return{config:new Rf(this,{zoom:e,lut:n}),defines:s,overrideFog:!1}}queryRadius(t){const e=t,n=nx(yc("line-width",this,e),yc("line-gap-width",this,e)),s=yc("line-offset",this,e);return n/2+Math.abs(s)+vy(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,s,c,d){if(t.queryGeometry.isAboveHorizon)return!1;const f=U0(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),_=t.pixelToTileUnitsFactor/2*nx(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),x=this.paint.get("line-offset").evaluate(e,n);return x&&(s=function(E,D){const S=[],P=new Ae(0,0);for(let F=0;F<E.length;F++){const z=E[F],$=[];for(let H=0;H<z.length;H++){const ee=z[H],Pe=z[H+1],Oe=0===H?P:ee.sub(z[H-1])._unit()._perp(),ke=H===z.length-1?P:Pe.sub(ee)._unit()._perp(),dt=Oe._add(ke)._unit();dt._mult(1/(dt.x*ke.x+dt.y*ke.y)),$.push(dt._mult(D)._add(ee))}S.push($)}return S}(s,x*t.pixelToTileUnitsFactor)),function(E,D,S){for(let P=0;P<D.length;P++){const F=D[P];if(E.length>=3)for(let z=0;z<F.length;z++)if(Uh(E,F[z]))return!0;if(Eb(E,F,S))return!0}return!1}(f,s,_)}isTileClipped(){return!0}isDraped(t){const e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:up,background:class extends ua{constructor(t,e,n,s){super(t,rx,e,n,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},raster:g_,"raster-particle":cx,sky:class extends ua{constructor(t,e,n,s){super(t,hx,e,n,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=em({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),c=!s,d=t.style.light,f=d.properties.get("position");return c&&"viewport"===d.properties.get("anchor")&&Do("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?jm(f.azimuthal,90-f.polar,e):jm(s[0],90-s[1],e)}const n=this.paint.get("sky-gradient-center");return jm(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}},slot:class extends ua{constructor(t,e,n,s){super(t,Zw,e,null)}},model:class extends ua{constructor(t,e,n,s){super(t,bx,e,n,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new b_(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof M_?hi-1:0}queryIntersectsFeature(t,e,n,s,c,d){if(!this.modelManager)return!1;const f=this.modelManager,_=t.tile.getBucket(this);if(!(_&&_ instanceof b_))return!1;const x=_;for(const E in x.instancesPerModel){const D=x.instancesPerModel[E],S=void 0!==e.id?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(D.idToFeaturesIndex.hasOwnProperty(S)){const P=D.features[D.idToFeaturesIndex[S]],F=f.getModel(E,this.scope);if(!F)return!1;let z=a.ad.create();const $=new Yr(0,0),H=x.canonical;let ee=Number.MAX_VALUE;for(let Pe=0;Pe<P.instancedDataCount;++Pe){const Oe=16*(P.instancedDataOffset+Pe),ke=D.instancedDataArray.float32,dt=[ke[Oe+4],ke[Oe+5],ke[Oe+6]];Id(H,$,ke[Oe],0|ke[Oe+1]),wx(z,F,d,$,P.rotation,P.scale,dt,!1,!1,!1),"globe"===d.projection.name&&(z=zv(z,d));const st=a.ad.multiply([],d.projMatrix,z),Dt=t.queryGeometry,kt=uh(Dt.isPointQuery()?Dt.screenBounds:Dt.screenGeometry,d,st,F.aabb);null!=kt&&(ee=Math.min(kt,ee))}return ee!==Number.MAX_VALUE&&ee}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||"model-color"!==t&&"model-color-mix-intensity"!==t&&"model-rotation"!==t&&"model-scale"!==t&&"model-translation"!==t&&"model-emissive-strength"!==t)}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof de}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,s){const c=t.tile,d=c.getBucket(this);let f=null,_=Number.MAX_VALUE;if(!(d&&d instanceof M_))return{queryFeature:f,intersectionZ:_};const x=d.getNodesInfo()[e];if(x.hiddenByReplacement||!x.node.meshes||!n.filter(new rr(c.tileID.overscaledZ),x.feature,c.tileID.canonical))return{queryFeature:f,intersectionZ:_};const E=x.node,D=s.calculatePosMatrix(c.tileID.toUnwrapped(),s.worldSize),S=x.evaluatedScale;let P=0;s.elevation&&E.elevation&&(P=E.elevation*s.elevation.exaggeration()),a.ad.translate(D,D,[(E.anchor?E.anchor[0]:0)*(S[0]-1),(E.anchor?E.anchor[1]:0)*(S[1]-1),P]),a.ad.scale(D,D,S),a.ad.multiply(D,D,E.matrix);const F=t.queryGeometry,z=F.isPointQuery()?F.screenBounds:F.screenGeometry,$=function(ee){const Pe=a.ad.multiply([],D,ee.matrix),Oe=a.ad.multiply(Pe,s.expandedFarZProjMatrix,Pe);for(let ke=0;ke<ee.meshes.length;++ke){const dt=ee.meshes[ke];if(ke===ee.lightMeshIndex)continue;const st=uh(z,s,Oe,dt.aabb);null!=st&&(_=Math.min(st,_))}if(ee.children)for(const ke of ee.children)$(ke)};if($(E),_===Number.MAX_VALUE)return{queryFeature:f,intersectionZ:_};const H=new Yr(0,0);return Id(c.tileID.canonical,H,x.node.anchor[0],x.node.anchor[1]),f={type:"Feature",geometry:{type:"Point",coordinates:[H.lng,H.lat]},properties:x.feature.properties,id:x.feature.id,state:{},layer:this.serialize()},{queryFeature:f,intersectionZ:_}}},clip:class extends ua{constructor(t,e,n,s){super(t,zb,e,n,s)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new jy(t)}isTileClipped(){return!0}is3D(){return!0}}};Ee(kv,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const aE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class vp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,s]=new Uint8Array(e,0,2);if(219!==n)throw new Error("Data does not appear to be in a KDBush format.");const c=s>>4;if(1!==c)throw new Error(`Got v${c} data when expected v1.`);const d=aE[15&s];if(!d)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new vp(_,f,d,e)}constructor(e,n=64,s=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=aE.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${s}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+_+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=n,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return S_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:_}=this,x=[0,d.length-1,0],E=[];for(;x.length;){const D=x.pop()||0,S=x.pop()||0,P=x.pop()||0;if(S-P<=_){for(let H=P;H<=S;H++){const ee=f[2*H],Pe=f[2*H+1];ee>=e&&ee<=s&&Pe>=n&&Pe<=c&&E.push(d[H])}continue}const F=P+S>>1,z=f[2*F],$=f[2*F+1];z>=e&&z<=s&&$>=n&&$<=c&&E.push(d[F]),(0===D?e<=z:n<=$)&&(x.push(P),x.push(F-1),x.push(1-D)),(0===D?s>=z:c>=$)&&(x.push(F+1),x.push(S),x.push(1-D))}return E}within(e,n,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:f}=this,_=[0,c.length-1,0],x=[],E=s*s;for(;_.length;){const D=_.pop()||0,S=_.pop()||0,P=_.pop()||0;if(S-P<=f){for(let H=P;H<=S;H++)Sx(d[2*H],d[2*H+1],e,n)<=E&&x.push(c[H]);continue}const F=P+S>>1,z=d[2*F],$=d[2*F+1];Sx(z,$,e,n)<=E&&x.push(c[F]),(0===D?e-s<=z:n-s<=$)&&(_.push(P),_.push(F-1),_.push(1-D)),(0===D?e+s>=z:n+s>=$)&&(_.push(F+1),_.push(S),_.push(1-D))}return x}}function S_(t,e,n,s,c,d){if(c-s<=n)return;const f=s+c>>1;n0(t,e,f,s,c,d),S_(t,e,n,s,f-1,1-d),S_(t,e,n,f+1,c,1-d)}function n0(t,e,n,s,c,d){for(;c>s;){if(c-s>600){const E=c-s+1,D=n-s+1,S=Math.log(E),P=.5*Math.exp(2*S/3),F=.5*Math.sqrt(S*P*(E-P)/E)*(D-E/2<0?-1:1);n0(t,e,n,Math.max(s,Math.floor(n-D*P/E+F)),Math.min(c,Math.floor(n+(E-D)*P/E+F)),d)}const f=e[2*n+d];let _=s,x=c;for(Zm(t,e,s,n),e[2*c+d]>f&&Zm(t,e,s,c);_<x;){for(Zm(t,e,_,x),_++,x--;e[2*_+d]<f;)_++;for(;e[2*x+d]>f;)x--}e[2*s+d]===f?Zm(t,e,s,x):(x++,Zm(t,e,x,c)),x<=n&&(s=x+1),n<=x&&(c=x-1)}}function Zm(t,e,n,s){uf(t,n,s),uf(e,2*n,2*s),uf(e,2*n+1,2*s+1)}function uf(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function Sx(t,e,n,s){const c=t-n,d=e-s;return c*c+d*d}a.$=ln,a.A=fc,a.B=Gu,a.C=Br,a.D=Qo,a.E=lc,a.G=Ms,a.H=m,a.I=W1,a.J=p,a.K=function(t){const e=t.value;let n=[];if(!e)return n;const s=$l(e);return"string"!==s?(n=n.concat([new x_(t.key,e,`string expected, "${s}" found`)]),n):(yx(e,!0)||(n=n.concat([new x_(t.key,e,`invalid url "${e}"`)])),n)},a.L=Jt,a.M=class{constructor(t,e,n,s){this.id=t,this.position=null!=e?new Yr(e[0],e[1]):new Yr(0,0),this.orientation=n??[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new es([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(a.ad.multiply(t.matrix,e,t.matrix),t.meshes)for(const n of t.meshes){const s=es.applyTransformFast(n.aabb,t.matrix);this.aabb.encapsulate(s)}if(t.children)for(const n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){const t=a.ad.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,s,c,d,f=!1){wx(this.matrix,this,t.transform,this.position,e,n,s,c,d,f)}upload(t){if(!this.uploaded){for(const e of this.nodes)Vv(e,t);for(const e of this.nodes)Au(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)dh(t)}},a.N=to,a.O=Mn,a.P=Ae,a.Q=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Zo(t.expression.evaluate(e))}interpolate(t,e,n){return{x:zi(t.x,e.x,n),y:zi(t.y,e.y,n),z:zi(t.z,e.z,n),azimuthal:zi(t.azimuthal,e.azimuthal,n),polar:zi(t.polar,e.polar,n)}}},a.R=sc,a.S=ug,a.T=bc,a.U=Pr,a.V=x_,a.W=ai,a.X=rr,a.Y=Da,a.Z=de,a.a=js,a.a$=function(t){const{x:e,y:n}=t.point,{lng:s,lat:c}=t._center;return $0(e,n,t.worldSize,s,c)},a.a0=No,a.a1=cd,a.a2=zi,a.a3=hi,a.a4=cc,a.a5=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,s]){const c=Zo([1,n,s]);return{x:c.x,y:c.y,z:c.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:zi(t.x,e.x,n),y:zi(t.y,e.y,n),z:zi(t.z,e.z,n)}}},a.a6=yg,a.a7=Kd,a.a8=Gc,a.a9=A0,a.aB=function(t,e){const{x:n,y:s}=t.point,c=$0(n,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return a.ad.multiply(c,c,Sg(ld(e)))},a.aD=th,a.aE=tc,a.aF=ym,a.aG=function(t,e,n,s,c){const d=5*e+2;t.float32[d+0]=n,t.float32[d+1]=s,t.float32[d+2]=c},a.aH=op,a.aI=Yr,a.aJ=Dw,a.aK=oa,a.aL=Os,a.aM=qp,a.aN=px,a.aO=_c,a.aP=Cy,a.aQ=function(t,e,n,s,c,d,f,_,x){if("globe"===x.name)return Cy(t,e,new _c(n,s,c),!1);const E=vd({z:n,x:s,y:c},x);return new es([(d+E.x/E.scale)*e,e*(E.y/E.scale),f],[(d+E.x2/E.scale)*e,e*(E.y2/E.scale),_])},a.aR=function(t,e,n){let s=0;for(let c=0;c<2;++c)t[c]>0&&(s+=(t[c]-0)*(t[c]-0)),e[c]<0&&(s+=(0-e[c])*(0-e[c]));return s},a.aS=bs,a.aT=jh,a.aU=Hp,a.aV=function(t){const e=a.ad.identity(new Float64Array(16));a.ad.multiply(e,t.pixelMatrix,t.globeMatrix);const n=[0,Jl,0],s=[0,Ql,0];return a._.transformMat4(n,n,e),a._.transformMat4(s,s,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Ag(t,new Yr(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!Ag(t,new Yr(t.center.lat,-90))]},a.aW=function(t,e){const{scale:n}=t.tileTransform,s=n*hi/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return a.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},a.aX=__,a.aY=fx,a.aZ=function(t){const e=fx(t,!0);return a.aC.invert([],[e[0],e[1],e[4],e[5]])},a.a_=by,a.aa=il,a.ab=Zi,a.ac=function(t,e,n){const s=Math.sqrt(t*t+e*e+n*n),c=s>0?Math.acos(n/s)*ho:0;let d=0!==t||0!==e?Math.atan2(-e,-t)*ho+90:0;return d<0&&(d+=360),[s,d,c]},a.ae=tf,a.af=nc,a.ag=ip,a.ah=function(t,e){const n={};for(let s=0;s<e.length;s++){const c=e[s];c in t&&(n[c]=t[c])}return n},a.ai=ad,a.aj=bu,a.ak=Wc,a.al=Mf,a.am=function(t){ye++,ye>Ul&&(t.getActor().send("enforceCacheSizeLimit",zl),ye=0)},a.an=ac,a.ao=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,s){const c=this.entries[t]=this.entries[t]||{callbacks:[]};if(c.result){const[d,f]=c.result;return this.scheduler?this.scheduler.add(()=>{s(d,f)},e):s(d,f),()=>{}}return c.callbacks.push(s),c.cancel||(c.cancel=n((d,f)=>{c.result=[d,f];for(const _ of c.callbacks)this.scheduler?this.scheduler.add(()=>{_(d,f)},e):_(d,f);setTimeout(()=>delete this.entries[t],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(d=>d!==s),c.callbacks.length||(c.cancel(),delete this.entries[t]))}}},a.ap=function(t,e,n){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{const d=jl(t.request,(f,_,x,E)=>{f?c(f):_&&c(null,{vectorTile:n?void 0:new am(new Kc(_)),rawData:_,cacheControl:x,expires:E})});return()=>{d.cancel(),c()}},e)},a.aq=_g,a.ar=class extends Al{constructor(t){super(t),this.current=fy}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<9;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},a.as=hy,a.at=Ut,a.au=qn,a.aw=fo,a.ax=Ia,a.ay=qs,a.az=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},a.b=rs,a.b$=md,a.b0=Ro,a.b1=vg,a.b2=function(t){const e=Math.round((t+45+360)%360/90)%4;return he[e]},a.b3=45,a.b4=Ff,a.b5=Wp,a.b6=es,a.b7=Zo,a.b8=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},a.b9=qe,a.bA=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},a.bB=sw,a.bD=V0,a.bE=Bl,a.bF=al,a.bG=256,a.bH=function(t,e){const n=[0,0,0],s=Qp(ld(e.canonical));return a._.transformMat4(n,n,s),a._.transformMat4(n,n,t),n},a.bI=t=>({u_camera_to_center_distance:new il(t),u_extrude_scale:new Vp(t),u_device_pixel_ratio:new il(t),u_matrix:new yg(t),u_inv_rot_matrix:new yg(t),u_merc_center:new Gc(t),u_tile_id:new _g(t),u_zoom_transition:new il(t),u_up_dir:new _g(t),u_emissive_strength:new il(t)}),a.bJ=t=>({u_matrix:new yg(t),u_pixels_to_tile_units:new Vp(t),u_device_pixel_ratio:new il(t),u_units_to_pixels:new Gc(t),u_dash_image:new Kd(t),u_gradient_image:new Kd(t),u_image_height:new il(t),u_texsize:new Gc(t),u_tile_units_to_pixels:new il(t),u_alpha_discard_threshold:new il(t),u_trim_offset:new Gc(t),u_trim_fade_range:new Gc(t),u_trim_color:new hy(t),u_emissive_strength:new il(t)}),a.bK=t=>({u_matrix:new yg(t),u_texsize:new Gc(t),u_pixels_to_tile_units:new Vp(t),u_device_pixel_ratio:new il(t),u_image:new Kd(t),u_units_to_pixels:new Gc(t),u_tile_units_to_pixels:new il(t),u_alpha_discard_threshold:new il(t),u_trim_offset:new Gc(t)}),a.bL=ag,a.bM=nw,a.bN=sa,a.bO=vm,a.bP=j1,a.bQ=Qg,a.bR=Ay,a.bS=(t,e,n,s,c,d)=>{const f=t.transform,_="globe"===f.projection.name;let x;if("map"===d.paint.get("circle-pitch-alignment"))if(_){const D=V0(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;x=Float32Array.from([D,0,0,D])}else x=f.calculatePixelsToTileUnitsMatrix(n);else x=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(f.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Vo.devicePixelRatio,u_extrude_scale:x,u_inv_rot_matrix:H0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(_){E.u_inv_rot_matrix=s,E.u_merc_center=c,E.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],E.u_zoom_transition=cd(f.zoom);const D=c[0]*hi,S=c[1]*hi;E.u_up_dir=f.projection.upVector(new _c(0,0,0),D,S)}return E},a.bT=cw,a.bU=(t,e,n,s,c,d)=>{const f=t.transform;return{u_matrix:lw(t,e,n,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:f.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_image:0,u_tile_units_to_pixels:aw(e,f),u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:d}},a.bV=(t,e,n,s,c,d,f)=>{const _=t.transform,x=_.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:lw(t,e,n,s),u_pixels_to_tile_units:x,u_device_pixel_ratio:d,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:D1(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:aw(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:f,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength")}},a.bW=ur,a.bX=em,a.bY=hm,a.bZ=gy,a.b_=Hg,a.ba=function(t,e,n){const s=cd(n.zoom),c=t.style.map._antialias,d=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===s&&!c&&!d},a.bb=function(t){const e=t.pixelsPerMeter,n=e/Ia(1,t.center.lat),s=a.ad.identity(new Float64Array(16));return a.ad.translate(s,s,[t.point.x,t.point.y,0]),a.ad.scale(s,s,[n,n,e]),Float32Array.from(s)},a.bc=Jp,a.bd=function(t){const e=bs-5;t=Ut(t,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(Zi(t))),3);return Math.round(n*(xg.length-1))},a.be=function(t,e,n,s){const c=e.getNorth(),d=e.getSouth(),f=e.getWest(),_=e.getEast(),x=1<<t.z,E=_-f,D=c-d,S=E/64,P=-D/xg[n],F=[0,S,0,P,0,0,c,f,0];if(t.z>0){const z=180/s;a.bC.multiply(F,F,[z/E+1,0,0,0,z/D+1,0,-.5*z/S,.5*z/P,1])}return F[2]=x,F[5]=t.x,F[8]=t.y,F},a.bf=Qp,a.bg=ld,a.bh=function(t,e,n){const s=a.ad.identity(new Float64Array(16)),c=(e/(1<<t)-.5)*Math.PI*2;return a.ad.rotateY(s,n.globeMatrix,c),Float32Array.from(s)},a.bi=rc,a.bj=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},a.bk=g_,a.bl=cx,a.bm=sx,a.bn=function(t,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<t.length;s++){const c=document.createElement("source");zo(t[s])||(n.crossOrigin="Anonymous"),c.src=t[s],n.appendChild(c)}return{cancel:()=>{}}},a.bo=u_,a.bp=Fo,a.bq=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,s=1<<n,c=Math.floor(t.x),d=Math.floor((t.x-c)*s),f=Math.floor(t.y*s),_=this.findDEMTileFor(new Os(n,c,n,d,f));return!(!_||!_.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const c=s.getSource().maxzoom,d=1<<c,f=Math.floor(t.x),_=t.x-f,x=new Os(c,f,c,Math.floor(_*d),Math.floor(t.y*d)),E=this.findDEMTileFor(x);if(!E||!E.dem)return e;const D=E.dem,S=1<<E.tileID.canonical.z,P=(_*S-E.tileID.canonical.x)*D.dim,F=(t.y*S-E.tileID.canonical.y)*D.dim,z=Math.floor(P),$=Math.floor(F);return(n?this.exaggeration():1)*zi(zi(D.get(z,$),D.get(z,$+1),F-$),zi(D.get(z+1,$),D.get(z+1,$+1),F-$),P-z)}getAtTileOffset(t,e,n){const s=1<<t.canonical.z;return this.getAtPointOrZero(new Da(t.wrap+(t.canonical.x+e/hi)/s,(t.canonical.y+n/hi)/s))}getAtTileOffsetFunc(t,e,n,s){return c=>{const d=this.getAtTileOffset(t,c.x,c.y),f=s.upVector(t.canonical,c.x,c.y),_=s.upVectorScale(t.canonical,e,n).metersToTile;return a._.scale(f,f,d*_),f}}getForTilePoints(t,e,n,s){if(this.isUsingMockSource())return!1;const c=Xf.create(this,t,s);return!!c&&(e.forEach(d=>{d[2]=this.exaggeration()*c.getElevationAt(d[0],d[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,s=e.tileID,c=1<<t.canonical.z-s.canonical.z;let d=t.canonical.x/c-s.canonical.x,f=t.canonical.y/c-s.canonical.y,_=0;for(let x=0;x<t.canonical.z-s.canonical.z&&!n.leaves[_];x++){d*=2,f*=2;const E=2*Math.floor(f)+Math.floor(d);_=n.childOffsets[_]+E,d%=1,f%=1}return{min:this.exaggeration()*n.minimums[_],max:this.exaggeration()*n.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(0===t.length)return null;let e=!1,n=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const c of t){const d=this.getMinMaxForTile(c.tileID);d&&(n=Math.min(n,d.min),s=Math.max(s,d.max),e=!0)}return e?{min:n,max:s}:null}},a.br=Yp,a.bs=Tg,a.bt=gc,a.bu=Zs,a.bv=ah,a.bw=Gv,a.bx=af,a.by=d_,a.bz=X0,a.c=Qv,a.c$=Dc,a.c0=450,a.c1=7,a.c2=ax,a.c3=Fv,a.c4=256,a.c5=za,a.c6=Sg,a.c7=oo,a.c8=Rh,a.c9=nd,a.cA=function(t){let e=1/0,n=1/0,s=-1/0,c=-1/0;for(const d of t)e=Math.min(e,d.x),n=Math.min(n,d.y),s=Math.max(s,d.x),c=Math.max(c,d.y);return{min:new Ae(e,n),max:new Ae(s,c)}},a.cB=Uh,a.cC=xb,a.cD=Ca,a.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.cF=vv,a.cG=wg,a.cH=s1,a.cI=a1,a.cJ=Ev,a.cK=vp,a.cL=function(t){return t({pluginStatus:In,pluginURL:Li}),hr.on("pluginStateChange",t),t},a.cM=nh,a.cN=_d,a.cO=_h,a.cP=Ir,a.cQ=De,a.cR=oc,a.cS=ul,a.cT=eo,a.cU=function(t){const e=t.indexOf("\x1f");return e>=0?t.slice(0,e):t},a.cV=function(t){return t.indexOf("\x1f")>=0},a.cW=function(t){const e=t.indexOf("\x1f");return e>=0?t.slice(e+1):""},a.cX=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:`layers.${n}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},a.cY=function(t,e,n,s){return"custom"===t.type?new ux(t,e):new Km[t.type](t,e,n,s)},a.cZ=Oo,a.c_=hr,a.ca=1,a.cb=771,a.cc=0,a.cd=Af,a.ce=function(t,e,n,s,c){return Ut((t-e)/(n-e)*(c-s)+s,s,c)},a.cf=Xl,a.cg=Zd,a.ch=class{constructor(t,e,n,s){this.context=t,this.format=s,this.size=n,this.texture=t.gl.createTexture();const[c,d,f]=this.size,{gl:_}=t;_.bindTexture(_.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let x=this.format,E=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(x=_.DEPTH_COMPONENT16,E=_.UNSIGNED_SHORT),this.format===_.R8&&(s=_.RED),this.format===_.R32F&&(E=_.FLOAT,s=_.RED),_.texImage3D(_.TEXTURE_3D,0,x,c,d,f,0,s,E,e.data)}bind(t,e){const{context:n}=this,{gl:s}=n;s.bindTexture(s.TEXTURE_3D,this.texture),t!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,t),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},a.ci=zv,a.cj=[1,1,1],a.ck=Xf,a.cl=hp,a.cm=wa,a.cn=Pf,a.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ae(1/0,1/0),max:new Ae(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){const n=Xy(new Ae(0,0),new Ae(hi,hi),t),s=[];if(e&&!um(n,this._globalClipBounds))return s;for(const c of this._activeRegions){if(c.hiddenByOverlap||!um(n,c))continue;const d=r1(c.min,c.max,t);s.push({min:d.min,max:d.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask})}return s}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const s of e.cache.getVisibleCoordinates()){const c=e.cache.getTile(s).buckets[e.layer];c&&c.updateFootprints(s.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(t){const e=t.getFootprints();if(0===e.length)return;const n=t.getOrder(),s=t.getClipMask();for(const c of e){if(!c.footprint)continue;const d=Xy(c.footprint.min,c.footprint.max,c.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:c.id,footprint:c.footprint,order:n,clipMask:s})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||Wy(e.min,n.min)||Wy(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){const n=this._activeRegions[e],s=this._prevRegions[e];t=n.priority!==s.priority||!cm(n,s)||n.order!==s.order||n.clipMask!==s.clipMask,++e}}if(t){++this._updateTime;for(const n of this._activeRegions)n.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));const e=n=>{const s=this._activeRegions;if(n>=s.length)return n;const c=s[n].priority;for(;n<s.length&&s[n].priority===c;)++n;return n};if(this._sourceIds.length>1){let n=0,s=e(n);for(;n!==s;){let c=n;const d=n;for(;c!==s;){const f=this._activeRegions[c];f.hiddenByOverlap=!1;for(let _=0;_<d;_++){const x=this._activeRegions[_];if(!x.hiddenByOverlap&&f.order===1/0&&um(f,x)&&(f.hiddenByOverlap=o1(f.footprint,f.tileId,x.footprint,x.tileId),f.hiddenByOverlap))break}++c}n=s,s=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},a.cp=ba,a.cq=Pm,a.cr=Lh,a.cs=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const n=new gc,s=new Zs,c=[],d=t+1+2,f=e[0]+1,_=e[0]+1+(1+e.length),x=(E,D,S)=>{let P=E===d-1?E-2:0===E?E:E-1;return P+=S?24575:0,[P,D]};for(let E=0;E<d;++E)n.emplaceBack(...x(E,0,!0));for(let E=0;E<f;++E)for(let D=0;D<d;++D)n.emplaceBack(...x(D,E,(0===D||D===d-1)&&!0));for(let E=0;E<e.length;++E){const D=e[E];for(let S=0;S<d;++S)n.emplaceBack(...x(S,D,!0))}for(let E=0;E<e.length;++E){const D=s.length,S=e[E]+1+2,P=new Zs;for(let $=0;$<S-1;$++){const H=$===S-2,ee=H?d*(_-e.length+E-$):d;for(let Pe=0;Pe<d-1;Pe++){const Oe=$*d+Pe;0===$||H||0===Pe||Pe===d-2?(P.emplaceBack(Oe+1,Oe,Oe+ee),P.emplaceBack(Oe+ee,Oe+ee+1,Oe+1)):(s.emplaceBack(Oe+1,Oe,Oe+ee),s.emplaceBack(Oe+ee,Oe+ee+1,Oe+1))}}const F=rs.simpleSegment(0,D,n.length,s.length-D);for(let $=0;$<P.uint16.length;$+=3)s.emplaceBack(P.uint16[$],P.uint16[$+1],P.uint16[$+2]);const z=rs.simpleSegment(0,D,n.length,s.length-D);c.push({withoutSkirts:F,withSkirts:z})}return{vertices:n,indices:s,segments:c}}_createGrid(t){const e=this._fillGridMeshWithLods(64,xg);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Yp.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Zs;for(let f=0;f<=64;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new nd,s=new nd,c=new nd,d=new nd;this._poleSegments=[];for(let f=0,_=0;f<vg;f++){const x=360/(1<<f);n.emplaceBack(0,-Ca,0,.5,0),s.emplaceBack(0,-Ca,0,.5,1),c.emplaceBack(0,-Ca,0,.5,.5),d.emplaceBack(0,-Ca,0,.5,.5);for(let E=0;E<=64;E++){let D=E/64,S=0;const P=zi(0,x,D),[F,z,$]=Bh(Pg,G0,P,Ca);n.emplaceBack(F,z,$,D,S),s.emplaceBack(F,z,$,D,1-S);const H=Zi(P);D=.5+.5*Math.sin(H),S=.5+.5*Math.cos(H),c.emplaceBack(F,z,$,D,S),d.emplaceBack(F,z,$,D,1-S)}this._poleSegments.push(rs.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,Ig,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,Ig,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(c,Ig,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(d,Ig,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},a.ct=function(t){return Tl.has(t)},a.cu=h1,a.cv=function(t,e,n=0,s=!0){const c=new Ae(n,n),d=t.sub(c),f=e.add(c),_=[d,new Ae(f.x,d.y),f,new Ae(d.x,f.y)];return s&&_.push(d.clone()),_},a.cw=function(t,e){const n=[];for(let s=0;s<t.length;s++){const c=qn(s-1,-1,t.length-1),d=qn(s+1,-1,t.length-1),f=t[s],_=t[d],x=t[c].sub(f).unit(),E=_.sub(f).unit(),D=E.angleWithSep(x.x,x.y),S=x.add(E).unit().mult(-1*e/Math.sin(D/2));n.push(f.add(S))}return n},a.cx=Iv,a.cy=z0,a.cz=function(t,e,n=0){return a._.fromValues(((e.x-n)*t.scale-t.x)*hi,(e.y*t.scale-t.y)*hi,O0(e.z,e.y))},a.d=wr,a.d$=Te,a.d0=Pt,a.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.d2=Ht,a.d3=k0,a.d4=zh,a.d5=function([t,e,n]){const s=Math.hypot(t,e,n),c=Math.atan2(t,n),d=.5*Math.PI-Math.acos(-e/s);return new Yr(Ro(c),Ro(d))},a.d6=Ta,a.d7=od,a.d8=T,a.d9=Ag,a.dA=function(t){const e=Nu();if(!e)return;const n=e.delete(Bs);t&&n.catch(t).then(()=>t())},a.dB=pp,a.dC=rl,a.dD=function(t){Hv=Vo.resolveURL(t),lf||(lf=new Gv(af(),new lc)),lf.broadcast("setDracoUrl",Hv)},a.dE=Wv,a.dF=function(t){gp=Vo.resolveURL(t),lf||(lf=new Gv(af(),new lc)),lf.broadcast("setMeshoptUrl",gp)},a.dG=mi,a.dH=Ee,a.dI=Yd,a.dJ=Ll,a.dK=vd,a.dL=ly,a.dM=mm,a.dN=_m,a.dO=T1,a.dP=Di,a.dQ=Qh,a.dR=sp,a.dS=function(t,e,n,s,c,d,f,_,x,E,D){t.createArrays(),t.tilePixelRatio=hi/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const S=t.layers[0].layout,P=t.layers[0]._unevaluatedLayout._values,F={};if("composite"===t.textSizeData.kind){const{minZoom:ee,maxZoom:Pe}=t.textSizeData;F.compositeTextSizes=[P["text-size"].possiblyEvaluate(new rr(ee),_),P["text-size"].possiblyEvaluate(new rr(Pe),_)]}if("composite"===t.iconSizeData.kind){const{minZoom:ee,maxZoom:Pe}=t.iconSizeData;F.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new rr(ee),_),P["icon-size"].possiblyEvaluate(new rr(Pe),_)]}F.layoutTextSize=P["text-size"].possiblyEvaluate(new rr(x+1),_),F.layoutIconSize=P["icon-size"].possiblyEvaluate(new rr(x+1),_),F.textMaxSize=P["text-size"].possiblyEvaluate(new rr(18),_);const z="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement"),$=S.get("text-size");let H=!1;for(const ee of t.features)if(ee.icon&&ee.icon.nameSecondary){H=!0;break}for(const ee of t.features){const Pe=S.get("text-font").evaluate(ee,{},_).join(","),Oe=$.evaluate(ee,{},_),ke=F.layoutTextSize.evaluate(ee,{},_),dt=(F.layoutIconSize.evaluate(ee,{},_),{horizontal:{},vertical:void 0}),st=ee.text;let Dt,kt=[0,0];if(st){const dn=st.toString(),Fn=S.get("text-letter-spacing").evaluate(ee,{},_)*sa,Yn=S.get("text-line-height").evaluate(ee,{},_)*sa,Sn=Gn(dn)?Fn:0,Wn=S.get("text-anchor").evaluate(ee,{},_),xn=S.get("text-variable-anchor");if(!xn){const Qn=S.get("text-radial-offset").evaluate(ee,{},_);kt=Qn?j1(Wn,[Qn*sa,i_]):S.get("text-offset").evaluate(ee,{},_).map(ci=>ci*sa)}let Hn=z?"center":S.get("text-justify").evaluate(ee,{},_);const ni="point"===S.get("symbol-placement"),Zn=ni?S.get("text-max-width").evaluate(ee,{},_)*sa:1/0,Si=Qn=>{t.allowVerticalPlacement&&hn(dn)&&(dt.vertical=pv(st,e,n,c,Pe,Zn,Yn,Wn,Qn,Sn,kt,tc.vertical,!0,ke,Oe))};if(!z&&xn){const Qn="auto"===Hn?xn.map(Qi=>Ev(Qi)):[Hn];let ci=!1;for(let Qi=0;Qi<Qn.length;Qi++){const $i=Qn[Qi];if(!dt.horizontal[$i])if(ci)dt.horizontal[$i]=dt.horizontal[0];else{const ji=pv(st,e,n,c,Pe,Zn,Yn,"center",$i,Sn,kt,tc.horizontal,!1,ke,Oe);ji&&(dt.horizontal[$i]=ji,ci=1===ji.positionedLines.length)}}Si("left")}else{if("auto"===Hn&&(Hn=Ev(Wn)),ni||S.get("text-writing-mode").indexOf("horizontal")>=0||!hn(dn)){const Qn=pv(st,e,n,c,Pe,Zn,Yn,Wn,Hn,Sn,kt,tc.horizontal,!1,ke,Oe);Qn&&(dt.horizontal[Hn]=Qn)}Si(ni?"left":Hn)}}let Yt=!1;if(ee.icon&&ee.icon.namePrimary){const dn=s[ee.icon.namePrimary];dn&&(Dt=Em(c[ee.icon.namePrimary],ee.icon.nameSecondary?c[ee.icon.nameSecondary]:void 0,S.get("icon-offset").evaluate(ee,{},_),S.get("icon-anchor").evaluate(ee,{},_)),Yt=dn.sdf,void 0===t.sdfIcons?t.sdfIcons=dn.sdf:t.sdfIcons!==dn.sdf&&Do("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(dn.pixelRatio!==t.pixelRatio||0!==S.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const yn=$1(dt.horizontal)||dt.vertical;t.iconsInText||(t.iconsInText=!!yn&&yn.iconsInText),(yn||Dt)&&vw(t,ee,dt,Dt,s,F,ke,0,kt,Yt,f,_,E,D,H)}d&&t.generateCollisionDebugBuffers(x,t.collisionBoxArray)},a.dT=iv,a.dU=Hf,a.dV=am,a.dW=Kc,a.dX=Ug,a.dY=lp,a.dZ=lm,a.d_=rm,a.da=My,a.db=function(t){const e=[0,0,0],n=a.ad.identity(new Float64Array(16));return a.ad.multiply(n,t.pixelMatrix,t.globeMatrix),a._.transformMat4(e,e,n),new Ae(e[0],e[1])},a.dc=We,a.dd=je,a.de=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(null==qa){const s=n.navigator?n.navigator.userAgent:null;qa=!!n.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return qa}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.df=Vi,a.dg=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",El,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!De(t))return t;const n=aa(t);return n.params.push(`sdk=js-${Z}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!De(t))return t;const n=aa(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!De(t))return t;const n=aa(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,s){if(!De(t))return t;const c=aa(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),n&&c.params.push(`language=${n}`),s&&c.params.push(`worldview=${s}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,s){const c=aa(t);return De(t)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||s)):(c.path+=`${e}${n}`,Cl(c))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!De(t))return t;const s=aa(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&"raster"!==s.authority&&512===n?"@2x":""}${q.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${T.RASTER_URL_PREFIX}${s.path}`:"rasterarrays"===s.authority?s.path=`/${T.RASTERARRAYS_URL_PREFIX}${s.path}`:"3dtiles"===s.authority?s.path=`/${T.TILES3D_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${T.TILE_URL_VERSION}${s.path}`);const c=this._customAccessToken||function(d){for(const f of d){const _=f.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(s.params)||T.ACCESS_TOKEN;return T.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,c)}canonicalizeTileURL(t,e){const n=aa(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let s="mapbox://";n.path.match(/^\/raster\/v1\//)?s+=`raster/${n.path.replace(`/${T.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?s+=`rasterarrays/${n.path.replace(`/${T.RASTERARRAYS_URL_PREFIX}/`,"")}`:s+=`tiles/${n.path.replace(`/${T.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(d=>!d.match(/^access_token=/))),c.length&&(s+=`?${c.join("&")}`),s}canonicalizeTileset(t,e){const n=!!e&&De(e),s=[];for(const c of t.tiles||[])Ce(c)?s.push(this.canonicalizeTileURL(c,n)):s.push(c);return s}_makeAPIURL(t,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=aa(T.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,"http"===t.protocol){const c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if("/"!==s.path&&(t.path=`${s.path}${t.path}`),!T.REQUIRE_ACCESS_TOKEN)return Cl(t);if(e=e||T.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(c=>-1===c.indexOf("access_token")),t.params.push(`access_token=${e||""}`),Cl(t)}},a.dh=function(t,e){e?Tl.add(t):Tl.delete(t)},a.di=q,a.dj=Ac,a.dk=_f,a.dl=ll,a.dm=Ad,a.dn=ru,a.dp=function(t){Tl.delete(t)},a.dq=ou,a.dr=Pa,a.ds=ti,a.dt=Z,a.du=function(t,e){zl=t,Ul=e},a.dv=function(t,e,n=!1){if(In===bi||In===Mi||In===xi)throw new Error("setRTLTextPlugin cannot be called multiple times.");Li=Vo.resolveURL(t),In=bi,di=e,Ji(),n||fr()},a.dw=Fr,a.dx=function(){af().acquire(w_)},a.dy=function(){const t=Gm;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(w_),Gm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.dz=E_,a.e=Vo,a.e0=sv,a.e1=ht,a.e2=jl,a.e3=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==T_){const n=new Uint32Array(t,0,7),[,,s,c,d,f]=n;e=n.byteLength+c+d+f+d,(s!==t.byteLength||e>=t.byteLength)&&Do("Invalid b3dm header information.")}return Jv(t,e)},a.e4=function(t,e){const n=Qv(t);for(const s of n){for(const c of s.meshes)oE(c);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(sE(s.lights,e)))}return n},a.e5=M_,a.e6=$v,a.e7=Rr,a.e8=function(t){se(),wl&&wl.then(e=>{e.keys().then(n=>{for(let s=0;s<n.length-t;s++)e.delete(n[s])})})},a.f=la,a.g=function(t,e){return Dc(ai(t,{type:"json"}),e)},a.h=iu,a.i=vc,a.j=Jr,a.k=t_,a.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>Jv(e,0,t))},a.m=class extends x_{},a.n=$l,a.o=Ya,a.p=Sw,a.q=jd,a.r=r,a.s=u,a.t=J,a.u=ra,a.v=Us,a.w=Do,a.x=ge,a.y=Q,a.z=Hu}),v(0,function(a){function Z(wt){const te=wt?wt.url.toString():void 0;return te?performance.getEntriesByName(te):[]}function ie(wt){if("number"==typeof wt||"boolean"==typeof wt||"string"==typeof wt||null==wt)return JSON.stringify(wt);if(Array.isArray(wt)){let ue="[";for(const Ge of wt)ue+=`${ie(Ge)},`;return`${ue}]`}let te="{";for(const ue of Object.keys(wt).sort())te+=`${ue}:${ie(wt[ue])},`;return`${te}}`}function T(wt){let te="";for(const ue of a.cE)te+=`/${ie(wt[ue])}`;return te}class Ce{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,ue){this._layerConfigs={},this._layers={},this.update(te,[],ue)}update(te,ue,Ge){this._options=Ge;for(const gt of te)this._layerConfigs[gt.id]=gt,(this._layers[gt.id]=a.cY(gt,this.scope,null,this._options)).compileFilter(),this.keyCache[gt.id]&&delete this.keyCache[gt.id];for(const gt of ue)delete this.keyCache[gt],delete this._layerConfigs[gt],delete this._layers[gt];this.familiesBySource={};const bt=function(gt,jt){const rn={};for(let on=0;on<gt.length;on++){const Un=jt&&jt[gt[on].id]||T(gt[on]);jt&&(jt[gt[on].id]=Un);let zn=rn[Un];zn||(zn=rn[Un]=[]),zn.push(gt[on])}const Ft=[];for(const on in rn)Ft.push(rn[on]);return Ft}(a.dG(this._layerConfigs),this.keyCache);for(const gt of bt){const jt=gt.map(Ei=>this._layers[Ei.id]),rn=jt[0];if("none"===rn.visibility)continue;const Ft=rn.source||"";let on=this.familiesBySource[Ft];on||(on=this.familiesBySource[Ft]={});const Un=rn.sourceLayer||"_geojsonTileLayer";let zn=on[Un];zn||(zn=on[Un]=[]),zn.push(jt)}}}const De=1*a.dJ;class Je{constructor(te){const ue={},Ge=[];for(const rn in te){const Ft=te[rn],on=ue[rn]={};for(const Un in Ft.glyphs){const zn=Ft.glyphs[+Un];if(!zn||0===zn.bitmap.width||0===zn.bitmap.height)continue;const Ei=zn.metrics.localGlyph?De:1,Ui={x:0,y:0,w:zn.bitmap.width+2*Ei,h:zn.bitmap.height+2*Ei};Ge.push(Ui),on[Un]=Ui}}const{w:bt,h:gt}=a.j(Ge),jt=new a.dI({width:bt||1,height:gt||1});for(const rn in te){const Ft=te[rn];for(const on in Ft.glyphs){const Un=Ft.glyphs[+on];if(!Un||0===Un.bitmap.width||0===Un.bitmap.height)continue;const zn=ue[rn][on],Ei=Un.metrics.localGlyph?De:1;a.dI.copy(Un.bitmap,jt,{x:0,y:0},{x:zn.x+Ei,y:zn.y+Ei},Un.bitmap)}}this.image=jt,this.positions=ue}}a.dH(Je,"GlyphAtlas");class re{constructor(te){this.tileID=new a.aL(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.lut=te.lut,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.scope=te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.collectResourceTiming,this.promoteId=te.promoteId,this.isSymbolTile=te.isSymbolTile,this.tileTransform=a.dK(te.tileID.canonical,te.projection),this.projection=te.projection,this.brightness=te.brightness,this.extraShadowCaster=!!te.extraShadowCaster,this.tessellationStep=te.tessellationStep}parse(te,ue,Ge,bt,gt){this.status="parsing",this.data=te,this.collisionBoxArray=new a.dL;const jt=new a.dM(Object.keys(te.layers).sort()),rn=new a.dN(this.tileID,this.promoteId);rn.bucketLayerIDs=[];const Ft={},on=new a.dO(256,256),Un={featureIndex:rn,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:on,availableImages:Ge,brightness:this.brightness},zn=ue.familiesBySource[this.source];for(const lt in zn){const Be=te.layers[lt];if(!Be)continue;let we=!1,Fe=!1,Gt=!1;for(const mt of zn[lt])"symbol"===mt[0].type?we=!0:Fe=!0,mt[0].is3D()&&"model"!==mt[0].type&&(Gt=!0);if(this.extraShadowCaster&&!Gt||!0===this.isSymbolTile&&!we||!1===this.isSymbolTile&&!Fe)continue;1===Be.version&&a.w(`Vector tile source "${this.source}" layer "${lt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const vn=jt.encode(lt),Ie=[];for(let mt=0;mt<Be.length;mt++){const Tt=Be.feature(mt),En=rn.getId(Tt,lt);Ie.push({feature:Tt,id:En,index:mt,sourceLayerIndex:vn})}for(const mt of zn[lt]){const Tt=mt[0];(!this.extraShadowCaster||Tt.is3D()&&"model"!==Tt.type)&&(void 0!==this.isSymbolTile&&"symbol"===Tt.type!==this.isSymbolTile||Tt.minzoom&&this.zoom<Math.floor(Tt.minzoom)||Tt.maxzoom&&this.zoom>=Tt.maxzoom||"none"!==Tt.visibility&&(ze(mt,this.zoom,Un.brightness,Ge),(Ft[Tt.id]=Tt.createBucket({index:rn.bucketLayerIDs.length,layers:mt,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Ie,Un,this.tileID.canonical,this.tileTransform),rn.bucketLayerIDs.push(mt.map(En=>En.id))))}}let Ei,Ui,qi,Ki;on.trim();const Gi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},nr=()=>{if(Ei)return this.status="done",gt(Ei);if(this.extraShadowCaster)this.status="done",gt(null,{buckets:a.dG(Ft).filter(lt=>!lt.isEmpty()),featureIndex:rn,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Un.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ui&&qi&&Ki){const lt=new Je(Ui),Be=new a.dQ(qi,Ki,this.lut);for(const we in Ft){const Fe=Ft[we];Fe instanceof a.dR?(ze(Fe.layers,this.zoom,Un.brightness,Ge),a.dS(Fe,Ui,lt.positions,qi,Be.iconPositions,this.showCollisionBoxes,Ge,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Fe.hasPattern&&(Fe instanceof a.dT||Fe instanceof a.dU||Fe instanceof a.b_)&&(ze(Fe.layers,this.zoom,Un.brightness,Ge),Fe.addFeatures(Un,this.tileID.canonical,Be.patternPositions,Ge,this.tileTransform,this.brightness))}this.status="done",gt(null,{buckets:a.dG(Ft).filter(we=>!we.isEmpty()),featureIndex:rn,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:lt.image,lineAtlas:on,imageAtlas:Be,brightness:Un.brightness})}};if(!this.extraShadowCaster){const lt=a.dP(Un.glyphDependencies,Fe=>Object.keys(Fe).map(Number));Object.keys(lt).length?bt.send("getGlyphs",{uid:this.uid,stacks:lt,scope:this.scope},(Fe,Gt)=>{Ei||(Ei=Fe,Ui=Gt,nr())},void 0,!1,Gi):Ui={};const Be=Object.keys(Un.iconDependencies);Be.length?bt.send("getImages",{icons:Be,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Fe,Gt)=>{Ei||(Ei=Fe,qi=Gt,nr())},void 0,!1,Gi):qi={};const we=Object.keys(Un.patternDependencies);we.length?bt.send("getImages",{icons:we,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Fe,Gt)=>{Ei||(Ei=Fe,Ki=Gt,nr())},void 0,!1,Gi):Ki={}}nr()}}function ze(wt,te,ue,Ge){const bt=new a.X(te,{brightness:ue});for(const gt of wt)gt.recalculate(bt,Ge)}class je extends a.E{constructor(te,ue,Ge,bt,gt,jt){super(),this.actor=te,this.layerIndex=ue,this.availableImages=Ge,this.loadVectorData=gt||a.ap,this.loading={},this.loaded={},this.deduped=new a.ao(te.scheduler),this.isSpriteLoaded=bt,this.scheduler=te.scheduler,this.brightness=jt}loadTile(te,ue){const Ge=te.uid,bt=te&&te.request,gt=bt&&bt.collectResourceTiming,jt=this.loading[Ge]=new re(te);jt.abort=this.loadVectorData(te,(rn,Ft)=>{const on=!this.loading[Ge];if(delete this.loading[Ge],on||rn||!Ft)return jt.status="done",on||(this.loaded[Ge]=jt),ue(rn);const Un=Ft.rawData,zn={};Ft.expires&&(zn.expires=Ft.expires),Ft.cacheControl&&(zn.cacheControl=Ft.cacheControl),jt.vectorTile=Ft.vectorTile||new a.dV(new a.dW(Un));const Ei=()=>{jt.parse(jt.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ui,qi)=>{if(Ui||!qi)return ue(Ui);const Ki={};if(gt){const Gi=Z(bt);Gi.length>0&&(Ki.resourceTiming=JSON.parse(JSON.stringify(Gi)))}ue(null,a.W({rawTileData:Un.slice(0)},qi,zn,Ki))})};this.isSpriteLoaded?Ei():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Ei,{type:"parseTile",isSymbolTile:te.isSymbolTile,zoom:te.tileZoom}):Ei()}),this.loaded=this.loaded||{},this.loaded[Ge]=jt})}reloadTile(te,ue){const Ge=this.loaded,bt=te.uid;if(Ge&&Ge[bt]){const gt=Ge[bt];gt.showCollisionBoxes=te.showCollisionBoxes,gt.projection=te.projection,gt.brightness=te.brightness,gt.tileTransform=a.dK(te.tileID.canonical,te.projection),gt.extraShadowCaster=te.extraShadowCaster,gt.lut=te.lut;const jt=(rn,Ft)=>{const on=gt.reloadCallback;on&&(delete gt.reloadCallback,gt.parse(gt.vectorTile,this.layerIndex,this.availableImages,this.actor,on)),ue(rn,Ft)};"parsing"===gt.status?gt.reloadCallback=jt:"done"===gt.status&&(gt.vectorTile?gt.parse(gt.vectorTile,this.layerIndex,this.availableImages,this.actor,jt):jt())}else ue(null,void 0)}abortTile(te,ue){const Ge=te.uid,bt=this.loading[Ge];bt&&(bt.abort&&bt.abort(),delete this.loading[Ge]),ue()}removeTile(te,ue){const Ge=this.loaded,bt=te.uid;Ge&&Ge[bt]&&delete Ge[bt],ue()}}class We{loadTile(te,ue){const{uid:Ge,encoding:bt,rawImageData:gt,padding:jt}=te,rn=ImageBitmap&&gt instanceof ImageBitmap?this.getImageData(gt,jt):gt;ue(null,new a.dX(Ge,rn,bt,jt<1))}getImageData(te,ue){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const Ge=this.offscreenCanvasContext.getImageData(-ue,-ue,te.width+2*ue,te.height+2*ue);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ge}}class Ne{decodeRasterArray({task:te,buffer:ue},Ge){a.dY.performDecoding(ue,te).then(bt=>{Ge(null,bt)},bt=>{Ge(bt)})}}const ht=a.dZ.prototype.toGeoJSON;let He=class{constructor(wt){this._feature=wt,this.extent=a.a3,this.type=wt.type,this.properties=wt.tags,"id"in wt&&!isNaN(wt.id)&&(this.id=parseInt(wt.id,10))}loadGeometry(){if(1===this._feature.type){const wt=[];for(const te of this._feature.geometry)wt.push([new a.P(te[0],te[1])]);return wt}{const wt=[];for(const te of this._feature.geometry){const ue=[];for(const Ge of te)ue.push(new a.P(Ge[0],Ge[1]));wt.push(ue)}return wt}}toGeoJSON(wt,te,ue){return ht.call(this,wt,te,ue)}},be=class{constructor(wt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.a3,this.length=wt.length,this._features=wt}feature(wt){return new He(this._features[wt])}};const Ye=64/4096;class Le{constructor(){this.features=new Map}clear(){this.features.clear()}load(te=[],ue){for(const Ge of te){const bt=Ge.id;if(null==bt)continue;let gt=this.features.get(bt);gt&&this.updateCache(gt,ue),Ge.geometry?(gt=Ve(Ge),this.updateCache(gt,ue),this.features.set(bt,gt)):this.features.delete(bt),this.updateCache(gt,ue)}}updateCache(te,ue){for(const{canonical:Ge,uid:bt}of Object.values(ue)){const{z:gt,x:jt,y:rn}=Ge;ot(te,Math.pow(2,gt),jt,rn)&&delete ue[bt]}}getTile(te,ue,Ge){const bt=Math.pow(2,te),gt=[];for(const jt of this.features.values())ot(jt,bt,ue,Ge)&&gt.push(xt(jt,bt,ue,Ge));return{features:gt}}getFeatures(){return[...this.features.values()]}}function ot({minX:wt,minY:te,maxX:ue,maxY:Ge},bt,gt,jt){return wt<(gt+1+Ye)/bt&&te<(jt+1+Ye)/bt&&ue>(gt-Ye)/bt&&Ge>(jt-Ye)/bt}function Ve(wt){const{id:te,geometry:ue,properties:Ge}=wt;if(!ue)return;if("GeometryCollection"===ue.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:bt,coordinates:gt}=ue,jt={id:te,type:1,geometry:[],tags:Ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},rn=jt.geometry;if("Point"===bt)Ue(gt,rn,jt);else if("MultiPoint"===bt)for(const Ft of gt)Ue(Ft,rn,jt);else if("LineString"===bt)jt.type=2,$t(gt,rn,jt);else if("MultiLineString"===bt)jt.type=2,nt(gt,rn,jt);else if("Polygon"===bt)jt.type=3,nt(gt,rn,jt,!0);else{if("MultiPolygon"!==bt)throw new Error("Input data is not a valid GeoJSON object.");jt.type=3;for(const Ft of gt)nt(Ft,rn,jt,!0)}return jt}function Ue([wt,te],ue,Ge){const bt=a.aj(wt);let gt=a.ak(te);gt=gt<0?0:gt>1?1:gt,ue.push(bt,gt),Ge.minX=Math.min(Ge.minX,bt),Ge.minY=Math.min(Ge.minY,gt),Ge.maxX=Math.max(Ge.maxX,bt),Ge.maxY=Math.max(Ge.maxY,gt)}function $t(wt,te,ue,Ge=!1,bt=!1){const gt=[];for(const jt of wt)Ue(jt,gt,ue);te.push(gt),Ge&&function(jt,rn){let Ft=0;for(let on=0,Un=jt.length,zn=Un-2;on<Un;zn=on,on+=2)Ft+=(jt[on]-jt[zn])*(jt[on+1]+jt[zn+1]);if(Ft>0===rn)for(let on=0,Un=jt.length;on<Un/2;on+=2){const zn=jt[on],Ei=jt[on+1];jt[on]=jt[Un-2-on],jt[on+1]=jt[Un-1-on],jt[Un-2-on]=zn,jt[Un-1-on]=Ei}}(gt,bt)}function nt(wt,te,ue,Ge=!1){for(let bt=0;bt<wt.length;bt++)$t(wt[bt],te,ue,Ge,0===bt)}function xt(wt,te,ue,Ge){const{id:bt,type:gt,geometry:jt,tags:rn}=wt,Ft=[];if(1===gt)ct(jt,te,ue,Ge,Ft);else for(const on of jt)Ft.push(ct(on,te,ue,Ge));return{id:bt,type:gt,geometry:Ft,tags:rn}}function ct(wt,te,ue,Ge,bt=[]){for(let gt=0;gt<wt.length;gt+=2)bt.push(Mt(wt[gt],wt[gt+1],te,ue,Ge));return bt}function Mt(wt,te,ue,Ge,bt){return[Math.round(a.a3*(wt*ue-Ge)),Math.round(a.a3*(te*ue-bt))]}var $e={exports:{}},Et=a.d$,cn=a.d_.VectorTileFeature,fn=Kn;function Kn(wt,te){this.options=te||{},this.features=wt,this.length=wt.length}function Kt(wt,te){this.id="number"==typeof wt.id?wt.id:void 0,this.type=wt.type,this.rawGeometry=1===wt.type?[wt.geometry]:wt.geometry,this.properties=wt.tags,this.extent=te||4096}Kn.prototype.feature=function(wt){return new Kt(this.features[wt],this.options.extent)},Kt.prototype.loadGeometry=function(){var wt=this.rawGeometry;this.geometry=[];for(var te=0;te<wt.length;te++){for(var ue=wt[te],Ge=[],bt=0;bt<ue.length;bt++)Ge.push(new Et(ue[bt][0],ue[bt][1]));this.geometry.push(Ge)}return this.geometry},Kt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var wt=this.geometry,te=1/0,ue=-1/0,Ge=1/0,bt=-1/0,gt=0;gt<wt.length;gt++)for(var jt=wt[gt],rn=0;rn<jt.length;rn++){var Ft=jt[rn];te=Math.min(te,Ft.x),ue=Math.max(ue,Ft.x),Ge=Math.min(Ge,Ft.y),bt=Math.max(bt,Ft.y)}return[te,Ge,ue,bt]},Kt.prototype.toGeoJSON=cn.prototype.toGeoJSON;var at=a.e0,ve=fn;function Me(wt){var te=new at;return function(ue,Ge){for(var bt in ue.layers)Ge.writeMessage(3,fe,ue.layers[bt])}(wt,te),te.finish()}function fe(wt,te){var ue;te.writeVarintField(15,wt.version||1),te.writeStringField(1,wt.name||""),te.writeVarintField(5,wt.extent||4096);var Ge={keys:[],values:[],keycache:{},valuecache:{}};for(ue=0;ue<wt.length;ue++)Ge.feature=wt.feature(ue),te.writeMessage(2,vt,Ge);var bt=Ge.keys;for(ue=0;ue<bt.length;ue++)te.writeStringField(3,bt[ue]);var gt=Ge.values;for(ue=0;ue<gt.length;ue++)te.writeMessage(4,tn,gt[ue])}function vt(wt,te){var ue=wt.feature;void 0!==ue.id&&te.writeVarintField(1,ue.id),te.writeMessage(2,_n,wt),te.writeVarintField(3,ue.type),te.writeMessage(4,it,ue)}function _n(wt,te){var ue=wt.feature,Ge=wt.keys,bt=wt.values,gt=wt.keycache,jt=wt.valuecache;for(var rn in ue.properties){var Ft=ue.properties[rn],on=gt[rn];if(null!==Ft){void 0===on&&(Ge.push(rn),gt[rn]=on=Ge.length-1),te.writeVarint(on);var Un=typeof Ft;"string"!==Un&&"boolean"!==Un&&"number"!==Un&&(Ft=JSON.stringify(Ft));var zn=Un+":"+Ft,Ei=jt[zn];void 0===Ei&&(bt.push(Ft),jt[zn]=Ei=bt.length-1),te.writeVarint(Ei)}}}function Re(wt,te){return(te<<3)+(7&wt)}function wn(wt){return wt<<1^wt>>31}function it(wt,te){for(var ue=wt.loadGeometry(),Ge=wt.type,bt=0,gt=0,jt=ue.length,rn=0;rn<jt;rn++){var Ft=ue[rn],on=1;1===Ge&&(on=Ft.length),te.writeVarint(Re(1,on));for(var Un=3===Ge?Ft.length-1:Ft.length,zn=0;zn<Un;zn++){1===zn&&1!==Ge&&te.writeVarint(Re(2,Un-1));var Ei=Ft[zn].x-bt,Ui=Ft[zn].y-gt;te.writeVarint(wn(Ei)),te.writeVarint(wn(Ui)),bt+=Ei,gt+=Ui}3===Ge&&te.writeVarint(Re(7,1))}}function tn(wt,te){var ue=typeof wt;"string"===ue?te.writeStringField(1,wt):"boolean"===ue?te.writeBooleanField(7,wt):"number"===ue&&(wt%1!=0?te.writeDoubleField(3,wt):wt<0?te.writeSVarintField(6,wt):te.writeVarintField(5,wt))}$e.exports=Me,$e.exports.fromVectorTileJs=Me,$e.exports.fromGeojsonVt=function(wt,te){te=te||{};var ue={};for(var Ge in wt)ue[Ge]=new ve(wt[Ge].features,te),ue[Ge].name=Ge,ue[Ge].version=te.version,ue[Ge].extent=te.extent;return Me({layers:ue})},$e.exports.GeoJSONWrapper=ve;var bn=a.e1($e.exports);const Jn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:wt=>wt},jn=Math.fround||(_i=new Float32Array(1),wt=>(_i[0]=+wt,_i[0]));var _i;const ut=3,nn=5,ui=6;class pn{constructor(te){this.options=Object.assign(Object.create(Jn),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:ue,minZoom:Ge,maxZoom:bt}=this.options;ue&&console.time("total time");const gt=`prepare ${te.length} points`;ue&&console.time(gt),this.points=te;const jt=[];for(let Ft=0;Ft<te.length;Ft++){const on=te[Ft];if(!on.geometry)continue;const[Un,zn]=on.geometry.coordinates,Ei=jn(Qt(Un)),Ui=jn(Se(zn));jt.push(Ei,Ui,1/0,Ft,-1,1),this.options.reduce&&jt.push(0)}let rn=this.trees[bt+1]=this._createTree(jt);ue&&console.timeEnd(gt);for(let Ft=bt;Ft>=Ge;Ft--){const on=+Date.now();rn=this.trees[Ft]=this._createTree(this._cluster(rn,Ft)),ue&&console.log("z%d: %d clusters in %dms",Ft,rn.numItems,+Date.now()-on)}return ue&&console.timeEnd("total time"),this}getClusters(te,ue){let Ge=((te[0]+180)%360+360)%360-180;const bt=Math.max(-90,Math.min(90,te[1]));let gt=180===te[2]?180:((te[2]+180)%360+360)%360-180;const jt=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)Ge=-180,gt=180;else if(Ge>gt){const zn=this.getClusters([Ge,bt,180,jt],ue),Ei=this.getClusters([-180,bt,gt,jt],ue);return zn.concat(Ei)}const rn=this.trees[this._limitZoom(ue)],Ft=rn.range(Qt(Ge),Se(jt),Qt(gt),Se(bt)),on=rn.data,Un=[];for(const zn of Ft){const Ei=this.stride*zn;Un.push(on[Ei+nn]>1?An(on,Ei,this.clusterProps):this.points[on[Ei+ut]])}return Un}getChildren(te){const ue=this._getOriginId(te),Ge=this._getOriginZoom(te),bt="No cluster with the specified id.",gt=this.trees[Ge];if(!gt)throw new Error(bt);const jt=gt.data;if(ue*this.stride>=jt.length)throw new Error(bt);const rn=this.options.radius/(this.options.extent*Math.pow(2,Ge-1)),Ft=gt.within(jt[ue*this.stride],jt[ue*this.stride+1],rn),on=[];for(const Un of Ft){const zn=Un*this.stride;jt[zn+4]===te&&on.push(jt[zn+nn]>1?An(jt,zn,this.clusterProps):this.points[jt[zn+ut]])}if(0===on.length)throw new Error(bt);return on}getLeaves(te,ue,Ge){const bt=[];return this._appendLeaves(bt,te,ue=ue||10,Ge=Ge||0,0),bt}getTile(te,ue,Ge){const bt=this.trees[this._limitZoom(te)],gt=Math.pow(2,te),{extent:jt,radius:rn}=this.options,Ft=rn/jt,on=(Ge-Ft)/gt,Un=(Ge+1+Ft)/gt,zn={features:[]};return this._addTileFeatures(bt.range((ue-Ft)/gt,on,(ue+1+Ft)/gt,Un),bt.data,ue,Ge,gt,zn),0===ue&&this._addTileFeatures(bt.range(1-Ft/gt,on,1,Un),bt.data,gt,Ge,gt,zn),ue===gt-1&&this._addTileFeatures(bt.range(0,on,Ft/gt,Un),bt.data,-1,Ge,gt,zn),zn.features.length?zn:null}getClusterExpansionZoom(te){let ue=this._getOriginZoom(te)-1;for(;ue<=this.options.maxZoom;){const Ge=this.getChildren(te);if(ue++,1!==Ge.length)break;te=Ge[0].properties.cluster_id}return ue}_appendLeaves(te,ue,Ge,bt,gt){const jt=this.getChildren(ue);for(const rn of jt){const Ft=rn.properties;if(Ft&&Ft.cluster?gt+Ft.point_count<=bt?gt+=Ft.point_count:gt=this._appendLeaves(te,Ft.cluster_id,Ge,bt,gt):gt<bt?gt++:te.push(rn),te.length===Ge)break}return gt}_createTree(te){const ue=new a.cK(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ge=0;Ge<te.length;Ge+=this.stride)ue.add(te[Ge],te[Ge+1]);return ue.finish(),ue.data=te,ue}_addTileFeatures(te,ue,Ge,bt,gt,jt){for(const rn of te){const Ft=rn*this.stride,on=ue[Ft+nn]>1;let Un,zn,Ei;if(on)Un=Ct(ue,Ft,this.clusterProps),zn=ue[Ft],Ei=ue[Ft+1];else{const Ki=this.points[ue[Ft+ut]];Un=Ki.properties;const[Gi,nr]=Ki.geometry.coordinates;zn=Qt(Gi),Ei=Se(nr)}const Ui={type:1,geometry:[[Math.round(this.options.extent*(zn*gt-Ge)),Math.round(this.options.extent*(Ei*gt-bt))]],tags:Un};let qi;qi=on||this.options.generateId?ue[Ft+ut]:this.points[ue[Ft+ut]].id,void 0!==qi&&(Ui.id=qi),jt.features.push(Ui)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,ue){const{radius:Ge,extent:bt,reduce:gt,minPoints:jt}=this.options,rn=Ge/(bt*Math.pow(2,ue)),Ft=te.data,on=[],Un=this.stride;for(let zn=0;zn<Ft.length;zn+=Un){if(Ft[zn+2]<=ue)continue;Ft[zn+2]=ue;const Ei=Ft[zn],Ui=Ft[zn+1],qi=te.within(Ft[zn],Ft[zn+1],rn),Ki=Ft[zn+nn];let Gi=Ki;for(const nr of qi){const lt=nr*Un;Ft[lt+2]>ue&&(Gi+=Ft[lt+nn])}if(Gi>Ki&&Gi>=jt){let nr,lt=Ei*Ki,Be=Ui*Ki,we=-1;const Fe=(zn/Un<<5)+(ue+1)+this.points.length;for(const Gt of qi){const vn=Gt*Un;if(Ft[vn+2]<=ue)continue;Ft[vn+2]=ue;const Ie=Ft[vn+nn];lt+=Ft[vn]*Ie,Be+=Ft[vn+1]*Ie,Ft[vn+4]=Fe,gt&&(nr||(nr=this._map(Ft,zn,!0),we=this.clusterProps.length,this.clusterProps.push(nr)),gt(nr,this._map(Ft,vn)))}Ft[zn+4]=Fe,on.push(lt/Gi,Be/Gi,1/0,Fe,-1,Gi),gt&&on.push(we)}else{for(let nr=0;nr<Un;nr++)on.push(Ft[zn+nr]);if(Gi>1)for(const nr of qi){const lt=nr*Un;if(!(Ft[lt+2]<=ue)){Ft[lt+2]=ue;for(let Be=0;Be<Un;Be++)on.push(Ft[lt+Be])}}}}return on}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,ue,Ge){if(te[ue+nn]>1){const jt=this.clusterProps[te[ue+ui]];return Ge?Object.assign({},jt):jt}const bt=this.points[te[ue+ut]].properties,gt=this.options.map(bt);return Ge&&gt===bt?Object.assign({},gt):gt}}function An(wt,te,ue){return{type:"Feature",id:wt[te+ut],properties:Ct(wt,te,ue),geometry:{type:"Point",coordinates:[(Ge=wt[te],360*(Ge-.5)),Bt(wt[te+1])]}};var Ge}function Ct(wt,te,ue){const Ge=wt[te+nn],bt=Ge>=1e4?`${Math.round(Ge/1e3)}k`:Ge>=1e3?Math.round(Ge/100)/10+"k":Ge,gt=wt[te+ui],jt=-1===gt?{}:Object.assign({},ue[gt]);return Object.assign(jt,{cluster:!0,cluster_id:wt[te+ut],point_count:Ge,point_count_abbreviated:bt})}function Qt(wt){return wt/360+.5}function Se(wt){const te=Math.sin(wt*Math.PI/180),ue=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ue<0?0:ue>1?1:ue}function Bt(wt){const te=(180-360*wt)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function Nt(wt,te,ue,Ge){let bt=Ge;const gt=te+(ue-te>>1);let jt,rn=ue-te;const Ft=wt[te],on=wt[te+1],Un=wt[ue],zn=wt[ue+1];for(let Ei=te+3;Ei<ue;Ei+=3){const Ui=Rn(wt[Ei],wt[Ei+1],Ft,on,Un,zn);if(Ui>bt)jt=Ei,bt=Ui;else if(Ui===bt){const qi=Math.abs(Ei-gt);qi<rn&&(jt=Ei,rn=qi)}}bt>Ge&&(jt-te>3&&Nt(wt,te,jt,Ge),wt[jt+2]=bt,ue-jt>3&&Nt(wt,jt,ue,Ge))}function Rn(wt,te,ue,Ge,bt,gt){let jt=bt-ue,rn=gt-Ge;if(0!==jt||0!==rn){const Ft=((wt-ue)*jt+(te-Ge)*rn)/(jt*jt+rn*rn);Ft>1?(ue=bt,Ge=gt):Ft>0&&(ue+=jt*Ft,Ge+=rn*Ft)}return jt=wt-ue,rn=te-Ge,jt*jt+rn*rn}function Ci(wt,te,ue,Ge){const bt={id:wt??null,type:te,geometry:ue,tags:Ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===te||"MultiPoint"===te||"LineString"===te)Oi(bt,ue);else if("Polygon"===te)Oi(bt,ue[0]);else if("MultiLineString"===te)for(const gt of ue)Oi(bt,gt);else if("MultiPolygon"===te)for(const gt of ue)Oi(bt,gt[0]);return bt}function Oi(wt,te){for(let ue=0;ue<te.length;ue+=3)wt.minX=Math.min(wt.minX,te[ue]),wt.minY=Math.min(wt.minY,te[ue+1]),wt.maxX=Math.max(wt.maxX,te[ue]),wt.maxY=Math.max(wt.maxY,te[ue+1])}function ei(wt,te,ue,Ge){if(!te.geometry)return;const bt=te.geometry.coordinates;if(bt&&0===bt.length)return;const gt=te.geometry.type,jt=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2);let rn=[],Ft=te.id;if(ue.promoteId?Ft=te.properties[ue.promoteId]:ue.generateId&&(Ft=Ge||0),"Point"===gt)no(bt,rn);else if("MultiPoint"===gt)for(const on of bt)no(on,rn);else if("LineString"===gt)mo(bt,rn,jt,!1);else if("MultiLineString"===gt){if(ue.lineMetrics){for(const on of bt)rn=[],mo(on,rn,jt,!1),wt.push(Ci(Ft,"LineString",rn,te.properties));return}mr(bt,rn,jt,!1)}else if("Polygon"===gt)mr(bt,rn,jt,!0);else{if("MultiPolygon"!==gt){if("GeometryCollection"===gt){for(const on of te.geometry.geometries)ei(wt,{id:Ft,geometry:on,properties:te.properties},ue,Ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const on of bt){const Un=[];mr(on,Un,jt,!0),rn.push(Un)}}wt.push(Ci(Ft,gt,rn,te.properties))}function no(wt,te){te.push($n(wt[0]),ar(wt[1]),0)}function mo(wt,te,ue,Ge){let bt,gt,jt=0;for(let Ft=0;Ft<wt.length;Ft++){const on=$n(wt[Ft][0]),Un=ar(wt[Ft][1]);te.push(on,Un,0),Ft>0&&(jt+=Ge?(bt*Un-on*gt)/2:Math.sqrt(Math.pow(on-bt,2)+Math.pow(Un-gt,2))),bt=on,gt=Un}const rn=te.length-3;te[2]=1,Nt(te,0,rn,ue),te[rn+2]=1,te.size=Math.abs(jt),te.start=0,te.end=te.size}function mr(wt,te,ue,Ge){for(let bt=0;bt<wt.length;bt++){const gt=[];mo(wt[bt],gt,ue,Ge),te.push(gt)}}function $n(wt){return wt/360+.5}function ar(wt){const te=Math.sin(wt*Math.PI/180),ue=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ue<0?0:ue>1?1:ue}function gn(wt,te,ue,Ge,bt,gt,jt,rn){if(Ge/=te,gt>=(ue/=te)&&jt<Ge)return wt;if(jt<ue||gt>=Ge)return null;const Ft=[];for(const on of wt){const Un=on.geometry;let zn=on.type;const Ei=0===bt?on.minX:on.minY,Ui=0===bt?on.maxX:on.maxY;if(Ei>=ue&&Ui<Ge){Ft.push(on);continue}if(Ui<ue||Ei>=Ge)continue;let qi=[];if("Point"===zn||"MultiPoint"===zn)ii(Un,qi,ue,Ge,bt);else if("LineString"===zn)oi(Un,qi,ue,Ge,bt,!1,rn.lineMetrics);else if("MultiLineString"===zn)pr(Un,qi,ue,Ge,bt,!1);else if("Polygon"===zn)pr(Un,qi,ue,Ge,bt,!0);else if("MultiPolygon"===zn)for(const Ki of Un){const Gi=[];pr(Ki,Gi,ue,Ge,bt,!0),Gi.length&&qi.push(Gi)}if(qi.length){if(rn.lineMetrics&&"LineString"===zn){for(const Ki of qi)Ft.push(Ci(on.id,zn,Ki,on.tags));continue}"LineString"!==zn&&"MultiLineString"!==zn||(1===qi.length?(zn="LineString",qi=qi[0]):zn="MultiLineString"),"Point"!==zn&&"MultiPoint"!==zn||(zn=3===qi.length?"Point":"MultiPoint"),Ft.push(Ci(on.id,zn,qi,on.tags))}}return Ft.length?Ft:null}function ii(wt,te,ue,Ge,bt){for(let gt=0;gt<wt.length;gt+=3){const jt=wt[gt+bt];jt>=ue&&jt<=Ge&&io(te,wt[gt],wt[gt+1],wt[gt+2])}}function oi(wt,te,ue,Ge,bt,gt,jt){let rn=Yi(wt);const Ft=0===bt?ao:ro;let on,Un,zn=wt.start;for(let Gi=0;Gi<wt.length-3;Gi+=3){const nr=wt[Gi],lt=wt[Gi+1],Be=wt[Gi+2],we=wt[Gi+3],Fe=wt[Gi+4],Gt=0===bt?nr:lt,vn=0===bt?we:Fe;let Ie=!1;jt&&(on=Math.sqrt(Math.pow(nr-we,2)+Math.pow(lt-Fe,2))),Gt<ue?vn>ue&&(Un=Ft(rn,nr,lt,we,Fe,ue),jt&&(rn.start=zn+on*Un)):Gt>Ge?vn<Ge&&(Un=Ft(rn,nr,lt,we,Fe,Ge),jt&&(rn.start=zn+on*Un)):io(rn,nr,lt,Be),vn<ue&&Gt>=ue&&(Un=Ft(rn,nr,lt,we,Fe,ue),Ie=!0),vn>Ge&&Gt<=Ge&&(Un=Ft(rn,nr,lt,we,Fe,Ge),Ie=!0),!gt&&Ie&&(jt&&(rn.end=zn+on*Un),te.push(rn),rn=Yi(wt)),jt&&(zn+=on)}let Ei=wt.length-3;const Ui=wt[Ei],qi=wt[Ei+1],Ki=0===bt?Ui:qi;Ki>=ue&&Ki<=Ge&&io(rn,Ui,qi,wt[Ei+2]),Ei=rn.length-3,gt&&Ei>=3&&(rn[Ei]!==rn[0]||rn[Ei+1]!==rn[1])&&io(rn,rn[0],rn[1],rn[2]),rn.length&&te.push(rn)}function Yi(wt){const te=[];return te.size=wt.size,te.start=wt.start,te.end=wt.end,te}function pr(wt,te,ue,Ge,bt,gt){for(const jt of wt)oi(jt,te,ue,Ge,bt,gt,!1)}function io(wt,te,ue,Ge){wt.push(te,ue,Ge)}function ao(wt,te,ue,Ge,bt,gt){const jt=(gt-te)/(Ge-te);return io(wt,gt,ue+(bt-ue)*jt,1),jt}function ro(wt,te,ue,Ge,bt,gt){const jt=(gt-ue)/(bt-ue);return io(wt,te+(Ge-te)*jt,gt,1),jt}function co(wt,te){const ue=[];for(let Ge=0;Ge<wt.length;Ge++){const bt=wt[Ge],gt=bt.type;let jt;if("Point"===gt||"MultiPoint"===gt||"LineString"===gt)jt=Po(bt.geometry,te);else if("MultiLineString"===gt||"Polygon"===gt){jt=[];for(const rn of bt.geometry)jt.push(Po(rn,te))}else if("MultiPolygon"===gt){jt=[];for(const rn of bt.geometry){const Ft=[];for(const on of rn)Ft.push(Po(on,te));jt.push(Ft)}}ue.push(Ci(bt.id,gt,jt,bt.tags))}return ue}function Po(wt,te){const ue=[];ue.size=wt.size,void 0!==wt.start&&(ue.start=wt.start,ue.end=wt.end);for(let Ge=0;Ge<wt.length;Ge+=3)ue.push(wt[Ge]+te,wt[Ge+1],wt[Ge+2]);return ue}function go(wt,te){if(wt.transformed)return wt;const ue=1<<wt.z,Ge=wt.x,bt=wt.y;for(const gt of wt.features){const jt=gt.geometry,rn=gt.type;if(gt.geometry=[],1===rn)for(let Ft=0;Ft<jt.length;Ft+=2)gt.geometry.push(bo(jt[Ft],jt[Ft+1],te,ue,Ge,bt));else for(let Ft=0;Ft<jt.length;Ft++){const on=[];for(let Un=0;Un<jt[Ft].length;Un+=2)on.push(bo(jt[Ft][Un],jt[Ft][Un+1],te,ue,Ge,bt));gt.geometry.push(on)}}return wt.transformed=!0,wt}function bo(wt,te,ue,Ge,bt,gt){return[Math.round(ue*(wt*Ge-bt)),Math.round(ue*(te*Ge-gt))]}function Bn(wt,te,ue,Ge,bt){const gt=te===bt.maxZoom?0:bt.tolerance/((1<<te)*bt.extent),jt={features:[],numPoints:0,numSimplified:0,numFeatures:wt.length,source:null,x:ue,y:Ge,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const rn of wt)Cn(jt,rn,gt,bt);return jt}function Cn(wt,te,ue,Ge){const bt=te.geometry,gt=te.type,jt=[];if(wt.minX=Math.min(wt.minX,te.minX),wt.minY=Math.min(wt.minY,te.minY),wt.maxX=Math.max(wt.maxX,te.maxX),wt.maxY=Math.max(wt.maxY,te.maxY),"Point"===gt||"MultiPoint"===gt)for(let rn=0;rn<bt.length;rn+=3)jt.push(bt[rn],bt[rn+1]),wt.numPoints++,wt.numSimplified++;else if("LineString"===gt)At(jt,bt,wt,ue,!1,!1);else if("MultiLineString"===gt||"Polygon"===gt)for(let rn=0;rn<bt.length;rn++)At(jt,bt[rn],wt,ue,"Polygon"===gt,0===rn);else if("MultiPolygon"===gt)for(let rn=0;rn<bt.length;rn++){const Ft=bt[rn];for(let on=0;on<Ft.length;on++)At(jt,Ft[on],wt,ue,!0,0===on)}if(jt.length){let rn=te.tags||null;if("LineString"===gt&&Ge.lineMetrics){rn={};for(const on in te.tags)rn[on]=te.tags[on];rn.mapbox_clip_start=bt.start/bt.size,rn.mapbox_clip_end=bt.end/bt.size}const Ft={geometry:jt,type:"Polygon"===gt||"MultiPolygon"===gt?3:"LineString"===gt||"MultiLineString"===gt?2:1,tags:rn};null!==te.id&&(Ft.id=te.id),wt.features.push(Ft)}}function At(wt,te,ue,Ge,bt,gt){const jt=Ge*Ge;if(Ge>0&&te.size<(bt?jt:Ge))return void(ue.numPoints+=te.length/3);const rn=[];for(let Ft=0;Ft<te.length;Ft+=3)(0===Ge||te[Ft+2]>jt)&&(ue.numSimplified++,rn.push(te[Ft],te[Ft+1])),ue.numPoints++;bt&&function(Ft,on){let Un=0;for(let zn=0,Ei=Ft.length,Ui=Ei-2;zn<Ei;Ui=zn,zn+=2)Un+=(Ft[zn]-Ft[Ui])*(Ft[zn+1]+Ft[Ui+1]);if(Un>0===on)for(let zn=0,Ei=Ft.length;zn<Ei/2;zn+=2){const Ui=Ft[zn],qi=Ft[zn+1];Ft[zn]=Ft[Ei-2-zn],Ft[zn+1]=Ft[Ei-1-zn],Ft[Ei-2-zn]=Ui,Ft[Ei-1-zn]=qi}}(rn,gt),wt.push(rn)}const an={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class pt{constructor(te,ue){const Ge=(ue=this.options=function(gt,jt){for(const rn in jt)gt[rn]=jt[rn];return gt}(Object.create(an),ue)).debug;if(Ge&&console.time("preprocess data"),ue.maxZoom<0||ue.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ue.promoteId&&ue.generateId)throw new Error("promoteId and generateId cannot be used together.");let bt=function(gt,jt){const rn=[];if("FeatureCollection"===gt.type)for(let Ft=0;Ft<gt.features.length;Ft++)ei(rn,gt.features[Ft],jt,Ft);else ei(rn,"Feature"===gt.type?gt:{geometry:gt},jt);return rn}(te,ue);this.tiles={},this.tileCoords=[],Ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ue.indexMaxZoom,ue.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),bt=function(gt,jt){const rn=jt.buffer/jt.extent;let Ft=gt;const on=gn(gt,1,-1-rn,rn,0,-1,2,jt),Un=gn(gt,1,1-rn,2+rn,0,-1,2,jt);return(on||Un)&&(Ft=gn(gt,1,-rn,1+rn,0,-1,2,jt)||[],on&&(Ft=co(on,1).concat(Ft)),Un&&(Ft=Ft.concat(co(Un,-1)))),Ft}(bt,ue),bt.length&&this.splitTile(bt,0,0,0),Ge&&(bt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,ue,Ge,bt,gt,jt,rn){const Ft=[te,ue,Ge,bt],on=this.options,Un=on.debug;for(;Ft.length;){bt=Ft.pop(),Ge=Ft.pop(),ue=Ft.pop(),te=Ft.pop();const zn=1<<ue,Ei=On(ue,Ge,bt);let Ui=this.tiles[Ei];if(!Ui&&(Un>1&&console.time("creation"),Ui=this.tiles[Ei]=Bn(te,ue,Ge,bt,on),this.tileCoords.push({z:ue,x:Ge,y:bt}),Un)){Un>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ue,Ge,bt,Ui.numFeatures,Ui.numPoints,Ui.numSimplified),console.timeEnd("creation"));const Ie=`z${ue}`;this.stats[Ie]=(this.stats[Ie]||0)+1,this.total++}if(Ui.source=te,null==gt){if(ue===on.indexMaxZoom||Ui.numPoints<=on.indexMaxPoints)continue}else{if(ue===on.maxZoom||ue===gt)continue;if(null!=gt){const Ie=gt-ue;if(Ge!==jt>>Ie||bt!==rn>>Ie)continue}}if(Ui.source=null,0===te.length)continue;Un>1&&console.time("clipping");const qi=.5*on.buffer/on.extent,Ki=.5-qi,Gi=.5+qi,nr=1+qi;let lt=null,Be=null,we=null,Fe=null,Gt=gn(te,zn,Ge-qi,Ge+Gi,0,Ui.minX,Ui.maxX,on),vn=gn(te,zn,Ge+Ki,Ge+nr,0,Ui.minX,Ui.maxX,on);te=null,Gt&&(lt=gn(Gt,zn,bt-qi,bt+Gi,1,Ui.minY,Ui.maxY,on),Be=gn(Gt,zn,bt+Ki,bt+nr,1,Ui.minY,Ui.maxY,on),Gt=null),vn&&(we=gn(vn,zn,bt-qi,bt+Gi,1,Ui.minY,Ui.maxY,on),Fe=gn(vn,zn,bt+Ki,bt+nr,1,Ui.minY,Ui.maxY,on),vn=null),Un>1&&console.timeEnd("clipping"),Ft.push(lt||[],ue+1,2*Ge,2*bt),Ft.push(Be||[],ue+1,2*Ge,2*bt+1),Ft.push(we||[],ue+1,2*Ge+1,2*bt),Ft.push(Fe||[],ue+1,2*Ge+1,2*bt+1)}}getTile(te,ue,Ge){te=+te,ue=+ue,Ge=+Ge;const bt=this.options,{extent:gt,debug:jt}=bt;if(te<0||te>24)return null;const rn=1<<te,Ft=On(te,ue=ue+rn&rn-1,Ge);if(this.tiles[Ft])return go(this.tiles[Ft],gt);jt>1&&console.log("drilling down to z%d-%d-%d",te,ue,Ge);let on,Un=te,zn=ue,Ei=Ge;for(;!on&&Un>0;)Un--,zn>>=1,Ei>>=1,on=this.tiles[On(Un,zn,Ei)];return on&&on.source?(jt>1&&(console.log("found parent tile z%d-%d-%d",Un,zn,Ei),console.time("drilling down")),this.splitTile(on.source,Un,zn,Ei,te,ue,Ge),jt>1&&console.timeEnd("drilling down"),this.tiles[Ft]?go(this.tiles[Ft],gt):null):null}}function On(wt,te,ue){return 32*((1<<wt)*ue+te)+wt}function Ze(wt,te){const ue=wt.tileID.canonical;if(!this._geoJSONIndex)return te(null,null);const Ge=this._geoJSONIndex.getTile(ue.z,ue.x,ue.y);if(!Ge)return te(null,null);const bt=new be(Ge.features);let gt=bn(bt);0===gt.byteOffset&&gt.byteLength===gt.buffer.byteLength||(gt=new Uint8Array(gt)),te(null,{vectorTile:bt,rawData:gt.buffer})}class Ln extends je{constructor(te,ue,Ge,bt,gt,jt){super(te,ue,Ge,bt,Ze,jt),gt&&(this.loadGeoJSON=gt),this._dynamicIndex=new Le}loadData(te,ue){const Ge=te&&te.request,bt=Ge&&Ge.collectResourceTiming;this.loadGeoJSON(te,(gt,jt)=>{if(gt||!jt)return ue(gt);if("object"!=typeof jt)return ue(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{try{if(te.filter){const Ft=a.y(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ft.result)throw new Error(Ft.value.map(on=>`${on.key}: ${on.message}`).join(", "));jt.features=jt.features.filter(on=>Ft.value.evaluate({zoom:0},on))}te.dynamic?("Feature"===jt.type&&(jt={type:"FeatureCollection",features:[jt]}),te.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(jt.features,this.loaded),te.cluster&&(jt.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=te.cluster?new pn(function({superclusterOptions:Ft,clusterProperties:on}){if(!on||!Ft)return Ft;const Un={},zn={},Ei={accumulated:null,zoom:0},Ui={properties:null},qi=Object.keys(on);for(const Ki of qi){const[Gi,nr]=on[Ki],lt=a.y(nr),Be=a.y("string"==typeof Gi?[Gi,["accumulated"],["get",Ki]]:Gi);Un[Ki]=lt.value,zn[Ki]=Be.value}return Ft.map=Ki=>{Ui.properties=Ki;const Gi={};for(const nr of qi)Gi[nr]=Un[nr].evaluate(Ei,Ui);return Gi},Ft.reduce=(Ki,Gi)=>{Ui.properties=Gi;for(const nr of qi)Ei.accumulated=Ki[nr],Ki[nr]=zn[nr].evaluate(Ei,Ui)},Ft}(te)).load(jt.features):te.dynamic?this._dynamicIndex:new pt(Ft=jt,te.geojsonVtOptions)}catch(Ft){return ue(Ft)}const rn={};if(bt){const Ft=Z(Ge);Ft&&(rn.resourceTiming={},rn.resourceTiming[te.source]=JSON.parse(JSON.stringify(Ft)))}ue(null,rn)}var Ft})}reloadTile(te,ue){const Ge=this.loaded;return Ge&&Ge[te.uid]?te.partial?ue(null,void 0):super.reloadTile(te,ue):this.loadTile(te,ue)}loadGeoJSON(te,ue){if(te.request)a.g(te.request,ue);else{if("string"!=typeof te.data)return ue(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));try{return ue(null,JSON.parse(te.data))}catch{return ue(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(te,ue){try{ue(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(Ge){ue(Ge)}}getClusterChildren(te,ue){try{ue(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(Ge){ue(Ge)}}getClusterLeaves(te,ue){try{ue(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(Ge){ue(Ge)}}}class Dn{constructor(te,ue){this.tileID=new a.aL(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=ue}parse(te,ue,Ge,bt){this.status="parsing";const gt=new a.aL(Ge.tileID.overscaledZ,Ge.tileID.wrap,Ge.tileID.canonical.z,Ge.tileID.canonical.x,Ge.tileID.canonical.y),jt={},rn=ue.familiesBySource[Ge.source],Ft=new a.dN(gt,Ge.promoteId);return Ft.bucketLayerIDs=[],Ft.is3DTile=!0,a.e3(te).then(on=>{if(!on)return bt(new Error("Could not parse tile"));const Un=a.e4(on,1/a.b5(Ge.tileID.canonical)),zn=on.json.extensionsUsed&&on.json.extensionsUsed.includes("MAPBOX_mesh_features")||on.json.asset.extras&&on.json.asset.extras.MAPBOX_mesh_features,Ei=on.json.extensionsUsed&&on.json.extensionsUsed.includes("EXT_meshopt_compression"),Ui=new a.X(this.zoom,{brightness:this.brightness});for(const qi in rn)for(const Ki of rn[qi]){const Gi=Ki[0];Ft.bucketLayerIDs.push(Ki.map(lt=>lt.id)),Gi.recalculate(Ui,[]);const nr=new a.e5(Un,gt,zn,Ei,this.brightness,Ft);zn||(nr.needsUpload=!0),jt[Gi.fqid]=nr,nr.evaluate(Gi)}this.status="done",bt(null,{buckets:jt,featureIndex:Ft})}).catch(on=>bt(new Error(on.message)))}}class ki{constructor(te,ue,Ge,bt,gt,jt){this.actor=te,this.layerIndex=ue,this.brightness=jt,this.loading={},this.loaded={}}loadTile(te,ue){const Ge=te.uid,bt=this.loading[Ge]=new Dn(te,this.brightness);a.e2(te.request,(gt,jt)=>{const rn=!this.loading[Ge];return delete this.loading[Ge],rn||gt?(bt.status="done",rn||(this.loaded[Ge]=bt),ue(gt)):jt&&0!==jt.byteLength?void bt.parse(jt,this.layerIndex,te,(Ft,on)=>{bt.status="done",this.loaded=this.loaded||{},this.loaded[Ge]=bt,Ft||!on?ue(Ft):ue(null,on)}):(bt.status="done",this.loaded[Ge]=bt,ue())})}reloadTile(te,ue){const Ge=this.loaded,bt=te.uid;if(Ge&&Ge[bt]){const gt=Ge[bt];gt.projection=te.projection,gt.brightness=te.brightness;const jt=(rn,Ft)=>{gt.reloadCallback&&(delete gt.reloadCallback,this.loadTile(te,ue)),ue(rn,Ft)};"parsing"===gt.status?gt.reloadCallback=jt:"done"===gt.status&&this.loadTile(te,ue)}}abortTile(te,ue){const Ge=te.uid;this.loading[Ge]&&delete this.loading[Ge],ue()}removeTile(te,ue){const Ge=this.loaded,bt=te.uid;Ge&&Ge[bt]&&delete Ge[bt],ue()}}class Fi{constructor(te){this.self=te,this.actor=new a.e6(te,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.aJ({name:"mercator"}),this.workerSourceTypes={vector:je,geojson:Ln,"batched-model":ki},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ue,Ge)=>{if(this.workerSourceTypes[ue])throw new Error(`Worker source with name "${ue}" already registered.`);this.workerSourceTypes[ue]=Ge},this.self.registerRTLTextPlugin=ue=>{if(a.e7.isParsed())throw new Error("RTL text plugin already registered.");a.e7.applyArabicShaping=ue.applyArabicShaping,a.e7.processBidirectionalText=ue.processBidirectionalText,a.e7.processStyledBidirectionalText=ue.processStyledBidirectionalText}}clearCaches(te,ue,Ge){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te],delete this.rasterArrayWorkerSource,Ge()}checkIfReady(te,ue,Ge){Ge()}setReferrer(te,ue){this.referrer=ue}spriteLoaded(te,{scope:ue,isLoaded:Ge}){if(this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),this.isSpriteLoaded[te][ue]=Ge,this.workerSources[te]&&this.workerSources[te][ue])for(const bt in this.workerSources[te][ue]){const gt=this.workerSources[te][ue][bt];for(const jt in gt){const rn=gt[jt];rn instanceof je&&(rn.isSpriteLoaded=Ge,rn.fire(new a.f("isSpriteLoaded")))}}}setImages(te,{scope:ue,images:Ge},bt){if(this.availableImages[te]||(this.availableImages[te]={}),this.availableImages[te][ue]=Ge,this.workerSources[te]&&this.workerSources[te][ue]){for(const gt in this.workerSources[te][ue]){const jt=this.workerSources[te][ue][gt];for(const rn in jt)jt[rn].availableImages=Ge}bt()}else bt()}setProjection(te,ue){this.projections[te]=a.aJ(ue)}setBrightness(te,ue,Ge){this.brightness=ue,Ge()}setLayers(te,ue,Ge){this.getLayerIndex(te,ue.scope).replace(ue.layers,ue.options),Ge()}updateLayers(te,ue,Ge){this.getLayerIndex(te,ue.scope).update(ue.layers,ue.removedIds,ue.options),Ge()}loadTile(te,ue,Ge){ue.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,ue.type,ue.source,ue.scope).loadTile(ue,Ge)}loadDEMTile(te,ue,Ge){this.getDEMWorkerSource(te,ue.source,ue.scope).loadTile(ue,Ge)}decodeRasterArray(te,ue,Ge){this.getRasterArrayWorkerSource().decodeRasterArray(ue,Ge)}reloadTile(te,ue,Ge){ue.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,ue.type,ue.source,ue.scope).reloadTile(ue,Ge)}abortTile(te,ue,Ge){this.getWorkerSource(te,ue.type,ue.source,ue.scope).abortTile(ue,Ge)}removeTile(te,ue,Ge){this.getWorkerSource(te,ue.type,ue.source,ue.scope).removeTile(ue,Ge)}removeSource(te,ue,Ge){if(!(this.workerSources[te]&&this.workerSources[te][ue.scope]&&this.workerSources[te][ue.scope][ue.type]&&this.workerSources[te][ue.scope][ue.type][ue.source]))return;const bt=this.workerSources[te][ue.scope][ue.type][ue.source];delete this.workerSources[te][ue.scope][ue.type][ue.source],void 0!==bt.removeSource?bt.removeSource(ue,Ge):Ge()}loadWorkerSource(te,ue,Ge){try{this.self.importScripts(ue.url),Ge()}catch(bt){Ge(bt.toString())}}syncRTLPluginState(te,ue,Ge){try{a.e7.setState(ue);const bt=a.e7.getPluginURL();if(a.e7.isLoaded()&&!a.e7.isParsed()&&null!=bt){this.self.importScripts(bt);const gt=a.e7.isParsed();Ge(gt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${bt}`),gt)}}catch(bt){Ge(bt.toString())}}setDracoUrl(te,ue){this.dracoUrl=ue}getAvailableImages(te,ue){this.availableImages[te]||(this.availableImages[te]={});let Ge=this.availableImages[te][ue];return Ge||(Ge=[]),Ge}getLayerIndex(te,ue){this.layerIndexes[te]||(this.layerIndexes[te]={});let Ge=this.layerIndexes[te][ue];return Ge||(Ge=this.layerIndexes[te][ue]=new Ce,Ge.scope=ue),Ge}getWorkerSource(te,ue,Ge,bt){return this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][bt]||(this.workerSources[te][bt]={}),this.workerSources[te][bt][ue]||(this.workerSources[te][bt][ue]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),this.workerSources[te][bt][ue][Ge]||(this.workerSources[te][bt][ue][Ge]=new this.workerSourceTypes[ue]({send:(gt,jt,rn,Ft,on,Un)=>{this.actor.send(gt,jt,rn,te,on,Un)},scheduler:this.actor.scheduler},this.getLayerIndex(te,bt),this.getAvailableImages(te,bt),this.isSpriteLoaded[te][bt],void 0,this.brightness)),this.workerSources[te][bt][ue][Ge]}getDEMWorkerSource(te,ue,Ge){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][Ge]||(this.demWorkerSources[te][Ge]={}),this.demWorkerSources[te][Ge][ue]||(this.demWorkerSources[te][Ge][ue]=new We),this.demWorkerSources[te][Ge][ue]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ne),this.rasterArrayWorkerSource}enforceCacheSizeLimit(te,ue){a.e8(ue)}getWorkerPerformanceMetrics(te,ue,Ge){Ge(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Fi(self)),Fi}),v(0,function(a){function Z(p,r){if(Array.isArray(p)){if(!Array.isArray(r)||p.length!==r.length)return!1;for(let u=0;u<p.length;u++)if(!Z(p[u],r[u]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==r){if("object"!=typeof r||Object.keys(p).length!==Object.keys(r).length)return!1;for(const u in p)if(!Z(p[u],r[u]))return!1;return!0}return p===r}var ie=T;function T(p){return r=p,!(typeof window>"u"||typeof document>"u"||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,b,w=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(w);try{b=new Worker(I),m=!0}catch{m=!1}return b&&b.terminate(),URL.revokeObjectURL(I),m}()||!function(){var m=document.createElement("canvas");m.width=m.height=1;var b=m.getContext("2d");if(!b)return!1;var w=b.getImageData(0,0,1,1);return w&&w.width===m.width}()||(void 0===Ce[u=r&&r.failIfMajorPerformanceCaveat]&&(Ce[u]=function(m){var b,I,M,R,w=(I=m,M=document.createElement("canvas"),(R=Object.create(T.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,M.getContext("webgl2",R));if(!w)return!1;try{b=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!b||w.isContextLost())&&(w.shaderSource(b,"void main() {}"),w.compileShader(b),!0===w.getShaderParameter(b,w.COMPILE_STATUS))}(u)),!Ce[u]||document.documentMode));var r,u}var Ce={};function De(p,r,u){const m=document.createElement(p);return null!=r&&(m.className=r),u&&u.appendChild(m),m}function Je(p,r,u){const m=document.createElementNS("http://www.w3.org/2000/svg",p);for(const b of Object.keys(r))m.setAttributeNS(null,b,String(r[b]));return u&&u.appendChild(m),m}T.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const re=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ze=re&&void 0!==re.userSelect?"userSelect":"WebkitUserSelect";let je;function We(){re&&ze&&(je=re[ze],re[ze]="none")}function Ne(){re&&ze&&(re[ze]=je)}function ht(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",ht,!0)}function He(){window.addEventListener("click",ht,!0),window.setTimeout(()=>{window.removeEventListener("click",ht,!0)},0)}function be(p,r){const u=p.getBoundingClientRect();return ot(p,u,r)}function Ye(p,r){const u=p.getBoundingClientRect(),m=[];for(let b=0;b<r.length;b++)m.push(ot(p,u,r[b]));return m}function Le(p){return void 0!==window.InstallTrigger&&2===p.button&&p.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function ot(p,r,u){const m=p.offsetWidth===r.width?1:p.offsetWidth/r.width;return new a.P((u.clientX-r.left)*m,(u.clientY-r.top)*m)}class Ve{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,u){this._updatedSourceCaches[r]=u,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const u=r.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(r.id),this.setDirty()}removeLayer(r){const u=r.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][r.id]=r,this._updatedLayers[u].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const u in this._updatedLayers)r[u]=r[u]||{},r[u].updatedIds=Array.from(this._updatedLayers[u].values());for(const u in this._removedLayers)r[u]=r[u]||{},r[u].removedIds=Object.keys(this._removedLayers[u]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(r){this._updatedImages.add(r),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const Ue={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $t{constructor(r,u,m,b,w,I){this.length=u.length,this.attributes=m,this.itemSize=u.bytesPerElement,this.dynamicDraw=b,this.instanceCount=I,this.context=r;const M=r.gl;this.buffer=M.createBuffer(),r.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||w||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,u){for(let m=0;m<this.attributes.length;m++){const b=u.attributes[this.attributes[m].name];void 0!==b&&r.enableVertexAttribArray(b)}}setVertexAttribPointers(r,u,m){for(let b=0;b<this.attributes.length;b++){const w=this.attributes[b],I=u.attributes[w.name];void 0!==I&&r.vertexAttribPointer(I,w.components,r[Ue[w.type]],!1,this.itemSize,w.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(r,u,m){for(let b=0;b<this.attributes.length;b++){const w=u.attributes[this.attributes[b].name];void 0!==w&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(w,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class nt{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class xt extends nt{getDefault(){return a.C.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class ct extends nt{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Mt extends nt{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class $e extends nt{getDefault(){return[!0,!0,!0,!0]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Et extends nt{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class cn extends nt{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class fn extends nt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const u=this.current;(r.func!==u.func||r.ref!==u.ref||r.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Kn extends nt{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Kt extends nt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=r,this.dirty=!1}}class at extends nt{getDefault(){return[0,1]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class ve extends nt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=r,this.dirty=!1}}class Me extends nt{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class fe extends nt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.BLEND):u.disable(u.BLEND),this.current=r,this.dirty=!1}}class vt extends nt{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class _n extends nt{getDefault(){return a.C.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Re extends nt{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class wn extends nt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=r,this.dirty=!1}}class it extends nt{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class tn extends nt{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let bn=class extends nt{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class Jn extends nt{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class jn extends nt{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class _i extends nt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class ut extends nt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class nn extends nt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class ui extends nt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class pn extends nt{getDefault(){return null}set(r){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class An extends nt{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class Ct extends nt{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Qt extends nt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Se extends nt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Bt extends nt{constructor(r,u){super(r),this.context=r,this.parent=u}getDefault(){return null}}class Nt extends Bt{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Rn extends Bt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Ci extends Bt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Oi extends Rn{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ei{constructor(r,u,m,b,w){this.context=r,this.width=u,this.height=m;const I=this.framebuffer=r.gl.createFramebuffer();b&&(this.colorAttachment=new Nt(r,I)),w&&(this.depthAttachmentType=w,this.depthAttachment="renderbuffer"===w?new Rn(r,I):new Ci(r,I))}destroy(){const r=this.context.gl;if(this.colorAttachment){const u=this.colorAttachment.get();u&&r.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const u=this.depthAttachment.get();u&&r.deleteRenderbuffer(u)}else{const u=this.depthAttachment.get();u&&r.deleteTexture(u)}r.deleteFramebuffer(this.framebuffer)}}class no{constructor(r,u){this.gl=r,this.clearColor=new xt(this),this.clearDepth=new ct(this),this.clearStencil=new Mt(this),this.colorMask=new $e(this),this.depthMask=new Et(this),this.stencilMask=new cn(this),this.stencilFunc=new fn(this),this.stencilOp=new Kn(this),this.stencilTest=new Kt(this),this.depthRange=new at(this),this.depthTest=new ve(this),this.depthFunc=new Me(this),this.blend=new fe(this),this.blendFunc=new vt(this),this.blendColor=new _n(this),this.blendEquation=new Re(this),this.cullFace=new wn(this),this.cullFaceSide=new it(this),this.frontFace=new tn(this),this.program=new bn(this),this.activeTexture=new Jn(this),this.viewport=new jn(this),this.bindFramebuffer=new _i(this),this.bindRenderbuffer=new ut(this),this.bindTexture=new nn(this),this.bindVertexBuffer=new ui(this),this.bindElementBuffer=new pn(this),this.bindVertexArrayOES=new An(this),this.pixelStoreUnpack=new Ct(this),this.pixelStoreUnpackPremultiplyAlpha=new Qt(this),this.pixelStoreUnpackFlipY=new Se(this),this.options=u?{...u}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,u,m){return new a.I(this,r,u,m)}createVertexBuffer(r,u,m,b,w){return new $t(this,r,u,m,b,w)}createRenderbuffer(r,u,m){const b=this.gl,w=b.createRenderbuffer();return this.bindRenderbuffer.set(w),b.renderbufferStorage(b.RENDERBUFFER,r,u,m),this.bindRenderbuffer.set(null),w}createFramebuffer(r,u,m,b){return new ei(this,r,u,m,b)}clear({color:r,depth:u,stencil:m,colorMask:b}){const w=this.gl;let I=0;r&&(I|=w.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set(b||[!0,!0,!0,!0])),void 0!==u&&(I|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==m&&(I|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),w.clear(I)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){Z(r.blendFunction,a.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class mo{constructor(r){this._gl=r.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){const r=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,r}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class mr{constructor(r){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,r.registerParameter(this,["Symbols"],"useOcclusionQueries"),r.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),r.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),r.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),r.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class $n{constructor(r,u,m,b){const w={width:m[0],height:m[1],data:null},I=r.gl;this.targetColorTexture=new a.T(r,w,I.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new a.T(r,w,I.RGBA,{useMipmap:!1}),this.context=r,this.updateParticleTexture(u,b),this.lastInvalidatedAt=0}updateParticleTexture(r,u){if(this.particleTextureDimension===u.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const m=this.context.gl,b=u.width*u.height;this.particleTexture0=new a.T(this.context,u,m.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,u,m.RGBA,{premultiply:!1,useMipmap:!1});const w=new a.S;w.reserve(b);for(let I=0;I<b;I++)w.emplaceBack(I);this.particleIndexBuffer=this.context.createVertexBuffer(w,a.p.members,!0),this.particleSegment=a.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=u.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=a.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class ar extends a.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.numModelsLoading={}}loadModel(r,u){return a.l(this.requestManager.transformRequest(u,a.R.Model).url).then(m=>{if(!m)return;const b=a.c(m),w=new a.M(r,void 0,void 0,b);return w.computeBoundsAndApplyParent(),w}).catch(m=>{if(m&&404===m.status)return null;this.fire(new a.d(new Error(`Could not load model ${r} from ${u}: ${m.message}`)))})}load(r,u){this.models[u]||(this.models[u]={});const m=Object.keys(r);this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+m.length;const b=[];for(const w of m)b.push(this.loadModel(w,r[w]));Promise.allSettled(b).then(w=>{for(let I=0;I<w.length;I++){const{status:M,value:R}=w[I];"fulfilled"===M&&R&&(this.models[u][m[I]]={model:R,numReferences:1})}this.numModelsLoading[u]-=m.length,this.fire(new a.f("data",{dataType:"style"}))}).catch(w=>{this.fire(new a.d(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,u){return!!this.getModel(r,u)}getModel(r,u){return this.models[u]||(this.models[u]={}),this.models[u][r]?this.models[u][r].model:void 0}addModel(r,u,m){this.models[m]||(this.models[m]={}),this.hasModel(r,m)&&this.models[m][r].numReferences++,this.load({[r]:this.requestManager.normalizeModelURL(u)},m)}addModels(r,u){this.models[u]||(this.models[u]={});const m={};for(const b in r)this.models[u][b]={},m[b]=this.requestManager.normalizeModelURL(r[b]);this.load(m,u)}addModelsFromBucket(r,u){this.models[u]||(this.models[u]={});const m={};for(const b of r)this.hasModel(b,u)?this.models[u][b].numReferences++:m[b]=this.requestManager.normalizeModelURL(b);this.load(m,u)}removeModel(r,u){if(this.models[u]&&this.models[u][r]&&(this.models[u][r].numReferences--,0===this.models[u][r].numReferences)){const m=this.models[u][r].model;delete this.models[u][r],m.destroy()}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,u){this.models[u]||(this.models[u]={});for(const m in this.models[u])this.models[u][m].model&&this.models[u][m].model.upload(r.context)}}function gn(p){const{userImage:r}=p;return!!(r&&r.render&&r.render())&&(p.data.replace(new Uint8Array(r.data.buffer)),!0)}class ii extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(r){this.images[r]={},this.loaded[r]=!1,this.updatedImages[r]={},this.patterns[r]={},this.callbackDispatchedThisFrame[r]={},this.atlasImage[r]=new a.i({width:1,height:1})}isLoaded(){for(const r in this.loaded)if(!this.loaded[r])return!1;return!0}setLoaded(r,u){if(this.loaded[u]!==r&&(this.loaded[u]=r,r)){for(const{ids:m,callback:b}of this.requestors)this._notify(m,u,b);this.requestors=[]}}hasImage(r,u){return!!this.getImage(r,u)}getImage(r,u){return this.images[u][r]}addImage(r,u,m){this._validate(r,m)&&(this.images[u][r]=m)}_validate(r,u){let m=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new a.d(new Error(`Image "${r}" has invalid "stretchX" value`))),m=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new a.d(new Error(`Image "${r}" has invalid "stretchY" value`))),m=!1),this._validateContent(u.content,u)||(this.fire(new a.d(new Error(`Image "${r}" has invalid "content" value`))),m=!1),m}_validateStretch(r,u){if(!r)return!0;let m=0;for(const b of r){if(b[0]<m||b[1]<b[0]||u<b[1])return!1;m=b[1]}return!0}_validateContent(r,u){return!(r&&(4!==r.length||r[0]<0||u.data.width<r[0]||r[1]<0||u.data.height<r[1]||r[2]<0||u.data.width<r[2]||r[3]<0||u.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,u,m){m.version=this.images[u][r].version+1,this.images[u][r]=m,this.updatedImages[u][r]=!0}removeImage(r,u){const m=this.images[u][r];delete this.images[u][r],delete this.patterns[u][r],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(r){return Object.keys(this.images[r])}getImages(r,u,m){let b=!0;const w=!!this.loaded[u];if(!w)for(const I of r)this.images[u][I]||(b=!1);w||b?this._notify(r,u,m):this.requestors.push({ids:r,scope:u,callback:m})}getUpdatedImages(r){return this.updatedImages[r]}_notify(r,u,m){const b={};for(const w of r){this.images[u][w]||this.fire(new a.f("styleimagemissing",{id:w}));const I=this.images[u][w];I?b[w]={data:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!(!I.userImage||!I.userImage.render)}:a.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}m(null,b)}getPixelSize(r){const{width:u,height:m}=this.atlasImage[r];return{width:u,height:m}}getPattern(r,u,m){const b=this.patterns[u][r],w=this.getImage(r,u);if(!w)return null;if(b&&b.position.version===w.version)return b.position;if(b)b.position.version=w.version;else{const I={w:w.data.width+2,h:w.data.height+2,x:0,y:0},M=new a.k(I,w);this.patterns[u][r]={bin:I,position:M}}return this._updatePatternAtlas(u,m),this.patterns[u][r].position}bind(r,u){const m=r.gl;let b=this.atlasTexture[u];b?this.dirty&&(b.update(this.atlasImage[u]),this.dirty=!1):(b=new a.T(r,this.atlasImage[u],m.RGBA),this.atlasTexture[u]=b),b.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(r,u){const m=[];for(const M in this.patterns[r])m.push(this.patterns[r][M].bin);const{w:b,h:w}=a.j(m),I=this.atlasImage[r];I.resize({width:b||1,height:w||1});for(const M in this.patterns[r]){const{bin:R}=this.patterns[r][M],L=R.x+1,U=R.y+1,G=this.images[r][M].data,J=G.width,Q=G.height;a.i.copy(G,I,{x:0,y:0},{x:L,y:U},{width:J,height:Q},u),a.i.copy(G,I,{x:0,y:Q-1},{x:L,y:U-1},{width:J,height:1},u),a.i.copy(G,I,{x:0,y:0},{x:L,y:U+Q},{width:J,height:1},u),a.i.copy(G,I,{x:J-1,y:0},{x:L-1,y:U},{width:1,height:Q},u),a.i.copy(G,I,{x:0,y:0},{x:L+J,y:U},{width:1,height:Q},u)}this.dirty=!0}beginFrame(){for(const r in this.images)this.callbackDispatchedThisFrame[r]={}}dispatchRenderCallbacks(r,u){for(const m of r){if(this.callbackDispatchedThisFrame[u][m])continue;this.callbackDispatchedThisFrame[u][m]=!0;const b=this.images[u][m];gn(b)&&this.updateImage(m,u,b)}}}function oi(p){const r=p.key,u=p.value,m=p.valueSpec||{},b=p.objectElementValidators||{},w=p.style,I=p.styleSpec;let M=[];const R=a.n(u);if("object"!==R)return[new a.V(r,u,`object expected, ${R} found`)];for(const L in u){const U=L.split(".")[0];let G;b[U]?G=b[U]:m[U]?G=te:b["*"]?G=b["*"]:m["*"]&&(G=te),G?M=M.concat(G({key:(r&&`${r}.`)+L,value:u[L],valueSpec:m[U]||m["*"],style:w,styleSpec:I,object:u,objectKey:L},u)):M.push(new a.m(r,u[L],`unknown property "${L}"`))}for(const L in m)b[L]||m[L].required&&void 0===m[L].default&&void 0===u[L]&&M.push(new a.V(r,u,`missing required property "${L}"`));return M}function Yi(p){const r=p.value,u=p.valueSpec,m=p.style,b=p.styleSpec,w=p.key,I=p.arrayElementValidator||te;if("array"!==a.n(r))return[new a.V(w,r,`array expected, ${a.n(r)} found`)];if(u.length&&r.length!==u.length)return[new a.V(w,r,`array length ${u.length} expected, length ${r.length} found`)];if(u["min-length"]&&r.length<u["min-length"])return[new a.V(w,r,`array length at least ${u["min-length"]} expected, length ${r.length} found`)];let M={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};b.$version<7&&(M.function=u.function),"object"===a.n(u.value)&&(M=u.value);let R=[];for(let L=0;L<r.length;L++)R=R.concat(I({array:r,arrayIndex:L,value:r[L],valueSpec:M,style:m,styleSpec:b,key:`${w}[${L}]`},!0));return R}function pr(p){const r=p.key,u=p.value,m=p.valueSpec;let b=a.n(u);if("number"===b&&u!=u&&(b="NaN"),"number"!==b)return[new a.V(r,u,`number expected, ${b} found`)];if("minimum"in m){let w=m.minimum;if("array"===a.n(m.minimum)&&(w=m.minimum[p.arrayIndex]),u<w)return[new a.V(r,u,`${u} is less than the minimum value ${w}`)]}if("maximum"in m){let w=m.maximum;if("array"===a.n(m.maximum)&&(w=m.maximum[p.arrayIndex]),u>w)return[new a.V(r,u,`${u} is greater than the maximum value ${w}`)]}return[]}function io(p){const r=p.valueSpec,u=a.u(p.value.type);let m,b,w,I={};const M="categorical"!==u&&void 0===p.value.property,R=!M,L="array"===a.n(p.value.stops)&&"array"===a.n(p.value.stops[0])&&"object"===a.n(p.value.stops[0][0]),U=oi({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(Q){if("identity"===u)return[new a.V(Q.key,Q.value,'identity function may not have a "stops" property')];let le=[];const de=Q.value;return le=le.concat(Yi({key:Q.key,value:de,valueSpec:Q.valueSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:G})),"array"===a.n(de)&&0===de.length&&le.push(new a.V(Q.key,de,"array must have at least one stop")),le},default:function(Q){return te({key:Q.key,value:Q.value,valueSpec:r,style:Q.style,styleSpec:Q.styleSpec})}}});return"identity"===u&&M&&U.push(new a.V(p.key,p.value,'missing required property "property"')),"identity"===u||p.value.stops||U.push(new a.V(p.key,p.value,'missing required property "stops"')),"exponential"===u&&p.valueSpec.expression&&!a.s(p.valueSpec)&&U.push(new a.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(R&&!a.q(p.valueSpec)?U.push(new a.V(p.key,p.value,"property functions not supported")):M&&!a.r(p.valueSpec)&&U.push(new a.V(p.key,p.value,"zoom functions not supported"))),"categorical"!==u&&!L||void 0!==p.value.property||U.push(new a.V(p.key,p.value,'"property" property is required')),U;function G(Q){let le=[];const de=Q.value,ge=Q.key;if("array"!==a.n(de))return[new a.V(ge,de,`array expected, ${a.n(de)} found`)];if(2!==de.length)return[new a.V(ge,de,`array length 2 expected, length ${de.length} found`)];if(L){if("object"!==a.n(de[0]))return[new a.V(ge,de,`object expected, ${a.n(de[0])} found`)];if(void 0===de[0].zoom)return[new a.V(ge,de,"object stop key must have zoom")];if(void 0===de[0].value)return[new a.V(ge,de,"object stop key must have value")];const xe=a.u(de[0].zoom);if("number"!=typeof xe)return[new a.V(ge,de[0].zoom,"stop zoom values must be numbers")];if(w&&w>xe)return[new a.V(ge,de[0].zoom,"stop zoom values must appear in ascending order")];xe!==w&&(w=xe,b=void 0,I={}),le=le.concat(oi({key:`${ge}[0]`,value:de[0],valueSpec:{zoom:{}},style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:pr,value:J}}))}else le=le.concat(J({key:`${ge}[0]`,value:de[0],valueSpec:{},style:Q.style,styleSpec:Q.styleSpec},de));return a.t(a.v(de[1]))?le.concat([new a.V(`${ge}[1]`,de[1],"expressions are not allowed in function stops.")]):le.concat(te({key:`${ge}[1]`,value:de[1],valueSpec:r,style:Q.style,styleSpec:Q.styleSpec}))}function J(Q,le){const de=a.n(Q.value),ge=a.u(Q.value),xe=null!==Q.value?Q.value:le;if(m){if(de!==m)return[new a.V(Q.key,xe,`${de} stop domain type must match previous stop domain type ${m}`)]}else m=de;if("number"!==de&&"string"!==de&&"boolean"!==de&&"number"!=typeof ge&&"string"!=typeof ge&&"boolean"!=typeof ge)return[new a.V(Q.key,xe,"stop domain value must be a number, string, or boolean")];if("number"!==de&&"categorical"!==u){let Ke=`number expected, ${de} found`;return a.q(r)&&void 0===u&&(Ke+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V(Q.key,xe,Ke)]}return"categorical"!==u||"number"!==de||"number"==typeof ge&&isFinite(ge)&&Math.floor(ge)===ge?"categorical"!==u&&"number"===de&&"number"==typeof ge&&"number"==typeof b&&void 0!==b&&ge<b?[new a.V(Q.key,xe,"stop domain values must appear in ascending order")]:(b=ge,"categorical"===u&&ge in I?[new a.V(Q.key,xe,"stop domain values must be unique")]:(I[ge]=!0,[])):[new a.V(Q.key,xe,`integer expected, found ${String(ge)}`)]}}function ao(p){const r=("property"===p.expressionContext?a.x:a.y)(a.v(p.value),p.valueSpec);if("error"===r.result)return r.value.map(m=>new a.V(`${p.key}${m.key}`,p.value,m.message));const u=r.value.expression||r.value._styleExpression.expression;if("property"===p.expressionContext&&"text-font"===p.propertyKey&&!u.outputDefined())return[new a.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===p.expressionContext&&"layout"===p.propertyType&&!a.z(u))return[new a.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===p.expressionContext)return ro(u,p);if(p.expressionContext&&0===p.expressionContext.indexOf("cluster")){if(!a.A(u,["zoom","feature-state"]))return[new a.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===p.expressionContext&&!a.B(u))return[new a.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ro(p,r){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const b of r.valueSpec.expression.parameters)u.delete(b);if(0===u.size)return[];const m=[];return p instanceof a.D&&u.has(p.name)?[new a.V(r.key,r.value,`["${p.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(p.eachChild(b=>{m.push(...ro(b,r))}),m)}function co(p){const r=p.key,u=p.value,m=p.valueSpec,b=[];return Array.isArray(m.values)?-1===m.values.indexOf(a.u(u))&&b.push(new a.V(r,u,`expected one of [${m.values.join(", ")}], ${JSON.stringify(u)} found`)):-1===Object.keys(m.values).indexOf(a.u(u))&&b.push(new a.V(r,u,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(u)} found`)),b}function Po(p){return a.G(a.v(p.value))?ao(a.o({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):go(p)}function go(p){const r=p.value,u=p.key;if("array"!==a.n(r))return[new a.V(u,r,`array expected, ${a.n(r)} found`)];const m=p.styleSpec;let b,w=[];if(r.length<1)return[new a.V(u,r,"filter array must have at least 1 element")];switch(w=w.concat(co({key:`${u}[0]`,value:r[0],valueSpec:m.filter_operator,style:p.style,styleSpec:p.styleSpec})),a.u(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===a.u(r[1])&&w.push(new a.V(u,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&w.push(new a.V(u,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(b=a.n(r[1]),"string"!==b&&w.push(new a.V(`${u}[1]`,r[1],`string expected, ${b} found`)));for(let I=2;I<r.length;I++)b=a.n(r[I]),"$type"===a.u(r[1])?w=w.concat(co({key:`${u}[${I}]`,value:r[I],valueSpec:m.geometry_type,style:p.style,styleSpec:p.styleSpec})):"string"!==b&&"number"!==b&&"boolean"!==b&&w.push(new a.V(`${u}[${I}]`,r[I],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let I=1;I<r.length;I++)w=w.concat(go({key:`${u}[${I}]`,value:r[I],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":b=a.n(r[1]),2!==r.length?w.push(new a.V(u,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==b&&w.push(new a.V(`${u}[1]`,r[1],`string expected, ${b} found`))}return w}function bo(p,r){const u=p.key,m=p.style,b=p.layer,w=p.styleSpec,I=p.value,M=p.objectKey,R=w[`${r}_${p.layerType}`];if(!R)return[];const L=M.match(/^(.*)-transition$/);if("paint"===r&&L&&R[L[1]]&&R[L[1]].transition)return te({key:u,value:I,valueSpec:w.transition,style:m,styleSpec:w});const U=p.valueSpec||R[M];if(!U)return[new a.m(u,I,`unknown property "${M}"`)];let G;if("string"===a.n(I)&&a.q(U)&&!U.tokens&&(G=/^{([^}]+)}$/.exec(I))){const Q=`\`{ "type": "identity", "property": ${G?JSON.stringify(G[1]):'"_"'} }\``;return[new a.V(u,I,`"${M}" does not support interpolation syntax\nUse an identity property function instead: ${Q}.`)]}const J=[];if("symbol"===p.layerType)"text-field"!==M||!m||m.glyphs||m.imports||J.push(new a.V(u,I,'use of "text-field" requires a style "glyphs" property')),"text-font"===M&&a.H(a.v(I))&&"identity"===a.u(I.type)&&J.push(new a.V(u,I,'"text-font" does not support identity functions'));else if("model"===p.layerType&&"paint"===r&&b&&b.layout&&b.layout.hasOwnProperty("model-id")&&a.q(U)&&(a.J(U)||a.r(U))){const Q=a.x(a.v(I),U),le=Q.value.expression||Q.value._styleExpression.expression;le&&!a.A(le,["measure-light"])&&("model-emissive-strength"===M&&a.B(le)&&a.z(le)||J.push(new a.V(u,I,`${M} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return J.concat(te({key:p.key,value:I,valueSpec:U,style:m,styleSpec:w,expressionContext:"property",propertyType:r,propertyKey:M}))}function Bn(p){return bo(p,"paint")}function Cn(p){return bo(p,"layout")}function At(p){let r=[];const u=p.value,m=p.key,b=p.style,w=p.styleSpec;u.type||u.ref||r.push(new a.V(m,u,'either "type" or "ref" is required'));let I=a.u(u.type);const M=a.u(u.ref);if(u.id){const R=a.u(u.id);for(let L=0;L<p.arrayIndex;L++){const U=b.layers[L];a.u(U.id)===R&&r.push(new a.V(m,u.id,`duplicate layer id "${u.id}", previously used at line ${U.id.__line__}`))}}if("ref"in u){let R;["type","source","source-layer","filter","layout"].forEach(L=>{L in u&&r.push(new a.V(m,u[L],`"${L}" is prohibited for ref layers`))}),b.layers.forEach(L=>{a.u(L.id)===M&&(R=L)}),R?R.ref?r.push(new a.V(m,u.ref,"ref cannot reference another ref layer")):I=a.u(R.type):"string"==typeof M&&r.push(new a.V(m,u.ref,`ref layer "${M}" not found`))}else if("background"!==I&&"sky"!==I&&"slot"!==I)if(u.source){const R=b.sources&&b.sources[u.source],L=R&&a.u(R.type);R?"vector"===L&&"raster"===I?r.push(new a.V(m,u.source,`layer "${u.id}" requires a raster source`)):"raster"===L&&"raster"!==I?r.push(new a.V(m,u.source,`layer "${u.id}" requires a vector source`)):"vector"!==L||u["source-layer"]?"raster-dem"===L&&"hillshade"!==I?r.push(new a.V(m,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==L||["raster","raster-particle"].includes(I)?"line"!==I||!u.paint||!u.paint["line-gradient"]&&!u.paint["line-trim-offset"]||"geojson"===L&&R.lineMetrics?"raster-particle"===I&&"raster-array"!==L&&r.push(new a.V(m,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):r.push(new a.V(m,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new a.V(m,u.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new a.V(m,u,`layer "${u.id}" must specify a "source-layer"`)):r.push(new a.V(m,u.source,`source "${u.source}" not found`))}else r.push(new a.V(m,u,'missing required property "source"'));return r=r.concat(oi({key:m,value:u,valueSpec:w.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>te({key:`${m}.type`,value:u.type,valueSpec:w.layer.type,style:p.style,styleSpec:p.styleSpec,object:u,objectKey:"type"}),filter:R=>Po(a.o({layerType:I},R)),layout:R=>oi({layer:u,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":L=>Cn(a.o({layerType:I},L))}}),paint:R=>oi({layer:u,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":L=>Bn(a.o({layerType:I,layer:u},L))}})}})),r}function an(p){const r=p.value,u=p.key,m=a.n(r);return"string"!==m?[new a.V(u,r,`string expected, ${m} found`)]:[]}const pt={promoteId:function({key:p,value:r}){if("string"===a.n(r))return an({key:p,value:r});{const u=[];for(const m in r)u.push(...an({key:`${p}.${m}`,value:r[m]}));return u}}};function On(p){const r=p.value,u=p.key,m=p.styleSpec,b=p.style;if(!r.type)return[new a.V(u,r,'"type" is required')];const w=a.u(r.type);let I=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&(r.url||r.tiles||I.push(new a.m(u,r,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return I=I.concat(oi({key:u,value:r,valueSpec:m[`source_${w.replace("-","_")}`],style:p.style,styleSpec:m,objectElementValidators:pt})),I;case"geojson":if(I=oi({key:u,value:r,valueSpec:m.source_geojson,style:b,styleSpec:m,objectElementValidators:pt}),r.cluster)for(const M in r.clusterProperties){const[R,L]=r.clusterProperties[M],U="string"==typeof R?[R,["accumulated"],["get",M]]:R;I.push(...ao({key:`${u}.${M}.map`,value:L,expressionContext:"cluster-map"})),I.push(...ao({key:`${u}.${M}.reduce`,value:U,expressionContext:"cluster-reduce"}))}return I;case"video":return oi({key:u,value:r,valueSpec:m.source_video,style:b,styleSpec:m});case"image":return oi({key:u,value:r,valueSpec:m.source_image,style:b,styleSpec:m});case"canvas":return[new a.V(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return co({key:`${u}.type`,value:r.type,valueSpec:{values:Ze(m)},style:b,styleSpec:m})}}function Ze(p){return p.source.reduce((r,u)=>{const m=p[u];return"enum"===m.type.type&&(r=r.concat(Object.keys(m.type.values))),r},[])}function Ln(p){const r=p.value,u=p.styleSpec,m=u.light,b=p.style;let w=[];const I=a.n(r);if(void 0===r)return w;if("object"!==I)return w=w.concat([new a.V("light",r,`object expected, ${I} found`)]),w;for(const M in r){const R=M.match(/^(.*)-transition$/);w=w.concat(R&&m[R[1]]&&m[R[1]].transition?te({key:M,value:r[M],valueSpec:u.transition,style:b,styleSpec:u}):m[M]?te({key:M,value:r[M],valueSpec:m[M],style:b,styleSpec:u}):[new a.V(M,r[M],`unknown property "${M}"`)])}return w}function Dn(p){const r=p.value;let u=[];if(!r)return u;const m=a.n(r);if("object"!==m)return u=u.concat([new a.V("light-3d",r,`object expected, ${m} found`)]),u;const b=p.styleSpec,w=b["light-3d"],I=p.key,M=p.style,R=p.style.lights;for(const G of["type","id"])if(!(G in r))return u=u.concat([new a.V("light-3d",r,`missing property ${G} on light`)]),u;if(r.type&&R)for(let G=0;G<p.arrayIndex;G++){const J=a.u(r.type),Q=R[G];a.u(Q.type)===J&&u.push(new a.V(I,r.id,`duplicate light type "${r.type}", previously defined at line ${Q.id.__line__}`))}const L=`properties_light_${r.type}`;if(!(L in b))return u=u.concat([new a.V("light-3d",r,`Invalid light type ${r.type}`)]),u;const U=b[L];for(const G in r)if("properties"===G){const J=r[G],Q=a.n(J);if("object"!==Q)return u=u.concat([new a.V("properties",J,`object expected, ${Q} found`)]),u;for(const le in J)u=u.concat(U[le]?te({key:le,value:J[le],valueSpec:U[le],style:M,styleSpec:b}):[new a.m(p.key,J[le],`unknown property "${le}"`)])}else{const J=G.match(/^(.*)-transition$/);u=u.concat(J&&w[J[1]]&&w[J[1]].transition?te({key:G,value:r[G],valueSpec:b.transition,style:M,styleSpec:b}):w[G]?te({key:G,value:r[G],valueSpec:w[G],style:M,styleSpec:b}):[new a.m(G,r[G],`unknown property "${G}"`)])}return u}function ki(p){const r=p.value,u=p.key,m=p.style,b=p.styleSpec,w=b.terrain;let I=[];const M=a.n(r);if(void 0===r||"null"===M)return I;if("object"!==M)return I=I.concat([new a.V("terrain",r,`object expected, ${M} found`)]),I;for(const R in r){const L=R.match(/^(.*)-transition$/);I=I.concat(L&&w[L[1]]&&w[L[1]].transition?te({key:R,value:r[R],valueSpec:b.transition,style:m,styleSpec:b}):w[R]?te({key:R,value:r[R],valueSpec:w[R],style:m,styleSpec:b}):[new a.m(R,r[R],`unknown property "${R}"`)])}if(r.source){const R=m.sources&&m.sources[r.source],L=R&&a.u(R.type);R?"raster-dem"!==L&&I.push(new a.V(u,r.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):I.push(new a.V(u,r.source,`source "${r.source}" not found`))}else I.push(new a.V(u,r,'terrain is missing required property "source"'));return I}function Fi(p){const r=p.value,u=p.style,m=p.styleSpec,b=m.fog;let w=[];const I=a.n(r);if(void 0===r)return w;if("object"!==I)return w=w.concat([new a.V("fog",r,`object expected, ${I} found`)]),w;for(const M in r){const R=M.match(/^(.*)-transition$/);w=w.concat(R&&b[R[1]]&&b[R[1]].transition?te({key:M,value:r[M],valueSpec:m.transition,style:u,styleSpec:m}):b[M]?te({key:M,value:r[M],valueSpec:b[M],style:u,styleSpec:m}):[new a.m(M,r[M],`unknown property "${M}"`)])}return w}const wt={"*":()=>[],array:Yi,boolean:function(p){const r=p.value,u=p.key,m=a.n(r);return"boolean"!==m?[new a.V(u,r,`boolean expected, ${m} found`)]:[]},number:pr,color:function(p){const r=p.key,u=p.value,m=a.n(u);return"string"!==m?[new a.V(r,u,`color expected, ${m} found`)]:null===a.F(u)?[new a.V(r,u,`color expected, "${u}" found`)]:[]},enum:co,filter:Po,function:io,layer:At,object:oi,source:On,model:a.K,light:Ln,"light-3d":Dn,terrain:ki,fog:Fi,string:an,formatted:function(p){return 0===an(p).length?[]:ao(p)},resolvedImage:function(p){return 0===an(p).length?[]:ao(p)},projection:function(p){const r=p.value,u=p.styleSpec,m=u.projection,b=p.style;let w=[];const I=a.n(r);if("object"===I)for(const M in r)w=w.concat(te({key:M,value:r[M],valueSpec:m[M],style:b,styleSpec:u}));else"string"!==I&&(w=w.concat([new a.V("projection",r,`object or string expected, ${I} found`)]));return w},import:function(p){const{value:r,styleSpec:u}=p,{data:m,...b}=r;Object.defineProperty(b,"__line__",{value:r.__line__,enumerable:!1});let w=oi(a.o({},p,{value:b,valueSpec:u.import}));return""===a.u(b.id)&&w.push(new a.V(`${p.key}.id`,b,"import id can't be an empty string")),m&&(w=w.concat(Ge(m,u,{key:`${p.key}.data`}))),w}};function te(p,r=!1){const u=p.value,m=p.valueSpec,b=p.styleSpec;if(m.expression&&a.H(a.u(u)))return io(p);if(m.expression&&a.t(a.v(u)))return ao(p);if(m.type&&wt[m.type]){const w=wt[m.type](p);return!0===r&&w.length>0&&"array"===a.n(p.value)?ao(p):w}return oi(a.o({},p,{valueSpec:m.type?b[m.type]:m}))}function ue(p){const r=p.value,u=p.key,m=an(p);return m.length||(-1===r.indexOf("{fontstack}")&&m.push(new a.V(u,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&m.push(new a.V(u,r,'"glyphs" url must include a "{range}" token'))),m}function Ge(p,r=a.L,u={}){return te({key:u.key||"",value:p,valueSpec:r.$root,styleSpec:r,style:p,objectElementValidators:{glyphs:ue,"*":()=>[]}})}function bt(p,r=a.L){return Ki(Ge(p,r))}const gt=p=>Ki(On(p)),jt=p=>Ki(Ln(p)),rn=p=>Ki(Dn(p)),Ft=p=>Ki(ki(p)),on=p=>Ki(Fi(p)),Un=p=>Ki(At(p)),zn=p=>Ki(Po(p)),Ei=p=>Ki(Bn(p)),Ui=p=>Ki(Cn(p)),qi=p=>Ki(a.K(p));function Ki(p){return p.slice().sort((r,u)=>r.line&&u.line?r.line-u.line:0)}function Gi(p,r){let u=!1;if(r&&r.length)for(const m of r)m instanceof a.m?a.w(m.message):(p.fire(new a.d(new Error(m.message))),u=!0);return u}const nr=new a.N({anchor:new a.O(a.L.light.anchor),position:new a.Q(a.L.light.position),color:new a.O(a.L.light.color),intensity:new a.O(a.L.light.intensity)});class lt extends a.E{constructor(r,u="flat"){super(),this._transitionable=new a.U(nr),this.setLight(r,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,u,m={}){this._validate(jt,r,m)||(this._transitionable.setTransitionOrValue(r),this.id=u)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,m){return(!m||!1!==m.validate)&&Gi(this,r.call(bt,a.W({value:u,style:{glyphs:!0,sprite:!0},styleSpec:a.L})))}}const Be=new a.N({source:new a.O(a.L.terrain.source),exaggeration:new a.O(a.L.terrain.exaggeration)});let we=class extends a.E{constructor(p,r,u,m){super(),this.scope=u,this._transitionable=new a.U(Be,u,m),this._transitionable.setTransitionOrValue(p,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(p,r){this._transitionable.setTransitionOrValue(p,r)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new a.X(p)).get("exaggeration")}isZoomDependent(){const p=this._transitionable._values.exaggeration;return null!=p&&null!=p.value&&null!=p.value.expression&&p.value.expression instanceof a.Z}};const Fe=45,Gt=65,vn=.05;function Ie(p,r,u,m){const b=a.$(Fe,Gt,u),[w,I]=mt(p,m);let M=1-Math.min(1,Math.exp((r-w)/(I-w)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*b*p.alpha}function mt(p,r){const u=.5/Math.tan(.5*r);return[p.range[0]+u,p.range[1]+u]}function Tt(p,r,u,m,b){const w=a._.transformMat4([],[r,u,m],b.mercatorFogMatrix);return Ie(p,a._.length(w),b.pitch,b._fov)}function En(p,r,u,m,b,w,I){const M=[[u,m,0],[b,m,0],[b,w,0],[u,w,0]];let R=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const U of M){const G=a._.transformMat4([],U,r),J=a._.length(G);R=Math.min(R,J),L=Math.max(L,J)}return[Ie(p,R,I.pitch,I._fov),Ie(p,L,I.pitch,I._fov)]}const si=new a.N({range:new a.O(a.L.fog.range),color:new a.O(a.L.fog.color),"high-color":new a.O(a.L.fog["high-color"]),"space-color":new a.O(a.L.fog["space-color"]),"horizon-blend":new a.O(a.L.fog["horizon-blend"]),"star-intensity":new a.O(a.L.fog["star-intensity"]),"vertical-range":new a.O(a.L.fog["vertical-range"])});class Ai extends a.E{constructor(r,u,m,b){super(),this._transitionable=new a.U(si,m,new Map(b)),this.set(r,b),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new a.a0(si),this.scope=m}get state(){const r=this._transform,u="globe"===r.projection.name,m=a.a1(r.zoom),b=this.properties.get("range"),w=[.5,3];return{range:u?[a.a2(w[0],b[0],m),a.a2(w[1],b[1],m)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,u,m={}){if(this._validate(on,r,m))return;const b=a.W({},r);for(const w of Object.keys(a.L.fog))void 0===b[w]&&(b[w]=a.L.fog[w].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:a.$(Fe,Gt,r))*u.a}getOpacityAtLatLng(r,u){return this._transform.projection.supportsFog?function(m,b,w){const I=a.Y.fromLngLat(b),M=w.elevation?w.elevation.getAtPointOrZero(I):0;return Tt(m,I.x,I.y,M,w)}(this.state,r,u):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const u=this._transform.calculateFogTileMatrix(r.toUnwrapped());return En(this.state,u,0,0,a.a3,a.a3,this._transform)}getOpacityForBounds(r,u,m,b,w){return this._transform.projection.supportsFog?En(this.state,r,u,m,b,w,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?mt(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const u=[4,5,6,7];for(const m of u){const b=r.points[m];let w;if(b[2]>=0)w=b;else{const I=r.points[m-4];w=a.a4(I,b,I[2]/(I[2]-b[2]))}if(Tt(this.state,w[0],w[1],0,this._transform)>=vn)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,m){return(!m||!1!==m.validate)&&Gi(this,r.call(bt,a.W({value:u,style:{glyphs:!0,sprite:!0},styleSpec:a.L})))}}class Ri extends a.E{constructor(r,u,m,b){super(),this.scope=m,this._options=r,this.properties=new a.a0(u),this._transitionable=new a.U(u,m,new Map(b)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,u){this._options=r,this._transitionable.setTransitionOrValue(r.properties,u)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const pi=new a.N({color:new a.O(a.L.properties_light_ambient.color),intensity:new a.O(a.L.properties_light_ambient.intensity)}),Ti=new a.N({direction:new a.a5(a.L.properties_light_directional.direction),color:new a.O(a.L.properties_light_directional.color),intensity:new a.O(a.L.properties_light_directional.intensity),"cast-shadows":new a.O(a.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new a.O(a.L.properties_light_directional["shadow-intensity"])});var vr="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",Io="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",gr="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Nr="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",_o="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform highp sampler2D u_depth;uniform vec2 u_depth_size_inv;uniform vec2 u_depth_range_unpack;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\n#ifdef TERRAIN_DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef TERRAIN_DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;\n#ifdef TERRAIN_DEPTH_D24\nvec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nvec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",yo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Vr="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",uo="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",ko="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",Ls="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Gr="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const xs=[];ks(vr,xs),ks(gr,xs),ks(Io,xs);const Qs={"_prelude_fog.vertex.glsl":yo,"_prelude_terrain.vertex.glsl":_o,"_prelude_shadow.vertex.glsl":Ls,"_prelude_fog.fragment.glsl":Vr,"_prelude_shadow.fragment.glsl":Gr,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":uo,"_prelude_raster_particle.glsl":ko},Ss={};xr("",_o),xr(Vr,yo),xr(Gr,Ls),xr(uo,""),xr(ko,"");const Sa=xr(Io,gr),ma=vr;var Fl={background:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:xr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:xr('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:xr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:xr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:xr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:xr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:xr("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:xr('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:xr("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:xr("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED)\nin float a_z_offset;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\n#if defined(ELEVATED)\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);\n#else\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LINE_JOIN_NONE\nfloat pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED)\nin float a_z_offset;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\n#if defined(ELEVATED)\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);\n#else\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef LINE_JOIN_NONE\nv_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:xr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:xr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:xr('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:xr('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\nout_color*=alpha;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;\n#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH\nocclusion_fade*=occlusionFade(projected_point);\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;\n#endif\n}'),symbolSDF:xr('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;\n#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH\nocclusion_fade*=occlusionFade(projected_point);\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:xr('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;\n#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH\nocclusion_fade*=occlusionFade(projected_point);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:xr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:xr('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Nr),skyboxGradient:xr('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Nr),skyboxCapture:xr("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:xr('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:xr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;\n#ifdef TERRAIN_DEPTH_D24\nfloat unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef TERRAIN_DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:xr("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:xr("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),occlusion:xr("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function ks(p,r){const u=p.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let m of u)if(m=m.trim(),"#"===m[0]&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=m.split(" ");for(const w of b)r.includes(w)||r.push(w)}}function xr(p,r){const u=/#include\s+"([^"]+)"/g,m=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let b=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);b&&(b=b.map(L=>{const U=L.split(" ");return U[U.length-1]}),b=[...new Set(b)]);const w={},I=[],M=[];if(p=p.replace(u,(L,U)=>(M.push(U),"")),(r=r.replace(u,(L,U)=>(I.push(U),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let R=[...xs];ks(p,R),ks(r,R);for(const L of[...I,...M])Qs[L]||console.error(`Undefined include: ${L}`),Ss[L]||(Ss[L]=[],ks(Qs[L],Ss[L])),R=[...R,...Ss[L]];return{fragmentSource:p=p.replace(m,(L,U,G,J,Q)=>(w[Q]=!0,"define"===U?`\n#ifndef HAS_UNIFORM_u_${Q}\nin ${G} ${J} ${Q};\n#else\nuniform ${G} ${J} u_${Q};\n#endif\n`:"initialize"===U?`\n#ifdef HAS_UNIFORM_u_${Q}\n    ${G} ${J} ${Q} = u_${Q};\n#endif\n`:"define-attribute"===U?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\n    in ${G} ${J} ${Q};\n#endif\n`:"initialize-attribute"===U?"":void 0)),vertexSource:r=r.replace(m,(L,U,G,J,Q)=>{const le="float"===J?"vec2":J,de=Q.match(/color/)?"color":le;return"define-attribute-vertex-shader-only"===U?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\nin ${G} ${J} a_${Q};\n#endif\n`:w[Q]?"define"===U?`\n#ifndef HAS_UNIFORM_u_${Q}\nuniform lowp float u_${Q}_t;\nin ${G} ${le} a_${Q};\nout ${G} ${J} ${Q};\n#else\nuniform ${G} ${J} u_${Q};\n#endif\n`:"initialize"===U?"vec4"===de?`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${Q} = a_${Q};\n#else\n    ${G} ${J} ${Q} = u_${Q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${Q} = unpack_mix_${de}(a_${Q}, u_${Q}_t);\n#else\n    ${G} ${J} ${Q} = u_${Q};\n#endif\n`:"define-attribute"===U?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\n    in ${G} ${J} a_${Q};\n    out ${G} ${J} ${Q};\n#endif\n`:"initialize-attribute"===U?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\n    ${Q} = a_${Q};\n#endif\n`:void 0:"define"===U?`\n#ifndef HAS_UNIFORM_u_${Q}\nuniform lowp float u_${Q}_t;\nin ${G} ${le} a_${Q};\n#else\nuniform ${G} ${J} u_${Q};\n#endif\n`:"define-instanced"===U?"mat4"===de?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${Q}0;\nin vec4 a_${Q}1;\nin vec4 a_${Q}2;\nin vec4 a_${Q}3;\n#else\nuniform ${G} ${J} u_${Q};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${G} ${le} a_${Q};\n#else\nuniform ${G} ${J} u_${Q};\n#endif\n`:"initialize-attribute-custom"===U?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\n    ${G} ${J} ${Q} = a_${Q};\n#endif\n`:"vec4"===de?`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${G} ${J} ${Q} = a_${Q};\n#else\n    ${G} ${J} ${Q} = u_${Q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${G} ${J} ${Q} = unpack_mix_${de}(a_${Q}, u_${Q}_t);\n#else\n    ${G} ${J} ${Q} = u_${Q};\n#endif\n`}),staticAttributes:b,usedDefines:R,vertexIncludes:I,fragmentIncludes:M}}class Nl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,u,m,b,w,I,M,R){this.context=r;let L=this.boundPaintVertexBuffers.length!==b.length;for(let G=0;!L&&G<b.length;G++)this.boundPaintVertexBuffers[G]!==b[G]&&(L=!0);let U=this.boundDynamicVertexBuffers.length!==M.length;for(let G=0;!U&&G<M.length;G++)this.boundDynamicVertexBuffers[G]!==M[G]&&(U=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==m||L||U||this.boundIndexBuffer!==w||this.boundVertexOffset!==I)this.freshBind(u,m,b,w,I,M,R);else{r.bindVertexArrayOES.set(this.vao);for(const G of M)G&&(G.bind(),R&&G.instanceCount&&G.setVertexAttribDivisor(r.gl,u,R));w&&w.dynamicDraw&&w.bind()}}freshBind(r,u,m,b,w,I,M){const R=r.numAttributes,L=this.context,U=L.gl;this.vao&&this.destroy(),this.vao=L.gl.createVertexArray(),L.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=b,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=I,u.enableAttributes(U,r),u.bind(),u.setVertexAttribPointers(U,r,w);for(const G of m)G.enableAttributes(U,r),G.bind(),G.setVertexAttribPointers(U,r,w);for(const G of I)G&&(G.enableAttributes(U,r),G.bind(),G.setVertexAttribPointers(U,r,w),M&&G.instanceCount&&G.setVertexAttribDivisor(U,r,M));b&&b.bind(),L.currentNumAttributes=R}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ol(p,r){const u=Math.pow(2,r.canonical.z),m=r.canonical.y;return[new a.Y(0,m/u).toLngLat().lat,new a.Y(0,(m+1)/u).toLngLat().lat]}function Wa(p,r,u,m,b,w,I){const M=p.context,R=M.gl,L=u.hillshadeFBO;if(!L)return;p.prepareDrawTile();const U=p.isTileAffectedByFog(r),G=p.getOrCreateProgram("hillshade",{overrideFog:U});M.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,L.colorAttachment.get());const J=((ge,xe,Ke,Qe)=>{const et=Ke.paint.get("hillshade-shadow-color"),yt=Ke.paint.get("hillshade-highlight-color"),_t=Ke.paint.get("hillshade-accent-color"),St=Ke.paint.get("hillshade-emissive-strength");let Ee=a.ab(Ke.paint.get("hillshade-illumination-direction"));if("viewport"===Ke.paint.get("hillshade-illumination-anchor"))Ee-=ge.transform.angle;else if(ge.style&&ge.style.enable3dLights()&&ge.style.directionalLight){const Lt=ge.style.directionalLight.properties.get("direction"),sn=a.ac(Lt.x,Lt.y,Lt.z);Ee=a.ab(sn[1])}const tt=!ge.options.moving;return{u_matrix:Qe||ge.transform.calculateProjMatrix(xe.tileID.toUnwrapped(),tt),u_image:0,u_latrange:ol(0,xe.tileID),u_light:[Ke.paint.get("hillshade-exaggeration"),Ee],u_shadow:et.toRenderColor(Ke.lut),u_highlight:yt.toRenderColor(Ke.lut),u_emissive_strength:St,u_accent:_t.toRenderColor(Ke.lut)}})(p,u,m,p.terrain?r.projMatrix:null);p.uploadCommonUniforms(M,G,r.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:le,tileBoundsSegments:de}=p.getTileBoundsBuffers(u);G.draw(p,R.TRIANGLES,b,w,I,a.af.disabled,J,m.id,Q,le,de)}function bl(p,r,u){if(!r.needsDEMTextureUpload)return;const m=p.context,b=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||p.getTileTexture(u.stride);const w=u.getPixels();r.demTexture?r.demTexture.update(w,{premultiply:!1}):r.demTexture=new a.T(m,w,b.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Vs(p,r,u){const m=p.context,b=m.gl;if(!r.dem)return;const w=r.dem;if(m.activeTexture.set(b.TEXTURE1),bl(p,r,w),!r.demTexture)return;r.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const I=w.dim;m.activeTexture.set(b.TEXTURE0);let M=r.hillshadeFBO;if(!M){const J=new a.T(m,{width:I,height:I,data:null},b.RGBA);J.bind(b.LINEAR,b.CLAMP_TO_EDGE),M=r.hillshadeFBO=m.createFramebuffer(I,I,!0,"renderbuffer"),M.colorAttachment.set(J.texture)}m.bindFramebuffer.set(M.framebuffer),m.viewport.set([0,0,I,I]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:L,tileBoundsSegments:U}=p.getMercatorTileBoundsBuffers(),G=[];p.linearFloatFilteringSupported()&&G.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:G}).draw(p,b.TRIANGLES,a.ae.disabled,a.ag.disabled,a.a.unblended,a.af.disabled,((J,Q)=>{const le=Q.stride,de=a.ad.create();return a.ad.ortho(de,0,a.a3,-a.a3,0,0,1),a.ad.translate(de,de,[0,-a.a3,0]),{u_matrix:de,u_image:1,u_dimension:[le,le],u_zoom:J.overscaledZ}})(r.tileID,w),u.id,R,L,U),r.needsHillshadePrepare=!1}function sl(p,r,u,m,b){const w=function(I,M){if(I)return b(I);if(M){if(p.url&&M.tiles&&p.tiles&&delete p.tiles,M.variants){if(!Array.isArray(M.variants))return b(new Error("variants must be an array"));for(const L of M.variants){if(null==L||"object"!=typeof L||L.constructor!==Object)return b(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return b(new Error("capabilities must be an array"));if(1===L.capabilities.length&&"meshopt"===L.capabilities[0]){M=a.W(M,L);break}}}const R=a.ah(a.W(M,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(R.vectorLayers=M.vector_layers,R.vectorLayerIds=R.vectorLayers.map(L=>L.id)),M.raster_layers&&(R.rasterLayers=M.raster_layers,R.rasterLayerIds=R.rasterLayers.map(L=>L.id)),R.tiles=r.canonicalizeTileset(R,p.url),b(null,R)}};return p.url?a.g(r.transformRequest(r.normalizeSourceURL(p.url,null,u,m),a.R.Source),w):a.e.frame(()=>w(null,p))}class pe{constructor(r,u,m){this.bounds=a.ai.convert(this.validateBounds(r)),this.minzoom=u||0,this.maxzoom=m||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const u=Math.pow(2,r.z),m=Math.floor(a.aj(this.bounds.getWest())*u),b=Math.floor(a.ak(this.bounds.getNorth())*u),w=Math.ceil(a.aj(this.bounds.getEast())*u),I=Math.ceil(a.ak(this.bounds.getSouth())*u);return r.x>=m&&r.x<w&&r.y>=b&&r.y<I}}class kr extends a.E{constructor(r,u,m,b){super(),this.id=r,this.dispatcher=m,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.W({type:"raster"},u),a.W(this,a.ah(u,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new a.f("dataloading",{dataType:"source"})),this._tileJSONRequest=sl(this._options,this.map._requestManager,null,null,(u,m)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new a.d(u)):m&&(a.W(this,m),m.bounds&&(this.tileBounds=new pe(m.bounds,this.minzoom,this.maxzoom)),a.an(m.tiles),this.fire(new a.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.f("data",{dataType:"source",sourceDataType:"content"}))),r&&r(u)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=a.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return a.W({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,u){const m=a.e.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);r.request=a.h(this.map._requestManager.transformRequest(b,a.R.Tile),(w,I,M,R)=>(delete r.request,r.aborted?(r.state="unloaded",u(null)):w?(r.state="errored",u(w)):I?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:M,expires:R}),r.setTexture(I,this.map.painter),r.state="loaded",a.am(this.dispatcher),void u(null)):u(null)))}abortTile(r,u){r.request&&(r.request.cancel(),delete r.request),u&&u()}unloadTile(r,u){r.texture&&r.texture instanceof a.T?(r.destroy(!0),r.texture&&r.texture instanceof a.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),u&&u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Te extends a.E{constructor(r,u,m,b){if(super(),this.id=r,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.W(this,a.ah(u,["url","scheme","tileSize","promoteId"])),this._options=a.W({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new a.ao}load(r){this._loaded=!1,this.fire(new a.f("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=sl(this._options,this.map._requestManager,u,m,(b,w)=>{this._tileJSONRequest=null,this._loaded=!0,b?(u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),m&&2!==m.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new a.d(b))):w&&(a.W(this,w),w.bounds&&(this.tileBounds=new pe(w.bounds,this.minzoom,this.maxzoom)),a.an(w.tiles,this.map._requestManager._customAccessToken),this.fire(new a.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.f("data",{dataType:"source",sourceDataType:"content"}))),r&&r(b)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=a.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return a.W({},this._options)}loadTile(r,u){const m=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),b=this.map._requestManager.transformRequest(m,a.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,I={request:b,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,lut:w?{image:w.image.clone()}:null,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(I.request.collectResourceTiming=this._collectResourceTiming,r.actor&&"expired"!==r.state)"loading"===r.state?r.reloadCallback=u:r.request=r.actor.send("reloadTile",I,M.bind(this));else if(r.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",I,M.bind(this),void 0,!0);else{const R=a.ap.call({deduped:this._deduped},I,(L,U)=>{L||!U?M.call(this,L):(I.data={cacheControl:U.cacheControl,expires:U.expires,rawData:U.rawData.slice(0)},r.actor&&r.actor.send("loadTile",I,M.bind(this),void 0,!0))},!0);r.request={cancel:R}}function M(R,L){return delete r.request,r.aborted?u(null):R&&404!==R.status?u(R):(L&&L.resourceTiming&&(r.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&r.setExpiryData(L),r.loadVectorData(L,this.map.painter),a.am(this.dispatcher),u(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,u){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const Y=(p,r,u)=>({u_matrix:p,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:u}),Ae=(p,r,u,m,b,w,I,M,R,L,U,G,J,Q,le,de)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:u,u_zoom_transition:b,u_merc_center:w,u_image0:0,u_frustum_tl:I,u_frustum_tr:M,u_frustum_br:R,u_frustum_bl:L,u_globe_pos:U,u_globe_radius:G,u_viewport:J,u_grid_matrix:de?Float32Array.from(de):new Float32Array(9),u_skirt_height:Q,u_far_z_cutoff:le});class jr{constructor(r=0,u=0,m=0,b=0){if(isNaN(r)||r<0||isNaN(u)||u<0||isNaN(m)||m<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=u,this.left=m,this.right=b}interpolate(r,u,m){return null!=u.top&&null!=r.top&&(this.top=a.a2(r.top,u.top,m)),null!=u.bottom&&null!=r.bottom&&(this.bottom=a.a2(r.bottom,u.bottom,m)),null!=u.left&&null!=r.left&&(this.left=a.a2(r.left,u.left,m)),null!=u.right&&null!=r.right&&(this.right=a.a2(r.right,u.right,m)),this}getCenter(r,u){const m=a.at((this.left+r-this.right)/2,0,r),b=a.at((this.top+u-this.bottom)/2,0,u);return new a.P(m,b)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new jr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ho(p,r){const u=a.aw(p,3);a.ad.fromQuat(p,r),a.az(p,3,u)}function Zi(p,r){const u=a.av.identity([]);return a.av.rotateZ(u,u,-r),a.av.rotateX(u,u,-p),u}function Ro(p,r){const u=[p[0],p[1],0],m=[r[0],r[1],0];if(a._.length(u)>=1e-15){const I=a._.normalize([],u);a._.scale(m,I,a._.dot(m,I)),r[0]=m[0],r[1]=m[1]}const b=a._.cross([],r,p);if(a._.len(b)<1e-15)return null;const w=Math.atan2(-b[1],b[0]);return Zi(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),w)}class he{constructor(r,u){this.position=r,this.orientation=u}get position(){return this._position}set position(r){if(r){const u=r instanceof a.Y?r:new a.Y(r[0],r[1],r[2]);this._renderWorldCopies&&(u.x=a.au(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(r,u){if(this.orientation=null,!this.position)return;const m=this.position,b=this._elevation?this._elevation.getAtPointOrZero(a.Y.fromLngLat(r)):0,w=a.Y.fromLngLat(r,b),I=[w.x-m.x,w.y-m.y,w.z-m.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=Ro(I,u)}setPitchBearing(r,u){this.orientation=Zi(a.ab(r),a.ab(-u))}}class qe{constructor(r,u){this._transform=a.ad.identity([]),this.orientation=u,this.position=r}get mercatorPosition(){const r=this.position;return new a.Y(r[0],r[1],r[2])}get position(){const r=a.aw(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var u;r&&a.az(this._transform,3,[(u=r)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||a.av.identity([]),r&&ho(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,u){this._orientation=Zi(r,u),ho(this._transform,this._orientation)}forward(){const r=a.aw(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=a.aw(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=a.aw(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,u){const m=new Float64Array(16);return a.ad.invert(m,this.getWorldToCamera(r,u)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,u,m){const b=this.position;a._.scale(b,b,-r);const w=new Float64Array(16);return a.ad.fromScaling(w,[m,m,m]),a.ad.translate(w,w,b),w[10]*=u,w}getWorldToCamera(r,u){const m=new Float64Array(16),b=new Float64Array(4),w=this.position;return a.av.conjugate(b,this._orientation),a._.scale(w,w,-r),a.ad.fromQuat(m,b),a.ad.translate(m,m,w),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=u,m[9]*=u,m[10]*=u,m[11]*=u,m}getCameraToClipPerspective(r,u,m,b){const w=new Float64Array(16);return a.ad.perspective(w,r,u,m,b),w}getCameraToClipOrthographic(r,u,m,b,w,I){const M=new Float64Array(16);return a.ad.ortho(M,r,u,m,b,w,I),M}getDistanceToElevation(r,u=!1){const m=0===r?0:a.ax(r,u?a.ay(this.position[1]):this.position[1]),b=this.forward();return(m-this.position[2])/b[2]}clone(){return new qe([...this.position],[...this.orientation])}}const Pt={unknown:0,flipRequired:1,flipNotRequired:2},Ht=Math.tan(85*Math.PI/180);function Ut(p,r,u,m,b,w,I){const M=a.ad.create();if(u)if("globe"===w.name){const R=a.aB(b,r);a.ad.multiply(M,M,R)}else{const R=a.aC.invert([],I);M[0]=R[0],M[1]=R[1],M[4]=R[2],M[5]=R[3],m||a.ad.rotateZ(M,M,b.angle)}else a.ad.multiply(M,b.labelPlaneMatrix,p);return M}function ln(p,r,u,m,b,w,I){const M=Ut(p,r,u,m,b,w,I);return"globe"===w.name&&u||(M[2]=M[6]=M[10]=M[14]=0),M}function qn(p,r,u,m,b,w,I){if(u){if("globe"===w.name){const M=Ut(p,r,u,m,b,w,I);return a.ad.invert(M,M),a.ad.multiply(M,p,M),M}{const M=a.ad.clone(p),R=a.ad.identity([]);return R[0]=I[0],R[1]=I[1],R[4]=I[2],R[5]=I[3],a.ad.multiply(M,M,R),m||a.ad.rotateZ(M,M,-b.angle),M}}return b.glCoordMatrix}function ti(p,r,u,m){const b=[p,r,u,1];u?a.aA.transformMat4(b,b,m):Oo(b,b,m);const w=b[3];return b[0]/=w,b[1]/=w,b[2]/=w,b}function mi(p,r){return Math.min(.5+p/r*.5,1.5)}function ai(p,r){const u=p[0]/p[3],m=p[1]/p[3];return u>=-r[0]&&u<=r[0]&&m>=-r[1]&&m<=r[1]}function Hi(p,r,u,m,b,w,I,M,R,L){const U=u.transform,G=m?p.textSizeData:p.iconSizeData,J=a.aD(G,u.transform.zoom),Q="globe"===U.projection.name,le=[256/u.width*2+1,256/u.height*2+1],de=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;de.clear();let ge=null;Q&&(ge=m?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const xe=p.lineVertexArray,Ke=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,Qe=u.transform.width/u.transform.height;let et,yt=!1;for(let _t=0;_t<Ke.length;_t++){const St=Ke.get(_t),{numGlyphs:Ee,writingMode:tt}=St;if(tt!==a.aE.vertical||yt||et===a.aE.horizontal||(yt=!0),et=tt,(St.hidden||tt===a.aE.vertical)&&!yt){Di(Ee,de);continue}yt=!1;const Lt=new a.P(St.tileAnchorX,St.tileAnchorY);let{x:sn,y:zt,z:It}=U.projection.projectTilePoint(Lt.x,Lt.y,L.canonical);if(R){const[Mi,xi,di]=R(Lt);sn+=Mi,zt+=xi,It+=di}const hn=[sn,zt,It,1];if(a.aA.transformMat4(hn,hn,r),!ai(hn,le)){Di(Ee,de);continue}const Gn=hn[3],Xn=mi(u.transform.getCameraToCenterDistance(U.projection),Gn),Vn=a.aF(G,J,St),Xt=I?Vn/Xn:Vn*Xn,mn=ti(sn,zt,It,b);if(mn[3]<=0){Di(Ee,de);continue}let Pn={};const yi=I?null:R,bi=ur(St,Xt,!1,M,r,b,w,p.glyphOffsetArray,xe,de,ge,mn,Lt,Pn,Qe,yi,U.projection,L,I);yt=bi.useVertical,yi&&bi.needsFlipping&&(Pn={}),(bi.notEnoughRoom||yt||bi.needsFlipping&&ur(St,Xt,!0,M,r,b,w,p.glyphOffsetArray,xe,de,ge,mn,Lt,Pn,Qe,yi,U.projection,L,I).notEnoughRoom)&&Di(Ee,de)}m?(p.text.dynamicLayoutVertexBuffer.updateData(de),ge&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(ge)):(p.icon.dynamicLayoutVertexBuffer.updateData(de),ge&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(ge))}function Vi(p,r,u,m,b,w,I,M,R,L,U,G,J,Q,le,de){const{lineStartIndex:ge,glyphStartIndex:xe,segment:Ke}=M,Qe=xe+M.numGlyphs,et=ge+M.lineLength,yt=r.getoffsetX(xe),_t=r.getoffsetX(Qe-1),St=wo(p*yt,u,m,b,w,I,Ke,ge,et,R,L,U,G,J,!0,Q,le,de);if(!St)return null;const Ee=wo(p*_t,u,m,b,w,I,Ke,ge,et,R,L,U,G,J,!0,Q,le,de);return Ee?{first:St,last:Ee}:null}function er(p,r,u,m){return p===a.aE.horizontal&&Math.abs(m)>Math.abs(u)?{useVertical:!0}:p===a.aE.vertical?m>0?{needsFlipping:!0}:null:r!==Pt.unknown&&(0===(b=u)||Math.abs(m/b)>Ht)?r===Pt.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null;var b}function ur(p,r,u,m,b,w,I,M,R,L,U,G,J,Q,le,de,ge,xe,Ke){const Qe=r/24,et=p.lineOffsetX*Qe,yt=p.lineOffsetY*Qe,{lineStartIndex:_t,glyphStartIndex:St,numGlyphs:Ee,segment:tt,writingMode:Lt,flipState:sn}=p,zt=_t+p.lineLength,It=hn=>{if(U){const[Xt,mn,Pn]=hn.up,yi=L.length;a.aG(U,yi+0,Xt,mn,Pn),a.aG(U,yi+1,Xt,mn,Pn),a.aG(U,yi+2,Xt,mn,Pn),a.aG(U,yi+3,Xt,mn,Pn)}const[Gn,Xn,Vn]=hn.point;a.aH(L,Gn,Xn,Vn,hn.angle)};if(Ee>1){const hn=Vi(Qe,M,et,yt,u,G,J,p,R,w,Q,de,!1,ge,xe,Ke);if(!hn)return{notEnoughRoom:!0};if(m&&!u){let[Gn,Xn,Vn]=hn.first.point,[Xt,mn,Pn]=hn.last.point;[Gn,Xn]=ti(Gn,Xn,Vn,I),[Xt,mn]=ti(Xt,mn,Pn,I);const yi=er(Lt,sn,(Xt-Gn)*le,mn-Xn);if(p.flipState=yi&&yi.needsFlipping?Pt.flipRequired:Pt.flipNotRequired,yi)return yi}It(hn.first);for(let Gn=St+1;Gn<St+Ee-1;Gn++){const Xn=wo(Qe*M.getoffsetX(Gn),et,yt,u,G,J,tt,_t,zt,R,w,Q,de,!1,!1,ge,xe,Ke);if(!Xn)return L.length-=4*(Gn-St),{notEnoughRoom:!0};It(Xn)}It(hn.last)}else{if(m&&!u){const Gn=ti(J.x,J.y,0,b),Xn=_t+tt+1,Vn=new a.P(R.getx(Xn),R.gety(Xn)),Xt=ti(Vn.x,Vn.y,0,b),mn=Xt[3]>0?Xt:Fo(J,Vn,Gn,1,b,void 0,ge,xe.canonical),Pn=er(Lt,sn,(mn[0]-Gn[0])*le,mn[1]-Gn[1]);if(p.flipState=Pn&&Pn.needsFlipping?Pt.flipRequired:Pt.flipNotRequired,Pn)return Pn}const hn=wo(Qe*M.getoffsetX(St),et,yt,u,G,J,tt,_t,zt,R,w,Q,de,!1,!1,ge,xe,Ke);if(!hn)return{notEnoughRoom:!0};It(hn)}return{}}function To(p,r,u,m,b){const{x:w,y:I,z:M}=m.projectTilePoint(p.x,p.y,r);if(!b)return ti(w,I,M,u);const[R,L,U]=b(p);return ti(w+R,I+L,M+U,u)}function Fo(p,r,u,m,b,w,I,M){const R=To(p.sub(r)._unit()._add(p),M,b,I,w);return a._.sub(R,u,R),a._.normalize(R,R),a._.scaleAndAdd(R,u,R,m)}function wo(p,r,u,m,b,w,I,M,R,L,U,G,J,Q,le,de,ge,xe){const Ke=m?p-r:p+r;let Qe=Ke>0?1:-1,et=0;m&&(Qe*=-1,et=Math.PI),Qe<0&&(et+=Math.PI);let yt=M+I+(Qe>0?0:1)|0,_t=b,St=b,Ee=0,tt=0;const Lt=Math.abs(Ke),sn=[],zt=[];let It=w,hn=It;const Gn=()=>Fo(hn,It,St,Lt-Ee+1,U,J,de,ge.canonical);for(;Ee+tt<=Lt;){if(yt+=Qe,yt<M||yt>=R)return null;if(St=_t,hn=It,sn.push(St),Q&&zt.push(hn),It=new a.P(L.getx(yt),L.gety(yt)),_t=G[yt],!_t){const xi=To(It,ge.canonical,U,de,J);_t=xi[3]>0?G[yt]=xi:Gn()}Ee+=tt,tt=a._.distance(St,_t)}le&&J&&(G[yt]&&(_t=Gn(),tt=a._.distance(St,_t)),G[yt]=_t);const Xn=(Lt-Ee)/tt,Vn=It.sub(hn)._mult(Xn)._add(hn),Xt=a._.sub([],_t,St),mn=a._.scaleAndAdd([],St,Xt,Xn);let Pn=[0,0,1],yi=Xt[0],bi=Xt[1];if(xe&&(Pn=de.upVector(ge.canonical,Vn.x,Vn.y),0!==Pn[0]||0!==Pn[1]||1!==Pn[2])){const xi=[Pn[2],0,-Pn[0]],di=a._.cross([],Pn,xi);a._.normalize(xi,xi),a._.normalize(di,di),yi=a._.dot(Xt,xi),bi=a._.dot(Xt,di)}if(u){const xi=a._.cross([],Pn,Xt);a._.normalize(xi,xi),a._.scaleAndAdd(mn,mn,xi,u*Qe)}const Mi=et+Math.atan2(bi,yi);return sn.push(mn),Q&&zt.push(Vn),{point:mn,angle:Mi,path:sn,tilePath:zt,up:Pn}}function Di(p,r){const u=r.length,m=u+4*p;r.resize(m),r.float32.fill(-1/0,4*u,4*m)}function Oo(p,r,u){const m=r[0],b=r[1];return p[0]=u[0]*m+u[4]*b+u[12],p[1]=u[1]*m+u[5]*b+u[13],p[3]=u[3]*m+u[7]*b+u[15],p}const eo=(p,r,u)=>(1-u)*p+u*r,ga=p=>p*p*p*p*p;class Do{constructor(r,u,m,b,w,I,M){this.tileSize=512,this._renderWorldCopies=void 0===w||w,this._minZoom=r||0,this._maxZoom=u||22,this._minPitch=m??0,this._maxPitch=b??60,this.setProjection(I),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new a.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new jr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new qe,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const r=new Do(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(r,u=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||m)&&this._updateCameraOnTerrain(),(r||m)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return a.ah(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=a.aJ(this.projectionOptions);const m=!Z(u,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.aJ({name:"mercator"});const u=r!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.au(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const u=-r*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=a.aC.create(),a.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const u=a.at(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=a.ab(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const u=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const m=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let b=0,w=0;for(let I=0;I<u.length;I++){const M=new a.P(u[I][0]*this.width,m+u[I][1]*(this.height-m)),R=r.pointCoordinate(M);if(!R)continue;const L=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);b+=R[3]*L,w+=L}return 0===w?NaN:b/w}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const r=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*u,b=this._mercatorZfromZoom(r),w=this._mercatorZfromZoom(this._maxZoom),I=Math.max(b-m,w);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let m;m=r.z<this._camera.position[2]?[u.x,u.y,u.z]:[r.x,r.y,r.z];const b=a._.length(a._.sub([],this._camera.position,m));return a.at(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let u=!1;if(r.orientation&&!a.av.exactEquals(r.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(r.orientation)),r.position){const m=[r.position.x,r.position.y,r.position.z];a._.exactEquals(m,this._camera.position)||(this._setCameraPosition(m),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,u=new he;return u.position=new a.Y(r[0],r[1],r[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(r){if(!a.av.length(r))return!1;a.av.normalize(r,r);const u=a._.transformQuat([],[0,0,-1],r),m=a._.transformQuat([],[0,-1,0],r);if(m[2]<0)return!1;const b=Ro(u,m);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(r){const u=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;r[2]=a.at(r[2],b/m,b/u),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,u,m){this._unmodified=!1,this._edgeInsets.interpolate(r,u,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const u=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(r){const u=[new a.aK(0,r)];if(this.renderWorldCopies){const m=this.pointCoordinate(new a.P(0,0)),b=this.pointCoordinate(new a.P(this.width,0)),w=this.pointCoordinate(new a.P(this.width,this.height)),I=this.pointCoordinate(new a.P(0,this.height)),M=Math.floor(Math.min(m.x,b.x,w.x,I.x)),R=Math.floor(Math.max(m.x,b.x,w.x,I.x)),L=1;for(let U=M-L;U<=R+L;U++)0!==U&&u.push(new a.aK(U,r))}return u}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(r,u,m){let b=[];if(0===u[0]&&0===u[1])return b;for(const I of r){const M=I.canonical,R=I.overscaledZ,L=I.wrap,U=1<<M.z,G=M.x+1<U,J=M.x>0,Q=M.y+1<U,le=M.y>0,de=I.wrap-(J?0:1),ge=I.wrap+(G?0:1),xe=J?M.x-1:U-1,Ke=G?M.x+1:0;u[0]<0?(b.push(new a.aL(R,ge,M.z,Ke,M.y)),u[1]<0&&Q&&(b.push(new a.aL(R,L,M.z,M.x,M.y+1)),b.push(new a.aL(R,ge,M.z,Ke,M.y+1))),u[1]>0&&le&&(b.push(new a.aL(R,L,M.z,M.x,M.y-1)),b.push(new a.aL(R,ge,M.z,Ke,M.y-1)))):u[0]>0?(b.push(new a.aL(R,de,M.z,xe,M.y)),u[1]<0&&Q&&(b.push(new a.aL(R,L,M.z,M.x,M.y+1)),b.push(new a.aL(R,de,M.z,xe,M.y+1))),u[1]>0&&le&&(b.push(new a.aL(R,L,M.z,M.x,M.y-1)),b.push(new a.aL(R,de,M.z,xe,M.y-1)))):u[1]<0&&Q?b.push(new a.aL(R,L,M.z,M.x,M.y+1)):le&&b.push(new a.aL(R,L,M.z,M.x,M.y-1))}if(b.length>1){b.sort((R,L)=>R.overscaledZ-L.overscaledZ||R.wrap-L.wrap||R.canonical.z-L.canonical.z||R.canonical.x-L.canonical.x||R.canonical.y-L.canonical.y);let I=0,M=0;for(;M<b.length;)b[M].equals(b[I])?++M:b[++I]=b[M++];b.length=I+1}const w=[];for(const I of b)b.some(M=>I.isChildOf(M))||w.push(I);return b=w.filter(I=>!r.some(M=>!!(I.overscaledZ<m&&M.isChildOf(I))||I.equals(M)||I.isChildOf(M))),b}coveringTiles(r){let u=this.coveringZoomLevel(r);const m=u,b=this.elevation&&this.elevation.exaggeration(),w=b&&!r.isTerrainDEM,I="mercator"===this.projection.name;if(void 0!==r.minzoom&&u<r.minzoom)return[];void 0!==r.maxzoom&&u>r.maxzoom&&(u=r.maxzoom);const M=this.locationCoordinate(this.center),R=this.center.lat,L=1<<u,U=[L*M.x,L*M.y,0],G="globe"===this.projection.name,J=!G,Q=a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,J),le=G?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),de=L*a.ax(1,this.center.lat),ge=this._camera.position[2]/a.ax(1,this.center.lat),xe=[L*le.x,L*le.y,ge*(J?1:de)],Ke=G||b,Qe=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),et=this.isLODDisabled(!0)?u:0;let yt;if(this._elevation&&r.isTerrainDEM)yt=1e4*this._elevation.exaggeration();else if(this._elevation){const Xt=this._elevation.getMinMaxForVisibleTiles();yt=Xt?Xt.max:this._centerAltitude}else yt=this._centerAltitude;const _t=r.isTerrainDEM?-yt:this._elevation?this._elevation.getMinElevationBelowMSL():0,St=this.projection.isReprojectedInTileSpace?a.aN(this):1,Ee=Xt=>{const Pn=new a.Y(Xt.x+25e-6,Xt.y,Xt.z),yi=new a.Y(Xt.x,Xt.y+25e-6,Xt.z),bi=Xt.toLngLat(),Mi=Pn.toLngLat(),xi=yi.toLngLat(),di=this.locationCoordinate(bi),In=this.locationCoordinate(Mi),Li=this.locationCoordinate(xi),Ir=Math.hypot(In.x-di.x,In.y-di.y),Ji=Math.hypot(Li.x-di.x,Li.y-di.y);return Math.sqrt(Ir*Ji)*St/25e-6},tt=Xt=>{const mn=yt,Pn=_t;return{aabb:a.aQ(this,L,0,0,0,Xt,Pn,mn,this.projection),zoom:0,x:0,y:0,minZ:Pn,maxZ:mn,wrap:Xt,fullyVisible:!1}},Lt=[];let sn=[];const zt=u,It=r.reparseOverscaled?m:u,hn=(ge-this._centerAltitude)*de,Gn=Xt=>{if(!this._elevation||!Xt.tileID||!I)return;const mn=this._elevation.getMinMaxForTile(Xt.tileID),Pn=Xt.aabb;mn?(Pn.min[2]=mn.min,Pn.max[2]=mn.max,Pn.center[2]=(Pn.min[2]+Pn.max[2])/2):(Xt.shouldSplit=Vn(Xt),Xt.shouldSplit||(Pn.min[2]=Pn.max[2]=Pn.center[2]=this._centerAltitude))},Xn=(Xt,mn)=>{if(.707*mn<Xt)return 1;const Pn=mn/Xt;return Pn/(1.4144271570014144+(Math.pow(1.1,Pn-1.4144271570014144+1)-1)/(1.1-1)-1)},Vn=Xt=>{if(Xt.zoom<et)return!0;if(Xt.zoom===zt)return!1;if(null!=Xt.shouldSplit)return Xt.shouldSplit;const mn=Xt.aabb.distanceX(xe),Pn=Xt.aabb.distanceY(xe);let yi=hn,bi=1;if(G){yi=Xt.aabb.distanceZ(xe);const Ji=Math.pow(2,Xt.zoom),hr=a.ay((Xt.y+1)/Ji),Fr=a.ay(Xt.y/Ji),fr=Math.min(Math.max(R,hr),Fr),Rr=a.b4(fr)/a.b4(R);if(bi=fr===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Rr/this._mercatorScaleRatio),this.zoom<=a.b1&&Xt.zoom===zt-1&&Rr>=.9)return!0}else if(w&&(yi=Xt.aabb.distanceZ(xe)*de),this.projection.isReprojectedInTileSpace&&m<=5){const Ji=Math.pow(2,Xt.zoom),hr=Ee(new a.Y((Xt.x+.5)/Ji,(Xt.y+.5)/Ji));bi=hr>.85?1:hr}if(!I){const Ji=Math.sqrt(mn*mn+Pn*Pn+yi*yi);let hr=(1<<zt-Xt.zoom)*Qe*bi;return hr*=Xn(Math.max(yi,hn),Ji),Ji<hr}let Mi=Number.MAX_VALUE,xi=0;const di=Xt.aabb.getCorners(),In=[];for(const Ji of di){a._.sub(In,Ji,xe),G||(w?In[2]*=de:In[2]=hn);const hr=a._.dot(In,this._camera.forward());hr<Mi&&(Mi=hr,xi=Math.abs(In[2]))}let Li=(1<<zt-Xt.zoom)*Qe*bi;if(Li*=Xn(Math.max(xi,hn),Mi),Mi<Li)return!0;const Ir=Xt.aabb.closestPoint(U);return Ir[0]===U[0]&&Ir[1]===U[1]};if(this.renderWorldCopies)for(let Xt=1;Xt<=3;Xt++)Lt.push(tt(-Xt)),Lt.push(tt(Xt));for(Lt.push(tt(0));Lt.length>0;){const Xt=Lt.pop(),mn=Xt.x,Pn=Xt.y;let yi=Xt.fullyVisible;const bi=()=>"globe"===this.projection.name&&(0===Xt.y||Xt.y===(1<<Xt.zoom)-1);if(!yi){let Mi=Ke?Xt.aabb.intersects(Q):Xt.aabb.intersectsFlat(Q);if(0===Mi&&bi()){const xi=new a.aO(Xt.zoom,mn,Pn);Mi=a.aP(this,L,xi,!0).intersects(Q)}if(0===Mi)continue;yi=2===Mi}if(Xt.zoom!==zt&&Vn(Xt))for(let Mi=0;Mi<4;Mi++){const xi=(mn<<1)+Mi%2,di=(Pn<<1)+(Mi>>1),In={aabb:I?Xt.aabb.quadrant(Mi):a.aQ(this,L,Xt.zoom+1,xi,di,Xt.wrap,Xt.minZ,Xt.maxZ,this.projection),zoom:Xt.zoom+1,x:xi,y:di,wrap:Xt.wrap,fullyVisible:yi,tileID:void 0,shouldSplit:void 0,minZ:Xt.minZ,maxZ:Xt.maxZ};w&&!G&&(In.tileID=new a.aL(Xt.zoom+1===zt?It:Xt.zoom+1,Xt.wrap,Xt.zoom+1,xi,di),Gn(In)),Lt.push(In)}else{const Mi=Xt.zoom===zt?It:Xt.zoom;if(r.minzoom&&r.minzoom>Mi)continue;if(!yi){let Li=Ke?Xt.aabb.intersectsPrecise(Q):Xt.aabb.intersectsPreciseFlat(Q);if(0===Li&&bi()){const Ir=new a.aO(Xt.zoom,mn,Pn);Li=a.aP(this,L,Ir,!0).intersectsPrecise(Q)}if(0===Li)continue}const xi=U[0]-(.5+mn+(Xt.wrap<<Xt.zoom))*(1<<u-Xt.zoom),di=U[1]-.5-Pn,In=Xt.tileID?Xt.tileID:new a.aL(Mi,Xt.wrap,Xt.zoom,mn,Pn);sn.push({tileID:In,distanceSq:xi*xi+di*di})}}if(this.fogCullDistSq){const Xt=this.fogCullDistSq,mn=this.horizonLineFromTop();sn=sn.filter(Pn=>{const yi=[0,0,0,1],bi=[a.a3,a.a3,0,1],Mi=this.calculateFogTileMatrix(Pn.tileID.toUnwrapped());a.aA.transformMat4(yi,yi,Mi),a.aA.transformMat4(bi,bi,Mi);const xi=a.aA.min([],yi,bi),di=a.aA.max([],yi,bi),In=a.aR(xi,di);if(0===In)return!0;let Li=!1;const Ir=this._elevation;if(Ir&&In>Xt&&0!==mn){const Ji=this.calculateProjMatrix(Pn.tileID.toUnwrapped());let hr;r.isTerrainDEM||(hr=Ir.getMinMaxForTile(Pn.tileID)),hr||(hr={min:_t,max:yt});const Fr=a.b2(this.rotation),fr=[Fr[0]*a.a3,Fr[1]*a.a3,hr.max];a._.transformMat4(fr,fr,Ji),Li=(1-fr[1])*this.height*.5<mn}return In<Xt||Li})}return sn.sort((Xt,mn)=>Xt.distanceSq-mn.distanceSq).map(Xt=>Xt.tileID)}resize(r,u){this.width=r,this.height=u,this.pixelsToGLUnits=[2/r,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const u=a.at(r.lat,-a.aS,a.aS),m=this.projection.project(r.lng,u);return new a.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,u){let m,b;const w=this.centerPoint;if("globe"===this.projection.name){const M=this.worldSize;m=(u.x-w.x)/M,b=(u.y-w.y)/M}else{const M=this.pointCoordinate(u),R=this.pointCoordinate(w);m=M.x-R.x,b=M.y-R.y}const I=this.locationCoordinate(r);this.setLocation(new a.Y(I.x-m,I.y-b))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,u){const m=u?a.ax(u,r.lat):void 0,b=this.projection.project(r.lng,r.lat);return new a.Y(b.x,b.y,m)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,u){const m=u??this._centerAltitude,b=[r.x,r.y,0,1],w=[r.x,r.y,1,1];a.aA.transformMat4(b,b,this.pixelMatrixInverse),a.aA.transformMat4(w,w,this.pixelMatrixInverse);const I=w[3];a.aA.scale(b,b,1/b[3]),a.aA.scale(w,w,1/I);const M=b[2],R=w[2];return{p0:b,p1:w,t:M===R?0:(m-M)/(R-M)}}screenPointToMercatorRay(r){const u=[r.x,r.y,0,1],m=[r.x,r.y,1,1];return a.aA.transformMat4(u,u,this.pixelMatrixInverse),a.aA.transformMat4(m,m,this.pixelMatrixInverse),a.aA.scale(u,u,1/u[3]),a.aA.scale(m,m,1/m[3]),u[2]=a.ax(u[2],this._center.lat)*this.worldSize,m[2]=a.ax(m[2],this._center.lat)*this.worldSize,a.aA.scale(u,u,1/this.worldSize),a.aA.scale(m,m,1/this.worldSize),new a.aT([u[0],u[1],u[2]],a._.normalize([],a._.sub([],m,u)))}rayIntersectionCoordinate(r){const{p0:u,p1:m,t:b}=r,w=a.ax(u[2],this._center.lat),I=a.ax(m[2],this._center.lat);return new a.Y(a.a2(u[0],m[0],b)/this.worldSize,a.a2(u[1],m[1],b)/this.worldSize,a.a2(w,I,b))}pointCoordinate(r,u=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,u)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let u=this.projection.pointCoordinate3D(this,r.x,r.y);if(u)return new a.Y(u[0],u[1],u[2]);let m=0,b=this.horizonLineFromTop();if(r.y>b)return this.pointCoordinate(r);const w=.02*b,I=r.clone();for(let M=0;M<10&&b-m>w;M++){I.y=a.a2(m,b,.66);const R=this.projection.pointCoordinate3D(this,I.x,I.y);R?(b=I.y,u=R):m=I.y}return u?new a.Y(u[0],u[1],u[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=a.aU)return!this.isPointAboveHorizon(r);const u=this.pointCoordinate(r);return u.y>=0&&u.y<=1}_coordinatePoint(r,u){const m=u&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,b=[r.x*this.worldSize,r.y*this.worldSize,m+r.toAltitude(),1];return a.aA.transformMat4(b,b,this.pixelMatrix),b[3]>0?new a.P(b[0]/b[3],b[1]/b[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:u}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,w=this.pointLocation3D(new a.P(u,r)),I=this.pointLocation3D(new a.P(b,r)),M=this.pointLocation3D(new a.P(b,m)),R=this.pointLocation3D(new a.P(u,m));let L=Math.min(w.lng,I.lng,M.lng,R.lng),U=Math.max(w.lng,I.lng,M.lng,R.lng),G=Math.min(w.lat,I.lat,M.lat,R.lat),J=Math.max(w.lat,I.lat,M.lat,R.lat);const Q=Math.pow(2,-this.zoom)/16*270,le="globe"===this.projection.name?1:4,de=(ge,xe,Ke,Qe,et)=>{const yt=(ge+Ke)/2,_t=(xe+Qe)/2,St=new a.P(yt,_t),{lng:Ee,lat:tt}=this.pointLocation3D(St),Lt=Math.max(0,L-Ee,G-tt,Ee-U,tt-J);L=Math.min(L,Ee),U=Math.max(U,Ee),G=Math.min(G,tt),J=Math.max(J,tt),(et<le||Lt>Q)&&(de(ge,xe,yt,_t,et+1),de(yt,_t,Ke,Qe,et+1))};if(de(u,r,b,r,1),de(b,r,b,m,1),de(b,m,u,m,1),de(u,m,u,r,1),"globe"===this.projection.name){const[ge,xe]=a.aV(this);ge?(J=90,U=180,L=-180):xe&&(G=-90,U=180,L=-180)}return new a.ai(new a.aI(L,G),new a.aI(U,J))}_getBoundsRectangular(r,u){const{top:m,left:b}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,M=new a.P(b,m),R=new a.P(I,m),L=new a.P(I,w),U=new a.P(b,w);let G=this.pointCoordinate(M,r),J=this.pointCoordinate(R,r);const Q=this.pointCoordinate(L,u),le=this.pointCoordinate(U,u),de=(ge,xe)=>(xe.y-ge.y)/(xe.x-ge.x);return G.y>1&&J.y>=0?G=new a.Y((1-le.y)/de(le,G)+le.x,1):G.y<0&&J.y<=1&&(G=new a.Y(-le.y/de(le,G)+le.x,0)),J.y>1&&G.y>=0?J=new a.Y((1-Q.y)/de(Q,J)+Q.x,1):J.y<0&&G.y<=1&&(J=new a.Y(-Q.y/de(Q,J)+Q.x,0)),(new a.ai).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=r.visibleDemTiles.reduce((m,b)=>{if(b.dem){const w=b.dem.tree;m.min=Math.min(m.min,w.minimums[0]),m.max=Math.max(m.max,w.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*r.exaggeration(),u.max*r.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-u*(1-this._horizonShift);return r?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-a.aS,this.maxLat=a.aS,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.aj(this.minLng)*this.tileSize,this.worldMaxX=a.aj(this.maxLng)*this.tileSize,this.worldMinY=a.ak(this.maxLat)*this.tileSize,this.worldMaxY=a.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,u){return this.projection.createTileMatrix(this,u,r)}calculateDistanceTileData(r){const u=r.key,m=this._distanceTileDataCache;if(m[u])return m[u];const b=r.canonical,w=1/this.height,I=this.cameraWorldSize,M=I/this.zoomScale(b.z),R=(b.x+Math.pow(2,b.z)*r.wrap)*M,L=b.y*M,U=this.point;U.x*=I/this.worldSize,U.y*=I/this.worldSize;const G=this.angle,J=Math.sin(-G),Q=-Math.cos(-G);return m[u]={bearing:[J,Q],center:[(U.x-R)*w,(U.y-L)*w],scale:M/a.a3*w},m[u]}calculateFogTileMatrix(r){const u=r.key,m=this._fogTileMatrixCache;if(m[u])return m[u];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return a.ad.multiply(b,this.worldToFogMatrix,b),m[u]=new Float32Array(b),m[u]}calculateProjMatrix(r,u=!1,m=!1){const b=r.key;let w;if(w=m?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,w[b])return w[b];const I=this.calculatePosMatrix(r,this.worldSize);let M;return M=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,a.ad.multiply(I,M,I),w[b]=new Float32Array(I),w[b]}calculatePixelsToTileUnitsMatrix(r){const u=r.tileID.key,m=this._pixelsToTileUnitsCache;if(m[u])return m[u];const b=a.aW(r,this);return m[u]=b,m[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const r=1/this.worldSize,u=a.ad.fromScaling([],[r,r,r]);return a.ad.multiply(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const r=this._elevation;this._updateCameraState();const u=a.ax(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),b=this._camera.forward(),w=a.ax(1,this._center.lat);m[2]/=w,b[2]/=w,a._.normalize(b,b);const I=r.raycast(m,b,r.exaggeration());if(I){const M=a._.scaleAndAdd([],m,b,I),R=new a.Y(M[0],M[1],a.ax(M[2],a.ay(M[1]))),L=(R.z+a._.length([R.x-m[0],R.y-m[1],R.z-m[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const u=this._elevation,m=a.ax(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(m),w=u.getAtPointOrZero(new a.Y(...b)),I=this.pixelsPerMeter/this.worldSize*w,M=this._minimumHeightOverTerrain(),R=b[2]-I;if(R<=M)if(R<0||r){const L=this.locationCoordinate(this._center,this._centerAltitude),U=[b[0],b[1],L.z-b[2]],G=a._.length(U);U[2]-=(M-R)/this._pixelsPerMercatorPixel;const J=a._.length(U);if(0===J)return;a._.scale(U,U,G/J*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],L.z*this._pixelsPerMercatorPixel-U[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const J=this.center;return J.lat=a.at(J.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(J.lng=a.at(J.lng,this.minLng,this.maxLng)),this.center=J,void(this._constraining=!1)}const u=this._unmodified,{x:m,y:b}=this.point;let w=0,I=m,M=b;const R=this.width/2,L=this.height/2,U=this.worldMinY*this.scale,G=this.worldMaxY*this.scale;if(b-L<U&&(M=U+L),b+L>G&&(M=G-L),G-U<this.height&&(w=Math.max(w,this.height/(G-U)),M=(G+U)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const J=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,le=this.worldSize/2-(J+Q)/2;I=(m+le+this.worldSize)%this.worldSize-le,I-R<J&&(I=J+R),I+R>Q&&(I=Q-R),Q-J<this.width&&(w=Math.max(w,this.width/(Q-J)),I=(Q+J)/2)}I===m&&M===b||(this.center=this.unproject(new a.P(I,M))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,u="globe"===this.projection.name,m=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=a.ax(1,this.center.lat)/a.ax(1,a.b3));const b=a.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w="meters"===this.projection.zAxisUnit?m:1,I=this._camera.getWorldToCamera(this.worldSize,w);let M;const R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(R[8]=2*-r.x/this.width,R[9]=2*r.y/this.height,this.isOrthographic){let tt=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Lt=tt*this.aspect,sn=-Lt,zt=-tt;Lt-=r.x,sn-=r.x,tt+=r.y,zt+=r.y,M=this._camera.getCameraToClipOrthographic(sn,Lt,zt,tt,this._nearZ,this._farZ),((It,hn,Gn,Xn)=>{for(let Vn=0;Vn<16;Vn++)It[Vn]=eo(hn[Vn],Gn[Vn],Xn)})(M,M,R,ga(this.pitch>=15?1:this.pitch/15))}else M=R;const L=a.ad.mul([],R,I);let U=a.ad.mul([],M,I);if(this.projection.isReprojectedInTileSpace){const tt=this.locationCoordinate(this.center),Lt=a.ad.identity([]);a.ad.translate(Lt,Lt,[tt.x*this.worldSize,tt.y*this.worldSize,0]),a.ad.multiply(Lt,Lt,a.aY(this)),a.ad.translate(Lt,Lt,[-tt.x*this.worldSize,-tt.y*this.worldSize,0]),a.ad.multiply(U,U,Lt),a.ad.multiply(L,L,Lt),this.inverseAdjustmentMatrix=a.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.ad.scale([],U,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=U,this.invProjMatrix=a.ad.invert(new Float64Array(16),this.projMatrix),u){const tt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);tt[8]=2*-r.x/this.width,tt[9]=2*r.y/this.height,this.expandedFarZProjMatrix=a.ad.mul([],tt,I)}else this.expandedFarZProjMatrix=this.projMatrix;const G=a.ad.invert([],M);this.frustumCorners=a.a_.fromInvProjectionMatrix(G,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);const J=new Float32Array(16);a.ad.identity(J),a.ad.scale(J,J,[1,-1,1]),a.ad.rotateX(J,J,this._pitch),a.ad.rotateZ(J,J,this.angle);const Q=a.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.ad.clone(Q);const le=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Q[8]=2*-r.x/this.width,Q[9]=2*(r.y+le)/this.height,this.skyboxMatrix=a.ad.multiply(J,Q,J);const de=this.point,ge=de.x,xe=de.y,Ke=this.width%2/2,Qe=this.height%2/2,et=Math.cos(this.angle),yt=Math.sin(this.angle),_t=ge-Math.round(ge)+et*Ke+yt*Qe,St=xe-Math.round(xe)+et*Qe+yt*Ke,Ee=new Float64Array(U);if(a.ad.translate(Ee,Ee,[_t>.5?_t-1:_t,St>.5?St-1:St,0]),this.alignedProjMatrix=Ee,U=a.ad.create(),a.ad.scale(U,U,[this.width/2,-this.height/2,1]),a.ad.translate(U,U,[1,-1,0]),this.labelPlaneMatrix=U,U=a.ad.create(),a.ad.scale(U,U,[1,-1,1]),a.ad.translate(U,U,[-1,-1,0]),a.ad.scale(U,U,[2/this.width,2/this.height,1]),this.glCoordMatrix=U,this.pixelMatrix=a.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},U=a.ad.invert(new Float64Array(16),this.pixelMatrix),!U)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=U,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=a.a$(this);const tt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a._.transformMat4(tt,tt,I),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=U;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,m=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,w=[r,r,u];a._.scale(w,w,b),a._.scale(m,m,-1),a._.multiply(m,m,w);const I=a.ad.create();a.ad.translate(I,I,m),a.ad.scale(I,I,w),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,u,b)}_computeCameraPosition(r){const u=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),b=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-r/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-m[0]*w,b.y/this.worldSize-m[1]*w,r/this.worldSize*this._centerAltitude-m[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],b=r[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(w=Math.min((u-m)/b,1)),this._camera.position=a._.scaleAndAdd([],this._camera.position,r,w),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,u=this._camera.forward(),{pitch:m,bearing:b}=this._camera.getPitchBearing(),w=a.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.ab(this._maxPitch)),M=Math.max((r[2]-w)/Math.cos(m),I),R=this._zoomFromMercatorZ(M);a._.scaleAndAdd(r,r,u,M),this._pitch=a.at(m,a.ab(this.minPitch),a.ab(this.maxPitch)),this.angle=a.au(b,-Math.PI,Math.PI),this._setZoom(a.at(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.Y(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let u=0,m=a.aU,b=0,w=1/0;for(;m-u>1e-6&&m>u;){const I=u+.5*(m-u),M=this.tileSize*Math.pow(2,I),R=this.getCameraToCenterDistance(this.projection,I,M),L=this.scaleZoom(R/(r*this.tileSize)),U=Math.abs(I-L);U<w&&(w=U,b=I),I<L?u=I:m=I}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,u){const m=Math.min(r.x,u.x),b=Math.max(r.x,u.x),w=Math.min(r.y,u.y),I=Math.max(r.y,u.y);if(w<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const M=[new a.P(m,w),new a.P(b,I),new a.P(m,I),new a.P(b,w)],R=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const U of M){const G=this.pointRayIntersection(U);if(G.t<0)return!0;const J=this.rayIntersectionCoordinate(G);if(J.x<R||J.y<0||J.x>L||J.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(r,u){const m=a._.length(a._.sub([],this._camera.position,r)),b=this._zoomFromMercatorZ(m)+u;return m-this._mercatorZfromZoom(b)}getCameraPoint(){if("globe"===this.projection.name){const r=function([u,m,b],w){const I=[u,m,b,1];a.aA.transformMat4(I,I,w);const M=I[3]=Math.max(I[3],1e-6);return I[0]/=M,I[1]/=M,I[2]/=M,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,r))}}getCameraToCenterDistance(r,u=this.zoom,m=this.worldSize){const b=a.aX(r,u,this.width,this.height,1024),w=r.pixelSpaceConversion(this.center.lat,m,b);let I=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(I=eo(1,I,ga(this.pitch>=15?1:this.pitch/15))),I}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&a.ad.multiply(r,r,this.globeMatrix),r}getFrustum(r){return a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,"meters"===this.projection.zAxisUnit)}}const Wr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},ea=(p,r)=>{if(r>0&&p.terrain&&a.w("Cutoff is currently disabled on terrain"),r<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const u=p.transform,m=Math.max(Math.abs(u._zoom-(p.minCutoffZoom-1)),1),b=u.isLODDisabled(!1)?a.$(60,45,u.pitch):a.$(30,15,u.pitch),w=u._farZ-u._nearZ,I=r*u.height,M=((1-(R=b))*u.cameraToCenterDistance+R*(u._farZ+I))*m;var R;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(M-u._nearZ)/w,(M-I-u._nearZ)/w]}}},Zo={cascadeCount:2,shadowMapResolution:2048};class Fs{constructor(r,u){this.aabb=r,this.lastCascade=u}}class _a{add(r,u){const m=this.receivers[r.key];void 0!==m?(m.aabb.min[0]=Math.min(m.aabb.min[0],u.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],u.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],u.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],u.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],u.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],u.max[2])):this.receivers[r.key]=new Fs(u,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,u,m){const b=a.b6.fromPoints(r.points);let w=0;for(const I in this.receivers){const M=this.receivers[I];if(!M||!b.intersectsAabb(M.aabb))continue;M.aabb.min=b.closestPoint(M.aabb.min),M.aabb.max=b.closestPoint(M.aabb.max);const R=M.aabb.getCorners();for(let L=0;L<m.length;L++){let U=!0;for(const G of R){const J=[G[0]*u,G[1]*u,G[2]];if(a._.transformMat4(J,J,m[L].matrix),J[0]<-1||J[0]>1||J[1]<-1||J[1]>1){U=!1;break}}if(M.lastCascade=L,w=Math.max(w,L),U)break}}return w+1}}class Xa{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new _a,this._depthMode=new a.ae(r.context.gl.LEQUAL,a.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(Zo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(Zo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,u){const m=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!u||!u.properties)return;const b=u.properties.get("shadow-intensity");if(!u.shadowsEnabled()||b<=0||(this._shadowLayerCount=m.style.order.reduce((le,de)=>{const ge=m.style._mergedLayers[de];return le+(ge.hasShadowPass()&&!ge.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=m.context,I=Zo.shadowMapResolution,M=Zo.shadowMapResolution;if(0===this._cascades.length||Zo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let le=0;le<Zo.cascadeCount;++le){const de=m._shadowMapDebug,ge=w.gl,xe=w.createFramebuffer(I,M,de,"texture"),Ke=new a.T(w,{width:I,height:M,data:null},ge.DEPTH_COMPONENT);if(xe.depthAttachment.set(Ke.texture),de){const Qe=new a.T(w,{width:I,height:M,data:null},ge.RGBA);xe.colorAttachment.set(Qe.texture)}this._cascades.push({framebuffer:xe,texture:Ke,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.aM,scale:0})}}this.shadowDirection=Ka(u);let R=0;if(r.elevation){const le=r.elevation,de=[1e4,-1e4];le.visibleDemTiles.filter(ge=>ge.dem).forEach(ge=>{const xe=ge.dem.tree;de[0]=Math.min(de[0],xe.minimums[0]),de[1]=Math.max(de[1],xe.maximums[0])}),1e4!==de[0]&&(R=(de[1]-de[0])*le.exaggeration())}const L=1.5*r.cameraToCenterDistance,U=3*L,G=new Float64Array(16);for(let le=0;le<this._cascades.length;++le){const de=this._cascades[le];let ge=r.height/50,xe=1;1===Zo.cascadeCount?xe=U:0===le?xe=L:(ge=L,xe=U);const[Ke,Qe]=Za(r,this.shadowDirection,ge,xe,Zo.shadowMapResolution,R);de.scale=r.scale,de.matrix=Ke,de.boundingSphereRadius=Qe,a.ad.invert(G,de.matrix),de.frustum=a.aM.fromInvProjectionMatrix(G,1,0,!0),de.far=xe}const J=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[J].far,this._cascades[J].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Zo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Zo.shadowMapResolution,this._uniformValues.u_shadowmap_0=Wr.ShadowMap0,this._uniformValues.u_shadowmap_1=Wr.ShadowMap0+1,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Q=m.transform.elevation;for(const le of this._groundShadowTiles){let de={min:0,max:0};if(Q){const ge=Q.getMinMaxForTile(le);ge&&(de=ge)}this.addShadowReceiver(le.toUnwrapped(),de.min,de.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,u){if(!this.enabled)return;const m=this.painter,b=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),b.viewport.set([0,0,Zo.shadowMapResolution,Zo.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){m.currentShadowCascade=w,b.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),b.clear({color:a.C.white,depth:1});for(const I of r.order){const M=r._mergedLayers[I];if(!M.hasShadowPass()||M.isHidden(m.transform.zoom))continue;const R=r.getLayerSourceCache(M),L=R?u[R.id]:void 0;("model"===M.type||L&&L.length)&&m.renderLayer(m,R,M,L)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const r=this.painter,u=r.style,m=r.context,b=u.directionalLight,w=u.ambientLight;if(!b||!w)return;const I=[],M=ea(r,r.longestCutoffRange);M.shouldRenderCutoff&&I.push("RENDER_CUTOFF");const R=Ns(u,b,w),L=new a.ae(m.gl.LEQUAL,a.ae.ReadOnly,r.depthRangeFor3D);for(const U of this._groundShadowTiles){const G=U.toUnwrapped(),J=r.isTileAffectedByFog(U),Q=r.getOrCreateProgram("groundShadow",{defines:I,overrideFog:J});this.setupShadows(G,Q),r.uploadCommonUniforms(m,Q,G,null,M);const le={u_matrix:r.transform.calculateProjMatrix(G),u_ground_shadow_factor:R};Q.draw(r,m.gl.TRIANGLES,L,a.ag.disabled,a.a.multiply,a.af.disabled,le,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,{},r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?a.a.unblended:a.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const u=this.painter.transform,m=u.calculatePosMatrix(r,u.worldSize);return a.ad.multiply(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(r){return a.ad.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,u,m,b=0){if(!this.enabled)return;const w=this.painter.transform,I=this.painter.context,M=I.gl,R=this._uniformValues,L=new Float64Array(16),U=w.calculatePosMatrix(r,w.worldSize);for(let G=0;G<this._cascades.length;G++)a.ad.multiply(L,this._cascades[G].matrix,U),R[0===G?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),I.activeTexture.set(M.TEXTURE0+Wr.ShadowMap0+G),this._cascades[G].texture.bind(M.NEAREST,M.CLAMP_TO_EDGE);if(this.useNormalOffset=!!m,this.useNormalOffset){const G=a.b5(r.canonical),J=2/w.tileSize*a.a3/Zo.shadowMapResolution,Q=J*this._cascades[0].boundingSphereRadius,le=J*this._cascades[this._cascades.length-1].boundingSphereRadius,de=("vector-tile"===m?1:3)/Math.pow(2,b-r.canonical.z-(1-w.zoom+Math.floor(w.zoom)));R.u_shadow_normal_offset=[G,Q*de,le*de],R.u_shadow_bias=[6e-5,.0012,.012]}else R.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(I,R)}setupShadowsFromMatrix(r,u,m=!1){if(!this.enabled)return;const b=this.painter.context,w=b.gl,I=this._uniformValues,M=new Float64Array(16);for(let R=0;R<Zo.cascadeCount;R++)a.ad.multiply(M,this._cascades[R].matrix,r),I[0===R?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),b.activeTexture.set(w.TEXTURE0+Wr.ShadowMap0+R),this._cascades[R].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);this.useNormalOffset=m,m?(I.u_shadow_normal_offset=[1,5,5],I.u_shadow_bias=[6e-5,.0012,.012]):I.u_shadow_bias=[36e-5,.0012,.012],u.setShadowUniformValues(b,I)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,u,m,b){if(b[2]>=0)return{};const w=function(R,L,U){const G=U/(1<<R.canonical.z);return new a.b6([R.canonical.x*G+R.wrap*U,R.canonical.y*G+R.wrap*U,0],[(R.canonical.x+1)*G+R.wrap*U,(R.canonical.y+1)*G+R.wrap*U,L])}(r,u,m).getCorners(),I=u/-b[2];b[0]<0?(a._.add(w[0],w[0],[b[0]*I,0,0]),a._.add(w[3],w[3],[b[0]*I,0,0])):b[0]>0&&(a._.add(w[1],w[1],[b[0]*I,0,0]),a._.add(w[2],w[2],[b[0]*I,0,0])),b[1]<0?(a._.add(w[0],w[0],[0,b[1]*I,0]),a._.add(w[1],w[1],[0,b[1]*I,0])):b[1]>0&&(a._.add(w[2],w[2],[0,b[1]*I,0]),a._.add(w[3],w[3],[0,b[1]*I,0]));const M={};return M.vertices=w,M.planes=[Aa(w[1],w[0],w[4]),Aa(w[2],w[1],w[5]),Aa(w[3],w[2],w[6]),Aa(w[0],w[3],w[7])],M}addShadowReceiver(r,u,m){this._receivers.add(r,a.b6.fromTileIdAndHeight(r,u,m))}getMaxCascadeForTile(r){const u=this._receivers.get(r);return u&&u.lastCascade?u.lastCascade:0}}function Aa(p,r,u){const m=a._.sub([],u,r),b=a._.sub([],p,r),w=a._.cross([],m,b),I=a._.length(w);return 0===I?[0,0,1,0]:(a._.scale(w,w,1/I),[w[0],w[1],w[2],-a._.dot(w,r)])}function Ka(p){const r=p.properties.get("direction"),u=a.ac(r.x,r.y,r.z);u[2]=a.at(u[2],0,75);const m=a.b7([u[0],u[1],u[2]]);return a._.fromValues(m.x,m.y,m.z)}function Ns(p,r,u){const m=r.properties.get("color"),b=r.properties.get("intensity"),w=r.properties.get("direction"),I=[w.x,w.y,w.z],M=u.properties.get("color"),R=u.properties.get("intensity"),L=Math.max(a._.dot([0,0,1],I),0),U=[0,0,0];a._.scale(U,M.toRenderColor(p.getLut(r.scope)).toArray01Linear().slice(0,3),R);const G=[0,0,0];return a._.scale(G,m.toRenderColor(p.getLut(u.scope)).toArray01Linear().slice(0,3),L*b),a.b8([U[0]>0?U[0]/(U[0]+G[0]):0,U[1]>0?U[1]/(U[1]+G[1]):0,U[2]>0?U[2]/(U[2]+G[2]):0])}function Za(p,r,u,m,b,w){const I=p.zoom,M=p.scale,R=p.worldSize,L=1/R,U=p.aspect,G=Math.sqrt(1+U*U)*Math.tan(.5*p.fovX),J=G*G,Q=m-u,le=m+u;let de,ge;J>Q/le?(de=m,ge=m*G):(de=.5*le*(1+J),ge=.5*Math.sqrt(Q*Q+2*(m*m+u*u)*J+le*le*J*J));const xe=p.projection.pixelsPerMeter(p.center.lat,R),Ke=p._camera.getCameraToWorldMercator(),Qe=[0,0,-de*L];a._.transformMat4(Qe,Qe,Ke);let et=ge*L;const yt=p._edgeInsets;if(!(0===yt.left&&0===yt.top&&0===yt.right&&0===yt.bottom||yt.left===yt.right&&yt.top===yt.bottom)){const yi=p._camera.getWorldToCamera(p.worldSize,"meters"===p.projection.zAxisUnit?xe:1),bi=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,u,m);bi[8]=2*-p.centerOffset.x/p.width,bi[9]=2*p.centerOffset.y/p.height;const Mi=new Float64Array(16);a.ad.mul(Mi,bi,yi);const xi=new Float64Array(16);a.ad.invert(xi,Mi);const di=a.aM.fromInvProjectionMatrix(xi,R,I,!0);for(const In of di.points){const Li=((_t=In)[0]/=M,_t[1]/=M,_t[2]=a.ax(_t[2],p._center.lat),_t);et=Math.max(et,a._.len(a._.subtract([],Qe,Li)))}}var _t;et*=b/(b-1);const St=Math.acos(r[2]),Ee=Math.atan2(-r[0],-r[1]),tt=new qe;tt.position=Qe,tt.setPitchBearing(St,Ee);const Lt=tt.getWorldToCamera(R,xe),sn=et*R,zt=Math.min(p._mercatorZfromZoom(17)*R*-2,-2*sn),It=tt.getCameraToClipOrthographic(-sn,sn,-sn,sn,zt,(sn+w*xe)/r[2]),hn=new Float64Array(16);a.ad.multiply(hn,It,Lt);const Gn=a._.fromValues(Math.floor(1e6*Qe[0])/1e6*R,Math.floor(1e6*Qe[1])/1e6*R,0),Xn=.5*b,Vn=[0,0,0];a._.transformMat4(Vn,Gn,hn),a._.scale(Vn,Vn,Xn);const Xt=[Math.floor(Vn[0]),Math.floor(Vn[1]),Math.floor(Vn[2])],mn=[0,0,0];a._.sub(mn,Vn,Xt),a._.scale(mn,mn,-1/Xn);const Pn=new Float64Array(16);return a.ad.identity(Pn),a.ad.translate(Pn,Pn,mn),a.ad.multiply(hn,Pn,hn),[hn,sn]}function jo(p,r){return null!=p&&null!=r&&!(!p.hasData()||!r.hasData())&&null!=p.demTexture&&null!=r.demTexture&&p.tileID.key!==r.tileID.key}const qa=new class{constructor(){this.operations={}}newMorphing(p,r,u,m,b){if(p in this.operations){const w=this.operations[p];w.to.tileID.key!==u.tileID.key&&(w.queued=u)}else this.operations[p]={startTime:m,phase:0,duration:b,from:r,to:u,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const r=this.operations[p];return{from:r.from,to:r.to,phase:r.phase}}update(p){for(const r in this.operations){const u=this.operations[r];for(u.phase=(p-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,p)){delete this.operations[r];break}}}_nextOp(p,r){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=r,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},ku={0:null,1:"TERRAIN_VERTEX_MORPHING"};function fo(p,r,u){if(0===r)return 0;const m=r<1&&514===u?.25/r:1;return 6*Math.pow(1.5,22-p)*Math.max(r,1)*m}function Fu(p,r){const u=1<<p.z;return!r&&(0===p.x||p.x===u-1)||0===p.y||p.y===u-1}const ss=p=>({u_matrix:p});function al(p,r,u,m,b){if(b>0){const w=a.e.now(),I=(w-p.timeAdded)/b,M=r?(w-r.timeAdded)/b:-1,R=u.getSource(),L=m.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),U=!r||Math.abs(r.tileID.overscaledZ-L)>Math.abs(p.tileID.overscaledZ-L),G=U&&p.refreshedUponExpiration?1:a.at(U?I:1-M,0,1);return p.refreshedUponExpiration&&I>=1&&(p.refreshedUponExpiration=!1),r?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}class Bl extends kr{constructor(r,u,m,b){super(r,u,m,b),this.type="raster-array",this.maxzoom=22,this._options=a.W({type:"raster-array"},u)}triggerRepaint(r){const u=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);u&&u.enabled&&m&&u._clearRenderCacheForTile(m.id,r.tileID),this.map.triggerRepaint()}loadTile(r,u){const m=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(m,a.R.Tile);r.requestParams=b,r.actor||(r.actor=this.dispatcher.getActor()),r.request=r.fetchHeader(void 0,(w,I,M,R)=>(delete r.request,r.aborted?(r.state="unloaded",u(null)):w?20===w.code?void 0:(r.state="errored",u(w)):(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:M,expires:R}),r.state="empty",void u(null))))}unloadTile(r,u){const m=r.texture;m&&m instanceof a.T?(r.destroy(!0),this.map.painter.saveTileTexture(m)):(r.destroy(),r.flushQueues(),r._isHeaderLoaded=!1,delete r._mrt,delete r.textureDescriptor),r.fbo&&(r.fbo.destroy(),delete r.fbo),delete r.request,delete r.requestParams,delete r.neighboringTiles,r.state="unloaded"}prepareTile(r,u,m){r._isHeaderLoaded&&("empty"!==r.state&&(r.state="reloading"),r.fetchBand(u,m,(b,w)=>{if(b)return r.state="errored",this.fire(new a.d(b)),void this.triggerRepaint(r);w&&(r.setTexture(w,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const u=this.rasterLayers.find(({id:w})=>w===r),m=u&&u.fields,b=m&&m.bands&&m.bands;return b?b[0]:0}getTextureDescriptor(r,u,m){if(!r)return;const b=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!b)return;let w=null;u instanceof a.bk?w=u.paint.get("raster-array-band"):u instanceof a.bl&&(w=u.paint.get("raster-particle-array-band"));const I=w||this.getInitialBand(b);if(null!=I)if(r.textureDescriptor){if(!r.updateNeeded(b,I)||m)return Object.assign({},r.textureDescriptor,{texture:r.texture})}else this.prepareTile(r,b,I)}}const rc={vector:Te,raster:kr,"raster-dem":class extends kr{constructor(p,r,u,m){super(p,r,u,m),this.type="raster-dem",this.maxzoom=22,this._options=a.W({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(p,r){const u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(b,w){b&&(p.state="errored",r(b)),w&&(p.dem=w,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",r(null))}p.request=a.h(this.map._requestManager.transformRequest(u,a.R.Tile),function(b,w,I,M){if(delete p.request,p.aborted)p.state="unloaded",r(null);else if(b)p.state="errored",r(b);else if(w){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:I,expires:M});const R=ImageBitmap&&w instanceof ImageBitmap&&a.bi(),L=1-(w.width-a.bj(w.width))/2;L<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const U=R?w:a.e.getImageData(w,L),G={uid:p.uid,coord:p.tileID,source:this.id,scope:this.scope,rawImageData:U,encoding:this.encoding,padding:L};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",G,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const r=p.canonical,u=Math.pow(2,r.z),m=(r.x-1+u)%u,b=0===r.x?p.wrap-1:p.wrap,w=(r.x+1+u)%u,I=r.x+1===u?p.wrap+1:p.wrap,M={};return M[new a.aL(p.overscaledZ,b,r.z,m,r.y).key]={backfilled:!1},M[new a.aL(p.overscaledZ,I,r.z,w,r.y).key]={backfilled:!1},r.y>0&&(M[new a.aL(p.overscaledZ,b,r.z,m,r.y-1).key]={backfilled:!1},M[new a.aL(p.overscaledZ,p.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},M[new a.aL(p.overscaledZ,I,r.z,w,r.y-1).key]={backfilled:!1}),r.y+1<u&&(M[new a.aL(p.overscaledZ,b,r.z,m,r.y+1).key]={backfilled:!1},M[new a.aL(p.overscaledZ,p.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},M[new a.aL(p.overscaledZ,I,r.z,w,r.y+1).key]={backfilled:!1}),M}},"raster-array":Bl,geojson:class extends a.E{constructor(p,r,u,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(m),this._data=r.data,this._options=a.W({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),void 0!==r.minzoom&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const b=a.a3/this.tileSize;this.workerOptions=a.W({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*b,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*b,extent:a.a3,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:a.a3,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*b,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){return this._options.dynamic?"string"!=typeof p&&("Feature"===p.type&&(p={type:"FeatureCollection",features:[p]}),"FeatureCollection"!==p.type)?this.fire(new a.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&"string"!=typeof p&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type?this._data.features.push(...p.features):this._data=p,this._updateWorkerData(!0),this):this.fire(new a.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(p,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},r),this}getClusterChildren(p,r){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},r),this}getClusterLeaves(p,r,u,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:r,offset:u},m),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.f("dataloading",{dataType:"source"})),this._loaded=!1;const r=a.W({append:p},this.workerOptions);r.scope=this.scope;const u=this._data;"string"==typeof u?(r.request=this.map._requestManager.transformRequest(a.e.resolveURL(u),a.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(m,b)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new a.d(m));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(w.resourceTiming=b.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new a.f("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,r){const u=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const m=this.map.style?this.map.style.getLut(this.scope):null,b=this._partialReload,w={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m?{image:m.image.clone()}:null,scope:this.scope,pixelRatio:a.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:b};p.request=this.actor.send(u,w,(I,M)=>b&&!M?(p.state="loaded",r(null)):(delete p.request,p.destroy(),p.aborted?r(null):I?r(I):(p.loadVectorData(M,this.map.painter,"reloadTile"===u),r(null))),void 0,"loadTile"===u)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,r){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.bm{constructor(p,r,u,m){super(p,r,u,m),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const r of p.urls)this.urls.push(this.map._requestManager.transformRequest(r,a.R.Source).url);a.bn(this.urls,(r,u)=>{this._loaded=!0,r?this.fire(new a.d(r)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const r=this.video.seekable;p<r.start(0)||p>r.end(0)?this.fire(new a.d(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,r=p.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(p,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.bm,model:class extends a.E{constructor(p,r,u,m){super(),this.id=p,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){const p=[];for(const r in this._options.models){const u=this._options.models[r],m=a.l(this.map._requestManager.transformRequest(u.uri,a.R.Model).url).then(b=>{if(!b)return;const w=a.c(b),I=new a.M(r,u.position,u.orientation,w);I.computeBoundsAndApplyParent(),this.models.push(I)}).catch(b=>{this.fire(new a.d(new Error(`Could not load model ${r} from ${u.uri}: ${b.message}`)))});p.push(m)}return Promise.allSettled(p).then(()=>{this._loaded=!0,this.fire(new a.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this.fire(new a.d(new Error(`Could not load models: ${r.message}`)))})}onAdd(p){this.map=p,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(p,r){}serialize(){return{type:"model"}}},"batched-model":class extends a.E{constructor(p,r,u,m){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(p){this.map=p,this.load()}load(p){this._loaded=!1,this.fire(new a.f("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map._worldview;this._tileJSONRequest=sl(this._options,this.map._requestManager,r,u,(m,b)=>{this._tileJSONRequest=null,this._loaded=!0,m?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),u&&2!==u.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new a.d(m))):b&&(a.W(this,b),b.bounds&&(this.tileBounds=new pe(b.bounds,this.minzoom,this.maxzoom)),a.an(b.tiles,this.map._requestManager._customAccessToken),this.fire(new a.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.f("data",{dataType:"source",sourceDataType:"content"}))),p&&p(m)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,r){const u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(u,a.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(p.actor&&"expired"!==p.state)if("loading"===p.state)p.reloadCallback=r;else{if(p.buckets){const w=Object.values(p.buckets);for(const I of w)I.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",m,b.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",m,b.bind(this),void 0,!0);function b(w,I){return p.aborted?r(null):w&&404!==w.status?r(w):(I&&(I.resourceTiming&&(p.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&p.setExpiryData(I),p.buckets={...p.buckets,...I.buckets},I.featureIndex&&(p.latestFeatureIndex=I.featureIndex)),p.state="loaded",void r(null))}}serialize(){return a.W({},this._options)}},canvas:class extends a.bm{constructor(p,r,u,m){super(p,r,u,m),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(w=>"number"!=typeof w))||this.fire(new a.d(new a.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.d(new a.V(`sources.${p}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new a.d(new a.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof HTMLCanvasElement||this.fire(new a.d(new a.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.d(new a.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof a.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends a.E{constructor(p,r,u,m){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=r,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new pe(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),a.W(this,a.ah(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new a.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:r,y:u,z:m}=p.canonical;return this._implementation.hasTile({x:r,y:u,z:m})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,r){const{x:u,y:m,z:b}=p.tileID.canonical,w=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:u,y:m,z:b},{signal:w.signal})).then(function(I){return delete p.request,p.aborted?(p.state="unloaded",r(null)):void 0===I?(p.state="errored",r(null)):null===I?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",r(null)):(M=I)instanceof ImageData||M instanceof HTMLCanvasElement||M instanceof ImageBitmap||M instanceof HTMLImageElement?(this.loadTileData(p,I),p.state="loaded",void r(null)):(p.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var M}.bind(this)).catch(I=>{20!==I.code&&(p.state="errored",r(I))}),p.request.cancel=()=>w.abort()}loadTileData(p,r){p.setTexture(r,this.map.painter)}unloadTile(p,r){if(p.texture&&p.texture instanceof a.T?(p.destroy(!0),p.texture&&p.texture instanceof a.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:u,y:m,z:b}=p.tileID.canonical;this._implementation.unloadTile({x:u,y:m,z:b})}r&&r()}abortTile(p,r){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){const p=a.al(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new a.f("data",{dataType:"source",sourceDataType:"content"}))}}},Vo=function(p,r,u,m){const b=new rc[r.type](p,r,u,m);if(b.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${b.id}`);return a.bp(["load","abort","unload","serialize","prepare"],b),b};class br extends a.bv{constructor(r){const u={type:"raster-dem",maxzoom:r.transform.maxZoom},m=new a.bw(a.bx(),null),b=Vo("mock-dem",u,m,r.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,u){r.state="loaded",u(null)}}class oc extends a.bv{constructor(r){const u=Vo("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new a.bw(a.bx(),null),r.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,u,m){if(r.freezeTileCoverage)return;this.transform=r;const b=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,I)=>{if(w[I.key]="",!this._tiles[I.key]){const M=new a.by(I,this._source.tileSize*I.overscaleFactor(),r.tileZoom);M.state="loaded",this._tiles[I.key]=M}return w},{});for(const w in this._tiles)w in b||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(r){const u=this.proxyCachedFBO[r];if(void 0!==u){const m=Object.values(u);this.renderCachePool.push(...m),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Bs extends a.aL{constructor(r,u,m){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=u,this.projMatrix=m}}class zl extends a.bq{constructor(r,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,b,w]=function(R){const L=new a.bt,U=new a.bu,G=131;L.reserve(17161),U.reserve(33800);const J=a.a3/128,Q=a.a3+J/2,le=Q+J;for(let ge=-J;ge<le;ge+=J)for(let xe=-J;xe<le;xe+=J){const Ke=xe<0||xe>Q||ge<0||ge>Q?24575:0,Qe=a.at(Math.round(xe),0,a.a3),et=a.at(Math.round(ge),0,a.a3);L.emplaceBack(Qe+Ke,et)}const de=(ge,xe)=>{const Ke=xe*G+ge;U.emplaceBack(Ke+1,Ke,Ke+G),U.emplaceBack(Ke+G,Ke+G+1,Ke+1)};for(let ge=1;ge<129;ge++)for(let xe=1;xe<129;xe++)de(xe,ge);return[0,129].forEach(ge=>{for(let xe=0;xe<130;xe++)de(xe,ge),de(ge,xe)}),[L,U,32768]}(),I=r.context;this.gridBuffer=I.createVertexBuffer(m,a.br.members),this.gridIndexBuffer=I.createIndexBuffer(b),this.gridSegments=a.b.simpleSegment(0,0,m.length,b.length),this.gridNoSkirtSegments=a.b.simpleSegment(0,0,m.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new oc(u.map),this.orthoMatrix=a.ad.create(),a.ad.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,a.a3,0,a.a3,0,1);const M=I.gl;this._overlapStencilMode=new a.ag({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new br(u.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,u,m){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const b=r.terrain.properties,w=0===r.terrain.drapeRenderMode,I=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.e.now();const M=r.terrain&&r.terrain.scope,R=b.get("source"),L=w?this._mockSourceCache:r.getSourceCache(R,M);if(!L)return void a.w(`Couldn't find terrain source "${R}".`);if(this.sourceCache=L,this._exaggeration=I?this.calculateExaggeration(u):b.get("exaggeration"),!u.projection.requiresDraping&&I&&0===this._exaggeration)return void this._disable();this.enabled=!0;const U=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const G=this.getScaledDemTileSize();this.sourceCache.update(u,G,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,U(),this._initializing=!0),U(),u.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(r){const u=this._previousCameraAltitude,m=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=m;const b=null!=u?m-u:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;const w=r.zoom,I=this._style.terrain;if(!this._previousUpdateTimestamp)return I.getExaggeration(w);let M=w-this._previousZoom;const R=this._previousUpdateTimestamp;let L=w;null!=this._evaluationZoom&&(L=this._evaluationZoom,Math.abs(w-L)>.5&&(M=.5*(w-L+M)),M*b<0&&(L+=M)),this._evaluationZoom=L;const U=I.getExaggeration(L),G=U===I.getExaggeration(Math.max(0,L-.1));if(G&&Math.abs(U-this._exaggeration)<.01)return U;let J=Math.min(.1,.00375*(this._updateTimestamp-R));return(G||U<.1||Math.abs(M)<1e-4)&&(J=Math.min(.2,4*J)),a.a2(this._exaggeration,U,J)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(a.Y.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=u.getIds().map(R=>{const L=u.getTileByID(R).tileID;return L.projMatrix=m.calculateProjMatrix(L.toUnwrapped()),L});!function(R,L){const U=L.transform.pointCoordinate(L.transform.getCameraPoint()),G=new a.P(U.x,U.y);R.sort((J,Q)=>{if(Q.overscaledZ-J.overscaledZ)return Q.overscaledZ-J.overscaledZ;const le=new a.P(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),de=new a.P(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),ge=G.mult(1<<J.canonical.z);return ge.x-=.5,ge.y-=.5,ge.distSqr(le)-ge.distSqr(de)})}(b,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},b.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const I=this._style._mergedSourceCaches;for(const R in I){const L=I[R];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,r[R],w),L.usedForTerrain))continue;const U=r[R];L.getSource().reparseOverscaled&&this._assignTerrainTiles(U)}this.proxiedCoords[u.id]=b.map(R=>new Bs(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const M={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const L=this.terrainTileForTile[R.key];if(!L)continue;const U=L.tileID.key;U in M||(this._visibleDemTiles.push(L),M[U]=U)}}_assignTerrainTiles(r){this._initializing||r.forEach(u=>{if(this.terrainTileForTile[u.key])return;const m=this._findTileCoveringTileID(u,this.sourceCache);m&&(this.terrainTileForTile[u.key]=m)})}_prepareDEMTextures(){const r=this.painter.context,u=r.gl;for(const m in this.terrainTileForTile){const b=this.terrainTileForTile[m],w=b.dem;!w||b.demTexture&&!b.needsDEMTextureUpload||(r.activeTexture.set(u.TEXTURE1),bl(this.painter,b,w))}}_prepareDemTileUniforms(r,u,m,b){if(!u||null==u.demTexture)return!1;const w=r.tileID.canonical,I=Math.pow(2,u.tileID.canonical.z-w.z),M=b||"";return m[`u_dem_tl${M}`]=[w.x*I%1,w.y*I%1],m[`u_dem_scale${M}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,u=r.gl;if(!this._emptyDepthBufferTexture){const m=new a.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.T(r,m,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0;const u=this._visibleDemTiles.reduce((m,b)=>{if(!b.dem)return m;const w=b.dem.tree.minimums[0];return w>0&&r++,m+w},0);return r?u/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,u=r.gl;r.activeTexture.set(u.TEXTURE2);const m=this._getLoadedAreaMinimum(),[b,w]=(()=>{const M=new a.bz({width:1,height:1},new Float32Array([m]));return[u.R32F,M]})();this._emptyDEMTextureDirty=!1;let I=this._emptyDEMTexture;return I?I.update(w,{premultiply:!1}):I=this._emptyDEMTexture=new a.T(r,w,b,{premultiply:!1}),I}setupElevationDraw(r,u,m){const b=this.painter.context,w=b.gl,I={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[2,0],u_exaggeration:0};I.u_exaggeration=this.exaggeration();let M=null,R=null,L=1;if(m&&m.morphing&&this._useVertexMorphing){const le=m.morphing.srcDemTile,de=m.morphing.dstDemTile;L=m.morphing.phase,le&&de&&(this._prepareDemTileUniforms(r,le,I,"_prev")&&(R=le),this._prepareDemTileUniforms(r,de,I)&&(M=de))}const U=le=>le&&le.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let G=null;var J,Q;if(this.enabled?R&&M?(G=M.demTexture,b.activeTexture.set(w.TEXTURE4),R.demTexture.bind(U(R),w.CLAMP_TO_EDGE),I.u_dem_lerp=L):(M=this.terrainTileForTile[r.tileID.key],G=this._prepareDemTileUniforms(r,M,I)?M.demTexture:this.emptyDEMTexture):G=this.emptyDEMTexture,b.activeTexture.set(w.TEXTURE2),G&&(I.u_dem_size=1===(J=G).size[0]?1:J.size[0]-2,G.bind(U(M),w.CLAMP_TO_EDGE)),b.activeTexture.set(w.TEXTURE3),m&&m.useDepthForOcclusion&&this.painter.terrainDepthTexture&&this.painter.terrainDepthFBO?(this.painter.terrainDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),I.u_depth_size_inv=[1/this.painter.terrainDepthFBO.width,1/this.painter.terrainDepthFBO.height],I.u_depth_range_unpack=[2/((Q=this.painter.depthRangeFor3D)[1]-Q[0]),-1-2*Q[0]/(Q[1]-Q[0])]):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),I.u_depth_range_unpack=[2,0]),b.activeTexture.set(w.TEXTURE0),m&&m.useMeterToDem&&M){const le=(1<<M.tileID.canonical.z)*a.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=le}if(m&&m.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),u.setTerrainUniformValues(b,I),"globe"===this.painter.transform.projection.name){const le=this.globeUniformValues(this.painter.transform,r.tileID.canonical,m&&m.useDenormalizedUpVectorScale);u.setGlobeUniformValues(b,le)}}globeUniformValues(r,u,m){const b=r.projection;return{u_tile_tl_up:b.upVector(u,0,0),u_tile_tr_up:b.upVector(u,a.a3,0),u_tile_br_up:b.upVector(u,a.a3,a.a3),u_tile_bl_up:b.upVector(u,0,a.a3),u_tile_up_scale:m?a.bs(1):b.upVectorScale(u,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const u=this.painter,m=this.painter.context;0!==r.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,w,I,M,R){if("globe"===b.transform.projection.name)!function(L,U,G,J,Q){const le=L.context,de=le.gl;let ge,xe;const Ke=L.transform,Qe=a.ba(L,le,Ke),et=(It,hn)=>{if(xe===hn)return;const Gn=[ku[hn],"PROJECTION_GLOBE_VIEW"];Qe&&Gn.push("CUSTOM_ANTIALIASING");const Xn=L.isTileAffectedByFog(It);ge=L.getOrCreateProgram("globeRaster",{defines:Gn,overrideFog:Xn}),xe=hn},yt=L.colorModeForRenderPass(),_t=new a.ae(de.LEQUAL,a.ae.ReadWrite,L.depthRangeFor3D);qa.update(Q);const St=a.bb(Ke),Ee=[a.aj(Ke.center.lng),a.ak(Ke.center.lat)],tt=L.globeSharedBuffers,Lt=[Ke.width*a.e.devicePixelRatio,Ke.height*a.e.devicePixelRatio],sn=Float32Array.from(Ke.globeMatrix),zt={useDenormalizedUpVectorScale:!0};{const It=L.transform,hn=fo(It.zoom,U.exaggeration(),U.sourceCache._source.tileSize);xe=-1;const Gn=de.TRIANGLES;for(const Xn of J){const Vn=G.getTile(Xn),Xt=a.ag.disabled,mn=U.prevTerrainTileForTile[Xn.key],Pn=U.terrainTileForTile[Xn.key];jo(mn,Pn)&&qa.newMorphing(Xn.key,mn,Pn,Q,250),le.activeTexture.set(de.TEXTURE0),Vn.texture&&Vn.texture.bind(de.LINEAR,de.CLAMP_TO_EDGE);const yi=qa.getMorphValuesForProxy(Xn.key),bi=yi?1:0;yi&&a.o(zt,{morphing:{srcDemTile:yi.from,dstDemTile:yi.to,phase:a.b9(yi.phase)}});const Mi=a.bc(Xn.canonical),xi=a.bd(Mi.getCenter().lat),di=a.be(Xn.canonical,Mi,xi,It.worldSize/It._pixelsPerMercatorPixel),In=a.bf(a.bg(Xn.canonical)),Li=Ae(It.expandedFarZProjMatrix,sn,St,In,a.a1(It.zoom),Ee,It.frustumCorners.TL,It.frustumCorners.TR,It.frustumCorners.BR,It.frustumCorners.BL,It.globeCenterInViewSpace,It.globeRadius,Lt,hn,It._farZ,di);if(et(Xn,bi),ge&&(U.setupElevationDraw(Vn,ge,zt),L.uploadCommonUniforms(le,ge,Xn.toUnwrapped()),tt)){const[Ir,Ji,hr]=tt.getGridBuffers(xi,0!==hn);ge.draw(L,Gn,_t,Xt,yt,a.af.backCCW,Li,"globe_raster",Ir,Ji,hr)}}}if(tt&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const It=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Qe&&It.push("CUSTOM_ANTIALIASING"),ge=L.getOrCreateProgram("globeRaster",{defines:It});for(const hn of J){const{x:Gn,y:Xn,z:Vn}=hn.canonical,Xt=0===Xn,mn=Xn===(1<<Vn)-1,[Pn,yi,bi,Mi]=tt.getPoleBuffers(Vn,!1);if(Mi&&(Xt||mn)){const xi=G.getTile(hn);le.activeTexture.set(de.TEXTURE0),xi.texture&&xi.texture.bind(de.LINEAR,de.CLAMP_TO_EDGE);let di=a.bh(Vn,Gn,Ke);const In=a.bf(a.bg(hn.canonical)),Li=(Ir,Ji)=>Ir.draw(L,de.TRIANGLES,_t,a.ag.disabled,yt,a.af.disabled,Ae(Ke.expandedFarZProjMatrix,di,di,In,0,Ee,Ke.frustumCorners.TL,Ke.frustumCorners.TR,Ke.frustumCorners.BR,Ke.frustumCorners.BL,Ke.globeCenterInViewSpace,Ke.globeRadius,Lt,0,Ke._farZ),"globe_pole_raster",Ji,bi,Mi);U.setupElevationDraw(xi,ge,zt),L.uploadCommonUniforms(le,ge,hn.toUnwrapped()),Xt&&L.renderDefaultNorthPole&&Li(ge,Pn),mn&&L.renderDefaultSouthPole&&(di=a.ad.scale(a.ad.create(),di,[1,-1,1]),Li(ge,yi))}}}}(b,w,I,M,R);else{const L=b.context,U=L.gl;let G,J;const Q=b.shadowRenderer,le=ea(b,b.longestCutoffRange),de=yt=>{if(J===yt)return;const _t=[];_t.push(ku[yt]),le.shouldRenderCutoff&&_t.push("RENDER_CUTOFF"),G=b.getOrCreateProgram("terrainRaster",{defines:_t}),J=yt},ge=b.colorModeForRenderPass(),xe=new a.ae(U.LEQUAL,a.ae.ReadWrite,b.depthRangeFor3D);qa.update(R);const Ke=b.transform,Qe=fo(Ke.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let et=[0,0,0];if(Q){const yt=b.style.directionalLight,_t=b.style.ambientLight;yt&&_t&&(et=Ns(b.style,yt,_t))}{J=-1;const yt=U.TRIANGLES,[_t,St]=[w.gridIndexBuffer,w.gridSegments];for(const Ee of M){const tt=I.getTile(Ee),Lt=a.ag.disabled,sn=w.prevTerrainTileForTile[Ee.key],zt=w.terrainTileForTile[Ee.key];jo(sn,zt)&&qa.newMorphing(Ee.key,sn,zt,R,250),L.activeTexture.set(U.TEXTURE0),tt.texture&&tt.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const It=qa.getMorphValuesForProxy(Ee.key),hn=It?1:0;let Gn;It&&(Gn={morphing:{srcDemTile:It.from,dstDemTile:It.to,phase:a.b9(It.phase)}});const Xn=Y(Ee.projMatrix,Fu(Ee.canonical,Ke.renderWorldCopies)?Qe/10:Qe,et);if(de(hn),!G)continue;w.setupElevationDraw(tt,G,Gn);const Vn=Ee.toUnwrapped();Q&&Q.setupShadows(Vn,G),b.uploadCommonUniforms(L,G,Vn,null,le),G.draw(b,yt,xe,Lt,ge,a.af.backCCW,Xn,"terrain_raster",w.gridBuffer,_t,St)}}}}(u,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const u=this.painter,m=this.painter.context,b=this.proxySourceCache,w=this.proxiedCoords[b.id],I=this._drapedRenderBatches.shift(),M=u.style.order,R=[];let L=0;for(const U of w){const G=b.getTileByID(U.proxyTileKey),J=b.proxyCachedFBO[U.key]?b.proxyCachedFBO[U.key][r]:void 0,Q=void 0!==J?b.renderCache[J]:this.pool[L++],le=void 0!==J;if(G.texture=Q.tex,le&&!Q.dirty){R.push(G.tileID);continue}let de;m.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(m.clear({color:a.C.transparent,stencil:0}),Q.dirty=!1);for(let ge=I.start;ge<=I.end;++ge){const xe=u.style._mergedLayers[M[ge]];if(xe.isHidden(u.transform.zoom))continue;const Ke=u.style.getLayerSourceCache(xe),Qe=Ke?this.proxyToSource[U.key][Ke.id]:[U];if(!Qe)continue;const et=Qe;m.viewport.set([0,0,Q.fb.width,Q.fb.height]),de!==(Ke?Ke.id:null)&&(this._setupStencil(Q,Qe,xe,Ke),de=Ke?Ke.id:null),u.renderLayer(u,Ke,xe,et)}if(0===this._drapedRenderBatches.length)for(const ge of this._pendingGroundEffectLayers){const xe=u.style._mergedLayers[M[ge]];if(xe.isHidden(u.transform.zoom))continue;const Ke=u.style.getLayerSourceCache(xe),Qe=Ke?this.proxyToSource[U.key][Ke.id]:[U];if(!Qe)continue;const et=Qe;m.viewport.set([0,0,Q.fb.width,Q.fb.height]),de!==(Ke?Ke.id:null)&&(this._setupStencil(Q,Qe,xe,Ke),de=Ke?Ke.id:null),u.renderLayer(u,Ke,xe,et)}this.renderedToTile?(Q.dirty=!0,R.push(G.tileID)):le||--L,5===L&&(L=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),I.end+1}postRender(){}isLayerOrderingCorrect(r){const u=r.order.length;let m=-1,b=u;for(let w=0;w<u;++w)this._style.isLayerDraped(r._mergedLayers[r.order[w]])?m=Math.max(m,w):b=Math.min(b,w);return b>m}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{r=Math.min(r,u.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,u,m){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const I=w.tileID,M=1<<I.overscaledZ,{x:R,y:L}=I.canonical,U=R/M,G=(R+1)/M,J=L/M,Q=(L+1)/M;return{minx:U,miny:J,maxx:G,maxy:Q,t:w.dem.tree.raycastRoot(U,J,G,Q,r,u,m),tile:w}});b.sort((w,I)=>(null!==w.t?w.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const w of b){if(null==w.t)return null;const I=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,r,u,m);if(null!=I)return I}return null}_createFBO(){const r=this.painter.context,u=r.gl,m=this.drapeBufferSize;r.activeTexture.set(u.TEXTURE0);const b=new a.T(r,{width:m[0],height:m[1],data:null},u.RGBA);b.bind(u.LINEAR,u.CLAMP_TO_EDGE);const w=r.createFramebuffer(m[0],m[1],!0,null);return w.colorAttachment.set(b.texture),w.depthAttachment=new Oi(r,w.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:w,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const u=this._style._mergedLayers[r],m=u.isHidden(this.painter.transform.zoom);return"custom"===u.type?!m&&u.shouldRedrape():!m&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const m of this._style.getSources())if(m instanceof Te){r=!0;break}if(!r)return;const u={};for(let m=0;m<this._style.order.length;++m){const b=this._style._mergedLayers[this._style.order[m]],w=this._style.getLayerSourceCache(b);if(w&&!u[w.id]&&!b.isHidden(this.painter.transform.zoom)&&"line"===b.type&&b.widthExpression()instanceof a.Z){u[w.id]=!0;for(const I of this.proxyCoords){const M=this.proxyToSource[I.key][w.id];if(M)for(const R of M)this._clearRenderCacheForTile(w.id,R)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof kr){r=!0;break}if(!r)return;const u={};for(let m=0;m<this._style.order.length;++m){const b=this._style._mergedLayers[this._style.order[m]],w=this._style.getLayerSourceCache(b);if(!w||u[w.id]||b.isHidden(this.painter.transform.zoom)||"raster"!==b.type)continue;const I=b.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const R=this.proxyToSource[M.key][w.id];if(R)for(const L of R){const U=al(w.getTile(L),w.findLoadedParent(L,0),w,this.painter.transform,I);(1!==U.opacity||0!==U.mix)&&this._clearRenderCacheForTile(w.id,L)}}}}_setupDrapedRenderBatches(){const r=this._style.order,u=r.length;if(0===u)return;const m=[];this._pendingGroundEffectLayers=[];let b,w=0,I=this._style._mergedLayers[r[w]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++w<u;)I=this._style._mergedLayers[r[w]];for(;w<u;++w){const M=this._style._mergedLayers[r[w]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?void 0===b&&(b=w):("fill-extrusion"===M.type&&this._pendingGroundEffectLayers.push(w),void 0!==b&&(m.push({start:b,end:w-1}),b=void 0)))}if(void 0!==b&&m.push({start:b,end:w-1}),0!==m.length){const M=m[m.length-1];this._pendingGroundEffectLayers.every(R=>R>M.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(r){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const I=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let M=0;M<I.length;++M){const R=Object.values(I[M]);u.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,b=this._tilesDirty;for(let I=m.length-1;I>=0;I--){const M=m[I];if(u.getTileByID(M.key),void 0!==u.proxyCachedFBO[M.key]){const R=r[M.key],L=this.proxyToSource[M.key];let U=0;for(const G in L){const J=L[G],Q=R[G];if(!Q||Q.length!==J.length||J.some((le,de)=>le!==Q[de]||b[G]&&b[G].hasOwnProperty(le.key))){U=-1;break}++U}for(const G in u.proxyCachedFBO[M.key])u.renderCache[u.proxyCachedFBO[M.key][G]].dirty=U<0||U!==Object.values(R).length}}const w=[...this._drapedRenderBatches];w.sort((I,M)=>M.end-M.start-(I.end-I.start));for(const I of w)for(const M of m){if(u.proxyCachedFBO[M.key])continue;let R=u.renderCachePool.pop();void 0===R&&u.renderCache.length<50&&(R=u.renderCache.length,u.renderCache.push(this._createFBO())),void 0!==R&&(u.proxyCachedFBO[M.key]={},u.proxyCachedFBO[M.key][I.start]=R,u.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(r,u,m,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,I=w.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let M;if(m.isTileClipped())M=u.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):a.ag.disabled}_renderTileClippingMasks(r,u){const m=this.painter,b=this.painter.context,w=b.gl;m._tileClippingMaskIDs={},b.setColorMode(a.a.disabled),b.setDepthMode(a.ae.disabled);const I=m.getOrCreateProgram("clippingMask");for(const M of r){const R=m._tileClippingMaskIDs[M.key]=--u;I.draw(m,w.TRIANGLES,a.ae.disabled,new a.ag({func:w.ALWAYS,mask:0},R,255,w.KEEP,w.KEEP,w.REPLACE),a.a.disabled,a.af.disabled,ss(M.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(r){const u=this.painter.transform;if(r.x<0||r.x>u.width||r.y<0||r.y>u.height)return null;const m=[r.x,r.y,1,1];a.aA.transformMat4(m,m,u.pixelMatrixInverse),a.aA.scale(m,m,1/m[3]),m[0]/=u.worldSize,m[1]/=u.worldSize;const b=u._camera.position,w=a.ax(1,u.center.lat),I=[b[0],b[1],b[2]/w,0],M=a._.subtract([],m.slice(0,3),I);a._.normalize(M,M);const R=this.raycast(I,M,this._exaggeration);return null!==R&&R?(a._.scaleAndAdd(I,I,M,R),I[3]=I[2],I[2]*=w,I):null}_setupProxiedCoordsForOrtho(r,u,m){if(r.getSource()instanceof a.bm)return this._setupProxiedCoordsForImageSource(r,u,m);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const b=this.proxiedCoords[r.id]=[],w=this.proxyCoords;for(let R=0;R<w.length;R++){const L=w[R],U=this._findTileCoveringTileID(L,r);if(U){const G=this._createProxiedId(L,U,m[L.key]&&m[L.key][r.id]);b.push(G),this.proxyToSource[L.key][r.id]=[G]}}let I=!1;const M=new Set;for(let R=0;R<u.length;R++){const L=r.getTile(u[R]);if(!L||!L.hasData())continue;const U=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(U&&U.tileID.canonical.z!==L.tileID.canonical.z){const G=this.proxyToSource[U.tileID.key][r.id],J=this._createProxiedId(U.tileID,L,m[U.tileID.key]&&m[U.tileID.key][r.id]);G?G.splice(G.length-1,0,J):this.proxyToSource[U.tileID.key][r.id]=[J];const Q=this.proxyToSource[U.tileID.key][r.id];M.has(Q)||M.add(Q),b.push(J),I=!0}}if(this._sourceTilesOverlap[r.id]=I,I&&this._debugParams.sortTilesHiZFirst)for(const R of M)R.sort((L,U)=>U.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(r,u,m){if(!r.getSource().loaded())return;const b=this.proxiedCoords[r.id]=[],w=this.proxyCoords,I=r.getSource(),M=I.tileID;if(!M)return;const R=new a.P(M.x,M.y)._div(1<<M.z),L=I.coordinates.map(a.Y.fromLngLat).reduce((G,J)=>(G.min.x=Math.min(G.min.x,J.x-R.x),G.min.y=Math.min(G.min.y,J.y-R.y),G.max.x=Math.max(G.max.x,J.x-R.x),G.max.y=Math.max(G.max.y,J.y-R.y),G),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),U=(G,J)=>{const Q=G.wrap+G.canonical.x/(1<<G.canonical.z),le=G.canonical.y/(1<<G.canonical.z),de=a.a3/(1<<G.canonical.z),ge=J.wrap+J.canonical.x/(1<<J.canonical.z),xe=J.canonical.y/(1<<J.canonical.z);return Q+de<ge+L.min.x||Q>ge+L.max.x||le+de<xe+L.min.y||le>xe+L.max.y};for(let G=0;G<w.length;G++){const J=w[G];for(let Q=0;Q<u.length;Q++){const le=r.getTile(u[Q]);if(!le||!le.hasData()||U(J,le.tileID))continue;const de=this._createProxiedId(J,le,m[J.key]&&m[J.key][r.id]),ge=this.proxyToSource[J.key][r.id];ge?ge.push(de):this.proxyToSource[J.key][r.id]=[de],b.push(de)}}}_createProxiedId(r,u,m){let b=this.orthoMatrix;if(m){const w=m.find(I=>I.key===u.tileID.key);if(w)return w}if(u.tileID.key!==r.key){const w=r.canonical.z-u.tileID.canonical.z;let I,M,R;b=a.ad.create();const L=u.tileID.wrap-r.wrap<<r.overscaledZ;w>0?(I=a.a3>>w,M=I*((u.tileID.canonical.x<<w)-r.canonical.x+L),R=I*((u.tileID.canonical.y<<w)-r.canonical.y)):(I=a.a3<<-w,M=a.a3*(u.tileID.canonical.x-(r.canonical.x+L<<-w)),R=a.a3*(u.tileID.canonical.y-(r.canonical.y<<-w))),a.ad.ortho(b,0,I,0,I,0,1),a.ad.translate(b,b,[M,R,0])}return new Bs(u.tileID,r.key,b)}_findTileCoveringTileID(r,u){let m=u.getTile(r);if(m&&m.hasData())return m;const b=this._findCoveringTileCache[u.id],w=b[r.key];if(m=w?u.getTileByID(w):null,m&&m.hasData()||null===w)return m;let I=m?m.tileID:r,M=I.overscaledZ;const R=u.getSource().minzoom,L=[];if(!w){const G=u.getSource().maxzoom;if(r.canonical.z>=G){const J=r.canonical.z-G;u.getSource().reparseOverscaled?(M=Math.max(r.canonical.z+2,u.transform.tileZoom),I=new a.aL(M,r.wrap,G,r.canonical.x>>J,r.canonical.y>>J)):0!==J&&(M=G,I=new a.aL(M,r.wrap,G,r.canonical.x>>J,r.canonical.y>>J))}I.key!==r.key&&(L.push(I.key),m=u.getTile(I))}const U=G=>{L.forEach(J=>{b[J]=G}),L.length=0};for(M-=1;M>=R&&(!m||!m.hasData());M--){m&&U(m.tileID.key);const G=I.calculateScaledKey(M);if(m=u.getTileByID(G),m&&m.hasData())break;const J=b[G];if(null===J)break;void 0===J?L.push(G):m=u.getTileByID(J)}return U(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,u){let m=this._tilesDirty[r];m||(m=this._tilesDirty[r]={}),m[u.key]=!0}}function Ul(p,r,u){const m=function(M,R,L){const U=a._.dot(R,M),G=a._.dot(L,[.2126,.7152,.0722]),J=(le,de,ge)=>(1-ge)*le+ge*de,Q=J(1-.3*Math.min(G,1),1,Math.min(U+1,1));return J(.92,1,Math.asin(a.at(R[2],-1,1))/Math.PI+.5)*Q}(p,[0,0,1],r),b=[0,0,0];a._.scale(b,u.slice(0,3),m);const w=[0,0,0];a._.scale(w,r.slice(0,3),p[2]);const I=[0,0,0];return a._.add(I,b,w),a.b8(I)}const wl=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ta=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Nu{static cacheKey(r,u,m,b){let w=`${u}${b?b.cacheKey:""}`;for(const I of m)r.usedDefines.includes(I)&&(w+=`/${I}`);return w}constructor(r,u,m,b,w,I){const M=r.gl;this.program=M.createProgram(),this.configuration=b,this.name=u,this.fixedDefines=[...I];const R=b?b.getBinderAttributes():[],L=(m.staticAttributes||[]).concat(R);let U=b?b.defines():[];U=U.concat(I.map(ge=>`#define ${ge}`));const G="#version 300 es\n";let J=G+U.concat("precision mediump float;",ma,Sa.fragmentSource).join("\n");for(const ge of m.fragmentIncludes)J+=`\n${Qs[ge]}`;J+=`\n${m.fragmentSource}`;let Q=G+U.concat("precision highp float;",ma,Sa.vertexSource).join("\n");for(const ge of m.vertexIncludes)Q+=`\n${Qs[ge]}`;Q+=`\n${m.vertexSource}`;const le=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(le,J),M.compileShader(le),M.attachShader(this.program,le);const de=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(de,Q),M.compileShader(de),M.attachShader(this.program,de),this.attributes={},this.numAttributes=L.length;for(let ge=0;ge<this.numAttributes;ge++)if(L[ge]){const xe=L[ge].startsWith("a_")?L[ge]:`a_${L[ge]}`;M.bindAttribLocation(this.program,ge,xe),this.attributes[xe]=ge}M.linkProgram(this.program),M.deleteShader(de),M.deleteShader(le),this.fixedUniforms=w(r),this.binderUniforms=b?b.getUniforms(r):[],I.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new a.a7(ge=r),u_dem_prev:new a.a7(ge),u_dem_tl:new a.a8(ge),u_dem_scale:new a.aa(ge),u_dem_tl_prev:new a.a8(ge),u_dem_scale_prev:new a.aa(ge),u_dem_size:new a.aa(ge),u_dem_lerp:new a.aa(ge),u_exaggeration:new a.aa(ge),u_depth:new a.a7(ge),u_depth_size_inv:new a.a8(ge),u_depth_range_unpack:new a.a8(ge),u_meter_to_dem:new a.aa(ge),u_label_plane_matrix_inv:new a.a6(ge)}),I.includes("GLOBE")&&(this.globeUniforms=(ge=>({u_tile_tl_up:new a.aq(ge),u_tile_tr_up:new a.aq(ge),u_tile_br_up:new a.aq(ge),u_tile_bl_up:new a.aq(ge),u_tile_up_scale:new a.aa(ge)}))(r)),I.includes("FOG")&&(this.fogUniforms=(ge=>({u_fog_matrix:new a.a6(ge),u_fog_range:new a.a8(ge),u_fog_color:new a.as(ge),u_fog_horizon_blend:new a.aa(ge),u_fog_vertical_limit:new a.a8(ge),u_fog_temporal_offset:new a.aa(ge),u_frustum_tl:new a.aq(ge),u_frustum_tr:new a.aq(ge),u_frustum_br:new a.aq(ge),u_frustum_bl:new a.aq(ge),u_globe_pos:new a.aq(ge),u_globe_radius:new a.aa(ge),u_globe_transition:new a.aa(ge),u_is_globe:new a.a7(ge),u_viewport:new a.a8(ge)}))(r)),I.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ge=>({u_cutoff_params:new a.as(ge)}))(r)),I.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ge=>({u_lighting_ambient_color:new a.aq(ge),u_lighting_directional_dir:new a.aq(ge),u_lighting_directional_color:new a.aq(ge),u_ground_radiance:new a.aq(ge)}))(r)),I.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ge=>({u_light_matrix_0:new a.a6(ge),u_light_matrix_1:new a.a6(ge),u_fade_range:new a.a8(ge),u_shadow_normal_offset:new a.aq(ge),u_shadow_intensity:new a.aa(ge),u_shadow_texel_size:new a.aa(ge),u_shadow_map_resolution:new a.aa(ge),u_shadow_direction:new a.aq(ge),u_shadow_bias:new a.aq(ge),u_shadowmap_0:new a.a7(ge),u_shadowmap_1:new a.a7(ge)}))(r))}var ge}setTerrainUniformValues(r,u){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const b in u)m[b]&&m[b].set(this.program,b,u[b])}}setGlobeUniformValues(r,u){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const b in u)m[b]&&m[b].set(this.program,b,u[b])}}setFogUniformValues(r,u){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const b in u)m[b].set(this.program,b,u[b])}}setCutoffUniformValues(r,u){if(!this.cutoffUniforms)return;const m=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const b in u)m[b].set(this.program,b,u[b])}}setLightsUniformValues(r,u){if(!this.lightsUniforms)return;const m=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const b in u)m[b].set(this.program,b,u[b])}}setShadowUniformValues(r,u){if(this.failedToCreate||!this.shadowUniforms)return;const m=this.shadowUniforms;r.program.set(this.program);for(const b in u)m[b].set(this.program,b,u[b])}_drawDebugWireframe(r,u,m,b,w,I,M,R,L,U){const G=r.options.wireframe;if(!1===G.terrain&&!1===G.layers2D&&!1===G.layers3D)return;const J=r.context;if(!(G.terrain&&("terrainRaster"===this.name||"globeRaster"===this.name)||!(!G.layers2D||r._terrain&&r._terrain.renderingToTexture)&&wl.includes(this.name)||G.layers3D&&ta.includes(this.name)))return;const Q=J.gl,le=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,w,J);if(!le)return;const de=[...this.fixedDefines];de.push("DEBUG_WIREFRAME");const ge=r.getOrCreateProgram(this.name,{config:this.configuration,defines:de});J.program.set(ge.program);const xe=(et,yt,_t)=>{if(yt[et]&&_t[et])for(const St in yt[et])_t[et][St]&&_t[et][St].set(_t.program,St,yt[et][St].current)};L&&L.setUniforms(ge.program,J,ge.binderUniforms,M,{zoom:R}),xe("fixedUniforms",this,ge),xe("terrainUniforms",this,ge),xe("globeUniforms",this,ge),xe("fogUniforms",this,ge),xe("lightsUniforms",this,ge),xe("shadowUniforms",this,ge),le.bind(),J.setColorMode(new a.a([Q.ONE,Q.ONE_MINUS_SRC_ALPHA,Q.ZERO,Q.ONE],a.C.transparent,[!0,!0,!0,!1])),J.setDepthMode(new a.ae(u.func===Q.LESS?Q.LEQUAL:u.func,a.ae.ReadOnly,u.range)),J.setStencilMode(a.ag.disabled);const Ke=3*I.primitiveLength*2,Qe=3*I.primitiveOffset*2*2;U&&U>1?Q.drawElementsInstanced(Q.LINES,Ke,Q.UNSIGNED_SHORT,Qe,U):Q.drawElements(Q.LINES,Ke,Q.UNSIGNED_SHORT,Qe),w.bind(),J.program.set(this.program),J.setDepthMode(u),J.setStencilMode(m),J.setColorMode(b)}draw(r,u,m,b,w,I,M,R,L,U,G,J,Q,le,de,ge){const xe=r.context,Ke=xe.gl;if(this.failedToCreate)return;xe.program.set(this.program),xe.setDepthMode(m),xe.setStencilMode(b),xe.setColorMode(w),xe.setCullFace(I);for(const yt of Object.keys(this.fixedUniforms))this.fixedUniforms[yt].set(this.program,yt,M[yt]);le&&le.setUniforms(this.program,xe,this.binderUniforms,J,{zoom:Q});const Qe={[Ke.POINTS]:1,[Ke.LINES]:2,[Ke.TRIANGLES]:3,[Ke.LINE_STRIP]:1}[u],et=ge&&ge>0?1:void 0;for(const yt of G.get()){const _t=yt.vaos||(yt.vaos={});(_t[R]||(_t[R]=new Nl)).bind(xe,this,L,le?le.getPaintVertexBuffers():[],U,yt.vertexOffset,de||[],et),ge&&ge>1?Ke.drawElementsInstanced(u,yt.primitiveLength*Qe,Ke.UNSIGNED_SHORT,yt.primitiveOffset*Qe*2,ge):U?Ke.drawElements(u,yt.primitiveLength*Qe,Ke.UNSIGNED_SHORT,yt.primitiveOffset*Qe*2):Ke.drawArrays(u,yt.vertexOffset,yt.vertexLength),u===Ke.TRIANGLES&&U&&this._drawDebugWireframe(r,m,b,w,U,yt,J,Q,le,ge)}}}function se(p,r){const u=Math.pow(2,r.tileID.overscaledZ),m=r.tileSize*Math.pow(2,p.transform.tileZoom)/u,b=m*(r.tileID.canonical.x+r.tileID.wrap*u),w=m*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.bB(r,1,p.transform.tileZoom),u_pixel_coord_upper:[b>>16,w>>16],u_pixel_coord_lower:[65535&b,65535&w]}}const ye=a.ad.create(),q=(p,r,u,m,b,w,I,M,R,L,U,G,J,Q,le,de)=>{const ge=r.style.light,xe=ge.properties.get("position"),Ke=[xe.x,xe.y,xe.z],Qe=a.bC.create();"viewport"===ge.properties.get("anchor")&&(a.bC.fromRotation(Qe,-r.transform.angle),a._.transformMat3(Ke,Ke,Qe));const et=ge.properties.get("color"),yt=r.transform,_t={u_matrix:p,u_lightpos:Ke,u_lightintensity:ge.properties.get("intensity"),u_lightcolor:[et.r,et.g,et.b],u_vertical_gradient:+u,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ye,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:w,u_flood_light_color:G,u_vertical_scale:J,u_flood_light_intensity:Q,u_ground_shadow_factor:le,u_emissive_strength:de};return"globe"===yt.projection.name&&(_t.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],_t.u_zoom_transition=R,_t.u_inv_rot_matrix=U,_t.u_merc_center=L,_t.u_up_dir=yt.projection.upVector(new a.aO(0,0,0),L[0]*a.a3,L[1]*a.a3),_t.u_height_lift=M),_t},rt=(p,r,u)=>({u_matrix:p,u_edge_radius:r,u_vertical_scale:u}),qt=(p,r,u,m,b,w,I,M,R,L,U,G,J,Q)=>{const le=q(p,r,u,m,b,w,I,R,L,U,G,J,Q,1,[0,0,0],0),de={u_height_factor:-Math.pow(2,I.overscaledZ)/M.tileSize/8};return a.W(le,se(r,M),de)},sr=(p,r)=>({u_matrix:p,u_emissive_strength:r}),Zr=(p,r,u,m)=>a.W(sr(p,r),se(u,m)),as=(p,r,u)=>({u_matrix:p,u_world:u,u_emissive_strength:r}),_r=(p,r,u,m,b)=>a.W(Zr(p,r,u,m),{u_world:b}),sc=(p,r,u,m)=>{const b=a.a3/u.tileSize;return{u_matrix:p,u_camera_to_center_distance:r.getCameraToCenterDistance(m),u_extrude_scale:[r.pixelsToGLUnits[0]/b,r.pixelsToGLUnits[1]/b]}},Sd=(p,r,u=1)=>({u_matrix:p,u_color:r.toRenderColor(null),u_overlay:0,u_overlay_scale:u}),_h=a.ad.create(),Dc=(p,r,u,m,b,w,I)=>{const M=p.transform,R="globe"===M.projection.name,L=R?a.bD(M.zoom,r.canonical)*M._pixelsPerMercatorPixel:a.bB(u,1,w),U={u_matrix:r.projMatrix,u_extrude_scale:L,u_intensity:I,u_inv_rot_matrix:_h,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){U.u_inv_rot_matrix=m,U.u_merc_center=b,U.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],U.u_zoom_transition=a.a1(M.zoom);const G=b[0]*a.a3,J=b[1]*a.a3;U.u_up_dir=M.projection.upVector(new a.aO(0,0,0),G,J)}return U};function jl(p,[r,u,m,b],[w,I]){if(w===I)return[0,0,0,0];const M=255*(p-1)/(p*(I-w));return[r*M,u*M,m*M,b*M]}function zo(p,r,[u,m]){return u===m?0:.5/p+(r-u)*(p-1)/(p*(m-u))}const nu=(p,r,u,m,b,w,I,M,R,L,U,G,J,Q,le,de,ge,xe,Ke,Qe,et)=>({u_matrix:p,u_normalize_matrix:r,u_globe_matrix:u,u_merc_matrix:m,u_grid_matrix:b,u_tl_parent:w,u_scale_parent:L,u_fade_t:U.mix,u_opacity:U.opacity*G.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:G.paint.get("raster-brightness-min"),u_brightness_high:G.paint.get("raster-brightness-max"),u_saturation_factor:a.bE(G.paint.get("raster-saturation")),u_contrast_factor:a.bF(G.paint.get("raster-contrast")),u_spin_weights:ya(G.paint.get("raster-hue-rotate")),u_perspective_transform:J,u_raster_elevation:Q,u_zoom_transition:I,u_merc_center:M,u_cutoff_params:R,u_colorization_mix:jl(a.bG,de,xe),u_colorization_offset:zo(a.bG,ge,xe),u_color_ramp:le,u_texture_offset:[Qe/(Ke+2*Qe),Ke/(Ke+2*Qe)],u_texture_res:[Ke+2*Qe,Ke+2*Qe],u_emissive_strength:et});function ya(p){p*=Math.PI/180;const r=Math.sin(p),u=Math.cos(p);return[(2*u+1)/3,(-Math.sqrt(3)*r-u+1)/3,(Math.sqrt(3)*r-u+1)/3]}const va=.05,iu=(p,r,u,m,b,w,I,M,R,L,U,G)=>({u_matrix:p,u_normalize_matrix:r,u_globe_matrix:u,u_merc_matrix:m,u_grid_matrix:b,u_tl_parent:w,u_scale_parent:L,u_fade_t:U.mix,u_opacity:U.opacity,u_image0:0,u_image1:1,u_raster_elevation:G,u_zoom_transition:I,u_merc_center:M,u_cutoff_params:R}),El=(p,r,u,m,b,w,I,M,R,L)=>({u_particle_texture:p,u_particle_texture_side_len:r,u_tile_offset:u,u_velocity:m,u_color_ramp:w,u_velocity_res:b,u_max_speed:I,u_uv_offset:M,u_data_scale:[255*R[0],255*R[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[va,va]}),ll=(p,r,u,m,b,w,I,M,R,L)=>({u_particle_texture:p,u_particle_texture_side_len:r,u_velocity:u,u_velocity_res:m,u_max_speed:b,u_speed_factor:w,u_reset_rate:I,u_rand_seed:Math.random(),u_uv_offset:M,u_data_scale:[255*R[0],255*R[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[va,va]}),Bu=a.ad.create(),aa=(p,r,u,m,b,w,I,M,R,L,U,G,J,Q,le,de,ge,xe)=>{const Ke=b.transform,Qe={u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Ke.getCameraToCenterDistance(de),u_rotate_symbol:+u,u_aspect_ratio:Ke.width/Ke.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:I,u_coord_matrix:M,u_is_text:+R,u_pitch_with_map:+m,u_texsize:L,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Bu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Bu,u_up_vector:[0,-1,0],u_color_adj_mat:ge,u_icon_transition:xe||0};return"globe"===de.name&&(Qe.u_tile_id=[U.canonical.x,U.canonical.y,1<<U.canonical.z],Qe.u_zoom_transition=G,Qe.u_inv_rot_matrix=Q,Qe.u_merc_center=J,Qe.u_camera_forward=Ke._camera.forward(),Qe.u_ecef_origin=a.bH(Ke.globeMatrix,U.toUnwrapped()),Qe.u_tile_matrix=Float32Array.from(Ke.globeMatrix),Qe.u_up_vector=le),Qe},Cl=(p,r,u,m,b,w,I,M,R,L,U,G,J,Q,le,de,ge)=>a.W(aa(p,r,u,m,b,w,I,M,R,L,G,J,Q,le,de,ge),{u_gamma_scale:m?b.transform.getCameraToCenterDistance(ge)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:a.e.devicePixelRatio,u_is_halo:+U,undefined:void 0}),Mc=(p,r,u,m,b,w,I,M,R,L,U,G,J,Q,le,de)=>a.W(Cl(p,r,u,m,b,w,I,M,!0,R,!0,U,G,J,Q,le,de),{u_texsize_icon:L,u_texture_icon:1}),Sc=(p,r,u,m)=>({u_matrix:p,u_emissive_strength:r,u_opacity:u,u_color:m}),Sr=(p,r,u,m,b,w,I,M)=>a.W(function(R,L,U,G,J){const{width:Q,height:le}=G.imageManager.getPixelSize(L),de=Math.pow(2,J.tileID.overscaledZ),ge=J.tileSize*Math.pow(2,G.transform.tileZoom)/de,xe=ge*(J.tileID.canonical.x+J.tileID.wrap*de),Ke=ge*J.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[Q,le],u_pattern_size:U.displaySize,u_tile_units_to_pixels:1/a.bB(J,1,G.transform.tileZoom),u_pixel_coord_upper:[xe>>16,Ke>>16],u_pixel_coord_lower:[65535&xe,65535&Ke]}}(0,w,I,m,M),{u_matrix:p,u_emissive_strength:r,u_opacity:u}),Il=new Float32Array(a.ad.identity([])),ac=(p,r,u,m,b,w,I,M,R,L,U,G,J,Q=[0,0,0],le)=>{const de=b.style.light,ge=de.properties.get("position"),xe=[-ge.x,-ge.y,ge.z],Ke=a.bC.create();"viewport"===de.properties.get("anchor")&&(a.bC.fromRotation(Ke,-b.transform.angle),a._.transformMat3(xe,xe,Ke));const Qe="MASK"===U.alphaMode,et=de.properties.get("color").toRenderColor(null),yt=J.paint.get("model-ambient-occlusion-intensity"),_t=J.paint.get("model-color").constantOr(a.C.white).toRenderColor(null),St=J.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:p,u_lighting_matrix:r,u_normal_matrix:u,u_node_matrix:m||Il,u_lightpos:xe,u_lightintensity:de.properties.get("intensity"),u_lightcolor:[et.r,et.g,et.b],u_camera_pos:Q,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+Qe,u_alphaCutoff:U.alphaCutoff,u_baseColorFactor:[I.r,I.g,I.b,I.a],u_emissiveFactor:[M[0],M[1],M[2],1],u_metallicFactor:R,u_roughnessFactor:L,u_baseColorTexture:Wr.BaseColor,u_metallicRoughnessTexture:Wr.MetallicRoughness,u_normalTexture:Wr.Normal,u_occlusionTexture:Wr.Occlusion,u_emissionTexture:Wr.Emission,u_lutTexture:Wr.LUT,u_color_mix:[_t.r,_t.g,_t.b,St],u_aoIntensity:yt,u_emissive_strength:G,u_occlusionTextureTransform:le||[0,0,0,0]}},Pa=(p,r=Il,u=Il)=>({u_matrix:p,u_instance:r,u_node_matrix:u}),Ad=(p,r,u,m,b)=>({u_matrix:Float32Array.from(p),u_anchorPos:r,u_screenSizePx:u,u_occluderSizePx:m,u_color:b}),yh={fillExtrusion:p=>({u_matrix:new a.a6(p),u_lightpos:new a.aq(p),u_lightintensity:new a.aa(p),u_lightcolor:new a.aq(p),u_vertical_gradient:new a.aa(p),u_opacity:new a.aa(p),u_edge_radius:new a.aa(p),u_ao:new a.a8(p),u_tile_id:new a.aq(p),u_zoom_transition:new a.aa(p),u_inv_rot_matrix:new a.a6(p),u_merc_center:new a.a8(p),u_up_dir:new a.aq(p),u_height_lift:new a.aa(p),u_flood_light_color:new a.aq(p),u_vertical_scale:new a.aa(p),u_flood_light_intensity:new a.aa(p),u_ground_shadow_factor:new a.aq(p),u_emissive_strength:new a.aa(p)}),fillExtrusionDepth:p=>({u_matrix:new a.a6(p),u_edge_radius:new a.aa(p),u_vertical_scale:new a.aa(p)}),fillExtrusionPattern:p=>({u_matrix:new a.a6(p),u_lightpos:new a.aq(p),u_lightintensity:new a.aa(p),u_lightcolor:new a.aq(p),u_vertical_gradient:new a.aa(p),u_height_factor:new a.aa(p),u_edge_radius:new a.aa(p),u_ao:new a.a8(p),u_tile_id:new a.aq(p),u_zoom_transition:new a.aa(p),u_inv_rot_matrix:new a.a6(p),u_merc_center:new a.a8(p),u_up_dir:new a.aq(p),u_height_lift:new a.aa(p),u_image:new a.a7(p),u_texsize:new a.a8(p),u_pixel_coord_upper:new a.a8(p),u_pixel_coord_lower:new a.a8(p),u_tile_units_to_pixels:new a.aa(p),u_opacity:new a.aa(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new a.a6(p),u_opacity:new a.aa(p),u_ao_pass:new a.aa(p),u_meter_to_tile:new a.aa(p),u_ao:new a.a8(p),u_flood_light_intensity:new a.aa(p),u_flood_light_color:new a.aq(p),u_attenuation:new a.aa(p),u_edge_radius:new a.aa(p),u_fb:new a.a7(p),u_fb_size:new a.aa(p)}),fill:p=>({u_matrix:new a.a6(p),u_emissive_strength:new a.aa(p)}),fillPattern:p=>({u_matrix:new a.a6(p),u_emissive_strength:new a.aa(p),u_image:new a.a7(p),u_texsize:new a.a8(p),u_pixel_coord_upper:new a.a8(p),u_pixel_coord_lower:new a.a8(p),u_tile_units_to_pixels:new a.aa(p)}),fillOutline:p=>({u_matrix:new a.a6(p),u_emissive_strength:new a.aa(p),u_world:new a.a8(p)}),fillOutlinePattern:p=>({u_matrix:new a.a6(p),u_emissive_strength:new a.aa(p),u_world:new a.a8(p),u_image:new a.a7(p),u_texsize:new a.a8(p),u_pixel_coord_upper:new a.a8(p),u_pixel_coord_lower:new a.a8(p),u_tile_units_to_pixels:new a.aa(p)}),circle:a.bI,collisionBox:p=>({u_matrix:new a.a6(p),u_camera_to_center_distance:new a.aa(p),u_extrude_scale:new a.a8(p)}),collisionCircle:p=>({u_matrix:new a.a6(p),u_inv_matrix:new a.a6(p),u_camera_to_center_distance:new a.aa(p),u_viewport_size:new a.a8(p)}),debug:p=>({u_color:new a.a9(p),u_matrix:new a.a6(p),u_overlay:new a.a7(p),u_overlay_scale:new a.aa(p)}),clippingMask:p=>({u_matrix:new a.a6(p)}),heatmap:p=>({u_extrude_scale:new a.aa(p),u_intensity:new a.aa(p),u_matrix:new a.a6(p),u_inv_rot_matrix:new a.a6(p),u_merc_center:new a.a8(p),u_tile_id:new a.aq(p),u_zoom_transition:new a.aa(p),u_up_dir:new a.aq(p)}),heatmapTexture:p=>({u_image:new a.a7(p),u_color_ramp:new a.a7(p),u_opacity:new a.aa(p)}),hillshade:p=>({u_matrix:new a.a6(p),u_image:new a.a7(p),u_latrange:new a.a8(p),u_light:new a.a8(p),u_shadow:new a.a9(p),u_highlight:new a.a9(p),u_emissive_strength:new a.aa(p),u_accent:new a.a9(p)}),hillshadePrepare:p=>({u_matrix:new a.a6(p),u_image:new a.a7(p),u_dimension:new a.a8(p),u_zoom:new a.aa(p)}),line:a.bJ,linePattern:a.bK,raster:p=>({u_matrix:new a.a6(p),u_normalize_matrix:new a.a6(p),u_globe_matrix:new a.a6(p),u_merc_matrix:new a.a6(p),u_grid_matrix:new a.ar(p),u_tl_parent:new a.a8(p),u_scale_parent:new a.aa(p),u_fade_t:new a.aa(p),u_opacity:new a.aa(p),u_image0:new a.a7(p),u_image1:new a.a7(p),u_brightness_low:new a.aa(p),u_brightness_high:new a.aa(p),u_saturation_factor:new a.aa(p),u_contrast_factor:new a.aa(p),u_spin_weights:new a.aq(p),u_perspective_transform:new a.a8(p),u_raster_elevation:new a.aa(p),u_zoom_transition:new a.aa(p),u_merc_center:new a.a8(p),u_cutoff_params:new a.as(p),u_colorization_mix:new a.as(p),u_colorization_offset:new a.aa(p),u_color_ramp:new a.a7(p),u_texture_offset:new a.a8(p),u_texture_res:new a.a8(p),u_emissive_strength:new a.aa(p)}),rasterParticle:p=>({u_matrix:new a.a6(p),u_normalize_matrix:new a.a6(p),u_globe_matrix:new a.a6(p),u_merc_matrix:new a.a6(p),u_grid_matrix:new a.ar(p),u_tl_parent:new a.a8(p),u_scale_parent:new a.aa(p),u_fade_t:new a.aa(p),u_opacity:new a.aa(p),u_image0:new a.a7(p),u_image1:new a.a7(p),u_raster_elevation:new a.aa(p),u_zoom_transition:new a.aa(p),u_merc_center:new a.a8(p),u_cutoff_params:new a.as(p)}),rasterParticleTexture:p=>({u_texture:new a.a7(p),u_opacity:new a.aa(p)}),rasterParticleDraw:p=>({u_particle_texture:new a.a7(p),u_particle_texture_side_len:new a.aa(p),u_tile_offset:new a.a8(p),u_velocity:new a.a7(p),u_color_ramp:new a.a7(p),u_velocity_res:new a.a8(p),u_max_speed:new a.aa(p),u_uv_offset:new a.a8(p),u_data_scale:new a.a8(p),u_data_offset:new a.aa(p),u_particle_pos_scale:new a.aa(p),u_particle_pos_offset:new a.a8(p)}),rasterParticleUpdate:p=>({u_particle_texture:new a.a7(p),u_particle_texture_side_len:new a.aa(p),u_velocity:new a.a7(p),u_velocity_res:new a.a8(p),u_max_speed:new a.aa(p),u_speed_factor:new a.aa(p),u_reset_rate:new a.aa(p),u_rand_seed:new a.aa(p),u_uv_offset:new a.a8(p),u_data_scale:new a.a8(p),u_data_offset:new a.aa(p),u_particle_pos_scale:new a.aa(p),u_particle_pos_offset:new a.a8(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new a.a7(p),u_is_size_feature_constant:new a.a7(p),u_size_t:new a.aa(p),u_size:new a.aa(p),u_camera_to_center_distance:new a.aa(p),u_rotate_symbol:new a.a7(p),u_aspect_ratio:new a.aa(p),u_fade_change:new a.aa(p),u_matrix:new a.a6(p),u_label_plane_matrix:new a.a6(p),u_coord_matrix:new a.a6(p),u_is_text:new a.a7(p),u_pitch_with_map:new a.a7(p),u_texsize:new a.a8(p),u_tile_id:new a.aq(p),u_zoom_transition:new a.aa(p),u_inv_rot_matrix:new a.a6(p),u_merc_center:new a.a8(p),u_camera_forward:new a.aq(p),u_tile_matrix:new a.a6(p),u_up_vector:new a.aq(p),u_ecef_origin:new a.aq(p),u_texture:new a.a7(p),u_icon_transition:new a.aa(p),u_color_adj_mat:new a.a6(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new a.a7(p),u_is_size_feature_constant:new a.a7(p),u_size_t:new a.aa(p),u_size:new a.aa(p),u_camera_to_center_distance:new a.aa(p),u_rotate_symbol:new a.a7(p),u_aspect_ratio:new a.aa(p),u_fade_change:new a.aa(p),u_matrix:new a.a6(p),u_label_plane_matrix:new a.a6(p),u_coord_matrix:new a.a6(p),u_is_text:new a.a7(p),u_pitch_with_map:new a.a7(p),u_texsize:new a.a8(p),u_texture:new a.a7(p),u_gamma_scale:new a.aa(p),u_device_pixel_ratio:new a.aa(p),u_tile_id:new a.aq(p),u_zoom_transition:new a.aa(p),u_inv_rot_matrix:new a.a6(p),u_merc_center:new a.a8(p),u_camera_forward:new a.aq(p),u_tile_matrix:new a.a6(p),u_up_vector:new a.aq(p),u_ecef_origin:new a.aq(p),u_is_halo:new a.a7(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new a.a7(p),u_is_size_feature_constant:new a.a7(p),u_size_t:new a.aa(p),u_size:new a.aa(p),u_camera_to_center_distance:new a.aa(p),u_rotate_symbol:new a.a7(p),u_aspect_ratio:new a.aa(p),u_fade_change:new a.aa(p),u_matrix:new a.a6(p),u_label_plane_matrix:new a.a6(p),u_coord_matrix:new a.a6(p),u_is_text:new a.a7(p),u_pitch_with_map:new a.a7(p),u_texsize:new a.a8(p),u_texsize_icon:new a.a8(p),u_texture:new a.a7(p),u_texture_icon:new a.a7(p),u_gamma_scale:new a.aa(p),u_device_pixel_ratio:new a.aa(p),u_is_halo:new a.a7(p)}),background:p=>({u_matrix:new a.a6(p),u_emissive_strength:new a.aa(p),u_opacity:new a.aa(p),u_color:new a.a9(p)}),backgroundPattern:p=>({u_matrix:new a.a6(p),u_emissive_strength:new a.aa(p),u_opacity:new a.aa(p),u_image:new a.a7(p),u_pattern_tl:new a.a8(p),u_pattern_br:new a.a8(p),u_texsize:new a.a8(p),u_pattern_size:new a.a8(p),u_pixel_coord_upper:new a.a8(p),u_pixel_coord_lower:new a.a8(p),u_tile_units_to_pixels:new a.aa(p)}),terrainRaster:p=>({u_matrix:new a.a6(p),u_image0:new a.a7(p),u_skirt_height:new a.aa(p),u_ground_shadow_factor:new a.aq(p)}),skybox:p=>({u_matrix:new a.a6(p),u_sun_direction:new a.aq(p),u_cubemap:new a.a7(p),u_opacity:new a.aa(p),u_temporal_offset:new a.aa(p)}),skyboxGradient:p=>({u_matrix:new a.a6(p),u_color_ramp:new a.a7(p),u_center_direction:new a.aq(p),u_radius:new a.aa(p),u_opacity:new a.aa(p),u_temporal_offset:new a.aa(p)}),skyboxCapture:p=>({u_matrix_3f:new a.ar(p),u_sun_direction:new a.aq(p),u_sun_intensity:new a.aa(p),u_color_tint_r:new a.as(p),u_color_tint_m:new a.as(p),u_luminance:new a.aa(p)}),globeRaster:p=>({u_proj_matrix:new a.a6(p),u_globe_matrix:new a.a6(p),u_normalize_matrix:new a.a6(p),u_merc_matrix:new a.a6(p),u_zoom_transition:new a.aa(p),u_merc_center:new a.a8(p),u_image0:new a.a7(p),u_grid_matrix:new a.ar(p),u_skirt_height:new a.aa(p),u_far_z_cutoff:new a.aa(p),u_frustum_tl:new a.aq(p),u_frustum_tr:new a.aq(p),u_frustum_br:new a.aq(p),u_frustum_bl:new a.aq(p),u_globe_pos:new a.aq(p),u_globe_radius:new a.aa(p),u_viewport:new a.a8(p)}),globeAtmosphere:p=>({u_frustum_tl:new a.aq(p),u_frustum_tr:new a.aq(p),u_frustum_br:new a.aq(p),u_frustum_bl:new a.aq(p),u_horizon:new a.aa(p),u_transition:new a.aa(p),u_fadeout_range:new a.aa(p),u_color:new a.as(p),u_high_color:new a.as(p),u_space_color:new a.as(p),u_temporal_offset:new a.aa(p),u_horizon_angle:new a.aa(p)}),model:p=>({u_matrix:new a.a6(p),u_lighting_matrix:new a.a6(p),u_normal_matrix:new a.a6(p),u_node_matrix:new a.a6(p),u_lightpos:new a.aq(p),u_lightintensity:new a.aa(p),u_lightcolor:new a.aq(p),u_camera_pos:new a.aq(p),u_opacity:new a.aa(p),u_baseColorFactor:new a.as(p),u_emissiveFactor:new a.as(p),u_metallicFactor:new a.aa(p),u_roughnessFactor:new a.aa(p),u_baseTextureIsAlpha:new a.a7(p),u_alphaMask:new a.a7(p),u_alphaCutoff:new a.aa(p),u_baseColorTexture:new a.a7(p),u_metallicRoughnessTexture:new a.a7(p),u_normalTexture:new a.a7(p),u_occlusionTexture:new a.a7(p),u_emissionTexture:new a.a7(p),u_lutTexture:new a.a7(p),u_color_mix:new a.as(p),u_aoIntensity:new a.aa(p),u_emissive_strength:new a.aa(p),u_occlusionTextureTransform:new a.as(p)}),modelDepth:p=>({u_matrix:new a.a6(p),u_instance:new a.a6(p),u_node_matrix:new a.a6(p)}),groundShadow:p=>({u_matrix:new a.a6(p),u_ground_shadow_factor:new a.aq(p)}),stars:p=>({u_matrix:new a.a6(p),u_up:new a.aq(p),u_right:new a.aq(p),u_intensity_multiplier:new a.aa(p)}),occlusion:p=>({u_matrix:new a.a6(p),u_anchorPos:new a.aq(p),u_screenSizePx:new a.a8(p),u_occluderSizePx:new a.a8(p),u_color:new a.as(p)})};function ru(p,r,u){const m=r.createTileMatrix(p,p.worldSize,u.toUnwrapped());return a.ad.multiply(new Float32Array(16),p.projMatrix,m)}function gf(p,r,u){if(r.projection.name===u.projection.name)return p.projMatrix;const m=u.clone();return m.setProjection(r.projection),ru(m,r.getProjection(),p)}function Ac(p,r,u){return r.name===u.projection.name?p.projMatrix:ru(u,r,p)}let ou;function _f(p,r,u,m,b,w,I){const M=p.context,R=M.gl,L=p.transform,U=p.getOrCreateProgram("collisionBox"),G=[];let J=0,Q=0;for(let et=0;et<m.length;et++){const yt=m[et],_t=r.getTile(yt),St=_t.getBucket(u);if(!St)continue;const Ee=gf(yt,St,L);let tt=Ee;0===b[0]&&0===b[1]||(tt=p.translatePosMatrix(Ee,_t,b,w));const Lt=I?St.textCollisionBox:St.iconCollisionBox,sn=St.collisionCircleArray;if(sn.length>0){const zt=a.ad.create(),It=tt;a.ad.mul(zt,St.placementInvProjMatrix,L.glCoordMatrix),a.ad.mul(zt,zt,St.placementViewportMatrix),G.push({circleArray:sn,circleOffset:Q,transform:It,invTransform:zt,projection:St.getProjection()}),J+=sn.length/4,Q=J}Lt&&(p.terrain&&p.terrain.setupElevationDraw(_t,U),U.draw(p,R.LINES,a.ae.disabled,a.ag.disabled,p.colorModeForRenderPass(),a.af.disabled,sc(tt,L,_t,St.getProjection()),u.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Lt.segments,null,L.zoom,null,[Lt.collisionVertexBuffer,Lt.collisionVertexBufferExt]))}if(!I||!G.length)return;const le=p.getOrCreateProgram("collisionCircle"),de=new a.bL;de.resize(4*J),de._trim();let ge=0;for(const et of G)for(let yt=0;yt<et.circleArray.length/4;yt++){const _t=4*yt,St=et.circleArray[_t+0],Ee=et.circleArray[_t+1],tt=et.circleArray[_t+2],Lt=et.circleArray[_t+3];de.emplace(ge++,St,Ee,tt,Lt,0),de.emplace(ge++,St,Ee,tt,Lt,1),de.emplace(ge++,St,Ee,tt,Lt,2),de.emplace(ge++,St,Ee,tt,Lt,3)}(!ou||ou.length<2*J)&&(ou=function(et){const yt=2*et,_t=new a.bu;_t.resize(yt),_t._trim();for(let St=0;St<yt;St++){const Ee=6*St;_t.uint16[Ee+0]=4*St+0,_t.uint16[Ee+1]=4*St+1,_t.uint16[Ee+2]=4*St+2,_t.uint16[Ee+3]=4*St+2,_t.uint16[Ee+4]=4*St+3,_t.uint16[Ee+5]=4*St+0}return _t}(J));const xe=M.createIndexBuffer(ou,!0),Ke=M.createVertexBuffer(de,a.bM.members,!0);for(const et of G){const yt={u_matrix:et.transform,u_inv_matrix:et.invTransform,u_camera_to_center_distance:(Qe=L).getCameraToCenterDistance(et.projection),u_viewport_size:[Qe.width,Qe.height]};le.draw(p,R.TRIANGLES,a.ae.disabled,a.ag.disabled,p.colorModeForRenderPass(),a.af.disabled,yt,u.id,Ke,xe,a.b.simpleSegment(0,2*et.circleOffset,et.circleArray.length,et.circleArray.length/2),null,L.zoom)}var Qe;Ke.destroy(),xe.destroy()}const Tl=a.ad.create();function cl(p){const r=p._camera.getWorldToCamera(p.worldSize,1),u=a.ad.multiply([],r,p.globeMatrix);a.ad.invert(u,u);const m=[0,0,0],b=[0,1,0,0];return a.aA.transformMat4(b,b,u),m[0]=b[0],m[1]=b[1],m[2]=b[2],a._.normalize(m,m),m}function zu({width:p,height:r,anchor:u,textOffset:m,textScale:b},w){const{horizontalAlign:I,verticalAlign:M}=a.bQ(u),R=-(I-.5)*p,L=-(M-.5)*r,U=a.bP(u,m);return new a.P((R/b+U[0])*w,(L/b+U[1])*w)}function Uu(p,r,u,m,b,w,I,M,R,L,U){const G=p.text.placedSymbolArray,J=p.text.dynamicLayoutVertexArray,Q=p.icon.dynamicLayoutVertexArray,le={},de=p.getProjection(),ge=Ac(M,de,w),xe=w.elevation,Ke=de.upVectorScale(M.canonical,w.center.lat,w.worldSize).metersToTile;J.clear();for(let Qe=0;Qe<G.length;Qe++){const et=G.get(Qe),{tileAnchorX:yt,tileAnchorY:_t,numGlyphs:St}=et,Ee=et.hidden||!et.crossTileID||p.allowVerticalPlacement&&!et.placedOrientation?null:m[et.crossTileID];if(Ee){let tt=0,Lt=0,sn=0;if(xe){const Pn=xe?xe.getAtTileOffset(M,yt,_t):0,[yi,bi,Mi]=de.upVector(M.canonical,yt,_t);tt=Pn*yi*Ke,Lt=Pn*bi*Ke,sn=Pn*Mi*Ke}let[zt,It,hn,Gn]=ti(et.projectedAnchorX+tt,et.projectedAnchorY+Lt,et.projectedAnchorZ+sn,u?ge:I);const Xn=mi(w.getCameraToCenterDistance(de),Gn);let Vn=b.evaluateSizeForFeature(p.textSizeData,L,et)*Xn/a.bN;u&&(Vn*=p.tilePixelRatio/R);const Xt=zu(Ee,Vn);u?(({x:zt,y:It,z:hn}=de.projectTilePoint(yt+Xt.x,_t+Xt.y,M.canonical)),[zt,It,hn]=ti(zt+tt,It+Lt,hn+sn,I)):(r&&Xt._rotate(-w.angle),zt+=Xt.x,It+=Xt.y,hn=0);const mn=p.allowVerticalPlacement&&et.placedOrientation===a.aE.vertical?Math.PI/2:0;for(let Pn=0;Pn<St;Pn++)a.aH(J,zt,It,hn,mn);U&&et.associatedIconIndex>=0&&(le[et.associatedIconIndex]={x:zt,y:It,z:hn,angle:mn})}else Di(St,J)}if(U){Q.clear();const Qe=p.icon.placedSymbolArray;for(let et=0;et<Qe.length;et++){const yt=Qe.get(et),{numGlyphs:_t}=yt,St=le[et];if(yt.hidden||!St)Di(_t,Q);else{const{x:Ee,y:tt,z:Lt,angle:sn}=St;for(let zt=0;zt<_t;zt++)a.aH(Q,Ee,tt,Lt,sn)}}p.icon.dynamicLayoutVertexBuffer.updateData(Q)}p.text.dynamicLayoutVertexBuffer.updateData(J)}function su(p,r,u,m,b,w,I={}){const M=u.paint.get("icon-translate"),R=u.paint.get("text-translate"),L=u.paint.get("icon-translate-anchor"),U=u.paint.get("text-translate-anchor"),G=u.layout.get("icon-rotation-alignment"),J=u.layout.get("text-rotation-alignment"),Q=u.layout.get("icon-pitch-alignment"),le=u.layout.get("text-pitch-alignment"),de=u.layout.get("icon-keep-upright"),ge=u.layout.get("text-keep-upright"),xe=u.paint.get("icon-color-saturation"),Ke=u.paint.get("icon-color-contrast"),Qe=u.paint.get("icon-color-brightness-min"),et=u.paint.get("icon-color-brightness-max"),yt=u.paint.get("icon-occlusion-opacity").constantOr(0),_t=u.paint.get("text-occlusion-opacity").constantOr(0),St=p.context,Ee=St.gl,tt=p.transform,Lt="map"===G,sn="map"===J,zt="map"===Q,It="map"===le,hn=1!==yt,Gn=1!==_t,Xn=void 0!==u.layout.get("symbol-sort-key").constantOr(1);let Vn=!1;const Xt=p.depthModeForSublayer(0,a.ae.ReadOnly),mn=[a.aj(tt.center.lng),a.ak(tt.center.lat)],Pn=u.layout.get("text-variable-anchor"),yi="globe"===tt.projection.name,bi=[],Mi=[0,-1,0];for(const xi of m){const di=r.getTile(xi),In=di.getBucket(u);if(!In||"mercator"===In.projection.name&&yi||In.fullyClipped)continue;const Li="globe"===In.projection.name,Ir=Li?a.a1(tt.zoom):0,Ji=Ac(xi,In.getProjection(),tt),hr=tt.calculatePixelsToTileUnitsMatrix(di),Fr=Pn&&In.hasTextData(),fr=In.hasIconTextFit()&&Fr&&In.hasIconData(),Rr=In.getProjection().createInversionMatrix(tt,xi.canonical),rr=()=>{const No=Lt&&"point"!==u.layout.get("symbol-placement"),Mn=[];u.hasInitialOcclusionOpacityProperties&&hn&&p.symbolParams.useOcclusionQueries&&!Li&&!yi&&Mn.push("OCCLUSION_QUERIES"),u.hasInitialOcclusionOpacityProperties||Mn.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH");const Pi=No||fr,zs=u.paint.get("icon-image-cross-fade").constantOr(0);p.terrainRenderModeElevated()&&zt&&Mn.push("PITCH_WITH_MAP_TERRAIN"),Li&&(Mn.push("PROJECTION_GLOBE_VIEW"),Pi&&Mn.push("PROJECTED_POS_ON_VIEWPORT")),zs>0&&Mn.push("ICON_TRANSITION"),In.icon.zOffsetVertexBuffer&&Mn.push("Z_OFFSET"),Mn.push("TERRAIN_DEPTH_D24"),0===xe&&0===Ke&&0===Qe&&1===et||Mn.push("COLOR_ADJUSTMENT");const to=In.icon.programConfigurations.get(u.id),Jt=p.getOrCreateProgram(In.sdfIcons?"symbolSDF":"symbolIcon",{config:to,defines:Mn});let ra;const Us=di.imageAtlasTexture?di.imageAtlasTexture.size:[0,0],Ms=In.iconSizeData,Xs=a.aD(Ms,tt.zoom),Ks=zt||0!==tt.pitch,Tr=Ut(Ji,di.tileID.canonical,zt,Lt,tt,In.getProjection(),hr),xa=qn(Ji,di.tileID.canonical,zt,Lt,tt,In.getProjection(),hr),pc=p.translatePosMatrix(xa,di,M,L,!0),jc=p.translatePosMatrix(Ji,di,M,L),Ju=Pi?Tl:Tr,mc=Lt&&!zt&&!No;let Qu=Mi;!yi&&!tt.mercatorFromTransition||Lt||(Qu=cl(tt));const Vd=Li?Qu:Mi;if(In.sdfIcons&&!In.iconsInText)ra=Cl(Ms.kind,Xs,mc,zt,p,jc,Ju,pc,!1,Us,!0,xi,Ir,mn,Rr,Vd,In.getProjection());else{const ed=u.getColorAdjustmentMatrix(xe,Ke,Qe,et);ra=aa(Ms.kind,Xs,mc,zt,p,jc,Ju,pc,!1,Us,xi,Ir,mn,Rr,Vd,In.getProjection(),ed,zs)}const $d=di.imageAtlasTexture?di.imageAtlasTexture:null,Sl=1!==u.layout.get("icon-size").constantOr(0)||In.iconsNeedLinear,Gd=In.sdfIcons||p.options.rotating||p.options.zooming||Sl||Ks?Ee.LINEAR:Ee.NEAREST,Mf=In.sdfIcons&&0!==u.paint.get("icon-halo-width").constantOr(1),Sf=p.terrain&&zt&&No?a.ad.invert(a.ad.create(),Tr):Tl;if(No&&In.icon){const ed=tt.elevation,ua=ed?ed.getAtTileOffsetFunc(xi,tt.center.lat,tt.worldSize,In.getProjection()):null,li=ln(Ji,di.tileID.canonical,zt,Lt,tt,In.getProjection(),hr);Hi(In,Ji,p,!1,li,xa,zt,de,ua,xi)}return{program:Jt,buffers:In.icon,uniformValues:ra,atlasTexture:$d,atlasTextureIcon:null,atlasInterpolation:Gd,atlasInterpolationIcon:null,isSDF:In.sdfIcons,hasHalo:Mf,tile:di,labelPlaneMatrixInv:Sf}},Ur=()=>{const No=sn&&"point"!==u.layout.get("symbol-placement"),Mn=[],Pi=No||Pn||fr;u.hasInitialOcclusionOpacityProperties&&Gn&&p.symbolParams.useOcclusionQueries&&!Li&&!yi&&Mn.push("OCCLUSION_QUERIES"),u.hasInitialOcclusionOpacityProperties||Mn.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH"),p.terrainRenderModeElevated()&&It&&Mn.push("PITCH_WITH_MAP_TERRAIN"),Li&&(Mn.push("PROJECTION_GLOBE_VIEW"),Pi&&Mn.push("PROJECTED_POS_ON_VIEWPORT")),In.text.zOffsetVertexBuffer&&Mn.push("Z_OFFSET"),Mn.push("TERRAIN_DEPTH_D24");const zs=In.text.programConfigurations.get(u.id),to=p.getOrCreateProgram(In.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:zs,defines:Mn});let Jt,ra=[0,0],Us=null;const Ms=In.textSizeData;In.iconsInText&&(ra=di.imageAtlasTexture?di.imageAtlasTexture.size:[0,0],Us=di.imageAtlasTexture?di.imageAtlasTexture:null,Jt=It||0!==tt.pitch||p.options.rotating||p.options.zooming||"composite"===Ms.kind||"camera"===Ms.kind?Ee.LINEAR:Ee.NEAREST);const Xs=di.glyphAtlasTexture?di.glyphAtlasTexture.size:[0,0],Ks=a.aD(Ms,tt.zoom),Tr=Ut(Ji,di.tileID.canonical,It,sn,tt,In.getProjection(),hr),xa=qn(Ji,di.tileID.canonical,It,sn,tt,In.getProjection(),hr),pc=p.translatePosMatrix(xa,di,R,U,!0),jc=p.translatePosMatrix(Ji,di,R,U),Ju=Pi?Tl:Tr,mc=sn&&!It&&!No;let Qu=Mi;!yi&&!tt.mercatorFromTransition||sn||(Qu=cl(tt));const Vd=Li?Qu:Mi;let $d;$d=In.iconsInText?Mc(Ms.kind,Ks,mc,It,p,jc,Ju,pc,Xs,ra,xi,Ir,mn,Rr,Vd,In.getProjection()):Cl(Ms.kind,Ks,mc,It,p,jc,Ju,pc,!0,Xs,!0,xi,Ir,mn,Rr,Vd,In.getProjection());const Sl=di.glyphAtlasTexture?di.glyphAtlasTexture:null,Gd=Ee.LINEAR,Mf=0!==u.paint.get("text-halo-width").constantOr(1),Sf=p.terrain&&It&&No?a.ad.invert(a.ad.create(),Tr):Tl;if(No&&In.text){const ed=tt.elevation,ua=ed?ed.getAtTileOffsetFunc(xi,tt.center.lat,tt.worldSize,In.getProjection()):null,li=ln(Ji,di.tileID.canonical,It,sn,tt,In.getProjection(),hr);Hi(In,Ji,p,!0,li,xa,It,ge,ua,xi)}return{program:to,buffers:In.text,uniformValues:$d,atlasTexture:Sl,atlasTextureIcon:Us,atlasInterpolation:Gd,atlasInterpolationIcon:Jt,isSDF:!0,hasHalo:Mf,tile:di,labelPlaneMatrixInv:Sf}},po=In.icon.segments.get().length,Pr=In.text.segments.get().length,cr=po&&!I.onlyText?rr():null,Kr=Pr&&!I.onlyIcons?Ur():null,ps=u.paint.get("icon-opacity").constantOr(1),xo=u.paint.get("text-opacity").constantOr(1);if(Xn&&In.canOverlap){Vn=!0;const No=ps&&!I.onlyText?In.icon.segments.get():[],Mn=xo&&!I.onlyIcons?In.text.segments.get():[];for(const Pi of No)bi.push({segments:new a.b([Pi]),sortKey:Pi.sortKey,state:cr});for(const Pi of Mn)bi.push({segments:new a.b([Pi]),sortKey:Pi.sortKey,state:Kr})}else I.onlyText||bi.push({segments:ps?In.icon.segments:new a.b([]),sortKey:0,state:cr}),I.onlyIcons||bi.push({segments:xo?In.text.segments:new a.b([]),sortKey:0,state:Kr})}Vn&&bi.sort((xi,di)=>xi.sortKey-di.sortKey);for(const xi of bi){const di=xi.state;if(di)if(p.terrain&&p.terrain.setupElevationDraw(di.tile,di.program,{useDepthForOcclusion:!u.hasInitialOcclusionOpacityProperties&&tt.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:di.labelPlaneMatrixInv}),St.activeTexture.set(Ee.TEXTURE0),di.atlasTexture&&di.atlasTexture.bind(di.atlasInterpolation,Ee.CLAMP_TO_EDGE,!0),di.atlasTextureIcon&&(St.activeTexture.set(Ee.TEXTURE1),di.atlasTextureIcon&&di.atlasTextureIcon.bind(di.atlasInterpolationIcon,Ee.CLAMP_TO_EDGE,!0)),p.uploadCommonLightUniforms(p.context,di.program),di.hasHalo){const In=di.uniformValues;In.u_is_halo=1,Ra(di.buffers,xi.segments,u,p,di.program,Xt,b,w,In,2),In.u_is_halo=0}else{if(di.isSDF){const In=di.uniformValues;di.hasHalo&&(In.u_is_halo=1,Ra(di.buffers,xi.segments,u,p,di.program,Xt,b,w,In,1)),In.u_is_halo=0}Ra(di.buffers,xi.segments,u,p,di.program,Xt,b,w,di.uniformValues,1)}}}function Ra(p,r,u,m,b,w,I,M,R,L){const U=m.context.gl,G=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer];p.occlusionQueryOpacityVertexBuffer.length>0&&G.push(p.occlusionQueryOpacityVertexBuffer),b.draw(m,U.TRIANGLES,w,I,M,a.af.disabled,R,u.id,p.layoutVertexBuffer,p.indexBuffer,r,u.paint,m.transform.zoom,p.programConfigurations.get(u.id),G,L)}function ul(p,r,u,m,b,w,I){const M=p.context.gl,R=u.paint.get("fill-pattern"),L=R&&R.constantOr(1);let U,G,J,Q,le;I?(G=L&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=M.LINES):(G=L?"fillPattern":"fill",U=M.TRIANGLES);for(const de of m){const ge=r.getTile(de);if(L&&!ge.patternsLoaded())continue;const xe=ge.getBucket(u);if(!xe)continue;p.prepareDrawTile();const Ke=xe.programConfigurations.get(u.id),Qe=p.isTileAffectedByFog(de),et=p.getOrCreateProgram(G,{config:Ke,overrideFog:Qe});L&&(p.context.activeTexture.set(M.TEXTURE0),ge.imageAtlasTexture&&ge.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Ke.updatePaintBuffers());const yt=R.constantOr(null);if(yt&&ge.imageAtlas){const Ee=ge.imageAtlas.patternPositions[yt.toString()];Ee&&Ke.setConstantPatternPositions(Ee)}const _t=p.translatePosMatrix(de.projMatrix,ge,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor")),St=u.paint.get("fill-emissive-strength");if(I){Q=xe.indexBuffer2,le=xe.segments2;const Ee=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];J="fillOutlinePattern"===G&&L?_r(_t,St,p,ge,Ee):as(_t,St,Ee)}else Q=xe.indexBuffer,le=xe.segments,J=L?Zr(_t,St,p,ge):sr(_t,St);p.uploadCommonUniforms(p.context,et,de.toUnwrapped()),et.draw(p,U,b,p.stencilModeForClipping(de),w,a.af.disabled,J,u.id,xe.layoutVertexBuffer,Q,le,u.paint,p.transform.zoom,Ke,void 0)}}function la(p,r,u,m,b,w,I,M){u.resetLayerRenderingStats(p);const R=p.context,L=R.gl,U=p.transform,G=u.paint.get("fill-extrusion-pattern"),J=G.constantOr(1),Q=u.paint.get("fill-extrusion-opacity"),le=p.style.enable3dLights(),de=u.paint.get(le&&!J?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ge=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),de],xe=u.layout.get("fill-extrusion-edge-radius"),Ke=xe>0&&!u.paint.get("fill-extrusion-rounded-roof"),Qe=Ke?0:xe,et="globe"===U.projection.name?a.bY():0,yt="globe"===U.projection.name,_t=yt?a.a1(U.zoom):0,St=[a.aj(U.center.lng),a.ak(U.center.lat)],Ee=u.paint.get("fill-extrusion-flood-light-color").toRenderColor(u.lut).toArray01().slice(0,3),tt=u.paint.get("fill-extrusion-flood-light-intensity"),Lt=u.paint.get("fill-extrusion-vertical-scale"),sn=ea(p,u.paint.get("fill-extrusion-cutoff-fade-range")),zt=u.paint.get("fill-extrusion-emissive-strength"),It=[];let hn;yt&&It.push("PROJECTION_GLOBE_VIEW"),ge[0]>0&&It.push("FAUX_AO"),Ke&&It.push("ZERO_ROOF_RADIUS"),M&&It.push("HAS_CENTROID"),tt>0&&It.push("FLOOD_LIGHT"),sn.shouldRenderCutoff&&It.push("RENDER_CUTOFF");const Gn="shadow"===p.renderPass,Xn=p.shadowRenderer,Vn=Gn&&!!Xn;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let Xt=[0,0,0];if(Xn){const yi=p.style.directionalLight,bi=p.style.ambientLight;yi&&bi&&(Xt=Ns(p.style,yi,bi)),hn=It.concat(["SHADOWS_SINGLE_CASCADE"])}const mn=Vn?"fillExtrusionDepth":J?"fillExtrusionPattern":"fillExtrusion",Pn=u.getLayerRenderingStats();for(const yi of m){const bi=r.getTile(yi),Mi=bi.getBucket(u);if(!Mi||Mi.projection.name!==U.projection.name)continue;let xi=!1;Xn&&(xi=0===Xn.getMaxCascadeForTile(yi.toUnwrapped()));const di=p.isTileAffectedByFog(yi),In=Mi.programConfigurations.get(u.id),Li=p.getOrCreateProgram(mn,{config:In,defines:xi?hn:It,overrideFog:di});if(p.terrain&&p.terrain.setupElevationDraw(bi,Li,{useMeterToDem:!0}),!Mi.centroidVertexBuffer){const Rr=Li.attributes.a_centroid_pos;void 0!==Rr&&L.vertexAttrib2f(Rr,0,0)}!Gn&&Xn&&Xn.setupShadows(bi.tileID.toUnwrapped(),Li,"vector-tile",bi.tileID.overscaledZ),J&&(p.context.activeTexture.set(L.TEXTURE0),bi.imageAtlasTexture&&bi.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),In.updatePaintBuffers());const Ir=G.constantOr(null);if(Ir&&bi.imageAtlas){const Rr=bi.imageAtlas.patternPositions[Ir.toString()];Rr&&In.setConstantPatternPositions(Rr)}const Ji=u.paint.get("fill-extrusion-vertical-gradient");let hr;if(Gn&&Xn){if(Rd(bi.tileID,Mi,p))continue;const Rr=Xn.calculateShadowPassMatrixFromTile(bi.tileID.toUnwrapped());hr=rt(Rr,Qe,Lt)}else{const Rr=p.translatePosMatrix(yi.expandedProjMatrix,bi,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),rr=U.projection.createInversionMatrix(U,yi.canonical);hr=J?qt(Rr,p,Ji,Q,ge,Qe,yi,bi,et,_t,St,rr,Ee,Lt):q(Rr,p,Ji,Q,ge,Qe,yi,et,_t,St,rr,Ee,Lt,tt,Xt,zt)}p.uploadCommonUniforms(R,Li,yi.toUnwrapped(),null,sn);let Fr=Mi.segments;if("mercator"===U.projection.name&&!Gn&&(Fr=Mi.getVisibleSegments(bi.tileID,p.terrain,p.transform.getFrustum(0)),!Fr.get().length))continue;if(Pn)if(Gn)for(const Rr of Fr.get())Pn.numRenderedVerticesInShadowPass+=Rr.primitiveLength;else for(const Rr of Fr.get())Pn.numRenderedVerticesInTransparentPass+=Rr.primitiveLength;const fr=[];(p.terrain||M)&&fr.push(Mi.centroidVertexBuffer),yt&&fr.push(Mi.layoutVertexExtBuffer),Li.draw(p,R.gl.TRIANGLES,b,w,I,a.af.backCCW,hr,u.id,Mi.layoutVertexBuffer,Mi.indexBuffer,Fr,u.paint,p.transform.zoom,In,fr)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}function wr(p,r,u,m,b,w,I,M,R,L,U,G,J,Q,le,de,ge,xe,Ke){const Qe=p.context,et=Qe.gl,yt=p.transform,_t=p.transform.zoom,St=[],Ee=ea(p,u.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===L?(St.push("CLEAR_SUBPASS"),Ke&&(St.push("CLEAR_FROM_TEXTURE"),Qe.activeTexture.set(et.TEXTURE0),Ke.bind(et.LINEAR,et.CLAMP_TO_EDGE))):"sdf"===L&&St.push("SDF_SUBPASS"),ge&&St.push("HAS_CENTROID"),Ee.shouldRenderCutoff&&St.push("RENDER_CUTOFF");const tt=u.layout.get("fill-extrusion-edge-radius"),Lt=(sn,zt,It,hn,Gn)=>{const Xn=zt.programConfigurations.get(u.id),Vn=p.isTileAffectedByFog(sn),Xt=p.getOrCreateProgram("fillExtrusionGroundEffect",{config:Xn,defines:St,overrideFog:Vn}),mn=((yi,bi,Mi,xi,di,In,Li,Ir,Ji,hr,Fr)=>({u_matrix:bi,u_opacity:Mi,u_ao_pass:xi?1:0,u_meter_to_tile:di,u_ao:In,u_flood_light_intensity:Li,u_flood_light_color:Ir,u_attenuation:Ji,u_edge_radius:hr,u_fb:0,u_fb_size:Fr}))(0,hn,U,R,Gn,[G,J*Gn],Q,le,de,_t>=17?0:tt*Gn,Ke?Ke.size[0]:0),Pn=[];ge&&Pn.push(zt.hiddenByLandmarkVertexBuffer),p.uploadCommonUniforms(Qe,Xt,sn.toUnwrapped(),null,Ee),Xt.draw(p,Qe.gl.TRIANGLES,b,w,I,M,mn,u.id,zt.vertexBuffer,zt.indexBuffer,It,u.paint,_t,Xn,Pn)};for(const sn of m){const zt=r.getTile(sn),It=zt.getBucket(u);if(!It||It.projection.name!==yt.projection.name||!It.groundEffect||It.groundEffect&&!It.groundEffect.hasData())continue;const hn=It.groundEffect,Gn=1/It.tileToMeter;{const Xn=p.translatePosMatrix(sn.projMatrix,zt,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Vn=hn.getDefaultSegment();Lt(sn,hn,Vn,Xn,Gn)}if(xe)for(let Xn=0;Xn<4;Xn++){const Vn=a.bZ[Xn](sn),Xt=r.getTile(Vn);if(!Xt)continue;const mn=Xt.getBucket(u);if(!mn||mn.projection.name!==yt.projection.name||!mn.groundEffect||mn.groundEffect&&!mn.groundEffect.hasData())continue;const Pn=mn.groundEffect;let yi,bi;0===Xn?(yi=[-a.a3,0,0],bi=1):1===Xn?(yi=[a.a3,0,0],bi=0):2===Xn?(yi=[0,-a.a3,0],bi=3):(yi=[0,a.a3,0],bi=2);const Mi=Pn.regionSegments[bi];if(!Mi)continue;const xi=new Float32Array(16);a.ad.translate(xi,sn.projMatrix,yi),Lt(sn,Pn,Mi,p.translatePosMatrix(xi,zt,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Gn)}}}function So(p,r,u,m,b,w,I){0===m.centroidVertexArray.length&&m.createCentroidsBuffer();const M=w?w.findDEMTileFor(u):null;if(!(M&&M.dem||I))return;const R=xe=>new a.P(Math.ceil((xe+a.c0)*a.c1),0),L=xe=>{const Ke=r.getSource().minzoom,Qe=yt=>{const _t=r.getTileByID(yt);if(_t&&_t.hasData())return _t.getBucket(b)},et=[0,-1,1];for(const yt of et){if(xe.overscaledZ+yt<Ke)continue;const _t=Qe(xe.calculateScaledKey(xe.overscaledZ+yt));if(_t)return _t}},U=[0,0,0],G=(xe,Ke)=>(U[0]=Math.min(xe.min.y,Ke.min.y),U[1]=Math.max(xe.max.y,Ke.max.y),U[2]=a.a3-Ke.min.x>xe.max.x?Ke.min.x-a.a3:xe.max.x,U),J=(xe,Ke)=>(U[0]=Math.min(xe.min.x,Ke.min.x),U[1]=Math.max(xe.max.x,Ke.max.x),U[2]=a.a3-Ke.min.y>xe.max.y?Ke.min.y-a.a3:xe.max.y,U),Q=[(xe,Ke)=>G(xe,Ke),(xe,Ke)=>G(Ke,xe),(xe,Ke)=>J(xe,Ke),(xe,Ke)=>J(Ke,xe)],le=(xe,Ke,Qe,et,yt,_t,St)=>{if(!w)return 0;const Ee=[[_t?Qe:xe,_t?xe:Qe,0],[_t?Qe:Ke,_t?Ke:Qe,0]],tt=St<0?a.a3+St:St,Lt=[_t?tt:(xe+Ke)/2,_t?(xe+Ke)/2:tt,0];return 0===Qe&&St<0||0!==Qe&&St>0?w.getForTilePoints(yt,[Lt],!0,et):Ee.push(Lt),w.getForTilePoints(u,Ee,!0,M),Math.max(Ee[0][2],Ee[1][2],Lt[2])/w.exaggeration()};for(let xe=0;xe<4;xe++){const Ke=m.borderFeatureIndices[xe];if(0===Ke.length)continue;const Qe=a.bZ[xe](u),et=L(Qe);if(!(et&&et instanceof a.b_)||m.borderDoneWithNeighborZ[xe]===et.canonical.z)continue;0===et.centroidVertexArray.length&&et.createCentroidsBuffer();const yt=w?w.findDEMTileFor(Qe):null;if(!(yt&&yt.dem||I))continue;const _t=(xe<2?1:5)-xe,St=et.borderDoneWithNeighborZ[_t]!==m.canonical.z,Ee=et.borderFeatureIndices[_t];let tt=0;if(m.canonical.z!==et.canonical.z){for(const Lt of Ke)m.showCentroid(m.featuresOnBorder[Lt]);if(St)for(const Lt of Ee)et.showCentroid(et.featuresOnBorder[Lt]);m.borderDoneWithNeighborZ[xe]=et.canonical.z,et.borderDoneWithNeighborZ[_t]=m.canonical.z}for(const Lt of Ke){const sn=m.featuresOnBorder[Lt],zt=m.centroidData[sn.centroidDataIndex],It=sn.borders[xe];let hn;for(;tt<Ee.length;){hn=et.featuresOnBorder[Ee[tt]];const Gn=hn.borders[_t];if(Gn[1]>It[0]+3||Gn[0]>It[0]-3)break;et.showCentroid(hn),tt++}if(hn&&tt<Ee.length){const Gn=tt;let Xn=0;for(;!(hn.borders[_t][0]>It[1]-3)&&(Xn++,++tt!==Ee.length);)hn=et.featuresOnBorder[Ee[tt]];if(hn=et.featuresOnBorder[Ee[Gn]],Xn>1){const mn=hn.borders[_t];Math.abs(It[0]-mn[0])<3&&Math.abs(It[1]-mn[1])<3&&(Xn=1,tt=Gn+1)}else if(0===Xn){m.showCentroid(sn);continue}const Vn=et.centroidData[hn.centroidDataIndex];I&&1===Xn&&(((de=zt).flags|(ge=Vn).flags)&a.b$?(de.flags|=a.b$,ge.flags|=a.b$):(de.flags&=~a.b$,ge.flags&=~a.b$));const Xt=sn.intersectsCount()>1||hn.intersectsCount()>1;if(Xn>1)tt=Gn,zt.centroidXY=Vn.centroidXY=new a.P(0,0);else if(yt&&yt.dem&&!Xt){const mn=Q[xe](zt,Vn),Pn=xe%2?a.a3-1:0,yi=le(mn[0],Math.min(a.a3-1,mn[1]),Pn,yt,Qe,xe<2,mn[2]);zt.centroidXY=Vn.centroidXY=R(yi)}else Xt?zt.centroidXY=Vn.centroidXY=new a.P(0,0):(zt.centroidXY=m.encodeBorderCentroid(sn),Vn.centroidXY=et.encodeBorderCentroid(hn));m.writeCentroidToBuffer(zt),et.writeCentroidToBuffer(Vn)}else m.showCentroid(sn)}m.borderDoneWithNeighborZ[xe]=et.canonical.z,et.borderDoneWithNeighborZ[_t]=m.canonical.z}var de,ge;(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(p)}const vh=[1,0,0],lc=[0,1,0],Pd=[0,0,1];function Rd(p,r,u){const m=u.transform,b=u.shadowRenderer;if(!b)return!0;const w=p.toUnwrapped(),I=m.tileSize*b._cascades[u.currentShadowCascade].scale;let M=r.maxHeight;if(m.elevation){const de=m.elevation.getMinMaxForTile(p);de&&(M+=de.max)}const R=[...b.shadowDirection];R[2]=-R[2];const L=b.computeSimplifiedTileShadowVolume(w,M,I,R);if(!L)return!1;const U=[vh,lc,Pd,R,[R[0],0,R[2]],[0,R[1],R[2]]],G="globe"===m.projection.name,J=m.scaleZoom(I),Q=a.aM.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,J,!G),le=b.getCurrentCascadeFrustum();return 0===Q.intersectsPrecise(L.vertices,L.planes,U)||0===le.intersectsPrecise(L.vertices,L.planes,U)}function ju(p){return[p[0]*a.c2,p[1]*a.c2,p[2]*a.c2,0]}function Vl(p,r,u,m,b,w,I,M,R){const L=m.getSource(),U=u.globeSharedBuffers;if(!U)return;let G,J,Q;if(r&&(G=m.getTile(r)),L instanceof a.bm?(J=L.texture,Q=a.bh(0,0,u.transform)):G&&r&&(J=G.texture,Q=a.bh(r.canonical.z,r.canonical.x,u.transform)),!J||!Q)return;p||(Q=a.ad.scale(a.ad.create(),Q,[1,-1,1]));const le=u.context,de=le.gl,ge="nearest"===b.paint.get("raster-resampling")?de.NEAREST:de.LINEAR,xe=u.colorModeForDrapableLayerRenderPass(w),Ke=I.defines;Ke.push("GLOBE_POLES");const Qe=new a.ae(de.LEQUAL,a.ae.ReadWrite,u.depthRangeFor3D),et=Float32Array.from(u.transform.expandedFarZProjMatrix),yt=Float32Array.from(a.bf(a.bg(new a.aO(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),le.activeTexture.set(de.TEXTURE0),J.bind(ge,de.CLAMP_TO_EDGE),le.activeTexture.set(de.TEXTURE1),J.bind(ge,de.CLAMP_TO_EDGE),J.useMipmap&&le.extTextureFilterAnisotropic&&u.transform.pitch>20&&de.texParameterf(de.TEXTURE_2D,le.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,le.extTextureFilterAnisotropicMax);const[_t,St,Ee,tt]=r?U.getPoleBuffers(r.canonical.z,!1):U.getPoleBuffers(0,!0),Lt=b.paint.get("raster-elevation");let sn;p?(sn=_t,u.renderDefaultNorthPole=0!==Lt):(sn=St,u.renderDefaultSouthPole=0!==Lt);const zt=ju(I.mix),It=(Gn=et,Xn=yt,Vn=Q,Xt=a.a1(u.transform.zoom),Pn=b,bi=Lt,xi=zt,di=I.offset,In=I.range,Li=w,nu(Gn,Xn,Vn,new Float32Array(16),new Float32Array(9),[0,0],Xt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Pn,[0,0],bi,2,xi,di,In,1,0,Li)),hn=u.getOrCreateProgram("raster",{defines:Ke});var Gn,Xn,Vn,Xt,Pn,bi,xi,di,In,Li;u.uploadCommonUniforms(le,hn,null),hn.draw(u,de.TRIANGLES,Qe,R,xe,M,It,b.id,sn,Ee,tt)}function qr(p){const r=p._nearZ,u=p.projection.farthestPixelDistance(p),m=u-r,b=.2*p.height,w=r+b;return[r,u,(w-b-r)/m,(w-r)/m]}function Br(p,r,u,m){if(p)return r instanceof Bl&&p instanceof a.c3?r.getTextureDescriptor(p,u,!0):{texture:p.texture,mix:ju(m.mix),offset:m.offset,buffer:0,tileSize:1}}function xh(p,r,u){if(!p)return null;const m=r.getTextureDescriptor(p,u,!0);if(!m)return null;let{texture:b,mix:w,offset:I,tileSize:M,buffer:R,format:L}=m;if(!b||!L)return null;let U=!1;return"uint32"===L&&(U=!0,w[3]=0,w=jl(a.c4,w,[0,u.paint.get("raster-particle-max-speed")]),I=zo(a.c4,I,[0,u.paint.get("raster-particle-max-speed")])),{texture:b,textureOffset:[R/(M+2*R),M/(M+2*R)],tileSize:M,scalarData:U,scale:w,offset:I,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function zi(p){const r=p._nearZ,u=p.projection.farthestPixelDistance(p),m=u-r,b=.2*p.height,w=r+b;return[r,u,(w-b-r)/m,(w-r)/m]}const cc=new a.C(1,0,0,1),au=new a.C(0,1,0,1),Ya=new a.C(0,0,1,1),$s=new a.C(1,0,1,1),lu=new a.C(0,1,1,1);function V(p,r,u,m,b,w,I){const M=p.context,R=p.transform,L=M.gl,U="globe"===R.projection.name,G=U?["PROJECTION_GLOBE_VIEW"]:[];let J=a.ad.clone(u.projMatrix);if(U&&a.a1(R.zoom)>0){const zt=a.c5(u.canonical,R),It=a.c6(zt);J=a.ad.multiply(new Float32Array(16),R.globeMatrix,It),a.ad.multiply(J,R.projMatrix,J)}const Q=a.ad.create();Q[12]+=2*b/(a.e.devicePixelRatio*R.width),Q[13]+=2*w/(a.e.devicePixelRatio*R.height),a.ad.multiply(J,Q,J);const le=p.getOrCreateProgram("debug",{defines:G}),de=r.getTileByID(u.key);p.terrain&&p.terrain.setupElevationDraw(de,le);const ge=a.ae.disabled,xe=a.ag.disabled,Ke=p.colorModeForRenderPass();M.activeTexture.set(L.TEXTURE0),p.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),U?de._makeGlobeTileDebugBuffers(p.context,R):de._makeDebugTileBoundsBuffers(p.context,R.projection);const et=de._tileDebugBuffer||p.debugBuffer,yt=de._tileDebugIndexBuffer||p.debugIndexBuffer,_t=de._tileDebugSegments||p.debugSegments;if(le.draw(p,L.LINE_STRIP,ge,xe,Ke,a.af.disabled,Sd(J,m),"$debug",et,yt,_t,null,null,null,[de._globeTileDebugBorderBuffer]),I){const zt=de.latestRawTileData,It=Math.floor((zt&&zt.byteLength||0)/1024);let hn=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(hn+=` => ${u.overscaledZ}`),hn+=` ${de.state}`,hn+=` ${It}kb`,function(Gn,Xn){Gn.initDebugOverlayCanvas();const Vn=Gn.debugOverlayCanvas,Xt=Gn.context.gl,mn=Gn.debugOverlayCanvas.getContext("2d");mn.clearRect(0,0,Vn.width,Vn.height),mn.shadowColor="white",mn.shadowBlur=2,mn.lineWidth=1.5,mn.strokeStyle="white",mn.textBaseline="top",mn.font="bold 36px Open Sans, sans-serif",mn.fillText(Xn,5,5),mn.strokeText(Xn,5,5),Gn.debugOverlayTexture.update(Vn),Gn.debugOverlayTexture.bind(Xt.LINEAR,Xt.CLAMP_TO_EDGE)}(p,hn)}const St=r.getTile(u).tileSize,Ee=512/Math.min(St,512)*(u.overscaledZ/R.zoom)*.5,tt=de._tileDebugTextBuffer||p.debugBuffer,Lt=de._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,sn=de._tileDebugTextSegments||p.debugSegments;le.draw(p,L.TRIANGLES,ge,xe,a.a.alphaBlended,a.af.disabled,Sd(J,a.C.transparent,Ee),"$debug",tt,Lt,sn,null,null,null,[de._globeTileDebugTextBuffer])}function oe(p,r,u,m){ae(p,0,r+u/2,p.transform.width,u,m)}function K(p,r,u,m){ae(p,r-u/2,0,u,p.transform.height,m)}function ae(p,r,u,m,b,w){const I=p.context,M=I.gl;M.enable(M.SCISSOR_TEST),M.scissor(r*a.e.devicePixelRatio,u*a.e.devicePixelRatio,m*a.e.devicePixelRatio,b*a.e.devicePixelRatio),I.clear({color:w}),M.disable(M.SCISSOR_TEST)}const Ot=a.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Nn}=Ot;function kn(p,r,u,m){p.emplaceBack(r,u,m)}class Xi{constructor(r){this.vertexArray=new a.c8,this.indices=new a.bu,kn(this.vertexArray,-1,-1,1),kn(this.vertexArray,1,-1,1),kn(this.vertexArray,-1,1,1),kn(this.vertexArray,1,1,1),kn(this.vertexArray,-1,-1,-1),kn(this.vertexArray,1,-1,-1),kn(this.vertexArray,-1,1,-1),kn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Nn),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=a.b.simpleSegment(0,0,36,12)}}function vo(p,r,u,m,b,w){const I=p.context.gl,M=r.paint.get("sky-atmosphere-color"),R=r.paint.get("sky-atmosphere-halo-color"),L=r.paint.get("sky-atmosphere-sun-intensity"),U={u_matrix_3f:a.bC.fromMat4(a.bC.create(),m),u_sun_direction:b,u_sun_intensity:L,u_color_tint_r:[(le=M).r,le.g,le.b,le.a],u_color_tint_m:[(de=R).r,de.g,de.b,de.a],u_luminance:5e-5};var le,de;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+w,r.skyboxTexture,0),u.draw(p,I.TRIANGLES,a.ae.disabled,a.ag.disabled,a.a.unblended,a.af.frontCW,U,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Ar=a.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Xr{constructor(r){const u=new a.c9;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const m=new a.bu;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(u,Ar.members),this.indexBuffer=r.createIndexBuffer(m),this.segments=a.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const gi=a.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class qo{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Eo{constructor(r){this.colorModeAlphaBlendedWriteRGB=new a.a([a.ca,a.cb,a.ca,a.cb],a.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new a.a([a.ca,a.cc,a.ca,a.cc],a.C.transparent,[!1,!1,!1,!0]),this.params=new qo,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){const u=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Xr(u);const m=this.params.sizeRange,b=this.params.intensityRange,w=function(U){const G=a.cf(30),J=[];for(let Q=0;Q<U;++Q){const le=2*Math.PI*G(),de=Math.acos(1-2*G())-.5*Math.PI;J.push(a._.fromValues(Math.cos(de)*Math.cos(le),Math.cos(de)*Math.sin(le),Math.sin(de)))}return J}(this.params.starsCount),I=a.cf(300),M=new a.cd,R=new a.bu;let L=0;for(let U=0;U<w.length;++U){const G=a._.scale([],w[U],200),J=Math.max(0,1+.01*m*(1*I()-.5)),Q=Math.max(0,1+.01*b*(1*I()-.5));M.emplaceBack(G[0],G[1],G[2],-1,-1,J,Q),M.emplaceBack(G[0],G[1],G[2],1,-1,J,Q),M.emplaceBack(G[0],G[1],G[2],1,1,J,Q),M.emplaceBack(G[0],G[1],G[2],-1,1,J,Q),R.emplaceBack(L+0,L+1,L+2),R.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=u.createVertexBuffer(M,gi.members),this.starsIdx=u.createIndexBuffer(R),this.starsSegments=a.b.simpleSegment(0,0,M.length,R.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,u){const m=r.context,b=m.gl,w=r.transform,I=new a.ae(b.LEQUAL,a.ae.ReadOnly,[0,1]),M=a.a1(w.zoom),R=r.style.getLut(u.scope),L=u.properties.get("color").toRenderColor(R).toArray01(),U=u.properties.get("high-color").toRenderColor(R).toArray01(),G=u.properties.get("space-color").toRenderColor(R).toArray01PremultipliedAlpha(),J=5e-4,Q=a.ce(u.properties.get("horizon-blend"),0,1,J,.25),le=a.ba(r,m,w)&&Q===J?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,de=r.frameCounter/1e3%1,ge=a._.length(w.globeCenterInViewSpace),xe=Math.sqrt(Math.pow(ge,2)-Math.pow(le,2)),Ke=Math.acos(xe/ge),Qe=et=>{const yt="globe"===w.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];et&&yt.push("ALPHA_PASS");const _t=r.getOrCreateProgram("globeAtmosphere",{defines:yt}),St=((tt,Lt,sn,zt,It,hn,Gn,Xn,Vn,Xt,mn,Pn)=>({u_frustum_tl:tt,u_frustum_tr:Lt,u_frustum_br:sn,u_frustum_bl:zt,u_horizon:It,u_transition:hn,u_fadeout_range:Gn,u_color:Xn,u_high_color:Vn,u_space_color:Xt,u_temporal_offset:mn,u_horizon_angle:Pn}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,M,Q,L,U,G,de,Ke);r.uploadCommonUniforms(m,_t);const Ee=this.atmosphereBuffer;Ee&&_t.draw(r,b.TRIANGLES,I,a.ag.disabled,et?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,a.af.backCW,St,et?"atmosphere_glow_alpha":"atmosphere_glow",Ee.vertexBuffer,Ee.indexBuffer,Ee.segments)};Qe(!1),Qe(!0)}drawStars(r,u){const m=a.at(u.properties.get("star-intensity"),0,1);if(0===m)return;const b=r.context,w=b.gl,I=r.transform,M=r.getOrCreateProgram("stars"),R=a.av.identity([]);a.av.rotateX(R,R,-I._pitch),a.av.rotateZ(R,R,-I.angle),a.av.rotateX(R,R,a.ab(I._center.lat)),a.av.rotateY(R,R,-a.ab(I._center.lng));const L=a.ad.fromQuat(new Float32Array(16),R),U=a.ad.multiply([],I.starsProjMatrix,L),G=a.bC.fromMat4([],L),J=a.bC.invert([],G),Q=[0,1,0];a._.transformMat3(Q,Q,J),a._.scale(Q,Q,this.params.sizeMultiplier);const le=[1,0,0];a._.transformMat3(le,le,J),a._.scale(le,le,this.params.sizeMultiplier);const de=(ge=Q,xe=le,Ke=m,{u_matrix:Float32Array.from(U),u_up:ge,u_right:xe,u_intensity_multiplier:Ke});var ge,xe,Ke;r.uploadCommonUniforms(b,M),this.starsVx&&this.starsIdx&&M.draw(r,w.TRIANGLES,a.ae.disabled,a.ag.disabled,this.colorModeAlphaBlendedWriteRGB,a.af.disabled,de,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Go(p,r){const u=[...p],m=r.cameraWorldSizeForFog/r.worldSize,b=a.ad.identity([]);return a.ad.scale(b,b,[m,m,1]),a.ad.multiply(u,b,u),a.ad.multiply(u,r.worldToFogMatrix,u),u}function na(p,r,u,m,b){const w=u.material,I=m.context,{baseColorTexture:M,metallicRoughnessTexture:R}=w.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:U,emissionTexture:G}=w;function J(Q,le,de){if(Q&&(p.push(le),I.activeTexture.set(I.gl.TEXTURE0+de),Q.gfxTexture)){const{minFilter:ge,magFilter:xe,wrapS:Ke,wrapT:Qe}=Q.sampler;Q.gfxTexture.bindExtraParam(ge,xe,Ke,Qe)}}J(M,"HAS_TEXTURE_u_baseColorTexture",Wr.BaseColor),J(R,"HAS_TEXTURE_u_metallicRoughnessTexture",Wr.MetallicRoughness),J(L,"HAS_TEXTURE_u_normalTexture",Wr.Normal),J(U,"HAS_TEXTURE_u_occlusionTexture",Wr.Occlusion),J(G,"HAS_TEXTURE_u_emissionTexture",Wr.Emission),b&&(b.texture||(b.texture=new a.ch(m.context,b.image,[b.image.height,b.image.height,b.image.height],I.gl.RGBA)),I.activeTexture.set(I.gl.TEXTURE0+Wr.LUT),b.texture&&b.texture.bind(I.gl.LINEAR,I.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),u.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(u.texcoordBuffer)),u.colorBuffer&&(p.push(12===u.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(u.colorBuffer)),u.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(u.normalBuffer)),u.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(u.pbrBuffer)),"OPAQUE"!==w.alphaMode&&"MASK"!==w.alphaMode||p.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||p.push("DIFFUSE_SHADED"),p.push("USE_STANDARD_DERIVATIVES")}function Is(p,r,u,m,b,w){const I=u.paint.get("model-opacity"),M=r.context,R=new a.ae(r.context.gl.LEQUAL,a.ae.ReadWrite,r.depthRangeFor3D),L=r.transform,U=p.mesh,G=U.material,J=G.pbrMetallicRoughness,Q=r.style.fog;let le;le="pixels"===r.transform.projection.zAxisUnit?[...p.nodeModelMatrix]:a.ad.multiply([],m.zScaleMatrix,p.nodeModelMatrix),a.ad.multiply(le,m.negCameraPosMatrix,le);const de=a.ad.invert([],le);a.ad.transpose(de,de);const ge=u.paint.get("model-emissive-strength").constantOr(0),xe=ac(new Float32Array(p.worldViewProjection),new Float32Array(le),new Float32Array(de),null,r,I,J.baseColorFactor.toRenderColor(null),G.emissiveFactor,J.metallicFactor,J.roughnessFactor,G,ge,u),Ke={defines:[]},Qe=[];na(Ke.defines,Qe,U,r,u.lut);const et=r.shadowRenderer;et&&(et.useNormalOffset=!1);let yt=null;if(Q){const Ee=Go(p.nodeModelMatrix,r.transform);if(yt=new Float32Array(Ee),"globe"!==L.projection.name){const tt=U.aabb.min,Lt=U.aabb.max,[sn,zt]=Q.getOpacityForBounds(Ee,tt[0],tt[1],Lt[0],Lt[1]);Ke.overrideFog=sn>=vn||zt>=vn}}const _t=ea(r,u.paint.get("model-cutoff-fade-range"));_t.shouldRenderCutoff&&Ke.defines.push("RENDER_CUTOFF");const St=r.getOrCreateProgram("model",Ke);r.uploadCommonUniforms(M,St,null,yt,_t),"shadow"!==r.renderPass&&et&&et.setupShadowsFromMatrix(p.nodeModelMatrix,St),St.draw(r,M.gl.TRIANGLES,R,b,w,U.material.doubleSided?a.af.disabled:a.af.backCCW,xe,u.id,U.vertexBuffer,U.indexBuffer,U.segments,u.paint,r.transform.zoom,void 0,Qe)}function Oa(p,r,u,m,b,w,I){let M;M="globe"===p.projection.name?a.ci(u,p):[...u],a.ad.multiply(M,M,r.matrix);const R=a.ad.multiply([],m,M);if(r.meshes)for(const L of r.meshes){if("BLEND"!==L.material.alphaMode){I.push({mesh:L,depth:0,modelIndex:b,worldViewProjection:R,nodeModelMatrix:M});continue}const U=a._.transformMat4([],L.centroid,R);U[2]>0&&w.push({mesh:L,depth:U[2],modelIndex:b,worldViewProjection:R,nodeModelMatrix:M})}if(r.children)for(const L of r.children)Oa(p,L,u,m,b,w,I)}function Yo(p,r,u,m){const b=u.shadowRenderer;if(!b)return;const w=b.getShadowPassDepthMode(),I=b.getShadowPassColorMode(),M=b.calculateShadowPassMatrixFromMatrix(r),R=Pa(M);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,w,a.ag.disabled,I,a.af.backCCW,R,m.id,p.vertexBuffer,p.indexBuffer,p.segments,m.paint,u.transform.zoom,void 0,void 0)}function ds(p,r,u){const m=r.updateZoomBasedPaintProperties(),b=function(w,I,M){let R,L,U,G=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&G>0){const J=w.terrain,Q=J.findDEMTileFor(M);Q&&Q.dem?R=a.ck.create(J,M,Q):G=0}if(0===G&&(I.terrainElevationMin=0,I.terrainElevationMax=0),G===I.validForExaggeration&&(0===G||R&&R._demTile&&R._demTile.tileID===I.validForDEMTile.id&&R._dem._timestamp===I.validForDEMTile.timestamp))return!1;for(const J in I.instancesPerModel){const Q=I.instancesPerModel[J];for(let le=0;le<Q.instancedDataArray.length;++le){const de=(R?G*R.getElevationAt(0|Q.instancedDataArray.float32[16*le],0|Q.instancedDataArray.float32[16*le+1],!0,!0):0)+Q.instancesEvaluatedElevation[le];Q.instancedDataArray.float32[16*le+6]=de,L=L?Math.min(I.terrainElevationMin,de):de,U=U?Math.max(I.terrainElevationMax,de):de}}return I.terrainElevationMin=L||0,I.terrainElevationMax=U||0,I.validForExaggeration=G,I.validForDEMTile=R&&R._demTile?{id:R._demTile.tileID,timestamp:R._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,r,u);(m||b)&&(r.uploaded=!1,r.upload(p.context))}const Ds={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.b6([0,0,0],[a.a3,a.a3,0])};function ts(p,r){const u=1<<p.canonical.z,m=r.getFreeCameraOptions().position,b=r.elevation,w=p.canonical.x/u,I=(p.canonical.x+1)/u,M=p.canonical.y/u,R=(p.canonical.y+1)/u;let L=r._centerAltitude;if(b){const Q=b.getMinMaxForTile(p);Q&&Q.max>L&&(L=Q.max)}const U=a.at(m.x,w,I)-m.x,G=a.at(m.y,M,R)-m.y,J=a.ax(L,r.center.lat)-m.z;return r._zoomFromMercatorZ(Math.sqrt(U*U+G*G+J*J))}function Jo(p,r,u,m,b,w,I){const M=p.context,R="shadow"===p.renderPass,L=p.shadowRenderer,U=R&&L?L.getShadowPassDepthMode():new a.ae(M.gl.LEQUAL,a.ae.ReadWrite,p.depthRangeFor3D),G=p.isTileAffectedByFog(w);if(u.meshes)for(const J of u.meshes){const Q=["MODEL_POSITION_ON_GPU"],le=[];let de,ge,xe;m.instancedDataArray.length>20&&Q.push("INSTANCED_ARRAYS");const Ke=ea(p,r.paint.get("model-cutoff-fade-range"));if(Ke.shouldRenderCutoff&&Q.push("RENDER_CUTOFF"),R&&L)de=p.getOrCreateProgram("modelDepth",{defines:Q}),ge=Pa(I.shadowTileMatrix,I.shadowTileMatrix,Float32Array.from(u.matrix)),xe=L.getShadowPassColorMode();else{na(Q,le,J,p,r.lut),de=p.getOrCreateProgram("model",{defines:Q,overrideFog:G});const et=J.material,yt=et.pbrMetallicRoughness,_t=r.paint.get("model-opacity"),St=r.paint.get("model-emissive-strength").constantOr(0);ge=ac(w.expandedProjMatrix,Float32Array.from(u.matrix),new Float32Array(16),null,p,_t,yt.baseColorFactor.toRenderColor(null),et.emissiveFactor,yt.metallicFactor,yt.roughnessFactor,et,St,r,b),L&&(I.shadowUniformsInitialized?de.setShadowUniformValues(M,L.getShadowUniformValues()):(L.setupShadows(w.toUnwrapped(),de,"model-tile",w.overscaledZ),I.shadowUniformsInitialized=!0)),xe=Ke.shouldRenderCutoff||_t<1||"OPAQUE"!==et.alphaMode?a.a.alphaBlended:a.a.unblended}p.uploadCommonUniforms(M,de,w.toUnwrapped(),null,Ke);const Qe=J.material.doubleSided?a.af.disabled:a.af.backCCW;if(m.instancedDataArray.length>20)le.push(m.instancedDataBuffer),de.draw(p,M.gl.TRIANGLES,U,a.ag.disabled,xe,Qe,ge,r.id,J.vertexBuffer,J.indexBuffer,J.segments,r.paint,p.transform.zoom,void 0,le,m.instancedDataArray.length);else{const et=R?"u_instance":"u_normal_matrix";for(let yt=0;yt<m.instancedDataArray.length;++yt)ge[et]=new Float32Array(m.instancedDataArray.arrayBuffer,64*yt,16),de.draw(p,M.gl.TRIANGLES,U,a.ag.disabled,xe,Qe,ge,r.id,J.vertexBuffer,J.indexBuffer,J.segments,r.paint,p.transform.zoom,void 0,le)}}if(u.children)for(const J of u.children)Jo(p,r,J,m,b,w,I)}const Gs=[1,-1,1];function Ja(p,r,u,m){if(!u.modelManager)return!0;const b=u.modelManager;if(!u.shadowRenderer)return!0;const w=u.shadowRenderer,I=r.aabb;let M=!0,R=p.maxHeight;if(0===R){let U=0;for(const G in p.instancesPerModel){const J=b.getModel(G,m);J?U=Math.max(U,Math.max(Math.max(J.aabb.max[0],J.aabb.max[1]),J.aabb.max[2])):M=!1}R=p.maxScale*U*1.41+p.maxVerticalOffset,M&&(p.maxHeight=R)}I.max[2]=R,I.min[2]+=p.terrainElevationMin,I.max[2]+=p.terrainElevationMax,a._.transformMat4(I.min,I.min,r.tileMatrix),a._.transformMat4(I.max,I.max,r.tileMatrix);const L=I.intersects(w.getCurrentCascadeFrustum());return 0===u.currentShadowCascade&&(p.isInsideFirstShadowMapFrustum=2===L),0===L}function Lo(p,r){const u=p.uniformValues.u_cutoff_params[0],m=p.uniformValues.u_cutoff_params[1],b=p.uniformValues.u_cutoff_params[2],w=p.uniformValues.u_cutoff_params[3];return m===u||w===b?1:a.at(((r-u)/(m-u)-b)/(w-b),0,1)}function uc(p,r,u,m){if(r.pitch<20)return 1;const b=r.getWorldToCameraMatrix(),w=a.ad.multiply([],b,p),I=[...u.min,1];let M=a.aA.transformMat4([],I,w),R=M,L=M;I[1]=u.max[1],M=a.aA.transformMat4([],I,w),R=M[1]<R[1]?M:R,L=M[1]>L[1]?M:L,I[0]=u.max[0],M=a.aA.transformMat4([],I,w),R=M[1]<R[1]?M:R,L=M[1]>L[1]?M:L,I[1]=u.min[1],M=a.aA.transformMat4([],I,w),R=M[1]<R[1]?M:R,L=M[1]>L[1]?M:L;const U=a.at(m[0],0,1),G=100*r.pixelsPerMeter*a.at(m[1],0,1),J=a.at(m[2],0,1),Q=a._.lerp([],R,L,U),le=Math.tan(.5*r.fovX),de=-Q[2]*le;if(0===G)return Q[1]<-Math.abs(de)?J:1;const ge=(-Math.abs(de)-Q[1])/G,xe=(Qe,et,yt)=>(1-yt)*Qe+yt*et,Ke=a.at(xe(1,J,ge),J,1);return xe(1,Ke,a.at((r.pitch-20)/20,0,1))}class La{}class Pc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,u,m){{const G=this._storage.get(u.id);if(G)return G.lastUsedFrameIdx=r,G.buf}const b=m.gl,w=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),I=new ArrayBuffer(w),M=new Int16Array(I);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(I));const R=new a.cm;for(let G=0;G<w/2;G+=3){const J=M[G],Q=M[G+1],le=M[G+2];R.emplaceBack(J,Q),R.emplaceBack(Q,le),R.emplaceBack(le,J)}const L=m.bindVertexArrayOES.current,U=new La;return U.buf=new a.I(m,R),U.lastUsedFrameIdx=r,this._storage.set(u.id,U),m.bindVertexArrayOES.set(L),U.buf}update(r){for(const[u,m]of this._storage)r-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(u))}destroy(){for(const[r,u]of this._storage)u.buf.destroy(),this._storage.delete(r)}}const Rc=a.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class $l{constructor(r){const u=new a.cn,m=new a.bu;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1),m.emplaceBack(0,1,2),m.emplaceBack(0,2,3),this.segments=a.b.simpleSegment(0,0,u.length,m.length),this.vx=r.createVertexBuffer(u,Rc.members),this.idx=r.createIndexBuffer(m)}destroy(){this.vx.destroy(),this.idx.destroy()}}const Od={symbol:function(p,r,u,m,b){if("translucent"!==p.renderPass)return;const w=a.ag.disabled,I=p.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(L,U,G,J,Q,le,de){const ge=U.transform,xe="map"===Q,Ke="map"===le;for(const Qe of L){const et=J.getTile(Qe),yt=et.getBucket(G);if(!yt||!yt.text||!yt.text.segments.get().length)continue;const _t=a.aD(yt.textSizeData,ge.zoom),St=Ac(Qe,yt.getProjection(),ge),Ee=ge.calculatePixelsToTileUnitsMatrix(et),tt=Ut(St,et.tileID.canonical,Ke,xe,ge,yt.getProjection(),Ee),Lt=yt.hasIconTextFit()&&yt.hasIconData();if(_t){const sn=Math.pow(2,ge.zoom-et.tileID.overscaledZ);Uu(yt,xe,Ke,de,a.bO,ge,tt,Qe,sn,_t,Lt)}}}(m,p,u,r,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),b);const M=0!==u.paint.get("icon-opacity").constantOr(1),R=0!==u.paint.get("text-opacity").constantOr(1);void 0!==u.layout.get("symbol-sort-key").constantOr(1)&&(M||R)?su(p,r,u,m,w,I):(M&&su(p,r,u,m,w,I,{onlyIcons:!0}),R&&su(p,r,u,m,w,I,{onlyText:!0}),function(L,U,G,J){if(!L.symbolParams.useOcclusionQueries)return;const Q=L.context.gl,le=L.transform,de=G.paint,ge=de.get("icon-occlusion-opacity").constantOr(0),xe=de.get("text-occlusion-opacity").constantOr(0);if(!G.hasInitialOcclusionOpacityProperties||1===ge&&1===xe)return;const Ke="globe"===le.projection.name;for(const Qe of J){const et=U.getTile(Qe),yt=et.getBucket(G);if(!yt||"mercator"===yt.projection.name&&Ke||yt.fullyClipped)continue;if("globe"===yt.projection.name){a.w(`Occlusion not supported for globe mode. Layer: ${G.type}`);continue}const _t=Ac(Qe,yt.getProjection(),le),St=a.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,L.symbolParams.depthOffset,1),Ee=a.ad.multiply([],St,_t),tt="none"!==L.symbolParams.visualizeOcclusions?1:L.symbolParams.occlusionQueryFrameWindow;for(let Lt=0;Lt<yt.symbolInstances.length;Lt++){const sn=yt.symbolInstances.get(Lt),zt=L.style.placement.opacities[sn.crossTileID];if(zt&&zt.isHidden()||(L.frameCounter+Lt)%tt!=0)continue;const It=sn.tileAnchorX,hn=sn.tileAnchorY,Gn=sn.zOffset;let Xn;if("none"===L.symbolParams.visualizeOcclusions){const yi=yt.queries.get(Lt);if(yi){if(!yi.isFree()){if(!yi.isResultAvailable())continue;const bi=yi.consumeResult();sn.occlusionState=0===bi?0:1;continue}Xn=yi}else Xn=new mo(L.context),yt.queries.set(Lt,Xn)}const Vn=L.getOrCreateProgram("occlusion"),Xt=L.symbolParams.occluderSize,mn=Ad(Ee,[It,hn,Gn],[le.width,le.height],[Xt,Xt],"zPass"===L.symbolParams.visualizeOcclusions?[1,0,0,.8]:[1,.4,.2,.9]);L.terrain&&L.terrain.setupElevationDraw(et,Vn,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),"none"===L.symbolParams.visualizeOcclusions&&Xn&&Xn.begin();const Pn=new a.ae("zPass"===L.symbolParams.visualizeOcclusions?L.context.gl.ALWAYS:L.context.gl.LEQUAL,a.ae.ReadOnly,L.depthRangeFor3D);Vn.draw(L,Q.TRIANGLES,Pn,a.ag.disabled,"none"!==L.symbolParams.visualizeOcclusions?a.a.alphaBlendedNonPremultiplied:a.a.disabled,a.af.disabled,mn,"occlusion",L.occlusionBuffers.vx,L.occlusionBuffers.idx,L.occlusionBuffers.segments),"none"===L.symbolParams.visualizeOcclusions&&Xn&&Xn.end()}}}(p,r,u,m)),r.map.showCollisionBoxes&&(_f(p,r,u,m,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),_f(p,r,u,m,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(p,r,u,m){if("translucent"!==p.renderPass)return;const b=u.paint.get("circle-opacity"),w=u.paint.get("circle-stroke-width"),I=u.paint.get("circle-stroke-opacity"),M=void 0!==u.layout.get("circle-sort-key").constantOr(1),R=u.paint.get("circle-emissive-strength");if(0===b.constantOr(1)&&(0===w.constantOr(1)||0===I.constantOr(1)))return;const L=p.context,U=L.gl,G=p.transform,J=p.depthModeForSublayer(0,a.ae.ReadOnly),Q=a.ag.disabled,le=p.colorModeForDrapableLayerRenderPass(R),de="globe"===G.projection.name,ge=[a.aj(G.center.lng),a.ak(G.center.lat)],xe=[];for(let Qe=0;Qe<m.length;Qe++){const et=m[Qe],yt=r.getTile(et),_t=yt.getBucket(u);if(!_t||_t.projection.name!==G.projection.name)continue;const St=_t.programConfigurations.get(u.id),Ee=a.bR(u),tt=p.isTileAffectedByFog(et);de&&Ee.push("PROJECTION_GLOBE_VIEW"),Ee.push("TERRAIN_DEPTH_D24");const Lt=p.getOrCreateProgram("circle",{config:St,defines:Ee,overrideFog:tt}),sn=_t.layoutVertexBuffer,zt=_t.globeExtVertexBuffer,It=_t.indexBuffer,hn=G.projection.createInversionMatrix(G,et.canonical),Gn={programConfiguration:St,program:Lt,layoutVertexBuffer:sn,globeExtVertexBuffer:zt,indexBuffer:It,uniformValues:a.bS(p,et,yt,hn,ge,u),tile:yt};if(M){const Xn=_t.segments.get();for(const Vn of Xn)xe.push({segments:new a.b([Vn]),sortKey:Vn.sortKey,state:Gn})}else xe.push({segments:_t.segments,sortKey:0,state:Gn})}M&&xe.sort((Qe,et)=>Qe.sortKey-et.sortKey);const Ke={useDepthForOcclusion:G.depthOcclusionForSymbolsAndCircles};for(const Qe of xe){const{programConfiguration:et,program:yt,layoutVertexBuffer:_t,globeExtVertexBuffer:St,indexBuffer:Ee,uniformValues:tt,tile:Lt}=Qe.state,sn=Qe.segments;p.terrain&&p.terrain.setupElevationDraw(Lt,yt,Ke),p.uploadCommonUniforms(L,yt,Lt.tileID.toUnwrapped()),yt.draw(p,U.TRIANGLES,J,Q,le,a.af.disabled,tt,u.id,_t,Ee,sn,u.paint,G.zoom,et,[St])}},heatmap:function(p,r,u,m){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const b=p.context,w=b.gl,I=a.ag.disabled,M=new a.a([w.ONE,w.ONE,w.ONE,w.ONE],a.C.transparent,[!0,!0,!0,!0]);(function(Q,le,de,ge){const xe=Q.gl,Ke=le.width*ge,Qe=le.height*ge;Q.activeTexture.set(xe.TEXTURE1),Q.viewport.set([0,0,Ke,Qe]);let et=de.heatmapFbo;if(!et||et&&(et.width!==Ke||et.height!==Qe)){et&&et.destroy();const yt=xe.createTexture();xe.bindTexture(xe.TEXTURE_2D,yt),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MAG_FILTER,xe.LINEAR),et=de.heatmapFbo=Q.createFramebuffer(Ke,Qe,!0,null),function(_t,St,Ee,tt,Lt,sn){const zt=_t.gl;zt.texImage2D(zt.TEXTURE_2D,0,_t.extRenderToTextureHalfFloat?zt.RGBA16F:zt.RGBA,Lt,sn,0,zt.RGBA,_t.extRenderToTextureHalfFloat?zt.HALF_FLOAT:zt.UNSIGNED_BYTE,null),tt.colorAttachment.set(Ee)}(Q,0,yt,et,Ke,Qe)}else xe.bindTexture(xe.TEXTURE_2D,et.colorAttachment.get()),Q.bindFramebuffer.set(et.framebuffer)})(b,p,u,"globe"===p.transform.projection.name?.5:.25),b.clear({color:a.C.transparent});const R=p.transform,L="globe"===R.projection.name,U=L?["PROJECTION_GLOBE_VIEW"]:[],G=L?a.af.frontCCW:a.af.disabled,J=[a.aj(R.center.lng),a.ak(R.center.lat)];for(let Q=0;Q<m.length;Q++){const le=m[Q];if(r.hasRenderableParent(le))continue;const de=r.getTile(le),ge=de.getBucket(u);if(!ge||ge.projection.name!==R.projection.name)continue;const xe=p.isTileAffectedByFog(le),Ke=ge.programConfigurations.get(u.id),Qe=p.getOrCreateProgram("heatmap",{config:Ke,defines:U,overrideFog:xe}),{zoom:et}=p.transform;p.terrain&&p.terrain.setupElevationDraw(de,Qe),p.uploadCommonUniforms(b,Qe,le.toUnwrapped());const yt=R.projection.createInversionMatrix(R,le.canonical);Qe.draw(p,w.TRIANGLES,a.ae.disabled,I,M,G,Dc(p,le,de,yt,J,et,u.paint.get("heatmap-intensity")),u.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,u.paint,p.transform.zoom,Ke,L?[ge.globeExtVertexBuffer]:null)}b.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(b,w){const I=b.context,M=I.gl,R=w.heatmapFbo;if(!R)return;I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,R.colorAttachment.get()),I.activeTexture.set(M.TEXTURE1);let L=w.colorRampTexture;L||(L=w.colorRampTexture=new a.T(I,w.colorRamp,M.RGBA)),L.bind(M.LINEAR,M.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,M.TRIANGLES,a.ae.disabled,a.ag.disabled,b.colorModeForRenderPass(),a.af.disabled,{u_image:0,u_color_ramp:1,u_opacity:w.paint.get("heatmap-opacity")},w.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,w.paint,b.transform.zoom)}(p,u))},line:function(p,r,u,m){if("translucent"!==p.renderPass)return;const b=u.paint.get("line-opacity"),w=u.paint.get("line-width");if(0===b.constantOr(1)||0===w.constantOr(1))return;const I=u.paint.get("line-emissive-strength"),M=u.paint.get("line-occlusion-opacity"),R=p.context,L=R.gl,U=u.layout.get("line-z-offset"),G=!U.isConstant()||!!U.constantOr(0),J=G?new a.ae(p.depthOcclusion?L.GREATER:L.LEQUAL,a.ae.ReadOnly,p.depthRangeFor3D):p.depthModeForSublayer(0,a.ae.ReadOnly),Q=p.colorModeForDrapableLayerRenderPass(I),le=p.terrain&&p.terrain.renderingToTexture,de=le?1:a.e.devicePixelRatio,ge=u.paint.get("line-dasharray"),xe=ge.constantOr(1),Ke=u.layout.get("line-cap"),Qe=ge.constantOr(null),et=Ke.constantOr(null),yt=u.paint.get("line-pattern"),_t=yt.constantOr(1),St=yt.constantOr(null),Ee=u.paint.get("line-opacity").constantOr(1);let tt=!_t&&1!==Ee||p.depthOcclusion&&M>0&&M<1;const Lt=u.paint.get("line-gradient"),sn=_t?"linePattern":"line",zt=a.bT(u);let It;if(le&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(tt=!1),0!==M&&p.depthOcclusion){const Gn=u.paint._values["line-opacity"];Gn&&Gn.value&&"constant"===Gn.value.kind?It=Gn.value:a.w(`Occlusion opacity for layer ${u.id} is supported only when line-opacity isn't data-driven.`)}if(G&&(p.forceTerrainMode=!0),!G&&0!==M&&p.terrain&&!le)return void a.w(`Occlusion opacity for layer ${u.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const hn=tt&&G?p.stencilModeFor3D():a.ag.disabled;for(const Gn of m){const Xn=r.getTile(Gn);if(_t&&!Xn.patternsLoaded())continue;const Vn=Xn.getBucket(u);if(!Vn)continue;p.prepareDrawTile();const Xt=Vn.programConfigurations.get(u.id),mn=p.isTileAffectedByFog(Gn),Pn=p.getOrCreateProgram(sn,{config:Xt,defines:G?[...zt,"ELEVATED"]:zt,overrideFog:mn});if(St&&Xn.imageAtlas){const In=Xn.imageAtlas.patternPositions[St.toString()];In&&Xt.setConstantPatternPositions(In)}if(!_t&&Qe&&et&&Xn.lineAtlas){const In=Xn.lineAtlas.getDash(Qe,et);In&&Xt.setConstantPatternPositions(In)}let[yi,bi]=u.paint.get("line-trim-offset");("round"===et||"square"===et)&&yi!==bi&&(0===yi&&(yi-=1),1===bi&&(bi+=1));const Mi=le?Gn.projMatrix:null,xi=_t?a.bU(p,Xn,u,Mi,de,[yi,bi]):a.bV(p,Xn,u,Mi,Vn.lineClipsArray.length,de,[yi,bi]);if(Lt){const In=Vn.gradients[u.id];let Li=In.texture;if(u.gradientVersion!==In.version){let Ir=256;if(u.stepInterpolant){const Ji=r.getSource().maxzoom,hr=Gn.canonical.z===Ji?Math.ceil(1<<p.transform.maxZoom-Gn.canonical.z):1;Ir=a.at(a.bW(Vn.maxLineLength/a.a3*1024*hr),256,R.maxTextureSize)}In.gradient=a.bX({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Ir,image:In.gradient||void 0,clips:Vn.lineClipsArray}),In.texture?In.texture.update(In.gradient):In.texture=new a.T(R,In.gradient,L.RGBA),In.version=u.gradientVersion,Li=In.texture}R.activeTexture.set(L.TEXTURE1),Li.bind(u.stepInterpolant?L.NEAREST:L.LINEAR,L.CLAMP_TO_EDGE)}xe&&(R.activeTexture.set(L.TEXTURE0),Xn.lineAtlasTexture&&Xn.lineAtlasTexture.bind(L.LINEAR,L.REPEAT),Xt.updatePaintBuffers()),_t&&(R.activeTexture.set(L.TEXTURE0),Xn.imageAtlasTexture&&Xn.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Xt.updatePaintBuffers()),G&&p.terrain.setupElevationDraw(Xn,Pn),p.uploadCommonUniforms(R,Pn,Gn.toUnwrapped());const di=In=>{null!=It&&(It.value=Ee*M),Pn.draw(p,L.TRIANGLES,J,In,Q,a.af.disabled,xi,u.id,Vn.layoutVertexBuffer,Vn.indexBuffer,Vn.segments,u.paint,p.transform.zoom,Xt,[Vn.layoutVertexBuffer2,Vn.patternVertexBuffer,Vn.zOffsetVertexBuffer]),null!=It&&(It.value=Ee)};if(tt&&!G){const In=p.stencilModeForClipping(Gn).ref;0===In&&le&&R.clear({stencil:0});const Li={func:L.EQUAL,mask:255};xi.u_alpha_discard_threshold=.8,di(new a.ag(Li,In,255,L.KEEP,L.KEEP,L.INVERT)),xi.u_alpha_discard_threshold=0,di(new a.ag(Li,In,255,L.KEEP,L.KEEP,L.KEEP))}else tt&&G&&(xi.u_alpha_discard_threshold=.001),di(G?hn:p.stencilModeForClipping(Gn))}tt&&(p.resetStencilClippingMasks(),le&&R.clear({stencil:0})),0===M||p.depthOcclusion||le||p.layersWithOcclusionOpacity.push(p.currentLayer),G&&(p.forceTerrainMode=!1)},fill:function(p,r,u,m){const b=u.paint.get("fill-color"),w=u.paint.get("fill-opacity");if(0===w.constantOr(1))return;const I=u.paint.get("fill-emissive-strength"),M=p.colorModeForDrapableLayerRenderPass(I),R=u.paint.get("fill-pattern"),L=p.opaquePassEnabledForLayer()&&!R.constantOr(1)&&1===b.constantOr(a.C.transparent).a&&1===w.constantOr(0)?"opaque":"translucent";if(p.renderPass===L){const U=p.depthModeForSublayer(1,"opaque"===p.renderPass?a.ae.ReadWrite:a.ae.ReadOnly);ul(p,r,u,m,U,M,!1)}if("translucent"===p.renderPass&&u.paint.get("fill-antialias")){const U=p.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,a.ae.ReadOnly);ul(p,r,u,m,U,M,!0)}},"fill-extrusion":function(p,r,u,m){const b=u.paint.get("fill-extrusion-opacity"),w=p.context,I=w.gl,M=p.terrain,R=M&&M.renderingToTexture;if(0===b)return;const L=p.conflationActive&&p.style.isLayerClipped(u,r.getSource()),U=p.style.order.indexOf(u.fqid);if(L&&function(G,J,Q,le,de){for(const ge of le){const xe=J.getTile(ge).getBucket(Q);xe&&(xe.updateReplacement(ge,G.replacementSource,de),xe.uploadCentroid(G.context))}}(p,r,u,m,U),M||L)for(const G of m){const J=r.getTile(G).getBucket(u);J&&So(p.context,r,G,J,u,M,L)}if("shadow"===p.renderPass&&p.shadowRenderer){const G=p.shadowRenderer;if(M&&b<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.Z)return;const J=G.getShadowPassDepthMode(),Q=G.getShadowPassColorMode();la(p,r,u,m,J,a.ag.disabled,Q,L)}else if("translucent"===p.renderPass){const G=!u.paint.get("fill-extrusion-pattern").constantOr(1),J=u.paint.get("fill-extrusion-color").constantOr(a.C.white);if(!R&&0!==J.a){const Q=new a.ae(p.context.gl.LEQUAL,a.ae.ReadWrite,p.depthRangeFor3D);1===b&&G?la(p,r,u,m,Q,a.ag.disabled,a.a.unblended,L):(la(p,r,u,m,Q,a.ag.disabled,a.a.disabled,L),la(p,r,u,m,Q,p.stencilModeFor3D(),p.colorModeForRenderPass(),L),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&G&&(!M&&"globe"!==p.transform.projection.name||R)){const Q=u.paint.get("fill-extrusion-opacity"),le=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),de=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ge=u.paint.get("fill-extrusion-flood-light-intensity"),xe=u.paint.get("fill-extrusion-flood-light-color").toRenderColor(u.lut).toArray01().slice(0,3),Ke=le>0&&de>0,Qe=ge>0,et=(_t,St,Ee)=>(1-Ee)*_t+Ee*St,yt=_t=>{const St=p.depthModeForSublayer(1,a.ae.ReadOnly,I.LEQUAL,!0),Ee=u.paint.get(_t?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),tt=et(.1,3,Ee),Lt=p._showOverdrawInspector;if(!Lt){const sn=new a.ag({func:I.ALWAYS,mask:255},255,255,I.KEEP,I.KEEP,I.REPLACE),zt=new a.a([I.ONE,I.ONE,I.ONE,I.ONE],a.C.transparent,[!1,!1,!1,!0],I.MIN);wr(p,r,u,m,St,sn,zt,a.af.disabled,_t,"sdf",Q,le,de,ge,xe,tt,L,!1)}{const sn=Lt?a.ag.disabled:new a.ag({func:I.EQUAL,mask:255},255,255,I.KEEP,I.DECR,I.DECR),zt=Lt?p.colorModeForRenderPass():new a.a([I.ONE_MINUS_DST_ALPHA,I.DST_ALPHA,I.ONE,I.ONE],a.C.transparent,[!0,!0,!0,!0]);wr(p,r,u,m,St,sn,zt,a.af.disabled,_t,"color",Q,le,de,ge,xe,tt,L,!1)}};if(R){const _t=(St,Ee,tt)=>{const Lt=p.depthModeForSublayer(1,a.ae.ReadOnly,I.LEQUAL,!1),sn=u.paint.get(St?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),zt=et(.1,3,sn);{const It=new a.a([I.ONE,I.ONE,I.ONE,I.ONE],a.C.transparent,[!1,!1,!1,!0]);wr(p,r,u,m,Lt,a.ag.disabled,It,a.af.disabled,St,"clear",Q,le,de,ge,xe,zt,L,Ee)}{const It=new a.ag({func:I.ALWAYS,mask:255},255,255,I.KEEP,I.KEEP,I.REPLACE),hn=new a.a([I.ONE,I.ONE,I.ONE,I.ONE],a.C.transparent,[!1,!1,!1,!0],I.MIN);wr(p,r,u,m,Lt,It,hn,a.af.disabled,St,"sdf",Q,le,de,ge,xe,zt,L,Ee)}{const It=St?I.ZERO:I.ONE_MINUS_DST_ALPHA,hn=new a.ag({func:I.EQUAL,mask:255},255,255,I.KEEP,I.DECR,I.DECR),Gn=new a.a([It,I.DST_ALPHA,I.ONE_MINUS_DST_ALPHA,I.ZERO],a.C.transparent,[!0,!0,!0,!0]);wr(p,r,u,m,Lt,hn,Gn,a.af.disabled,St,"color",Q,le,de,ge,xe,zt,L,Ee)}{const It=new a.a([I.ONE,I.ONE,I.ONE,St?I.ZERO:I.ONE],a.C.transparent,[!1,!1,!1,!0],St?I.FUNC_ADD:I.MAX);wr(p,r,u,m,Lt,a.ag.disabled,It,a.af.disabled,St,"clear",Q,le,de,ge,xe,zt,L,Ee,tt)}};if(Ke||Qe){let St;if(p.prepareDrawTile(),M){const Ee=M.drapeBufferSize[0],tt=M.drapeBufferSize[1];St=M.framebufferCopyTexture,St&&(!St||St.size[0]===Ee&&St.size[1]===tt)||(St&&St.destroy(),St=M.framebufferCopyTexture=new a.T(w,new a.i({width:Ee,height:tt}),I.RGBA)),St.bind(I.LINEAR,I.CLAMP_TO_EDGE),I.copyTexImage2D(I.TEXTURE_2D,0,I.RGBA,0,0,Ee,tt,0)}Ke&&_t(!0,!1,St),Qe&&_t(!1,!0,St)}}else Ke&&yt(!0),Qe&&yt(!1)}}},hillshade:function(p,r,u,m){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass||p.style.disableElevatedTerrain)return;const b=p.context,w=p.terrain&&p.terrain.renderingToTexture,[I,M]="translucent"!==p.renderPass||w?[{},m]:p.stencilConfigForOverlap(m);for(const R of M){const L=r.getTile(R);if(L.needsHillshadePrepare&&"offscreen"===p.renderPass)Vs(p,L,u);else if("translucent"===p.renderPass){const U=p.depthModeForSublayer(0,a.ae.ReadOnly),G=u.paint.get("hillshade-emissive-strength"),J=p.colorModeForDrapableLayerRenderPass(G),Q=w&&p.terrain?p.terrain.stencilModeForRTTOverlap(R):I[R.overscaledZ];Wa(p,R,L,u,U,Q,J)}}b.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,r,u,m,b,w){if("translucent"!==p.renderPass||0===u.paint.get("raster-opacity"))return;const I="globe"===p.transform.projection.name,M=0!==u.paint.get("raster-elevation"),R=M&&I;if(p.renderElevatedRasterBackface&&!R)return;const L=p.context,U=L.gl,G=r.getSource(),J=function(_t,St,Ee,tt){const Lt=St.paint.get("raster-color"),sn="raster-array"===_t.type,zt=[],It=St.paint.get("raster-resampling"),hn=St.paint.get("raster-color-mix");let Gn=St.paint.get("raster-color-range");const Xn=[hn[0],hn[1],hn[2],0],Vn=hn[3];let Xt="nearest"===It?tt.NEAREST:tt.LINEAR;if(sn&&(zt.push("RASTER_ARRAY"),Lt||zt.push("RASTER_COLOR"),"linear"===It&&zt.push("RASTER_ARRAY_LINEAR"),Xt=tt.NEAREST,!Gn&&_t.rasterLayers)){const mn=_t.rasterLayers.find(({id:Pn})=>Pn===St.sourceLayer);mn&&mn.fields&&mn.fields.range&&(Gn=mn.fields.range)}if(Gn=Gn||[0,1],Lt){zt.push("RASTER_COLOR"),Ee.activeTexture.set(tt.TEXTURE2),St.updateColorRamp(Gn);let mn=St.colorRampTexture;mn||(mn=St.colorRampTexture=new a.T(Ee,St.colorRamp,tt.RGBA)),mn.bind(tt.LINEAR,tt.CLAMP_TO_EDGE)}return{mix:Xn,range:Gn,offset:Vn,defines:zt,resampling:Xt}}(G,u,L,U);if(G instanceof a.bm&&!m.length&&!I)return;const Q=u.paint.get("raster-emissive-strength"),le=p.colorModeForDrapableLayerRenderPass(Q),de=p.terrain&&p.terrain.renderingToTexture,ge=!p.options.moving,xe="nearest"===u.paint.get("raster-resampling")?U.NEAREST:U.LINEAR;if(G instanceof a.bm&&!m.length&&(G.onNorthPole||G.onSouthPole)){const _t=M?p.stencilModeFor3D():a.ag.disabled;return void Vl(!!G.onNorthPole,null,p,r,u,Q,J,a.af.disabled,_t)}if(!m.length)return;const[Ke,Qe]=G instanceof a.bm||de?[{},m]:p.stencilConfigForOverlap(m),et=Qe[Qe.length-1].overscaledZ;R&&J.defines.push("PROJECTION_GLOBE_VIEW"),M&&J.defines.push("RENDER_CUTOFF");const yt=(_t,St,Ee)=>{for(const tt of _t){const Lt=tt.toUnwrapped(),sn=r.getTile(tt);if(de&&(!sn||!sn.hasData()))continue;L.activeTexture.set(U.TEXTURE0);const zt=Br(sn,G,u,J);if(!zt||!zt.texture)continue;const{texture:It,mix:hn,offset:Gn,tileSize:Xn,buffer:Vn}=zt;let Xt,mn;de?(Xt=a.ae.disabled,mn=tt.projMatrix):M?(Xt=new a.ae(U.LEQUAL,a.ae.ReadWrite,p.depthRangeFor3D),mn=I?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(Lt,ge)):(Xt=p.depthModeForSublayer(tt.overscaledZ-et,1===u.paint.get("raster-opacity")?a.ae.ReadWrite:a.ae.ReadOnly,U.LESS),mn=p.transform.calculateProjMatrix(Lt,ge));const Pn=p.terrain&&de?p.terrain.stencilModeForRTTOverlap(tt):Ke[tt.overscaledZ],yi=w?0:u.paint.get("raster-fade-duration");sn.registerFadeDuration(yi);const bi=r.findLoadedParent(tt,0),Mi=al(sn,bi,r,p.transform,yi);let xi,di;p.terrain&&p.terrain.prepareDrawTile(),L.activeTexture.set(U.TEXTURE0),It.bind(xe,U.CLAMP_TO_EDGE),L.activeTexture.set(U.TEXTURE1),bi?(bi.texture&&bi.texture.bind(xe,U.CLAMP_TO_EDGE),xi=Math.pow(2,bi.tileID.overscaledZ-sn.tileID.overscaledZ),di=[sn.tileID.canonical.x*xi%1,sn.tileID.canonical.y*xi%1]):It.bind(xe,U.CLAMP_TO_EDGE),It.useMipmap&&L.extTextureFilterAnisotropic&&p.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const In=p.transform;let Li;const Ir=M?qr(In):[0,0,0,0];let Ji,hr,Fr,fr,Rr,rr=0;if(R&&G instanceof a.bm&&G.coordinates.length>3)Ji=Float32Array.from(a.bf(a.bg(new a.aO(0,0,0)))),hr=Float32Array.from(In.globeMatrix),Fr=Float32Array.from(a.bb(In)),fr=[a.aj(In.center.lng),a.ak(In.center.lat)],Li=G.elevatedGlobePerspectiveTransform,Rr=G.elevatedGlobeGridMatrix||new Float32Array(9);else if(R){const cr=a.bc(tt.canonical);rr=a.bd(cr.getCenter().lat),Ji=Float32Array.from(a.bf(a.bg(tt.canonical))),hr=Float32Array.from(In.globeMatrix),Fr=Float32Array.from(a.bb(In)),fr=[a.aj(In.center.lng),a.ak(In.center.lat)],Li=[0,0],Rr=Float32Array.from(a.be(tt.canonical,cr,rr,In.worldSize/In._pixelsPerMercatorPixel))}else Li=G instanceof a.bm?G.perspectiveTransform:[0,0],Ji=new Float32Array(16),hr=new Float32Array(9),Fr=new Float32Array(16),fr=[0,0],Rr=new Float32Array(9);const Ur=nu(mn,Ji,hr,Fr,Rr,di||[0,0],a.a1(p.transform.zoom),fr,Ir,xi||1,Mi,u,Li,M?u.paint.get("raster-elevation"):0,2,hn,Gn,J.range,Xn,Vn,Q),po=p.isTileAffectedByFog(tt),Pr=p.getOrCreateProgram("raster",{defines:J.defines,overrideFog:po});if(p.uploadCommonUniforms(L,Pr,Lt),G instanceof a.bm){const cr=G.elevatedGlobeVertexBuffer,Kr=G.elevatedGlobeIndexBuffer;if(de||!I)G.boundsBuffer&&G.boundsSegments&&Pr.draw(p,U.TRIANGLES,Xt,a.ag.disabled,le,a.af.disabled,Ur,u.id,G.boundsBuffer,p.quadTriangleIndexBuffer,G.boundsSegments);else if(cr&&Kr){const ps=In.zoom<=a.b1?G.elevatedGlobeSegments:G.getSegmentsForLongitude(In.center.lng);ps&&Pr.draw(p,U.TRIANGLES,Xt,a.ag.disabled,le,St,Ur,u.id,cr,Kr,ps)}}else if(R){Xt=new a.ae(U.LEQUAL,a.ae.ReadOnly,p.depthRangeFor3D);const cr=p.globeSharedBuffers;if(cr){const[Kr,ps,xo]=cr.getGridBuffers(rr,!1);Pr.draw(p,U.TRIANGLES,Xt,Ee||Pn,p.colorModeForRenderPass(),St,Ur,u.id,Kr,ps,xo)}}else{const{tileBoundsBuffer:cr,tileBoundsIndexBuffer:Kr,tileBoundsSegments:ps}=p.getTileBoundsBuffers(sn);Pr.draw(p,U.TRIANGLES,Xt,Pn,le,a.af.disabled,Ur,u.id,cr,Kr,ps)}}if(!(G instanceof a.bm)&&R)for(const tt of _t){const Lt=tt.canonical.y===(1<<tt.canonical.z)-1;0===tt.canonical.y&&Vl(!0,tt,p,r,u,Q,J,St,Ee||a.ag.disabled),Lt&&Vl(!1,tt,p,r,u,Q,J,St===a.af.frontCW?a.af.backCW:a.af.frontCW,Ee||a.ag.disabled)}};R?yt(Qe,p.renderElevatedRasterBackface?a.af.backCW:a.af.frontCW,p.stencilModeFor3D()):yt(Qe,a.af.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,r,u,m,b,w){"offscreen"===p.renderPass&&function(I,M,R,L){if(!L.length)return;const U=I.context,G=U.gl,J=M.getSource();if(!(J instanceof Bl))return;const Q=Math.ceil(Math.sqrt(R.paint.get("raster-particle-count")));let le=R.particlePositionRGBAImage;if(!le||le.width!==Q){const Qe=function(et){const yt=et*et,_t=new Uint8Array(4*yt),St=function(tt){return tt|=0,tt=Math.imul(2747636419^tt,2654435769),tt=Math.imul(tt^tt>>>16,2654435769),((tt=Math.imul(tt^tt>>>16,2654435769))>>>0)/4294967296},Ee=1/1.1;for(let tt=0;tt<yt;tt++){const Lt=Ee*(St(2*tt+0)+va),sn=Ee*(St(2*tt+1)+va),zt=255*Lt%1,It=255*sn%1,hn=zt,Gn=sn-It/255,Xn=It;_t[4*tt+0]=255*(Lt-zt/255),_t[4*tt+1]=255*hn,_t[4*tt+2]=255*Gn,_t[4*tt+3]=255*Xn}return _t}(Q);le=R.particlePositionRGBAImage=new a.i({width:Q,height:Q},Qe)}let de=R.particleFramebuffer;de?de.width!==Q&&(de.destroy(),de=R.particleFramebuffer=U.createFramebuffer(Q,Q,!0,null)):de=R.particleFramebuffer=U.createFramebuffer(Q,Q,!0,null);const ge=[];for(const Qe of L){const et=M.getTile(Qe);if(!(et instanceof a.c3))continue;const yt=xh(et,J,R);if(!yt)continue;const _t=[et.tileSize,et.tileSize];let St=R.tileFramebuffer;St||(St=R.tileFramebuffer=U.createFramebuffer(_t[0],_t[1],!0,null));let Ee=et.rasterParticleState;Ee||(Ee=et.rasterParticleState=new $n(U,Qe,_t,le));const tt=Ee.update(R.lastInvalidatedAt);Ee.particleTextureDimension!==Q&&Ee.updateParticleTexture(Qe,le);const Lt=Ee.targetColorTexture;Ee.targetColorTexture=Ee.backgroundColorTexture,Ee.backgroundColorTexture=Lt;const sn=Ee.particleTexture0;Ee.particleTexture0=Ee.particleTexture1,Ee.particleTexture1=sn,ge.push([Qe,yt,Ee,tt])}if(0===ge.length)return;const xe=a.e.now(),Ke=R.previousDrawTimestamp?.001*(xe-R.previousDrawTimestamp):.0167;if(R.previousDrawTimestamp=xe,R.hasColorMap()){U.activeTexture.set(G.TEXTURE0+2);let Qe=R.colorRampTexture;Qe||(Qe=R.colorRampTexture=new a.T(U,R.colorRamp,G.RGBA)),Qe.bind(G.LINEAR,G.CLAMP_TO_EDGE)}U.bindFramebuffer.set(R.tileFramebuffer.framebuffer),function(Qe,et,yt){const _t=Qe.context,St=_t.gl,Ee=et.tileFramebuffer;_t.activeTexture.set(St.TEXTURE0);const tt={u_texture:0,u_opacity:1.05*(sn=et.paint.get("raster-particle-fade-opacity-factor"))/(sn+.05)},Lt=Qe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var sn;for(const zt of yt){const[,,It,hn]=zt;Ee.colorAttachment.set(It.targetColorTexture.texture),_t.viewport.set([0,0,Ee.width,Ee.height]),_t.clear({color:a.C.transparent}),hn&&(It.backgroundColorTexture.bind(St.NEAREST,St.CLAMP_TO_EDGE),Lt.draw(Qe,St.TRIANGLES,a.ae.disabled,a.ag.disabled,a.a.alphaBlended,a.af.disabled,tt,et.id,Qe.viewportBuffer,Qe.quadTriangleIndexBuffer,Qe.viewportSegments))}}(I,R,ge),function(Qe,et,yt,_t){const St=Qe.context,Ee=St.gl,tt=yt.tileFramebuffer,Lt="globe"===Qe.transform.projection.name,sn=yt.paint.get("raster-particle-max-speed");for(const zt of _t){const[It,hn,Gn]=zt;St.activeTexture.set(Ee.TEXTURE0+0),hn.texture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),tt.colorAttachment.set(Gn.targetColorTexture.texture);const Xn=Qe.getOrCreateProgram("rasterParticleDraw",{defines:hn.defines,overrideFog:!1});St.activeTexture.set(Ee.TEXTURE0+1);const Vn=hn.scalarData?[]:[0,1,2,3].map(Pn=>a.bZ[Pn](It));Vn.push(It);const Xt=It.canonical.x,mn=It.canonical.y;for(const Pn of Vn){const yi=et.getTile(Lt?Pn.wrapped():Pn);if(!yi)continue;const bi=yi.rasterParticleState;if(!bi)continue;const Mi=Pn.canonical.x+(1<<Pn.canonical.z)*(Pn.wrap-It.wrap),xi=Pn.canonical.y;bi.particleTexture0.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE);const di=El(1,bi.particleTexture0.size[0],[Mi-Xt,xi-mn],0,hn.texture.size,2,sn,hn.textureOffset,hn.scale,hn.offset);Xn.draw(Qe,Ee.POINTS,a.ae.disabled,a.ag.disabled,a.a.alphaBlended,a.af.disabled,di,yt.id,bi.particleIndexBuffer,void 0,bi.particleSegment)}}}(I,M,R,ge),U.bindFramebuffer.set(R.particleFramebuffer.framebuffer),function(Qe,et,yt,_t){const St=Qe.context,Ee=St.gl,tt=et.paint.get("raster-particle-max-speed"),Lt=_t*et.paint.get("raster-particle-speed-factor")*.15,sn=(It=.01+1*et.paint.get("raster-particle-reset-rate-factor"),Math.pow(It,6)),zt=et.particleFramebuffer;var It;St.viewport.set([0,0,zt.width,zt.height]);for(const It of yt){const[,hn,Gn]=It;St.activeTexture.set(Ee.TEXTURE0+0),hn.texture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),St.activeTexture.set(Ee.TEXTURE0+1);const Xn=Gn.particleTexture0;Xn.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE);const Vn=ll(1,Xn.size[0],0,hn.texture.size,tt,Lt,sn,hn.textureOffset,hn.scale,hn.offset);zt.colorAttachment.set(Gn.particleTexture1.texture),St.clear({color:a.C.transparent}),Qe.getOrCreateProgram("rasterParticleUpdate",{defines:hn.defines}).draw(Qe,Ee.TRIANGLES,a.ae.disabled,a.ag.disabled,a.a.unblended,a.af.disabled,Vn,et.id,Qe.viewportBuffer,Qe.quadTriangleIndexBuffer,Qe.viewportSegments)}}(I,R,ge,Ke)}(p,r,u,m),"translucent"===p.renderPass&&(function(I,M,R,L,U){const G=I.context,J=G.gl,Q=!I.options.moving,le="globe"===I.transform.projection.name;if(!L.length)return;const[de,ge]=I.stencilConfigForOverlap(L),xe=[];le&&xe.push("PROJECTION_GLOBE_VIEW");const Ke=I.stencilModeFor3D();for(const Qe of ge){const et=Qe.toUnwrapped(),yt=M.getTile(Qe);if(!yt.rasterParticleState)continue;const _t=yt.rasterParticleState,St=100;yt.registerFadeDuration(St);const Ee=M.findLoadedParent(Qe,0),tt=al(yt,Ee,M,I.transform,St);let Lt,sn;I.terrain&&I.terrain.prepareDrawTile(),G.activeTexture.set(J.TEXTURE0),_t.targetColorTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),G.activeTexture.set(J.TEXTURE1),Ee&&Ee.rasterParticleState?(Ee.rasterParticleState.targetColorTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),Lt=Math.pow(2,Ee.tileID.overscaledZ-yt.tileID.overscaledZ),sn=[yt.tileID.canonical.x*Lt%1,yt.tileID.canonical.y*Lt%1]):_t.targetColorTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const zt=le?Float32Array.from(I.transform.expandedFarZProjMatrix):I.transform.calculateProjMatrix(et,Q),It=I.transform,hn=zi(It),Gn=a.bc(Qe.canonical),Xn=a.bd(Gn.getCenter().lat);let Vn,Xt,mn,Pn,yi;le?(Vn=Float32Array.from(a.bf(a.bg(Qe.canonical))),Xt=Float32Array.from(It.globeMatrix),mn=Float32Array.from(a.bb(It)),Pn=[a.aj(It.center.lng),a.ak(It.center.lat)],yi=Float32Array.from(a.be(Qe.canonical,Gn,Xn,It.worldSize/It._pixelsPerMercatorPixel))):(Vn=new Float32Array(16),Xt=new Float32Array(9),mn=new Float32Array(16),Pn=[0,0],yi=new Float32Array(9));const bi=iu(zt,Vn,Xt,mn,yi,sn||[0,0],a.a1(I.transform.zoom),Pn,hn,Lt||1,tt,250),Mi=I.isTileAffectedByFog(Qe),xi=I.getOrCreateProgram("rasterParticle",{defines:xe,overrideFog:Mi});if(I.uploadCommonUniforms(G,xi,et),le){const di=new a.ae(J.LEQUAL,a.ae.ReadWrite,I.depthRangeFor3D),In=0,Li=I.globeSharedBuffers;if(Li){const[Ir,Ji,hr]=Li.getGridBuffers(Xn,0!==In);xi.draw(I,J.TRIANGLES,di,Ke,a.a.alphaBlended,a.af.backCCW,bi,R.id,Ir,Ji,hr)}}else{const di=I.depthModeForSublayer(0,a.ae.ReadOnly),In=de[Qe.overscaledZ],{tileBoundsBuffer:Li,tileBoundsIndexBuffer:Ir,tileBoundsSegments:Ji}=I.getTileBoundsBuffers(yt);xi.draw(I,J.TRIANGLES,di,In,a.a.alphaBlended,a.af.disabled,bi,R.id,Li,Ir,Ji)}}I.resetStencilClippingMasks()}(p,r,u,m),p.style.map.triggerRepaint())},background:function(p,r,u,m){const b=u.paint.get("background-color"),w=u.paint.get("background-opacity"),I=u.paint.get("background-emissive-strength");if(0===w)return;const M=p.context,R=M.gl,L=p.transform,U=L.tileSize,G=u.paint.get("background-pattern");let J;if(void 0!==G&&(null===G||(J=p.imageManager.getPattern(G.toString(),u.scope,p.style.getLut(u.scope)),!J)))return;const Q=!G&&1===b.a&&1===w&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==Q)return;const le=a.ag.disabled,de=p.depthModeForSublayer(0,"opaque"===Q?a.ae.ReadWrite:a.ae.ReadOnly),ge=p.colorModeForDrapableLayerRenderPass(I),xe=G?"backgroundPattern":"background";let Ke,Qe=m;Qe||(Ke=p.getBackgroundTiles(),Qe=Object.values(Ke).map(et=>et.tileID)),G&&(M.activeTexture.set(R.TEXTURE0),p.imageManager.bind(p.context,u.scope));for(const et of Qe){const yt=p.isTileAffectedByFog(et),_t=p.getOrCreateProgram(xe,{overrideFog:yt}),St=et.toUnwrapped(),Ee=m?et.projMatrix:p.transform.calculateProjMatrix(St);p.prepareDrawTile();const tt=r?r.getTile(et):Ke?Ke[et.key]:new a.by(et,U,L.zoom,p),Lt=G?Sr(Ee,I,w,p,0,u.scope,J,{tileID:et,tileSize:U}):Sc(Ee,I,w,b.toRenderColor(u.lut));p.uploadCommonUniforms(M,_t,St);const{tileBoundsBuffer:sn,tileBoundsIndexBuffer:zt,tileBoundsSegments:It}=p.getTileBoundsBuffers(tt);_t.draw(p,R.TRIANGLES,de,le,ge,a.af.disabled,Lt,u.id,sn,zt,It)}},sky:function(p,r,u){const m=p._atmosphere?a.a1(p.transform.zoom):1,b=u.paint.get("sky-opacity")*m;if(0===b)return;const w=p.context,I=u.paint.get("sky-type"),M=new a.ae(w.gl.LEQUAL,a.ae.ReadOnly,[0,1]),R=p.frameCounter/1e3%1;"atmosphere"===I?"offscreen"===p.renderPass?u.needsSkyboxCapture(p)&&(function(L,U,G,J){const Q=L.context,le=Q.gl;let de=U.skyboxFbo;if(!de){de=U.skyboxFbo=Q.createFramebuffer(32,32,!0,null),U.skyboxGeometry=new Xi(Q),U.skyboxTexture=Q.gl.createTexture(),le.bindTexture(le.TEXTURE_CUBE_MAP,U.skyboxTexture),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MAG_FILTER,le.LINEAR);for(let Qe=0;Qe<6;++Qe)le.texImage2D(le.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,0,le.RGBA,32,32,0,le.RGBA,le.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(de.framebuffer),Q.viewport.set([0,0,32,32]);const ge=U.getCenter(L,!0),xe=L.getOrCreateProgram("skyboxCapture"),Ke=new Float64Array(16);a.ad.identity(Ke),a.ad.rotateY(Ke,Ke,.5*-Math.PI),vo(L,U,xe,Ke,ge,0),a.ad.identity(Ke),a.ad.rotateY(Ke,Ke,.5*Math.PI),vo(L,U,xe,Ke,ge,1),a.ad.identity(Ke),a.ad.rotateX(Ke,Ke,.5*-Math.PI),vo(L,U,xe,Ke,ge,2),a.ad.identity(Ke),a.ad.rotateX(Ke,Ke,.5*Math.PI),vo(L,U,xe,Ke,ge,3),a.ad.identity(Ke),vo(L,U,xe,Ke,ge,4),a.ad.identity(Ke),a.ad.rotateY(Ke,Ke,Math.PI),vo(L,U,xe,Ke,ge,5),Q.viewport.set([0,0,L.width,L.height])}(p,u),u.markSkyboxValid(p)):"sky"===p.renderPass&&function(L,U,G,J,Q){const le=L.context,de=le.gl,ge=L.transform,xe=L.getOrCreateProgram("skybox");le.activeTexture.set(de.TEXTURE0),de.bindTexture(de.TEXTURE_CUBE_MAP,U.skyboxTexture);const Ke=((Qe,et,yt,_t,St)=>({u_matrix:Qe,u_sun_direction:et,u_cubemap:0,u_opacity:_t,u_temporal_offset:St}))(ge.skyboxMatrix,U.getCenter(L,!1),0,J,Q);L.uploadCommonUniforms(le,xe),xe.draw(L,de.TRIANGLES,G,a.ag.disabled,L.colorModeForRenderPass(),a.af.backCW,Ke,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(p,u,M,b,R):"gradient"===I&&"sky"===p.renderPass&&function(L,U,G,J,Q){const le=L.context,de=le.gl,ge=L.transform,xe=L.getOrCreateProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new Xi(le)),le.activeTexture.set(de.TEXTURE0);let Ke=U.colorRampTexture;Ke||(Ke=U.colorRampTexture=new a.T(le,U.colorRamp,de.RGBA)),Ke.bind(de.LINEAR,de.CLAMP_TO_EDGE);const Qe=(et=ge.skyboxMatrix,yt=U.getCenter(L,!1),_t=U.paint.get("sky-gradient-radius"),St=J,Ee=Q,{u_matrix:et,u_color_ramp:0,u_center_direction:yt,u_radius:a.ab(_t),u_opacity:St,u_temporal_offset:Ee});var et,yt,_t,St,Ee;L.uploadCommonUniforms(le,xe),xe.draw(L,de.TRIANGLES,G,a.ag.disabled,L.colorModeForRenderPass(),a.af.backCW,Qe,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(p,u,M,b,R)},debug:function(p,r,u,m,b,w){for(let I=0;I<u.length;I++)if(b){const L=new a.C(.8*m.r,.8*m.g,.8*m.b,1);V(p,r,u[I],m,-1,-1,w),V(p,r,u[I],m,-1,1,w),V(p,r,u[I],m,1,1,w),V(p,r,u[I],m,1,-1,w),V(p,r,u[I],L,0,0,w)}else V(p,r,u[I],m,0,0,w)},custom:function(p,r,u,m){const b=p.context,w=u.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||"offscreen"===p.renderPass)&&u.isDraped(r)){if("offscreen"===p.renderPass){const I=w.prerender;if(I){if(p.setCustomLayerDefaults(),b.setColorMode(p.colorModeForRenderPass()),"globe"===p.transform.projection.name){const M=p.transform.pointMerc;I.call(w,b.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),a.a1(p.transform.zoom),[M.x,M.y],p.transform.pixelsPerMeterRatio)}else I.call(w,b.gl,p.transform.customLayerMatrix());b.setDirty(),p.setBaseState()}}else if("translucent"===p.renderPass){if(p.terrain&&p.terrain.renderingToTexture){const M=w.renderToTile;if(M){const R=m[0].canonical,L=new a.Y(R.x+m[0].wrap*(1<<R.z),R.y,R.z);b.setDepthMode(a.ae.disabled),b.setStencilMode(a.ag.disabled),b.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),M.call(w,b.gl,L),b.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),b.setColorMode(p.colorModeForRenderPass()),b.setStencilMode(a.ag.disabled);const I="3d"===w.renderingMode?new a.ae(p.context.gl.LEQUAL,a.ae.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,a.ae.ReadOnly);if(b.setDepthMode(I),"globe"===p.transform.projection.name){const M=p.transform.pointMerc;w.render(b.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),a.a1(p.transform.zoom),[M.x,M.y],p.transform.pixelsPerMeterRatio)}else w.render(b.gl,p.transform.customLayerMatrix());b.setDirty(),p.setBaseState(),b.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,r,u,m){if("opaque"===p.renderPass)return;const b=u.paint.get("model-opacity");if(0===b)return;const w=u.paint.get("model-cast-shadows");if("shadow"===p.renderPass&&(!w||p.terrain&&b<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof a.Z))return;const I=p.shadowRenderer,M=u.paint.get("model-receive-shadows");I&&(I.useNormalOffset=!0,M||(I.enabled=!1));const R=()=>{I&&(I.useNormalOffset=!0,M||(I.enabled=!0))},L=r.getSource();if("light-beam"===p.renderPass&&"batched-model"!==L.type)return;if("vector"===L.type||"geojson"===L.type)return function(xe,Ke,Qe,et,yt){const _t=xe.transform;if("mercator"!==_t.projection.name)return void a.w(`Drawing 3D models for ${_t.projection.name} projection is not yet implemented`);const St=_t.getFreeCameraOptions().position;if(!xe.modelManager)return;const Ee=xe.modelManager;Qe.modelManager=Ee;const tt=xe.shadowRenderer;if(!Qe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Lt=Qe._unevaluatedLayout._values["model-id"],sn={...Qe.layout.get("model-id").parameters},zt=xe.style.order.indexOf(Qe.fqid);for(const It of et){const hn=Ke.getTile(It).getBucket(Qe);if(!hn||hn.projection.name!==_t.projection.name)continue;const Gn=hn.getModelUris();Gn&&!hn.modelsRequested&&(Ee.addModelsFromBucket(Gn,yt),hn.modelsRequested=!0);const Xn=ts(It,_t);sn.zoom=Xn;const Vn=Lt.possiblyEvaluate(sn);if(ds(xe,hn,It),Ds.shadowUniformsInitialized=!1,Ds.useSingleShadowCascade=!!tt&&0===tt.getMaxCascadeForTile(It.toUnwrapped()),"shadow"===xe.renderPass&&tt){if(1===xe.currentShadowCascade&&hn.isInsideFirstShadowMapFrustum)continue;const Pn=_t.calculatePosMatrix(It.toUnwrapped(),_t.worldSize);if(Ds.tileMatrix.set(Pn),Ds.shadowTileMatrix=Float32Array.from(tt.calculateShadowPassMatrixFromMatrix(Pn)),Ds.aabb.min.fill(0),Ds.aabb.max[0]=Ds.aabb.max[1]=a.a3,Ds.aabb.max[2]=0,Ja(hn,Ds,xe,Qe.scope))continue}const Xt=1<<It.canonical.z,mn=[((St.x-It.wrap)*Xt-It.canonical.x)*a.a3,(St.y*Xt-It.canonical.y)*a.a3,St.z*Xt*a.a3];xe.conflationActive&&Object.keys(hn.instancesPerModel).length>0&&xe.style.isLayerClipped(Qe,Ke.getSource())&&hn.updateReplacement(It,xe.replacementSource,zt)&&(hn.uploaded=!1,hn.upload(xe.context));for(let Pn in hn.instancesPerModel){const yi=hn.instancesPerModel[Pn];yi.features.length>0&&(Pn=Vn.evaluate(yi.features[0].feature,{}));const bi=Ee.getModel(Pn,yt);if(bi&&bi.uploaded)for(const Mi of bi.nodes)Jo(xe,Qe,Mi,yi,mn,It,Ds)}}}(p,r,u,m,"vector"===L.type?u.scope:""),void R();if(!L.loaded())return;if("batched-model"===L.type)return function(xe,Ke,Qe,et){Qe.resetLayerRenderingStats(xe);const yt=xe.context,_t=xe.transform,St=xe.style.fog,Ee=xe.shadowRenderer;if("mercator"!==_t.projection.name)return void a.w(`Drawing 3D landmark models for ${_t.projection.name} projection is not yet implemented`);const tt=xe.transform.getFreeCameraOptions().position,Lt=a._.scale([],[tt.x,tt.y,tt.z],xe.transform.worldSize);a._.negate(Lt,Lt);const sn=a.ad.identity([]),zt=a.cg(_t.center.lat,_t.zoom),It=a.ad.fromScaling([],[1,1,1/zt]);a.ad.translate(sn,sn,Lt);const hn=Qe.paint.get("model-opacity"),Gn=new a.ae(yt.gl.LEQUAL,a.ae.ReadWrite,xe.depthRangeFor3D),Xn=new a.ae(yt.gl.LEQUAL,a.ae.ReadOnly,xe.depthRangeFor3D),Vn=new a.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Xt="shadow"===xe.renderPass,mn=Xt&&Ee?Ee.getCurrentCascadeFrustum():_t.getFrustum(_t.scaleZoom(_t.worldSize)),Pn=Qe.paint.get("model-front-cutoff"),yi=Pn[2]<1,bi=ea(xe,Qe.paint.get("model-cutoff-fade-range")),Mi=Qe.getLayerRenderingStats();(function(xi,di,In,Li){const Ir=xi.terrain?xi.terrain.exaggeration():0,Ji=xi.transform.zoom;for(const hr of Li){const Fr=di.getTile(hr).getBucket(In);Fr&&(xi.conflationActive&&Fr.updateReplacement(hr,xi.replacementSource),Fr.evaluateScale(xi,In),xi.terrain&&Ir>0&&Fr.elevationUpdate(xi.terrain,Ir,hr,In.source),Fr.needsReEvaluation(xi,Ji,In)&&Fr.evaluate(In))}})(xe,Ke,Qe,et),function(){let xi,di,In;yi?(xi=et.length-1,di=-1,In=-1):(xi=0,di=et.length,In=1);for(let Li=xi;Li!==di;Li+=In){const Ir=et[Li],Ji=Ke.getTile(Ir).getBucket(Qe);if(!Ji||!Ji.uploaded)continue;let hr=!1;Ee&&(hr=0===Ee.getMaxCascadeForTile(Ir.toUnwrapped()));const Fr=_t.calculatePosMatrix(Ir.toUnwrapped(),_t.worldSize),fr=Ji.modelTraits,Rr=[];for(const rr of Ji.getNodesInfo()){if(rr.hiddenByReplacement||!rr.node.meshes)continue;const Ur=rr.node;let po=0;xe.terrain&&Ur.elevation&&(po=Ur.elevation*xe.terrain.exaggeration());const Pr=rr.evaluatedScale;if(Pr[0]<=1&&Pr[1]<=1&&Pr[2]<=1&&0===(()=>{const to=rr.aabb;return Vn.min=[...to.min],Vn.max=[...to.max],Vn.min[2]+=po,Vn.max[2]+=po,a._.transformMat4(Vn.min,Vn.min,Fr),a._.transformMat4(Vn.max,Vn.max,Fr),Vn})().intersects(mn))continue;const cr=[...Fr],Kr=Ur.anchor?Ur.anchor[0]:0,ps=Ur.anchor?Ur.anchor[1]:0;a.ad.translate(cr,cr,[Kr*(Pr[0]-1),ps*(Pr[1]-1),po]),a._.exactEquals(Pr,a.cj)||a.ad.scale(cr,cr,Pr);const xo=a.ad.multiply([],cr,Ur.matrix),No=a.ad.multiply([],_t.expandedFarZProjMatrix,xo),Mn=a.ad.multiply([],_t.expandedFarZProjMatrix,cr),Pi=a.aA.transformMat4([],[Kr,ps,po,1],No)[2];Ur.hidden=!1;let zs=hn;Xt||(yi&&(zs*=uc(cr,_t,rr.aabb,Pn)),zs*=Lo(bi,Pi)),0!==zs?Rr.push({nodeInfo:rr,depth:Pi,opacity:zs,wvpForNode:No,wvpForTile:Mn,nodeModelMatrix:xo,tileModelMatrix:cr}):Ur.hidden=!0}Xt||Rr.sort((rr,Ur)=>!yi||1===rr.opacity&&1===Ur.opacity?rr.depth<Ur.depth?-1:1:1===rr.opacity?-1:1===Ur.opacity?1:rr.depth>Ur.depth?-1:1);for(const rr of Rr){const Ur=rr.nodeInfo,po=Ur.node;let Pr=a.ad.multiply([],It,rr.tileModelMatrix);a.ad.multiply(Pr,sn,Pr);const cr=a.ad.invert([],Pr);a.ad.transpose(cr,cr),a.ad.scale(cr,cr,Gs),Pr=a.ad.multiply(Pr,Pr,po.matrix);const Kr="light-beam"===xe.renderPass,ps=fr&a.cl.HasMapboxMeshFeatures,xo=ps?0:Ur.evaluatedRMEA[0][2];for(let No=0;No<po.meshes.length;++No){const Mn=po.meshes[No],Pi=No===po.lightMeshIndex;let zs=rr.wvpForNode;if(Pi){if(!Kr&&!xe.terrain&&xe.shadowRenderer){xe.currentLayer<xe.firstLightBeamLayer&&(xe.firstLightBeamLayer=xe.currentLayer);continue}zs=rr.wvpForTile}else if(Kr)continue;const to={defines:[]},Jt=[];if(na(to.defines,Jt,Mn,xe,Qe.lut),ps||to.defines.push("DIFFUSE_SHADED"),hr&&to.defines.push("SHADOWS_SINGLE_CASCADE"),Mi&&(Xt?Mi.numRenderedVerticesInShadowPass+=Mn.vertexArray.length:Mi.numRenderedVerticesInTransparentPass+=Mn.vertexArray.length),Xt){Yo(Mn,rr.nodeModelMatrix,xe,Qe);continue}let ra=null;if(St){const xa=Go(rr.nodeModelMatrix,xe.transform);if(ra=new Float32Array(xa),"globe"!==_t.projection.name){const pc=Mn.aabb.min,jc=Mn.aabb.max,[Ju,mc]=St.getOpacityForBounds(xa,pc[0],pc[1],jc[0],jc[1]);to.overrideFog=Ju>=vn||mc>=vn}}const Us=Mn.material;let Ms;Us.occlusionTexture&&Us.occlusionTexture.offsetScale&&(Ms=Us.occlusionTexture.offsetScale,to.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Xt&&Ee&&(Ee.useNormalOffset=!!Mn.normalBuffer);const Xs=xe.getOrCreateProgram("model",to);!Xt&&Ee&&Ee.setupShadowsFromMatrix(rr.tileModelMatrix,Xs,Ee.useNormalOffset),xe.uploadCommonUniforms(yt,Xs,null,ra);const Ks=Us.pbrMetallicRoughness;Ks.metallicFactor=.9,Ks.roughnessFactor=.5;const Tr=ac(new Float32Array(zs),new Float32Array(Pr),new Float32Array(cr),new Float32Array(po.matrix),xe,rr.opacity,Ks.baseColorFactor.toRenderColor(null),Us.emissiveFactor,Ks.metallicFactor,Ks.roughnessFactor,Us,xo,Qe,[0,0,0],Ms);!Pi&&(Ur.hasTranslucentParts||rr.opacity<1)&&Xs.draw(xe,yt.gl.TRIANGLES,Gn,a.ag.disabled,a.a.disabled,a.af.backCCW,Tr,Qe.id,Mn.vertexBuffer,Mn.indexBuffer,Mn.segments,Qe.paint,xe.transform.zoom,void 0,Jt),Xs.draw(xe,yt.gl.TRIANGLES,Pi?Xn:Gn,a.ag.disabled,Pi||rr.opacity<1||Ur.hasTranslucentParts?a.a.alphaBlended:a.a.unblended,a.af.backCCW,Tr,Qe.id,Mn.vertexBuffer,Mn.indexBuffer,Mn.segments,Qe.paint,xe.transform.zoom,void 0,Jt)}}}}()}(p,r,u,m),void R();if("model"!==L.type)return;const U=L.getModels(),G=[],J=p.transform.getFreeCameraOptions().position,Q=a._.scale([],[J.x,J.y,J.z],p.transform.worldSize);a._.negate(Q,Q);const le=[],de=[];let ge=0;for(const xe of U){const Ke=u.paint.get("model-rotation").constantOr(null),Qe=u.paint.get("model-scale").constantOr(null),et=u.paint.get("model-translation").constantOr(null);xe.computeModelMatrix(p,Ke,Qe,et,!0,!0,!1);const yt=a.ad.identity([]),_t=a.cg(xe.position.lat,p.transform.zoom),St=a.ad.fromScaling([],[1,1,1/_t]);a.ad.translate(yt,yt,Q),G.push({zScaleMatrix:St,negCameraPosMatrix:yt});for(const Ee of xe.nodes)Oa(p.transform,Ee,xe.matrix,p.transform.expandedFarZProjMatrix,ge,le,de);ge++}if(le.sort((xe,Ke)=>Ke.depth-xe.depth),"shadow"!==p.renderPass){if(1===b)for(const xe of de)Is(xe,p,u,G[xe.modelIndex],a.ag.disabled,p.colorModeForRenderPass());else{for(const xe of de)Is(xe,p,u,G[xe.modelIndex],a.ag.disabled,a.a.disabled);for(const xe of de)Is(xe,p,u,G[xe.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}for(const xe of le)Is(xe,p,u,G[xe.modelIndex],a.ag.disabled,p.colorModeForRenderPass());R()}else{for(const xe of de)Yo(xe.mesh,xe.nodeModelMatrix,p,u);for(const xe of le)Yo(xe.mesh,xe.nodeModelMatrix,p,u);R()}}},Qa={model:function(p,r,u){const m=r.getSource();if(!m.loaded())return;if("vector"===m.type||"geojson"===m.type)return void(u.modelManager&&u.modelManager.upload(u,"vector"===m.type?p.scope:""));if("batched-model"===m.type||"model"!==m.type)return;const b=m.getModels();for(const w of b)w.upload(u.context)},raster:function(p,r,u){const m=r.getSource();if(!(m instanceof Bl&&m.loaded()))return;const b=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!b)return;const w=p.paint.get("raster-array-band")||m.getInitialBand(b);if(null==w)return;const I=r.getIds().map(M=>r.getTileByID(M));for(const M of I)M.updateNeeded(b,w)&&m.prepareTile(M,b,w)},"raster-particle":function(p,r,u){const m=r.getSource();if(!(m instanceof Bl&&m.loaded()))return;const b=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!b)return;const w=p.paint.get("raster-particle-array-band")||m.getInitialBand(b);if(null==w)return;const I=r.getIds().map(M=>r.getTileByID(M));for(const M of I)M.updateNeeded(b,w)&&m.prepareTile(M,b,w)}};class ny{constructor(r,u,m,b){this.context=new no(r,u),this.occlusionBuffers=new $l(this.context),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=a.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const I of w)this._debugParams.enabledLayers[I]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const I of w)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],I);this.symbolParams=new mr(b),this.setup(),this.numSublayers=a.bv.maxUnderzooming+a.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Xa(this),this._wireframeDebugCache=new Pc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(r,u){const m=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new zl(this,r));const b=this._terrain;this.transform.elevation=m?b:null,b.update(r,this.transform,u),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(r){const u=r.fog;if(!u||"globe"===this.transform.projection.name||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,b]=u.getFovAdjustedRange(this.transform._fov);if(m>b)return void(this.transform.fogCullDistSq=null);const w=m+.78*(b-m);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new zl(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,u){if(this.width=r*a.e.devicePixelRatio,this.height=u*a.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._mergedLayers[m].resize()}setup(){const r=this.context,u=new a.bt;u.emplaceBack(0,0),u.emplaceBack(a.a3,0),u.emplaceBack(0,a.a3),u.emplaceBack(a.a3,a.a3),this.tileExtentBuffer=r.createVertexBuffer(u,a.br.members),this.tileExtentSegments=a.b.simpleSegment(0,0,4,2);const m=new a.bt;m.emplaceBack(0,0),m.emplaceBack(a.a3,0),m.emplaceBack(0,a.a3),m.emplaceBack(a.a3,a.a3),this.debugBuffer=r.createVertexBuffer(m,a.br.members),this.debugSegments=a.b.simpleSegment(0,0,4,5);const b=new a.bt;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(b,a.br.members),this.viewportSegments=a.b.simpleSegment(0,0,4,2);const w=new a.cp;w.emplaceBack(0,0,0,0),w.emplaceBack(a.a3,0,a.a3,0),w.emplaceBack(0,a.a3,0,a.a3),w.emplaceBack(a.a3,a.a3,a.a3,a.a3),this.mercatorBoundsBuffer=r.createVertexBuffer(w,a.cq.members),this.mercatorBoundsSegments=a.b.simpleSegment(0,0,4,2);const I=new a.bu;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(I);const M=new a.cr;for(const L of[0,1,3,2,0])M.emplaceBack(L);this.debugIndexBuffer=r.createIndexBuffer(M),this.emptyTexture=new a.T(r,new a.i({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=a.ad.create();const R=this.context.gl;this.stencilClearMode=new a.ag({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,a.ae.disabled,this.stencilClearMode,a.a.disabled,a.af.disabled,ss(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,u,m){if(!u||this.currentStencilSource===u.id||!r.isTileClipped()||!m||0===m.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const R of m)if(void 0===this._tileClippingMaskIDs[R.key]){M=!0;break}if(!M)return}this.currentStencilSource=u.id;const b=this.context,w=b.gl;this.nextStencilID+m.length>256&&this.clearStencil(),b.setColorMode(a.a.disabled),b.setDepthMode(a.ae.disabled);const I=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of m){const R=u.getTile(M),L=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:U,tileBoundsIndexBuffer:G,tileBoundsSegments:J}=this.getTileBoundsBuffers(R);I.draw(this,w.TRIANGLES,a.ae.disabled,new a.ag({func:w.ALWAYS,mask:0},L,255,w.KEEP,w.KEEP,w.REPLACE),a.a.disabled,a.af.disabled,ss(M.projMatrix),"$clipping",U,G,J)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,u=this.context.gl;return new a.ag({func:u.NOTEQUAL,mask:255},r,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const u=this.context.gl;return new a.ag({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(r){const u=this.context.gl,m=r.sort((I,M)=>M.overscaledZ-I.overscaledZ),b=m[m.length-1].overscaledZ,w=m[0].overscaledZ-b+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const I={};for(let M=0;M<w;M++)I[M+b]=new a.ag({func:u.GEQUAL,mask:255},M+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=w,[I,m]}return[{[b]:a.ag.disabled},m]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new a.a([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new a.C(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?a.a.unblended:a.a.alphaBlended}colorModeForDrapableLayerRenderPass(r){const u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&"translucent"===this.renderPass?new a.a([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new a.C(0,0,0,void 0===r?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,u,m,b=!1){if(this.depthOcclusion)return new a.ae(this.context.gl.GREATER,a.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!b)return a.ae.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new a.ae(m||this.context.gl.LEQUAL,u,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const r=this.context.gl,u=Math.ceil(this.width),m=Math.ceil(this.height),b=this.context.bindFramebuffer.get(),w=r.getParameter(r.TEXTURE_BINDING_2D);this.terrainDepthFBO&&this.terrainDepthFBO.width===u&&this.terrainDepthFBO.height===m||(this.terrainDepthFBO&&(this.terrainDepthFBO.destroy(),this.terrainDepthFBO=void 0,this.terrainDepthTexture=void 0),0!==u&&0!==m&&(this.terrainDepthFBO=new ei(this.context,u,m,!1,"texture"),this.terrainDepthTexture=new a.T(this.context,{width:u,height:m,data:null},r.DEPTH_STENCIL),this.terrainDepthFBO.depthAttachment.set(this.terrainDepthTexture.texture))),this.context.bindFramebuffer.set(b),r.bindTexture(r.TEXTURE_2D,w),this.terrainDepthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.terrainDepthFBO.framebuffer),r.blitFramebuffer(0,0,u,m,0,0,u,m,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,u)=>r+u/this._fpsHistory.length,0))}render(r,u){const m=a.e.now();this._dt=m-this._timeStamp,this._timeStamp=m,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=u;const b=this.style._mergedLayers,w=this.style.order.filter(Ee=>{const tt=b[Ee];return!(tt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[tt.type]}),I=w.map(Ee=>b[Ee]),M=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(a.e.now()),this.imageManager.beginFrame();let R=0,L=!1;for(const Ee in M){const tt=M[Ee];tt.used&&(tt.prepare(this.context),tt.getSource().usedInConflation&&++R)}let U=!1;for(const Ee of I)Ee.isHidden(this.transform.zoom)||("clip"===Ee.type&&(U=!0),this.prepareLayer(Ee));const G={},J={},Q={},le={},de={};for(const Ee in M){const tt=M[Ee];G[Ee]=tt.getVisibleCoordinates(),J[Ee]=G[Ee].slice().reverse(),Q[Ee]=tt.getVisibleCoordinates(!0).reverse(),le[Ee]=tt.getShadowCasterCoordinates(),de[Ee]=tt.sortCoordinatesByDistance(G[Ee])}const ge=Ee=>{const tt=this.style.getLayerSourceCache(Ee);return tt&&tt.used?tt.getSource():null};if(R||U){const Ee=[],tt=[];let Lt=0;for(const sn of I)this.isSourceForClippingOrConflation(sn,ge(sn))&&(Ee.push(sn),tt.push(Lt)),Lt++;if(Ee&&(U||Ee.length>1)){const sn=[];for(let zt=0;zt<Ee.length;zt++){const It=Ee[zt],hn=tt[zt],Gn=this.style.getLayerSourceCache(It);if(!Gn||!Gn.used||!Gn.getSource().usedInConflation&&"clip"!==It.type)continue;let Xn=1/0,Vn=a.cu.None;if("clip"===It.type){Xn=hn;for(const Xt of It.layout.get("clip-layer-types"))Vn|="model"===Xt?a.cu.Model:"symbol"===Xt?a.cu.Symbol:a.cu.FillExtrusion}sn.push({layer:It.fqid,cache:Gn,order:Xn,clipMask:Vn})}this.replacementSource.setSources(sn),L=!0}}L||this.replacementSource.clear(),this.conflationActive=L,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ee=0;Ee<I.length;Ee++){const tt=I[Ee],Lt=tt.cutoffRange();if(this.longestCutoffRange=Math.max(Lt,this.longestCutoffRange),Lt>0){const sn=ge(tt);sn&&(this.minCutoffZoom=Math.max(sn.minzoom,this.minCutoffZoom)),tt.minzoom&&(this.minCutoffZoom=Math.max(tt.minzoom,this.minCutoffZoom))}tt.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ee),this._lastOcclusionLayer=Ee)}const xe=this.style&&this.style.fog;xe?(this._fogVisible=0!==xe.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=xe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Q),this.opaquePassCutoff=0);const Ke=this._shadowRenderer;if(Ke){Ke.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ee in M)for(const tt of G[Ee]){let Lt={min:0,max:0};this.terrain&&(Lt=this.terrain.getMinMaxForTile(tt)||Lt),Ke.addShadowReceiver(tt.toUnwrapped(),Lt.min,Lt.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new a.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Eo(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!a.ct(this.context.gl))return;this.renderPass="offscreen";for(const Ee of I){const tt=r.getLayerSourceCache(Ee);if(!Ee.hasOffscreenPass()||Ee.isHidden(this.transform.zoom))continue;const Lt=tt?J[tt.id]:void 0;("custom"===Ee.type||"raster"===Ee.type||"raster-particle"===Ee.type||Ee.isSky()||Lt&&Lt.length)&&this.renderLayer(this,tt,Ee,Lt)}this.depthRangeFor3D=[0,1-(I.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,le)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Qe="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),et=(()=>{if(u.showOverdrawInspector)return a.C.black;const Ee=this.style.fog;if(Ee&&this.transform.projection.supportsFog){const tt=this.style.getLut(Ee.scope);if(!Qe){const Lt=Ee.properties.get("color").toRenderColor(tt).toArray01();return new a.C(...Lt)}if(Qe){const Lt=Ee.properties.get("space-color").toRenderColor(tt).toArray01();return new a.C(...Lt)}}return a.C.transparent})();if(this.context.clear({color:et,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Qe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const Ee=I[this.currentLayer],tt=r.getLayerSourceCache(Ee);if(Ee.isSky())continue;const Lt=tt?(Ee.is3D()?de:J)[tt.id]:void 0;this._renderTileClippingMasks(Ee,tt,Lt),this.renderLayer(this,tt,Ee,Lt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Qe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.a1(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const Ee=I[this.currentLayer],tt=r.getLayerSourceCache(Ee);Ee.isSky()&&this.renderLayer(this,tt,Ee,tt?J[tt.id]:void 0)}function yt(Ee,tt){let Lt;return tt&&(Lt=("symbol"===Ee.type?Q:Ee.is3D()?de:J)[tt.id]),Lt}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){const Ee=I[this.currentLayer];if("raster"===Ee.type){const tt=r.getLayerSourceCache(Ee);this.renderLayer(this,tt,Ee,yt(Ee,tt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let _t=0;Ke&&(_t=Ke.getShadowCastingLayerCount());let St=!1;for(;this.currentLayer<w.length;){const Ee=I[this.currentLayer],tt=r.getLayerSourceCache(Ee);if(Ee.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ee)){if(Ee.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(St||!this.terrain||!this.style.hasSymbolLayers()&&!this.style.hasCircleLayers()||this.transform.isOrthographic||(St=!0,this.blitDepth()),Ee.is3D()||this.terrain||this._renderTileClippingMasks(Ee,tt,tt?G[tt.id]:void 0),this.renderLayer(this,tt,Ee,yt(Ee,tt)),!this.terrain&&Ke&&_t>0&&Ee.hasShadowPass()&&0==--_t&&(Ke.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Lt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Lt;this.currentLayer++){const sn=I[this.currentLayer];if(!sn.hasLightBeamPass())continue;const zt=r.getLayerSourceCache(sn);this.renderLayer(this,zt,sn,zt?J[zt.id]:void 0)}this.currentLayer=Lt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Lt=this.currentLayer;this.depthOcclusion=!0;for(const sn of this.layersWithOcclusionOpacity){this.currentLayer=sn;const zt=I[this.currentLayer],It=r.getLayerSourceCache(zt),hn=It?J[It.id]:void 0;zt.is3D()||this.terrain||this._renderTileClippingMasks(zt,It,It?G[It.id]:void 0),this.renderLayer(this,It,zt,hn)}this.depthOcclusion=!1,this.currentLayer=Lt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ee=null;I.forEach(tt=>{const Lt=r.getLayerSourceCache(tt);Lt&&!tt.isHidden(this.transform.zoom)&&Lt.getVisibleCoordinates().length&&(!Ee||Ee.getSource().maxzoom<Lt.getSource().maxzoom)&&(Ee=Lt)}),Ee&&this.options.showTileBoundaries&&Od.debug(this,Ee,Ee.getVisibleCoordinates(),a.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Od.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ee){const tt=Ee.transform.padding;oe(Ee,Ee.transform.height-(tt.top||0),3,cc),oe(Ee,tt.bottom||0,3,au),K(Ee,tt.left||0,3,Ya),K(Ee,Ee.transform.width-(tt.right||0),3,$s);const Lt=Ee.transform.centerPoint;var sn,zt,It,hn;ae(sn=Ee,(zt=Lt.x)-1,(It=Ee.transform.height-Lt.y)-10,2,20,hn=lu),ae(sn,zt-10,It-1,20,2,hn)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),L||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:u}=this.transform.projection,m=!u||!u.includes(r.type);if(Qa[r.type]&&(m||this.terrain&&"custom"===r.type)){const b=this.style.getLayerSourceCache(r);Qa[r.type](r,b,this)}this.gpuTimingEnd()}renderLayer(r,u,m,b){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||"model"===m.type||"raster"===m.type||"raster-particle"===m.type||b&&b.length)&&(this.id=m.id,this.gpuTimingStart(m),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(m.type)&&(!r.terrain||"custom"!==m.type)||"clip"===m.type||Od[m.type](r,u,m,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery,m=this.context.gl;let b=this.gpuTimers[r.id];b||(b=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:m.createQuery()}),b.calls++,m.beginQuery(u.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,u=this.context.gl,m=u.createQuery();this.deferredRenderGpuTimeQueries.push(m),u.beginQuery(r.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const u={};for(const m in r){const b=r[m],w=this.context.extTimerQuery,I=w.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(b.query),u[m]=I}return u}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.extTimerQuery,m=this.context.gl;let b=0;for(const w of r)b+=u.getQueryParameter(w,m.QUERY_RESULT)/1e6,u.deleteQueryEXT(w);return b}translatePosMatrix(r,u,m,b,w){if(!m[0]&&!m[1])return r;const I=w?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(I){const L=Math.sin(I),U=Math.cos(I);m=[m[0]*U-m[1]*L,m[0]*L+m[1]*U]}const M=[w?m[0]:a.bB(u,m[0],this.transform.zoom),w?m[1]:a.bB(u,m[1],this.transform.zoom),0],R=new Float32Array(16);return a.ad.translate(R,r,M),R}saveTileTexture(r){const u=r.size[0],m=this._tileTextures[u];m?m.push(r):this._tileTextures[u]=[r]}getTileTexture(r){const u=this._tileTextures[r];return u&&u.length>0?u.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(r,u,m){const b=void 0===m?this.terrain&&this.terrain.renderingToTexture:m,w=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===r||"terrainRaster"===r?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||w.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||w.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?w.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):w.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&w.push("GLOBE"),!this._fogVisible||b||void 0!==u&&!u||w.push("FOG","FOG_DITHERING"),b&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(r,u){this.cache=this.cache||{};const m=u&&u.defines||[],b=u&&u.config,w=this.currentGlobalDefines(r,u&&u.overrideFog,u&&u.overrideRtt).concat(m),I=Nu.cacheKey(Fl[r],r,w,b);return this.cache[I]||(this.cache[I]=new Nu(this.context,r,Fl[r],b,yh[r],w)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.terrainDepthFBO&&(this.terrainDepthFBO.destroy(),this.terrainDepthFBO=void 0,this.terrainDepthTexture=void 0)}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,u){if(this.style.enable3dLights()){const m=this.style.directionalLight,b=this.style.ambientLight;if(m&&b){const w=((I,M,R)=>{const L=I.properties.get("direction"),U=I.properties.get("color").toRenderColor(R.getLut(I.scope)).toArray01(),G=I.properties.get("intensity"),J=M.properties.get("color").toRenderColor(R.getLut(M.scope)).toArray01(),Q=M.properties.get("intensity"),le=[L.x,L.y,L.z],de=a.bA(J,Q),ge=a.bA(U,G);return{u_lighting_ambient_color:de,u_lighting_directional_dir:le,u_lighting_directional_color:ge,u_ground_radiance:Ul(le,ge,de)}})(m,b,this.style);u.setLightsUniformValues(r,w)}}}uploadCommonUniforms(r,u,m,b,w){if(this.uploadCommonLightUniforms(r,u),this.terrain&&this.terrain.renderingToTexture)return;const I=this.style.fog;if(I){const M=I.getOpacity(this.transform.pitch),R=((L,U,G,J,Q,le,de,ge,xe,Ke,Qe,et)=>{const yt=L.transform,_t=U.properties.get("color").toRenderColor(L.style.getLut(U.scope)).toArray01();_t[3]=J;const St=L.frameCounter/1e3%1,[Ee,tt]=U.properties.get("vertical-range");return{u_fog_matrix:G?yt.calculateFogTileMatrix(G):et||L.identityMat,u_fog_range:U.getFovAdjustedRange(yt._fov),u_fog_color:_t,u_fog_horizon_blend:U.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ee,tt),tt],u_fog_temporal_offset:St,u_frustum_tl:Q,u_frustum_tr:le,u_frustum_br:de,u_frustum_bl:ge,u_globe_pos:xe,u_globe_radius:Ke,u_viewport:Qe,u_globe_transition:a.a1(yt.zoom),u_is_globe:+("globe"===yt.projection.name)}})(this,I,m,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.e.devicePixelRatio,this.transform.height*a.e.devicePixelRatio],b);u.setFogUniformValues(r,R)}w&&u.setCutoffUniformValues(r,w.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,u=r.createTexture();return r.bindTexture(r.TEXTURE_2D,u),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,u=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const b of m)u[b.key]=r[b.key]||new a.by(b,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,u){return!(!r.is3D()||r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||"building"!==r.sourceLayer)&&"clip"!==r.type&&(!u||"batched-model"!==u.type))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let u=this._cachedTileFogOpacities[r.key];return u||(this._cachedTileFogOpacities[r.key]=u=this.style.fog.getOpacityForTile(r)),u[0]>=vn||u[1]>=vn}}class Hs{constructor(r,u,m,b){this.screenBounds=r,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(r,u){let m,b;if(r instanceof a.P||"number"==typeof r[0]){const w=a.P.convert(r);m=[w],b=u.isPointAboveHorizon(w)}else{const w=a.P.convert(r[0]),I=a.P.convert(r[1]);m=[w,I],b=a.cv(w,I).every(M=>u.isPointAboveHorizon(M))}return new Hs(m,u.getCameraPoint(),b,u)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return a.cv(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const u=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],b=a.cv(u,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<m.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?b[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(b[3]=this.cameraPoint)),a.cw(b,r)}bufferedCameraGeometryGlobe(r){const u=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],b=a.cv(u,m,r),w=this.cameraPoint.clone();switch(3*((w.y>u.y)+(w.y>m.y))+((w.x>u.x)+(w.x>m.x))){case 0:b[0]=w,b[4]=w.clone();break;case 1:b.splice(1,0,w);break;case 2:b[1]=w;break;case 3:b.splice(4,0,w);break;case 5:b.splice(2,0,w);break;case 6:b[3]=w;break;case 7:b.splice(3,0,w);break;case 8:b[2]=w}return b}containsTile(r,u,m,b=0){const w=r.queryPadding/u._pixelsPerMercatorPixel+1,I=m?this._bufferedCameraMercator(w,u):this._bufferedScreenMercator(w,u);let M=r.tileID.wrap+(I.unwrapped?b:0);const R=I.polygon.map(ge=>a.cx(r.tileTransform,ge,M));if(!a.cy(R,0,0,a.a3,a.a3))return;M=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const L=this.screenGeometryMercator.polygon.map(ge=>a.cz(r.tileTransform,ge,M)),U=L.map(ge=>new a.P(ge[0],ge[1])),G=u.getFreeCameraOptions().position||new a.Y(0,0,0),J=a.cz(r.tileTransform,G,M),Q=L.map(ge=>{const xe=a._.sub(ge,ge,J);return a._.normalize(xe,xe),new a.aT(J,xe)}),le=a.bB(r,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:U,tilespaceRays:Q,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(de=a.cA(R),de.min.x=a.at(de.min.x,0,a.a3),de.min.y=a.at(de.min.y,0,a.a3),de.max.x=a.at(de.max.x,0,a.a3),de.max.y=a.at(de.max.y,0,a.a3),de),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:le};var de}_bufferedScreenMercator(r,u){const m=bh(r);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let b;return b="globe"===u.projection.name?this._projectAndResample(this.bufferedScreenGeometry(r),u):{polygon:this.bufferedScreenGeometry(r).map(w=>u.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[m]=b,b}}_bufferedCameraMercator(r,u){const m=bh(r);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let b;return b="globe"===u.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),u):{polygon:this.bufferedCameraGeometry(r).map(w=>u.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[m]=b,b}}_projectAndResample(r,u){const m=function(w,I){const M=a.ad.multiply([],I.pixelMatrix,I.globeMatrix),R=[0,-a.cD,0,1],L=[0,a.cD,0,1],U=[0,0,0,1];a.aA.transformMat4(R,R,M),a.aA.transformMat4(L,L,M),a.aA.transformMat4(U,U,M);const G=new a.P(R[0]/R[3],R[1]/R[3]),J=new a.P(L[0]/L[3],L[1]/L[3]),Q=a.cB(w,G)&&R[3]<U[3],le=a.cB(w,J)&&L[3]<U[3];if(!Q&&!le)return null;const de=function(St,Ee,tt){for(let Lt=1;Lt<St.length;Lt++){const sn=Dl(Ee.pointCoordinate3D(St[Lt-1]).x),zt=Dl(Ee.pointCoordinate3D(St[Lt]).x);if(tt<0){if(sn<zt)return{idx:Lt,t:-sn/(zt-1-sn)}}else if(zt<sn)return{idx:Lt,t:(1-sn)/(zt+1-sn)}}return null}(w,I,Q?-1:1);if(!de)return null;const{idx:ge,t:xe}=de;let Ke=ge>1?Qo(w.slice(0,ge),I):[],Qe=ge<w.length?Qo(w.slice(ge),I):[];Ke=Ke.map(St=>new a.P(Dl(St.x),St.y)),Qe=Qe.map(St=>new a.P(Dl(St.x),St.y));const et=[...Ke];0===et.length&&et.push(Qe[Qe.length-1]);const yt=a.a2(et[et.length-1].y,(0===Qe.length?Ke[0]:Qe[0]).y,xe);let _t;return _t=Q?[new a.P(0,yt),new a.P(0,0),new a.P(1,0),new a.P(1,yt)]:[new a.P(1,yt),new a.P(1,1),new a.P(0,1),new a.P(0,yt)],et.push(..._t),0===Qe.length?et.push(Ke[0]):et.push(...Qe),{polygon:et.map(St=>new a.Y(St.x,St.y)),unwrapped:!1}}(r,u);if(m)return m;const b=function(w,I){let M=!1,R=-1/0,L=0;for(let G=0;G<w.length-1;G++)w[G].x>R&&(R=w[G].x,L=G);for(let G=0;G<w.length-1;G++){const J=(L+G)%(w.length-1),Q=w[J],le=w[J+1];Math.abs(Q.x-le.x)>.5&&(Q.x<le.x?(Q.x+=1,0===J&&(w[w.length-1].x+=1)):(le.x+=1,J+1===w.length-1&&(w[0].x+=1)),M=!0)}const U=a.aj(I.center.lng);return M&&U<Math.abs(U-1)&&w.forEach(G=>{G.x-=1}),{polygon:w,unwrapped:M}}(Qo(r,u).map(w=>new a.P(Dl(w.x),w.y)),u);return{polygon:b.polygon.map(w=>new a.Y(w.x,w.y)),unwrapped:b.unwrapped}}}function Qo(p,r){return a.cC(p,u=>{const m=r.pointCoordinate3D(u);u.x=m.x,u.y=m.y},1/256)}function Dl(p){return p<0?1+p%1:p%1}function bh(p){return 100*p|0}function yf(p,r){const u=a.ad.identity([]);return a.ad.scale(u,u,[.5*p.width,.5*-p.height,1]),a.ad.translate(u,u,[1,-1,0]),a.ad.multiply(u,u,p.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(u)}function ka(p,r,u,m,b,w,I,M=!1){const R=p.tilesIn(m,I,M);R.sort(Fa);const L=[];for(const G of R)L.push({wrappedTileID:G.tile.tileID.wrapped().key,queryResults:G.tile.queryRenderedFeatures(r,u,p._state,G,b,w,yf(p.transform,G.tile.tileID),M)});const U=function(G){const J={},Q={};for(const le of G){const de=le.queryResults,ge=le.wrappedTileID,xe=Q[ge]=Q[ge]||{};for(const Ke in de){const Qe=de[Ke],et=xe[Ke]=xe[Ke]||{},yt=J[Ke]=J[Ke]||[];for(const _t of Qe)et[_t.featureIndex]||(et[_t.featureIndex]=!0,yt.push(_t))}}return J}(L);for(const G in U)U[G].forEach(J=>{const Q=J.feature,le=Q.layer;le&&"background"!==le.type&&"sky"!==le.type&&"slot"!==le.type&&(Q.source=le.source,le["source-layer"]&&(Q.sourceLayer=le["source-layer"]),Q.state=void 0!==Q.id?p.getFeatureState(le["source-layer"],Q.id):{})});return U}function Ao(p,r){const u=p.getRenderableIds().map(w=>p.getTileByID(w)),m=[],b={};for(let w=0;w<u.length;w++){const I=u[w],M=I.tileID.canonical.key;b[M]||(b[M]=!0,I.querySourceFeatures(m,r))}return m}function Fa(p,r){const u=p.tileID,m=r.tileID;return u.overscaledZ-m.overscaledZ||u.canonical.y-m.canonical.y||u.wrap-m.wrap||u.canonical.x-m.canonical.x}class dc{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,u=!1;for(const m in this.style._mergedLayers){const b=this.style._mergedLayers[m];if("fill-extrusion"===b.type)this.layers.push({layer:b,visible:r,visibilityChanged:u});else if("model"===b.type){const w=this.style.getLayerSource(b);w&&"batched-model"===w.type&&this.layers.push({layer:b,visible:r,visibilityChanged:u})}}}onNewFrame(r){this.layersGotHidden=!1;for(const u of this.layers){const m=u.layer;let b=!1;"fill-extrusion"===m.type?b=!m.isHidden(r)&&m.paint.get("fill-extrusion-opacity")>0:"model"===m.type&&(b=!m.isHidden(r)&&m.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!b&&u.visible,u.visible=b}}updateZOffset(r,u){this.currentBuildingBuckets=[];for(const b of this.layers){const w=b.layer,I=this.style.getLayerSourceCache(w);let M=1;"fill-extrusion"===w.type&&(M=b.visible?w.paint.get("fill-extrusion-vertical-scale"):0);let R=I?I.getTile(u):null;if(!R&&I&&u.canonical.z>I.getSource().minzoom){let L=u.scaledTo(Math.min(I.getSource().maxzoom,u.overscaledZ-1));for(;L.overscaledZ>=I.getSource().minzoom&&(R=I.getTile(L),!R&&0!==L.overscaledZ);)L=L.scaledTo(L.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:R?R.getBucket(w):null,tileID:R?R.tileID:u,verticalScale:M})}r.hasAnyZOffset=!1;let m=!1;for(let b=0;b<r.symbolInstances.length;b++){const w=r.symbolInstances.get(b),I=w.zOffset,M=this._getHeightAtTileOffset(u,w.tileAnchorX,w.tileAnchorY);w.zOffset=M!==Number.NEGATIVE_INFINITY?M:I,m||I===w.zOffset||(m=!0),r.hasAnyZOffset||0===w.zOffset||(r.hasAnyZOffset=!0)}m&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,u,m,b){let w=u,I=m;if(r.canonical.z!==b.canonical.z){const M=b.canonical,R=1/(1<<r.canonical.z-M.z);w=(u+r.canonical.x*a.a3)*R-M.x*a.a3|0,I=(m+r.canonical.y*a.a3)*R-M.y*a.a3|0}return{tileX:w,tileY:I}}_getHeightAtTileOffset(r,u,m){let b,w;for(let I=0;I<this.layers.length;++I){if("fill-extrusion"!==this.layers[I].layer.type)continue;const{bucket:M,tileID:R,verticalScale:L}=this.currentBuildingBuckets[I];if(!M)continue;const{tileX:U,tileY:G}=this._mapCoordToOverlappingTile(r,u,m,R),J=M.getHeightAtTileCoord(U,G);J&&void 0!==J.height&&(J.hidden?b=J.height:w=Math.max(J.height*L,w||0))}if(void 0!==w)return w;for(let I=0;I<this.layers.length;++I){const M=this.layers[I];if("model"!==M.layer.type||!M.visible)continue;const{bucket:R,tileID:L}=this.currentBuildingBuckets[I];if(!R)continue;const{tileX:U,tileY:G}=this._mapCoordToOverlappingTile(r,u,m,L),J=R.getHeightAtTileCoord(U,G);if(J&&!J.hidden)return void 0===J.height&&void 0!==b?Math.min(J.maxHeight,b)*J.verticalScale:J.height?J.height*J.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Oc(p,r){const u={};for(const m in p)"ref"!==m&&(u[m]=p[m]);return a.cE.forEach(m=>{m in r&&(u[m]=r[m])}),u}function Vu(p){p=p.slice();const r=Object.create(null);for(let u=0;u<p.length;u++)r[p[u].id]=p[u];for(let u=0;u<p.length;u++)"ref"in p[u]&&(p[u]=Oc(p[u],r[p[u].ref]));return p}const Lr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function dl(p,r,u){u.push({command:Lr.addSource,args:[p,r[p]]})}function el(p,r,u){r.push({command:Lr.removeSource,args:[p]}),u[p]=!0}function Lc(p,r,u,m){el(p,u,m),dl(p,r,u)}function vf(p,r,u){let m;for(m in p[u])if(p[u].hasOwnProperty(m)&&"data"!==m&&!Z(p[u][m],r[u][m]))return!1;for(m in r[u])if(r[u].hasOwnProperty(m)&&"data"!==m&&!Z(p[u][m],r[u][m]))return!1;return!0}function Ld(p,r,u,m,b,w){let I;for(I in r=r||{},p=p||{})p.hasOwnProperty(I)&&(Z(p[I],r[I])||u.push({command:w,args:[m,I,r[I],b]}));for(I in r)r.hasOwnProperty(I)&&!p.hasOwnProperty(I)&&(Z(p[I],r[I])||u.push({command:w,args:[m,I,r[I],b]}))}function $u(p){return p.id}function Gl(p,r){return p[r.id]=r,p}class Ip{constructor(r,u){this.reset(r,u)}reset(r,u){this.points=r||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=a.at(r,0,1);let u=1,m=this._distances[u];const b=r*this.paddedLength+this.padding;for(;m<b&&u<this._distances.length;)m=this._distances[++u];const w=u-1,I=this._distances[w],M=m-I,R=M>0?(b-I)/M:0;return this.points[w].mult(1-R).add(this.points[u].mult(R))}}class cu{constructor(r,u,m){const b=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(r/m),this.yCellCount=Math.ceil(u/m);for(let I=0;I<this.xCellCount*this.yCellCount;I++)b.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=u,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,u,m,b,w){this._forEachCell(u,m,b,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(w)}insertCircle(r,u,m,b){this._forEachCell(u-b,m-b,u+b,m+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(u),this.circles.push(m),this.circles.push(b)}_insertBoxCell(r,u,m,b,w,I){this.boxCells[w].push(I)}_insertCircleCell(r,u,m,b,w,I){this.circleCells[w].push(I)}_query(r,u,m,b,w,I){if(m<0||r>this.width||b<0||u>this.height)return!w&&[];const M=[];if(r<=0&&u<=0&&this.width<=m&&this.height<=b){if(w)return!0;for(let R=0;R<this.boxKeys.length;R++)M.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const L=this.circles[3*R],U=this.circles[3*R+1],G=this.circles[3*R+2];M.push({key:this.circleKeys[R],x1:L-G,y1:U-G,x2:L+G,y2:U+G})}return I?M.filter(I):M}return this._forEachCell(r,u,m,b,this._queryCell,M,{hitTest:w,seenUids:{box:{},circle:{}}},I),w?M.length>0:M}_queryCircle(r,u,m,b,w){const I=r-m,M=r+m,R=u-m,L=u+m;if(M<0||I>this.width||L<0||R>this.height)return!b&&[];const U=[];return this._forEachCell(I,R,M,L,this._queryCellCircle,U,{hitTest:b,circle:{x:r,y:u,radius:m},seenUids:{box:{},circle:{}}},w),b?U.length>0:U}query(r,u,m,b,w){return this._query(r,u,m,b,!1,w)}hitTest(r,u,m,b,w){return this._query(r,u,m,b,!0,w)}hitTestCircle(r,u,m,b){return this._queryCircle(r,u,m,!0,b)}_queryCell(r,u,m,b,w,I,M,R){const L=M.seenUids,U=this.boxCells[w];if(null!==U){const J=this.bboxes;for(const Q of U)if(!L.box[Q]){L.box[Q]=!0;const le=4*Q;if(r<=J[le+2]&&u<=J[le+3]&&m>=J[le+0]&&b>=J[le+1]&&(!R||R(this.boxKeys[Q]))){if(M.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[Q],x1:J[le],y1:J[le+1],x2:J[le+2],y2:J[le+3]})}}}const G=this.circleCells[w];if(null!==G){const J=this.circles;for(const Q of G)if(!L.circle[Q]){L.circle[Q]=!0;const le=3*Q;if(this._circleAndRectCollide(J[le],J[le+1],J[le+2],r,u,m,b)&&(!R||R(this.circleKeys[Q]))){if(M.hitTest)return I.push(!0),!0;{const de=J[le],ge=J[le+1],xe=J[le+2];I.push({key:this.circleKeys[Q],x1:de-xe,y1:ge-xe,x2:de+xe,y2:ge+xe})}}}}}_queryCellCircle(r,u,m,b,w,I,M,R){const L=M.circle,U=M.seenUids,G=this.boxCells[w];if(null!==G){const Q=this.bboxes;for(const le of G)if(!U.box[le]){U.box[le]=!0;const de=4*le;if(this._circleAndRectCollide(L.x,L.y,L.radius,Q[de+0],Q[de+1],Q[de+2],Q[de+3])&&(!R||R(this.boxKeys[le])))return I.push(!0),!0}}const J=this.circleCells[w];if(null!==J){const Q=this.circles;for(const le of J)if(!U.circle[le]){U.circle[le]=!0;const de=3*le;if(this._circlesCollide(Q[de],Q[de+1],Q[de+2],L.x,L.y,L.radius)&&(!R||R(this.circleKeys[le])))return I.push(!0),!0}}}_forEachCell(r,u,m,b,w,I,M,R){const L=this._convertToXCellCoord(r),U=this._convertToYCellCoord(u),G=this._convertToXCellCoord(m),J=this._convertToYCellCoord(b);for(let Q=L;Q<=G;Q++)for(let le=U;le<=J;le++)if(w.call(this,r,u,m,b,this.xCellCount*le+Q,I,M,R))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,u,m,b,w,I){const M=b-r,R=w-u,L=m+I;return L*L>M*M+R*R}_circleAndRectCollide(r,u,m,b,w,I,M){const R=(I-b)/2,L=Math.abs(r-(b+R));if(L>R+m)return!1;const U=(M-w)/2,G=Math.abs(u-(w+U));if(G>U+m)return!1;if(L<=R||G<=U)return!0;const J=L-R,Q=G-U;return J*J+Q*Q<=m*m}}const hl=100;class kd{constructor(r,u,m=new cu(r.width+200,r.height+200,25),b=new cu(r.width+200,r.height+200,25)){this.transform=r,this.grid=m,this.ignoredGrid=b,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+hl,this.screenBottomBoundary=r.height+hl,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=u}placeCollisionBox(r,u,m,b,w,I,M,R){let L=m.projectedAnchorX,U=m.projectedAnchorY,G=m.projectedAnchorZ;const J=m.elevation,Q=m.tileID,le=r.getProjection();if(J&&Q){const[_t,St,Ee]=le.upVector(Q.canonical,m.tileAnchorX,m.tileAnchorY),tt=le.upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=_t*J*tt,U+=St*J*tt,G+=Ee*J*tt}const de=this.projectAndGetPerspectiveRatio(M,L,U,G,m.tileID,"globe"===le.name||!!J||this.transform.pitch>0,le),ge=I*de.perspectiveRatio,xe=(m.x1*u+b.x-m.padding)*ge+de.point.x,Ke=(m.y1*u+b.y-m.padding)*ge+de.point.y,Qe=(m.x2*u+b.x+m.padding)*ge+de.point.x,et=(m.y2*u+b.y+m.padding)*ge+de.point.y,yt=de.perspectiveRatio<=.55||de.occluded;return!this.isInsideGrid(xe,Ke,Qe,et)||!w&&this.grid.hitTest(xe,Ke,Qe,et,R)||yt?{box:[],offscreen:!1,occluded:de.occluded}:{box:[xe,Ke,Qe,et],offscreen:this.isOffscreen(xe,Ke,Qe,et),occluded:!1}}placeCollisionCircles(r,u,m,b,w,I,M,R,L,U,G,J,Q,le,de){const ge=[],xe=this.transform.elevation,Ke=r.getProjection(),Qe=xe?xe.getAtTileOffsetFunc(de,this.transform.center.lat,this.transform.worldSize,Ke):null,et=new a.P(m.tileAnchorX,m.tileAnchorY);let{x:yt,y:_t,z:St}=Ke.projectTilePoint(et.x,et.y,de.canonical);if(Qe){const[Vn,Xt,mn]=Qe(et);yt+=Vn,_t+=Xt,St+=mn}const Ee="globe"===Ke.name,tt=this.projectAndGetPerspectiveRatio(M,yt,_t,St,de,Ee||!!xe||this.transform.pitch>0,Ke),{perspectiveRatio:Lt}=tt,sn=(G?I/Lt:I*Lt)/a.bN,zt=ti(yt,_t,St,R),It=tt.signedDistanceFromCamera>0?Vi(sn,w,m.lineOffsetX*sn,m.lineOffsetY*sn,!1,zt,et,m,b,R,{},xe&&!G?Qe:null,G&&!!xe,Ke,de,G):null;let hn=!1,Gn=!1,Xn=!0;if(It&&!tt.occluded){const Vn=.5*Q*Lt+le,Xt=new a.P(-100,-100),mn=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Pn=new Ip,{first:yi,last:bi}=It,Mi=yi.path.length;let xi=[];for(let Li=Mi-1;Li>=1;Li--)xi.push(yi.path[Li]);for(let Li=1;Li<bi.path.length;Li++)xi.push(bi.path[Li]);const di=2.5*Vn;L&&(xi=xi.map(([Li,Ir,Ji],hr)=>(Qe&&!Ee&&(Ji=Qe(hr<Mi-1?yi.tilePath[Mi-1-hr]:bi.tilePath[hr-Mi+2])[2]),ti(Li,Ir,Ji,L))),xi.some(Li=>Li[3]<=0)&&(xi=[]));let In=[];if(xi.length>0){let Li=1/0,Ir=-1/0,Ji=1/0,hr=-1/0;for(const Fr of xi)Li=Math.min(Li,Fr[0]),Ji=Math.min(Ji,Fr[1]),Ir=Math.max(Ir,Fr[0]),hr=Math.max(hr,Fr[1]);Ir>=Xt.x&&Li<=mn.x&&hr>=Xt.y&&Ji<=mn.y&&(In=[xi.map(Fr=>new a.P(Fr[0],Fr[1]))],(Li<Xt.x||Ir>mn.x||Ji<Xt.y||hr>mn.y)&&(In=a.cF(In,Xt.x,Xt.y,mn.x,mn.y)))}for(const Li of In){Pn.reset(Li,.25*Vn);let Ir=0;Ir=Pn.length<=.5*Vn?1:Math.ceil(Pn.paddedLength/di)+1;for(let Ji=0;Ji<Ir;Ji++){const hr=Ji/Math.max(Ir-1,1),Fr=Pn.lerp(hr),fr=Fr.x+hl,Rr=Fr.y+hl;ge.push(fr,Rr,Vn,0);const rr=fr-Vn,Ur=Rr-Vn,po=fr+Vn,Pr=Rr+Vn;if(Xn=Xn&&this.isOffscreen(rr,Ur,po,Pr),Gn=Gn||this.isInsideGrid(rr,Ur,po,Pr),!u&&this.grid.hitTestCircle(fr,Rr,Vn,J)&&(hn=!0,!U))return{circles:[],offscreen:!1,collisionDetected:hn,occluded:!1}}}}return{circles:!U&&hn||!Gn?[]:ge,offscreen:Xn,collisionDetected:hn,occluded:tt.occluded}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let m=1/0,b=1/0,w=-1/0,I=-1/0;for(const U of r){const G=new a.P(U.x+hl,U.y+hl);m=Math.min(m,G.x),b=Math.min(b,G.y),w=Math.max(w,G.x),I=Math.max(I,G.y),u.push(G)}const M=this.grid.query(m,b,w,I).concat(this.ignoredGrid.query(m,b,w,I)),R={},L={};for(const U of M){const G=U.key;if(void 0===R[G.bucketInstanceId]&&(R[G.bucketInstanceId]={}),R[G.bucketInstanceId][G.featureIndex])continue;const J=[new a.P(U.x1,U.y1),new a.P(U.x2,U.y1),new a.P(U.x2,U.y2),new a.P(U.x1,U.y2)];a.cG(u,J)&&(R[G.bucketInstanceId][G.featureIndex]=!0,void 0===L[G.bucketInstanceId]&&(L[G.bucketInstanceId]=[]),L[G.bucketInstanceId].push(G.featureIndex))}return L}insertCollisionBox(r,u,m,b,w){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:w},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,u,m,b,w){const I=u?this.ignoredGrid:this.grid,M={bucketInstanceId:m,featureIndex:b,collisionGroupID:w};for(let R=0;R<r.length;R+=4)I.insertCircle(M,r[R],r[R+1],r[R+2])}projectAndGetPerspectiveRatio(r,u,m,b,w,I,M){const R=[u,m,b,1];let L=!1;b||this.transform.pitch>0?(a.aA.transformMat4(R,R,r),this.fogState&&w&&"globe"!==M.name&&(L=function(J,Q,le,de,ge,xe){const Ke=xe.calculateFogTileMatrix(ge),Qe=[Q,le,de];return a._.transformMat4(Qe,Qe,Ke),Ie(J,a._.length(Qe),xe.pitch,xe._fov)}(this.fogState,u,m,b,w.toUnwrapped(),this.transform)>.9)):Oo(R,R,r);const U=R[3];return{point:new a.P((R[0]/U+1)/2*this.transform.width+hl,(-R[1]/U+1)/2*this.transform.height+hl),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/U*.5,1.5),signedDistanceFromCamera:U,occluded:I&&R[2]>U||L}}isOffscreen(r,u,m,b){return m<hl||r>=this.screenRightBoundary||b<hl||u>this.screenBottomBoundary}isInsideGrid(r,u,m,b){return m>=0&&r<this.gridRightBoundary&&b>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const r=a.ad.identity([]);return a.ad.translate(r,r,[-100,-100,0]),r}}class wh{constructor(r,u,m,b){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?u:-u))):b&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class uu{constructor(r,u,m,b,w,I=!1){this.text=new wh(r?r.text:null,u,m,w),this.icon=new wh(r?r.icon:null,u,b,w),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class As{constructor(r,u,m,b=!1){this.text=r,this.icon=u,this.skipFade=m,this.clipped=b}}class Fd{constructor(){this.invProjMatrix=a.ad.create(),this.viewportMatrix=a.ad.create(),this.circles=[]}}class Eh{constructor(r,u,m,b,w){this.bucketInstanceId=r,this.featureIndex=u,this.sourceLayerIndex=m,this.bucketIndex=b,this.tileID=w}}class Ch{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const u=++this.maxGroupID;this.collisionGroups[r]={ID:u,predicate:m=>m.collisionGroupID===u}}return this.collisionGroups[r]}}function du(p,r,u,m,b){const{horizontalAlign:w,verticalAlign:I}=a.bQ(p),M=-(w-.5)*r,R=-(I-.5)*u,L=a.bP(p,m);return new a.P(M+L[0]*b,R+L[1]*b)}function hu(p,r,u,m,b){const w=new a.P(p,r);return u&&w._rotate(m?b:-b),w}class Tp{constructor(r,u,m,b,w,I){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new kd(this.transform,w),this.buildingIndex=I,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Ch(m),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,u,m,b){const w=m.getBucket(u),I=m.latestFeatureIndex;if(!w||!I||u.fqid!==w.layerIds[0])return;const M=w.layers[0].layout,R=m.collisionBoxArray,L=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),U=m.tileSize/a.a3,G=m.tileID.toUnwrapped();this.transform.setProjection(w.projection);const J=(Q=m.tileID,le=w.getProjection(),de=this.transform,le.name===this.projection?de.calculateProjMatrix(Q.toUnwrapped()):ru(de,le,Q));var Q,le,de;const ge="map"===M.get("text-pitch-alignment"),xe="map"===M.get("text-rotation-alignment");u.compileFilter();const Ke=u.dynamicFilter(),Qe=u.dynamicFilterNeedsFeature(),et=this.transform.calculatePixelsToTileUnitsMatrix(m),yt=ln(J,m.tileID.canonical,ge,xe,this.transform,w.getProjection(),et);let _t=null;if(ge){const tt=qn(J,m.tileID.canonical,ge,xe,this.transform,w.getProjection(),et);_t=a.ad.multiply([],this.transform.labelPlaneMatrix,tt)}let St=null;Ke&&m.latestFeatureIndex&&(St={unwrappedTileID:G,dynamicFilter:Ke,dynamicFilterNeedsFeature:Qe,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new Eh(w.bucketInstanceId,I,w.sourceLayerIndex,w.index,m.tileID);const Ee={bucket:w,layout:M,posMatrix:J,textLabelPlaneMatrix:yt,labelToScreenMatrix:_t,clippingData:St,scale:L,textPixelRatio:U,holdingForFade:m.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:a.aD(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.aD(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(b)for(const tt of w.sortKeyRanges){const{sortKey:Lt,symbolInstanceStart:sn,symbolInstanceEnd:zt}=tt;r.push({sortKey:Lt,symbolInstanceStart:sn,symbolInstanceEnd:zt,parameters:Ee})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Ee})}attemptAnchorPlacement(r,u,m,b,w,I,M,R,L,U,G,J,Q,le,de,ge,xe,Ke){const{textOffset0:Qe,textOffset1:et,crossTileID:yt}=J,_t=[Qe,et],St=du(r,m,b,_t,w),Ee=this.collisionIndex.placeCollisionBox(le,w,u,hu(St.x,St.y,I,M,this.transform.angle),G,R,L,U.predicate);if(ge){const tt=le.getSymbolInstanceIconSize(Ke,this.transform.zoom,J.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(le,tt,ge,hu(St.x,St.y,I,M,this.transform.angle),G,R,L,U.predicate).box.length)return}if(Ee.box.length>0){let tt;return this.prevPlacement&&this.prevPlacement.variableOffsets[yt]&&this.prevPlacement.placements[yt]&&this.prevPlacement.placements[yt].text&&(tt=this.prevPlacement.variableOffsets[yt].anchor),this.variableOffsets[yt]={textOffset:_t,width:m,height:b,anchor:r,textScale:w,prevAnchor:tt},this.markUsedJustification(le,r,J,de),le.allowVerticalPlacement&&(this.markUsedOrientation(le,de,J),this.placedOrientations[yt]=de),{shift:St,placedGlyphBoxes:Ee}}}placeLayerBucketPart(r,u,m,b){const{bucket:w,layout:I,posMatrix:M,textLabelPlaneMatrix:R,labelToScreenMatrix:L,clippingData:U,textPixelRatio:G,holdingForFade:J,collisionBoxArray:Q,partiallyEvaluatedTextSize:le,partiallyEvaluatedIconSize:de,collisionGroup:ge}=r.parameters,xe=I.get("text-optional"),Ke=I.get("icon-optional"),Qe=I.get("text-allow-overlap"),et=I.get("icon-allow-overlap"),yt="map"===I.get("text-rotation-alignment"),_t="map"===I.get("text-pitch-alignment"),St="viewport-y"===I.get("symbol-z-order"),Ee=I.get("symbol-z-elevate");this.transform.setProjection(w.projection);let tt=Qe&&(et||!w.hasIconData()||Ke),Lt=et&&(Qe||!w.hasTextData()||xe);!w.collisionArrays&&Q&&w.deserializeCollisionBoxes(Q),m&&b&&w.updateCollisionDebugBuffers(this.transform.zoom,Q);const sn=(zt,It,hn)=>{const{crossTileID:Gn,numVerticalGlyphVertices:Xn}=zt;if(U){const po={zoom:this.transform.zoom,pitch:this.transform.pitch};let Pr=null;if(U.dynamicFilterNeedsFeature){const cr=this.retainedQueryData[w.bucketInstanceId];Pr=U.featureIndex.loadFeature({featureIndex:zt.featureIndex,bucketIndex:cr.bucketIndex,sourceLayerIndex:cr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,U.dynamicFilter)(po,Pr,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new a.P(zt.tileAnchorX,zt.tileAnchorY),this.transform.calculateDistanceTileData(U.unwrappedTileID)))return this.placements[Gn]=new As(!1,!1,!1,!0),void u.add(Gn)}if(u.has(Gn))return;if(J)return void(this.placements[Gn]=new As(!1,!1,!1));let Vn=!1,Xt=!1,mn=!0,Pn=!1,yi=!1,bi=null,Mi={box:null,offscreen:null,occluded:null},xi={box:null,offscreen:null,occluded:null},di=null,In=null,Li=null,Ir=0,Ji=0,hr=0;hn.textFeatureIndex?Ir=hn.textFeatureIndex:zt.useRuntimeCollisionCircles&&(Ir=zt.featureIndex),hn.verticalTextFeatureIndex&&(Ji=hn.verticalTextFeatureIndex);const Fr=po=>{po.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Pr=this.transform.elevation;po.elevation=zt.zOffset+(Pr?Pr.getAtTileOffset(po.tileID,po.tileAnchorX,po.tileAnchorY):0)},fr=hn.textBox;if(fr){Fr(fr);const po=cr=>{let Kr=a.aE.horizontal;if(w.allowVerticalPlacement&&!cr&&this.prevPlacement){const ps=this.prevPlacement.placedOrientations[Gn];ps&&(this.placedOrientations[Gn]=ps,Kr=ps,this.markUsedOrientation(w,Kr,zt))}return Kr},Pr=(cr,Kr)=>{if(w.allowVerticalPlacement&&Xn>0&&hn.verticalTextBox){for(const ps of w.writingModes)if(ps===a.aE.vertical?(Mi=Kr(),xi=Mi):Mi=cr(),Mi&&Mi.box&&Mi.box.length)break}else Mi=cr()};if(I.get("text-variable-anchor")){let cr=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Gn]){const xo=this.prevPlacement.variableOffsets[Gn];cr.indexOf(xo.anchor)>0&&(cr=cr.filter(No=>No!==xo.anchor),cr.unshift(xo.anchor))}const Kr=(xo,No,Mn)=>{const Pi=w.getSymbolInstanceTextSize(le,zt,this.transform.zoom,It),zs=(xo.x2-xo.x1)*Pi+2*xo.padding,to=(xo.y2-xo.y1)*Pi+2*xo.padding,Jt=zt.hasIconTextFit&&!et?No:null;Jt&&Fr(Jt);let ra={box:[],offscreen:!1,occluded:!1};const Us=Qe?2*cr.length:cr.length;for(let Ms=0;Ms<Us;++Ms){const Xs=this.attemptAnchorPlacement(cr[Ms%cr.length],xo,zs,to,Pi,yt,_t,G,M,ge,Ms>=cr.length,zt,It,w,Mn,Jt,le,de);if(Xs&&(ra=Xs.placedGlyphBoxes,ra&&ra.box&&ra.box.length)){Vn=!0,bi=Xs.shift;break}}return ra};Pr(()=>Kr(fr,hn.iconBox,a.aE.horizontal),()=>{const xo=hn.verticalTextBox;return xo&&Fr(xo),w.allowVerticalPlacement&&!(Mi&&Mi.box&&Mi.box.length)&&Xn>0&&xo?Kr(xo,hn.verticalIconBox,a.aE.vertical):{box:null,offscreen:null,occluded:null}}),Mi&&(Vn=Mi.box,mn=Mi.offscreen,Pn=Mi.occluded);const ps=po(!(!Mi||!Mi.box));if(!Vn&&this.prevPlacement){const xo=this.prevPlacement.variableOffsets[Gn];xo&&(this.variableOffsets[Gn]=xo,this.markUsedJustification(w,xo.anchor,zt,ps))}}else{const cr=(Kr,ps)=>{const xo=w.getSymbolInstanceTextSize(le,zt,this.transform.zoom,It),No=this.collisionIndex.placeCollisionBox(w,xo,Kr,new a.P(0,0),Qe,G,M,ge.predicate);return No&&No.box&&No.box.length&&(this.markUsedOrientation(w,ps,zt),this.placedOrientations[Gn]=ps),No};Pr(()=>cr(fr,a.aE.horizontal),()=>{const Kr=hn.verticalTextBox;return w.allowVerticalPlacement&&Xn>0&&Kr?(Fr(Kr),cr(Kr,a.aE.vertical)):{box:null,offscreen:null,occluded:null}}),po(!!(Mi&&Mi.box&&Mi.box.length))}}if(di=Mi,Vn=di&&di.box&&di.box.length>0,mn=di&&di.offscreen,Pn=di&&di.occluded,zt.useRuntimeCollisionCircles){const po=w.text.placedSymbolArray.get(zt.centerJustifiedTextSymbolIndex>=0?zt.centerJustifiedTextSymbolIndex:zt.verticalPlacedTextSymbolIndex),Pr=a.aF(w.textSizeData,le,po),cr=I.get("text-padding");In=this.collisionIndex.placeCollisionCircles(w,Qe,po,w.lineVertexArray,w.glyphOffsetArray,Pr,M,R,L,m,_t,ge.predicate,zt.collisionCircleDiameter*Pr/a.bN,cr,this.retainedQueryData[w.bucketInstanceId].tileID),Vn=Qe||In.circles.length>0&&!In.collisionDetected,mn=mn&&In.offscreen,Pn=In.occluded}if(hn.iconFeatureIndex&&(hr=hn.iconFeatureIndex),hn.iconBox){const po=Pr=>{Fr(Pr);const cr=zt.hasIconTextFit&&bi?hu(bi.x,bi.y,yt,_t,this.transform.angle):new a.P(0,0),Kr=w.getSymbolInstanceIconSize(de,this.transform.zoom,zt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Kr,Pr,cr,et,G,M,ge.predicate)};xi&&xi.box&&xi.box.length&&hn.verticalIconBox?(Li=po(hn.verticalIconBox),Xt=Li.box.length>0):(Li=po(hn.iconBox),Xt=Li.box.length>0),mn=mn&&Li.offscreen,yi=Li.occluded}const Rr=xe||0===zt.numHorizontalGlyphVertices&&0===Xn,rr=Ke||0===zt.numIconVertices;if(Rr||rr?rr?Rr||(Xt=Xt&&Vn):Vn=Xt&&Vn:Xt=Vn=Xt&&Vn,Vn&&di&&di.box&&this.collisionIndex.insertCollisionBox(di.box,I.get("text-ignore-placement"),w.bucketInstanceId,xi&&xi.box&&Ji?Ji:Ir,ge.ID),Xt&&Li&&this.collisionIndex.insertCollisionBox(Li.box,I.get("icon-ignore-placement"),w.bucketInstanceId,hr,ge.ID),In&&(Vn&&this.collisionIndex.insertCollisionCircles(In.circles,I.get("text-ignore-placement"),w.bucketInstanceId,Ir,ge.ID),m)){const po=w.bucketInstanceId;let Pr=this.collisionCircleArrays[po];void 0===Pr&&(Pr=this.collisionCircleArrays[po]=new Fd);for(let cr=0;cr<In.circles.length;cr+=4)Pr.circles.push(In.circles[cr+0]),Pr.circles.push(In.circles[cr+1]),Pr.circles.push(In.circles[cr+2]),Pr.circles.push(In.collisionDetected?1:0)}const Ur="globe"!==w.projection.name;tt=tt&&(Ur||!Pn),Lt=Lt&&(Ur||!yi),this.placements[Gn]=new As(Vn||tt,Xt||Lt,mn||w.justReloaded),u.add(Gn)};if(Ee&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.updateZOffset()),St){const zt=w.getSortedSymbolIndexes(this.transform.angle);for(let It=zt.length-1;It>=0;--It){const hn=zt[It];sn(w.symbolInstances.get(hn),hn,w.collisionArrays[hn])}w.hasAnyZOffset&&a.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const zt=w.getSortedIndexesByZOffset();for(let It=0;It<zt.length;++It){const hn=zt[It];sn(w.symbolInstances.get(hn),hn,w.collisionArrays[hn])}}else for(let zt=r.symbolInstanceStart;zt<r.symbolInstanceEnd;zt++)sn(w.symbolInstances.get(zt),zt,w.collisionArrays[zt]);if(m&&w.bucketInstanceId in this.collisionCircleArrays){const zt=this.collisionCircleArrays[w.bucketInstanceId];a.ad.invert(zt.invProjMatrix,M),zt.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(r,u,m,b){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:R,crossTileID:L}=m,U=a.cJ(u),G=b===a.aE.vertical?R:"left"===U?w:"center"===U?I:"right"===U?M:-1;w>=0&&(r.text.placedSymbolArray.get(w).crossTileID=G>=0&&w!==G?0:L),I>=0&&(r.text.placedSymbolArray.get(I).crossTileID=G>=0&&I!==G?0:L),M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=G>=0&&M!==G?0:L),R>=0&&(r.text.placedSymbolArray.get(R).crossTileID=G>=0&&R!==G?0:L)}markUsedOrientation(r,u,m){const b=u===a.aE.horizontal||u===a.aE.horizontalOnly?u:0,w=u===a.aE.vertical?u:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:L}=m,U=r.text.placedSymbolArray;I>=0&&(U.get(I).placedOrientation=b),M>=0&&(U.get(M).placedOrientation=b),R>=0&&(U.get(R).placedOrientation=b),L>=0&&(U.get(L).placedOrientation=w)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let m=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const b=u?u.symbolFadeChange(r):1,w=u?u.opacities:{},I=u?u.variableOffsets:{},M=u?u.placedOrientations:{};for(const R in this.placements){const L=this.placements[R],U=w[R];U?(this.opacities[R]=new uu(U,b,L.text,L.icon,null,L.clipped),m=m||L.text!==U.text.placed||L.icon!==U.icon.placed):(this.opacities[R]=new uu(null,b,L.text,L.icon,L.skipFade,L.clipped),m=m||L.text||L.icon)}for(const R in w){const L=w[R];if(!this.opacities[R]){const U=new uu(L,b,!1,!1);U.isHidden()||(this.opacities[R]=U,m=m||L.text.placed||L.icon.placed)}}for(const R in I)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=I[R]);for(const R in M)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=M[R]);m?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:r)}updateLayerOpacities(r,u,m,b){const w=new Set;for(const I of u){const M=I.getBucket(r);M&&I.latestFeatureIndex&&r.fqid===M.layerIds[0]&&(this.updateBucketOpacities(M,w,I.collisionBoxArray,m,b,I.tileID),M.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(M,I.tileID),M.updateZOffset()))}}updateBucketOpacities(r,u,m,b,w,I){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const M=r.layers[0].layout,R=!!r.layers[0].dynamicFilter(),L=new uu(null,0,!1,!1,!0),U=M.get("text-allow-overlap"),G=M.get("icon-allow-overlap"),J=M.get("text-variable-anchor"),Q="map"===M.get("text-rotation-alignment"),le="map"===M.get("text-pitch-alignment"),de=new uu(null,0,U&&(G||!r.hasIconData()||M.get("icon-optional")),G&&(U||!r.hasTextData()||M.get("text-optional")),!0);!r.collisionArrays&&m&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(m);const ge=(Ke,Qe,et)=>{for(let yt=0;yt<Qe/4;yt++)Ke.opacityVertexArray.emplaceBack(et)};let xe=0;w&&r.updateReplacement(I,w);for(let Ke=0;Ke<r.symbolInstances.length;Ke++){const Qe=r.symbolInstances.get(Ke),{numHorizontalGlyphVertices:et,numVerticalGlyphVertices:yt,crossTileID:_t,numIconVertices:St,tileAnchorX:Ee,tileAnchorY:tt}=Qe,Lt=u.has(_t);let sn=this.opacities[_t];Lt?sn=L:sn||(sn=de,this.opacities[_t]=sn),u.add(_t);const zt=et>0||yt>0,It=St>0,hn=this.placedOrientations[_t],Gn=hn===a.aE.vertical,Xn=hn===a.aE.horizontal||hn===a.aE.horizontalOnly;!zt&&!It||sn.isHidden()||xe++;let Vn=!1;if((zt||It)&&w)for(const Xt of r.activeReplacements){if(Xt.order<b||Xt.order===1/0||!(Xt.clipMask&a.cu.Symbol)||Xt.min.x>Ee||Ee>Xt.max.x||Xt.min.y>tt||tt>Xt.max.y)continue;const mn=a.cH(Ee,tt,I.canonical,Xt.footprintTileId.canonical);if(Vn=a.cI(mn,Xt),Vn)break}if(zt){const Xt=Vn?Xe:ce(sn.text);ge(r.text,et,Gn?Xe:Xt),ge(r.text,yt,Xn?Xe:Xt);const mn=sn.text.isHidden(),{leftJustifiedTextSymbolIndex:Pn,centerJustifiedTextSymbolIndex:yi,rightJustifiedTextSymbolIndex:bi,verticalPlacedTextSymbolIndex:Mi}=Qe,xi=r.text.placedSymbolArray,di=mn||Gn?1:0;Pn>=0&&(xi.get(Pn).hidden=di),yi>=0&&(xi.get(yi).hidden=di),bi>=0&&(xi.get(bi).hidden=di),Mi>=0&&(xi.get(Mi).hidden=mn||Xn?1:0);const In=this.variableOffsets[_t];In&&this.markUsedJustification(r,In.anchor,Qe,hn);const Li=this.placedOrientations[_t];Li&&(this.markUsedJustification(r,"left",Qe,Li),this.markUsedOrientation(r,Li,Qe))}if(It){const Xt=Vn?Xe:ce(sn.icon),{placedIconSymbolIndex:mn,verticalPlacedIconSymbolIndex:Pn}=Qe,yi=r.icon.placedSymbolArray,bi=sn.icon.isHidden()?1:0;mn>=0&&(ge(r.icon,St,Gn?Xe:Xt),yi.get(mn).hidden=bi),Pn>=0&&(ge(r.icon,Qe.numVerticalIconVertices,Xn?Xe:Xt),yi.get(Pn).hidden=bi)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Xt=r.collisionArrays[Ke];if(Xt){let mn=new a.P(0,0),Pn=!0;if(Xt.textBox||Xt.verticalTextBox){if(J){const bi=this.variableOffsets[_t];bi?(mn=du(bi.anchor,bi.width,bi.height,bi.textOffset,bi.textScale),Q&&mn._rotate(le?this.transform.angle:-this.transform.angle)):Pn=!1}R&&(Pn=!sn.clipped),Xt.textBox&&fu(r.textCollisionBox.collisionVertexArray,sn.text.placed,!Pn||Gn,mn.x,mn.y),Xt.verticalTextBox&&fu(r.textCollisionBox.collisionVertexArray,sn.text.placed,!Pn||Xn,mn.x,mn.y)}const yi=Pn&&!(Xn||!Xt.verticalIconBox);Xt.iconBox&&fu(r.iconCollisionBox.collisionVertexArray,sn.icon.placed,yi,Qe.hasIconTextFit?mn.x:0,Qe.hasIconTextFit?mn.y:0),Xt.verticalIconBox&&fu(r.iconCollisionBox.collisionVertexArray,sn.icon.placed,!yi,Qe.hasIconTextFit?mn.x:0,Qe.hasIconTextFit?mn.y:0)}}}if(r.fullyClipped=0===xe,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const Ke=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=Ke.invProjMatrix,r.placementViewportMatrix=Ke.viewportMatrix,r.collisionCircleArray=Ke.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,u){const m=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*m>r}setStale(){this.stale=!0}}function fu(p,r,u,m,b){p.emplaceBack(r?1:0,u?1:0,m||0,b||0),p.emplaceBack(r?1:0,u?1:0,m||0,b||0),p.emplaceBack(r?1:0,u?1:0,m||0,b||0),p.emplaceBack(r?1:0,u?1:0,m||0,b||0)}const fl=Math.pow(2,25),xf=Math.pow(2,24),hi=Math.pow(2,17),k=Math.pow(2,16),W=Math.pow(2,9),N=Math.pow(2,8),X=Math.pow(2,1);function ce(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const r=p.placed?1:0,u=Math.floor(127*p.opacity);return u*fl+r*xf+u*hi+r*k+u*W+r*N+u*X+r}const Xe=0;class Rt{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,u,m,b,w){const I=this._bucketParts;for(;this._currentTileIndex<r.length;)if(u.getBucketParts(I,b,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((M,R)=>M.sortKey-R.sortKey));this._currentPartIndex<I.length;){const M=I[this._currentPartIndex];if(u.placeLayerBucketPart(M,this._seenCrossTileIDs,m,0===M.symbolInstanceStart),this._currentPartIndex++,w())return!0}return!1}}class un{constructor(r,u,m,b,w,I,M,R,L){this.placement=new Tp(r,w,I,M,R,L),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(r,u,m,b){const w=a.e.now(),I=()=>{const M=a.e.now()-w;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=u[r[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if("symbol"===M.type&&(!M.minzoom||M.minzoom<=R)&&(!M.maxzoom||M.maxzoom>R)){const L=M,U=L.layout.get("symbol-z-elevate"),G=this._inProgressLayer=this._inProgressLayer||new Rt(L),J=a.al(M.source,M.scope);if(G.continuePlacement(U?b[J]:m[J],this.placement,this._showCollisionBoxes,M,I))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const en=512/a.a3/2;class wi{constructor(r,u,m){this.tileID=r,this.bucketInstanceId=m,this.index=new a.cK(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=r.canonical.x*a.a3,w=r.canonical.y*a.a3;for(let I=0;I<u.length;I++){const{key:M,crossTileID:R,tileAnchorX:L,tileAnchorY:U}=u.get(I),G=Math.floor((b+L)*en),J=Math.floor((w+U)*en);this.index.add(G,J),this.keys.push(M),this.crossTileIDs.push(R)}this.index.finish()}findMatches(r,u,m){const b=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),w=en/Math.pow(2,u.canonical.z-this.tileID.canonical.z),I=u.canonical.x*a.a3,M=u.canonical.y*a.a3;for(let R=0;R<r.length;R++){const L=r.get(R);if(L.crossTileID)continue;const{key:U,tileAnchorX:G,tileAnchorY:J}=L,Q=Math.floor((I+G)*w),le=Math.floor((M+J)*w),de=this.index.range(Q-b,le-b,Q+b,le+b);for(const ge of de){const xe=this.crossTileIDs[ge];if(this.keys[ge]===U&&!m.has(xe)){m.add(xe),L.crossTileID=xe;break}}}}}class yr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class dr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const u=Math.round((r-this.lng)/360);if(0!==u)for(const m in this.indexes){const b=this.indexes[m],w={};for(const I in b){const M=b[I];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+u),w[M.tileID.key]=M}this.indexes[m]=w}this.lng=r}addBucket(r,u,m){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let w=0;w<u.symbolInstances.length;w++)u.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const b=this.usedCrossTileIDs[r.overscaledZ];for(const w in this.indexes){const I=this.indexes[w];if(Number(w)>r.overscaledZ)for(const M in I){const R=I[M];R.tileID.isChildOf(r)&&R.findMatches(u.symbolInstances,r,b)}else{const M=I[r.scaledTo(Number(w)).key];M&&M.findMatches(u.symbolInstances,r,b)}}for(let w=0;w<u.symbolInstances.length;w++){const I=u.symbolInstances.get(w);I.crossTileID||(I.crossTileID=m.generate(),b.add(I.crossTileID))}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new wi(r,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(r,u){for(const m of u.crossTileIDs)this.usedCrossTileIDs[r].delete(m)}removeStaleBuckets(r){let u=!1;for(const m in this.indexes){const b=this.indexes[m];for(const w in b)r[b[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,b[w]),delete b[w],u=!0)}return u}}class Ho{constructor(){this.layerIndexes={},this.crossTileIDs=new yr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,u,m,b){let w=this.layerIndexes[r.fqid];void 0===w&&(w=this.layerIndexes[r.fqid]=new dr);let I=!1;const M={};"globe"!==b.name&&w.handleWrapJump(m);for(const R of u){const L=R.getBucket(r);L&&r.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(R.tileID,L,this.crossTileIDs)&&(I=!0),M[L.bucketInstanceId]=!0)}return w.removeStaleBuckets(M)&&(I=!0),I}pruneUnusedLayers(r){const u={};r.forEach(m=>{u[m]=!0});for(const m in this.layerIndexes)u[m]||delete this.layerIndexes[m]}}const pl=new a.N({data:new a.O(a.L.colorTheme.data)}),ls=(p,r)=>Gi(p,r&&r.filter(u=>"source.canvas"!==u.identifier)),Hl=a.ah(Lr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Na=a.ah(Lr,["setCenter","setZoom","setBearing","setPitch"]),Ml={version:8,layers:[],sources:{}},bf={duration:300,delay:0};class ia extends a.E{constructor(r,u={}){super(),this.map=r,this.scope=u.scope||"",this.globalId=null,this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=a.W({},bf),this._buildingIndex=new dc(this),this.crossTileSymbolIndex=new Ho,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=u.styleChanges||new Ve,this.dispatcher=u.dispatcher?u.dispatcher:new a.bw(a.bx(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new ii,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new a.cM(r._requestManager,u.localFontFamily?a.cN.all:u.localIdeographFontFamily?a.cN.ideographs:a.cN.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new ar(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._config=u.config,this._initialConfig=u.initialConfig,this.dispatcher.broadcast("setReferrer",a.cO());const m=this;this._rtlTextPluginCallback=ia.registerForPluginStateChange(b=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(w,I)=>{if(a.cP(w),I&&I.every(M=>M))for(const M in m._sourceCaches){const R=m._sourceCaches[M],L=R.getSource().type;"vector"!==L&&"geojson"!==L||R.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const w=this.getOwnSource(b.sourceId);if(w&&w.vectorLayerIds)for(const I in this._layers){const M=this._layers[I];M.source===w.id&&this._validateLayer(M)}})}load(r){return r?("string"==typeof r?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if("string"==typeof r){if(a.cQ(r))return r;const u=a.cR(r);if(!u.startsWith("http"))try{return new URL(u,location.href).toString()}catch{return u}return u}return`json://${a.cS(JSON.stringify(r))}`}_diffStyle(r,u,m){this.globalId=this._getGlobalId(r);const b=(w,I)=>{try{I(null,this.setState(w,m))}catch(M){I(M,!1)}};if("string"==typeof r){const w=this.map._requestManager.normalizeStyleURL(r),I=this.map._requestManager.transformRequest(w,a.R.Style);a.g(I,(M,R)=>{M?this.fire(new a.d(M)):R&&b(R,u)})}else"object"==typeof r&&b(r,u)}loadURL(r,u={}){this.fire(new a.f("dataloading",{dataType:"style"}));const m="boolean"==typeof u.validate?u.validate:!a.cQ(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,u.accessToken),this.resolvedImports.add(r);const b=this.importsCache.get(r);if(b)return this._load(b,m);const w=this.map._requestManager.transformRequest(r,a.R.Style);this._request=a.g(w,(I,M)=>{if(this._request=null,I)this.fire(new a.d(I));else if(M)return this.importsCache.set(r,M),this._load(M,m)})}loadJSON(r,u={}){this.fire(new a.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=a.e.frame(()=>{this._request=null,this._load(r,!1!==u.validate)})}loadEmpty(){this.fire(new a.f("dataloading",{dataType:"style"})),this._load(Ml,!1)}_loadImports(r,u,m){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const b=[];for(const w of r){const I=this._createFragmentStyle(w),M=new Promise(U=>{I.once("style.import.load",U),I.once("error",U)}).then(()=>this.mergeAll());if(b.push(M),this.resolvedImports.has(w.url)){I.loadEmpty();continue}const R=w.data||this.importsCache.get(w.url);R?(I.loadJSON(R,{validate:u}),this._isInternalStyle(R)&&(I.globalId=null)):w.url?I.loadURL(w.url,{validate:u}):I.loadEmpty();const L={style:I,id:w.id,config:w.config};if(m){const U=this.fragments.findIndex(({id:G})=>G===m);this.fragments=this.fragments.slice(0,U).concat(L).concat(this.fragments.slice(U))}else this.fragments.push(L)}return Promise.allSettled(b)}getImportGlobalIds(r=this,u=new Set){for(const m of r.fragments)m.style.globalId&&u.add(m.style.globalId),this.getImportGlobalIds(m.style,u);return[...u.values()]}_createFragmentStyle(r){const u=this.scope?a.al(r.id,this.scope):r.id;let m;const b=this._initialConfig&&this._initialConfig[u];(r.config||b)&&(m=a.W({},r.config,b));const w=new ia(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:m,configOptions:this.options,configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&!1!==r.fragment)}_load(r,u){const m=r.schema;if(this._isInternalStyle(r)){const I=a.W({},Ml,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(I,u)}if(this.updateConfig(this._config,m),u&&ls(this,bt(r)))return;this._loaded=!0,this.stylesheet=a.cT(r);const b=()=>{for(const L in r.sources)this.addSource(L,r.sources[L],{validate:!1,isInitialLoad:!0});r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(r.glyphs,this.scope);const I=Vu(this.stylesheet.layers);if(this._order=I.map(L=>L.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const L=this.stylesheet.lights[0];this.light=new lt(L.properties,L.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new lt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const L of I){const U=a.cY(L,this.scope,this._styleColorTheme.lut,this.options);U.isConfigDependent&&this._configDependentLayers.add(U.fqid),U.setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize();const G=this.getOwnLayerSourceCache(U),J=!!this.directionalLight&&this.directionalLight.shadowsEnabled();G&&U.canCastShadows()&&J&&(G.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const M=this.stylesheet.terrain;M&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(M,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.f("data",{dataType:"style"}));const R=this.isRootStyle();r.imports?this._loadImports(r.imports,u).then(()=>{this._reloadImports(),this.fire(new a.f(R?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.f(R?"style.load":"style.import.load")))},w=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=w,w){const I=this._evaluateColorThemeData(w);this._loadColorTheme(I).then(()=>{b()}).catch(M=>{a.w(`Couldn't load color theme from the stylesheet: ${M}`),b()})}else this._styleColorTheme.lut=null,b()}isRootStyle(){return 0===this.importDepth}mergeAll(){let r,u,m,b,w,I,M,R;const L={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(U=>{if(U.stylesheet){if(null!=U.light&&(r=U.light),U.stylesheet.lights)for(const G of U.stylesheet.lights)"ambient"===G.type&&null!=U.ambientLight&&(u=U.ambientLight),"directional"===G.type&&null!=U.directionalLight&&(m=U.directionalLight);b=this._prioritizeTerrain(b,U.terrain,U.stylesheet.terrain),U.stylesheet.fog&&null!=U.fog&&(w=U.fog),null!=U.stylesheet.camera&&(R=U.stylesheet.camera),null!=U.stylesheet.projection&&(I=U.stylesheet.projection),null!=U.stylesheet.transition&&(M=U.stylesheet.transition),L[U.scope]=U._styleColorTheme}}),this.light=r,this.ambientLight=u,this.directionalLight=m,this.fog=w,this._styleColorThemeForScope=L,null===b?delete this.terrain:this.terrain=b,this.camera=R||{"camera-projection":"perspective"},this.projection=I||{name:"mercator"},this.transition=a.W({},bf,M),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){const u=m=>{for(const b of m.fragments)u(b.style);r(m)};u(this)}_prioritizeTerrain(r,u,m){const b=r&&0===r.drapeRenderMode;return null===m?u&&0===u.drapeRenderMode?u:b?r:null:null!=u&&(!r||b||u&&1===u.drapeRenderMode)?u:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{r=this._prioritizeTerrain(r,u.terrain,u.stylesheet.terrain)}),null===r?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(u=>{null!=u.stylesheet.projection&&(r=u.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},u={},m={};this.forEachFragmentStyle(b=>{for(const w in b._sourceCaches){const I=a.al(w,b.scope);r[I]=b._sourceCaches[w]}for(const w in b._otherSourceCaches){const I=a.al(w,b.scope);u[I]=b._otherSourceCaches[w]}for(const w in b._symbolSourceCaches){const I=a.al(w,b.scope);m[I]=b._symbolSourceCaches[w]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=m}mergeLayers(){const r={},u=[],m={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(I=>{for(const M of I._order){const R=I._layers[M];if("slot"===R.type){const L=a.cU(M);if(r[L])continue;r[L]=[]}R.slot&&r[R.slot]?r[R.slot].push(R):u.push(R)}}),this._mergedOrder=[],this._clipLayerIndices=[];let b=0;const w=(I=[])=>{for(const M of I)if("slot"===M.type){const R=a.cU(M.id);r[R]&&w(r[R]),this._mergedSlots.push(R)}else{const R=a.al(M.id,M.scope);this._mergedOrder.push(R),m[R]=M,M.is3D()&&(this._has3DLayers=!0),"circle"===M.type&&(this._hasCircleLayers=!0),"symbol"===M.type&&(this._hasSymbolLayers=!0),"clip"===M.type&&this._clipLayerIndices.push(b),b++}};w(u),this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=a.W({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(u,m,b){const w=a.W({},m);for(const M of Object.keys(a.L.colorTheme))void 0===w[M]&&(w[M]=a.L.colorTheme[M].default);const I=new a.U(pl,u,new Map(b));return I.setTransitionOrValue(w,b),I.untransitioned().possiblyEvaluate(new a.X(0))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const u=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((m,b)=>{const w="data:image/png;base64,";if(!r||0===r.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void m();let I=r;I.startsWith(w)||(I=w+I);const M="mapbox-reserved-lut",R=new Image;R.src=I,R.onerror=()=>{this._styleColorTheme.lutLoading=!1,b(new Error("Failed to load image data"))},R.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==u)return void m();this._styleColorTheme.lutLoading=!1;const{width:L,height:U,data:G}=a.e.getImageData(R);if(U>32)return void b(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==U*U)return void b(new Error("The width of the image must be equal to the height squared."));this.getImage(M)&&this.removeImage(M),this.addImage(M,{data:new a.i({width:L,height:U},G),pixelRatio:1,sdf:!1,version:0});const J=this.imageManager.getImage(M,this.scope);J?(this._styleColorTheme.lut={image:J.data,data:r},m()):b(new Error("Missing LUT image."))}})}getLut(r){const u=this._styleColorThemeForScope[r];return u?u.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(u,m,b){let w,I,M;const R=a.e.devicePixelRatio>1?"@2x":"";let L=a.g(m.transformRequest(m.normalizeSpriteURL(u,R,".json"),a.R.SpriteJSON),(J,Q)=>{L=null,M||(M=J,w=Q,G())}),U=a.h(m.transformRequest(m.normalizeSpriteURL(u,R,".png"),a.R.SpriteImage),(J,Q)=>{U=null,M||(M=J,I=Q,G())});function G(){if(M)b(M);else if(w&&I){const J=a.e.getImageData(I),Q={};for(const le in w){const{width:de,height:ge,x:xe,y:Ke,sdf:Qe,pixelRatio:et,stretchX:yt,stretchY:_t,content:St}=w[le],Ee=new a.i({width:de,height:ge});a.i.copy(J,Ee,{x:xe,y:Ke},{x:0,y:0},{width:de,height:ge},null),Q[le]={data:Ee,pixelRatio:et,sdf:Qe,stretchX:yt,stretchY:_t,content:St}}b(null,Q)}}return{cancel(){L&&(L.cancel(),L=null),U&&(U.cancel(),U=null)}}}(r,this.map._requestManager,(u,m)=>{if(this._spriteRequest=null,u)this.fire(new a.d(u));else if(m)for(const b in m)this.imageManager.addImage(b,this.scope,m[b]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.f("data",{dataType:"style"}))})}_validateLayer(r){const u=this.getOwnSource(r.source);if(!u)return;const m=r.sourceLayer;m&&("geojson"===u.type||u.vectorLayerIds&&-1===u.vectorLayerIds.indexOf(m))&&this.fire(new a.d(new Error(`Source layer "${m}" does not exist on source "${u.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,u)=>{const m=this.fragments[u];return m&&m.style&&(r.data=m.style.serialize()),r})}_serializeSources(){const r={};for(const u in this._sourceCaches){const m=this._sourceCaches[u].getSource();r[m.id]||(r[m.id]=m.serialize())}return r}_serializeLayers(r){const u=[];for(const m of r){const b=this._layers[m];b&&"custom"!==b.type&&u.push(b.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const u=this.getOwnLayer(r);if(u)return u;this.fire(new a.d(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const u=this.getOwnSource(r);if(u)return u;this.fire(new a.d(new Error(`The source '${r}' does not exist in the map's style.`)))}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const u=this.calculateLightsBrightness();r.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u));const m=this._changes.isDirty();let b=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const M in I){const{updatedIds:R,removedIds:L}=I[M];(R||L)&&(this._updateWorkerLayers(M,R,L),b=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._changes.reset()}const w={};for(const I in this._mergedSourceCaches){const M=this._mergedSourceCaches[I];w[I]=M.used,M.used=!1,M.tileCoverLift=0}for(const I of this._mergedOrder){const M=this._mergedLayers[I];if(M.recalculate(r,this._availableImages),!M.isHidden(r.zoom)){const R=this.getLayerSourceCache(M);R&&(R.used=!0,R.tileCoverLift=Math.max(R.tileCoverLift,M.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let R=M.minzoom||0;R<(M.maxzoom||25.5);R++){const L=this.map.painter;if(L){const U=M.getProgramIds();if(!U)continue;for(const G of U){const J=M.getDefaultProgramParams(G,r.zoom,this._styleColorTheme.lut);J&&(L.style=this,this.fog&&(L._fogVisible=!0,J.overrideFog=!0,L.getOrCreateProgram(G,J)),L._fogVisible=!1,J.overrideFog=!1,L.getOrCreateProgram(G,J),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(J.overrideRtt=!0,L.getOrCreateProgram(G,J)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&b&&this.mergeLayers();for(const I in w){const M=this._mergedSourceCaches[I];w[I]!==M.used&&M.getSource().fire(new a.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),m&&this.fire(new a.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=this._changes.getUpdatedImages();if(r.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],r);this._changes.resetUpdatedImages()}}_updateWorkerLayers(r,u,m){const b=this.getFragmentStyle(r);b&&this.dispatcher.broadcast("updateLayers",{layers:u?b._serializeLayers(u):[],scope:r,removedIds:m||[],options:b.options})}setState(r,u){if(this._checkLoaded(),ls(this,bt(r)))return!1;(r=a.cT(r)).layers=Vu(r.layers);const m=function(I,M){if(!I)return[{command:Lr.setStyle,args:[M]}];let R=[];try{if(!Z(I.version,M.version))return[{command:Lr.setStyle,args:[M]}];if(Z(I.center,M.center)||R.push({command:Lr.setCenter,args:[M.center]}),Z(I.zoom,M.zoom)||R.push({command:Lr.setZoom,args:[M.zoom]}),Z(I.bearing,M.bearing)||R.push({command:Lr.setBearing,args:[M.bearing]}),Z(I.pitch,M.pitch)||R.push({command:Lr.setPitch,args:[M.pitch]}),Z(I.sprite,M.sprite)||R.push({command:Lr.setSprite,args:[M.sprite]}),Z(I.glyphs,M.glyphs)||R.push({command:Lr.setGlyphs,args:[M.glyphs]}),Z(I.imports,M.imports)||function(Q=[],le=[],de){le=le||[];const ge=(Q=Q||[]).map($u),xe=le.map($u),Ke=Q.reduce(Gl,{}),Qe=le.reduce(Gl,{}),et=ge.slice();let yt,_t,St,Ee;for(yt=0,_t=0;yt<ge.length;yt++)St=ge[yt],Qe.hasOwnProperty(St)?_t++:(de.push({command:Lr.removeImport,args:[St]}),et.splice(et.indexOf(St,_t),1));for(yt=0,_t=0;yt<xe.length;yt++)St=xe[xe.length-1-yt],et[et.length-1-yt]!==St&&(Ke.hasOwnProperty(St)?(de.push({command:Lr.removeImport,args:[St]}),et.splice(et.lastIndexOf(St,et.length-_t),1)):_t++,Ee=et[et.length-yt],de.push({command:Lr.addImport,args:[Qe[St],Ee]}),et.splice(et.length-yt,0,St));for(const tt of le){const Lt=Ke[tt.id];Lt&&!Z(Lt,tt)&&de.push({command:Lr.updateImport,args:[tt.id,tt]})}}(I.imports,M.imports,R),Z(I.transition,M.transition)||R.push({command:Lr.setTransition,args:[M.transition]}),Z(I.light,M.light)||R.push({command:Lr.setLight,args:[M.light]}),Z(I.fog,M.fog)||R.push({command:Lr.setFog,args:[M.fog]}),Z(I.projection,M.projection)||R.push({command:Lr.setProjection,args:[M.projection]}),Z(I.lights,M.lights)||R.push({command:Lr.setLights,args:[M.lights]}),Z(I.camera,M.camera)||R.push({command:Lr.setCamera,args:[M.camera]}),!Z(I["color-theme"],M["color-theme"]))return[{command:Lr.setStyle,args:[M]}];const L={},U=[];!function(Q,le,de,ge){let xe;for(xe in le=le||{},Q=Q||{})Q.hasOwnProperty(xe)&&(le.hasOwnProperty(xe)||el(xe,de,ge));for(xe in le){if(!le.hasOwnProperty(xe))continue;const Ke=le[xe];Q.hasOwnProperty(xe)?Z(Q[xe],Ke)||("geojson"===Q[xe].type&&"geojson"===Ke.type&&vf(Q,le,xe)?de.push({command:Lr.setGeoJSONSourceData,args:[xe,Ke.data]}):Lc(xe,le,de,ge)):dl(xe,le,de)}}(I.sources,M.sources,U,L);const G=[];I.layers&&I.layers.forEach(Q=>{Q.source&&L[Q.source]?R.push({command:Lr.removeLayer,args:[Q.id]}):G.push(Q)});let J=I.terrain;J&&L[J.source]&&(R.push({command:Lr.setTerrain,args:[void 0]}),J=void 0),R=R.concat(U),Z(J,M.terrain)||R.push({command:Lr.setTerrain,args:[M.terrain]}),function(Q,le,de){le=le||[];const ge=(Q=Q||[]).map($u),xe=le.map($u),Ke=Q.reduce(Gl,{}),Qe=le.reduce(Gl,{}),et=ge.slice(),yt=Object.create(null);let _t,St,Ee,tt,Lt,sn,zt;for(_t=0,St=0;_t<ge.length;_t++)Ee=ge[_t],Qe.hasOwnProperty(Ee)?St++:(de.push({command:Lr.removeLayer,args:[Ee]}),et.splice(et.indexOf(Ee,St),1));for(_t=0,St=0;_t<xe.length;_t++)Ee=xe[xe.length-1-_t],et[et.length-1-_t]!==Ee&&(Ke.hasOwnProperty(Ee)?(de.push({command:Lr.removeLayer,args:[Ee]}),et.splice(et.lastIndexOf(Ee,et.length-St),1)):St++,sn=et[et.length-_t],de.push({command:Lr.addLayer,args:[Qe[Ee],sn]}),et.splice(et.length-_t,0,Ee),yt[Ee]=!0);for(_t=0;_t<xe.length;_t++)if(Ee=xe[_t],tt=Ke[Ee],Lt=Qe[Ee],!yt[Ee]&&!Z(tt,Lt))if(Z(tt.source,Lt.source)&&Z(tt["source-layer"],Lt["source-layer"])&&Z(tt.type,Lt.type)){for(zt in Ld(tt.layout,Lt.layout,de,Ee,null,Lr.setLayoutProperty),Ld(tt.paint,Lt.paint,de,Ee,null,Lr.setPaintProperty),Z(tt.slot,Lt.slot)||de.push({command:Lr.setSlot,args:[Ee,Lt.slot]}),Z(tt.filter,Lt.filter)||de.push({command:Lr.setFilter,args:[Ee,Lt.filter]}),Z(tt.minzoom,Lt.minzoom)&&Z(tt.maxzoom,Lt.maxzoom)||de.push({command:Lr.setLayerZoomRange,args:[Ee,Lt.minzoom,Lt.maxzoom]}),tt)tt.hasOwnProperty(zt)&&"layout"!==zt&&"paint"!==zt&&"filter"!==zt&&"metadata"!==zt&&"minzoom"!==zt&&"maxzoom"!==zt&&"slot"!==zt&&(0===zt.indexOf("paint.")?Ld(tt[zt],Lt[zt],de,Ee,zt.slice(6),Lr.setPaintProperty):Z(tt[zt],Lt[zt])||de.push({command:Lr.setLayerProperty,args:[Ee,zt,Lt[zt]]}));for(zt in Lt)Lt.hasOwnProperty(zt)&&!tt.hasOwnProperty(zt)&&"layout"!==zt&&"paint"!==zt&&"filter"!==zt&&"metadata"!==zt&&"minzoom"!==zt&&"maxzoom"!==zt&&"slot"!==zt&&(0===zt.indexOf("paint.")?Ld(tt[zt],Lt[zt],de,Ee,zt.slice(6),Lr.setPaintProperty):Z(tt[zt],Lt[zt])||de.push({command:Lr.setLayerProperty,args:[Ee,zt,Lt[zt]]}))}else de.push({command:Lr.removeLayer,args:[Ee]}),sn=et[et.lastIndexOf(Ee)+1],de.push({command:Lr.addLayer,args:[Lt,sn]})}(G,M.layers,R)}catch(L){console.warn("Unable to compute style diff:",L),R=[{command:Lr.setStyle,args:[M]}]}return R}(this.serialize(),r).filter(I=>!(I.command in Na));if(0===m.length)return!1;const b=m.filter(I=>!(I.command in Hl));if(b.length>0)throw new Error(`Unimplemented: ${b.map(I=>I.command).join(", ")}.`);const w=[];return m.forEach(I=>{w.push(this[I.command].apply(this,I.args))}),u&&Promise.all(w).then(u),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(r,u){return this.getImage(r)?this.fire(new a.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,this.scope,u),this._afterImageUpdated(r),this)}updateImage(r,u){this.imageManager.updateImage(r,this.scope,u)}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._afterImageUpdated(r),this):this.fire(new a.d(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(r),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new a.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(r,u,m={}){return this._checkLoaded(),this._validate(qi,`models.${r}`,u,null,m)||(this.modelManager.addModel(r,u,this.scope),this._changes.setDirty()),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope),this):this.fire(new a.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,u,m={}){if(this._checkLoaded(),void 0!==this.getOwnSource(r))throw new Error(`There is already a source with ID "${r}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(gt,`sources.${r}`,u,null,m))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const b=Vo(r,u,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id}));const w=I=>{const M=(I?"symbol:":"other:")+b.id,R=a.al(M,this.scope),L=this._sourceCaches[M]=new a.bv(R,b,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=L,L.onAdd(this.map)};w(!1),"vector"!==u.type&&"geojson"!==u.type||w(!0),b.onAdd&&b.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const u=this.getOwnSource(r);if(!u)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===r)return this.fire(new a.d(new Error(`Source "${r}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new a.d(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const m=this.getOwnSourceCaches(r);for(const b of m){const w=a.cU(b.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(b.id),b.fire(new a.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,u){this._checkLoaded(),this.getOwnSource(r).setData(u),this._changes.setDirty()}getOwnSource(r){const u=this.getOwnSourceCache(r);return u&&u.getSource()}getOwnSources(){const r=[];for(const u in this._otherSourceCaches){const m=this.getOwnSourceCache(u);m&&r.push(m.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const u in r){const m=r[u]._tiles;for(const b in m){const w=m[b];if("loaded"!==w.state&&"errored"!==w.state)return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const u=this._getTransitionParameters();for(const b of r){if(this._validate(rn,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(b),w.updateTransitions(u)}else this.ambientLight=new Ri(b,pi,this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(b),w.updateTransitions(u)}else this.directionalLight=new Ri(b,Ti,this.scope,this.options)}}const m=new a.X(this.z||0,u);this.ambientLight&&this.ambientLight.recalculate(m),this.directionalLight&&this.directionalLight.recalculate(m),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,u=this.ambientLight;if(!r||!u)return;const m=G=>.2126*(G[0]<=.03928?G[0]/12.92:Math.pow((G[0]+.055)/1.055,2.4))+.7152*(G[1]<=.03928?G[1]/12.92:Math.pow((G[1]+.055)/1.055,2.4))+.0722*(G[2]<=.03928?G[2]/12.92:Math.pow((G[2]+.055)/1.055,2.4)),b=r.properties.get("color").toRenderColor(null).toArray01(),w=r.properties.get("intensity"),I=r.properties.get("direction"),M=1-a.ac(I.x,I.y,I.z)[2]/90,R=m(b)*w*M,L=u.properties.get("color").toRenderColor(null).toArray01(),U=u.properties.get("intensity");return(R+m(L)*U)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(!r)return this;if(a.cV(r)){const u=a.cW(r),m=this.fragments.find(({id:w})=>w===u);if(!m)throw new Error(`Style import not found: ${r}`);const b=a.cU(r);return m.style.getFragmentStyle(b)}{const u=this.fragments.find(({id:m})=>m===r);if(!u)throw new Error(`Style import not found: ${r}`);return u.style}}getConfigProperty(r,u){const m=this.getFragmentStyle(r);if(!m)return null;const b=a.al(u,m.scope),w=m.options.get(b),I=w?w.value||w.default:null;return I?I.serialize():null}setConfigProperty(r,u,m){const b=this.getFragmentStyle(r);if(!b)return;const w=b.stylesheet.schema;if(!w||!w[u])return;const I=a.y(m);if("success"!==I.result)return void ls(this,I.value);const M=I.value.expression,R=a.al(u,b.scope),L=b.options.get(R);if(!L)return;let U;const{minValue:G,maxValue:J,stepValue:Q,type:le,values:de}=w[u],ge=a.y(w[u].default);"success"===ge.result&&(U=ge.value.expression),U?(this.options.set(R,{...L,value:M,default:U,minValue:G,maxValue:J,stepValue:Q,type:le,values:de}),this.updateConfigDependencies()):this.fire(new a.d(new Error(`No schema defined for the config option "${u}" in the "${r}" fragment.`)))}getConfig(r){const u=this.getFragmentStyle(r);if(!u)return null;const m=u.stylesheet.schema;if(!m)return null;const b={};for(const w in m){const I=a.al(w,u.scope),M=u.options.get(I),R=M?M.value||M.default:null;b[w]=R?R.serialize():null}return b}setConfig(r,u){const m=this.getFragmentStyle(r);m&&(m.updateConfig(u,m.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){const u=this.getFragmentStyle(r);return u?u.stylesheet.schema:null}setSchema(r,u){const m=this.getFragmentStyle(r);m&&(m.stylesheet.schema=u,m.updateConfig(m._config,u),this.updateConfigDependencies())}updateConfig(r,u){if(this._config=r,r||u)if(u)for(const m in u){let b,w;const I=a.y(u[m].default);if("success"===I.result&&(b=I.value.expression),r&&void 0!==r[m]){const J=a.y(r[m]);"success"===J.result&&(w=J.value.expression)}const{minValue:M,maxValue:R,stepValue:L,type:U,values:G}=u[m];if(b){const J=a.al(m,this.scope);this.options.set(J,{default:b,value:w,minValue:M,maxValue:R,stepValue:L,type:U,values:G})}else this.fire(new a.d(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new a.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const r of this._configDependentLayers){const u=this.getLayer(r);u&&(u.possiblyEvaluateVisibility(),this._updateLayer(u))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(r=>{if(r._styleColorTheme.colorTheme){const u=r._evaluateColorThemeData(r._styleColorTheme.colorTheme);(!r._styleColorTheme.lut||r._styleColorTheme.lut&&u!==r._styleColorTheme.lut.data)&&r.setColorTheme(r._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(r,u,m={}){this._checkLoaded();const b=r.id;if(this._layers[b])return void this.fire(new a.d(new Error(`Layer with id "${b}" already exists on this map`)));let w;if("custom"===r.type){if(ls(this,a.cX(r)))return;w=a.cY(r,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof r.source&&(this.addSource(b,r.source),r=a.cT(r),r=a.W(r,{source:b})),this._validate(Un,`layers.${b}`,r,{arrayIndex:-1},m))return;w=a.cY(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[w.id]=w.serialize()}w.isConfigDependent&&this._configDependentLayers.add(w.fqid);let I=this._order.length;if(u){const U=this._order.indexOf(u);if(-1===U)return void this.fire(new a.d(new Error(`Layer with id "${u}" does not exist on this map.`)));w.slot===this._layers[u].slot?I=U:a.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(I,0,b),this._layerOrderChanged=!0,this._layers[b]=w;const M=this.getOwnLayerSourceCache(w),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&w.canCastShadows()&&R&&(M.castsShadows=!0);const L=this._changes.getRemovedLayer(w);if(L&&w.source&&M&&"custom"!==w.type){this._changes.discardLayerRemoval(w);const U=a.al(w.source,w.scope);L.type!==w.type?this._changes.updateSourceCache(U,"clear"):(this._changes.updateSourceCache(U,"reload"),M.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(r,u){this._checkLoaded();const m=this._checkLayer(r);if(!m||r===u)return;const b=this._order.indexOf(r);this._order.splice(b,1);let w=this._order.length;if(u){const I=this._order.indexOf(u);if(-1===I)return void this.fire(new a.d(new Error(`Layer with id "${u}" does not exist on this map.`)));m.slot===this._layers[u].slot?w=I:a.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const u=this._checkLayer(r);if(!u)return;u.setEventedParent(null);const m=this._order.indexOf(r);this._order.splice(m,1),delete this._layers[r],delete this._serializedLayers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(u.fqid),this._changes.removeLayer(u);const b=this.getOwnLayerSourceCache(u);if(b&&b.castsShadows){let w=!1;for(const I in this._layers)if(this._layers[I].source===u.source&&this._layers[I].canCastShadows()){w=!0;break}b.castsShadows=w}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const u in this._layers)if(this._layers[u].type===r)return!0;return!1}setLayerZoomRange(r,u,m){this._checkLoaded();const b=this._checkLayer(r);b&&(b.minzoom===u&&b.maxzoom===m||(null!=u&&(b.minzoom=u),null!=m&&(b.maxzoom=m),this._updateLayer(b)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,u){this._checkLoaded();const m=this._checkLayer(r);m&&m.slot!==u&&(m.slot=u,this._updateLayer(m))}setFilter(r,u,m={}){this._checkLoaded();const b=this._checkLayer(r);if(b&&!Z(b.filter,u))return null==u?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(zn,`layers.${b.id}.filter`,u,{layerType:b.type},m)||(b.filter=a.cT(u),this._updateLayer(b)))}getFilter(r){const u=this._checkLayer(r);if(u)return a.cT(u.filter)}setLayoutProperty(r,u,m,b={}){this._checkLoaded();const w=this._checkLayer(r);if(w&&!Z(w.getLayoutProperty(u),m)){if(null!=m&&(!b||!1!==b.validate)&&ls(w,Ui.call(bt,{key:`layers.${r}.layout.${u}`,layerType:w.type,objectKey:u,value:m,styleSpec:a.L,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(u,m),w.isConfigDependent&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(r,u){const m=this._checkLayer(r);if(m)return m.getLayoutProperty(u)}setPaintProperty(r,u,m,b={}){this._checkLoaded();const w=this._checkLayer(r);if(!w||Z(w.getPaintProperty(u),m)||null!=m&&(!b||!1!==b.validate)&&ls(w,Ei.call(bt,{key:`layers.${r}.paint.${u}`,layerType:w.type,objectKey:u,value:m,styleSpec:a.L})))return;const I=w.setPaintProperty(u,m);w.isConfigDependent&&this._configDependentLayers.add(w.fqid),I&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(r,u){const m=this._checkLayer(r);if(m)return m.getPaintProperty(u)}setFeatureState(r,u){this._checkLoaded();const m=r.source,b=r.sourceLayer,w=this._checkSource(m);if(!w)return;const I=w.type;if("geojson"===I&&b)return void this.fire(new a.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!b)return void this.fire(new a.d(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new a.d(new Error("The feature id parameter must be provided.")));const M=this.getOwnSourceCaches(m);for(const R of M)R.setFeatureState(b,r.id,u)}removeFeatureState(r,u){this._checkLoaded();const m=r.source,b=this._checkSource(m);if(!b)return;const w=b.type,I="vector"===w?r.sourceLayer:void 0;if("vector"===w&&!I)return void this.fire(new a.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new a.d(new Error("A feature id is required to remove its specific state property.")));const M=this.getOwnSourceCaches(m);for(const R of M)R.removeFeatureState(I,r.id,u)}getFeatureState(r){this._checkLoaded();const u=r.source,m=r.sourceLayer,b=this._checkSource(u);if(b){if("vector"!==b.type||m)return void 0===r.id&&this.fire(new a.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(m,r.id);this.fire(new a.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=a.W({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return a.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),u=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return a.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},m=>void 0!==m)}_updateLayer(r){this._changes.updateLayer(r);const u=this.getLayerSourceCache(r),m=a.al(r.source,r.scope),b=this._changes.getUpdatedSourceCaches();r.source&&!b[m]&&u&&"raster"!==u.getSource().type&&(this._changes.updateSourceCache(m,"reload"),u.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const u=M=>"fill-extrusion"===this._mergedLayers[M].type||"model"===this._mergedLayers[M].type,m=this.order,b={},w=[];for(let M=m.length-1;M>=0;M--){const R=m[M];if(u(R)){b[R]=M;for(const L of r){const U=L[R];if(U)for(const G of U)w.push(G)}}}w.sort((M,R)=>R.intersectionZ-M.intersectionZ);const I=[];for(let M=m.length-1;M>=0;M--){const R=m[M];if(u(R))for(let L=w.length-1;L>=0;L--){const U=w[L].feature;if(U.layer&&b[U.layer.id]<M)break;I.push(U),w.pop()}else for(const L of r){const U=L[R];if(U)for(const G of U)I.push(G.feature)}}return I}queryRenderedFeatures(r,u,m){u&&u.filter&&this._validate(zn,"queryRenderedFeatures.filter",u.filter,null,u),u.scope=this.scope,u.availableImages=this._availableImages,u.serializedLayers=this._serializedLayers;const b={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new a.d(new Error("parameters.layers must be an Array."))),[];for(const L of u.layers){const U=this._mergedLayers[L];if(!U)return this.fire(new a.d(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];b[U.source]=!0}}const w=[],I=u.serializedLayers||{},M=u&&u.layers?u.layers.some(L=>{const U=this.getLayer(L);return U&&U.is3D()}):this.has3DLayers(),R=Hs.createFromScreenPoints(r,m);for(const L in this._mergedSourceCaches){const U=this._mergedSourceCaches[L].getSource();if(!U||U.scope!==u.scope)continue;const G=this._mergedSourceCaches[L].getSource().id;u.layers&&!b[G]||w.push(ka(this._mergedSourceCaches[L],this._mergedLayers,I,R,u,m,M,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(L,U,G,J,Q,le,de){const ge={},xe=le.queryRenderedSymbols(J),Ke=[];for(const Qe of Object.keys(xe).map(Number))Ke.push(de[Qe]);Ke.sort(Fa);for(const Qe of Ke){const et=Qe.featureIndex.lookupSymbolFeatures(xe[Qe.bucketInstanceId],U,Qe.bucketIndex,Qe.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,L);for(const yt in et){const _t=ge[yt]=ge[yt]||[],St=et[yt];St.sort((Ee,tt)=>{const Lt=Qe.featureSortOrder;if(Lt){const sn=Lt.indexOf(Ee.featureIndex);return Lt.indexOf(tt.featureIndex)-sn}return tt.featureIndex-Ee.featureIndex});for(const Ee of St)_t.push(Ee)}}for(const Qe in ge)ge[Qe].forEach(et=>{const yt=et.feature,_t=G(L[Qe]);if(!_t)return;const St=_t.getFeatureState(yt.layer["source-layer"],yt.id);yt.source=yt.layer.source,yt.layer["source-layer"]&&(yt.sourceLayer=yt.layer["source-layer"]),yt.state=St});return ge}(this._mergedLayers,I,this.getLayerSourceCache.bind(this),R.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(r,u){u&&u.filter&&this._validate(zn,"querySourceFeatures.filter",u.filter,null,u);const m=this.getOwnSourceCaches(r);let b=[];for(const w of m)b=b.concat(Ao(w,u));return b}addSourceType(r,u,m){return ia.getSourceType(r)?m(new Error(`A source type called "${r}" already exists.`)):(ia.setSourceType(r,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:u.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,u,m={}){this._checkLoaded();const b=this.light.getLight();let w=!1;for(const M in r)if(!Z(r[M],b[M])){w=!0;break}if(!w)return;const I=this._getTransitionParameters();this.light.setLight(r,u,m),this.light.updateTransitions(I)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=a.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,u=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()&&0!==u||delete this.terrain,null===r?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let m=r;const b=null==r.source;if(1===u){if(this.disableElevatedTerrain)return;if("object"==typeof m.source){const M="terrain-dem-src";this.addSource(M,m.source),m=a.cT(m),m=a.W(m,{source:M})}const w=a.W({},m),I={};if(this.terrain&&b){w.source=this.terrain.get().source;const M=this.terrain?this.getFragmentStyle(this.terrain.scope):null;M&&(I.style=M.serialize())}if(this._validate(Ft,"terrain",w,I))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&u!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,u),this.fire(new a.f("data",{dataType:"style"}))}else{const w=this.terrain,I=w.get();for(const M of Object.keys(a.L.terrain))!m.hasOwnProperty(M)&&a.L.terrain[M].default&&(m[M]=a.L.terrain[M].default);for(const M in r)if(!Z(r[M],I[M])){w.set(r,this.options),this.stylesheet.terrain=r;const R=this._getTransitionParameters({duration:0});w.updateTransitions(R),this.fire(new a.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const u=this.fog=new Ai(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog;if(!Z(u.get(),r)){u.set(r,this.options),this.stylesheet.fog=u.get();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}}else this._createFog(r);this._markersNeedUpdate=!0}setColorTheme(r){this._checkLoaded();const u=()=>{for(const b in this._layers)this._layers[b].lut=this._styleColorTheme.lut;for(const b in this._sourceCaches)this._sourceCaches[b].clearTiles()};if(this._styleColorTheme.colorTheme=r,!r)return this._styleColorTheme.lut=null,void u();const m=this._evaluateColorThemeData(r);this._loadColorTheme(m).then(()=>{this.fire(new a.f("colorthemeset")),u()}).catch(b=>{a.w(`Couldn't set color theme: ${b}`)})}_getTransitionParameters(r){return{now:a.e.now(),transition:a.W(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],u=[];for(const m in this._mergedLayers)this.isLayerDraped(this._mergedLayers[m])?r.push(m):u.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...u)}_createTerrain(r,u){const m=this.terrain=new we(r,u,this.scope,this.options);1===u&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const b=this._getTransitionParameters({duration:0});m.updateTransitions(b)}_force3DLayerUpdate(){for(const r in this._layers){const u=this._layers[r];"fill-extrusion"===u.type&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const u=this._layers[r];"symbol"===u.type&&this._updateLayer(u)}}_validate(r,u,m,b,w={}){if(w&&!1===w.validate)return!1;const I=a.W({},this.serialize());return ls(this,r.call(bt,a.W({key:u,style:I,value:m,styleSpec:a.L},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(r){const u=this.getSourceCaches(r);for(const m of u)m.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}reloadSource(r){const u=this.getSourceCaches(r);for(const m of u)m.resume(),m.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}updateSources(r){let u;this.directionalLight&&(u=Ka(this.directionalLight));for(const m in this._mergedSourceCaches)this._mergedSourceCaches[m].update(r,void 0,void 0,u)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const u=this._sourceCaches[r];u.resume(),u.reload()}}_updatePlacement(r,u,m,b,w,I,M=!1){let R=!1,L=!1;const U={},G={};for(const Q of this._mergedOrder){const le=this._mergedLayers[Q];if("symbol"!==le.type)continue;const de=a.al(le.source,le.scope);let ge=U[de];if(!ge){const Ke=this.getLayerSourceCache(le);if(!Ke)continue;const Qe=Ke.getRenderableIds(!0).map(et=>Ke.getTileByID(et));G[de]=Qe.slice(),ge=U[de]=Qe.sort((et,yt)=>yt.tileID.overscaledZ-et.tileID.overscaledZ||(et.tileID.isLessThan(yt.tileID)?-1:1))}const xe=this.crossTileSymbolIndex.addLayer(le,ge,u.center.lng,u.projection);R=R||xe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),M=M||this._layerOrderChanged||0===b,this._layerOrderChanged&&this.fire(new a.f("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.e.now(),u.zoom))&&(this.pauseablePlacement=new un(u,this._mergedOrder,M,m,b,w,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,U,G),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.e.now()),L=!0),R&&this.pauseablePlacement.placement.setStale()),L||R){this._buildingIndex.onNewFrame(u.zoom);for(let Q=0;Q<this._mergedOrder.length;Q++){const le=this._mergedLayers[this._mergedOrder[Q]];if("symbol"!==le.type)continue;const de=this.isLayerClipped(le)&&this._clipLayerIndices.some(ge=>Q<ge);this.placement.updateLayerOpacities(le,U[a.al(le.source,le.scope)],Q,de?I:null)}}let J=!1;for(const Q of this._mergedOrder){const le=this._mergedLayers[Q];if("symbol"!==le.type)continue;const de=U[a.al(le.source,le.scope)];for(const ge of de){const xe=ge.getBucket(le);xe&&ge.latestFeatureIndex&&le.fqid===xe.layerIds[0]&&(J=xe.updateOcclusionOpacities(r.context,r.symbolParams,r._dt)||J)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.e.now())||J,occlusionQueryBasedOpacityChanged:J}}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,u){this._checkLoaded();const m=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==m.findIndex(({id:w})=>w===r.id))return void this.fire(new a.d(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!u)return m.push(r),this._loadImports([r],!0);const b=m.findIndex(({id:w})=>w===u);return-1===b&&this.fire(new a.d(new Error(`Import with id "${u}" does not exist on this map.`))),this.stylesheet.imports=m.slice(0,b).concat(r).concat(m.slice(b)),this._loadImports([r],!0,u)}updateImport(r,u){this._checkLoaded();const m=this.stylesheet.imports||[],b=this.getImportIndex(r);return-1===b?this:"string"==typeof u?(this.setImportUrl(r,u),this):(u.url&&u.url!==m[b].url&&this.setImportUrl(r,u.url),Z(u.config,m[b].config)||this.setImportConfig(r,u.config),Z(u.data,m[b].data)||this.setImportData(r,u.data),this)}moveImport(r,u){this._checkLoaded();let m=this.stylesheet.imports||[];const b=this.getImportIndex(r);if(-1===b)return this;const w=this.getImportIndex(u);if(-1===w)return this;const I=m[b],M=this.fragments[b];return m=m.filter(({id:R})=>R!==r),this.fragments=this.fragments.filter(({id:R})=>R!==r),this.stylesheet.imports=m.slice(0,w).concat(I).concat(m.slice(w)),this.fragments=this.fragments.slice(0,w).concat(M).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(r,u){this._checkLoaded();const m=this.stylesheet.imports||[],b=this.getImportIndex(r);if(-1===b)return this;m[b].url=u;const w=this.fragments[b];return w.style=this._createFragmentStyle(m[b]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(u),this}setImportData(r,u){this._checkLoaded();const m=this.getImportIndex(r),b=this.stylesheet.imports||[];return-1===m?this:u?(this.fragments[m].style.setState(u),this._reloadImports(),this):(delete b[m].data,this.setImportUrl(r,b[m].url))}setImportConfig(r,u){this._checkLoaded();const m=this.getImportIndex(r),b=this.stylesheet.imports||[];if(-1===m)return this;u?b[m].config=u:delete b[m].config;const w=this.fragments[m],I=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=u,w.style.updateConfig(u,I),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const u=this.stylesheet.imports||[],m=this.getImportIndex(r);-1!==m&&(u.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports())}getImportIndex(r){const u=(this.stylesheet.imports||[]).findIndex(m=>m.id===r);return-1===u&&this.fire(new a.d(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),u}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const u in this._mergedOtherSourceCaches){const m=this._mergedOtherSourceCaches[u];m&&r.push(m.getSource())}return r}getSource(r,u){const m=this.getSourceCache(r,u);return m&&m.getSource()}getLayerSource(r){const u=this.getLayerSourceCache(r);return u&&u.getSource()}getSourceCache(r,u){const m=a.al(r,u);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(r){const u=a.al(r.source,r.scope);return"symbol"===r.type?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(r){if(null==r)return Object.values(this._mergedSourceCaches);const u=[];return this._mergedOtherSourceCaches[r]&&u.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&u.push(this._mergedSymbolSourceCaches[r]),u}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const u in r){const m=r[u];"reload"===m?this.reloadSource(u):"clear"===m&&this.clearSource(u)}}updateLayers(r){const u=this._changes.getUpdatedPaintProperties();for(const m of u){const b=this.getLayer(m);b&&b.updateTransitions(r)}}getImages(r,u,m){this.imageManager.getImages(u.icons,u.scope,m),this._updateTilesForChangedImages();const b=w=>{w&&w.setDependencies(u.tileID.key,u.type,u.icons)};b(this._otherSourceCaches[u.source]),b(this._symbolSourceCaches[u.source])}getGlyphs(r,u,m){this.glyphManager.getGlyphs(u.stacks,u.scope,m)}getResource(r,u,m){return a.c$(u,m)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const u=[];return this._otherSourceCaches[r]&&u.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&u.push(this._symbolSourceCaches[r]),u}_isSourceCacheLoaded(r){const u=this.getOwnSourceCaches(r);return 0===u.length?(this.fire(new a.d(new Error(`There is no source with ID '${r}'`))),!1):u.every(m=>m.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,u){if(0===this._clipLayerIndices.length&&"fill-extrusion"!==r.type)return!1;const m="fill-extrusion"===r.type&&"building"===r.sourceLayer;let b=0;if(r.is3D()){if(m||u&&"batched-model"===u.type)return!0;"model"===r.type&&(b=a.cu.Model)}else"symbol"===r.type&&(b=a.cu.Symbol);for(const w of this._clipLayerIndices){const I=this._mergedLayers[this._mergedOrder[w]];if(!I)continue;const M=[];for(const R of I.layout.get("clip-layer-types"))M.push("model"===R?a.cu.Model:"symbol"===R?a.cu.Symbol:a.cu.FillExtrusion);for(const R of M)if(b&R)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Dp(p,r){let u=!1,m=null;const b=()=>{m=null,u&&(p(),m=setTimeout(b,r),u=!1)};return()=>(u=!0,m||b(),m)}ia.getSourceType=function(p){return rc[p]},ia.setSourceType=function(p,r){rc[p]=r},ia.registerForPluginStateChange=a.cL;class Ih{constructor(r){this._hashName=r&&encodeURIComponent(r),a.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Dp(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const u=iy(r);if(this._hashName){const m=this._hashName;let b=!1;const w=location.hash.slice(1).split("&").map(I=>{const M=I.split("=")[0];return M===m?(b=!0,`${M}=${u}`):I}).filter(I=>I);return b||w.push(`${m}=${u}`),`#${w.join("&")}`}return`#${u}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let u;return r.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(u=m)}),(u&&u[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(m=>isNaN(m))){const m=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(u[3]||0):r.getBearing();return r.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:m,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function iy(p,r){const u=p.getCenter(),m=Math.round(100*p.getZoom())/100,b=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,b),I=Math.round(u.lng*w)/w,M=Math.round(u.lat*w)/w,R=p.getBearing(),L=p.getPitch();let U=r?`/${I}/${M}/${m}`:`${m}/${M}/${I}`;return(R||L)&&(U+="/"+Math.round(10*R)/10),L&&(U+=`/${Math.round(L)}`),U}const kc={linearity:.3,easing:a.d0(0,0,.3,1)},ry=a.W({deceleration:2500,maxSpeed:1400},kc),wf=a.W({deceleration:20,maxSpeed:1400},kc),Ef=a.W({deceleration:1e3,maxSpeed:360},kc),Th=a.W({deceleration:1e3,maxSpeed:90},kc);class Fc{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.e.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,u=a.e.now();for(;r.length>0&&u-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)u.zoom+=w.zoomDelta||0,u.bearing+=w.bearingDelta||0,u.pitch+=w.pitchDelta||0,w.panDelta&&u.pan._add(w.panDelta),w.around&&(u.around=w.around),w.pinchAround&&(u.pinchAround=w.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(u.pan.mag()){const w=pu(u.pan.mag(),m,a.W({},ry,r||{}));b.offset=u.pan.mult(w.amount/u.pan.mag()),b.center=this._map.transform.center,hc(b,w)}if(u.zoom){const w=pu(u.zoom,m,wf);b.zoom=this._map.transform.zoom+w.amount,hc(b,w)}if(u.bearing){const w=pu(u.bearing,m,Ef);b.bearing=this._map.transform.bearing+a.at(w.amount,-179,179),hc(b,w)}if(u.pitch){const w=pu(u.pitch,m,Th);b.pitch=this._map.transform.pitch+w.amount,hc(b,w)}if(b.zoom||b.bearing){const w=void 0===u.pinchAround?u.around:u.pinchAround;b.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function hc(p,r){(!p.duration||p.duration<r.duration)&&(p.duration=r.duration,p.easing=r.easing)}function pu(p,r,u){const{maxSpeed:m,linearity:b,deceleration:w}=u,I=a.at(p*b/(r/1e3),-m,m),M=Math.abs(I)/(w*b);return{easing:u.easing,duration:1e3*M,amount:I*(M/2)}}class ca extends a.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,m,b={}){const w=be(u.getCanvasContainer(),m),I=u.unproject(w);super(r,a.W({point:w,lngLat:I,originalEvent:m},b)),this._defaultPrevented=!1,this.target=u}}class Nc extends a.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,m){const b="touchend"===r?m.changedTouches:m.touches,w=Ye(u.getCanvasContainer(),b),I=w.map(R=>u.unproject(R)),M=w.reduce((R,L,U,G)=>R.add(L.div(G.length)),new a.P(0,0));super(r,{points:w,point:M,lngLats:I,lngLat:u.unproject(M),originalEvent:m}),this._defaultPrevented=!1}}class Gu extends a.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u){super("wheel",{originalEvent:u}),this._defaultPrevented=!1}}class Hu{constructor(r,u){this._map=r,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Gu(this._map,r))}mousedown(r,u){return this._mousedownPos=u,this._firePreventable(new ca(r.type,this._map,r))}mouseup(r){this._map.fire(new ca(r.type,this._map,r))}preclick(r){const u=a.W({},r);u.type="preclick",this._map.fire(new ca(u.type,this._map,u))}click(r,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(r),this._map.fire(new ca(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new ca(r.type,this._map,r))}mouseover(r){this._map.fire(new ca(r.type,this._map,r))}mouseout(r){this._map.fire(new ca(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Nc(r.type,this._map,r))}touchmove(r){this._map.fire(new Nc(r.type,this._map,r))}touchend(r){this._map.fire(new Nc(r.type,this._map,r))}touchcancel(r){this._map.fire(new Nc(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tl{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new ca(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ca("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new ca(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fc{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,u){this.isEnabled()&&r.shiftKey&&0===r.button&&(We(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(r,u){if(!this._active)return;const m=u,b=this._startPos,w=this._lastPos;if(!b||!w||w.equals(m)||!this._box&&m.dist(b)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=De("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const I=Math.min(b.x,m.x),M=Math.max(b.x,m.x),R=Math.min(b.y,m.y),L=Math.max(b.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${R}px)`,this._box.style.width=M-I+"px",this._box.style.height=L-R+"px")})}mouseupWindow(r,u){if(!this._active)return;const m=this._startPos,b=u;if(m&&0===r.button){if(this.reset(),He(),m.x!==b.x||m.y!==b.y)return this._map.fire(new a.f("boxzoomend",{originalEvent:r})),{cameraAnimation:w=>w.fitScreenCoordinates(m,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ne(),delete this._startPos,delete this._lastPos}_fireEvent(r,u){return this._map.fire(new a.f(r,{originalEvent:u}))}}function mu(p,r){const u={};for(let m=0;m<p.length;m++)u[p[m].identifier]=r[m];return u}class Mp{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,u,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=r.timeStamp),m.length===this.numTouches&&(this.centroid=function(b){const w=new a.P(0,0);for(const I of b)w._add(I);return w.div(b.length)}(u),this.touches=mu(m,u)))}touchmove(r,u,m){if(this.aborted||!this.centroid)return;const b=mu(m,u);for(const w in this.touches){const I=b[w];(!I||I.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(r,u,m){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Cf{constructor(r){this.singleTap=new Mp(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,u,m){this.singleTap.touchstart(r,u,m)}touchmove(r,u,m){this.singleTap.touchmove(r,u,m)}touchend(r,u,m){const b=this.singleTap.touchend(r,u,m);if(b){const w=r.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(b)<30;if(w&&I||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class If{constructor(){this._zoomIn=new Cf({numTouches:1,numTaps:2}),this._zoomOut=new Cf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,u,m){this._zoomIn.touchstart(r,u,m),this._zoomOut.touchstart(r,u,m)}touchmove(r,u,m){this._zoomIn.touchmove(r,u,m),this._zoomOut.touchmove(r,u,m)}touchend(r,u,m){const b=this._zoomIn.touchend(r,u,m),w=this._zoomOut.touchend(r,u,m);return b?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(b)},{originalEvent:r})}):w?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(w)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Bc={0:1,2:2};class Wu{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,u){return!1}_move(r,u){return{}}mousedown(r,u){if(this._lastPoint)return;const m=Le(r);this._correctButton(r,m)&&(this._lastPoint=u,this._eventButton=m)}mousemoveWindow(r,u){const m=this._lastPoint;if(m)if(r.preventDefault(),null!=this._eventButton&&function(b,w){const I=Bc[w];return void 0===b.buttons||(b.buttons&I)!==I}(r,this._eventButton))this.reset();else if(this._moved||!(u.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(m,u)}mouseupWindow(r){this._lastPoint&&Le(r)===this._eventButton&&(this._moved&&He(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ng extends Wu{mousedown(r,u){super.mousedown(r,u),this._lastPoint&&(this._active=!0)}_correctButton(r,u){return 0===u&&!r.ctrlKey}_move(r,u){return{around:u,panDelta:u.sub(r)}}}class Sp extends Wu{_correctButton(r,u){return 0===u&&r.ctrlKey||2===u}_move(r,u){const m=.8*(u.x-r.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(r){r.preventDefault()}}class Dh extends Wu{_correctButton(r,u){return 0===u&&r.ctrlKey||2===u}_move(r,u){const m=-.5*(u.y-r.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(r){r.preventDefault()}}class Xu{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),a.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(r,u,m){return this._calculateTransform(r,u,m)}touchmove(r,u,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length&&!a.d1())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,u,m)}}touchend(r,u,m){this._calculateTransform(r,u,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,u,m){m.length>0&&(this._active=!0);const b=mu(m,u),w=new a.P(0,0),I=new a.P(0,0);let M=0;for(const L in b){const U=b[L],G=this._touches[L];G&&(w._add(U),I._add(U.sub(G)),M++,b[L]=U)}if(this._touches=b,M<this._minTouches||!I.mag())return;const R=I.div(M);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(M),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=De("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Mh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,u,m){return{}}touchstart(r,u,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([u[0],u[1]]))}touchmove(r,u,m){const b=this._firstTwoTouches;if(!b)return;r.preventDefault();const[w,I]=b,M=Ku(m,u,w),R=Ku(m,u,I);if(!M||!R)return;const L=this._aroundCenter?null:M.add(R).div(2);return this._move([M,R],L,r)}touchend(r,u,m){if(!this._firstTwoTouches)return;const[b,w]=this._firstTwoTouches,I=Ku(m,u,b),M=Ku(m,u,w);I&&M||(this._active&&He(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ku(p,r,u){for(let m=0;m<p.length;m++)if(p[m].identifier===u)return r[m]}function Zu(p,r){return Math.log(p/r)/Math.LN2}class oy extends Mh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,u){const m=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Zu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Zu(this._distance,m),pinchAround:u}}}function Tf(p,r){return 180*p.angleWith(r)/Math.PI}class Ps extends Mh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,u){const m=this._vector;if(this._vector=r[0].sub(r[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Tf(this._vector,m),pinchAround:u}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const u=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const b=Tf(r,m);return Math.abs(b)<u}}function Nd(p){return Math.abs(p.y)>Math.abs(p.x)}class Ap extends Mh{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Nd(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,u,m){const b=this._lastPoints;if(!b)return;const w=r[0].sub(b[0]),I=r[1].sub(b[1]);return this._map._cooperativeGestures&&!a.d1()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(w,I,m.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(w.y+I.y)/2*-.5})}gestureBeginsVertically(r,u,m){if(void 0!==this._valid)return this._valid;const b=r.mag()>=2,w=u.mag()>=2;if(!b&&!w)return;if(!b||!w)return null==this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const I=r.y>0==u.y>0;return Nd(r)&&Nd(u)&&I}}const Bd={panStep:100,bearingStep:15,pitchStep:10};class ig{constructor(){const r=Bd;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let u=0,m=0,b=0,w=0,I=0;switch(r.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:r.shiftKey?m=-1:(r.preventDefault(),w=-1);break;case 39:r.shiftKey?m=1:(r.preventDefault(),w=1);break;case 38:r.shiftKey?b=1:(r.preventDefault(),I=-1);break;case 40:r.shiftKey?b=-1:(r.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(m=0,b=0),{cameraAnimation:M=>{const R=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:sy,zoom:u?Math.round(R)+u*(r.shiftKey?2:1):R,bearing:M.getBearing()+m*this._bearingStep,pitch:M.getPitch()+b*this._pitchStep,offset:[-w*this._panStep,-I*this._panStep],center:M.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function sy(p){return p*(2-p)}const zd=4.000244140625,Sh=1/450;class rg{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Sh,a.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||a.d1()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const m=a.e.now(),b=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==u&&u%zd==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(b*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),r.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=r,this._delta-=u,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=be(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;"wheel"===this._type&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const L="wheel"===this._type&&Math.abs(this._delta)>zd?this._wheelZoomRate:this._defaultZoomRate;let U=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&0!==U&&(U=1/U);const G=u(),J=Math.pow(2,G),Q="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):J;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(Q*U))),"wheel"===this._type&&(this._startZoom=G,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:u(),b=this._startZoom,w=this._easing;let I,M=!1;if("wheel"===this._type&&b&&w){const L=Math.min((a.e.now()-this._lastWheelEventTime)/200,1),U=w(L);I=a.a2(b,m,U),L<1?this._frameId||(this._frameId=!0):M=!0}else I=m,M=!0;this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let R=I-u();return R*this._lastDelta<0&&(R=0),{noInertia:!0,needsRenderFrame:!M,zoomDelta:R,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let u=a.d2;if(this._prevEase){const m=this._prevEase,b=(a.e.now()-m.start)/m.duration,w=m.easing(b+.01)-m.easing(b),I=.27/Math.sqrt(w*w+1e-4)*.01,M=Math.sqrt(.0729-I*I);u=a.d0(I,M,.25,1)}return this._prevEase={start:a.e.now(),duration:r,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=De("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ml{constructor(r,u){this._clickZoom=r,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ah{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,u){return r.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(r.shiftKey?-1:1),around:m.unproject(u)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qu{constructor(){this._tap=new Cf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,u,m){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=u[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(r,u,m))}touchmove(r,u,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const b=u[0],w=b.y-this._swipePoint.y;return this._swipePoint=b,r.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(r,u,m)}touchend(r,u,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(r,u,m)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cs{constructor(r,u,m){this._el=r,this._mousePan=u,this._touchPan=m}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ni{constructor(r,u,m){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=u,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Cr{constructor(r,u,m,b){this._el=r,this._touchZoom=u,this._touchRotate=m,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const hs=p=>p.zoom||p.drag||p.pitch||p.rotate;class gl extends a.f{}class Ws{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,u){const m=a._.sub([],u,r);this.radius=a._.length(m[2]<0?a._.div([],m,this.constants):[m[0],m[1],0])}projectRay(r){a._.div(r,r,this.constants),a._.normalize(r,r),a._.mul(r,r,this.constants);const u=a._.scale([],r,this.radius);if(u[2]>0){const m=a._.scale([],[0,0,1],a._.dot(u,[0,0,1])),b=a._.scale([],a._.normalize([],[u[0],u[1],0]),this.radius),w=a._.add([],u,a._.scale([],a._.sub([],a._.add([],b,m),u),2));u[0]=w[0],u[1]=w[1]}return u}}function Rs(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Yu{constructor(r,u){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fc(r),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ws,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),a.bp(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,w,I]of this._listeners){const M=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(w,M,I)}}destroy(){for(const[r,u,m]of this._listeners){const b=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(u,b,m)}}_addDefaultHandlers(r){const u=this._map,m=u.getCanvasContainer();this._add("mapEvent",new Hu(u,r));const b=u.boxZoom=new fc(u,r);this._add("boxZoom",b);const w=new If,I=new Ah;u.doubleClickZoom=new ml(I,w),this._add("tapZoom",w),this._add("clickZoom",I);const M=new qu;this._add("tapDragZoom",M);const R=u.touchPitch=new Ap(u);this._add("touchPitch",R);const L=new Sp(r),U=new Dh(r);u.dragRotate=new Ni(r,L,U),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",U,["mouseRotate"]);const G=new ng(r),J=new Xu(u,r);u.dragPan=new cs(m,G,J),this._add("mousePan",G),this._add("touchPan",J,["touchZoom","touchRotate"]);const Q=new Ps,le=new oy;u.touchZoomRotate=new Cr(m,le,Q,M),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new tl(u));const de=u.scrollZoom=new rg(u,this);this._add("scrollZoom",de,["mousePan"]);const ge=u.keyboard=new ig;this._add("keyboard",ge);for(const xe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[xe]&&u[xe].enable(r[xe])}_add(r,u,m){this._handlers.push({handlerName:r,handler:u,allowed:m}),this._handlersById[r]=u}stop(r){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!hs(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,u,m){for(const b in r)if(b!==m&&(!u||u.indexOf(b)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const u=[];for(const m of r)this._el.contains(m.target)&&u.push(m);return u}handleEvent(r,u){this._updatingCamera=!0;const m="renderFrame"===r.type,b=m?void 0:r,w={needsRenderFrame:!1},I={},M={},R=r.touches?this._getMapTouches(r.touches):void 0,L=R?Ye(this._el,R):m?void 0:be(this._el,r);for(const{handlerName:J,handler:Q,allowed:le}of this._handlers){if(!Q.isEnabled())continue;let de;this._blockedByActive(M,le,J)?Q.reset():Q[u||r.type]&&(de=Q[u||r.type](r,L,R),this.mergeHandlerResult(w,I,de,J,b),de&&de.needsRenderFrame&&this._triggerRenderFrame()),(de||Q.isActive())&&(M[J]=Q)}const U={};for(const J in this._previousActiveHandlers)M[J]||(U[J]=b);this._previousActiveHandlers=M,(Object.keys(U).length||Rs(w))&&(this._changes.push([w,I,U]),this._triggerRenderFrame()),(Object.keys(M).length||Rs(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=w;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))}mergeHandlerResult(r,u,m,b,w){if(!m)return;a.W(r,m);const I={handlerName:b,originalEvent:m.originalEvent||w};void 0!==m.zoomDelta&&(u.zoom=I),void 0!==m.panDelta&&(u.drag=I),void 0!==m.pitchDelta&&(u.pitch=I),void 0!==m.bearingDelta&&(u.rotate=I)}_applyChanges(){const r={},u={},m={};for(const[b,w,I]of this._changes)b.panDelta&&(r.panDelta=(r.panDelta||new a.P(0,0))._add(b.panDelta)),b.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(r.around=b.around),void 0!==b.aroundCoord&&(r.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(r.pinchAround=b.pinchAround),b.noInertia&&(r.noInertia=b.noInertia),a.W(u,w),a.W(m,I);this._updateMapTransform(r,u,m),this._changes=[]}_updateMapTransform(r,u,m){const b=this._map,w=b.transform,I=Ke=>[Ke.x,Ke.y,Ke.z];if((Ke=>{const Qe=this._eventsInProgress.drag;return Qe&&!this._handlersById[Qe.handlerName].isActive()})()&&!Rs(r)){const Ke=w.zoom;w.cameraElevationReference="sea",null!=this._originalZoom&&w._orthographicProjectionAtLowPitch&&"globe"!==w.projection.name&&0===w.pitch?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),Ke!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&b._stop(!0),!Rs(r))return void this._fireEvents(u,m,!0);let{panDelta:M,zoomDelta:R,bearingDelta:L,pitchDelta:U,around:G,aroundCoord:J,pinchAround:Q}=r;w._isCameraConstrained&&(R>0&&(R=0),w._isCameraConstrained=!1),void 0!==Q&&(G=Q),(R||(Ke=>u.drag&&!this._eventsInProgress.drag)())&&G&&(this._dragOrigin=I(w.pointCoordinate3D(G)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",b._stop(!0),G=G||b.transform.centerPoint,L&&(w.bearing+=L),U&&(w.pitch+=U),w._updateCameraState();const le=[0,0,0];if(M)if("mercator"===w.projection.name){const Ke=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(G).dir),Qe=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(G.sub(M)).dir);le[0]=Qe[0]-Ke[0],le[1]=Qe[1]-Ke[1]}else{const Ke=w.pointCoordinate(G);if("globe"===w.projection.name){M=M.rotate(-w.angle);const Qe=w._pixelsPerMercatorPixel/w.worldSize;le[0]=-M.x*a.d3(a.ay(Ke.y))*Qe,le[1]=-M.y*a.d3(w.center.lat)*Qe}else{const Qe=w.pointCoordinate(G.sub(M));Ke&&Qe&&(le[0]=Qe.x-Ke.x,le[1]=Qe.y-Ke.y)}}const de=w.zoom,ge=[0,0,0];if(R){const Ke=I(J||w.pointCoordinate3D(G)),Qe={dir:a._.normalize([],a._.sub([],Ke,w._camera.position))};if(Qe.dir[2]<0){const et=w.zoomDeltaToMovement(Ke,R);a._.scale(ge,Qe.dir,et)}}const xe=a._.add(le,le,ge);w._translateCameraConstrained(xe),R&&Math.abs(w.zoom-de)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(u,m,!0)}_fireEvents(r,u,m){const b=hs(this._eventsInProgress),w=hs(r),I={};for(const U in r){const{originalEvent:G}=r[U];this._eventsInProgress[U]||(I[`${U}start`]=G),this._eventsInProgress[U]=r[U]}!b&&w&&this._fireEvent("movestart",w.originalEvent);for(const U in I)this._fireEvent(U,I[U]);w&&this._fireEvent("move",w.originalEvent);for(const U in r){const{originalEvent:G}=r[U];this._fireEvent(U,G)}const M={};let R;for(const U in this._eventsInProgress){const{handlerName:G,originalEvent:J}=this._eventsInProgress[U];this._handlersById[G].isActive()||(delete this._eventsInProgress[U],R=u[G]||J,M[`${U}end`]=R)}for(const U in M)this._fireEvent(U,M[U]);const L=hs(this._eventsInProgress);if(m&&(b||w)&&!L){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=J=>0!==J&&-this._bearingSnap<J&&J<this._bearingSnap;U?(G(U.bearing||this._map.getBearing())&&(U.bearing=0),this._map.easeTo(U,{originalEvent:R})):(this._map.fire(new a.f("moveend",{originalEvent:R})),G(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,u){this._map.fire(new a.f(r,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new gl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ns="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class gs extends a.E{constructor(r,u){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=!1!==u.respectPrefersReducedMotion,a.bp(["_renderFrameCallback"],this)}getCenter(){return new a.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(r,u){return this.jumpTo({center:r},u)}panBy(r,u,m){return r=a.P.convert(r).mult(-1),this.panTo(this.transform.center,a.W({offset:r},u),m)}panTo(r,u,m){return this.easeTo(a.W({center:r},u),m)}getZoom(){return this.transform.zoom}setZoom(r,u){return this.jumpTo({zoom:r},u),this}zoomTo(r,u,m){return this.easeTo(a.W({zoom:r},u),m)}zoomIn(r,u){return this.zoomTo(this.getZoom()+1,r,u),this}zoomOut(r,u){return this.zoomTo(this.getZoom()-1,r,u),this}getBearing(){return this.transform.bearing}setBearing(r,u){return this.jumpTo({bearing:r},u),this}getPadding(){return this.transform.padding}setPadding(r,u){return this.jumpTo({padding:r},u),this}rotateTo(r,u,m){return this.easeTo(a.W({bearing:r},u),m)}resetNorth(r,u){return this.rotateTo(0,a.W({duration:1e3},r),u),this}resetNorthPitch(r,u){return this.easeTo(a.W({bearing:0,pitch:0,duration:1e3},r),u),this}snapToNorth(r,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,u):this}getPitch(){return this.transform.pitch}setPitch(r,u){return this.jumpTo({pitch:r},u),this}cameraForBounds(r,u){r=a.ai.convert(r);const m=u&&u.bearing||0,b=u&&u.pitch||0,w=r.getNorthWest(),I=r.getSouthEast();return this._cameraForBounds(this.transform,w,I,m,b,u)}_extendPadding(r){const u={top:0,right:0,bottom:0,left:0};return null==r?a.W({},u,this.transform.padding):"number"==typeof r?{top:r,bottom:r,right:r,left:r}:a.W({},u,r)}_extendCameraOptions(r){return(r=a.W({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,u){const m=u.max[0]-u.min[0],b=u.max[1]-u.min[1];return m/b>r.aspect?m/(2*Math.tan(.5*r.fovX)*r.aspect):b/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,u,m,b,w,I){const M=r.clone(),R=this._extendCameraOptions(I);M.bearing=b,M.pitch=w;const L=a.aI.convert(u),U=a.aI.convert(m),G=.5*(L.lat+U.lat),J=.5*(L.lng+U.lng),Q=a.d4(G,J),le=a._.normalize([],Q),de=a._.normalize([],a._.cross([],le,[0,1,0])),ge=a._.cross([],de,le),xe=[de[0],de[1],de[2],0,ge[0],ge[1],ge[2],0,le[0],le[1],le[2],0,0,0,0,1],Ke=[Q,a.d4(L.lat,L.lng),a.d4(U.lat,L.lng),a.d4(U.lat,U.lng),a.d4(L.lat,U.lng),a.d4(G,L.lng),a.d4(G,U.lng),a.d4(L.lat,J),a.d4(U.lat,J)];let Qe=a.b6.fromPoints(Ke.map(Pn=>[a._.dot(de,Pn),a._.dot(ge,Pn),a._.dot(le,Pn)]));const et=a._.transformMat4([],Qe.center,xe);0===a._.squaredLength(et)&&a._.set(et,0,0,1),a._.normalize(et,et),a._.scale(et,et,a.cD),M.center=a.d5(et);const yt=M.getWorldToCameraMatrix(),_t=a.ad.invert(new Float64Array(16),yt);Qe=a.b6.applyTransform(Qe,a.ad.multiply([],yt,xe));const St=this._extendAABB(Qe,M,R,b);if(!St)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Qe=St,a._.transformMat4(et,et,yt);const Ee=.5*(Qe.max[2]-Qe.min[2]),tt=this._minimumAABBFrustumDistance(M,Qe),Lt=a._.scale([],[0,0,1],Ee),sn=a._.add(Lt,et,Lt),zt=tt+(0===M.pitch?0:a._.distance(et,sn)),It=M.globeCenterInViewSpace,hn=a._.sub([],et,[It[0],It[1],It[2]]);a._.normalize(hn,hn),a._.scale(hn,hn,zt);const Gn=a._.add([],et,hn);a._.transformMat4(Gn,Gn,_t);const Xn=a.d7/a.cD,Vn=a._.length(Gn),Xt=a.ax(Math.max(Vn*Xn-a.d7,Number.EPSILON),0),mn=Math.min(M.zoomFromMercatorZAdjusted(Xt),R.maxZoom);return mn>.5*(a.b1+a.aU)?(M.setProjection({name:"mercator"}),M.zoom=mn,this._cameraForBounds(M,u,m,b,w,I)):{center:M.center,zoom:mn,bearing:b,pitch:w}}_extendAABB(r,u,m,b){const w=.5*((m.padding.left||0)+(m.padding.right||0)),I=.5*((m.padding.top||0)+(m.padding.bottom||0)),M=I,R=w,L=w,U=I,G=u.width-(R+L),J=u.height-(M+U),Q=a._.sub([],r.max,r.min),le=Math.min(G/Q[0],J/Q[1]),de=Math.min(u.scaleZoom(u.scale*le),m.maxZoom);if(isNaN(de))return null;const ge=u.scale/u.zoomScale(de),xe=new a.b6([r.min[0]-R*ge,r.min[1]-U*ge,r.min[2]],[r.max[0]+L*ge,r.max[1]+M*ge,r.max[2]]),Ke=("number"==typeof m.offset.x&&"number"==typeof m.offset.y?new a.P(m.offset.x,m.offset.y):a.P.convert(m.offset)).rotate(-a.ab(b));return xe.center[0]-=Ke.x*ge,xe.center[1]+=Ke.y*ge,xe}queryTerrainElevation(r,u){const m=this.transform.elevation;return m?(u=a.W({},{exaggerated:!0},u),m.getAtPoint(a.Y.fromLngLat(r),null,u.exaggerated)):null}_cameraForBounds(r,u,m,b,w,I){if("globe"===r.projection.name)return this._cameraForBoundsOnGlobe(r,u,m,b,w,I);const M=r.clone(),R=this._extendCameraOptions(I);M.bearing=b,M.pitch=w;const L=a.aI.convert(u),U=a.aI.convert(m),G=new a.aI(L.lng,U.lat),J=new a.aI(U.lng,L.lat),Q=M.project(L),le=M.project(U),de=this.queryTerrainElevation(L),ge=this.queryTerrainElevation(U),xe=this.queryTerrainElevation(G),Ke=this.queryTerrainElevation(J),Qe=[[Q.x,Q.y,Math.min(de||0,ge||0,xe||0,Ke||0)],[le.x,le.y,Math.max(de||0,ge||0,xe||0,Ke||0)]];let et=a.b6.fromPoints(Qe);const yt=M.getWorldToCameraMatrix(),_t=a.ad.invert(new Float64Array(16),yt);et=a.b6.applyTransform(et,yt);const St=this._extendAABB(et,M,R,b);if(!St)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");et=St;const Ee=.5*a._.sub([],et.max,et.min)[2],tt=this._minimumAABBFrustumDistance(M,et),Lt=[0,0,1,0];a.aA.transformMat4(Lt,Lt,yt),a.aA.normalize(Lt,Lt);const sn=a._.scale([],Lt,tt+Ee),zt=a._.add([],et.center,sn);a._.transformMat4(et.center,et.center,_t),a._.transformMat4(zt,zt,_t);const It=[et.center[0],et.center[1],zt[2]*M.pixelsPerMeter];a._.scale(It,It,1/M.worldSize);const hn=a.d6(It[0]),Gn=a.ay(It[1]),Xn=Math.min(M._zoomFromMercatorZ(It[2]),R.maxZoom),Vn=new a.aI(hn,Gn);return M.mercatorFromTransition&&Xn<.5*(a.b1+a.aU)?(M.setProjection({name:"globe"}),M.zoom=Xn,this._cameraForBounds(M,u,m,b,w,I)):{center:Vn,zoom:Xn,bearing:b,pitch:w}}fitBounds(r,u,m){const b=this.cameraForBounds(r,u);return this._fitInternal(b,u,m)}fitScreenCoordinates(r,u,m,b,w){const I=a.P.convert(r),M=a.P.convert(u),R=new a.P(Math.min(I.x,M.x),Math.min(I.y,M.y)),L=new a.P(Math.max(I.x,M.x),Math.max(I.y,M.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(I,M))return this;const U=this.transform.pointLocation3D(R),G=this.transform.pointLocation3D(L),J=this.transform.pointLocation3D(new a.P(R.x,L.y)),Q=this.transform.pointLocation3D(new a.P(L.x,R.y)),le=[Math.min(U.lng,G.lng,J.lng,Q.lng),Math.min(U.lat,G.lat,J.lat,Q.lat)],de=[Math.max(U.lng,G.lng,J.lng,Q.lng),Math.max(U.lat,G.lat,J.lat,Q.lat)],ge=b&&b.pitch?b.pitch:this.getPitch(),xe=this._cameraForBounds(this.transform,le,de,m,ge,b);return this._fitInternal(xe,b,w)}_fitInternal(r,u,m){return r?(u=a.W(r,u)).linear?this.easeTo(u,m):this.flyTo(u,m):this}jumpTo(r,u){this.stop();const m=r.preloadOnly?this.transform.clone():this.transform;let b=!1,w=!1,I=!1;if("zoom"in r&&m.zoom!==+r.zoom&&(b=!0,m.zoom=+r.zoom),void 0!==r.center&&(m.center=a.aI.convert(r.center)),"bearing"in r&&m.bearing!==+r.bearing&&(w=!0,m.bearing=+r.bearing),"pitch"in r&&m.pitch!==+r.pitch&&(I=!0,m.pitch=+r.pitch),null!=r.padding){const M="number"==typeof r.padding?this._extendPadding(r.padding):r.padding;m.isPaddingEqual(M)||(m.padding=M)}return r.preloadOnly?(this._preloadTiles(m),this):(this.fire(new a.f("movestart",u)).fire(new a.f("move",u)),b&&this.fire(new a.f("zoomstart",u)).fire(new a.f("zoom",u)).fire(new a.f("zoomend",u)),w&&this.fire(new a.f("rotatestart",u)).fire(new a.f("rotate",u)).fire(new a.f("rotateend",u)),I&&this.fire(new a.f("pitchstart",u)).fire(new a.f("pitch",u)).fire(new a.f("pitchend",u)),this.fire(new a.f("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w(ns),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,u){const m=this.transform;if(!m.projection.supportsFreeCamera)return a.w(ns),this;this.stop();const b=m.zoom,w=m.pitch,I=m.bearing;m.setFreeCameraOptions(r);const M=b!==m.zoom,R=w!==m.pitch,L=I!==m.bearing;return this.fire(new a.f("movestart",u)).fire(new a.f("move",u)),M&&this.fire(new a.f("zoomstart",u)).fire(new a.f("zoom",u)).fire(new a.f("zoomend",u)),L&&this.fire(new a.f("rotatestart",u)).fire(new a.f("rotate",u)).fire(new a.f("rotateend",u)),R&&this.fire(new a.f("pitchstart",u)).fire(new a.f("pitch",u)).fire(new a.f("pitchend",u)),this.fire(new a.f("moveend",u)),this}easeTo(r,u){this._stop(!1,r.easeId),(!1===(r=a.W({offset:[0,0],duration:500,easing:a.d2},r)).animate||this._prefersReducedMotion(r))&&(r.duration=0);const m=this.transform,b=this.getZoom(),w=this.getBearing(),I=this.getPitch(),M=this.getPadding(),R="zoom"in r?+r.zoom:b,L="bearing"in r?this._normalizeBearing(r.bearing,w):w,U="pitch"in r?+r.pitch:I,G=this._extendPadding(r.padding),J=a.P.convert(r.offset);let Q,le,de;if("globe"===m.projection.name){const tt=a.Y.fromLngLat(m.center),Lt=J.rotate(-m.angle);tt.x+=Lt.x/m.worldSize,tt.y+=Lt.y/m.worldSize;const sn=tt.toLngLat(),zt=a.aI.convert(r.center||sn);this._normalizeCenter(zt),Q=m.centerPoint.add(Lt),le=new a.P(tt.x,tt.y).mult(m.worldSize),de=new a.P(a.aj(zt.lng),a.ak(zt.lat)).mult(m.worldSize).sub(le)}else{Q=m.centerPoint.add(J);const tt=m.pointLocation(Q),Lt=a.aI.convert(r.center||tt);this._normalizeCenter(Lt),le=m.project(tt),de=m.project(Lt).sub(le)}const ge=m.zoomScale(R-b);let xe,Ke;r.around&&(xe=a.aI.convert(r.around),Ke=m.locationPoint(xe));const Qe=this._zooming||R!==b,et=this._rotating||w!==L,yt=this._pitching||U!==I,_t=!m.isPaddingEqual(G),St=tt=>Lt=>{if(Qe&&(tt.zoom=a.a2(b,R,Lt)),et&&(tt.bearing=a.a2(w,L,Lt)),yt&&(tt.pitch=a.a2(I,U,Lt)),_t&&(tt.interpolatePadding(M,G,Lt),Q=tt.centerPoint.add(J)),xe)tt.setLocationAtPoint(xe,Ke);else{const sn=tt.zoomScale(tt.zoom-b),zt=R>b?Math.min(2,ge):Math.max(.5,ge),It=Math.pow(zt,1-Lt),hn=tt.unproject(le.add(de.mult(Lt*It)).mult(sn));tt.setLocationAtPoint(tt.renderWorldCopies?hn.wrap():hn,Q)}return r.preloadOnly||this._fireMoveEvents(u),tt};if(r.preloadOnly){const tt=this._emulate(St,r.duration,m);return this._preloadTiles(tt),this}const Ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Qe,this._rotating=et,this._pitching=yt,this._padding=_t,this._easeId=r.easeId,this._prepareEase(u,r.noMoveStart,Ee),this._ease(St(m),tt=>{"sea"===m.cameraElevationReference&&m.recenterOnTerrain(),this._afterEase(u,tt)},r),this}_prepareEase(r,u,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),u||m.moving||this.fire(new a.f("movestart",r)),this._zooming&&!m.zooming&&this.fire(new a.f("zoomstart",r)),this._rotating&&!m.rotating&&this.fire(new a.f("rotatestart",r)),this._pitching&&!m.pitching&&this.fire(new a.f("pitchstart",r))}_fireMoveEvents(r){this.fire(new a.f("move",r)),this._zooming&&this.fire(new a.f("zoom",r)),this._rotating&&this.fire(new a.f("rotate",r)),this._pitching&&this.fire(new a.f("pitch",r))}_afterEase(r,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,b=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new a.f("zoomend",r)),b&&this.fire(new a.f("rotateend",r)),w&&this.fire(new a.f("pitchend",r)),this.fire(new a.f("moveend",r))}flyTo(r,u){if(this._prefersReducedMotion(r)){const mn=a.ah(r,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(mn,u)}this.stop(),r=a.W({offset:[0,0],speed:1.2,curve:1.42,easing:a.d2},r);const m=this.transform,b=this.getZoom(),w=this.getBearing(),I=this.getPitch(),M=this.getPadding(),R="zoom"in r?a.at(+r.zoom,m.minZoom,m.maxZoom):b,L="bearing"in r?this._normalizeBearing(r.bearing,w):w,U="pitch"in r?+r.pitch:I,G=this._extendPadding(r.padding),J=m.zoomScale(R-b),Q=a.P.convert(r.offset);let le=m.centerPoint.add(Q);const de=m.pointLocation(le),ge=a.aI.convert(r.center||de);this._normalizeCenter(ge);const xe=m.project(de),Ke=m.project(ge).sub(xe);let Qe=r.curve;const et=Math.max(m.width,m.height),yt=et/J,_t=Ke.mag();if("minZoom"in r){const mn=a.at(Math.min(r.minZoom,b,R),m.minZoom,m.maxZoom),Pn=et/m.zoomScale(mn-b);Qe=Math.sqrt(Pn/_t*2)}const St=Qe*Qe;function Ee(mn){const Pn=(yt*yt-et*et+(mn?-1:1)*St*St*_t*_t)/(2*(mn?yt:et)*St*_t);return Math.log(Math.sqrt(Pn*Pn+1)-Pn)}function tt(mn){return(Math.exp(mn)-Math.exp(-mn))/2}function Lt(mn){return(Math.exp(mn)+Math.exp(-mn))/2}const sn=Ee(0);let zt=function(mn){return Lt(sn)/Lt(sn+Qe*mn)},It=function(mn){return et*((Lt(sn)*(tt(Pn=sn+Qe*mn)/Lt(Pn))-tt(sn))/St)/_t;var Pn},hn=(Ee(1)-sn)/Qe;if(Math.abs(_t)<1e-6||!isFinite(hn)){if(Math.abs(et-yt)<1e-6)return this.easeTo(r,u);const mn=yt<et?-1:1;hn=Math.abs(Math.log(yt/et))/Qe,It=function(){return 0},zt=function(Pn){return Math.exp(mn*Qe*Pn)}}r.duration="duration"in r?+r.duration:1e3*hn/("screenSpeed"in r?+r.screenSpeed/Qe:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Gn=w!==L,Xn=U!==I,Vn=!m.isPaddingEqual(G),Xt=mn=>Pn=>{const yi=Pn*hn,bi=1/zt(yi);mn.zoom=1===Pn?R:b+mn.scaleZoom(bi),Gn&&(mn.bearing=a.a2(w,L,Pn)),Xn&&(mn.pitch=a.a2(I,U,Pn)),Vn&&(mn.interpolatePadding(M,G,Pn),le=mn.centerPoint.add(Q));const Mi=1===Pn?ge:mn.unproject(xe.add(Ke.mult(It(yi))).mult(bi));return mn.setLocationAtPoint(mn.renderWorldCopies?Mi.wrap():Mi,le),mn._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(u),mn};if(r.preloadOnly){const mn=this._emulate(Xt,r.duration,m);return this._preloadTiles(mn),this}return this._zooming=!0,this._rotating=Gn,this._pitching=Xn,this._padding=Vn,this._prepareEase(u,!1),this._ease(Xt(m),()=>this._afterEase(u),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,u)}if(!r){const m=this.handlers;m&&m.stop(!1)}return this}_ease(r,u,m){!1===m.animate||0===m.duration?(r(1),u()):(this._easeStart=a.e.now(),this._easeOptions=m,this._onEaseFrame=r,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((a.e.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,u){r=a.au(r,-180,180);const m=Math.abs(r-u);return Math.abs(r-360-u)<m&&(r-=360),Math.abs(r+360-u)<m&&(r+=360),r}_normalizeCenter(r){const u=this.transform;if(u.maxBounds||"globe"!==u.projection.name&&!u.renderWorldCopies)return;const m=r.lng-u.center.lng;r.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&a.e.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,u,m){const b=Math.ceil(15*u/1e3),w=[],I=r(m.clone());for(let M=0;M<=b;M++){const R=I(M/b);w.push(R.clone())}return w}_preloadTiles(r,u){}}class Wl{constructor(r={}){this.options=r,a.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const u=this.options&&this.options.compact;return this._map=r,this._container=De("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=De("button","mapboxgl-ctrl-attrib-button",this._container),De("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=De("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===u&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,u){const m=this._map._getUIString(`AttributionControl.${u}`);r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.d8.ACCESS_TOKEN}];if(r){const m=u.reduce((b,w,I)=>(w.value&&(b+=`${w.key}=${w.value}${I<u.length-1?"&":""}`),b),"?");r.href=`${a.d8.FEEDBACK_URL}/${m}#${iy(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const u=this._map.style._mergedSourceCaches;for(const b in u){const w=u[b];if(w.used){const I=w.getSource();I.attribution&&r.indexOf(I.attribution)<0&&r.push(I.attribution)}}r.sort((b,w)=>b.length-w.length),r=r.filter((b,w)=>{for(let I=w+1;I<r.length;I++)if(r[I].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const m=r.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,r.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class zr{constructor(){a.bp(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=De("div","mapboxgl-ctrl");const u=De("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const u in r){const m=r[u].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const u=r[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Ud{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const u=++this._id;return this._queue.push({callback:r,id:u,cancelled:!1}),u}remove(r){const u=this._currentlyRunning,m=u?this._queue.concat(u):this._queue;for(const b of m)if(b.id===r)return void(b.cancelled=!0)}run(r=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const m of u)if(!m.cancelled&&(m.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Pp(p,r,u){if(p=new a.aI(p.lng,p.lat),r){const m=new a.aI(p.lng-360,p.lat),b=new a.aI(p.lng+360,p.lat),w=360*Math.ceil(Math.abs(p.lng-u.center.lng)/360),I=u.locationPoint(p).distSqr(r),M=r.x<0||r.y<0||r.x>u.width||r.y>u.height;u.locationPoint(m).distSqr(r)<I&&(M||Math.abs(m.lng-u.center.lng)<w)?p=m:u.locationPoint(b).distSqr(r)<I&&(M||Math.abs(b.lng-u.center.lng)<w)&&(p=b)}for(;Math.abs(p.lng-u.center.lng)>180;){const m=u.locationPoint(p);if(m.x>=0&&m.y>=0&&m.x<=u.width&&m.y<=u.height)break;p.lng>u.center.lng?p.lng-=360:p.lng+=360}return p}const gu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class fs extends a.E{constructor(r,u){if(super(),(r instanceof HTMLElement||u)&&(r=a.W({element:r},u)),a.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=a.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=De("div");const w=41,I=27,M=Je("svg",{display:"block",height:w*this._scale+"px",width:I*this._scale+"px",viewBox:`0 0 ${I} ${w}`},this._element),R=Je("radialGradient",{id:"shadowGradient"},Je("defs",{},M));Je("stop",{offset:"10%","stop-opacity":.4},R),Je("stop",{offset:"100%","stop-opacity":.05},R),Je("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),Je("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),Je("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),Je("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=a.P.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const m=this._element.classList;for(const w in gu)m.remove(`mapboxgl-marker-anchor-${w}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`);const b=r&&r.className?r.className.trim().split(/\s+/):[];m.add(...b),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=a.aI.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const u=r.code,m=r.charCode||r.keyCode;"Space"!==u&&"Enter"!==u&&32!==m&&13!==m||this.togglePopup()}_onMapClick(r){const u=r.originalEvent.target,m=this._element;this._popup&&(u===m||m.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,u=this._pos;if(!r||!u)return!1;const m=r.unproject(u),b=r.getFreeCameraOptions();if(!b.position)return!1;const w=b.position.toLngLat();return w.distanceTo(m)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const u=this._pos;if(!u||u.x<0||u.x>r.transform.width||u.y<0||u.y>r.transform.height)return void this._clearFadeTimer();const m=r.unproject(u);let b;r._showingGlobe()&&a.d9(r.transform,this._lngLat)?b=0:(b=1-r._queryFogOpacity(m),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${r.x}px,${r.y}px)\n            ${gu[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${u.x}px,${u.y}px)\n        `}_calculateXYTransform(){const r=this._pos,u=this._map,m=this.getPitchAlignment();if(!u||!r||"map"!==m)return"";if(!u._showingGlobe()){const R=u.getPitch();return R?`rotateX(${R}deg)`:""}const b=a.b0(a.da(u.transform,this._lngLat)),w=r.sub(a.db(u.transform)),I=Math.abs(w.x)+Math.abs(w.y);if(0===I)return"";const M=b/I;return`rotateX(${-w.y*M}deg) rotateY(${w.x*M}deg)`}_calculateZTransform(){const r=this._pos,u=this._map;if(!u||!r)return"";let m=0;const b=this.getRotationAlignment();if("map"===b)if(u._showingGlobe()){const w=u.project(new a.aI(this._lngLat.lng,this._lngLat.lat+.001)),I=u.project(new a.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);m=a.b0(Math.atan2(I.y,I.x))-90}else m=-u.getBearing();else if("horizon"===b){const w=a.$(4,6,u.getZoom()),I=a.db(u.transform);I.y+=w*u.transform.height;const M=r.sub(I),R=a.b0(Math.atan2(M.y,M.x));m=(R>90?R-270:R+90)*(1-w)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Pp(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),!0===r?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=a.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const u=this._map;if(!u)return;const m=this._pointerdownPos,b=this._positionDelta;if(m&&b){if(!this._isDragging){const w=this._clickTolerance||u._clickTolerance;if(r.point.dist(m)<w)return;this._isDragging=!0}this._pos=r.point.sub(b),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new a.f("dragstart"))),this.fire(new a.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new a.f("dragend")),this._state="inactive"}_addDragHandler(r){const u=this._map,m=this._pos;u&&m&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(m),this._pointerdownPos=r.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const u=this._map;return u&&(r?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const zc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},_u=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Xl(p=new a.P(0,0),r="bottom"){if("number"==typeof p){const u=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(r){case"top":return new a.P(0,p);case"top-left":return new a.P(u,u);case"top-right":return new a.P(-u,u);case"bottom":return new a.P(0,-p);case"bottom-left":return new a.P(u,-u);case"bottom-right":return new a.P(-u,-u);case"left":return new a.P(p,0);case"right":return new a.P(-p,0)}return new a.P(0,0)}return p instanceof a.P||Array.isArray(p)?a.P.convert(p):a.P.convert(p[r]||[0,0])}class Kl{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const u=a.b9((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,u,m){this._start=this.getValue(u),this._end=r,this._startTime=u,this._endTime=u+m}}const Rp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Uc{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const Ph={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},nl={showCompass:!0,showZoom:!0,visualizePitch:!1};class lr{constructor(r,u,m=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new Sp({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,m&&(this.mousePitch=new Dh({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),a.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(r,u){this.mouseRotate.mousedown(r,u),this.mousePitch&&this.mousePitch.mousedown(r,u),We()}move(r,u){const m=this.map,b=this.mouseRotate.mousemoveWindow(r,u),w=b&&b.bearingDelta;if(w&&m.setBearing(m.getBearing()+w),this.mousePitch){const I=this.mousePitch.mousemoveWindow(r,u),M=I&&I.pitchDelta;M&&m.setPitch(m.getPitch()+M)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ne(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(a.W({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),be(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,be(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ye(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=Ye(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Df={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Zl={maxWidth:100,unit:"metric"},ql={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:a.dt,supported:ie,setRTLTextPlugin:a.dv,getRTLTextPluginStatus:a.dw,Map:class extends gs{constructor(p){a.dc.mark(a.dd.create);const r=p;if(null!=(p=a.W({},Ph,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&a.de(window)&&(p.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Do(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Ud,this._domRenderTaskQueue=new Ud,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.df(),this._locale=a.W({},Rp,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Kl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new a.dg(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?{...p.contextCreateOptions}:{},"string"==typeof p.container){const u=document.getElementById(p.container);if(!u)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=u}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),a.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Uc),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Yu(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||a.d8.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new Ih("string"==typeof p.hash&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==r.center&&null==r.zoom||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const u=p.bounds;u&&(this.resize(),this.fitBounds(u,a.W({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new Wl({customAttribution:p.customAttribution})),this._logoControl=new zr,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",u=>{this._update("style"===u.dataType),this.fire(new a.f(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new a.f(`${u.dataType}dataloading`,u))})}_getMapId(){return this._mapId}addControl(p,r){if(void 0===r&&(r=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new a.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[r];return-1!==r.indexOf("bottom")?m.insertBefore(u,m.firstChild):m.appendChild(u),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new a.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(p);return r>-1&&this._controls.splice(r,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new a.f("movestart",p)).fire(new a.f("move",p)),this.fire(new a.f("resize",p)),r&&this.fire(new a.f("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(a.ai.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new a.f("zoomstart")).fire(new a.f("zoom")).fire(new a.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new a.f("zoomstart")).fire(new a.f("zoom")).fire(new a.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new a.f("pitchstart")).fire(new a.f("pitch")).fire(new a.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new a.f("pitchstart")).fire(new a.f("pitch")).fire(new a.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return"auto"===p?navigator.language:Array.isArray(p)?0===p.length?void 0:p.map(r=>"auto"===r?navigator.language:r):p}setLanguage(p){const r=this._parseLanguage(p);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(p){return this._lazyInitEmptyStyle(),p?"string"==typeof p&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const p=this.transform,r=p.projection.name;let u;"globe"===r&&p.zoom>=a.aU?(p.setMercatorFromTransition(),u=!0):"mercator"===r&&p.zoom<a.aU&&(p.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,r){return this._updateProjection(p||r||{name:"mercator"})}_updateProjection(p){let r;return r="globe"===p.name&&this.transform.zoom>=a.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p){return this.transform.locationPoint3D(a.aI.convert(p))}unproject(p){return this.transform.pointLocation3D(a.P.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,r,u){if("mouseenter"===p||"mouseover"===p){let m=!1;const b=I=>{const M=r.filter(L=>this.getLayer(L)),R=M.length?this.queryRenderedFeatures(I.point,{layers:M}):[];R.length?m||(m=!0,u.call(this,new ca(p,this,I.originalEvent,{features:R}))):m=!1},w=()=>{m=!1};return{layers:new Set(r),listener:u,delegates:{mousemove:b,mouseout:w}}}if("mouseleave"===p||"mouseout"===p){let m=!1;const b=I=>{const M=r.filter(R=>this.getLayer(R));(M.length?this.queryRenderedFeatures(I.point,{layers:M}):[]).length?m=!0:m&&(m=!1,u.call(this,new ca(p,this,I.originalEvent)))},w=I=>{m&&(m=!1,u.call(this,new ca(p,this,I.originalEvent)))};return{layers:new Set(r),listener:u,delegates:{mousemove:b,mouseout:w}}}{const m=b=>{const w=r.filter(M=>this.getLayer(M)),I=w.length?this.queryRenderedFeatures(b.point,{layers:w}):[];I.length&&(b.features=I,u.call(this,b),delete b.features)};return{layers:new Set(r),listener:u,delegates:{[p]:m}}}}on(p,r,u){if("function"==typeof r||void 0===u)return super.on(p,r);if(Array.isArray(r)||(r=[r]),r)for(const b of r)if(!this._isValidId(b))return this;const m=this._createDelegatedListener(p,r,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const b in m.delegates)this.on(b,m.delegates[b]);return this}once(p,r,u){if("function"==typeof r||void 0===u)return super.once(p,r);if(Array.isArray(r)||(r=[r]),r)for(const b of r)if(!this._isValidId(b))return this;const m=this._createDelegatedListener(p,r,u);for(const b in m.delegates)this.once(b,m.delegates[b]);return this}off(p,r,u){if("function"==typeof r||void 0===u)return super.off(p,r);const m=new Set(Array.isArray(r)?r:[r]);for(const I of m)if(!this._isValidId(I))return this;const b=(I,M)=>{if(I.size!==M.size)return!1;for(const R of I)if(!M.has(R))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[p]:void 0;return w&&(I=>{for(let M=0;M<I.length;M++){const R=I[M];if(R.listener===u&&b(R.layers,m)){for(const L in R.delegates)this.off(L,R.delegates[L]);return I.splice(M,1),this}}})(w),this}queryRenderedFeatures(p,r){if(!this.style)return[];if(void 0!==r||void 0===p||p instanceof a.P||Array.isArray(p)||(r=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],(r=r||{}).layers&&Array.isArray(r.layers))for(const u of r.layers)if(!this._isValidId(u))return[];return this.style.queryRenderedFeatures(p,r,this.transform)}querySourceFeatures(p,r){return this._isValidId(p)?this.style.querySourceFeatures(p,r):[]}isPointOnSurface(p){const{name:r}=this.transform.projection;return"globe"!==r&&"mercator"!==r&&a.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(p))}setStyle(p,r){return r=a.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&p&&!1!==r.diff&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(p,(u,m)=>{u?(a.w(`Unable to perform style diff: ${String(u.message||u.error||u)}. Rebuilding the style from scratch.`),this._updateStyle(p,r)):m&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(p,r))}_getUIString(p){const r=this._locale[p];if(null==r)throw new Error(`Missing UI string '${p}'`);return r}_updateStyle(p,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){const u=a.W({},r);r&&r.config&&(u.initialConfig=r.config,delete u.config),this.style=new ia(this,u).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ia(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(p){return null==p?(this.fire(new a.d(new Error("IDs can't be empty."))),!1):!a.cV(p)||(this.fire(new a.d(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}addSource(p,r){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,r),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,r,u){this._lazyInitEmptyStyle(),this.style.addSourceType(p,r,u)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,r,{pixelRatio:u=1,sdf:m=!1,stretchX:b,stretchY:w,content:I}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:M,height:R,data:L}=a.e.getImageData(r);this.style.addImage(p,{data:new a.i({width:M,height:R},L),pixelRatio:u,stretchX:b,stretchY:w,content:I,sdf:m,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new a.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:R}=r,L=r;this.style.addImage(p,{data:new a.i({width:M,height:R},new Uint8Array(L.data)),pixelRatio:u,stretchX:b,stretchY:w,content:I,sdf:m,version:0,userImage:L}),L.onAdd&&L.onAdd(this,p)}}updateImage(p,r){this._lazyInitEmptyStyle();const u=this.style.getImage(p);if(!u)return void this.fire(new a.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?a.e.getImageData(r):r,{width:b,height:w,data:I}=m;if(void 0===b||void 0===w)return void this.fire(new a.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==u.data.width||w!==u.data.height)return void this.fire(new a.d(new Error(`The width and height of the updated image (${b}, ${w})\n                must be that same as the previous version of the image\n                (${u.data.width}, ${u.data.height})`)));const M=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);u.data.replace(I,M),this.style.updateImage(p,u)}hasImage(p){return p?!!this.style&&!!this.style.getImage(p):(this.fire(new a.d(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,r){a.h(this._requestManager.transformRequest(p,a.R.Image),(u,m)=>{r(u,m instanceof HTMLImageElement?a.e.getImageData(m):m)})}listImages(){return this.style.listImages()}addModel(p,r){this._lazyInitEmptyStyle(),this.style.addModel(p,r)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new a.d(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,r){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,r),this._update(!0)):this}getSlot(p){const r=this.getLayer(p);return r&&r.slot||null}setSlot(p,r){return this.style.setSlot(p,r),this.style.mergeLayers(),this._update(!0)}addImport(p,r){return this.style.addImport(p,r),this}updateImport(p,r){return"string"!=typeof r&&r.id!==p?(this.removeImport(p),this.addImport(r)):(this.style.updateImport(p,r),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,r){return this.style.moveImport(p,r),this._update(!0)}moveLayer(p,r){return this._isValidId(p)?(this.style.moveLayer(p,r),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;const r=this.style.getOwnLayer(p);return r?r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,r,u){return this._isValidId(p)?(this.style.setLayerZoomRange(p,r,u),this._update(!0)):this}setFilter(p,r,u={}){return this._isValidId(p)?(this.style.setFilter(p,r,u),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,r,u,m={}){return this._isValidId(p)?(this.style.setPaintProperty(p,r,u,m),this._update(!0)):this}getPaintProperty(p,r){return this._isValidId(p)?this.style.getPaintProperty(p,r):null}setLayoutProperty(p,r,u,m={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,r,u,m),this._update(!0)):this}getLayoutProperty(p,r){return this._isValidId(p)?this.style.getLayoutProperty(p,r):null}getSchema(p){return this.style.getSchema(p)}setSchema(p,r){return this.style.setSchema(p,r),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,r){return this.style.setConfig(p,r),this._update(!0)}getConfigProperty(p,r){return this.style.getConfigProperty(p,r)}setConfigProperty(p,r,u){return this.style.setConfigProperty(p,r,u),this._update(!0)}setLights(p){if(this._lazyInitEmptyStyle(),p&&1===p.length&&"flat"===p[0].type){const r=p[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return 0===p.length&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===p["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.aI.convert(p),this.transform):0}setFeatureState(p,r){return this._isValidId(p.source)?(this.style.setFeatureState(p,r),this._update()):this}removeFeatureState(p,r){return this._isValidId(p.source)?(this.style.removeFeatureState(p,r),this._update()):this}getFeatureState(p){return this._isValidId(p.source)?this.style.getFeatureState(p):null}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let u,m,b,w=this._container;for(;w&&(!m||!b);){const I=window.getComputedStyle(w).transform;I&&"none"!==I&&(u=I.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&"0"!==u[0]&&"1"!==u[0]&&(m=u[0]),u[3]&&"0"!==u[3]&&"1"!==u[3]&&(b=u[3])),w=w.parentElement}this._containerWidth=m?Math.abs(p/m):p,this._containerHeight=b?Math.abs(r/b):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=De("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=De("div","mapboxgl-canvas-container",p);this._canvas=De("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=De("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{m[b]=De("div",`mapboxgl-ctrl-${b}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,r){const u=a.e.devicePixelRatio||1;this._canvas.width=u*Math.ceil(p),this._canvas.height=u*Math.ceil(r),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${r}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const r=this._markers.indexOf(p);-1!==r&&this._markers.splice(r,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const r=this._popups.indexOf(p);-1!==r&&this._popups.splice(r,1)}_setupPainter(){const p=a.W({},ie.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",p);r?(a.dh(r,!0),this.painter=new ny(r,this._contextCreateOptions,this.transform,this._tp),this.on("data",u=>{"source"===u.dataType&&this.painter.setTileLoadedFlag(!0)}),a.di.testSupport(r)):this.fire(new a.d(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.f("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new a.f("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let r;this.fire(new a.f("renderstart")),++this._frameId;const u=this.painter.context.extTimerQuery,m=a.e.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=b.createQuery(),b.beginQuery(u.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,U=this.transform.pitch,G=a.e.now(),J=new a.X(L,{now:G,fadeDuration:w,pitch:U,transition:this.style.transition});this.style.update(J)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let I=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),I=this._updateAverageElevation(m),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):I=this._updateAverageElevation(m);const M=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource);if(M&&(this._placementDirty=M.needsRerender,this._occlusionOpacityChanged=M.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.dc.mark(a.dd.load),this.fire(new a.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const L=a.e.now()-m;b.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{const U=b.getQueryParameter(r,b.QUERY_RESULT)/1e6;b.deleteQuery(r),this.fire(new a.f("gpu-timing-frame",{cpuTime:L,gpuTime:U}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const U=this.painter.queryGpuTimers(L);this.fire(new a.f("gpu-timing-layer",{layerTimes:U}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const U=this.painter.queryGpuTimeDeferredRender(L);this.fire(new a.f("gpu-timing-deferred-render",{gpuTime:U}))},50)}const R=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||I;if((this._sourcesDirty||this._styleDirty||I||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),R||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{const L=!this.isMoving()&&this.loaded();if(L&&(I=this._updateAverageElevation(m,!0)),I)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new a.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const U=this._calculateSpeedIndex();this.fire(new a.f("speedindexcompleted",{speedIndex:U})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!R&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,a.dc.mark(a.dd.fullLoad),this._performanceMetricsCollection&&a.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const r of this._markers)p&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!p||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(p,r=!1){const u=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&u(0);const m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(r||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const b=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=p;const I=Math.abs(b-w);if(I>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(w),u(w);this._averageElevation.easeTo(w,p,300)}else if(I>1e-4)return this._averageElevation.jumpTo(w),u(w)}return!!this._averageElevation.isEasing(p)&&u(this._averageElevation.getValue(p))}_authenticate(){a.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===a.dl||401===p.status)){const r=this.painter.context.gl;a.dh(r,!1),this._logoControl instanceof zr&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&a.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const u=this.painter.context.gl,m=u.createFramebuffer();function b(w){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,w,0);const I=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,I),I}return u.bindFramebuffer(u.FRAMEBUFFER,m),this._canvasPixelComparison(b(p),r.canvasCopies.map(b),r.timeStamps)}_canvasPixelComparison(p,r,u){let m=u[1]-u[0];const b=p.length/4;for(let w=0;w<r.length;w++){const I=r[w];let M=0;for(let R=0;R<I.length;R+=4)I[R]===p[R]&&I[R+1]===p[R+1]&&I[R+2]===p[R+2]&&I[R+3]===p[R+3]&&(M+=1);m+=(u[w+2]-u[w+1])*(1-M/b)}return m}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.dp(this.painter.context.gl),a.dq.remove(),a.dr.remove(),this._removed=!0,this.fire(new a.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=a.e.frame(r=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(r)}))}_preloadTiles(p){const r=this.style?this.style.getSourceCaches():[];return a.ds(r,(u,m)=>u._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this._tp.refreshUI(),p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,this._tp.refreshUI(),p&&this._update())}_setCacheLimits(p,r){a.du(p,r)}_occlusionCriteriaSatisfied(){const p=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&p&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return a.dt}},NavigationControl:class{constructor(p={}){this.options=a.W({},nl,p),this._container=De("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(a.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),De("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),De("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:r}):u.resetNorth({},{originalEvent:r}))}),this._compassIcon=De("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const r=p.getZoom(),u=r===p.getMaxZoom(),m=r===p.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new lr(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,r){const u=De("button",p,this._container);return u.type="button",u.addEventListener("click",r),u}_setButtonTitle(p,r){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${r}`);p.setAttribute("aria-label",u),p.firstElementChild&&p.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends a.E{constructor(p={}){super();const r=navigator.geolocation;this.options=a.W({geolocation:r},Df,p),a.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Dp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=De("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const r=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,p(u)};void 0!==this._supportsGeolocation?p(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(u=>r("denied"!==u.state)).catch(()=>r()):r()}_isOutOfMapMaxBounds(p){const r=this._map.getMaxBounds(),u=p.coords;return!!r&&(u.longitude<r.getWest()||u.longitude>r.getEast()||u.latitude<r.getSouth()||u.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new a.f("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.f("geolocate",p)),this._finish()}}_updateCamera(p){const r=new a.aI(p.coords.longitude,p.coords.latitude),u=p.coords.accuracy,m=this._map.getBearing(),b=a.W({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(u),b,{geolocateSource:!0})}_updateMarker(p){if(p){const r=new a.aI(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,r=a.ax(1,p._center.lat)*p.worldSize,u=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.f("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=De("button","mapboxgl-ctrl-geolocate",this._container),De("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=De("div","mapboxgl-user-location"),this._dotElement.appendChild(De("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(De("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new fs({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=De("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new fs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.f("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Wl,ScaleControl:class{constructor(p={}){this.options=a.W({},Zl,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,r=this._map,u=r._containerHeight/2,m=r._containerWidth/2-p/2,b=r.unproject([m,u]),w=r.unproject([m+p,u]),I=b.distanceTo(w);if("imperial"===this.options.unit){const M=3.2808*I;M>5280?this._setScale(p,M/5280,"mile"):this._setScale(p,M,"foot")}else"nautical"===this.options.unit?this._setScale(p,I/1852,"nautical-mile"):I>=1e3?this._setScale(p,I/1e3,"kilometer"):this._setScale(p,I,"meter")}_setScale(p,r,u){this._map._requestDomTask(()=>{const m=function(w){const I=Math.pow(10,`${Math.floor(w)}`.length-1);let M=w/I;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(R){const L=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*L)/L}(M),I*M}(r),b=m/r;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==u?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(m):`${m}&nbsp;${ql[u]}`,this._container.style.width=p*b+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=De("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:a.w("Full screen control 'container' must be a DOM element.")),a.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=De("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=De("button","mapboxgl-ctrl-fullscreen",this._controlContainer);De("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.E{constructor(p){super(),this.options=a.W(Object.create(zc),p),a.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new a.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new a.f("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=a.aI.convert(p),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const r=document.createDocumentFragment(),u=document.createElement("body");let m;for(u.innerHTML=p;m=u.firstChild,m;)r.appendChild(m);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=De("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(p),this.options.closeButton){const u=this._closeButton=De("button","mapboxgl-popup-close-button",r);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let r;return this._classList.delete(p)?r=!1:(this._classList.add(p),r=!0),this._updateClassList(),r}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const r=this._map,u=this._container,m=this._pos;if(!r||!u||!m)return"bottom";const b=u.offsetWidth,w=u.offsetHeight,I=m.x<b/2,M=m.x>r.transform.width-b/2;if(m.y+p<w)return I?"top-left":M?"top-right":"top";if(m.y>r.transform.height-w){if(I)return"bottom-left";if(M)return"bottom-right"}return I?"left":M?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),p.className=r.join(" ")}_update(p){const r=this._map,u=this._content;if(!r||!this._lngLat&&!this._trackPointer||!u)return;let m=this._container;if(m||(m=this._container=De("div","mapboxgl-popup",r.getContainer()),this._tip=De("div","mapboxgl-popup-tip",m),m.appendChild(u)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Pp(this._lngLat,this._pos,r.transform)),!this._trackPointer||p){const b=this._pos=this._trackPointer&&p instanceof a.P?p:r.project(this._lngLat),w=Xl(this.options.offset),I=this._anchor=this._getAnchor(w.y),M=Xl(this.options.offset,I),R=b.add(M).round();r._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${gu[I]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&r._showingGlobe()){const b=a.d9(r.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(_u);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:fs,Style:ia,LngLat:a.aI,LngLatBounds:a.ai,Point:a.P,MercatorCoordinate:a.Y,FreeCameraOptions:he,Evented:a.E,config:a.d8,prewarm:a.dx,clearPrewarmedResources:a.dy,get accessToken(){return a.d8.ACCESS_TOKEN},set accessToken(p){a.d8.ACCESS_TOKEN=p},get baseApiUrl(){return a.d8.API_URL},set baseApiUrl(p){a.d8.API_URL=p},get workerCount(){return a.dz.workerCount},set workerCount(p){a.dz.workerCount=p},get maxParallelImageRequests(){return a.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){a.d8.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){a.dA(p)},get workerUrl(){return a.dB.workerUrl},set workerUrl(p){a.dB.workerUrl=p},get workerClass(){return a.dB.workerClass},set workerClass(p){a.dB.workerClass=p},get workerParams(){return a.dB.workerParams},set workerParams(p){a.dB.workerParams=p},get dracoUrl(){return a.dC()},set dracoUrl(p){a.dD(p)},get meshoptUrl(){return a.dE()},set meshoptUrl(p){a.dF(p)},setNow:a.e.setNow,restoreNow:a.e.restoreNow}}),g}()},4412:(vi,Vt,B)=>{"use strict";B.d(Vt,{t:()=>v});var g=B(1413);class v extends g.B{constructor(a){super(),this._value=a}get value(){return this.getValue()}_subscribe(a){const Z=super._subscribe(a);return!Z.closed&&a.next(this._value),Z}getValue(){const{hasError:a,thrownError:Z,_value:ie}=this;if(a)throw Z;return this._throwIfClosed(),ie}next(a){super.next(this._value=a)}}},1985:(vi,Vt,B)=>{"use strict";B.d(Vt,{c:()=>Ce});var g=B(7707),v=B(8359),me=B(3494),a=B(1203),Z=B(1026),ie=B(8071),T=B(9786);let Ce=(()=>{class ze{constructor(We){We&&(this._subscribe=We)}lift(We){const Ne=new ze;return Ne.source=this,Ne.operator=We,Ne}subscribe(We,Ne,ht){const He=function re(ze){return ze&&ze instanceof g.vU||function Je(ze){return ze&&(0,ie.T)(ze.next)&&(0,ie.T)(ze.error)&&(0,ie.T)(ze.complete)}(ze)&&(0,v.Uv)(ze)}(We)?We:new g.Ms(We,Ne,ht);return(0,T.Y)(()=>{const{operator:be,source:Ye}=this;He.add(be?be.call(He,Ye):Ye?this._subscribe(He):this._trySubscribe(He))}),He}_trySubscribe(We){try{return this._subscribe(We)}catch(Ne){We.error(Ne)}}forEach(We,Ne){return new(Ne=De(Ne))((ht,He)=>{const be=new g.Ms({next:Ye=>{try{We(Ye)}catch(Le){He(Le),be.unsubscribe()}},error:He,complete:ht});this.subscribe(be)})}_subscribe(We){var Ne;return null===(Ne=this.source)||void 0===Ne?void 0:Ne.subscribe(We)}[me.s](){return this}pipe(...We){return(0,a.m)(We)(this)}toPromise(We){return new(We=De(We))((Ne,ht)=>{let He;this.subscribe(be=>He=be,be=>ht(be),()=>Ne(He))})}}return ze.create=je=>new ze(je),ze})();function De(ze){var je;return null!==(je=ze??Z.$.Promise)&&void 0!==je?je:Promise}},1413:(vi,Vt,B)=>{"use strict";B.d(Vt,{B:()=>T});var g=B(1985),v=B(8359);const a=(0,B(1853).L)(De=>function(){De(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Z=B(7908),ie=B(9786);let T=(()=>{class De extends g.c{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(re){const ze=new Ce(this,this);return ze.operator=re,ze}_throwIfClosed(){if(this.closed)throw new a}next(re){(0,ie.Y)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const ze of this.currentObservers)ze.next(re)}})}error(re){(0,ie.Y)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=re;const{observers:ze}=this;for(;ze.length;)ze.shift().error(re)}})}complete(){(0,ie.Y)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:re}=this;for(;re.length;)re.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var re;return(null===(re=this.observers)||void 0===re?void 0:re.length)>0}_trySubscribe(re){return this._throwIfClosed(),super._trySubscribe(re)}_subscribe(re){return this._throwIfClosed(),this._checkFinalizedStatuses(re),this._innerSubscribe(re)}_innerSubscribe(re){const{hasError:ze,isStopped:je,observers:We}=this;return ze||je?v.Kn:(this.currentObservers=null,We.push(re),new v.yU(()=>{this.currentObservers=null,(0,Z.o)(We,re)}))}_checkFinalizedStatuses(re){const{hasError:ze,thrownError:je,isStopped:We}=this;ze?re.error(je):We&&re.complete()}asObservable(){const re=new g.c;return re.source=this,re}}return De.create=(Je,re)=>new Ce(Je,re),De})();class Ce extends T{constructor(Je,re){super(),this.destination=Je,this.source=re}next(Je){var re,ze;null===(ze=null===(re=this.destination)||void 0===re?void 0:re.next)||void 0===ze||ze.call(re,Je)}error(Je){var re,ze;null===(ze=null===(re=this.destination)||void 0===re?void 0:re.error)||void 0===ze||ze.call(re,Je)}complete(){var Je,re;null===(re=null===(Je=this.destination)||void 0===Je?void 0:Je.complete)||void 0===re||re.call(Je)}_subscribe(Je){var re,ze;return null!==(ze=null===(re=this.source)||void 0===re?void 0:re.subscribe(Je))&&void 0!==ze?ze:v.Kn}}},7707:(vi,Vt,B)=>{"use strict";B.d(Vt,{Ms:()=>ht,vU:()=>ze});var g=B(8071),v=B(8359),me=B(1026),a=B(5334),Z=B(5343);const ie=De("C",void 0,void 0);function De(ot,Ve,Ue){return{kind:ot,value:Ve,error:Ue}}var Je=B(9270),re=B(9786);class ze extends v.yU{constructor(Ve){super(),this.isStopped=!1,Ve?(this.destination=Ve,(0,v.Uv)(Ve)&&Ve.add(this)):this.destination=Le}static create(Ve,Ue,$t){return new ht(Ve,Ue,$t)}next(Ve){this.isStopped?Ye(function Ce(ot){return De("N",ot,void 0)}(Ve),this):this._next(Ve)}error(Ve){this.isStopped?Ye(function T(ot){return De("E",void 0,ot)}(Ve),this):(this.isStopped=!0,this._error(Ve))}complete(){this.isStopped?Ye(ie,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Ve){this.destination.next(Ve)}_error(Ve){try{this.destination.error(Ve)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const je=Function.prototype.bind;function We(ot,Ve){return je.call(ot,Ve)}class Ne{constructor(Ve){this.partialObserver=Ve}next(Ve){const{partialObserver:Ue}=this;if(Ue.next)try{Ue.next(Ve)}catch($t){He($t)}}error(Ve){const{partialObserver:Ue}=this;if(Ue.error)try{Ue.error(Ve)}catch($t){He($t)}else He(Ve)}complete(){const{partialObserver:Ve}=this;if(Ve.complete)try{Ve.complete()}catch(Ue){He(Ue)}}}class ht extends ze{constructor(Ve,Ue,$t){let nt;if(super(),(0,g.T)(Ve)||!Ve)nt={next:Ve??void 0,error:Ue??void 0,complete:$t??void 0};else{let xt;this&&me.$.useDeprecatedNextContext?(xt=Object.create(Ve),xt.unsubscribe=()=>this.unsubscribe(),nt={next:Ve.next&&We(Ve.next,xt),error:Ve.error&&We(Ve.error,xt),complete:Ve.complete&&We(Ve.complete,xt)}):nt=Ve}this.destination=new Ne(nt)}}function He(ot){me.$.useDeprecatedSynchronousErrorHandling?(0,re.l)(ot):(0,a.m)(ot)}function Ye(ot,Ve){const{onStoppedNotification:Ue}=me.$;Ue&&Je.f.setTimeout(()=>Ue(ot,Ve))}const Le={closed:!0,next:Z.l,error:function be(ot){throw ot},complete:Z.l}},8359:(vi,Vt,B)=>{"use strict";B.d(Vt,{Kn:()=>ie,yU:()=>Z,Uv:()=>T});var g=B(8071);const me=(0,B(1853).L)(De=>function(re){De(this),this.message=re?`${re.length} errors occurred during unsubscription:\n${re.map((ze,je)=>`${je+1}) ${ze.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=re});var a=B(7908);class Z{constructor(Je){this.initialTeardown=Je,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let Je;if(!this.closed){this.closed=!0;const{_parentage:re}=this;if(re)if(this._parentage=null,Array.isArray(re))for(const We of re)We.remove(this);else re.remove(this);const{initialTeardown:ze}=this;if((0,g.T)(ze))try{ze()}catch(We){Je=We instanceof me?We.errors:[We]}const{_finalizers:je}=this;if(je){this._finalizers=null;for(const We of je)try{Ce(We)}catch(Ne){Je=Je??[],Ne instanceof me?Je=[...Je,...Ne.errors]:Je.push(Ne)}}if(Je)throw new me(Je)}}add(Je){var re;if(Je&&Je!==this)if(this.closed)Ce(Je);else{if(Je instanceof Z){if(Je.closed||Je._hasParent(this))return;Je._addParent(this)}(this._finalizers=null!==(re=this._finalizers)&&void 0!==re?re:[]).push(Je)}}_hasParent(Je){const{_parentage:re}=this;return re===Je||Array.isArray(re)&&re.includes(Je)}_addParent(Je){const{_parentage:re}=this;this._parentage=Array.isArray(re)?(re.push(Je),re):re?[re,Je]:Je}_removeParent(Je){const{_parentage:re}=this;re===Je?this._parentage=null:Array.isArray(re)&&(0,a.o)(re,Je)}remove(Je){const{_finalizers:re}=this;re&&(0,a.o)(re,Je),Je instanceof Z&&Je._removeParent(this)}}Z.EMPTY=(()=>{const De=new Z;return De.closed=!0,De})();const ie=Z.EMPTY;function T(De){return De instanceof Z||De&&"closed"in De&&(0,g.T)(De.remove)&&(0,g.T)(De.add)&&(0,g.T)(De.unsubscribe)}function Ce(De){(0,g.T)(De)?De():De.unsubscribe()}},1026:(vi,Vt,B)=>{"use strict";B.d(Vt,{$:()=>g});const g={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},4572:(vi,Vt,B)=>{"use strict";B.d(Vt,{z:()=>Je});var g=B(1985),v=B(3073),me=B(6648),a=B(3669),Z=B(6450),ie=B(3794),T=B(8496),Ce=B(4360),De=B(5225);function Je(...je){const We=(0,ie.lI)(je),Ne=(0,ie.ms)(je),{args:ht,keys:He}=(0,v.D)(je);if(0===ht.length)return(0,me.H)([],We);const be=new g.c(function re(je,We,Ne=a.D){return ht=>{ze(We,()=>{const{length:He}=je,be=new Array(He);let Ye=He,Le=He;for(let ot=0;ot<He;ot++)ze(We,()=>{const Ve=(0,me.H)(je[ot],We);let Ue=!1;Ve.subscribe((0,Ce._)(ht,$t=>{be[ot]=$t,Ue||(Ue=!0,Le--),Le||ht.next(Ne(be.slice()))},()=>{--Ye||ht.complete()}))},ht)},ht)}}(ht,We,He?Ye=>(0,T.e)(He,Ye):a.D));return Ne?be.pipe((0,Z.I)(Ne)):be}function ze(je,We,Ne){je?(0,De.N)(Ne,je,We):We()}},8793:(vi,Vt,B)=>{"use strict";B.d(Vt,{x:()=>Z});var g=B(6365),me=B(3794),a=B(6648);function Z(...ie){return function v(){return(0,g.U)(1)}()((0,a.H)(ie,(0,me.lI)(ie)))}},9030:(vi,Vt,B)=>{"use strict";B.d(Vt,{v:()=>me});var g=B(1985),v=B(8750);function me(a){return new g.c(Z=>{(0,v.Tg)(a()).subscribe(Z)})}},983:(vi,Vt,B)=>{"use strict";B.d(Vt,{w:()=>v});const v=new(B(1985).c)(Z=>Z.complete())},7468:(vi,Vt,B)=>{"use strict";B.d(Vt,{p:()=>Ce});var g=B(1985),v=B(3073),me=B(8750),a=B(3794),Z=B(4360),ie=B(6450),T=B(8496);function Ce(...De){const Je=(0,a.ms)(De),{args:re,keys:ze}=(0,v.D)(De),je=new g.c(We=>{const{length:Ne}=re;if(!Ne)return void We.complete();const ht=new Array(Ne);let He=Ne,be=Ne;for(let Ye=0;Ye<Ne;Ye++){let Le=!1;(0,me.Tg)(re[Ye]).subscribe((0,Z._)(We,ot=>{Le||(Le=!0,be--),ht[Ye]=ot},()=>He--,void 0,()=>{(!He||!Le)&&(be||We.next(ze?(0,T.e)(ze,ht):ht),We.complete())}))}});return Je?je.pipe((0,ie.I)(Je)):je}},6648:(vi,Vt,B)=>{"use strict";B.d(Vt,{H:()=>$t});var g=B(8750),v=B(5225),me=B(9974),a=B(4360);function Z(nt,xt=0){return(0,me.N)((ct,Mt)=>{ct.subscribe((0,a._)(Mt,$e=>(0,v.N)(Mt,nt,()=>Mt.next($e),xt),()=>(0,v.N)(Mt,nt,()=>Mt.complete(),xt),$e=>(0,v.N)(Mt,nt,()=>Mt.error($e),xt)))})}function ie(nt,xt=0){return(0,me.N)((ct,Mt)=>{Mt.add(nt.schedule(()=>ct.subscribe(Mt),xt))})}var De=B(1985),re=B(4761),ze=B(8071);function We(nt,xt){if(!nt)throw new Error("Iterable cannot be null");return new De.c(ct=>{(0,v.N)(ct,xt,()=>{const Mt=nt[Symbol.asyncIterator]();(0,v.N)(ct,xt,()=>{Mt.next().then($e=>{$e.done?ct.complete():ct.next($e.value)})},0,!0)})})}var Ne=B(5055),ht=B(9858),He=B(7441),be=B(5397),Ye=B(7953),Le=B(591),ot=B(5196);function $t(nt,xt){return xt?function Ue(nt,xt){if(null!=nt){if((0,Ne.l)(nt))return function T(nt,xt){return(0,g.Tg)(nt).pipe(ie(xt),Z(xt))}(nt,xt);if((0,He.X)(nt))return function Je(nt,xt){return new De.c(ct=>{let Mt=0;return xt.schedule(function(){Mt===nt.length?ct.complete():(ct.next(nt[Mt++]),ct.closed||this.schedule())})})}(nt,xt);if((0,ht.y)(nt))return function Ce(nt,xt){return(0,g.Tg)(nt).pipe(ie(xt),Z(xt))}(nt,xt);if((0,Ye.T)(nt))return We(nt,xt);if((0,be.x)(nt))return function je(nt,xt){return new De.c(ct=>{let Mt;return(0,v.N)(ct,xt,()=>{Mt=nt[re.l](),(0,v.N)(ct,xt,()=>{let $e,Et;try{({value:$e,done:Et}=Mt.next())}catch(cn){return void ct.error(cn)}Et?ct.complete():ct.next($e)},0,!0)}),()=>(0,ze.T)(Mt?.return)&&Mt.return()})}(nt,xt);if((0,ot.U)(nt))return function Ve(nt,xt){return We((0,ot.C)(nt),xt)}(nt,xt)}throw(0,Le.L)(nt)}(nt,xt):(0,g.Tg)(nt)}},3726:(vi,Vt,B)=>{"use strict";B.d(Vt,{R:()=>Je});var g=B(8750),v=B(1985),me=B(1397),a=B(7441),Z=B(8071),ie=B(6450);const T=["addListener","removeListener"],Ce=["addEventListener","removeEventListener"],De=["on","off"];function Je(Ne,ht,He,be){if((0,Z.T)(He)&&(be=He,He=void 0),be)return Je(Ne,ht,He).pipe((0,ie.I)(be));const[Ye,Le]=function We(Ne){return(0,Z.T)(Ne.addEventListener)&&(0,Z.T)(Ne.removeEventListener)}(Ne)?Ce.map(ot=>Ve=>Ne[ot](ht,Ve,He)):function ze(Ne){return(0,Z.T)(Ne.addListener)&&(0,Z.T)(Ne.removeListener)}(Ne)?T.map(re(Ne,ht)):function je(Ne){return(0,Z.T)(Ne.on)&&(0,Z.T)(Ne.off)}(Ne)?De.map(re(Ne,ht)):[];if(!Ye&&(0,a.X)(Ne))return(0,me.Z)(ot=>Je(ot,ht,He))((0,g.Tg)(Ne));if(!Ye)throw new TypeError("Invalid event target");return new v.c(ot=>{const Ve=(...Ue)=>ot.next(1<Ue.length?Ue:Ue[0]);return Ye(Ve),()=>Le(Ve)})}function re(Ne,ht){return He=>be=>Ne[He](ht,be)}},8750:(vi,Vt,B)=>{"use strict";B.d(Vt,{Tg:()=>je});var g=B(1635),v=B(7441),me=B(9858),a=B(1985),Z=B(5055),ie=B(7953),T=B(591),Ce=B(5397),De=B(5196),Je=B(8071),re=B(5334),ze=B(3494);function je(ot){if(ot instanceof a.c)return ot;if(null!=ot){if((0,Z.l)(ot))return function We(ot){return new a.c(Ve=>{const Ue=ot[ze.s]();if((0,Je.T)(Ue.subscribe))return Ue.subscribe(Ve);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(ot);if((0,v.X)(ot))return function Ne(ot){return new a.c(Ve=>{for(let Ue=0;Ue<ot.length&&!Ve.closed;Ue++)Ve.next(ot[Ue]);Ve.complete()})}(ot);if((0,me.y)(ot))return function ht(ot){return new a.c(Ve=>{ot.then(Ue=>{Ve.closed||(Ve.next(Ue),Ve.complete())},Ue=>Ve.error(Ue)).then(null,re.m)})}(ot);if((0,ie.T)(ot))return be(ot);if((0,Ce.x)(ot))return function He(ot){return new a.c(Ve=>{for(const Ue of ot)if(Ve.next(Ue),Ve.closed)return;Ve.complete()})}(ot);if((0,De.U)(ot))return function Ye(ot){return be((0,De.C)(ot))}(ot)}throw(0,T.L)(ot)}function be(ot){return new a.c(Ve=>{(function Le(ot,Ve){var Ue,$t,nt,xt;return(0,g.sH)(this,void 0,void 0,function*(){try{for(Ue=(0,g.xN)(ot);!($t=yield Ue.next()).done;)if(Ve.next($t.value),Ve.closed)return}catch(ct){nt={error:ct}}finally{try{$t&&!$t.done&&(xt=Ue.return)&&(yield xt.call(Ue))}finally{if(nt)throw nt.error}}Ve.complete()})})(ot,Ve).catch(Ue=>Ve.error(Ue))})}},7673:(vi,Vt,B)=>{"use strict";B.d(Vt,{of:()=>me});var g=B(3794),v=B(6648);function me(...a){const Z=(0,g.lI)(a);return(0,v.H)(a,Z)}},4360:(vi,Vt,B)=>{"use strict";B.d(Vt,{_:()=>v});var g=B(7707);function v(a,Z,ie,T,Ce){return new me(a,Z,ie,T,Ce)}class me extends g.vU{constructor(Z,ie,T,Ce,De,Je){super(Z),this.onFinalize=De,this.shouldUnsubscribe=Je,this._next=ie?function(re){try{ie(re)}catch(ze){Z.error(ze)}}:super._next,this._error=Ce?function(re){try{Ce(re)}catch(ze){Z.error(ze)}finally{this.unsubscribe()}}:super._error,this._complete=T?function(){try{T()}catch(re){Z.error(re)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var Z;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:ie}=this;super.unsubscribe(),!ie&&(null===(Z=this.onFinalize)||void 0===Z||Z.call(this))}}}},274:(vi,Vt,B)=>{"use strict";B.d(Vt,{H:()=>me});var g=B(1397),v=B(8071);function me(a,Z){return(0,v.T)(Z)?(0,g.Z)(a,Z,1):(0,g.Z)(a,1)}},5964:(vi,Vt,B)=>{"use strict";B.d(Vt,{p:()=>me});var g=B(9974),v=B(4360);function me(a,Z){return(0,g.N)((ie,T)=>{let Ce=0;ie.subscribe((0,v._)(T,De=>a.call(Z,De,Ce++)&&T.next(De)))})}},980:(vi,Vt,B)=>{"use strict";B.d(Vt,{j:()=>v});var g=B(9974);function v(me){return(0,g.N)((a,Z)=>{try{a.subscribe(Z)}finally{Z.add(me)}})}},6354:(vi,Vt,B)=>{"use strict";B.d(Vt,{T:()=>me});var g=B(9974),v=B(4360);function me(a,Z){return(0,g.N)((ie,T)=>{let Ce=0;ie.subscribe((0,v._)(T,De=>{T.next(a.call(Z,De,Ce++))}))})}},6365:(vi,Vt,B)=>{"use strict";B.d(Vt,{U:()=>me});var g=B(1397),v=B(3669);function me(a=1/0){return(0,g.Z)(v.D,a)}},1397:(vi,Vt,B)=>{"use strict";B.d(Vt,{Z:()=>Ce});var g=B(6354),v=B(8750),me=B(9974),a=B(5225),Z=B(4360),T=B(8071);function Ce(De,Je,re=1/0){return(0,T.T)(Je)?Ce((ze,je)=>(0,g.T)((We,Ne)=>Je(ze,We,je,Ne))((0,v.Tg)(De(ze,je))),re):("number"==typeof Je&&(re=Je),(0,me.N)((ze,je)=>function ie(De,Je,re,ze,je,We,Ne,ht){const He=[];let be=0,Ye=0,Le=!1;const ot=()=>{Le&&!He.length&&!be&&Je.complete()},Ve=$t=>be<ze?Ue($t):He.push($t),Ue=$t=>{We&&Je.next($t),be++;let nt=!1;(0,v.Tg)(re($t,Ye++)).subscribe((0,Z._)(Je,xt=>{je?.(xt),We?Ve(xt):Je.next(xt)},()=>{nt=!0},void 0,()=>{if(nt)try{for(be--;He.length&&be<ze;){const xt=He.shift();Ne?(0,a.N)(Je,Ne,()=>Ue(xt)):Ue(xt)}ot()}catch(xt){Je.error(xt)}}))};return De.subscribe((0,Z._)(Je,Ve,()=>{Le=!0,ot()})),()=>{ht?.()}}(ze,je,De,re)))}},5558:(vi,Vt,B)=>{"use strict";B.d(Vt,{n:()=>a});var g=B(8750),v=B(9974),me=B(4360);function a(Z,ie){return(0,v.N)((T,Ce)=>{let De=null,Je=0,re=!1;const ze=()=>re&&!De&&Ce.complete();T.subscribe((0,me._)(Ce,je=>{De?.unsubscribe();let We=0;const Ne=Je++;(0,g.Tg)(Z(je,Ne)).subscribe(De=(0,me._)(Ce,ht=>Ce.next(ie?ie(je,ht,Ne,We++):ht),()=>{De=null,ze()}))},()=>{re=!0,ze()}))})}},6697:(vi,Vt,B)=>{"use strict";B.d(Vt,{s:()=>a});var g=B(983),v=B(9974),me=B(4360);function a(Z){return Z<=0?()=>g.w:(0,v.N)((ie,T)=>{let Ce=0;ie.subscribe((0,me._)(T,De=>{++Ce<=Z&&(T.next(De),Z<=Ce&&T.complete())}))})}},6129:(vi,Vt,B)=>{"use strict";B.d(Vt,{U:()=>g});const g={now:()=>(g.delegate||Date).now(),delegate:void 0}},9270:(vi,Vt,B)=>{"use strict";B.d(Vt,{f:()=>g});const g={setTimeout(v,me,...a){const{delegate:Z}=g;return Z?.setTimeout?Z.setTimeout(v,me,...a):setTimeout(v,me,...a)},clearTimeout(v){const{delegate:me}=g;return(me?.clearTimeout||clearTimeout)(v)},delegate:void 0}},4761:(vi,Vt,B)=>{"use strict";B.d(Vt,{l:()=>v});const v=function g(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},3494:(vi,Vt,B)=>{"use strict";B.d(Vt,{s:()=>g});const g="function"==typeof Symbol&&Symbol.observable||"@@observable"},3794:(vi,Vt,B)=>{"use strict";B.d(Vt,{ms:()=>a,lI:()=>Z});var g=B(8071);function me(T){return T[T.length-1]}function a(T){return(0,g.T)(me(T))?T.pop():void 0}function Z(T){return function v(T){return T&&(0,g.T)(T.schedule)}(me(T))?T.pop():void 0}},3073:(vi,Vt,B)=>{"use strict";B.d(Vt,{D:()=>Z});const{isArray:g}=Array,{getPrototypeOf:v,prototype:me,keys:a}=Object;function Z(T){if(1===T.length){const Ce=T[0];if(g(Ce))return{args:Ce,keys:null};if(function ie(T){return T&&"object"==typeof T&&v(T)===me}(Ce)){const De=a(Ce);return{args:De.map(Je=>Ce[Je]),keys:De}}}return{args:T,keys:null}}},7908:(vi,Vt,B)=>{"use strict";function g(v,me){if(v){const a=v.indexOf(me);0<=a&&v.splice(a,1)}}B.d(Vt,{o:()=>g})},1853:(vi,Vt,B)=>{"use strict";function g(v){const a=v(Z=>{Error.call(Z),Z.stack=(new Error).stack});return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a}B.d(Vt,{L:()=>g})},8496:(vi,Vt,B)=>{"use strict";function g(v,me){return v.reduce((a,Z,ie)=>(a[Z]=me[ie],a),{})}B.d(Vt,{e:()=>g})},9786:(vi,Vt,B)=>{"use strict";B.d(Vt,{Y:()=>me,l:()=>a});var g=B(1026);let v=null;function me(Z){if(g.$.useDeprecatedSynchronousErrorHandling){const ie=!v;if(ie&&(v={errorThrown:!1,error:null}),Z(),ie){const{errorThrown:T,error:Ce}=v;if(v=null,T)throw Ce}}else Z()}function a(Z){g.$.useDeprecatedSynchronousErrorHandling&&v&&(v.errorThrown=!0,v.error=Z)}},5225:(vi,Vt,B)=>{"use strict";function g(v,me,a,Z=0,ie=!1){const T=me.schedule(function(){a(),ie?v.add(this.schedule(null,Z)):this.unsubscribe()},Z);if(v.add(T),!ie)return T}B.d(Vt,{N:()=>g})},3669:(vi,Vt,B)=>{"use strict";function g(v){return v}B.d(Vt,{D:()=>g})},7441:(vi,Vt,B)=>{"use strict";B.d(Vt,{X:()=>g});const g=v=>v&&"number"==typeof v.length&&"function"!=typeof v},7953:(vi,Vt,B)=>{"use strict";B.d(Vt,{T:()=>v});var g=B(8071);function v(me){return Symbol.asyncIterator&&(0,g.T)(me?.[Symbol.asyncIterator])}},8071:(vi,Vt,B)=>{"use strict";function g(v){return"function"==typeof v}B.d(Vt,{T:()=>g})},5055:(vi,Vt,B)=>{"use strict";B.d(Vt,{l:()=>me});var g=B(3494),v=B(8071);function me(a){return(0,v.T)(a[g.s])}},5397:(vi,Vt,B)=>{"use strict";B.d(Vt,{x:()=>me});var g=B(4761),v=B(8071);function me(a){return(0,v.T)(a?.[g.l])}},4402:(vi,Vt,B)=>{"use strict";B.d(Vt,{A:()=>me});var g=B(1985),v=B(8071);function me(a){return!!a&&(a instanceof g.c||(0,v.T)(a.lift)&&(0,v.T)(a.subscribe))}},9858:(vi,Vt,B)=>{"use strict";B.d(Vt,{y:()=>v});var g=B(8071);function v(me){return(0,g.T)(me?.then)}},5196:(vi,Vt,B)=>{"use strict";B.d(Vt,{C:()=>me,U:()=>a});var g=B(1635),v=B(8071);function me(Z){return(0,g.AQ)(this,arguments,function*(){const T=Z.getReader();try{for(;;){const{value:Ce,done:De}=yield(0,g.N3)(T.read());if(De)return yield(0,g.N3)(void 0);yield yield(0,g.N3)(Ce)}}finally{T.releaseLock()}})}function a(Z){return(0,v.T)(Z?.getReader)}},9974:(vi,Vt,B)=>{"use strict";B.d(Vt,{N:()=>me,S:()=>v});var g=B(8071);function v(a){return(0,g.T)(a?.lift)}function me(a){return Z=>{if(v(Z))return Z.lift(function(ie){try{return a(ie,this)}catch(T){this.error(T)}});throw new TypeError("Unable to lift unknown Observable type")}}},6450:(vi,Vt,B)=>{"use strict";B.d(Vt,{I:()=>a});var g=B(6354);const{isArray:v}=Array;function a(Z){return(0,g.T)(ie=>function me(Z,ie){return v(ie)?Z(...ie):Z(ie)}(Z,ie))}},5343:(vi,Vt,B)=>{"use strict";function g(){}B.d(Vt,{l:()=>g})},1203:(vi,Vt,B)=>{"use strict";B.d(Vt,{F:()=>v,m:()=>me});var g=B(3669);function v(...a){return me(a)}function me(a){return 0===a.length?g.D:1===a.length?a[0]:function(ie){return a.reduce((T,Ce)=>Ce(T),ie)}}},5334:(vi,Vt,B)=>{"use strict";B.d(Vt,{m:()=>me});var g=B(1026),v=B(9270);function me(a){v.f.setTimeout(()=>{const{onUnhandledError:Z}=g.$;if(!Z)throw a;Z(a)})}},591:(vi,Vt,B)=>{"use strict";function g(v){return new TypeError(`You provided ${null!==v&&"object"==typeof v?"an invalid object":`'${v}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}B.d(Vt,{L:()=>g})},8996:(vi,Vt,B)=>{var g={"./ion-accordion_2.entry.js":[2375,2076,2375],"./ion-action-sheet.entry.js":[8814,2076,8814],"./ion-alert.entry.js":[5222,2076,5222],"./ion-app_8.entry.js":[7720,2076,7720],"./ion-avatar_3.entry.js":[1049,1049],"./ion-back-button.entry.js":[3162,2076,3162],"./ion-backdrop.entry.js":[7240,7240],"./ion-breadcrumb_2.entry.js":[8314,2076,8314],"./ion-button_2.entry.js":[4591,4591],"./ion-card_5.entry.js":[8584,8584],"./ion-checkbox.entry.js":[3511,3511],"./ion-chip.entry.js":[6024,6024],"./ion-col_3.entry.js":[5100,5100],"./ion-datetime-button.entry.js":[7428,1293,7428],"./ion-datetime_3.entry.js":[2885,1293,2076,2885],"./ion-fab_3.entry.js":[4463,2076,4463],"./ion-img.entry.js":[4183,4183],"./ion-infinite-scroll_2.entry.js":[4171,2076,4171],"./ion-input-password-toggle.entry.js":[6521,2076,6521],"./ion-input.entry.js":[9344,2076,9344],"./ion-item-option_3.entry.js":[5949,2076,5949],"./ion-item_8.entry.js":[3506,2076,3506],"./ion-loading.entry.js":[7372,2076,7372],"./ion-menu_3.entry.js":[2075,2076,2075],"./ion-modal.entry.js":[441,2076,441],"./ion-nav_2.entry.js":[5712,2076,5712],"./ion-picker-column-option.entry.js":[9013,9013],"./ion-picker-column.entry.js":[1459,2076,1459],"./ion-picker.entry.js":[6840,6840],"./ion-popover.entry.js":[6433,2076,6433],"./ion-progress-bar.entry.js":[9977,9977],"./ion-radio_2.entry.js":[8066,2076,8066],"./ion-range.entry.js":[8477,2076,8477],"./ion-refresher_2.entry.js":[5197,2076,5197],"./ion-reorder_2.entry.js":[7030,2076,7030],"./ion-ripple-effect.entry.js":[964,964],"./ion-route_4.entry.js":[8970,8970],"./ion-searchbar.entry.js":[8193,2076,8193],"./ion-segment_2.entry.js":[2560,2076,2560],"./ion-select_3.entry.js":[7076,2076,7076],"./ion-spinner.entry.js":[8805,2076,8805],"./ion-split-pane.entry.js":[5887,5887],"./ion-tab-bar_2.entry.js":[4406,2076,4406],"./ion-tab_2.entry.js":[1102,1102],"./ion-text.entry.js":[1577,1577],"./ion-textarea.entry.js":[2348,2076,2348],"./ion-toast.entry.js":[2415,2076,2415],"./ion-toggle.entry.js":[3814,2076,3814]};function v(me){if(!B.o(g,me))return Promise.resolve().then(()=>{var ie=new Error("Cannot find module '"+me+"'");throw ie.code="MODULE_NOT_FOUND",ie});var a=g[me],Z=a[0];return Promise.all(a.slice(1).map(B.e)).then(()=>B(Z))}v.keys=()=>Object.keys(g),v.id=8996,vi.exports=v},177:(vi,Vt,B)=>{"use strict";B.d(Vt,{AJ:()=>ln,MD:()=>Ut,N0:()=>To,QT:()=>me,QX:()=>ho,Sm:()=>ht,Sq:()=>Tt,T3:()=>ko,VF:()=>Z,Vy:()=>mi,Xr:()=>Hi,ZD:()=>a,_b:()=>Be,aZ:()=>be,bT:()=>Ai,fw:()=>He,hb:()=>We,hj:()=>De,qQ:()=>T,vh:()=>Vs});var g=B(3953);let v=null;function me(){return v}function a(V){v??=V}class Z{}const T=new g.nKC("");let Ce=(()=>{class V{historyGo(K){throw new Error("")}static#e=this.\u0275fac=function(ae){return new(ae||V)};static#t=this.\u0275prov=g.jDH({token:V,factory:()=>(0,g.WQX)(Je),providedIn:"platform"})}return V})();const De=new g.nKC("");let Je=(()=>{class V extends Ce{constructor(){super(),this._doc=(0,g.WQX)(T),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return me().getBaseHref(this._doc)}onPopState(K){const ae=me().getGlobalEventTarget(this._doc,"window");return ae.addEventListener("popstate",K,!1),()=>ae.removeEventListener("popstate",K)}onHashChange(K){const ae=me().getGlobalEventTarget(this._doc,"window");return ae.addEventListener("hashchange",K,!1),()=>ae.removeEventListener("hashchange",K)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(K){this._location.pathname=K}pushState(K,ae,Ot){this._history.pushState(K,ae,Ot)}replaceState(K,ae,Ot){this._history.replaceState(K,ae,Ot)}forward(){this._history.forward()}back(){this._history.back()}historyGo(K=0){this._history.go(K)}getState(){return this._history.state}static#e=this.\u0275fac=function(ae){return new(ae||V)};static#t=this.\u0275prov=g.jDH({token:V,factory:()=>new V,providedIn:"platform"})}return V})();function re(V,oe){if(0==V.length)return oe;if(0==oe.length)return V;let K=0;return V.endsWith("/")&&K++,oe.startsWith("/")&&K++,2==K?V+oe.substring(1):1==K?V+oe:V+"/"+oe}function ze(V){const oe=V.match(/#|\?|$/),K=oe&&oe.index||V.length;return V.slice(0,K-("/"===V[K-1]?1:0))+V.slice(K)}function je(V){return V&&"?"!==V[0]?"?"+V:V}let We=(()=>{class V{historyGo(K){throw new Error("")}static#e=this.\u0275fac=function(ae){return new(ae||V)};static#t=this.\u0275prov=g.jDH({token:V,factory:()=>(0,g.WQX)(ht),providedIn:"root"})}return V})();const Ne=new g.nKC("");let ht=(()=>{class V extends We{constructor(K,ae){super(),this._platformLocation=K,this._removeListenerFns=[],this._baseHref=ae??this._platformLocation.getBaseHrefFromDOM()??(0,g.WQX)(T).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(K){this._removeListenerFns.push(this._platformLocation.onPopState(K),this._platformLocation.onHashChange(K))}getBaseHref(){return this._baseHref}prepareExternalUrl(K){return re(this._baseHref,K)}path(K=!1){const ae=this._platformLocation.pathname+je(this._platformLocation.search),Ot=this._platformLocation.hash;return Ot&&K?`${ae}${Ot}`:ae}pushState(K,ae,Ot,Nn){const kn=this.prepareExternalUrl(Ot+je(Nn));this._platformLocation.pushState(K,ae,kn)}replaceState(K,ae,Ot,Nn){const kn=this.prepareExternalUrl(Ot+je(Nn));this._platformLocation.replaceState(K,ae,kn)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(K=0){this._platformLocation.historyGo?.(K)}static#e=this.\u0275fac=function(ae){return new(ae||V)(g.KVO(Ce),g.KVO(Ne,8))};static#t=this.\u0275prov=g.jDH({token:V,factory:V.\u0275fac,providedIn:"root"})}return V})(),He=(()=>{class V extends We{constructor(K,ae){super(),this._platformLocation=K,this._baseHref="",this._removeListenerFns=[],null!=ae&&(this._baseHref=ae)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(K){this._removeListenerFns.push(this._platformLocation.onPopState(K),this._platformLocation.onHashChange(K))}getBaseHref(){return this._baseHref}path(K=!1){const ae=this._platformLocation.hash??"#";return ae.length>0?ae.substring(1):ae}prepareExternalUrl(K){const ae=re(this._baseHref,K);return ae.length>0?"#"+ae:ae}pushState(K,ae,Ot,Nn){let kn=this.prepareExternalUrl(Ot+je(Nn));0==kn.length&&(kn=this._platformLocation.pathname),this._platformLocation.pushState(K,ae,kn)}replaceState(K,ae,Ot,Nn){let kn=this.prepareExternalUrl(Ot+je(Nn));0==kn.length&&(kn=this._platformLocation.pathname),this._platformLocation.replaceState(K,ae,kn)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(K=0){this._platformLocation.historyGo?.(K)}static#e=this.\u0275fac=function(ae){return new(ae||V)(g.KVO(Ce),g.KVO(Ne,8))};static#t=this.\u0275prov=g.jDH({token:V,factory:V.\u0275fac})}return V})(),be=(()=>{class V{constructor(K){this._subject=new g.bkB,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=K;const ae=this._locationStrategy.getBaseHref();this._basePath=function Ve(V){if(new RegExp("^(https?:)?//").test(V)){const[,K]=V.split(/\/\/[^\/]+/);return K}return V}(ze(ot(ae))),this._locationStrategy.onPopState(Ot=>{this._subject.emit({url:this.path(!0),pop:!0,state:Ot.state,type:Ot.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(K=!1){return this.normalize(this._locationStrategy.path(K))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(K,ae=""){return this.path()==this.normalize(K+je(ae))}normalize(K){return V.stripTrailingSlash(function Le(V,oe){if(!V||!oe.startsWith(V))return oe;const K=oe.substring(V.length);return""===K||["/",";","?","#"].includes(K[0])?K:oe}(this._basePath,ot(K)))}prepareExternalUrl(K){return K&&"/"!==K[0]&&(K="/"+K),this._locationStrategy.prepareExternalUrl(K)}go(K,ae="",Ot=null){this._locationStrategy.pushState(Ot,"",K,ae),this._notifyUrlChangeListeners(this.prepareExternalUrl(K+je(ae)),Ot)}replaceState(K,ae="",Ot=null){this._locationStrategy.replaceState(Ot,"",K,ae),this._notifyUrlChangeListeners(this.prepareExternalUrl(K+je(ae)),Ot)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(K=0){this._locationStrategy.historyGo?.(K)}onUrlChange(K){return this._urlChangeListeners.push(K),this._urlChangeSubscription??=this.subscribe(ae=>{this._notifyUrlChangeListeners(ae.url,ae.state)}),()=>{const ae=this._urlChangeListeners.indexOf(K);this._urlChangeListeners.splice(ae,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(K="",ae){this._urlChangeListeners.forEach(Ot=>Ot(K,ae))}subscribe(K,ae,Ot){return this._subject.subscribe({next:K,error:ae,complete:Ot})}static#e=this.normalizeQueryParams=je;static#t=this.joinWithSlash=re;static#n=this.stripTrailingSlash=ze;static#i=this.\u0275fac=function(ae){return new(ae||V)(g.KVO(We))};static#r=this.\u0275prov=g.jDH({token:V,factory:()=>function Ye(){return new be((0,g.KVO)(We))}(),providedIn:"root"})}return V})();function ot(V){return V.replace(/\/index.html$/,"")}var $t=function(V){return V[V.Decimal=0]="Decimal",V[V.Percent=1]="Percent",V[V.Currency=2]="Currency",V[V.Scientific=3]="Scientific",V}($t||{}),xt=function(V){return V[V.Format=0]="Format",V[V.Standalone=1]="Standalone",V}(xt||{}),ct=function(V){return V[V.Narrow=0]="Narrow",V[V.Abbreviated=1]="Abbreviated",V[V.Wide=2]="Wide",V[V.Short=3]="Short",V}(ct||{}),Mt=function(V){return V[V.Short=0]="Short",V[V.Medium=1]="Medium",V[V.Long=2]="Long",V[V.Full=3]="Full",V}(Mt||{});const $e={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function fe(V,oe){return pn((0,g.H5H)(V)[g.KH2.DateFormat],oe)}function vt(V,oe){return pn((0,g.H5H)(V)[g.KH2.TimeFormat],oe)}function _n(V,oe){return pn((0,g.H5H)(V)[g.KH2.DateTimeFormat],oe)}function Re(V,oe){const K=(0,g.H5H)(V),ae=K[g.KH2.NumberSymbols][oe];if(typeof ae>"u"){if(oe===$e.CurrencyDecimal)return K[g.KH2.NumberSymbols][$e.Decimal];if(oe===$e.CurrencyGroup)return K[g.KH2.NumberSymbols][$e.Group]}return ae}function _i(V){if(!V[g.KH2.ExtraData])throw new Error(`Missing extra locale data for the locale "${V[g.KH2.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function pn(V,oe){for(let K=oe;K>-1;K--)if(typeof V[K]<"u")return V[K];throw new Error("Locale data API: locale data undefined")}function An(V){const[oe,K]=V.split(":");return{hours:+oe,minutes:+K}}const Bt=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Nt={},Rn=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Ci=function(V){return V[V.Short=0]="Short",V[V.ShortGMT=1]="ShortGMT",V[V.Long=2]="Long",V[V.Extended=3]="Extended",V}(Ci||{}),Oi=function(V){return V[V.FullYear=0]="FullYear",V[V.Month=1]="Month",V[V.Date=2]="Date",V[V.Hours=3]="Hours",V[V.Minutes=4]="Minutes",V[V.Seconds=5]="Seconds",V[V.FractionalSeconds=6]="FractionalSeconds",V[V.Day=7]="Day",V}(Oi||{}),ei=function(V){return V[V.DayPeriods=0]="DayPeriods",V[V.Days=1]="Days",V[V.Months=2]="Months",V[V.Eras=3]="Eras",V}(ei||{});function no(V,oe,K,ae){let Ot=function On(V){if(Ln(V))return V;if("number"==typeof V&&!isNaN(V))return new Date(V);if("string"==typeof V){if(V=V.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(V)){const[Ot,Nn=1,kn=1]=V.split("-").map(Xi=>+Xi);return mo(Ot,Nn-1,kn)}const K=parseFloat(V);if(!isNaN(V-K))return new Date(K);let ae;if(ae=V.match(Bt))return function Ze(V){const oe=new Date(0);let K=0,ae=0;const Ot=V[8]?oe.setUTCFullYear:oe.setFullYear,Nn=V[8]?oe.setUTCHours:oe.setHours;V[9]&&(K=Number(V[9]+V[10]),ae=Number(V[9]+V[11])),Ot.call(oe,Number(V[1]),Number(V[2])-1,Number(V[3]));const kn=Number(V[4]||0)-K,Xi=Number(V[5]||0)-ae,vo=Number(V[6]||0),Ar=Math.floor(1e3*parseFloat("0."+(V[7]||0)));return Nn.call(oe,kn,Xi,vo,Ar),oe}(ae)}const oe=new Date(V);if(!Ln(oe))throw new Error(`Unable to convert "${V}" into a date`);return oe}(V);oe=mr(K,oe)||oe;let Xi,kn=[];for(;oe;){if(Xi=Rn.exec(oe),!Xi){kn.push(oe);break}{kn=kn.concat(Xi.slice(1));const Xr=kn.pop();if(!Xr)break;oe=Xr}}let vo=Ot.getTimezoneOffset();ae&&(vo=At(ae,vo),Ot=function pt(V,oe,K){const ae=K?-1:1,Ot=V.getTimezoneOffset();return function an(V,oe){return(V=new Date(V.getTime())).setMinutes(V.getMinutes()+oe),V}(V,ae*(At(oe,Ot)-Ot))}(Ot,ae,!0));let Ar="";return kn.forEach(Xr=>{const gi=function Cn(V){if(Bn[V])return Bn[V];let oe;switch(V){case"G":case"GG":case"GGG":oe=Yi(ei.Eras,ct.Abbreviated);break;case"GGGG":oe=Yi(ei.Eras,ct.Wide);break;case"GGGGG":oe=Yi(ei.Eras,ct.Narrow);break;case"y":oe=ii(Oi.FullYear,1,0,!1,!0);break;case"yy":oe=ii(Oi.FullYear,2,0,!0,!0);break;case"yyy":oe=ii(Oi.FullYear,3,0,!1,!0);break;case"yyyy":oe=ii(Oi.FullYear,4,0,!1,!0);break;case"Y":oe=bo(1);break;case"YY":oe=bo(2,!0);break;case"YYY":oe=bo(3);break;case"YYYY":oe=bo(4);break;case"M":case"L":oe=ii(Oi.Month,1,1);break;case"MM":case"LL":oe=ii(Oi.Month,2,1);break;case"MMM":oe=Yi(ei.Months,ct.Abbreviated);break;case"MMMM":oe=Yi(ei.Months,ct.Wide);break;case"MMMMM":oe=Yi(ei.Months,ct.Narrow);break;case"LLL":oe=Yi(ei.Months,ct.Abbreviated,xt.Standalone);break;case"LLLL":oe=Yi(ei.Months,ct.Wide,xt.Standalone);break;case"LLLLL":oe=Yi(ei.Months,ct.Narrow,xt.Standalone);break;case"w":oe=go(1);break;case"ww":oe=go(2);break;case"W":oe=go(1,!0);break;case"d":oe=ii(Oi.Date,1);break;case"dd":oe=ii(Oi.Date,2);break;case"c":case"cc":oe=ii(Oi.Day,1);break;case"ccc":oe=Yi(ei.Days,ct.Abbreviated,xt.Standalone);break;case"cccc":oe=Yi(ei.Days,ct.Wide,xt.Standalone);break;case"ccccc":oe=Yi(ei.Days,ct.Narrow,xt.Standalone);break;case"cccccc":oe=Yi(ei.Days,ct.Short,xt.Standalone);break;case"E":case"EE":case"EEE":oe=Yi(ei.Days,ct.Abbreviated);break;case"EEEE":oe=Yi(ei.Days,ct.Wide);break;case"EEEEE":oe=Yi(ei.Days,ct.Narrow);break;case"EEEEEE":oe=Yi(ei.Days,ct.Short);break;case"a":case"aa":case"aaa":oe=Yi(ei.DayPeriods,ct.Abbreviated);break;case"aaaa":oe=Yi(ei.DayPeriods,ct.Wide);break;case"aaaaa":oe=Yi(ei.DayPeriods,ct.Narrow);break;case"b":case"bb":case"bbb":oe=Yi(ei.DayPeriods,ct.Abbreviated,xt.Standalone,!0);break;case"bbbb":oe=Yi(ei.DayPeriods,ct.Wide,xt.Standalone,!0);break;case"bbbbb":oe=Yi(ei.DayPeriods,ct.Narrow,xt.Standalone,!0);break;case"B":case"BB":case"BBB":oe=Yi(ei.DayPeriods,ct.Abbreviated,xt.Format,!0);break;case"BBBB":oe=Yi(ei.DayPeriods,ct.Wide,xt.Format,!0);break;case"BBBBB":oe=Yi(ei.DayPeriods,ct.Narrow,xt.Format,!0);break;case"h":oe=ii(Oi.Hours,1,-12);break;case"hh":oe=ii(Oi.Hours,2,-12);break;case"H":oe=ii(Oi.Hours,1);break;case"HH":oe=ii(Oi.Hours,2);break;case"m":oe=ii(Oi.Minutes,1);break;case"mm":oe=ii(Oi.Minutes,2);break;case"s":oe=ii(Oi.Seconds,1);break;case"ss":oe=ii(Oi.Seconds,2);break;case"S":oe=ii(Oi.FractionalSeconds,1);break;case"SS":oe=ii(Oi.FractionalSeconds,2);break;case"SSS":oe=ii(Oi.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":oe=io(Ci.Short);break;case"ZZZZZ":oe=io(Ci.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":oe=io(Ci.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":oe=io(Ci.Long);break;default:return null}return Bn[V]=oe,oe}(Xr);Ar+=gi?gi(Ot,K,vo):"''"===Xr?"'":Xr.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),Ar}function mo(V,oe,K){const ae=new Date(0);return ae.setFullYear(V,oe,K),ae.setHours(0,0,0),ae}function mr(V,oe){const K=function cn(V){return(0,g.H5H)(V)[g.KH2.LocaleId]}(V);if(Nt[K]??={},Nt[K][oe])return Nt[K][oe];let ae="";switch(oe){case"shortDate":ae=fe(V,Mt.Short);break;case"mediumDate":ae=fe(V,Mt.Medium);break;case"longDate":ae=fe(V,Mt.Long);break;case"fullDate":ae=fe(V,Mt.Full);break;case"shortTime":ae=vt(V,Mt.Short);break;case"mediumTime":ae=vt(V,Mt.Medium);break;case"longTime":ae=vt(V,Mt.Long);break;case"fullTime":ae=vt(V,Mt.Full);break;case"short":const Ot=mr(V,"shortTime"),Nn=mr(V,"shortDate");ae=$n(_n(V,Mt.Short),[Ot,Nn]);break;case"medium":const kn=mr(V,"mediumTime"),Xi=mr(V,"mediumDate");ae=$n(_n(V,Mt.Medium),[kn,Xi]);break;case"long":const vo=mr(V,"longTime"),Ar=mr(V,"longDate");ae=$n(_n(V,Mt.Long),[vo,Ar]);break;case"full":const Xr=mr(V,"fullTime"),gi=mr(V,"fullDate");ae=$n(_n(V,Mt.Full),[Xr,gi])}return ae&&(Nt[K][oe]=ae),ae}function $n(V,oe){return oe&&(V=V.replace(/\{([^}]+)}/g,function(K,ae){return null!=oe&&ae in oe?oe[ae]:K})),V}function ar(V,oe,K="-",ae,Ot){let Nn="";(V<0||Ot&&V<=0)&&(Ot?V=1-V:(V=-V,Nn=K));let kn=String(V);for(;kn.length<oe;)kn="0"+kn;return ae&&(kn=kn.slice(kn.length-oe)),Nn+kn}function ii(V,oe,K=0,ae=!1,Ot=!1){return function(Nn,kn){let Xi=function oi(V,oe){switch(V){case Oi.FullYear:return oe.getFullYear();case Oi.Month:return oe.getMonth();case Oi.Date:return oe.getDate();case Oi.Hours:return oe.getHours();case Oi.Minutes:return oe.getMinutes();case Oi.Seconds:return oe.getSeconds();case Oi.FractionalSeconds:return oe.getMilliseconds();case Oi.Day:return oe.getDay();default:throw new Error(`Unknown DateType value "${V}".`)}}(V,Nn);if((K>0||Xi>-K)&&(Xi+=K),V===Oi.Hours)0===Xi&&-12===K&&(Xi=12);else if(V===Oi.FractionalSeconds)return function gn(V,oe){return ar(V,3).substring(0,oe)}(Xi,oe);const vo=Re(kn,$e.MinusSign);return ar(Xi,oe,vo,ae,Ot)}}function Yi(V,oe,K=xt.Format,ae=!1){return function(Ot,Nn){return function pr(V,oe,K,ae,Ot,Nn){switch(K){case ei.Months:return function Kt(V,oe,K){const ae=(0,g.H5H)(V),Nn=pn([ae[g.KH2.MonthsFormat],ae[g.KH2.MonthsStandalone]],oe);return pn(Nn,K)}(oe,Ot,ae)[V.getMonth()];case ei.Days:return function Kn(V,oe,K){const ae=(0,g.H5H)(V),Nn=pn([ae[g.KH2.DaysFormat],ae[g.KH2.DaysStandalone]],oe);return pn(Nn,K)}(oe,Ot,ae)[V.getDay()];case ei.DayPeriods:const kn=V.getHours(),Xi=V.getMinutes();if(Nn){const Ar=function ut(V){const oe=(0,g.H5H)(V);return _i(oe),(oe[g.KH2.ExtraData][2]||[]).map(ae=>"string"==typeof ae?An(ae):[An(ae[0]),An(ae[1])])}(oe),Xr=function nn(V,oe,K){const ae=(0,g.H5H)(V);_i(ae);const Nn=pn([ae[g.KH2.ExtraData][0],ae[g.KH2.ExtraData][1]],oe)||[];return pn(Nn,K)||[]}(oe,Ot,ae),gi=Ar.findIndex(qo=>{if(Array.isArray(qo)){const[Eo,Go]=qo,na=kn>=Eo.hours&&Xi>=Eo.minutes,Is=kn<Go.hours||kn===Go.hours&&Xi<Go.minutes;if(Eo.hours<Go.hours){if(na&&Is)return!0}else if(na||Is)return!0}else if(qo.hours===kn&&qo.minutes===Xi)return!0;return!1});if(-1!==gi)return Xr[gi]}return function fn(V,oe,K){const ae=(0,g.H5H)(V),Nn=pn([ae[g.KH2.DayPeriodsFormat],ae[g.KH2.DayPeriodsStandalone]],oe);return pn(Nn,K)}(oe,Ot,ae)[kn<12?0:1];case ei.Eras:return function at(V,oe){return pn((0,g.H5H)(V)[g.KH2.Eras],oe)}(oe,ae)[V.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${K}`)}}(Ot,Nn,V,oe,K,ae)}}function io(V){return function(oe,K,ae){const Ot=-1*ae,Nn=Re(K,$e.MinusSign),kn=Ot>0?Math.floor(Ot/60):Math.ceil(Ot/60);switch(V){case Ci.Short:return(Ot>=0?"+":"")+ar(kn,2,Nn)+ar(Math.abs(Ot%60),2,Nn);case Ci.ShortGMT:return"GMT"+(Ot>=0?"+":"")+ar(kn,1,Nn);case Ci.Long:return"GMT"+(Ot>=0?"+":"")+ar(kn,2,Nn)+":"+ar(Math.abs(Ot%60),2,Nn);case Ci.Extended:return 0===ae?"Z":(Ot>=0?"+":"")+ar(kn,2,Nn)+":"+ar(Math.abs(Ot%60),2,Nn);default:throw new Error(`Unknown zone width "${V}"`)}}}const ao=0,ro=4;function Po(V){const oe=V.getDay(),K=0===oe?-3:ro-oe;return mo(V.getFullYear(),V.getMonth(),V.getDate()+K)}function go(V,oe=!1){return function(K,ae){let Ot;if(oe){const Nn=new Date(K.getFullYear(),K.getMonth(),1).getDay()-1,kn=K.getDate();Ot=1+Math.floor((kn+Nn)/7)}else{const Nn=Po(K),kn=function co(V){const oe=mo(V,ao,1).getDay();return mo(V,0,1+(oe<=ro?ro:ro+7)-oe)}(Nn.getFullYear()),Xi=Nn.getTime()-kn.getTime();Ot=1+Math.round(Xi/6048e5)}return ar(Ot,V,Re(ae,$e.MinusSign))}}function bo(V,oe=!1){return function(K,ae){return ar(Po(K).getFullYear(),V,Re(ae,$e.MinusSign),oe)}}const Bn={};function At(V,oe){V=V.replace(/:/g,"");const K=Date.parse("Jan 01, 1970 00:00:00 "+V)/6e4;return isNaN(K)?oe:K}function Ln(V){return V instanceof Date&&!isNaN(V.valueOf())}const Dn=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function qi(V){const oe=parseInt(V);if(isNaN(oe))throw new Error("Invalid integer literal when parsing "+V);return oe}function Be(V,oe){oe=encodeURIComponent(oe);for(const K of V.split(";")){const ae=K.indexOf("="),[Ot,Nn]=-1==ae?[K,""]:[K.slice(0,ae),K.slice(ae+1)];if(Ot.trim()===oe)return decodeURIComponent(Nn)}return null}class mt{constructor(oe,K,ae,Ot){this.$implicit=oe,this.ngForOf=K,this.index=ae,this.count=Ot}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Tt=(()=>{class V{set ngForOf(K){this._ngForOf=K,this._ngForOfDirty=!0}set ngForTrackBy(K){this._trackByFn=K}get ngForTrackBy(){return this._trackByFn}constructor(K,ae,Ot){this._viewContainer=K,this._template=ae,this._differs=Ot,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(K){K&&(this._template=K)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const K=this._ngForOf;!this._differ&&K&&(this._differ=this._differs.find(K).create(this.ngForTrackBy))}if(this._differ){const K=this._differ.diff(this._ngForOf);K&&this._applyChanges(K)}}_applyChanges(K){const ae=this._viewContainer;K.forEachOperation((Ot,Nn,kn)=>{if(null==Ot.previousIndex)ae.createEmbeddedView(this._template,new mt(Ot.item,this._ngForOf,-1,-1),null===kn?void 0:kn);else if(null==kn)ae.remove(null===Nn?void 0:Nn);else if(null!==Nn){const Xi=ae.get(Nn);ae.move(Xi,kn),En(Xi,Ot)}});for(let Ot=0,Nn=ae.length;Ot<Nn;Ot++){const Xi=ae.get(Ot).context;Xi.index=Ot,Xi.count=Nn,Xi.ngForOf=this._ngForOf}K.forEachIdentityChange(Ot=>{En(ae.get(Ot.currentIndex),Ot)})}static ngTemplateContextGuard(K,ae){return!0}static#e=this.\u0275fac=function(ae){return new(ae||V)(g.rXU(g.c1b),g.rXU(g.C4Q),g.rXU(g._q3))};static#t=this.\u0275dir=g.FsC({type:V,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return V})();function En(V,oe){V.context.$implicit=oe.item}let Ai=(()=>{class V{constructor(K,ae){this._viewContainer=K,this._context=new Ri,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=ae}set ngIf(K){this._context.$implicit=this._context.ngIf=K,this._updateView()}set ngIfThen(K){pi("ngIfThen",K),this._thenTemplateRef=K,this._thenViewRef=null,this._updateView()}set ngIfElse(K){pi("ngIfElse",K),this._elseTemplateRef=K,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(K,ae){return!0}static#e=this.\u0275fac=function(ae){return new(ae||V)(g.rXU(g.c1b),g.rXU(g.C4Q))};static#t=this.\u0275dir=g.FsC({type:V,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return V})();class Ri{constructor(){this.$implicit=null,this.ngIf=null}}function pi(V,oe){if(oe&&!oe.createEmbeddedView)throw new Error(`${V} must be a TemplateRef, but received '${(0,g.Tbb)(oe)}'.`)}let ko=(()=>{class V{constructor(K){this._viewContainerRef=K,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(K){if(this._shouldRecreateView(K)){const ae=this._viewContainerRef;if(this._viewRef&&ae.remove(ae.indexOf(this._viewRef)),!this.ngTemplateOutlet)return void(this._viewRef=null);const Ot=this._createContextForwardProxy();this._viewRef=ae.createEmbeddedView(this.ngTemplateOutlet,Ot,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(K){return!!K.ngTemplateOutlet||!!K.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(K,ae,Ot)=>!!this.ngTemplateOutletContext&&Reflect.set(this.ngTemplateOutletContext,ae,Ot),get:(K,ae,Ot)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,ae,Ot)}})}static#e=this.\u0275fac=function(ae){return new(ae||V)(g.rXU(g.c1b))};static#t=this.\u0275dir=g.FsC({type:V,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[g.OA$]})}return V})();function Gr(V,oe){return new g.wOt(2100,!1)}const Wa=new g.nKC(""),bl=new g.nKC("");let Vs=(()=>{class V{constructor(K,ae,Ot){this.locale=K,this.defaultTimezone=ae,this.defaultOptions=Ot}transform(K,ae,Ot,Nn){if(null==K||""===K||K!=K)return null;try{return no(K,ae??this.defaultOptions?.dateFormat??"mediumDate",Nn||this.locale,Ot??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(kn){throw Gr()}}static#e=this.\u0275fac=function(ae){return new(ae||V)(g.rXU(g.xe9,16),g.rXU(Wa,24),g.rXU(bl,24))};static#t=this.\u0275pipe=g.EJ8({name:"date",type:V,pure:!0,standalone:!0})}return V})(),ho=(()=>{class V{constructor(K){this._locale=K}transform(K,ae,Ot){if(!function he(V){return!(null==V||""===V||V!=V)}(K))return null;Ot||=this._locale;try{return function on(V,oe,K){return function jt(V,oe,K,ae,Ot,Nn,kn=!1){let Xi="",vo=!1;if(isFinite(V)){let Ar=function Ei(V){let ae,Ot,Nn,kn,Xi,oe=Math.abs(V)+"",K=0;for((Ot=oe.indexOf("."))>-1&&(oe=oe.replace(".","")),(Nn=oe.search(/e/i))>0?(Ot<0&&(Ot=Nn),Ot+=+oe.slice(Nn+1),oe=oe.substring(0,Nn)):Ot<0&&(Ot=oe.length),Nn=0;"0"===oe.charAt(Nn);Nn++);if(Nn===(Xi=oe.length))ae=[0],Ot=1;else{for(Xi--;"0"===oe.charAt(Xi);)Xi--;for(Ot-=Nn,ae=[],kn=0;Nn<=Xi;Nn++,kn++)ae[kn]=Number(oe.charAt(Nn))}return Ot>22&&(ae=ae.splice(0,21),K=Ot-1,Ot=1),{digits:ae,exponent:K,integerLen:Ot}}(V);kn&&(Ar=function zn(V){if(0===V.digits[0])return V;const oe=V.digits.length-V.integerLen;return V.exponent?V.exponent+=2:(0===oe?V.digits.push(0,0):1===oe&&V.digits.push(0),V.integerLen+=2),V}(Ar));let Xr=oe.minInt,gi=oe.minFrac,qo=oe.maxFrac;if(Nn){const Yo=Nn.match(Dn);if(null===Yo)throw new Error(`${Nn} is not a valid digit info`);const ds=Yo[1],Ds=Yo[3],ts=Yo[5];null!=ds&&(Xr=qi(ds)),null!=Ds&&(gi=qi(Ds)),null!=ts?qo=qi(ts):null!=Ds&&gi>qo&&(qo=gi)}!function Ui(V,oe,K){if(oe>K)throw new Error(`The minimum number of digits after fraction (${oe}) is higher than the maximum (${K}).`);let ae=V.digits,Ot=ae.length-V.integerLen;const Nn=Math.min(Math.max(oe,Ot),K);let kn=Nn+V.integerLen,Xi=ae[kn];if(kn>0){ae.splice(Math.max(V.integerLen,kn));for(let gi=kn;gi<ae.length;gi++)ae[gi]=0}else{Ot=Math.max(0,Ot),V.integerLen=1,ae.length=Math.max(1,kn=Nn+1),ae[0]=0;for(let gi=1;gi<kn;gi++)ae[gi]=0}if(Xi>=5)if(kn-1<0){for(let gi=0;gi>kn;gi--)ae.unshift(0),V.integerLen++;ae.unshift(1),V.integerLen++}else ae[kn-1]++;for(;Ot<Math.max(0,Nn);Ot++)ae.push(0);let vo=0!==Nn;const Ar=oe+V.integerLen,Xr=ae.reduceRight(function(gi,qo,Eo,Go){return Go[Eo]=(qo+=gi)<10?qo:qo-10,vo&&(0===Go[Eo]&&Eo>=Ar?Go.pop():vo=!1),qo>=10?1:0},0);Xr&&(ae.unshift(Xr),V.integerLen++)}(Ar,gi,qo);let Eo=Ar.digits,Go=Ar.integerLen;const na=Ar.exponent;let Is=[];for(vo=Eo.every(Yo=>!Yo);Go<Xr;Go++)Eo.unshift(0);for(;Go<0;Go++)Eo.unshift(0);Go>0?Is=Eo.splice(Go,Eo.length):(Is=Eo,Eo=[0]);const Oa=[];for(Eo.length>=oe.lgSize&&Oa.unshift(Eo.splice(-oe.lgSize,Eo.length).join(""));Eo.length>oe.gSize;)Oa.unshift(Eo.splice(-oe.gSize,Eo.length).join(""));Eo.length&&Oa.unshift(Eo.join("")),Xi=Oa.join(Re(K,ae)),Is.length&&(Xi+=Re(K,Ot)+Is.join("")),na&&(Xi+=Re(K,$e.Exponential)+"+"+na)}else Xi=Re(K,$e.Infinity);return Xi=V<0&&!vo?oe.negPre+Xi+oe.negSuf:oe.posPre+Xi+oe.posSuf,Xi}(V,function Un(V,oe="-"){const K={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},ae=V.split(";"),Ot=ae[0],Nn=ae[1],kn=-1!==Ot.indexOf(".")?Ot.split("."):[Ot.substring(0,Ot.lastIndexOf("0")+1),Ot.substring(Ot.lastIndexOf("0")+1)],Xi=kn[0],vo=kn[1]||"";K.posPre=Xi.substring(0,Xi.indexOf("#"));for(let Xr=0;Xr<vo.length;Xr++){const gi=vo.charAt(Xr);"0"===gi?K.minFrac=K.maxFrac=Xr+1:"#"===gi?K.maxFrac=Xr+1:K.posSuf+=gi}const Ar=Xi.split(",");if(K.gSize=Ar[1]?Ar[1].length:0,K.lgSize=Ar[2]||Ar[1]?(Ar[2]||Ar[1]).length:0,Nn){const Xr=Ot.length-K.posPre.length-K.posSuf.length,gi=Nn.indexOf("#");K.negPre=Nn.substring(0,gi).replace(/'/g,""),K.negSuf=Nn.slice(gi+Xr).replace(/'/g,"")}else K.negPre=oe+K.posPre,K.negSuf=K.posSuf;return K}(function wn(V,oe){return(0,g.H5H)(V)[g.KH2.NumberFormats][oe]}(oe,$t.Decimal),Re(oe,$e.MinusSign)),oe,$e.Group,$e.Decimal,K)}(function qe(V){if("string"==typeof V&&!isNaN(Number(V)-parseFloat(V)))return Number(V);if("number"!=typeof V)throw new Error(`${V} is not a number`);return V}(K),Ot,ae)}catch(Nn){throw Gr()}}static#e=this.\u0275fac=function(ae){return new(ae||V)(g.rXU(g.xe9,16))};static#t=this.\u0275pipe=g.EJ8({name:"number",type:V,pure:!0,standalone:!0})}return V})();let Ut=(()=>{class V{static#e=this.\u0275fac=function(ae){return new(ae||V)};static#t=this.\u0275mod=g.$C({type:V});static#n=this.\u0275inj=g.G2t({})}return V})();const ln="browser",qn="server";function mi(V){return V===qn}let Hi=(()=>{class V{static#e=this.\u0275prov=(0,g.jDH)({token:V,providedIn:"root",factory:()=>function ti(V){return V===ln}((0,g.WQX)(g.Agw))?new Vi((0,g.WQX)(T),window):new ur})}return V})();class Vi{constructor(oe,K){this.document=oe,this.window=K,this.offset=()=>[0,0]}setOffset(oe){this.offset=Array.isArray(oe)?()=>oe:oe}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(oe){this.window.scrollTo(oe[0],oe[1])}scrollToAnchor(oe){const K=function er(V,oe){const K=V.getElementById(oe)||V.getElementsByName(oe)[0];if(K)return K;if("function"==typeof V.createTreeWalker&&V.body&&"function"==typeof V.body.attachShadow){const ae=V.createTreeWalker(V.body,NodeFilter.SHOW_ELEMENT);let Ot=ae.currentNode;for(;Ot;){const Nn=Ot.shadowRoot;if(Nn){const kn=Nn.getElementById(oe)||Nn.querySelector(`[name="${oe}"]`);if(kn)return kn}Ot=ae.nextNode()}}return null}(this.document,oe);K&&(this.scrollToElement(K),K.focus())}setHistoryScrollRestoration(oe){this.window.history.scrollRestoration=oe}scrollToElement(oe){const K=oe.getBoundingClientRect(),ae=K.left+this.window.pageXOffset,Ot=K.top+this.window.pageYOffset,Nn=this.offset();this.window.scrollTo(ae-Nn[0],Ot-Nn[1])}}class ur{setOffset(oe){}getScrollPosition(){return[0,0]}scrollToPosition(oe){}scrollToAnchor(oe){}setHistoryScrollRestoration(oe){}}class To{}},1626:(vi,Vt,B)=>{"use strict";B.d(Vt,{Lr:()=>We,Qq:()=>_n,a7:()=>ui,q1:()=>Ge});var g=B(467),v=B(3953),me=B(7673),a=B(1985),Z=B(6648),ie=B(274),T=B(5964),Ce=B(6354),De=B(980),Je=B(5558),re=B(177);class ze{}class je{}class We{constructor(mt){this.normalizedNames=new Map,this.lazyUpdate=null,mt?"string"==typeof mt?this.lazyInit=()=>{this.headers=new Map,mt.split("\n").forEach(Tt=>{const En=Tt.indexOf(":");if(En>0){const si=Tt.slice(0,En),Ai=si.toLowerCase(),Ri=Tt.slice(En+1).trim();this.maybeSetNormalizedName(si,Ai),this.headers.has(Ai)?this.headers.get(Ai).push(Ri):this.headers.set(Ai,[Ri])}})}:typeof Headers<"u"&&mt instanceof Headers?(this.headers=new Map,mt.forEach((Tt,En)=>{this.setHeaderEntries(En,Tt)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(mt).forEach(([Tt,En])=>{this.setHeaderEntries(Tt,En)})}:this.headers=new Map}has(mt){return this.init(),this.headers.has(mt.toLowerCase())}get(mt){this.init();const Tt=this.headers.get(mt.toLowerCase());return Tt&&Tt.length>0?Tt[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(mt){return this.init(),this.headers.get(mt.toLowerCase())||null}append(mt,Tt){return this.clone({name:mt,value:Tt,op:"a"})}set(mt,Tt){return this.clone({name:mt,value:Tt,op:"s"})}delete(mt,Tt){return this.clone({name:mt,value:Tt,op:"d"})}maybeSetNormalizedName(mt,Tt){this.normalizedNames.has(Tt)||this.normalizedNames.set(Tt,mt)}init(){this.lazyInit&&(this.lazyInit instanceof We?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(mt=>this.applyUpdate(mt)),this.lazyUpdate=null))}copyFrom(mt){mt.init(),Array.from(mt.headers.keys()).forEach(Tt=>{this.headers.set(Tt,mt.headers.get(Tt)),this.normalizedNames.set(Tt,mt.normalizedNames.get(Tt))})}clone(mt){const Tt=new We;return Tt.lazyInit=this.lazyInit&&this.lazyInit instanceof We?this.lazyInit:this,Tt.lazyUpdate=(this.lazyUpdate||[]).concat([mt]),Tt}applyUpdate(mt){const Tt=mt.name.toLowerCase();switch(mt.op){case"a":case"s":let En=mt.value;if("string"==typeof En&&(En=[En]),0===En.length)return;this.maybeSetNormalizedName(mt.name,Tt);const si=("a"===mt.op?this.headers.get(Tt):void 0)||[];si.push(...En),this.headers.set(Tt,si);break;case"d":const Ai=mt.value;if(Ai){let Ri=this.headers.get(Tt);if(!Ri)return;Ri=Ri.filter(pi=>-1===Ai.indexOf(pi)),0===Ri.length?(this.headers.delete(Tt),this.normalizedNames.delete(Tt)):this.headers.set(Tt,Ri)}else this.headers.delete(Tt),this.normalizedNames.delete(Tt)}}setHeaderEntries(mt,Tt){const En=(Array.isArray(Tt)?Tt:[Tt]).map(Ai=>Ai.toString()),si=mt.toLowerCase();this.headers.set(si,En),this.maybeSetNormalizedName(mt,si)}forEach(mt){this.init(),Array.from(this.normalizedNames.keys()).forEach(Tt=>mt(this.normalizedNames.get(Tt),this.headers.get(Tt)))}}class ht{encodeKey(mt){return Le(mt)}encodeValue(mt){return Le(mt)}decodeKey(mt){return decodeURIComponent(mt)}decodeValue(mt){return decodeURIComponent(mt)}}const be=/%(\d[a-f0-9])/gi,Ye={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Le(Ie){return encodeURIComponent(Ie).replace(be,(mt,Tt)=>Ye[Tt]??mt)}function ot(Ie){return`${Ie}`}class Ve{constructor(mt={}){if(this.updates=null,this.cloneFrom=null,this.encoder=mt.encoder||new ht,mt.fromString){if(mt.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function He(Ie,mt){const Tt=new Map;return Ie.length>0&&Ie.replace(/^\?/,"").split("&").forEach(si=>{const Ai=si.indexOf("="),[Ri,pi]=-1==Ai?[mt.decodeKey(si),""]:[mt.decodeKey(si.slice(0,Ai)),mt.decodeValue(si.slice(Ai+1))],Ti=Tt.get(Ri)||[];Ti.push(pi),Tt.set(Ri,Ti)}),Tt}(mt.fromString,this.encoder)}else mt.fromObject?(this.map=new Map,Object.keys(mt.fromObject).forEach(Tt=>{const En=mt.fromObject[Tt],si=Array.isArray(En)?En.map(ot):[ot(En)];this.map.set(Tt,si)})):this.map=null}has(mt){return this.init(),this.map.has(mt)}get(mt){this.init();const Tt=this.map.get(mt);return Tt?Tt[0]:null}getAll(mt){return this.init(),this.map.get(mt)||null}keys(){return this.init(),Array.from(this.map.keys())}append(mt,Tt){return this.clone({param:mt,value:Tt,op:"a"})}appendAll(mt){const Tt=[];return Object.keys(mt).forEach(En=>{const si=mt[En];Array.isArray(si)?si.forEach(Ai=>{Tt.push({param:En,value:Ai,op:"a"})}):Tt.push({param:En,value:si,op:"a"})}),this.clone(Tt)}set(mt,Tt){return this.clone({param:mt,value:Tt,op:"s"})}delete(mt,Tt){return this.clone({param:mt,value:Tt,op:"d"})}toString(){return this.init(),this.keys().map(mt=>{const Tt=this.encoder.encodeKey(mt);return this.map.get(mt).map(En=>Tt+"="+this.encoder.encodeValue(En)).join("&")}).filter(mt=>""!==mt).join("&")}clone(mt){const Tt=new Ve({encoder:this.encoder});return Tt.cloneFrom=this.cloneFrom||this,Tt.updates=(this.updates||[]).concat(mt),Tt}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(mt=>this.map.set(mt,this.cloneFrom.map.get(mt))),this.updates.forEach(mt=>{switch(mt.op){case"a":case"s":const Tt=("a"===mt.op?this.map.get(mt.param):void 0)||[];Tt.push(ot(mt.value)),this.map.set(mt.param,Tt);break;case"d":if(void 0===mt.value){this.map.delete(mt.param);break}{let En=this.map.get(mt.param)||[];const si=En.indexOf(ot(mt.value));-1!==si&&En.splice(si,1),En.length>0?this.map.set(mt.param,En):this.map.delete(mt.param)}}}),this.cloneFrom=this.updates=null)}}class $t{constructor(){this.map=new Map}set(mt,Tt){return this.map.set(mt,Tt),this}get(mt){return this.map.has(mt)||this.map.set(mt,mt.defaultValue()),this.map.get(mt)}delete(mt){return this.map.delete(mt),this}has(mt){return this.map.has(mt)}keys(){return this.map.keys()}}function xt(Ie){return typeof ArrayBuffer<"u"&&Ie instanceof ArrayBuffer}function ct(Ie){return typeof Blob<"u"&&Ie instanceof Blob}function Mt(Ie){return typeof FormData<"u"&&Ie instanceof FormData}class Et{constructor(mt,Tt,En,si){let Ai;if(this.url=Tt,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=mt.toUpperCase(),function nt(Ie){switch(Ie){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||si?(this.body=void 0!==En?En:null,Ai=si):Ai=En,Ai&&(this.reportProgress=!!Ai.reportProgress,this.withCredentials=!!Ai.withCredentials,Ai.responseType&&(this.responseType=Ai.responseType),Ai.headers&&(this.headers=Ai.headers),Ai.context&&(this.context=Ai.context),Ai.params&&(this.params=Ai.params),this.transferCache=Ai.transferCache),this.headers??=new We,this.context??=new $t,this.params){const Ri=this.params.toString();if(0===Ri.length)this.urlWithParams=Tt;else{const pi=Tt.indexOf("?");this.urlWithParams=Tt+(-1===pi?"?":pi<Tt.length-1?"&":"")+Ri}}else this.params=new Ve,this.urlWithParams=Tt}serializeBody(){return null===this.body?null:"string"==typeof this.body||xt(this.body)||ct(this.body)||Mt(this.body)||function $e(Ie){return typeof URLSearchParams<"u"&&Ie instanceof URLSearchParams}(this.body)?this.body:this.body instanceof Ve?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Mt(this.body)?null:ct(this.body)?this.body.type||null:xt(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Ve?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(mt={}){const Tt=mt.method||this.method,En=mt.url||this.url,si=mt.responseType||this.responseType,Ai=mt.transferCache??this.transferCache,Ri=void 0!==mt.body?mt.body:this.body,pi=mt.withCredentials??this.withCredentials,Ti=mt.reportProgress??this.reportProgress;let vr=mt.headers||this.headers,Io=mt.params||this.params;const gr=mt.context??this.context;return void 0!==mt.setHeaders&&(vr=Object.keys(mt.setHeaders).reduce((Nr,_o)=>Nr.set(_o,mt.setHeaders[_o]),vr)),mt.setParams&&(Io=Object.keys(mt.setParams).reduce((Nr,_o)=>Nr.set(_o,mt.setParams[_o]),Io)),new Et(Tt,En,Ri,{params:Io,headers:vr,context:gr,reportProgress:Ti,responseType:si,withCredentials:pi,transferCache:Ai})}}var cn=function(Ie){return Ie[Ie.Sent=0]="Sent",Ie[Ie.UploadProgress=1]="UploadProgress",Ie[Ie.ResponseHeader=2]="ResponseHeader",Ie[Ie.DownloadProgress=3]="DownloadProgress",Ie[Ie.Response=4]="Response",Ie[Ie.User=5]="User",Ie}(cn||{});class fn{constructor(mt,Tt=200,En="OK"){this.headers=mt.headers||new We,this.status=void 0!==mt.status?mt.status:Tt,this.statusText=mt.statusText||En,this.url=mt.url||null,this.ok=this.status>=200&&this.status<300}}class Kn extends fn{constructor(mt={}){super(mt),this.type=cn.ResponseHeader}clone(mt={}){return new Kn({headers:mt.headers||this.headers,status:void 0!==mt.status?mt.status:this.status,statusText:mt.statusText||this.statusText,url:mt.url||this.url||void 0})}}class Kt extends fn{constructor(mt={}){super(mt),this.type=cn.Response,this.body=void 0!==mt.body?mt.body:null}clone(mt={}){return new Kt({body:void 0!==mt.body?mt.body:this.body,headers:mt.headers||this.headers,status:void 0!==mt.status?mt.status:this.status,statusText:mt.statusText||this.statusText,url:mt.url||this.url||void 0})}}class at extends fn{constructor(mt){super(mt,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${mt.url||"(unknown url)"}`:`Http failure response for ${mt.url||"(unknown url)"}: ${mt.status} ${mt.statusText}`,this.error=mt.error||null}}function vt(Ie,mt){return{body:mt,headers:Ie.headers,context:Ie.context,observe:Ie.observe,params:Ie.params,reportProgress:Ie.reportProgress,responseType:Ie.responseType,withCredentials:Ie.withCredentials,transferCache:Ie.transferCache}}let _n=(()=>{class Ie{constructor(Tt){this.handler=Tt}request(Tt,En,si={}){let Ai;if(Tt instanceof Et)Ai=Tt;else{let Ti,vr;Ti=si.headers instanceof We?si.headers:new We(si.headers),si.params&&(vr=si.params instanceof Ve?si.params:new Ve({fromObject:si.params})),Ai=new Et(Tt,En,void 0!==si.body?si.body:null,{headers:Ti,context:si.context,params:vr,reportProgress:si.reportProgress,responseType:si.responseType||"json",withCredentials:si.withCredentials,transferCache:si.transferCache})}const Ri=(0,me.of)(Ai).pipe((0,ie.H)(Ti=>this.handler.handle(Ti)));if(Tt instanceof Et||"events"===si.observe)return Ri;const pi=Ri.pipe((0,T.p)(Ti=>Ti instanceof Kt));switch(si.observe||"body"){case"body":switch(Ai.responseType){case"arraybuffer":return pi.pipe((0,Ce.T)(Ti=>{if(null!==Ti.body&&!(Ti.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return Ti.body}));case"blob":return pi.pipe((0,Ce.T)(Ti=>{if(null!==Ti.body&&!(Ti.body instanceof Blob))throw new Error("Response is not a Blob.");return Ti.body}));case"text":return pi.pipe((0,Ce.T)(Ti=>{if(null!==Ti.body&&"string"!=typeof Ti.body)throw new Error("Response is not a string.");return Ti.body}));default:return pi.pipe((0,Ce.T)(Ti=>Ti.body))}case"response":return pi;default:throw new Error(`Unreachable: unhandled observe type ${si.observe}}`)}}delete(Tt,En={}){return this.request("DELETE",Tt,En)}get(Tt,En={}){return this.request("GET",Tt,En)}head(Tt,En={}){return this.request("HEAD",Tt,En)}jsonp(Tt,En){return this.request("JSONP",Tt,{params:(new Ve).append(En,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Tt,En={}){return this.request("OPTIONS",Tt,En)}patch(Tt,En,si={}){return this.request("PATCH",Tt,vt(si,En))}post(Tt,En,si={}){return this.request("POST",Tt,vt(si,En))}put(Tt,En,si={}){return this.request("PUT",Tt,vt(si,En))}static#e=this.\u0275fac=function(En){return new(En||Ie)(v.KVO(ze))};static#t=this.\u0275prov=v.jDH({token:Ie,factory:Ie.\u0275fac})}return Ie})();const Re=/^\)\]\}',?\n/;function it(Ie){if(Ie.url)return Ie.url;const mt="X-Request-URL".toLocaleLowerCase();return Ie.headers.get(mt)}let tn=(()=>{class Ie{constructor(){this.fetchImpl=(0,v.WQX)(bn,{optional:!0})?.fetch??fetch.bind(globalThis),this.ngZone=(0,v.WQX)(v.SKi)}handle(Tt){return new a.c(En=>{const si=new AbortController;return this.doRequest(Tt,si.signal,En).then(Jn,Ai=>En.error(new at({error:Ai}))),()=>si.abort()})}doRequest(Tt,En,si){var Ai=this;return(0,g.A)(function*(){const Ri=Ai.createRequestInit(Tt);let pi;try{const yo=Ai.ngZone.runOutsideAngular(()=>Ai.fetchImpl(Tt.urlWithParams,{signal:En,...Ri}));(function jn(Ie){Ie.then(Jn,Jn)})(yo),si.next({type:cn.Sent}),pi=yield yo}catch(yo){return void si.error(new at({error:yo,status:yo.status??0,statusText:yo.statusText,url:Tt.urlWithParams,headers:yo.headers}))}const Ti=new We(pi.headers),vr=pi.statusText,Io=it(pi)??Tt.urlWithParams;let gr=pi.status,Nr=null;if(Tt.reportProgress&&si.next(new Kn({headers:Ti,status:gr,statusText:vr,url:Io})),pi.body){const yo=pi.headers.get("content-length"),Vr=[],uo=pi.body.getReader();let Ls,Gr,ko=0;const xs=typeof Zone<"u"&&Zone.current;yield Ai.ngZone.runOutsideAngular((0,g.A)(function*(){for(;;){const{done:Ss,value:Sa}=yield uo.read();if(Ss)break;if(Vr.push(Sa),ko+=Sa.length,Tt.reportProgress){Gr="text"===Tt.responseType?(Gr??"")+(Ls??=new TextDecoder).decode(Sa,{stream:!0}):void 0;const ma=()=>si.next({type:cn.DownloadProgress,total:yo?+yo:void 0,loaded:ko,partialText:Gr});xs?xs.run(ma):ma()}}}));const Qs=Ai.concatChunks(Vr,ko);try{const Ss=pi.headers.get("Content-Type")??"";Nr=Ai.parseBody(Tt,Qs,Ss)}catch(Ss){return void si.error(new at({error:Ss,headers:new We(pi.headers),status:pi.status,statusText:pi.statusText,url:it(pi)??Tt.urlWithParams}))}}0===gr&&(gr=Nr?200:0),gr>=200&&gr<300?(si.next(new Kt({body:Nr,headers:Ti,status:gr,statusText:vr,url:Io})),si.complete()):si.error(new at({error:Nr,headers:Ti,status:gr,statusText:vr,url:Io}))})()}parseBody(Tt,En,si){switch(Tt.responseType){case"json":const Ai=(new TextDecoder).decode(En).replace(Re,"");return""===Ai?null:JSON.parse(Ai);case"text":return(new TextDecoder).decode(En);case"blob":return new Blob([En],{type:si});case"arraybuffer":return En.buffer}}createRequestInit(Tt){const En={},si=Tt.withCredentials?"include":void 0;if(Tt.headers.forEach((Ai,Ri)=>En[Ai]=Ri.join(",")),Tt.headers.has("Accept")||(En.Accept="application/json, text/plain, */*"),!Tt.headers.has("Content-Type")){const Ai=Tt.detectContentTypeHeader();null!==Ai&&(En["Content-Type"]=Ai)}return{body:Tt.serializeBody(),method:Tt.method,headers:En,credentials:si}}concatChunks(Tt,En){const si=new Uint8Array(En);let Ai=0;for(const Ri of Tt)si.set(Ri,Ai),Ai+=Ri.length;return si}static#e=this.\u0275fac=function(En){return new(En||Ie)};static#t=this.\u0275prov=v.jDH({token:Ie,factory:Ie.\u0275fac})}return Ie})();class bn{}function Jn(){}function _i(Ie,mt){return mt(Ie)}function ut(Ie,mt){return(Tt,En)=>mt.intercept(Tt,{handle:si=>Ie(si,En)})}const ui=new v.nKC(""),pn=new v.nKC(""),An=new v.nKC(""),Ct=new v.nKC("",{providedIn:"root",factory:()=>!0});function Qt(){let Ie=null;return(mt,Tt)=>{null===Ie&&(Ie=((0,v.WQX)(ui,{optional:!0})??[]).reduceRight(ut,_i));const En=(0,v.WQX)(v.TgB);if((0,v.WQX)(Ct)){const Ai=En.add();return Ie(mt,Tt).pipe((0,De.j)(()=>En.remove(Ai)))}return Ie(mt,Tt)}}let Nt=(()=>{class Ie extends ze{constructor(Tt,En){super(),this.backend=Tt,this.injector=En,this.chain=null,this.pendingTasks=(0,v.WQX)(v.TgB),this.contributeToStability=(0,v.WQX)(Ct)}handle(Tt){if(null===this.chain){const En=Array.from(new Set([...this.injector.get(pn),...this.injector.get(An,[])]));this.chain=En.reduceRight((si,Ai)=>function nn(Ie,mt,Tt){return(En,si)=>(0,v.N4e)(Tt,()=>mt(En,Ai=>Ie(Ai,si)))}(si,Ai,this.injector),_i)}if(this.contributeToStability){const En=this.pendingTasks.add();return this.chain(Tt,si=>this.backend.handle(si)).pipe((0,De.j)(()=>this.pendingTasks.remove(En)))}return this.chain(Tt,En=>this.backend.handle(En))}static#e=this.\u0275fac=function(En){return new(En||Ie)(v.KVO(je),v.KVO(v.uvJ))};static#t=this.\u0275prov=v.jDH({token:Ie,factory:Ie.\u0275fac})}return Ie})();const oi=/^\)\]\}',?\n/;let pr=(()=>{class Ie{constructor(Tt){this.xhrFactory=Tt}handle(Tt){if("JSONP"===Tt.method)throw new v.wOt(-2800,!1);const En=this.xhrFactory;return(En.\u0275loadImpl?(0,Z.H)(En.\u0275loadImpl()):(0,me.of)(null)).pipe((0,Je.n)(()=>new a.c(Ai=>{const Ri=En.build();if(Ri.open(Tt.method,Tt.urlWithParams),Tt.withCredentials&&(Ri.withCredentials=!0),Tt.headers.forEach((Vr,uo)=>Ri.setRequestHeader(Vr,uo.join(","))),Tt.headers.has("Accept")||Ri.setRequestHeader("Accept","application/json, text/plain, */*"),!Tt.headers.has("Content-Type")){const Vr=Tt.detectContentTypeHeader();null!==Vr&&Ri.setRequestHeader("Content-Type",Vr)}if(Tt.responseType){const Vr=Tt.responseType.toLowerCase();Ri.responseType="json"!==Vr?Vr:"text"}const pi=Tt.serializeBody();let Ti=null;const vr=()=>{if(null!==Ti)return Ti;const Vr=Ri.statusText||"OK",uo=new We(Ri.getAllResponseHeaders()),ko=function Yi(Ie){return"responseURL"in Ie&&Ie.responseURL?Ie.responseURL:/^X-Request-URL:/m.test(Ie.getAllResponseHeaders())?Ie.getResponseHeader("X-Request-URL"):null}(Ri)||Tt.url;return Ti=new Kn({headers:uo,status:Ri.status,statusText:Vr,url:ko}),Ti},Io=()=>{let{headers:Vr,status:uo,statusText:ko,url:Ls}=vr(),Gr=null;204!==uo&&(Gr=typeof Ri.response>"u"?Ri.responseText:Ri.response),0===uo&&(uo=Gr?200:0);let xs=uo>=200&&uo<300;if("json"===Tt.responseType&&"string"==typeof Gr){const Qs=Gr;Gr=Gr.replace(oi,"");try{Gr=""!==Gr?JSON.parse(Gr):null}catch(Ss){Gr=Qs,xs&&(xs=!1,Gr={error:Ss,text:Gr})}}xs?(Ai.next(new Kt({body:Gr,headers:Vr,status:uo,statusText:ko,url:Ls||void 0})),Ai.complete()):Ai.error(new at({error:Gr,headers:Vr,status:uo,statusText:ko,url:Ls||void 0}))},gr=Vr=>{const{url:uo}=vr(),ko=new at({error:Vr,status:Ri.status||0,statusText:Ri.statusText||"Unknown Error",url:uo||void 0});Ai.error(ko)};let Nr=!1;const _o=Vr=>{Nr||(Ai.next(vr()),Nr=!0);let uo={type:cn.DownloadProgress,loaded:Vr.loaded};Vr.lengthComputable&&(uo.total=Vr.total),"text"===Tt.responseType&&Ri.responseText&&(uo.partialText=Ri.responseText),Ai.next(uo)},yo=Vr=>{let uo={type:cn.UploadProgress,loaded:Vr.loaded};Vr.lengthComputable&&(uo.total=Vr.total),Ai.next(uo)};return Ri.addEventListener("load",Io),Ri.addEventListener("error",gr),Ri.addEventListener("timeout",gr),Ri.addEventListener("abort",gr),Tt.reportProgress&&(Ri.addEventListener("progress",_o),null!==pi&&Ri.upload&&Ri.upload.addEventListener("progress",yo)),Ri.send(pi),Ai.next({type:cn.Sent}),()=>{Ri.removeEventListener("error",gr),Ri.removeEventListener("abort",gr),Ri.removeEventListener("load",Io),Ri.removeEventListener("timeout",gr),Tt.reportProgress&&(Ri.removeEventListener("progress",_o),null!==pi&&Ri.upload&&Ri.upload.removeEventListener("progress",yo)),Ri.readyState!==Ri.DONE&&Ri.abort()}})))}static#e=this.\u0275fac=function(En){return new(En||Ie)(v.KVO(re.N0))};static#t=this.\u0275prov=v.jDH({token:Ie,factory:Ie.\u0275fac})}return Ie})();const io=new v.nKC(""),ro=new v.nKC("",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),Po=new v.nKC("",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class go{}let bo=(()=>{class Ie{constructor(Tt,En,si){this.doc=Tt,this.platform=En,this.cookieName=si,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Tt=this.doc.cookie||"";return Tt!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,re._b)(Tt,this.cookieName),this.lastCookieString=Tt),this.lastToken}static#e=this.\u0275fac=function(En){return new(En||Ie)(v.KVO(re.qQ),v.KVO(v.Agw),v.KVO(ro))};static#t=this.\u0275prov=v.jDH({token:Ie,factory:Ie.\u0275fac})}return Ie})();function Bn(Ie,mt){const Tt=Ie.url.toLowerCase();if(!(0,v.WQX)(io)||"GET"===Ie.method||"HEAD"===Ie.method||Tt.startsWith("http://")||Tt.startsWith("https://"))return mt(Ie);const En=(0,v.WQX)(go).getToken(),si=(0,v.WQX)(Po);return null!=En&&!Ie.headers.has(si)&&(Ie=Ie.clone({headers:Ie.headers.set(si,En)})),mt(Ie)}var At=function(Ie){return Ie[Ie.Interceptors=0]="Interceptors",Ie[Ie.LegacyInterceptors=1]="LegacyInterceptors",Ie[Ie.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",Ie[Ie.NoXsrfProtection=3]="NoXsrfProtection",Ie[Ie.JsonpSupport=4]="JsonpSupport",Ie[Ie.RequestsMadeViaParent=5]="RequestsMadeViaParent",Ie[Ie.Fetch=6]="Fetch",Ie}(At||{});function pt(...Ie){const mt=[_n,pr,Nt,{provide:ze,useExisting:Nt},{provide:je,useFactory:()=>(0,v.WQX)(tn,{optional:!0})??(0,v.WQX)(pr)},{provide:pn,useValue:Bn,multi:!0},{provide:io,useValue:!0},{provide:go,useClass:bo}];for(const Tt of Ie)mt.push(...Tt.\u0275providers);return(0,v.EmA)(mt)}const Ze=new v.nKC("");function Ln(){return function an(Ie,mt){return{\u0275kind:Ie,\u0275providers:mt}}(At.LegacyInterceptors,[{provide:Ze,useFactory:Qt},{provide:pn,useExisting:Ze,multi:!0}])}let Ge=(()=>{class Ie{static#e=this.\u0275fac=function(En){return new(En||Ie)};static#t=this.\u0275mod=v.$C({type:Ie});static#n=this.\u0275inj=v.G2t({providers:[pt(Ln())]})}return Ie})()},3953:(vi,Vt,B)=>{"use strict";function g(i,o){return Object.is(i,o)}B.d(Vt,{iLQ:()=>ob,sZ2:()=>Rg,hnV:()=>pS,Hbi:()=>rL,o8S:()=>Md,BIS:()=>tm,gRc:()=>MS,Ql9:()=>AO,Ocv:()=>BO,Z63:()=>Fa,aKT:()=>Cu,uvJ:()=>tl,zcH:()=>ec,bkB:()=>Xc,$GK:()=>qr,nKC:()=>Sr,zZn:()=>Ys,_q3:()=>vC,MKu:()=>xC,xe9:()=>lb,Co$:()=>bT,Vns:()=>qm,SKi:()=>ws,Xx1:()=>ds,Agw:()=>$h,PLl:()=>Z0,sFG:()=>Hv,_9s:()=>mp,czy:()=>Zg,kdw:()=>ts,C4Q:()=>Lm,NYb:()=>CO,giA:()=>hS,RxE:()=>rS,c1b:()=>_,gXe:()=>dl,mal:()=>Dx,L39:()=>zL,EWP:()=>jL,a0P:()=>KL,Ol2:()=>dE,w6W:()=>xA,oH4:()=>CS,SmG:()=>$O,Rfq:()=>Vo,WQX:()=>gi,QuC:()=>yr,EmA:()=>Ml,fpN:()=>iL,HJs:()=>ZL,N4e:()=>Xu,vPA:()=>or,O8t:()=>VL,H3F:()=>oS,zAP:()=>eA,H8p:()=>pu,KH2:()=>Y_,TgB:()=>yc,wOt:()=>Di,WHO:()=>uS,e01:()=>dS,H5H:()=>BE,Zy3:()=>Oo,mq5:()=>wD,JZv:()=>jo,LfX:()=>iu,plB:()=>Cd,jNT:()=>lC,zjR:()=>fS,TL$:()=>em,Tbb:()=>ss,Vt3:()=>fh,GFd:()=>xT,OA$:()=>Pn,Jv_:()=>AM,aNF:()=>PM,R7$:()=>yl,BMQ:()=>CE,AVh:()=>PE,wni:()=>oM,VBU:()=>k,FsC:()=>Xe,jDH:()=>zo,G2t:()=>ya,$C:()=>X,EJ8:()=>Rt,rXU:()=>Qh,nrm:()=>FE,eu8:()=>NE,bVm:()=>qx,qex:()=>Zx,k0s:()=>Kx,j41:()=>Xx,RV6:()=>vD,xGo:()=>kf,KVO:()=>Ar,kS0:()=>Ff,QTQ:()=>qf,bIt:()=>jE,lsd:()=>lM,XpG:()=>KD,nI1:()=>UM,bMT:()=>jM,i5U:()=>VM,SdG:()=>qD,NAR:()=>ZD,Y8G:()=>ME,FS9:()=>$E,lJ4:()=>LM,mGM:()=>aM,sdS:()=>cM,Njj:()=>oo,eBV:()=>Wo,B4B:()=>Xg,n$t:()=>w1,xc7:()=>AE,DNE:()=>fE,EFF:()=>vM,JRh:()=>WE,SpI:()=>eb,Lme:()=>XE,E5c:()=>KE,LHq:()=>ZE,DH7:()=>TM,mxI:()=>YE,R50:()=>qE,GBs:()=>sM});let v=null,me=!1,a=1;const Z=Symbol("SIGNAL");function ie(i){const o=v;return v=i,o}const Je={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function re(i){if(me)throw new Error("");if(null===v)return;v.consumerOnSignalRead(i);const o=v.nextProducerIndex++;$t(v),o<v.producerNode.length&&v.producerNode[o]!==i&&Ue(v)&&Ve(v.producerNode[o],v.producerIndexOfThis[o]),v.producerNode[o]!==i&&(v.producerNode[o]=i,v.producerIndexOfThis[o]=Ue(v)?ot(i,v,o):0),v.producerLastReadVersion[o]=i.version}function je(i){if((!Ue(i)||i.dirty)&&(i.dirty||i.lastCleanEpoch!==a)){if(!i.producerMustRecompute(i)&&!Ye(i))return i.dirty=!1,void(i.lastCleanEpoch=a);i.producerRecomputeValue(i),i.dirty=!1,i.lastCleanEpoch=a}}function We(i){if(void 0===i.liveConsumerNode)return;const o=me;me=!0;try{for(const l of i.liveConsumerNode)l.dirty||ht(l)}finally{me=o}}function Ne(){return!1!==v?.consumerAllowSignalWrites}function ht(i){i.dirty=!0,We(i),i.consumerMarkedDirty?.(i)}function He(i){return i&&(i.nextProducerIndex=0),ie(i)}function be(i,o){if(ie(o),i&&void 0!==i.producerNode&&void 0!==i.producerIndexOfThis&&void 0!==i.producerLastReadVersion){if(Ue(i))for(let l=i.nextProducerIndex;l<i.producerNode.length;l++)Ve(i.producerNode[l],i.producerIndexOfThis[l]);for(;i.producerNode.length>i.nextProducerIndex;)i.producerNode.pop(),i.producerLastReadVersion.pop(),i.producerIndexOfThis.pop()}}function Ye(i){$t(i);for(let o=0;o<i.producerNode.length;o++){const l=i.producerNode[o],h=i.producerLastReadVersion[o];if(h!==l.version||(je(l),h!==l.version))return!0}return!1}function Le(i){if($t(i),Ue(i))for(let o=0;o<i.producerNode.length;o++)Ve(i.producerNode[o],i.producerIndexOfThis[o]);i.producerNode.length=i.producerLastReadVersion.length=i.producerIndexOfThis.length=0,i.liveConsumerNode&&(i.liveConsumerNode.length=i.liveConsumerIndexOfThis.length=0)}function ot(i,o,l){if(nt(i),0===i.liveConsumerNode.length&&xt(i))for(let h=0;h<i.producerNode.length;h++)i.producerIndexOfThis[h]=ot(i.producerNode[h],i,h);return i.liveConsumerIndexOfThis.push(l),i.liveConsumerNode.push(o)-1}function Ve(i,o){if(nt(i),1===i.liveConsumerNode.length&&xt(i))for(let h=0;h<i.producerNode.length;h++)Ve(i.producerNode[h],i.producerIndexOfThis[h]);const l=i.liveConsumerNode.length-1;if(i.liveConsumerNode[o]=i.liveConsumerNode[l],i.liveConsumerIndexOfThis[o]=i.liveConsumerIndexOfThis[l],i.liveConsumerNode.length--,i.liveConsumerIndexOfThis.length--,o<i.liveConsumerNode.length){const h=i.liveConsumerIndexOfThis[o],y=i.liveConsumerNode[o];$t(y),y.producerIndexOfThis[h]=o}}function Ue(i){return i.consumerIsAlwaysLive||(i?.liveConsumerNode?.length??0)>0}function $t(i){i.producerNode??=[],i.producerIndexOfThis??=[],i.producerLastReadVersion??=[]}function nt(i){i.liveConsumerNode??=[],i.liveConsumerIndexOfThis??=[]}function xt(i){return void 0!==i.producerNode}const Mt=Symbol("UNSET"),$e=Symbol("COMPUTING"),Et=Symbol("ERRORED"),cn={...Je,value:Mt,dirty:!0,error:null,equal:g,producerMustRecompute:i=>i.value===Mt||i.value===$e,producerRecomputeValue(i){if(i.value===$e)throw new Error("Detected cycle in computations.");const o=i.value;i.value=$e;const l=He(i);let h;try{h=i.computation()}catch(y){h=Et,i.error=y}finally{be(i,l)}o!==Mt&&o!==Et&&h!==Et&&i.equal(o,h)?i.value=o:(i.value=h,i.version++)}};let Kn=function fn(){throw new Error};function Kt(){Kn()}let ve=null;function _n(i,o){Ne()||Kt(),i.equal(i.value,o)||(i.value=o,function tn(i){i.version++,function ze(){a++}(),We(i),ve?.()}(i))}const it={...Je,equal:g,value:void 0};var ut=B(4412),nn=B(1413),ui=B(8359),pn=B(6354);typeof navigator<"u"&&navigator,typeof navigator<"u"&&!/Opera/.test(navigator.userAgent)&&navigator,typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||navigator),typeof navigator<"u"&&!/Opera|WebKit/.test(navigator.userAgent)&&navigator,typeof navigator<"u"&&navigator;const wo="https://g.co/ng/security#xss";class Di extends Error{constructor(o,l){super(Oo(o,l)),this.code=o}}function Oo(i,o){return`NG0${Math.abs(i)}${o?": "+o:""}`}function Zo(i){return{toString:i}.toString()}const _a="__parameters__";function Ns(i,o,l){return Zo(()=>{const h=function Ka(i){return function(...l){if(i){const h=i(...l);for(const y in h)this[y]=h[y]}}}(o);function y(...C){if(this instanceof y)return h.apply(this,C),this;const A=new y(...C);return O.annotation=A,O;function O(j,ne,_e){const ft=j.hasOwnProperty(_a)?j[_a]:Object.defineProperty(j,_a,{value:[]})[_a];for(;ft.length<=_e;)ft.push(null);return(ft[_e]=ft[_e]||[]).push(A),j}}return l&&(y.prototype=Object.create(l.prototype)),y.prototype.ngMetadataName=i,y.annotationCls=y,y})}const jo=globalThis;function fo(i){for(let o in i)if(i[o]===fo)return o;throw Error("Could not find renamed property on target object.")}function Fu(i,o){for(const l in o)o.hasOwnProperty(l)&&!i.hasOwnProperty(l)&&(i[l]=o[l])}function ss(i){if("string"==typeof i)return i;if(Array.isArray(i))return"["+i.map(ss).join(", ")+"]";if(null==i)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;const o=i.toString();if(null==o)return""+o;const l=o.indexOf("\n");return-1===l?o:o.substring(0,l)}function al(i,o){return null==i||""===i?null===o?"":o:null==o||""===o?i:i+" "+o}const rc=fo({__forward_ref__:fo});function Vo(i){return i.__forward_ref__=Vo,i.toString=function(){return ss(this())},i}function br(i){return oc(i)?i():i}function oc(i){return"function"==typeof i&&i.hasOwnProperty(rc)&&i.__forward_ref__===Vo}function zo(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function ya(i){return{providers:i.providers||[],imports:i.imports||[]}}function va(i){return El(i,aa)||El(i,Mc)}function iu(i){return null!==va(i)}function El(i,o){return i.hasOwnProperty(o)?i[o]:null}function Bu(i){return i&&(i.hasOwnProperty(Cl)||i.hasOwnProperty(Sc))?i[Cl]:null}const aa=fo({\u0275prov:fo}),Cl=fo({\u0275inj:fo}),Mc=fo({ngInjectableDef:fo}),Sc=fo({ngInjectorDef:fo});class Sr{constructor(o,l){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof l?this.__NG_ELEMENT_ID__=l:void 0!==l&&(this.\u0275prov=zo({token:this,providedIn:l.providedIn||"root",factory:l.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Tl(i){return i&&!!i.\u0275providers}const cl=fo({\u0275cmp:fo}),zu=fo({\u0275dir:fo}),Uu=fo({\u0275pipe:fo}),su=fo({\u0275mod:fo}),Ra=fo({\u0275fac:fo}),ul=fo({__NG_ELEMENT_ID__:fo}),la=fo({__NG_ENV_ID__:fo});function wr(i){return"string"==typeof i?i:null==i?"":String(i)}function Vl(i,o){throw new Di(-201,!1)}var qr=function(i){return i[i.Default=0]="Default",i[i.Host=1]="Host",i[i.Self=2]="Self",i[i.SkipSelf=4]="SkipSelf",i[i.Optional=8]="Optional",i}(qr||{});let Br;function xh(){return Br}function zi(i){const o=Br;return Br=i,o}function cc(i,o,l){const h=va(i);return h&&"root"==h.providedIn?void 0===h.value?h.value=h.factory():h.value:l&qr.Optional?null:void 0!==o?o:void Vl()}const $s={},lu="__NG_DI_FLAG__",V="ngTempTokenPath",K=/\n/gm,Ot="__source";let Nn;function Xi(i){const o=Nn;return Nn=i,o}function vo(i,o=qr.Default){if(void 0===Nn)throw new Di(-203,!1);return null===Nn?cc(i,void 0,o):Nn.get(i,o&qr.Optional?null:void 0,o)}function Ar(i,o=qr.Default){return(xh()||vo)(br(i),o)}function gi(i,o=qr.Default){return Ar(i,qo(o))}function qo(i){return typeof i>"u"||"number"==typeof i?i:(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function Eo(i){const o=[];for(let l=0;l<i.length;l++){const h=br(i[l]);if(Array.isArray(h)){if(0===h.length)throw new Di(900,!1);let y,C=qr.Default;for(let A=0;A<h.length;A++){const O=h[A],j=na(O);"number"==typeof j?-1===j?y=O.token:C|=j:y=O}o.push(Ar(y,C))}else o.push(Ar(h))}return o}function Go(i,o){return i[lu]=o,i.prototype[lu]=o,i}function na(i){return i[lu]}const ds=Go(Ns("Optional"),8),ts=Go(Ns("SkipSelf"),4);function Gs(i,o){return i.hasOwnProperty(Ra)?i[Ra]:null}function uc(i,o){i.forEach(l=>Array.isArray(l)?uc(l,o):o(l))}function La(i,o,l){o>=i.length?i.push(l):i.splice(o,0,l)}function Pc(i,o){return o>=i.length-1?i.pop():i.splice(o,1)[0]}function Hs(i,o,l){let h=Dl(i,o);return h>=0?i[1|h]=l:(h=~h,function Qa(i,o,l,h){let y=i.length;if(y==o)i.push(l,h);else if(1===y)i.push(h,i[0]),i[0]=l;else{for(y--,i.push(i[y-1],i[y]);y>o;)i[y]=i[y-2],y--;i[o]=l,i[o+1]=h}}(i,h,o,l)),h}function Qo(i,o){const l=Dl(i,o);if(l>=0)return i[1|l]}function Dl(i,o){return function yf(i,o,l){let h=0,y=i.length>>l;for(;y!==h;){const C=h+(y-h>>1),A=i[C<<l];if(o===A)return C<<l;A>o?y=C:h=C+1}return~(y<<l)}(i,o,1)}const ka={},Ao=[],Fa=new Sr(""),dc=new Sr("",-1),Oc=new Sr("");class Vu{get(o,l=$s){if(l===$s){const h=new Error(`NullInjectorError: No provider for ${ss(o)}!`);throw h.name="NullInjectorError",h}return l}}var Lr=function(i){return i[i.OnPush=0]="OnPush",i[i.Default=1]="Default",i}(Lr||{}),dl=function(i){return i[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",i}(dl||{}),el=function(i){return i[i.None=0]="None",i[i.SignalBased=1]="SignalBased",i[i.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",i}(el||{});function Lc(i,o,l){let h=i.length;for(;;){const y=i.indexOf(o,l);if(-1===y)return y;if(0===y||i.charCodeAt(y-1)<=32){const C=o.length;if(y+C===h||i.charCodeAt(y+C)<=32)return y}l=y+1}}function vf(i,o,l){let h=0;for(;h<l.length;){const y=l[h];if("number"==typeof y){if(0!==y)break;h++;const C=l[h++],A=l[h++],O=l[h++];i.setAttribute(o,A,O,C)}else{const C=y,A=l[++h];$u(C)?i.setProperty(o,C,A):i.setAttribute(o,C,A),h++}}return h}function Ld(i){return 3===i||4===i||6===i}function $u(i){return 64===i.charCodeAt(0)}function Gl(i,o){if(null!==o&&0!==o.length)if(null===i||0===i.length)i=o.slice();else{let l=-1;for(let h=0;h<o.length;h++){const y=o[h];"number"==typeof y?l=y:0===l||Ip(i,l,y,null,-1===l||2===l?o[++h]:null)}}return i}function Ip(i,o,l,h,y){let C=0,A=i.length;if(-1===o)A=-1;else for(;C<i.length;){const O=i[C++];if("number"==typeof O){if(O===o){A=-1;break}if(O>o){A=C-1;break}}}for(;C<i.length;){const O=i[C];if("number"==typeof O)break;if(O===l){if(null===h)return void(null!==y&&(i[C+1]=y));if(h===i[C+1])return void(i[C+2]=y)}C++,null!==h&&C++,null!==y&&C++}-1!==A&&(i.splice(A,0,o),C=A+1),i.splice(C++,0,l),null!==h&&i.splice(C++,0,h),null!==y&&i.splice(C++,0,y)}const cu="ng-template";function hl(i,o,l,h){let y=0;if(h){for(;y<o.length&&"string"==typeof o[y];y+=2)if("class"===o[y]&&-1!==Lc(o[y+1].toLowerCase(),l,0))return!0}else if(kd(i))return!1;if(y=o.indexOf(1,y),y>-1){let C;for(;++y<o.length&&"string"==typeof(C=o[y]);)if(C.toLowerCase()===l)return!0}return!1}function kd(i){return 4===i.type&&i.value!==cu}function wh(i,o,l){return o===(4!==i.type||l?i.value:cu)}function uu(i,o,l){let h=4;const y=i.attrs,C=null!==y?function du(i){for(let o=0;o<i.length;o++)if(Ld(i[o]))return o;return i.length}(y):0;let A=!1;for(let O=0;O<o.length;O++){const j=o[O];if("number"!=typeof j){if(!A)if(4&h){if(h=2|1&h,""!==j&&!wh(i,j,l)||""===j&&1===o.length){if(As(h))return!1;A=!0}}else if(8&h){if(null===y||!hl(i,y,j,l)){if(As(h))return!1;A=!0}}else{const ne=o[++O],_e=Fd(j,y,kd(i),l);if(-1===_e){if(As(h))return!1;A=!0;continue}if(""!==ne){let ft;if(ft=_e>C?"":y[_e+1].toLowerCase(),2&h&&ne!==ft){if(As(h))return!1;A=!0}}}}else{if(!A&&!As(h)&&!As(j))return!1;if(A&&As(j))continue;A=!1,h=j|1&h}}return As(h)||A}function As(i){return!(1&i)}function Fd(i,o,l,h){if(null===o)return-1;let y=0;if(h||!l){let C=!1;for(;y<o.length;){const A=o[y];if(A===i)return y;if(3===A||6===A)C=!0;else{if(1===A||2===A){let O=o[++y];for(;"string"==typeof O;)O=o[++y];continue}if(4===A)break;if(0===A){y+=4;continue}}y+=C?1:2}return-1}return function hu(i,o){let l=i.indexOf(4);if(l>-1)for(l++;l<i.length;){const h=i[l];if("number"==typeof h)return-1;if(h===o)return l;l++}return-1}(o,i)}function Eh(i,o,l=!1){for(let h=0;h<o.length;h++)if(uu(i,o[h],l))return!0;return!1}function Tp(i,o){e:for(let l=0;l<o.length;l++){const h=o[l];if(i.length===h.length){for(let y=0;y<i.length;y++)if(i[y]!==h[y])continue e;return!0}}return!1}function fu(i,o){return i?":not("+o.trim()+")":o}function fl(i){let o=i[0],l=1,h=2,y="",C=!1;for(;l<i.length;){let A=i[l];if("string"==typeof A)if(2&h){const O=i[++l];y+="["+A+(O.length>0?'="'+O+'"':"")+"]"}else 8&h?y+="."+A:4&h&&(y+=" "+A);else""!==y&&!As(A)&&(o+=fu(C,y),y=""),h=A,C=C||!As(h);l++}return""!==y&&(o+=fu(C,y)),o}function k(i){return Zo(()=>{const o=Ho(i),l={...o,decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===Lr.OnPush,directiveDefs:null,pipeDefs:null,dependencies:o.standalone&&i.dependencies||null,getStandaloneInjector:null,signals:i.signals??!1,data:i.data||{},encapsulation:i.encapsulation||dl.Emulated,styles:i.styles||Ao,_:null,schemas:i.schemas||null,tView:null,id:""};pl(l);const h=i.dependencies;return l.directiveDefs=ls(h,!1),l.pipeDefs=ls(h,!0),l.id=function Na(i){let o=0;const l=[i.selectors,i.ngContentSelectors,i.hostVars,i.hostAttrs,i.consts,i.vars,i.decls,i.encapsulation,i.standalone,i.signals,i.exportAs,JSON.stringify(i.inputs),JSON.stringify(i.outputs),Object.getOwnPropertyNames(i.type.prototype),!!i.contentQueries,!!i.viewQuery].join("|");for(const y of l)o=Math.imul(31,o)+y.charCodeAt(0)|0;return o+=2147483648,"c"+o}(l),l})}function W(i){return un(i)||en(i)}function N(i){return null!==i}function X(i){return Zo(()=>({type:i.type,bootstrap:i.bootstrap||Ao,declarations:i.declarations||Ao,imports:i.imports||Ao,exports:i.exports||Ao,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function ce(i,o){if(null==i)return ka;const l={};for(const h in i)if(i.hasOwnProperty(h)){const y=i[h];let C,A,O=el.None;Array.isArray(y)?(O=y[0],C=y[1],A=y[2]??C):(C=y,A=y),o?(l[C]=O!==el.None?[h,O]:h,o[C]=A):l[C]=h}return l}function Xe(i){return Zo(()=>{const o=Ho(i);return pl(o),o})}function Rt(i){return{type:i.type,name:i.name,factory:null,pure:!1!==i.pure,standalone:!0===i.standalone,onDestroy:i.type.prototype.ngOnDestroy||null}}function un(i){return i[cl]||null}function en(i){return i[zu]||null}function wi(i){return i[Uu]||null}function yr(i){const o=un(i)||en(i)||wi(i);return null!==o&&o.standalone}function dr(i,o){const l=i[su]||null;if(!l&&!0===o)throw new Error(`Type ${ss(i)} does not have '\u0275mod' property.`);return l}function Ho(i){const o={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:o,inputTransforms:null,inputConfig:i.inputs||ka,exportAs:i.exportAs||null,standalone:!0===i.standalone,signals:!0===i.signals,selectors:i.selectors||Ao,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:ce(i.inputs,o),outputs:ce(i.outputs),debugInfo:null}}function pl(i){i.features?.forEach(o=>o(i))}function ls(i,o){if(!i)return null;const l=o?wi:W;return()=>("function"==typeof i?i():i).map(h=>l(h)).filter(N)}function Ml(i){return{\u0275providers:i}}function bf(...i){return{\u0275providers:ia(0,i),\u0275fromNgModule:!0}}function ia(i,...o){const l=[],h=new Set;let y;const C=A=>{l.push(A)};return uc(o,A=>{const O=A;Ih(O,C,[],h)&&(y||=[],y.push(O))}),void 0!==y&&Dp(y,C),l}function Dp(i,o){for(let l=0;l<i.length;l++){const{ngModule:h,providers:y}=i[l];kc(y,C=>{o(C,h)})}}function Ih(i,o,l,h){if(!(i=br(i)))return!1;let y=null,C=Bu(i);const A=!C&&un(i);if(C||A){if(A&&!A.standalone)return!1;y=i}else{const j=i.ngModule;if(C=Bu(j),!C)return!1;y=j}const O=h.has(y);if(A){if(O)return!1;if(h.add(y),A.dependencies){const j="function"==typeof A.dependencies?A.dependencies():A.dependencies;for(const ne of j)Ih(ne,o,l,h)}}else{if(!C)return!1;{if(null!=C.imports&&!O){let ne;h.add(y);try{uc(C.imports,_e=>{Ih(_e,o,l,h)&&(ne||=[],ne.push(_e))})}finally{}void 0!==ne&&Dp(ne,o)}if(!O){const ne=Gs(y)||(()=>new y);o({provide:y,useFactory:ne,deps:Ao},y),o({provide:Oc,useValue:y,multi:!0},y),o({provide:Fa,useValue:()=>Ar(y),multi:!0},y)}const j=C.providers;if(null!=j&&!O){const ne=i;kc(j,_e=>{o(_e,ne)})}}}return y!==i&&void 0!==i.providers}function kc(i,o){for(let l of i)Tl(l)&&(l=l.\u0275providers),Array.isArray(l)?kc(l,o):o(l)}const ry=fo({provide:String,useValue:fo});function wf(i){return null!==i&&"object"==typeof i&&ry in i}function Fc(i){return"function"==typeof i}const pu=new Sr(""),ca={},Nc={};let Gu;function Hu(){return void 0===Gu&&(Gu=new Vu),Gu}class tl{}class fc extends tl{get destroyed(){return this._destroyed}constructor(o,l,h,y){super(),this.parent=l,this.source=h,this.scopes=y,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Dh(o,A=>this.processProvider(A)),this.records.set(dc,Bc(void 0,this)),y.has("environment")&&this.records.set(tl,Bc(void 0,this));const C=this.records.get(pu);null!=C&&"string"==typeof C.value&&this.scopes.add(C.value),this.injectorDefTypes=new Set(this.get(Oc,Ao,qr.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;const o=ie(null);try{for(const h of this._ngOnDestroyHooks)h.ngOnDestroy();const l=this._onDestroyHooks;this._onDestroyHooks=[];for(const h of l)h()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),ie(o)}}onDestroy(o){return this.assertNotDestroyed(),this._onDestroyHooks.push(o),()=>this.removeOnDestroy(o)}runInContext(o){this.assertNotDestroyed();const l=Xi(this),h=zi(void 0);try{return o()}finally{Xi(l),zi(h)}}get(o,l=$s,h=qr.Default){if(this.assertNotDestroyed(),o.hasOwnProperty(la))return o[la](this);h=qo(h);const C=Xi(this),A=zi(void 0);try{if(!(h&qr.SkipSelf)){let j=this.records.get(o);if(void 0===j){const ne=function Sp(i){return"function"==typeof i||"object"==typeof i&&i instanceof Sr}(o)&&va(o);j=ne&&this.injectableDefInScope(ne)?Bc(mu(o),ca):null,this.records.set(o,j)}if(null!=j)return this.hydrate(o,j)}return(h&qr.Self?Hu():this.parent).get(o,l=h&qr.Optional&&l===$s?null:l)}catch(O){if("NullInjectorError"===O.name){if((O[V]=O[V]||[]).unshift(ss(o)),C)throw O;return function Is(i,o,l,h){const y=i[V];throw o[Ot]&&y.unshift(o[Ot]),i.message=function Oa(i,o,l,h=null){i=i&&"\n"===i.charAt(0)&&"\u0275"==i.charAt(1)?i.slice(2):i;let y=ss(o);if(Array.isArray(o))y=o.map(ss).join(" -> ");else if("object"==typeof o){let C=[];for(let A in o)if(o.hasOwnProperty(A)){let O=o[A];C.push(A+":"+("string"==typeof O?JSON.stringify(O):ss(O)))}y=`{${C.join(", ")}}`}return`${l}${h?"("+h+")":""}[${y}]: ${i.replace(K,"\n  ")}`}("\n"+i.message,y,l,h),i.ngTokenPath=y,i[V]=null,i}(O,o,"R3InjectorError",this.source)}throw O}finally{zi(A),Xi(C)}}resolveInjectorInitializers(){const o=ie(null),l=Xi(this),h=zi(void 0);try{const C=this.get(Fa,Ao,qr.Self);for(const A of C)A()}finally{Xi(l),zi(h),ie(o)}}toString(){const o=[],l=this.records;for(const h of l.keys())o.push(ss(h));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Di(205,!1)}processProvider(o){let l=Fc(o=br(o))?o:br(o&&o.provide);const h=function Cf(i){return wf(i)?Bc(void 0,i.useValue):Bc(If(i),ca)}(o);if(!Fc(o)&&!0===o.multi){let y=this.records.get(l);y||(y=Bc(void 0,ca,!0),y.factory=()=>Eo(y.multi),this.records.set(l,y)),l=o,y.multi.push(o)}this.records.set(l,h)}hydrate(o,l){const h=ie(null);try{return l.value===ca&&(l.value=Nc,l.value=l.factory()),"object"==typeof l.value&&l.value&&function ng(i){return null!==i&&"object"==typeof i&&"function"==typeof i.ngOnDestroy}(l.value)&&this._ngOnDestroyHooks.add(l.value),l.value}finally{ie(h)}}injectableDefInScope(o){if(!o.providedIn)return!1;const l=br(o.providedIn);return"string"==typeof l?"any"===l||this.scopes.has(l):this.injectorDefTypes.has(l)}removeOnDestroy(o){const l=this._onDestroyHooks.indexOf(o);-1!==l&&this._onDestroyHooks.splice(l,1)}}function mu(i){const o=va(i),l=null!==o?o.factory:Gs(i);if(null!==l)return l;if(i instanceof Sr)throw new Di(204,!1);if(i instanceof Function)return function Mp(i){if(i.length>0)throw new Di(204,!1);const l=function ll(i){return i&&(i[aa]||i[Mc])||null}(i);return null!==l?()=>l.factory(i):()=>new i}(i);throw new Di(204,!1)}function If(i,o,l){let h;if(Fc(i)){const y=br(i);return Gs(y)||mu(y)}if(wf(i))h=()=>br(i.useValue);else if(function Th(i){return!(!i||!i.useFactory)}(i))h=()=>i.useFactory(...Eo(i.deps||[]));else if(function Ef(i){return!(!i||!i.useExisting)}(i))h=()=>Ar(br(i.useExisting));else{const y=br(i&&(i.useClass||i.provide));if(!function Wu(i){return!!i.deps}(i))return Gs(y)||mu(y);h=()=>new y(...Eo(i.deps))}return h}function Bc(i,o,l=!1){return{factory:i,value:o,multi:l?[]:void 0}}function Dh(i,o){for(const l of i)Array.isArray(l)?Dh(l,o):l&&Tl(l)?Dh(l.\u0275providers,o):o(l)}function Xu(i,o){i instanceof fc&&i.assertNotDestroyed();const h=Xi(i),y=zi(void 0);try{return o()}finally{Xi(h),zi(y)}}function Mh(){return void 0!==xh()||null!=function kn(){return Nn}()}const cs=0,Ni=1,Cr=2,hs=3,gl=4,Ws=5,Rs=6,Yu=7,ns=8,gs=9,Wl=10,zr=11,Ud=12,Pp=13,gu=14,fs=15,zc=16,_u=17,Xl=18,Kl=19,Rp=20,Uc=21,Ph=22,nl=23,lr=25,Df=1,ql=7,p=9,r=10;var u=function(i){return i[i.None=0]="None",i[i.HasTransplantedViews=2]="HasTransplantedViews",i}(u||{});function m(i){return Array.isArray(i)&&"object"==typeof i[Df]}function b(i){return Array.isArray(i)&&!0===i[Df]}function w(i){return!!(4&i.flags)}function I(i){return i.componentOffset>-1}function M(i){return!(1&~i.flags)}function R(i){return!!i.template}function L(i){return!!(512&i[Cr])}class Xt{constructor(o,l,h){this.previousValue=o,this.currentValue=l,this.firstChange=h}isFirstChange(){return this.firstChange}}function mn(i,o,l,h){null!==o?o.applyValueToInputSignal(o,h):i[l]=h}function Pn(){return yi}function yi(i){return i.type.prototype.ngOnChanges&&(i.setInput=Mi),bi}function bi(){const i=di(this),o=i?.current;if(o){const l=i.previous;if(l===ka)i.previous=o;else for(let h in o)l[h]=o[h];i.current=null,this.ngOnChanges(o)}}function Mi(i,o,l,h,y){const C=this.declaredInputs[h],A=di(i)||function In(i,o){return i[xi]=o}(i,{previous:ka,current:null}),O=A.current||(A.current={}),j=A.previous,ne=j[C];O[C]=new Xt(ne&&ne.currentValue,l,j===ka),mn(i,o,y,l)}Pn.ngInherit=!0;const xi="__ngSimpleChanges__";function di(i){return i[xi]||null}const Ji=function(i,o,l){};function fr(i){for(;Array.isArray(i);)i=i[cs];return i}function rr(i,o){return fr(o[i])}function Ur(i,o){return fr(o[i.index])}function Pr(i,o){return i.data[o]}function cr(i,o){return i[o]}function Kr(i,o){const l=o[i];return m(l)?l:l[cs]}function xo(i){return!(128&~i[Cr])}function Mn(i,o){return null==o?null:i[o]}function Pi(i){i[_u]=0}function zs(i){1024&i[Cr]||(i[Cr]|=1024,xo(i)&&Us(i))}function Jt(i){return!!(9216&i[Cr]||i[nl]?.dirty)}function ra(i){i[Wl].changeDetectionScheduler?.notify(7),64&i[Cr]&&(i[Cr]|=1024),Jt(i)&&Us(i)}function Us(i){i[Wl].changeDetectionScheduler?.notify(0);let o=Ks(i);for(;null!==o&&!(8192&o[Cr])&&(o[Cr]|=8192,xo(o));)o=Ks(o)}function Ms(i,o){if(!(256&~i[Cr]))throw new Di(911,!1);null===i[Uc]&&(i[Uc]=[]),i[Uc].push(o)}function Ks(i){const o=i[hs];return b(o)?o[hs]:o}const Tr={lFrame:zp(null),bindingsEnabled:!0,skipHydrationRootTNode:null};let jc=!1;function $d(){return Tr.bindingsEnabled}function Sl(){return null!==Tr.skipHydrationRootTNode}function li(){return Tr.lFrame.lView}function lo(){return Tr.lFrame.tView}function Wo(i){return Tr.lFrame.contextLView=i,i[ns]}function oo(i){return Tr.lFrame.contextLView=null,i}function is(){let i=gc();for(;null!==i&&64===i.type;)i=i.parent;return i}function gc(){return Tr.lFrame.currentTNode}function ba(i,o){const l=Tr.lFrame;l.currentTNode=i,l.isParent=o}function Op(){return Tr.lFrame.isParent}function Lp(){Tr.lFrame.isParent=!1}function Fp(){return jc}function og(i){jc=i}function Ba(){const i=Tr.lFrame;let o=i.bindingRootIndex;return-1===o&&(o=i.bindingRootIndex=i.tView.bindingStartIndex),o}function Vc(){return Tr.lFrame.bindingIndex}function wa(){return Tr.lFrame.bindingIndex++}function $c(i){const o=Tr.lFrame,l=o.bindingIndex;return o.bindingIndex=o.bindingIndex+i,l}function ay(i,o){const l=Tr.lFrame;l.bindingIndex=l.bindingRootIndex=i,Np(o)}function Np(i){Tr.lFrame.currentDirectiveIndex=i}function nd(){return Tr.lFrame.currentQueryIndex}function Af(i){Tr.lFrame.currentQueryIndex=i}function Pf(i){const o=i[Ni];return 2===o.type?o.declTNode:1===o.type?i[Ws]:null}function lg(i,o,l){if(l&qr.SkipSelf){let y=o,C=i;for(;!(y=y.parent,null!==y||l&qr.Host||(y=Pf(C),null===y||(C=C[gu],10&y.type))););if(null===y)return!1;o=y,i=C}const h=Tr.lFrame=cg();return h.currentTNode=o,h.lView=i,!0}function Lh(i){const o=cg(),l=i[Ni];Tr.lFrame=o,o.currentTNode=l.firstChild,o.lView=i,o.tView=l,o.contextLView=i,o.bindingIndex=l.bindingStartIndex,o.inI18n=!1}function cg(){const i=Tr.lFrame,o=null===i?null:i.child;return null===o?zp(i):o}function zp(i){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return null!==i&&(i.child=o),o}function ug(){const i=Tr.lFrame;return Tr.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}const dg=ug;function hg(){const i=ug();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function Ea(){return Tr.lFrame.selectedIndex}function Xd(i){Tr.lFrame.selectedIndex=i}function _s(){const i=Tr.lFrame;return Pr(i.tView,i.selectedIndex)}let uy=!0;function Up(){return uy}function yu(i){uy=i}function jp(i,o){for(let l=o.directiveStart,h=o.directiveEnd;l<h;l++){const C=i.data[l].type.prototype,{ngAfterContentInit:A,ngAfterContentChecked:O,ngAfterViewInit:j,ngAfterViewChecked:ne,ngOnDestroy:_e}=C;A&&(i.contentHooks??=[]).push(-l,A),O&&((i.contentHooks??=[]).push(l,O),(i.contentCheckHooks??=[]).push(l,O)),j&&(i.viewHooks??=[]).push(-l,j),ne&&((i.viewHooks??=[]).push(l,ne),(i.viewCheckHooks??=[]).push(l,ne)),null!=_e&&(i.destroyHooks??=[]).push(l,_e)}}function fg(i,o,l){dy(i,o,3,l)}function pg(i,o,l,h){(3&i[Cr])===l&&dy(i,o,l,h)}function kh(i,o){let l=i[Cr];(3&l)===o&&(l&=16383,l+=1,i[Cr]=l)}function dy(i,o,l,h){const C=h??-1,A=o.length-1;let O=0;for(let j=void 0!==h?65535&i[_u]:0;j<A;j++)if("number"==typeof o[j+1]){if(O=o[j],null!=h&&O>=h)break}else o[j]<0&&(i[_u]+=65536),(O<C||-1==C)&&(gg(i,l,o,j),i[_u]=(4294901760&i[_u])+j+2),j++}function mg(i,o){Ji(4,i,o);const l=ie(null);try{o.call(i)}finally{ie(l),Ji(5,i,o)}}function gg(i,o,l,h){const y=l[h]<0,C=l[h+1],O=i[y?-l[h]:l[h]];y?i[Cr]>>14<i[_u]>>16&&(3&i[Cr])===o&&(i[Cr]+=16384,mg(O,C)):mg(O,C)}const Al=-1;class Kd{constructor(o,l,h){this.factory=o,this.resolving=!1,this.canSeeViewProviders=l,this.injectImpl=h}}const fy={};class Fh{constructor(o,l){this.injector=o,this.parentInjector=l}get(o,l,h){h=qo(h);const y=this.injector.get(o,fy,h);return y!==fy||l===fy?y:this.parentInjector.get(o,l,h)}}function Vp(i){return i!==Al}function Nh(i){return 32767&i}function vu(i,o){let l=function $p(i){return i>>16}(i),h=o;for(;l>0;)h=h[gu],l--;return h}let Yl=!0;function Hc(i){const o=Yl;return Yl=i,o}const rd=255,P0=5;let _b=0;const xu={};function Gp(i,o){const l=vg(i,o);if(-1!==l)return l;const h=o[Ni];h.firstCreatePass&&(i.injectorIndex=o.length,Ca(h.data,i),Ca(o,null),Ca(h.blueprint,null));const y=Hp(i,o),C=i.injectorIndex;if(Vp(y)){const A=Nh(y),O=vu(y,o),j=O[Ni].data;for(let ne=0;ne<8;ne++)o[C+ne]=O[A+ne]|j[A+ne]}return o[C+8]=y,C}function Ca(i,o){i.push(0,0,0,0,0,0,0,0,o)}function vg(i,o){return-1===i.injectorIndex||i.parent&&i.parent.injectorIndex===i.injectorIndex||null===o[i.injectorIndex+8]?-1:i.injectorIndex}function Hp(i,o){if(i.parent&&-1!==i.parent.injectorIndex)return i.parent.injectorIndex;let l=0,h=null,y=o;for(;null!==y;){if(h=R0(y),null===h)return Al;if(l++,y=y[gu],-1!==h.injectorIndex)return h.injectorIndex|l<<16}return Al}function py(i,o,l){!function yb(i,o,l){let h;"string"==typeof l?h=l.charCodeAt(0)||0:l.hasOwnProperty(ul)&&(h=l[ul]),null==h&&(h=l[ul]=_b++);const y=h&rd;o.data[i+(y>>P0)]|=1<<y}(i,o,l)}function xg(i,o,l){if(l&qr.Optional||void 0!==i)return i;Vl()}function Jl(i,o,l,h){if(l&qr.Optional&&void 0===h&&(h=null),!(l&(qr.Self|qr.Host))){const y=i[gs],C=zi(void 0);try{return y?y.get(o,h,l&qr.Optional):cc(o,h,l&qr.Optional)}finally{zi(C)}}return xg(h,0,l)}function Ql(i,o,l,h=qr.Default,y){if(null!==i){if(2048&o[Cr]&&!(h&qr.Self)){const A=function vb(i,o,l,h,y){let C=i,A=o;for(;null!==C&&null!==A&&2048&A[Cr]&&!(512&A[Cr]);){const O=Bh(C,A,l,h|qr.Self,xu);if(O!==xu)return O;let j=C.parent;if(!j){const ne=A[Rp];if(ne){const _e=ne.get(l,xu,h);if(_e!==xu)return _e}j=R0(A),A=A[gu]}C=j}return y}(i,o,l,h,xu);if(A!==xu)return A}const C=Bh(i,o,l,h,xu);if(C!==xu)return C}return Jl(o,l,h,y)}function Bh(i,o,l,h,y){const C=function Yr(i){if("string"==typeof i)return i.charCodeAt(0)||0;const o=i.hasOwnProperty(ul)?i[ul]:void 0;return"number"==typeof o?o>=0?o&rd:Os:o}(l);if("function"==typeof C){if(!lg(o,i,h))return h&qr.Host?xg(y,0,h):Jl(o,l,h,y);try{let A;if(A=C(h),null!=A||h&qr.Optional)return A;Vl()}finally{dg()}}else if("number"==typeof C){let A=null,O=vg(i,o),j=Al,ne=h&qr.Host?o[fs][Ws]:null;for((-1===O||h&qr.SkipSelf)&&(j=-1===O?Hp(i,o):o[O+8],j!==Al&&my(h,!1)?(A=o[Ni],O=Nh(j),o=vu(j,o)):O=-1);-1!==O;){const _e=o[Ni];if(ad(C,O,_e.data)){const ft=zh(O,o,l,A,h,ne);if(ft!==xu)return ft}j=o[O+8],j!==Al&&my(h,o[Ni].data[O+8]===ne)&&ad(C,O,o)?(A=_e,O=Nh(j),o=vu(j,o)):O=-1}}return y}function zh(i,o,l,h,y,C){const A=o[Ni],O=A.data[i+8],_e=od(O,A,l,null==h?I(O)&&Yl:h!=A&&!!(3&O.type),y&qr.Host&&C===O);return null!==_e?sd(o,A,_e,O):xu}function od(i,o,l,h,y){const C=i.providerIndexes,A=o.data,O=1048575&C,j=i.directiveStart,_e=C>>20,Wt=y?O+_e:i.directiveEnd;for(let Zt=h?O:O+_e;Zt<Wt;Zt++){const Tn=A[Zt];if(Zt<j&&l===Tn||Zt>=j&&Tn.type===l)return Zt}if(y){const Zt=A[j];if(Zt&&R(Zt)&&Zt.type===l)return j}return null}function sd(i,o,l,h){let y=i[l];const C=o.data;if(function il(i){return i instanceof Kd}(y)){const A=y;A.resolving&&function Pd(i,o){throw o&&o.join(" > "),new Di(-200,i)}(function So(i){return"function"==typeof i?i.name||i.toString():"object"==typeof i&&null!=i&&"function"==typeof i.type?i.type.name||i.type.toString():wr(i)}(C[l]));const O=Hc(A.canSeeViewProviders);A.resolving=!0;const ne=A.injectImpl?zi(A.injectImpl):null;lg(i,h,qr.Default);try{y=i[l]=A.factory(void 0,C,i,h),o.firstCreatePass&&l>=h.directiveStart&&function rs(i,o,l){const{ngOnChanges:h,ngOnInit:y,ngDoCheck:C}=o.type.prototype;if(h){const A=yi(o);(l.preOrderHooks??=[]).push(i,A),(l.preOrderCheckHooks??=[]).push(i,A)}y&&(l.preOrderHooks??=[]).push(0-i,y),C&&((l.preOrderHooks??=[]).push(i,C),(l.preOrderCheckHooks??=[]).push(i,C))}(l,C[l],o)}finally{null!==ne&&zi(ne),Hc(O),A.resolving=!1,dg()}}return y}function ad(i,o,l){return!!(l[o+(i>>P0)]&1<<i)}function my(i,o){return!(i&qr.Self||i&qr.Host&&o)}class oa{constructor(o,l){this._tNode=o,this._lView=l}get(o,l,h){return Ql(this._tNode,this._lView,o,qo(h),l)}}function Os(){return new oa(is(),li())}function kf(i){return Zo(()=>{const o=i.prototype.constructor,l=o[Ra]||gy(o),h=Object.prototype;let y=Object.getPrototypeOf(i.prototype).constructor;for(;y&&y!==h;){const C=y[Ra]||gy(y);if(C&&C!==l)return C;y=Object.getPrototypeOf(y)}return C=>new C})}function gy(i){return oc(i)?()=>{const o=gy(br(i));return o&&o()}:Gs(i)}function R0(i){const o=i[Ni],l=o.type;return 2===l?o.declTNode:1===l?i[Ws]:null}function Ff(i){return function Of(i,o){if("class"===o)return i.classes;if("style"===o)return i.styles;const l=i.attrs;if(l){const h=l.length;let y=0;for(;y<h;){const C=l[y];if(Ld(C))break;if(0===C)y+=2;else if("number"==typeof C)for(y++;y<h&&"string"==typeof l[y];)y++;else{if(C===o)return l[y+1];y+=2}}}return null}(is(),i)}function bg(i,o=null,l=null,h){const y=F0(i,o,l,h);return y.resolveInjectorInitializers(),y}function F0(i,o=null,l=null,h,y=new Set){const C=[l||Ao,bf(i)];return h=h||("object"==typeof i?void 0:ss(i)),new fc(C,o||Hu(),h||null,y)}class Ys{static#e=this.THROW_IF_NOT_FOUND=$s;static#t=this.NULL=new Vu;static create(o,l){if(Array.isArray(o))return bg({name:""},l,o,"");{const h=o.name??"";return bg({name:h},o.parent,o.providers,h)}}static#n=this.\u0275prov=zo({token:Ys,providedIn:"any",factory:()=>Ar(dc)});static#i=this.__NG_ELEMENT_ID__=-1}new Sr("").__NG_ELEMENT_ID__=i=>{const o=is();if(null===o)throw new Di(204,!1);if(2&o.type)return o.value;if(i&qr.Optional)return null;throw new Di(204,!1)};function Nf(i){return i.ngOriginalError}class ec{constructor(){this._console=console}handleError(o){const l=this._findOriginalError(o);this._console.error("ERROR",o),l&&this._console.error("ORIGINAL ERROR",l)}_findOriginalError(o){let l=o&&Nf(o);for(;l&&Nf(l);)l=Nf(l);return l||null}}const wg=new Sr("",{providedIn:"root",factory:()=>gi(ec).handleError.bind(void 0)});let Xp=(()=>{class i{static#e=this.__NG_ELEMENT_ID__=Eb;static#t=this.__NG_ENV_ID__=l=>l}return i})();class N0 extends Xp{constructor(o){super(),this._lView=o}onDestroy(o){return Ms(this._lView,o),()=>function Xs(i,o){if(null===i[Uc])return;const l=i[Uc].indexOf(o);-1!==l&&i[Uc].splice(l,1)}(this._lView,o)}}function Eb(){return new N0(li())}function z0(){return Bf(is(),li())}function Bf(i,o){return new Cu(Ur(i,o))}let Cu=(()=>{class i{constructor(l){this.nativeElement=l}static#e=this.__NG_ELEMENT_ID__=z0}return i})();function Cg(i){return i instanceof Cu?i.nativeElement:i}let yc=(()=>{class i{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new ut.t(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const l=this.taskId++;return this.pendingTasks.add(l),l}remove(l){this.pendingTasks.delete(l),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static#e=this.\u0275prov=zo({token:i,providedIn:"root",factory:()=>new i})}return i})();const Xc=class U0 extends nn.B{constructor(o=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=o,Mh()&&(this.destroyRef=gi(Xp,{optional:!0})??void 0,this.pendingTasks=gi(yc,{optional:!0})??void 0)}emit(o){const l=ie(null);try{super.next(o)}finally{ie(l)}}subscribe(o,l,h){let y=o,C=l||(()=>null),A=h;if(o&&"object"==typeof o){const j=o;y=j.next?.bind(j),C=j.error?.bind(j),A=j.complete?.bind(j)}this.__isAsync&&(C=this.wrapInTimeout(C),y&&(y=this.wrapInTimeout(y)),A&&(A=this.wrapInTimeout(A)));const O=super.subscribe({next:y,error:C,complete:A});return o instanceof ui.yU&&o.add(O),O}wrapInTimeout(o){return l=>{const h=this.pendingTasks?.add();setTimeout(()=>{o(l),void 0!==h&&this.pendingTasks?.remove(h)})}}};function Tb(){return this._results[Symbol.iterator]()}class xy{static#e=Symbol.iterator;get changes(){return this._changes??=new Xc}constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;const l=xy.prototype;l[Symbol.iterator]||(l[Symbol.iterator]=Tb)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,l){return this._results.reduce(o,l)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,l){this.dirty=!1;const h=function Lo(i){return i.flat(Number.POSITIVE_INFINITY)}(o);(this._changesDetected=!function Ja(i,o,l){if(i.length!==o.length)return!1;for(let h=0;h<i.length;h++){let y=i[h],C=o[h];if(l&&(y=l(y),C=l(C)),C!==y)return!1}return!0}(this._results,h,l))&&(this._results=h,this.length=h.length,this.last=h[this.length-1],this.first=h[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(o){this._onDirty=o}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}}function Kp(i){return!(128&~i.flags)}const qp=new Map;let es=0;const Uf="__ngContext__";function za(i,o){m(o)?(i[Uf]=o[Kl],function Ig(i){qp.set(i[Kl],i)}(o)):i[Uf]=o}function My(i){return Sy(i[Ud])}function Ag(i){return Sy(i[gl])}function Sy(i){for(;null!==i&&!b(i);)i=i[gl];return i}let ky;function em(i){ky=i}const Rg=new Sr("",{providedIn:"root",factory:()=>Rb}),Rb="ng",Z0=new Sr(""),$h=new Sr("",{providedIn:"platform",factory:()=>"unknown"}),tm=new Sr("",{providedIn:"root",factory:()=>function Jd(){if(void 0!==ky)return ky;if(typeof document<"u")return document;throw new Di(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let q0=()=>null;function Hf(i,o,l=!1){return q0(i,o,l)}const e1=new Sr("",{providedIn:"root",factory:()=>!1});let cm;function r1(i){return function um(){if(void 0===cm&&(cm=null,jo.trustedTypes))try{cm=jo.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return cm}()?.createScriptURL(i)||i}class Ky{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${wo})`}}function fd(i){return i instanceof Ky?i.changingThisBreaksApplicationSecurity:i}function Wf(i,o){const l=function u1(i){return i instanceof Ky&&i.getTypeName()||null}(i);if(null!=l&&l!==o){if("ResourceURL"===l&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${l} (see ${wo})`)}return l===o}const Gb=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Kf=function(i){return i[i.NONE=0]="NONE",i[i.HTML=1]="HTML",i[i.STYLE=2]="STYLE",i[i.SCRIPT=3]="SCRIPT",i[i.URL=4]="URL",i[i.RESOURCE_URL=5]="RESOURCE_URL",i}(Kf||{});function Xg(i){const o=pm();return o?o.sanitize(Kf.URL,i)||"":Wf(i,"URL")?fd(i):function Zy(i){return(i=String(i)).match(Gb)?i:"unsafe:"+i}(wr(i))}function b1(i){const o=pm();if(o)return r1(o.sanitize(Kf.RESOURCE_URL,i)||"");if(Wf(i,"ResourceURL"))return r1(fd(i));throw new Di(904,!1)}function w1(i,o,l){return function Qb(i,o){return"src"===o&&("embed"===i||"frame"===i||"iframe"===i||"media"===i||"script"===i)||"href"===o&&("base"===i||"link"===i)?b1:Xg}(o,l)(i)}function pm(){const i=li();return i&&i[Wl].sanitizer}const tv=/^>|^->|<!--|-->|--!>|<!-$/g,E1=/(<|>)/g,ew="\u200b$1\u200b";function Ma(i){return i instanceof Function?i():i}var Zg=function(i){return i[i.Important=1]="Important",i[i.DashCase=2]="DashCase",i}(Zg||{});let Zf;function eh(i,o){return Zf(i,o)}function Kc(i,o,l,h,y){if(null!=h){let C,A=!1;b(h)?C=h:m(h)&&(A=!0,h=h[cs]);const O=fr(h);0===i&&null!==l?null==y?k1(o,l,O):Yh(o,l,O,y||null,!0):1===i&&null!==l?Yh(o,l,O,y||null,!0):2===i?function Em(i,o,l){const h=gd(i,o);h&&function tc(i,o,l,h){i.removeChild(o,l,h)}(i,h,o,l)}(o,O,A):3===i&&o.destroyNode(O),null!=C&&function z1(i,o,l,h,y){const C=l[ql];C!==fr(l)&&Kc(o,i,h,C,y);for(let O=r;O<l.length;O++){const j=l[O];Cm(j[Ni],j,i,o,h,C)}}(o,i,C,l,y)}}function dv(i,o){return i.createComment(function C1(i){return i.replace(tv,o=>o.replace(E1,ew))}(o))}function _m(i,o,l){return i.createElement(o,l)}function sa(i,o){o[Wl].changeDetectionScheduler?.notify(8),Cm(i,o,o[zr],2,null,null)}function ym(i,o){const l=i[p],h=o[hs];(m(h)||o[fs]!==h[hs][fs])&&(i[Cr]|=u.HasTransplantedViews),null===l?i[p]=[o]:l.push(o)}function th(i,o){const l=i[p],h=l.indexOf(o);l.splice(h,1)}function vm(i,o){if(i.length<=r)return;const l=r+o,h=i[l];if(h){const y=h[zc];null!==y&&y!==i&&th(y,h),o>0&&(i[l-1][gl]=h[gl]);const C=Pc(i,r+o);!function O1(i,o){sa(i,o),o[cs]=null,o[Ws]=null}(h[Ni],h);const A=C[Xl];null!==A&&A.detachView(C[Ni]),h[hs]=null,h[gl]=null,h[Cr]&=-129}return h}function qg(i,o){if(!(256&o[Cr])){const l=o[zr];l.destroyNode&&Cm(i,o,l,3,null,null),function Zc(i){let o=i[Ud];if(!o)return qh(i[Ni],i);for(;o;){let l=null;if(m(o))l=o[Ud];else{const h=o[r];h&&(l=h)}if(!l){for(;o&&!o[gl]&&o!==i;)m(o)&&qh(o[Ni],o),o=o[hs];null===o&&(o=i),m(o)&&qh(o[Ni],o),l=o&&o[gl]}o=l}}(o)}}function qh(i,o){if(256&o[Cr])return;const l=ie(null);try{o[Cr]&=-129,o[Cr]|=256,o[nl]&&Le(o[nl]),function fw(i,o){let l;if(null!=i&&null!=(l=i.destroyHooks))for(let h=0;h<l.length;h+=2){const y=o[l[h]];if(!(y instanceof Kd)){const C=l[h+1];if(Array.isArray(C))for(let A=0;A<C.length;A+=2){const O=y[C[A]],j=C[A+1];Ji(4,O,j);try{j.call(O)}finally{Ji(5,O,j)}}else{Ji(4,y,C);try{C.call(y)}finally{Ji(5,y,C)}}}}}(i,o),function hw(i,o){const l=i.cleanup,h=o[Yu];if(null!==l)for(let C=0;C<l.length-1;C+=2)if("string"==typeof l[C]){const A=l[C+3];A>=0?h[A]():h[-A].unsubscribe(),C+=2}else l[C].call(h[l[C+1]]);null!==h&&(o[Yu]=null);const y=o[Uc];if(null!==y){o[Uc]=null;for(let C=0;C<y.length;C++)(0,y[C])()}}(i,o),1===o[Ni].type&&o[zr].destroy();const h=o[zc];if(null!==h&&b(o[hs])){h!==o[hs]&&th(h,o);const y=o[Xl];null!==y&&y.detachView(i)}!function Yp(i){qp.delete(i[Kl])}(o)}finally{ie(l)}}function xm(i,o,l){return function L1(i,o,l){let h=o;for(;null!==h&&168&h.type;)h=(o=h).parent;if(null===h)return l[cs];{const{componentOffset:y}=h;if(y>-1){const{encapsulation:C}=i.data[h.directiveStart+y];if(C===dl.None||C===dl.Emulated)return null}return Ur(h,l)}}(i,o.parent,l)}function Yh(i,o,l,h,y){i.insertBefore(o,l,h,y)}function k1(i,o,l){i.appendChild(o,l)}function fv(i,o,l,h,y){null!==h?Yh(i,o,l,h,y):k1(i,o,l)}function gd(i,o){return i.parentNode(o)}function bm(i,o,l){return mv(i,o,l)}let Jg,mv=function F1(i,o,l){return 40&i.type?Ur(i,l):null};function wm(i,o,l,h){const y=xm(i,h,o),C=o[zr],O=bm(h.parent||o[Ws],h,o);if(null!=y)if(Array.isArray(l))for(let j=0;j<l.length;j++)fv(C,y,l[j],O,!1);else fv(C,y,l,O,!1);void 0!==Jg&&Jg(C,h,o,l,y)}function Jh(i,o){if(null!==o){const l=o.type;if(3&l)return Ur(o,i);if(4&l)return e_(-1,i[o.index]);if(8&l){const h=o.child;if(null!==h)return Jh(i,h);{const y=i[o.index];return b(y)?e_(-1,y):fr(y)}}if(32&l)return eh(o,i)()||fr(i[o.index]);{const h=Qg(i,o);return null!==h?Array.isArray(h)?h[0]:Jh(Ks(i[fs]),h):Jh(i,o.next)}}return null}function Qg(i,o){return null!==o?i[fs][Ws].projection[o.projection]:null}function e_(i,o){const l=r+i+1;if(l<o.length){const h=o[l],y=h[Ni].firstChild;if(null!==y)return Jh(h,y)}return o[ql]}function qc(i,o,l,h,y,C,A){for(;null!=l;){if(128===l.type){l=l.next;continue}const O=h[l.index],j=l.type;if(A&&0===o&&(O&&za(fr(O),h),l.flags|=2),32&~l.flags)if(8&j)qc(i,o,l.child,h,y,C,!1),Kc(o,i,y,O,C);else if(32&j){const ne=eh(l,h);let _e;for(;_e=ne();)Kc(o,i,y,_e,C);Kc(o,i,y,O,C)}else 16&j?_v(i,o,h,l,y,C):Kc(o,i,y,O,C);l=A?l.projectionNext:l.next}}function Cm(i,o,l,h,y,C){qc(l,h,i.firstChild,o,y,C,!1)}function _v(i,o,l,h,y,C){const A=l[fs],j=A[Ws].projection[h.projection];if(Array.isArray(j))for(let ne=0;ne<j.length;ne++)Kc(o,i,y,j[ne],C);else{let ne=j;const _e=A[hs];Kp(h)&&(ne.flags|=128),qc(i,o,ne,_e,y,C,!0)}}function yv(i,o,l){""===l?i.removeAttribute(o,"class"):i.setAttribute(o,"class",l)}function vv(i,o,l){const{mergedAttrs:h,classes:y,styles:C}=l;null!==h&&vf(i,o,h),null!==y&&yv(i,o,y),null!==C&&function mw(i,o,l){i.setAttribute(o,"style",l)}(i,o,C)}const Jr={};function yl(i=1){t_(lo(),li(),Ea()+i,!1)}function t_(i,o,l,h){if(!h)if(3&~o[Cr]){const C=i.preOrderHooks;null!==C&&pg(o,C,0,l)}else{const C=i.preOrderCheckHooks;null!==C&&fg(o,C,l)}Xd(l)}function Qh(i,o=qr.Default){const l=li();return null===l?Ar(i,o):Ql(is(),l,br(i),o)}function qf(){throw new Error("invalid")}function xv(i,o,l,h,y,C){const A=ie(null);try{let O=null;y&el.SignalBased&&(O=o[h][Z]),null!==O&&void 0!==O.transformFn&&(C=O.transformFn(C)),y&el.HasDecoratorInputTransform&&(C=i.inputTransforms[h].call(o,C)),null!==i.setInput?i.setInput(o,O,C,l,h):mn(o,O,h,C)}finally{ie(A)}}function Ll(i,o,l,h,y,C,A,O,j,ne,_e){const ft=o.blueprint.slice();return ft[cs]=y,ft[Cr]=204|h,(null!==ne||i&&2048&i[Cr])&&(ft[Cr]|=2048),Pi(ft),ft[hs]=ft[gu]=i,ft[ns]=l,ft[Wl]=A||i&&i[Wl],ft[zr]=O||i&&i[zr],ft[gs]=j||i&&i[gs]||null,ft[Ws]=C,ft[Kl]=function Db(){return es++}(),ft[Rs]=_e,ft[Rp]=ne,ft[fs]=2==o.type?i[fs]:ft,ft}function _d(i,o,l,h,y){let C=i.data[o];if(null===C)C=function nh(i,o,l,h,y){const C=gc(),A=Op(),j=i.data[o]=function vw(i,o,l,h,y,C){let A=o?o.injectorIndex:-1,O=0;return Sl()&&(O|=128),{type:l,index:h,insertBeforeIndex:null,injectorIndex:A,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:O,providerIndexes:0,value:y,attrs:C,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,A?C:C&&C.parent,l,o,h,y);return null===i.firstChild&&(i.firstChild=j),null!==C&&(A?null==C.child&&null!==j.parent&&(C.child=j):null===C.next&&(C.next=j,j.prev=C)),j}(i,o,l,h,y),function sg(){return Tr.lFrame.inI18n}()&&(C.flags|=32);else if(64&C.type){C.type=l,C.value=h,C.attrs=y;const A=function Hd(){const i=Tr.lFrame,o=i.currentTNode;return i.isParent?o:o.parent}();C.injectorIndex=null===A?-1:A.injectorIndex}return ba(C,!0),C}function xc(i,o,l,h){if(0===l)return-1;const y=o.length;for(let C=0;C<l;C++)o.push(h),i.blueprint.push(h),i.data.push(null);return y}function bv(i,o,l,h,y){const C=Ea(),A=2&h;try{Xd(-1),A&&o.length>lr&&t_(i,o,lr,!1),Ji(A?2:0,y),l(h,y)}finally{Xd(C),Ji(A?3:1,y)}}function Yf(i,o,l){if(w(o)){const h=ie(null);try{const C=o.directiveEnd;for(let A=o.directiveStart;A<C;A++){const O=i.data[A];O.contentQueries&&O.contentQueries(1,l[A],A)}}finally{ie(h)}}}function n_(i,o,l){$d()&&(function Ew(i,o,l,h){const y=l.directiveStart,C=l.directiveEnd;I(l)&&function o_(i,o,l){const h=Ur(o,i),y=Im(l);let A=16;l.signals?A=4096:l.onPush&&(A=64);const O=Mm(i,Ll(i,y,null,A,h,o,null,i[Wl].rendererFactory.createRenderer(h,l),null,null,null));i[o.index]=O}(o,l,i.data[y+l.componentOffset]),i.firstCreatePass||Gp(l,o),za(h,o);const A=l.initialInputs;for(let O=y;O<C;O++){const j=i.data[O],ne=sd(o,i,O,l);za(ne,o),null!==A&&G1(0,O-y,ne,j,0,A),R(j)&&(Kr(l.index,o)[ns]=sd(o,i,O,l))}}(i,o,l,Ur(l,o)),!(64&~l.flags)&&tp(i,o,l))}function Jf(i,o,l=Ur){const h=o.localNames;if(null!==h){let y=o.index+1;for(let C=0;C<h.length;C+=2){const A=h[C+1],O=-1===A?l(o,i):i[A];i[y++]=O}}}function Im(i){const o=i.tView;return null===o||o.incompleteFirstPass?i.tView=wv(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts,i.id):o}function wv(i,o,l,h,y,C,A,O,j,ne,_e){const ft=lr+h,Wt=ft+y,Zt=function gw(i,o){const l=[];for(let h=0;h<o;h++)l.push(h<i?null:Jr);return l}(ft,Wt),Tn="function"==typeof ne?ne():ne;return Zt[Ni]={type:i,blueprint:Zt,template:l,queries:null,viewQuery:O,declTNode:o,data:Zt.slice().fill(null,ft),bindingStartIndex:ft,expandoStartIndex:Wt,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof C?C():C,pipeRegistry:"function"==typeof A?A():A,firstChild:null,schemas:j,consts:Tn,incompleteFirstPass:!1,ssrId:_e}}let i_=()=>null;function ep(i,o,l,h,y){for(let C in o){if(!o.hasOwnProperty(C))continue;const A=o[C];if(void 0===A)continue;h??={};let O,j=el.None;Array.isArray(A)?(O=A[0],j=A[1]):O=A;let ne=C;if(null!==y){if(!y.hasOwnProperty(C))continue;ne=y[C]}0===i?yd(h,l,ne,O,j):yd(h,l,ne,O)}return h}function yd(i,o,l,h,y){let C;i.hasOwnProperty(l)?(C=i[l]).push(o,h):C=i[l]=[o,h],void 0!==y&&C.push(y)}function Ua(i,o,l,h,y,C,A,O){const j=Ur(o,l);let _e,ne=o.inputs;!O&&null!=ne&&(_e=ne[h])?(nf(i,l,_e,h,y),I(o)&&function Cv(i,o){const l=Kr(o,i);16&l[Cr]||(l[Cr]|=64)}(l,o.index)):3&o.type&&(h=function $1(i){return"class"===i?"className":"for"===i?"htmlFor":"formaction"===i?"formAction":"innerHtml"===i?"innerHTML":"readonly"===i?"readOnly":"tabindex"===i?"tabIndex":i}(h),y=null!=A?A(y,o.value||"",h):y,C.setProperty(j,h,y))}function vd(i,o,l,h){if($d()){const y=null===h?null:{"":-1},C=function Dm(i,o){const l=i.directiveRegistry;let h=null,y=null;if(l)for(let C=0;C<l.length;C++){const A=l[C];if(Eh(o,A.selectors,!1))if(h||(h=[]),R(A))if(null!==A.findHostDirectiveDefs){const O=[];y=y||new Map,A.findHostDirectiveDefs(A,O,y),h.unshift(...O,A),ef(i,o,O.length)}else h.unshift(A),ef(i,o,0);else y=y||new Map,A.findHostDirectiveDefs?.(A,h,y),h.push(A)}return null===h?null:[h,y]}(i,l);let A,O;null===C?A=O=null:[A,O]=C,null!==A&&Iv(i,o,l,A,y,O),y&&function r_(i,o,l){if(o){const h=i.localNames=[];for(let y=0;y<o.length;y+=2){const C=l[o[y+1]];if(null==C)throw new Di(-301,!1);h.push(o[y],C)}}}(l,h,y)}l.mergedAttrs=Gl(l.mergedAttrs,l.attrs)}function Iv(i,o,l,h,y,C){for(let ne=0;ne<h.length;ne++)py(Gp(l,o),i,h[ne].type);!function Iw(i,o,l){i.flags|=1,i.directiveStart=o,i.directiveEnd=o+l,i.providerIndexes=o}(l,i.data.length,h.length);for(let ne=0;ne<h.length;ne++){const _e=h[ne];_e.providersResolver&&_e.providersResolver(_e)}let A=!1,O=!1,j=xc(i,o,h.length,null);for(let ne=0;ne<h.length;ne++){const _e=h[ne];l.mergedAttrs=Gl(l.mergedAttrs,_e.hostAttrs),np(i,l,o,j,_e),Cw(j,_e,y),null!==_e.contentQueries&&(l.flags|=4),(null!==_e.hostBindings||null!==_e.hostAttrs||0!==_e.hostVars)&&(l.flags|=64);const ft=_e.type.prototype;!A&&(ft.ngOnChanges||ft.ngOnInit||ft.ngDoCheck)&&((i.preOrderHooks??=[]).push(l.index),A=!0),!O&&(ft.ngOnChanges||ft.ngDoCheck)&&((i.preOrderCheckHooks??=[]).push(l.index),O=!0),j++}!function V1(i,o,l){const y=o.directiveEnd,C=i.data,A=o.attrs,O=[];let j=null,ne=null;for(let _e=o.directiveStart;_e<y;_e++){const ft=C[_e],Wt=l?l.get(ft):null,Tn=Wt?Wt.outputs:null;j=ep(0,ft.inputs,_e,j,Wt?Wt.inputs:null),ne=ep(1,ft.outputs,_e,ne,Tn);const fi=null===j||null===A||kd(o)?null:Tw(j,_e,A);O.push(fi)}null!==j&&(j.hasOwnProperty("class")&&(o.flags|=8),j.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=O,o.inputs=j,o.outputs=ne}(i,l,C)}function tp(i,o,l){const h=l.directiveStart,y=l.directiveEnd,C=l.index,A=function Zs(){return Tr.lFrame.currentDirectiveIndex}();try{Xd(C);for(let O=h;O<y;O++){const j=i.data[O],ne=o[O];Np(O),(null!==j.hostBindings||0!==j.hostVars||null!==j.hostAttrs)&&Tm(j,ne)}}finally{Xd(-1),Np(A)}}function Tm(i,o){null!==i.hostBindings&&i.hostBindings(1,o)}function ef(i,o,l){o.componentOffset=l,(i.components??=[]).push(o.index)}function Cw(i,o,l){if(l){if(o.exportAs)for(let h=0;h<o.exportAs.length;h++)l[o.exportAs[h]]=i;R(o)&&(l[""]=i)}}function np(i,o,l,h,y){i.data[h]=y;const C=y.factory||(y.factory=Gs(y.type)),A=new Kd(C,R(y),Qh);i.blueprint[h]=A,l[h]=A,function ww(i,o,l,h,y){const C=y.hostBindings;if(C){let A=i.hostBindingOpCodes;null===A&&(A=i.hostBindingOpCodes=[]);const O=~o.index;(function ih(i){let o=i.length;for(;o>0;){const l=i[--o];if("number"==typeof l&&l<0)return l}return 0})(A)!=O&&A.push(O),A.push(l,h,C)}}(i,o,h,xc(i,l,y.hostVars,Jr),y)}function Tu(i,o,l,h,y,C){const A=Ur(i,o);!function s_(i,o,l,h,y,C,A){if(null==C)i.removeAttribute(o,y,l);else{const O=null==A?wr(C):A(C,h||"",y);i.setAttribute(o,y,O,l)}}(o[zr],A,C,i.value,l,h,y)}function G1(i,o,l,h,y,C){const A=C[o];if(null!==A)for(let O=0;O<A.length;)xv(h,l,A[O++],A[O++],A[O++],A[O++])}function Tw(i,o,l){let h=null,y=0;for(;y<l.length;){const C=l[y];if(0!==C)if(5!==C){if("number"==typeof C)break;if(i.hasOwnProperty(C)){null===h&&(h=[]);const A=i[C];for(let O=0;O<A.length;O+=3)if(A[O]===o){h.push(C,A[O+1],A[O+2],l[y+1]);break}}y+=2}else y+=2;else y+=4}return h}function Tv(i,o,l,h){return[i,!0,0,o,null,h,null,l,null,null]}function H1(i,o){const l=i.contentQueries;if(null!==l){const h=ie(null);try{for(let y=0;y<l.length;y+=2){const A=l[y+1];if(-1!==A){const O=i.data[A];Af(l[y]),O.contentQueries(2,o[A],A)}}}finally{ie(h)}}}function Mm(i,o){return i[Ud]?i[Pp][gl]=o:i[Ud]=o,i[Pp]=o,o}function Dv(i,o,l){Af(0);const h=ie(null);try{o(i,l)}finally{ie(h)}}function W1(i){return i[Yu]??=[]}function tf(i){return i.cleanup??=[]}function ip(i,o){const l=i[gs],h=l?l.get(ec,null):null;h&&h.handleError(o)}function nf(i,o,l,h,y){for(let C=0;C<l.length;){const A=l[C++],O=l[C++],j=l[C++];xv(i.data[A],o[A],h,O,j,y)}}function js(i,o,l){const h=rr(o,i);!function uv(i,o,l){i.setValue(o,l)}(i[zr],h,l)}function Mv(i,o){const l=Kr(o,i),h=l[Ni];!function Sv(i,o){for(let l=o.length;l<i.blueprint.length;l++)o.push(i.blueprint[l])}(h,l);const y=l[cs];null!==y&&null===l[Rs]&&(l[Rs]=Hf(y,l[gs])),nc(h,l,l[ns])}function nc(i,o,l){Lh(o);try{const h=i.viewQuery;null!==h&&Dv(1,h,l);const y=i.template;null!==y&&bv(i,o,y,1,l),i.firstCreatePass&&(i.firstCreatePass=!1),o[Xl]?.finishViewCreation(i),i.staticContentQueries&&H1(i,o),i.staticViewQueries&&Dv(2,i.viewQuery,l);const C=i.components;null!==C&&function Mw(i,o){for(let l=0;l<o.length;l++)Mv(i,o[l])}(o,C)}catch(h){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),h}finally{o[Cr]&=-5,hg()}}function rp(i,o,l,h){const y=ie(null);try{const C=o.tView,j=Ll(i,C,l,4096&i[Cr]?4096:16,null,o,null,null,h?.injector??null,h?.embeddedViewInjector??null,h?.dehydratedView??null);j[zc]=i[o.index];const _e=i[Xl];return null!==_e&&(j[Xl]=_e.createEmbeddedView(C)),nc(C,j,l),j}finally{ie(y)}}function Du(i,o){return!o||null===o.firstChild||Kp(i)}function xd(i,o,l,h=!0){const y=o[Ni];if(function hv(i,o,l,h){const y=r+h,C=l.length;h>0&&(l[y-1][gl]=o),h<C-r?(o[gl]=l[y],La(l,r+h,o)):(l.push(o),o[gl]=null),o[hs]=l;const A=o[zc];null!==A&&l!==A&&ym(A,o);const O=o[Xl];null!==O&&O.insertView(i),ra(o),o[Cr]|=128}(y,o,i,l),h){const A=e_(l,i),O=o[zr],j=gd(O,i[ql]);null!==j&&function dw(i,o,l,h,y,C){h[cs]=y,h[Ws]=o,Cm(i,h,l,1,y,C)}(y,i[Ws],O,o,j,A)}const C=o[Rs];null!==C&&null!==C.firstChild&&(C.firstChild=null)}function Am(i,o,l,h,y=!1){for(;null!==l;){if(128===l.type){l=y?l.projectionNext:l.next;continue}const C=o[l.index];null!==C&&h.push(fr(C)),b(C)&&l_(C,h);const A=l.type;if(8&A)Am(i,o,l.child,h);else if(32&A){const O=eh(l,o);let j;for(;j=O();)h.push(j)}else if(16&A){const O=Qg(o,l);if(Array.isArray(O))h.push(...O);else{const j=Ks(o[fs]);Am(j[Ni],j,O,h,!0)}}l=y?l.projectionNext:l.next}return h}function l_(i,o){for(let l=r;l<i.length;l++){const h=i[l],y=h[Ni].firstChild;null!==y&&Am(h[Ni],h,y,o)}i[ql]!==i[cs]&&o.push(i[ql])}let c_=[];const wc={...Je,consumerIsAlwaysLive:!0,consumerMarkedDirty:i=>{Us(i.lView)},consumerOnSignalRead(){this.lView[nl]=this}},rh={...Je,consumerIsAlwaysLive:!0,consumerMarkedDirty:i=>{let o=Ks(i.lView);for(;o&&!Yc(o[Ni]);)o=Ks(o);o&&zs(o)},consumerOnSignalRead(){this.lView[nl]=this}};function Yc(i){return 2!==i.type}const oh=100;function rf(i,o=!0,l=0){const h=i[Wl],y=h.rendererFactory;y.begin?.();try{!function X1(i,o){const l=Fp();try{og(!0),Pv(i,o);let h=0;for(;Jt(i);){if(h===oh)throw new Di(103,!1);h++,Pv(i,1)}}finally{og(l)}}(i,l)}catch(A){throw o&&ip(i,A),A}finally{y.end?.(),h.inlineEffectRunner?.flush()}}function Sw(i,o,l,h){const y=o[Cr];if(!(256&~y))return;o[Wl].inlineEffectRunner?.flush(),Lh(o);let O=!0,j=null,ne=null;Yc(i)?(ne=function sp(i){return i[nl]??function bc(i){const o=c_.pop()??Object.create(wc);return o.lView=i,o}(i)}(o),j=He(ne)):null===function T(){return v}()?(O=!1,ne=function Mu(i){const o=i[nl]??Object.create(rh);return o.lView=i,o}(o),j=He(ne)):o[nl]&&(Le(o[nl]),o[nl]=null);try{Pi(o),function Wd(i){return Tr.lFrame.bindingIndex=i}(i.bindingStartIndex),null!==l&&bv(i,o,l,2,h);const _e=!(3&~y);if(_e){const Zt=i.preOrderCheckHooks;null!==Zt&&fg(o,Zt,null)}else{const Zt=i.preOrderHooks;null!==Zt&&pg(o,Zt,0,null),kh(o,0)}if(function d_(i){for(let o=My(i);null!==o;o=Ag(o)){if(!(o[Cr]&u.HasTransplantedViews))continue;const l=o[p];for(let h=0;h<l.length;h++)zs(l[h])}}(o),Av(o,0),null!==i.contentQueries&&H1(i,o),_e){const Zt=i.contentCheckHooks;null!==Zt&&fg(o,Zt)}else{const Zt=i.contentHooks;null!==Zt&&pg(o,Zt,1),kh(o,1)}!function U1(i,o){const l=i.hostBindingOpCodes;if(null!==l)try{for(let h=0;h<l.length;h++){const y=l[h];if(y<0)Xd(~y);else{const C=y,A=l[++h],O=l[++h];ay(A,C),O(2,o[C])}}}finally{Xd(-1)}}(i,o);const ft=i.components;null!==ft&&Z1(o,ft,0);const Wt=i.viewQuery;if(null!==Wt&&Dv(2,Wt,h),_e){const Zt=i.viewCheckHooks;null!==Zt&&fg(o,Zt)}else{const Zt=i.viewHooks;null!==Zt&&pg(o,Zt,2),kh(o,2)}if(!0===i.firstUpdatePass&&(i.firstUpdatePass=!1),o[Ph]){for(const Zt of o[Ph])Zt();o[Ph]=null}o[Cr]&=-73}catch(_e){throw Us(o),_e}finally{null!==ne&&(be(ne,j),O&&function u_(i){i.lView[nl]!==i&&(i.lView=null,c_.push(i))}(ne)),hg()}}function Av(i,o){for(let l=My(i);null!==l;l=Ag(l))for(let h=r;h<l.length;h++)K1(l[h],o)}function Aw(i,o,l){K1(Kr(o,i),l)}function K1(i,o){xo(i)&&Pv(i,o)}function Pv(i,o){const h=i[Ni],y=i[Cr],C=i[nl];let A=!!(0===o&&16&y);if(A||=!!(64&y&&0===o),A||=!!(1024&y),A||=!(!C?.dirty||!Ye(C)),A||=!1,C&&(C.dirty=!1),i[Cr]&=-9217,A)Sw(h,i,h.template,i[ns]);else if(8192&y){Av(i,1);const O=h.components;null!==O&&Z1(i,O,1)}}function Z1(i,o,l){for(let h=0;h<o.length;h++)Aw(i,o[h],l)}function Rm(i,o){const l=Fp()?64:1088;for(i[Wl].changeDetectionScheduler?.notify(o);i;){i[Cr]|=l;const h=Ks(i);if(L(i)&&!h)return i;i=h}return null}class Om{get rootNodes(){const o=this._lView,l=o[Ni];return Am(l,o,l.firstChild,[])}constructor(o,l,h=!0){this._lView=o,this._cdRefInjectingView=l,this.notifyErrorHandler=h,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[ns]}set context(o){this._lView[ns]=o}get destroyed(){return!(256&~this._lView[Cr])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[hs];if(b(o)){const l=o[8],h=l?l.indexOf(this):-1;h>-1&&(vm(o,h),Pc(l,h))}this._attachedToViewContainer=!1}qg(this._lView[Ni],this._lView)}onDestroy(o){Ms(this._lView,o)}markForCheck(){Rm(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Cr]&=-129}reattach(){ra(this._lView),this._lView[Cr]|=128}detectChanges(){this._lView[Cr]|=1024,rf(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Di(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;const o=L(this._lView),l=this._lView[zc];null!==l&&!o&&th(l,this._lView),sa(this._lView[Ni],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new Di(902,!1);this._appRef=o;const l=L(this._lView),h=this._lView[zc];null!==h&&!l&&ym(h,this._lView),ra(this._lView)}}let Lm=(()=>{class i{static#e=this.__NG_ELEMENT_ID__=Ow}return i})();const Pw=Lm,Rw=class extends Pw{constructor(o,l,h){super(),this._declarationLView=o,this._declarationTContainer=l,this.elementRef=h}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(o,l){return this.createEmbeddedViewImpl(o,l)}createEmbeddedViewImpl(o,l,h){const y=rp(this._declarationLView,this._declarationTContainer,o,{embeddedViewInjector:l,dehydratedView:h});return new Om(y)}};function Ow(){return h_(is(),li())}function h_(i,o){return 4&i.type?new Rw(o,i,Bf(i,o)):null}let fp=()=>null;function Au(i,o){return fp(i,o)}class dh{}const $m=new Sr("",{providedIn:"root",factory:()=>!1}),$v=new Sr("");class Gv{}class pp{}class Gm{resolveComponentFactory(o){throw function eE(i){const o=Error(`No component factory found for ${ss(i)}.`);return o.ngComponent=i,o}(o)}}class af{static#e=this.NULL=new Gm}class mp{}let Hv=(()=>{class i{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function Qc(){const i=li(),l=Kr(is().index,i);return(m(l)?l:i)[zr]}()}return i})(),gp=(()=>{class i{static#e=this.\u0275prov=zo({token:i,providedIn:"root",factory:()=>null})}return i})();const lf=new Set;function rl(i){lf.has(i)||(lf.add(i),performance?.mark?.("mark_feature_usage",{detail:{feature:i}}))}function Wv(i){let o=!0;return setTimeout(()=>{o&&(o=!1,i())}),"function"==typeof jo.requestAnimationFrame&&jo.requestAnimationFrame(()=>{o&&(o=!1,i())}),()=>{o=!1}}function Hm(i){let o=!0;return queueMicrotask(()=>{o&&i()}),()=>{o=!1}}function Cx(...i){}class ws{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:l=!1,shouldCoalesceRunChangeDetection:h=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Xc(!1),this.onMicrotaskEmpty=new Xc(!1),this.onStable=new Xc(!1),this.onError=new Xc(!1),typeof Zone>"u")throw new Di(908,!1);Zone.assertZonePatched();const y=this;y._nesting=0,y._outer=y._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(y._inner=y._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(y._inner=y._inner.fork(Zone.longStackTraceZoneSpec)),y.shouldCoalesceEventChangeDetection=!h&&l,y.shouldCoalesceRunChangeDetection=h,y.callbackScheduled=!1,function tE(i){const o=()=>{!function I_(i){i.isCheckStableRunning||i.callbackScheduled||(i.callbackScheduled=!0,Zone.root.run(()=>{Wv(()=>{i.callbackScheduled=!1,T_(i),i.isCheckStableRunning=!0,Kv(i),i.isCheckStableRunning=!1})}),T_(i))}(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(l,h,y,C,A,O)=>{if(function Ix(i){return Jv(i,"__ignore_ng_zone__")}(O))return l.invokeTask(y,C,A,O);try{return Zv(i),l.invokeTask(y,C,A,O)}finally{(i.shouldCoalesceEventChangeDetection&&"eventTask"===C.type||i.shouldCoalesceRunChangeDetection)&&o(),qv(i)}},onInvoke:(l,h,y,C,A,O,j)=>{try{return Zv(i),l.invoke(y,C,A,O,j)}finally{i.shouldCoalesceRunChangeDetection&&!i.callbackScheduled&&!function nE(i){return Jv(i,"__scheduler_tick__")}(O)&&o(),qv(i)}},onHasTask:(l,h,y,C)=>{l.hasTask(y,C),h===y&&("microTask"==C.change?(i._hasPendingMicrotasks=C.microTask,T_(i),Kv(i)):"macroTask"==C.change&&(i.hasPendingMacrotasks=C.macroTask))},onHandleError:(l,h,y,C)=>(l.handleError(y,C),i.runOutsideAngular(()=>i.onError.emit(C)),!1)})}(y)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ws.isInAngularZone())throw new Di(909,!1)}static assertNotInAngularZone(){if(ws.isInAngularZone())throw new Di(909,!1)}run(o,l,h){return this._inner.run(o,l,h)}runTask(o,l,h,y){const C=this._inner,A=C.scheduleEventTask("NgZoneEvent: "+y,o,Xv,Cx,Cx);try{return C.runTask(A,l,h)}finally{C.cancelTask(A)}}runGuarded(o,l,h){return this._inner.runGuarded(o,l,h)}runOutsideAngular(o){return this._outer.run(o)}}const Xv={};function Kv(i){if(0==i._nesting&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function T_(i){i.hasPendingMicrotasks=!!(i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&!0===i.callbackScheduled)}function Zv(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function qv(i){i._nesting--,Kv(i)}class Yv{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Xc,this.onMicrotaskEmpty=new Xc,this.onStable=new Xc,this.onError=new Xc}run(o,l,h){return o.apply(l,h)}runGuarded(o,l,h){return o.apply(l,h)}runOutsideAngular(o){return o()}runTask(o,l,h,y){return o.apply(l,h)}}function Jv(i,o){return!(!Array.isArray(i)||1!==i.length)&&!0===i[0]?.data?.[o]}var ja=function(i){return i[i.EarlyRead=0]="EarlyRead",i[i.Write=1]="Write",i[i.MixedReadWrite=2]="MixedReadWrite",i[i.Read=3]="Read",i}(ja||{});const Tx={destroy(){}};function Dx(i,o){!o&&function Ku(i){if(!Mh())throw new Di(-203,!1)}();const l=o?.injector??gi(Ys);return function _l(i){return"browser"===(i??gi(Ys)).get($h)}(l)?(rl("NgAfterNextRender"),function Qv(i,o,l,h){const y=function rE(i,o){if(i instanceof Function)switch(o){case ja.EarlyRead:return{earlyRead:i};case ja.Write:return{write:i};case ja.MixedReadWrite:return{mixedReadWrite:i};case ja.Read:return{read:i}}return i}(i,h),C=o.get(_p),A=C.handler??=new sE,O=[],j=[],ne=()=>{for(const Zt of j)A.unregister(Zt);_e()},_e=o.get(Xp).onDestroy(ne);let ft=0;const Wt=(Zt,Tn)=>{if(!Tn)return;const fi=l?(...Wi)=>(ft--,ft<1&&ne(),Tn(...Wi)):Tn,Bi=Xu(o,()=>new oE(Zt,O,fi));A.register(Bi),j.push(Bi),ft++};return Wt(ja.EarlyRead,y.earlyRead),Wt(ja.Write,y.write),Wt(ja.MixedReadWrite,y.mixedReadWrite),Wt(ja.Read,y.read),{destroy:ne}}(i,l,!0,o?.phase??ja.MixedReadWrite)):Tx}class oE{constructor(o,l,h){this.phase=o,this.pipelinedArgs=l,this.callbackFn=h,this.zone=gi(ws),this.errorHandler=gi(ec,{optional:!0}),gi(dh,{optional:!0})?.notify(6)}invoke(){try{const o=this.zone.runOutsideAngular(()=>this.callbackFn.apply(null,this.pipelinedArgs));this.pipelinedArgs.splice(0,this.pipelinedArgs.length,o)}catch(o){this.errorHandler?.handleError(o)}}}class sE{constructor(){this.executingCallbacks=!1,this.buckets={[ja.EarlyRead]:new Set,[ja.Write]:new Set,[ja.MixedReadWrite]:new Set,[ja.Read]:new Set},this.deferredCallbacks=new Set}register(o){(this.executingCallbacks?this.deferredCallbacks:this.buckets[o.phase]).add(o)}unregister(o){this.buckets[o.phase].delete(o),this.deferredCallbacks.delete(o)}execute(){this.executingCallbacks=!0;for(const o of Object.values(this.buckets))for(const l of o)l.invoke();this.executingCallbacks=!1;for(const o of this.deferredCallbacks)this.buckets[o.phase].add(o);this.deferredCallbacks.clear()}destroy(){for(const o of Object.values(this.buckets))o.clear();this.deferredCallbacks.clear()}}let _p=(()=>{class i{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){const l=[...this.internalCallbacks];this.internalCallbacks.length=0;for(const h of l)h()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static#e=this.\u0275prov=zo({token:i,providedIn:"root",factory:()=>new i})}return i})();function Cd(i){return!!dr(i)}function vp(i,o,l){let h=l?i.styles:null,y=l?i.classes:null,C=0;if(null!==o)for(let A=0;A<o.length;A++){const O=o[A];"number"==typeof O?C=O:1==C?y=al(y,O):2==C&&(h=al(h,O+": "+o[++A]+";"))}l?i.styles=h:i.stylesWithoutHost=h,l?i.classes=y:i.classesWithoutHost=y}class S_ extends af{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const l=un(o);return new uf(l,this.ngModule)}}function n0(i,o){const l=[];for(const h in i){if(!i.hasOwnProperty(h))continue;const y=i[h];if(void 0===y)continue;const C=Array.isArray(y),A=C?y[0]:y;l.push(o?{propName:A,templateName:h,isSignal:!!((C?y[1]:el.None)&el.SignalBased)}:{propName:A,templateName:h})}return l}class uf extends pp{get inputs(){const o=this.componentDef,l=o.inputTransforms,h=n0(o.inputs,!0);if(null!==l)for(const y of h)l.hasOwnProperty(y.propName)&&(y.transform=l[y.propName]);return h}get outputs(){return n0(this.componentDef.outputs,!1)}constructor(o,l){super(),this.componentDef=o,this.ngModule=l,this.componentType=o.type,this.selector=function xf(i){return i.map(fl).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!l}create(o,l,h,y){const C=ie(null);try{let A=(y=y||this.ngModule)instanceof tl?y:y?.injector;A&&null!==this.componentDef.getStandaloneInjector&&(A=this.componentDef.getStandaloneInjector(A)||A);const O=A?new Fh(o,A):o,j=O.get(mp,null);if(null===j)throw new Di(407,!1);const ne=O.get(gp,null),Wt={rendererFactory:j,sanitizer:ne,inlineEffectRunner:null,afterRenderEventManager:O.get(_p,null),changeDetectionScheduler:O.get(dh,null)},Zt=j.createRenderer(null,this.componentDef),Tn=this.componentDef.selectors[0][0]||"div",fi=h?function _w(i,o,l,h){const C=h.get(e1,!1)||l===dl.ShadowDom,A=i.selectRootElement(o,C);return function Qf(i){i_(i)}(A),A}(Zt,h,this.componentDef.encapsulation,O):_m(Zt,Tn,function Zm(i){const o=i.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(Tn));let Bi=512;this.componentDef.signals?Bi|=4096:this.componentDef.onPush||(Bi|=16);let Wi=null;null!==fi&&(Wi=Hf(fi,O,!0));const Ii=wv(0,null,null,1,0,null,null,null,null,null,null),$r=Ll(null,Ii,null,Bi,null,null,Wt,Zt,O,null,Wi);let Ko,Cs;Lh($r);try{const Ha=this.componentDef;let Tc,ty=null;Ha.findHostDirectiveDefs?(Tc=[],ty=new Map,Ha.findHostDirectiveDefs(Ha,Tc,ty),Tc.push(Ha)):Tc=[Ha];const uA=function t(i,o){const l=i[Ni],h=lr;return i[h]=o,_d(l,h,2,"#host",null)}($r,fi),qL=function e(i,o,l,h,y,C,A){const O=y[Ni];!function n(i,o,l,h){for(const y of i)o.mergedAttrs=Gl(o.mergedAttrs,y.hostAttrs);null!==o.mergedAttrs&&(vp(o,o.mergedAttrs,!0),null!==l&&vv(h,l,o))}(h,i,o,A);let j=null;null!==o&&(j=Hf(o,y[gs]));const ne=C.rendererFactory.createRenderer(o,l);let _e=16;l.signals?_e=4096:l.onPush&&(_e=64);const ft=Ll(y,Im(l),null,_e,y[i.index],i,C,ne,null,null,j);return O.firstCreatePass&&ef(O,i,h.length-1),Mm(y,ft),y[i.index]=ft}(uA,fi,Ha,Tc,$r,Wt,Zt);Cs=Pr(Ii,lr),fi&&function c(i,o,l,h){if(h)vf(i,l,["ng-version","18.1.2"]);else{const{attrs:y,classes:C}=function hi(i){const o=[],l=[];let h=1,y=2;for(;h<i.length;){let C=i[h];if("string"==typeof C)2===y?""!==C&&o.push(C,i[++h]):8===y&&l.push(C);else{if(!As(y))break;y=C}h++}return{attrs:o,classes:l}}(o.selectors[0]);y&&vf(i,l,y),C&&C.length>0&&yv(i,l,C.join(" "))}}(Zt,Ha,fi,h),void 0!==l&&function d(i,o,l){const h=i.projection=[];for(let y=0;y<o.length;y++){const C=l[y];h.push(null!=C?Array.from(C):null)}}(Cs,this.ngContentSelectors,l),Ko=function s(i,o,l,h,y,C){const A=is(),O=y[Ni],j=Ur(A,y);Iv(O,y,A,l,null,h);for(let _e=0;_e<l.length;_e++)za(sd(y,O,A.directiveStart+_e,A),y);tp(O,y,A),j&&za(j,y);const ne=sd(y,O,A.directiveStart+A.componentOffset,A);if(i[ns]=y[ns]=ne,null!==C)for(const _e of C)_e(ne,o);return Yf(O,A,y),ne}(qL,Ha,Tc,ty,$r,[f]),nc(Ii,$r,null)}finally{hg()}return new Sx(this.componentType,Ko,Bf(Cs,$r),$r,Cs)}finally{ie(C)}}}class Sx extends Gv{constructor(o,l,h,y,C){super(),this.location=h,this._rootLView=y,this._tNode=C,this.previousInputValues=null,this.instance=l,this.hostView=this.changeDetectorRef=new Om(y,void 0,!1),this.componentType=o}setInput(o,l){const h=this._tNode.inputs;let y;if(null!==h&&(y=h[o])){if(this.previousInputValues??=new Map,this.previousInputValues.has(o)&&Object.is(this.previousInputValues.get(o),l))return;const C=this._rootLView;nf(C[Ni],C,y,o,l),this.previousInputValues.set(o,l),Rm(Kr(this._tNode.index,C),1)}}get injector(){return new oa(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function f(){const i=is();jp(li()[Ni],i)}let _=(()=>{class i{static#e=this.__NG_ELEMENT_ID__=x}return i})();function x(){return F(is(),li())}const E=_,D=class extends E{constructor(o,l,h){super(),this._lContainer=o,this._hostTNode=l,this._hostLView=h}get element(){return Bf(this._hostTNode,this._hostLView)}get injector(){return new oa(this._hostTNode,this._hostLView)}get parentInjector(){const o=Hp(this._hostTNode,this._hostLView);if(Vp(o)){const l=vu(o,this._hostLView),h=Nh(o);return new oa(l[Ni].data[h+8],l)}return new oa(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const l=S(this._lContainer);return null!==l&&l[o]||null}get length(){return this._lContainer.length-r}createEmbeddedView(o,l,h){let y,C;"number"==typeof h?y=h:null!=h&&(y=h.index,C=h.injector);const A=Au(this._lContainer,o.ssrId),O=o.createEmbeddedViewImpl(l||{},C,A);return this.insertImpl(O,y,Du(this._hostTNode,A)),O}createComponent(o,l,h,y,C){const A=o&&!function Bd(i){return"function"==typeof i}(o);let O;if(A)O=l;else{const Tn=l||{};O=Tn.index,h=Tn.injector,y=Tn.projectableNodes,C=Tn.environmentInjector||Tn.ngModuleRef}const j=A?o:new uf(un(o)),ne=h||this.parentInjector;if(!C&&null==j.ngModule){const fi=(A?ne:this.parentInjector).get(tl,null);fi&&(C=fi)}const _e=un(j.componentType??{}),ft=Au(this._lContainer,_e?.id??null),Zt=j.create(ne,y,ft?.firstChild??null,C);return this.insertImpl(Zt.hostView,O,Du(this._hostTNode,ft)),Zt}insert(o,l){return this.insertImpl(o,l,!0)}insertImpl(o,l,h){const y=o._lView;if(function No(i){return b(i[hs])}(y)){const O=this.indexOf(o);if(-1!==O)this.detach(O);else{const j=y[hs],ne=new D(j,j[Ws],j[hs]);ne.detach(ne.indexOf(o))}}const C=this._adjustIndex(l),A=this._lContainer;return xd(A,y,C,h),o.attachToViewContainerRef(),La(P(A),C,o),o}move(o,l){return this.insert(o,l)}indexOf(o){const l=S(this._lContainer);return null!==l?l.indexOf(o):-1}remove(o){const l=this._adjustIndex(o,-1),h=vm(this._lContainer,l);h&&(Pc(P(this._lContainer),l),qg(h[Ni],h))}detach(o){const l=this._adjustIndex(o,-1),h=vm(this._lContainer,l);return h&&null!=Pc(P(this._lContainer),l)?new Om(h):null}_adjustIndex(o,l=0){return o??this.length+l}};function S(i){return i[8]}function P(i){return i[8]||(i[8]=[])}function F(i,o){let l;const h=o[i.index];return b(h)?l=h:(l=Tv(h,o,null,i),o[i.index]=l,Mm(o,l)),$(l,o,i,h),new D(l,i,o)}let $=function Pe(i,o,l,h){if(i[ql])return;let y;y=8&l.type?fr(h):function z(i,o){const l=i[zr],h=l.createComment(""),y=Ur(o,i);return Yh(l,gd(l,y),h,function pv(i,o){return i.nextSibling(o)}(l,y),!1),h}(o,l),i[ql]=y},H=()=>!1;class st{constructor(o){this.queryList=o,this.matches=null}clone(){return new st(this.queryList)}setDirty(){this.queryList.setDirty()}}class Dt{constructor(o=[]){this.queries=o}createEmbeddedView(o){const l=o.queries;if(null!==l){const h=null!==o.contentQueries?o.contentQueries[0]:l.length,y=[];for(let C=0;C<h;C++){const A=l.getByIndex(C);y.push(this.queries[A.indexInDeclarationView].clone())}return new Dt(y)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}finishViewCreation(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let l=0;l<this.queries.length;l++)null!==$i(o,l).matches&&this.queries[l].setDirty()}}class kt{constructor(o,l,h=null){this.flags=l,this.read=h,this.predicate="string"==typeof o?function Qn(i){return i.split(",").map(o=>o.trim())}(o):o}}class Yt{constructor(o=[]){this.queries=o}elementStart(o,l){for(let h=0;h<this.queries.length;h++)this.queries[h].elementStart(o,l)}elementEnd(o){for(let l=0;l<this.queries.length;l++)this.queries[l].elementEnd(o)}embeddedTView(o){let l=null;for(let h=0;h<this.length;h++){const y=null!==l?l.length:0,C=this.getByIndex(h).embeddedTView(o,y);C&&(C.indexInDeclarationView=h,null!==l?l.push(C):l=[C])}return null!==l?new Yt(l):null}template(o,l){for(let h=0;h<this.queries.length;h++)this.queries[h].template(o,l)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class yn{constructor(o,l=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=l}elementStart(o,l){this.isApplyingToNode(l)&&this.matchTNode(o,l)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,l){this.elementStart(o,l)}embeddedTView(o,l){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,l),new yn(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1&~this.metadata.flags){const l=this._declarationNodeIndex;let h=o.parent;for(;null!==h&&8&h.type&&h.index!==l;)h=h.parent;return l===(null!==h?h.index:-1)}return this._appliesToNextNode}matchTNode(o,l){const h=this.metadata.predicate;if(Array.isArray(h))for(let y=0;y<h.length;y++){const C=h[y];this.matchTNodeWithReadOption(o,l,dn(l,C)),this.matchTNodeWithReadOption(o,l,od(l,o,C,!1,!1))}else h===Lm?4&l.type&&this.matchTNodeWithReadOption(o,l,-1):this.matchTNodeWithReadOption(o,l,od(l,o,h,!1,!1))}matchTNodeWithReadOption(o,l,h){if(null!==h){const y=this.metadata.read;if(null!==y)if(y===Cu||y===_||y===Lm&&4&l.type)this.addMatch(l.index,-2);else{const C=od(l,o,y,!1,!1);null!==C&&this.addMatch(l.index,C)}else this.addMatch(l.index,h)}}addMatch(o,l){null===this.matches?this.matches=[o,l]:this.matches.push(o,l)}}function dn(i,o){const l=i.localNames;if(null!==l)for(let h=0;h<l.length;h+=2)if(l[h]===o)return l[h+1];return null}function Yn(i,o,l,h){return-1===l?function Fn(i,o){return 11&i.type?Bf(i,o):4&i.type?h_(i,o):null}(o,i):-2===l?function Sn(i,o,l){return l===Cu?Bf(o,i):l===Lm?h_(o,i):l===_?F(o,i):void 0}(i,o,h):sd(i,i[Ni],l,o)}function Wn(i,o,l,h){const y=o[Xl].queries[h];if(null===y.matches){const C=i.data,A=l.matches,O=[];for(let j=0;null!==A&&j<A.length;j+=2){const ne=A[j];O.push(ne<0?null:Yn(o,C[ne],A[j+1],l.metadata.read))}y.matches=O}return y.matches}function xn(i,o,l,h){const y=i.queries.getByIndex(l),C=y.matches;if(null!==C){const A=Wn(i,o,y,l);for(let O=0;O<C.length;O+=2){const j=C[O];if(j>0)h.push(A[O/2]);else{const ne=C[O+1],_e=o[-j];for(let ft=r;ft<_e.length;ft++){const Wt=_e[ft];Wt[zc]===Wt[hs]&&xn(Wt[Ni],Wt,ne,h)}if(null!==_e[p]){const ft=_e[p];for(let Wt=0;Wt<ft.length;Wt++){const Zt=ft[Wt];xn(Zt[Ni],Zt,ne,h)}}}}}return h}function ni(i,o,l){const h=new xy(!(4&~l));return function Ev(i,o,l,h){const y=W1(o);y.push(l),i.firstCreatePass&&tf(i).push(h,y.length-1)}(i,o,h,h.destroy),(o[Xl]??=new Dt).queries.push(new st(h))-1}function ci(i,o,l){null===i.queries&&(i.queries=new Yt),i.queries.track(new yn(o,l))}function $i(i,o){return i.queries.getByIndex(o)}function ji(i,o){const l=i[Ni],h=$i(l,o);return h.crossesNgTemplate?xn(l,i,o,[]):Wn(l,i,h,o)}function or(i,o){rl("NgSignals");const l=function Me(i){const o=Object.create(it);o.value=i;const l=()=>(re(o),o.value);return l[Z]=o,l}(i),h=l[Z];return o?.equal&&(h.equal=o.equal),l.set=y=>_n(h,y),l.update=y=>function Re(i,o){Ne()||Kt(),_n(i,o(i.value))}(h,y),l.asReadonly=Mr.bind(l),l}function Mr(){const i=this[Z];if(void 0===i.readonlyFn){const o=()=>this();o[Z]=i,i.readonlyFn=o}return i.readonlyFn}function Er(i){return function ri(i){return"function"==typeof i&&void 0!==i[Z]}(i)&&"function"==typeof i.set}function fh(i){let o=function xl(i){return Object.getPrototypeOf(i.prototype).constructor}(i.type),l=!0;const h=[i];for(;o;){let y;if(R(i))y=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new Di(903,!1);y=o.\u0275dir}if(y){if(l){h.push(y);const A=i;A.inputs=Fx(i.inputs),A.inputTransforms=Fx(i.inputTransforms),A.declaredInputs=Fx(i.declaredInputs),A.outputs=Fx(i.outputs);const O=y.hostBindings;O&&pA(i,O);const j=y.viewQuery,ne=y.contentQueries;if(j&&hA(i,j),ne&&fA(i,ne),kx(i,y),Fu(i.outputs,y.outputs),R(y)&&y.data.animation){const _e=i.data;_e.animation=(_e.animation||[]).concat(y.data.animation)}}const C=y.features;if(C)for(let A=0;A<C.length;A++){const O=C[A];O&&O.ngInherit&&O(i),O===fh&&(l=!1)}}o=Object.getPrototypeOf(o)}!function mf(i){let o=0,l=null;for(let h=i.length-1;h>=0;h--){const y=i[h];y.hostVars=o+=y.hostVars,y.hostAttrs=Gl(y.hostAttrs,l=Gl(l,y.hostAttrs))}}(h)}function kx(i,o){for(const l in o.inputs){if(!o.inputs.hasOwnProperty(l)||i.inputs.hasOwnProperty(l))continue;const h=o.inputs[l];if(void 0!==h&&(i.inputs[l]=h,i.declaredInputs[l]=o.declaredInputs[l],null!==o.inputTransforms)){const y=Array.isArray(h)?h[0]:h;if(!o.inputTransforms.hasOwnProperty(y))continue;i.inputTransforms??={},i.inputTransforms[y]=o.inputTransforms[y]}}}function Fx(i){return i===ka?{}:i===Ao?[]:i}function hA(i,o){const l=i.viewQuery;i.viewQuery=l?(h,y)=>{o(h,y),l(h,y)}:o}function fA(i,o){const l=i.contentQueries;i.contentQueries=l?(h,y,C)=>{o(h,y,C),l(h,y,C)}:o}function pA(i,o){const l=i.hostBindings;i.hostBindings=l?(h,y)=>{o(h,y),l(h,y)}:o}function xT(i){const o=i.inputConfig,l={};for(const h in o)if(o.hasOwnProperty(h)){const y=o[h];Array.isArray(y)&&y[3]&&(l[h]=y[3])}i.inputTransforms=l}class qm{}class bT{}function xA(i,o){return new cE(i,o??null,[])}class cE extends qm{constructor(o,l,h){super(),this._parent=l,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new S_(this);const y=dr(o);this._bootstrapComponents=Ma(y.bootstrap),this._r3Injector=F0(o,l,[{provide:qm,useValue:this},{provide:af,useValue:this.componentFactoryResolver},...h],ss(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(l=>l()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class uE extends bT{constructor(o){super(),this.moduleType=o}create(o){return new cE(this.moduleType,o,[])}}class wT extends qm{constructor(o){super(),this.componentFactoryResolver=new S_(this),this.instance=null;const l=new fc([...o.providers,{provide:qm,useValue:this},{provide:af,useValue:this.componentFactoryResolver}],o.parent||Hu(),o.debugName,new Set(["environment"]));this.injector=l,o.runEnvironmentInitializers&&l.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function dE(i,o,l=null){return new wT({providers:i,parent:o,debugName:l,runEnvironmentInitializers:!0}).injector}function Nx(i){return!!hE(i)&&(Array.isArray(i)||!(i instanceof Map)&&Symbol.iterator in i)}function hE(i){return null!==i&&("function"==typeof i||"object"==typeof i)}function ph(i,o,l){return i[o]=l}function ha(i,o,l){return!Object.is(i[o],l)&&(i[o]=l,!0)}function Ym(i,o,l,h){const y=ha(i,o,l);return ha(i,o+1,h)||y}function l0(i,o,l,h,y,C,A,O,j,ne){const _e=l+lr,ft=o.firstCreatePass?function TA(i,o,l,h,y,C,A,O,j){const ne=o.consts,_e=_d(o,i,4,A||null,O||null);vd(o,l,_e,Mn(ne,j)),jp(o,_e);const ft=_e.tView=wv(2,_e,h,y,C,o.directiveRegistry,o.pipeRegistry,null,o.schemas,ne,null);return null!==o.queries&&(o.queries.template(o,_e),ft.queries=o.queries.embeddedTView(_e)),_e}(_e,o,i,h,y,C,A,O,j):o.data[_e];ba(ft,!1);const Wt=ET(o,i,ft,l);Up()&&wm(o,i,Wt,ft),za(Wt,i);const Zt=Tv(Wt,i,Wt,ft);return i[_e]=Zt,Mm(i,Zt),function ee(i,o,l){return H(i,o,l)}(Zt,ft,i),M(ft)&&n_(o,i,ft),null!=j&&Jf(i,ft,ne),ft}function fE(i,o,l,h,y,C,A,O){const j=li(),ne=lo();return l0(j,ne,i,o,l,h,y,Mn(ne.consts,C),A,O),fE}let ET=function CT(i,o,l,h){return yu(!0),o[zr].createComment("")};function CE(i,o,l,h){const y=li();return ha(y,wa(),o)&&(lo(),Tu(_s(),y,i,o,l,h)),CE}function j_(i,o,l,h){return ha(i,wa(),l)?o+wr(l)+h:Jr}function $_(i,o,l,h,y,C,A,O){const ne=function Bx(i,o,l,h,y){const C=Ym(i,o,l,h);return ha(i,o+2,y)||C}(i,Vc(),l,y,A);return $c(3),ne?o+wr(l)+h+wr(y)+C+wr(A)+O:Jr}function G_(i,o,l,h,y,C,A,O,j,ne){const ft=function Lu(i,o,l,h,y,C){const A=Ym(i,o,l,h);return Ym(i,o+2,y,C)||A}(i,Vc(),l,y,A,j);return $c(4),ft?o+wr(l)+h+wr(y)+C+wr(A)+O+wr(j)+ne:Jr}function Gx(i,o){return i<<17|o<<2}function Ep(i){return i>>17&32767}function IE(i){return 2|i}function Qm(i){return(131068&i)>>2}function TE(i,o){return-131069&i|o<<2}function DE(i){return 1|i}function tD(i,o,l,h){const y=i[l+1],C=null===o;let A=h?Ep(y):Qm(y),O=!1;for(;0!==A&&(!1===O||C);){const ne=i[A+1];d2(i[A],o)&&(O=!0,i[A+1]=h?DE(ne):IE(ne)),A=h?Ep(ne):Qm(ne)}O&&(i[l+1]=h?IE(y):DE(y))}function d2(i,o){return null===i||null==o||(Array.isArray(i)?i[1]:i)===o||!(!Array.isArray(i)||"string"!=typeof o)&&Dl(i,o)>=0}function ME(i,o,l){const h=li();return ha(h,wa(),o)&&Ua(lo(),_s(),h,i,o,h[zr],l,!1),ME}function SE(i,o,l,h,y){const A=y?"class":"style";nf(i,l,o.inputs[A],A,h)}function AE(i,o,l){return Td(i,o,l,!1),AE}function PE(i,o){return Td(i,o,null,!0),PE}function Td(i,o,l,h){const y=li(),C=lo(),A=$c(2);C.firstUpdatePass&&function cD(i,o,l,h){const y=i.data;if(null===y[l+1]){const C=y[Ea()],A=function lD(i,o){return o>=i.expandoStartIndex}(i,l);(function fD(i,o){return!!(i.flags&(o?8:16))})(C,h)&&null===o&&!A&&(o=!1),o=function x2(i,o,l,h){const y=function Bp(i){const o=Tr.lFrame.currentDirectiveIndex;return-1===o?null:i[o]}(i);let C=h?o.residualClasses:o.residualStyles;if(null===y)0===(h?o.classBindings:o.styleBindings)&&(l=h0(l=RE(null,i,o,l,h),o.attrs,h),C=null);else{const A=o.directiveStylingLast;if(-1===A||i[A]!==y)if(l=RE(y,i,o,l,h),null===C){let j=function b2(i,o,l){const h=l?o.classBindings:o.styleBindings;if(0!==Qm(h))return i[Ep(h)]}(i,o,h);void 0!==j&&Array.isArray(j)&&(j=RE(null,i,o,j[1],h),j=h0(j,o.attrs,h),function w2(i,o,l,h){i[Ep(l?o.classBindings:o.styleBindings)]=h}(i,o,h,j))}else C=function E2(i,o,l){let h;const y=o.directiveEnd;for(let C=1+o.directiveStylingLast;C<y;C++)h=h0(h,i[C].hostAttrs,l);return h0(h,o.attrs,l)}(i,o,h)}return void 0!==C&&(h?o.residualClasses=C:o.residualStyles=C),l}(y,C,o,h),function c2(i,o,l,h,y,C){let A=C?o.classBindings:o.styleBindings,O=Ep(A),j=Qm(A);i[h]=l;let _e,ne=!1;if(Array.isArray(l)?(_e=l[1],(null===_e||Dl(l,_e)>0)&&(ne=!0)):_e=l,y)if(0!==j){const Wt=Ep(i[O+1]);i[h+1]=Gx(Wt,O),0!==Wt&&(i[Wt+1]=TE(i[Wt+1],h)),i[O+1]=function a2(i,o){return 131071&i|o<<17}(i[O+1],h)}else i[h+1]=Gx(O,0),0!==O&&(i[O+1]=TE(i[O+1],h)),O=h;else i[h+1]=Gx(j,0),0===O?O=h:i[j+1]=TE(i[j+1],h),j=h;ne&&(i[h+1]=IE(i[h+1])),tD(i,_e,h,!0),tD(i,_e,h,!1),function u2(i,o,l,h,y){const C=y?i.residualClasses:i.residualStyles;null!=C&&"string"==typeof o&&Dl(C,o)>=0&&(l[h+1]=DE(l[h+1]))}(o,_e,i,h,C),A=Gx(O,j),C?o.classBindings=A:o.styleBindings=A}(y,C,o,l,A,h)}}(C,i,A,h),o!==Jr&&ha(y,A,o)&&function dD(i,o,l,h,y,C,A,O){if(!(3&o.type))return;const j=i.data,ne=j[O+1],_e=function l2(i){return!(1&~i)}(ne)?hD(j,o,l,y,Qm(ne),A):void 0;Hx(_e)||(Hx(C)||function s2(i){return!(2&~i)}(ne)&&(C=hD(j,null,l,y,O,A)),function pw(i,o,l,h,y){if(o)y?i.addClass(l,h):i.removeClass(l,h);else{let C=-1===h.indexOf("-")?void 0:Zg.DashCase;null==y?i.removeStyle(l,h,C):("string"==typeof y&&y.endsWith("!important")&&(y=y.slice(0,-10),C|=Zg.Important),i.setStyle(l,h,y,C))}}(h,A,rr(Ea(),l),y,C))}(C,C.data[Ea()],y,y[zr],i,y[A+1]=function D2(i,o){return null==i||""===i||("string"==typeof o?i+=o:"object"==typeof i&&(i=ss(fd(i)))),i}(o,l),h,A)}function RE(i,o,l,h,y){let C=null;const A=l.directiveEnd;let O=l.directiveStylingLast;for(-1===O?O=l.directiveStart:O++;O<A&&(C=o[O],h=h0(h,C.hostAttrs,y),C!==i);)O++;return null!==i&&(l.directiveStylingLast=O),h}function h0(i,o,l){const h=l?1:2;let y=-1;if(null!==o)for(let C=0;C<o.length;C++){const A=o[C];"number"==typeof A?y=A:y===h&&(Array.isArray(i)||(i=void 0===i?[]:["",i]),Hs(i,A,!!l||o[++C]))}return void 0===i?null:i}function hD(i,o,l,h,y,C){const A=null===o;let O;for(;y>0;){const j=i[y],ne=Array.isArray(j),_e=ne?j[1]:j,ft=null===_e;let Wt=l[y+1];Wt===Jr&&(Wt=ft?Ao:void 0);let Zt=ft?Qo(Wt,h):_e===h?Wt:void 0;if(ne&&!Hx(Zt)&&(Zt=Qo(j,h)),Hx(Zt)&&(O=Zt,A))return O;const Tn=i[y+1];y=A?Ep(Tn):Qm(Tn)}if(null!==o){let j=C?o.residualClasses:o.residualStyles;null!=j&&(O=Qo(j,h))}return O}function Hx(i){return void 0!==i}function Xx(i,o,l,h){const y=li(),C=lo(),A=lr+i,O=y[zr],j=C.firstCreatePass?function q2(i,o,l,h,y,C){const A=o.consts,j=_d(o,i,2,h,Mn(A,y));return vd(o,l,j,Mn(A,C)),null!==j.attrs&&vp(j,j.attrs,!1),null!==j.mergedAttrs&&vp(j,j.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,j),j}(A,C,y,o,l,h):C.data[A],ne=_D(C,y,j,O,o,i);y[A]=ne;const _e=M(j);return ba(j,!0),vv(O,ne,j),!function O_(i){return!(32&~i.flags)}(j)&&Up()&&wm(C,y,ne,j),0===function mc(){return Tr.lFrame.elementDepthCount}()&&za(ne,y),function Qu(){Tr.lFrame.elementDepthCount++}(),_e&&(n_(C,y,j),Yf(C,j,y)),null!==h&&Jf(y,j),Xx}function Kx(){let i=is();Op()?Lp():(i=i.parent,ba(i,!1));const o=i;(function Gd(i){return Tr.skipHydrationRootTNode===i})(o)&&function ua(){Tr.skipHydrationRootTNode=null}(),function Vd(){Tr.lFrame.elementDepthCount--}();const l=lo();return l.firstCreatePass&&(jp(l,i),w(i)&&l.queries.elementEnd(i)),null!=o.classesWithoutHost&&function hy(i){return!!(8&i.flags)}(o)&&SE(l,o,li(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function A0(i){return!!(16&i.flags)}(o)&&SE(l,o,li(),o.stylesWithoutHost,!1),Kx}function FE(i,o,l,h){return Xx(i,o,l,h),Kx(),FE}let _D=(i,o,l,h,y,C)=>(yu(!0),_m(h,y,function cy(){return Tr.lFrame.currentNamespace}()));function Zx(i,o,l){const h=li(),y=lo(),C=i+lr,A=y.firstCreatePass?function Q2(i,o,l,h,y){const C=o.consts,A=Mn(C,h),O=_d(o,i,8,"ng-container",A);return null!==A&&vp(O,A,!0),vd(o,l,O,Mn(C,y)),null!==o.queries&&o.queries.elementStart(o,O),O}(C,y,h,o,l):y.data[C];ba(A,!0);const O=yD(y,h,A,i);return h[C]=O,Up()&&wm(y,h,O,A),za(O,h),M(A)&&(n_(y,h,A),Yf(y,A,h)),null!=l&&Jf(h,A),Zx}function qx(){let i=is();const o=lo();return Op()?Lp():(i=i.parent,ba(i,!1)),o.firstCreatePass&&(jp(o,i),w(i)&&o.queries.elementEnd(i)),qx}function NE(i,o,l){return Zx(i,o,l),qx(),NE}let yD=(i,o,l,h)=>(yu(!0),dv(o[zr],""));function vD(){return li()}const eg=void 0;var iP=["en",[["a","p"],["AM","PM"],eg],[["AM","PM"],eg,eg],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],eg,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],eg,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",eg,"{1} 'at' {0}",eg],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function nP(i){const l=Math.floor(Math.abs(i)),h=i.toString().replace(/^[^.]*\.?/,"").length;return 1===l&&0===h?1:5}];let q_={};function BE(i){const o=function rP(i){return i.toLowerCase().replace(/_/g,"-")}(i);let l=ED(o);if(l)return l;const h=o.split("-")[0];if(l=ED(h),l)return l;if("en"===h)return iP;throw new Di(701,!1)}function wD(i){return BE(i)[Y_.PluralCase]}function ED(i){return i in q_||(q_[i]=jo.ng&&jo.ng.common&&jo.ng.common.locales&&jo.ng.common.locales[i]),q_[i]}var Y_=function(i){return i[i.LocaleId=0]="LocaleId",i[i.DayPeriodsFormat=1]="DayPeriodsFormat",i[i.DayPeriodsStandalone=2]="DayPeriodsStandalone",i[i.DaysFormat=3]="DaysFormat",i[i.DaysStandalone=4]="DaysStandalone",i[i.MonthsFormat=5]="MonthsFormat",i[i.MonthsStandalone=6]="MonthsStandalone",i[i.Eras=7]="Eras",i[i.FirstDayOfWeek=8]="FirstDayOfWeek",i[i.WeekendRange=9]="WeekendRange",i[i.DateFormat=10]="DateFormat",i[i.TimeFormat=11]="TimeFormat",i[i.DateTimeFormat=12]="DateTimeFormat",i[i.NumberSymbols=13]="NumberSymbols",i[i.NumberFormats=14]="NumberFormats",i[i.CurrencyCode=15]="CurrencyCode",i[i.CurrencySymbol=16]="CurrencySymbol",i[i.CurrencyName=17]="CurrencyName",i[i.Currencies=18]="Currencies",i[i.Directionality=19]="Directionality",i[i.PluralCase=20]="PluralCase",i[i.ExtraData=21]="ExtraData",i}(Y_||{});const J_="en-US";let CD=J_;let $D=(i,o,l)=>{};function jE(i,o,l,h){const y=li(),C=lo(),A=is();return VE(C,y,y[zr],A,i,o,h),jE}function VE(i,o,l,h,y,C,A){const O=M(h),ne=i.firstCreatePass&&tf(i),_e=o[ns],ft=W1(o);let Wt=!0;if(3&h.type||A){const fi=Ur(h,o),Bi=A?A(fi):fi,Wi=ft.length,Ii=A?Ko=>A(fr(Ko[h.index])):h.index;let $r=null;if(!A&&O&&($r=function HP(i,o,l,h){const y=i.cleanup;if(null!=y)for(let C=0;C<y.length-1;C+=2){const A=y[C];if(A===l&&y[C+1]===h){const O=o[Yu],j=y[C+2];return O.length>j?O[j]:null}"string"==typeof A&&(C+=2)}return null}(i,o,y,h.index)),null!==$r)($r.__ngLastListenerFn__||$r).__ngNextListenerFn__=C,$r.__ngLastListenerFn__=C,Wt=!1;else{C=XD(h,o,_e,C),$D(fi,y,C);const Ko=l.listen(Bi,y,C);ft.push(C,Ko),ne&&ne.push(y,Ii,Wi,Wi+1)}}else C=XD(h,o,_e,C);const Zt=h.outputs;let Tn;if(Wt&&null!==Zt&&(Tn=Zt[y])){const fi=Tn.length;if(fi)for(let Bi=0;Bi<fi;Bi+=2){const Cs=o[Tn[Bi]][Tn[Bi+1]].subscribe(C),Ha=ft.length;ft.push(C,Cs),ne&&ne.push(y,h.index,Ha,-(Ha+1))}}}function WD(i,o,l,h){const y=ie(null);try{return Ji(6,o,l),!1!==l(h)}catch(C){return ip(i,C),!1}finally{Ji(7,o,l),ie(y)}}function XD(i,o,l,h){return function y(C){if(C===Function)return h;Rm(i.componentOffset>-1?Kr(i.index,o):o,5);let O=WD(o,l,h,C),j=y.__ngNextListenerFn__;for(;j;)O=WD(o,l,j,C)&&O,j=j.__ngNextListenerFn__;return O}}function KD(i=1){return function ly(i){return(Tr.lFrame.contextLView=function to(i,o){for(;i>0;)o=o[gu],i--;return o}(i,Tr.lFrame.contextLView))[ns]}(i)}function WP(i,o){let l=null;const h=function Ch(i){const o=i.attrs;if(null!=o){const l=o.indexOf(5);if(!(1&l))return o[l+1]}return null}(i);for(let y=0;y<o.length;y++){const C=o[y];if("*"!==C){if(null===h?Eh(i,C,!0):Tp(h,C))return y}else l=y}return l}function ZD(i){const o=li()[fs][Ws];if(!o.projection){const h=o.projection=function Rc(i,o){const l=[];for(let h=0;h<i;h++)l.push(o);return l}(i?i.length:1,null),y=h.slice();let C=o.child;for(;null!==C;){if(128!==C.type){const A=i?WP(C,i):0;null!==A&&(y[A]?y[A].projectionNext=C:h[A]=C,y[A]=C)}C=C.next}}}function qD(i,o=0,l,h,y,C){const A=li(),O=lo(),j=h?i+1:null;null!==j&&l0(A,O,j,h,y,C,null,l);const ne=_d(O,lr+i,16,null,l||null);null===ne.projection&&(ne.projection=o),Lp();const ft=!A[Rs]||Sl();null===A[fs][Ws].projection[ne.projection]&&null!==j?function XP(i,o,l){const h=lr+l,y=o.data[h],C=i[h],A=Au(C,y.tView.ssrId);xd(C,rp(i,y,void 0,{dehydratedView:A}),0,Du(y,A))}(A,O,j):ft&&32&~ne.flags&&function B1(i,o,l){_v(o[zr],0,o,l,xm(i,l,o),bm(l.parent||o[Ws],l,o))}(O,A,ne)}function $E(i,o,l){return GE(i,"",o,"",l),$E}function GE(i,o,l,h,y){const C=li(),A=j_(C,o,l,h);return A!==Jr&&Ua(lo(),_s(),C,i,A,C[zr],y,!1),GE}function oM(i,o,l,h){!function Si(i,o,l,h){const y=lo();if(y.firstCreatePass){const C=is();ci(y,new kt(o,l,h),C.index),function Qi(i,o){const l=i.contentQueries||(i.contentQueries=[]);o!==(l.length?l[l.length-1]:-1)&&l.push(i.queries.length-1,o)}(y,i),!(2&~l)&&(y.staticContentQueries=!0)}return ni(y,li(),l)}(i,o,l,h)}function sM(i,o,l){!function Zn(i,o,l){const h=lo();return h.firstCreatePass&&(ci(h,new kt(i,o,l),-1),!(2&~o)&&(h.staticViewQueries=!0)),ni(h,li(),o)}(i,o,l)}function aM(i){const o=li(),l=lo(),h=nd();Af(h+1);const y=$i(l,h);if(i.dirty&&function ps(i){return!(4&~i[Cr])}(o)===!(2&~y.metadata.flags)){if(null===y.matches)i.reset([]);else{const C=ji(o,h);i.reset(C,Cg),i.notifyOnChanges()}return!0}return!1}function lM(){return function Hn(i,o){return i[Xl].queries[o].queryList}(li(),nd())}function cM(i){return cr(function td(){return Tr.lFrame.contextLView}(),lr+i)}function vM(i,o=""){const l=li(),h=lo(),y=i+lr,C=h.firstCreatePass?_d(h,y,1,o,null):h.data[y],A=xM(h,l,C,o,i);l[y]=A,Up()&&wm(h,l,A,C),ba(C,!1)}let xM=(i,o,l,h,y)=>(yu(!0),function cv(i,o){return i.createText(o)}(o[zr],h));function WE(i){return eb("",i,""),WE}function eb(i,o,l){const h=li(),y=j_(h,i,o,l);return y!==Jr&&js(h,Ea(),y),eb}function XE(i,o,l,h,y){const C=li(),A=function V_(i,o,l,h,y,C){const O=Ym(i,Vc(),l,y);return $c(2),O?o+wr(l)+h+wr(y)+C:Jr}(C,i,o,l,h,y);return A!==Jr&&js(C,Ea(),A),XE}function KE(i,o,l,h,y,C,A){const O=li(),j=$_(O,i,o,l,h,y,C,A);return j!==Jr&&js(O,Ea(),j),KE}function ZE(i,o,l,h,y,C,A,O,j){const ne=li(),_e=G_(ne,i,o,l,h,y,C,A,O,j);return _e!==Jr&&js(ne,Ea(),_e),ZE}function qE(i,o,l){Er(o)&&(o=o());const h=li();return ha(h,wa(),o)&&Ua(lo(),_s(),h,i,o,h[zr],l,!1),qE}function TM(i,o){const l=Er(i);return l&&i.set(o),l}function YE(i,o){const l=li(),h=lo(),y=is();return VE(h,l,l[zr],y,i,o),YE}function JE(i,o,l,h,y){if(i=br(i),Array.isArray(i))for(let C=0;C<i.length;C++)JE(i[C],o,l,h,y);else{const C=lo(),A=li(),O=is();let j=Fc(i)?i:br(i.provide);const ne=If(i),_e=1048575&O.providerIndexes,ft=O.directiveStart,Wt=O.providerIndexes>>20;if(Fc(i)||!i.multi){const Zt=new Kd(ne,y,Qh),Tn=eC(j,o,y?_e:_e+Wt,ft);-1===Tn?(py(Gp(O,A),C,j),QE(C,i,o.length),o.push(j),O.directiveStart++,O.directiveEnd++,y&&(O.providerIndexes+=1048576),l.push(Zt),A.push(Zt)):(l[Tn]=Zt,A[Tn]=Zt)}else{const Zt=eC(j,o,_e+Wt,ft),Tn=eC(j,o,_e,_e+Wt),Bi=Tn>=0&&l[Tn];if(y&&!Bi||!y&&!(Zt>=0&&l[Zt])){py(Gp(O,A),C,j);const Wi=function fR(i,o,l,h,y){const C=new Kd(i,l,Qh);return C.multi=[],C.index=o,C.componentProviders=0,SM(C,y,h&&!l),C}(y?hR:dR,l.length,y,h,ne);!y&&Bi&&(l[Tn].providerFactory=Wi),QE(C,i,o.length,0),o.push(j),O.directiveStart++,O.directiveEnd++,y&&(O.providerIndexes+=1048576),l.push(Wi),A.push(Wi)}else QE(C,i,Zt>-1?Zt:Tn,SM(l[y?Tn:Zt],ne,!y&&h));!y&&h&&Bi&&l[Tn].componentProviders++}}}function QE(i,o,l,h){const y=Fc(o),C=function hc(i){return!!i.useClass}(o);if(y||C){const j=(C?br(o.useClass):o).prototype.ngOnDestroy;if(j){const ne=i.destroyHooks||(i.destroyHooks=[]);if(!y&&o.multi){const _e=ne.indexOf(l);-1===_e?ne.push(l,[h,j]):ne[_e+1].push(h,j)}else ne.push(l,j)}}}function SM(i,o,l){return l&&i.componentProviders++,i.multi.push(o)-1}function eC(i,o,l,h){for(let y=l;y<h;y++)if(o[y]===i)return y;return-1}function dR(i,o,l,h){return tC(this.multi,[])}function hR(i,o,l,h){const y=this.multi;let C;if(this.providerFactory){const A=this.providerFactory.componentProviders,O=sd(l,l[Ni],this.providerFactory.index,h);C=O.slice(0,A),tC(y,C);for(let j=A;j<O.length;j++)C.push(O[j])}else C=[],tC(y,C);return C}function tC(i,o){for(let l=0;l<i.length;l++)o.push((0,i[l])());return o}function AM(i,o=[]){return l=>{l.providersResolver=(h,y)=>function uR(i,o,l){const h=lo();if(h.firstCreatePass){const y=R(i);JE(l,h.data,h.blueprint,y,!0),JE(o,h.data,h.blueprint,y,!1)}}(h,y?y(i):i,o)}}let pR=(()=>{class i{constructor(l){this._injector=l,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(l){if(!l.standalone)return null;if(!this.cachedInjectors.has(l)){const h=ia(0,l.type),y=h.length>0?dE([h],this._injector,`Standalone[${l.type.name}]`):null;this.cachedInjectors.set(l,y)}return this.cachedInjectors.get(l)}ngOnDestroy(){try{for(const l of this.cachedInjectors.values())null!==l&&l.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=zo({token:i,providedIn:"environment",factory:()=>new i(Ar(tl))})}return i})();function PM(i){rl("NgStandalone"),i.getStandaloneInjector=o=>o.get(pR).getOrCreateStandaloneInjector(i)}function LM(i,o,l){const h=Ba()+i,y=li();return y[h]===Jr?ph(y,h,l?o.call(l):o()):function a0(i,o){return i[o]}(y,h)}function y0(i,o){const l=i[o];return l===Jr?void 0:l}function UM(i,o){const l=lo();let h;const y=i+lr;l.firstCreatePass?(h=function DR(i,o){if(o)for(let l=o.length-1;l>=0;l--){const h=o[l];if(i===h.name)return h}}(o,l.pipeRegistry),l.data[y]=h,h.onDestroy&&(l.destroyHooks??=[]).push(y,h.onDestroy)):h=l.data[y];const C=h.factory||(h.factory=Gs(h.type)),O=zi(Qh);try{const j=Hc(!1),ne=C();return Hc(j),function HE(i,o,l,h){l>=i.data.length&&(i.data[l]=null,i.blueprint[l]=null),o[l]=h}(l,li(),y,ne),ne}finally{zi(O)}}function jM(i,o,l){const h=i+lr,y=li(),C=cr(y,h);return v0(y,h)?function kM(i,o,l,h,y,C){const A=o+l;return ha(i,A,y)?ph(i,A+1,C?h.call(C,y):h(y)):y0(i,A+1)}(y,Ba(),o,C.transform,l,C):C.transform(l)}function VM(i,o,l,h){const y=i+lr,C=li(),A=cr(C,y);return v0(C,y)?function FM(i,o,l,h,y,C,A){const O=o+l;return Ym(i,O,y,C)?ph(i,O+2,A?h.call(A,y,C):h(y,C)):y0(i,O+2)}(C,Ba(),o,A.transform,l,h,A):A.transform(l,h)}function v0(i,o){return i[Ni].data[o].pure}class rS{constructor(o){this.full=o;const l=o.split(".");this.major=l[0],this.minor=l[1],this.patch=l.slice(2).join(".")}}let oS=(()=>{class i{log(l){console.log(l)}warn(l){console.warn(l)}static#e=this.\u0275fac=function(h){return new(h||i)};static#t=this.\u0275prov=zo({token:i,factory:i.\u0275fac,providedIn:"platform"})}return i})();const uS=new Sr(""),dS=new Sr("");let aC,CO=(()=>{class i{constructor(l,h,y){this._ngZone=l,this.registry=h,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,aC||(function IO(i){aC=i}(y),y.addToWindow(h)),this._watchAngularEvents(),l.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ws.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}isStable(){return this._isZoneStable&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let l=this._callbacks.pop();clearTimeout(l.timeoutId),l.doneCb()}});else{let l=this.getPendingTasks();this._callbacks=this._callbacks.filter(h=>!h.updateCb||!h.updateCb(l)||(clearTimeout(h.timeoutId),!1))}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(l=>({source:l.source,creationLocation:l.creationLocation,data:l.data})):[]}addCallback(l,h,y){let C=-1;h&&h>0&&(C=setTimeout(()=>{this._callbacks=this._callbacks.filter(A=>A.timeoutId!==C),l()},h)),this._callbacks.push({doneCb:l,timeoutId:C,updateCb:y})}whenStable(l,h,y){if(y&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(l,h,y),this._runCallbacksIfReady()}registerApplication(l){this.registry.registerApplication(l,this)}unregisterApplication(l){this.registry.unregisterApplication(l)}findProviders(l,h,y){return[]}static#e=this.\u0275fac=function(h){return new(h||i)(Ar(ws),Ar(hS),Ar(dS))};static#t=this.\u0275prov=zo({token:i,factory:i.\u0275fac})}return i})(),hS=(()=>{class i{constructor(){this._applications=new Map}registerApplication(l,h){this._applications.set(l,h)}unregisterApplication(l){this._applications.delete(l)}unregisterAllApplications(){this._applications.clear()}getTestability(l){return this._applications.get(l)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(l,h=!0){return aC?.findTestabilityInTree(this,l,h)??null}static#e=this.\u0275fac=function(h){return new(h||i)};static#t=this.\u0275prov=zo({token:i,factory:i.\u0275fac,providedIn:"platform"})}return i})();function lC(i){return!!i&&"function"==typeof i.then}function fS(i){return!!i&&"function"==typeof i.subscribe}const pS=new Sr("");let cC=(()=>{class i{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((l,h)=>{this.resolve=l,this.reject=h}),this.appInits=gi(pS,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const l=[];for(const y of this.appInits){const C=y();if(lC(C))l.push(C);else if(fS(C)){const A=new Promise((O,j)=>{C.subscribe({complete:O,error:j})});l.push(A)}}const h=()=>{this.done=!0,this.resolve()};Promise.all(l).then(()=>{h()}).catch(y=>{this.reject(y)}),0===l.length&&h(),this.initialized=!0}static#e=this.\u0275fac=function(h){return new(h||i)};static#t=this.\u0275prov=zo({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();const ob=new Sr("");function _S(i,o){return Array.isArray(o)?o.reduce(_S,i):{...i,...o}}let Md=(()=>{class i{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=gi(wg),this.afterRenderEffectManager=gi(_p),this.zonelessEnabled=gi($m),this.externalTestViews=new Set,this.beforeRender=new nn.B,this.afterTick=new nn.B,this.componentTypes=[],this.components=[],this.isStable=gi(yc).hasPendingTasks.pipe((0,pn.T)(l=>!l)),this._injector=gi(tl)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(l,h){const y=l instanceof pp;if(!this._injector.get(cC).done)throw!y&&yr(l),new Di(405,!1);let A;A=y?l:this._injector.get(af).resolveComponentFactory(l),this.componentTypes.push(A.componentType);const O=function TO(i){return i.isBoundToModule}(A)?void 0:this._injector.get(qm),ne=A.create(Ys.NULL,[],h||A.selector,O),_e=ne.location.nativeElement,ft=ne.injector.get(uS,null);return ft?.registerApplication(_e),ne.onDestroy(()=>{this.detachView(ne.hostView),sb(this.components,ne),ft?.unregisterApplication(_e)}),this._loadComponent(ne),ne}tick(){this._tick(!0)}_tick(l){if(this._runningTick)throw new Di(101,!1);const h=ie(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(l)}catch(y){this.internalErrorHandler(y)}finally{this._runningTick=!1,ie(h),this.afterTick.next()}}detectChangesInAttachedViews(l){let h=null;this._injector.destroyed||(h=this._injector.get(mp,null,{optional:!0}));let y=0;const C=this.afterRenderEffectManager;for(;y<10;){const A=0===y;if(l||!A){this.beforeRender.next(A);for(let{_lView:O,notifyErrorHandler:j}of this._views)MO(O,j,A,this.zonelessEnabled)}else h?.begin?.(),h?.end?.();if(y++,C.executeInternalCallbacks(),!this.allViews.some(({_lView:O})=>Jt(O))&&(C.execute(),!this.allViews.some(({_lView:O})=>Jt(O))))break}}attachView(l){const h=l;this._views.push(h),h.attachToAppRef(this)}detachView(l){const h=l;sb(this._views,h),h.detachFromAppRef()}_loadComponent(l){this.attachView(l.hostView),this.tick(),this.components.push(l);const h=this._injector.get(ob,[]);[...this._bootstrapListeners,...h].forEach(y=>y(l))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(l=>l()),this._views.slice().forEach(l=>l.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(l){return this._destroyListeners.push(l),()=>sb(this._destroyListeners,l)}destroy(){if(this._destroyed)throw new Di(406,!1);const l=this._injector;l.destroy&&!l.destroyed&&l.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(h){return new(h||i)};static#t=this.\u0275prov=zo({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function sb(i,o){const l=i.indexOf(o);l>-1&&i.splice(l,1)}function MO(i,o,l,h){(l||Jt(i))&&rf(i,o,l&&!h?0:1)}class SO{constructor(o,l){this.ngModuleFactory=o,this.componentFactories=l}}let AO=(()=>{class i{compileModuleSync(l){return new uE(l)}compileModuleAsync(l){return Promise.resolve(this.compileModuleSync(l))}compileModuleAndAllComponentsSync(l){const h=this.compileModuleSync(l),C=Ma(dr(l).declarations).reduce((A,O)=>{const j=un(O);return j&&A.push(new uf(j)),A},[]);return new SO(h,C)}compileModuleAndAllComponentsAsync(l){return Promise.resolve(this.compileModuleAndAllComponentsSync(l))}clearCache(){}clearCacheFor(l){}getModuleId(l){}static#e=this.\u0275fac=function(h){return new(h||i)};static#t=this.\u0275prov=zo({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),OO=(()=>{class i{constructor(){this.zone=gi(ws),this.changeDetectionScheduler=gi(dh),this.applicationRef=gi(Md)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(h){return new(h||i)};static#t=this.\u0275prov=zo({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function uC({ngZoneFactory:i,ignoreChangesOutsideZone:o}){return i??=()=>new ws(dC()),[{provide:ws,useFactory:i},{provide:Fa,multi:!0,useFactory:()=>{const l=gi(OO,{optional:!0});return()=>l.initialize()}},{provide:Fa,multi:!0,useFactory:()=>{const l=gi(FO);return()=>{l.initialize()}}},{provide:wg,useFactory:kO},!0===o?{provide:$v,useValue:!0}:[]]}function kO(){const i=gi(ws),o=gi(ec);return l=>i.runOutsideAngular(()=>o.handleError(l))}function dC(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:i?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:i?.runCoalescing??!1}}let FO=(()=>{class i{constructor(){this.subscription=new ui.yU,this.initialized=!1,this.zone=gi(ws),this.pendingTasks=gi(yc)}initialize(){if(this.initialized)return;this.initialized=!0;let l=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(l=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{ws.assertNotInAngularZone(),queueMicrotask(()=>{null!==l&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(l),l=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{ws.assertInAngularZone(),l??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static#e=this.\u0275fac=function(h){return new(h||i)};static#t=this.\u0275prov=zo({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),w0=(()=>{class i{constructor(){this.appRef=gi(Md),this.taskService=gi(yc),this.ngZone=gi(ws),this.zonelessEnabled=gi($m),this.disableScheduling=gi($v,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new ui.yU,this.cancelScheduledCallback=null,this.shouldRefreshViews=!1,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Yv||!this.zoneIsDefined)}notify(l){if(!this.zonelessEnabled&&5===l)return;switch(l){case 3:case 2:case 0:case 4:case 5:case 1:this.shouldRefreshViews=!0}if(!this.shouldScheduleTick())return;const h=this.useMicrotaskScheduler?Hm:Wv;this.pendingRenderTaskId=this.taskService.add(),this.zoneIsDefined?Zone.root.run(()=>{this.cancelScheduledCallback=h(()=>{this.tick(this.shouldRefreshViews)})}):this.cancelScheduledCallback=h(()=>{this.tick(this.shouldRefreshViews)})}shouldScheduleTick(){return!(this.disableScheduling||null!==this.pendingRenderTaskId||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&ws.isInAngularZone())}tick(l){if(this.runningTick||this.appRef.destroyed)return;const h=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick(l)},void 0,this.schedulerTickApplyArgs)}catch(y){throw this.taskService.remove(h),y}finally{this.cleanup()}this.useMicrotaskScheduler=!0,Hm(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(h)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.shouldRefreshViews=!1,this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,null!==this.pendingRenderTaskId){const l=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(l)}}static#e=this.\u0275fac=function(h){return new(h||i)};static#t=this.\u0275prov=zo({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();const lb=new Sr("",{providedIn:"root",factory:()=>gi(lb,qr.Optional|qr.SkipSelf)||function NO(){return typeof $localize<"u"&&$localize.locale||J_}()}),BO=new Sr("",{providedIn:"root",factory:()=>"USD"}),fC=new Sr("");let wS=(()=>{class i{constructor(l){this._injector=l,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(l,h){const y=function cf(i="zone.js",o){return"noop"===i?new Yv:"zone.js"===i?new ws(o):i}(h?.ngZone,dC({eventCoalescing:h?.ngZoneEventCoalescing,runCoalescing:h?.ngZoneRunCoalescing}));return y.run(()=>{const C=h?.ignoreChangesOutsideZone,A=function bA(i,o,l){return new cE(i,o,l)}(l.moduleType,this.injector,[...uC({ngZoneFactory:()=>y,ignoreChangesOutsideZone:C}),{provide:dh,useExisting:w0}]),O=A.injector.get(ec,null);return y.runOutsideAngular(()=>{const j=y.onError.subscribe({next:ne=>{O.handleError(ne)}});A.onDestroy(()=>{sb(this._modules,A),j.unsubscribe()})}),function gS(i,o,l){try{const h=l();return lC(h)?h.catch(y=>{throw o.runOutsideAngular(()=>i.handleError(y)),y}):h}catch(h){throw o.runOutsideAngular(()=>i.handleError(h)),h}}(O,y,()=>{const j=A.injector.get(cC);return j.runInitializers(),j.donePromise.then(()=>(function ID(i){"string"==typeof i&&(CD=i.toLowerCase().replace(/_/g,"-"))}(A.injector.get(lb,J_)||J_),this._moduleDoBootstrap(A),A))})})}bootstrapModule(l,h=[]){const y=_S({},h);return function RO(i,o,l){const h=new uE(l);return Promise.resolve(h)}(0,0,l).then(C=>this.bootstrapModuleFactory(C,y))}_moduleDoBootstrap(l){const h=l.injector.get(Md);if(l._bootstrapComponents.length>0)l._bootstrapComponents.forEach(y=>h.bootstrap(y));else{if(!l.instance.ngDoBootstrap)throw new Di(-403,!1);l.instance.ngDoBootstrap(h)}this._modules.push(l)}onDestroy(l){this._destroyListeners.push(l)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Di(404,!1);this._modules.slice().forEach(h=>h.destroy()),this._destroyListeners.forEach(h=>h());const l=this._injector.get(fC,null);l&&(l.forEach(h=>h()),l.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(h){return new(h||i)(Ar(Ys))};static#t=this.\u0275prov=zo({token:i,factory:i.\u0275fac,providedIn:"platform"})}return i})(),Cp=null;const ES=new Sr("");function CS(i,o,l=[]){const h=`Platform: ${o}`,y=new Sr(h);return(C=[])=>{let A=pC();if(!A||A.injector.get(ES,!1)){const O=[...l,...C,{provide:y,useValue:!0}];i?i(O):function UO(i){if(Cp&&!Cp.get(ES,!1))throw new Di(400,!1);(function mS(){!function at(i){Kn=i}(()=>{throw new Di(600,!1)})})(),Cp=i;const o=i.get(wS);(function TS(i){i.get(Z0,null)?.forEach(l=>l())})(i)}(function IS(i=[],o){return Ys.create({name:o,providers:[{provide:pu,useValue:"platform"},{provide:fC,useValue:new Set([()=>Cp=null])},...i]})}(O,h))}return function jO(i){const o=pC();if(!o)throw new Di(401,!1);return o}()}}function pC(){return Cp?.get(wS)??null}function $O(){}let MS=(()=>{class i{static#e=this.__NG_ELEMENT_ID__=GO}return i})();function GO(i){return function HO(i,o,l){if(I(i)&&!l){const h=Kr(i.index,o);return new Om(h,h)}return 175&i.type?new Om(o[fs],o):null}(is(),li(),!(16&~i))}class RS{constructor(){}supports(o){return Nx(o)}create(o){return new qO(o)}}const ZO=(i,o)=>o;class qO{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||ZO}forEachItem(o){let l;for(l=this._itHead;null!==l;l=l._next)o(l)}forEachOperation(o){let l=this._itHead,h=this._removalsHead,y=0,C=null;for(;l||h;){const A=!h||l&&l.currentIndex<LS(h,y,C)?l:h,O=LS(A,y,C),j=A.currentIndex;if(A===h)y--,h=h._nextRemoved;else if(l=l._next,null==A.previousIndex)y++;else{C||(C=[]);const ne=O-y,_e=j-y;if(ne!=_e){for(let Wt=0;Wt<ne;Wt++){const Zt=Wt<C.length?C[Wt]:C[Wt]=0,Tn=Zt+Wt;_e<=Tn&&Tn<ne&&(C[Wt]=Zt+1)}C[A.previousIndex]=_e-ne}}O!==j&&o(A,O,j)}}forEachPreviousItem(o){let l;for(l=this._previousItHead;null!==l;l=l._nextPrevious)o(l)}forEachAddedItem(o){let l;for(l=this._additionsHead;null!==l;l=l._nextAdded)o(l)}forEachMovedItem(o){let l;for(l=this._movesHead;null!==l;l=l._nextMoved)o(l)}forEachRemovedItem(o){let l;for(l=this._removalsHead;null!==l;l=l._nextRemoved)o(l)}forEachIdentityChange(o){let l;for(l=this._identityChangesHead;null!==l;l=l._nextIdentityChange)o(l)}diff(o){if(null==o&&(o=[]),!Nx(o))throw new Di(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let y,C,A,l=this._itHead,h=!1;if(Array.isArray(o)){this.length=o.length;for(let O=0;O<this.length;O++)C=o[O],A=this._trackByFn(O,C),null!==l&&Object.is(l.trackById,A)?(h&&(l=this._verifyReinsertion(l,C,A,O)),Object.is(l.item,C)||this._addIdentityChange(l,C)):(l=this._mismatch(l,C,A,O),h=!0),l=l._next}else y=0,function CA(i,o){if(Array.isArray(i))for(let l=0;l<i.length;l++)o(i[l]);else{const l=i[Symbol.iterator]();let h;for(;!(h=l.next()).done;)o(h.value)}}(o,O=>{A=this._trackByFn(y,O),null!==l&&Object.is(l.trackById,A)?(h&&(l=this._verifyReinsertion(l,O,A,y)),Object.is(l.item,O)||this._addIdentityChange(l,O)):(l=this._mismatch(l,O,A,y),h=!0),l=l._next,y++}),this.length=y;return this._truncate(l),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,l,h,y){let C;return null===o?C=this._itTail:(C=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null))?(Object.is(o.item,l)||this._addIdentityChange(o,l),this._reinsertAfter(o,C,y)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(h,y))?(Object.is(o.item,l)||this._addIdentityChange(o,l),this._moveAfter(o,C,y)):o=this._addAfter(new YO(l,h),C,y),o}_verifyReinsertion(o,l,h,y){let C=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null);return null!==C?o=this._reinsertAfter(C,o._prev,y):o.currentIndex!=y&&(o.currentIndex=y,this._addToMoves(o,y)),o}_truncate(o){for(;null!==o;){const l=o._next;this._addToRemovals(this._unlink(o)),o=l}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,l,h){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const y=o._prevRemoved,C=o._nextRemoved;return null===y?this._removalsHead=C:y._nextRemoved=C,null===C?this._removalsTail=y:C._prevRemoved=y,this._insertAfter(o,l,h),this._addToMoves(o,h),o}_moveAfter(o,l,h){return this._unlink(o),this._insertAfter(o,l,h),this._addToMoves(o,h),o}_addAfter(o,l,h){return this._insertAfter(o,l,h),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,l,h){const y=null===l?this._itHead:l._next;return o._next=y,o._prev=l,null===y?this._itTail=o:y._prev=o,null===l?this._itHead=o:l._next=o,null===this._linkedRecords&&(this._linkedRecords=new OS),this._linkedRecords.put(o),o.currentIndex=h,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const l=o._prev,h=o._next;return null===l?this._itHead=h:l._next=h,null===h?this._itTail=l:h._prev=l,o}_addToMoves(o,l){return o.previousIndex===l||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new OS),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,l){return o.item=l,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class YO{constructor(o,l){this.item=o,this.trackById=l,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class JO{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,l){let h;for(h=this._head;null!==h;h=h._nextDup)if((null===l||l<=h.currentIndex)&&Object.is(h.trackById,o))return h;return null}remove(o){const l=o._prevDup,h=o._nextDup;return null===l?this._head=h:l._nextDup=h,null===h?this._tail=l:h._prevDup=l,null===this._head}}class OS{constructor(){this.map=new Map}put(o){const l=o.trackById;let h=this.map.get(l);h||(h=new JO,this.map.set(l,h)),h.add(o)}get(o,l){const y=this.map.get(o);return y?y.get(o,l):null}remove(o){const l=o.trackById;return this.map.get(l).remove(o)&&this.map.delete(l),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function LS(i,o,l){const h=i.previousIndex;if(null===h)return h;let y=0;return l&&h<l.length&&(y=l[h]),h+o+y}class kS{constructor(){}supports(o){return o instanceof Map||hE(o)}create(){return new QO}}class QO{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let l;for(l=this._mapHead;null!==l;l=l._next)o(l)}forEachPreviousItem(o){let l;for(l=this._previousMapHead;null!==l;l=l._nextPrevious)o(l)}forEachChangedItem(o){let l;for(l=this._changesHead;null!==l;l=l._nextChanged)o(l)}forEachAddedItem(o){let l;for(l=this._additionsHead;null!==l;l=l._nextAdded)o(l)}forEachRemovedItem(o){let l;for(l=this._removalsHead;null!==l;l=l._nextRemoved)o(l)}diff(o){if(o){if(!(o instanceof Map||hE(o)))throw new Di(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let l=this._mapHead;if(this._appendAfter=null,this._forEach(o,(h,y)=>{if(l&&l.key===y)this._maybeAddToChanges(l,h),this._appendAfter=l,l=l._next;else{const C=this._getOrCreateRecordForKey(y,h);l=this._insertBeforeOrAppend(l,C)}}),l){l._prev&&(l._prev._next=null),this._removalsHead=l;for(let h=l;null!==h;h=h._nextRemoved)h===this._mapHead&&(this._mapHead=null),this._records.delete(h.key),h._nextRemoved=h._next,h.previousValue=h.currentValue,h.currentValue=null,h._prev=null,h._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,l){if(o){const h=o._prev;return l._next=o,l._prev=h,o._prev=l,h&&(h._next=l),o===this._mapHead&&(this._mapHead=l),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=l,l._prev=this._appendAfter):this._mapHead=l,this._appendAfter=l,null}_getOrCreateRecordForKey(o,l){if(this._records.has(o)){const y=this._records.get(o);this._maybeAddToChanges(y,l);const C=y._prev,A=y._next;return C&&(C._next=A),A&&(A._prev=C),y._next=null,y._prev=null,y}const h=new eL(o);return this._records.set(o,h),h.currentValue=l,this._addToAdditions(h),h}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,l){Object.is(l,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=l,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,l){o instanceof Map?o.forEach(l):Object.keys(o).forEach(h=>l(o[h],h))}}class eL{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function FS(){return new vC([new RS])}let vC=(()=>{class i{static#e=this.\u0275prov=zo({token:i,providedIn:"root",factory:FS});constructor(l){this.factories=l}static create(l,h){if(null!=h){const y=h.factories.slice();l=l.concat(y)}return new i(l)}static extend(l){return{provide:i,useFactory:h=>i.create(l,h||FS()),deps:[[i,new ts,new ds]]}}find(l){const h=this.factories.find(y=>y.supports(l));if(null!=h)return h;throw new Di(901,!1)}}return i})();function NS(){return new xC([new kS])}let xC=(()=>{class i{static#e=this.\u0275prov=zo({token:i,providedIn:"root",factory:NS});constructor(l){this.factories=l}static create(l,h){if(h){const y=h.factories.slice();l=l.concat(y)}return new i(l)}static extend(l){return{provide:i,useFactory:h=>i.create(l,h||NS()),deps:[[i,new ts,new ds]]}}find(l){const h=this.factories.find(y=>y.supports(l));if(h)return h;throw new Di(901,!1)}}return i})();const iL=CS(null,"core",[]);let rL=(()=>{class i{constructor(l){}static#e=this.\u0275fac=function(h){return new(h||i)(Ar(Md))};static#t=this.\u0275mod=X({type:i});static#n=this.\u0275inj=ya({})}return i})();const eA=new Sr("");function zL(i){return"boolean"==typeof i?i:null!=i&&"false"!==i}function jL(i,o){rl("NgSignals");const l=function ct(i){const o=Object.create(cn);o.computation=i;const l=()=>{if(je(o),re(o),o.value===Et)throw o.error;return o.value};return l[Z]=o,l}(i);return o?.equal&&(l[Z].equal=o.equal),l}function VL(i){const o=ie(null);try{return i()}finally{ie(o)}}function KL(i,o){const l=un(i),h=o.elementInjector||Hu();return new uf(l).create(h,o.projectableNodes,o.hostElement,o.environmentInjector)}function ZL(i){const o=un(i);if(!o)return null;const l=new uf(o);return{get selector(){return l.selector},get type(){return l.componentType},get inputs(){return l.inputs},get outputs(){return l.outputs},get ngContentSelectors(){return l.ngContentSelectors},get isStandalone(){return o.standalone},get isSignal(){return o.signals}}}},9417:(vi,Vt,B)=>{"use strict";B.d(Vt,{BC:()=>Ct,VZ:()=>ea,YN:()=>ta,cz:()=>be,kq:()=>De,vO:()=>nn,vS:()=>xr,zX:()=>Do});var g=B(3953),v=B(177),me=B(6648),a=B(7468),Z=B(1413),ie=B(6354);let T=(()=>{class se{constructor(q,rt){this._renderer=q,this._elementRef=rt,this.onChange=qt=>{},this.onTouched=()=>{}}setProperty(q,rt){this._renderer.setProperty(this._elementRef.nativeElement,q,rt)}registerOnTouched(q){this.onTouched=q}registerOnChange(q){this.onChange=q}setDisabledState(q){this.setProperty("disabled",q)}static#e=this.\u0275fac=function(rt){return new(rt||se)(g.rXU(g.sFG),g.rXU(g.aKT))};static#t=this.\u0275dir=g.FsC({type:se})}return se})(),Ce=(()=>{class se extends T{static#e=this.\u0275fac=(()=>{let q;return function(qt){return(q||(q=g.xGo(se)))(qt||se)}})();static#t=this.\u0275dir=g.FsC({type:se,features:[g.Vt3]})}return se})();const De=new g.nKC(""),ze={provide:De,useExisting:(0,g.Rfq)(()=>Ne),multi:!0},We=new g.nKC("");let Ne=(()=>{class se extends T{constructor(q,rt,qt){super(q,rt),this._compositionMode=qt,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function je(){const se=(0,v.QT)()?(0,v.QT)().getUserAgent():"";return/android (\d+)/.test(se.toLowerCase())}())}writeValue(q){this.setProperty("value",q??"")}_handleInput(q){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(q)}_compositionStart(){this._composing=!0}_compositionEnd(q){this._composing=!1,this._compositionMode&&this.onChange(q)}static#e=this.\u0275fac=function(rt){return new(rt||se)(g.rXU(g.sFG),g.rXU(g.aKT),g.rXU(We,8))};static#t=this.\u0275dir=g.FsC({type:se,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(rt,qt){1&rt&&g.bIt("input",function(Zr){return qt._handleInput(Zr.target.value)})("blur",function(){return qt.onTouched()})("compositionstart",function(){return qt._compositionStart()})("compositionend",function(Zr){return qt._compositionEnd(Zr.target.value)})},features:[g.Jv_([ze]),g.Vt3]})}return se})();function ht(se){return null==se||("string"==typeof se||Array.isArray(se))&&0===se.length}const be=new g.nKC(""),Ye=new g.nKC("");function Et(se){return null}function cn(se){return null!=se}function fn(se){return(0,g.jNT)(se)?(0,me.H)(se):se}function Kn(se){let ye={};return se.forEach(q=>{ye=null!=q?{...ye,...q}:ye}),0===Object.keys(ye).length?null:ye}function Kt(se,ye){return ye.map(q=>q(se))}function ve(se){return se.map(ye=>function at(se){return!se.validate}(ye)?ye:q=>ye.validate(q))}function fe(se){return null!=se?function Me(se){if(!se)return null;const ye=se.filter(cn);return 0==ye.length?null:function(q){return Kn(Kt(q,ye))}}(ve(se)):null}function _n(se){return null!=se?function vt(se){if(!se)return null;const ye=se.filter(cn);return 0==ye.length?null:function(q){const rt=Kt(q,ye).map(fn);return(0,a.p)(rt).pipe((0,ie.T)(Kn))}}(ve(se)):null}function Re(se,ye){return null===se?[ye]:Array.isArray(se)?[...se,ye]:[se,ye]}function tn(se){return se?Array.isArray(se)?se:[se]:[]}function bn(se,ye){return Array.isArray(se)?se.includes(ye):se===ye}function Jn(se,ye){const q=tn(ye);return tn(se).forEach(qt=>{bn(q,qt)||q.push(qt)}),q}function jn(se,ye){return tn(ye).filter(q=>!bn(se,q))}class _i{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(ye){this._rawValidators=ye||[],this._composedValidatorFn=fe(this._rawValidators)}_setAsyncValidators(ye){this._rawAsyncValidators=ye||[],this._composedAsyncValidatorFn=_n(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(ye){this._onDestroyCallbacks.push(ye)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(ye=>ye()),this._onDestroyCallbacks=[]}reset(ye=void 0){this.control&&this.control.reset(ye)}hasError(ye,q){return!!this.control&&this.control.hasError(ye,q)}getError(ye,q){return this.control?this.control.getError(ye,q):null}}class ut extends _i{get formDirective(){return null}get path(){return null}}class nn extends _i{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class ui{constructor(ye){this._cd=ye}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}}let Ct=(()=>{class se extends ui{constructor(q){super(q)}static#e=this.\u0275fac=function(rt){return new(rt||se)(g.rXU(nn,2))};static#t=this.\u0275dir=g.FsC({type:se,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(rt,qt){2&rt&&g.AVh("ng-untouched",qt.isUntouched)("ng-touched",qt.isTouched)("ng-pristine",qt.isPristine)("ng-dirty",qt.isDirty)("ng-valid",qt.isValid)("ng-invalid",qt.isInvalid)("ng-pending",qt.isPending)},features:[g.Vt3]})}return se})();const ao="VALID",ro="INVALID",co="PENDING",Po="DISABLED";class go{}class bo extends go{constructor(ye,q){super(),this.value=ye,this.source=q}}class Bn extends go{constructor(ye,q){super(),this.pristine=ye,this.source=q}}class Cn extends go{constructor(ye,q){super(),this.touched=ye,this.source=q}}class At extends go{constructor(ye,q){super(),this.status=ye,this.source=q}}function ki(se){return null!=se&&!Array.isArray(se)&&"object"==typeof se}class te{constructor(ye,q){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=(0,g.EWP)(()=>this.statusReactive()),this.statusReactive=(0,g.vPA)(void 0),this._pristine=(0,g.EWP)(()=>this.pristineReactive()),this.pristineReactive=(0,g.vPA)(!0),this._touched=(0,g.EWP)(()=>this.touchedReactive()),this.touchedReactive=(0,g.vPA)(!1),this._events=new Z.B,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(ye),this._assignAsyncValidators(q)}get validator(){return this._composedValidatorFn}set validator(ye){this._rawValidators=this._composedValidatorFn=ye}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(ye){this._rawAsyncValidators=this._composedAsyncValidatorFn=ye}get parent(){return this._parent}get status(){return(0,g.O8t)(this.statusReactive)}set status(ye){(0,g.O8t)(()=>this.statusReactive.set(ye))}get valid(){return this.status===ao}get invalid(){return this.status===ro}get pending(){return this.status==co}get disabled(){return this.status===Po}get enabled(){return this.status!==Po}get pristine(){return(0,g.O8t)(this.pristineReactive)}set pristine(ye){(0,g.O8t)(()=>this.pristineReactive.set(ye))}get dirty(){return!this.pristine}get touched(){return(0,g.O8t)(this.touchedReactive)}set touched(ye){(0,g.O8t)(()=>this.touchedReactive.set(ye))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(ye){this._assignValidators(ye)}setAsyncValidators(ye){this._assignAsyncValidators(ye)}addValidators(ye){this.setValidators(Jn(ye,this._rawValidators))}addAsyncValidators(ye){this.setAsyncValidators(Jn(ye,this._rawAsyncValidators))}removeValidators(ye){this.setValidators(jn(ye,this._rawValidators))}removeAsyncValidators(ye){this.setAsyncValidators(jn(ye,this._rawAsyncValidators))}hasValidator(ye){return bn(this._rawValidators,ye)}hasAsyncValidator(ye){return bn(this._rawAsyncValidators,ye)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(ye={}){const q=!1===this.touched;this.touched=!0;const rt=ye.sourceControl??this;this._parent&&!ye.onlySelf&&this._parent.markAsTouched({...ye,sourceControl:rt}),q&&!1!==ye.emitEvent&&this._events.next(new Cn(!0,rt))}markAllAsTouched(ye={}){this.markAsTouched({onlySelf:!0,emitEvent:ye.emitEvent,sourceControl:this}),this._forEachChild(q=>q.markAllAsTouched(ye))}markAsUntouched(ye={}){const q=!0===this.touched;this.touched=!1,this._pendingTouched=!1;const rt=ye.sourceControl??this;this._forEachChild(qt=>{qt.markAsUntouched({onlySelf:!0,emitEvent:ye.emitEvent,sourceControl:rt})}),this._parent&&!ye.onlySelf&&this._parent._updateTouched(ye,rt),q&&!1!==ye.emitEvent&&this._events.next(new Cn(!1,rt))}markAsDirty(ye={}){const q=!0===this.pristine;this.pristine=!1;const rt=ye.sourceControl??this;this._parent&&!ye.onlySelf&&this._parent.markAsDirty({...ye,sourceControl:rt}),q&&!1!==ye.emitEvent&&this._events.next(new Bn(!1,rt))}markAsPristine(ye={}){const q=!1===this.pristine;this.pristine=!0,this._pendingDirty=!1;const rt=ye.sourceControl??this;this._forEachChild(qt=>{qt.markAsPristine({onlySelf:!0,emitEvent:ye.emitEvent})}),this._parent&&!ye.onlySelf&&this._parent._updatePristine(ye,rt),q&&!1!==ye.emitEvent&&this._events.next(new Bn(!0,rt))}markAsPending(ye={}){this.status=co;const q=ye.sourceControl??this;!1!==ye.emitEvent&&(this._events.next(new At(this.status,q)),this.statusChanges.emit(this.status)),this._parent&&!ye.onlySelf&&this._parent.markAsPending({...ye,sourceControl:q})}disable(ye={}){const q=this._parentMarkedDirty(ye.onlySelf);this.status=Po,this.errors=null,this._forEachChild(qt=>{qt.disable({...ye,onlySelf:!0})}),this._updateValue();const rt=ye.sourceControl??this;!1!==ye.emitEvent&&(this._events.next(new bo(this.value,rt)),this._events.next(new At(this.status,rt)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...ye,skipPristineCheck:q},this),this._onDisabledChange.forEach(qt=>qt(!0))}enable(ye={}){const q=this._parentMarkedDirty(ye.onlySelf);this.status=ao,this._forEachChild(rt=>{rt.enable({...ye,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:ye.emitEvent}),this._updateAncestors({...ye,skipPristineCheck:q},this),this._onDisabledChange.forEach(rt=>rt(!1))}_updateAncestors(ye,q){this._parent&&!ye.onlySelf&&(this._parent.updateValueAndValidity(ye),ye.skipPristineCheck||this._parent._updatePristine({},q),this._parent._updateTouched({},q))}setParent(ye){this._parent=ye}getRawValue(){return this.value}updateValueAndValidity(ye={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){const rt=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ao||this.status===co)&&this._runAsyncValidator(rt,ye.emitEvent)}const q=ye.sourceControl??this;!1!==ye.emitEvent&&(this._events.next(new bo(this.value,q)),this._events.next(new At(this.status,q)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!ye.onlySelf&&this._parent.updateValueAndValidity({...ye,sourceControl:q})}_updateTreeValidity(ye={emitEvent:!0}){this._forEachChild(q=>q._updateTreeValidity(ye)),this.updateValueAndValidity({onlySelf:!0,emitEvent:ye.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Po:ao}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(ye,q){if(this.asyncValidator){this.status=co,this._hasOwnPendingAsyncValidator={emitEvent:!1!==q};const rt=fn(this.asyncValidator(this));this._asyncValidationSubscription=rt.subscribe(qt=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(qt,{emitEvent:q,shouldHaveEmitted:ye})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();const ye=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,ye}return!1}setErrors(ye,q={}){this.errors=ye,this._updateControlsErrors(!1!==q.emitEvent,this,q.shouldHaveEmitted)}get(ye){let q=ye;return null==q||(Array.isArray(q)||(q=q.split(".")),0===q.length)?null:q.reduce((rt,qt)=>rt&&rt._find(qt),this)}getError(ye,q){const rt=q?this.get(q):this;return rt&&rt.errors?rt.errors[ye]:null}hasError(ye,q){return!!this.getError(ye,q)}get root(){let ye=this;for(;ye._parent;)ye=ye._parent;return ye}_updateControlsErrors(ye,q,rt){this.status=this._calculateStatus(),ye&&this.statusChanges.emit(this.status),(ye||rt)&&this._events.next(new At(this.status,q)),this._parent&&this._parent._updateControlsErrors(ye,q,rt)}_initObservables(){this.valueChanges=new g.bkB,this.statusChanges=new g.bkB}_calculateStatus(){return this._allControlsDisabled()?Po:this.errors?ro:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(co)?co:this._anyControlsHaveStatus(ro)?ro:ao}_anyControlsHaveStatus(ye){return this._anyControls(q=>q.status===ye)}_anyControlsDirty(){return this._anyControls(ye=>ye.dirty)}_anyControlsTouched(){return this._anyControls(ye=>ye.touched)}_updatePristine(ye,q){const rt=!this._anyControlsDirty(),qt=this.pristine!==rt;this.pristine=rt,this._parent&&!ye.onlySelf&&this._parent._updatePristine(ye,q),qt&&this._events.next(new Bn(this.pristine,q))}_updateTouched(ye={},q){this.touched=this._anyControlsTouched(),this._events.next(new Cn(this.touched,q)),this._parent&&!ye.onlySelf&&this._parent._updateTouched(ye,q)}_registerOnCollectionChange(ye){this._onCollectionChange=ye}_setUpdateStrategy(ye){ki(ye)&&null!=ye.updateOn&&(this._updateOn=ye.updateOn)}_parentMarkedDirty(ye){return!ye&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(ye){return null}_assignValidators(ye){this._rawValidators=Array.isArray(ye)?ye.slice():ye,this._composedValidatorFn=function Ze(se){return Array.isArray(se)?fe(se):se||null}(this._rawValidators)}_assignAsyncValidators(ye){this._rawAsyncValidators=Array.isArray(ye)?ye.slice():ye,this._composedAsyncValidatorFn=function Dn(se){return Array.isArray(se)?_n(se):se||null}(this._rawAsyncValidators)}}const Ft=new g.nKC("CallSetDisabledState",{providedIn:"root",factory:()=>on}),on="always";function zn(se,ye,q=on){(function Ki(se,ye){const q=function wn(se){return se._rawValidators}(se);null!==ye.validator?se.setValidators(Re(q,ye.validator)):"function"==typeof q&&se.setValidators([q]);const rt=function it(se){return se._rawAsyncValidators}(se);null!==ye.asyncValidator?se.setAsyncValidators(Re(rt,ye.asyncValidator)):"function"==typeof rt&&se.setAsyncValidators([rt]);const qt=()=>se.updateValueAndValidity();Ui(ye._rawValidators,qt),Ui(ye._rawAsyncValidators,qt)})(se,ye),ye.valueAccessor.writeValue(se.value),(se.disabled||"always"===q)&&ye.valueAccessor.setDisabledState?.(se.disabled),function nr(se,ye){ye.valueAccessor.registerOnChange(q=>{se._pendingValue=q,se._pendingChange=!0,se._pendingDirty=!0,"change"===se.updateOn&&Be(se,ye)})}(se,ye),function we(se,ye){const q=(rt,qt)=>{ye.valueAccessor.writeValue(rt),qt&&ye.viewToModelUpdate(rt)};se.registerOnChange(q),ye._registerOnDestroy(()=>{se._unregisterOnChange(q)})}(se,ye),function lt(se,ye){ye.valueAccessor.registerOnTouched(()=>{se._pendingTouched=!0,"blur"===se.updateOn&&se._pendingChange&&Be(se,ye),"submit"!==se.updateOn&&se.markAsTouched()})}(se,ye),function qi(se,ye){if(ye.valueAccessor.setDisabledState){const q=rt=>{ye.valueAccessor.setDisabledState(rt)};se.registerOnDisabledChange(q),ye._registerOnDestroy(()=>{se._unregisterOnDisabledChange(q)})}}(se,ye)}function Ui(se,ye){se.forEach(q=>{q.registerOnValidatorChange&&q.registerOnValidatorChange(ye)})}function Be(se,ye){se._pendingDirty&&se.markAsDirty(),se.setValue(se._pendingValue,{emitModelToViewChange:!1}),ye.viewToModelUpdate(se._pendingValue),se._pendingChange=!1}function _o(se,ye){const q=se.indexOf(ye);q>-1&&se.splice(q,1)}function yo(se){return"object"==typeof se&&null!==se&&2===Object.keys(se).length&&"value"in se&&"disabled"in se}Promise.resolve();const Vr=class extends te{constructor(ye=null,q,rt){super(function On(se){return(ki(se)?se.validators:se)||null}(q),function Ln(se,ye){return(ki(ye)?ye.asyncValidators:se)||null}(rt,q)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(ye),this._setUpdateStrategy(q),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ki(q)&&(q.nonNullable||q.initialValueIsDefault)&&(this.defaultValue=yo(ye)?ye.value:ye)}setValue(ye,q={}){this.value=this._pendingValue=ye,this._onChange.length&&!1!==q.emitModelToViewChange&&this._onChange.forEach(rt=>rt(this.value,!1!==q.emitViewToModelChange)),this.updateValueAndValidity(q)}patchValue(ye,q={}){this.setValue(ye,q)}reset(ye=this.defaultValue,q={}){this._applyFormState(ye),this.markAsPristine(q),this.markAsUntouched(q),this.setValue(this.value,q),this._pendingChange=!1}_updateValue(){}_anyControls(ye){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(ye){this._onChange.push(ye)}_unregisterOnChange(ye){_o(this._onChange,ye)}registerOnDisabledChange(ye){this._onDisabledChange.push(ye)}_unregisterOnDisabledChange(ye){_o(this._onDisabledChange,ye)}_forEachChild(ye){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(ye){yo(ye)?(this.value=this._pendingValue=ye.value,ye.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=ye}},Fl={provide:nn,useExisting:(0,g.Rfq)(()=>xr)},ks=Promise.resolve();let xr=(()=>{class se extends nn{constructor(q,rt,qt,sr,Zr,as){super(),this._changeDetectorRef=Zr,this.callSetDisabledState=as,this.control=new Vr,this._registered=!1,this.name="",this.update=new g.bkB,this._parent=q,this._setValidators(rt),this._setAsyncValidators(qt),this.valueAccessor=function pi(se,ye){if(!ye)return null;let q,rt,qt;return Array.isArray(ye),ye.forEach(sr=>{sr.constructor===Ne?q=sr:function Ai(se){return Object.getPrototypeOf(se.constructor)===Ce}(sr)?rt=sr:qt=sr}),qt||rt||q||null}(0,sr)}ngOnChanges(q){if(this._checkForErrors(),!this._registered||"name"in q){if(this._registered&&(this._checkName(),this.formDirective)){const rt=q.name.previousValue;this.formDirective.removeControl({name:rt,path:this._getPath(rt)})}this._setUpControl()}"isDisabled"in q&&this._updateDisabled(q),function si(se,ye){if(!se.hasOwnProperty("model"))return!1;const q=se.model;return!!q.isFirstChange()||!Object.is(ye,q.currentValue)}(q,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(q){this.viewModel=q,this.update.emit(q)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){zn(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(q){ks.then(()=>{this.control.setValue(q,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(q){const rt=q.isDisabled.currentValue,qt=0!==rt&&(0,g.L39)(rt);ks.then(()=>{qt&&!this.control.disabled?this.control.disable():!qt&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(q){return this._parent?function Un(se,ye){return[...ye.path,se]}(q,this._parent):[q]}static#e=this.\u0275fac=function(rt){return new(rt||se)(g.rXU(ut,9),g.rXU(be,10),g.rXU(Ye,10),g.rXU(De,10),g.rXU(g.gRc,8),g.rXU(Ft,8))};static#t=this.\u0275dir=g.FsC({type:se,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[g.Jv_([Fl]),g.Vt3,g.OA$]})}return se})();function Oo(se){return"number"==typeof se?se:parseFloat(se)}let eo=(()=>{class se{constructor(){this._validator=Et}ngOnChanges(q){if(this.inputName in q){const rt=this.normalizeInput(q[this.inputName].currentValue);this._enabled=this.enabled(rt),this._validator=this._enabled?this.createValidator(rt):Et,this._onChange&&this._onChange()}}validate(q){return this._validator(q)}registerOnValidatorChange(q){this._onChange=q}enabled(q){return null!=q}static#e=this.\u0275fac=function(rt){return new(rt||se)};static#t=this.\u0275dir=g.FsC({type:se,features:[g.OA$]})}return se})();const ga={provide:be,useExisting:(0,g.Rfq)(()=>Do),multi:!0};let Do=(()=>{class se extends eo{constructor(){super(...arguments),this.inputName="max",this.normalizeInput=q=>Oo(q),this.createValidator=q=>function Ue(se){return ye=>{if(ht(ye.value)||ht(se))return null;const q=parseFloat(ye.value);return!isNaN(q)&&q>se?{max:{max:se,actual:ye.value}}:null}}(q)}static#e=this.\u0275fac=(()=>{let q;return function(qt){return(q||(q=g.xGo(se)))(qt||se)}})();static#t=this.\u0275dir=g.FsC({type:se,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(rt,qt){2&rt&&g.BMQ("max",qt._enabled?qt.max:null)},inputs:{max:"max"},features:[g.Jv_([ga]),g.Vt3]})}return se})();const Wr={provide:be,useExisting:(0,g.Rfq)(()=>ea),multi:!0};let ea=(()=>{class se extends eo{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=q=>Oo(q),this.createValidator=q=>function Ve(se){return ye=>{if(ht(ye.value)||ht(se))return null;const q=parseFloat(ye.value);return!isNaN(q)&&q<se?{min:{min:se,actual:ye.value}}:null}}(q)}static#e=this.\u0275fac=(()=>{let q;return function(qt){return(q||(q=g.xGo(se)))(qt||se)}})();static#t=this.\u0275dir=g.FsC({type:se,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(rt,qt){2&rt&&g.BMQ("min",qt._enabled?qt.min:null)},inputs:{min:"min"},features:[g.Jv_([Wr]),g.Vt3]})}return se})(),Bl=(()=>{class se{static#e=this.\u0275fac=function(rt){return new(rt||se)};static#t=this.\u0275mod=g.$C({type:se});static#n=this.\u0275inj=g.G2t({})}return se})(),ta=(()=>{class se{static withConfig(q){return{ngModule:se,providers:[{provide:Ft,useValue:q.callSetDisabledState??on}]}}static#e=this.\u0275fac=function(rt){return new(rt||se)};static#t=this.\u0275mod=g.$C({type:se});static#n=this.\u0275inj=g.G2t({imports:[Bl]})}return se})()},345:(vi,Vt,B)=>{"use strict";B.d(Vt,{Bb:()=>ui,hE:()=>Ct,sG:()=>jn});var g=B(177),v=B(3953);class me extends g.VF{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class a extends me{static makeCurrent(){(0,g.ZD)(new a)}onAndCancel(Cn,At,an){return Cn.addEventListener(At,an),()=>{Cn.removeEventListener(At,an)}}dispatchEvent(Cn,At){Cn.dispatchEvent(At)}remove(Cn){Cn.parentNode&&Cn.parentNode.removeChild(Cn)}createElement(Cn,At){return(At=At||this.getDefaultDocument()).createElement(Cn)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(Cn){return Cn.nodeType===Node.ELEMENT_NODE}isShadowRoot(Cn){return Cn instanceof DocumentFragment}getGlobalEventTarget(Cn,At){return"window"===At?window:"document"===At?Cn:"body"===At?Cn.body:null}getBaseHref(Cn){const At=function ie(){return Z=Z||document.querySelector("base"),Z?Z.getAttribute("href"):null}();return null==At?null:function T(Bn){return new URL(Bn,document.baseURI).pathname}(At)}resetBaseElement(){Z=null}getUserAgent(){return window.navigator.userAgent}getCookie(Cn){return(0,g._b)(document.cookie,Cn)}}let Z=null,De=(()=>{class Bn{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(an){return new(an||Bn)};static#t=this.\u0275prov=v.jDH({token:Bn,factory:Bn.\u0275fac})}return Bn})();const Je=new v.nKC("");let re=(()=>{class Bn{constructor(At,an){this._zone=an,this._eventNameToPlugin=new Map,At.forEach(pt=>{pt.manager=this}),this._plugins=At.slice().reverse()}addEventListener(At,an,pt){return this._findPluginFor(an).addEventListener(At,an,pt)}getZone(){return this._zone}_findPluginFor(At){let an=this._eventNameToPlugin.get(At);if(an)return an;if(an=this._plugins.find(On=>On.supports(At)),!an)throw new v.wOt(5101,!1);return this._eventNameToPlugin.set(At,an),an}static#e=this.\u0275fac=function(an){return new(an||Bn)(v.KVO(Je),v.KVO(v.SKi))};static#t=this.\u0275prov=v.jDH({token:Bn,factory:Bn.\u0275fac})}return Bn})();class ze{constructor(Cn){this._doc=Cn}}const je="ng-app-id";let We=(()=>{class Bn{constructor(At,an,pt,On={}){this.doc=At,this.appId=an,this.nonce=pt,this.platformId=On,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=(0,g.Vy)(On),this.resetHostNodes()}addStyles(At){for(const an of At)1===this.changeUsageCount(an,1)&&this.onStyleAdded(an)}removeStyles(At){for(const an of At)this.changeUsageCount(an,-1)<=0&&this.onStyleRemoved(an)}ngOnDestroy(){const At=this.styleNodesInDOM;At&&(At.forEach(an=>an.remove()),At.clear());for(const an of this.getAllStyles())this.onStyleRemoved(an);this.resetHostNodes()}addHost(At){this.hostNodes.add(At);for(const an of this.getAllStyles())this.addStyleToHost(At,an)}removeHost(At){this.hostNodes.delete(At)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(At){for(const an of this.hostNodes)this.addStyleToHost(an,At)}onStyleRemoved(At){const an=this.styleRef;an.get(At)?.elements?.forEach(pt=>pt.remove()),an.delete(At)}collectServerRenderedStyles(){const At=this.doc.head?.querySelectorAll(`style[${je}="${this.appId}"]`);if(At?.length){const an=new Map;return At.forEach(pt=>{null!=pt.textContent&&an.set(pt.textContent,pt)}),an}return null}changeUsageCount(At,an){const pt=this.styleRef;if(pt.has(At)){const On=pt.get(At);return On.usage+=an,On.usage}return pt.set(At,{usage:an,elements:[]}),an}getStyleElement(At,an){const pt=this.styleNodesInDOM,On=pt?.get(an);if(On?.parentNode===At)return pt.delete(an),On.removeAttribute(je),On;{const Ze=this.doc.createElement("style");return this.nonce&&Ze.setAttribute("nonce",this.nonce),Ze.textContent=an,this.platformIsServer&&Ze.setAttribute(je,this.appId),At.appendChild(Ze),Ze}}addStyleToHost(At,an){const pt=this.getStyleElement(At,an),On=this.styleRef,Ze=On.get(an)?.elements;Ze?Ze.push(pt):On.set(an,{elements:[pt],usage:1})}resetHostNodes(){const At=this.hostNodes;At.clear(),At.add(this.doc.head)}static#e=this.\u0275fac=function(an){return new(an||Bn)(v.KVO(g.qQ),v.KVO(v.sZ2),v.KVO(v.BIS,8),v.KVO(v.Agw))};static#t=this.\u0275prov=v.jDH({token:Bn,factory:Bn.\u0275fac})}return Bn})();const Ne={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},ht=/%COMP%/g,ot=new v.nKC("",{providedIn:"root",factory:()=>!0});function $t(Bn,Cn){return Cn.map(At=>At.replace(ht,Bn))}let nt=(()=>{class Bn{constructor(At,an,pt,On,Ze,Ln,Dn,ki=null){this.eventManager=At,this.sharedStylesHost=an,this.appId=pt,this.removeStylesOnCompDestroy=On,this.doc=Ze,this.platformId=Ln,this.ngZone=Dn,this.nonce=ki,this.rendererByCompId=new Map,this.platformIsServer=(0,g.Vy)(Ln),this.defaultRenderer=new xt(At,Ze,Dn,this.platformIsServer)}createRenderer(At,an){if(!At||!an)return this.defaultRenderer;this.platformIsServer&&an.encapsulation===v.gXe.ShadowDom&&(an={...an,encapsulation:v.gXe.Emulated});const pt=this.getOrCreateRenderer(At,an);return pt instanceof fn?pt.applyToHost(At):pt instanceof cn&&pt.applyStyles(),pt}getOrCreateRenderer(At,an){const pt=this.rendererByCompId;let On=pt.get(an.id);if(!On){const Ze=this.doc,Ln=this.ngZone,Dn=this.eventManager,ki=this.sharedStylesHost,Fi=this.removeStylesOnCompDestroy,wt=this.platformIsServer;switch(an.encapsulation){case v.gXe.Emulated:On=new fn(Dn,ki,an,this.appId,Fi,Ze,Ln,wt);break;case v.gXe.ShadowDom:return new Et(Dn,ki,At,an,Ze,Ln,this.nonce,wt);default:On=new cn(Dn,ki,an,Fi,Ze,Ln,wt)}pt.set(an.id,On)}return On}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(an){return new(an||Bn)(v.KVO(re),v.KVO(We),v.KVO(v.sZ2),v.KVO(ot),v.KVO(g.qQ),v.KVO(v.Agw),v.KVO(v.SKi),v.KVO(v.BIS))};static#t=this.\u0275prov=v.jDH({token:Bn,factory:Bn.\u0275fac})}return Bn})();class xt{constructor(Cn,At,an,pt){this.eventManager=Cn,this.doc=At,this.ngZone=an,this.platformIsServer=pt,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(Cn,At){return At?this.doc.createElementNS(Ne[At]||At,Cn):this.doc.createElement(Cn)}createComment(Cn){return this.doc.createComment(Cn)}createText(Cn){return this.doc.createTextNode(Cn)}appendChild(Cn,At){($e(Cn)?Cn.content:Cn).appendChild(At)}insertBefore(Cn,At,an){Cn&&($e(Cn)?Cn.content:Cn).insertBefore(At,an)}removeChild(Cn,At){Cn&&Cn.removeChild(At)}selectRootElement(Cn,At){let an="string"==typeof Cn?this.doc.querySelector(Cn):Cn;if(!an)throw new v.wOt(-5104,!1);return At||(an.textContent=""),an}parentNode(Cn){return Cn.parentNode}nextSibling(Cn){return Cn.nextSibling}setAttribute(Cn,At,an,pt){if(pt){At=pt+":"+At;const On=Ne[pt];On?Cn.setAttributeNS(On,At,an):Cn.setAttribute(At,an)}else Cn.setAttribute(At,an)}removeAttribute(Cn,At,an){if(an){const pt=Ne[an];pt?Cn.removeAttributeNS(pt,At):Cn.removeAttribute(`${an}:${At}`)}else Cn.removeAttribute(At)}addClass(Cn,At){Cn.classList.add(At)}removeClass(Cn,At){Cn.classList.remove(At)}setStyle(Cn,At,an,pt){pt&(v.czy.DashCase|v.czy.Important)?Cn.style.setProperty(At,an,pt&v.czy.Important?"important":""):Cn.style[At]=an}removeStyle(Cn,At,an){an&v.czy.DashCase?Cn.style.removeProperty(At):Cn.style[At]=""}setProperty(Cn,At,an){null!=Cn&&(Cn[At]=an)}setValue(Cn,At){Cn.nodeValue=At}listen(Cn,At,an){if("string"==typeof Cn&&!(Cn=(0,g.QT)().getGlobalEventTarget(this.doc,Cn)))throw new Error(`Unsupported event target ${Cn} for event ${At}`);return this.eventManager.addEventListener(Cn,At,this.decoratePreventDefault(an))}decoratePreventDefault(Cn){return At=>{if("__ngUnwrap__"===At)return Cn;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>Cn(At)):Cn(At))&&At.preventDefault()}}}function $e(Bn){return"TEMPLATE"===Bn.tagName&&void 0!==Bn.content}class Et extends xt{constructor(Cn,At,an,pt,On,Ze,Ln,Dn){super(Cn,On,Ze,Dn),this.sharedStylesHost=At,this.hostEl=an,this.shadowRoot=an.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const ki=$t(pt.id,pt.styles);for(const Fi of ki){const wt=document.createElement("style");Ln&&wt.setAttribute("nonce",Ln),wt.textContent=Fi,this.shadowRoot.appendChild(wt)}}nodeOrShadowRoot(Cn){return Cn===this.hostEl?this.shadowRoot:Cn}appendChild(Cn,At){return super.appendChild(this.nodeOrShadowRoot(Cn),At)}insertBefore(Cn,At,an){return super.insertBefore(this.nodeOrShadowRoot(Cn),At,an)}removeChild(Cn,At){return super.removeChild(this.nodeOrShadowRoot(Cn),At)}parentNode(Cn){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(Cn)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class cn extends xt{constructor(Cn,At,an,pt,On,Ze,Ln,Dn){super(Cn,On,Ze,Ln),this.sharedStylesHost=At,this.removeStylesOnCompDestroy=pt,this.styles=Dn?$t(Dn,an.styles):an.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class fn extends cn{constructor(Cn,At,an,pt,On,Ze,Ln,Dn){const ki=pt+"-"+an.id;super(Cn,At,an,On,Ze,Ln,Dn,ki),this.contentAttr=function Ve(Bn){return"_ngcontent-%COMP%".replace(ht,Bn)}(ki),this.hostAttr=function Ue(Bn){return"_nghost-%COMP%".replace(ht,Bn)}(ki)}applyToHost(Cn){this.applyStyles(),this.setAttribute(Cn,this.hostAttr,"")}createElement(Cn,At){const an=super.createElement(Cn,At);return super.setAttribute(an,this.contentAttr,""),an}}let Kn=(()=>{class Bn extends ze{constructor(At){super(At)}supports(At){return!0}addEventListener(At,an,pt){return At.addEventListener(an,pt,!1),()=>this.removeEventListener(At,an,pt)}removeEventListener(At,an,pt){return At.removeEventListener(an,pt)}static#e=this.\u0275fac=function(an){return new(an||Bn)(v.KVO(g.qQ))};static#t=this.\u0275prov=v.jDH({token:Bn,factory:Bn.\u0275fac})}return Bn})(),Kt=(()=>{class Bn extends ze{constructor(At){super(At),this.delegate=(0,v.WQX)(v.zAP,{optional:!0})}supports(At){return!!this.delegate&&this.delegate.supports(At)}addEventListener(At,an,pt){return this.delegate.addEventListener(At,an,pt)}removeEventListener(At,an,pt){return this.delegate.removeEventListener(At,an,pt)}static#e=this.\u0275fac=function(an){return new(an||Bn)(v.KVO(g.qQ))};static#t=this.\u0275prov=v.jDH({token:Bn,factory:Bn.\u0275fac})}return Bn})();const at=["alt","control","meta","shift"],ve={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Me={alt:Bn=>Bn.altKey,control:Bn=>Bn.ctrlKey,meta:Bn=>Bn.metaKey,shift:Bn=>Bn.shiftKey};let fe=(()=>{class Bn extends ze{constructor(At){super(At)}supports(At){return null!=Bn.parseEventName(At)}addEventListener(At,an,pt){const On=Bn.parseEventName(an),Ze=Bn.eventCallback(On.fullKey,pt,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,g.QT)().onAndCancel(At,On.domEventName,Ze))}static parseEventName(At){const an=At.toLowerCase().split("."),pt=an.shift();if(0===an.length||"keydown"!==pt&&"keyup"!==pt)return null;const On=Bn._normalizeKey(an.pop());let Ze="",Ln=an.indexOf("code");if(Ln>-1&&(an.splice(Ln,1),Ze="code."),at.forEach(ki=>{const Fi=an.indexOf(ki);Fi>-1&&(an.splice(Fi,1),Ze+=ki+".")}),Ze+=On,0!=an.length||0===On.length)return null;const Dn={};return Dn.domEventName=pt,Dn.fullKey=Ze,Dn}static matchEventFullKeyCode(At,an){let pt=ve[At.key]||At.key,On="";return an.indexOf("code.")>-1&&(pt=At.code,On="code."),!(null==pt||!pt)&&(pt=pt.toLowerCase()," "===pt?pt="space":"."===pt&&(pt="dot"),at.forEach(Ze=>{Ze!==pt&&(0,Me[Ze])(At)&&(On+=Ze+".")}),On+=pt,On===an)}static eventCallback(At,an,pt){return On=>{Bn.matchEventFullKeyCode(On,At)&&pt.runGuarded(()=>an(On))}}static _normalizeKey(At){return"esc"===At?"escape":At}static#e=this.\u0275fac=function(an){return new(an||Bn)(v.KVO(g.qQ))};static#t=this.\u0275prov=v.jDH({token:Bn,factory:Bn.\u0275fac})}return Bn})();const jn=(0,v.oH4)(v.fpN,"browser",[{provide:v.Agw,useValue:g.AJ},{provide:v.PLl,useValue:function it(){a.makeCurrent()},multi:!0},{provide:g.qQ,useFactory:function bn(){return(0,v.TL$)(document),document},deps:[]}]),_i=new v.nKC(""),ut=[{provide:v.e01,useClass:class Ce{addToWindow(Cn){v.JZv.getAngularTestability=(an,pt=!0)=>{const On=Cn.findTestabilityInTree(an,pt);if(null==On)throw new v.wOt(5103,!1);return On},v.JZv.getAllAngularTestabilities=()=>Cn.getAllTestabilities(),v.JZv.getAllAngularRootElements=()=>Cn.getAllRootElements(),v.JZv.frameworkStabilizers||(v.JZv.frameworkStabilizers=[]),v.JZv.frameworkStabilizers.push(an=>{const pt=v.JZv.getAllAngularTestabilities();let On=pt.length;const Ze=function(){On--,0==On&&an()};pt.forEach(Ln=>{Ln.whenStable(Ze)})})}findTestabilityInTree(Cn,At,an){return null==At?null:Cn.getTestability(At)??(an?(0,g.QT)().isShadowRoot(At)?this.findTestabilityInTree(Cn,At.host,!0):this.findTestabilityInTree(Cn,At.parentElement,!0):null)}},deps:[]},{provide:v.WHO,useClass:v.NYb,deps:[v.SKi,v.giA,v.e01]},{provide:v.NYb,useClass:v.NYb,deps:[v.SKi,v.giA,v.e01]}],nn=[{provide:v.H8p,useValue:"root"},{provide:v.zcH,useFactory:function tn(){return new v.zcH},deps:[]},{provide:Je,useClass:Kn,multi:!0,deps:[g.qQ,v.SKi,v.Agw]},{provide:Je,useClass:fe,multi:!0,deps:[g.qQ]},{provide:Je,useClass:Kt,multi:!0},nt,We,re,{provide:v._9s,useExisting:nt},{provide:g.N0,useClass:De,deps:[]},[]];let ui=(()=>{class Bn{constructor(At){}static withServerTransition(At){return{ngModule:Bn,providers:[{provide:v.sZ2,useValue:At.appId}]}}static#e=this.\u0275fac=function(an){return new(an||Bn)(v.KVO(_i,12))};static#t=this.\u0275mod=v.$C({type:Bn});static#n=this.\u0275inj=v.G2t({providers:[...nn,...ut],imports:[g.MD,v.Hbi]})}return Bn})(),Ct=(()=>{class Bn{constructor(At){this._doc=At}getTitle(){return this._doc.title}setTitle(At){this._doc.title=At||""}static#e=this.\u0275fac=function(an){return new(an||Bn)(v.KVO(g.qQ))};static#t=this.\u0275prov=v.jDH({token:Bn,factory:Bn.\u0275fac,providedIn:"root"})}return Bn})()},1470:(vi,Vt,B)=>{"use strict";B.d(Vt,{nX:()=>Vi,Zp:()=>Pt,Z:()=>Io,Xk:()=>ut,b:()=>gi,Ix:()=>ts,Wk:()=>Ja,iI:()=>kd,Sd:()=>ro});var g=B(3953),v=B(4402),me=B(6648),a=B(7673),Z=B(4412),ie=B(4572);const Ce=(0,B(1853).L)(k=>function(){k(this),this.name="EmptyError",this.message="no elements in sequence"});var De=B(8793),Je=B(9030),re=B(1203),ze=B(1985),je=B(8071);function We(k,W){const N=(0,je.T)(k)?k:()=>k,X=ce=>ce.error(N());return new ze.c(W?ce=>W.schedule(X,0,ce):X)}var Ne=B(983),ht=B(8359),He=B(9974),be=B(4360);function Ye(){return(0,He.N)((k,W)=>{let N=null;k._refCount++;const X=(0,be._)(W,void 0,void 0,void 0,()=>{if(!k||k._refCount<=0||0<--k._refCount)return void(N=null);const ce=k._connection,Xe=N;N=null,ce&&(!Xe||ce===Xe)&&ce.unsubscribe(),W.unsubscribe()});k.subscribe(X),X.closed||(N=k.connect())})}class Le extends ze.c{constructor(W,N){super(),this.source=W,this.subjectFactory=N,this._subject=null,this._refCount=0,this._connection=null,(0,He.S)(W)&&(this.lift=W.lift)}_subscribe(W){return this.getSubject().subscribe(W)}getSubject(){const W=this._subject;return(!W||W.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:W}=this;this._subject=this._connection=null,W?.unsubscribe()}connect(){let W=this._connection;if(!W){W=this._connection=new ht.yU;const N=this.getSubject();W.add(this.source.subscribe((0,be._)(N,void 0,()=>{this._teardown(),N.complete()},X=>{this._teardown(),N.error(X)},()=>this._teardown()))),W.closed&&(this._connection=null,W=ht.yU.EMPTY)}return W}refCount(){return Ye()(this)}}var ot=B(1413),Ve=B(177),Ue=B(6354),$t=B(5558),nt=B(6697),xt=B(3794),Mt=B(5964),$e=B(1397);function Et(k){return(0,He.N)((W,N)=>{let X=!1;W.subscribe((0,be._)(N,ce=>{X=!0,N.next(ce)},()=>{X||N.next(k),N.complete()}))})}function cn(k=fn){return(0,He.N)((W,N)=>{let X=!1;W.subscribe((0,be._)(N,ce=>{X=!0,N.next(ce)},()=>X?N.complete():N.error(k())))})}function fn(){return new Ce}var Kn=B(3669);function Kt(k,W){const N=arguments.length>=2;return X=>X.pipe(k?(0,Mt.p)((ce,Xe)=>k(ce,Xe,X)):Kn.D,(0,nt.s)(1),N?Et(W):cn(()=>new Ce))}var at=B(274);function ve(k,W,N){const X=(0,je.T)(k)||W||N?{next:k,error:W,complete:N}:k;return X?(0,He.N)((ce,Xe)=>{var Rt;null===(Rt=X.subscribe)||void 0===Rt||Rt.call(X);let un=!0;ce.subscribe((0,be._)(Xe,en=>{var wi;null===(wi=X.next)||void 0===wi||wi.call(X,en),Xe.next(en)},()=>{var en;un=!1,null===(en=X.complete)||void 0===en||en.call(X),Xe.complete()},en=>{var wi;un=!1,null===(wi=X.error)||void 0===wi||wi.call(X,en),Xe.error(en)},()=>{var en,wi;un&&(null===(en=X.unsubscribe)||void 0===en||en.call(X)),null===(wi=X.finalize)||void 0===wi||wi.call(X)}))}):Kn.D}var Me=B(8750);function fe(k){return(0,He.N)((W,N)=>{let Xe,X=null,ce=!1;X=W.subscribe((0,be._)(N,void 0,void 0,Rt=>{Xe=(0,Me.Tg)(k(Rt,fe(k)(W))),X?(X.unsubscribe(),X=null,Xe.subscribe(N)):ce=!0})),ce&&(X.unsubscribe(),X=null,Xe.subscribe(N))})}function Re(k){return k<=0?()=>Ne.w:(0,He.N)((W,N)=>{let X=[];W.subscribe((0,be._)(N,ce=>{X.push(ce),k<X.length&&X.shift()},()=>{for(const ce of X)N.next(ce);N.complete()},void 0,()=>{X=null}))})}var tn=B(980),bn=B(5343),jn=B(6365),_i=B(345);const ut="primary",nn=Symbol("RouteTitle");class ui{constructor(W){this.params=W||{}}has(W){return Object.prototype.hasOwnProperty.call(this.params,W)}get(W){if(this.has(W)){const N=this.params[W];return Array.isArray(N)?N[0]:N}return null}getAll(W){if(this.has(W)){const N=this.params[W];return Array.isArray(N)?N:[N]}return[]}get keys(){return Object.keys(this.params)}}function pn(k){return new ui(k)}function An(k,W,N){const X=N.path.split("/");if(X.length>k.length||"full"===N.pathMatch&&(W.hasChildren()||X.length<k.length))return null;const ce={};for(let Xe=0;Xe<X.length;Xe++){const Rt=X[Xe],un=k[Xe];if(":"===Rt[0])ce[Rt.substring(1)]=un;else if(Rt!==un.path)return null}return{consumed:k.slice(0,X.length),posParams:ce}}function Qt(k,W){const N=k?Se(k):void 0,X=W?Se(W):void 0;if(!N||!X||N.length!=X.length)return!1;let ce;for(let Xe=0;Xe<N.length;Xe++)if(ce=N[Xe],!Bt(k[ce],W[ce]))return!1;return!0}function Se(k){return[...Object.keys(k),...Object.getOwnPropertySymbols(k)]}function Bt(k,W){if(Array.isArray(k)&&Array.isArray(W)){if(k.length!==W.length)return!1;const N=[...k].sort(),X=[...W].sort();return N.every((ce,Xe)=>X[Xe]===ce)}return k===W}function Nt(k){return k.length>0?k[k.length-1]:null}function Rn(k){return(0,v.A)(k)?k:(0,g.jNT)(k)?(0,me.H)(Promise.resolve(k)):(0,a.of)(k)}const Ci={exact:function mo(k,W,N){if(!io(k.segments,W.segments)||!gn(k.segments,W.segments,N)||k.numberOfChildren!==W.numberOfChildren)return!1;for(const X in W.children)if(!k.children[X]||!mo(k.children[X],W.children[X],N))return!1;return!0},subset:$n},Oi={exact:function no(k,W){return Qt(k,W)},subset:function mr(k,W){return Object.keys(W).length<=Object.keys(k).length&&Object.keys(W).every(N=>Bt(k[N],W[N]))},ignored:()=>!0};function ei(k,W,N){return Ci[N.paths](k.root,W.root,N.matrixParams)&&Oi[N.queryParams](k.queryParams,W.queryParams)&&!("exact"===N.fragment&&k.fragment!==W.fragment)}function $n(k,W,N){return ar(k,W,W.segments,N)}function ar(k,W,N,X){if(k.segments.length>N.length){const ce=k.segments.slice(0,N.length);return!(!io(ce,N)||W.hasChildren()||!gn(ce,N,X))}if(k.segments.length===N.length){if(!io(k.segments,N)||!gn(k.segments,N,X))return!1;for(const ce in W.children)if(!k.children[ce]||!$n(k.children[ce],W.children[ce],X))return!1;return!0}{const ce=N.slice(0,k.segments.length),Xe=N.slice(k.segments.length);return!!(io(k.segments,ce)&&gn(k.segments,ce,X)&&k.children[ut])&&ar(k.children[ut],W,Xe,X)}}function gn(k,W,N){return W.every((X,ce)=>Oi[N](k[ce].parameters,X.parameters))}class ii{constructor(W=new oi([],{}),N={},X=null){this.root=W,this.queryParams=N,this.fragment=X}get queryParamMap(){return this._queryParamMap??=pn(this.queryParams),this._queryParamMap}toString(){return Po.serialize(this)}}class oi{constructor(W,N){this.segments=W,this.children=N,this.parent=null,Object.values(N).forEach(X=>X.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return go(this)}}class Yi{constructor(W,N){this.path=W,this.parameters=N}get parameterMap(){return this._parameterMap??=pn(this.parameters),this._parameterMap}toString(){return Ze(this)}}function io(k,W){return k.length===W.length&&k.every((N,X)=>N.path===W[X].path)}let ro=(()=>{class k{static#e=this.\u0275fac=function(X){return new(X||k)};static#t=this.\u0275prov=g.jDH({token:k,factory:()=>new co,providedIn:"root"})}return k})();class co{parse(W){const N=new jt(W);return new ii(N.parseRootSegment(),N.parseQueryParams(),N.parseFragment())}serialize(W){const N=`/${bo(W.root,!0)}`,X=function Dn(k){const W=Object.entries(k).map(([N,X])=>Array.isArray(X)?X.map(ce=>`${Cn(N)}=${Cn(ce)}`).join("&"):`${Cn(N)}=${Cn(X)}`).filter(N=>N);return W.length?`?${W.join("&")}`:""}(W.queryParams);return`${N}${X}${"string"==typeof W.fragment?`#${function At(k){return encodeURI(k)}(W.fragment)}`:""}`}}const Po=new co;function go(k){return k.segments.map(W=>Ze(W)).join("/")}function bo(k,W){if(!k.hasChildren())return go(k);if(W){const N=k.children[ut]?bo(k.children[ut],!1):"",X=[];return Object.entries(k.children).forEach(([ce,Xe])=>{ce!==ut&&X.push(`${ce}:${bo(Xe,!1)}`)}),X.length>0?`${N}(${X.join("//")})`:N}{const N=function ao(k,W){let N=[];return Object.entries(k.children).forEach(([X,ce])=>{X===ut&&(N=N.concat(W(ce,X)))}),Object.entries(k.children).forEach(([X,ce])=>{X!==ut&&(N=N.concat(W(ce,X)))}),N}(k,(X,ce)=>ce===ut?[bo(k.children[ut],!1)]:[`${ce}:${bo(X,!1)}`]);return 1===Object.keys(k.children).length&&null!=k.children[ut]?`${go(k)}/${N[0]}`:`${go(k)}/(${N.join("//")})`}}function Bn(k){return encodeURIComponent(k).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Cn(k){return Bn(k).replace(/%3B/gi,";")}function an(k){return Bn(k).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function pt(k){return decodeURIComponent(k)}function On(k){return pt(k.replace(/\+/g,"%20"))}function Ze(k){return`${an(k.path)}${function Ln(k){return Object.entries(k).map(([W,N])=>`;${an(W)}=${an(N)}`).join("")}(k.parameters)}`}const ki=/^[^\/()?;#]+/;function Fi(k){const W=k.match(ki);return W?W[0]:""}const wt=/^[^\/()?;=#]+/,ue=/^[^=?&#]+/,bt=/^[^&#]+/;class jt{constructor(W){this.url=W,this.remaining=W}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new oi([],{}):new oi([],this.parseChildren())}parseQueryParams(){const W={};if(this.consumeOptional("?"))do{this.parseQueryParam(W)}while(this.consumeOptional("&"));return W}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const W=[];for(this.peekStartsWith("(")||W.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),W.push(this.parseSegment());let N={};this.peekStartsWith("/(")&&(this.capture("/"),N=this.parseParens(!0));let X={};return this.peekStartsWith("(")&&(X=this.parseParens(!1)),(W.length>0||Object.keys(N).length>0)&&(X[ut]=new oi(W,N)),X}parseSegment(){const W=Fi(this.remaining);if(""===W&&this.peekStartsWith(";"))throw new g.wOt(4009,!1);return this.capture(W),new Yi(pt(W),this.parseMatrixParams())}parseMatrixParams(){const W={};for(;this.consumeOptional(";");)this.parseParam(W);return W}parseParam(W){const N=function te(k){const W=k.match(wt);return W?W[0]:""}(this.remaining);if(!N)return;this.capture(N);let X="";if(this.consumeOptional("=")){const ce=Fi(this.remaining);ce&&(X=ce,this.capture(X))}W[pt(N)]=pt(X)}parseQueryParam(W){const N=function Ge(k){const W=k.match(ue);return W?W[0]:""}(this.remaining);if(!N)return;this.capture(N);let X="";if(this.consumeOptional("=")){const Rt=function gt(k){const W=k.match(bt);return W?W[0]:""}(this.remaining);Rt&&(X=Rt,this.capture(X))}const ce=On(N),Xe=On(X);if(W.hasOwnProperty(ce)){let Rt=W[ce];Array.isArray(Rt)||(Rt=[Rt],W[ce]=Rt),Rt.push(Xe)}else W[ce]=Xe}parseParens(W){const N={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const X=Fi(this.remaining),ce=this.remaining[X.length];if("/"!==ce&&")"!==ce&&";"!==ce)throw new g.wOt(4010,!1);let Xe;X.indexOf(":")>-1?(Xe=X.slice(0,X.indexOf(":")),this.capture(Xe),this.capture(":")):W&&(Xe=ut);const Rt=this.parseChildren();N[Xe]=1===Object.keys(Rt).length?Rt[ut]:new oi([],Rt),this.consumeOptional("//")}return N}peekStartsWith(W){return this.remaining.startsWith(W)}consumeOptional(W){return!!this.peekStartsWith(W)&&(this.remaining=this.remaining.substring(W.length),!0)}capture(W){if(!this.consumeOptional(W))throw new g.wOt(4011,!1)}}function rn(k){return k.segments.length>0?new oi([],{[ut]:k}):k}function Ft(k){const W={};for(const[X,ce]of Object.entries(k.children)){const Xe=Ft(ce);if(X===ut&&0===Xe.segments.length&&Xe.hasChildren())for(const[Rt,un]of Object.entries(Xe.children))W[Rt]=un;else(Xe.segments.length>0||Xe.hasChildren())&&(W[X]=Xe)}return function on(k){if(1===k.numberOfChildren&&k.children[ut]){const W=k.children[ut];return new oi(k.segments.concat(W.segments),W.children)}return k}(new oi(k.segments,W))}function Un(k){return k instanceof ii}function Ei(k){let W;const ce=rn(function N(Xe){const Rt={};for(const en of Xe.children){const wi=N(en);Rt[en.outlet]=wi}const un=new oi(Xe.url,Rt);return Xe===k&&(W=un),un}(k.root));return W??ce}function Ui(k,W,N,X){let ce=k;for(;ce.parent;)ce=ce.parent;if(0===W.length)return Gi(ce,ce,ce,N,X);const Xe=function Be(k){if("string"==typeof k[0]&&1===k.length&&"/"===k[0])return new lt(!0,0,k);let W=0,N=!1;const X=k.reduce((ce,Xe,Rt)=>{if("object"==typeof Xe&&null!=Xe){if(Xe.outlets){const un={};return Object.entries(Xe.outlets).forEach(([en,wi])=>{un[en]="string"==typeof wi?wi.split("/"):wi}),[...ce,{outlets:un}]}if(Xe.segmentPath)return[...ce,Xe.segmentPath]}return"string"!=typeof Xe?[...ce,Xe]:0===Rt?(Xe.split("/").forEach((un,en)=>{0==en&&"."===un||(0==en&&""===un?N=!0:".."===un?W++:""!=un&&ce.push(un))}),ce):[...ce,Xe]},[]);return new lt(N,W,X)}(W);if(Xe.toRoot())return Gi(ce,ce,new oi([],{}),N,X);const Rt=function Fe(k,W,N){if(k.isAbsolute)return new we(W,!0,0);if(!N)return new we(W,!1,NaN);if(null===N.parent)return new we(N,!0,0);const X=qi(k.commands[0])?0:1;return function Gt(k,W,N){let X=k,ce=W,Xe=N;for(;Xe>ce;){if(Xe-=ce,X=X.parent,!X)throw new g.wOt(4005,!1);ce=X.segments.length}return new we(X,!1,ce-Xe)}(N,N.segments.length-1+X,k.numberOfDoubleDots)}(Xe,ce,k),un=Rt.processChildren?mt(Rt.segmentGroup,Rt.index,Xe.commands):Ie(Rt.segmentGroup,Rt.index,Xe.commands);return Gi(ce,Rt.segmentGroup,un,N,X)}function qi(k){return"object"==typeof k&&null!=k&&!k.outlets&&!k.segmentPath}function Ki(k){return"object"==typeof k&&null!=k&&k.outlets}function Gi(k,W,N,X,ce){let Rt,Xe={};X&&Object.entries(X).forEach(([en,wi])=>{Xe[en]=Array.isArray(wi)?wi.map(yr=>`${yr}`):`${wi}`}),Rt=k===W?N:nr(k,W,N);const un=rn(Ft(Rt));return new ii(un,Xe,ce)}function nr(k,W,N){const X={};return Object.entries(k.children).forEach(([ce,Xe])=>{X[ce]=Xe===W?N:nr(Xe,W,N)}),new oi(k.segments,X)}class lt{constructor(W,N,X){if(this.isAbsolute=W,this.numberOfDoubleDots=N,this.commands=X,W&&X.length>0&&qi(X[0]))throw new g.wOt(4003,!1);const ce=X.find(Ki);if(ce&&ce!==Nt(X))throw new g.wOt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class we{constructor(W,N,X){this.segmentGroup=W,this.processChildren=N,this.index=X}}function Ie(k,W,N){if(k??=new oi([],{}),0===k.segments.length&&k.hasChildren())return mt(k,W,N);const X=function Tt(k,W,N){let X=0,ce=W;const Xe={match:!1,pathIndex:0,commandIndex:0};for(;ce<k.segments.length;){if(X>=N.length)return Xe;const Rt=k.segments[ce],un=N[X];if(Ki(un))break;const en=`${un}`,wi=X<N.length-1?N[X+1]:null;if(ce>0&&void 0===en)break;if(en&&wi&&"object"==typeof wi&&void 0===wi.outlets){if(!Ri(en,wi,Rt))return Xe;X+=2}else{if(!Ri(en,{},Rt))return Xe;X++}ce++}return{match:!0,pathIndex:ce,commandIndex:X}}(k,W,N),ce=N.slice(X.commandIndex);if(X.match&&X.pathIndex<k.segments.length){const Xe=new oi(k.segments.slice(0,X.pathIndex),{});return Xe.children[ut]=new oi(k.segments.slice(X.pathIndex),k.children),mt(Xe,0,ce)}return X.match&&0===ce.length?new oi(k.segments,{}):X.match&&!k.hasChildren()?En(k,W,N):X.match?mt(k,0,ce):En(k,W,N)}function mt(k,W,N){if(0===N.length)return new oi(k.segments,{});{const X=function vn(k){return Ki(k[0])?k[0].outlets:{[ut]:k}}(N),ce={};if(Object.keys(X).some(Xe=>Xe!==ut)&&k.children[ut]&&1===k.numberOfChildren&&0===k.children[ut].segments.length){const Xe=mt(k.children[ut],W,N);return new oi(k.segments,Xe.children)}return Object.entries(X).forEach(([Xe,Rt])=>{"string"==typeof Rt&&(Rt=[Rt]),null!==Rt&&(ce[Xe]=Ie(k.children[Xe],W,Rt))}),Object.entries(k.children).forEach(([Xe,Rt])=>{void 0===X[Xe]&&(ce[Xe]=Rt)}),new oi(k.segments,ce)}}function En(k,W,N){const X=k.segments.slice(0,W);let ce=0;for(;ce<N.length;){const Xe=N[ce];if(Ki(Xe)){const en=si(Xe.outlets);return new oi(X,en)}if(0===ce&&qi(N[0])){X.push(new Yi(k.segments[W].path,Ai(N[0]))),ce++;continue}const Rt=Ki(Xe)?Xe.outlets[ut]:`${Xe}`,un=ce<N.length-1?N[ce+1]:null;Rt&&un&&qi(un)?(X.push(new Yi(Rt,Ai(un))),ce+=2):(X.push(new Yi(Rt,{})),ce++)}return new oi(X,{})}function si(k){const W={};return Object.entries(k).forEach(([N,X])=>{"string"==typeof X&&(X=[X]),null!==X&&(W[N]=En(new oi([],{}),0,X))}),W}function Ai(k){const W={};return Object.entries(k).forEach(([N,X])=>W[N]=`${X}`),W}function Ri(k,W,N){return k==N.path&&Qt(W,N.parameters)}const pi="imperative";var Ti=function(k){return k[k.NavigationStart=0]="NavigationStart",k[k.NavigationEnd=1]="NavigationEnd",k[k.NavigationCancel=2]="NavigationCancel",k[k.NavigationError=3]="NavigationError",k[k.RoutesRecognized=4]="RoutesRecognized",k[k.ResolveStart=5]="ResolveStart",k[k.ResolveEnd=6]="ResolveEnd",k[k.GuardsCheckStart=7]="GuardsCheckStart",k[k.GuardsCheckEnd=8]="GuardsCheckEnd",k[k.RouteConfigLoadStart=9]="RouteConfigLoadStart",k[k.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",k[k.ChildActivationStart=11]="ChildActivationStart",k[k.ChildActivationEnd=12]="ChildActivationEnd",k[k.ActivationStart=13]="ActivationStart",k[k.ActivationEnd=14]="ActivationEnd",k[k.Scroll=15]="Scroll",k[k.NavigationSkipped=16]="NavigationSkipped",k}(Ti||{});class vr{constructor(W,N){this.id=W,this.url=N}}class Io extends vr{constructor(W,N,X="imperative",ce=null){super(W,N),this.type=Ti.NavigationStart,this.navigationTrigger=X,this.restoredState=ce}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class gr extends vr{constructor(W,N,X){super(W,N),this.urlAfterRedirects=X,this.type=Ti.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var Nr=function(k){return k[k.Redirect=0]="Redirect",k[k.SupersededByNewNavigation=1]="SupersededByNewNavigation",k[k.NoDataFromResolver=2]="NoDataFromResolver",k[k.GuardRejected=3]="GuardRejected",k}(Nr||{}),_o=function(k){return k[k.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",k[k.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",k}(_o||{});class yo extends vr{constructor(W,N,X,ce){super(W,N),this.reason=X,this.code=ce,this.type=Ti.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Vr extends vr{constructor(W,N,X,ce){super(W,N),this.reason=X,this.code=ce,this.type=Ti.NavigationSkipped}}class uo extends vr{constructor(W,N,X,ce){super(W,N),this.error=X,this.target=ce,this.type=Ti.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class ko extends vr{constructor(W,N,X,ce){super(W,N),this.urlAfterRedirects=X,this.state=ce,this.type=Ti.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ls extends vr{constructor(W,N,X,ce){super(W,N),this.urlAfterRedirects=X,this.state=ce,this.type=Ti.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Gr extends vr{constructor(W,N,X,ce,Xe){super(W,N),this.urlAfterRedirects=X,this.state=ce,this.shouldActivate=Xe,this.type=Ti.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class xs extends vr{constructor(W,N,X,ce){super(W,N),this.urlAfterRedirects=X,this.state=ce,this.type=Ti.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Qs extends vr{constructor(W,N,X,ce){super(W,N),this.urlAfterRedirects=X,this.state=ce,this.type=Ti.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ss{constructor(W){this.route=W,this.type=Ti.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Sa{constructor(W){this.route=W,this.type=Ti.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class ma{constructor(W){this.snapshot=W,this.type=Ti.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Fl{constructor(W){this.snapshot=W,this.type=Ti.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ks{constructor(W){this.snapshot=W,this.type=Ti.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xr{constructor(W){this.snapshot=W,this.type=Ti.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Nl{constructor(W,N,X){this.routerEvent=W,this.position=N,this.anchor=X,this.type=Ti.Scroll}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class ol{}class Wa{constructor(W,N){this.url=W,this.navigationBehaviorOptions=N}}function Zi(k){return k.outlet||ut}function he(k){if(!k)return null;if(k.routeConfig?._injector)return k.routeConfig._injector;for(let W=k.parent;W;W=W.parent){const N=W.routeConfig;if(N?._loadedInjector)return N._loadedInjector;if(N?._injector)return N._injector}return null}class qe{get injector(){return he(this.route?.snapshot)??this.rootInjector}set injector(W){}constructor(W){this.rootInjector=W,this.outlet=null,this.route=null,this.children=new Pt(this.rootInjector),this.attachRef=null}}let Pt=(()=>{class k{constructor(N){this.rootInjector=N,this.contexts=new Map}onChildOutletCreated(N,X){const ce=this.getOrCreateContext(N);ce.outlet=X,this.contexts.set(N,ce)}onChildOutletDestroyed(N){const X=this.getContext(N);X&&(X.outlet=null,X.attachRef=null)}onOutletDeactivated(){const N=this.contexts;return this.contexts=new Map,N}onOutletReAttached(N){this.contexts=N}getOrCreateContext(N){let X=this.getContext(N);return X||(X=new qe(this.rootInjector),this.contexts.set(N,X)),X}getContext(N){return this.contexts.get(N)||null}static#e=this.\u0275fac=function(X){return new(X||k)(g.KVO(g.uvJ))};static#t=this.\u0275prov=g.jDH({token:k,factory:k.\u0275fac,providedIn:"root"})}return k})();class Ht{constructor(W){this._root=W}get root(){return this._root.value}parent(W){const N=this.pathFromRoot(W);return N.length>1?N[N.length-2]:null}children(W){const N=Ut(W,this._root);return N?N.children.map(X=>X.value):[]}firstChild(W){const N=Ut(W,this._root);return N&&N.children.length>0?N.children[0].value:null}siblings(W){const N=ln(W,this._root);return N.length<2?[]:N[N.length-2].children.map(ce=>ce.value).filter(ce=>ce!==W)}pathFromRoot(W){return ln(W,this._root).map(N=>N.value)}}function Ut(k,W){if(k===W.value)return W;for(const N of W.children){const X=Ut(k,N);if(X)return X}return null}function ln(k,W){if(k===W.value)return[W];for(const N of W.children){const X=ln(k,N);if(X.length)return X.unshift(W),X}return[]}class qn{constructor(W,N){this.value=W,this.children=N}toString(){return`TreeNode(${this.value})`}}function ti(k){const W={};return k&&k.children.forEach(N=>W[N.value.outlet]=N),W}class mi extends Ht{constructor(W,N){super(W),this.snapshot=N,Fo(this,W)}toString(){return this.snapshot.toString()}}function ai(k){const W=function Hi(k){const Xe=new ur([],{},{},"",{},ut,k,null,{});return new To("",new qn(Xe,[]))}(k),N=new Z.t([new Yi("",{})]),X=new Z.t({}),ce=new Z.t({}),Xe=new Z.t({}),Rt=new Z.t(""),un=new Vi(N,X,Xe,Rt,ce,ut,k,W.root);return un.snapshot=W.root,new mi(new qn(un,[]),W)}class Vi{constructor(W,N,X,ce,Xe,Rt,un,en){this.urlSubject=W,this.paramsSubject=N,this.queryParamsSubject=X,this.fragmentSubject=ce,this.dataSubject=Xe,this.outlet=Rt,this.component=un,this._futureSnapshot=en,this.title=this.dataSubject?.pipe((0,Ue.T)(wi=>wi[nn]))??(0,a.of)(void 0),this.url=W,this.params=N,this.queryParams=X,this.fragment=ce,this.data=Xe}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe((0,Ue.T)(W=>pn(W))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe((0,Ue.T)(W=>pn(W))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function er(k,W,N="emptyOnly"){let X;const{routeConfig:ce}=k;return X=null===W||"always"!==N&&""!==ce?.path&&(W.component||W.routeConfig?.loadComponent)?{params:{...k.params},data:{...k.data},resolve:{...k.data,...k._resolvedData??{}}}:{params:{...W.params,...k.params},data:{...W.data,...k.data},resolve:{...k.data,...W.data,...ce?.data,...k._resolvedData}},ce&&eo(ce)&&(X.resolve[nn]=ce.title),X}class ur{get title(){return this.data?.[nn]}constructor(W,N,X,ce,Xe,Rt,un,en,wi){this.url=W,this.params=N,this.queryParams=X,this.fragment=ce,this.data=Xe,this.outlet=Rt,this.component=un,this.routeConfig=en,this._resolve=wi}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=pn(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=pn(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(X=>X.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class To extends Ht{constructor(W,N){super(N),this.url=W,Fo(this,N)}toString(){return wo(this._root)}}function Fo(k,W){W.value._routerState=k,W.children.forEach(N=>Fo(k,N))}function wo(k){const W=k.children.length>0?` { ${k.children.map(wo).join(", ")} } `:"";return`${k.value}${W}`}function Di(k){if(k.snapshot){const W=k.snapshot,N=k._futureSnapshot;k.snapshot=N,Qt(W.queryParams,N.queryParams)||k.queryParamsSubject.next(N.queryParams),W.fragment!==N.fragment&&k.fragmentSubject.next(N.fragment),Qt(W.params,N.params)||k.paramsSubject.next(N.params),function Ct(k,W){if(k.length!==W.length)return!1;for(let N=0;N<k.length;++N)if(!Qt(k[N],W[N]))return!1;return!0}(W.url,N.url)||k.urlSubject.next(N.url),Qt(W.data,N.data)||k.dataSubject.next(N.data)}else k.snapshot=k._futureSnapshot,k.dataSubject.next(k._futureSnapshot.data)}function Oo(k,W){const N=Qt(k.params,W.params)&&function pr(k,W){return io(k,W)&&k.every((N,X)=>Qt(N.parameters,W[X].parameters))}(k.url,W.url);return N&&!(!k.parent!=!W.parent)&&(!k.parent||Oo(k.parent,W.parent))}function eo(k){return"string"==typeof k.title||null===k.title}let ga=(()=>{class k{constructor(){this.activated=null,this._activatedRoute=null,this.name=ut,this.activateEvents=new g.bkB,this.deactivateEvents=new g.bkB,this.attachEvents=new g.bkB,this.detachEvents=new g.bkB,this.parentContexts=(0,g.WQX)(Pt),this.location=(0,g.WQX)(g.c1b),this.changeDetector=(0,g.WQX)(g.gRc),this.inputBinder=(0,g.WQX)(Wr,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(N){if(N.name){const{firstChange:X,previousValue:ce}=N.name;if(X)return;this.isTrackedInParentContexts(ce)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(ce)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(N){return this.parentContexts.getContext(N)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const N=this.parentContexts.getContext(this.name);N?.route&&(N.attachRef?this.attach(N.attachRef,N.route):this.activateWith(N.route,N.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new g.wOt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new g.wOt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new g.wOt(4012,!1);this.location.detach();const N=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(N.instance),N}attach(N,X){this.activated=N,this._activatedRoute=X,this.location.insert(N.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(N.instance)}deactivate(){if(this.activated){const N=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(N)}}activateWith(N,X){if(this.isActivated)throw new g.wOt(4013,!1);this._activatedRoute=N;const ce=this.location,Rt=N.snapshot.component,un=this.parentContexts.getOrCreateContext(this.name).children,en=new Do(N,un,ce.injector);this.activated=ce.createComponent(Rt,{index:ce.length,injector:en,environmentInjector:X}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(X){return new(X||k)};static#t=this.\u0275dir=g.FsC({type:k,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[g.OA$]})}return k})();class Do{__ngOutletInjector(W){return new Do(this.route,this.childContexts,W)}constructor(W,N,X){this.route=W,this.childContexts=N,this.parent=X}get(W,N){return W===Vi?this.route:W===Pt?this.childContexts:this.parent.get(W,N)}}const Wr=new g.nKC("");let ea=(()=>{class k{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(N){this.unsubscribeFromRouteData(N),this.subscribeToRouteData(N)}unsubscribeFromRouteData(N){this.outletDataSubscriptions.get(N)?.unsubscribe(),this.outletDataSubscriptions.delete(N)}subscribeToRouteData(N){const{activatedRoute:X}=N,ce=(0,ie.z)([X.queryParams,X.params,X.data]).pipe((0,$t.n)(([Xe,Rt,un],en)=>(un={...Xe,...Rt,...un},0===en?(0,a.of)(un):Promise.resolve(un)))).subscribe(Xe=>{if(!N.isActivated||!N.activatedComponentRef||N.activatedRoute!==X||null===X.component)return void this.unsubscribeFromRouteData(N);const Rt=(0,g.HJs)(X.component);if(Rt)for(const{templateName:un}of Rt.inputs)N.activatedComponentRef.setInput(un,Xe[un]);else this.unsubscribeFromRouteData(N)});this.outletDataSubscriptions.set(N,ce)}static#e=this.\u0275fac=function(X){return new(X||k)};static#t=this.\u0275prov=g.jDH({token:k,factory:k.\u0275fac})}return k})();function Fs(k,W,N){if(N&&k.shouldReuseRoute(W.value,N.value.snapshot)){const X=N.value;X._futureSnapshot=W.value;const ce=function _a(k,W,N){return W.children.map(X=>{for(const ce of N.children)if(k.shouldReuseRoute(X.value,ce.value.snapshot))return Fs(k,X,ce);return Fs(k,X)})}(k,W,N);return new qn(X,ce)}{if(k.shouldAttach(W.value)){const Xe=k.retrieve(W.value);if(null!==Xe){const Rt=Xe.route;return Rt.value._futureSnapshot=W.value,Rt.children=W.children.map(un=>Fs(k,un)),Rt}}const X=function Xa(k){return new Vi(new Z.t(k.url),new Z.t(k.params),new Z.t(k.queryParams),new Z.t(k.fragment),new Z.t(k.data),k.outlet,k.component,k)}(W.value),ce=W.children.map(Xe=>Fs(k,Xe));return new qn(X,ce)}}class Aa{constructor(W,N){this.redirectTo=W,this.navigationBehaviorOptions=N}}const Ka="ngNavigationCancelingError";function Ns(k,W){const{redirectTo:N,navigationBehaviorOptions:X}=Un(W)?{redirectTo:W,navigationBehaviorOptions:void 0}:W,ce=Za(!1,Nr.Redirect);return ce.url=N,ce.navigationBehaviorOptions=X,ce}function Za(k,W){const N=new Error(`NavigationCancelingError: ${k||""}`);return N[Ka]=!0,N.cancellationCode=W,N}function qa(k){return!!k&&k[Ka]}class Fu{constructor(W,N,X,ce,Xe){this.routeReuseStrategy=W,this.futureState=N,this.currState=X,this.forwardEvent=ce,this.inputBindingEnabled=Xe}activate(W){const N=this.futureState._root,X=this.currState?this.currState._root:null;this.deactivateChildRoutes(N,X,W),Di(this.futureState.root),this.activateChildRoutes(N,X,W)}deactivateChildRoutes(W,N,X){const ce=ti(N);W.children.forEach(Xe=>{const Rt=Xe.value.outlet;this.deactivateRoutes(Xe,ce[Rt],X),delete ce[Rt]}),Object.values(ce).forEach(Xe=>{this.deactivateRouteAndItsChildren(Xe,X)})}deactivateRoutes(W,N,X){const ce=W.value,Xe=N?N.value:null;if(ce===Xe)if(ce.component){const Rt=X.getContext(ce.outlet);Rt&&this.deactivateChildRoutes(W,N,Rt.children)}else this.deactivateChildRoutes(W,N,X);else Xe&&this.deactivateRouteAndItsChildren(N,X)}deactivateRouteAndItsChildren(W,N){W.value.component&&this.routeReuseStrategy.shouldDetach(W.value.snapshot)?this.detachAndStoreRouteSubtree(W,N):this.deactivateRouteAndOutlet(W,N)}detachAndStoreRouteSubtree(W,N){const X=N.getContext(W.value.outlet),ce=X&&W.value.component?X.children:N,Xe=ti(W);for(const Rt of Object.values(Xe))this.deactivateRouteAndItsChildren(Rt,ce);if(X&&X.outlet){const Rt=X.outlet.detach(),un=X.children.onOutletDeactivated();this.routeReuseStrategy.store(W.value.snapshot,{componentRef:Rt,route:W,contexts:un})}}deactivateRouteAndOutlet(W,N){const X=N.getContext(W.value.outlet),ce=X&&W.value.component?X.children:N,Xe=ti(W);for(const Rt of Object.values(Xe))this.deactivateRouteAndItsChildren(Rt,ce);X&&(X.outlet&&(X.outlet.deactivate(),X.children.onOutletDeactivated()),X.attachRef=null,X.route=null)}activateChildRoutes(W,N,X){const ce=ti(N);W.children.forEach(Xe=>{this.activateRoutes(Xe,ce[Xe.value.outlet],X),this.forwardEvent(new xr(Xe.value.snapshot))}),W.children.length&&this.forwardEvent(new Fl(W.value.snapshot))}activateRoutes(W,N,X){const ce=W.value,Xe=N?N.value:null;if(Di(ce),ce===Xe)if(ce.component){const Rt=X.getOrCreateContext(ce.outlet);this.activateChildRoutes(W,N,Rt.children)}else this.activateChildRoutes(W,N,X);else if(ce.component){const Rt=X.getOrCreateContext(ce.outlet);if(this.routeReuseStrategy.shouldAttach(ce.snapshot)){const un=this.routeReuseStrategy.retrieve(ce.snapshot);this.routeReuseStrategy.store(ce.snapshot,null),Rt.children.onOutletReAttached(un.contexts),Rt.attachRef=un.componentRef,Rt.route=un.route.value,Rt.outlet&&Rt.outlet.attach(un.componentRef,un.route.value),Di(un.route.value),this.activateChildRoutes(W,null,Rt.children)}else Rt.attachRef=null,Rt.route=ce,Rt.outlet&&Rt.outlet.activateWith(ce,Rt.injector),this.activateChildRoutes(W,null,Rt.children)}else this.activateChildRoutes(W,null,X)}}class ss{constructor(W){this.path=W,this.route=this.path[this.path.length-1]}}class al{constructor(W,N){this.component=W,this.route=N}}function Bl(k,W,N){const X=k._root;return br(X,W?W._root:null,N,[X.value])}function Vo(k,W){const N=Symbol(),X=W.get(k,N);return X===N?"function"!=typeof k||(0,g.LfX)(k)?W.get(k):k:X}function br(k,W,N,X,ce={canDeactivateChecks:[],canActivateChecks:[]}){const Xe=ti(W);return k.children.forEach(Rt=>{(function oc(k,W,N,X,ce={canDeactivateChecks:[],canActivateChecks:[]}){const Xe=k.value,Rt=W?W.value:null,un=N?N.getContext(k.value.outlet):null;if(Rt&&Xe.routeConfig===Rt.routeConfig){const en=function Bs(k,W,N){if("function"==typeof N)return N(k,W);switch(N){case"pathParamsChange":return!io(k.url,W.url);case"pathParamsOrQueryParamsChange":return!io(k.url,W.url)||!Qt(k.queryParams,W.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Oo(k,W)||!Qt(k.queryParams,W.queryParams);default:return!Oo(k,W)}}(Rt,Xe,Xe.routeConfig.runGuardsAndResolvers);en?ce.canActivateChecks.push(new ss(X)):(Xe.data=Rt.data,Xe._resolvedData=Rt._resolvedData),br(k,W,Xe.component?un?un.children:null:N,X,ce),en&&un&&un.outlet&&un.outlet.isActivated&&ce.canDeactivateChecks.push(new al(un.outlet.component,Rt))}else Rt&&zl(W,un,ce),ce.canActivateChecks.push(new ss(X)),br(k,null,Xe.component?un?un.children:null:N,X,ce)})(Rt,Xe[Rt.value.outlet],N,X.concat([Rt.value]),ce),delete Xe[Rt.value.outlet]}),Object.entries(Xe).forEach(([Rt,un])=>zl(un,N.getContext(Rt),ce)),ce}function zl(k,W,N){const X=ti(k),ce=k.value;Object.entries(X).forEach(([Xe,Rt])=>{zl(Rt,ce.component?W?W.children.getContext(Xe):null:W,N)}),N.canDeactivateChecks.push(new al(ce.component&&W&&W.outlet&&W.outlet.isActivated?W.outlet.component:null,ce))}function Ul(k){return"function"==typeof k}function rt(k){return k instanceof Ce||"EmptyError"===k?.name}const qt=Symbol("INITIAL_VALUE");function sr(){return(0,$t.n)(k=>(0,ie.z)(k.map(W=>W.pipe((0,nt.s)(1),function ct(...k){const W=(0,xt.lI)(k);return(0,He.N)((N,X)=>{(W?(0,De.x)(k,N,W):(0,De.x)(k,N)).subscribe(X)})}(qt)))).pipe((0,Ue.T)(W=>{for(const N of W)if(!0!==N){if(N===qt)return qt;if(!1===N||Zr(N))return N}return!0}),(0,Mt.p)(W=>W!==qt),(0,nt.s)(1)))}function Zr(k){return Un(k)||k instanceof Aa}function ya(k){return(0,re.F)(ve(W=>{if("boolean"!=typeof W)throw Ns(0,W)}),(0,Ue.T)(W=>!0===W))}class iu{constructor(W){this.segmentGroup=W||null}}class El extends Error{constructor(W){super(),this.urlTree=W}}function ll(k){return We(new iu(k))}class Mc{constructor(W,N){this.urlSerializer=W,this.urlTree=N}lineralizeSegments(W,N){let X=[],ce=N.root;for(;;){if(X=X.concat(ce.segments),0===ce.numberOfChildren)return(0,a.of)(X);if(ce.numberOfChildren>1||!ce.children[ut])return We(new g.wOt(4e3,!1));ce=ce.children[ut]}}applyRedirectCommands(W,N,X,ce,Xe){if("string"!=typeof N){const un=N,{queryParams:en,fragment:wi,routeConfig:yr,url:dr,outlet:Ho,params:pl,data:ls,title:Hl}=ce,Na=(0,g.N4e)(Xe,()=>un({params:pl,data:ls,queryParams:en,fragment:wi,routeConfig:yr,url:dr,outlet:Ho,title:Hl}));if(Na instanceof ii)throw new El(Na);N=Na}const Rt=this.applyRedirectCreateUrlTree(N,this.urlSerializer.parse(N),W,X);if("/"===N[0])throw new El(Rt);return Rt}applyRedirectCreateUrlTree(W,N,X,ce){const Xe=this.createSegmentGroup(W,N.root,X,ce);return new ii(Xe,this.createQueryParams(N.queryParams,this.urlTree.queryParams),N.fragment)}createQueryParams(W,N){const X={};return Object.entries(W).forEach(([ce,Xe])=>{if("string"==typeof Xe&&":"===Xe[0]){const un=Xe.substring(1);X[ce]=N[un]}else X[ce]=Xe}),X}createSegmentGroup(W,N,X,ce){const Xe=this.createSegments(W,N.segments,X,ce);let Rt={};return Object.entries(N.children).forEach(([un,en])=>{Rt[un]=this.createSegmentGroup(W,en,X,ce)}),new oi(Xe,Rt)}createSegments(W,N,X,ce){return N.map(Xe=>":"===Xe.path[0]?this.findPosParam(W,Xe,ce):this.findOrReturn(Xe,X))}findPosParam(W,N,X){const ce=X[N.path.substring(1)];if(!ce)throw new g.wOt(4001,!1);return ce}findOrReturn(W,N){let X=0;for(const ce of N){if(ce.path===W.path)return N.splice(X),ce;X++}return W}}const Sc={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Sr(k,W,N,X,ce){const Xe=Il(k,W,N);return Xe.matched?(X=function Vs(k,W){return k.providers&&!k._injector&&(k._injector=(0,g.Ol2)(k.providers,W,`Route: ${k.path}`)),k._injector??W}(W,X),function va(k,W,N,X){const ce=W.canMatch;if(!ce||0===ce.length)return(0,a.of)(!0);const Xe=ce.map(Rt=>{const un=Vo(Rt,k);return Rn(function q(k){return k&&Ul(k.canMatch)}(un)?un.canMatch(W,N):(0,g.N4e)(k,()=>un(W,N)))});return(0,a.of)(Xe).pipe(sr(),ya())}(X,W,N).pipe((0,Ue.T)(Rt=>!0===Rt?Xe:{...Sc}))):(0,a.of)(Xe)}function Il(k,W,N){if("**"===W.path)return function ac(k){return{matched:!0,parameters:k.length>0?Nt(k).parameters:{},consumedSegments:k,remainingSegments:[],positionalParamSegments:{}}}(N);if(""===W.path)return"full"===W.pathMatch&&(k.hasChildren()||N.length>0)?{...Sc}:{matched:!0,consumedSegments:[],remainingSegments:N,parameters:{},positionalParamSegments:{}};const ce=(W.matcher||An)(N,k,W);if(!ce)return{...Sc};const Xe={};Object.entries(ce.posParams??{}).forEach(([un,en])=>{Xe[un]=en.path});const Rt=ce.consumed.length>0?{...Xe,...ce.consumed[ce.consumed.length-1].parameters}:Xe;return{matched:!0,consumedSegments:ce.consumed,remainingSegments:N.slice(ce.consumed.length),parameters:Rt,positionalParamSegments:ce.posParams??{}}}function Pa(k,W,N,X){return N.length>0&&function ru(k,W,N){return N.some(X=>Ac(k,W,X)&&Zi(X)!==ut)}(k,N,X)?{segmentGroup:new oi(W,yh(X,new oi(N,k.children))),slicedSegments:[]}:0===N.length&&function gf(k,W,N){return N.some(X=>Ac(k,W,X))}(k,N,X)?{segmentGroup:new oi(k.segments,Ad(k,N,X,k.children)),slicedSegments:N}:{segmentGroup:new oi(k.segments,k.children),slicedSegments:N}}function Ad(k,W,N,X){const ce={};for(const Xe of N)if(Ac(k,W,Xe)&&!X[Zi(Xe)]){const Rt=new oi([],{});ce[Zi(Xe)]=Rt}return{...X,...ce}}function yh(k,W){const N={};N[ut]=W;for(const X of k)if(""===X.path&&Zi(X)!==ut){const ce=new oi([],{});N[Zi(X)]=ce}return N}function Ac(k,W,N){return(!(k.hasChildren()||W.length>0)||"full"!==N.pathMatch)&&""===N.path}class Tl{}class Uu{constructor(W,N,X,ce,Xe,Rt,un){this.injector=W,this.configLoader=N,this.rootComponentType=X,this.config=ce,this.urlTree=Xe,this.paramsInheritanceStrategy=Rt,this.urlSerializer=un,this.applyRedirects=new Mc(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(W){return new g.wOt(4002,`'${W.segmentGroup}'`)}recognize(){const W=Pa(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(W).pipe((0,Ue.T)(({children:N,rootSnapshot:X})=>{const ce=new qn(X,N),Xe=new To("",ce),Rt=function zn(k,W,N=null,X=null){return Ui(Ei(k),W,N,X)}(X,[],this.urlTree.queryParams,this.urlTree.fragment);return Rt.queryParams=this.urlTree.queryParams,Xe.url=this.urlSerializer.serialize(Rt),{state:Xe,tree:Rt}}))}match(W){const N=new ur([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Object.freeze({}),ut,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,W,ut,N).pipe((0,Ue.T)(X=>({children:X,rootSnapshot:N})),fe(X=>{if(X instanceof El)return this.urlTree=X.urlTree,this.match(X.urlTree.root);throw X instanceof iu?this.noMatchError(X):X}))}processSegmentGroup(W,N,X,ce,Xe){return 0===X.segments.length&&X.hasChildren()?this.processChildren(W,N,X,Xe):this.processSegment(W,N,X,X.segments,ce,!0,Xe).pipe((0,Ue.T)(Rt=>Rt instanceof qn?[Rt]:[]))}processChildren(W,N,X,ce){const Xe=[];for(const Rt of Object.keys(X.children))"primary"===Rt?Xe.unshift(Rt):Xe.push(Rt);return(0,me.H)(Xe).pipe((0,at.H)(Rt=>{const un=X.children[Rt],en=function Ro(k,W){const N=k.filter(X=>Zi(X)===W);return N.push(...k.filter(X=>Zi(X)!==W)),N}(N,Rt);return this.processSegmentGroup(W,en,un,Rt,ce)}),function _n(k,W){return(0,He.N)(function vt(k,W,N,X,ce){return(Xe,Rt)=>{let un=N,en=W,wi=0;Xe.subscribe((0,be._)(Rt,yr=>{const dr=wi++;en=un?k(en,yr,dr):(un=!0,yr),X&&Rt.next(en)},ce&&(()=>{un&&Rt.next(en),Rt.complete()})))}}(k,W,arguments.length>=2,!0))}((Rt,un)=>(Rt.push(...un),Rt)),Et(null),function wn(k,W){const N=arguments.length>=2;return X=>X.pipe(k?(0,Mt.p)((ce,Xe)=>k(ce,Xe,X)):Kn.D,Re(1),N?Et(W):cn(()=>new Ce))}(),(0,$e.Z)(Rt=>{if(null===Rt)return ll(X);const un=ul(Rt);return function su(k){k.sort((W,N)=>W.value.outlet===ut?-1:N.value.outlet===ut?1:W.value.outlet.localeCompare(N.value.outlet))}(un),(0,a.of)(un)}))}processSegment(W,N,X,ce,Xe,Rt,un){return(0,me.H)(N).pipe((0,at.H)(en=>this.processSegmentAgainstRoute(en._injector??W,N,en,X,ce,Xe,Rt,un).pipe(fe(wi=>{if(wi instanceof iu)return(0,a.of)(null);throw wi}))),Kt(en=>!!en),fe(en=>{if(rt(en))return function _f(k,W,N){return 0===W.length&&!k.children[N]}(X,ce,Xe)?(0,a.of)(new Tl):ll(X);throw en}))}processSegmentAgainstRoute(W,N,X,ce,Xe,Rt,un,en){return function ou(k,W,N,X){return!!(Zi(k)===X||X!==ut&&Ac(W,N,k))&&Il(W,k,N).matched}(X,ce,Xe,Rt)?void 0===X.redirectTo?this.matchSegmentAgainstRoute(W,ce,X,Xe,Rt,en):this.allowRedirects&&un?this.expandSegmentAgainstRouteUsingRedirect(W,ce,N,X,Xe,Rt,en):ll(ce):ll(ce)}expandSegmentAgainstRouteUsingRedirect(W,N,X,ce,Xe,Rt,un){const{matched:en,parameters:wi,consumedSegments:yr,positionalParamSegments:dr,remainingSegments:Ho}=Il(N,ce,Xe);if(!en)return ll(N);"string"==typeof ce.redirectTo&&"/"===ce.redirectTo[0]&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const pl=new ur(Xe,wi,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,wr(ce),Zi(ce),ce.component??ce._loadedComponent??null,ce,So(ce)),ls=er(pl,un,this.paramsInheritanceStrategy);pl.params=Object.freeze(ls.params),pl.data=Object.freeze(ls.data);const Hl=this.applyRedirects.applyRedirectCommands(yr,ce.redirectTo,dr,pl,W);return this.applyRedirects.lineralizeSegments(ce,Hl).pipe((0,$e.Z)(Na=>this.processSegment(W,X,N,Na.concat(Ho),Rt,!1,un)))}matchSegmentAgainstRoute(W,N,X,ce,Xe,Rt){const un=Sr(N,X,ce,W);return"**"===X.path&&(N.children={}),un.pipe((0,$t.n)(en=>en.matched?this.getChildConfig(W=X._injector??W,X,ce).pipe((0,$t.n)(({routes:wi})=>{const yr=X._loadedInjector??W,{parameters:dr,consumedSegments:Ho,remainingSegments:pl}=en,ls=new ur(Ho,dr,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,wr(X),Zi(X),X.component??X._loadedComponent??null,X,So(X)),Hl=er(ls,Rt,this.paramsInheritanceStrategy);ls.params=Object.freeze(Hl.params),ls.data=Object.freeze(Hl.data);const{segmentGroup:Na,slicedSegments:Ml}=Pa(N,Ho,pl,wi);if(0===Ml.length&&Na.hasChildren())return this.processChildren(yr,wi,Na,ls).pipe((0,Ue.T)(ia=>new qn(ls,ia)));if(0===wi.length&&0===Ml.length)return(0,a.of)(new qn(ls,[]));const bf=Zi(X)===Xe;return this.processSegment(yr,wi,Na,Ml,bf?ut:Xe,!0,ls).pipe((0,Ue.T)(ia=>new qn(ls,ia instanceof qn?[ia]:[])))})):ll(N)))}getChildConfig(W,N,X){return N.children?(0,a.of)({routes:N.children,injector:W}):N.loadChildren?void 0!==N._loadedRoutes?(0,a.of)({routes:N._loadedRoutes,injector:N._loadedInjector}):function nu(k,W,N,X){const ce=W.canLoad;if(void 0===ce||0===ce.length)return(0,a.of)(!0);const Xe=ce.map(Rt=>{const un=Vo(Rt,k);return Rn(function ta(k){return k&&Ul(k.canLoad)}(un)?un.canLoad(W,N):(0,g.N4e)(k,()=>un(W,N)))});return(0,a.of)(Xe).pipe(sr(),ya())}(W,N,X).pipe((0,$e.Z)(ce=>ce?this.configLoader.loadChildren(W,N).pipe(ve(Xe=>{N._loadedRoutes=Xe.routes,N._loadedInjector=Xe.injector})):function Cl(k){return We(Za(!1,Nr.GuardRejected))}())):(0,a.of)({routes:[],injector:W})}}function Ra(k){const W=k.value.routeConfig;return W&&""===W.path}function ul(k){const W=[],N=new Set;for(const X of k){if(!Ra(X)){W.push(X);continue}const ce=W.find(Xe=>X.value.routeConfig===Xe.value.routeConfig);void 0!==ce?(ce.children.push(...X.children),N.add(ce)):W.push(X)}for(const X of N){const ce=ul(X.children);W.push(new qn(X.value,ce))}return W.filter(X=>!N.has(X))}function wr(k){return k.data||{}}function So(k){return k.resolve||{}}function Pd(k){const W=k.children.map(N=>Pd(N)).flat();return[k,...W]}function qr(k){return(0,$t.n)(W=>{const N=k(W);return N?(0,me.H)(N).pipe((0,Ue.T)(()=>W)):(0,a.of)(W)})}let Br=(()=>{class k{buildTitle(N){let X,ce=N.root;for(;void 0!==ce;)X=this.getResolvedTitleForRoute(ce)??X,ce=ce.children.find(Xe=>Xe.outlet===ut);return X}getResolvedTitleForRoute(N){return N.data[nn]}static#e=this.\u0275fac=function(X){return new(X||k)};static#t=this.\u0275prov=g.jDH({token:k,factory:()=>(0,g.WQX)(xh),providedIn:"root"})}return k})(),xh=(()=>{class k extends Br{constructor(N){super(),this.title=N}updateTitle(N){const X=this.buildTitle(N);void 0!==X&&this.title.setTitle(X)}static#e=this.\u0275fac=function(X){return new(X||k)(g.KVO(_i.hE))};static#t=this.\u0275prov=g.jDH({token:k,factory:k.\u0275fac,providedIn:"root"})}return k})();const zi=new g.nKC("",{providedIn:"root",factory:()=>({})});let cc=(()=>{class k{static#e=this.\u0275fac=function(X){return new(X||k)};static#t=this.\u0275cmp=g.VBU({type:k,selectors:[["ng-component"]],standalone:!0,features:[g.aNF],decls:1,vars:0,template:function(X,ce){1&X&&g.nrm(0,"router-outlet")},dependencies:[ga],encapsulation:2})}return k})();function au(k){const W=k.children&&k.children.map(au),N=W?{...k,children:W}:{...k};return!N.component&&!N.loadComponent&&(W||N.loadChildren)&&N.outlet&&N.outlet!==ut&&(N.component=cc),N}const Ya=new g.nKC("");let $s=(()=>{class k{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,g.WQX)(g.Ql9)}loadComponent(N){if(this.componentLoaders.get(N))return this.componentLoaders.get(N);if(N._loadedComponent)return(0,a.of)(N._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(N);const X=Rn(N.loadComponent()).pipe((0,Ue.T)(oe),ve(Xe=>{this.onLoadEndListener&&this.onLoadEndListener(N),N._loadedComponent=Xe}),(0,tn.j)(()=>{this.componentLoaders.delete(N)})),ce=new Le(X,()=>new ot.B).pipe(Ye());return this.componentLoaders.set(N,ce),ce}loadChildren(N,X){if(this.childrenLoaders.get(X))return this.childrenLoaders.get(X);if(X._loadedRoutes)return(0,a.of)({routes:X._loadedRoutes,injector:X._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(X);const Xe=function lu(k,W,N,X){return Rn(k.loadChildren()).pipe((0,Ue.T)(oe),(0,$e.Z)(ce=>ce instanceof g.Co$||Array.isArray(ce)?(0,a.of)(ce):(0,me.H)(W.compileModuleAsync(ce))),(0,Ue.T)(ce=>{X&&X(k);let Xe,Rt,un=!1;return Array.isArray(ce)?(Rt=ce,!0):(Xe=ce.create(N).injector,Rt=Xe.get(Ya,[],{optional:!0,self:!0}).flat()),{routes:Rt.map(au),injector:Xe}}))}(X,this.compiler,N,this.onLoadEndListener).pipe((0,tn.j)(()=>{this.childrenLoaders.delete(X)})),Rt=new Le(Xe,()=>new ot.B).pipe(Ye());return this.childrenLoaders.set(X,Rt),Rt}static#e=this.\u0275fac=function(X){return new(X||k)};static#t=this.\u0275prov=g.jDH({token:k,factory:k.\u0275fac,providedIn:"root"})}return k})();function oe(k){return function V(k){return k&&"object"==typeof k&&"default"in k}(k)?k.default:k}let K=(()=>{class k{static#e=this.\u0275fac=function(X){return new(X||k)};static#t=this.\u0275prov=g.jDH({token:k,factory:()=>(0,g.WQX)(ae),providedIn:"root"})}return k})(),ae=(()=>{class k{shouldProcessUrl(N){return!0}extract(N){return N}merge(N,X){return N}static#e=this.\u0275fac=function(X){return new(X||k)};static#t=this.\u0275prov=g.jDH({token:k,factory:k.\u0275fac,providedIn:"root"})}return k})();const Ot=new g.nKC(""),Nn=new g.nKC("");function kn(k,W,N){const X=k.get(Nn),ce=k.get(Ve.qQ);return k.get(g.SKi).runOutsideAngular(()=>{if(!ce.startViewTransition||X.skipNextTransition)return X.skipNextTransition=!1,new Promise(wi=>setTimeout(wi));let Xe;const Rt=new Promise(wi=>{Xe=wi}),un=ce.startViewTransition(()=>(Xe(),function Xi(k){return new Promise(W=>{(0,g.mal)({read:()=>setTimeout(W)},{injector:k})})}(k))),{onViewTransitionCreated:en}=X;return en&&(0,g.N4e)(k,()=>en({transition:un,from:W,to:N})),Rt})}const vo=new g.nKC("");let Ar=(()=>{class k{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new ot.B,this.transitionAbortSubject=new ot.B,this.configLoader=(0,g.WQX)($s),this.environmentInjector=(0,g.WQX)(g.uvJ),this.urlSerializer=(0,g.WQX)(ro),this.rootContexts=(0,g.WQX)(Pt),this.location=(0,g.WQX)(Ve.aZ),this.inputBindingEnabled=null!==(0,g.WQX)(Wr,{optional:!0}),this.titleStrategy=(0,g.WQX)(Br),this.options=(0,g.WQX)(zi,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=(0,g.WQX)(K),this.createViewTransition=(0,g.WQX)(Ot,{optional:!0}),this.navigationErrorHandler=(0,g.WQX)(vo,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>(0,a.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=ce=>this.events.next(new Sa(ce)),this.configLoader.onLoadStartListener=ce=>this.events.next(new Ss(ce))}complete(){this.transitions?.complete()}handleNavigationRequest(N){const X=++this.navigationId;this.transitions?.next({...this.transitions.value,...N,id:X})}setupNavigations(N,X,ce){return this.transitions=new Z.t({id:0,currentUrlTree:X,currentRawUrl:X,extractedUrl:this.urlHandlingStrategy.extract(X),urlAfterRedirects:this.urlHandlingStrategy.extract(X),rawUrl:X,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:pi,restoredState:null,currentSnapshot:ce.snapshot,targetSnapshot:null,currentRouterState:ce,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,Mt.p)(Xe=>0!==Xe.id),(0,Ue.T)(Xe=>({...Xe,extractedUrl:this.urlHandlingStrategy.extract(Xe.rawUrl)})),(0,$t.n)(Xe=>{let Rt=!1,un=!1;return(0,a.of)(Xe).pipe((0,$t.n)(en=>{if(this.navigationId>Xe.id)return this.cancelNavigationTransition(Xe,"",Nr.SupersededByNewNavigation),Ne.w;this.currentTransition=Xe,this.currentNavigation={id:en.id,initialUrl:en.rawUrl,extractedUrl:en.extractedUrl,targetBrowserUrl:"string"==typeof en.extras.browserUrl?this.urlSerializer.parse(en.extras.browserUrl):en.extras.browserUrl,trigger:en.source,extras:en.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null};const wi=!N.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!wi&&"reload"!==(en.extras.onSameUrlNavigation??N.onSameUrlNavigation)){const dr="";return this.events.next(new Vr(en.id,this.urlSerializer.serialize(en.rawUrl),dr,_o.IgnoredSameUrlNavigation)),en.resolve(!1),Ne.w}if(this.urlHandlingStrategy.shouldProcessUrl(en.rawUrl))return(0,a.of)(en).pipe((0,$t.n)(dr=>{const Ho=this.transitions?.getValue();return this.events.next(new Io(dr.id,this.urlSerializer.serialize(dr.extractedUrl),dr.source,dr.restoredState)),Ho!==this.transitions?.getValue()?Ne.w:Promise.resolve(dr)}),function vh(k,W,N,X,ce,Xe){return(0,$e.Z)(Rt=>function cl(k,W,N,X,ce,Xe,Rt="emptyOnly"){return new Uu(k,W,N,X,ce,Rt,Xe).recognize()}(k,W,N,X,Rt.extractedUrl,ce,Xe).pipe((0,Ue.T)(({state:un,tree:en})=>({...Rt,targetSnapshot:un,urlAfterRedirects:en}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,N.config,this.urlSerializer,this.paramsInheritanceStrategy),ve(dr=>{Xe.targetSnapshot=dr.targetSnapshot,Xe.urlAfterRedirects=dr.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:dr.urlAfterRedirects};const Ho=new ko(dr.id,this.urlSerializer.serialize(dr.extractedUrl),this.urlSerializer.serialize(dr.urlAfterRedirects),dr.targetSnapshot);this.events.next(Ho)}));if(wi&&this.urlHandlingStrategy.shouldProcessUrl(en.currentRawUrl)){const{id:dr,extractedUrl:Ho,source:pl,restoredState:ls,extras:Hl}=en,Na=new Io(dr,this.urlSerializer.serialize(Ho),pl,ls);this.events.next(Na);const Ml=ai(this.rootComponentType).snapshot;return this.currentTransition=Xe={...en,targetSnapshot:Ml,urlAfterRedirects:Ho,extras:{...Hl,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=Ho,(0,a.of)(Xe)}{const dr="";return this.events.next(new Vr(en.id,this.urlSerializer.serialize(en.extractedUrl),dr,_o.IgnoredByUrlHandlingStrategy)),en.resolve(!1),Ne.w}}),ve(en=>{const wi=new Ls(en.id,this.urlSerializer.serialize(en.extractedUrl),this.urlSerializer.serialize(en.urlAfterRedirects),en.targetSnapshot);this.events.next(wi)}),(0,Ue.T)(en=>(this.currentTransition=Xe={...en,guards:Bl(en.targetSnapshot,en.currentSnapshot,this.rootContexts)},Xe)),function as(k,W){return(0,$e.Z)(N=>{const{targetSnapshot:X,currentSnapshot:ce,guards:{canActivateChecks:Xe,canDeactivateChecks:Rt}}=N;return 0===Rt.length&&0===Xe.length?(0,a.of)({...N,guardsResult:!0}):function _r(k,W,N,X){return(0,me.H)(k).pipe((0,$e.Z)(ce=>function zo(k,W,N,X,ce){const Xe=W&&W.routeConfig?W.routeConfig.canDeactivate:null;if(!Xe||0===Xe.length)return(0,a.of)(!0);const Rt=Xe.map(un=>{const en=he(W)??ce,wi=Vo(un,en);return Rn(function ye(k){return k&&Ul(k.canDeactivate)}(wi)?wi.canDeactivate(k,W,N,X):(0,g.N4e)(en,()=>wi(k,W,N,X))).pipe(Kt())});return(0,a.of)(Rt).pipe(sr())}(ce.component,ce.route,N,W,X)),Kt(ce=>!0!==ce,!0))}(Rt,X,ce,k).pipe((0,$e.Z)(un=>un&&function wl(k){return"boolean"==typeof k}(un)?function sc(k,W,N,X){return(0,me.H)(W).pipe((0,at.H)(ce=>(0,De.x)(function _h(k,W){return null!==k&&W&&W(new ma(k)),(0,a.of)(!0)}(ce.route.parent,X),function Sd(k,W){return null!==k&&W&&W(new ks(k)),(0,a.of)(!0)}(ce.route,X),function jl(k,W,N){const X=W[W.length-1],Xe=W.slice(0,W.length-1).reverse().map(Rt=>function rc(k){const W=k.routeConfig?k.routeConfig.canActivateChild:null;return W&&0!==W.length?{node:k,guards:W}:null}(Rt)).filter(Rt=>null!==Rt).map(Rt=>(0,Je.v)(()=>{const un=Rt.guards.map(en=>{const wi=he(Rt.node)??N,yr=Vo(en,wi);return Rn(function se(k){return k&&Ul(k.canActivateChild)}(yr)?yr.canActivateChild(X,k):(0,g.N4e)(wi,()=>yr(X,k))).pipe(Kt())});return(0,a.of)(un).pipe(sr())}));return(0,a.of)(Xe).pipe(sr())}(k,ce.path,N),function Dc(k,W,N){const X=W.routeConfig?W.routeConfig.canActivate:null;if(!X||0===X.length)return(0,a.of)(!0);const ce=X.map(Xe=>(0,Je.v)(()=>{const Rt=he(W)??N,un=Vo(Xe,Rt);return Rn(function Nu(k){return k&&Ul(k.canActivate)}(un)?un.canActivate(W,k):(0,g.N4e)(Rt,()=>un(W,k))).pipe(Kt())}));return(0,a.of)(ce).pipe(sr())}(k,ce.route,N))),Kt(ce=>!0!==ce,!0))}(X,Xe,k,W):(0,a.of)(un)),(0,Ue.T)(un=>({...N,guardsResult:un})))})}(this.environmentInjector,en=>this.events.next(en)),ve(en=>{if(Xe.guardsResult=en.guardsResult,en.guardsResult&&"boolean"!=typeof en.guardsResult)throw Ns(0,en.guardsResult);const wi=new Gr(en.id,this.urlSerializer.serialize(en.extractedUrl),this.urlSerializer.serialize(en.urlAfterRedirects),en.targetSnapshot,!!en.guardsResult);this.events.next(wi)}),(0,Mt.p)(en=>!!en.guardsResult||(this.cancelNavigationTransition(en,"",Nr.GuardRejected),!1)),qr(en=>{if(en.guards.canActivateChecks.length)return(0,a.of)(en).pipe(ve(wi=>{const yr=new xs(wi.id,this.urlSerializer.serialize(wi.extractedUrl),this.urlSerializer.serialize(wi.urlAfterRedirects),wi.targetSnapshot);this.events.next(yr)}),(0,$t.n)(wi=>{let yr=!1;return(0,a.of)(wi).pipe(function lc(k,W){return(0,$e.Z)(N=>{const{targetSnapshot:X,guards:{canActivateChecks:ce}}=N;if(!ce.length)return(0,a.of)(N);const Xe=new Set(ce.map(en=>en.route)),Rt=new Set;for(const en of Xe)if(!Rt.has(en))for(const wi of Pd(en))Rt.add(wi);let un=0;return(0,me.H)(Rt).pipe((0,at.H)(en=>Xe.has(en)?function Rd(k,W,N,X){const ce=k.routeConfig,Xe=k._resolve;return void 0!==ce?.title&&!eo(ce)&&(Xe[nn]=ce.title),function ju(k,W,N,X){const ce=Se(k);if(0===ce.length)return(0,a.of)({});const Xe={};return(0,me.H)(ce).pipe((0,$e.Z)(Rt=>function Vl(k,W,N,X){const ce=he(W)??X,Xe=Vo(k,ce);return Rn(Xe.resolve?Xe.resolve(W,N):(0,g.N4e)(ce,()=>Xe(W,N)))}(k[Rt],W,N,X).pipe(Kt(),ve(un=>{if(un instanceof Aa)throw Ns(new co,un);Xe[Rt]=un}))),Re(1),function it(k){return(0,Ue.T)(()=>k)}(Xe),fe(Rt=>rt(Rt)?Ne.w:We(Rt)))}(Xe,k,W,X).pipe((0,Ue.T)(Rt=>(k._resolvedData=Rt,k.data=er(k,k.parent,N).resolve,null)))}(en,X,k,W):(en.data=er(en,en.parent,k).resolve,(0,a.of)(void 0))),ve(()=>un++),Re(1),(0,$e.Z)(en=>un===Rt.size?(0,a.of)(N):Ne.w))})}(this.paramsInheritanceStrategy,this.environmentInjector),ve({next:()=>yr=!0,complete:()=>{yr||this.cancelNavigationTransition(wi,"",Nr.NoDataFromResolver)}}))}),ve(wi=>{const yr=new Qs(wi.id,this.urlSerializer.serialize(wi.extractedUrl),this.urlSerializer.serialize(wi.urlAfterRedirects),wi.targetSnapshot);this.events.next(yr)}))}),qr(en=>{const wi=yr=>{const dr=[];yr.routeConfig?.loadComponent&&!yr.routeConfig._loadedComponent&&dr.push(this.configLoader.loadComponent(yr.routeConfig).pipe(ve(Ho=>{yr.component=Ho}),(0,Ue.T)(()=>{})));for(const Ho of yr.children)dr.push(...wi(Ho));return dr};return(0,ie.z)(wi(en.targetSnapshot.root)).pipe(Et(null),(0,nt.s)(1))}),qr(()=>this.afterPreactivation()),(0,$t.n)(()=>{const{currentSnapshot:en,targetSnapshot:wi}=Xe,yr=this.createViewTransition?.(this.environmentInjector,en.root,wi.root);return yr?(0,me.H)(yr).pipe((0,Ue.T)(()=>Xe)):(0,a.of)(Xe)}),(0,Ue.T)(en=>{const wi=function Zo(k,W,N){const X=Fs(k,W._root,N?N._root:void 0);return new mi(X,W)}(N.routeReuseStrategy,en.targetSnapshot,en.currentRouterState);return this.currentTransition=Xe={...en,targetRouterState:wi},this.currentNavigation.targetRouterState=wi,Xe}),ve(()=>{this.events.next(new ol)}),((k,W,N,X)=>(0,Ue.T)(ce=>(new Fu(W,ce.targetRouterState,ce.currentRouterState,N,X).activate(k),ce)))(this.rootContexts,N.routeReuseStrategy,en=>this.events.next(en),this.inputBindingEnabled),(0,nt.s)(1),ve({next:en=>{Rt=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new gr(en.id,this.urlSerializer.serialize(en.extractedUrl),this.urlSerializer.serialize(en.urlAfterRedirects))),this.titleStrategy?.updateTitle(en.targetRouterState.snapshot),en.resolve(!0)},complete:()=>{Rt=!0}}),function Jn(k){return(0,He.N)((W,N)=>{(0,Me.Tg)(k).subscribe((0,be._)(N,()=>N.complete(),bn.l)),!N.closed&&W.subscribe(N)})}(this.transitionAbortSubject.pipe(ve(en=>{throw en}))),(0,tn.j)(()=>{!Rt&&!un&&this.cancelNavigationTransition(Xe,"",Nr.SupersededByNewNavigation),this.currentTransition?.id===Xe.id&&(this.currentNavigation=null,this.currentTransition=null)}),fe(en=>{if(un=!0,qa(en))this.events.next(new yo(Xe.id,this.urlSerializer.serialize(Xe.extractedUrl),en.message,en.cancellationCode)),function jo(k){return qa(k)&&Un(k.url)}(en)?this.events.next(new Wa(en.url,en.navigationBehaviorOptions)):Xe.resolve(!1);else{const wi=new uo(Xe.id,this.urlSerializer.serialize(Xe.extractedUrl),en,Xe.targetSnapshot??void 0);try{const yr=(0,g.N4e)(this.environmentInjector,()=>this.navigationErrorHandler?.(wi));if(yr instanceof Aa){const{message:dr,cancellationCode:Ho}=Ns(0,yr);this.events.next(new yo(Xe.id,this.urlSerializer.serialize(Xe.extractedUrl),dr,Ho)),this.events.next(new Wa(yr.redirectTo,yr.navigationBehaviorOptions))}else{this.events.next(wi);const dr=N.errorHandler(en);Xe.resolve(!!dr)}}catch(yr){this.options.resolveNavigationPromiseOnError?Xe.resolve(!1):Xe.reject(yr)}}return Ne.w}))}))}cancelNavigationTransition(N,X,ce){const Xe=new yo(N.id,this.urlSerializer.serialize(N.extractedUrl),X,ce);this.events.next(Xe),N.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){const N=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),X=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return N.toString()!==X?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static#e=this.\u0275fac=function(X){return new(X||k)};static#t=this.\u0275prov=g.jDH({token:k,factory:k.\u0275fac,providedIn:"root"})}return k})();function Xr(k){return k!==pi}let gi=(()=>{class k{static#e=this.\u0275fac=function(X){return new(X||k)};static#t=this.\u0275prov=g.jDH({token:k,factory:()=>(0,g.WQX)(Eo),providedIn:"root"})}return k})();class qo{shouldDetach(W){return!1}store(W,N){}shouldAttach(W){return!1}retrieve(W){return null}shouldReuseRoute(W,N){return W.routeConfig===N.routeConfig}}let Eo=(()=>{class k extends qo{static#e=this.\u0275fac=(()=>{let N;return function(ce){return(N||(N=g.xGo(k)))(ce||k)}})();static#t=this.\u0275prov=g.jDH({token:k,factory:k.\u0275fac,providedIn:"root"})}return k})(),Go=(()=>{class k{static#e=this.\u0275fac=function(X){return new(X||k)};static#t=this.\u0275prov=g.jDH({token:k,factory:()=>(0,g.WQX)(na),providedIn:"root"})}return k})(),na=(()=>{class k extends Go{constructor(){super(...arguments),this.location=(0,g.WQX)(Ve.aZ),this.urlSerializer=(0,g.WQX)(ro),this.options=(0,g.WQX)(zi,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=(0,g.WQX)(K),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new ii,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=ai(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(N){return this.location.subscribe(X=>{"popstate"===X.type&&N(X.url,X.state)})}handleRouterEvent(N,X){if(N instanceof Io)this.stateMemento=this.createStateMemento();else if(N instanceof Vr)this.rawUrlTree=X.initialUrl;else if(N instanceof ko){if("eager"===this.urlUpdateStrategy&&!X.extras.skipLocationChange){const ce=this.urlHandlingStrategy.merge(X.finalUrl,X.initialUrl);this.setBrowserUrl(X.targetBrowserUrl??ce,X)}}else N instanceof ol?(this.currentUrlTree=X.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(X.finalUrl,X.initialUrl),this.routerState=X.targetRouterState,"deferred"===this.urlUpdateStrategy&&!X.extras.skipLocationChange&&this.setBrowserUrl(X.targetBrowserUrl??this.rawUrlTree,X)):N instanceof yo&&(N.code===Nr.GuardRejected||N.code===Nr.NoDataFromResolver)?this.restoreHistory(X):N instanceof uo?this.restoreHistory(X,!0):N instanceof gr&&(this.lastSuccessfulId=N.id,this.currentPageId=this.browserPageId)}setBrowserUrl(N,X){const ce=N instanceof ii?this.urlSerializer.serialize(N):N;if(this.location.isCurrentPathEqualTo(ce)||X.extras.replaceUrl){const Rt={...X.extras.state,...this.generateNgRouterState(X.id,this.browserPageId)};this.location.replaceState(ce,"",Rt)}else{const Xe={...X.extras.state,...this.generateNgRouterState(X.id,this.browserPageId+1)};this.location.go(ce,"",Xe)}}restoreHistory(N,X=!1){if("computed"===this.canceledNavigationResolution){const Xe=this.currentPageId-this.browserPageId;0!==Xe?this.location.historyGo(Xe):this.currentUrlTree===N.finalUrl&&0===Xe&&(this.resetState(N),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(X&&this.resetState(N),this.resetUrlToCurrentUrlTree())}resetState(N){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,N.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(N,X){return"computed"===this.canceledNavigationResolution?{navigationId:N,\u0275routerPageId:X}:{navigationId:N}}static#e=this.\u0275fac=(()=>{let N;return function(ce){return(N||(N=g.xGo(k)))(ce||k)}})();static#t=this.\u0275prov=g.jDH({token:k,factory:k.\u0275fac,providedIn:"root"})}return k})();var Is=function(k){return k[k.COMPLETE=0]="COMPLETE",k[k.FAILED=1]="FAILED",k[k.REDIRECTING=2]="REDIRECTING",k}(Is||{});function Oa(k,W){k.events.pipe((0,Mt.p)(N=>N instanceof gr||N instanceof yo||N instanceof uo||N instanceof Vr),(0,Ue.T)(N=>N instanceof gr||N instanceof Vr?Is.COMPLETE:N instanceof yo&&(N.code===Nr.Redirect||N.code===Nr.SupersededByNewNavigation)?Is.REDIRECTING:Is.FAILED),(0,Mt.p)(N=>N!==Is.REDIRECTING),(0,nt.s)(1)).subscribe(()=>{W()})}function Yo(k){throw k}const ds={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Ds={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ts=(()=>{class k{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=(0,g.WQX)(g.H3F),this.stateManager=(0,g.WQX)(Go),this.options=(0,g.WQX)(zi,{optional:!0})||{},this.pendingTasks=(0,g.WQX)(g.TgB),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=(0,g.WQX)(Ar),this.urlSerializer=(0,g.WQX)(ro),this.location=(0,g.WQX)(Ve.aZ),this.urlHandlingStrategy=(0,g.WQX)(K),this._events=new ot.B,this.errorHandler=this.options.errorHandler||Yo,this.navigated=!1,this.routeReuseStrategy=(0,g.WQX)(gi),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=(0,g.WQX)(Ya,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!(0,g.WQX)(Wr,{optional:!0}),this.eventsSubscription=new ht.yU,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:N=>{this.console.warn(N)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const N=this.navigationTransitions.events.subscribe(X=>{try{const ce=this.navigationTransitions.currentTransition,Xe=this.navigationTransitions.currentNavigation;if(null!==ce&&null!==Xe)if(this.stateManager.handleRouterEvent(X,Xe),X instanceof yo&&X.code!==Nr.Redirect&&X.code!==Nr.SupersededByNewNavigation)this.navigated=!0;else if(X instanceof gr)this.navigated=!0;else if(X instanceof Wa){const Rt=X.navigationBehaviorOptions,un=this.urlHandlingStrategy.merge(X.url,ce.currentRawUrl),en={browserUrl:ce.extras.browserUrl,info:ce.extras.info,skipLocationChange:ce.extras.skipLocationChange,replaceUrl:ce.extras.replaceUrl||"eager"===this.urlUpdateStrategy||Xr(ce.source),...Rt};this.scheduleNavigation(un,pi,null,en,{resolve:ce.resolve,reject:ce.reject,promise:ce.promise})}(function Gs(k){return!(k instanceof ol||k instanceof Wa)})(X)&&this._events.next(X)}catch(ce){this.navigationTransitions.transitionAbortSubject.next(ce)}});this.eventsSubscription.add(N)}resetRootComponentType(N){this.routerState.root.component=N,this.navigationTransitions.rootComponentType=N}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),pi,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((N,X)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(N,"popstate",X)},0)})}navigateToSyncWithBrowser(N,X,ce){const Xe={replaceUrl:!0},Rt=ce?.navigationId?ce:null;if(ce){const en={...ce};delete en.navigationId,delete en.\u0275routerPageId,0!==Object.keys(en).length&&(Xe.state=en)}const un=this.parseUrl(N);this.scheduleNavigation(un,X,Rt,Xe)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(N){this.config=N.map(au),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(N,X={}){const{relativeTo:ce,queryParams:Xe,fragment:Rt,queryParamsHandling:un,preserveFragment:en}=X,wi=en?this.currentUrlTree.fragment:Rt;let dr,yr=null;switch(un){case"merge":yr={...this.currentUrlTree.queryParams,...Xe};break;case"preserve":yr=this.currentUrlTree.queryParams;break;default:yr=Xe||null}null!==yr&&(yr=this.removeEmptyProps(yr));try{dr=Ei(ce?ce.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof N[0]||"/"!==N[0][0])&&(N=[]),dr=this.currentUrlTree.root}return Ui(dr,N,yr,wi??null)}navigateByUrl(N,X={skipLocationChange:!1}){const ce=Un(N)?N:this.parseUrl(N),Xe=this.urlHandlingStrategy.merge(ce,this.rawUrlTree);return this.scheduleNavigation(Xe,pi,null,X)}navigate(N,X={skipLocationChange:!1}){return function Jo(k){for(let W=0;W<k.length;W++)if(null==k[W])throw new g.wOt(4008,!1)}(N),this.navigateByUrl(this.createUrlTree(N,X),X)}serializeUrl(N){return this.urlSerializer.serialize(N)}parseUrl(N){try{return this.urlSerializer.parse(N)}catch{return this.urlSerializer.parse("/")}}isActive(N,X){let ce;if(ce=!0===X?{...ds}:!1===X?{...Ds}:X,Un(N))return ei(this.currentUrlTree,N,ce);const Xe=this.parseUrl(N);return ei(this.currentUrlTree,Xe,ce)}removeEmptyProps(N){return Object.entries(N).reduce((X,[ce,Xe])=>(null!=Xe&&(X[ce]=Xe),X),{})}scheduleNavigation(N,X,ce,Xe,Rt){if(this.disposed)return Promise.resolve(!1);let un,en,wi;Rt?(un=Rt.resolve,en=Rt.reject,wi=Rt.promise):wi=new Promise((dr,Ho)=>{un=dr,en=Ho});const yr=this.pendingTasks.add();return Oa(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(yr))}),this.navigationTransitions.handleNavigationRequest({source:X,restoredState:ce,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:N,extras:Xe,resolve:un,reject:en,promise:wi,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),wi.catch(dr=>Promise.reject(dr))}static#e=this.\u0275fac=function(X){return new(X||k)};static#t=this.\u0275prov=g.jDH({token:k,factory:k.\u0275fac,providedIn:"root"})}return k})(),Ja=(()=>{class k{constructor(N,X,ce,Xe,Rt,un){this.router=N,this.route=X,this.tabIndexAttribute=ce,this.renderer=Xe,this.el=Rt,this.locationStrategy=un,this.href=null,this.onChanges=new ot.B,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1,this.routerLinkInput=null;const en=Rt.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===en||"area"===en,this.isAnchorElement?this.subscription=N.events.subscribe(wi=>{wi instanceof gr&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(N){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",N)}ngOnChanges(N){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(N){null==N?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(this.routerLinkInput=Un(N)||Array.isArray(N)?N:[N],this.setTabIndexIfNotOnNativeEl("0"))}onClick(N,X,ce,Xe,Rt){const un=this.urlTree;return!!(null===un||this.isAnchorElement&&(0!==N||X||ce||Xe||Rt||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(un,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){const N=this.urlTree;this.href=null!==N&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(N)):null;const X=null===this.href?null:(0,g.n$t)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",X)}applyAttributeValue(N,X){const ce=this.renderer,Xe=this.el.nativeElement;null!==X?ce.setAttribute(Xe,N,X):ce.removeAttribute(Xe,N)}get urlTree(){return null===this.routerLinkInput?null:Un(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static#e=this.\u0275fac=function(X){return new(X||k)(g.rXU(ts),g.rXU(Vi),g.kS0("tabindex"),g.rXU(g.sFG),g.rXU(g.aKT),g.rXU(Ve.hb))};static#t=this.\u0275dir=g.FsC({type:k,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(X,ce){1&X&&g.bIt("click",function(Rt){return ce.onClick(Rt.button,Rt.ctrlKey,Rt.shiftKey,Rt.altKey,Rt.metaKey)}),2&X&&g.BMQ("target",ce.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",g.L39],skipLocationChange:[2,"skipLocationChange","skipLocationChange",g.L39],replaceUrl:[2,"replaceUrl","replaceUrl",g.L39],routerLink:"routerLink"},standalone:!0,features:[g.GFd,g.OA$]})}return k})();class La{}let $l=(()=>{class k{constructor(N,X,ce,Xe,Rt){this.router=N,this.injector=ce,this.preloadingStrategy=Xe,this.loader=Rt}setUpPreloading(){this.subscription=this.router.events.pipe((0,Mt.p)(N=>N instanceof gr),(0,at.H)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(N,X){const ce=[];for(const Xe of X){Xe.providers&&!Xe._injector&&(Xe._injector=(0,g.Ol2)(Xe.providers,N,`Route: ${Xe.path}`));const Rt=Xe._injector??N,un=Xe._loadedInjector??Rt;(Xe.loadChildren&&!Xe._loadedRoutes&&void 0===Xe.canLoad||Xe.loadComponent&&!Xe._loadedComponent)&&ce.push(this.preloadConfig(Rt,Xe)),(Xe.children||Xe._loadedRoutes)&&ce.push(this.processRoutes(un,Xe.children??Xe._loadedRoutes))}return(0,me.H)(ce).pipe((0,jn.U)())}preloadConfig(N,X){return this.preloadingStrategy.preload(X,()=>{let ce;ce=X.loadChildren&&void 0===X.canLoad?this.loader.loadChildren(N,X):(0,a.of)(null);const Xe=ce.pipe((0,$e.Z)(Rt=>null===Rt?(0,a.of)(void 0):(X._loadedRoutes=Rt.routes,X._loadedInjector=Rt.injector,this.processRoutes(Rt.injector??N,Rt.routes))));if(X.loadComponent&&!X._loadedComponent){const Rt=this.loader.loadComponent(X);return(0,me.H)([Xe,Rt]).pipe((0,jn.U)())}return Xe})}static#e=this.\u0275fac=function(X){return new(X||k)(g.KVO(ts),g.KVO(g.Ql9),g.KVO(g.uvJ),g.KVO(La),g.KVO($s))};static#t=this.\u0275prov=g.jDH({token:k,factory:k.\u0275fac,providedIn:"root"})}return k})();const Od=new g.nKC("");let Qa=(()=>{class k{constructor(N,X,ce,Xe,Rt={}){this.urlSerializer=N,this.transitions=X,this.viewportScroller=ce,this.zone=Xe,this.options=Rt,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},Rt.scrollPositionRestoration||="disabled",Rt.anchorScrolling||="disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(N=>{N instanceof Io?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=N.navigationTrigger,this.restoredId=N.restoredState?N.restoredState.navigationId:0):N instanceof gr?(this.lastId=N.id,this.scheduleScrollEvent(N,this.urlSerializer.parse(N.urlAfterRedirects).fragment)):N instanceof Vr&&N.code===_o.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(N,this.urlSerializer.parse(N.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(N=>{N instanceof Nl&&(N.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(N.position):N.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(N.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(N,X){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Nl(N,"popstate"===this.lastSource?this.store[this.restoredId]:null,X))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(X){g.QTQ()};static#t=this.\u0275prov=g.jDH({token:k,factory:k.\u0275fac})}return k})();function Qo(k,W){return{\u0275kind:k,\u0275providers:W}}function Ao(){const k=(0,g.WQX)(g.zZn);return W=>{const N=k.get(g.o8S);if(W!==N.components[0])return;const X=k.get(ts),ce=k.get(Fa);1===k.get(dc)&&X.initialNavigation(),k.get(dl,null,g.$GK.Optional)?.setUpPreloading(),k.get(Od,null,g.$GK.Optional)?.init(),X.resetRootComponentType(N.componentTypes[0]),ce.closed||(ce.next(),ce.complete(),ce.unsubscribe())}}const Fa=new g.nKC("",{factory:()=>new ot.B}),dc=new g.nKC("",{providedIn:"root",factory:()=>1}),dl=new g.nKC("");function el(k){return Qo(0,[{provide:dl,useExisting:$l},{provide:La,useExisting:k}])}function Gl(k){return Qo(9,[{provide:Ot,useValue:kn},{provide:Nn,useValue:{skipNextTransition:!!k?.skipInitialTransition,...k}}])}const cu=new g.nKC("ROUTER_FORROOT_GUARD"),hl=[Ve.aZ,{provide:ro,useClass:co},ts,Pt,{provide:Vi,useFactory:function Hs(k){return k.routerState.root},deps:[ts]},$s,[]];let kd=(()=>{class k{constructor(N){}static forRoot(N,X){return{ngModule:k,providers:[hl,[],{provide:Ya,multi:!0,useValue:N},{provide:cu,useFactory:Fd,deps:[[ts,new g.Xx1,new g.kdw]]},{provide:zi,useValue:X||{}},X?.useHash?{provide:Ve.hb,useClass:Ve.fw}:{provide:Ve.hb,useClass:Ve.Sm},{provide:Od,useFactory:()=>{const k=(0,g.WQX)(Ve.Xr),W=(0,g.WQX)(g.SKi),N=(0,g.WQX)(zi),X=(0,g.WQX)(Ar),ce=(0,g.WQX)(ro);return N.scrollOffset&&k.setOffset(N.scrollOffset),new Qa(ce,X,k,W,N)}},X?.preloadingStrategy?el(X.preloadingStrategy).\u0275providers:[],X?.initialNavigation?Eh(X):[],X?.bindToComponentInputs?Qo(8,[ea,{provide:Wr,useExisting:ea}]).\u0275providers:[],X?.enableViewTransitions?Gl().\u0275providers:[],[{provide:Ch,useFactory:Ao},{provide:g.iLQ,multi:!0,useExisting:Ch}]]}}static forChild(N){return{ngModule:k,providers:[{provide:Ya,multi:!0,useValue:N}]}}static#e=this.\u0275fac=function(X){return new(X||k)(g.KVO(cu,8))};static#t=this.\u0275mod=g.$C({type:k});static#n=this.\u0275inj=g.G2t({})}return k})();function Fd(k){return"guarded"}function Eh(k){return["disabled"===k.initialNavigation?Qo(3,[{provide:g.hnV,multi:!0,useFactory:()=>{const W=(0,g.WQX)(ts);return()=>{W.setUpLocationChangeListener()}}},{provide:dc,useValue:2}]).\u0275providers:[],"enabledBlocking"===k.initialNavigation?Qo(2,[{provide:dc,useValue:0},{provide:g.hnV,multi:!0,deps:[g.zZn],useFactory:W=>{const N=W.get(Ve.hj,Promise.resolve());return()=>N.then(()=>new Promise(X=>{const ce=W.get(ts),Xe=W.get(Fa);Oa(ce,()=>{X(!0)}),W.get(Ar).afterPreactivation=()=>(X(!0),Xe.closed?(0,a.of)(void 0):Xe),ce.initialNavigation()}))}}]).\u0275providers:[]]}const Ch=new g.nKC("")},7552:(vi,Vt,B)=>{"use strict";B.d(Vt,{QU:()=>ze,X7:()=>De});var g=B(3953),v=B(177),me=B(6354),a=B(1397),Z=B(9030),ie=B(7673),T=B(1626);const Ce=new g.nKC("JWT_OPTIONS");let De=(()=>{class je{constructor(Ne=null){this.tokenGetter=Ne&&Ne.tokenGetter||function(){}}urlBase64Decode(Ne){let ht=Ne.replace(/-/g,"+").replace(/_/g,"/");switch(ht.length%4){case 0:break;case 2:ht+="==";break;case 3:ht+="=";break;default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(ht)}b64decode(Ne){let He="";if((Ne=String(Ne).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let Ye,Le,be=0,ot=0;Le=Ne.charAt(ot++);~Le&&(Ye=be%4?64*Ye+Le:Le,be++%4)?He+=String.fromCharCode(255&Ye>>(-2*be&6)):0)Le="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(Le);return He}b64DecodeUnicode(Ne){return decodeURIComponent(Array.prototype.map.call(this.b64decode(Ne),ht=>"%"+("00"+ht.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(Ne=this.tokenGetter()){return Ne instanceof Promise?Ne.then(ht=>this._decodeToken(ht)):this._decodeToken(Ne)}_decodeToken(Ne){if(!Ne||""===Ne)return null;const ht=Ne.split(".");if(3!==ht.length)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");const He=this.urlBase64Decode(ht[1]);if(!He)throw new Error("Cannot decode the token.");return JSON.parse(He)}getTokenExpirationDate(Ne=this.tokenGetter()){return Ne instanceof Promise?Ne.then(ht=>this._getTokenExpirationDate(ht)):this._getTokenExpirationDate(Ne)}_getTokenExpirationDate(Ne){let ht;if(ht=this.decodeToken(Ne),!ht||!ht.hasOwnProperty("exp"))return null;const He=new Date(0);return He.setUTCSeconds(ht.exp),He}isTokenExpired(Ne=this.tokenGetter(),ht){return Ne instanceof Promise?Ne.then(He=>this._isTokenExpired(He,ht)):this._isTokenExpired(Ne,ht)}_isTokenExpired(Ne,ht){if(!Ne||""===Ne)return!0;const He=this.getTokenExpirationDate(Ne);return ht=ht||0,null!==He&&!(He.valueOf()>(new Date).valueOf()+1e3*ht)}getAuthScheme(Ne,ht){return"function"==typeof Ne?Ne(ht):Ne}}return je.\u0275fac=function(Ne){return new(Ne||je)(g.KVO(Ce))},je.\u0275prov=g.jDH({token:je,factory:je.\u0275fac}),je})();const Je=je=>je instanceof Promise?(0,Z.v)(()=>je):(0,ie.of)(je);let re=(()=>{class je{constructor(Ne,ht,He){this.jwtHelper=ht,this.document=He,this.standardPorts=["80","443"],this.tokenGetter=Ne.tokenGetter,this.headerName=Ne.headerName||"Authorization",this.authScheme=Ne.authScheme||""===Ne.authScheme?Ne.authScheme:"Bearer ",this.allowedDomains=Ne.allowedDomains||[],this.disallowedRoutes=Ne.disallowedRoutes||[],this.throwNoTokenError=Ne.throwNoTokenError||!1,this.skipWhenExpired=Ne.skipWhenExpired}isAllowedDomain(Ne){const ht=new URL(Ne.url,this.document.location.origin);if(ht.host===this.document.location.host)return!0;const He=`${ht.hostname}${ht.port&&!this.standardPorts.includes(ht.port)?":"+ht.port:""}`;return this.allowedDomains.findIndex(be=>"string"==typeof be?be===He:be instanceof RegExp&&be.test(He))>-1}isDisallowedRoute(Ne){const ht=new URL(Ne.url,this.document.location.origin);return this.disallowedRoutes.findIndex(He=>{if("string"==typeof He){const be=new URL(He,this.document.location.origin);return be.hostname===ht.hostname&&be.pathname===ht.pathname}return He instanceof RegExp&&He.test(Ne.url)})>-1}handleInterception(Ne,ht,He){const be=this.jwtHelper.getAuthScheme(this.authScheme,ht);if(!Ne&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");let Ye=(0,ie.of)(!1);return this.skipWhenExpired&&(Ye=Ne?Je(this.jwtHelper.isTokenExpired(Ne)):(0,ie.of)(!0)),Ne?Ye.pipe((0,me.T)(Le=>Le&&this.skipWhenExpired?ht.clone():ht.clone({setHeaders:{[this.headerName]:`${be}${Ne}`}})),(0,a.Z)(Le=>He.handle(Le))):He.handle(ht)}intercept(Ne,ht){if(!this.isAllowedDomain(Ne)||this.isDisallowedRoute(Ne))return ht.handle(Ne);const He=this.tokenGetter(Ne);return Je(He).pipe((0,a.Z)(be=>this.handleInterception(be,Ne,ht)))}}return je.\u0275fac=function(Ne){return new(Ne||je)(g.KVO(Ce),g.KVO(De),g.KVO(v.qQ))},je.\u0275prov=g.jDH({token:je,factory:je.\u0275fac}),je})(),ze=(()=>{class je{constructor(Ne){if(Ne)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(Ne){return{ngModule:je,providers:[{provide:T.a7,useClass:re,multi:!0},Ne.jwtOptionsProvider||{provide:Ce,useValue:Ne.config},De]}}}return je.\u0275fac=function(Ne){return new(Ne||je)(g.KVO(je,12))},je.\u0275mod=g.$C({type:je}),je.\u0275inj=g.G2t({}),je})()},3656:(vi,Vt,B)=>{"use strict";B.d(Vt,{Yq:()=>Bt,TS:()=>An,sR:()=>Ct,el:()=>Ge,Sb:()=>ao,QE:()=>Ft,CF:()=>Yi,Rg:()=>Ln,p4:()=>on,jM:()=>Gi,q9:()=>ut,y8:()=>Se,Kb:()=>nr,OD:()=>Jn,CE:()=>bt,pF:()=>gt,fL:()=>zn,YV:()=>wt,er:()=>Un,z3:()=>Ei});var g=B(467),v=B(3953),me=B(1470),a=B(177),Z=B(5531),ie=B(4442);var Mt=B(1413),$e=B(3726),Et=B(4412),cn=B(4572),fn=B(7673),Kn=B(1635),Kt=B(5964),at=B(5558),ve=B(3669),Me=B(9974),fe=B(4360);function _n(lt,Be){return lt===Be}var Re=B(9417);const wn=["tabsInner"];let Jn=(()=>{class lt{doc;_readyPromise;win;backButton=new Mt.B;keyboardDidShow=new Mt.B;keyboardDidHide=new Mt.B;pause=new Mt.B;resume=new Mt.B;resize=new Mt.B;constructor(we,Fe){this.doc=we,Fe.run(()=>{let Gt;this.win=we.defaultView,this.backButton.subscribeWithPriority=function(vn,Ie){return this.subscribe(mt=>mt.register(vn,Tt=>Fe.run(()=>Ie(Tt))))},_i(this.pause,we,"pause",Fe),_i(this.resume,we,"resume",Fe),_i(this.backButton,we,"ionBackButton",Fe),_i(this.resize,this.win,"resize",Fe),_i(this.keyboardDidShow,this.win,"ionKeyboardDidShow",Fe),_i(this.keyboardDidHide,this.win,"ionKeyboardDidHide",Fe),this._readyPromise=new Promise(vn=>{Gt=vn}),this.win?.cordova?we.addEventListener("deviceready",()=>{Gt("cordova")},{once:!0}):Gt("dom")})}is(we){return(0,Z.a)(this.win,we)}platforms(){return(0,Z.g)(this.win)}ready(){return this._readyPromise}get isRTL(){return"rtl"===this.doc.dir}getQueryParam(we){return jn(this.win.location.href,we)}isLandscape(){return!this.isPortrait()}isPortrait(){return this.win.matchMedia?.("(orientation: portrait)").matches}testUserAgent(we){const Fe=this.win.navigator;return!!(Fe?.userAgent&&Fe.userAgent.indexOf(we)>=0)}url(){return this.win.location.href}width(){return this.win.innerWidth}height(){return this.win.innerHeight}static \u0275fac=function(Fe){return new(Fe||lt)(v.KVO(a.qQ),v.KVO(v.SKi))};static \u0275prov=v.jDH({token:lt,factory:lt.\u0275fac,providedIn:"root"})}return lt})();const jn=(lt,Be)=>{Be=Be.replace(/[[\]\\]/g,"\\$&");const Fe=new RegExp("[\\?&]"+Be+"=([^&#]*)").exec(lt);return Fe?decodeURIComponent(Fe[1].replace(/\+/g," ")):null},_i=(lt,Be,we,Fe)=>{Be&&Be.addEventListener(we,Gt=>{Fe.run(()=>{const vn=Gt?.detail;lt.next(vn)})})};let ut=(()=>{class lt{location;serializer;router;topOutlet;direction=ui;animated=pn;animationBuilder;guessDirection="forward";guessAnimation;lastNavId=-1;constructor(we,Fe,Gt,vn){this.location=Fe,this.serializer=Gt,this.router=vn,vn&&vn.events.subscribe(Ie=>{if(Ie instanceof me.Z){const mt=Ie.restoredState?Ie.restoredState.navigationId:Ie.id;this.guessDirection=this.guessAnimation=mt<this.lastNavId?"back":"forward",this.lastNavId="forward"===this.guessDirection?Ie.id:mt}}),we.backButton.subscribeWithPriority(0,Ie=>{this.pop(),Ie()})}navigateForward(we,Fe={}){return this.setDirection("forward",Fe.animated,Fe.animationDirection,Fe.animation),this.navigate(we,Fe)}navigateBack(we,Fe={}){return this.setDirection("back",Fe.animated,Fe.animationDirection,Fe.animation),this.navigate(we,Fe)}navigateRoot(we,Fe={}){return this.setDirection("root",Fe.animated,Fe.animationDirection,Fe.animation),this.navigate(we,Fe)}back(we={animated:!0,animationDirection:"back"}){return this.setDirection("back",we.animated,we.animationDirection,we.animation),this.location.back()}pop(){var we=this;return(0,g.A)(function*(){let Fe=we.topOutlet;for(;Fe;){if(yield Fe.pop())return!0;Fe=Fe.parentOutlet}return!1})()}setDirection(we,Fe,Gt,vn){this.direction=we,this.animated=nn(we,Fe,Gt),this.animationBuilder=vn}setTopOutlet(we){this.topOutlet=we}consumeTransition(){let Fe,we="root";const Gt=this.animationBuilder;return"auto"===this.direction?(we=this.guessDirection,Fe=this.guessAnimation):(Fe=this.animated,we=this.direction),this.direction=ui,this.animated=pn,this.animationBuilder=void 0,{direction:we,animation:Fe,animationBuilder:Gt}}navigate(we,Fe){if(Array.isArray(we))return this.router.navigate(we,Fe);{const Gt=this.serializer.parse(we.toString());return void 0!==Fe.queryParams&&(Gt.queryParams={...Fe.queryParams}),void 0!==Fe.fragment&&(Gt.fragment=Fe.fragment),this.router.navigateByUrl(Gt,Fe)}}static \u0275fac=function(Fe){return new(Fe||lt)(v.KVO(Jn),v.KVO(a.aZ),v.KVO(me.Sd),v.KVO(me.Ix,8))};static \u0275prov=v.jDH({token:lt,factory:lt.\u0275fac,providedIn:"root"})}return lt})();const nn=(lt,Be,we)=>{if(!1!==Be){if(void 0!==we)return we;if("forward"===lt||"back"===lt)return lt;if("root"===lt&&!0===Be)return"forward"}},ui="auto",pn=void 0;let An=(()=>{class lt{get(we,Fe){const Gt=Qt();return Gt?Gt.get(we,Fe):null}getBoolean(we,Fe){const Gt=Qt();return!!Gt&&Gt.getBoolean(we,Fe)}getNumber(we,Fe){const Gt=Qt();return Gt?Gt.getNumber(we,Fe):0}static \u0275fac=function(Fe){return new(Fe||lt)};static \u0275prov=v.jDH({token:lt,factory:lt.\u0275fac,providedIn:"root"})}return lt})();const Ct=new v.nKC("USERCONFIG"),Qt=()=>{if(typeof window<"u"){const lt=window.Ionic;if(lt?.config)return lt.config}return null};class Se{data;constructor(Be={}){this.data=Be,console.warn("[Ionic Warning]: NavParams has been deprecated in favor of using Angular's input API. Developers should migrate to either the @Input decorator or the Signals-based input API.")}get(Be){return this.data[Be]}}let Bt=(()=>{class lt{zone=(0,v.WQX)(v.SKi);applicationRef=(0,v.WQX)(v.o8S);config=(0,v.WQX)(Ct);create(we,Fe,Gt){return new Nt(we,Fe,this.applicationRef,this.zone,Gt,this.config.useSetInputAPI??!1)}static \u0275fac=function(Fe){return new(Fe||lt)};static \u0275prov=v.jDH({token:lt,factory:lt.\u0275fac})}return lt})();class Nt{environmentInjector;injector;applicationRef;zone;elementReferenceKey;enableSignalsSupport;elRefMap=new WeakMap;elEventsMap=new WeakMap;constructor(Be,we,Fe,Gt,vn,Ie){this.environmentInjector=Be,this.injector=we,this.applicationRef=Fe,this.zone=Gt,this.elementReferenceKey=vn,this.enableSignalsSupport=Ie}attachViewToDom(Be,we,Fe,Gt){return this.zone.run(()=>new Promise(vn=>{const Ie={...Fe};void 0!==this.elementReferenceKey&&(Ie[this.elementReferenceKey]=Be),vn(Rn(this.zone,this.environmentInjector,this.injector,this.applicationRef,this.elRefMap,this.elEventsMap,Be,we,Ie,Gt,this.elementReferenceKey,this.enableSignalsSupport))}))}removeViewFromDom(Be,we){return this.zone.run(()=>new Promise(Fe=>{const Gt=this.elRefMap.get(we);if(Gt){Gt.destroy(),this.elRefMap.delete(we);const vn=this.elEventsMap.get(we);vn&&(vn(),this.elEventsMap.delete(we))}Fe()}))}}const Rn=(lt,Be,we,Fe,Gt,vn,Ie,mt,Tt,En,si,Ai)=>{const Ri=v.zZn.create({providers:no(Tt),parent:we}),pi=(0,v.a0P)(mt,{environmentInjector:Be,elementInjector:Ri}),Ti=pi.instance,vr=pi.location.nativeElement;if(Tt)if(si&&void 0!==Ti[si]&&console.error(`[Ionic Error]: ${si} is a reserved property when using ${Ie.tagName.toLowerCase()}. Rename or remove the "${si}" property from ${mt.name}.`),!0===Ai&&void 0!==pi.setInput){const{modal:gr,popover:Nr,..._o}=Tt;for(const yo in _o)pi.setInput(yo,_o[yo]);void 0!==gr&&Object.assign(Ti,{modal:gr}),void 0!==Nr&&Object.assign(Ti,{popover:Nr})}else Object.assign(Ti,Tt);if(En)for(const gr of En)vr.classList.add(gr);const Io=Oi(lt,Ti,vr);return Ie.appendChild(vr),Fe.attachView(pi.hostView),Gt.set(vr,pi),vn.set(vr,Io),vr},Ci=[ie.L,ie.a,ie.b,ie.c,ie.d],Oi=(lt,Be,we)=>lt.run(()=>{const Fe=Ci.filter(Gt=>"function"==typeof Be[Gt]).map(Gt=>{const vn=Ie=>Be[Gt](Ie.detail);return we.addEventListener(Gt,vn),()=>we.removeEventListener(Gt,vn)});return()=>Fe.forEach(Gt=>Gt())}),ei=new v.nKC("NavParamsToken"),no=lt=>[{provide:ei,useValue:lt},{provide:Se,useFactory:mo,deps:[ei]}],mo=lt=>new Se(lt),mr=(lt,Be)=>{const we=lt.prototype;Be.forEach(Fe=>{Object.defineProperty(we,Fe,{get(){return this.el[Fe]},set(Gt){this.z.runOutsideAngular(()=>this.el[Fe]=Gt)}})})},$n=(lt,Be)=>{const we=lt.prototype;Be.forEach(Fe=>{we[Fe]=function(){const Gt=arguments;return this.z.runOutsideAngular(()=>this.el[Fe].apply(this.el,Gt))}})},ar=(lt,Be,we)=>{we.forEach(Fe=>lt[Fe]=(0,$e.R)(Be,Fe))};function gn(lt){return function(we){const{defineCustomElementFn:Fe,inputs:Gt,methods:vn}=lt;return void 0!==Fe&&Fe(),Gt&&mr(we,Gt),vn&&$n(we,vn),we}}const ii=["alignment","animated","arrow","keepContentsMounted","backdropDismiss","cssClass","dismissOnSelect","enterAnimation","event","focusTrap","isOpen","keyboardClose","leaveAnimation","mode","showBackdrop","translucent","trigger","triggerAction","reference","size","side"],oi=["present","dismiss","onDidDismiss","onWillDismiss"];let Yi=(()=>{let lt=class CC{z;template;isCmpOpen=!1;el;constructor(we,Fe,Gt){this.z=Gt,this.el=Fe.nativeElement,this.el.addEventListener("ionMount",()=>{this.isCmpOpen=!0,we.detectChanges()}),this.el.addEventListener("didDismiss",()=>{this.isCmpOpen=!1,we.detectChanges()}),ar(this,this.el,["ionPopoverDidPresent","ionPopoverWillPresent","ionPopoverWillDismiss","ionPopoverDidDismiss","didPresent","willPresent","willDismiss","didDismiss"])}static \u0275fac=function(Fe){return new(Fe||CC)(v.rXU(v.gRc),v.rXU(v.aKT),v.rXU(v.SKi))};static \u0275dir=v.FsC({type:CC,selectors:[["ion-popover"]],contentQueries:function(Fe,Gt,vn){if(1&Fe&&v.wni(vn,v.C4Q,5),2&Fe){let Ie;v.mGM(Ie=v.lsd())&&(Gt.template=Ie.first)}},inputs:{alignment:"alignment",animated:"animated",arrow:"arrow",keepContentsMounted:"keepContentsMounted",backdropDismiss:"backdropDismiss",cssClass:"cssClass",dismissOnSelect:"dismissOnSelect",enterAnimation:"enterAnimation",event:"event",focusTrap:"focusTrap",isOpen:"isOpen",keyboardClose:"keyboardClose",leaveAnimation:"leaveAnimation",mode:"mode",showBackdrop:"showBackdrop",translucent:"translucent",trigger:"trigger",triggerAction:"triggerAction",reference:"reference",size:"size",side:"side"}})};return lt=(0,Kn.Cg)([gn({inputs:ii,methods:oi})],lt),lt})();const pr=["animated","keepContentsMounted","backdropBreakpoint","backdropDismiss","breakpoints","canDismiss","cssClass","enterAnimation","event","focusTrap","handle","handleBehavior","initialBreakpoint","isOpen","keyboardClose","leaveAnimation","mode","presentingElement","showBackdrop","translucent","trigger"],io=["present","dismiss","onDidDismiss","onWillDismiss","setCurrentBreakpoint","getCurrentBreakpoint"];let ao=(()=>{let lt=class IC{z;template;isCmpOpen=!1;el;constructor(we,Fe,Gt){this.z=Gt,this.el=Fe.nativeElement,this.el.addEventListener("ionMount",()=>{this.isCmpOpen=!0,we.detectChanges()}),this.el.addEventListener("didDismiss",()=>{this.isCmpOpen=!1,we.detectChanges()}),ar(this,this.el,["ionModalDidPresent","ionModalWillPresent","ionModalWillDismiss","ionModalDidDismiss","ionBreakpointDidChange","didPresent","willPresent","willDismiss","didDismiss"])}static \u0275fac=function(Fe){return new(Fe||IC)(v.rXU(v.gRc),v.rXU(v.aKT),v.rXU(v.SKi))};static \u0275dir=v.FsC({type:IC,selectors:[["ion-modal"]],contentQueries:function(Fe,Gt,vn){if(1&Fe&&v.wni(vn,v.C4Q,5),2&Fe){let Ie;v.mGM(Ie=v.lsd())&&(Gt.template=Ie.first)}},inputs:{animated:"animated",keepContentsMounted:"keepContentsMounted",backdropBreakpoint:"backdropBreakpoint",backdropDismiss:"backdropDismiss",breakpoints:"breakpoints",canDismiss:"canDismiss",cssClass:"cssClass",enterAnimation:"enterAnimation",event:"event",focusTrap:"focusTrap",handle:"handle",handleBehavior:"handleBehavior",initialBreakpoint:"initialBreakpoint",isOpen:"isOpen",keyboardClose:"keyboardClose",leaveAnimation:"leaveAnimation",mode:"mode",presentingElement:"presentingElement",showBackdrop:"showBackdrop",translucent:"translucent",trigger:"trigger"}})};return lt=(0,Kn.Cg)([gn({inputs:pr,methods:io})],lt),lt})();const co=(lt,Be)=>((lt=lt.filter(we=>we.stackId!==Be.stackId)).push(Be),lt),bo=(lt,Be)=>{const we=lt.createUrlTree(["."],{relativeTo:Be});return lt.serializeUrl(we)},Bn=(lt,Be)=>!Be||lt.stackId!==Be.stackId,Cn=(lt,Be)=>{if(!lt)return;const we=At(Be);for(let Fe=0;Fe<we.length;Fe++){if(Fe>=lt.length)return we[Fe];if(we[Fe]!==lt[Fe])return}},At=lt=>lt.split("/").map(Be=>Be.trim()).filter(Be=>""!==Be),an=lt=>{lt&&(lt.ref.destroy(),lt.unlistenEvents())};class pt{containerEl;router;navCtrl;zone;location;views=[];runningTask;skipTransition=!1;tabsPrefix;activeView;nextId=0;constructor(Be,we,Fe,Gt,vn,Ie){this.containerEl=we,this.router=Fe,this.navCtrl=Gt,this.zone=vn,this.location=Ie,this.tabsPrefix=void 0!==Be?At(Be):void 0}createView(Be,we){const Fe=bo(this.router,we),Gt=Be?.location?.nativeElement,vn=Oi(this.zone,Be.instance,Gt);return{id:this.nextId++,stackId:Cn(this.tabsPrefix,Fe),unlistenEvents:vn,element:Gt,ref:Be,url:Fe}}getExistingView(Be){const we=bo(this.router,Be),Fe=this.views.find(Gt=>Gt.url===we);return Fe&&Fe.ref.changeDetectorRef.reattach(),Fe}setActive(Be){const we=this.navCtrl.consumeTransition();let{direction:Fe,animation:Gt,animationBuilder:vn}=we;const Ie=this.activeView,mt=Bn(Be,Ie);mt&&(Fe="back",Gt=void 0);const Tt=this.views.slice();let En;const si=this.router;si.getCurrentNavigation?En=si.getCurrentNavigation():si.navigations?.value&&(En=si.navigations.value),En?.extras?.replaceUrl&&this.views.length>0&&this.views.splice(-1,1);const Ai=this.views.includes(Be),Ri=this.insertView(Be,Fe);Ai||Be.ref.changeDetectorRef.detectChanges();const pi=Be.animationBuilder;return void 0===vn&&"back"===Fe&&!mt&&void 0!==pi&&(vn=pi),Ie&&(Ie.animationBuilder=vn),this.zone.runOutsideAngular(()=>this.wait(()=>(Ie&&Ie.ref.changeDetectorRef.detach(),Be.ref.changeDetectorRef.reattach(),this.transition(Be,Ie,Gt,this.canGoBack(1),!1,vn).then(()=>On(Be,Ri,Tt,this.location,this.zone)).then(()=>({enteringView:Be,direction:Fe,animation:Gt,tabSwitch:mt})))))}canGoBack(Be,we=this.getActiveStackId()){return this.getStack(we).length>Be}pop(Be,we=this.getActiveStackId()){return this.zone.run(()=>{const Fe=this.getStack(we);if(Fe.length<=Be)return Promise.resolve(!1);const Gt=Fe[Fe.length-Be-1];let vn=Gt.url;const Ie=Gt.savedData;if(Ie){const Tt=Ie.get("primary");Tt?.route?._routerState?.snapshot.url&&(vn=Tt.route._routerState.snapshot.url)}const{animationBuilder:mt}=this.navCtrl.consumeTransition();return this.navCtrl.navigateBack(vn,{...Gt.savedExtras,animation:mt}).then(()=>!0)})}startBackTransition(){const Be=this.activeView;if(Be){const we=this.getStack(Be.stackId),Fe=we[we.length-2],Gt=Fe.animationBuilder;return this.wait(()=>this.transition(Fe,Be,"back",this.canGoBack(2),!0,Gt))}return Promise.resolve()}endBackTransition(Be){Be?(this.skipTransition=!0,this.pop(1)):this.activeView&&Ze(this.activeView,this.views,this.views,this.location,this.zone)}getLastUrl(Be){const we=this.getStack(Be);return we.length>0?we[we.length-1]:void 0}getRootUrl(Be){const we=this.getStack(Be);return we.length>0?we[0]:void 0}getActiveStackId(){return this.activeView?this.activeView.stackId:void 0}getActiveView(){return this.activeView}hasRunningTask(){return void 0!==this.runningTask}destroy(){this.containerEl=void 0,this.views.forEach(an),this.activeView=void 0,this.views=[]}getStack(Be){return this.views.filter(we=>we.stackId===Be)}insertView(Be,we){return this.activeView=Be,this.views=((lt,Be,we)=>"root"===we?co(lt,Be):"forward"===we?((lt,Be)=>(lt.indexOf(Be)>=0?lt=lt.filter(Fe=>Fe.stackId!==Be.stackId||Fe.id<=Be.id):lt.push(Be),lt))(lt,Be):((lt,Be)=>lt.indexOf(Be)>=0?lt.filter(Fe=>Fe.stackId!==Be.stackId||Fe.id<=Be.id):co(lt,Be))(lt,Be))(this.views,Be,we),this.views.slice()}transition(Be,we,Fe,Gt,vn,Ie){if(this.skipTransition)return this.skipTransition=!1,Promise.resolve(!1);if(we===Be)return Promise.resolve(!1);const mt=Be?Be.element:void 0,Tt=we?we.element:void 0,En=this.containerEl;return mt&&mt!==Tt&&(mt.classList.add("ion-page"),mt.classList.add("ion-page-invisible"),En.commit)?En.commit(mt,Tt,{duration:void 0===Fe?0:void 0,direction:Fe,showGoBack:Gt,progressAnimation:vn,animationBuilder:Ie}):Promise.resolve(!1)}wait(Be){var we=this;return(0,g.A)(function*(){void 0!==we.runningTask&&(yield we.runningTask,we.runningTask=void 0);const Fe=we.runningTask=Be();return Fe.finally(()=>we.runningTask=void 0),Fe})()}}const On=(lt,Be,we,Fe,Gt)=>"function"==typeof requestAnimationFrame?new Promise(vn=>{requestAnimationFrame(()=>{Ze(lt,Be,we,Fe,Gt),vn()})}):Promise.resolve(),Ze=(lt,Be,we,Fe,Gt)=>{Gt.run(()=>we.filter(vn=>!Be.includes(vn)).forEach(an)),Be.forEach(vn=>{const mt=Fe.path().split("?")[0].split("#")[0];if(vn!==lt&&vn.url!==mt){const Tt=vn.element;Tt.setAttribute("aria-hidden","true"),Tt.classList.add("ion-page-hidden"),vn.ref.changeDetectorRef.detach()}})};let Ln=(()=>{class lt{parentOutlet;nativeEl;activatedView=null;tabsPrefix;_swipeGesture;stackCtrl;proxyMap=new WeakMap;currentActivatedRoute$=new Et.t(null);activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=me.Xk;stackWillChange=new v.bkB;stackDidChange=new v.bkB;activateEvents=new v.bkB;deactivateEvents=new v.bkB;parentContexts=(0,v.WQX)(me.Zp);location=(0,v.WQX)(v.c1b);environmentInjector=(0,v.WQX)(v.uvJ);inputBinder=(0,v.WQX)(ki,{optional:!0});supportsBindingToComponentInputs=!0;config=(0,v.WQX)(An);navCtrl=(0,v.WQX)(ut);set animation(we){this.nativeEl.animation=we}set animated(we){this.nativeEl.animated=we}set swipeGesture(we){this._swipeGesture=we,this.nativeEl.swipeHandler=we?{canStart:()=>this.stackCtrl.canGoBack(1)&&!this.stackCtrl.hasRunningTask(),onStart:()=>this.stackCtrl.startBackTransition(),onEnd:Fe=>this.stackCtrl.endBackTransition(Fe)}:void 0}constructor(we,Fe,Gt,vn,Ie,mt,Tt,En){this.parentOutlet=En,this.nativeEl=vn.nativeElement,this.name=we||me.Xk,this.tabsPrefix="true"===Fe?bo(Ie,Tt):void 0,this.stackCtrl=new pt(this.tabsPrefix,this.nativeEl,Ie,this.navCtrl,mt,Gt),this.parentContexts.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.stackCtrl.destroy(),this.inputBinder?.unsubscribeFromRouteData(this)}getContext(){return this.parentContexts.getContext(this.name)}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(!this.activated){const we=this.getContext();we?.route&&this.activateWith(we.route,we.injector)}new Promise(we=>((lt,Be)=>{lt.componentOnReady?lt.componentOnReady().then(we=>Be(we)):(lt=>{"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(lt):"function"==typeof requestAnimationFrame?requestAnimationFrame(lt):setTimeout(lt)})(()=>Be(lt))})(this.nativeEl,we)).then(()=>{void 0===this._swipeGesture&&(this.swipeGesture=this.config.getBoolean("swipeBackEnabled","ios"===this.nativeEl.mode))})}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){throw new Error("incompatible reuse strategy")}attach(we,Fe){throw new Error("incompatible reuse strategy")}deactivate(){if(this.activated){if(this.activatedView){const Fe=this.getContext();this.activatedView.savedData=new Map(Fe.children.contexts);const Gt=this.activatedView.savedData.get("primary");if(Gt&&Fe.route&&(Gt.route={...Fe.route}),this.activatedView.savedExtras={},Fe.route){const vn=Fe.route.snapshot;this.activatedView.savedExtras.queryParams=vn.queryParams,this.activatedView.savedExtras.fragment=vn.fragment}}const we=this.component;this.activatedView=null,this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(we)}}activateWith(we,Fe){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=we;let Gt,vn=this.stackCtrl.getExistingView(we);if(vn){Gt=this.activated=vn.ref;const mt=vn.savedData;mt&&(this.getContext().children.contexts=mt),this.updateActivatedRouteProxy(Gt.instance,we)}else{const mt=we._futureSnapshot,Tt=this.parentContexts.getOrCreateContext(this.name).children,En=new Et.t(null),si=this.createActivatedRouteProxy(En,we),Ai=new Dn(si,Tt,this.location.injector);Gt=this.activated=this.outletContent.createComponent(mt.routeConfig.component??mt.component,{index:this.outletContent.length,injector:Ai,environmentInjector:Fe??this.environmentInjector}),En.next(Gt.instance),vn=this.stackCtrl.createView(this.activated,we),this.proxyMap.set(Gt.instance,si),this.currentActivatedRoute$.next({component:Gt.instance,activatedRoute:we})}this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activatedView=vn,this.navCtrl.setTopOutlet(this);const Ie=this.stackCtrl.getActiveView();this.stackWillChange.emit({enteringView:vn,tabSwitch:Bn(vn,Ie)}),this.stackCtrl.setActive(vn).then(mt=>{this.activateEvents.emit(Gt.instance),this.stackDidChange.emit(mt)})}canGoBack(we=1,Fe){return this.stackCtrl.canGoBack(we,Fe)}pop(we=1,Fe){return this.stackCtrl.pop(we,Fe)}getLastUrl(we){const Fe=this.stackCtrl.getLastUrl(we);return Fe?Fe.url:void 0}getLastRouteView(we){return this.stackCtrl.getLastUrl(we)}getRootView(we){return this.stackCtrl.getRootUrl(we)}getActiveStackId(){return this.stackCtrl.getActiveStackId()}createActivatedRouteProxy(we,Fe){const Gt=new me.nX;return Gt._futureSnapshot=Fe._futureSnapshot,Gt._routerState=Fe._routerState,Gt.snapshot=Fe.snapshot,Gt.outlet=Fe.outlet,Gt.component=Fe.component,Gt._paramMap=this.proxyObservable(we,"paramMap"),Gt._queryParamMap=this.proxyObservable(we,"queryParamMap"),Gt.url=this.proxyObservable(we,"url"),Gt.params=this.proxyObservable(we,"params"),Gt.queryParams=this.proxyObservable(we,"queryParams"),Gt.fragment=this.proxyObservable(we,"fragment"),Gt.data=this.proxyObservable(we,"data"),Gt}proxyObservable(we,Fe){return we.pipe((0,Kt.p)(Gt=>!!Gt),(0,at.n)(Gt=>this.currentActivatedRoute$.pipe((0,Kt.p)(vn=>null!==vn&&vn.component===Gt),(0,at.n)(vn=>vn&&vn.activatedRoute[Fe]),function vt(lt,Be=ve.D){return lt=lt??_n,(0,Me.N)((we,Fe)=>{let Gt,vn=!0;we.subscribe((0,fe._)(Fe,Ie=>{const mt=Be(Ie);(vn||!lt(Gt,mt))&&(vn=!1,Gt=mt,Fe.next(Ie))}))})}())))}updateActivatedRouteProxy(we,Fe){const Gt=this.proxyMap.get(we);if(!Gt)throw new Error("Could not find activated route proxy for view");Gt._futureSnapshot=Fe._futureSnapshot,Gt._routerState=Fe._routerState,Gt.snapshot=Fe.snapshot,Gt.outlet=Fe.outlet,Gt.component=Fe.component,this.currentActivatedRoute$.next({component:we,activatedRoute:Fe})}static \u0275fac=function(Fe){return new(Fe||lt)(v.kS0("name"),v.kS0("tabs"),v.rXU(a.aZ),v.rXU(v.aKT),v.rXU(me.Ix),v.rXU(v.SKi),v.rXU(me.nX),v.rXU(lt,12))};static \u0275dir=v.FsC({type:lt,selectors:[["ion-router-outlet"]],inputs:{animated:"animated",animation:"animation",mode:"mode",swipeGesture:"swipeGesture",name:"name"},outputs:{stackWillChange:"stackWillChange",stackDidChange:"stackDidChange",activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]})}return lt})();class Dn{route;childContexts;parent;constructor(Be,we,Fe){this.route=Be,this.childContexts=we,this.parent=Fe}get(Be,we){return Be===me.nX?this.route:Be===me.Zp?this.childContexts:this.parent.get(Be,we)}}const ki=new v.nKC("");let Fi=(()=>{class lt{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(we){this.unsubscribeFromRouteData(we),this.subscribeToRouteData(we)}unsubscribeFromRouteData(we){this.outletDataSubscriptions.get(we)?.unsubscribe(),this.outletDataSubscriptions.delete(we)}subscribeToRouteData(we){const{activatedRoute:Fe}=we,Gt=(0,cn.z)([Fe.queryParams,Fe.params,Fe.data]).pipe((0,at.n)(([vn,Ie,mt],Tt)=>(mt={...vn,...Ie,...mt},0===Tt?(0,fn.of)(mt):Promise.resolve(mt)))).subscribe(vn=>{if(!we.isActivated||!we.activatedComponentRef||we.activatedRoute!==Fe||null===Fe.component)return void this.unsubscribeFromRouteData(we);const Ie=(0,v.HJs)(Fe.component);if(Ie)for(const{templateName:mt}of Ie.inputs)we.activatedComponentRef.setInput(mt,vn[mt]);else this.unsubscribeFromRouteData(we)});this.outletDataSubscriptions.set(we,Gt)}static \u0275fac=function(Fe){return new(Fe||lt)};static \u0275prov=v.jDH({token:lt,factory:lt.\u0275fac})}return lt})();const wt=()=>({provide:ki,useFactory:te,deps:[me.Ix]});function te(lt){return lt?.componentInputBindingEnabled?new Fi:null}const ue=["color","defaultHref","disabled","icon","mode","routerAnimation","text","type"];let Ge=(()=>{let lt=class TC{routerOutlet;navCtrl;config;r;z;el;constructor(we,Fe,Gt,vn,Ie,mt){this.routerOutlet=we,this.navCtrl=Fe,this.config=Gt,this.r=vn,this.z=Ie,mt.detach(),this.el=this.r.nativeElement}onClick(we){const Fe=this.defaultHref||this.config.get("backButtonDefaultHref");this.routerOutlet?.canGoBack()?(this.navCtrl.setDirection("back",void 0,void 0,this.routerAnimation),this.routerOutlet.pop(),we.preventDefault()):null!=Fe&&(this.navCtrl.navigateBack(Fe,{animation:this.routerAnimation}),we.preventDefault())}static \u0275fac=function(Fe){return new(Fe||TC)(v.rXU(Ln,8),v.rXU(ut),v.rXU(An),v.rXU(v.aKT),v.rXU(v.SKi),v.rXU(v.gRc))};static \u0275dir=v.FsC({type:TC,hostBindings:function(Fe,Gt){1&Fe&&v.bIt("click",function(Ie){return Gt.onClick(Ie)})},inputs:{color:"color",defaultHref:"defaultHref",disabled:"disabled",icon:"icon",mode:"mode",routerAnimation:"routerAnimation",text:"text",type:"type"}})};return lt=(0,Kn.Cg)([gn({inputs:ue})],lt),lt})(),bt=(()=>{class lt{locationStrategy;navCtrl;elementRef;router;routerLink;routerDirection="forward";routerAnimation;constructor(we,Fe,Gt,vn,Ie){this.locationStrategy=we,this.navCtrl=Fe,this.elementRef=Gt,this.router=vn,this.routerLink=Ie}ngOnInit(){this.updateTargetUrlAndHref()}ngOnChanges(){this.updateTargetUrlAndHref()}updateTargetUrlAndHref(){if(this.routerLink?.urlTree){const we=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.routerLink.urlTree));this.elementRef.nativeElement.href=we}}onClick(we){this.navCtrl.setDirection(this.routerDirection,void 0,void 0,this.routerAnimation),we.preventDefault()}static \u0275fac=function(Fe){return new(Fe||lt)(v.rXU(a.hb),v.rXU(ut),v.rXU(v.aKT),v.rXU(me.Ix),v.rXU(me.Wk,8))};static \u0275dir=v.FsC({type:lt,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(Fe,Gt){1&Fe&&v.bIt("click",function(Ie){return Gt.onClick(Ie)})},inputs:{routerDirection:"routerDirection",routerAnimation:"routerAnimation"},features:[v.OA$]})}return lt})(),gt=(()=>{class lt{locationStrategy;navCtrl;elementRef;router;routerLink;routerDirection="forward";routerAnimation;constructor(we,Fe,Gt,vn,Ie){this.locationStrategy=we,this.navCtrl=Fe,this.elementRef=Gt,this.router=vn,this.routerLink=Ie}ngOnInit(){this.updateTargetUrlAndHref()}ngOnChanges(){this.updateTargetUrlAndHref()}updateTargetUrlAndHref(){if(this.routerLink?.urlTree){const we=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.routerLink.urlTree));this.elementRef.nativeElement.href=we}}onClick(){this.navCtrl.setDirection(this.routerDirection,void 0,void 0,this.routerAnimation)}static \u0275fac=function(Fe){return new(Fe||lt)(v.rXU(a.hb),v.rXU(ut),v.rXU(v.aKT),v.rXU(me.Ix),v.rXU(me.Wk,8))};static \u0275dir=v.FsC({type:lt,selectors:[["a","routerLink",""],["area","routerLink",""]],hostBindings:function(Fe,Gt){1&Fe&&v.bIt("click",function(){return Gt.onClick()})},inputs:{routerDirection:"routerDirection",routerAnimation:"routerAnimation"},features:[v.OA$]})}return lt})();const jt=["animated","animation","root","rootParams","swipeGesture"],rn=["push","insert","insertPages","pop","popTo","popToRoot","removeIndex","setRoot","setPages","getActive","getByIndex","canGoBack","getPrevious"];let Ft=(()=>{let lt=class DC{z;el;constructor(we,Fe,Gt,vn,Ie,mt){this.z=Ie,mt.detach(),this.el=we.nativeElement,we.nativeElement.delegate=vn.create(Fe,Gt),ar(this,this.el,["ionNavDidChange","ionNavWillChange"])}static \u0275fac=function(Fe){return new(Fe||DC)(v.rXU(v.aKT),v.rXU(v.uvJ),v.rXU(v.zZn),v.rXU(Bt),v.rXU(v.SKi),v.rXU(v.gRc))};static \u0275dir=v.FsC({type:DC,inputs:{animated:"animated",animation:"animation",root:"root",rootParams:"rootParams",swipeGesture:"swipeGesture"}})};return lt=(0,Kn.Cg)([gn({inputs:jt,methods:rn})],lt),lt})(),on=(()=>{class lt{navCtrl;tabsInner;ionTabsWillChange=new v.bkB;ionTabsDidChange=new v.bkB;tabBarSlot="bottom";constructor(we){this.navCtrl=we}ngAfterContentInit(){this.detectSlotChanges()}ngAfterContentChecked(){this.detectSlotChanges()}onStackWillChange({enteringView:we,tabSwitch:Fe}){const Gt=we.stackId;Fe&&void 0!==Gt&&this.ionTabsWillChange.emit({tab:Gt})}onStackDidChange({enteringView:we,tabSwitch:Fe}){const Gt=we.stackId;Fe&&void 0!==Gt&&(this.tabBar&&(this.tabBar.selectedTab=Gt),this.ionTabsDidChange.emit({tab:Gt}))}select(we){const Fe="string"==typeof we,Gt=Fe?we:we.detail.tab,vn=this.outlet.getActiveStackId()===Gt,Ie=`${this.outlet.tabsPrefix}/${Gt}`;if(Fe||we.stopPropagation(),vn){const mt=this.outlet.getActiveStackId();if(this.outlet.getLastRouteView(mt)?.url===Ie)return;const En=this.outlet.getRootView(Gt);return this.navCtrl.navigateRoot(Ie,{...En&&Ie===En.url&&En.savedExtras,animated:!0,animationDirection:"back"})}{const mt=this.outlet.getLastRouteView(Gt),Tt=mt?.url||Ie,En=mt?.savedExtras;return this.navCtrl.navigateRoot(Tt,{...En,animated:!0,animationDirection:"back"})}}getSelected(){return this.outlet.getActiveStackId()}detectSlotChanges(){this.tabBars.forEach(we=>{const Fe=we.el.getAttribute("slot");Fe!==this.tabBarSlot&&(this.tabBarSlot=Fe,this.relocateTabBar())})}relocateTabBar(){const we=this.tabBar.el;"top"===this.tabBarSlot?this.tabsInner.nativeElement.before(we):this.tabsInner.nativeElement.after(we)}static \u0275fac=function(Fe){return new(Fe||lt)(v.rXU(ut))};static \u0275dir=v.FsC({type:lt,selectors:[["ion-tabs"]],viewQuery:function(Fe,Gt){if(1&Fe&&v.GBs(wn,7,v.aKT),2&Fe){let vn;v.mGM(vn=v.lsd())&&(Gt.tabsInner=vn.first)}},hostBindings:function(Fe,Gt){1&Fe&&v.bIt("ionTabButtonClick",function(Ie){return Gt.select(Ie)})},outputs:{ionTabsWillChange:"ionTabsWillChange",ionTabsDidChange:"ionTabsDidChange"}})}return lt})();const Un=lt=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(lt):"function"==typeof requestAnimationFrame?requestAnimationFrame(lt):setTimeout(lt);let zn=(()=>{class lt{injector;elementRef;onChange=()=>{};onTouched=()=>{};lastValue;statusChanges;constructor(we,Fe){this.injector=we,this.elementRef=Fe}writeValue(we){this.elementRef.nativeElement.value=this.lastValue=we,Ei(this.elementRef)}handleValueChange(we,Fe){we===this.elementRef.nativeElement&&(Fe!==this.lastValue&&(this.lastValue=Fe,this.onChange(Fe)),Ei(this.elementRef))}_handleBlurEvent(we){we===this.elementRef.nativeElement&&(this.onTouched(),Ei(this.elementRef))}registerOnChange(we){this.onChange=we}registerOnTouched(we){this.onTouched=we}setDisabledState(we){this.elementRef.nativeElement.disabled=we}ngOnDestroy(){this.statusChanges&&this.statusChanges.unsubscribe()}ngAfterViewInit(){let we;try{we=this.injector.get(Re.vO)}catch{}if(!we)return;we.statusChanges&&(this.statusChanges=we.statusChanges.subscribe(()=>Ei(this.elementRef)));const Fe=we.control;Fe&&["markAsTouched","markAllAsTouched","markAsUntouched","markAsDirty","markAsPristine"].forEach(vn=>{if(typeof Fe[vn]<"u"){const Ie=Fe[vn].bind(Fe);Fe[vn]=(...mt)=>{Ie(...mt),Ei(this.elementRef)}}})}static \u0275fac=function(Fe){return new(Fe||lt)(v.rXU(v.zZn),v.rXU(v.aKT))};static \u0275dir=v.FsC({type:lt,hostBindings:function(Fe,Gt){1&Fe&&v.bIt("ionBlur",function(Ie){return Gt._handleBlurEvent(Ie.target)})}})}return lt})();const Ei=lt=>{Un(()=>{const Be=lt.nativeElement,we=null!=Be.value&&Be.value.toString().length>0,Fe=Ui(Be);qi(Be,Fe);const Gt=Be.closest("ion-item");Gt&&qi(Gt,we?[...Fe,"item-has-value"]:Fe)})},Ui=lt=>{const Be=lt.classList,we=[];for(let Fe=0;Fe<Be.length;Fe++){const Gt=Be.item(Fe);null!==Gt&&Ki(Gt,"ng-")&&we.push(`ion-${Gt.substring(3)}`)}return we},qi=(lt,Be)=>{const we=lt.classList;we.remove("ion-valid","ion-invalid","ion-touched","ion-untouched","ion-dirty","ion-pristine"),we.add(...Be)},Ki=(lt,Be)=>lt.substring(0,Be.length)===Be;class Gi{shouldDetach(Be){return!1}shouldAttach(Be){return!1}store(Be,we){}retrieve(Be){return null}shouldReuseRoute(Be,we){if(Be.routeConfig!==we.routeConfig)return!1;const Fe=Be.params,Gt=we.params,vn=Object.keys(Fe),Ie=Object.keys(Gt);if(vn.length!==Ie.length)return!1;for(const mt of vn)if(Gt[mt]!==Fe[mt])return!1;return!0}}class nr{ctrl;constructor(Be){this.ctrl=Be}create(Be){return this.ctrl.create(Be||{})}dismiss(Be,we,Fe){return this.ctrl.dismiss(Be,we,Fe)}getTop(){return this.ctrl.getTop()}}},9465:(vi,Vt,B)=>{"use strict";B.d(Vt,{GD:()=>Ss,hG:()=>xs,hB:()=>Kn,U1:()=>Jn,mC:()=>jn,el:()=>Io,In:()=>ut,Jm:()=>pn,QW:()=>An,b_:()=>Ct,I9:()=>Qt,ME:()=>Se,HW:()=>Bt,ZB:()=>Ci,hU:()=>Oi,W9:()=>ei,Q8:()=>mr,YW:()=>$n,OL:()=>ar,M0:()=>gn,lO:()=>ii,eU:()=>oi,iq:()=>Yi,$w:()=>ro,uz:()=>Po,he:()=>an,nf:()=>pt,AF:()=>On,jL:()=>ko,oS:()=>Ln,MC:()=>Dn,cA:()=>ki,T6:()=>Gr,JI:()=>wt,Ob:()=>Ft,To:()=>on,Ki:()=>Un,Rg:()=>Ti,ln:()=>qi,S1:()=>Ki,Gp:()=>Gi,eP:()=>nr,Nm:()=>lt,Ip:()=>Be,w2:()=>Fe,HP:()=>Gt,nc:()=>Tt,Zx:()=>En,BC:()=>si,BY:()=>Ri,ai:()=>pi,bv:()=>sl,Xi:()=>ma,W3:()=>ks,su:()=>Kt,N7:()=>Nr,Je:()=>at,Gw:()=>ve,K_:()=>ol});var g=B(3953),v=B(9417),me=B(3656),a=B(1635),Z=B(3726),ie=B(177),T=B(1470),je=(B(9986),B(1331),B(9856),B(361),B(8607),B(4921)),We=B(464),ht=(B(6073),B(1070)),be=(B(8476),B(8393));B(1970),B(8669);var Ue=B(467);const $t=je.i,nt=function(){var pe=(0,Ue.A)(function*(kr,Te){if(!(typeof window>"u"))return yield $t(),(0,be.b)(JSON.parse('[["ion-menu_3",[[33,"ion-menu-button",{"color":[513],"disabled":[4],"menu":[1],"autoHide":[4,"auto-hide"],"type":[1],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]],[33,"ion-menu",{"contentId":[513,"content-id"],"menuId":[513,"menu-id"],"type":[1025],"disabled":[1028],"side":[513],"swipeGesture":[4,"swipe-gesture"],"maxEdgeStart":[2,"max-edge-start"],"isPaneVisible":[32],"isEndSide":[32],"isOpen":[64],"isActive":[64],"open":[64],"close":[64],"toggle":[64],"setOpen":[64]},[[16,"ionSplitPaneVisible","onSplitPaneChanged"],[2,"click","onBackdropClick"]],{"type":["typeChanged"],"disabled":["disabledChanged"],"side":["sideChanged"],"swipeGesture":["swipeGestureChanged"]}],[1,"ion-menu-toggle",{"menu":[1],"autoHide":[4,"auto-hide"],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]]]],["ion-input-password-toggle",[[33,"ion-input-password-toggle",{"color":[513],"showIcon":[1,"show-icon"],"hideIcon":[1,"hide-icon"],"type":[1025]},null,{"type":["onTypeChange"]}]]],["ion-fab_3",[[33,"ion-fab-button",{"color":[513],"activated":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1],"show":[4],"translucent":[4],"type":[1],"size":[1],"closeIcon":[1,"close-icon"]}],[1,"ion-fab",{"horizontal":[1],"vertical":[1],"edge":[4],"activated":[1028],"close":[64],"toggle":[64]},null,{"activated":["activatedChanged"]}],[1,"ion-fab-list",{"activated":[4],"side":[1]},null,{"activated":["activatedChanged"]}]]],["ion-refresher_2",[[0,"ion-refresher-content",{"pullingIcon":[1025,"pulling-icon"],"pullingText":[1,"pulling-text"],"refreshingSpinner":[1025,"refreshing-spinner"],"refreshingText":[1,"refreshing-text"]}],[32,"ion-refresher",{"pullMin":[2,"pull-min"],"pullMax":[2,"pull-max"],"closeDuration":[1,"close-duration"],"snapbackDuration":[1,"snapback-duration"],"pullFactor":[2,"pull-factor"],"disabled":[4],"nativeRefresher":[32],"state":[32],"complete":[64],"cancel":[64],"getProgress":[64]},null,{"disabled":["disabledChanged"]}]]],["ion-back-button",[[33,"ion-back-button",{"color":[513],"defaultHref":[1025,"default-href"],"disabled":[516],"icon":[1],"text":[1],"type":[1],"routerAnimation":[16]}]]],["ion-toast",[[33,"ion-toast",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"color":[513],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"duration":[2],"header":[1],"layout":[1],"message":[1],"keyboardClose":[4,"keyboard-close"],"position":[1],"positionAnchor":[1,"position-anchor"],"buttons":[16],"translucent":[4],"animated":[4],"icon":[1],"htmlAttributes":[16],"swipeGesture":[1,"swipe-gesture"],"isOpen":[4,"is-open"],"trigger":[1],"revealContentToScreenReader":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},null,{"swipeGesture":["swipeGestureChanged"],"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}]]],["ion-card_5",[[33,"ion-card",{"color":[513],"button":[4],"type":[1],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}],[32,"ion-card-content"],[33,"ion-card-header",{"color":[513],"translucent":[4]}],[33,"ion-card-subtitle",{"color":[513]}],[33,"ion-card-title",{"color":[513]}]]],["ion-item-option_3",[[33,"ion-item-option",{"color":[513],"disabled":[4],"download":[1],"expandable":[4],"href":[1],"rel":[1],"target":[1],"type":[1]}],[32,"ion-item-options",{"side":[1],"fireSwipeEvent":[64]}],[0,"ion-item-sliding",{"disabled":[4],"state":[32],"getOpenAmount":[64],"getSlidingRatio":[64],"open":[64],"close":[64],"closeOpened":[64]},null,{"disabled":["disabledChanged"]}]]],["ion-accordion_2",[[49,"ion-accordion",{"value":[1],"disabled":[4],"readonly":[4],"toggleIcon":[1,"toggle-icon"],"toggleIconSlot":[1,"toggle-icon-slot"],"state":[32],"isNext":[32],"isPrevious":[32]},null,{"value":["valueChanged"]}],[33,"ion-accordion-group",{"animated":[4],"multiple":[4],"value":[1025],"disabled":[4],"readonly":[4],"expand":[1],"requestAccordionToggle":[64],"getAccordions":[64]},[[0,"keydown","onKeydown"]],{"value":["valueChanged"],"disabled":["disabledChanged"],"readonly":["readonlyChanged"]}]]],["ion-infinite-scroll_2",[[32,"ion-infinite-scroll-content",{"loadingSpinner":[1025,"loading-spinner"],"loadingText":[1,"loading-text"]}],[0,"ion-infinite-scroll",{"threshold":[1],"disabled":[4],"position":[1],"isLoading":[32],"complete":[64]},null,{"threshold":["thresholdChanged"],"disabled":["disabledChanged"]}]]],["ion-reorder_2",[[33,"ion-reorder",null,[[2,"click","onClick"]]],[0,"ion-reorder-group",{"disabled":[4],"state":[32],"complete":[64]},null,{"disabled":["disabledChanged"]}]]],["ion-segment_2",[[33,"ion-segment-button",{"disabled":[1028],"layout":[1],"type":[1],"value":[8],"checked":[32],"setFocus":[64]},null,{"value":["valueChanged"]}],[33,"ion-segment",{"color":[513],"disabled":[4],"scrollable":[4],"swipeGesture":[4,"swipe-gesture"],"value":[1032],"selectOnFocus":[4,"select-on-focus"],"activated":[32]},[[0,"keydown","onKeyDown"]],{"color":["colorChanged"],"swipeGesture":["swipeGestureChanged"],"value":["valueChanged"],"disabled":["disabledChanged"]}]]],["ion-tab-bar_2",[[33,"ion-tab-button",{"disabled":[4],"download":[1],"href":[1],"rel":[1],"layout":[1025],"selected":[1028],"tab":[1],"target":[1]},[[8,"ionTabBarChanged","onTabBarChanged"]]],[33,"ion-tab-bar",{"color":[513],"selectedTab":[1,"selected-tab"],"translucent":[4],"keyboardVisible":[32]},null,{"selectedTab":["selectedTabChanged"]}]]],["ion-chip",[[33,"ion-chip",{"color":[513],"outline":[4],"disabled":[4]}]]],["ion-datetime-button",[[33,"ion-datetime-button",{"color":[513],"disabled":[516],"datetime":[1],"datetimePresentation":[32],"dateText":[32],"timeText":[32],"datetimeActive":[32],"selectedButton":[32]}]]],["ion-input",[[38,"ion-input",{"color":[513],"autocapitalize":[1],"autocomplete":[1],"autocorrect":[1],"autofocus":[4],"clearInput":[4,"clear-input"],"clearInputIcon":[1,"clear-input-icon"],"clearOnEdit":[4,"clear-on-edit"],"counter":[4],"counterFormatter":[16],"debounce":[2],"disabled":[516],"enterkeyhint":[1],"errorText":[1,"error-text"],"fill":[1],"inputmode":[1],"helperText":[1,"helper-text"],"label":[1],"labelPlacement":[1,"label-placement"],"max":[8],"maxlength":[2],"min":[8],"minlength":[2],"multiple":[4],"name":[1],"pattern":[1],"placeholder":[1],"readonly":[516],"required":[4],"shape":[1],"spellcheck":[4],"step":[1],"type":[1],"value":[1032],"hasFocus":[32],"setFocus":[64],"getInputElement":[64]},null,{"debounce":["debounceChanged"],"type":["onTypeChange"],"value":["valueChanged"]}]]],["ion-searchbar",[[34,"ion-searchbar",{"color":[513],"animated":[4],"autocapitalize":[1],"autocomplete":[1],"autocorrect":[1],"cancelButtonIcon":[1,"cancel-button-icon"],"cancelButtonText":[1,"cancel-button-text"],"clearIcon":[1,"clear-icon"],"debounce":[2],"disabled":[4],"inputmode":[1],"enterkeyhint":[1],"maxlength":[2],"minlength":[2],"name":[1],"placeholder":[1],"searchIcon":[1,"search-icon"],"showCancelButton":[1,"show-cancel-button"],"showClearButton":[1,"show-clear-button"],"spellcheck":[4],"type":[1],"value":[1025],"focused":[32],"noAnimate":[32],"setFocus":[64],"getInputElement":[64]},null,{"lang":["onLangChanged"],"dir":["onDirChanged"],"debounce":["debounceChanged"],"value":["valueChanged"],"showCancelButton":["showCancelButtonChanged"]}]]],["ion-toggle",[[33,"ion-toggle",{"color":[513],"name":[1],"checked":[1028],"disabled":[4],"value":[1],"enableOnOffLabels":[4,"enable-on-off-labels"],"labelPlacement":[1,"label-placement"],"justify":[1],"alignment":[1],"activated":[32]},null,{"disabled":["disabledChanged"]}]]],["ion-nav_2",[[1,"ion-nav",{"delegate":[16],"swipeGesture":[1028,"swipe-gesture"],"animated":[4],"animation":[16],"rootParams":[16],"root":[1],"push":[64],"insert":[64],"insertPages":[64],"pop":[64],"popTo":[64],"popToRoot":[64],"removeIndex":[64],"setRoot":[64],"setPages":[64],"setRouteId":[64],"getRouteId":[64],"getActive":[64],"getByIndex":[64],"canGoBack":[64],"getPrevious":[64],"getLength":[64]},null,{"swipeGesture":["swipeGestureChanged"],"root":["rootChanged"]}],[0,"ion-nav-link",{"component":[1],"componentProps":[16],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}]]],["ion-textarea",[[38,"ion-textarea",{"color":[513],"autocapitalize":[1],"autofocus":[4],"clearOnEdit":[4,"clear-on-edit"],"debounce":[2],"disabled":[4],"fill":[1],"inputmode":[1],"enterkeyhint":[1],"maxlength":[2],"minlength":[2],"name":[1],"placeholder":[1],"readonly":[4],"required":[4],"spellcheck":[4],"cols":[514],"rows":[2],"wrap":[1],"autoGrow":[516,"auto-grow"],"value":[1025],"counter":[4],"counterFormatter":[16],"errorText":[1,"error-text"],"helperText":[1,"helper-text"],"label":[1],"labelPlacement":[1,"label-placement"],"shape":[1],"hasFocus":[32],"setFocus":[64],"getInputElement":[64]},null,{"debounce":["debounceChanged"],"value":["valueChanged"]}]]],["ion-backdrop",[[33,"ion-backdrop",{"visible":[4],"tappable":[4],"stopPropagation":[4,"stop-propagation"]},[[2,"click","onMouseDown"]]]]],["ion-loading",[[34,"ion-loading",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"message":[1],"cssClass":[1,"css-class"],"duration":[2],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"spinner":[1025],"translucent":[4],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},null,{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}]]],["ion-breadcrumb_2",[[33,"ion-breadcrumb",{"collapsed":[4],"last":[4],"showCollapsedIndicator":[4,"show-collapsed-indicator"],"color":[1],"active":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"separator":[4],"target":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}],[33,"ion-breadcrumbs",{"color":[513],"maxItems":[2,"max-items"],"itemsBeforeCollapse":[2,"items-before-collapse"],"itemsAfterCollapse":[2,"items-after-collapse"],"collapsed":[32],"activeChanged":[32]},[[0,"collapsedClick","onCollapsedClick"]],{"maxItems":["maxItemsChanged"],"itemsBeforeCollapse":["maxItemsChanged"],"itemsAfterCollapse":["maxItemsChanged"]}]]],["ion-modal",[[33,"ion-modal",{"hasController":[4,"has-controller"],"overlayIndex":[2,"overlay-index"],"delegate":[16],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"breakpoints":[16],"initialBreakpoint":[2,"initial-breakpoint"],"backdropBreakpoint":[2,"backdrop-breakpoint"],"handle":[4],"handleBehavior":[1,"handle-behavior"],"component":[1],"componentProps":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"animated":[4],"presentingElement":[16],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"keepContentsMounted":[4,"keep-contents-mounted"],"focusTrap":[4,"focus-trap"],"canDismiss":[4,"can-dismiss"],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"setCurrentBreakpoint":[64],"getCurrentBreakpoint":[64]},null,{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}]]],["ion-route_4",[[0,"ion-route",{"url":[1],"component":[1],"componentProps":[16],"beforeLeave":[16],"beforeEnter":[16]},null,{"url":["onUpdate"],"component":["onUpdate"],"componentProps":["onComponentProps"]}],[0,"ion-route-redirect",{"from":[1],"to":[1]},null,{"from":["propDidChange"],"to":["propDidChange"]}],[0,"ion-router",{"root":[1],"useHash":[4,"use-hash"],"canTransition":[64],"push":[64],"back":[64],"printDebug":[64],"navChanged":[64]},[[8,"popstate","onPopState"],[4,"ionBackButton","onBackButton"]]],[1,"ion-router-link",{"color":[513],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}]]],["ion-avatar_3",[[33,"ion-avatar"],[33,"ion-badge",{"color":[513]}],[1,"ion-thumbnail"]]],["ion-col_3",[[1,"ion-col",{"offset":[1],"offsetXs":[1,"offset-xs"],"offsetSm":[1,"offset-sm"],"offsetMd":[1,"offset-md"],"offsetLg":[1,"offset-lg"],"offsetXl":[1,"offset-xl"],"pull":[1],"pullXs":[1,"pull-xs"],"pullSm":[1,"pull-sm"],"pullMd":[1,"pull-md"],"pullLg":[1,"pull-lg"],"pullXl":[1,"pull-xl"],"push":[1],"pushXs":[1,"push-xs"],"pushSm":[1,"push-sm"],"pushMd":[1,"push-md"],"pushLg":[1,"push-lg"],"pushXl":[1,"push-xl"],"size":[1],"sizeXs":[1,"size-xs"],"sizeSm":[1,"size-sm"],"sizeMd":[1,"size-md"],"sizeLg":[1,"size-lg"],"sizeXl":[1,"size-xl"]},[[9,"resize","onResize"]]],[1,"ion-grid",{"fixed":[4]}],[1,"ion-row"]]],["ion-tab_2",[[1,"ion-tab",{"active":[1028],"delegate":[16],"tab":[1],"component":[1],"setActive":[64]},null,{"active":["changeActive"]}],[1,"ion-tabs",{"useRouter":[1028,"use-router"],"selectedTab":[32],"select":[64],"getTab":[64],"getSelected":[64],"setRouteId":[64],"getRouteId":[64]}]]],["ion-img",[[1,"ion-img",{"alt":[1],"src":[1],"loadSrc":[32],"loadError":[32]},null,{"src":["srcChanged"]}]]],["ion-progress-bar",[[33,"ion-progress-bar",{"type":[1],"reversed":[4],"value":[2],"buffer":[2],"color":[513]}]]],["ion-range",[[33,"ion-range",{"color":[513],"debounce":[2],"name":[1],"label":[1],"dualKnobs":[4,"dual-knobs"],"min":[2],"max":[2],"pin":[4],"pinFormatter":[16],"snaps":[4],"step":[2],"ticks":[4],"activeBarStart":[1026,"active-bar-start"],"disabled":[4],"value":[1026],"labelPlacement":[1,"label-placement"],"ratioA":[32],"ratioB":[32],"pressedKnob":[32]},null,{"debounce":["debounceChanged"],"min":["minChanged"],"max":["maxChanged"],"activeBarStart":["activeBarStartChanged"],"disabled":["disabledChanged"],"value":["valueChanged"]}]]],["ion-split-pane",[[33,"ion-split-pane",{"contentId":[513,"content-id"],"disabled":[4],"when":[8],"visible":[32],"isVisible":[64]},null,{"visible":["visibleChanged"],"disabled":["updateState"],"when":["updateState"]}]]],["ion-text",[[1,"ion-text",{"color":[513]}]]],["ion-select_3",[[33,"ion-select",{"cancelText":[1,"cancel-text"],"color":[513],"compareWith":[1,"compare-with"],"disabled":[4],"fill":[1],"interface":[1],"interfaceOptions":[8,"interface-options"],"justify":[1],"label":[1],"labelPlacement":[1,"label-placement"],"multiple":[4],"name":[1],"okText":[1,"ok-text"],"placeholder":[1],"selectedText":[1,"selected-text"],"toggleIcon":[1,"toggle-icon"],"expandedIcon":[1,"expanded-icon"],"shape":[1],"value":[1032],"isExpanded":[32],"open":[64]},null,{"disabled":["styleChanged"],"isExpanded":["styleChanged"],"placeholder":["styleChanged"],"value":["styleChanged"]}],[1,"ion-select-option",{"disabled":[4],"value":[8]}],[34,"ion-select-popover",{"header":[1],"subHeader":[1,"sub-header"],"message":[1],"multiple":[4],"options":[16]}]]],["ion-picker",[[33,"ion-picker",{"exitInputMode":[64]},[[1,"touchstart","preventTouchStartPropagation"]]]]],["ion-picker-column",[[1,"ion-picker-column",{"disabled":[4],"value":[1032],"color":[513],"numericInput":[4,"numeric-input"],"ariaLabel":[32],"isActive":[32],"scrollActiveItemIntoView":[64],"setValue":[64],"setFocus":[64]},null,{"aria-label":["ariaLabelChanged"],"value":["valueChange"]}]]],["ion-datetime_3",[[33,"ion-datetime",{"color":[1],"name":[1],"disabled":[4],"formatOptions":[16],"readonly":[4],"isDateEnabled":[16],"min":[1025],"max":[1025],"presentation":[1],"cancelText":[1,"cancel-text"],"doneText":[1,"done-text"],"clearText":[1,"clear-text"],"yearValues":[8,"year-values"],"monthValues":[8,"month-values"],"dayValues":[8,"day-values"],"hourValues":[8,"hour-values"],"minuteValues":[8,"minute-values"],"locale":[1],"firstDayOfWeek":[2,"first-day-of-week"],"titleSelectedDatesFormatter":[16],"multiple":[4],"highlightedDates":[16],"value":[1025],"showDefaultTitle":[4,"show-default-title"],"showDefaultButtons":[4,"show-default-buttons"],"showClearButton":[4,"show-clear-button"],"showDefaultTimeLabel":[4,"show-default-time-label"],"hourCycle":[1,"hour-cycle"],"size":[1],"preferWheel":[4,"prefer-wheel"],"showMonthAndYear":[32],"activeParts":[32],"workingParts":[32],"isTimePopoverOpen":[32],"forceRenderDate":[32],"confirm":[64],"reset":[64],"cancel":[64]},null,{"formatOptions":["formatOptionsChanged"],"disabled":["disabledChanged"],"min":["minChanged"],"max":["maxChanged"],"presentation":["presentationChanged"],"yearValues":["yearValuesChanged"],"monthValues":["monthValuesChanged"],"dayValues":["dayValuesChanged"],"hourValues":["hourValuesChanged"],"minuteValues":["minuteValuesChanged"],"value":["valueChanged"]}],[34,"ion-picker-legacy",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"columns":[16],"cssClass":[1,"css-class"],"duration":[2],"showBackdrop":[4,"show-backdrop"],"backdropDismiss":[4,"backdrop-dismiss"],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"getColumn":[64]},null,{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}],[32,"ion-picker-legacy-column",{"col":[16]},null,{"col":["colChanged"]}]]],["ion-radio_2",[[33,"ion-radio",{"color":[513],"name":[1],"disabled":[4],"value":[8],"labelPlacement":[1,"label-placement"],"justify":[1],"alignment":[1],"checked":[32],"buttonTabindex":[32],"setFocus":[64],"setButtonTabindex":[64]},null,{"value":["valueChanged"]}],[0,"ion-radio-group",{"allowEmptySelection":[4,"allow-empty-selection"],"compareWith":[1,"compare-with"],"name":[1],"value":[1032]},[[4,"keydown","onKeydown"]],{"value":["valueChanged"]}]]],["ion-ripple-effect",[[1,"ion-ripple-effect",{"type":[1],"addRipple":[64]}]]],["ion-button_2",[[33,"ion-button",{"color":[513],"buttonType":[1025,"button-type"],"disabled":[516],"expand":[513],"fill":[1537],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"download":[1],"href":[1],"rel":[1],"shape":[513],"size":[513],"strong":[4],"target":[1],"type":[1],"form":[1],"isCircle":[32]},null,{"disabled":["disabledChanged"]}],[1,"ion-icon",{"mode":[1025],"color":[1],"ios":[1],"md":[1],"flipRtl":[4,"flip-rtl"],"name":[513],"src":[1],"icon":[8],"size":[1],"lazy":[4],"sanitize":[4],"svgContent":[32],"isVisible":[32]},null,{"name":["loadIcon"],"src":["loadIcon"],"icon":["loadIcon"],"ios":["loadIcon"],"md":["loadIcon"]}]]],["ion-action-sheet",[[34,"ion-action-sheet",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"header":[1],"subHeader":[1,"sub-header"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},null,{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}]]],["ion-alert",[[34,"ion-alert",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"header":[1],"subHeader":[1,"sub-header"],"message":[1],"buttons":[16],"inputs":[1040],"backdropDismiss":[4,"backdrop-dismiss"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},[[4,"keydown","onKeydown"]],{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"],"buttons":["buttonsChanged"],"inputs":["inputsChanged"]}]]],["ion-app_8",[[0,"ion-app",{"setFocus":[64]}],[1,"ion-content",{"color":[513],"fullscreen":[4],"fixedSlotPlacement":[1,"fixed-slot-placement"],"forceOverscroll":[1028,"force-overscroll"],"scrollX":[4,"scroll-x"],"scrollY":[4,"scroll-y"],"scrollEvents":[4,"scroll-events"],"getScrollElement":[64],"getBackgroundElement":[64],"scrollToTop":[64],"scrollToBottom":[64],"scrollByPoint":[64],"scrollToPoint":[64]},[[9,"resize","onResize"]]],[36,"ion-footer",{"collapse":[1],"translucent":[4],"keyboardVisible":[32]}],[36,"ion-header",{"collapse":[1],"translucent":[4]}],[1,"ion-router-outlet",{"mode":[1025],"delegate":[16],"animated":[4],"animation":[16],"swipeHandler":[16],"commit":[64],"setRouteId":[64],"getRouteId":[64]},null,{"swipeHandler":["swipeHandlerChanged"]}],[33,"ion-title",{"color":[513],"size":[1]},null,{"size":["sizeChanged"]}],[33,"ion-toolbar",{"color":[513]},[[0,"ionStyle","childrenStyle"]]],[38,"ion-buttons",{"collapse":[4]}]]],["ion-picker-column-option",[[33,"ion-picker-column-option",{"disabled":[4],"value":[8],"color":[513],"ariaLabel":[32]},null,{"aria-label":["onAriaLabelChange"]}]]],["ion-popover",[[33,"ion-popover",{"hasController":[4,"has-controller"],"delegate":[16],"overlayIndex":[2,"overlay-index"],"enterAnimation":[16],"leaveAnimation":[16],"component":[1],"componentProps":[16],"keyboardClose":[4,"keyboard-close"],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"event":[8],"showBackdrop":[4,"show-backdrop"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"triggerAction":[1,"trigger-action"],"trigger":[1],"size":[1],"dismissOnSelect":[4,"dismiss-on-select"],"reference":[1],"side":[1],"alignment":[1025],"arrow":[4],"isOpen":[4,"is-open"],"keyboardEvents":[4,"keyboard-events"],"focusTrap":[4,"focus-trap"],"keepContentsMounted":[4,"keep-contents-mounted"],"presented":[32],"presentFromTrigger":[64],"present":[64],"dismiss":[64],"getParentPopover":[64],"onDidDismiss":[64],"onWillDismiss":[64]},null,{"trigger":["onTriggerChange"],"triggerAction":["onTriggerChange"],"isOpen":["onIsOpenChange"]}]]],["ion-checkbox",[[33,"ion-checkbox",{"color":[513],"name":[1],"checked":[1028],"indeterminate":[1028],"disabled":[4],"value":[8],"labelPlacement":[1,"label-placement"],"justify":[1],"alignment":[1]}]]],["ion-spinner",[[1,"ion-spinner",{"color":[513],"duration":[2],"name":[1],"paused":[4]}]]],["ion-item_8",[[33,"ion-item-divider",{"color":[513],"sticky":[4]}],[32,"ion-item-group"],[33,"ion-note",{"color":[513]}],[1,"ion-skeleton-text",{"animated":[4]}],[33,"ion-item",{"color":[513],"button":[4],"detail":[4],"detailIcon":[1,"detail-icon"],"disabled":[516],"download":[1],"href":[1],"rel":[1],"lines":[1],"routerAnimation":[16],"routerDirection":[1,"router-direction"],"target":[1],"type":[1],"multipleInputs":[32],"focusable":[32]},[[0,"ionColor","labelColorChanged"],[0,"ionStyle","itemStyle"]],{"button":["buttonChanged"]}],[38,"ion-label",{"color":[513],"position":[1],"noAnimate":[32]},null,{"color":["colorChanged"],"position":["positionChanged"]}],[32,"ion-list",{"lines":[1],"inset":[4],"closeSlidingItems":[64]}],[33,"ion-list-header",{"color":[513],"lines":[1]}]]]]'),Te)});return function(Te,Y){return pe.apply(this,arguments)}}(),xt=["*"],ct=["outletContent"];let Kn=(()=>{class pe extends me.fL{constructor(Te,Y){super(Te,Y)}writeValue(Te){this.elementRef.nativeElement.checked=this.lastValue=Te,(0,me.z3)(this.elementRef)}_handleIonChange(Te){this.handleValueChange(Te,Te.checked)}static \u0275fac=function(Y){return new(Y||pe)(g.rXU(g.zZn),g.rXU(g.aKT))};static \u0275dir=g.FsC({type:pe,selectors:[["ion-checkbox"],["ion-toggle"]],hostBindings:function(Y,Ae){1&Y&&g.bIt("ionChange",function(ho){return Ae._handleIonChange(ho.target)})},features:[g.Jv_([{provide:v.kq,useExisting:pe,multi:!0}]),g.Vt3]})}return pe})(),Kt=(()=>{class pe extends me.fL{el;constructor(Te,Y){super(Te,Y),this.el=Y}handleInputEvent(Te){this.handleValueChange(Te,Te.value)}registerOnChange(Te){super.registerOnChange("ION-INPUT"===this.el.nativeElement.tagName?Y=>{Te(""===Y?null:parseFloat(Y))}:Te)}static \u0275fac=function(Y){return new(Y||pe)(g.rXU(g.zZn),g.rXU(g.aKT))};static \u0275dir=g.FsC({type:pe,selectors:[["ion-input","type","number"],["ion-range"]],hostBindings:function(Y,Ae){1&Y&&g.bIt("ionInput",function(ho){return Ae.handleInputEvent(ho.target)})},features:[g.Jv_([{provide:v.kq,useExisting:pe,multi:!0}]),g.Vt3]})}return pe})(),at=(()=>{class pe extends me.fL{constructor(Te,Y){super(Te,Y)}_handleChangeEvent(Te){this.handleValueChange(Te,Te.value)}static \u0275fac=function(Y){return new(Y||pe)(g.rXU(g.zZn),g.rXU(g.aKT))};static \u0275dir=g.FsC({type:pe,selectors:[["ion-select"],["ion-radio-group"],["ion-segment"],["ion-datetime"]],hostBindings:function(Y,Ae){1&Y&&g.bIt("ionChange",function(ho){return Ae._handleChangeEvent(ho.target)})},features:[g.Jv_([{provide:v.kq,useExisting:pe,multi:!0}]),g.Vt3]})}return pe})(),ve=(()=>{class pe extends me.fL{constructor(Te,Y){super(Te,Y)}_handleInputEvent(Te){this.handleValueChange(Te,Te.value)}static \u0275fac=function(Y){return new(Y||pe)(g.rXU(g.zZn),g.rXU(g.aKT))};static \u0275dir=g.FsC({type:pe,selectors:[["ion-input",3,"type","number"],["ion-textarea"],["ion-searchbar"]],hostBindings:function(Y,Ae){1&Y&&g.bIt("ionInput",function(ho){return Ae._handleInputEvent(ho.target)})},features:[g.Jv_([{provide:v.kq,useExisting:pe,multi:!0}]),g.Vt3]})}return pe})();const Me=(pe,kr)=>{const Te=pe.prototype;kr.forEach(Y=>{Object.defineProperty(Te,Y,{get(){return this.el[Y]},set(Ae){this.z.runOutsideAngular(()=>this.el[Y]=Ae)},configurable:!0})})},fe=(pe,kr)=>{const Te=pe.prototype;kr.forEach(Y=>{Te[Y]=function(){const Ae=arguments;return this.z.runOutsideAngular(()=>this.el[Y].apply(this.el,Ae))}})},vt=(pe,kr,Te)=>{Te.forEach(Y=>pe[Y]=(0,Z.R)(kr,Y))};function Re(pe){return function(Te){const{defineCustomElementFn:Y,inputs:Ae,methods:jr}=pe;return void 0!==Y&&Y(),Ae&&Me(Te,Ae),jr&&fe(Te,jr),Te}}let Jn=(()=>{let pe=class RC{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||RC)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:RC,selectors:[["ion-app"]],ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({})],pe),pe})(),jn=(()=>{let pe=class OC{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||OC)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:OC,selectors:[["ion-avatar"]],ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({})],pe),pe})(),ut=(()=>{let pe=class kC{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||kC)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:kC,selectors:[["ion-badge"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["color","mode"]})],pe),pe})(),pn=(()=>{let pe=class BC{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement,vt(this,this.el,["ionFocus","ionBlur"])}static \u0275fac=function(Y){return new(Y||BC)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:BC,selectors:[["ion-button"]],inputs:{buttonType:"buttonType",color:"color",disabled:"disabled",download:"download",expand:"expand",fill:"fill",form:"form",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",size:"size",strong:"strong",target:"target",type:"type"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["buttonType","color","disabled","download","expand","fill","form","href","mode","rel","routerAnimation","routerDirection","shape","size","strong","target","type"]})],pe),pe})(),An=(()=>{let pe=class zC{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||zC)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:zC,selectors:[["ion-buttons"]],inputs:{collapse:"collapse"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["collapse"]})],pe),pe})(),Ct=(()=>{let pe=class UC{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||UC)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:UC,selectors:[["ion-card"]],inputs:{button:"button",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",target:"target",type:"type"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["button","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","target","type"]})],pe),pe})(),Qt=(()=>{let pe=class jC{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||jC)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:jC,selectors:[["ion-card-content"]],inputs:{mode:"mode"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["mode"]})],pe),pe})(),Se=(()=>{let pe=class VC{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||VC)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:VC,selectors:[["ion-card-header"]],inputs:{color:"color",mode:"mode",translucent:"translucent"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["color","mode","translucent"]})],pe),pe})(),Bt=(()=>{let pe=class $C{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||$C)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:$C,selectors:[["ion-card-subtitle"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["color","mode"]})],pe),pe})(),Ci=(()=>{let pe=class WC{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||WC)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:WC,selectors:[["ion-chip"]],inputs:{color:"color",disabled:"disabled",mode:"mode",outline:"outline"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["color","disabled","mode","outline"]})],pe),pe})(),Oi=(()=>{let pe=class XC{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||XC)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:XC,selectors:[["ion-col"]],inputs:{offset:"offset",offsetLg:"offsetLg",offsetMd:"offsetMd",offsetSm:"offsetSm",offsetXl:"offsetXl",offsetXs:"offsetXs",pull:"pull",pullLg:"pullLg",pullMd:"pullMd",pullSm:"pullSm",pullXl:"pullXl",pullXs:"pullXs",push:"push",pushLg:"pushLg",pushMd:"pushMd",pushSm:"pushSm",pushXl:"pushXl",pushXs:"pushXs",size:"size",sizeLg:"sizeLg",sizeMd:"sizeMd",sizeSm:"sizeSm",sizeXl:"sizeXl",sizeXs:"sizeXs"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["offset","offsetLg","offsetMd","offsetSm","offsetXl","offsetXs","pull","pullLg","pullMd","pullSm","pullXl","pullXs","push","pushLg","pushMd","pushSm","pushXl","pushXs","size","sizeLg","sizeMd","sizeSm","sizeXl","sizeXs"]})],pe),pe})(),ei=(()=>{let pe=class KC{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement,vt(this,this.el,["ionScrollStart","ionScroll","ionScrollEnd"])}static \u0275fac=function(Y){return new(Y||KC)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:KC,selectors:[["ion-content"]],inputs:{color:"color",fixedSlotPlacement:"fixedSlotPlacement",forceOverscroll:"forceOverscroll",fullscreen:"fullscreen",scrollEvents:"scrollEvents",scrollX:"scrollX",scrollY:"scrollY"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["color","fixedSlotPlacement","forceOverscroll","fullscreen","scrollEvents","scrollX","scrollY"],methods:["getScrollElement","scrollToTop","scrollToBottom","scrollByPoint","scrollToPoint"]})],pe),pe})(),mr=(()=>{let pe=class YC{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||YC)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:YC,selectors:[["ion-fab"]],inputs:{activated:"activated",edge:"edge",horizontal:"horizontal",vertical:"vertical"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["activated","edge","horizontal","vertical"],methods:["close"]})],pe),pe})(),$n=(()=>{let pe=class JC{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement,vt(this,this.el,["ionFocus","ionBlur"])}static \u0275fac=function(Y){return new(Y||JC)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:JC,selectors:[["ion-fab-button"]],inputs:{activated:"activated",closeIcon:"closeIcon",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",show:"show",size:"size",target:"target",translucent:"translucent",type:"type"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["activated","closeIcon","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","show","size","target","translucent","type"]})],pe),pe})(),ar=(()=>{let pe=class QC{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||QC)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:QC,selectors:[["ion-fab-list"]],inputs:{activated:"activated",side:"side"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["activated","side"]})],pe),pe})(),gn=(()=>{let pe=class eI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||eI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:eI,selectors:[["ion-footer"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["collapse","mode","translucent"]})],pe),pe})(),ii=(()=>{let pe=class tI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||tI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:tI,selectors:[["ion-grid"]],inputs:{fixed:"fixed"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["fixed"]})],pe),pe})(),oi=(()=>{let pe=class nI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||nI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:nI,selectors:[["ion-header"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["collapse","mode","translucent"]})],pe),pe})(),Yi=(()=>{let pe=class iI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||iI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:iI,selectors:[["ion-icon"]],inputs:{color:"color",flipRtl:"flipRtl",icon:"icon",ios:"ios",lazy:"lazy",md:"md",mode:"mode",name:"name",sanitize:"sanitize",size:"size",src:"src"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["color","flipRtl","icon","ios","lazy","md","mode","name","sanitize","size","src"]})],pe),pe})(),ro=(()=>{let pe=class aI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement,vt(this,this.el,["ionInput","ionChange","ionBlur","ionFocus"])}static \u0275fac=function(Y){return new(Y||aI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:aI,selectors:[["ion-input"]],inputs:{autocapitalize:"autocapitalize",autocomplete:"autocomplete",autocorrect:"autocorrect",autofocus:"autofocus",clearInput:"clearInput",clearInputIcon:"clearInputIcon",clearOnEdit:"clearOnEdit",color:"color",counter:"counter",counterFormatter:"counterFormatter",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",errorText:"errorText",fill:"fill",helperText:"helperText",inputmode:"inputmode",label:"label",labelPlacement:"labelPlacement",max:"max",maxlength:"maxlength",min:"min",minlength:"minlength",mode:"mode",multiple:"multiple",name:"name",pattern:"pattern",placeholder:"placeholder",readonly:"readonly",required:"required",shape:"shape",spellcheck:"spellcheck",step:"step",type:"type",value:"value"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["autocapitalize","autocomplete","autocorrect","autofocus","clearInput","clearInputIcon","clearOnEdit","color","counter","counterFormatter","debounce","disabled","enterkeyhint","errorText","fill","helperText","inputmode","label","labelPlacement","max","maxlength","min","minlength","mode","multiple","name","pattern","placeholder","readonly","required","shape","spellcheck","step","type","value"],methods:["setFocus","getInputElement"]})],pe),pe})(),Po=(()=>{let pe=class cI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||cI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:cI,selectors:[["ion-item"]],inputs:{button:"button",color:"color",detail:"detail",detailIcon:"detailIcon",disabled:"disabled",download:"download",href:"href",lines:"lines",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",target:"target",type:"type"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["button","color","detail","detailIcon","disabled","download","href","lines","mode","rel","routerAnimation","routerDirection","target","type"]})],pe),pe})(),an=(()=>{let pe=class mI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||mI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:mI,selectors:[["ion-label"]],inputs:{color:"color",mode:"mode",position:"position"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["color","mode","position"]})],pe),pe})(),pt=(()=>{let pe=class gI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||gI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:gI,selectors:[["ion-list"]],inputs:{inset:"inset",lines:"lines",mode:"mode"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["inset","lines","mode"],methods:["closeSlidingItems"]})],pe),pe})(),On=(()=>{let pe=class _I{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||_I)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:_I,selectors:[["ion-list-header"]],inputs:{color:"color",lines:"lines",mode:"mode"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["color","lines","mode"]})],pe),pe})(),Ln=(()=>{let pe=class vI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement,vt(this,this.el,["ionWillOpen","ionWillClose","ionDidOpen","ionDidClose"])}static \u0275fac=function(Y){return new(Y||vI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:vI,selectors:[["ion-menu"]],inputs:{contentId:"contentId",disabled:"disabled",maxEdgeStart:"maxEdgeStart",menuId:"menuId",side:"side",swipeGesture:"swipeGesture",type:"type"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["contentId","disabled","maxEdgeStart","menuId","side","swipeGesture","type"],methods:["isOpen","isActive","open","close","toggle","setOpen"]})],pe),pe})(),Dn=(()=>{let pe=class xI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||xI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:xI,selectors:[["ion-menu-button"]],inputs:{autoHide:"autoHide",color:"color",disabled:"disabled",menu:"menu",mode:"mode",type:"type"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["autoHide","color","disabled","menu","mode","type"]})],pe),pe})(),ki=(()=>{let pe=class bI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||bI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:bI,selectors:[["ion-menu-toggle"]],inputs:{autoHide:"autoHide",menu:"menu"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["autoHide","menu"]})],pe),pe})(),wt=(()=>{let pe=class EI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||EI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:EI,selectors:[["ion-note"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["color","mode"]})],pe),pe})(),Ft=(()=>{let pe=class PI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement,vt(this,this.el,["ionChange","ionInput","ionFocus","ionBlur","ionKnobMoveStart","ionKnobMoveEnd"])}static \u0275fac=function(Y){return new(Y||PI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:PI,selectors:[["ion-range"]],inputs:{activeBarStart:"activeBarStart",color:"color",debounce:"debounce",disabled:"disabled",dualKnobs:"dualKnobs",label:"label",labelPlacement:"labelPlacement",max:"max",min:"min",mode:"mode",name:"name",pin:"pin",pinFormatter:"pinFormatter",snaps:"snaps",step:"step",ticks:"ticks",value:"value"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["activeBarStart","color","debounce","disabled","dualKnobs","label","labelPlacement","max","min","mode","name","pin","pinFormatter","snaps","step","ticks","value"]})],pe),pe})(),on=(()=>{let pe=class RI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement,vt(this,this.el,["ionRefresh","ionPull","ionStart"])}static \u0275fac=function(Y){return new(Y||RI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:RI,selectors:[["ion-refresher"]],inputs:{closeDuration:"closeDuration",disabled:"disabled",mode:"mode",pullFactor:"pullFactor",pullMax:"pullMax",pullMin:"pullMin",snapbackDuration:"snapbackDuration"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["closeDuration","disabled","mode","pullFactor","pullMax","pullMin","snapbackDuration"],methods:["complete","cancel","getProgress"]})],pe),pe})(),Un=(()=>{let pe=class OI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||OI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:OI,selectors:[["ion-refresher-content"]],inputs:{pullingIcon:"pullingIcon",pullingText:"pullingText",refreshingSpinner:"refreshingSpinner",refreshingText:"refreshingText"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["pullingIcon","pullingText","refreshingSpinner","refreshingText"]})],pe),pe})(),qi=(()=>{let pe=class NI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||NI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:NI,selectors:[["ion-row"]],ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({})],pe),pe})(),Ki=(()=>{let pe=class BI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement,vt(this,this.el,["ionInput","ionChange","ionCancel","ionClear","ionBlur","ionFocus"])}static \u0275fac=function(Y){return new(Y||BI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:BI,selectors:[["ion-searchbar"]],inputs:{animated:"animated",autocapitalize:"autocapitalize",autocomplete:"autocomplete",autocorrect:"autocorrect",cancelButtonIcon:"cancelButtonIcon",cancelButtonText:"cancelButtonText",clearIcon:"clearIcon",color:"color",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",maxlength:"maxlength",minlength:"minlength",mode:"mode",name:"name",placeholder:"placeholder",searchIcon:"searchIcon",showCancelButton:"showCancelButton",showClearButton:"showClearButton",spellcheck:"spellcheck",type:"type",value:"value"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["animated","autocapitalize","autocomplete","autocorrect","cancelButtonIcon","cancelButtonText","clearIcon","color","debounce","disabled","enterkeyhint","inputmode","maxlength","minlength","mode","name","placeholder","searchIcon","showCancelButton","showClearButton","spellcheck","type","value"],methods:["setFocus","getInputElement"]})],pe),pe})(),Gi=(()=>{let pe=class zI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement,vt(this,this.el,["ionChange"])}static \u0275fac=function(Y){return new(Y||zI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:zI,selectors:[["ion-segment"]],inputs:{color:"color",disabled:"disabled",mode:"mode",scrollable:"scrollable",selectOnFocus:"selectOnFocus",swipeGesture:"swipeGesture",value:"value"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["color","disabled","mode","scrollable","selectOnFocus","swipeGesture","value"]})],pe),pe})(),nr=(()=>{let pe=class UI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||UI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:UI,selectors:[["ion-segment-button"]],inputs:{disabled:"disabled",layout:"layout",mode:"mode",type:"type",value:"value"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["disabled","layout","mode","type","value"]})],pe),pe})(),lt=(()=>{let pe=class jI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement,vt(this,this.el,["ionChange","ionCancel","ionDismiss","ionFocus","ionBlur"])}static \u0275fac=function(Y){return new(Y||jI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:jI,selectors:[["ion-select"]],inputs:{cancelText:"cancelText",color:"color",compareWith:"compareWith",disabled:"disabled",expandedIcon:"expandedIcon",fill:"fill",interface:"interface",interfaceOptions:"interfaceOptions",justify:"justify",label:"label",labelPlacement:"labelPlacement",mode:"mode",multiple:"multiple",name:"name",okText:"okText",placeholder:"placeholder",selectedText:"selectedText",shape:"shape",toggleIcon:"toggleIcon",value:"value"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["cancelText","color","compareWith","disabled","expandedIcon","fill","interface","interfaceOptions","justify","label","labelPlacement","mode","multiple","name","okText","placeholder","selectedText","shape","toggleIcon","value"],methods:["open"]})],pe),pe})(),Be=(()=>{let pe=class VI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||VI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:VI,selectors:[["ion-select-option"]],inputs:{disabled:"disabled",value:"value"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["disabled","value"]})],pe),pe})(),Fe=(()=>{let pe=class GI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||GI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:GI,selectors:[["ion-spinner"]],inputs:{color:"color",duration:"duration",name:"name",paused:"paused"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["color","duration","name","paused"]})],pe),pe})(),Gt=(()=>{let pe=class HI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement,vt(this,this.el,["ionSplitPaneVisible"])}static \u0275fac=function(Y){return new(Y||HI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:HI,selectors:[["ion-split-pane"]],inputs:{contentId:"contentId",disabled:"disabled",when:"when"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["contentId","disabled","when"]})],pe),pe})(),Tt=(()=>{let pe=class ZI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement,vt(this,this.el,["ionChange","ionInput","ionBlur","ionFocus"])}static \u0275fac=function(Y){return new(Y||ZI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:ZI,selectors:[["ion-textarea"]],inputs:{autoGrow:"autoGrow",autocapitalize:"autocapitalize",autofocus:"autofocus",clearOnEdit:"clearOnEdit",color:"color",cols:"cols",counter:"counter",counterFormatter:"counterFormatter",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",errorText:"errorText",fill:"fill",helperText:"helperText",inputmode:"inputmode",label:"label",labelPlacement:"labelPlacement",maxlength:"maxlength",minlength:"minlength",mode:"mode",name:"name",placeholder:"placeholder",readonly:"readonly",required:"required",rows:"rows",shape:"shape",spellcheck:"spellcheck",value:"value",wrap:"wrap"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["autoGrow","autocapitalize","autofocus","clearOnEdit","color","cols","counter","counterFormatter","debounce","disabled","enterkeyhint","errorText","fill","helperText","inputmode","label","labelPlacement","maxlength","minlength","mode","name","placeholder","readonly","required","rows","shape","spellcheck","value","wrap"],methods:["setFocus","getInputElement"]})],pe),pe})(),En=(()=>{let pe=class qI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||qI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:qI,selectors:[["ion-thumbnail"]],ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({})],pe),pe})(),si=(()=>{let pe=class YI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||YI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:YI,selectors:[["ion-title"]],inputs:{color:"color",size:"size"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["color","size"]})],pe),pe})(),Ri=(()=>{let pe=class QI{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement,vt(this,this.el,["ionChange","ionFocus","ionBlur"])}static \u0275fac=function(Y){return new(Y||QI)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:QI,selectors:[["ion-toggle"]],inputs:{alignment:"alignment",checked:"checked",color:"color",disabled:"disabled",enableOnOffLabels:"enableOnOffLabels",justify:"justify",labelPlacement:"labelPlacement",mode:"mode",name:"name",value:"value"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["alignment","checked","color","disabled","enableOnOffLabels","justify","labelPlacement","mode","name","value"]})],pe),pe})(),pi=(()=>{let pe=class eT{z;el;constructor(Te,Y,Ae){this.z=Ae,Te.detach(),this.el=Y.nativeElement}static \u0275fac=function(Y){return new(Y||eT)(g.rXU(g.gRc),g.rXU(g.aKT),g.rXU(g.SKi))};static \u0275cmp=g.VBU({type:eT,selectors:[["ion-toolbar"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})};return pe=(0,a.Cg)([Re({inputs:["color","mode"]})],pe),pe})(),Ti=(()=>{class pe extends me.Rg{parentOutlet;outletContent;constructor(Te,Y,Ae,jr,ho,Zi,Ro,he){super(Te,Y,Ae,jr,ho,Zi,Ro,he),this.parentOutlet=he}static \u0275fac=function(Y){return new(Y||pe)(g.kS0("name"),g.kS0("tabs"),g.rXU(ie.aZ),g.rXU(g.aKT),g.rXU(T.Ix),g.rXU(g.SKi),g.rXU(T.nX),g.rXU(pe,12))};static \u0275cmp=g.VBU({type:pe,selectors:[["ion-router-outlet"]],viewQuery:function(Y,Ae){if(1&Y&&g.GBs(ct,7,g.c1b),2&Y){let jr;g.mGM(jr=g.lsd())&&(Ae.outletContent=jr.first)}},features:[g.Vt3],ngContentSelectors:xt,decls:3,vars:0,consts:[["outletContent",""]],template:function(Y,Ae){1&Y&&(g.NAR(),g.qex(0,null,0),g.SdG(2),g.bVm())},encapsulation:2})}return pe})(),Io=(()=>{class pe extends me.el{constructor(Te,Y,Ae,jr,ho,Zi){super(Te,Y,Ae,jr,ho,Zi)}static \u0275fac=function(Y){return new(Y||pe)(g.rXU(Ti,8),g.rXU(me.q9),g.rXU(me.TS),g.rXU(g.aKT),g.rXU(g.SKi),g.rXU(g.gRc))};static \u0275cmp=g.VBU({type:pe,selectors:[["ion-back-button"]],features:[g.Vt3],ngContentSelectors:xt,decls:1,vars:0,template:function(Y,Ae){1&Y&&(g.NAR(),g.SdG(0))},encapsulation:2,changeDetection:0})}return pe})(),Nr=(()=>{class pe extends me.CE{static \u0275fac=(()=>{let Te;return function(Ae){return(Te||(Te=g.xGo(pe)))(Ae||pe)}})();static \u0275dir=g.FsC({type:pe,selectors:[["","routerLink","",5,"a",5,"area"]],features:[g.Vt3]})}return pe})();const uo={provide:v.cz,useExisting:(0,g.Rfq)(()=>ko),multi:!0};let ko=(()=>{class pe extends v.zX{static \u0275fac=(()=>{let Te;return function(Ae){return(Te||(Te=g.xGo(pe)))(Ae||pe)}})();static \u0275dir=g.FsC({type:pe,selectors:[["ion-input","type","number","max","","formControlName",""],["ion-input","type","number","max","","formControl",""],["ion-input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(Y,Ae){2&Y&&g.BMQ("max",Ae._enabled?Ae.max:null)},features:[g.Jv_([uo]),g.Vt3]})}return pe})();const Ls={provide:v.cz,useExisting:(0,g.Rfq)(()=>Gr),multi:!0};let Gr=(()=>{class pe extends v.VZ{static \u0275fac=(()=>{let Te;return function(Ae){return(Te||(Te=g.xGo(pe)))(Ae||pe)}})();static \u0275dir=g.FsC({type:pe,selectors:[["ion-input","type","number","min","","formControlName",""],["ion-input","type","number","min","","formControl",""],["ion-input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(Y,Ae){2&Y&&g.BMQ("min",Ae._enabled?Ae.min:null)},features:[g.Jv_([Ls]),g.Vt3]})}return pe})(),xs=(()=>{class pe extends me.Kb{constructor(){super(ht.a)}static \u0275fac=function(Y){return new(Y||pe)};static \u0275prov=g.jDH({token:pe,factory:pe.\u0275fac,providedIn:"root"})}return pe})(),Ss=(()=>{class pe extends me.Kb{constructor(){super(ht.b)}static \u0275fac=function(Y){return new(Y||pe)};static \u0275prov=g.jDH({token:pe,factory:pe.\u0275fac,providedIn:"root"})}return pe})(),ma=(()=>{class pe extends me.Kb{constructor(){super(ht.l)}static \u0275fac=function(Y){return new(Y||pe)};static \u0275prov=g.jDH({token:pe,factory:pe.\u0275fac,providedIn:"root"})}return pe})(),ks=(()=>{class pe extends me.Kb{angularDelegate=(0,g.WQX)(me.Yq);injector=(0,g.WQX)(g.zZn);environmentInjector=(0,g.WQX)(g.uvJ);constructor(){super(ht.m)}create(Te){return super.create({...Te,delegate:this.angularDelegate.create(this.environmentInjector,this.injector,"modal")})}static \u0275fac=function(Y){return new(Y||pe)};static \u0275prov=g.jDH({token:pe,factory:pe.\u0275fac})}return pe})();class Nl extends me.Kb{angularDelegate=(0,g.WQX)(me.Yq);injector=(0,g.WQX)(g.zZn);environmentInjector=(0,g.WQX)(g.uvJ);constructor(){super(ht.c)}create(kr){return super.create({...kr,delegate:this.angularDelegate.create(this.environmentInjector,this.injector,"popover")})}}let ol=(()=>{class pe extends me.Kb{constructor(){super(ht.t)}static \u0275fac=function(Y){return new(Y||pe)};static \u0275prov=g.jDH({token:pe,factory:pe.\u0275fac,providedIn:"root"})}return pe})();const Wa=(pe,kr,Te)=>()=>{const Y=kr.defaultView;if(Y&&typeof window<"u"){(0,We.s)({...pe,_zoneGate:jr=>Te.run(jr)});const Ae="__zone_symbol__addEventListener"in kr.body?"__zone_symbol__addEventListener":"addEventListener";return function Ve(){var pe=[];if(typeof window<"u"){var kr=window;(!kr.customElements||kr.Element&&(!kr.Element.prototype.closest||!kr.Element.prototype.matches||!kr.Element.prototype.remove||!kr.Element.prototype.getRootNode))&&pe.push(B.e(7278).then(B.t.bind(B,2190,23))),("function"!=typeof Object.assign||!Object.entries||!Array.prototype.find||!Array.prototype.includes||!String.prototype.startsWith||!String.prototype.endsWith||kr.NodeList&&!kr.NodeList.prototype.forEach||!kr.fetch||!function(){try{var Y=new URL("b","http://a");return Y.pathname="c%20d","http://a/c%20d"===Y.href&&Y.searchParams}catch{return!1}}()||typeof WeakMap>"u")&&pe.push(B.e(9329).then(B.t.bind(B,7783,23)))}return Promise.all(pe)}().then(()=>nt(Y,{exclude:["ion-tabs","ion-tab"],syncQueue:!0,raf:me.er,jmp:jr=>Te.runOutsideAngular(jr),ael(jr,ho,Zi,Ro){jr[Ae](ho,Zi,Ro)},rel(jr,ho,Zi,Ro){jr.removeEventListener(ho,Zi,Ro)}}))}};let sl=(()=>{class pe{static forRoot(Te={}){return{ngModule:pe,providers:[{provide:me.sR,useValue:Te},{provide:g.hnV,useFactory:Wa,multi:!0,deps:[me.sR,ie.qQ,g.SKi]},me.Yq,(0,me.YV)()]}}static \u0275fac=function(Y){return new(Y||pe)};static \u0275mod=g.$C({type:pe});static \u0275inj=g.G2t({providers:[ks,Nl],imports:[ie.MD]})}return pe})()},4842:(vi,Vt,B)=>{"use strict";B.d(Vt,{Wr:()=>Le,h:()=>_n,D9:()=>vt,c$:()=>Me});var g=B(3953),v=B(7673),me=B(4402),a=B(7468),Z=B(8793),ie=B(9030),T=B(6697),Ce=B(1413),De=B(6129);class Je extends Ce.B{constructor(wn=1/0,it=1/0,tn=De.U){super(),this._bufferSize=wn,this._windowTime=it,this._timestampProvider=tn,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=it===1/0,this._bufferSize=Math.max(1,wn),this._windowTime=Math.max(1,it)}next(wn){const{isStopped:it,_buffer:tn,_infiniteTimeWindow:bn,_timestampProvider:Jn,_windowTime:jn}=this;it||(tn.push(wn),!bn&&tn.push(Jn.now()+jn)),this._trimBuffer(),super.next(wn)}_subscribe(wn){this._throwIfClosed(),this._trimBuffer();const it=this._innerSubscribe(wn),{_infiniteTimeWindow:tn,_buffer:bn}=this,Jn=bn.slice();for(let jn=0;jn<Jn.length&&!wn.closed;jn+=tn?1:2)wn.next(Jn[jn]);return this._checkFinalizedStatuses(wn),it}_trimBuffer(){const{_bufferSize:wn,_timestampProvider:it,_buffer:tn,_infiniteTimeWindow:bn}=this,Jn=(bn?1:2)*wn;if(wn<1/0&&Jn<tn.length&&tn.splice(0,tn.length-Jn),!bn){const jn=it.now();let _i=0;for(let ut=1;ut<tn.length&&tn[ut]<=jn;ut+=2)_i=ut;_i&&tn.splice(0,_i+1)}}}var re=B(8750),ze=B(7707),je=B(9974);function Ne(Re,wn,...it){if(!0===wn)return void Re();if(!1===wn)return;const tn=new ze.Ms({next:()=>{tn.unsubscribe(),Re()}});return(0,re.Tg)(wn(...it)).subscribe(tn)}function ht(Re,wn,it){let tn,bn=!1;return Re&&"object"==typeof Re?({bufferSize:tn=1/0,windowTime:wn=1/0,refCount:bn=!1,scheduler:it}=Re):tn=Re??1/0,function We(Re={}){const{connector:wn=(()=>new Ce.B),resetOnError:it=!0,resetOnComplete:tn=!0,resetOnRefCountZero:bn=!0}=Re;return Jn=>{let jn,_i,ut,nn=0,ui=!1,pn=!1;const An=()=>{_i?.unsubscribe(),_i=void 0},Ct=()=>{An(),jn=ut=void 0,ui=pn=!1},Qt=()=>{const Se=jn;Ct(),Se?.unsubscribe()};return(0,je.N)((Se,Bt)=>{nn++,!pn&&!ui&&An();const Nt=ut=ut??wn();Bt.add(()=>{nn--,0===nn&&!pn&&!ui&&(_i=Ne(Qt,bn))}),Nt.subscribe(Bt),!jn&&nn>0&&(jn=new ze.Ms({next:Rn=>Nt.next(Rn),error:Rn=>{pn=!0,An(),_i=Ne(Ct,it,Rn),Nt.error(Rn)},complete:()=>{ui=!0,An(),_i=Ne(Ct,tn),Nt.complete()}}),(0,re.Tg)(Se).subscribe(jn))})(Jn)}}({connector:()=>new Je(tn,wn,it),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:bn})}var He=B(6354),be=B(274),Ye=B(5558);class Le{}let ot=(()=>{class Re extends Le{getTranslation(it){return(0,v.of)({})}static \u0275fac=(()=>{let it;return function(bn){return(it||(it=g.xGo(Re)))(bn||Re)}})();static \u0275prov=g.jDH({token:Re,factory:Re.\u0275fac})}return Re})();class Ve{}let Ue=(()=>{class Re{handle(it){return it.key}static \u0275fac=function(tn){return new(tn||Re)};static \u0275prov=g.jDH({token:Re,factory:Re.\u0275fac})}return Re})();function $t(Re,wn){if(Re===wn)return!0;if(null===Re||null===wn)return!1;if(Re!=Re&&wn!=wn)return!0;let bn,Jn,jn,it=typeof Re;if(it==typeof wn&&"object"==it){if(!Array.isArray(Re)){if(Array.isArray(wn))return!1;for(Jn in jn=Object.create(null),Re){if(!$t(Re[Jn],wn[Jn]))return!1;jn[Jn]=!0}for(Jn in wn)if(!(Jn in jn)&&typeof wn[Jn]<"u")return!1;return!0}if(!Array.isArray(wn))return!1;if((bn=Re.length)==wn.length){for(Jn=0;Jn<bn;Jn++)if(!$t(Re[Jn],wn[Jn]))return!1;return!0}}return!1}function nt(Re){return typeof Re<"u"&&null!==Re}function xt(Re){return Re&&"object"==typeof Re&&!Array.isArray(Re)}function ct(Re,wn){let it=Object.assign({},Re);return xt(Re)&&xt(wn)&&Object.keys(wn).forEach(tn=>{xt(wn[tn])?tn in Re?it[tn]=ct(Re[tn],wn[tn]):Object.assign(it,{[tn]:wn[tn]}):Object.assign(it,{[tn]:wn[tn]})}),it}class Mt{}let $e=(()=>{class Re extends Mt{templateMatcher=/{{\s?([^{}\s]*)\s?}}/g;interpolate(it,tn){let bn;return bn="string"==typeof it?this.interpolateString(it,tn):"function"==typeof it?this.interpolateFunction(it,tn):it,bn}getValue(it,tn){let bn="string"==typeof tn?tn.split("."):[tn];tn="";do{tn+=bn.shift(),!nt(it)||!nt(it[tn])||"object"!=typeof it[tn]&&bn.length?bn.length?tn+=".":it=void 0:(it=it[tn],tn="")}while(bn.length);return it}interpolateFunction(it,tn){return it(tn)}interpolateString(it,tn){return tn?it.replace(this.templateMatcher,(bn,Jn)=>{let jn=this.getValue(tn,Jn);return nt(jn)?jn:bn}):it}static \u0275fac=(()=>{let it;return function(bn){return(it||(it=g.xGo(Re)))(bn||Re)}})();static \u0275prov=g.jDH({token:Re,factory:Re.\u0275fac})}return Re})();class Et{}let cn=(()=>{class Re extends Et{compile(it,tn){return it}compileTranslations(it,tn){return it}static \u0275fac=(()=>{let it;return function(bn){return(it||(it=g.xGo(Re)))(bn||Re)}})();static \u0275prov=g.jDH({token:Re,factory:Re.\u0275fac})}return Re})();class fn{defaultLang;currentLang=this.defaultLang;translations={};langs=[];onTranslationChange=new g.bkB;onLangChange=new g.bkB;onDefaultLangChange=new g.bkB}const Kn=new g.nKC("USE_STORE"),Kt=new g.nKC("USE_DEFAULT_LANG"),at=new g.nKC("DEFAULT_LANGUAGE"),ve=new g.nKC("USE_EXTEND");let Me=(()=>{class Re{store;currentLoader;compiler;parser;missingTranslationHandler;useDefaultLang;isolate;extend;loadingTranslations;pending=!1;_onTranslationChange=new g.bkB;_onLangChange=new g.bkB;_onDefaultLangChange=new g.bkB;_defaultLang;_currentLang;_langs=[];_translations={};_translationRequests={};get onTranslationChange(){return this.isolate?this._onTranslationChange:this.store.onTranslationChange}get onLangChange(){return this.isolate?this._onLangChange:this.store.onLangChange}get onDefaultLangChange(){return this.isolate?this._onDefaultLangChange:this.store.onDefaultLangChange}get defaultLang(){return this.isolate?this._defaultLang:this.store.defaultLang}set defaultLang(it){this.isolate?this._defaultLang=it:this.store.defaultLang=it}get currentLang(){return this.isolate?this._currentLang:this.store.currentLang}set currentLang(it){this.isolate?this._currentLang=it:this.store.currentLang=it}get langs(){return this.isolate?this._langs:this.store.langs}set langs(it){this.isolate?this._langs=it:this.store.langs=it}get translations(){return this.isolate?this._translations:this.store.translations}set translations(it){this.isolate?this._translations=it:this.store.translations=it}constructor(it,tn,bn,Jn,jn,_i=!0,ut=!1,nn=!1,ui){this.store=it,this.currentLoader=tn,this.compiler=bn,this.parser=Jn,this.missingTranslationHandler=jn,this.useDefaultLang=_i,this.isolate=ut,this.extend=nn,ui&&this.setDefaultLang(ui)}setDefaultLang(it){if(it===this.defaultLang)return;let tn=this.retrieveTranslations(it);typeof tn<"u"?(null==this.defaultLang&&(this.defaultLang=it),tn.pipe((0,T.s)(1)).subscribe(bn=>{this.changeDefaultLang(it)})):this.changeDefaultLang(it)}getDefaultLang(){return this.defaultLang}use(it){if(it===this.currentLang)return(0,v.of)(this.translations[it]);let tn=this.retrieveTranslations(it);return typeof tn<"u"?(this.currentLang||(this.currentLang=it),tn.pipe((0,T.s)(1)).subscribe(bn=>{this.changeLang(it)}),tn):(this.changeLang(it),(0,v.of)(this.translations[it]))}retrieveTranslations(it){let tn;return(typeof this.translations[it]>"u"||this.extend)&&(this._translationRequests[it]=this._translationRequests[it]||this.getTranslation(it),tn=this._translationRequests[it]),tn}getTranslation(it){this.pending=!0;const tn=this.currentLoader.getTranslation(it).pipe(ht(1),(0,T.s)(1));return this.loadingTranslations=tn.pipe((0,He.T)(bn=>this.compiler.compileTranslations(bn,it)),ht(1),(0,T.s)(1)),this.loadingTranslations.subscribe({next:bn=>{this.translations[it]=this.extend&&this.translations[it]?{...bn,...this.translations[it]}:bn,this.updateLangs(),this.pending=!1},error:bn=>{this.pending=!1}}),tn}setTranslation(it,tn,bn=!1){tn=this.compiler.compileTranslations(tn,it),this.translations[it]=(bn||this.extend)&&this.translations[it]?ct(this.translations[it],tn):tn,this.updateLangs(),this.onTranslationChange.emit({lang:it,translations:this.translations[it]})}getLangs(){return this.langs}addLangs(it){it.forEach(tn=>{-1===this.langs.indexOf(tn)&&this.langs.push(tn)})}updateLangs(){this.addLangs(Object.keys(this.translations))}getParsedResult(it,tn,bn){let Jn;if(tn instanceof Array){let jn={},_i=!1;for(let ut of tn)jn[ut]=this.getParsedResult(it,ut,bn),(0,me.A)(jn[ut])&&(_i=!0);if(_i){const ut=tn.map(nn=>(0,me.A)(jn[nn])?jn[nn]:(0,v.of)(jn[nn]));return(0,a.p)(ut).pipe((0,He.T)(nn=>{let ui={};return nn.forEach((pn,An)=>{ui[tn[An]]=pn}),ui}))}return jn}if(it&&(Jn=this.parser.interpolate(this.parser.getValue(it,tn),bn)),typeof Jn>"u"&&null!=this.defaultLang&&this.defaultLang!==this.currentLang&&this.useDefaultLang&&(Jn=this.parser.interpolate(this.parser.getValue(this.translations[this.defaultLang],tn),bn)),typeof Jn>"u"){let jn={key:tn,translateService:this};typeof bn<"u"&&(jn.interpolateParams=bn),Jn=this.missingTranslationHandler.handle(jn)}return typeof Jn<"u"?Jn:tn}get(it,tn){if(!nt(it)||!it.length)throw new Error('Parameter "key" required');if(this.pending)return this.loadingTranslations.pipe((0,be.H)(bn=>(bn=this.getParsedResult(bn,it,tn),(0,me.A)(bn)?bn:(0,v.of)(bn))));{let bn=this.getParsedResult(this.translations[this.currentLang],it,tn);return(0,me.A)(bn)?bn:(0,v.of)(bn)}}getStreamOnTranslationChange(it,tn){if(!nt(it)||!it.length)throw new Error('Parameter "key" required');return(0,Z.x)((0,ie.v)(()=>this.get(it,tn)),this.onTranslationChange.pipe((0,Ye.n)(bn=>{const Jn=this.getParsedResult(bn.translations,it,tn);return"function"==typeof Jn.subscribe?Jn:(0,v.of)(Jn)})))}stream(it,tn){if(!nt(it)||!it.length)throw new Error('Parameter "key" required');return(0,Z.x)((0,ie.v)(()=>this.get(it,tn)),this.onLangChange.pipe((0,Ye.n)(bn=>{const Jn=this.getParsedResult(bn.translations,it,tn);return(0,me.A)(Jn)?Jn:(0,v.of)(Jn)})))}instant(it,tn){if(!nt(it)||!it.length)throw new Error('Parameter "key" required');let bn=this.getParsedResult(this.translations[this.currentLang],it,tn);if((0,me.A)(bn)){if(it instanceof Array){let Jn={};return it.forEach((jn,_i)=>{Jn[it[_i]]=it[_i]}),Jn}return it}return bn}set(it,tn,bn=this.currentLang){this.translations[bn][it]=this.compiler.compile(tn,bn),this.updateLangs(),this.onTranslationChange.emit({lang:bn,translations:this.translations[bn]})}changeLang(it){this.currentLang=it,this.onLangChange.emit({lang:it,translations:this.translations[it]}),null==this.defaultLang&&this.changeDefaultLang(it)}changeDefaultLang(it){this.defaultLang=it,this.onDefaultLangChange.emit({lang:it,translations:this.translations[it]})}reloadLang(it){return this.resetLang(it),this.getTranslation(it)}resetLang(it){this._translationRequests[it]=void 0,this.translations[it]=void 0}getBrowserLang(){if(typeof window>"u"||typeof window.navigator>"u")return;let it=window.navigator.languages?window.navigator.languages[0]:null;return it=it||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,typeof it>"u"?void 0:(-1!==it.indexOf("-")&&(it=it.split("-")[0]),-1!==it.indexOf("_")&&(it=it.split("_")[0]),it)}getBrowserCultureLang(){if(typeof window>"u"||typeof window.navigator>"u")return;let it=window.navigator.languages?window.navigator.languages[0]:null;return it=it||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,it}static \u0275fac=function(tn){return new(tn||Re)(g.KVO(fn),g.KVO(Le),g.KVO(Et),g.KVO(Mt),g.KVO(Ve),g.KVO(Kt),g.KVO(Kn),g.KVO(ve),g.KVO(at))};static \u0275prov=g.jDH({token:Re,factory:Re.\u0275fac})}return Re})(),vt=(()=>{class Re{translate;_ref;value="";lastKey=null;lastParams=[];onTranslationChange;onLangChange;onDefaultLangChange;constructor(it,tn){this.translate=it,this._ref=tn}updateValue(it,tn,bn){let Jn=jn=>{this.value=void 0!==jn?jn:it,this.lastKey=it,this._ref.markForCheck()};if(bn){let jn=this.translate.getParsedResult(bn,it,tn);(0,me.A)(jn.subscribe)?jn.subscribe(Jn):Jn(jn)}this.translate.get(it,tn).subscribe(Jn)}transform(it,...tn){if(!it||!it.length)return it;if($t(it,this.lastKey)&&$t(tn,this.lastParams))return this.value;let bn;if(nt(tn[0])&&tn.length)if("string"==typeof tn[0]&&tn[0].length){let Jn=tn[0].replace(/(\')?([a-zA-Z0-9_]+)(\')?(\s)?:/g,'"$2":').replace(/:(\s)?(\')(.*?)(\')/g,':"$3"');try{bn=JSON.parse(Jn)}catch{throw new SyntaxError(`Wrong parameter in TranslatePipe. Expected a valid Object, received: ${tn[0]}`)}}else"object"==typeof tn[0]&&!Array.isArray(tn[0])&&(bn=tn[0]);return this.lastKey=it,this.lastParams=tn,this.updateValue(it,bn),this._dispose(),this.onTranslationChange||(this.onTranslationChange=this.translate.onTranslationChange.subscribe(Jn=>{this.lastKey&&Jn.lang===this.translate.currentLang&&(this.lastKey=null,this.updateValue(it,bn,Jn.translations))})),this.onLangChange||(this.onLangChange=this.translate.onLangChange.subscribe(Jn=>{this.lastKey&&(this.lastKey=null,this.updateValue(it,bn,Jn.translations))})),this.onDefaultLangChange||(this.onDefaultLangChange=this.translate.onDefaultLangChange.subscribe(()=>{this.lastKey&&(this.lastKey=null,this.updateValue(it,bn))})),this.value}_dispose(){typeof this.onTranslationChange<"u"&&(this.onTranslationChange.unsubscribe(),this.onTranslationChange=void 0),typeof this.onLangChange<"u"&&(this.onLangChange.unsubscribe(),this.onLangChange=void 0),typeof this.onDefaultLangChange<"u"&&(this.onDefaultLangChange.unsubscribe(),this.onDefaultLangChange=void 0)}ngOnDestroy(){this._dispose()}static \u0275fac=function(tn){return new(tn||Re)(g.rXU(Me,16),g.rXU(g.gRc,16))};static \u0275pipe=g.EJ8({name:"translate",type:Re,pure:!1});static \u0275prov=g.jDH({token:Re,factory:Re.\u0275fac})}return Re})(),_n=(()=>{class Re{static forRoot(it={}){return{ngModule:Re,providers:[it.loader||{provide:Le,useClass:ot},it.compiler||{provide:Et,useClass:cn},it.parser||{provide:Mt,useClass:$e},it.missingTranslationHandler||{provide:Ve,useClass:Ue},fn,{provide:Kn,useValue:it.isolate},{provide:Kt,useValue:it.useDefaultLang},{provide:ve,useValue:it.extend},{provide:at,useValue:it.defaultLanguage},Me]}}static forChild(it={}){return{ngModule:Re,providers:[it.loader||{provide:Le,useClass:ot},it.compiler||{provide:Et,useClass:cn},it.parser||{provide:Mt,useClass:$e},it.missingTranslationHandler||{provide:Ve,useClass:Ue},{provide:Kn,useValue:it.isolate},{provide:Kt,useValue:it.useDefaultLang},{provide:ve,useValue:it.extend},{provide:at,useValue:it.defaultLanguage},Me]}}static \u0275fac=function(tn){return new(tn||Re)};static \u0275mod=g.$C({type:Re});static \u0275inj=g.G2t({})}return Re})()},467:(vi,Vt,B)=>{"use strict";function g(me,a,Z,ie,T,Ce,De){try{var Je=me[Ce](De),re=Je.value}catch(ze){return void Z(ze)}Je.done?a(re):Promise.resolve(re).then(ie,T)}function v(me){return function(){var a=this,Z=arguments;return new Promise(function(ie,T){var Ce=me.apply(a,Z);function De(re){g(Ce,ie,T,De,Je,"next",re)}function Je(re){g(Ce,ie,T,De,Je,"throw",re)}De(void 0)})}}B.d(Vt,{A:()=>v})},1635:(vi,Vt,B)=>{"use strict";function Z(ve,Me,fe,vt){var wn,_n=arguments.length,Re=_n<3?Me:null===vt?vt=Object.getOwnPropertyDescriptor(Me,fe):vt;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)Re=Reflect.decorate(ve,Me,fe,vt);else for(var it=ve.length-1;it>=0;it--)(wn=ve[it])&&(Re=(_n<3?wn(Re):_n>3?wn(Me,fe,Re):wn(Me,fe))||Re);return _n>3&&Re&&Object.defineProperty(Me,fe,Re),Re}function ze(ve,Me,fe,vt){return new(fe||(fe=Promise))(function(Re,wn){function it(Jn){try{bn(vt.next(Jn))}catch(jn){wn(jn)}}function tn(Jn){try{bn(vt.throw(Jn))}catch(jn){wn(jn)}}function bn(Jn){Jn.done?Re(Jn.value):function _n(Re){return Re instanceof fe?Re:new fe(function(wn){wn(Re)})}(Jn.value).then(it,tn)}bn((vt=vt.apply(ve,Me||[])).next())})}function ot(ve){return this instanceof ot?(this.v=ve,this):new ot(ve)}function Ve(ve,Me,fe){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _n,vt=fe.apply(ve,Me||[]),Re=[];return _n={},it("next"),it("throw"),it("return",function wn(ut){return function(nn){return Promise.resolve(nn).then(ut,jn)}}),_n[Symbol.asyncIterator]=function(){return this},_n;function it(ut,nn){vt[ut]&&(_n[ut]=function(ui){return new Promise(function(pn,An){Re.push([ut,ui,pn,An])>1||tn(ut,ui)})},nn&&(_n[ut]=nn(_n[ut])))}function tn(ut,nn){try{!function bn(ut){ut.value instanceof ot?Promise.resolve(ut.value.v).then(Jn,jn):_i(Re[0][2],ut)}(vt[ut](nn))}catch(ui){_i(Re[0][3],ui)}}function Jn(ut){tn("next",ut)}function jn(ut){tn("throw",ut)}function _i(ut,nn){ut(nn),Re.shift(),Re.length&&tn(Re[0][0],Re[0][1])}}function $t(ve){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var fe,Me=ve[Symbol.asyncIterator];return Me?Me.call(ve):(ve=function ht(ve){var Me="function"==typeof Symbol&&Symbol.iterator,fe=Me&&ve[Me],vt=0;if(fe)return fe.call(ve);if(ve&&"number"==typeof ve.length)return{next:function(){return ve&&vt>=ve.length&&(ve=void 0),{value:ve&&ve[vt++],done:!ve}}};throw new TypeError(Me?"Object is not iterable.":"Symbol.iterator is not defined.")}(ve),fe={},vt("next"),vt("throw"),vt("return"),fe[Symbol.asyncIterator]=function(){return this},fe);function vt(Re){fe[Re]=ve[Re]&&function(wn){return new Promise(function(it,tn){!function _n(Re,wn,it,tn){Promise.resolve(tn).then(function(bn){Re({value:bn,done:it})},wn)}(it,tn,(wn=ve[Re](wn)).done,wn.value)})}}}B.d(Vt,{AQ:()=>Ve,Cg:()=>Z,N3:()=>ot,sH:()=>ze,xN:()=>$t}),"function"==typeof SuppressedError&&SuppressedError}},vi=>{vi(vi.s=9796)}]);