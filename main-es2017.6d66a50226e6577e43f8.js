(self.webpackChunkio_openchargemap_app=self.webpackChunkio_openchargemap_app||[]).push([[179],{8255:function(t){function e(t){return Promise.resolve().then(function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}e.keys=function(){return[]},e.resolve=e,e.id=8255,t.exports=e},8583:function(t,e,n){"use strict";n.d(e,{mr:function(){return x},ez:function(){return xt},K0:function(){return l},uU:function(){return _t},JJ:function(){return vt},Do:function(){return w},V_:function(){return h},Ye:function(){return T},S$:function(){return _},sg:function(){return dt},O5:function(){return ft},b0:function(){return b},lw:function(){return c},EM:function(){return wt},JF:function(){return St},w_:function(){return a},bD:function(){return bt},q:function(){return o},Mx:function(){return ut},HT:function(){return s}});var i=n(639);let r=null;function o(){return r}function s(t){r||(r=t)}class a{}const l=new i.OlP("DocumentToken");let c=(()=>{class t{historyGo(t){throw new Error("Not implemented")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=(0,i.Yz7)({factory:u,token:t,providedIn:"platform"}),t})();function u(){return(0,i.LFG)(d)}const h=new i.OlP("Location Initialized");let d=(()=>{class t extends c{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return o().getBaseHref(this._doc)}onPopState(t){const e=o().getGlobalEventTarget(this._doc,"window");return e.addEventListener("popstate",t,!1),()=>e.removeEventListener("popstate",t)}onHashChange(t){const e=o().getGlobalEventTarget(this._doc,"window");return e.addEventListener("hashchange",t,!1),()=>e.removeEventListener("hashchange",t)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,e,n){p()?this._history.pushState(t,e,n):this.location.hash=n}replaceState(t,e,n){p()?this._history.replaceState(t,e,n):this.location.hash=n}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(l))},t.\u0275prov=(0,i.Yz7)({factory:f,token:t,providedIn:"platform"}),t})();function p(){return!!window.history.pushState}function f(){return new d((0,i.LFG)(l))}function m(t,e){if(0==t.length)return e;if(0==e.length)return t;let n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,2==n?t+e.substring(1):1==n?t+e:t+"/"+e}function g(t){const e=t.match(/#|\?|$/),n=e&&e.index||t.length;return t.slice(0,n-("/"===t[n-1]?1:0))+t.slice(n)}function y(t){return t&&"?"!==t[0]?"?"+t:t}let _=(()=>{class t{historyGo(t){throw new Error("Not implemented")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=(0,i.Yz7)({factory:v,token:t,providedIn:"root"}),t})();function v(t){const e=(0,i.LFG)(l).location;return new b((0,i.LFG)(c),e&&e.origin||"")}const x=new i.OlP("appBaseHref");let b=(()=>{class t extends _{constructor(t,e){if(super(),this._platformLocation=t,this._removeListenerFns=[],null==e&&(e=this._platformLocation.getBaseHrefFromDOM()),null==e)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=e}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return m(this._baseHref,t)}path(t=!1){const e=this._platformLocation.pathname+y(this._platformLocation.search),n=this._platformLocation.hash;return n&&t?`${e}${n}`:e}pushState(t,e,n,i){const r=this.prepareExternalUrl(n+y(i));this._platformLocation.pushState(t,e,r)}replaceState(t,e,n,i){const r=this.prepareExternalUrl(n+y(i));this._platformLocation.replaceState(t,e,r)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var e,n;null===(n=(e=this._platformLocation).historyGo)||void 0===n||n.call(e,t)}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(c),i.LFG(x,8))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac}),t})(),w=(()=>{class t extends _{constructor(t,e){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=e&&(this._baseHref=e)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e}prepareExternalUrl(t){const e=m(this._baseHref,t);return e.length>0?"#"+e:e}pushState(t,e,n,i){let r=this.prepareExternalUrl(n+y(i));0==r.length&&(r=this._platformLocation.pathname),this._platformLocation.pushState(t,e,r)}replaceState(t,e,n,i){let r=this.prepareExternalUrl(n+y(i));0==r.length&&(r=this._platformLocation.pathname),this._platformLocation.replaceState(t,e,r)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var e,n;null===(n=(e=this._platformLocation).historyGo)||void 0===n||n.call(e,t)}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(c),i.LFG(x,8))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac}),t})(),T=(()=>{class t{constructor(t,e){this._subject=new i.vpe,this._urlChangeListeners=[],this._platformStrategy=t;const n=this._platformStrategy.getBaseHref();this._platformLocation=e,this._baseHref=g(S(n)),this._platformStrategy.onPopState(t=>{this._subject.emit({url:this.path(!0),pop:!0,state:t.state,type:t.type})})}path(t=!1){return this.normalize(this._platformStrategy.path(t))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(t,e=""){return this.path()==this.normalize(t+y(e))}normalize(e){return t.stripTrailingSlash(function(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,S(e)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(t,e="",n=null){this._platformStrategy.pushState(n,"",t,e),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+y(e)),n)}replaceState(t,e="",n=null){this._platformStrategy.replaceState(n,"",t,e),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+y(e)),n)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(t=0){var e,n;null===(n=(e=this._platformStrategy).historyGo)||void 0===n||n.call(e,t)}onUrlChange(t){this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(t=>{this._notifyUrlChangeListeners(t.url,t.state)}))}_notifyUrlChangeListeners(t="",e){this._urlChangeListeners.forEach(n=>n(t,e))}subscribe(t,e,n){return this._subject.subscribe({next:t,error:e,complete:n})}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(_),i.LFG(c))},t.normalizeQueryParams=y,t.joinWithSlash=m,t.stripTrailingSlash=g,t.\u0275prov=(0,i.Yz7)({factory:A,token:t,providedIn:"root"}),t})();function A(){return new T((0,i.LFG)(_),(0,i.LFG)(c))}function S(t){return t.replace(/\/index.html$/,"")}var C=(()=>((C=C||{})[C.Decimal=0]="Decimal",C[C.Percent=1]="Percent",C[C.Currency=2]="Currency",C[C.Scientific=3]="Scientific",C))(),I=(()=>((I=I||{})[I.Zero=0]="Zero",I[I.One=1]="One",I[I.Two=2]="Two",I[I.Few=3]="Few",I[I.Many=4]="Many",I[I.Other=5]="Other",I))(),E=(()=>((E=E||{})[E.Format=0]="Format",E[E.Standalone=1]="Standalone",E))(),M=(()=>((M=M||{})[M.Narrow=0]="Narrow",M[M.Abbreviated=1]="Abbreviated",M[M.Wide=2]="Wide",M[M.Short=3]="Short",M))(),k=(()=>((k=k||{})[k.Short=0]="Short",k[k.Medium=1]="Medium",k[k.Long=2]="Long",k[k.Full=3]="Full",k))(),P=(()=>((P=P||{})[P.Decimal=0]="Decimal",P[P.Group=1]="Group",P[P.List=2]="List",P[P.PercentSign=3]="PercentSign",P[P.PlusSign=4]="PlusSign",P[P.MinusSign=5]="MinusSign",P[P.Exponential=6]="Exponential",P[P.SuperscriptingExponent=7]="SuperscriptingExponent",P[P.PerMille=8]="PerMille",P[P.Infinity=9]="Infinity",P[P.NaN=10]="NaN",P[P.TimeSeparator=11]="TimeSeparator",P[P.CurrencyDecimal=12]="CurrencyDecimal",P[P.CurrencyGroup=13]="CurrencyGroup",P))();function D(t,e){return F((0,i.cg1)(t)[i.wAp.DateFormat],e)}function L(t,e){return F((0,i.cg1)(t)[i.wAp.TimeFormat],e)}function O(t,e){return F((0,i.cg1)(t)[i.wAp.DateTimeFormat],e)}function R(t,e){const n=(0,i.cg1)(t),r=n[i.wAp.NumberSymbols][e];if(void 0===r){if(e===P.CurrencyDecimal)return n[i.wAp.NumberSymbols][P.Decimal];if(e===P.CurrencyGroup)return n[i.wAp.NumberSymbols][P.Group]}return r}const z=i.kL8;function Z(t){if(!t[i.wAp.ExtraData])throw new Error(`Missing extra locale data for the locale "${t[i.wAp.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function F(t,e){for(let n=e;n>-1;n--)if(void 0!==t[n])return t[n];throw new Error("Locale data API: locale data undefined")}function U(t){const[e,n]=t.split(":");return{hours:+e,minutes:+n}}const N=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,B={},q=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var $=(()=>(($=$||{})[$.Short=0]="Short",$[$.ShortGMT=1]="ShortGMT",$[$.Long=2]="Long",$[$.Extended=3]="Extended",$))(),V=(()=>((V=V||{})[V.FullYear=0]="FullYear",V[V.Month=1]="Month",V[V.Date=2]="Date",V[V.Hours=3]="Hours",V[V.Minutes=4]="Minutes",V[V.Seconds=5]="Seconds",V[V.FractionalSeconds=6]="FractionalSeconds",V[V.Day=7]="Day",V))(),j=(()=>((j=j||{})[j.DayPeriods=0]="DayPeriods",j[j.Days=1]="Days",j[j.Months=2]="Months",j[j.Eras=3]="Eras",j))();function G(t,e,n,i){let r=function(t){if(ot(t))return t;if("number"==typeof t&&!isNaN(t))return new Date(t);if("string"==typeof t){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){const[e,n=1,i=1]=t.split("-").map(t=>+t);return Y(e,n-1,i)}const e=parseFloat(t);if(!isNaN(t-e))return new Date(e);let n;if(n=t.match(N))return function(t){const e=new Date(0);let n=0,i=0;const r=t[8]?e.setUTCFullYear:e.setFullYear,o=t[8]?e.setUTCHours:e.setHours;t[9]&&(n=Number(t[9]+t[10]),i=Number(t[9]+t[11])),r.call(e,Number(t[1]),Number(t[2])-1,Number(t[3]));const s=Number(t[4]||0)-n,a=Number(t[5]||0)-i,l=Number(t[6]||0),c=Math.floor(1e3*parseFloat("0."+(t[7]||0)));return o.call(e,s,a,l,c),e}(n)}const e=new Date(t);if(!ot(e))throw new Error(`Unable to convert "${t}" into a date`);return e}(t);e=H(n,e)||e;let o,s=[];for(;e;){if(o=q.exec(e),!o){s.push(e);break}{s=s.concat(o.slice(1));const t=s.pop();if(!t)break;e=t}}let a=r.getTimezoneOffset();i&&(a=rt(i,a),r=function(t,e,n){const i=t.getTimezoneOffset();return function(t,e){return(t=new Date(t.getTime())).setMinutes(t.getMinutes()+e),t}(t,-1*(rt(e,i)-i))}(r,i));let l="";return s.forEach(t=>{const e=function(t){if(it[t])return it[t];let e;switch(t){case"G":case"GG":case"GGG":e=Q(j.Eras,M.Abbreviated);break;case"GGGG":e=Q(j.Eras,M.Wide);break;case"GGGGG":e=Q(j.Eras,M.Narrow);break;case"y":e=X(V.FullYear,1,0,!1,!0);break;case"yy":e=X(V.FullYear,2,0,!0,!0);break;case"yyy":e=X(V.FullYear,3,0,!1,!0);break;case"yyyy":e=X(V.FullYear,4,0,!1,!0);break;case"Y":e=nt(1);break;case"YY":e=nt(2,!0);break;case"YYY":e=nt(3);break;case"YYYY":e=nt(4);break;case"M":case"L":e=X(V.Month,1,1);break;case"MM":case"LL":e=X(V.Month,2,1);break;case"MMM":e=Q(j.Months,M.Abbreviated);break;case"MMMM":e=Q(j.Months,M.Wide);break;case"MMMMM":e=Q(j.Months,M.Narrow);break;case"LLL":e=Q(j.Months,M.Abbreviated,E.Standalone);break;case"LLLL":e=Q(j.Months,M.Wide,E.Standalone);break;case"LLLLL":e=Q(j.Months,M.Narrow,E.Standalone);break;case"w":e=et(1);break;case"ww":e=et(2);break;case"W":e=et(1,!0);break;case"d":e=X(V.Date,1);break;case"dd":e=X(V.Date,2);break;case"c":case"cc":e=X(V.Day,1);break;case"ccc":e=Q(j.Days,M.Abbreviated,E.Standalone);break;case"cccc":e=Q(j.Days,M.Wide,E.Standalone);break;case"ccccc":e=Q(j.Days,M.Narrow,E.Standalone);break;case"cccccc":e=Q(j.Days,M.Short,E.Standalone);break;case"E":case"EE":case"EEE":e=Q(j.Days,M.Abbreviated);break;case"EEEE":e=Q(j.Days,M.Wide);break;case"EEEEE":e=Q(j.Days,M.Narrow);break;case"EEEEEE":e=Q(j.Days,M.Short);break;case"a":case"aa":case"aaa":e=Q(j.DayPeriods,M.Abbreviated);break;case"aaaa":e=Q(j.DayPeriods,M.Wide);break;case"aaaaa":e=Q(j.DayPeriods,M.Narrow);break;case"b":case"bb":case"bbb":e=Q(j.DayPeriods,M.Abbreviated,E.Standalone,!0);break;case"bbbb":e=Q(j.DayPeriods,M.Wide,E.Standalone,!0);break;case"bbbbb":e=Q(j.DayPeriods,M.Narrow,E.Standalone,!0);break;case"B":case"BB":case"BBB":e=Q(j.DayPeriods,M.Abbreviated,E.Format,!0);break;case"BBBB":e=Q(j.DayPeriods,M.Wide,E.Format,!0);break;case"BBBBB":e=Q(j.DayPeriods,M.Narrow,E.Format,!0);break;case"h":e=X(V.Hours,1,-12);break;case"hh":e=X(V.Hours,2,-12);break;case"H":e=X(V.Hours,1);break;case"HH":e=X(V.Hours,2);break;case"m":e=X(V.Minutes,1);break;case"mm":e=X(V.Minutes,2);break;case"s":e=X(V.Seconds,1);break;case"ss":e=X(V.Seconds,2);break;case"S":e=X(V.FractionalSeconds,1);break;case"SS":e=X(V.FractionalSeconds,2);break;case"SSS":e=X(V.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":e=K($.Short);break;case"ZZZZZ":e=K($.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":e=K($.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":e=K($.Long);break;default:return null}return it[t]=e,e}(t);l+=e?e(r,n,a):"''"===t?"'":t.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),l}function Y(t,e,n){const i=new Date(0);return i.setFullYear(t,e,n),i.setHours(0,0,0),i}function H(t,e){const n=function(t){return(0,i.cg1)(t)[i.wAp.LocaleId]}(t);if(B[n]=B[n]||{},B[n][e])return B[n][e];let r="";switch(e){case"shortDate":r=D(t,k.Short);break;case"mediumDate":r=D(t,k.Medium);break;case"longDate":r=D(t,k.Long);break;case"fullDate":r=D(t,k.Full);break;case"shortTime":r=L(t,k.Short);break;case"mediumTime":r=L(t,k.Medium);break;case"longTime":r=L(t,k.Long);break;case"fullTime":r=L(t,k.Full);break;case"short":const e=H(t,"shortTime"),n=H(t,"shortDate");r=J(O(t,k.Short),[e,n]);break;case"medium":const i=H(t,"mediumTime"),o=H(t,"mediumDate");r=J(O(t,k.Medium),[i,o]);break;case"long":const s=H(t,"longTime"),a=H(t,"longDate");r=J(O(t,k.Long),[s,a]);break;case"full":const l=H(t,"fullTime"),c=H(t,"fullDate");r=J(O(t,k.Full),[l,c])}return r&&(B[n][e]=r),r}function J(t,e){return e&&(t=t.replace(/\{([^}]+)}/g,function(t,n){return null!=e&&n in e?e[n]:t})),t}function W(t,e,n="-",i,r){let o="";(t<0||r&&t<=0)&&(r?t=1-t:(t=-t,o=n));let s=String(t);for(;s.length<e;)s="0"+s;return i&&(s=s.substr(s.length-e)),o+s}function X(t,e,n=0,i=!1,r=!1){return function(o,s){let a=function(t,e){switch(t){case V.FullYear:return e.getFullYear();case V.Month:return e.getMonth();case V.Date:return e.getDate();case V.Hours:return e.getHours();case V.Minutes:return e.getMinutes();case V.Seconds:return e.getSeconds();case V.FractionalSeconds:return e.getMilliseconds();case V.Day:return e.getDay();default:throw new Error(`Unknown DateType value "${t}".`)}}(t,o);if((n>0||a>-n)&&(a+=n),t===V.Hours)0===a&&-12===n&&(a=12);else if(t===V.FractionalSeconds)return function(t,e){return W(t,3).substr(0,e)}(a,e);const l=R(s,P.MinusSign);return W(a,e,l,i,r)}}function Q(t,e,n=E.Format,r=!1){return function(o,s){return function(t,e,n,r,o,s){switch(n){case j.Months:return function(t,e,n){const r=(0,i.cg1)(t),o=F([r[i.wAp.MonthsFormat],r[i.wAp.MonthsStandalone]],e);return F(o,n)}(e,o,r)[t.getMonth()];case j.Days:return function(t,e,n){const r=(0,i.cg1)(t),o=F([r[i.wAp.DaysFormat],r[i.wAp.DaysStandalone]],e);return F(o,n)}(e,o,r)[t.getDay()];case j.DayPeriods:const a=t.getHours(),l=t.getMinutes();if(s){const t=function(t){const e=(0,i.cg1)(t);return Z(e),(e[i.wAp.ExtraData][2]||[]).map(t=>"string"==typeof t?U(t):[U(t[0]),U(t[1])])}(e),n=function(t,e,n){const r=(0,i.cg1)(t);Z(r);const o=F([r[i.wAp.ExtraData][0],r[i.wAp.ExtraData][1]],e)||[];return F(o,n)||[]}(e,o,r),s=t.findIndex(t=>{if(Array.isArray(t)){const[e,n]=t,i=a>=e.hours&&l>=e.minutes,r=a<n.hours||a===n.hours&&l<n.minutes;if(e.hours<n.hours){if(i&&r)return!0}else if(i||r)return!0}else if(t.hours===a&&t.minutes===l)return!0;return!1});if(-1!==s)return n[s]}return function(t,e,n){const r=(0,i.cg1)(t),o=F([r[i.wAp.DayPeriodsFormat],r[i.wAp.DayPeriodsStandalone]],e);return F(o,n)}(e,o,r)[a<12?0:1];case j.Eras:return function(t,e){return F((0,i.cg1)(t)[i.wAp.Eras],e)}(e,r)[t.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${n}`)}}(o,s,t,e,n,r)}}function K(t){return function(e,n,i){const r=-1*i,o=R(n,P.MinusSign),s=r>0?Math.floor(r/60):Math.ceil(r/60);switch(t){case $.Short:return(r>=0?"+":"")+W(s,2,o)+W(Math.abs(r%60),2,o);case $.ShortGMT:return"GMT"+(r>=0?"+":"")+W(s,1,o);case $.Long:return"GMT"+(r>=0?"+":"")+W(s,2,o)+":"+W(Math.abs(r%60),2,o);case $.Extended:return 0===i?"Z":(r>=0?"+":"")+W(s,2,o)+":"+W(Math.abs(r%60),2,o);default:throw new Error(`Unknown zone width "${t}"`)}}}function tt(t){return Y(t.getFullYear(),t.getMonth(),t.getDate()+(4-t.getDay()))}function et(t,e=!1){return function(n,i){let r;if(e){const t=new Date(n.getFullYear(),n.getMonth(),1).getDay()-1,e=n.getDate();r=1+Math.floor((e+t)/7)}else{const t=tt(n),e=function(t){const e=Y(t,0,1).getDay();return Y(t,0,1+(e<=4?4:11)-e)}(t.getFullYear()),i=t.getTime()-e.getTime();r=1+Math.round(i/6048e5)}return W(r,t,R(i,P.MinusSign))}}function nt(t,e=!1){return function(n,i){return W(tt(n).getFullYear(),t,R(i,P.MinusSign),e)}}const it={};function rt(t,e){t=t.replace(/:/g,"");const n=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(n)?e:n}function ot(t){return t instanceof Date&&!isNaN(t.valueOf())}const st=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function at(t){const e=parseInt(t);if(isNaN(e))throw new Error("Invalid integer literal when parsing "+t);return e}class lt{}let ct=(()=>{class t extends lt{constructor(t){super(),this.locale=t}getPluralCategory(t,e){switch(z(e||this.locale)(t)){case I.Zero:return"zero";case I.One:return"one";case I.Two:return"two";case I.Few:return"few";case I.Many:return"many";default:return"other"}}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(i.soG))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac}),t})();function ut(t,e){e=encodeURIComponent(e);for(const n of t.split(";")){const t=n.indexOf("="),[i,r]=-1==t?[n,""]:[n.slice(0,t),n.slice(t+1)];if(i.trim()===e)return decodeURIComponent(r)}return null}class ht{constructor(t,e,n,i){this.$implicit=t,this.ngForOf=e,this.index=n,this.count=i}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let dt=(()=>{class t{constructor(t,e,n){this._viewContainer=t,this._template=e,this._differs=n,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch(t){throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(t){return t.name||typeof t}(e)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const e=[];t.forEachOperation((t,n,i)=>{if(null==t.previousIndex){const n=this._viewContainer.createEmbeddedView(this._template,new ht(null,this._ngForOf,-1,-1),null===i?void 0:i),r=new pt(t,n);e.push(r)}else if(null==i)this._viewContainer.remove(null===n?void 0:n);else if(null!==n){const r=this._viewContainer.get(n);this._viewContainer.move(r,i);const o=new pt(t,r);e.push(o)}});for(let n=0;n<e.length;n++)this._perViewChange(e[n].view,e[n].record);for(let n=0,i=this._viewContainer.length;n<i;n++){const t=this._viewContainer.get(n);t.context.index=n,t.context.count=i,t.context.ngForOf=this._ngForOf}t.forEachIdentityChange(t=>{this._viewContainer.get(t.currentIndex).context.$implicit=t.item})}_perViewChange(t,e){t.context.$implicit=e.item}static ngTemplateContextGuard(t,e){return!0}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.s_b),i.Y36(i.Rgc),i.Y36(i.ZZ4))},t.\u0275dir=i.lG2({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),t})();class pt{constructor(t,e){this.record=t,this.view=e}}let ft=(()=>{class t{constructor(t,e){this._viewContainer=t,this._context=new mt,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=e}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){gt("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){gt("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,e){return!0}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.s_b),i.Y36(i.Rgc))},t.\u0275dir=i.lG2({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),t})();class mt{constructor(){this.$implicit=null,this.ngIf=null}}function gt(t,e){if(e&&!e.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${(0,i.AaK)(e)}'.`)}function yt(t,e){return Error(`InvalidPipeArgument: '${e}' for pipe '${(0,i.AaK)(t)}'`)}let _t=(()=>{class t{constructor(t){this.locale=t}transform(e,n="mediumDate",i,r){if(null==e||""===e||e!=e)return null;try{return G(e,n,r||this.locale,i)}catch(o){throw yt(t,o.message)}}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.soG,16))},t.\u0275pipe=i.Yjl({name:"date",type:t,pure:!0}),t})(),vt=(()=>{class t{constructor(t){this._locale=t}transform(e,n,r){if(!function(t){return!(null==t||""===t||t!=t)}(e))return null;r=r||this._locale;try{return function(t,e,n){return function(t,e,n,i,r,o,s=!1){let a="",l=!1;if(isFinite(t)){let c=function(t){let e,n,i,r,o,s=Math.abs(t)+"",a=0;for((n=s.indexOf("."))>-1&&(s=s.replace(".","")),(i=s.search(/e/i))>0?(n<0&&(n=i),n+=+s.slice(i+1),s=s.substring(0,i)):n<0&&(n=s.length),i=0;"0"===s.charAt(i);i++);if(i===(o=s.length))e=[0],n=1;else{for(o--;"0"===s.charAt(o);)o--;for(n-=i,e=[],r=0;i<=o;i++,r++)e[r]=Number(s.charAt(i))}return n>22&&(e=e.splice(0,21),a=n-1,n=1),{digits:e,exponent:a,integerLen:n}}(t);s&&(c=function(t){if(0===t.digits[0])return t;const e=t.digits.length-t.integerLen;return t.exponent?t.exponent+=2:(0===e?t.digits.push(0,0):1===e&&t.digits.push(0),t.integerLen+=2),t}(c));let u=e.minInt,h=e.minFrac,d=e.maxFrac;if(o){const t=o.match(st);if(null===t)throw new Error(`${o} is not a valid digit info`);const e=t[1],n=t[3],i=t[5];null!=e&&(u=at(e)),null!=n&&(h=at(n)),null!=i?d=at(i):null!=n&&h>d&&(d=h)}!function(t,e,n){if(e>n)throw new Error(`The minimum number of digits after fraction (${e}) is higher than the maximum (${n}).`);let i=t.digits,r=i.length-t.integerLen;const o=Math.min(Math.max(e,r),n);let s=o+t.integerLen,a=i[s];if(s>0){i.splice(Math.max(t.integerLen,s));for(let t=s;t<i.length;t++)i[t]=0}else{r=Math.max(0,r),t.integerLen=1,i.length=Math.max(1,s=o+1),i[0]=0;for(let t=1;t<s;t++)i[t]=0}if(a>=5)if(s-1<0){for(let e=0;e>s;e--)i.unshift(0),t.integerLen++;i.unshift(1),t.integerLen++}else i[s-1]++;for(;r<Math.max(0,o);r++)i.push(0);let l=0!==o;const c=e+t.integerLen,u=i.reduceRight(function(t,e,n,i){return i[n]=(e+=t)<10?e:e-10,l&&(0===i[n]&&n>=c?i.pop():l=!1),e>=10?1:0},0);u&&(i.unshift(u),t.integerLen++)}(c,h,d);let p=c.digits,f=c.integerLen;const m=c.exponent;let g=[];for(l=p.every(t=>!t);f<u;f++)p.unshift(0);for(;f<0;f++)p.unshift(0);f>0?g=p.splice(f,p.length):(g=p,p=[0]);const y=[];for(p.length>=e.lgSize&&y.unshift(p.splice(-e.lgSize,p.length).join(""));p.length>e.gSize;)y.unshift(p.splice(-e.gSize,p.length).join(""));p.length&&y.unshift(p.join("")),a=y.join(R(n,i)),g.length&&(a+=R(n,r)+g.join("")),m&&(a+=R(n,P.Exponential)+"+"+m)}else a=R(n,P.Infinity);return a=t<0&&!l?e.negPre+a+e.negSuf:e.posPre+a+e.posSuf,a}(t,function(t,e="-"){const n={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},i=t.split(";"),r=i[0],o=i[1],s=-1!==r.indexOf(".")?r.split("."):[r.substring(0,r.lastIndexOf("0")+1),r.substring(r.lastIndexOf("0")+1)],a=s[0],l=s[1]||"";n.posPre=a.substr(0,a.indexOf("#"));for(let u=0;u<l.length;u++){const t=l.charAt(u);"0"===t?n.minFrac=n.maxFrac=u+1:"#"===t?n.maxFrac=u+1:n.posSuf+=t}const c=a.split(",");if(n.gSize=c[1]?c[1].length:0,n.lgSize=c[2]||c[1]?(c[2]||c[1]).length:0,o){const t=r.length-n.posPre.length-n.posSuf.length,e=o.indexOf("#");n.negPre=o.substr(0,e).replace(/'/g,""),n.negSuf=o.substr(e+t).replace(/'/g,"")}else n.negPre=e+n.posPre,n.negSuf=n.posSuf;return n}(function(t,e){return(0,i.cg1)(t)[i.wAp.NumberFormats][e]}(e,C.Decimal),R(e,P.MinusSign)),e,P.Group,P.Decimal,n)}(function(t){if("string"==typeof t&&!isNaN(Number(t)-parseFloat(t)))return Number(t);if("number"!=typeof t)throw new Error(`${t} is not a number`);return t}(e),r,n)}catch(o){throw yt(t,o.message)}}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.soG,16))},t.\u0275pipe=i.Yjl({name:"number",type:t,pure:!0}),t})();let xt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({providers:[{provide:lt,useClass:ct}]}),t})();const bt="browser";let wt=(()=>{class t{}return t.\u0275prov=(0,i.Yz7)({token:t,providedIn:"root",factory:()=>new Tt((0,i.LFG)(l),window)}),t})();class Tt{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function(t,e){const n=t.getElementById(e)||t.getElementsByName(e)[0];if(n)return n;if("function"==typeof t.createTreeWalker&&t.body&&(t.body.createShadowRoot||t.body.attachShadow)){const n=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let i=n.currentNode;for(;i;){const t=i.shadowRoot;if(t){const n=t.getElementById(e)||t.querySelector(`[name="${e}"]`);if(n)return n}i=n.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),this.attemptFocus(e))}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),n=e.left+this.window.pageXOffset,i=e.top+this.window.pageYOffset,r=this.offset();this.window.scrollTo(n-r[0],i-r[1])}attemptFocus(t){return t.focus(),this.document.activeElement===t}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=At(this.window.history)||At(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function At(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class St{}},1841:function(t,e,n){"use strict";n.d(e,{TP:function(){return D},eN:function(){return k},JF:function(){return $},WM:function(){return d}});var i=n(8583),r=n(639),o=n(5917),s=n(7574),a=n(4612),l=n(5435),c=n(8002);class u{}class h{}class d{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(t=>{const e=t.indexOf(":");if(e>0){const n=t.slice(0,e),i=n.toLowerCase(),r=t.slice(e+1).trim();this.maybeSetNormalizedName(n,i),this.headers.has(i)?this.headers.get(i).push(r):this.headers.set(i,[r])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let n=t[e];const i=e.toLowerCase();"string"==typeof n&&(n=[n]),n.length>0&&(this.headers.set(i,n),this.maybeSetNormalizedName(e,i))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof d?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new d;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof d?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let n=t.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(t.name,e);const i=("a"===t.op?this.headers.get(e):void 0)||[];i.push(...n),this.headers.set(e,i);break;case"d":const r=t.value;if(r){let t=this.headers.get(e);if(!t)return;t=t.filter(t=>-1===r.indexOf(t)),0===t.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,t)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class p{encodeKey(t){return g(t)}encodeValue(t){return g(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const f=/%(\d[a-f0-9])/gi,m={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function g(t){return encodeURIComponent(t).replace(f,(t,e)=>{var n;return null!==(n=m[e])&&void 0!==n?n:t})}function y(t){return`${t}`}class _{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new p,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(t,e){const n=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(t=>{const i=t.indexOf("="),[r,o]=-1==i?[e.decodeKey(t),""]:[e.decodeKey(t.slice(0,i)),e.decodeValue(t.slice(i+1))],s=n.get(r)||[];s.push(o),n.set(r,s)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const n=t.fromObject[e];this.map.set(e,Array.isArray(n)?n:[n])})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(n=>{const i=t[n];Array.isArray(i)?i.forEach(t=>{e.push({param:n,value:t,op:"a"})}):e.push({param:n,value:i,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(t=>e+"="+this.encoder.encodeValue(t)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new _({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(y(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let e=this.map.get(t.param)||[];const n=e.indexOf(y(t.value));-1!==n&&e.splice(n,1),e.length>0?this.map.set(t.param,e):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class v{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}keys(){return this.map.keys()}}function x(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function b(t){return"undefined"!=typeof Blob&&t instanceof Blob}function w(t){return"undefined"!=typeof FormData&&t instanceof FormData}class T{constructor(t,e,n,i){let r;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||i?(this.body=void 0!==n?n:null,r=i):r=n,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params)),this.headers||(this.headers=new d),this.context||(this.context=new v),this.params){const t=this.params.toString();if(0===t.length)this.urlWithParams=e;else{const n=e.indexOf("?");this.urlWithParams=e+(-1===n?"?":n<e.length-1?"&":"")+t}}else this.params=new _,this.urlWithParams=e}serializeBody(){return null===this.body?null:x(this.body)||b(this.body)||w(this.body)||"undefined"!=typeof URLSearchParams&&this.body instanceof URLSearchParams||"string"==typeof this.body?this.body:this.body instanceof _?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||w(this.body)?null:b(this.body)?this.body.type||null:x(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof _?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var e;const n=t.method||this.method,i=t.url||this.url,r=t.responseType||this.responseType,o=void 0!==t.body?t.body:this.body,s=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,a=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let l=t.headers||this.headers,c=t.params||this.params;const u=null!==(e=t.context)&&void 0!==e?e:this.context;return void 0!==t.setHeaders&&(l=Object.keys(t.setHeaders).reduce((e,n)=>e.set(n,t.setHeaders[n]),l)),t.setParams&&(c=Object.keys(t.setParams).reduce((e,n)=>e.set(n,t.setParams[n]),c)),new T(n,i,o,{params:c,headers:l,context:u,reportProgress:a,responseType:r,withCredentials:s})}}var A=(()=>((A=A||{})[A.Sent=0]="Sent",A[A.UploadProgress=1]="UploadProgress",A[A.ResponseHeader=2]="ResponseHeader",A[A.DownloadProgress=3]="DownloadProgress",A[A.Response=4]="Response",A[A.User=5]="User",A))();class S{constructor(t,e=200,n="OK"){this.headers=t.headers||new d,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||n,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class C extends S{constructor(t={}){super(t),this.type=A.ResponseHeader}clone(t={}){return new C({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class I extends S{constructor(t={}){super(t),this.type=A.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new I({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class E extends S{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function M(t,e){return{body:e,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let k=(()=>{class t{constructor(t){this.handler=t}request(t,e,n={}){let i;if(t instanceof T)i=t;else{let r,o;r=n.headers instanceof d?n.headers:new d(n.headers),n.params&&(o=n.params instanceof _?n.params:new _({fromObject:n.params})),i=new T(t,e,void 0!==n.body?n.body:null,{headers:r,context:n.context,params:o,reportProgress:n.reportProgress,responseType:n.responseType||"json",withCredentials:n.withCredentials})}const r=(0,o.of)(i).pipe((0,a.b)(t=>this.handler.handle(t)));if(t instanceof T||"events"===n.observe)return r;const s=r.pipe((0,l.h)(t=>t instanceof I));switch(n.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return s.pipe((0,c.U)(t=>{if(null!==t.body&&!(t.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return t.body}));case"blob":return s.pipe((0,c.U)(t=>{if(null!==t.body&&!(t.body instanceof Blob))throw new Error("Response is not a Blob.");return t.body}));case"text":return s.pipe((0,c.U)(t=>{if(null!==t.body&&"string"!=typeof t.body)throw new Error("Response is not a string.");return t.body}));case"json":default:return s.pipe((0,c.U)(t=>t.body))}case"response":return s;default:throw new Error(`Unreachable: unhandled observe type ${n.observe}}`)}}delete(t,e={}){return this.request("DELETE",t,e)}get(t,e={}){return this.request("GET",t,e)}head(t,e={}){return this.request("HEAD",t,e)}jsonp(t,e){return this.request("JSONP",t,{params:(new _).append(e,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,e={}){return this.request("OPTIONS",t,e)}patch(t,e,n={}){return this.request("PATCH",t,M(n,e))}post(t,e,n={}){return this.request("POST",t,M(n,e))}put(t,e,n={}){return this.request("PUT",t,M(n,e))}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(u))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})();class P{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const D=new r.OlP("HTTP_INTERCEPTORS");let L=(()=>{class t{intercept(t,e){return e.handle(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})();const O=/^\)\]\}',?\n/;let R=(()=>{class t{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new s.y(e=>{const n=this.xhrFactory.build();if(n.open(t.method,t.urlWithParams),t.withCredentials&&(n.withCredentials=!0),t.headers.forEach((t,e)=>n.setRequestHeader(t,e.join(","))),t.headers.has("Accept")||n.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const e=t.detectContentTypeHeader();null!==e&&n.setRequestHeader("Content-Type",e)}if(t.responseType){const e=t.responseType.toLowerCase();n.responseType="json"!==e?e:"text"}const i=t.serializeBody();let r=null;const o=()=>{if(null!==r)return r;const e=1223===n.status?204:n.status,i=n.statusText||"OK",o=new d(n.getAllResponseHeaders()),s=function(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(n)||t.url;return r=new C({headers:o,status:e,statusText:i,url:s}),r},s=()=>{let{headers:i,status:r,statusText:s,url:a}=o(),l=null;204!==r&&(l=void 0===n.response?n.responseText:n.response),0===r&&(r=l?200:0);let c=r>=200&&r<300;if("json"===t.responseType&&"string"==typeof l){const t=l;l=l.replace(O,"");try{l=""!==l?JSON.parse(l):null}catch(u){l=t,c&&(c=!1,l={error:u,text:l})}}c?(e.next(new I({body:l,headers:i,status:r,statusText:s,url:a||void 0})),e.complete()):e.error(new E({error:l,headers:i,status:r,statusText:s,url:a||void 0}))},a=t=>{const{url:i}=o(),r=new E({error:t,status:n.status||0,statusText:n.statusText||"Unknown Error",url:i||void 0});e.error(r)};let l=!1;const c=i=>{l||(e.next(o()),l=!0);let r={type:A.DownloadProgress,loaded:i.loaded};i.lengthComputable&&(r.total=i.total),"text"===t.responseType&&!!n.responseText&&(r.partialText=n.responseText),e.next(r)},u=t=>{let n={type:A.UploadProgress,loaded:t.loaded};t.lengthComputable&&(n.total=t.total),e.next(n)};return n.addEventListener("load",s),n.addEventListener("error",a),n.addEventListener("timeout",a),n.addEventListener("abort",a),t.reportProgress&&(n.addEventListener("progress",c),null!==i&&n.upload&&n.upload.addEventListener("progress",u)),n.send(i),e.next({type:A.Sent}),()=>{n.removeEventListener("error",a),n.removeEventListener("abort",a),n.removeEventListener("load",s),n.removeEventListener("timeout",a),t.reportProgress&&(n.removeEventListener("progress",c),null!==i&&n.upload&&n.upload.removeEventListener("progress",u)),n.readyState!==n.DONE&&n.abort()}})}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(i.JF))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})();const z=new r.OlP("XSRF_COOKIE_NAME"),Z=new r.OlP("XSRF_HEADER_NAME");class F{}let U=(()=>{class t{constructor(t,e,n){this.doc=t,this.platform=e,this.cookieName=n,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,i.Mx)(t,this.cookieName),this.lastCookieString=t),this.lastToken}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(i.K0),r.LFG(r.Lbi),r.LFG(z))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})(),N=(()=>{class t{constructor(t,e){this.tokenService=t,this.headerName=e}intercept(t,e){const n=t.url.toLowerCase();if("GET"===t.method||"HEAD"===t.method||n.startsWith("http://")||n.startsWith("https://"))return e.handle(t);const i=this.tokenService.getToken();return null!==i&&!t.headers.has(this.headerName)&&(t=t.clone({headers:t.headers.set(this.headerName,i)})),e.handle(t)}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(F),r.LFG(Z))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})(),B=(()=>{class t{constructor(t,e){this.backend=t,this.injector=e,this.chain=null}handle(t){if(null===this.chain){const t=this.injector.get(D,[]);this.chain=t.reduceRight((t,e)=>new P(t,e),this.backend)}return this.chain.handle(t)}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(h),r.LFG(r.zs3))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})(),q=(()=>{class t{static disable(){return{ngModule:t,providers:[{provide:N,useClass:L}]}}static withOptions(e={}){return{ngModule:t,providers:[e.cookieName?{provide:z,useValue:e.cookieName}:[],e.headerName?{provide:Z,useValue:e.headerName}:[]]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({providers:[N,{provide:D,useExisting:N,multi:!0},{provide:F,useClass:U},{provide:z,useValue:"XSRF-TOKEN"},{provide:Z,useValue:"X-XSRF-TOKEN"}]}),t})(),$=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({providers:[k,{provide:u,useClass:B},R,{provide:h,useExisting:R}],imports:[[q.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),t})()},639:function(t,e,n){"use strict";n.d(e,{deG:function(){return dn},tb:function(){return Yl},AFp:function(){return ql},ip1:function(){return Nl},CZH:function(){return Bl},hGG:function(){return Uc},z2F:function(){return Mc},ahi:function(){return un},sBO:function(){return Fa},Sil:function(){return rc},_Vd:function(){return la},aQ5:function(){return fn},EJc:function(){return Wl},SBq:function(){return da},qLn:function(){return Li},vpe:function(){return vl},L6J:function(){return Ul},gxx:function(){return bo},tBr:function(){return Un},XFs:function(){return O},OlP:function(){return hn},zs3:function(){return zo},ZZ4:function(){return Pa},aQg:function(){return La},soG:function(){return Jl},YKP:function(){return Ha},v3s:function(){return Pc},h0i:function(){return Ya},PXZ:function(){return Ac},R0b:function(){return ac},FiY:function(){return Nn},r_U:function(){return Fl},Lbi:function(){return Gl},g9A:function(){return jl},Qsj:function(){return ma},FYo:function(){return fa},JOm:function(){return zi},Tiy:function(){return ya},q3G:function(){return Ci},tp0:function(){return Bn},EAV:function(){return Oc},Rgc:function(){return $a},dDg:function(){return fc},DyG:function(){return gn},GfV:function(){return _a},i9L:function(){return mn},s_b:function(){return Wa},ifc:function(){return N},eFA:function(){return Sc},G48:function(){return bc},Gpc:function(){return y},_c5:function(){return Zc},VLi:function(){return yc},c2e:function(){return Hl},zSh:function(){return To},wAp:function(){return Ys},vHH:function(){return x},EiD:function(){return Ai},mCW:function(){return li},qzn:function(){return Xn},JVY:function(){return Kn},pB0:function(){return ii},eBb:function(){return ei},L6k:function(){return ti},LAX:function(){return ni},cg1:function(){return Vs},Tjo:function(){return zc},kL8:function(){return js},yhl:function(){return Qn},dqk:function(){return j},sIi:function(){return Go},CqO:function(){return ms},QGY:function(){return ps},F4k:function(){return fs},RDi:function(){return Mt},AaK:function(){return f},z3N:function(){return Wn},qOj:function(){return Fo},TTD:function(){return wt},_Bn:function(){return ra},xp6:function(){return Tr},uIk:function(){return Xo},ekj:function(){return Es},Suo:function(){return Ll},Xpm:function(){return nt},lG2:function(){return ct},Yz7:function(){return S},cJS:function(){return C},oAB:function(){return st},Yjl:function(){return ut},Y36:function(){return is},_UZ:function(){return cs},BQk:function(){return hs},ynx:function(){return us},qZA:function(){return ls},TgZ:function(){return as},EpF:function(){return ds},n5z:function(){return tn},Ikx:function(){return Ns},LFG:function(){return On},$8M:function(){return nn},$Z:function(){return rs},NdJ:function(){return gs},CRH:function(){return Ol},oxw:function(){return vs},ALo:function(){return pl},lcZ:function(){return fl},xi3:function(){return ml},Hsn:function(){return ws},F$t:function(){return bs},Q6J:function(){return os},s9C:function(){return Ts},DdM:function(){return hl},iGM:function(){return Pl},MAs:function(){return ns},CHM:function(){return Yt},LSH:function(){return Ii},kYT:function(){return at},Udp:function(){return Is},YNc:function(){return es},_uU:function(){return Os},Oqu:function(){return Rs},hij:function(){return zs},AsE:function(){return Zs},lnq:function(){return Fs},HOy:function(){return Us},Gf:function(){return Dl}});var i=n(7574),r=n(4869),o=n(3282),s=n(6693),a=n(9765),l=n(5319),c=n(2441);var u=n(1307);function h(){return new a.xQ}function d(t){for(let e in t)if(t[e]===d)return e;throw Error("Could not find renamed property on target object.")}function p(t,e){for(const n in e)e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=e[n])}function f(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(f).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function m(t,e){return null==t||""===t?null===e?"":e:null==e||""===e?t:t+" "+e}const g=d({__forward_ref__:d});function y(t){return t.__forward_ref__=y,t.toString=function(){return f(this())},t}function _(t){return v(t)?t():t}function v(t){return"function"==typeof t&&t.hasOwnProperty(g)&&t.__forward_ref__===y}class x extends Error{constructor(t,e){super(function(t,e){return`${t?`NG0${t}: `:""}${e}`}(t,e)),this.code=t}}function b(t){return"string"==typeof t?t:null==t?"":String(t)}function w(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():b(t)}function T(t,e){const n=e?` in ${e}`:"";throw new x("201",`No provider for ${w(t)} found${n}`)}function A(t,e){null==t&&function(t,e,n,i){throw new Error(`ASSERTION ERROR: ${t}`+(null==i?"":` [Expected=> ${n} ${i} ${e} <=Actual]`))}(e,t,null,"!=")}function S(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function C(t){return{providers:t.providers||[],imports:t.imports||[]}}function I(t){return E(t,k)||E(t,D)}function E(t,e){return t.hasOwnProperty(e)?t[e]:null}function M(t){return t&&(t.hasOwnProperty(P)||t.hasOwnProperty(L))?t[P]:null}const k=d({"\u0275prov":d}),P=d({"\u0275inj":d}),D=d({ngInjectableDef:d}),L=d({ngInjectorDef:d});var O=(()=>((O=O||{})[O.Default=0]="Default",O[O.Host=1]="Host",O[O.Self=2]="Self",O[O.SkipSelf=4]="SkipSelf",O[O.Optional=8]="Optional",O))();let R;function z(t){const e=R;return R=t,e}function Z(t,e,n){const i=I(t);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:n&O.Optional?null:void 0!==e?e:void T(f(t),"Injector")}function F(t){return{toString:t}.toString()}var U=(()=>((U=U||{})[U.OnPush=0]="OnPush",U[U.Default=1]="Default",U))(),N=(()=>((N=N||{})[N.Emulated=0]="Emulated",N[N.None=2]="None",N[N.ShadowDom=3]="ShadowDom",N))();const B="undefined"!=typeof globalThis&&globalThis,q="undefined"!=typeof window&&window,$="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,V="undefined"!=typeof global&&global,j=B||V||q||$,G={},Y=[],H=d({"\u0275cmp":d}),J=d({"\u0275dir":d}),W=d({"\u0275pipe":d}),X=d({"\u0275mod":d}),Q=d({"\u0275loc":d}),K=d({"\u0275fac":d}),tt=d({__NG_ELEMENT_ID__:d});let et=0;function nt(t){return F(()=>{const e={},n={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:e,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===U.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||Y,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||N.Emulated,id:"c",styles:t.styles||Y,_:null,setInput:null,schemas:t.schemas||null,tView:null},i=t.directives,r=t.features,o=t.pipes;return n.id+=et++,n.inputs=lt(t.inputs,e),n.outputs=lt(t.outputs),r&&r.forEach(t=>t(n)),n.directiveDefs=i?()=>("function"==typeof i?i():i).map(it):null,n.pipeDefs=o?()=>("function"==typeof o?o():o).map(rt):null,n})}function it(t){return ht(t)||function(t){return t[J]||null}(t)}function rt(t){return function(t){return t[W]||null}(t)}const ot={};function st(t){return F(()=>{const e={type:t.type,bootstrap:t.bootstrap||Y,declarations:t.declarations||Y,imports:t.imports||Y,exports:t.exports||Y,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(ot[t.id]=t.type),e})}function at(t,e){return F(()=>{const n=dt(t,!0);n.declarations=e.declarations||Y,n.imports=e.imports||Y,n.exports=e.exports||Y})}function lt(t,e){if(null==t)return G;const n={};for(const i in t)if(t.hasOwnProperty(i)){let r=t[i],o=r;Array.isArray(r)&&(o=r[1],r=r[0]),n[r]=i,e&&(e[r]=o)}return n}const ct=nt;function ut(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,onDestroy:t.type.prototype.ngOnDestroy||null}}function ht(t){return t[H]||null}function dt(t,e){const n=t[X]||null;if(!n&&!0===e)throw new Error(`Type ${f(t)} does not have '\u0275mod' property.`);return n}function pt(t){return Array.isArray(t)&&"object"==typeof t[1]}function ft(t){return Array.isArray(t)&&!0===t[1]}function mt(t){return 0!=(8&t.flags)}function gt(t){return 2==(2&t.flags)}function yt(t){return 1==(1&t.flags)}function _t(t){return null!==t.template}function vt(t){return 0!=(512&t[2])}function xt(t,e){return t.hasOwnProperty(K)?t[K]:null}class bt{constructor(t,e,n){this.previousValue=t,this.currentValue=e,this.firstChange=n}isFirstChange(){return this.firstChange}}function wt(){return Tt}function Tt(t){return t.type.prototype.ngOnChanges&&(t.setInput=St),At}function At(){const t=It(this),e=null==t?void 0:t.current;if(e){const n=t.previous;if(n===G)t.previous=e;else for(let t in e)n[t]=e[t];t.current=null,this.ngOnChanges(e)}}function St(t,e,n,i){const r=It(t)||function(t,e){return t[Ct]=e}(t,{previous:G,current:null}),o=r.current||(r.current={}),s=r.previous,a=this.declaredInputs[n],l=s[a];o[a]=new bt(l&&l.currentValue,e,s===G),t[i]=e}wt.ngInherit=!0;const Ct="__ngSimpleChanges__";function It(t){return t[Ct]||null}let Et;function Mt(t){Et=t}function kt(t){return!!t.listen}const Pt={createRenderer:(t,e)=>void 0!==Et?Et:"undefined"!=typeof document?document:void 0};function Dt(t){for(;Array.isArray(t);)t=t[0];return t}function Lt(t,e){return Dt(e[t])}function Ot(t,e){return Dt(e[t.index])}function Rt(t,e){return t.data[e]}function zt(t,e){return t[e]}function Zt(t,e){const n=e[t];return pt(n)?n:n[0]}function Ft(t){return 4==(4&t[2])}function Ut(t){return 128==(128&t[2])}function Nt(t,e){return null==e?null:t[e]}function Bt(t){t[18]=0}function qt(t,e){t[5]+=e;let n=t,i=t[3];for(;null!==i&&(1===e&&1===n[5]||-1===e&&0===n[5]);)i[5]+=e,n=i,i=i[3]}const $t={lFrame:pe(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Vt(){return $t.bindingsEnabled}function jt(){return $t.lFrame.lView}function Gt(){return $t.lFrame.tView}function Yt(t){return $t.lFrame.contextLView=t,t[8]}function Ht(){let t=Jt();for(;null!==t&&64===t.type;)t=t.parent;return t}function Jt(){return $t.lFrame.currentTNode}function Wt(t,e){const n=$t.lFrame;n.currentTNode=t,n.isParent=e}function Xt(){return $t.lFrame.isParent}function Qt(){$t.lFrame.isParent=!1}function Kt(){return $t.isInCheckNoChangesMode}function te(t){$t.isInCheckNoChangesMode=t}function ee(){const t=$t.lFrame;let e=t.bindingRootIndex;return-1===e&&(e=t.bindingRootIndex=t.tView.bindingStartIndex),e}function ne(){return $t.lFrame.bindingIndex}function ie(){return $t.lFrame.bindingIndex++}function re(t){const e=$t.lFrame,n=e.bindingIndex;return e.bindingIndex=e.bindingIndex+t,n}function oe(t,e){const n=$t.lFrame;n.bindingIndex=n.bindingRootIndex=t,se(e)}function se(t){$t.lFrame.currentDirectiveIndex=t}function ae(){return $t.lFrame.currentQueryIndex}function le(t){$t.lFrame.currentQueryIndex=t}function ce(t){const e=t[1];return 2===e.type?e.declTNode:1===e.type?t[6]:null}function ue(t,e,n){if(n&O.SkipSelf){let i=e,r=t;for(;!(i=i.parent,null!==i||n&O.Host||(i=ce(r),null===i||(r=r[15],10&i.type))););if(null===i)return!1;e=i,t=r}const i=$t.lFrame=de();return i.currentTNode=e,i.lView=t,!0}function he(t){const e=de(),n=t[1];$t.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function de(){const t=$t.lFrame,e=null===t?null:t.child;return null===e?pe(t):e}function pe(t){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=e),e}function fe(){const t=$t.lFrame;return $t.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const me=fe;function ge(){const t=fe();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function ye(){return $t.lFrame.selectedIndex}function _e(t){$t.lFrame.selectedIndex=t}function ve(){const t=$t.lFrame;return Rt(t.tView,t.selectedIndex)}function xe(t,e){for(let n=e.directiveStart,i=e.directiveEnd;n<i;n++){const e=t.data[n].type.prototype,{ngAfterContentInit:i,ngAfterContentChecked:r,ngAfterViewInit:o,ngAfterViewChecked:s,ngOnDestroy:a}=e;i&&(t.contentHooks||(t.contentHooks=[])).push(-n,i),r&&((t.contentHooks||(t.contentHooks=[])).push(n,r),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(n,r)),o&&(t.viewHooks||(t.viewHooks=[])).push(-n,o),s&&((t.viewHooks||(t.viewHooks=[])).push(n,s),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(n,s)),null!=a&&(t.destroyHooks||(t.destroyHooks=[])).push(n,a)}}function be(t,e,n){Ae(t,e,3,n)}function we(t,e,n,i){(3&t[2])===n&&Ae(t,e,n,i)}function Te(t,e){let n=t[2];(3&n)===e&&(n&=2047,n+=1,t[2]=n)}function Ae(t,e,n,i){const r=null!=i?i:-1,o=e.length-1;let s=0;for(let a=void 0!==i?65535&t[18]:0;a<o;a++)if("number"==typeof e[a+1]){if(s=e[a],null!=i&&s>=i)break}else e[a]<0&&(t[18]+=65536),(s<r||-1==r)&&(Se(t,n,e,a),t[18]=(4294901760&t[18])+a+2),a++}function Se(t,e,n,i){const r=n[i]<0,o=n[i+1],s=t[r?-n[i]:n[i]];if(r){if(t[2]>>11<t[18]>>16&&(3&t[2])===e){t[2]+=2048;try{o.call(s)}finally{}}}else try{o.call(s)}finally{}}class Ce{constructor(t,e,n){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=n}}function Ie(t,e,n){const i=kt(t);let r=0;for(;r<n.length;){const o=n[r];if("number"==typeof o){if(0!==o)break;r++;const s=n[r++],a=n[r++],l=n[r++];i?t.setAttribute(e,a,l,s):e.setAttributeNS(s,a,l)}else{const s=o,a=n[++r];Me(s)?i&&t.setProperty(e,s,a):i?t.setAttribute(e,s,a):e.setAttribute(s,a),r++}}return r}function Ee(t){return 3===t||4===t||6===t}function Me(t){return 64===t.charCodeAt(0)}function ke(t,e){if(null!==e&&0!==e.length)if(null===t||0===t.length)t=e.slice();else{let n=-1;for(let i=0;i<e.length;i++){const r=e[i];"number"==typeof r?n=r:0===n||Pe(t,n,r,null,-1===n||2===n?e[++i]:null)}}return t}function Pe(t,e,n,i,r){let o=0,s=t.length;if(-1===e)s=-1;else for(;o<t.length;){const n=t[o++];if("number"==typeof n){if(n===e){s=-1;break}if(n>e){s=o-1;break}}}for(;o<t.length;){const e=t[o];if("number"==typeof e)break;if(e===n){if(null===i)return void(null!==r&&(t[o+1]=r));if(i===t[o+1])return void(t[o+2]=r)}o++,null!==i&&o++,null!==r&&o++}-1!==s&&(t.splice(s,0,e),o=s+1),t.splice(o++,0,n),null!==i&&t.splice(o++,0,i),null!==r&&t.splice(o++,0,r)}function De(t){return-1!==t}function Le(t){return 32767&t}function Oe(t,e){let n=function(t){return t>>16}(t),i=e;for(;n>0;)i=i[15],n--;return i}let Re=!0;function ze(t){const e=Re;return Re=t,e}let Ze=0;function Fe(t,e){const n=Ne(t,e);if(-1!==n)return n;const i=e[1];i.firstCreatePass&&(t.injectorIndex=e.length,Ue(i.data,t),Ue(e,null),Ue(i.blueprint,null));const r=Be(t,e),o=t.injectorIndex;if(De(r)){const t=Le(r),n=Oe(r,e),i=n[1].data;for(let r=0;r<8;r++)e[o+r]=n[t+r]|i[t+r]}return e[o+8]=r,o}function Ue(t,e){t.push(0,0,0,0,0,0,0,0,e)}function Ne(t,e){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===e[t.injectorIndex+8]?-1:t.injectorIndex}function Be(t,e){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let n=0,i=null,r=e;for(;null!==r;){const t=r[1],e=t.type;if(i=2===e?t.declTNode:1===e?r[6]:null,null===i)return-1;if(n++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|n<<16}return-1}function qe(t,e,n){!function(t,e,n){let i;"string"==typeof n?i=n.charCodeAt(0)||0:n.hasOwnProperty(tt)&&(i=n[tt]),null==i&&(i=n[tt]=Ze++);const r=255&i;e.data[t+(r>>5)]|=1<<r}(t,e,n)}function $e(t,e,n){if(n&O.Optional)return t;T(e,"NodeInjector")}function Ve(t,e,n,i){if(n&O.Optional&&void 0===i&&(i=null),0==(n&(O.Self|O.Host))){const r=t[9],o=z(void 0);try{return r?r.get(e,i,n&O.Optional):Z(e,i,n&O.Optional)}finally{z(o)}}return $e(i,e,n)}function je(t,e,n,i=O.Default,r){if(null!==t){const o=function(t){if("string"==typeof t)return t.charCodeAt(0)||0;const e=t.hasOwnProperty(tt)?t[tt]:void 0;return"number"==typeof e?e>=0?255&e:Ye:e}(n);if("function"==typeof o){if(!ue(e,t,i))return i&O.Host?$e(r,n,i):Ve(e,n,i,r);try{const t=o(i);if(null!=t||i&O.Optional)return t;T(n)}finally{me()}}else if("number"==typeof o){let r=null,s=Ne(t,e),a=-1,l=i&O.Host?e[16][6]:null;for((-1===s||i&O.SkipSelf)&&(a=-1===s?Be(t,e):e[s+8],-1!==a&&Qe(i,!1)?(r=e[1],s=Le(a),e=Oe(a,e)):s=-1);-1!==s;){const t=e[1];if(Xe(o,s,t.data)){const t=He(s,e,n,r,i,l);if(t!==Ge)return t}a=e[s+8],-1!==a&&Qe(i,e[1].data[s+8]===l)&&Xe(o,s,e)?(r=t,s=Le(a),e=Oe(a,e)):s=-1}}}return Ve(e,n,i,r)}const Ge={};function Ye(){return new Ke(Ht(),jt())}function He(t,e,n,i,r,o){const s=e[1],a=s.data[t+8],l=Je(a,s,n,null==i?gt(a)&&Re:i!=s&&0!=(3&a.type),r&O.Host&&o===a);return null!==l?We(e,s,l,a):Ge}function Je(t,e,n,i,r){const o=t.providerIndexes,s=e.data,a=1048575&o,l=t.directiveStart,c=o>>20,u=r?a+c:t.directiveEnd;for(let h=i?a:a+c;h<u;h++){const t=s[h];if(h<l&&n===t||h>=l&&t.type===n)return h}if(r){const t=s[l];if(t&&_t(t)&&t.type===n)return l}return null}function We(t,e,n,i){let r=t[n];const o=e.data;if(function(t){return t instanceof Ce}(r)){const s=r;s.resolving&&function(t,e){throw new x("200",`Circular dependency in DI detected for ${t}`)}(w(o[n]));const a=ze(s.canSeeViewProviders);s.resolving=!0;const l=s.injectImpl?z(s.injectImpl):null;ue(t,i,O.Default);try{r=t[n]=s.factory(void 0,o,t,i),e.firstCreatePass&&n>=i.directiveStart&&function(t,e,n){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:o}=e.type.prototype;if(i){const i=Tt(e);(n.preOrderHooks||(n.preOrderHooks=[])).push(t,i),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,i)}r&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-t,r),o&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t,o),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,o))}(n,o[n],e)}finally{null!==l&&z(l),ze(a),s.resolving=!1,me()}}return r}function Xe(t,e,n){return!!(n[e+(t>>5)]&1<<t)}function Qe(t,e){return!(t&O.Self||t&O.Host&&e)}class Ke{constructor(t,e){this._tNode=t,this._lView=e}get(t,e){return je(this._tNode,this._lView,t,void 0,e)}}function tn(t){return F(()=>{const e=t.prototype.constructor,n=e[K]||en(e),i=Object.prototype;let r=Object.getPrototypeOf(t.prototype).constructor;for(;r&&r!==i;){const t=r[K]||en(r);if(t&&t!==n)return t;r=Object.getPrototypeOf(r)}return t=>new t})}function en(t){return v(t)?()=>{const e=en(_(t));return e&&e()}:xt(t)}function nn(t){return function(t,e){if("class"===e)return t.classes;if("style"===e)return t.styles;const n=t.attrs;if(n){const t=n.length;let i=0;for(;i<t;){const r=n[i];if(Ee(r))break;if(0===r)i+=2;else if("number"==typeof r)for(i++;i<t&&"string"==typeof n[i];)i++;else{if(r===e)return n[i+1];i+=2}}}return null}(Ht(),t)}const rn="__parameters__",on="__prop__metadata__";function sn(t){return function(...e){if(t){const n=t(...e);for(const t in n)this[t]=n[t]}}}function an(t,e,n){return F(()=>{const i=sn(e);function r(...t){if(this instanceof r)return i.apply(this,t),this;const e=new r(...t);return n.annotation=e,n;function n(t,n,i){const r=t.hasOwnProperty(rn)?t[rn]:Object.defineProperty(t,rn,{value:[]})[rn];for(;r.length<=i;)r.push(null);return(r[i]=r[i]||[]).push(e),t}}return n&&(r.prototype=Object.create(n.prototype)),r.prototype.ngMetadataName=t,r.annotationCls=r,r})}function ln(t,e,n,i){return F(()=>{const r=sn(e);function o(...t){if(this instanceof o)return r.apply(this,t),this;const e=new o(...t);return function(n,r){const o=n.constructor,s=o.hasOwnProperty(on)?o[on]:Object.defineProperty(o,on,{value:{}})[on];s[r]=s.hasOwnProperty(r)&&s[r]||[],s[r].unshift(e),i&&i(n,r,...t)}}return n&&(o.prototype=Object.create(n.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}function cn(){return an("Attribute",t=>({attributeName:t,__NG_ELEMENT_ID__:()=>nn(t)}))}const un=cn();class hn{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=S({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}toString(){return`InjectionToken ${this._desc}`}}const dn=new hn("AnalyzeForEntryComponents");class pn{}const fn=ln("ContentChild",(t,e={})=>Object.assign({selector:t,first:!0,isViewQuery:!1,descendants:!0},e),pn),mn=ln("ViewChild",(t,e)=>Object.assign({selector:t,first:!0,isViewQuery:!0,descendants:!0},e),pn),gn=Function;function yn(t,e){void 0===e&&(e=t);for(let n=0;n<t.length;n++){let i=t[n];Array.isArray(i)?(e===t&&(e=t.slice(0,n)),yn(i,e)):e!==t&&e.push(i)}return e}function _n(t,e){t.forEach(t=>Array.isArray(t)?_n(t,e):e(t))}function vn(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function xn(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}function bn(t,e){const n=[];for(let i=0;i<t;i++)n.push(e);return n}function wn(t,e,n){let i=An(t,e);return i>=0?t[1|i]=n:(i=~i,function(t,e,n,i){let r=t.length;if(r==e)t.push(n,i);else if(1===r)t.push(i,t[0]),t[0]=n;else{for(r--,t.push(t[r-1],t[r]);r>e;)t[r]=t[r-2],r--;t[e]=n,t[e+1]=i}}(t,i,e,n)),i}function Tn(t,e){const n=An(t,e);if(n>=0)return t[1|n]}function An(t,e){return function(t,e,n){let i=0,r=t.length>>n;for(;r!==i;){const o=i+(r-i>>1),s=t[o<<n];if(e===s)return o<<n;s>e?r=o:i=o+1}return~(r<<n)}(t,e,1)}const Sn={},Cn="__NG_DI_FLAG__",In="ngTempTokenPath",En=/\n/gm,Mn="__source",kn=d({provide:String,useValue:d});let Pn;function Dn(t){const e=Pn;return Pn=t,e}function Ln(t,e=O.Default){if(void 0===Pn)throw new Error("inject() must be called from an injection context");return null===Pn?Z(t,void 0,e):Pn.get(t,e&O.Optional?null:void 0,e)}function On(t,e=O.Default){return(R||Ln)(_(t),e)}function Rn(t){const e=[];for(let n=0;n<t.length;n++){const i=_(t[n]);if(Array.isArray(i)){if(0===i.length)throw new Error("Arguments array must have arguments.");let t,n=O.Default;for(let e=0;e<i.length;e++){const r=i[e],o=Zn(r);"number"==typeof o?-1===o?t=r.token:n|=o:t=r}e.push(On(t,n))}else e.push(On(i))}return e}function zn(t,e){return t[Cn]=e,t.prototype[Cn]=e,t}function Zn(t){return t[Cn]}function Fn(t,e,n,i){const r=t[In];throw e[Mn]&&r.unshift(e[Mn]),t.message=function(t,e,n,i=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let r=f(e);if(Array.isArray(e))r=e.map(f).join(" -> ");else if("object"==typeof e){let t=[];for(let n in e)if(e.hasOwnProperty(n)){let i=e[n];t.push(n+":"+("string"==typeof i?JSON.stringify(i):f(i)))}r=`{${t.join(", ")}}`}return`${n}${i?"("+i+")":""}[${r}]: ${t.replace(En,"\n  ")}`}("\n"+t.message,r,n,i),t.ngTokenPath=r,t[In]=null,t}const Un=zn(an("Inject",t=>({token:t})),-1),Nn=zn(an("Optional"),8),Bn=zn(an("SkipSelf"),4);let qn;function $n(t){var e;return(null===(e=function(){if(void 0===qn&&(qn=null,j.trustedTypes))try{qn=j.trustedTypes.createPolicy("angular",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch(t){}return qn}())||void 0===e?void 0:e.createHTML(t))||t}class Vn{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class jn extends Vn{getTypeName(){return"HTML"}}class Gn extends Vn{getTypeName(){return"Style"}}class Yn extends Vn{getTypeName(){return"Script"}}class Hn extends Vn{getTypeName(){return"URL"}}class Jn extends Vn{getTypeName(){return"ResourceURL"}}function Wn(t){return t instanceof Vn?t.changingThisBreaksApplicationSecurity:t}function Xn(t,e){const n=Qn(t);if(null!=n&&n!==e){if("ResourceURL"===n&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===e}function Qn(t){return t instanceof Vn&&t.getTypeName()||null}function Kn(t){return new jn(t)}function ti(t){return new Gn(t)}function ei(t){return new Yn(t)}function ni(t){return new Hn(t)}function ii(t){return new Jn(t)}class ri{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString($n(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class oi{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const t=this.inertDocument.createElement("html");this.inertDocument.appendChild(t);const e=this.inertDocument.createElement("body");t.appendChild(e)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=$n(t),e;const n=this.inertDocument.createElement("body");return n.innerHTML=$n(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(n),n}stripCustomNsAttrs(t){const e=t.attributes;for(let i=e.length-1;0<i;i--){const n=e.item(i).name;("xmlns:ns1"===n||0===n.indexOf("ns1:"))&&t.removeAttribute(n)}let n=t.firstChild;for(;n;)n.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(n),n=n.nextSibling}}const si=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,ai=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function li(t){return(t=String(t)).match(si)||t.match(ai)?t:"unsafe:"+t}function ci(t){const e={};for(const n of t.split(","))e[n]=!0;return e}function ui(...t){const e={};for(const n of t)for(const t in n)n.hasOwnProperty(t)&&(e[t]=!0);return e}const hi=ci("area,br,col,hr,img,wbr"),di=ci("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),pi=ci("rp,rt"),fi=ui(hi,ui(di,ci("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),ui(pi,ci("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),ui(pi,di)),mi=ci("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),gi=ci("srcset"),yi=ui(mi,gi,ci("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),ci("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),_i=ci("script,style,template");class vi{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,n=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?n=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,n&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let t=this.checkClobberedElement(e,e.nextSibling);if(t){e=t;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!fi.hasOwnProperty(e))return this.sanitizedSomething=!0,!_i.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const n=t.attributes;for(let r=0;r<n.length;r++){const t=n.item(r),e=t.name,o=e.toLowerCase();if(!yi.hasOwnProperty(o)){this.sanitizedSomething=!0;continue}let s=t.value;mi[o]&&(s=li(s)),gi[o]&&(i=s,s=(i=String(i)).split(",").map(t=>li(t.trim())).join(", ")),this.buf.push(" ",e,'="',wi(s),'"')}var i;return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();fi.hasOwnProperty(e)&&!hi.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(wi(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const xi=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,bi=/([^\#-~ |!])/g;function wi(t){return t.replace(/&/g,"&amp;").replace(xi,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(bi,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Ti;function Ai(t,e){let n=null;try{Ti=Ti||function(t){const e=new oi(t);return function(){try{return!!(new window.DOMParser).parseFromString($n(""),"text/html")}catch(t){return!1}}()?new ri(e):e}(t);let i=e?String(e):"";n=Ti.getInertBodyElement(i);let r=5,o=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=o,o=n.innerHTML,n=Ti.getInertBodyElement(i)}while(i!==o);return $n((new vi).sanitizeChildren(Si(n)||n))}finally{if(n){const t=Si(n)||n;for(;t.firstChild;)t.removeChild(t.firstChild)}}}function Si(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}var Ci=(()=>((Ci=Ci||{})[Ci.NONE=0]="NONE",Ci[Ci.HTML=1]="HTML",Ci[Ci.STYLE=2]="STYLE",Ci[Ci.SCRIPT=3]="SCRIPT",Ci[Ci.URL=4]="URL",Ci[Ci.RESOURCE_URL=5]="RESOURCE_URL",Ci))();function Ii(t){const e=function(){const t=jt();return t&&t[12]}();return e?e.sanitize(Ci.URL,t)||"":Xn(t,"URL")?Wn(t):li(b(t))}const Ei="__ngContext__";function Mi(t,e){t[Ei]=e}function ki(t){const e=function(t){return t[Ei]||null}(t);return e?Array.isArray(e)?e:e.lView:null}function Pi(t){return t.ngOriginalError}function Di(t,...e){t.error(...e)}class Li{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t),n=this._findContext(t),i=(r=t)&&r.ngErrorLogger||Di;var r;i(this._console,"ERROR",t),e&&i(this._console,"ORIGINAL ERROR",e),n&&i(this._console,"ERROR CONTEXT",n)}_findContext(t){return t?t.ngDebugContext||this._findContext(Pi(t)):null}_findOriginalError(t){let e=t&&Pi(t);for(;e&&Pi(e);)e=Pi(e);return e||null}}const Oi=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(j))();function Ri(t){return t instanceof Function?t():t}var zi=(()=>((zi=zi||{})[zi.Important=1]="Important",zi[zi.DashCase=2]="DashCase",zi))();function Zi(t,e){return undefined(t,e)}function Fi(t){const e=t[3];return ft(e)?e[3]:e}function Ui(t){return Bi(t[13])}function Ni(t){return Bi(t[4])}function Bi(t){for(;null!==t&&!ft(t);)t=t[4];return t}function qi(t,e,n,i,r){if(null!=i){let o,s=!1;ft(i)?o=i:pt(i)&&(s=!0,i=i[0]);const a=Dt(i);0===t&&null!==n?null==r?Wi(e,n,a):Ji(e,n,a,r||null,!0):1===t&&null!==n?Ji(e,n,a,r||null,!0):2===t?function(t,e,n){const i=Qi(t,e);i&&function(t,e,n,i){kt(t)?t.removeChild(e,n,i):e.removeChild(n)}(t,i,e,n)}(e,a,s):3===t&&e.destroyNode(a),null!=o&&function(t,e,n,i,r){const o=n[7];o!==Dt(n)&&qi(e,t,i,o,r);for(let s=10;s<n.length;s++){const r=n[s];sr(r[1],r,t,e,i,o)}}(e,t,o,n,r)}}function $i(t,e,n){return kt(t)?t.createElement(e,n):null===n?t.createElement(e):t.createElementNS(n,e)}function Vi(t,e){const n=t[9],i=n.indexOf(e),r=e[3];1024&e[2]&&(e[2]&=-1025,qt(r,-1)),n.splice(i,1)}function ji(t,e){if(t.length<=10)return;const n=10+e,i=t[n];if(i){const r=i[17];null!==r&&r!==t&&Vi(r,i),e>0&&(t[n-1][4]=i[4]);const o=xn(t,10+e);!function(t,e){sr(t,e,e[11],2,null,null),e[0]=null,e[6]=null}(i[1],i);const s=o[19];null!==s&&s.detachView(o[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function Gi(t,e){if(!(256&e[2])){const n=e[11];kt(n)&&n.destroyNode&&sr(t,e,n,3,null,null),function(t){let e=t[13];if(!e)return Yi(t[1],t);for(;e;){let n=null;if(pt(e))n=e[13];else{const t=e[10];t&&(n=t)}if(!n){for(;e&&!e[4]&&e!==t;)pt(e)&&Yi(e[1],e),e=e[3];null===e&&(e=t),pt(e)&&Yi(e[1],e),n=e&&e[4]}e=n}}(e)}}function Yi(t,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function(t,e){let n;if(null!=t&&null!=(n=t.destroyHooks))for(let i=0;i<n.length;i+=2){const t=e[n[i]];if(!(t instanceof Ce)){const e=n[i+1];if(Array.isArray(e))for(let n=0;n<e.length;n+=2){const i=t[e[n]],r=e[n+1];try{r.call(i)}finally{}}else try{e.call(t)}finally{}}}}(t,e),function(t,e){const n=t.cleanup,i=e[7];let r=-1;if(null!==n)for(let o=0;o<n.length-1;o+=2)if("string"==typeof n[o]){const t=n[o+1],s="function"==typeof t?t(e):Dt(e[t]),a=i[r=n[o+2]],l=n[o+3];"boolean"==typeof l?s.removeEventListener(n[o],a,l):l>=0?i[r=l]():i[r=-l].unsubscribe(),o+=2}else{const t=i[r=n[o+1]];n[o].call(t)}if(null!==i){for(let t=r+1;t<i.length;t++)i[t]();e[7]=null}}(t,e),1===e[1].type&&kt(e[11])&&e[11].destroy();const n=e[17];if(null!==n&&ft(e[3])){n!==e[3]&&Vi(n,e);const i=e[19];null!==i&&i.detachView(t)}}}function Hi(t,e,n){return function(t,e,n){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return n[0];if(2&i.flags){const e=t.data[i.directiveStart].encapsulation;if(e===N.None||e===N.Emulated)return null}return Ot(i,n)}(t,e.parent,n)}function Ji(t,e,n,i,r){kt(t)?t.insertBefore(e,n,i,r):e.insertBefore(n,i,r)}function Wi(t,e,n){kt(t)?t.appendChild(e,n):e.appendChild(n)}function Xi(t,e,n,i,r){null!==i?Ji(t,e,n,i,r):Wi(t,e,n)}function Qi(t,e){return kt(t)?t.parentNode(e):e.parentNode}function Ki(t,e,n){return tr(t,e,n)}let tr=function(t,e,n){return 40&t.type?Ot(t,n):null};function er(t,e,n,i){const r=Hi(t,i,e),o=e[11],s=Ki(i.parent||e[6],i,e);if(null!=r)if(Array.isArray(n))for(let a=0;a<n.length;a++)Xi(o,r,n[a],s,!1);else Xi(o,r,n,s,!1)}function nr(t,e){if(null!==e){const n=e.type;if(3&n)return Ot(e,t);if(4&n)return rr(-1,t[e.index]);if(8&n){const n=e.child;if(null!==n)return nr(t,n);{const n=t[e.index];return ft(n)?rr(-1,n):Dt(n)}}if(32&n)return Zi(e,t)()||Dt(t[e.index]);{const n=ir(t,e);return null!==n?Array.isArray(n)?n[0]:nr(Fi(t[16]),n):nr(t,e.next)}}return null}function ir(t,e){return null!==e?t[16][6].projection[e.projection]:null}function rr(t,e){const n=10+t+1;if(n<e.length){const t=e[n],i=t[1].firstChild;if(null!==i)return nr(t,i)}return e[7]}function or(t,e,n,i,r,o,s){for(;null!=n;){const a=i[n.index],l=n.type;if(s&&0===e&&(a&&Mi(Dt(a),i),n.flags|=4),64!=(64&n.flags))if(8&l)or(t,e,n.child,i,r,o,!1),qi(e,t,r,a,o);else if(32&l){const s=Zi(n,i);let l;for(;l=s();)qi(e,t,r,l,o);qi(e,t,r,a,o)}else 16&l?ar(t,e,i,n,r,o):qi(e,t,r,a,o);n=s?n.projectionNext:n.next}}function sr(t,e,n,i,r,o){or(n,i,t.firstChild,e,r,o,!1)}function ar(t,e,n,i,r,o){const s=n[16],a=s[6].projection[i.projection];if(Array.isArray(a))for(let l=0;l<a.length;l++)qi(e,t,r,a[l],o);else or(t,e,a,s[3],r,o,!0)}function lr(t,e,n){kt(t)?t.setAttribute(e,"style",n):e.style.cssText=n}function cr(t,e,n){kt(t)?""===n?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n):e.className=n}function ur(t,e,n){let i=t.length;for(;;){const r=t.indexOf(e,n);if(-1===r)return r;if(0===r||t.charCodeAt(r-1)<=32){const n=e.length;if(r+n===i||t.charCodeAt(r+n)<=32)return r}n=r+1}}const hr="ng-template";function dr(t,e,n){let i=0;for(;i<t.length;){let r=t[i++];if(n&&"class"===r){if(r=t[i],-1!==ur(r.toLowerCase(),e,0))return!0}else if(1===r){for(;i<t.length&&"string"==typeof(r=t[i++]);)if(r.toLowerCase()===e)return!0;return!1}}return!1}function pr(t){return 4===t.type&&t.value!==hr}function fr(t,e,n){return e===(4!==t.type||n?t.value:hr)}function mr(t,e,n){let i=4;const r=t.attrs||[],o=function(t){for(let e=0;e<t.length;e++)if(Ee(t[e]))return e;return t.length}(r);let s=!1;for(let a=0;a<e.length;a++){const l=e[a];if("number"!=typeof l){if(!s)if(4&i){if(i=2|1&i,""!==l&&!fr(t,l,n)||""===l&&1===e.length){if(gr(i))return!1;s=!0}}else{const c=8&i?l:e[++a];if(8&i&&null!==t.attrs){if(!dr(t.attrs,c,n)){if(gr(i))return!1;s=!0}continue}const u=yr(8&i?"class":l,r,pr(t),n);if(-1===u){if(gr(i))return!1;s=!0;continue}if(""!==c){let t;t=u>o?"":r[u+1].toLowerCase();const e=8&i?t:null;if(e&&-1!==ur(e,c,0)||2&i&&c!==t){if(gr(i))return!1;s=!0}}}}else{if(!s&&!gr(i)&&!gr(l))return!1;if(s&&gr(l))continue;s=!1,i=l|1&i}}return gr(i)||s}function gr(t){return 0==(1&t)}function yr(t,e,n,i){if(null===e)return-1;let r=0;if(i||!n){let n=!1;for(;r<e.length;){const i=e[r];if(i===t)return r;if(3===i||6===i)n=!0;else{if(1===i||2===i){let t=e[++r];for(;"string"==typeof t;)t=e[++r];continue}if(4===i)break;if(0===i){r+=4;continue}}r+=n?1:2}return-1}return function(t,e){let n=t.indexOf(4);if(n>-1)for(n++;n<t.length;){const i=t[n];if("number"==typeof i)return-1;if(i===e)return n;n++}return-1}(e,t)}function _r(t,e,n=!1){for(let i=0;i<e.length;i++)if(mr(t,e[i],n))return!0;return!1}function vr(t,e){t:for(let n=0;n<e.length;n++){const i=e[n];if(t.length===i.length){for(let e=0;e<t.length;e++)if(t[e]!==i[e])continue t;return!0}}return!1}function xr(t,e){return t?":not("+e.trim()+")":e}function br(t){let e=t[0],n=1,i=2,r="",o=!1;for(;n<t.length;){let s=t[n];if("string"==typeof s)if(2&i){const e=t[++n];r+="["+s+(e.length>0?'="'+e+'"':"")+"]"}else 8&i?r+="."+s:4&i&&(r+=" "+s);else""!==r&&!gr(s)&&(e+=xr(o,r),r=""),i=s,o=o||!gr(i);n++}return""!==r&&(e+=xr(o,r)),e}const wr={};function Tr(t){Ar(Gt(),jt(),ye()+t,Kt())}function Ar(t,e,n,i){if(!i)if(3==(3&e[2])){const i=t.preOrderCheckHooks;null!==i&&be(e,i,n)}else{const i=t.preOrderHooks;null!==i&&we(e,i,0,n)}_e(n)}function Sr(t,e){return t<<17|e<<2}function Cr(t){return t>>17&32767}function Ir(t){return 2|t}function Er(t){return(131068&t)>>2}function Mr(t,e){return-131069&t|e<<2}function kr(t){return 1|t}function Pr(t,e){const n=t.contentQueries;if(null!==n)for(let i=0;i<n.length;i+=2){const r=n[i],o=n[i+1];if(-1!==o){const n=t.data[o];le(r),n.contentQueries(2,e[o],o)}}}function Dr(t,e,n,i,r,o,s,a,l,c){const u=e.blueprint.slice();return u[0]=r,u[2]=140|i,Bt(u),u[3]=u[15]=t,u[8]=n,u[10]=s||t&&t[10],u[11]=a||t&&t[11],u[12]=l||t&&t[12]||null,u[9]=c||t&&t[9]||null,u[6]=o,u[16]=2==e.type?t[16]:u,u}function Lr(t,e,n,i,r){let o=t.data[e];if(null===o)o=function(t,e,n,i,r){const o=Jt(),s=Xt(),a=t.data[e]=function(t,e,n,i,r,o){return{type:n,index:i,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,s?o:o&&o.parent,n,e,i,r);return null===t.firstChild&&(t.firstChild=a),null!==o&&(s?null==o.child&&null!==a.parent&&(o.child=a):null===o.next&&(o.next=a)),a}(t,e,n,i,r),$t.lFrame.inI18n&&(o.flags|=64);else if(64&o.type){o.type=n,o.value=i,o.attrs=r;const t=function(){const t=$t.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}();o.injectorIndex=null===t?-1:t.injectorIndex}return Wt(o,!0),o}function Or(t,e,n,i){if(0===n)return-1;const r=e.length;for(let o=0;o<n;o++)e.push(i),t.blueprint.push(i),t.data.push(null);return r}function Rr(t,e,n){he(e);try{const i=t.viewQuery;null!==i&&po(1,i,n);const r=t.template;null!==r&&Fr(t,e,r,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&Pr(t,e),t.staticViewQueries&&po(2,t.viewQuery,n);const o=t.components;null!==o&&function(t,e){for(let n=0;n<e.length;n++)ao(t,e[n])}(e,o)}catch(i){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),i}finally{e[2]&=-5,ge()}}function zr(t,e,n,i){const r=e[2];if(256==(256&r))return;he(e);const o=Kt();try{Bt(e),function(t){$t.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==n&&Fr(t,e,n,2,i);const s=3==(3&r);if(!o)if(s){const n=t.preOrderCheckHooks;null!==n&&be(e,n,null)}else{const n=t.preOrderHooks;null!==n&&we(e,n,0,null),Te(e,0)}if(function(t){for(let e=Ui(t);null!==e;e=Ni(e)){if(!e[2])continue;const t=e[9];for(let e=0;e<t.length;e++){const n=t[e],i=n[3];0==(1024&n[2])&&qt(i,1),n[2]|=1024}}}(e),function(t){for(let e=Ui(t);null!==e;e=Ni(e))for(let t=10;t<e.length;t++){const n=e[t],i=n[1];Ut(n)&&zr(i,n,i.template,n[8])}}(e),null!==t.contentQueries&&Pr(t,e),!o)if(s){const n=t.contentCheckHooks;null!==n&&be(e,n)}else{const n=t.contentHooks;null!==n&&we(e,n,1),Te(e,1)}!function(t,e){const n=t.hostBindingOpCodes;if(null!==n)try{for(let t=0;t<n.length;t++){const i=n[t];if(i<0)_e(~i);else{const r=i,o=n[++t],s=n[++t];oe(o,r),s(2,e[r])}}}finally{_e(-1)}}(t,e);const a=t.components;null!==a&&function(t,e){for(let n=0;n<e.length;n++)oo(t,e[n])}(e,a);const l=t.viewQuery;if(null!==l&&po(2,l,i),!o)if(s){const n=t.viewCheckHooks;null!==n&&be(e,n)}else{const n=t.viewHooks;null!==n&&we(e,n,2),Te(e,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),o||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,qt(e[3],-1))}finally{ge()}}function Zr(t,e,n,i){const r=e[10],o=!Kt(),s=Ft(e);try{o&&!s&&r.begin&&r.begin(),s&&Rr(t,e,i),zr(t,e,n,i)}finally{o&&!s&&r.end&&r.end()}}function Fr(t,e,n,i,r){const o=ye(),s=2&i;try{_e(-1),s&&e.length>20&&Ar(t,e,20,Kt()),n(i,r)}finally{_e(o)}}function Ur(t,e,n){if(mt(e)){const i=e.directiveEnd;for(let r=e.directiveStart;r<i;r++){const e=t.data[r];e.contentQueries&&e.contentQueries(1,n[r],r)}}}function Nr(t,e,n){!Vt()||(function(t,e,n,i){const r=n.directiveStart,o=n.directiveEnd;t.firstCreatePass||Fe(n,e),Mi(i,e);const s=n.initialInputs;for(let a=r;a<o;a++){const i=t.data[a],o=_t(i);o&&to(e,n,i);const l=We(e,t,a,n);Mi(l,e),null!==s&&no(0,a-r,l,i,0,s),o&&(Zt(n.index,e)[8]=l)}}(t,e,n,Ot(n,e)),128==(128&n.flags)&&function(t,e,n){const i=n.directiveStart,r=n.directiveEnd,o=n.index,s=$t.lFrame.currentDirectiveIndex;try{_e(o);for(let n=i;n<r;n++){const i=t.data[n],r=e[n];se(n),(null!==i.hostBindings||0!==i.hostVars||null!==i.hostAttrs)&&Jr(i,r)}}finally{_e(-1),se(s)}}(t,e,n))}function Br(t,e,n=Ot){const i=e.localNames;if(null!==i){let r=e.index+1;for(let o=0;o<i.length;o+=2){const s=i[o+1],a=-1===s?n(e,t):t[s];t[r++]=a}}}function qr(t){const e=t.tView;return null===e||e.incompleteFirstPass?t.tView=$r(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):e}function $r(t,e,n,i,r,o,s,a,l,c){const u=20+i,h=u+r,d=function(t,e){const n=[];for(let i=0;i<e;i++)n.push(i<t?null:wr);return n}(u,h),p="function"==typeof c?c():c;return d[1]={type:t,blueprint:d,template:n,queries:null,viewQuery:a,declTNode:e,data:d.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof s?s():s,firstChild:null,schemas:l,consts:p,incompleteFirstPass:!1}}function Vr(t,e,n,i){const r=mo(e);null===n?r.push(i):(r.push(n),t.firstCreatePass&&go(t).push(i,r.length-1))}function jr(t,e,n){for(let i in t)if(t.hasOwnProperty(i)){const r=t[i];(n=null===n?{}:n).hasOwnProperty(i)?n[i].push(e,r):n[i]=[e,r]}return n}function Gr(t,e,n,i,r,o,s,a){const l=Ot(e,n);let c,u=e.inputs;!a&&null!=u&&(c=u[i])?(_o(t,n,c,i,r),gt(e)&&function(t,e){const n=Zt(e,t);16&n[2]||(n[2]|=64)}(n,e.index)):3&e.type&&(i=function(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(i),r=null!=s?s(r,e.value||"",i):r,kt(o)?o.setProperty(l,i,r):Me(i)||(l.setProperty?l.setProperty(i,r):l[i]=r))}function Yr(t,e,n,i){let r=!1;if(Vt()){const o=function(t,e,n){const i=t.directiveRegistry;let r=null;if(i)for(let o=0;o<i.length;o++){const s=i[o];_r(n,s.selectors,!1)&&(r||(r=[]),qe(Fe(n,e),t,s.type),_t(s)?(Wr(t,n),r.unshift(s)):r.push(s))}return r}(t,e,n),s=null===i?null:{"":-1};if(null!==o){r=!0,Qr(n,t.data.length,o.length);for(let t=0;t<o.length;t++){const e=o[t];e.providersResolver&&e.providersResolver(e)}let i=!1,a=!1,l=Or(t,e,o.length,null);for(let r=0;r<o.length;r++){const c=o[r];n.mergedAttrs=ke(n.mergedAttrs,c.hostAttrs),Kr(t,n,e,l,c),Xr(l,c,s),null!==c.contentQueries&&(n.flags|=8),(null!==c.hostBindings||null!==c.hostAttrs||0!==c.hostVars)&&(n.flags|=128);const u=c.type.prototype;!i&&(u.ngOnChanges||u.ngOnInit||u.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n.index),i=!0),!a&&(u.ngOnChanges||u.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n.index),a=!0),l++}!function(t,e){const n=e.directiveEnd,i=t.data,r=e.attrs,o=[];let s=null,a=null;for(let l=e.directiveStart;l<n;l++){const t=i[l],n=t.inputs,c=null===r||pr(e)?null:io(n,r);o.push(c),s=jr(n,l,s),a=jr(t.outputs,l,a)}null!==s&&(s.hasOwnProperty("class")&&(e.flags|=16),s.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=o,e.inputs=s,e.outputs=a}(t,n)}s&&function(t,e,n){if(e){const i=t.localNames=[];for(let t=0;t<e.length;t+=2){const r=n[e[t+1]];if(null==r)throw new x("301",`Export of name '${e[t+1]}' not found!`);i.push(e[t],r)}}}(n,i,s)}return n.mergedAttrs=ke(n.mergedAttrs,n.attrs),r}function Hr(t,e,n,i,r,o){const s=o.hostBindings;if(s){let n=t.hostBindingOpCodes;null===n&&(n=t.hostBindingOpCodes=[]);const o=~e.index;(function(t){let e=t.length;for(;e>0;){const n=t[--e];if("number"==typeof n&&n<0)return n}return 0})(n)!=o&&n.push(o),n.push(i,r,s)}}function Jr(t,e){null!==t.hostBindings&&t.hostBindings(1,e)}function Wr(t,e){e.flags|=2,(t.components||(t.components=[])).push(e.index)}function Xr(t,e,n){if(n){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)n[e.exportAs[i]]=t;_t(e)&&(n[""]=t)}}function Qr(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}function Kr(t,e,n,i,r){t.data[i]=r;const o=r.factory||(r.factory=xt(r.type)),s=new Ce(o,_t(r),null);t.blueprint[i]=s,n[i]=s,Hr(t,e,0,i,Or(t,n,r.hostVars,wr),r)}function to(t,e,n){const i=Ot(e,t),r=qr(n),o=t[10],s=lo(t,Dr(t,r,null,n.onPush?64:16,i,e,o,o.createRenderer(i,n),null,null));t[e.index]=s}function eo(t,e,n,i,r,o){const s=Ot(t,e);!function(t,e,n,i,r,o,s){if(null==o)kt(t)?t.removeAttribute(e,r,n):e.removeAttribute(r);else{const a=null==s?b(o):s(o,i||"",r);kt(t)?t.setAttribute(e,r,a,n):n?e.setAttributeNS(n,r,a):e.setAttribute(r,a)}}(e[11],s,o,t.value,n,i,r)}function no(t,e,n,i,r,o){const s=o[e];if(null!==s){const t=i.setInput;for(let e=0;e<s.length;){const r=s[e++],o=s[e++],a=s[e++];null!==t?i.setInput(n,a,r,o):n[o]=a}}}function io(t,e){let n=null,i=0;for(;i<e.length;){const r=e[i];if(0!==r)if(5!==r){if("number"==typeof r)break;t.hasOwnProperty(r)&&(null===n&&(n=[]),n.push(r,t[r],e[i+1])),i+=2}else i+=2;else i+=4}return n}function ro(t,e,n,i){return new Array(t,!0,!1,e,null,0,i,n,null,null)}function oo(t,e){const n=Zt(e,t);if(Ut(n)){const t=n[1];80&n[2]?zr(t,n,t.template,n[8]):n[5]>0&&so(n)}}function so(t){for(let n=Ui(t);null!==n;n=Ni(n))for(let t=10;t<n.length;t++){const e=n[t];if(1024&e[2]){const t=e[1];zr(t,e,t.template,e[8])}else e[5]>0&&so(e)}const e=t[1].components;if(null!==e)for(let n=0;n<e.length;n++){const i=Zt(e[n],t);Ut(i)&&i[5]>0&&so(i)}}function ao(t,e){const n=Zt(e,t),i=n[1];(function(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])})(i,n),Rr(i,n,n[8])}function lo(t,e){return t[13]?t[14][4]=e:t[13]=e,t[14]=e,e}function co(t){for(;t;){t[2]|=64;const e=Fi(t);if(vt(t)&&!e)return t;t=e}return null}function uo(t,e,n){const i=e[10];i.begin&&i.begin();try{zr(t,e,t.template,n)}catch(r){throw yo(e,r),r}finally{i.end&&i.end()}}function ho(t){!function(t){for(let e=0;e<t.components.length;e++){const n=t.components[e],i=ki(n),r=i[1];Zr(r,i,r.template,n)}}(t[8])}function po(t,e,n){le(0),e(t,n)}const fo=(()=>Promise.resolve(null))();function mo(t){return t[7]||(t[7]=[])}function go(t){return t.cleanup||(t.cleanup=[])}function yo(t,e){const n=t[9],i=n?n.get(Li,null):null;i&&i.handleError(e)}function _o(t,e,n,i,r){for(let o=0;o<n.length;){const s=n[o++],a=n[o++],l=e[s],c=t.data[s];null!==c.setInput?c.setInput(l,r,i,a):l[a]=r}}function vo(t,e,n){const i=Lt(e,t);!function(t,e,n){kt(t)?t.setValue(e,n):e.textContent=n}(t[11],i,n)}function xo(t,e,n){let i=n?t.styles:null,r=n?t.classes:null,o=0;if(null!==e)for(let s=0;s<e.length;s++){const t=e[s];"number"==typeof t?o=t:1==o?r=m(r,t):2==o&&(i=m(i,t+": "+e[++s]+";"))}n?t.styles=i:t.stylesWithoutHost=i,n?t.classes=r:t.classesWithoutHost=r}const bo=new hn("INJECTOR",-1);class wo{get(t,e=Sn){if(e===Sn){const e=new Error(`NullInjectorError: No provider for ${f(t)}!`);throw e.name="NullInjectorError",e}return e}}const To=new hn("Set Injector scope."),Ao={},So={};let Co;function Io(){return void 0===Co&&(Co=new wo),Co}function Eo(t,e=null,n=null,i){return new Mo(t,n,e||Io(),i)}class Mo{constructor(t,e,n,i=null){this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const r=[];e&&_n(e,n=>this.processProvider(n,t,e)),_n([t],t=>this.processInjectorType(t,[],r)),this.records.set(bo,Do(void 0,this));const o=this.records.get(To);this.scope=null!=o?o.value:null,this.source=i||("object"==typeof t?null:f(t))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(t=>t.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(t,e=Sn,n=O.Default){this.assertNotDestroyed();const i=Dn(this),r=z(void 0);try{if(!(n&O.SkipSelf)){let e=this.records.get(t);if(void 0===e){const n=("function"==typeof(o=t)||"object"==typeof o&&o instanceof hn)&&I(t);e=n&&this.injectableDefInScope(n)?Do(ko(t),Ao):null,this.records.set(t,e)}if(null!=e)return this.hydrate(t,e)}return(n&O.Self?Io():this.parent).get(t,e=n&O.Optional&&e===Sn?null:e)}catch(s){if("NullInjectorError"===s.name){if((s[In]=s[In]||[]).unshift(f(t)),i)throw s;return Fn(s,t,"R3InjectorError",this.source)}throw s}finally{z(r),Dn(i)}var o}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(t=>this.get(t))}toString(){const t=[];return this.records.forEach((e,n)=>t.push(f(n))),`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(t,e,n){if(!(t=_(t)))return!1;let i=M(t);const r=null==i&&t.ngModule||void 0,o=void 0===r?t:r,s=-1!==n.indexOf(o);if(void 0!==r&&(i=M(r)),null==i)return!1;if(null!=i.imports&&!s){let t;n.push(o);try{_n(i.imports,i=>{this.processInjectorType(i,e,n)&&(void 0===t&&(t=[]),t.push(i))})}finally{}if(void 0!==t)for(let e=0;e<t.length;e++){const{ngModule:n,providers:i}=t[e];_n(i,t=>this.processProvider(t,n,i||Y))}}this.injectorDefTypes.add(o);const a=xt(o)||(()=>new o);this.records.set(o,Do(a,Ao));const l=i.providers;if(null!=l&&!s){const e=t;_n(l,t=>this.processProvider(t,e,l))}return void 0!==r&&void 0!==t.providers}processProvider(t,e,n){let i=Oo(t=_(t))?t:_(t&&t.provide);const r=Lo(o=t)?Do(void 0,o.useValue):Do(Po(o),Ao);var o;if(Oo(t)||!0!==t.multi)this.records.get(i);else{let e=this.records.get(i);e||(e=Do(void 0,Ao,!0),e.factory=()=>Rn(e.multi),this.records.set(i,e)),i=t,e.multi.push(t)}this.records.set(i,r)}hydrate(t,e){return e.value===Ao&&(e.value=So,e.value=e.factory()),"object"==typeof e.value&&e.value&&null!==(n=e.value)&&"object"==typeof n&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(e.value),e.value;var n}injectableDefInScope(t){if(!t.providedIn)return!1;const e=_(t.providedIn);return"string"==typeof e?"any"===e||e===this.scope:this.injectorDefTypes.has(e)}}function ko(t){const e=I(t),n=null!==e?e.factory:xt(t);if(null!==n)return n;if(t instanceof hn)throw new Error(`Token ${f(t)} is missing a \u0275prov definition.`);if(t instanceof Function)return function(t){const e=t.length;if(e>0){const n=bn(e,"?");throw new Error(`Can't resolve all parameters for ${f(t)}: (${n.join(", ")}).`)}const n=function(t){const e=t&&(t[k]||t[D]);if(e){const n=function(t){if(t.hasOwnProperty("name"))return t.name;const e=(""+t).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),e}return null}(t);return null!==n?()=>n.factory(t):()=>new t}(t);throw new Error("unreachable")}function Po(t,e,n){let i;if(Oo(t)){const e=_(t);return xt(e)||ko(e)}if(Lo(t))i=()=>_(t.useValue);else if(function(t){return!(!t||!t.useFactory)}(t))i=()=>t.useFactory(...Rn(t.deps||[]));else if(function(t){return!(!t||!t.useExisting)}(t))i=()=>On(_(t.useExisting));else{const e=_(t&&(t.useClass||t.provide));if(!function(t){return!!t.deps}(t))return xt(e)||ko(e);i=()=>new e(...Rn(t.deps))}return i}function Do(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function Lo(t){return null!==t&&"object"==typeof t&&kn in t}function Oo(t){return"function"==typeof t}const Ro=function(t,e,n){return function(t,e=null,n=null,i){const r=Eo(t,e,n,i);return r._resolveInjectorDefTypes(),r}({name:n},e,t,n)};let zo=(()=>{class t{static create(t,e){return Array.isArray(t)?Ro(t,e,""):Ro(t.providers,t.parent,t.name||"")}}return t.THROW_IF_NOT_FOUND=Sn,t.NULL=new wo,t.\u0275prov=S({token:t,providedIn:"any",factory:()=>On(bo)}),t.__NG_ELEMENT_ID__=-1,t})();function Zo(t,e){xe(ki(t)[1],Ht())}function Fo(t){let e=function(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),n=!0;const i=[t];for(;e;){let r;if(_t(t))r=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new Error("Directives cannot inherit Components");r=e.\u0275dir}if(r){if(n){i.push(r);const e=t;e.inputs=Uo(t.inputs),e.declaredInputs=Uo(t.declaredInputs),e.outputs=Uo(t.outputs);const n=r.hostBindings;n&&qo(t,n);const o=r.viewQuery,s=r.contentQueries;if(o&&No(t,o),s&&Bo(t,s),p(t.inputs,r.inputs),p(t.declaredInputs,r.declaredInputs),p(t.outputs,r.outputs),_t(r)&&r.data.animation){const e=t.data;e.animation=(e.animation||[]).concat(r.data.animation)}}const e=r.features;if(e)for(let i=0;i<e.length;i++){const r=e[i];r&&r.ngInherit&&r(t),r===Fo&&(n=!1)}}e=Object.getPrototypeOf(e)}!function(t){let e=0,n=null;for(let i=t.length-1;i>=0;i--){const r=t[i];r.hostVars=e+=r.hostVars,r.hostAttrs=ke(r.hostAttrs,n=ke(n,r.hostAttrs))}}(i)}function Uo(t){return t===G?{}:t===Y?[]:t}function No(t,e){const n=t.viewQuery;t.viewQuery=n?(t,i)=>{e(t,i),n(t,i)}:e}function Bo(t,e){const n=t.contentQueries;t.contentQueries=n?(t,i,r)=>{e(t,i,r),n(t,i,r)}:e}function qo(t,e){const n=t.hostBindings;t.hostBindings=n?(t,i)=>{e(t,i),n(t,i)}:e}let $o=null;function Vo(){if(!$o){const t=j.Symbol;if(t&&t.iterator)$o=t.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const n=t[e];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&($o=n)}}}return $o}class jo{constructor(t){this.wrapped=t}static wrap(t){return new jo(t)}static unwrap(t){return jo.isWrapped(t)?t.wrapped:t}static isWrapped(t){return t instanceof jo}}function Go(t){return!!Yo(t)&&(Array.isArray(t)||!(t instanceof Map)&&Vo()in t)}function Yo(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function Ho(t,e,n){return t[e]=n}function Jo(t,e,n){return!Object.is(t[e],n)&&(t[e]=n,!0)}function Wo(t,e,n,i){const r=Jo(t,e,n);return Jo(t,e+1,i)||r}function Xo(t,e,n,i){const r=jt();return Jo(r,ie(),e)&&(Gt(),eo(ve(),r,t,e,n,i)),Xo}function Qo(t,e,n,i){return Jo(t,ie(),n)?e+b(n)+i:wr}function Ko(t,e,n,i,r,o,s,a){const l=function(t,e,n,i,r){const o=Wo(t,e,n,i);return Jo(t,e+2,r)||o}(t,ne(),n,r,s);return re(3),l?e+b(n)+i+b(r)+o+b(s)+a:wr}function ts(t,e,n,i,r,o,s,a,l,c){const u=function(t,e,n,i,r,o){const s=Wo(t,e,n,i);return Wo(t,e+2,r,o)||s}(t,ne(),n,r,s,l);return re(4),u?e+b(n)+i+b(r)+o+b(s)+a+b(l)+c:wr}function es(t,e,n,i,r,o,s,a){const l=jt(),c=Gt(),u=t+20,h=c.firstCreatePass?function(t,e,n,i,r,o,s,a,l){const c=e.consts,u=Lr(e,t,4,s||null,Nt(c,a));Yr(e,n,u,Nt(c,l)),xe(e,u);const h=u.tViews=$r(2,u,i,r,o,e.directiveRegistry,e.pipeRegistry,null,e.schemas,c);return null!==e.queries&&(e.queries.template(e,u),h.queries=e.queries.embeddedTView(u)),u}(u,c,l,e,n,i,r,o,s):c.data[u];Wt(h,!1);const d=l[11].createComment("");er(c,l,d,h),Mi(d,l),lo(l,l[u]=ro(d,l,d,h)),yt(h)&&Nr(c,l,h),null!=s&&Br(l,h,a)}function ns(t){return zt($t.lFrame.contextLView,20+t)}function is(t,e=O.Default){const n=jt();return null===n?On(t,e):je(Ht(),n,_(t),e)}function rs(){throw new Error("invalid")}function os(t,e,n){const i=jt();return Jo(i,ie(),e)&&Gr(Gt(),ve(),i,t,e,i[11],n,!1),os}function ss(t,e,n,i,r){const o=r?"class":"style";_o(t,n,e.inputs[o],o,i)}function as(t,e,n,i){const r=jt(),o=Gt(),s=20+t,a=r[11],l=r[s]=$i(a,e,$t.lFrame.currentNamespace),c=o.firstCreatePass?function(t,e,n,i,r,o,s){const a=e.consts,l=Lr(e,t,2,r,Nt(a,o));return Yr(e,n,l,Nt(a,s)),null!==l.attrs&&xo(l,l.attrs,!1),null!==l.mergedAttrs&&xo(l,l.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,l),l}(s,o,r,0,e,n,i):o.data[s];Wt(c,!0);const u=c.mergedAttrs;null!==u&&Ie(a,l,u);const h=c.classes;null!==h&&cr(a,l,h);const d=c.styles;null!==d&&lr(a,l,d),64!=(64&c.flags)&&er(o,r,l,c),0===$t.lFrame.elementDepthCount&&Mi(l,r),$t.lFrame.elementDepthCount++,yt(c)&&(Nr(o,r,c),Ur(o,c,r)),null!==i&&Br(r,c)}function ls(){let t=Ht();Xt()?Qt():(t=t.parent,Wt(t,!1));const e=t;$t.lFrame.elementDepthCount--;const n=Gt();n.firstCreatePass&&(xe(n,t),mt(t)&&n.queries.elementEnd(t)),null!=e.classesWithoutHost&&function(t){return 0!=(16&t.flags)}(e)&&ss(n,e,jt(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function(t){return 0!=(32&t.flags)}(e)&&ss(n,e,jt(),e.stylesWithoutHost,!1)}function cs(t,e,n,i){as(t,e,n,i),ls()}function us(t,e,n){const i=jt(),r=Gt(),o=t+20,s=r.firstCreatePass?function(t,e,n,i,r){const o=e.consts,s=Nt(o,i),a=Lr(e,t,8,"ng-container",s);return null!==s&&xo(a,s,!0),Yr(e,n,a,Nt(o,r)),null!==e.queries&&e.queries.elementStart(e,a),a}(o,r,i,e,n):r.data[o];Wt(s,!0);const a=i[o]=i[11].createComment("");er(r,i,a,s),Mi(a,i),yt(s)&&(Nr(r,i,s),Ur(r,s,i)),null!=n&&Br(i,s)}function hs(){let t=Ht();const e=Gt();Xt()?Qt():(t=t.parent,Wt(t,!1)),e.firstCreatePass&&(xe(e,t),mt(t)&&e.queries.elementEnd(t))}function ds(){return jt()}function ps(t){return!!t&&"function"==typeof t.then}function fs(t){return!!t&&"function"==typeof t.subscribe}const ms=fs;function gs(t,e,n,i){const r=jt(),o=Gt(),s=Ht();return function(t,e,n,i,r,o,s,a){const l=yt(i),c=t.firstCreatePass&&go(t),u=e[8],h=mo(e);let d=!0;if(3&i.type||a){const p=Ot(i,e),f=a?a(p):p,m=h.length,g=a?t=>a(Dt(t[i.index])):i.index;if(kt(n)){let s=null;if(!a&&l&&(s=function(t,e,n,i){const r=t.cleanup;if(null!=r)for(let o=0;o<r.length-1;o+=2){const t=r[o];if(t===n&&r[o+1]===i){const t=e[7],n=r[o+2];return t.length>n?t[n]:null}"string"==typeof t&&(o+=2)}return null}(t,e,r,i.index)),null!==s)(s.__ngLastListenerFn__||s).__ngNextListenerFn__=o,s.__ngLastListenerFn__=o,d=!1;else{o=_s(i,e,u,o,!1);const t=n.listen(f,r,o);h.push(o,t),c&&c.push(r,g,m,m+1)}}else o=_s(i,e,u,o,!0),f.addEventListener(r,o,s),h.push(o),c&&c.push(r,g,m,s)}else o=_s(i,e,u,o,!1);const p=i.outputs;let f;if(d&&null!==p&&(f=p[r])){const t=f.length;if(t)for(let n=0;n<t;n+=2){const t=e[f[n]][f[n+1]].subscribe(o),s=h.length;h.push(o,t),c&&c.push(r,i.index,s,-(s+1))}}}(o,r,r[11],s,t,e,!!n,i),gs}function ys(t,e,n,i){try{return!1!==n(i)}catch(r){return yo(t,r),!1}}function _s(t,e,n,i,r){return function n(o){if(o===Function)return i;const s=2&t.flags?Zt(t.index,e):e;0==(32&e[2])&&co(s);let a=ys(e,0,i,o),l=n.__ngNextListenerFn__;for(;l;)a=ys(e,0,l,o)&&a,l=l.__ngNextListenerFn__;return r&&!1===a&&(o.preventDefault(),o.returnValue=!1),a}}function vs(t=1){return function(t){return($t.lFrame.contextLView=function(t,e){for(;t>0;)e=e[15],t--;return e}(t,$t.lFrame.contextLView))[8]}(t)}function xs(t,e){let n=null;const i=function(t){const e=t.attrs;if(null!=e){const t=e.indexOf(5);if(0==(1&t))return e[t+1]}return null}(t);for(let r=0;r<e.length;r++){const o=e[r];if("*"!==o){if(null===i?_r(t,o,!0):vr(i,o))return r}else n=r}return n}function bs(t){const e=jt()[16][6];if(!e.projection){const n=e.projection=bn(t?t.length:1,null),i=n.slice();let r=e.child;for(;null!==r;){const e=t?xs(r,t):0;null!==e&&(i[e]?i[e].projectionNext=r:n[e]=r,i[e]=r),r=r.next}}}function ws(t,e=0,n){const i=jt(),r=Gt(),o=Lr(r,20+t,16,null,n||null);null===o.projection&&(o.projection=e),Qt(),64!=(64&o.flags)&&function(t,e,n){ar(e[11],0,e,n,Hi(t,n,e),Ki(n.parent||e[6],n,e))}(r,i,o)}function Ts(t,e,n){return As(t,"",e,"",n),Ts}function As(t,e,n,i,r){const o=jt(),s=Qo(o,e,n,i);return s!==wr&&Gr(Gt(),ve(),o,t,s,o[11],r,!1),As}function Ss(t,e,n,i,r){const o=t[n+1],s=null===e;let a=i?Cr(o):Er(o),l=!1;for(;0!==a&&(!1===l||s);){const n=t[a+1];Cs(t[a],e)&&(l=!0,t[a+1]=i?kr(n):Ir(n)),a=i?Cr(n):Er(n)}l&&(t[n+1]=i?Ir(o):kr(o))}function Cs(t,e){return null===t||null==e||(Array.isArray(t)?t[1]:t)===e||!(!Array.isArray(t)||"string"!=typeof e)&&An(t,e)>=0}function Is(t,e,n){return Ms(t,e,n,!1),Is}function Es(t,e){return Ms(t,e,null,!0),Es}function Ms(t,e,n,i){const r=jt(),o=Gt(),s=re(2);o.firstUpdatePass&&function(t,e,n,i){const r=t.data;if(null===r[n+1]){const o=r[ye()],s=function(t,e){return e>=t.expandoStartIndex}(t,n);(function(t,e){return 0!=(t.flags&(e?16:32))})(o,i)&&null===e&&!s&&(e=!1),e=function(t,e,n,i){const r=function(t){const e=$t.lFrame.currentDirectiveIndex;return-1===e?null:t[e]}(t);let o=i?e.residualClasses:e.residualStyles;if(null===r)0===(i?e.classBindings:e.styleBindings)&&(n=Ps(n=ks(null,t,e,n,i),e.attrs,i),o=null);else{const s=e.directiveStylingLast;if(-1===s||t[s]!==r)if(n=ks(r,t,e,n,i),null===o){let n=function(t,e,n){const i=n?e.classBindings:e.styleBindings;if(0!==Er(i))return t[Cr(i)]}(t,e,i);void 0!==n&&Array.isArray(n)&&(n=ks(null,t,e,n[1],i),n=Ps(n,e.attrs,i),function(t,e,n,i){t[Cr(n?e.classBindings:e.styleBindings)]=i}(t,e,i,n))}else o=function(t,e,n){let i;const r=e.directiveEnd;for(let o=1+e.directiveStylingLast;o<r;o++)i=Ps(i,t[o].hostAttrs,n);return Ps(i,e.attrs,n)}(t,e,i)}return void 0!==o&&(i?e.residualClasses=o:e.residualStyles=o),n}(r,o,e,i),function(t,e,n,i,r,o){let s=o?e.classBindings:e.styleBindings,a=Cr(s),l=Er(s);t[i]=n;let c,u=!1;if(Array.isArray(n)){const t=n;c=t[1],(null===c||An(t,c)>0)&&(u=!0)}else c=n;if(r)if(0!==l){const e=Cr(t[a+1]);t[i+1]=Sr(e,a),0!==e&&(t[e+1]=Mr(t[e+1],i)),t[a+1]=function(t,e){return 131071&t|e<<17}(t[a+1],i)}else t[i+1]=Sr(a,0),0!==a&&(t[a+1]=Mr(t[a+1],i)),a=i;else t[i+1]=Sr(l,0),0===a?a=i:t[l+1]=Mr(t[l+1],i),l=i;u&&(t[i+1]=Ir(t[i+1])),Ss(t,c,i,!0),Ss(t,c,i,!1),function(t,e,n,i,r){const o=r?t.residualClasses:t.residualStyles;null!=o&&"string"==typeof e&&An(o,e)>=0&&(n[i+1]=kr(n[i+1]))}(e,c,t,i,o),s=Sr(a,l),o?e.classBindings=s:e.styleBindings=s}(r,o,e,n,s,i)}}(o,t,s,i),e!==wr&&Jo(r,s,e)&&function(t,e,n,i,r,o,s,a){if(!(3&e.type))return;const l=t.data,c=l[a+1];Ls(function(t){return 1==(1&t)}(c)?Ds(l,e,n,r,Er(c),s):void 0)||(Ls(o)||function(t){return 2==(2&t)}(c)&&(o=Ds(l,null,n,r,a,s)),function(t,e,n,i,r){const o=kt(t);if(e)r?o?t.addClass(n,i):n.classList.add(i):o?t.removeClass(n,i):n.classList.remove(i);else{let e=-1===i.indexOf("-")?void 0:zi.DashCase;if(null==r)o?t.removeStyle(n,i,e):n.style.removeProperty(i);else{const s="string"==typeof r&&r.endsWith("!important");s&&(r=r.slice(0,-10),e|=zi.Important),o?t.setStyle(n,i,r,e):n.style.setProperty(i,r,s?"important":"")}}}(i,s,Lt(ye(),n),r,o))}(o,o.data[ye()],r,r[11],t,r[s+1]=function(t,e){return null==t||("string"==typeof e?t+=e:"object"==typeof t&&(t=f(Wn(t)))),t}(e,n),i,s)}function ks(t,e,n,i,r){let o=null;const s=n.directiveEnd;let a=n.directiveStylingLast;for(-1===a?a=n.directiveStart:a++;a<s&&(o=e[a],i=Ps(i,o.hostAttrs,r),o!==t);)a++;return null!==t&&(n.directiveStylingLast=a),i}function Ps(t,e,n){const i=n?1:2;let r=-1;if(null!==e)for(let o=0;o<e.length;o++){const s=e[o];"number"==typeof s?r=s:r===i&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),wn(t,s,!!n||e[++o]))}return void 0===t?null:t}function Ds(t,e,n,i,r,o){const s=null===e;let a;for(;r>0;){const e=t[r],o=Array.isArray(e),l=o?e[1]:e,c=null===l;let u=n[r+1];u===wr&&(u=c?Y:void 0);let h=c?Tn(u,i):l===i?u:void 0;if(o&&!Ls(h)&&(h=Tn(e,i)),Ls(h)&&(a=h,s))return a;const d=t[r+1];r=s?Cr(d):Er(d)}if(null!==e){let t=o?e.residualClasses:e.residualStyles;null!=t&&(a=Tn(t,i))}return a}function Ls(t){return void 0!==t}function Os(t,e=""){const n=jt(),i=Gt(),r=t+20,o=i.firstCreatePass?Lr(i,r,1,e,null):i.data[r],s=n[r]=function(t,e){return kt(t)?t.createText(e):t.createTextNode(e)}(n[11],e);er(i,n,s,o),Wt(o,!1)}function Rs(t){return zs("",t,""),Rs}function zs(t,e,n){const i=jt(),r=Qo(i,t,e,n);return r!==wr&&vo(i,ye(),r),zs}function Zs(t,e,n,i,r){const o=jt(),s=function(t,e,n,i,r,o){const s=Wo(t,ne(),n,r);return re(2),s?e+b(n)+i+b(r)+o:wr}(o,t,e,n,i,r);return s!==wr&&vo(o,ye(),s),Zs}function Fs(t,e,n,i,r,o,s){const a=jt(),l=Ko(a,t,e,n,i,r,o,s);return l!==wr&&vo(a,ye(),l),Fs}function Us(t,e,n,i,r,o,s,a,l){const c=jt(),u=ts(c,t,e,n,i,r,o,s,a,l);return u!==wr&&vo(c,ye(),u),Us}function Ns(t,e,n){const i=jt();return Jo(i,ie(),e)&&Gr(Gt(),ve(),i,t,e,i[11],n,!0),Ns}const Bs=void 0;var qs=["en",[["a","p"],["AM","PM"],Bs],[["AM","PM"],Bs,Bs],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Bs,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Bs,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Bs,"{1} 'at' {0}",Bs],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(t){const e=Math.floor(Math.abs(t)),n=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===n?1:5}];let $s={};function Vs(t){const e=function(t){return t.toLowerCase().replace(/_/g,"-")}(t);let n=Gs(e);if(n)return n;const i=e.split("-")[0];if(n=Gs(i),n)return n;if("en"===i)return qs;throw new Error(`Missing locale data for the locale "${t}".`)}function js(t){return Vs(t)[Ys.PluralCase]}function Gs(t){return t in $s||($s[t]=j.ng&&j.ng.common&&j.ng.common.locales&&j.ng.common.locales[t]),$s[t]}var Ys=(()=>((Ys=Ys||{})[Ys.LocaleId=0]="LocaleId",Ys[Ys.DayPeriodsFormat=1]="DayPeriodsFormat",Ys[Ys.DayPeriodsStandalone=2]="DayPeriodsStandalone",Ys[Ys.DaysFormat=3]="DaysFormat",Ys[Ys.DaysStandalone=4]="DaysStandalone",Ys[Ys.MonthsFormat=5]="MonthsFormat",Ys[Ys.MonthsStandalone=6]="MonthsStandalone",Ys[Ys.Eras=7]="Eras",Ys[Ys.FirstDayOfWeek=8]="FirstDayOfWeek",Ys[Ys.WeekendRange=9]="WeekendRange",Ys[Ys.DateFormat=10]="DateFormat",Ys[Ys.TimeFormat=11]="TimeFormat",Ys[Ys.DateTimeFormat=12]="DateTimeFormat",Ys[Ys.NumberSymbols=13]="NumberSymbols",Ys[Ys.NumberFormats=14]="NumberFormats",Ys[Ys.CurrencyCode=15]="CurrencyCode",Ys[Ys.CurrencySymbol=16]="CurrencySymbol",Ys[Ys.CurrencyName=17]="CurrencyName",Ys[Ys.Currencies=18]="Currencies",Ys[Ys.Directionality=19]="Directionality",Ys[Ys.PluralCase=20]="PluralCase",Ys[Ys.ExtraData=21]="ExtraData",Ys))();const Hs="en-US";let Js=Hs;function Ws(t){A(t,"Expected localeId to be defined"),"string"==typeof t&&(Js=t.toLowerCase().replace(/_/g,"-"))}function Xs(t,e,n,i,r){if(t=_(t),Array.isArray(t))for(let o=0;o<t.length;o++)Xs(t[o],e,n,i,r);else{const o=Gt(),s=jt();let a=Oo(t)?t:_(t.provide),l=Po(t);const c=Ht(),u=1048575&c.providerIndexes,h=c.directiveStart,d=c.providerIndexes>>20;if(Oo(t)||!t.multi){const i=new Ce(l,r,is),p=ta(a,e,r?u:u+d,h);-1===p?(qe(Fe(c,s),o,a),Qs(o,t,e.length),e.push(a),c.directiveStart++,c.directiveEnd++,r&&(c.providerIndexes+=1048576),n.push(i),s.push(i)):(n[p]=i,s[p]=i)}else{const p=ta(a,e,u+d,h),f=ta(a,e,u,u+d),m=p>=0&&n[p],g=f>=0&&n[f];if(r&&!g||!r&&!m){qe(Fe(c,s),o,a);const u=function(t,e,n,i,r){const o=new Ce(t,n,is);return o.multi=[],o.index=e,o.componentProviders=0,Ks(o,r,i&&!n),o}(r?na:ea,n.length,r,i,l);!r&&g&&(n[f].providerFactory=u),Qs(o,t,e.length,0),e.push(a),c.directiveStart++,c.directiveEnd++,r&&(c.providerIndexes+=1048576),n.push(u),s.push(u)}else Qs(o,t,p>-1?p:f,Ks(n[r?f:p],l,!r&&i));!r&&i&&g&&n[f].componentProviders++}}}function Qs(t,e,n,i){const r=Oo(e);if(r||function(t){return!!t.useClass}(e)){const o=(e.useClass||e).prototype.ngOnDestroy;if(o){const s=t.destroyHooks||(t.destroyHooks=[]);if(!r&&e.multi){const t=s.indexOf(n);-1===t?s.push(n,[i,o]):s[t+1].push(i,o)}else s.push(n,o)}}}function Ks(t,e,n){return n&&t.componentProviders++,t.multi.push(e)-1}function ta(t,e,n,i){for(let r=n;r<i;r++)if(e[r]===t)return r;return-1}function ea(t,e,n,i){return ia(this.multi,[])}function na(t,e,n,i){const r=this.multi;let o;if(this.providerFactory){const t=this.providerFactory.componentProviders,e=We(n,n[1],this.providerFactory.index,i);o=e.slice(0,t),ia(r,o);for(let n=t;n<e.length;n++)o.push(e[n])}else o=[],ia(r,o);return o}function ia(t,e){for(let n=0;n<t.length;n++)e.push((0,t[n])());return e}function ra(t,e=[]){return n=>{n.providersResolver=(n,i)=>function(t,e,n){const i=Gt();if(i.firstCreatePass){const r=_t(t);Xs(n,i.data,i.blueprint,r,!0),Xs(e,i.data,i.blueprint,r,!1)}}(n,i?i(t):t,e)}}class oa{}const sa="ngComponent";class aa{resolveComponentFactory(t){throw function(t){const e=Error(`No component factory found for ${f(t)}. Did you add it to @NgModule.entryComponents?`);return e[sa]=t,e}(t)}}let la=(()=>{class t{}return t.NULL=new aa,t})();function ca(...t){}function ua(t,e){return new da(Ot(t,e))}const ha=function(){return ua(Ht(),jt())};let da=(()=>{class t{constructor(t){this.nativeElement=t}}return t.__NG_ELEMENT_ID__=ha,t})();function pa(t){return t instanceof da?t.nativeElement:t}class fa{}let ma=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>ga(),t})();const ga=function(){const t=jt(),e=Zt(Ht().index,t);return function(t){return t[11]}(pt(e)?e:t)};let ya=(()=>{class t{}return t.\u0275prov=S({token:t,providedIn:"root",factory:()=>null}),t})();class _a{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const va=new _a("12.2.6");class xa{constructor(){}supports(t){return Go(t)}create(t){return new wa(t)}}const ba=(t,e)=>e;class wa{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||ba}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,n=this._removalsHead,i=0,r=null;for(;e||n;){const o=!n||e&&e.currentIndex<Ca(n,i,r)?e:n,s=Ca(o,i,r),a=o.currentIndex;if(o===n)i--,n=n._nextRemoved;else if(e=e._next,null==o.previousIndex)i++;else{r||(r=[]);const t=s-i,e=a-i;if(t!=e){for(let n=0;n<t;n++){const i=n<r.length?r[n]:r[n]=0,o=i+n;e<=o&&o<t&&(r[n]=i+1)}r[o.previousIndex]=e-t}}s!==a&&t(o,s,a)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!Go(t))throw new Error(`Error trying to diff '${f(t)}'. Only arrays and iterables are allowed`);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e,n,i,r=this._itHead,o=!1;if(Array.isArray(t)){this.length=t.length;for(let e=0;e<this.length;e++)n=t[e],i=this._trackByFn(e,n),null!==r&&Object.is(r.trackById,i)?(o&&(r=this._verifyReinsertion(r,n,i,e)),Object.is(r.item,n)||this._addIdentityChange(r,n)):(r=this._mismatch(r,n,i,e),o=!0),r=r._next}else e=0,function(t,e){if(Array.isArray(t))for(let n=0;n<t.length;n++)e(t[n]);else{const n=t[Vo()]();let i;for(;!(i=n.next()).done;)e(i.value)}}(t,t=>{i=this._trackByFn(e,t),null!==r&&Object.is(r.trackById,i)?(o&&(r=this._verifyReinsertion(r,t,i,e)),Object.is(r.item,t)||this._addIdentityChange(r,t)):(r=this._mismatch(r,t,i,e),o=!0),r=r._next,e++}),this.length=e;return this._truncate(r),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,n,i){let r;return null===t?r=this._itTail:(r=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,r,i)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,i))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,r,i)):t=this._addAfter(new Ta(e,n),r,i),t}_verifyReinsertion(t,e,n,i){let r=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==r?t=this._reinsertAfter(r,t._prev,i):t.currentIndex!=i&&(t.currentIndex=i,this._addToMoves(t,i)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const i=t._prevRemoved,r=t._nextRemoved;return null===i?this._removalsHead=r:i._nextRemoved=r,null===r?this._removalsTail=i:r._prevRemoved=i,this._insertAfter(t,e,n),this._addToMoves(t,n),t}_moveAfter(t,e,n){return this._unlink(t),this._insertAfter(t,e,n),this._addToMoves(t,n),t}_addAfter(t,e,n){return this._insertAfter(t,e,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,n){const i=null===e?this._itHead:e._next;return t._next=i,t._prev=e,null===i?this._itTail=t:i._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new Sa),this._linkedRecords.put(t),t.currentIndex=n,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,n=t._next;return null===e?this._itHead=n:e._next=n,null===n?this._itTail=e:n._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Sa),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class Ta{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Aa{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===e||e<=n.currentIndex)&&Object.is(n.trackById,t))return n;return null}remove(t){const e=t._prevDup,n=t._nextDup;return null===e?this._head=n:e._nextDup=n,null===n?this._tail=e:n._prevDup=e,null===this._head}}class Sa{constructor(){this.map=new Map}put(t){const e=t.trackById;let n=this.map.get(e);n||(n=new Aa,this.map.set(e,n)),n.add(t)}get(t,e){const n=this.map.get(t);return n?n.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Ca(t,e,n){const i=t.previousIndex;if(null===i)return i;let r=0;return n&&i<n.length&&(r=n[i]),i+e+r}class Ia{constructor(){}supports(t){return t instanceof Map||Yo(t)}create(){return new Ea}}class Ea{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||Yo(t)))throw new Error(`Error trying to diff '${f(t)}'. Only maps and objects are allowed`)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(t,n)=>{if(e&&e.key===n)this._maybeAddToChanges(e,t),this._appendAfter=e,e=e._next;else{const i=this._getOrCreateRecordForKey(n,t);e=this._insertBeforeOrAppend(e,i)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let t=e;null!==t;t=t._nextRemoved)t===this._mapHead&&(this._mapHead=null),this._records.delete(t.key),t._nextRemoved=t._next,t.previousValue=t.currentValue,t.currentValue=null,t._prev=null,t._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const n=t._prev;return e._next=t,e._prev=n,t._prev=e,n&&(n._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const n=this._records.get(t);this._maybeAddToChanges(n,e);const i=n._prev,r=n._next;return i&&(i._next=r),r&&(r._prev=i),n._next=null,n._prev=null,n}const n=new Ma(t);return this._records.set(t,n),n.currentValue=e,this._addToAdditions(n),n}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(n=>e(t[n],n))}}class Ma{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function ka(){return new Pa([new xa])}let Pa=(()=>{class t{constructor(t){this.factories=t}static create(e,n){if(null!=n){const t=n.factories.slice();e=e.concat(t)}return new t(e)}static extend(e){return{provide:t,useFactory:n=>t.create(e,n||ka()),deps:[[t,new Bn,new Nn]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(null!=e)return e;throw new Error(`Cannot find a differ supporting object '${t}' of type '${function(t){return t.name||typeof t}(t)}'`)}}return t.\u0275prov=S({token:t,providedIn:"root",factory:ka}),t})();function Da(){return new La([new Ia])}let La=(()=>{class t{constructor(t){this.factories=t}static create(e,n){if(n){const t=n.factories.slice();e=e.concat(t)}return new t(e)}static extend(e){return{provide:t,useFactory:n=>t.create(e,n||Da()),deps:[[t,new Bn,new Nn]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(e)return e;throw new Error(`Cannot find a differ supporting object '${t}'`)}}return t.\u0275prov=S({token:t,providedIn:"root",factory:Da}),t})();function Oa(t,e,n,i,r=!1){for(;null!==n;){const o=e[n.index];if(null!==o&&i.push(Dt(o)),ft(o))for(let t=10;t<o.length;t++){const e=o[t],n=e[1].firstChild;null!==n&&Oa(e[1],e,n,i)}const s=n.type;if(8&s)Oa(t,e,n.child,i);else if(32&s){const t=Zi(n,e);let r;for(;r=t();)i.push(r)}else if(16&s){const t=ir(e,n);if(Array.isArray(t))i.push(...t);else{const n=Fi(e[16]);Oa(n[1],n,t,i,!0)}}n=r?n.projectionNext:n.next}return i}class Ra{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return Oa(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(ft(t)){const e=t[8],n=e?e.indexOf(this):-1;n>-1&&(ji(t,n),xn(e,n))}this._attachedToViewContainer=!1}Gi(this._lView[1],this._lView)}onDestroy(t){Vr(this._lView[1],this._lView,null,t)}markForCheck(){co(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){uo(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(t,e,n){te(!0);try{uo(t,e,n)}finally{te(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var t;this._appRef=null,sr(this._lView[1],t=this._lView,t[11],2,null,null)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t}}class za extends Ra{constructor(t){super(t),this._view=t}detectChanges(){ho(this._view)}checkNoChanges(){!function(t){te(!0);try{ho(t)}finally{te(!1)}}(this._view)}get context(){return null}}const Za=function(t){return function(t,e,n){if(gt(t)&&!n){const n=Zt(t.index,e);return new Ra(n,n)}return 47&t.type?new Ra(e[16],e):null}(Ht(),jt(),16==(16&t))};let Fa=(()=>{class t{}return t.__NG_ELEMENT_ID__=Za,t})();const Ua=[new Ia],Na=new Pa([new xa]),Ba=new La(Ua),qa=function(){return Ga(Ht(),jt())};let $a=(()=>{class t{}return t.__NG_ELEMENT_ID__=qa,t})();const Va=$a,ja=class extends Va{constructor(t,e,n){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=n}createEmbeddedView(t){const e=this._declarationTContainer.tViews,n=Dr(this._declarationLView,e,t,16,null,e.declTNode,null,null,null,null);n[17]=this._declarationLView[this._declarationTContainer.index];const i=this._declarationLView[19];return null!==i&&(n[19]=i.createEmbeddedView(e)),Rr(e,n,t),new Ra(n)}};function Ga(t,e){return 4&t.type?new ja(e,t,ua(t,e)):null}class Ya{}class Ha{}const Ja=function(){return el(Ht(),jt())};let Wa=(()=>{class t{}return t.__NG_ELEMENT_ID__=Ja,t})();const Xa=Wa,Qa=class extends Xa{constructor(t,e,n){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=n}get element(){return ua(this._hostTNode,this._hostLView)}get injector(){return new Ke(this._hostTNode,this._hostLView)}get parentInjector(){const t=Be(this._hostTNode,this._hostLView);if(De(t)){const e=Oe(t,this._hostLView),n=Le(t);return new Ke(e[1].data[n+8],e)}return new Ke(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=Ka(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,n){const i=t.createEmbeddedView(e||{});return this.insert(i,n),i}createComponent(t,e,n,i,r){const o=n||this.parentInjector;if(!r&&null==t.ngModule&&o){const t=o.get(Ya,null);t&&(r=t)}const s=t.create(o,i,void 0,r);return this.insert(s.hostView,e),s}insert(t,e){const n=t._lView,i=n[1];if(ft(n[3])){const e=this.indexOf(t);if(-1!==e)this.detach(e);else{const e=n[3],i=new Qa(e,e[6],e[3]);i.detach(i.indexOf(t))}}const r=this._adjustIndex(e),o=this._lContainer;!function(t,e,n,i){const r=10+i,o=n.length;i>0&&(n[r-1][4]=e),i<o-10?(e[4]=n[r],vn(n,10+i,e)):(n.push(e),e[4]=null),e[3]=n;const s=e[17];null!==s&&n!==s&&function(t,e){const n=t[9];e[16]!==e[3][3][16]&&(t[2]=!0),null===n?t[9]=[e]:n.push(e)}(s,e);const a=e[19];null!==a&&a.insertView(t),e[2]|=128}(i,n,o,r);const s=rr(r,o),a=n[11],l=Qi(a,o[7]);return null!==l&&function(t,e,n,i,r,o){i[0]=r,i[6]=e,sr(t,i,n,1,r,o)}(i,o[6],a,n,l,s),t.attachToViewContainerRef(),vn(tl(o),r,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=Ka(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),n=ji(this._lContainer,e);n&&(xn(tl(this._lContainer),e),Gi(n[1],n))}detach(t){const e=this._adjustIndex(t,-1),n=ji(this._lContainer,e);return n&&null!=xn(tl(this._lContainer),e)?new Ra(n):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function Ka(t){return t[8]}function tl(t){return t[8]||(t[8]=[])}function el(t,e){let n;const i=e[t.index];if(ft(i))n=i;else{let r;if(8&t.type)r=Dt(i);else{const n=e[11];r=n.createComment("");const i=Ot(t,e);Ji(n,Qi(n,i),r,function(t,e){return kt(t)?t.nextSibling(e):e.nextSibling}(n,i),!1)}e[t.index]=n=ro(i,e,r,t),lo(e,n)}return new Qa(n,t,e)}const nl={};class il extends la{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=ht(t);return new sl(e,this.ngModule)}}function rl(t){const e=[];for(let n in t)t.hasOwnProperty(n)&&e.push({propName:t[n],templateName:n});return e}const ol=new hn("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Oi});class sl extends oa{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=t.selectors.map(br).join(","),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return rl(this.componentDef.inputs)}get outputs(){return rl(this.componentDef.outputs)}create(t,e,n,i){const r=(i=i||this.ngModule)?function(t,e){return{get:(n,i,r)=>{const o=t.get(n,nl,r);return o!==nl||i===nl?o:e.get(n,i,r)}}}(t,i.injector):t,o=r.get(fa,Pt),s=r.get(ya,null),a=o.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",c=n?function(t,e,n){if(kt(t))return t.selectRootElement(e,n===N.ShadowDom);let i="string"==typeof e?t.querySelector(e):e;return i.textContent="",i}(a,n,this.componentDef.encapsulation):$i(o.createRenderer(null,this.componentDef),l,function(t){const e=t.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(l)),u=this.componentDef.onPush?576:528,h=function(t,e){return{components:[],scheduler:t||Oi,clean:fo,playerHandler:e||null,flags:0}}(),d=$r(0,null,null,1,0,null,null,null,null,null),p=Dr(null,d,h,u,null,null,o,a,s,r);let f,m;he(p);try{const t=function(t,e,n,i,r,o){const s=n[1];n[20]=t;const a=Lr(s,20,2,"#host",null),l=a.mergedAttrs=e.hostAttrs;null!==l&&(xo(a,l,!0),null!==t&&(Ie(r,t,l),null!==a.classes&&cr(r,t,a.classes),null!==a.styles&&lr(r,t,a.styles)));const c=i.createRenderer(t,e),u=Dr(n,qr(e),null,e.onPush?64:16,n[20],a,i,c,o||null,null);return s.firstCreatePass&&(qe(Fe(a,n),s,e.type),Wr(s,a),Qr(a,n.length,1)),lo(n,u),n[20]=u}(c,this.componentDef,p,o,a);if(c)if(n)Ie(a,c,["ng-version",va.full]);else{const{attrs:t,classes:e}=function(t){const e=[],n=[];let i=1,r=2;for(;i<t.length;){let o=t[i];if("string"==typeof o)2===r?""!==o&&e.push(o,t[++i]):8===r&&n.push(o);else{if(!gr(r))break;r=o}i++}return{attrs:e,classes:n}}(this.componentDef.selectors[0]);t&&Ie(a,c,t),e&&e.length>0&&cr(a,c,e.join(" "))}if(m=Rt(d,20),void 0!==e){const t=m.projection=[];for(let n=0;n<this.ngContentSelectors.length;n++){const i=e[n];t.push(null!=i?Array.from(i):null)}}f=function(t,e,n,i,r){const o=n[1],s=function(t,e,n){const i=Ht();t.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),Kr(t,i,e,Or(t,e,1,null),n));const r=We(e,t,i.directiveStart,i);Mi(r,e);const o=Ot(i,e);return o&&Mi(o,e),r}(o,n,e);if(i.components.push(s),t[8]=s,r&&r.forEach(t=>t(s,e)),e.contentQueries){const t=Ht();e.contentQueries(1,s,t.directiveStart)}const a=Ht();return!o.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(_e(a.index),Hr(n[1],a,0,a.directiveStart,a.directiveEnd,e),Jr(e,s)),s}(t,this.componentDef,p,h,[Zo]),Rr(d,p,null)}finally{ge()}return new al(this.componentType,f,ua(m,p),p,m)}}class al extends class{}{constructor(t,e,n,i,r){super(),this.location=n,this._rootLView=i,this._tNode=r,this.instance=e,this.hostView=this.changeDetectorRef=new za(i),this.componentType=t}get injector(){return new Ke(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}const ll=new Map;class cl extends Ya{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new il(this);const n=dt(t),i=t[Q]||null;i&&Ws(i),this._bootstrapComponents=Ri(n.bootstrap),this._r3Injector=Eo(t,e,[{provide:Ya,useValue:this},{provide:la,useValue:this.componentFactoryResolver}],f(t)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(t)}get(t,e=zo.THROW_IF_NOT_FOUND,n=O.Default){return t===zo||t===Ya||t===bo?this:this._r3Injector.get(t,e,n)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class ul extends Ha{constructor(t){super(),this.moduleType=t,null!==dt(t)&&function(t){const e=new Set;!function t(n){const i=dt(n,!0),r=i.id;null!==r&&(function(t,e,n){if(e&&e!==n)throw new Error(`Duplicate module registered for ${t} - ${f(e)} vs ${f(e.name)}`)}(r,ll.get(r),n),ll.set(r,n));const o=Ri(i.imports);for(const s of o)e.has(s)||(e.add(s),t(s))}(t)}(t)}create(t){return new cl(this.moduleType,t)}}function hl(t,e,n){const i=ee()+t,r=jt();return r[i]===wr?Ho(r,i,n?e.call(n):e()):function(t,e){return t[e]}(r,i)}function dl(t,e){const n=t[e];return n===wr?void 0:n}function pl(t,e){const n=Gt();let i;const r=t+20;n.firstCreatePass?(i=function(t,e){if(e)for(let n=e.length-1;n>=0;n--){const i=e[n];if(t===i.name)return i}throw new x("302",`The pipe '${t}' could not be found!`)}(e,n.pipeRegistry),n.data[r]=i,i.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(r,i.onDestroy)):i=n.data[r];const o=i.factory||(i.factory=xt(i.type)),s=z(is);try{const t=ze(!1),e=o();return ze(t),function(t,e,n,i){n>=t.data.length&&(t.data[n]=null,t.blueprint[n]=null),e[n]=i}(n,jt(),r,e),e}finally{z(s)}}function fl(t,e,n){const i=t+20,r=jt(),o=zt(r,i);return yl(r,gl(r,i)?function(t,e,n,i,r,o){const s=e+n;return Jo(t,s,r)?Ho(t,s+1,o?i.call(o,r):i(r)):dl(t,s+1)}(r,ee(),e,o.transform,n,o):o.transform(n))}function ml(t,e,n,i){const r=t+20,o=jt(),s=zt(o,r);return yl(o,gl(o,r)?function(t,e,n,i,r,o,s){const a=e+n;return Wo(t,a,r,o)?Ho(t,a+2,s?i.call(s,r,o):i(r,o)):dl(t,a+2)}(o,ee(),e,s.transform,n,i,s):s.transform(n,i))}function gl(t,e){return t[1].data[e].pure}function yl(t,e){return jo.isWrapped(e)&&(e=jo.unwrap(e),t[ne()]=wr),e}function _l(t){return e=>{setTimeout(t,void 0,e)}}const vl=class extends a.xQ{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,n){var i,r,o;let s=t,a=e||(()=>null),c=n;if(t&&"object"==typeof t){const e=t;s=null===(i=e.next)||void 0===i?void 0:i.bind(e),a=null===(r=e.error)||void 0===r?void 0:r.bind(e),c=null===(o=e.complete)||void 0===o?void 0:o.bind(e)}this.__isAsync&&(a=_l(a),s&&(s=_l(s)),c&&(c=_l(c)));const u=super.subscribe({next:s,error:a,complete:c});return t instanceof l.w&&t.add(u),u}};function xl(){return this._results[Vo()]()}class bl{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Vo(),n=bl.prototype;n[e]||(n[e]=xl)}get changes(){return this._changes||(this._changes=new vl)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const n=this;n.dirty=!1;const i=yn(t);(this._changesDetected=!function(t,e,n){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++){let r=t[i],o=e[i];if(n&&(r=n(r),o=n(o)),o!==r)return!1}return!0}(n._results,i,e))&&(n._results=i,n.length=i.length,n.last=i[this.length-1],n.first=i[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class wl{constructor(t){this.queryList=t,this.matches=null}clone(){return new wl(this.queryList)}setDirty(){this.queryList.setDirty()}}class Tl{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const n=null!==t.contentQueries?t.contentQueries[0]:e.length,i=[];for(let t=0;t<n;t++){const n=e.getByIndex(t);i.push(this.queries[n.indexInDeclarationView].clone())}return new Tl(i)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==Zl(t,e).matches&&this.queries[e].setDirty()}}class Al{constructor(t,e,n=null){this.predicate=t,this.flags=e,this.read=n}}class Sl{constructor(t=[]){this.queries=t}elementStart(t,e){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let n=0;n<this.length;n++){const i=null!==e?e.length:0,r=this.getByIndex(n).embeddedTView(t,i);r&&(r.indexInDeclarationView=n,null!==e?e.push(r):e=[r])}return null!==e?new Sl(e):null}template(t,e){for(let n=0;n<this.queries.length;n++)this.queries[n].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class Cl{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new Cl(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let n=t.parent;for(;null!==n&&8&n.type&&n.index!==e;)n=n.parent;return e===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const n=this.metadata.predicate;if(Array.isArray(n))for(let i=0;i<n.length;i++){const r=n[i];this.matchTNodeWithReadOption(t,e,Il(e,r)),this.matchTNodeWithReadOption(t,e,Je(e,t,r,!1,!1))}else n===$a?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,Je(e,t,n,!1,!1))}matchTNodeWithReadOption(t,e,n){if(null!==n){const i=this.metadata.read;if(null!==i)if(i===da||i===Wa||i===$a&&4&e.type)this.addMatch(e.index,-2);else{const n=Je(e,t,i,!1,!1);null!==n&&this.addMatch(e.index,n)}else this.addMatch(e.index,n)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function Il(t,e){const n=t.localNames;if(null!==n)for(let i=0;i<n.length;i+=2)if(n[i]===e)return n[i+1];return null}function El(t,e,n,i){return-1===n?function(t,e){return 11&t.type?ua(t,e):4&t.type?Ga(t,e):null}(e,t):-2===n?function(t,e,n){return n===da?ua(e,t):n===$a?Ga(e,t):n===Wa?el(e,t):void 0}(t,e,i):We(t,t[1],n,e)}function Ml(t,e,n,i){const r=e[19].queries[i];if(null===r.matches){const i=t.data,o=n.matches,s=[];for(let t=0;t<o.length;t+=2){const r=o[t];s.push(r<0?null:El(e,i[r],o[t+1],n.metadata.read))}r.matches=s}return r.matches}function kl(t,e,n,i){const r=t.queries.getByIndex(n),o=r.matches;if(null!==o){const s=Ml(t,e,r,n);for(let t=0;t<o.length;t+=2){const n=o[t];if(n>0)i.push(s[t/2]);else{const r=o[t+1],s=e[-n];for(let t=10;t<s.length;t++){const e=s[t];e[17]===e[3]&&kl(e[1],e,r,i)}if(null!==s[9]){const t=s[9];for(let e=0;e<t.length;e++){const n=t[e];kl(n[1],n,r,i)}}}}}return i}function Pl(t){const e=jt(),n=Gt(),i=ae();le(i+1);const r=Zl(n,i);if(t.dirty&&Ft(e)===(2==(2&r.metadata.flags))){if(null===r.matches)t.reset([]);else{const o=r.crossesNgTemplate?kl(n,e,i,[]):Ml(n,e,r,i);t.reset(o,pa),t.notifyOnChanges()}return!0}return!1}function Dl(t,e,n){const i=Gt();i.firstCreatePass&&(zl(i,new Al(t,e,n),-1),2==(2&e)&&(i.staticViewQueries=!0)),Rl(i,jt(),e)}function Ll(t,e,n,i){const r=Gt();if(r.firstCreatePass){const o=Ht();zl(r,new Al(e,n,i),o.index),function(t,e){const n=t.contentQueries||(t.contentQueries=[]);e!==(n.length?n[n.length-1]:-1)&&n.push(t.queries.length-1,e)}(r,t),2==(2&n)&&(r.staticContentQueries=!0)}Rl(r,jt(),n)}function Ol(){return t=jt(),e=ae(),t[19].queries[e].queryList;var t,e}function Rl(t,e,n){const i=new bl(4==(4&n));Vr(t,e,i,i.destroy),null===e[19]&&(e[19]=new Tl),e[19].queries.push(new wl(i))}function zl(t,e,n){null===t.queries&&(t.queries=new Sl),t.queries.track(new Cl(e,n))}function Zl(t,e){return t.queries.getByIndex(e)}const Fl=ln("Output",t=>({bindingPropertyName:t})),Ul=ln("HostListener",(t,e)=>({eventName:t,args:e})),Nl=new hn("Application Initializer");let Bl=(()=>{class t{constructor(t){this.appInits=t,this.resolve=ca,this.reject=ca,this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}runInitializers(){if(this.initialized)return;const t=[],e=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let n=0;n<this.appInits.length;n++){const e=this.appInits[n]();if(ps(e))t.push(e);else if(ms(e)){const n=new Promise((t,n)=>{e.subscribe({complete:t,error:n})});t.push(n)}}Promise.all(t).then(()=>{e()}).catch(t=>{this.reject(t)}),0===t.length&&e(),this.initialized=!0}}return t.\u0275fac=function(e){return new(e||t)(On(Nl,8))},t.\u0275prov=S({token:t,factory:t.\u0275fac}),t})();const ql=new hn("AppId"),$l={provide:ql,useFactory:function(){return`${Vl()}${Vl()}${Vl()}`},deps:[]};function Vl(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const jl=new hn("Platform Initializer"),Gl=new hn("Platform ID"),Yl=new hn("appBootstrapListener");let Hl=(()=>{class t{log(t){console.log(t)}warn(t){console.warn(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=S({token:t,factory:t.\u0275fac}),t})();const Jl=new hn("LocaleId"),Wl=new hn("DefaultCurrencyCode");class Xl{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}const Ql=function(t){return new ul(t)},Kl=Ql,tc=function(t){return Promise.resolve(Ql(t))},ec=function(t){const e=Ql(t),n=Ri(dt(t).declarations).reduce((t,e)=>{const n=ht(e);return n&&t.push(new sl(n)),t},[]);return new Xl(e,n)},nc=ec,ic=function(t){return Promise.resolve(ec(t))};let rc=(()=>{class t{constructor(){this.compileModuleSync=Kl,this.compileModuleAsync=tc,this.compileModuleAndAllComponentsSync=nc,this.compileModuleAndAllComponentsAsync=ic}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=S({token:t,factory:t.\u0275fac}),t})();const oc=(()=>Promise.resolve(0))();function sc(t){"undefined"==typeof Zone?oc.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class ac{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new vl(!1),this.onMicrotaskEmpty=new vl(!1),this.onStable=new vl(!1),this.onError=new vl(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!n&&e,i.shouldCoalesceRunChangeDetection=n,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function(){let t=j.requestAnimationFrame,e=j.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&e){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function(t){const e=()=>{!function(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(j,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,uc(t),t.isCheckStableRunning=!0,cc(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),uc(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,i,r,o,s,a)=>{try{return hc(t),n.invokeTask(r,o,s,a)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||t.shouldCoalesceRunChangeDetection)&&e(),dc(t)}},onInvoke:(n,i,r,o,s,a,l)=>{try{return hc(t),n.invoke(r,o,s,a,l)}finally{t.shouldCoalesceRunChangeDetection&&e(),dc(t)}},onHasTask:(e,n,i,r)=>{e.hasTask(i,r),n===i&&("microTask"==r.change?(t._hasPendingMicrotasks=r.microTask,uc(t),cc(t)):"macroTask"==r.change&&(t.hasPendingMacrotasks=r.macroTask))},onHandleError:(e,n,i,r)=>(e.handleError(i,r),t.runOutsideAngular(()=>t.onError.emit(r)),!1)})}(i)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ac.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(ac.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,e,n){return this._inner.run(t,e,n)}runTask(t,e,n,i){const r=this._inner,o=r.scheduleEventTask("NgZoneEvent: "+i,t,lc,ca,ca);try{return r.runTask(o,e,n)}finally{r.cancelTask(o)}}runGuarded(t,e,n){return this._inner.runGuarded(t,e,n)}runOutsideAngular(t){return this._outer.run(t)}}const lc={};function cc(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function uc(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function hc(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function dc(t){t._nesting--,cc(t)}class pc{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new vl,this.onMicrotaskEmpty=new vl,this.onStable=new vl,this.onError=new vl}run(t,e,n){return t.apply(e,n)}runGuarded(t,e,n){return t.apply(e,n)}runOutsideAngular(t){return t()}runTask(t,e,n,i){return t.apply(e,n)}}let fc=(()=>{class t{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ac.assertNotInAngularZone(),sc(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())sc(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(e=>!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,e,n){let i=-1;e&&e>0&&(i=setTimeout(()=>{this._callbacks=this._callbacks.filter(t=>t.timeoutId!==i),t(this._didWork,this.getPendingTasks())},e)),this._callbacks.push({doneCb:t,timeoutId:i,updateCb:n})}whenStable(t,e,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,e,n),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,e,n){return[]}}return t.\u0275fac=function(e){return new(e||t)(On(ac))},t.\u0275prov=S({token:t,factory:t.\u0275fac}),t})(),mc=(()=>{class t{constructor(){this._applications=new Map,_c.addToWindow(this)}registerApplication(t,e){this._applications.set(t,e)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,e=!0){return _c.findTestabilityInTree(this,t,e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=S({token:t,factory:t.\u0275fac}),t})();class gc{addToWindow(t){}findTestabilityInTree(t,e,n){return null}}function yc(t){_c=t}let _c=new gc,vc=!0,xc=!1;function bc(){if(xc)throw new Error("Cannot enable prod mode after platform setup.");vc=!1}let wc;const Tc=new hn("AllowMultipleToken");class Ac{constructor(t,e){this.name=t,this.token=e}}function Sc(t,e,n=[]){const i=`Platform: ${e}`,r=new hn(i);return(e=[])=>{let o=Cc();if(!o||o.injector.get(Tc,!1))if(t)t(n.concat(e).concat({provide:r,useValue:!0}));else{const t=n.concat(e).concat({provide:r,useValue:!0},{provide:To,useValue:"platform"});!function(t){if(wc&&!wc.destroyed&&!wc.injector.get(Tc,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");wc=t.get(Ic);const e=t.get(jl,null);e&&e.forEach(t=>t())}(zo.create({providers:t,name:i}))}return function(t){const e=Cc();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(r)}}function Cc(){return wc&&!wc.destroyed?wc:null}let Ic=(()=>{class t{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,e){const n=function(t,e){let n;return n="noop"===t?new pc:("zone.js"===t?void 0:t)||new ac({enableLongStackTrace:(xc=!0,vc),shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),n}(e?e.ngZone:void 0,{ngZoneEventCoalescing:e&&e.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:e&&e.ngZoneRunCoalescing||!1}),i=[{provide:ac,useValue:n}];return n.run(()=>{const r=zo.create({providers:i,parent:this.injector,name:t.moduleType.name}),o=t.create(r),s=o.injector.get(Li,null);if(!s)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.runOutsideAngular(()=>{const t=n.onError.subscribe({next:t=>{s.handleError(t)}});o.onDestroy(()=>{kc(this._modules,o),t.unsubscribe()})}),function(t,n,i){try{const e=i();return ps(e)?e.catch(e=>{throw n.runOutsideAngular(()=>t.handleError(e)),e}):e}catch(e){throw n.runOutsideAngular(()=>t.handleError(e)),e}}(s,n,()=>{const t=o.injector.get(Bl);return t.runInitializers(),t.donePromise.then(()=>(Ws(o.injector.get(Jl,Hs)||Hs),this._moduleDoBootstrap(o),o))})})}bootstrapModule(t,e=[]){const n=Ec({},e);return function(t,e,n){const i=new ul(n);return Promise.resolve(i)}(0,0,t).then(t=>this.bootstrapModuleFactory(t,n))}_moduleDoBootstrap(t){const e=t.injector.get(Mc);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(t=>e.bootstrap(t));else{if(!t.instance.ngDoBootstrap)throw new Error(`The module ${f(t.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);t.instance.ngDoBootstrap(e)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(t=>t.destroy()),this._destroyListeners.forEach(t=>t()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(e){return new(e||t)(On(zo))},t.\u0275prov=S({token:t,factory:t.\u0275fac}),t})();function Ec(t,e){return Array.isArray(e)?e.reduce(Ec,t):Object.assign(Object.assign({},t),e)}let Mc=(()=>{class t{constructor(t,e,n,a,l){this._zone=t,this._injector=e,this._exceptionHandler=n,this._componentFactoryResolver=a,this._initStatus=l,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const d=new i.y(t=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{t.next(this._stable),t.complete()})}),p=new i.y(t=>{let e;this._zone.runOutsideAngular(()=>{e=this._zone.onStable.subscribe(()=>{ac.assertNotInAngularZone(),sc(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,t.next(!0))})})});const n=this._zone.onUnstable.subscribe(()=>{ac.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{t.next(!1)}))});return()=>{e.unsubscribe(),n.unsubscribe()}});this.isStable=function(...t){let e=Number.POSITIVE_INFINITY,n=null,a=t[t.length-1];return(0,r.K)(a)?(n=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof a&&(e=t.pop()),null===n&&1===t.length&&t[0]instanceof i.y?t[0]:(0,o.J)(e)((0,s.n)(t,n))}(d,p.pipe(t=>(0,u.x)()(function(t,e){return function(e){let n;n="function"==typeof t?t:function(){return t};const i=Object.create(e,c.N);return i.source=e,i.subjectFactory=n,i}}(h)(t))))}bootstrap(t,e){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let n;n=t instanceof oa?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(n.componentType);const i=function(t){return t.isBoundToModule}(n)?void 0:this._injector.get(Ya),r=n.create(zo.NULL,[],e||n.selector,i),o=r.location.nativeElement,s=r.injector.get(fc,null),a=s&&r.injector.get(mc);return s&&a&&a.registerApplication(o,s),r.onDestroy(()=>{this.detachView(r.hostView),kc(this.components,r),a&&a.unregisterApplication(o)}),this._loadComponent(r),r}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const e=t;this._views.push(e),e.attachToAppRef(this)}detachView(t){const e=t;kc(this._views,e),e.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(Yl,[]).concat(this._bootstrapListeners).forEach(e=>e(t))}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(e){return new(e||t)(On(ac),On(zo),On(Li),On(la),On(Bl))},t.\u0275prov=S({token:t,factory:t.\u0275fac}),t})();function kc(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class Pc{}class Dc{}const Lc={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let Oc=(()=>{class t{constructor(t,e){this._compiler=t,this._config=e||Lc}load(t){return this.loadAndCompile(t)}loadAndCompile(t){let[e,i]=t.split("#");return void 0===i&&(i="default"),n(8255)(e).then(t=>t[i]).then(t=>Rc(t,e,i)).then(t=>this._compiler.compileModuleAsync(t))}loadFactory(t){let[e,i]=t.split("#"),r="NgFactory";return void 0===i&&(i="default",r=""),n(8255)(this._config.factoryPathPrefix+e+this._config.factoryPathSuffix).then(t=>t[i+r]).then(t=>Rc(t,e,i))}}return t.\u0275fac=function(e){return new(e||t)(On(rc),On(Dc,8))},t.\u0275prov=S({token:t,factory:t.\u0275fac}),t})();function Rc(t,e,n){if(!t)throw new Error(`Cannot find '${n}' in '${e}'`);return t}const zc=function(t){return null},Zc=Sc(null,"core",[{provide:Gl,useValue:"unknown"},{provide:Ic,deps:[zo]},{provide:mc,deps:[]},{provide:Hl,deps:[]}]),Fc=[{provide:Mc,useClass:Mc,deps:[ac,zo,Li,la,Bl]},{provide:ol,deps:[ac],useFactory:function(t){let e=[];return t.onStable.subscribe(()=>{for(;e.length;)e.pop()()}),function(t){e.push(t)}}},{provide:Bl,useClass:Bl,deps:[[new Nn,Nl]]},{provide:rc,useClass:rc,deps:[]},$l,{provide:Pa,useFactory:function(){return Na},deps:[]},{provide:La,useFactory:function(){return Ba},deps:[]},{provide:Jl,useFactory:function(t){return Ws(t=t||"undefined"!=typeof $localize&&$localize.locale||Hs),t},deps:[[new Un(Jl),new Nn,new Bn]]},{provide:Wl,useValue:"USD"}];let Uc=(()=>{class t{constructor(t){}}return t.\u0275fac=function(e){return new(e||t)(On(Mc))},t.\u0275mod=st({type:t}),t.\u0275inj=C({providers:Fc}),t})()},3679:function(t,e,n){"use strict";n.d(e,{Fj:function(){return p},u5:function(){return ct},Fd:function(){return ot},qQ:function(){return at},JU:function(){return u},a5:function(){return D},JJ:function(){return L},On:function(){return K},wV:function(){return et}});var i=n(639),r=n(8583),o=n(4402),s=n(5758),a=n(8002);let l=(()=>{class t{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=t=>{},this.onTouched=()=>{}}setProperty(t,e){this._renderer.setProperty(this._elementRef.nativeElement,t,e)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.Qsj),i.Y36(i.SBq))},t.\u0275dir=i.lG2({type:t}),t})(),c=(()=>{class t extends l{}return t.\u0275fac=function(){let e;return function(n){return(e||(e=i.n5z(t)))(n||t)}}(),t.\u0275dir=i.lG2({type:t,features:[i.qOj]}),t})();const u=new i.OlP("NgValueAccessor"),h={provide:u,useExisting:(0,i.Gpc)(()=>p),multi:!0},d=new i.OlP("CompositionEventMode");let p=(()=>{class t extends l{constructor(t,e,n){super(t,e),this._compositionMode=n,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const t=(0,r.q)()?(0,r.q)().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(t){this.setProperty("value",null==t?"":t)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.Qsj),i.Y36(i.SBq),i.Y36(d,8))},t.\u0275dir=i.lG2({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,e){1&t&&i.NdJ("input",function(t){return e._handleInput(t.target.value)})("blur",function(){return e.onTouched()})("compositionstart",function(){return e._compositionStart()})("compositionend",function(t){return e._compositionEnd(t.target.value)})},features:[i._Bn([h]),i.qOj]}),t})();function f(t){return null==t||0===t.length}const m=new i.OlP("NgValidators"),g=new i.OlP("NgAsyncValidators");function y(t){return null}function _(t){return null!=t}function v(t){const e=(0,i.QGY)(t)?(0,o.D)(t):t;return(0,i.CqO)(e),e}function x(t){let e={};return t.forEach(t=>{e=null!=t?Object.assign(Object.assign({},e),t):e}),0===Object.keys(e).length?null:e}function b(t,e){return e.map(e=>e(t))}function w(t){return t.map(t=>function(t){return!t.validate}(t)?t:e=>t.validate(e))}function T(t){return null!=t?function(t){if(!t)return null;const e=t.filter(_);return 0==e.length?null:function(t){return x(b(t,e))}}(w(t)):null}function A(t){return null!=t?function(t){if(!t)return null;const e=t.filter(_);return 0==e.length?null:function(t){const n=b(t,e).map(v);return(0,s.D)(n).pipe((0,a.U)(x))}}(w(t)):null}function S(t,e){return null===t?[e]:Array.isArray(t)?[...t,e]:[t,e]}function C(t){return t?Array.isArray(t)?t:[t]:[]}function I(t,e){return Array.isArray(t)?t.includes(e):t===e}function E(t,e){const n=C(e);return C(t).forEach(t=>{I(n,t)||n.push(t)}),n}function M(t,e){return C(e).filter(e=>!I(t,e))}let k=(()=>{class t{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=T(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=A(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=i.lG2({type:t}),t})(),P=(()=>{class t extends k{get formDirective(){return null}get path(){return null}}return t.\u0275fac=function(){let e;return function(n){return(e||(e=i.n5z(t)))(n||t)}}(),t.\u0275dir=i.lG2({type:t,features:[i.qOj]}),t})();class D extends k{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}let L=(()=>{class t extends class{constructor(t){this._cd=t}is(t){var e,n,i;return"submitted"===t?!!(null===(e=this._cd)||void 0===e?void 0:e.submitted):!!(null===(i=null===(n=this._cd)||void 0===n?void 0:n.control)||void 0===i?void 0:i[t])}}{constructor(t){super(t)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(D,2))},t.\u0275dir=i.lG2({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,e){2&t&&i.ekj("ng-untouched",e.is("untouched"))("ng-touched",e.is("touched"))("ng-pristine",e.is("pristine"))("ng-dirty",e.is("dirty"))("ng-valid",e.is("valid"))("ng-invalid",e.is("invalid"))("ng-pending",e.is("pending"))},features:[i.qOj]}),t})();function O(t,e){(function(t,e){const n=function(t){return t._rawValidators}(t);null!==e.validator?t.setValidators(S(n,e.validator)):"function"==typeof n&&t.setValidators([n]);const i=function(t){return t._rawAsyncValidators}(t);null!==e.asyncValidator?t.setAsyncValidators(S(i,e.asyncValidator)):"function"==typeof i&&t.setAsyncValidators([i]);const r=()=>t.updateValueAndValidity();R(e._rawValidators,r),R(e._rawAsyncValidators,r)})(t,e),e.valueAccessor.writeValue(t.value),function(t,e){e.valueAccessor.registerOnChange(n=>{t._pendingValue=n,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&z(t,e)})}(t,e),function(t,e){const n=(t,n)=>{e.valueAccessor.writeValue(t),n&&e.viewToModelUpdate(t)};t.registerOnChange(n),e._registerOnDestroy(()=>{t._unregisterOnChange(n)})}(t,e),function(t,e){e.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&z(t,e),"submit"!==t.updateOn&&t.markAsTouched()})}(t,e),function(t,e){if(e.valueAccessor.setDisabledState){const n=t=>{e.valueAccessor.setDisabledState(t)};t.registerOnDisabledChange(n),e._registerOnDestroy(()=>{t._unregisterOnDisabledChange(n)})}}(t,e)}function R(t,e){t.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function z(t,e){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function Z(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const F="VALID",U="INVALID",N="PENDING",B="DISABLED";function q(t){return(G(t)?t.validators:t)||null}function $(t){return Array.isArray(t)?T(t):t||null}function V(t,e){return(G(e)?e.asyncValidators:t)||null}function j(t){return Array.isArray(t)?A(t):t||null}function G(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class Y{constructor(t,e){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=e,this._composedValidatorFn=$(this._rawValidators),this._composedAsyncValidatorFn=j(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===F}get invalid(){return this.status===U}get pending(){return this.status==N}get disabled(){return this.status===B}get enabled(){return this.status!==B}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=$(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=j(t)}addValidators(t){this.setValidators(E(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(E(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(M(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(M(t,this._rawAsyncValidators))}hasValidator(t){return I(this._rawValidators,t)}hasAsyncValidator(t){return I(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=N,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=B,this.errors=null,this._forEachChild(e=>{e.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(t=>t(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=F,this._forEachChild(e=>{e.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(t=>t(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===F||this.status===N)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?B:F}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=N,this._hasOwnPendingAsyncValidator=!0;const e=v(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(e=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(e,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){return function(t,e,n){if(null==e||(Array.isArray(e)||(e=e.split(".")),Array.isArray(e)&&0===e.length))return null;let i=t;return e.forEach(t=>{i=i instanceof J?i.controls.hasOwnProperty(t)?i.controls[t]:null:i instanceof W&&i.at(t)||null}),i}(this,t)}getError(t,e){const n=e?this.get(e):this;return n&&n.errors?n.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new i.vpe,this.statusChanges=new i.vpe}_calculateStatus(){return this._allControlsDisabled()?B:this.errors?U:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(N)?N:this._anyControlsHaveStatus(U)?U:F}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_isBoxedValue(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){G(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class H extends Y{constructor(t=null,e,n){super(q(e),V(n,e)),this._onChange=[],this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(t=>t(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=null,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){Z(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){Z(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){this._isBoxedValue(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}}class J extends Y{constructor(t,e,n){super(q(e),V(n,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,n={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,n={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){this._checkAllValuesPresent(t),Object.keys(t).forEach(n=>{this._throwIfControlMissing(n),this.controls[n].setValue(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(Object.keys(t).forEach(n=>{this.controls[n]&&this.controls[n].patchValue(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((n,i)=>{n.reset(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,n)=>(t[n]=e instanceof H?e.value:e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(t,e)=>!!e._syncPendingControls()||t);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_throwIfControlMissing(t){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[t])throw new Error(`Cannot find form control with name: ${t}.`)}_forEachChild(t){Object.keys(this.controls).forEach(e=>{const n=this.controls[e];n&&t(n,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const e of Object.keys(this.controls)){const n=this.controls[e];if(this.contains(e)&&t(n))return!0}return!1}_reduceValue(){return this._reduceChildren({},(t,e,n)=>((e.enabled||this.disabled)&&(t[n]=e.value),t))}_reduceChildren(t,e){let n=t;return this._forEachChild((t,i)=>{n=e(n,t,i)}),n}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(t){this._forEachChild((e,n)=>{if(void 0===t[n])throw new Error(`Must supply a value for form control with name: '${n}'.`)})}}class W extends Y{constructor(t,e,n){super(q(e),V(n,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(t){return this.controls[t]}push(t,e={}){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(t,e,n={}){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:n.emitEvent})}removeAt(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(t,e,n={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),e&&(this.controls.splice(t,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){this._checkAllValuesPresent(t),t.forEach((t,n)=>{this._throwIfControlMissing(n),this.at(n).setValue(t,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(t.forEach((t,n)=>{this.at(n)&&this.at(n).patchValue(t,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t=[],e={}){this._forEachChild((n,i)=>{n.reset(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(t=>t instanceof H?t.value:t.getRawValue())}clear(t={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:t.emitEvent}))}_syncPendingControls(){let t=this.controls.reduce((t,e)=>!!e._syncPendingControls()||t,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_throwIfControlMissing(t){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(t))throw new Error(`Cannot find form control at index ${t}`)}_forEachChild(t){this.controls.forEach((e,n)=>{t(e,n)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_checkAllValuesPresent(t){this._forEachChild((e,n)=>{if(void 0===t[n])throw new Error(`Must supply a value for form control at index: ${n}.`)})}_allControlsDisabled(){for(const t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}}const X={provide:D,useExisting:(0,i.Gpc)(()=>K)},Q=(()=>Promise.resolve(null))();let K=(()=>{class t extends D{constructor(t,e,n,r){super(),this.control=new H,this._registered=!1,this.update=new i.vpe,this._parent=t,this._setValidators(e),this._setAsyncValidators(n),this.valueAccessor=function(t,e){if(!e)return null;let n,i,r;return Array.isArray(e),e.forEach(t=>{t.constructor===p?n=t:function(t){return Object.getPrototypeOf(t.constructor)===c}(t)?i=t:r=t}),r||i||n||null}(0,r)}ngOnChanges(t){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in t&&this._updateDisabled(t),function(t,e){if(!t.hasOwnProperty("model"))return!1;const n=t.model;return!!n.isFirstChange()||!Object.is(e,n.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?function(t,e){return[...e.path,t]}(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){O(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){Q.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1})})}_updateDisabled(t){const e=t.isDisabled.currentValue,n=""===e||e&&"false"!==e;Q.then(()=>{n&&!this.control.disabled?this.control.disable():!n&&this.control.disabled&&this.control.enable()})}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(P,9),i.Y36(m,10),i.Y36(g,10),i.Y36(u,10))},t.\u0275dir=i.lG2({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[i._Bn([X]),i.qOj,i.TTD]}),t})();const tt={provide:u,useExisting:(0,i.Gpc)(()=>et),multi:!0};let et=(()=>{class t extends c{writeValue(t){this.setProperty("value",null==t?"":t)}registerOnChange(t){this.onChange=e=>{t(""==e?null:parseFloat(e))}}}return t.\u0275fac=function(){let e;return function(n){return(e||(e=i.n5z(t)))(n||t)}}(),t.\u0275dir=i.lG2({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(t,e){1&t&&i.NdJ("input",function(t){return e.onChange(t.target.value)})("blur",function(){return e.onTouched()})},features:[i._Bn([tt]),i.qOj]}),t})(),nt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({}),t})(),it=(()=>{class t{constructor(){this._validator=y}handleChanges(t){if(this.inputName in t){const e=this.normalizeInput(t[this.inputName].currentValue);this._validator=this.createValidator(e),this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=i.lG2({type:t}),t})();const rt={provide:m,useExisting:(0,i.Gpc)(()=>ot),multi:!0};let ot=(()=>{class t extends it{constructor(){super(...arguments),this.inputName="max",this.normalizeInput=t=>parseFloat(t),this.createValidator=t=>function(t){return e=>{if(f(e.value)||f(t))return null;const n=parseFloat(e.value);return!isNaN(n)&&n>t?{max:{max:t,actual:e.value}}:null}}(t)}ngOnChanges(t){this.handleChanges(t)}}return t.\u0275fac=function(){let e;return function(n){return(e||(e=i.n5z(t)))(n||t)}}(),t.\u0275dir=i.lG2({type:t,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(t,e){if(2&t){let t;i.uIk("max",null!==(t=e.max)&&void 0!==t?t:null)}},inputs:{max:"max"},features:[i._Bn([rt]),i.qOj,i.TTD]}),t})();const st={provide:m,useExisting:(0,i.Gpc)(()=>at),multi:!0};let at=(()=>{class t extends it{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=t=>parseFloat(t),this.createValidator=t=>function(t){return e=>{if(f(e.value)||f(t))return null;const n=parseFloat(e.value);return!isNaN(n)&&n<t?{min:{min:t,actual:e.value}}:null}}(t)}ngOnChanges(t){this.handleChanges(t)}}return t.\u0275fac=function(){let e;return function(n){return(e||(e=i.n5z(t)))(n||t)}}(),t.\u0275dir=i.lG2({type:t,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(t,e){if(2&t){let t;i.uIk("min",null!==(t=e.min)&&void 0!==t?t:null)}},inputs:{min:"min"},features:[i._Bn([st]),i.qOj,i.TTD]}),t})(),lt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[[nt]]}),t})(),ct=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[lt]}),t})()},8093:function(t,e,n){"use strict";n.d(e,{gz:function(){return ge},y6:function(){return Ln},OD:function(){return ct},eC:function(){return St},wN:function(){return En},F0:function(){return Nn},rH:function(){return qn},Bz:function(){return ti},Hx:function(){return Yt}});var i=n(8583),r=n(639),o=n(4869),s=n(9796),a=n(7393);class l extends a.L{notifyNext(t,e,n,i,r){this.destination.next(e)}notifyError(t,e){this.destination.error(t)}notifyComplete(t){this.destination.complete()}}class c extends a.L{constructor(t,e,n){super(),this.parent=t,this.outerValue=e,this.outerIndex=n,this.index=0}_next(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)}_error(t){this.parent.notifyError(t,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}var u=n(7444),h=n(7574);function d(t,e,n,i,r=new c(t,n,i)){if(!r.closed)return e instanceof h.y?e.subscribe(r):(0,u.s)(e)(r)}var p=n(6693);const f={};class m{constructor(t){this.resultSelector=t}call(t,e){return e.subscribe(new g(t,this.resultSelector))}}class g extends l{constructor(t,e){super(t),this.resultSelector=e,this.active=0,this.values=[],this.observables=[]}_next(t){this.values.push(f),this.observables.push(t)}_complete(){const t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(let n=0;n<e;n++)this.add(d(this,t[n],void 0,n))}}notifyComplete(t){0==(this.active-=1)&&this.destination.complete()}notifyNext(t,e,n){const i=this.values,r=this.toRespond?i[n]===f?--this.toRespond:this.toRespond:0;i[n]=e,0===r&&(this.resultSelector?this._tryResultSelector(i):this.destination.next(i.slice()))}_tryResultSelector(t){let e;try{e=this.resultSelector.apply(this,t)}catch(n){return void this.destination.error(n)}this.destination.next(e)}}const y=(()=>{function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t})();var _=n(4402),v=n(5917),x=n(6215),b=n(8071),w=n(1439),T=n(9193),A=n(2441),S=n(9765);function C(t,e){let n=!1;return arguments.length>=2&&(n=!0),function(i){return i.lift(new I(t,e,n))}}class I{constructor(t,e,n=!1){this.accumulator=t,this.seed=e,this.hasSeed=n}call(t,e){return e.subscribe(new E(t,this.accumulator,this.seed,this.hasSeed))}}class E extends a.L{constructor(t,e,n,i){super(t),this.accumulator=e,this._seed=n,this.hasSeed=i,this.index=0}get seed(){return this._seed}set seed(t){this.hasSeed=!0,this._seed=t}_next(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)}_tryNext(t){const e=this.index++;let n;try{n=this.accumulator(this.seed,t,e)}catch(i){this.destination.error(i)}this.seed=n,this.destination.next(n)}}var M=n(5345);function k(t){return function(e){const n=new P(t),i=e.lift(n);return n.caught=i}}class P{constructor(t){this.selector=t}call(t,e){return e.subscribe(new D(t,this.selector,this.caught))}}class D extends M.Ds{constructor(t,e,n){super(t),this.selector=e,this.caught=n}error(t){if(!this.isStopped){let n;try{n=this.selector(t,this.caught)}catch(e){return void super.error(e)}this._unsubscribeAndRecycle();const i=new M.IY(this);this.add(i);const r=(0,M.ft)(n,i);r!==i&&this.add(r)}}}var L=n(5435),O=n(7108);function R(t){return function(e){return 0===t?(0,T.c)():e.lift(new z(t))}}class z{constructor(t){if(this.total=t,this.total<0)throw new O.W}call(t,e){return e.subscribe(new Z(t,this.total))}}class Z extends a.L{constructor(t,e){super(t),this.total=e,this.ring=new Array,this.count=0}_next(t){const e=this.ring,n=this.total,i=this.count++;e.length<n?e.push(t):e[i%n]=t}_complete(){const t=this.destination;let e=this.count;if(e>0){const n=this.count>=this.total?this.total:this.count,i=this.ring;for(let r=0;r<n;r++){const r=e++%n;t.next(i[r])}}t.complete()}}function F(t=B){return e=>e.lift(new U(t))}class U{constructor(t){this.errorFactory=t}call(t,e){return e.subscribe(new N(t,this.errorFactory))}}class N extends a.L{constructor(t,e){super(t),this.errorFactory=e,this.hasValue=!1}_next(t){this.hasValue=!0,this.destination.next(t)}_complete(){if(this.hasValue)return this.destination.complete();{let e;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)}}}function B(){return new y}function q(t=null){return e=>e.lift(new $(t))}class ${constructor(t){this.defaultValue=t}call(t,e){return e.subscribe(new V(t,this.defaultValue))}}class V extends a.L{constructor(t,e){super(t),this.defaultValue=e,this.isEmpty=!0}_next(t){this.isEmpty=!1,this.destination.next(t)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}var j=n(4487),G=n(5257);function Y(t,e){const n=arguments.length>=2;return i=>i.pipe(t?(0,L.h)((e,n)=>t(e,n,i)):j.y,(0,G.q)(1),n?q(e):F(()=>new y))}function H(){}var J=n(9105);function W(t,e,n){return function(i){return i.lift(new X(t,e,n))}}class X{constructor(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}call(t,e){return e.subscribe(new Q(t,this.nextOrObserver,this.error,this.complete))}}class Q extends a.L{constructor(t,e,n,i){super(t),this._tapNext=H,this._tapError=H,this._tapComplete=H,this._tapError=n||H,this._tapComplete=i||H,(0,J.m)(e)?(this._context=this,this._tapNext=e):e&&(this._context=e,this._tapNext=e.next||H,this._tapError=e.error||H,this._tapComplete=e.complete||H)}_next(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)}_error(t){try{this._tapError.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.error(t)}_complete(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()}}var K=n(5319);class tt{constructor(t){this.callback=t}call(t,e){return e.subscribe(new et(t,this.callback))}}class et extends a.L{constructor(t,e){super(t),this.add(new K.w(e))}}var nt=n(8002),it=n(3190),rt=n(4612),ot=n(9773),st=n(1307),at=n(3282);class lt{constructor(t,e){this.id=t,this.url=e}}class ct extends lt{constructor(t,e,n="imperative",i=null){super(t,e),this.navigationTrigger=n,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ut extends lt{constructor(t,e,n){super(t,e),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ht extends lt{constructor(t,e,n){super(t,e),this.reason=n}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class dt extends lt{constructor(t,e,n){super(t,e),this.error=n}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class pt extends lt{constructor(t,e,n,i){super(t,e),this.urlAfterRedirects=n,this.state=i}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ft extends lt{constructor(t,e,n,i){super(t,e),this.urlAfterRedirects=n,this.state=i}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class mt extends lt{constructor(t,e,n,i,r){super(t,e),this.urlAfterRedirects=n,this.state=i,this.shouldActivate=r}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class gt extends lt{constructor(t,e,n,i){super(t,e),this.urlAfterRedirects=n,this.state=i}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class yt extends lt{constructor(t,e,n,i){super(t,e),this.urlAfterRedirects=n,this.state=i}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _t{constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class vt{constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class xt{constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class bt{constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class wt{constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Tt{constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class At{constructor(t,e,n){this.routerEvent=t,this.position=e,this.anchor=n}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const St="primary";class Ct{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function It(t){return new Ct(t)}const Et="ngNavigationCancelingError";function Mt(t){const e=Error("NavigationCancelingError: "+t);return e[Et]=!0,e}function kt(t,e,n){const i=n.path.split("/");if(i.length>t.length||"full"===n.pathMatch&&(e.hasChildren()||i.length<t.length))return null;const r={};for(let o=0;o<i.length;o++){const e=i[o],n=t[o];if(e.startsWith(":"))r[e.substring(1)]=n;else if(e!==n.path)return null}return{consumed:t.slice(0,i.length),posParams:r}}function Pt(t,e){const n=t?Object.keys(t):void 0,i=e?Object.keys(e):void 0;if(!n||!i||n.length!=i.length)return!1;let r;for(let o=0;o<n.length;o++)if(r=n[o],!Dt(t[r],e[r]))return!1;return!0}function Dt(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;const n=[...t].sort(),i=[...e].sort();return n.every((t,e)=>i[e]===t)}return t===e}function Lt(t){return Array.prototype.concat.apply([],t)}function Ot(t){return t.length>0?t[t.length-1]:null}function Rt(t,e){for(const n in t)t.hasOwnProperty(n)&&e(t[n],n)}function zt(t){return(0,r.CqO)(t)?t:(0,r.QGY)(t)?(0,_.D)(Promise.resolve(t)):(0,v.of)(t)}const Zt={exact:function t(e,n,i){if(!Gt(e.segments,n.segments)||!qt(e.segments,n.segments,i)||e.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children)if(!e.children[r]||!t(e.children[r],n.children[r],i))return!1;return!0},subset:Nt},Ft={exact:function(t,e){return Pt(t,e)},subset:function(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(n=>Dt(t[n],e[n]))},ignored:()=>!0};function Ut(t,e,n){return Zt[n.paths](t.root,e.root,n.matrixParams)&&Ft[n.queryParams](t.queryParams,e.queryParams)&&!("exact"===n.fragment&&t.fragment!==e.fragment)}function Nt(t,e,n){return Bt(t,e,e.segments,n)}function Bt(t,e,n,i){if(t.segments.length>n.length){const r=t.segments.slice(0,n.length);return!(!Gt(r,n)||e.hasChildren()||!qt(r,n,i))}if(t.segments.length===n.length){if(!Gt(t.segments,n)||!qt(t.segments,n,i))return!1;for(const n in e.children)if(!t.children[n]||!Nt(t.children[n],e.children[n],i))return!1;return!0}{const r=n.slice(0,t.segments.length),o=n.slice(t.segments.length);return!!(Gt(t.segments,r)&&qt(t.segments,r,i)&&t.children[St])&&Bt(t.children[St],e,o,i)}}function qt(t,e,n){return e.every((e,i)=>Ft[n](t[i].parameters,e.parameters))}class $t{constructor(t,e,n){this.root=t,this.queryParams=e,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=It(this.queryParams)),this._queryParamMap}toString(){return Jt.serialize(this)}}class Vt{constructor(t,e){this.segments=t,this.children=e,this.parent=null,Rt(e,(t,e)=>t.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Wt(this)}}class jt{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=It(this.parameters)),this._parameterMap}toString(){return ie(this)}}function Gt(t,e){return t.length===e.length&&t.every((t,n)=>t.path===e[n].path)}class Yt{}class Ht{parse(t){const e=new le(t);return new $t(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){var e;return`${`/${Xt(t.root,!0)}`}${function(t){const e=Object.keys(t).map(e=>{const n=t[e];return Array.isArray(n)?n.map(t=>`${Kt(e)}=${Kt(t)}`).join("&"):`${Kt(e)}=${Kt(n)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(t.queryParams)}${"string"==typeof t.fragment?`#${e=t.fragment,encodeURI(e)}`:""}`}}const Jt=new Ht;function Wt(t){return t.segments.map(t=>ie(t)).join("/")}function Xt(t,e){if(!t.hasChildren())return Wt(t);if(e){const e=t.children[St]?Xt(t.children[St],!1):"",n=[];return Rt(t.children,(t,e)=>{e!==St&&n.push(`${e}:${Xt(t,!1)}`)}),n.length>0?`${e}(${n.join("//")})`:e}{const e=function(t,e){let n=[];return Rt(t.children,(t,i)=>{i===St&&(n=n.concat(e(t,i)))}),Rt(t.children,(t,i)=>{i!==St&&(n=n.concat(e(t,i)))}),n}(t,(e,n)=>n===St?[Xt(t.children[St],!1)]:[`${n}:${Xt(e,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[St]?`${Wt(t)}/${e[0]}`:`${Wt(t)}/(${e.join("//")})`}}function Qt(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Kt(t){return Qt(t).replace(/%3B/gi,";")}function te(t){return Qt(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function ee(t){return decodeURIComponent(t)}function ne(t){return ee(t.replace(/\+/g,"%20"))}function ie(t){return`${te(t.path)}${function(t){return Object.keys(t).map(e=>`;${te(e)}=${te(t[e])}`).join("")}(t.parameters)}`}const re=/^[^\/()?;=#]+/;function oe(t){const e=t.match(re);return e?e[0]:""}const se=/^[^=?&#]+/,ae=/^[^?&#]+/;class le{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Vt([],{}):new Vt([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(n[St]=new Vt(t,e)),n}parseSegment(){const t=oe(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new jt(ee(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=oe(this.remaining);if(!e)return;this.capture(e);let n="";if(this.consumeOptional("=")){const t=oe(this.remaining);t&&(n=t,this.capture(n))}t[ee(e)]=ee(n)}parseQueryParam(t){const e=function(t){const e=t.match(se);return e?e[0]:""}(this.remaining);if(!e)return;this.capture(e);let n="";if(this.consumeOptional("=")){const t=function(t){const e=t.match(ae);return e?e[0]:""}(this.remaining);t&&(n=t,this.capture(n))}const i=ne(e),r=ne(n);if(t.hasOwnProperty(i)){let e=t[i];Array.isArray(e)||(e=[e],t[i]=e),e.push(r)}else t[i]=r}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=oe(this.remaining),i=this.remaining[n.length];if("/"!==i&&")"!==i&&";"!==i)throw new Error(`Cannot parse url '${this.url}'`);let r;n.indexOf(":")>-1?(r=n.substr(0,n.indexOf(":")),this.capture(r),this.capture(":")):t&&(r=St);const o=this.parseChildren();e[r]=1===Object.keys(o).length?o[St]:new Vt([],o),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class ce{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=ue(t,this._root);return e?e.children.map(t=>t.value):[]}firstChild(t){const e=ue(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=he(t,this._root);return e.length<2?[]:e[e.length-2].children.map(t=>t.value).filter(e=>e!==t)}pathFromRoot(t){return he(t,this._root).map(t=>t.value)}}function ue(t,e){if(t===e.value)return e;for(const n of e.children){const e=ue(t,n);if(e)return e}return null}function he(t,e){if(t===e.value)return[e];for(const n of e.children){const i=he(t,n);if(i.length)return i.unshift(e),i}return[]}class de{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function pe(t){const e={};return t&&t.children.forEach(t=>e[t.value.outlet]=t),e}class fe extends ce{constructor(t,e){super(t),this.snapshot=e,xe(this,t)}toString(){return this.snapshot.toString()}}function me(t,e){const n=function(t,e){const n=new _e([],{},{},"",{},St,e,null,t.root,-1,{});return new ve("",new de(n,[]))}(t,e),i=new x.X([new jt("",{})]),r=new x.X({}),o=new x.X({}),s=new x.X({}),a=new x.X(""),l=new ge(i,r,s,a,o,St,e,n.root);return l.snapshot=n.root,new fe(new de(l,[]),n)}class ge{constructor(t,e,n,i,r,o,s,a){this.url=t,this.params=e,this.queryParams=n,this.fragment=i,this.data=r,this.outlet=o,this.component=s,this._futureSnapshot=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,nt.U)(t=>It(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,nt.U)(t=>It(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function ye(t,e="emptyOnly"){const n=t.pathFromRoot;let i=0;if("always"!==e)for(i=n.length-1;i>=1;){const t=n[i],e=n[i-1];if(t.routeConfig&&""===t.routeConfig.path)i--;else{if(e.component)break;i--}}return function(t){return t.reduce((t,e)=>({params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign({},t.resolve),e._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(i))}class _e{constructor(t,e,n,i,r,o,s,a,l,c,u){this.url=t,this.params=e,this.queryParams=n,this.fragment=i,this.data=r,this.outlet=o,this.component=s,this.routeConfig=a,this._urlSegment=l,this._lastPathIndex=c,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=It(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=It(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(t=>t.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class ve extends ce{constructor(t,e){super(e),this.url=t,xe(this,e)}toString(){return be(this._root)}}function xe(t,e){e.value._routerState=t,e.children.forEach(e=>xe(t,e))}function be(t){const e=t.children.length>0?` { ${t.children.map(be).join(", ")} } `:"";return`${t.value}${e}`}function we(t){if(t.snapshot){const e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,Pt(e.queryParams,n.queryParams)||t.queryParams.next(n.queryParams),e.fragment!==n.fragment&&t.fragment.next(n.fragment),Pt(e.params,n.params)||t.params.next(n.params),function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Pt(t[n],e[n]))return!1;return!0}(e.url,n.url)||t.url.next(n.url),Pt(e.data,n.data)||t.data.next(n.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function Te(t,e){return Pt(t.params,e.params)&&function(t,e){return Gt(t,e)&&t.every((t,n)=>Pt(t.parameters,e[n].parameters))}(t.url,e.url)&&!(!t.parent!=!e.parent)&&(!t.parent||Te(t.parent,e.parent))}function Ae(t,e,n){if(n&&t.shouldReuseRoute(e.value,n.value.snapshot)){const i=n.value;i._futureSnapshot=e.value;const r=function(t,e,n){return e.children.map(e=>{for(const i of n.children)if(t.shouldReuseRoute(e.value,i.value.snapshot))return Ae(t,e,i);return Ae(t,e)})}(t,e,n);return new de(i,r)}{if(t.shouldAttach(e.value)){const n=t.retrieve(e.value);if(null!==n){const t=n.route;return Se(e,t),t}}const n=function(t){return new ge(new x.X(t.url),new x.X(t.params),new x.X(t.queryParams),new x.X(t.fragment),new x.X(t.data),t.outlet,t.component,t)}(e.value),i=e.children.map(e=>Ae(t,e));return new de(n,i)}}function Se(t,e){if(t.value.routeConfig!==e.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(t.children.length!==e.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");e.value._futureSnapshot=t.value;for(let n=0;n<t.children.length;++n)Se(t.children[n],e.children[n])}function Ce(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function Ie(t){return"object"==typeof t&&null!=t&&t.outlets}function Ee(t,e,n,i,r){let o={};return i&&Rt(i,(t,e)=>{o[e]=Array.isArray(t)?t.map(t=>`${t}`):`${t}`}),new $t(n.root===t?e:Me(n.root,t,e),o,r)}function Me(t,e,n){const i={};return Rt(t.children,(t,r)=>{i[r]=t===e?n:Me(t,e,n)}),new Vt(t.segments,i)}class ke{constructor(t,e,n){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=n,t&&n.length>0&&Ce(n[0]))throw new Error("Root segment cannot have matrix parameters");const i=n.find(Ie);if(i&&i!==Ot(n))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Pe{constructor(t,e,n){this.segmentGroup=t,this.processChildren=e,this.index=n}}function De(t,e,n){if(t||(t=new Vt([],{})),0===t.segments.length&&t.hasChildren())return Le(t,e,n);const i=function(t,e,n){let i=0,r=e;const o={match:!1,pathIndex:0,commandIndex:0};for(;r<t.segments.length;){if(i>=n.length)return o;const e=t.segments[r],s=n[i];if(Ie(s))break;const a=`${s}`,l=i<n.length-1?n[i+1]:null;if(r>0&&void 0===a)break;if(a&&l&&"object"==typeof l&&void 0===l.outlets){if(!Ze(a,l,e))return o;i+=2}else{if(!Ze(a,{},e))return o;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(t,e,n),r=n.slice(i.commandIndex);if(i.match&&i.pathIndex<t.segments.length){const e=new Vt(t.segments.slice(0,i.pathIndex),{});return e.children[St]=new Vt(t.segments.slice(i.pathIndex),t.children),Le(e,0,r)}return i.match&&0===r.length?new Vt(t.segments,{}):i.match&&!t.hasChildren()?Oe(t,e,n):i.match?Le(t,0,r):Oe(t,e,n)}function Le(t,e,n){if(0===n.length)return new Vt(t.segments,{});{const i=function(t){return Ie(t[0])?t[0].outlets:{[St]:t}}(n),r={};return Rt(i,(n,i)=>{"string"==typeof n&&(n=[n]),null!==n&&(r[i]=De(t.children[i],e,n))}),Rt(t.children,(t,e)=>{void 0===i[e]&&(r[e]=t)}),new Vt(t.segments,r)}}function Oe(t,e,n){const i=t.segments.slice(0,e);let r=0;for(;r<n.length;){const o=n[r];if(Ie(o)){const t=Re(o.outlets);return new Vt(i,t)}if(0===r&&Ce(n[0])){i.push(new jt(t.segments[e].path,ze(n[0]))),r++;continue}const s=Ie(o)?o.outlets[St]:`${o}`,a=r<n.length-1?n[r+1]:null;s&&a&&Ce(a)?(i.push(new jt(s,ze(a))),r+=2):(i.push(new jt(s,{})),r++)}return new Vt(i,{})}function Re(t){const e={};return Rt(t,(t,n)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[n]=Oe(new Vt([],{}),0,t))}),e}function ze(t){const e={};return Rt(t,(t,n)=>e[n]=`${t}`),e}function Ze(t,e,n){return t==n.path&&Pt(e,n.parameters)}class Fe{constructor(t,e,n,i){this.routeReuseStrategy=t,this.futureState=e,this.currState=n,this.forwardEvent=i}activate(t){const e=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,n,t),we(this.futureState.root),this.activateChildRoutes(e,n,t)}deactivateChildRoutes(t,e,n){const i=pe(e);t.children.forEach(t=>{const e=t.value.outlet;this.deactivateRoutes(t,i[e],n),delete i[e]}),Rt(i,(t,e)=>{this.deactivateRouteAndItsChildren(t,n)})}deactivateRoutes(t,e,n){const i=t.value,r=e?e.value:null;if(i===r)if(i.component){const r=n.getContext(i.outlet);r&&this.deactivateChildRoutes(t,e,r.children)}else this.deactivateChildRoutes(t,e,n);else r&&this.deactivateRouteAndItsChildren(e,n)}deactivateRouteAndItsChildren(t,e){this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const n=e.getContext(t.value.outlet);if(n&&n.outlet){const e=n.outlet.detach(),i=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:e,route:t,contexts:i})}}deactivateRouteAndOutlet(t,e){const n=e.getContext(t.value.outlet),i=n&&t.value.component?n.children:e,r=pe(t);for(const o of Object.keys(r))this.deactivateRouteAndItsChildren(r[o],i);n&&n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated(),n.attachRef=null,n.resolver=null,n.route=null)}activateChildRoutes(t,e,n){const i=pe(e);t.children.forEach(t=>{this.activateRoutes(t,i[t.value.outlet],n),this.forwardEvent(new Tt(t.value.snapshot))}),t.children.length&&this.forwardEvent(new bt(t.value.snapshot))}activateRoutes(t,e,n){const i=t.value,r=e?e.value:null;if(we(i),i===r)if(i.component){const r=n.getOrCreateContext(i.outlet);this.activateChildRoutes(t,e,r.children)}else this.activateChildRoutes(t,e,n);else if(i.component){const e=n.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const t=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),e.children.onOutletReAttached(t.contexts),e.attachRef=t.componentRef,e.route=t.route.value,e.outlet&&e.outlet.attach(t.componentRef,t.route.value),Ue(t.route)}else{const n=function(t){for(let e=t.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig;if(t&&t.component)return null}return null}(i.snapshot),r=n?n.module.componentFactoryResolver:null;e.attachRef=null,e.route=i,e.resolver=r,e.outlet&&e.outlet.activateWith(i,r),this.activateChildRoutes(t,null,e.children)}}else this.activateChildRoutes(t,null,n)}}function Ue(t){we(t.value),t.children.forEach(Ue)}class Ne{constructor(t,e){this.routes=t,this.module=e}}function Be(t){return"function"==typeof t}function qe(t){return t instanceof $t}const $e=Symbol("INITIAL_VALUE");function Ve(){return(0,it.w)(t=>function(...t){let e,n;return(0,o.K)(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&(0,s.k)(t[0])&&(t=t[0]),(0,p.n)(t,n).lift(new m(e))}(t.map(t=>t.pipe((0,G.q)(1),function(...t){const e=t[t.length-1];return(0,o.K)(e)?(t.pop(),n=>(0,b.z)(t,n,e)):e=>(0,b.z)(t,e)}($e)))).pipe(C((t,e)=>{let n=!1;return e.reduce((t,i,r)=>t!==$e?t:(i===$e&&(n=!0),n||!1!==i&&r!==e.length-1&&!qe(i)?t:i),t)},$e),(0,L.h)(t=>t!==$e),(0,nt.U)(t=>qe(t)?t:!0===t),(0,G.q)(1)))}let je=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=r.Xpm({type:t,selectors:[["ng-component"]],decls:1,vars:0,template:function(t,e){1&t&&r._UZ(0,"router-outlet")},directives:function(){return[Vn]},encapsulation:2}),t})();function Ge(t,e=""){for(let n=0;n<t.length;n++){const i=t[n];Ye(i,He(e,i))}}function Ye(t,e){t.children&&Ge(t.children,e)}function He(t,e){return e?t||e.path?t&&!e.path?`${t}/`:!t&&e.path?e.path:`${t}/${e.path}`:"":t}function Je(t){const e=t.children&&t.children.map(Je),n=e?Object.assign(Object.assign({},t),{children:e}):Object.assign({},t);return!n.component&&(e||n.loadChildren)&&n.outlet&&n.outlet!==St&&(n.component=je),n}function We(t){return t.outlet||St}function Xe(t,e){const n=t.filter(t=>We(t)===e);return n.push(...t.filter(t=>We(t)!==e)),n}const Qe={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function Ke(t,e,n){var i;if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||n.length>0)?Object.assign({},Qe):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const r=(e.matcher||kt)(n,t,e);if(!r)return Object.assign({},Qe);const o={};Rt(r.posParams,(t,e)=>{o[e]=t.path});const s=r.consumed.length>0?Object.assign(Object.assign({},o),r.consumed[r.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:r.consumed,lastChild:r.consumed.length,parameters:s,positionalParamSegments:null!==(i=r.posParams)&&void 0!==i?i:{}}}function tn(t,e,n,i,r="corrected"){if(n.length>0&&function(t,e,n){return n.some(n=>en(t,e,n)&&We(n)!==St)}(t,n,i)){const r=new Vt(e,function(t,e,n,i){const r={};r[St]=i,i._sourceSegment=t,i._segmentIndexShift=e.length;for(const o of n)if(""===o.path&&We(o)!==St){const n=new Vt([],{});n._sourceSegment=t,n._segmentIndexShift=e.length,r[We(o)]=n}return r}(t,e,i,new Vt(n,t.children)));return r._sourceSegment=t,r._segmentIndexShift=e.length,{segmentGroup:r,slicedSegments:[]}}if(0===n.length&&function(t,e,n){return n.some(n=>en(t,e,n))}(t,n,i)){const o=new Vt(t.segments,function(t,e,n,i,r,o){const s={};for(const a of i)if(en(t,n,a)&&!r[We(a)]){const n=new Vt([],{});n._sourceSegment=t,n._segmentIndexShift="legacy"===o?t.segments.length:e.length,s[We(a)]=n}return Object.assign(Object.assign({},r),s)}(t,e,n,i,t.children,r));return o._sourceSegment=t,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:n}}const o=new Vt(t.segments,t.children);return o._sourceSegment=t,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:n}}function en(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path}function nn(t,e,n,i){return!!(We(t)===i||i!==St&&en(e,n,t))&&("**"===t.path||Ke(e,t,n).matched)}function rn(t,e,n){return 0===e.length&&!t.children[n]}class on{constructor(t){this.segmentGroup=t||null}}class sn{constructor(t){this.urlTree=t}}function an(t){return new h.y(e=>e.error(new on(t)))}function ln(t){return new h.y(e=>e.error(new sn(t)))}function cn(t){return new h.y(e=>e.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t}'`)))}class un{constructor(t,e,n,i,o){this.configLoader=e,this.urlSerializer=n,this.urlTree=i,this.config=o,this.allowRedirects=!0,this.ngModule=t.get(r.h0i)}apply(){const t=tn(this.urlTree.root,[],[],this.config).segmentGroup,e=new Vt(t.segments,t.children);return this.expandSegmentGroup(this.ngModule,this.config,e,St).pipe((0,nt.U)(t=>this.createUrlTree(hn(t),this.urlTree.queryParams,this.urlTree.fragment))).pipe(k(t=>{if(t instanceof sn)return this.allowRedirects=!1,this.match(t.urlTree);throw t instanceof on?this.noMatchError(t):t}))}match(t){return this.expandSegmentGroup(this.ngModule,this.config,t.root,St).pipe((0,nt.U)(e=>this.createUrlTree(hn(e),t.queryParams,t.fragment))).pipe(k(t=>{throw t instanceof on?this.noMatchError(t):t}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,e,n){const i=t.segments.length>0?new Vt([],{[St]:t}):t;return new $t(i,e,n)}expandSegmentGroup(t,e,n,i){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(t,e,n).pipe((0,nt.U)(t=>new Vt([],t))):this.expandSegment(t,n,e,n.segments,i,!0)}expandChildren(t,e,n){const i=[];for(const r of Object.keys(n.children))"primary"===r?i.unshift(r):i.push(r);return(0,_.D)(i).pipe((0,rt.b)(i=>{const r=n.children[i],o=Xe(e,i);return this.expandSegmentGroup(t,o,r,i).pipe((0,nt.U)(t=>({segment:t,outlet:i})))}),C((t,e)=>(t[e.outlet]=e.segment,t),{}),function(t,e){const n=arguments.length>=2;return i=>i.pipe(t?(0,L.h)((e,n)=>t(e,n,i)):j.y,R(1),n?q(e):F(()=>new y))}())}expandSegment(t,e,n,i,r,o){return(0,_.D)(n).pipe((0,rt.b)(s=>this.expandSegmentAgainstRoute(t,e,n,s,i,r,o).pipe(k(t=>{if(t instanceof on)return(0,v.of)(null);throw t}))),Y(t=>!!t),k((t,n)=>{if(t instanceof y||"EmptyError"===t.name){if(rn(e,i,r))return(0,v.of)(new Vt([],{}));throw new on(e)}throw t}))}expandSegmentAgainstRoute(t,e,n,i,r,o,s){return nn(i,e,r,o)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(t,e,i,r,o):s&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,n,i,r,o):an(e):an(e)}expandSegmentAgainstRouteUsingRedirect(t,e,n,i,r,o){return"**"===i.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,i,o):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,n,i,r,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,n,i){const r=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?ln(r):this.lineralizeSegments(n,r).pipe((0,ot.zg)(n=>{const r=new Vt(n,{});return this.expandSegment(t,r,e,n,i,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,n,i,r,o){const{matched:s,consumedSegments:a,lastChild:l,positionalParamSegments:c}=Ke(e,i,r);if(!s)return an(e);const u=this.applyRedirectCommands(a,i.redirectTo,c);return i.redirectTo.startsWith("/")?ln(u):this.lineralizeSegments(i,u).pipe((0,ot.zg)(i=>this.expandSegment(t,e,n,i.concat(r.slice(l)),o,!1)))}matchSegmentAgainstRoute(t,e,n,i,r){if("**"===n.path)return n.loadChildren?(n._loadedConfig?(0,v.of)(n._loadedConfig):this.configLoader.load(t.injector,n)).pipe((0,nt.U)(t=>(n._loadedConfig=t,new Vt(i,{})))):(0,v.of)(new Vt(i,{}));const{matched:o,consumedSegments:s,lastChild:a}=Ke(e,n,i);if(!o)return an(e);const l=i.slice(a);return this.getChildConfig(t,n,i).pipe((0,ot.zg)(t=>{const i=t.module,o=t.routes,{segmentGroup:a,slicedSegments:c}=tn(e,s,l,o),u=new Vt(a.segments,a.children);if(0===c.length&&u.hasChildren())return this.expandChildren(i,o,u).pipe((0,nt.U)(t=>new Vt(s,t)));if(0===o.length&&0===c.length)return(0,v.of)(new Vt(s,{}));const h=We(n)===r;return this.expandSegment(i,u,o,c,h?St:r,!0).pipe((0,nt.U)(t=>new Vt(s.concat(t.segments),t.children)))}))}getChildConfig(t,e,n){return e.children?(0,v.of)(new Ne(e.children,t)):e.loadChildren?void 0!==e._loadedConfig?(0,v.of)(e._loadedConfig):this.runCanLoadGuards(t.injector,e,n).pipe((0,ot.zg)(n=>{return n?this.configLoader.load(t.injector,e).pipe((0,nt.U)(t=>(e._loadedConfig=t,t))):(i=e,new h.y(t=>t.error(Mt(`Cannot load children because the guard of the route "path: '${i.path}'" returned false`))));var i})):(0,v.of)(new Ne([],t))}runCanLoadGuards(t,e,n){const i=e.canLoad;if(!i||0===i.length)return(0,v.of)(!0);const r=i.map(i=>{const r=t.get(i);let o;if((s=r)&&Be(s.canLoad))o=r.canLoad(e,n);else{if(!Be(r))throw new Error("Invalid CanLoad guard");o=r(e,n)}var s;return zt(o)});return(0,v.of)(r).pipe(Ve(),W(t=>{if(!qe(t))return;const e=Mt(`Redirecting to "${this.urlSerializer.serialize(t)}"`);throw e.url=t,e}),(0,nt.U)(t=>!0===t))}lineralizeSegments(t,e){let n=[],i=e.root;for(;;){if(n=n.concat(i.segments),0===i.numberOfChildren)return(0,v.of)(n);if(i.numberOfChildren>1||!i.children[St])return cn(t.redirectTo);i=i.children[St]}}applyRedirectCommands(t,e,n){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,n)}applyRedirectCreatreUrlTree(t,e,n,i){const r=this.createSegmentGroup(t,e.root,n,i);return new $t(r,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const n={};return Rt(t,(t,i)=>{if("string"==typeof t&&t.startsWith(":")){const r=t.substring(1);n[i]=e[r]}else n[i]=t}),n}createSegmentGroup(t,e,n,i){const r=this.createSegments(t,e.segments,n,i);let o={};return Rt(e.children,(e,r)=>{o[r]=this.createSegmentGroup(t,e,n,i)}),new Vt(r,o)}createSegments(t,e,n,i){return e.map(e=>e.path.startsWith(":")?this.findPosParam(t,e,i):this.findOrReturn(e,n))}findPosParam(t,e,n){const i=n[e.path.substring(1)];if(!i)throw new Error(`Cannot redirect to '${t}'. Cannot find '${e.path}'.`);return i}findOrReturn(t,e){let n=0;for(const i of e){if(i.path===t.path)return e.splice(n),i;n++}return t}}function hn(t){const e={};for(const n of Object.keys(t.children)){const i=hn(t.children[n]);(i.segments.length>0||i.hasChildren())&&(e[n]=i)}return function(t){if(1===t.numberOfChildren&&t.children[St]){const e=t.children[St];return new Vt(t.segments.concat(e.segments),e.children)}return t}(new Vt(t.segments,e))}class dn{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class pn{constructor(t,e){this.component=t,this.route=e}}function fn(t,e,n){const i=t._root;return gn(i,e?e._root:null,n,[i.value])}function mn(t,e,n){const i=function(t){if(!t)return null;for(let e=t.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig}return null}(e);return(i?i.module.injector:n).get(t)}function gn(t,e,n,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const o=pe(e);return t.children.forEach(t=>{(function(t,e,n,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const o=t.value,s=e?e.value:null,a=n?n.getContext(t.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){const l=function(t,e,n){if("function"==typeof n)return n(t,e);switch(n){case"pathParamsChange":return!Gt(t.url,e.url);case"pathParamsOrQueryParamsChange":return!Gt(t.url,e.url)||!Pt(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Te(t,e)||!Pt(t.queryParams,e.queryParams);case"paramsChange":default:return!Te(t,e)}}(s,o,o.routeConfig.runGuardsAndResolvers);l?r.canActivateChecks.push(new dn(i)):(o.data=s.data,o._resolvedData=s._resolvedData),gn(t,e,o.component?a?a.children:null:n,i,r),l&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new pn(a.outlet.component,s))}else s&&yn(e,a,r),r.canActivateChecks.push(new dn(i)),gn(t,null,o.component?a?a.children:null:n,i,r)})(t,o[t.value.outlet],n,i.concat([t.value]),r),delete o[t.value.outlet]}),Rt(o,(t,e)=>yn(t,n.getContext(e),r)),r}function yn(t,e,n){const i=pe(t),r=t.value;Rt(i,(t,i)=>{yn(t,r.component?e?e.children.getContext(i):null:e,n)}),n.canDeactivateChecks.push(new pn(r.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,r))}class _n{}function vn(t){return new h.y(e=>e.error(t))}class xn{constructor(t,e,n,i,r,o){this.rootComponentType=t,this.config=e,this.urlTree=n,this.url=i,this.paramsInheritanceStrategy=r,this.relativeLinkResolution=o}recognize(){const t=tn(this.urlTree.root,[],[],this.config.filter(t=>void 0===t.redirectTo),this.relativeLinkResolution).segmentGroup,e=this.processSegmentGroup(this.config,t,St);if(null===e)return null;const n=new _e([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},St,this.rootComponentType,null,this.urlTree.root,-1,{}),i=new de(n,e),r=new ve(this.url,i);return this.inheritParamsAndData(r._root),r}inheritParamsAndData(t){const e=t.value,n=ye(e,this.paramsInheritanceStrategy);e.params=Object.freeze(n.params),e.data=Object.freeze(n.data),t.children.forEach(t=>this.inheritParamsAndData(t))}processSegmentGroup(t,e,n){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,n)}processChildren(t,e){const n=[];for(const r of Object.keys(e.children)){const i=e.children[r],o=Xe(t,r),s=this.processSegmentGroup(o,i,r);if(null===s)return null;n.push(...s)}const i=wn(n);return i.sort((t,e)=>t.value.outlet===St?-1:e.value.outlet===St?1:t.value.outlet.localeCompare(e.value.outlet)),i}processSegment(t,e,n,i){for(const r of t){const t=this.processSegmentAgainstRoute(r,e,n,i);if(null!==t)return t}return rn(e,n,i)?[]:null}processSegmentAgainstRoute(t,e,n,i){if(t.redirectTo||!nn(t,e,n,i))return null;let r,o=[],s=[];if("**"===t.path){const i=n.length>0?Ot(n).parameters:{};r=new _e(n,i,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Sn(t),We(t),t.component,t,Tn(e),An(e)+n.length,Cn(t))}else{const i=Ke(e,t,n);if(!i.matched)return null;o=i.consumedSegments,s=n.slice(i.lastChild),r=new _e(o,i.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Sn(t),We(t),t.component,t,Tn(e),An(e)+o.length,Cn(t))}const a=(u=t).children?u.children:u.loadChildren?u._loadedConfig.routes:[],{segmentGroup:l,slicedSegments:c}=tn(e,o,s,a.filter(t=>void 0===t.redirectTo),this.relativeLinkResolution);var u;if(0===c.length&&l.hasChildren()){const t=this.processChildren(a,l);return null===t?null:[new de(r,t)]}if(0===a.length&&0===c.length)return[new de(r,[])];const h=We(t)===i,d=this.processSegment(a,l,c,h?St:i);return null===d?null:[new de(r,d)]}}function bn(t){const e=t.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function wn(t){const e=[],n=new Set;for(const i of t){if(!bn(i)){e.push(i);continue}const t=e.find(t=>i.value.routeConfig===t.value.routeConfig);void 0!==t?(t.children.push(...i.children),n.add(t)):e.push(i)}for(const i of n){const t=wn(i.children);e.push(new de(i.value,t))}return e.filter(t=>!n.has(t))}function Tn(t){let e=t;for(;e._sourceSegment;)e=e._sourceSegment;return e}function An(t){let e=t,n=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,n+=e._segmentIndexShift?e._segmentIndexShift:0;return n-1}function Sn(t){return t.data||{}}function Cn(t){return t.resolve||{}}function In(t){return(0,it.w)(e=>{const n=t(e);return n?(0,_.D)(n).pipe((0,nt.U)(()=>e)):(0,v.of)(e)})}class En{}class Mn extends class{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const kn=new r.OlP("ROUTES");class Pn{constructor(t,e,n,i){this.loader=t,this.compiler=e,this.onLoadStartListener=n,this.onLoadEndListener=i}load(t,e){if(e._loader$)return e._loader$;this.onLoadStartListener&&this.onLoadStartListener(e);const n=this.loadModuleFactory(e.loadChildren).pipe((0,nt.U)(n=>{this.onLoadEndListener&&this.onLoadEndListener(e);const i=n.create(t);return new Ne(Lt(i.injector.get(kn,void 0,r.XFs.Self|r.XFs.Optional)).map(Je),i)}),k(t=>{throw e._loader$=void 0,t}));return e._loader$=new A.c(n,()=>new S.xQ).pipe((0,st.x)()),e._loader$}loadModuleFactory(t){return"string"==typeof t?(0,_.D)(this.loader.load(t)):zt(t()).pipe((0,ot.zg)(t=>t instanceof r.YKP?(0,v.of)(t):(0,_.D)(this.compiler.compileModuleAsync(t))))}}class Dn{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Ln,this.attachRef=null}}class Ln{constructor(){this.contexts=new Map}onChildOutletCreated(t,e){const n=this.getOrCreateContext(t);n.outlet=e,this.contexts.set(t,n)}onChildOutletDestroyed(t){const e=this.getContext(t);e&&(e.outlet=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let e=this.getContext(t);return e||(e=new Dn,this.contexts.set(t,e)),e}getContext(t){return this.contexts.get(t)||null}}class On{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function Rn(t){throw t}function zn(t,e,n){return e.parse("/")}function Zn(t,e){return(0,v.of)(null)}const Fn={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Un={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Nn=(()=>{class t{constructor(t,e,n,i,o,s,a,l){this.rootComponentType=t,this.urlSerializer=e,this.rootContexts=n,this.location=i,this.config=l,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new S.xQ,this.errorHandler=Rn,this.malformedUriErrorHandler=zn,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Zn,afterPreactivation:Zn},this.urlHandlingStrategy=new On,this.routeReuseStrategy=new Mn,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=o.get(r.h0i),this.console=o.get(r.c2e);const c=o.get(r.R0b);this.isNgZoneEnabled=c instanceof r.R0b&&r.R0b.isInAngularZone(),this.resetConfig(l),this.currentUrlTree=new $t(new Vt([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Pn(s,a,t=>this.triggerEvent(new _t(t)),t=>this.triggerEvent(new vt(t))),this.routerState=me(this.currentUrlTree,this.rootComponentType),this.transitions=new x.X({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var t;return null===(t=this.location.getState())||void 0===t?void 0:t.\u0275routerPageId}setupNavigations(t){const e=this.events;return t.pipe((0,L.h)(t=>0!==t.id),(0,nt.U)(t=>Object.assign(Object.assign({},t),{extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl)})),(0,it.w)(t=>{let n=!1,i=!1;return(0,v.of)(t).pipe(W(t=>{this.currentNavigation={id:t.id,initialUrl:t.currentRawUrl,extractedUrl:t.extractedUrl,trigger:t.source,extras:t.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),(0,it.w)(t=>{const n=this.browserUrlTree.toString(),r=!this.navigated||t.extractedUrl.toString()!==n||n!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||r)&&this.urlHandlingStrategy.shouldProcessUrl(t.rawUrl))return Bn(t.source)&&(this.browserUrlTree=t.extractedUrl),(0,v.of)(t).pipe((0,it.w)(t=>{const n=this.transitions.getValue();return e.next(new ct(t.id,this.serializeUrl(t.extractedUrl),t.source,t.restoredState)),n!==this.transitions.getValue()?T.E:Promise.resolve(t)}),function(t,e,n,i){return(0,it.w)(r=>function(t,e,n,i,r){return new un(t,e,n,i,r).apply()}(t,e,n,r.extractedUrl,i).pipe((0,nt.U)(t=>Object.assign(Object.assign({},r),{urlAfterRedirects:t}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),W(t=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:t.urlAfterRedirects})}),function(t,e,n,r,o){return(0,ot.zg)(s=>function(t,e,n,r,o="emptyOnly",s="legacy"){try{const i=new xn(t,e,n,r,o,s).recognize();return null===i?vn(new _n):(0,v.of)(i)}catch(i){return vn(i)}}(t,e,s.urlAfterRedirects,n(s.urlAfterRedirects),r,o).pipe((0,nt.U)(t=>Object.assign(Object.assign({},s),{targetSnapshot:t}))))}(this.rootComponentType,this.config,t=>this.serializeUrl(t),this.paramsInheritanceStrategy,this.relativeLinkResolution),W(t=>{"eager"===this.urlUpdateStrategy&&(t.extras.skipLocationChange||this.setBrowserUrl(t.urlAfterRedirects,t),this.browserUrlTree=t.urlAfterRedirects);const n=new pt(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);e.next(n)}));if(r&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:n,extractedUrl:i,source:r,restoredState:o,extras:s}=t,a=new ct(n,this.serializeUrl(i),r,o);e.next(a);const l=me(i,this.rootComponentType).snapshot;return(0,v.of)(Object.assign(Object.assign({},t),{targetSnapshot:l,urlAfterRedirects:i,extras:Object.assign(Object.assign({},s),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=t.rawUrl,this.browserUrlTree=t.urlAfterRedirects,t.resolve(null),T.E}),In(t=>{const{targetSnapshot:e,id:n,extractedUrl:i,rawUrl:r,extras:{skipLocationChange:o,replaceUrl:s}}=t;return this.hooks.beforePreactivation(e,{navigationId:n,appliedUrlTree:i,rawUrlTree:r,skipLocationChange:!!o,replaceUrl:!!s})}),W(t=>{const e=new ft(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);this.triggerEvent(e)}),(0,nt.U)(t=>Object.assign(Object.assign({},t),{guards:fn(t.targetSnapshot,t.currentSnapshot,this.rootContexts)})),function(t,e){return(0,ot.zg)(n=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:o,canDeactivateChecks:s}}=n;return 0===s.length&&0===o.length?(0,v.of)(Object.assign(Object.assign({},n),{guardsResult:!0})):function(t,e,n,i){return(0,_.D)(t).pipe((0,ot.zg)(t=>function(t,e,n,i,r){const o=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!o||0===o.length)return(0,v.of)(!0);const s=o.map(o=>{const s=mn(o,e,r);let a;if(function(t){return t&&Be(t.canDeactivate)}(s))a=zt(s.canDeactivate(t,e,n,i));else{if(!Be(s))throw new Error("Invalid CanDeactivate guard");a=zt(s(t,e,n,i))}return a.pipe(Y())});return(0,v.of)(s).pipe(Ve())}(t.component,t.route,n,e,i)),Y(t=>!0!==t,!0))}(s,i,r,t).pipe((0,ot.zg)(n=>n&&function(t){return"boolean"==typeof t}(n)?function(t,e,n,i){return(0,_.D)(e).pipe((0,rt.b)(e=>(0,b.z)(function(t,e){return null!==t&&e&&e(new xt(t)),(0,v.of)(!0)}(e.route.parent,i),function(t,e){return null!==t&&e&&e(new wt(t)),(0,v.of)(!0)}(e.route,i),function(t,e,n){const i=e[e.length-1],r=e.slice(0,e.length-1).reverse().map(t=>function(t){const e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}(t)).filter(t=>null!==t).map(e=>(0,w.P)(()=>{const r=e.guards.map(r=>{const o=mn(r,e.node,n);let s;if(function(t){return t&&Be(t.canActivateChild)}(o))s=zt(o.canActivateChild(i,t));else{if(!Be(o))throw new Error("Invalid CanActivateChild guard");s=zt(o(i,t))}return s.pipe(Y())});return(0,v.of)(r).pipe(Ve())}));return(0,v.of)(r).pipe(Ve())}(t,e.path,n),function(t,e,n){const i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||0===i.length)return(0,v.of)(!0);const r=i.map(i=>(0,w.P)(()=>{const r=mn(i,e,n);let o;if(function(t){return t&&Be(t.canActivate)}(r))o=zt(r.canActivate(e,t));else{if(!Be(r))throw new Error("Invalid CanActivate guard");o=zt(r(e,t))}return o.pipe(Y())}));return(0,v.of)(r).pipe(Ve())}(t,e.route,n))),Y(t=>!0!==t,!0))}(i,o,t,e):(0,v.of)(n)),(0,nt.U)(t=>Object.assign(Object.assign({},n),{guardsResult:t})))})}(this.ngModule.injector,t=>this.triggerEvent(t)),W(t=>{if(qe(t.guardsResult)){const e=Mt(`Redirecting to "${this.serializeUrl(t.guardsResult)}"`);throw e.url=t.guardsResult,e}const e=new mt(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot,!!t.guardsResult);this.triggerEvent(e)}),(0,L.h)(t=>!!t.guardsResult||(this.restoreHistory(t),this.cancelNavigationTransition(t,""),!1)),In(t=>{if(t.guards.canActivateChecks.length)return(0,v.of)(t).pipe(W(t=>{const e=new gt(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);this.triggerEvent(e)}),(0,it.w)(t=>{let e=!1;return(0,v.of)(t).pipe(function(t,e){return(0,ot.zg)(n=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=n;if(!r.length)return(0,v.of)(n);let o=0;return(0,_.D)(r).pipe((0,rt.b)(n=>function(t,e,n,i){return function(t,e,n,i){const r=Object.keys(t);if(0===r.length)return(0,v.of)({});const o={};return(0,_.D)(r).pipe((0,ot.zg)(r=>function(t,e,n,i){const r=mn(t,e,i);return zt(r.resolve?r.resolve(e,n):r(e,n))}(t[r],e,n,i).pipe(W(t=>{o[r]=t}))),R(1),(0,ot.zg)(()=>Object.keys(o).length===r.length?(0,v.of)(o):T.E))}(t._resolve,t,e,i).pipe((0,nt.U)(e=>(t._resolvedData=e,t.data=Object.assign(Object.assign({},t.data),ye(t,n).resolve),null)))}(n.route,i,t,e)),W(()=>o++),R(1),(0,ot.zg)(t=>o===r.length?(0,v.of)(n):T.E))})}(this.paramsInheritanceStrategy,this.ngModule.injector),W({next:()=>e=!0,complete:()=>{e||(this.restoreHistory(t),this.cancelNavigationTransition(t,"At least one route resolver didn't emit any value."))}}))}),W(t=>{const e=new yt(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);this.triggerEvent(e)}))}),In(t=>{const{targetSnapshot:e,id:n,extractedUrl:i,rawUrl:r,extras:{skipLocationChange:o,replaceUrl:s}}=t;return this.hooks.afterPreactivation(e,{navigationId:n,appliedUrlTree:i,rawUrlTree:r,skipLocationChange:!!o,replaceUrl:!!s})}),(0,nt.U)(t=>{const e=function(t,e,n){const i=Ae(t,e._root,n?n._root:void 0);return new fe(i,e)}(this.routeReuseStrategy,t.targetSnapshot,t.currentRouterState);return Object.assign(Object.assign({},t),{targetRouterState:e})}),W(t=>{this.currentUrlTree=t.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(t.urlAfterRedirects,t.rawUrl),this.routerState=t.targetRouterState,"deferred"===this.urlUpdateStrategy&&(t.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,t),this.browserUrlTree=t.urlAfterRedirects)}),((t,e,n)=>(0,nt.U)(i=>(new Fe(e,i.targetRouterState,i.currentRouterState,n).activate(t),i)))(this.rootContexts,this.routeReuseStrategy,t=>this.triggerEvent(t)),W({next(){n=!0},complete(){n=!0}}),function(t){return e=>e.lift(new tt(t))}(()=>{if(!n&&!i){const e=`Navigation ID ${t.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(t),this.cancelNavigationTransition(t,e)):this.cancelNavigationTransition(t,e)}this.currentNavigation=null}),k(n=>{if(i=!0,function(t){return t&&t[Et]}(n)){const i=qe(n.url);i||(this.navigated=!0,this.restoreHistory(t,!0));const r=new ht(t.id,this.serializeUrl(t.extractedUrl),n.message);e.next(r),i?setTimeout(()=>{const e=this.urlHandlingStrategy.merge(n.url,this.rawUrlTree),i={skipLocationChange:t.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Bn(t.source)};this.scheduleNavigation(e,"imperative",null,i,{resolve:t.resolve,reject:t.reject,promise:t.promise})},0):t.resolve(!1)}else{this.restoreHistory(t,!0);const i=new dt(t.id,this.serializeUrl(t.extractedUrl),n);e.next(i);try{t.resolve(this.errorHandler(n))}catch(r){t.reject(r)}}return T.E}))}))}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}getTransition(){const t=this.transitions.value;return t.urlAfterRedirects=this.browserUrlTree,t}setTransition(t){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),t))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const e=this.extractLocationChangeInfoFromEvent(t);this.shouldScheduleNavigation(this.lastLocationChangeInfo,e)&&setTimeout(()=>{const{source:t,state:n,urlTree:i}=e,r={replaceUrl:!0};if(n){const t=Object.assign({},n);delete t.navigationId,delete t.\u0275routerPageId,0!==Object.keys(t).length&&(r.state=t)}this.scheduleNavigation(i,t,n,r)},0),this.lastLocationChangeInfo=e}))}extractLocationChangeInfoFromEvent(t){var e;return{source:"popstate"===t.type?"popstate":"hashchange",urlTree:this.parseUrl(t.url),state:(null===(e=t.state)||void 0===e?void 0:e.navigationId)?t.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(t,e){if(!t)return!0;const n=e.urlTree.toString()===t.urlTree.toString();return e.transitionId!==t.transitionId||!n||!("hashchange"===e.source&&"popstate"===t.source||"popstate"===e.source&&"hashchange"===t.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(t){this.events.next(t)}resetConfig(t){Ge(t),this.config=t.map(Je),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,e={}){const{relativeTo:n,queryParams:i,fragment:r,queryParamsHandling:o,preserveFragment:s}=e,a=n||this.routerState.root,l=s?this.currentUrlTree.fragment:r;let c=null;switch(o){case"merge":c=Object.assign(Object.assign({},this.currentUrlTree.queryParams),i);break;case"preserve":c=this.currentUrlTree.queryParams;break;default:c=i||null}return null!==c&&(c=this.removeEmptyProps(c)),function(t,e,n,i,r){if(0===n.length)return Ee(e.root,e.root,e,i,r);const o=function(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new ke(!0,0,t);let e=0,n=!1;const i=t.reduce((t,i,r)=>{if("object"==typeof i&&null!=i){if(i.outlets){const e={};return Rt(i.outlets,(t,n)=>{e[n]="string"==typeof t?t.split("/"):t}),[...t,{outlets:e}]}if(i.segmentPath)return[...t,i.segmentPath]}return"string"!=typeof i?[...t,i]:0===r?(i.split("/").forEach((i,r)=>{0==r&&"."===i||(0==r&&""===i?n=!0:".."===i?e++:""!=i&&t.push(i))}),t):[...t,i]},[]);return new ke(n,e,i)}(n);if(o.toRoot())return Ee(e.root,new Vt([],{}),e,i,r);const s=function(t,e,n){if(t.isAbsolute)return new Pe(e.root,!0,0);if(-1===n.snapshot._lastPathIndex){const t=n.snapshot._urlSegment;return new Pe(t,t===e.root,0)}const i=Ce(t.commands[0])?0:1;return function(t,e,n){let i=t,r=e,o=n;for(;o>r;){if(o-=r,i=i.parent,!i)throw new Error("Invalid number of '../'");r=i.segments.length}return new Pe(i,!1,r-o)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+i,t.numberOfDoubleDots)}(o,e,t),a=s.processChildren?Le(s.segmentGroup,s.index,o.commands):De(s.segmentGroup,s.index,o.commands);return Ee(s.segmentGroup,a,e,i,r)}(a,this.currentUrlTree,t,c,null!=l?l:null)}navigateByUrl(t,e={skipLocationChange:!1}){const n=qe(t)?t:this.parseUrl(t),i=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(i,"imperative",null,e)}navigate(t,e={skipLocationChange:!1}){return function(t){for(let e=0;e<t.length;e++){const n=t[e];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${e}`)}}(t),this.navigateByUrl(this.createUrlTree(t,e),e)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let e;try{e=this.urlSerializer.parse(t)}catch(n){e=this.malformedUriErrorHandler(n,this.urlSerializer,t)}return e}isActive(t,e){let n;if(n=!0===e?Object.assign({},Fn):!1===e?Object.assign({},Un):e,qe(t))return Ut(this.currentUrlTree,t,n);const i=this.parseUrl(t);return Ut(this.currentUrlTree,i,n)}removeEmptyProps(t){return Object.keys(t).reduce((e,n)=>{const i=t[n];return null!=i&&(e[n]=i),e},{})}processNavigations(){this.navigations.subscribe(t=>{this.navigated=!0,this.lastSuccessfulId=t.id,this.currentPageId=t.targetPageId,this.events.next(new ut(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,t.resolve(!0)},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}scheduleNavigation(t,e,n,i,r){var o,s;if(this.disposed)return Promise.resolve(!1);const a=this.getTransition(),l=Bn(e)&&a&&!Bn(a.source),c=(this.lastSuccessfulId===a.id||this.currentNavigation?a.rawUrl:a.urlAfterRedirects).toString()===t.toString();if(l&&c)return Promise.resolve(!0);let u,h,d;r?(u=r.resolve,h=r.reject,d=r.promise):d=new Promise((t,e)=>{u=t,h=e});const p=++this.navigationId;let f;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(n=this.location.getState()),f=n&&n.\u0275routerPageId?n.\u0275routerPageId:i.replaceUrl||i.skipLocationChange?null!==(o=this.browserPageId)&&void 0!==o?o:0:(null!==(s=this.browserPageId)&&void 0!==s?s:0)+1):f=0,this.setTransition({id:p,targetPageId:f,source:e,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:i,resolve:u,reject:h,promise:d,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),d.catch(t=>Promise.reject(t))}setBrowserUrl(t,e){const n=this.urlSerializer.serialize(t),i=Object.assign(Object.assign({},e.extras.state),this.generateNgRouterState(e.id,e.targetPageId));this.location.isCurrentPathEqualTo(n)||e.extras.replaceUrl?this.location.replaceState(n,"",i):this.location.go(n,"",i)}restoreHistory(t,e=!1){var n,i;if("computed"===this.canceledNavigationResolution){const e=this.currentPageId-t.targetPageId;"popstate"!==t.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(n=this.currentNavigation)||void 0===n?void 0:n.finalUrl)||0===e?this.currentUrlTree===(null===(i=this.currentNavigation)||void 0===i?void 0:i.finalUrl)&&0===e&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(e)}else"replace"===this.canceledNavigationResolution&&(e&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(t,e){const n=new ht(t.id,this.serializeUrl(t.extractedUrl),e);this.triggerEvent(n),t.resolve(!1)}generateNgRouterState(t,e){return"computed"===this.canceledNavigationResolution?{navigationId:t,"\u0275routerPageId":e}:{navigationId:t}}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(r.DyG),r.LFG(Yt),r.LFG(Ln),r.LFG(i.Ye),r.LFG(r.zs3),r.LFG(r.v3s),r.LFG(r.Sil),r.LFG(void 0))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})();function Bn(t){return"imperative"!==t}let qn=(()=>{class t{constructor(t,e,n,i,r){this.router=t,this.route=e,this.commands=[],this.onChanges=new S.xQ,null==n&&i.setAttribute(r.nativeElement,"tabindex","0")}ngOnChanges(t){this.onChanges.next(this)}set routerLink(t){this.commands=null!=t?Array.isArray(t)?t:[t]:[]}onClick(){const t={skipLocationChange:$n(this.skipLocationChange),replaceUrl:$n(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,t),!0}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:$n(this.preserveFragment)})}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(Nn),r.Y36(ge),r.$8M("tabindex"),r.Y36(r.Qsj),r.Y36(r.SBq))},t.\u0275dir=r.lG2({type:t,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(t,e){1&t&&r.NdJ("click",function(){return e.onClick()})},inputs:{routerLink:"routerLink",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[r.TTD]}),t})();function $n(t){return""===t||!!t}let Vn=(()=>{class t{constructor(t,e,n,i,o){this.parentContexts=t,this.location=e,this.resolver=n,this.changeDetector=o,this.activated=null,this._activatedRoute=null,this.activateEvents=new r.vpe,this.deactivateEvents=new r.vpe,this.name=i||St,t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,t}attach(t,e){this.activated=t,this._activatedRoute=e,this.location.insert(t.hostView)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,e){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;const n=(e=e||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),i=this.parentContexts.getOrCreateContext(this.name).children,r=new jn(t,i,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,r),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(Ln),r.Y36(r.s_b),r.Y36(r._Vd),r.$8M("name"),r.Y36(r.sBO))},t.\u0275dir=r.lG2({type:t,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),t})();class jn{constructor(t,e,n){this.route=t,this.childContexts=e,this.parent=n}get(t,e){return t===ge?this.route:t===Ln?this.childContexts:this.parent.get(t,e)}}class Gn{}class Yn{preload(t,e){return(0,v.of)(null)}}let Hn=(()=>{class t{constructor(t,e,n,i,r){this.router=t,this.injector=i,this.preloadingStrategy=r,this.loader=new Pn(e,n,e=>t.triggerEvent(new _t(e)),e=>t.triggerEvent(new vt(e)))}setUpPreloading(){this.subscription=this.router.events.pipe((0,L.h)(t=>t instanceof ut),(0,rt.b)(()=>this.preload())).subscribe(()=>{})}preload(){const t=this.injector.get(r.h0i);return this.processRoutes(t,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,e){const n=[];for(const i of e)if(i.loadChildren&&!i.canLoad&&i._loadedConfig){const t=i._loadedConfig;n.push(this.processRoutes(t.module,t.routes))}else i.loadChildren&&!i.canLoad?n.push(this.preloadConfig(t,i)):i.children&&n.push(this.processRoutes(t,i.children));return(0,_.D)(n).pipe((0,at.J)(),(0,nt.U)(t=>{}))}preloadConfig(t,e){return this.preloadingStrategy.preload(e,()=>(e._loadedConfig?(0,v.of)(e._loadedConfig):this.loader.load(t.injector,e)).pipe((0,ot.zg)(t=>(e._loadedConfig=t,this.processRoutes(t.module,t.routes)))))}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(Nn),r.LFG(r.v3s),r.LFG(r.Sil),r.LFG(r.zs3),r.LFG(Gn))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})(),Jn=(()=>{class t{constructor(t,e,n={}){this.router=t,this.viewportScroller=e,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(t=>{t instanceof ct?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof ut&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.router.parseUrl(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(t=>{t instanceof At&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,e){this.router.triggerEvent(new At(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,e))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(Nn),r.LFG(i.EM),r.LFG(void 0))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})();const Wn=new r.OlP("ROUTER_CONFIGURATION"),Xn=new r.OlP("ROUTER_FORROOT_GUARD"),Qn=[i.Ye,{provide:Yt,useClass:Ht},{provide:Nn,useFactory:function(t,e,n,i,r,o,s,a={},l,c){const u=new Nn(null,t,e,n,i,r,o,Lt(s));return l&&(u.urlHandlingStrategy=l),c&&(u.routeReuseStrategy=c),function(t,e){t.errorHandler&&(e.errorHandler=t.errorHandler),t.malformedUriErrorHandler&&(e.malformedUriErrorHandler=t.malformedUriErrorHandler),t.onSameUrlNavigation&&(e.onSameUrlNavigation=t.onSameUrlNavigation),t.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=t.paramsInheritanceStrategy),t.relativeLinkResolution&&(e.relativeLinkResolution=t.relativeLinkResolution),t.urlUpdateStrategy&&(e.urlUpdateStrategy=t.urlUpdateStrategy)}(a,u),a.enableTracing&&u.events.subscribe(t=>{var e,n;null===(e=console.group)||void 0===e||e.call(console,`Router Event: ${t.constructor.name}`),console.log(t.toString()),console.log(t),null===(n=console.groupEnd)||void 0===n||n.call(console)}),u},deps:[Yt,Ln,i.Ye,r.zs3,r.v3s,r.Sil,kn,Wn,[class{},new r.FiY],[En,new r.FiY]]},Ln,{provide:ge,useFactory:function(t){return t.routerState.root},deps:[Nn]},{provide:r.v3s,useClass:r.EAV},Hn,Yn,class{preload(t,e){return e().pipe(k(()=>(0,v.of)(null)))}},{provide:Wn,useValue:{enableTracing:!1}}];function Kn(){return new r.PXZ("Router",Nn)}let ti=(()=>{class t{constructor(t,e){}static forRoot(e,n){return{ngModule:t,providers:[Qn,ri(e),{provide:Xn,useFactory:ii,deps:[[Nn,new r.FiY,new r.tp0]]},{provide:Wn,useValue:n||{}},{provide:i.S$,useFactory:ni,deps:[i.lw,[new r.tBr(i.mr),new r.FiY],Wn]},{provide:Jn,useFactory:ei,deps:[Nn,i.EM,Wn]},{provide:Gn,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:Yn},{provide:r.PXZ,multi:!0,useFactory:Kn},[oi,{provide:r.ip1,multi:!0,useFactory:si,deps:[oi]},{provide:li,useFactory:ai,deps:[oi]},{provide:r.tb,multi:!0,useExisting:li}]]}}static forChild(e){return{ngModule:t,providers:[ri(e)]}}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(Xn,8),r.LFG(Nn,8))},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({}),t})();function ei(t,e,n){return n.scrollOffset&&e.setOffset(n.scrollOffset),new Jn(t,e,n)}function ni(t,e,n={}){return n.useHash?new i.Do(t,e):new i.b0(t,e)}function ii(t){return"guarded"}function ri(t){return[{provide:r.deG,multi:!0,useValue:t},{provide:kn,multi:!0,useValue:t}]}let oi=(()=>{class t{constructor(t){this.injector=t,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new S.xQ}appInitializer(){return this.injector.get(i.V_,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let t=null;const e=new Promise(e=>t=e),n=this.injector.get(Nn),i=this.injector.get(Wn);return"disabled"===i.initialNavigation?(n.setUpLocationChangeListener(),t(!0)):"enabled"===i.initialNavigation||"enabledBlocking"===i.initialNavigation?(n.hooks.afterPreactivation=()=>this.initNavigation?(0,v.of)(null):(this.initNavigation=!0,t(!0),this.resultOfPreactivationDone),n.initialNavigation()):t(!0),e})}bootstrapListener(t){const e=this.injector.get(Wn),n=this.injector.get(Hn),i=this.injector.get(Jn),o=this.injector.get(Nn),s=this.injector.get(r.z2F);t===s.components[0]&&(("enabledNonBlocking"===e.initialNavigation||void 0===e.initialNavigation)&&o.initialNavigation(),n.setUpPreloading(),i.init(),o.resetRootComponentType(s.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(r.zs3))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})();function si(t){return t.appInitializer.bind(t)}function ai(t){return t.bootstrapListener.bind(t)}const li=new r.OlP("Router Initializer")},6686:function(t,e,n){"use strict";n.d(e,{N0:function(){return c},Ar:function(){return h}});var i=n(639),r=n(8583),o=n(9773),s=n(4402),a=n(1841);const l=new i.OlP("JWT_OPTIONS");let c=(()=>{class t{constructor(t=null){this.tokenGetter=t&&t.tokenGetter||function(){}}urlBase64Decode(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(e)}b64decode(t){let e="";if((t=String(t).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let n,i,r=0,o=0;i=t.charAt(o++);~i&&(n=r%4?64*n+i:i,r++%4)?e+=String.fromCharCode(255&n>>(-2*r&6)):0)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return e}b64DecodeUnicode(t){return decodeURIComponent(Array.prototype.map.call(this.b64decode(t),t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(t=this.tokenGetter()){if(!t||""===t)return null;const e=t.split(".");if(3!==e.length)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");const n=this.urlBase64Decode(e[1]);if(!n)throw new Error("Cannot decode the token.");return JSON.parse(n)}getTokenExpirationDate(t=this.tokenGetter()){let e;if(e=this.decodeToken(t),!e||!e.hasOwnProperty("exp"))return null;const n=new Date(0);return n.setUTCSeconds(e.exp),n}isTokenExpired(t=this.tokenGetter(),e){if(!t||""===t)return!0;const n=this.getTokenExpirationDate(t);return e=e||0,null!==n&&!(n.valueOf()>(new Date).valueOf()+1e3*e)}getAuthScheme(t,e){return"function"==typeof t?t(e):t}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(l))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac}),t})(),u=(()=>{class t{constructor(t,e,n){this.jwtHelper=e,this.document=n,this.standardPorts=["80","443"],this.tokenGetter=t.tokenGetter,this.headerName=t.headerName||"Authorization",this.authScheme=t.authScheme||""===t.authScheme?t.authScheme:"Bearer ",this.allowedDomains=t.allowedDomains||[],this.disallowedRoutes=t.disallowedRoutes||[],this.throwNoTokenError=t.throwNoTokenError||!1,this.skipWhenExpired=t.skipWhenExpired}isAllowedDomain(t){const e=new URL(t.url,this.document.location.origin);if(e.host===this.document.location.host)return!0;const n=`${e.hostname}${e.port&&!this.standardPorts.includes(e.port)?":"+e.port:""}`;return this.allowedDomains.findIndex(t=>"string"==typeof t?t===n:t instanceof RegExp&&t.test(n))>-1}isDisallowedRoute(t){const e=new URL(t.url,this.document.location.origin);return this.disallowedRoutes.findIndex(n=>{if("string"==typeof n){const t=new URL(n,this.document.location.origin);return t.hostname===e.hostname&&t.pathname===e.pathname}return n instanceof RegExp&&n.test(t.url)})>-1}handleInterception(t,e,n){const i=this.jwtHelper.getAuthScheme(this.authScheme,e);let r=!1;if(!t&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");return this.skipWhenExpired&&(r=!t||this.jwtHelper.isTokenExpired(t)),t&&r&&this.skipWhenExpired?e=e.clone():t&&(e=e.clone({setHeaders:{[this.headerName]:`${i}${t}`}})),n.handle(e)}intercept(t,e){if(!this.isAllowedDomain(t)||this.isDisallowedRoute(t))return e.handle(t);const n=this.tokenGetter(t);return n instanceof Promise?(0,s.D)(n).pipe((0,o.zg)(n=>this.handleInterception(n,t,e))):this.handleInterception(n,t,e)}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(l),i.LFG(c),i.LFG(r.K0))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac}),t})(),h=(()=>{class t{constructor(t){if(t)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(e){return{ngModule:t,providers:[{provide:a.TP,useClass:u,multi:!0},e.jwtOptionsProvider||{provide:l,useValue:e.config},c]}}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(t,12))},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({}),t})()},8384:function(t,e,n){"use strict";n.d(e,{Uw:function(){return c},fo:function(){return l}});var i=n(8239);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global&&global;var r=(()=>{return(t=r||(r={})).Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE",r;var t})();class o extends Error{constructor(t,e){super(t),this.message=t,this.code=e}}const s=t=>{var e,n,s,a,l;const c=t.CapacitorCustomPlatform||null,u=t.Capacitor||{},h=u.Plugins=u.Plugins||{},d=t.CapacitorPlatforms,p=(null===(e=null==d?void 0:d.currentPlatform)||void 0===e?void 0:e.getPlatform)||(()=>null!==c?c.name:(t=>{var e,n;return(null==t?void 0:t.androidBridge)?"android":(null===(n=null===(e=null==t?void 0:t.webkit)||void 0===e?void 0:e.messageHandlers)||void 0===n?void 0:n.bridge)?"ios":"web"})(t)),f=(null===(n=null==d?void 0:d.currentPlatform)||void 0===n?void 0:n.isNativePlatform)||(()=>"web"!==p()),m=(null===(s=null==d?void 0:d.currentPlatform)||void 0===s?void 0:s.isPluginAvailable)||(t=>{const e=y.get(t);return!(!(null==e?void 0:e.platforms.has(p()))&&!g(t))}),g=(null===(a=null==d?void 0:d.currentPlatform)||void 0===a?void 0:a.getPluginHeader)||(t=>{var e;return null===(e=u.PluginHeaders)||void 0===e?void 0:e.find(e=>e.name===t)}),y=new Map,_=(null===(l=null==d?void 0:d.currentPlatform)||void 0===l?void 0:l.registerPlugin)||((t,e={})=>{const n=y.get(t);if(n)return console.warn(`Capacitor plugin "${t}" already registered. Cannot register plugins twice.`),n.proxy;const s=p(),a=g(t);let l;const d=function(){var t=(0,i.Z)(function*(){return!l&&s in e?l=l="function"==typeof e[s]?yield e[s]():e[s]:null!==c&&!l&&"web"in e&&(l=l="function"==typeof e.web?yield e.web():e.web),l});return function(){return t.apply(this,arguments)}}(),f=e=>{let n;const l=(...l)=>{const c=d().then(i=>{const c=((e,n)=>{var i,l;if(!a){if(e)return null===(l=e[n])||void 0===l?void 0:l.bind(e);throw new o(`"${t}" plugin is not implemented on ${s}`,r.Unimplemented)}{const r=null==a?void 0:a.methods.find(t=>n===t.name);if(r)return"promise"===r.rtype?e=>u.nativePromise(t,n.toString(),e):(e,i)=>u.nativeCallback(t,n.toString(),e,i);if(e)return null===(i=e[n])||void 0===i?void 0:i.bind(e)}})(i,e);if(c){const t=c(...l);return n=null==t?void 0:t.remove,t}throw new o(`"${t}.${e}()" is not implemented on ${s}`,r.Unimplemented)});return"addListener"===e&&(c.remove=(0,i.Z)(function*(){return n()})),c};return l.toString=()=>`${e.toString()}() { [capacitor code] }`,Object.defineProperty(l,"name",{value:e,writable:!1,configurable:!1}),l},m=f("addListener"),_=f("removeListener"),v=(t,e)=>{const n=m({eventName:t},e),r=function(){var r=(0,i.Z)(function*(){const i=yield n;_({eventName:t,callbackId:i},e)});return function(){return r.apply(this,arguments)}}(),o=new Promise(t=>n.then(()=>t({remove:r})));return o.remove=(0,i.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield r()}),o},x=new Proxy({},{get(t,e){switch(e){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return a?v:m;case"removeListener":return _;default:return f(e)}}});return h[t]=x,y.set(t,{name:t,proxy:x,platforms:new Set([...Object.keys(e),...a?[s]:[]])}),x});return u.convertFileSrc||(u.convertFileSrc=t=>t),u.getPlatform=p,u.handleError=e=>t.console.error(e),u.isNativePlatform=f,u.isPluginAvailable=m,u.pluginMethodNoop=(t,e,n)=>Promise.reject(`${n} does not have an implementation of "${e}".`),u.registerPlugin=_,u.Exception=o,u.DEBUG=!!u.DEBUG,u.isLoggingEnabled=!!u.isLoggingEnabled,u.platform=u.getPlatform(),u.isNative=u.isNativePlatform(),u},a=(t=>t.Capacitor=s(t))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),l=a.registerPlugin;class c{constructor(t){this.listeners={},this.windowListeners={},t&&(console.warn(`Capacitor WebPlugin "${t.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=t)}addListener(t,e){var n=this;this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e);const r=this.windowListeners[t];r&&!r.registered&&this.addWindowListener(r);const o=function(){var r=(0,i.Z)(function*(){return n.removeListener(t,e)});return function(){return r.apply(this,arguments)}}(),s=Promise.resolve({remove:o});return Object.defineProperty(s,"remove",{value:(a=(0,i.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield o()}),function(){return a.apply(this,arguments)})}),s;var a}removeAllListeners(){var t=this;return(0,i.Z)(function*(){t.listeners={};for(const e in t.windowListeners)t.removeWindowListener(t.windowListeners[e]);t.windowListeners={}})()}notifyListeners(t,e){const n=this.listeners[t];n&&n.forEach(t=>t(e))}hasListeners(t){return!!this.listeners[t].length}registerWindowListener(t,e){this.windowListeners[e]={registered:!1,windowEventName:t,pluginEventName:e,handler:t=>{this.notifyListeners(e,t)}}}unimplemented(t="not implemented"){return new a.Exception(t,r.Unimplemented)}unavailable(t="not available"){return new a.Exception(t,r.Unavailable)}removeListener(t,e){var n=this;return(0,i.Z)(function*(){const i=n.listeners[t];if(!i)return;const r=i.indexOf(e);n.listeners[t].splice(r,1),n.listeners[t].length||n.removeWindowListener(n.windowListeners[t])})()}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){!t||(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}}},2517:function(t,e,n){"use strict";function i(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s}function r(t,e){return function(n,i){e(n,i,t)}}function o(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{l(i.next(t))}catch(e){o(e)}}function a(t){try{l(i.throw(t))}catch(e){o(e)}}function l(t){t.done?r(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(s,a)}l((i=i.apply(t,e||[])).next())})}n.d(e,{BX:function(){return ge},Br:function(){return ye},w:function(){return z},dr:function(){return nt},BJ:function(){return it},oU:function(){return rt},cs:function(){return pe},yp:function(){return ot},YG:function(){return st},Sm:function(){return at},PM:function(){return lt},FN:function(){return ct},Zi:function(){return ut},wI:function(){return ht},W2:function(){return dt},IJ:function(){return pt},W4:function(){return ft},zq:function(){return mt},fr:function(){return gt},jY:function(){return yt},Gu:function(){return _t},gu:function(){return vt},pK:function(){return xt},Ie:function(){return bt},Q$:function(){return wt},q_:function(){return Tt},yh:function(){return At},z0:function(){return St},fG:function(){return Ct},zc:function(){return It},uN:function(){return Et},I_:function(){return Mt},nJ:function(){return kt},Wo:function(){return Pt},jP:function(){return he},Nd:function(){return Dt},VI:function(){return Lt},cJ:function(){return Ot},GO:function(){return Rt},t9:function(){return zt},n0:function(){return Zt},PQ:function(){return Ft},jI:function(){return Ut},g2:function(){return Nt},Bs:function(){return Bt},wd:function(){return qt},ho:function(){return $t},sr:function(){return Vt},Pc:function(){return Pe},r4:function(){return Ee},HT:function(){return _e},IN:function(){return be},SH:function(){return H},X1:function(){return Ht},as:function(){return F},t4:function(){return j},YI:function(){return fe},QI:function(){return q},j9:function(){return V},yF:function(){return Te}});var s=n(639),a=n(3679),l=n(8583),c=n(8093),u=n(4086),h=(n(9554),n(7405),n(7807)),d=n(9461),p=n(7585),f=n(2377),m=n(4001),g=n(5554),y=n(7053),_=(n(960),n(3150)),v=n(9765),x=n(2759),b=n(6215),w=n(7393);class T{constructor(t,e){this.compare=t,this.keySelector=e}call(t,e){return e.subscribe(new A(t,this.compare,this.keySelector))}}class A extends w.L{constructor(t,e,n){super(t),this.keySelector=n,this.hasKey=!1,"function"==typeof e&&(this.compare=e)}compare(t,e){return t===e}_next(t){let e;try{const{keySelector:n}=this;e=n?n(t):t}catch(i){return this.destination.error(i)}let n=!1;if(this.hasKey)try{const{compare:t}=this;n=t(this.key,e)}catch(i){return this.destination.error(i)}else this.hasKey=!0;n||(this.key=e,this.destination.next(t))}}var S=n(5435),C=n(3190);const I=p.i,E=["*"],M=t=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(t):"function"==typeof requestAnimationFrame?requestAnimationFrame(t):setTimeout(t);let k=(()=>{class t{constructor(t,e){this.injector=t,this.el=e,this.onChange=()=>{},this.onTouched=()=>{}}writeValue(t){this.el.nativeElement.value=this.lastValue=null==t?"":t,P(this.el)}handleChangeEvent(t,e){t===this.el.nativeElement&&(e!==this.lastValue&&(this.lastValue=e,this.onChange(e)),P(this.el))}_handleBlurEvent(t){t===this.el.nativeElement&&(this.onTouched(),P(this.el))}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.el.nativeElement.disabled=t}ngOnDestroy(){this.statusChanges&&this.statusChanges.unsubscribe()}ngAfterViewInit(){let t;try{t=this.injector.get(a.a5)}catch(n){}if(!t)return;t.statusChanges&&(this.statusChanges=t.statusChanges.subscribe(()=>P(this.el)));const e=t.control;e&&["markAsTouched","markAllAsTouched","markAsUntouched","markAsDirty","markAsPristine"].forEach(t=>{if(e[t]){const n=e[t].bind(e);e[t]=(...t)=>{n(...t),P(this.el)}}})}}return t.\u0275fac=function(t){s.$Z()},t.\u0275dir=s.lG2({type:t,hostBindings:function(t,e){1&t&&s.NdJ("ionBlur",function(t){return e._handleBlurEvent(t.target)})}}),i([(0,s.L6J)("ionBlur",["$event.target"])],t.prototype,"_handleBlurEvent",null),t})();const P=t=>{M(()=>{const e=t.nativeElement,n=D(e);L(e,n);const i=e.closest("ion-item");i&&L(i,n)})},D=t=>{const e=t.classList,n=[];for(let i=0;i<e.length;i++){const t=e.item(i);null!==t&&O(t,"ng-")&&n.push(`ion-${t.substr(3)}`)}return n},L=(t,e)=>{const n=t.classList;["ion-valid","ion-invalid","ion-touched","ion-untouched","ion-dirty","ion-pristine"].forEach(t=>n.remove(t)),e.forEach(t=>n.add(t))},O=(t,e)=>t.substr(0,e.length)===e;var R;let z=R=class extends k{constructor(t,e){super(t,e)}writeValue(t){this.el.nativeElement.checked=this.lastValue=null!=t&&t,P(this.el)}_handleIonChange(t){this.handleChangeEvent(t,t.checked)}};var Z;z.\u0275fac=function(t){return new(t||z)(s.Y36(s.zs3),s.Y36(s.SBq))},z.\u0275dir=s.lG2({type:z,selectors:[["ion-checkbox"],["ion-toggle"]],hostBindings:function(t,e){1&t&&s.NdJ("ionChange",function(t){return e._handleIonChange(t.target)})},features:[s._Bn([{provide:a.JU,useExisting:R,multi:!0}]),s.qOj]}),z.ctorParameters=()=>[{type:s.zs3},{type:s.SBq}],i([(0,s.L6J)("ionChange",["$event.target"])],z.prototype,"_handleIonChange",null);let F=Z=class extends k{constructor(t,e){super(t,e)}_handleIonChange(t){this.handleChangeEvent(t,t.value)}registerOnChange(t){super.registerOnChange(e=>{t(""===e?null:parseFloat(e))})}};var U;F.\u0275fac=function(t){return new(t||F)(s.Y36(s.zs3),s.Y36(s.SBq))},F.\u0275dir=s.lG2({type:F,selectors:[["ion-input","type","number"]],hostBindings:function(t,e){1&t&&s.NdJ("ionChange",function(t){return e._handleIonChange(t.target)})},features:[s._Bn([{provide:a.JU,useExisting:Z,multi:!0}]),s.qOj]}),F.ctorParameters=()=>[{type:s.zs3},{type:s.SBq}],i([(0,s.L6J)("ionChange",["$event.target"])],F.prototype,"_handleIonChange",null);let N=U=class extends k{constructor(t,e){super(t,e)}_handleIonSelect(t){this.handleChangeEvent(t,t.checked)}};var B;N.\u0275fac=function(t){return new(t||N)(s.Y36(s.zs3),s.Y36(s.SBq))},N.\u0275dir=s.lG2({type:N,selectors:[["ion-radio"]],hostBindings:function(t,e){1&t&&s.NdJ("ionSelect",function(t){return e._handleIonSelect(t.target)})},features:[s._Bn([{provide:a.JU,useExisting:U,multi:!0}]),s.qOj]}),N.ctorParameters=()=>[{type:s.zs3},{type:s.SBq}],i([(0,s.L6J)("ionSelect",["$event.target"])],N.prototype,"_handleIonSelect",null);let q=B=class extends k{constructor(t,e){super(t,e)}_handleChangeEvent(t){this.handleChangeEvent(t,t.value)}};var $;q.\u0275fac=function(t){return new(t||q)(s.Y36(s.zs3),s.Y36(s.SBq))},q.\u0275dir=s.lG2({type:q,selectors:[["ion-range"],["ion-select"],["ion-radio-group"],["ion-segment"],["ion-datetime"]],hostBindings:function(t,e){1&t&&s.NdJ("ionChange",function(t){return e._handleChangeEvent(t.target)})},features:[s._Bn([{provide:a.JU,useExisting:B,multi:!0}]),s.qOj]}),q.ctorParameters=()=>[{type:s.zs3},{type:s.SBq}],i([(0,s.L6J)("ionChange",["$event.target"])],q.prototype,"_handleChangeEvent",null);let V=$=class extends k{constructor(t,e){super(t,e)}_handleInputEvent(t){this.handleChangeEvent(t,t.value)}};V.\u0275fac=function(t){return new(t||V)(s.Y36(s.zs3),s.Y36(s.SBq))},V.\u0275dir=s.lG2({type:V,selectors:[["ion-input",3,"type","number"],["ion-textarea"],["ion-searchbar"]],hostBindings:function(t,e){1&t&&s.NdJ("ionChange",function(t){return e._handleInputEvent(t.target)})},features:[s._Bn([{provide:a.JU,useExisting:$,multi:!0}]),s.qOj]}),V.ctorParameters=()=>[{type:s.zs3},{type:s.SBq}],i([(0,s.L6J)("ionChange",["$event.target"])],V.prototype,"_handleInputEvent",null);let j=class{constructor(t,e){this.doc=t,this.backButton=new v.xQ,this.keyboardDidShow=new v.xQ,this.keyboardDidHide=new v.xQ,this.pause=new v.xQ,this.resume=new v.xQ,this.resize=new v.xQ,e.run(()=>{let n;this.win=t.defaultView,this.backButton.subscribeWithPriority=function(t,n){return this.subscribe(i=>i.register(t,t=>e.run(()=>n(t))))},Y(this.pause,t,"pause"),Y(this.resume,t,"resume"),Y(this.backButton,t,"ionBackButton"),Y(this.resize,this.win,"resize"),Y(this.keyboardDidShow,this.win,"ionKeyboardDidShow"),Y(this.keyboardDidHide,this.win,"ionKeyboardDidHide"),this._readyPromise=new Promise(t=>{n=t}),this.win&&this.win.cordova?t.addEventListener("deviceready",()=>{n("cordova")},{once:!0}):n("dom")})}is(t){return(0,p.a)(this.win,t)}platforms(){return(0,p.g)(this.win)}ready(){return this._readyPromise}get isRTL(){return"rtl"===this.doc.dir}getQueryParam(t){return G(this.win.location.href,t)}isLandscape(){return!this.isPortrait()}isPortrait(){return this.win.matchMedia&&this.win.matchMedia("(orientation: portrait)").matches}testUserAgent(t){const e=this.win.navigator;return!!(e&&e.userAgent&&e.userAgent.indexOf(t)>=0)}url(){return this.win.location.href}width(){return this.win.innerWidth}height(){return this.win.innerHeight}};j.\u0275fac=function(t){return new(t||j)(s.LFG(l.K0),s.LFG(s.R0b))},j.\u0275prov=s.Yz7({token:j,factory:function(t){return j.\u0275fac(t)},providedIn:"root"}),j.ngInjectableDef=(0,s.Yz7)({factory:function(){return new j((0,s.LFG)(l.K0),(0,s.LFG)(s.R0b))},token:j,providedIn:"root"}),j=i([r(0,(0,s.tBr)(l.K0))],j);const G=(t,e)=>{e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return n?decodeURIComponent(n[1].replace(/\+/g," ")):null},Y=(t,e,n)=>{e&&e.addEventListener(n,e=>{t.next(null!=e?e.detail:void 0)})};let H=class{constructor(t,e,n,i){this.location=e,this.serializer=n,this.router=i,this.direction=W,this.animated=X,this.guessDirection="forward",this.lastNavId=-1,i&&i.events.subscribe(t=>{if(t instanceof c.OD){const e=t.restoredState?t.restoredState.navigationId:t.id;this.guessDirection=e<this.lastNavId?"back":"forward",this.guessAnimation=t.restoredState?void 0:this.guessDirection,this.lastNavId="forward"===this.guessDirection?t.id:e}}),t.backButton.subscribeWithPriority(0,t=>{this.pop(),t()})}navigateForward(t,e={}){return this.setDirection("forward",e.animated,e.animationDirection,e.animation),this.navigate(t,e)}navigateBack(t,e={}){return this.setDirection("back",e.animated,e.animationDirection,e.animation),this.navigate(t,e)}navigateRoot(t,e={}){return this.setDirection("root",e.animated,e.animationDirection,e.animation),this.navigate(t,e)}back(t={animated:!0,animationDirection:"back"}){return this.setDirection("back",t.animated,t.animationDirection,t.animation),this.location.back()}pop(){return o(this,void 0,void 0,function*(){let t=this.topOutlet;for(;t&&!(yield t.pop());)t=t.parentOutlet})}setDirection(t,e,n,i){this.direction=t,this.animated=J(t,e,n),this.animationBuilder=i}setTopOutlet(t){this.topOutlet=t}consumeTransition(){let t,e="root";const n=this.animationBuilder;return"auto"===this.direction?(e=this.guessDirection,t=this.guessAnimation):(t=this.animated,e=this.direction),this.direction=W,this.animated=X,this.animationBuilder=void 0,{direction:e,animation:t,animationBuilder:n}}navigate(t,e){if(Array.isArray(t))return this.router.navigate(t,e);{const n=this.serializer.parse(t.toString());return void 0!==e.queryParams&&(n.queryParams=Object.assign({},e.queryParams)),void 0!==e.fragment&&(n.fragment=e.fragment),this.router.navigateByUrl(n,e)}}};H.\u0275fac=function(t){return new(t||H)(s.LFG(j),s.LFG(l.Ye),s.LFG(c.Hx),s.LFG(c.F0,8))},H.\u0275prov=s.Yz7({token:H,factory:function(t){return H.\u0275fac(t)},providedIn:"root"}),H.ngInjectableDef=(0,s.Yz7)({factory:function(){return new H((0,s.LFG)(j),(0,s.LFG)(l.Ye),(0,s.LFG)(c.Hx),(0,s.LFG)(c.F0,8))},token:H,providedIn:"root"}),H=i([r(3,(0,s.FiY)())],H);const J=(t,e,n)=>{if(!1!==e){if(void 0!==n)return n;if("forward"===t||"back"===t)return t;if("root"===t&&!0===e)return"forward"}},W="auto",X=void 0,Q=(t,e)=>{const n=t.prototype;e.forEach(t=>{Object.defineProperty(n,t,{get(){return this.el[t]},set(e){this.z.runOutsideAngular(()=>this.el[t]=e)}})})},K=(t,e)=>{const n=t.prototype;e.forEach(t=>{n[t]=function(){const e=arguments;return this.z.runOutsideAngular(()=>this.el[t].apply(this.el,e))}})},tt=(t,e,n)=>{n.forEach(n=>t[n]=(0,x.R)(e,n))};function et(t){return function(e){return t.inputs&&Q(e,t.inputs),t.methods&&K(e,t.methods),e}}let nt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-app"]],ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t})(),it=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-avatar"]],ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t})(),rt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-back-button"]],inputs:{color:"color",defaultHref:"defaultHref",disabled:"disabled",icon:"icon",mode:"mode",routerAnimation:"routerAnimation",text:"text",type:"type"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["color","defaultHref","disabled","icon","mode","routerAnimation","text","type"]})],t),t})(),ot=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-badge"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["color","mode"]})],t),t})(),st=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement,tt(this,this.el,["ionFocus","ionBlur"])}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-button"]],inputs:{buttonType:"buttonType",color:"color",disabled:"disabled",download:"download",expand:"expand",fill:"fill",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",size:"size",strong:"strong",target:"target",type:"type"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["buttonType","color","disabled","download","expand","fill","href","mode","rel","routerAnimation","routerDirection","shape","size","strong","target","type"]})],t),t})(),at=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-buttons"]],inputs:{collapse:"collapse"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["collapse"]})],t),t})(),lt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-card"]],inputs:{button:"button",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",target:"target",type:"type"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["button","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","target","type"]})],t),t})(),ct=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-card-content"]],inputs:{mode:"mode"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["mode"]})],t),t})(),ut=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-card-header"]],inputs:{color:"color",mode:"mode",translucent:"translucent"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["color","mode","translucent"]})],t),t})(),ht=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-col"]],inputs:{offset:"offset",offsetLg:"offsetLg",offsetMd:"offsetMd",offsetSm:"offsetSm",offsetXl:"offsetXl",offsetXs:"offsetXs",pull:"pull",pullLg:"pullLg",pullMd:"pullMd",pullSm:"pullSm",pullXl:"pullXl",pullXs:"pullXs",push:"push",pushLg:"pushLg",pushMd:"pushMd",pushSm:"pushSm",pushXl:"pushXl",pushXs:"pushXs",size:"size",sizeLg:"sizeLg",sizeMd:"sizeMd",sizeSm:"sizeSm",sizeXl:"sizeXl",sizeXs:"sizeXs"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["offset","offsetLg","offsetMd","offsetSm","offsetXl","offsetXs","pull","pullLg","pullMd","pullSm","pullXl","pullXs","push","pushLg","pushMd","pushSm","pushXl","pushXs","size","sizeLg","sizeMd","sizeSm","sizeXl","sizeXs"]})],t),t})(),dt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement,tt(this,this.el,["ionScrollStart","ionScroll","ionScrollEnd"])}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-content"]],inputs:{color:"color",forceOverscroll:"forceOverscroll",fullscreen:"fullscreen",scrollEvents:"scrollEvents",scrollX:"scrollX",scrollY:"scrollY"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["color","forceOverscroll","fullscreen","scrollEvents","scrollX","scrollY"],methods:["getScrollElement","scrollToTop","scrollToBottom","scrollByPoint","scrollToPoint"]})],t),t})(),pt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-fab"]],inputs:{activated:"activated",edge:"edge",horizontal:"horizontal",vertical:"vertical"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["activated","edge","horizontal","vertical"],methods:["close"]})],t),t})(),ft=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement,tt(this,this.el,["ionFocus","ionBlur"])}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-fab-button"]],inputs:{activated:"activated",closeIcon:"closeIcon",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",show:"show",size:"size",target:"target",translucent:"translucent",type:"type"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["activated","closeIcon","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","show","size","target","translucent","type"]})],t),t})(),mt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-fab-list"]],inputs:{activated:"activated",side:"side"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["activated","side"]})],t),t})(),gt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-footer"]],inputs:{mode:"mode",translucent:"translucent"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["mode","translucent"]})],t),t})(),yt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-grid"]],inputs:{fixed:"fixed"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["fixed"]})],t),t})(),_t=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-header"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["collapse","mode","translucent"]})],t),t})(),vt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-icon"]],inputs:{ariaHidden:"ariaHidden",ariaLabel:"ariaLabel",color:"color",flipRtl:"flipRtl",icon:"icon",ios:"ios",lazy:"lazy",md:"md",mode:"mode",name:"name",sanitize:"sanitize",size:"size",src:"src"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["ariaHidden","ariaLabel","color","flipRtl","icon","ios","lazy","md","mode","name","sanitize","size","src"]})],t),t})(),xt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement,tt(this,this.el,["ionInput","ionChange","ionBlur","ionFocus"])}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-input"]],inputs:{accept:"accept",autocapitalize:"autocapitalize",autocomplete:"autocomplete",autocorrect:"autocorrect",autofocus:"autofocus",clearInput:"clearInput",clearOnEdit:"clearOnEdit",color:"color",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",max:"max",maxlength:"maxlength",min:"min",minlength:"minlength",mode:"mode",multiple:"multiple",name:"name",pattern:"pattern",placeholder:"placeholder",readonly:"readonly",required:"required",size:"size",spellcheck:"spellcheck",step:"step",type:"type",value:"value"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["accept","autocapitalize","autocomplete","autocorrect","autofocus","clearInput","clearOnEdit","color","debounce","disabled","enterkeyhint","inputmode","max","maxlength","min","minlength","mode","multiple","name","pattern","placeholder","readonly","required","size","spellcheck","step","type","value"],methods:["setFocus","getInputElement"]})],t),t})(),bt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-item"]],inputs:{button:"button",color:"color",detail:"detail",detailIcon:"detailIcon",disabled:"disabled",download:"download",href:"href",lines:"lines",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",target:"target",type:"type"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["button","color","detail","detailIcon","disabled","download","href","lines","mode","rel","routerAnimation","routerDirection","target","type"]})],t),t})(),wt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-label"]],inputs:{color:"color",mode:"mode",position:"position"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["color","mode","position"]})],t),t})(),Tt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-list"]],inputs:{inset:"inset",lines:"lines",mode:"mode"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["inset","lines","mode"],methods:["closeSlidingItems"]})],t),t})(),At=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-list-header"]],inputs:{color:"color",lines:"lines",mode:"mode"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["color","lines","mode"]})],t),t})(),St=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement,tt(this,this.el,["ionWillOpen","ionWillClose","ionDidOpen","ionDidClose"])}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-menu"]],inputs:{contentId:"contentId",disabled:"disabled",maxEdgeStart:"maxEdgeStart",menuId:"menuId",side:"side",swipeGesture:"swipeGesture",type:"type"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["contentId","disabled","maxEdgeStart","menuId","side","swipeGesture","type"],methods:["isOpen","isActive","open","close","toggle","setOpen"]})],t),t})(),Ct=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-menu-button"]],inputs:{autoHide:"autoHide",color:"color",disabled:"disabled",menu:"menu",mode:"mode",type:"type"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["autoHide","color","disabled","menu","mode","type"]})],t),t})(),It=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-menu-toggle"]],inputs:{autoHide:"autoHide",menu:"menu"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["autoHide","menu"]})],t),t})(),Et=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-note"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["color","mode"]})],t),t})(),Mt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement,tt(this,this.el,["ionChange","ionFocus","ionBlur"])}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-range"]],inputs:{color:"color",debounce:"debounce",disabled:"disabled",dualKnobs:"dualKnobs",max:"max",min:"min",mode:"mode",name:"name",pin:"pin",snaps:"snaps",step:"step",ticks:"ticks",value:"value"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["color","debounce","disabled","dualKnobs","max","min","mode","name","pin","snaps","step","ticks","value"]})],t),t})(),kt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement,tt(this,this.el,["ionRefresh","ionPull","ionStart"])}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-refresher"]],inputs:{closeDuration:"closeDuration",disabled:"disabled",pullFactor:"pullFactor",pullMax:"pullMax",pullMin:"pullMin",snapbackDuration:"snapbackDuration"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["closeDuration","disabled","pullFactor","pullMax","pullMin","snapbackDuration"],methods:["complete","cancel","getProgress"]})],t),t})(),Pt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-refresher-content"]],inputs:{pullingIcon:"pullingIcon",pullingText:"pullingText",refreshingSpinner:"refreshingSpinner",refreshingText:"refreshingText"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["pullingIcon","pullingText","refreshingSpinner","refreshingText"]})],t),t})(),Dt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-row"]],ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t})(),Lt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement,tt(this,this.el,["ionInput","ionChange","ionCancel","ionClear","ionBlur","ionFocus"])}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-searchbar"]],inputs:{animated:"animated",autocomplete:"autocomplete",autocorrect:"autocorrect",cancelButtonIcon:"cancelButtonIcon",cancelButtonText:"cancelButtonText",clearIcon:"clearIcon",color:"color",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",mode:"mode",placeholder:"placeholder",searchIcon:"searchIcon",showCancelButton:"showCancelButton",showClearButton:"showClearButton",spellcheck:"spellcheck",type:"type",value:"value"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["animated","autocomplete","autocorrect","cancelButtonIcon","cancelButtonText","clearIcon","color","debounce","disabled","enterkeyhint","inputmode","mode","placeholder","searchIcon","showCancelButton","showClearButton","spellcheck","type","value"],methods:["setFocus","getInputElement"]})],t),t})(),Ot=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement,tt(this,this.el,["ionChange"])}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-segment"]],inputs:{color:"color",disabled:"disabled",mode:"mode",scrollable:"scrollable",swipeGesture:"swipeGesture",value:"value"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["color","disabled","mode","scrollable","swipeGesture","value"]})],t),t})(),Rt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-segment-button"]],inputs:{disabled:"disabled",layout:"layout",mode:"mode",type:"type",value:"value"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["disabled","layout","mode","type","value"]})],t),t})(),zt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement,tt(this,this.el,["ionChange","ionCancel","ionFocus","ionBlur"])}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-select"]],inputs:{cancelText:"cancelText",compareWith:"compareWith",disabled:"disabled",interface:"interface",interfaceOptions:"interfaceOptions",mode:"mode",multiple:"multiple",name:"name",okText:"okText",placeholder:"placeholder",selectedText:"selectedText",value:"value"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["cancelText","compareWith","disabled","interface","interfaceOptions","mode","multiple","name","okText","placeholder","selectedText","value"],methods:["open"]})],t),t})(),Zt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-select-option"]],inputs:{disabled:"disabled",value:"value"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["disabled","value"]})],t),t})(),Ft=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-spinner"]],inputs:{color:"color",duration:"duration",name:"name",paused:"paused"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["color","duration","name","paused"]})],t),t})(),Ut=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement,tt(this,this.el,["ionSplitPaneVisible"])}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-split-pane"]],inputs:{contentId:"contentId",disabled:"disabled",when:"when"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["contentId","disabled","when"]})],t),t})(),Nt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement,tt(this,this.el,["ionChange","ionInput","ionBlur","ionFocus"])}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-textarea"]],inputs:{autoGrow:"autoGrow",autocapitalize:"autocapitalize",autofocus:"autofocus",clearOnEdit:"clearOnEdit",color:"color",cols:"cols",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",maxlength:"maxlength",minlength:"minlength",mode:"mode",name:"name",placeholder:"placeholder",readonly:"readonly",required:"required",rows:"rows",spellcheck:"spellcheck",value:"value",wrap:"wrap"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["autoGrow","autocapitalize","autofocus","clearOnEdit","color","cols","debounce","disabled","enterkeyhint","inputmode","maxlength","minlength","mode","name","placeholder","readonly","required","rows","spellcheck","value","wrap"],methods:["setFocus","getInputElement"]})],t),t})(),Bt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-thumbnail"]],ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t})(),qt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-title"]],inputs:{color:"color",size:"size"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["color","size"]})],t),t})(),$t=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement,tt(this,this.el,["ionChange","ionFocus","ionBlur"])}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-toggle"]],inputs:{checked:"checked",color:"color",disabled:"disabled",mode:"mode",name:"name",value:"value"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["checked","color","disabled","mode","name","value"]})],t),t})(),Vt=(()=>{let t=class{constructor(t,e,n){this.z=n,t.detach(),this.el=e.nativeElement}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.sBO),s.Y36(s.SBq),s.Y36(s.R0b))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ion-toolbar"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:E,decls:1,vars:0,template:function(t,e){1&t&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),t=i([et({inputs:["color","mode"]})],t),t})(),jt=class{get(t,e){const n=Yt();return n?n.get(t,e):null}getBoolean(t,e){const n=Yt();return!!n&&n.getBoolean(t,e)}getNumber(t,e){const n=Yt();return n?n.getNumber(t,e):0}set(t,e){console.warn("[DEPRECATION][Config]: The Config.set() method is deprecated and will be removed in Ionic Framework 6.0. Please see https://ionicframework.com/docs/angular/config for alternatives.");const n=Yt();n&&n.set(t,e)}};jt.\u0275fac=function(t){return new(t||jt)},jt.\u0275prov=s.Yz7({token:jt,factory:function(t){return jt.\u0275fac(t)},providedIn:"root"}),jt.ngInjectableDef=(0,s.Yz7)({factory:function(){return new jt},token:jt,providedIn:"root"});const Gt=new s.OlP("USERCONFIG"),Yt=()=>{if("undefined"!=typeof window){const t=window.Ionic;if(t&&t.config)return t.config}return null};class Ht{constructor(t={}){this.data=t}get(t){return this.data[t]}}let Jt=(()=>{let t=class{constructor(t,e){this.zone=t,this.appRef=e}create(t,e,n){return new Wt(t,e,n,this.appRef,this.zone)}};return t.\u0275fac=function(e){return new(e||t)(s.LFG(s.R0b),s.LFG(s.z2F))},t.\u0275prov=s.Yz7({token:t,factory:function(e){return t.\u0275fac(e)}}),t})();class Wt{constructor(t,e,n,i,r){this.resolver=t,this.injector=e,this.location=n,this.appRef=i,this.zone=r,this.elRefMap=new WeakMap,this.elEventsMap=new WeakMap}attachViewToDom(t,e,n,i){return this.zone.run(()=>new Promise(r=>{r(Xt(this.zone,this.resolver,this.injector,this.location,this.appRef,this.elRefMap,this.elEventsMap,t,e,n,i))}))}removeViewFromDom(t,e){return this.zone.run(()=>new Promise(t=>{const n=this.elRefMap.get(e);if(n){n.destroy(),this.elRefMap.delete(e);const t=this.elEventsMap.get(e);t&&(t(),this.elEventsMap.delete(e))}t()}))}}const Xt=(t,e,n,i,r,o,a,l,c,u,h)=>{const d=e.resolveComponentFactory(c),p=s.zs3.create({providers:ee(u),parent:n}),f=i?i.createComponent(d,i.length,p):d.create(p),m=f.instance,g=f.location.nativeElement;if(u&&Object.assign(m,u),h)for(const s of h)g.classList.add(s);const y=Kt(t,m,g);return l.appendChild(g),i||r.attachView(f.hostView),f.changeDetectorRef.reattach(),o.set(g,f),a.set(g,y),g},Qt=[m.L,m.a,m.b,m.c,m.d],Kt=(t,e,n)=>t.run(()=>{const t=Qt.filter(t=>"function"==typeof e[t]).map(t=>{const i=n=>e[t](n.detail);return n.addEventListener(t,i),()=>n.removeEventListener(t,i)});return()=>t.forEach(t=>t())}),te=new s.OlP("NavParamsToken"),ee=t=>[{provide:te,useValue:t},{provide:Ht,useFactory:ne,deps:[te]}],ne=t=>new Ht(t),ie=(t,e)=>((t=t.filter(t=>t.stackId!==e.stackId)).push(e),t),re=(t,e)=>{const n=t.createUrlTree(["."],{relativeTo:e});return t.serializeUrl(n)},oe=(t,e)=>{if(!t)return;const n=se(e);for(let i=0;i<n.length;i++){if(i>=t.length)return n[i];if(n[i]!==t[i])return}},se=t=>t.split("/").map(t=>t.trim()).filter(t=>""!==t),ae=t=>{t&&(t.ref.destroy(),t.unlistenEvents())};class le{constructor(t,e,n,i,r,o){this.containerEl=e,this.router=n,this.navCtrl=i,this.zone=r,this.location=o,this.views=[],this.skipTransition=!1,this.nextId=0,this.tabsPrefix=void 0!==t?se(t):void 0}createView(t,e){const n=re(this.router,e),i=t&&t.location&&t.location.nativeElement,r=Kt(this.zone,t.instance,i);return{id:this.nextId++,stackId:oe(this.tabsPrefix,n),unlistenEvents:r,element:i,ref:t,url:n}}getExistingView(t){const e=re(this.router,t),n=this.views.find(t=>t.url===e);return n&&n.ref.changeDetectorRef.reattach(),n}setActive(t){const e=this.navCtrl.consumeTransition();let{direction:n,animation:i,animationBuilder:r}=e;const o=this.activeView,s=((t,e)=>!e||t.stackId!==e.stackId)(t,o);s&&(n="back",i=void 0);const a=this.views.slice();let l;const c=this.router;c.getCurrentNavigation?l=c.getCurrentNavigation():c.navigations&&c.navigations.value&&(l=c.navigations.value),l&&l.extras&&l.extras.replaceUrl&&this.views.length>0&&this.views.splice(-1,1);const u=this.views.includes(t),h=this.insertView(t,n);u||t.ref.changeDetectorRef.detectChanges();const d=t.animationBuilder;return void 0===r&&"back"===n&&!s&&void 0!==d&&(r=d),o&&(o.animationBuilder=r),this.zone.runOutsideAngular(()=>this.wait(()=>(o&&o.ref.changeDetectorRef.detach(),t.ref.changeDetectorRef.reattach(),this.transition(t,o,i,this.canGoBack(1),!1,r).then(()=>ce(t,h,a,this.location)).then(()=>({enteringView:t,direction:n,animation:i,tabSwitch:s})))))}canGoBack(t,e=this.getActiveStackId()){return this.getStack(e).length>t}pop(t,e=this.getActiveStackId()){return this.zone.run(()=>{const n=this.getStack(e);if(n.length<=t)return Promise.resolve(!1);const i=n[n.length-t-1];let r=i.url;const o=i.savedData;if(o){const t=o.get("primary");t&&t.route&&t.route._routerState&&t.route._routerState.snapshot&&t.route._routerState.snapshot.url&&(r=t.route._routerState.snapshot.url)}const{animationBuilder:s}=this.navCtrl.consumeTransition();return this.navCtrl.navigateBack(r,Object.assign({},i.savedExtras,{animation:s})).then(()=>!0)})}startBackTransition(){const t=this.activeView;if(t){const e=this.getStack(t.stackId),n=e[e.length-2],i=n.animationBuilder;return this.wait(()=>this.transition(n,t,"back",this.canGoBack(2),!0,i))}return Promise.resolve()}endBackTransition(t){t?(this.skipTransition=!0,this.pop(1)):this.activeView&&ue(this.activeView,this.views,this.views,this.location)}getLastUrl(t){const e=this.getStack(t);return e.length>0?e[e.length-1]:void 0}getRootUrl(t){const e=this.getStack(t);return e.length>0?e[0]:void 0}getActiveStackId(){return this.activeView?this.activeView.stackId:void 0}hasRunningTask(){return void 0!==this.runningTask}destroy(){this.containerEl=void 0,this.views.forEach(ae),this.activeView=void 0,this.views=[]}getStack(t){return this.views.filter(e=>e.stackId===t)}insertView(t,e){return this.activeView=t,this.views=((t,e,n)=>"root"===n?ie(t,e):"forward"===n?((t,e)=>(t.indexOf(e)>=0?t=t.filter(t=>t.stackId!==e.stackId||t.id<=e.id):t.push(e),t))(t,e):((t,e)=>t.indexOf(e)>=0?t.filter(t=>t.stackId!==e.stackId||t.id<=e.id):ie(t,e))(t,e))(this.views,t,e),this.views.slice()}transition(t,e,n,i,r,o){if(this.skipTransition)return this.skipTransition=!1,Promise.resolve(!1);if(e===t)return Promise.resolve(!1);const s=t?t.element:void 0,a=e?e.element:void 0,l=this.containerEl;return s&&s!==a&&(s.classList.add("ion-page"),s.classList.add("ion-page-invisible"),s.parentElement!==l&&l.appendChild(s),l.commit)?l.commit(s,a,{deepWait:!0,duration:void 0===n?0:void 0,direction:n,showGoBack:i,progressAnimation:r,animationBuilder:o}):Promise.resolve(!1)}wait(t){return o(this,void 0,void 0,function*(){void 0!==this.runningTask&&(yield this.runningTask,this.runningTask=void 0);const e=this.runningTask=t();return e.finally(()=>this.runningTask=void 0),e})}}const ce=(t,e,n,i)=>"function"==typeof requestAnimationFrame?new Promise(r=>{requestAnimationFrame(()=>{ue(t,e,n,i),r()})}):Promise.resolve(),ue=(t,e,n,i)=>{n.filter(t=>!e.includes(t)).forEach(ae),e.forEach(e=>{const n=i.path().split("?")[0].split("#")[0];if(e!==t&&e.url!==n){const t=e.element;t.setAttribute("aria-hidden","true"),t.classList.add("ion-page-hidden"),e.ref.changeDetectorRef.detach()}})};let he=(()=>{let t=class{constructor(t,e,n,i,r,o,a,l,u,h,d,p,f){this.parentContexts=t,this.location=e,this.resolver=n,this.config=o,this.navCtrl=a,this.parentOutlet=f,this.activated=null,this.activatedView=null,this._activatedRoute=null,this.proxyMap=new WeakMap,this.currentActivatedRoute$=new b.X(null),this.stackEvents=new s.vpe,this.activateEvents=new s.vpe,this.deactivateEvents=new s.vpe,this.nativeEl=u.nativeElement,this.name=i||c.eC,this.tabsPrefix="true"===r?re(h,p):void 0,this.stackCtrl=new le(this.tabsPrefix,this.nativeEl,h,a,d,l),t.onChildOutletCreated(this.name,this)}set animation(t){this.nativeEl.animation=t}set animated(t){this.nativeEl.animated=t}set swipeGesture(t){this._swipeGesture=t,this.nativeEl.swipeHandler=t?{canStart:()=>this.stackCtrl.canGoBack(1)&&!this.stackCtrl.hasRunningTask(),onStart:()=>this.stackCtrl.startBackTransition(),onEnd:t=>this.stackCtrl.endBackTransition(t)}:void 0}ngOnDestroy(){this.stackCtrl.destroy()}getContext(){return this.parentContexts.getContext(this.name)}ngOnInit(){if(!this.activated){const t=this.getContext();t&&t.route&&this.activateWith(t.route,t.resolver||null)}new Promise(t=>(0,f.c)(this.nativeEl,t)).then(()=>{void 0===this._swipeGesture&&(this.swipeGesture=this.config.getBoolean("swipeBackEnabled","ios"===this.nativeEl.mode))})}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){throw new Error("incompatible reuse strategy")}attach(t,e){throw new Error("incompatible reuse strategy")}deactivate(){if(this.activated){if(this.activatedView){const t=this.getContext();this.activatedView.savedData=new Map(t.children.contexts);const e=this.activatedView.savedData.get("primary");if(e&&t.route&&(e.route=Object.assign({},t.route)),this.activatedView.savedExtras={},t.route){const e=t.route.snapshot;this.activatedView.savedExtras.queryParams=e.queryParams,this.activatedView.savedExtras.fragment=e.fragment}}const t=this.component;this.activatedView=null,this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,e){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;let n,i=this.stackCtrl.getExistingView(t);if(i){n=this.activated=i.ref;const e=i.savedData;e&&(this.getContext().children.contexts=e),this.updateActivatedRouteProxy(n.instance,t)}else{const r=(e=e||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),o=this.parentContexts.getOrCreateContext(this.name).children,s=new b.X(null),a=this.createActivatedRouteProxy(s,t),l=new de(a,o,this.location.injector);n=this.activated=this.location.createComponent(r,this.location.length,l),s.next(n.instance),i=this.stackCtrl.createView(this.activated,t),this.proxyMap.set(n.instance,a),this.currentActivatedRoute$.next({component:n.instance,activatedRoute:t})}this.activatedView=i,this.stackCtrl.setActive(i).then(t=>{this.navCtrl.setTopOutlet(this),this.activateEvents.emit(n.instance),this.stackEvents.emit(t)})}canGoBack(t=1,e){return this.stackCtrl.canGoBack(t,e)}pop(t=1,e){return this.stackCtrl.pop(t,e)}getLastUrl(t){const e=this.stackCtrl.getLastUrl(t);return e?e.url:void 0}getLastRouteView(t){return this.stackCtrl.getLastUrl(t)}getRootView(t){return this.stackCtrl.getRootUrl(t)}getActiveStackId(){return this.stackCtrl.getActiveStackId()}createActivatedRouteProxy(t,e){const n=new c.gz;return n._futureSnapshot=e._futureSnapshot,n._routerState=e._routerState,n.snapshot=e.snapshot,n.outlet=e.outlet,n.component=e.component,n._paramMap=this.proxyObservable(t,"paramMap"),n._queryParamMap=this.proxyObservable(t,"queryParamMap"),n.url=this.proxyObservable(t,"url"),n.params=this.proxyObservable(t,"params"),n.queryParams=this.proxyObservable(t,"queryParams"),n.fragment=this.proxyObservable(t,"fragment"),n.data=this.proxyObservable(t,"data"),n}proxyObservable(t,e){return t.pipe((0,S.h)(t=>!!t),(0,C.w)(t=>this.currentActivatedRoute$.pipe((0,S.h)(e=>null!==e&&e.component===t),(0,C.w)(t=>t&&t.activatedRoute[e]),t=>t.lift(new T(void 0,void 0)))))}updateActivatedRouteProxy(t,e){const n=this.proxyMap.get(t);if(!n)throw new Error("Could not find activated route proxy for view");n._futureSnapshot=e._futureSnapshot,n._routerState=e._routerState,n.snapshot=e.snapshot,n.outlet=e.outlet,n.component=e.component,this.currentActivatedRoute$.next({component:t,activatedRoute:e})}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(c.y6),s.Y36(s.s_b),s.Y36(s._Vd),s.$8M("name"),s.$8M("tabs"),s.Y36(jt),s.Y36(H),s.Y36(l.Ye),s.Y36(s.SBq),s.Y36(c.F0),s.Y36(s.R0b),s.Y36(c.gz),s.Y36(t,12))},t.\u0275dir=s.lG2({type:t,selectors:[["ion-router-outlet"]],inputs:{animated:"animated",animation:"animation",swipeGesture:"swipeGesture"},outputs:{stackEvents:"stackEvents",activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),i([(0,s.r_U)()],t.prototype,"stackEvents",void 0),i([(0,s.r_U)("activate")],t.prototype,"activateEvents",void 0),i([(0,s.r_U)("deactivate")],t.prototype,"deactivateEvents",void 0),t=i([r(3,(0,s.ahi)("name")),r(4,(0,s.FiY)()),r(4,(0,s.ahi)("tabs")),r(12,(0,s.tp0)()),r(12,(0,s.FiY)())],t),t})();class de{constructor(t,e,n){this.route=t,this.childContexts=e,this.parent=n}get(t,e){return t===c.gz?this.route:t===c.y6?this.childContexts:this.parent.get(t,e)}}let pe=(()=>{let t=class{constructor(t,e,n){this.routerOutlet=t,this.navCtrl=e,this.config=n}onClick(t){const e=this.defaultHref||this.config.get("backButtonDefaultHref");this.routerOutlet&&this.routerOutlet.canGoBack()?(this.navCtrl.setDirection("back",void 0,void 0,this.routerAnimation),this.routerOutlet.pop(),t.preventDefault()):null!=e&&(this.navCtrl.navigateBack(e,{animation:this.routerAnimation}),t.preventDefault())}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(he,8),s.Y36(H),s.Y36(jt))},t.\u0275dir=s.lG2({type:t,selectors:[["ion-back-button"]],hostBindings:function(t,e){1&t&&s.NdJ("click",function(t){return e.onClick(t)})},inputs:{defaultHref:"defaultHref",routerAnimation:"routerAnimation"}}),i([(0,s.L6J)("click",["$event"])],t.prototype,"onClick",null),t=i([r(0,(0,s.FiY)())],t),t})(),fe=(()=>{let t=class{constructor(t,e,n,i,r){this.locationStrategy=t,this.navCtrl=e,this.elementRef=n,this.router=i,this.routerLink=r,this.routerDirection="forward"}ngOnInit(){this.updateTargetUrlAndHref()}ngOnChanges(){this.updateTargetUrlAndHref()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}updateTargetUrlAndHref(){if(this.routerLink){const t=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.routerLink.urlTree));this.elementRef.nativeElement.href=t}}onClick(t){this.navCtrl.setDirection(this.routerDirection,void 0,void 0,this.routerAnimation),t.preventDefault()}};return t.\u0275fac=function(e){return new(e||t)(s.Y36(l.S$),s.Y36(H),s.Y36(s.SBq),s.Y36(c.F0),s.Y36(c.rH,8))},t.\u0275dir=s.lG2({type:t,selectors:[["","routerLink",""]],hostBindings:function(t,e){1&t&&s.NdJ("click",function(t){return e.onClick(t)})},inputs:{routerDirection:"routerDirection",routerAnimation:"routerAnimation"},features:[s.TTD]}),i([(0,s.L6J)("click",["$event"])],t.prototype,"onClick",null),t=i([r(4,(0,s.FiY)())],t),t})();class me{constructor(t){this.ctrl=t}create(t){return this.ctrl.create(t||{})}dismiss(t,e,n){return this.ctrl.dismiss(t,e,n)}getTop(){return this.ctrl.getTop()}}let ge=class extends me{constructor(){super(y.b)}};ge.\u0275fac=function(t){return new(t||ge)},ge.\u0275prov=s.Yz7({token:ge,factory:function(t){return ge.\u0275fac(t)},providedIn:"root"}),ge.ngInjectableDef=(0,s.Yz7)({factory:function(){return new ge},token:ge,providedIn:"root"});let ye=class extends me{constructor(){super(y.a)}};ye.\u0275fac=function(t){return new(t||ye)},ye.\u0275prov=s.Yz7({token:ye,factory:function(t){return ye.\u0275fac(t)},providedIn:"root"}),ye.ngInjectableDef=(0,s.Yz7)({factory:function(){return new ye},token:ye,providedIn:"root"});let _e=class extends me{constructor(){super(y.l)}};_e.\u0275fac=function(t){return new(t||_e)},_e.\u0275prov=s.Yz7({token:_e,factory:function(t){return _e.\u0275fac(t)},providedIn:"root"}),_e.ngInjectableDef=(0,s.Yz7)({factory:function(){return new _e},token:_e,providedIn:"root"});let ve=class{open(t){return g.m.open(t)}close(t){return g.m.close(t)}toggle(t){return g.m.toggle(t)}enable(t,e){return g.m.enable(t,e)}swipeGesture(t,e){return g.m.swipeGesture(t,e)}isOpen(t){return g.m.isOpen(t)}isEnabled(t){return g.m.isEnabled(t)}get(t){return g.m.get(t)}getOpen(){return g.m.getOpen()}getMenus(){return g.m.getMenus()}};ve.\u0275fac=function(t){return new(t||ve)},ve.\u0275prov=s.Yz7({token:ve,factory:function(t){return ve.\u0275fac(t)},providedIn:"root"}),ve.ngInjectableDef=(0,s.Yz7)({factory:function(){return new ve},token:ve,providedIn:"root"});let xe=class extends me{constructor(){super(y.p)}};xe.\u0275fac=function(t){return new(t||xe)},xe.\u0275prov=s.Yz7({token:xe,factory:function(t){return xe.\u0275fac(t)},providedIn:"root"}),xe.ngInjectableDef=(0,s.Yz7)({factory:function(){return new xe},token:xe,providedIn:"root"});let be=(()=>{let t=class extends me{constructor(t,e,n){super(y.m),this.angularDelegate=t,this.resolver=e,this.injector=n}create(t){return super.create(Object.assign({},t,{delegate:this.angularDelegate.create(this.resolver,this.injector)}))}};return t.\u0275fac=function(e){return new(e||t)(s.LFG(Jt),s.LFG(s._Vd),s.LFG(s.zs3))},t.\u0275prov=s.Yz7({token:t,factory:function(e){return t.\u0275fac(e)}}),t})(),we=(()=>{let t=class extends me{constructor(t,e,n){super(y.c),this.angularDelegate=t,this.resolver=e,this.injector=n}create(t){return super.create(Object.assign({},t,{delegate:this.angularDelegate.create(this.resolver,this.injector)}))}};return t.\u0275fac=function(e){return new(e||t)(s.LFG(Jt),s.LFG(s._Vd),s.LFG(s.zs3))},t.\u0275prov=s.Yz7({token:t,factory:function(e){return t.\u0275fac(e)}}),t})(),Te=class extends me{constructor(){super(y.t)}};Te.\u0275fac=function(t){return new(t||Te)},Te.\u0275prov=s.Yz7({token:Te,factory:function(t){return Te.\u0275fac(t)},providedIn:"root"}),Te.ngInjectableDef=(0,s.Yz7)({factory:function(){return new Te},token:Te,providedIn:"root"});let Ae=class{read(t){Se().read(t)}write(t){Se().write(t)}};Ae.\u0275fac=function(t){return new(t||Ae)},Ae.\u0275prov=s.Yz7({token:Ae,factory:function(t){return Ae.\u0275fac(t)},providedIn:"root"}),Ae.ngInjectableDef=(0,s.Yz7)({factory:function(){return new Ae},token:Ae,providedIn:"root"});const Se=()=>{const t="undefined"!=typeof window?window:null;if(null!=t){const e=t.Ionic;return e&&e.queue?e.queue:{read:e=>t.requestAnimationFrame(e),write:e=>t.requestAnimationFrame(e)}}return{read:t=>t(),write:t=>t()}};let Ce=class{create(t){return(0,u.c)(t)}easingTime(t,e,n,i,r){return(0,h.g)(t,e,n,i,r)}};Ce.\u0275fac=function(t){return new(t||Ce)},Ce.\u0275prov=s.Yz7({token:Ce,factory:function(t){return Ce.\u0275fac(t)},providedIn:"root"}),Ce.ngInjectableDef=(0,s.Yz7)({factory:function(){return new Ce},token:Ce,providedIn:"root"});let Ie=class{constructor(t){this.zone=t}create(t,e=!1){return e&&Object.getOwnPropertyNames(t).forEach(e=>{if("function"==typeof t[e]){const n=t[e];t[e]=(...t)=>this.zone.run(()=>n(...t))}}),(0,d.createGesture)(t)}};Ie.\u0275fac=function(t){return new(t||Ie)(s.LFG(s.R0b))},Ie.\u0275prov=s.Yz7({token:Ie,factory:function(t){return Ie.\u0275fac(t)},providedIn:"root"}),Ie.ngInjectableDef=(0,s.Yz7)({factory:function(){return new Ie((0,s.LFG)(s.R0b))},token:Ie,providedIn:"root"});class Ee{shouldDetach(t){return!1}shouldAttach(t){return!1}store(t,e){}retrieve(t){return null}shouldReuseRoute(t,e){if(t.routeConfig!==e.routeConfig)return!1;const n=t.params,i=e.params,r=Object.keys(n),o=Object.keys(i);if(r.length!==o.length)return!1;for(const s of r)if(i[s]!==n[s])return!1;return!0}}const Me=(t,e,i)=>()=>{const r=e.defaultView;if(r&&"undefined"!=typeof window){(r.Ionic=r.Ionic||{}).config=Object.assign({},t,{_zoneGate:t=>i.run(t)});const o="__zone_symbol__addEventListener"in e.body?"__zone_symbol__addEventListener":"addEventListener";return function(){var t=[];if("undefined"!=typeof window){var e=window;(!e.customElements||e.Element&&(!e.Element.prototype.closest||!e.Element.prototype.matches||!e.Element.prototype.remove||!e.Element.prototype.getRootNode))&&t.push(n.e(6748).then(n.t.bind(n,5141,23))),("function"!=typeof Object.assign||!Object.entries||!Array.prototype.find||!Array.prototype.includes||!String.prototype.startsWith||!String.prototype.endsWith||e.NodeList&&!e.NodeList.prototype.forEach||!e.fetch||!function(){try{var t=new URL("b","http://a");return t.pathname="c%20d","http://a/c%20d"===t.href&&t.searchParams}catch(e){return!1}}()||"undefined"==typeof WeakMap)&&t.push(n.e(2214).then(n.t.bind(n,7656,23)))}return Promise.all(t)}().then(()=>((t,e)=>"undefined"==typeof window?Promise.resolve():(_.C&&_.C.supports&&_.C.supports("color","var(--c)")?(0,_.a)():n.e(1843).then(n.t.bind(n,5902,23)).then(()=>(_.p.$cssShim$=_.w.__cssshim)?_.p.$cssShim$.i():0)).then(()=>(I(),(0,_.b)(JSON.parse('[["ion-select_3",[[2,"ion-select-popover",{"header":[1],"subHeader":[1,"sub-header"],"message":[1],"options":[16]},[[0,"ionChange","onSelect"]]],[33,"ion-select",{"disabled":[4],"cancelText":[1,"cancel-text"],"okText":[1,"ok-text"],"placeholder":[1],"name":[1],"selectedText":[1,"selected-text"],"multiple":[4],"interface":[1],"interfaceOptions":[8,"interface-options"],"compareWith":[1,"compare-with"],"value":[1032],"isExpanded":[32],"open":[64]}],[1,"ion-select-option",{"disabled":[4],"value":[8]}]]],["ion-menu_3",[[33,"ion-menu-button",{"color":[513],"disabled":[4],"menu":[1],"autoHide":[4,"auto-hide"],"type":[1],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]],[33,"ion-menu",{"contentId":[513,"content-id"],"menuId":[513,"menu-id"],"type":[1025],"disabled":[1028],"side":[513],"swipeGesture":[4,"swipe-gesture"],"maxEdgeStart":[2,"max-edge-start"],"isPaneVisible":[32],"isEndSide":[32],"isOpen":[64],"isActive":[64],"open":[64],"close":[64],"toggle":[64],"setOpen":[64]},[[16,"ionSplitPaneVisible","onSplitPaneChanged"],[2,"click","onBackdropClick"]]],[1,"ion-menu-toggle",{"menu":[1],"autoHide":[4,"auto-hide"],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]]]],["ion-action-sheet",[[34,"ion-action-sheet",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"header":[1],"subHeader":[1,"sub-header"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-fab_3",[[33,"ion-fab-button",{"color":[513],"activated":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1],"show":[4],"translucent":[4],"type":[1],"size":[1],"closeIcon":[1,"close-icon"]}],[1,"ion-fab",{"horizontal":[1],"vertical":[1],"edge":[4],"activated":[1028],"close":[64]}],[1,"ion-fab-list",{"activated":[4],"side":[1]}]]],["ion-refresher_2",[[0,"ion-refresher-content",{"pullingIcon":[1025,"pulling-icon"],"pullingText":[1,"pulling-text"],"refreshingSpinner":[1025,"refreshing-spinner"],"refreshingText":[1,"refreshing-text"]}],[32,"ion-refresher",{"pullMin":[2,"pull-min"],"pullMax":[2,"pull-max"],"closeDuration":[1,"close-duration"],"snapbackDuration":[1,"snapback-duration"],"pullFactor":[2,"pull-factor"],"disabled":[4],"nativeRefresher":[32],"state":[32],"complete":[64],"cancel":[64],"getProgress":[64]}]]],["ion-alert",[[34,"ion-alert",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"header":[1],"subHeader":[1,"sub-header"],"message":[1],"buttons":[16],"inputs":[1040],"backdropDismiss":[4,"backdrop-dismiss"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},[[4,"keydown","onKeydown"]]]]],["ion-back-button",[[33,"ion-back-button",{"color":[513],"defaultHref":[1025,"default-href"],"disabled":[516],"icon":[1],"text":[1],"type":[1],"routerAnimation":[16]}]]],["ion-loading",[[34,"ion-loading",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"message":[1],"cssClass":[1,"css-class"],"duration":[2],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"spinner":[1025],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-toast",[[33,"ion-toast",{"overlayIndex":[2,"overlay-index"],"color":[513],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"duration":[2],"header":[1],"message":[1],"keyboardClose":[4,"keyboard-close"],"position":[1],"buttons":[16],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-card_5",[[33,"ion-card",{"color":[513],"button":[4],"type":[1],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}],[32,"ion-card-content"],[33,"ion-card-header",{"color":[513],"translucent":[4]}],[33,"ion-card-subtitle",{"color":[513]}],[33,"ion-card-title",{"color":[513]}]]],["ion-item-option_3",[[33,"ion-item-option",{"color":[513],"disabled":[4],"download":[1],"expandable":[4],"href":[1],"rel":[1],"target":[1],"type":[1]}],[32,"ion-item-options",{"side":[1],"fireSwipeEvent":[64]}],[0,"ion-item-sliding",{"disabled":[4],"state":[32],"getOpenAmount":[64],"getSlidingRatio":[64],"open":[64],"close":[64],"closeOpened":[64]}]]],["ion-infinite-scroll_2",[[32,"ion-infinite-scroll-content",{"loadingSpinner":[1025,"loading-spinner"],"loadingText":[1,"loading-text"]}],[0,"ion-infinite-scroll",{"threshold":[1],"disabled":[4],"position":[1],"isLoading":[32],"complete":[64]}]]],["ion-reorder_2",[[33,"ion-reorder",null,[[2,"click","onClick"]]],[0,"ion-reorder-group",{"disabled":[4],"state":[32],"complete":[64]}]]],["ion-segment_2",[[33,"ion-segment-button",{"disabled":[4],"layout":[1],"type":[1],"value":[1],"checked":[32]}],[33,"ion-segment",{"color":[513],"disabled":[4],"scrollable":[4],"swipeGesture":[4,"swipe-gesture"],"value":[1025],"activated":[32]}]]],["ion-tab-bar_2",[[33,"ion-tab-button",{"disabled":[4],"download":[1],"href":[1],"rel":[1],"layout":[1025],"selected":[1028],"tab":[1],"target":[1]},[[8,"ionTabBarChanged","onTabBarChanged"]]],[33,"ion-tab-bar",{"color":[513],"selectedTab":[1,"selected-tab"],"translucent":[4],"keyboardVisible":[32]}]]],["ion-chip",[[33,"ion-chip",{"color":[513],"outline":[4],"disabled":[4]}]]],["ion-modal",[[34,"ion-modal",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"component":[1],"componentProps":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"animated":[4],"swipeToClose":[4,"swipe-to-close"],"presentingElement":[16],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-popover",[[34,"ion-popover",{"delegate":[16],"overlayIndex":[2,"overlay-index"],"enterAnimation":[16],"leaveAnimation":[16],"component":[1],"componentProps":[16],"keyboardClose":[4,"keyboard-close"],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"event":[8],"showBackdrop":[4,"show-backdrop"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-searchbar",[[34,"ion-searchbar",{"color":[513],"animated":[4],"autocomplete":[1],"autocorrect":[1],"cancelButtonIcon":[1,"cancel-button-icon"],"cancelButtonText":[1,"cancel-button-text"],"clearIcon":[1,"clear-icon"],"debounce":[2],"disabled":[4],"inputmode":[1],"enterkeyhint":[1],"placeholder":[1],"searchIcon":[1,"search-icon"],"showCancelButton":[1,"show-cancel-button"],"showClearButton":[1,"show-clear-button"],"spellcheck":[4],"type":[1],"value":[1025],"focused":[32],"noAnimate":[32],"setFocus":[64],"getInputElement":[64]}]]],["ion-app_8",[[0,"ion-app"],[34,"ion-buttons",{"collapse":[4]}],[1,"ion-content",{"color":[513],"fullscreen":[4],"forceOverscroll":[1028,"force-overscroll"],"scrollX":[4,"scroll-x"],"scrollY":[4,"scroll-y"],"scrollEvents":[4,"scroll-events"],"getScrollElement":[64],"scrollToTop":[64],"scrollToBottom":[64],"scrollByPoint":[64],"scrollToPoint":[64]},[[8,"appload","onAppLoad"],[2,"click","onClick"]]],[36,"ion-footer",{"translucent":[4]}],[36,"ion-header",{"collapse":[1],"translucent":[4]}],[1,"ion-router-outlet",{"mode":[1025],"delegate":[16],"animated":[4],"animation":[16],"swipeHandler":[16],"commit":[64],"setRouteId":[64],"getRouteId":[64]}],[33,"ion-title",{"color":[513],"size":[1]}],[33,"ion-toolbar",{"color":[513]},[[0,"ionStyle","childrenStyle"]]]]],["ion-route_4",[[0,"ion-route",{"url":[1],"component":[1],"componentProps":[16],"beforeLeave":[16],"beforeEnter":[16]}],[0,"ion-route-redirect",{"from":[1],"to":[1]}],[0,"ion-router",{"root":[1],"useHash":[4,"use-hash"],"canTransition":[64],"push":[64],"back":[64],"printDebug":[64],"navChanged":[64]},[[8,"popstate","onPopState"],[4,"ionBackButton","onBackButton"]]],[1,"ion-router-link",{"color":[513],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}]]],["ion-avatar_3",[[33,"ion-avatar"],[33,"ion-badge",{"color":[513]}],[1,"ion-thumbnail"]]],["ion-col_3",[[1,"ion-col",{"offset":[1],"offsetXs":[1,"offset-xs"],"offsetSm":[1,"offset-sm"],"offsetMd":[1,"offset-md"],"offsetLg":[1,"offset-lg"],"offsetXl":[1,"offset-xl"],"pull":[1],"pullXs":[1,"pull-xs"],"pullSm":[1,"pull-sm"],"pullMd":[1,"pull-md"],"pullLg":[1,"pull-lg"],"pullXl":[1,"pull-xl"],"push":[1],"pushXs":[1,"push-xs"],"pushSm":[1,"push-sm"],"pushMd":[1,"push-md"],"pushLg":[1,"push-lg"],"pushXl":[1,"push-xl"],"size":[1],"sizeXs":[1,"size-xs"],"sizeSm":[1,"size-sm"],"sizeMd":[1,"size-md"],"sizeLg":[1,"size-lg"],"sizeXl":[1,"size-xl"]},[[9,"resize","onResize"]]],[1,"ion-grid",{"fixed":[4]}],[1,"ion-row"]]],["ion-nav_2",[[1,"ion-nav",{"delegate":[16],"swipeGesture":[1028,"swipe-gesture"],"animated":[4],"animation":[16],"rootParams":[16],"root":[1],"push":[64],"insert":[64],"insertPages":[64],"pop":[64],"popTo":[64],"popToRoot":[64],"removeIndex":[64],"setRoot":[64],"setPages":[64],"setRouteId":[64],"getRouteId":[64],"getActive":[64],"getByIndex":[64],"canGoBack":[64],"getPrevious":[64]}],[0,"ion-nav-link",{"component":[1],"componentProps":[16],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}]]],["ion-slide_2",[[0,"ion-slide"],[36,"ion-slides",{"options":[8],"pager":[4],"scrollbar":[4],"update":[64],"updateAutoHeight":[64],"slideTo":[64],"slideNext":[64],"slidePrev":[64],"getActiveIndex":[64],"getPreviousIndex":[64],"length":[64],"isEnd":[64],"isBeginning":[64],"startAutoplay":[64],"stopAutoplay":[64],"lockSwipeToNext":[64],"lockSwipeToPrev":[64],"lockSwipes":[64],"getSwiper":[64]}]]],["ion-tab_2",[[1,"ion-tab",{"active":[1028],"delegate":[16],"tab":[1],"component":[1],"setActive":[64]}],[1,"ion-tabs",{"useRouter":[1028,"use-router"],"selectedTab":[32],"select":[64],"getTab":[64],"getSelected":[64],"setRouteId":[64],"getRouteId":[64]}]]],["ion-checkbox",[[33,"ion-checkbox",{"color":[513],"name":[1],"checked":[1028],"indeterminate":[1028],"disabled":[4],"value":[1]}]]],["ion-img",[[1,"ion-img",{"alt":[1],"src":[1],"loadSrc":[32],"loadError":[32]}]]],["ion-input",[[34,"ion-input",{"fireFocusEvents":[4,"fire-focus-events"],"color":[513],"accept":[1],"autocapitalize":[1],"autocomplete":[1],"autocorrect":[1],"autofocus":[4],"clearInput":[4,"clear-input"],"clearOnEdit":[4,"clear-on-edit"],"debounce":[2],"disabled":[4],"enterkeyhint":[1],"inputmode":[1],"max":[1],"maxlength":[2],"min":[1],"minlength":[2],"multiple":[4],"name":[1],"pattern":[1],"placeholder":[1],"readonly":[4],"required":[4],"spellcheck":[4],"step":[1],"size":[2],"type":[1],"value":[1032],"hasFocus":[32],"setFocus":[64],"setBlur":[64],"getInputElement":[64]}]]],["ion-progress-bar",[[33,"ion-progress-bar",{"type":[1],"reversed":[4],"value":[2],"buffer":[2],"color":[513]}]]],["ion-range",[[33,"ion-range",{"color":[513],"debounce":[2],"name":[1],"dualKnobs":[4,"dual-knobs"],"min":[2],"max":[2],"pin":[4],"snaps":[4],"step":[2],"ticks":[4],"disabled":[4],"value":[1026],"ratioA":[32],"ratioB":[32],"pressedKnob":[32]}]]],["ion-split-pane",[[33,"ion-split-pane",{"contentId":[513,"content-id"],"disabled":[4],"when":[8],"visible":[32]}]]],["ion-text",[[1,"ion-text",{"color":[513]}]]],["ion-textarea",[[34,"ion-textarea",{"fireFocusEvents":[4,"fire-focus-events"],"color":[513],"autocapitalize":[1],"autofocus":[4],"clearOnEdit":[1028,"clear-on-edit"],"debounce":[2],"disabled":[4],"inputmode":[1],"enterkeyhint":[1],"maxlength":[2],"minlength":[2],"name":[1],"placeholder":[1],"readonly":[4],"required":[4],"spellcheck":[4],"cols":[2],"rows":[2],"wrap":[1],"autoGrow":[4,"auto-grow"],"value":[1025],"hasFocus":[32],"setFocus":[64],"setBlur":[64],"getInputElement":[64]}]]],["ion-toggle",[[33,"ion-toggle",{"color":[513],"name":[1],"checked":[1028],"disabled":[4],"value":[1],"activated":[32]}]]],["ion-virtual-scroll",[[0,"ion-virtual-scroll",{"approxItemHeight":[2,"approx-item-height"],"approxHeaderHeight":[2,"approx-header-height"],"approxFooterHeight":[2,"approx-footer-height"],"headerFn":[16],"footerFn":[16],"items":[16],"itemHeight":[16],"headerHeight":[16],"footerHeight":[16],"renderItem":[16],"renderHeader":[16],"renderFooter":[16],"nodeRender":[16],"domRender":[16],"totalHeight":[32],"positionForItem":[64],"checkRange":[64],"checkEnd":[64]},[[9,"resize","onResize"]]]]],["ion-datetime_3",[[34,"ion-picker",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"columns":[16],"cssClass":[1,"css-class"],"duration":[2],"showBackdrop":[4,"show-backdrop"],"backdropDismiss":[4,"backdrop-dismiss"],"animated":[4],"htmlAttributes":[16],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"getColumn":[64]}],[33,"ion-datetime",{"name":[1],"disabled":[4],"readonly":[4],"min":[1025],"max":[1025],"displayFormat":[1,"display-format"],"displayTimezone":[1,"display-timezone"],"pickerFormat":[1,"picker-format"],"cancelText":[1,"cancel-text"],"doneText":[1,"done-text"],"yearValues":[8,"year-values"],"monthValues":[8,"month-values"],"dayValues":[8,"day-values"],"hourValues":[8,"hour-values"],"minuteValues":[8,"minute-values"],"monthNames":[1,"month-names"],"monthShortNames":[1,"month-short-names"],"dayNames":[1,"day-names"],"dayShortNames":[1,"day-short-names"],"pickerOptions":[16],"placeholder":[1],"value":[1025],"isExpanded":[32],"open":[64]}],[32,"ion-picker-column",{"col":[16]}]]],["ion-radio_2",[[33,"ion-radio",{"color":[513],"name":[1],"disabled":[4],"value":[8],"checked":[32],"buttonTabindex":[32],"setFocus":[64],"setButtonTabindex":[64]}],[0,"ion-radio-group",{"allowEmptySelection":[4,"allow-empty-selection"],"name":[1],"value":[1032]},[[4,"keydown","onKeydown"]]]]],["ion-spinner",[[1,"ion-spinner",{"color":[513],"duration":[2],"name":[1],"paused":[4]}]]],["ion-backdrop",[[33,"ion-backdrop",{"visible":[4],"tappable":[4],"stopPropagation":[4,"stop-propagation"]},[[2,"click","onMouseDown"]]]]],["ion-ripple-effect",[[1,"ion-ripple-effect",{"type":[1],"addRipple":[64]}]]],["ion-button_2",[[33,"ion-button",{"color":[513],"buttonType":[1025,"button-type"],"disabled":[516],"expand":[513],"fill":[1537],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"download":[1],"href":[1],"rel":[1],"shape":[513],"size":[513],"strong":[4],"target":[1],"type":[1]}],[1,"ion-icon",{"mode":[1025],"color":[1],"ariaLabel":[1537,"aria-label"],"ariaHidden":[513,"aria-hidden"],"ios":[1],"md":[1],"flipRtl":[4,"flip-rtl"],"name":[513],"src":[1],"icon":[8],"size":[1],"lazy":[4],"sanitize":[4],"svgContent":[32],"isVisible":[32]}]]],["ion-item_8",[[33,"ion-item-divider",{"color":[513],"sticky":[4]}],[32,"ion-item-group"],[33,"ion-note",{"color":[513]}],[1,"ion-skeleton-text",{"animated":[4]}],[49,"ion-item",{"color":[513],"button":[4],"detail":[4],"detailIcon":[1,"detail-icon"],"disabled":[4],"download":[1],"href":[1],"rel":[1],"lines":[1],"routerAnimation":[16],"routerDirection":[1,"router-direction"],"target":[1],"type":[1],"multipleInputs":[32]},[[0,"ionColor","labelColorChanged"],[0,"ionStyle","itemStyle"]]],[34,"ion-label",{"color":[513],"position":[1],"noAnimate":[32]}],[32,"ion-list",{"lines":[1],"inset":[4],"closeSlidingItems":[64]}],[33,"ion-list-header",{"color":[513],"lines":[1]}]]]]'),e))))(0,{exclude:["ion-tabs","ion-tab"],syncQueue:!0,raf:M,jmp:t=>i.runOutsideAngular(t),ael(t,e,n,i){t[o](e,n,i)},rel(t,e,n,i){t.removeEventListener(e,n,i)}}))}};var ke;let Pe=ke=class{static forRoot(t){return{ngModule:ke,providers:[{provide:Gt,useValue:t},{provide:s.ip1,useFactory:Me,multi:!0,deps:[Gt,l.K0,s.R0b]}]}}};Pe.\u0275fac=function(t){return new(t||Pe)},Pe.\u0275mod=s.oAB({type:Pe}),Pe.\u0275inj=s.cJS({providers:[Jt,be,we],imports:[[l.ez]]})},4086:function(t,e,n){"use strict";n.d(e,{c:function(){return h}});var i=n(2377);let r;const o=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),s=t=>{if(void 0===r){const e=void 0!==t.style.webkitAnimationName;r=void 0===t.style.animationName&&e?"-webkit-":""}return r},a=(t,e,n)=>{const i=e.startsWith("animation")?s(t):"";t.style.setProperty(i+e,n)},l=(t,e)=>{const n=e.startsWith("animation")?s(t):"";t.style.removeProperty(n+e)},c=[],u=(t=[],e)=>{if(void 0!==e){const n=Array.isArray(e)?e:[e];return[...t,...n]}return t},h=t=>{let e,n,r,h,d,p,f,m,g,y,_,v,x,b=[],w=[],T=[],A=!1,S={},C=[],I=[],E={},M=0,k=!1,P=!1,D=!0,L=!1,O=!0;const R=t,z=[],Z=[],F=[],U=[],N=[],B=[],q=[],$=[],V=[],j=[],G="function"==typeof AnimationEffect||"function"==typeof window.AnimationEffect,Y="function"==typeof Element&&"function"==typeof Element.prototype.animate&&G,H=(t,e)=>((e&&e.oneTimeCallback?Z:z).push({c:t,o:e}),x),J=()=>{if(Y)j.forEach(t=>{t.cancel()}),j.length=0;else{const t=F.slice();(0,i.r)(()=>{t.forEach(t=>{l(t,"animation-name"),l(t,"animation-duration"),l(t,"animation-timing-function"),l(t,"animation-iteration-count"),l(t,"animation-delay"),l(t,"animation-play-state"),l(t,"animation-fill-mode"),l(t,"animation-direction")})})}},W=()=>{N.forEach(t=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),N.length=0},X=()=>void 0!==d?d:f?f.getFill():"both",Q=()=>void 0!==g?g:void 0!==p?p:f?f.getDirection():"normal",K=()=>k?"linear":void 0!==r?r:f?f.getEasing():"linear",tt=()=>P?0:void 0!==y?y:void 0!==n?n:f?f.getDuration():0,et=()=>void 0!==h?h:f?f.getIterations():1,nt=()=>void 0!==_?_:void 0!==e?e:f?f.getDelay():0,it=()=>{0!==M&&(M--,0===M&&((()=>{ht(),$.forEach(t=>t()),V.forEach(t=>t());const t=D?1:0,e=C,n=I,i=E;F.forEach(t=>{const r=t.classList;e.forEach(t=>r.add(t)),n.forEach(t=>r.remove(t));for(const e in i)i.hasOwnProperty(e)&&a(t,e,i[e])}),z.forEach(e=>e.c(t,x)),Z.forEach(e=>e.c(t,x)),Z.length=0,O=!0,D&&(L=!0),D=!0})(),f&&f.animationFinish()))},rt=(e=!0)=>{(()=>{B.forEach(t=>t()),q.forEach(t=>t());const t=w,e=T,n=S;F.forEach(i=>{const r=i.classList;t.forEach(t=>r.add(t)),e.forEach(t=>r.remove(t));for(const t in n)n.hasOwnProperty(t)&&a(i,t,n[t])})})(),b.length>0&&(Y?(F.forEach(t=>{const e=t.animate(b,{id:R,delay:nt(),duration:tt(),easing:K(),iterations:et(),fill:X(),direction:Q()});e.pause(),j.push(e)}),j.length>0&&(j[0].onfinish=()=>{it()})):((e=!0)=>{W();const n=(t=>(t.forEach(t=>{for(const e in t)if(t.hasOwnProperty(e)){const n=t[e];if("easing"===e)t["animation-timing-function"]=n,delete t[e];else{const i=o(e);i!==e&&(t[i]=n,delete t[e])}}}),t))(b);F.forEach(r=>{if(n.length>0){const o=((t=[])=>t.map(t=>{const e=t.offset,n=[];for(const i in t)t.hasOwnProperty(i)&&"offset"!==i&&n.push(`${i}: ${t[i]};`);return`${100*e}% { ${n.join(" ")} }`}).join(" "))(n);v=void 0!==t?t:(t=>{let e=c.indexOf(t);return e<0&&(e=c.push(t)-1),`ion-animation-${e}`})(o);const l=((t,e,n)=>{const i=(t=>{const e=t.getRootNode();return e.head||e})(n),r=s(n),o=i.querySelector("#"+t);if(o)return o;const a=(n.ownerDocument||document).createElement("style");return a.id=t,a.textContent=`@${r}keyframes ${t} { ${e} } @${r}keyframes ${t}-alt { ${e} }`,i.appendChild(a),a})(v,o,r);N.push(l),a(r,"animation-duration",`${tt()}ms`),a(r,"animation-timing-function",K()),a(r,"animation-delay",`${nt()}ms`),a(r,"animation-fill-mode",X()),a(r,"animation-direction",Q());const u=et()===1/0?"infinite":et().toString();a(r,"animation-iteration-count",u),a(r,"animation-play-state","paused"),e&&a(r,"animation-name",`${l.id}-alt`),(0,i.r)(()=>{a(r,"animation-name",l.id||null)})}})})(e)),A=!0},ot=t=>{if(t=Math.min(Math.max(t,0),.9999),Y)j.forEach(e=>{e.currentTime=e.effect.getComputedTiming().delay+tt()*t,e.pause()});else{const e=`-${tt()*t}ms`;F.forEach(t=>{b.length>0&&(a(t,"animation-delay",e),a(t,"animation-play-state","paused"))})}},st=t=>{j.forEach(t=>{t.effect.updateTiming({delay:nt(),duration:tt(),easing:K(),iterations:et(),fill:X(),direction:Q()})}),void 0!==t&&ot(t)},at=(t=!0,e)=>{(0,i.r)(()=>{F.forEach(n=>{a(n,"animation-name",v||null),a(n,"animation-duration",`${tt()}ms`),a(n,"animation-timing-function",K()),a(n,"animation-delay",void 0!==e?`-${e*tt()}ms`:`${nt()}ms`),a(n,"animation-fill-mode",X()||null),a(n,"animation-direction",Q()||null);const r=et()===1/0?"infinite":et().toString();a(n,"animation-iteration-count",r),t&&a(n,"animation-name",`${v}-alt`),(0,i.r)(()=>{a(n,"animation-name",v||null)})})})},lt=(t=!1,e=!0,n)=>(t&&U.forEach(i=>{i.update(t,e,n)}),Y?st(n):at(e,n),x),ct=()=>{A&&(Y?j.forEach(t=>{t.pause()}):F.forEach(t=>{a(t,"animation-play-state","paused")}))},ut=()=>{m=void 0,it()},ht=()=>{m&&clearTimeout(m)},dt=t=>new Promise(e=>{t&&t.sync&&(P=!0,H(()=>P=!1,{oneTimeCallback:!0})),A||rt(),L&&(Y?(ot(0),st()):at(),L=!1),O&&(M=U.length+1,O=!1),H(()=>e(),{oneTimeCallback:!0}),U.forEach(t=>{t.play()}),Y?(j.forEach(t=>{t.play()}),(0===b.length||0===F.length)&&it()):(()=>{if(ht(),(0,i.r)(()=>{F.forEach(t=>{b.length>0&&a(t,"animation-play-state","running")})}),0===b.length||0===F.length)it();else{const t=nt()||0,e=tt()||0,n=et()||1;isFinite(n)&&(m=setTimeout(ut,t+e*n+100)),((t,e)=>{let n;const r={passive:!0},o=e=>{t===e.target&&(n&&n(),ht(),(0,i.r)(()=>{F.forEach(t=>{l(t,"animation-duration"),l(t,"animation-delay"),l(t,"animation-play-state")}),(0,i.r)(it)}))};t&&(t.addEventListener("webkitAnimationEnd",o,r),t.addEventListener("animationend",o,r),n=()=>{t.removeEventListener("webkitAnimationEnd",o,r),t.removeEventListener("animationend",o,r)})})(F[0])}})()}),pt=(t,e)=>{const n=b[0];return void 0===n||void 0!==n.offset&&0!==n.offset?b=[{offset:0,[t]:e},...b]:n[t]=e,x};return x={parentAnimation:f,elements:F,childAnimations:U,id:R,animationFinish:it,from:pt,to:(t,e)=>{const n=b[b.length-1];return void 0===n||void 0!==n.offset&&1!==n.offset?b=[...b,{offset:1,[t]:e}]:n[t]=e,x},fromTo:(t,e,n)=>pt(t,e).to(t,n),parent:t=>(f=t,x),play:dt,pause:()=>(U.forEach(t=>{t.pause()}),ct(),x),stop:()=>{U.forEach(t=>{t.stop()}),A&&(J(),A=!1),k=!1,P=!1,O=!0,g=void 0,y=void 0,_=void 0,M=0,L=!1,D=!0},destroy:t=>(U.forEach(e=>{e.destroy(t)}),(t=>{J(),t&&W()})(t),F.length=0,U.length=0,b.length=0,z.length=0,Z.length=0,A=!1,O=!0,x),keyframes:t=>(b=t,x),addAnimation:t=>{if(null!=t)if(Array.isArray(t))for(const e of t)e.parent(x),U.push(e);else t.parent(x),U.push(t);return x},addElement:t=>{if(null!=t)if(1===t.nodeType)F.push(t);else if(t.length>=0)for(let e=0;e<t.length;e++)F.push(t[e]);else console.error("Invalid addElement value");return x},update:lt,fill:t=>(d=t,lt(!0),x),direction:t=>(p=t,lt(!0),x),iterations:t=>(h=t,lt(!0),x),duration:t=>(!Y&&0===t&&(t=1),n=t,lt(!0),x),easing:t=>(r=t,lt(!0),x),delay:t=>(e=t,lt(!0),x),getWebAnimations:()=>j,getKeyframes:()=>b,getFill:X,getDirection:Q,getDelay:nt,getIterations:et,getEasing:K,getDuration:tt,afterAddRead:t=>($.push(t),x),afterAddWrite:t=>(V.push(t),x),afterClearStyles:(t=[])=>{for(const e of t)E[e]="";return x},afterStyles:(t={})=>(E=t,x),afterRemoveClass:t=>(I=u(I,t),x),afterAddClass:t=>(C=u(C,t),x),beforeAddRead:t=>(B.push(t),x),beforeAddWrite:t=>(q.push(t),x),beforeClearStyles:(t=[])=>{for(const e of t)S[e]="";return x},beforeStyles:(t={})=>(S=t,x),beforeRemoveClass:t=>(T=u(T,t),x),beforeAddClass:t=>(w=u(w,t),x),onFinish:H,progressStart:(t=!1,e)=>(U.forEach(n=>{n.progressStart(t,e)}),ct(),k=t,A?lt(!1,!0,e):rt(),x),progressStep:t=>(U.forEach(e=>{e.progressStep(t)}),ot(t),x),progressEnd:(t,e,n)=>(k=!1,U.forEach(i=>{i.progressEnd(t,e,n)}),void 0!==n&&(y=n),L=!1,D=!0,0===t?(g="reverse"===Q()?"normal":"reverse","reverse"===g&&(D=!1),Y?(lt(),ot(1-e)):(_=(1-e)*tt()*-1,lt(!1,!1))):1===t&&(Y?(lt(),ot(e)):(_=e*tt()*-1,lt(!1,!1))),void 0!==t&&(H(()=>{y=void 0,g=void 0,_=void 0},{oneTimeCallback:!0}),f||dt()),x)}}},7807:function(t,e,n){"use strict";n.d(e,{g:function(){return i}});const i=(t,e,n,i,s)=>o(t[1],e[1],n[1],i[1],s).map(o=>r(t[0],e[0],n[0],i[0],o)),r=(t,e,n,i,r)=>r*(3*e*Math.pow(r-1,2)+r*(-3*n*r+3*n+i*r))-t*Math.pow(r-1,3),o=(t,e,n,i,r)=>s((i-=r)-3*(n-=r)+3*(e-=r)-(t-=r),3*n-6*e+3*t,3*e-3*t,t).filter(t=>t>=0&&t<=1),s=(t,e,n,i)=>{if(0===t)return((t,e,n)=>{const i=e*e-4*t*n;return i<0?[]:[(-e+Math.sqrt(i))/(2*t),(-e-Math.sqrt(i))/(2*t)]})(e,n,i);const r=(3*(n/=t)-(e/=t)*e)/3,o=(2*e*e*e-9*e*n+27*(i/=t))/27;if(0===r)return[Math.pow(-o,1/3)];if(0===o)return[Math.sqrt(-r),-Math.sqrt(-r)];const s=Math.pow(o/2,2)+Math.pow(r/3,3);if(0===s)return[Math.pow(o/2,.5)-e/3];if(s>0)return[Math.pow(-o/2+Math.sqrt(s),1/3)-Math.pow(o/2+Math.sqrt(s),1/3)-e/3];const a=Math.sqrt(Math.pow(-r/3,3)),l=Math.acos(-o/(2*Math.sqrt(Math.pow(-r/3,3)))),c=2*Math.pow(a,1/3);return[c*Math.cos(l/3)-e/3,c*Math.cos((l+2*Math.PI)/3)-e/3,c*Math.cos((l+4*Math.PI)/3)-e/3]}},960:function(t,e,n){"use strict";n.d(e,{G:function(){return s}});class i{constructor(t,e,n,i,r){this.id=e,this.name=n,this.disableScroll=r,this.priority=1e6*i+e,this.ctrl=t}canStart(){return!!this.ctrl&&this.ctrl.canStart(this.name)}start(){return!!this.ctrl&&this.ctrl.start(this.name,this.id,this.priority)}capture(){if(!this.ctrl)return!1;const t=this.ctrl.capture(this.name,this.id,this.priority);return t&&this.disableScroll&&this.ctrl.disableScroll(this.id),t}release(){this.ctrl&&(this.ctrl.release(this.id),this.disableScroll&&this.ctrl.enableScroll(this.id))}destroy(){this.release(),this.ctrl=void 0}}class r{constructor(t,e,n,i){this.id=e,this.disable=n,this.disableScroll=i,this.ctrl=t}block(){if(this.ctrl){if(this.disable)for(const t of this.disable)this.ctrl.disableGesture(t,this.id);this.disableScroll&&this.ctrl.disableScroll(this.id)}}unblock(){if(this.ctrl){if(this.disable)for(const t of this.disable)this.ctrl.enableGesture(t,this.id);this.disableScroll&&this.ctrl.enableScroll(this.id)}}destroy(){this.unblock(),this.ctrl=void 0}}const o="backdrop-no-scroll",s=new class{constructor(){this.gestureId=0,this.requestedStart=new Map,this.disabledGestures=new Map,this.disabledScroll=new Set}createGesture(t){return new i(this,this.newID(),t.name,t.priority||0,!!t.disableScroll)}createBlocker(t={}){return new r(this,this.newID(),t.disable,!!t.disableScroll)}start(t,e,n){return this.canStart(t)?(this.requestedStart.set(e,n),!0):(this.requestedStart.delete(e),!1)}capture(t,e,n){if(!this.start(t,e,n))return!1;const i=this.requestedStart;let r=-1e4;if(i.forEach(t=>{r=Math.max(r,t)}),r===n){this.capturedId=e,i.clear();const n=new CustomEvent("ionGestureCaptured",{detail:{gestureName:t}});return document.dispatchEvent(n),!0}return i.delete(e),!1}release(t){this.requestedStart.delete(t),this.capturedId===t&&(this.capturedId=void 0)}disableGesture(t,e){let n=this.disabledGestures.get(t);void 0===n&&(n=new Set,this.disabledGestures.set(t,n)),n.add(e)}enableGesture(t,e){const n=this.disabledGestures.get(t);void 0!==n&&n.delete(e)}disableScroll(t){this.disabledScroll.add(t),1===this.disabledScroll.size&&document.body.classList.add(o)}enableScroll(t){this.disabledScroll.delete(t),0===this.disabledScroll.size&&document.body.classList.remove(o)}canStart(t){return!(void 0!==this.capturedId||this.isDisabled(t))}isCaptured(){return void 0!==this.capturedId}isScrollDisabled(){return this.disabledScroll.size>0}isDisabled(t){const e=this.disabledGestures.get(t);return!!(e&&e.size>0)}newID(){return this.gestureId++,this.gestureId}}},3087:function(t,e,n){"use strict";n.r(e),n.d(e,{MENU_BACK_BUTTON_PRIORITY:function(){return a},OVERLAY_BACK_BUTTON_PRIORITY:function(){return s},blockHardwareBackButton:function(){return r},startHardwareBackButton:function(){return o}});var i=n(8239);const r=()=>{document.addEventListener("backbutton",()=>{})},o=()=>{const t=document;let e=!1;t.addEventListener("backbutton",()=>{if(e)return;let n=0,r=[];const o=new CustomEvent("ionBackButton",{bubbles:!1,detail:{register(t,e){r.push({priority:t,handler:e,id:n++})}}});t.dispatchEvent(o);const s=function(){var t=(0,i.Z)(function*(t){try{if(t&&t.handler){const e=t.handler(a);null!=e&&(yield e)}}catch(e){console.error(e)}});return function(e){return t.apply(this,arguments)}}(),a=()=>{if(r.length>0){let t={priority:Number.MIN_SAFE_INTEGER,handler:()=>{},id:-1};r.forEach(e=>{e.priority>=t.priority&&(t=e)}),e=!0,r=r.filter(e=>e.id!==t.id),s(t).then(()=>e=!1)}};a()})},s=100,a=99},2377:function(t,e,n){"use strict";n.d(e,{a:function(){return o},b:function(){return s},c:function(){return i},d:function(){return h},e:function(){return d},f:function(){return _},g:function(){return a},h:function(){return u},i:function(){return r},j:function(){return p},k:function(){return c},l:function(){return f},m:function(){return y},n:function(){return v},o:function(){return m},p:function(){return g},r:function(){return l}});const i=(t,e)=>{t.componentOnReady?t.componentOnReady().then(t=>e(t)):l(()=>e(t))},r=(t,e=[])=>{const n={};return e.forEach(e=>{t.hasAttribute(e)&&(null!==t.getAttribute(e)&&(n[e]=t.getAttribute(e)),t.removeAttribute(e))}),n},o=(t,e,n,i)=>{if("undefined"!=typeof window){const r=window,o=r&&r.Ionic&&r.Ionic.config;if(o){const r=o.get("_ael");if(r)return r(t,e,n,i);if(o._ael)return o._ael(t,e,n,i)}}return t.addEventListener(e,n,i)},s=(t,e,n,i)=>{if("undefined"!=typeof window){const r=window,o=r&&r.Ionic&&r.Ionic.config;if(o){const r=o.get("_rel");if(r)return r(t,e,n,i);if(o._rel)return o._rel(t,e,n,i)}}return t.removeEventListener(e,n,i)},a=(t,e=t)=>t.shadowRoot||e,l=t=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(t):"function"==typeof requestAnimationFrame?requestAnimationFrame(t):setTimeout(t),c=t=>!!t.shadowRoot&&!!t.attachShadow,u=t=>{const e=t.closest("ion-item");return e?e.querySelector("ion-label"):null},h=(t,e)=>{let n;const i=t.getAttribute("aria-labelledby"),r=t.id;let o=null!==i&&""!==i.trim()?i:e+"-lbl",s=null!==i&&""!==i.trim()?document.getElementById(i):u(t);return s?(null===i&&(s.id=o),n=s.textContent,s.setAttribute("aria-hidden","true")):""!==r.trim()&&(s=document.querySelector(`label[for="${r}"]`),s&&(""!==s.id?o=s.id:s.id=o=`${r}-lbl`,n=s.textContent)),{label:s,labelId:o,labelText:n}},d=(t,e,n,i,r)=>{if(t||c(e)){let t=e.querySelector("input.aux-input");t||(t=e.ownerDocument.createElement("input"),t.type="hidden",t.classList.add("aux-input"),e.appendChild(t)),t.disabled=r,t.name=n,t.value=i||""}},p=(t,e,n)=>Math.max(t,Math.min(e,n)),f=(t,e)=>{if(!t){const t="ASSERT: "+e;throw console.error(t),new Error(t)}},m=t=>t.timeStamp||Date.now(),g=t=>{if(t){const e=t.changedTouches;if(e&&e.length>0){const t=e[0];return{x:t.clientX,y:t.clientY}}if(void 0!==t.pageX)return{x:t.pageX,y:t.pageY}}return{x:0,y:0}},y=t=>{const e="rtl"===document.dir;switch(t){case"start":return e;case"end":return!e;default:throw new Error(`"${t}" is not a valid value for [side]. Use "start" or "end" instead.`)}},_=(t,e)=>{const n=t._original||t;return{_original:t,emit:v(n.emit.bind(n),e)}},v=(t,e=0)=>{let n;return(...i)=>{clearTimeout(n),n=setTimeout(t,e,...i)}}},5554:function(t,e,n){"use strict";n.d(e,{m:function(){return d}});var i=n(8239),r=n(3087),o=n(2377),s=n(7585),a=n(4086);const l=t=>(0,a.c)().duration(t?400:300),c=t=>{let e,n;const i=t.width+8,r=(0,a.c)(),o=(0,a.c)();t.isEndSide?(e=i+"px",n="0px"):(e=-i+"px",n="0px"),r.addElement(t.menuInnerEl).fromTo("transform",`translateX(${e})`,`translateX(${n})`);const c="ios"===(0,s.b)(t),u=c?.2:.25;return o.addElement(t.backdropEl).fromTo("opacity",.01,u),l(c).addAnimation([r,o])},u=t=>{let e,n;const i=(0,s.b)(t),r=t.width;t.isEndSide?(e=-r+"px",n=r+"px"):(e=r+"px",n=-r+"px");const o=(0,a.c)().addElement(t.menuInnerEl).fromTo("transform",`translateX(${n})`,"translateX(0px)"),c=(0,a.c)().addElement(t.contentEl).fromTo("transform","translateX(0px)",`translateX(${e})`),u=(0,a.c)().addElement(t.backdropEl).fromTo("opacity",.01,.32);return l("ios"===i).addAnimation([o,c,u])},h=t=>{const e=(0,s.b)(t),n=t.width*(t.isEndSide?-1:1)+"px",i=(0,a.c)().addElement(t.contentEl).fromTo("transform","translateX(0px)",`translateX(${n})`);return l("ios"===e).addAnimation(i)},d=(()=>{const t=new Map,e=[],n=function(){var t=(0,i.Z)(function*(t){const e=yield m(t);return!!e&&e.open()});return function(e){return t.apply(this,arguments)}}(),s=function(){var t=(0,i.Z)(function*(t){const e=yield void 0!==t?m(t):g();return void 0!==e&&e.close()});return function(e){return t.apply(this,arguments)}}(),a=function(){var t=(0,i.Z)(function*(t){const e=yield m(t);return!!e&&e.toggle()});return function(e){return t.apply(this,arguments)}}(),l=function(){var t=(0,i.Z)(function*(t,e){const n=yield m(e);return n&&(n.disabled=!t),n});return function(e,n){return t.apply(this,arguments)}}(),d=function(){var t=(0,i.Z)(function*(t,e){const n=yield m(e);return n&&(n.swipeGesture=t),n});return function(e,n){return t.apply(this,arguments)}}(),p=function(){var t=(0,i.Z)(function*(t){if(null!=t){const e=yield m(t);return void 0!==e&&e.isOpen()}return void 0!==(yield g())});return function(e){return t.apply(this,arguments)}}(),f=function(){var t=(0,i.Z)(function*(t){const e=yield m(t);return!!e&&!e.disabled});return function(e){return t.apply(this,arguments)}}(),m=function(){var t=(0,i.Z)(function*(t){return yield C(),"start"===t||"end"===t?S(e=>e.side===t&&!e.disabled)||S(e=>e.side===t):null!=t?S(e=>e.menuId===t):S(t=>!t.disabled)||(e.length>0?e[0].el:void 0)});return function(e){return t.apply(this,arguments)}}(),g=function(){var t=(0,i.Z)(function*(){return yield C(),w()});return function(){return t.apply(this,arguments)}}(),y=function(){var t=(0,i.Z)(function*(){return yield C(),T()});return function(){return t.apply(this,arguments)}}(),_=function(){var t=(0,i.Z)(function*(){return yield C(),A()});return function(){return t.apply(this,arguments)}}(),v=(e,n)=>{t.set(e,n)},x=t=>{const n=t.side;e.filter(e=>e.side===n&&e!==t).forEach(t=>t.disabled=!0)},b=function(){var t=(0,i.Z)(function*(t,e,n){if(A())return!1;if(e){const e=yield g();e&&t.el!==e&&(yield e.setOpen(!1,!1))}return t._setOpen(e,n)});return function(e,n,i){return t.apply(this,arguments)}}(),w=()=>S(t=>t._isOpen),T=()=>e.map(t=>t.el),A=()=>e.some(t=>t.isAnimating),S=t=>{const n=e.find(t);if(void 0!==n)return n.el},C=()=>Promise.all(Array.from(document.querySelectorAll("ion-menu")).map(t=>new Promise(e=>(0,o.c)(t,e))));return v("reveal",h),v("push",u),v("overlay",c),"undefined"!=typeof document&&document.addEventListener("ionBackButton",t=>{const e=w();e&&t.detail.register(r.MENU_BACK_BUTTON_PRIORITY,()=>e.close())}),{registerAnimation:v,get:m,getMenus:y,getOpen:g,isEnabled:f,swipeGesture:d,isAnimating:_,isOpen:p,enable:l,toggle:a,close:s,open:n,_getOpenSync:w,_createAnimation:(e,n)=>{const i=t.get(e);if(!i)throw new Error("animation not registered");return i(n)},_register:t=>{e.indexOf(t)<0&&(t.disabled||x(t),e.push(t))},_unregister:t=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)},_setOpen:b,_setActiveMenu:x}})()},9461:function(t,e,n){"use strict";n.r(e),n.d(e,{GESTURE_CONTROLLER:function(){return i.G},createGesture:function(){return l}});var i=n(960);const r=(t,e,n,i)=>{const r=o(t)?{capture:!!i.capture,passive:!!i.passive}:!!i.capture;let s,a;return t.__zone_symbol__addEventListener?(s="__zone_symbol__addEventListener",a="__zone_symbol__removeEventListener"):(s="addEventListener",a="removeEventListener"),t[s](e,n,r),()=>{t[a](e,n,r)}},o=t=>{if(void 0===s)try{const e=Object.defineProperty({},"passive",{get:()=>{s=!0}});t.addEventListener("optsTest",()=>{},e)}catch(e){s=!1}return!!s};let s;const a=t=>t instanceof Document?t:t.ownerDocument,l=t=>{let e=!1,n=!1,o=!0,s=!1;const l=Object.assign({disableScroll:!1,direction:"x",gesturePriority:0,passive:!0,maxAngle:40,threshold:10},t),d=l.canStart,p=l.onWillStart,f=l.onStart,m=l.onEnd,g=l.notCaptured,y=l.onMove,_=l.threshold,v=l.passive,x=l.blurOnStart,b={type:"pan",startX:0,startY:0,startTime:0,currentX:0,currentY:0,velocityX:0,velocityY:0,deltaX:0,deltaY:0,currentTime:0,event:void 0,data:void 0},w=((t,e,n)=>{const i=n*(Math.PI/180),r="x"===t,o=Math.cos(i),s=e*e;let a=0,l=0,c=!1,u=0;return{start(t,e){a=t,l=e,u=0,c=!0},detect(t,e){if(!c)return!1;const n=t-a,i=e-l,h=n*n+i*i;if(h<s)return!1;const d=Math.sqrt(h),p=(r?n:i)/d;return u=p>o?1:p<-o?-1:0,c=!1,!0},isGesture:()=>0!==u,getDirection:()=>u}})(l.direction,l.threshold,l.maxAngle),T=i.G.createGesture({name:t.gestureName,priority:t.gesturePriority,disableScroll:t.disableScroll}),A=()=>{!e||(s=!1,y&&y(b))},S=()=>!(T&&!T.capture()||(e=!0,o=!1,b.startX=b.currentX,b.startY=b.currentY,b.startTime=b.currentTime,p?p(b).then(C):C(),0)),C=()=>{x&&(()=>{if("undefined"!=typeof document){const t=document.activeElement;null!==t&&t.blur&&t.blur()}})(),f&&f(b),o=!0},I=()=>{e=!1,n=!1,s=!1,o=!0,T.release()},E=t=>{const n=e,i=o;if(I(),i){if(c(b,t),n)return void(m&&m(b));g&&g(b)}},M=((t,e,n,i,o)=>{let s,l,c,u,h,d,p,f=0;const m=i=>{f=Date.now()+2e3,e(i)&&(!l&&n&&(l=r(t,"touchmove",n,o)),c||(c=r(i.target,"touchend",y,o)),u||(u=r(i.target,"touchcancel",y,o)))},g=i=>{f>Date.now()||!e(i)||(!d&&n&&(d=r(a(t),"mousemove",n,o)),p||(p=r(a(t),"mouseup",_,o)))},y=t=>{v(),i&&i(t)},_=t=>{x(),i&&i(t)},v=()=>{l&&l(),c&&c(),u&&u(),l=c=u=void 0},x=()=>{d&&d(),p&&p(),d=p=void 0},b=()=>{v(),x()},w=(e=!0)=>{e?(s||(s=r(t,"touchstart",m,o)),h||(h=r(t,"mousedown",g,o))):(s&&s(),h&&h(),s=h=void 0,b())};return{enable:w,stop:b,destroy:()=>{w(!1),i=n=e=void 0}}})(l.el,t=>{const e=h(t);return!(n||!o||(u(t,b),b.startX=b.currentX,b.startY=b.currentY,b.startTime=b.currentTime=e,b.velocityX=b.velocityY=b.deltaX=b.deltaY=0,b.event=t,d&&!1===d(b))||(T.release(),!T.start()))&&(n=!0,0===_?S():(w.start(b.startX,b.startY),!0))},t=>{e?!s&&o&&(s=!0,c(b,t),requestAnimationFrame(A)):(c(b,t),w.detect(b.currentX,b.currentY)&&(!w.isGesture()||!S())&&k())},E,{capture:!1,passive:v}),k=()=>{I(),M.stop(),g&&g(b)};return{enable(t=!0){t||(e&&E(void 0),I()),M.enable(t)},destroy(){T.destroy(),M.destroy()}}},c=(t,e)=>{if(!e)return;const n=t.currentX,i=t.currentY,r=t.currentTime;u(e,t);const o=t.currentX,s=t.currentY,a=(t.currentTime=h(e))-r;if(a>0&&a<100){const e=(s-i)/a;t.velocityX=(o-n)/a*.7+.3*t.velocityX,t.velocityY=.7*e+.3*t.velocityY}t.deltaX=o-t.startX,t.deltaY=s-t.startY,t.event=e},u=(t,e)=>{let n=0,i=0;if(t){const e=t.changedTouches;if(e&&e.length>0){const t=e[0];n=t.clientX,i=t.clientY}else void 0!==t.pageX&&(n=t.pageX,i=t.pageY)}e.currentX=n,e.currentY=i},h=t=>t.timeStamp||Date.now()},3150:function(t,e,n){"use strict";n.d(e,{B:function(){return Vt},C:function(){return p},H:function(){return Z},a:function(){return y},b:function(){return At},c:function(){return $t},e:function(){return ot},f:function(){return qt},g:function(){return D},h:function(){return R},i:function(){return rt},j:function(){return pt},k:function(){return St},p:function(){return m},r:function(){return Et},s:function(){return P},w:function(){return d}});var i=n(8239);let r,o,s,a=!1,l=!1,c=!1,u=!1,h=!1;const d="undefined"!=typeof window?window:{},p=d.CSS,f=d.document||{head:{}},m={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,n,i)=>t.addEventListener(e,n,i),rel:(t,e,n,i)=>t.removeEventListener(e,n,i),ce:(t,e)=>new CustomEvent(t,e)},g=(()=>(f.head.attachShadow+"").indexOf("[native")>-1)(),y=t=>Promise.resolve(t),_=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replace}catch(t){}return!1})(),v=(t,e,n,i)=>{n&&n.map(([n,i,r])=>{const o=b(t,n),s=x(e,r),a=w(n);m.ael(o,i,s,a),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>m.rel(o,i,s,a))})},x=(t,e)=>n=>{try{256&t.$flags$?t.$lazyInstance$[e](n):(t.$queuedListeners$=t.$queuedListeners$||[]).push([e,n])}catch(i){Pt(i)}},b=(t,e)=>4&e?f:8&e?d:16&e?f.body:t,w=t=>0!=(2&t),T="s-id",A="sty-id",S="http://www.w3.org/1999/xlink",C=new WeakMap,I=(t,e,n)=>{let i=Ot.get(t);_&&n?(i=i||new CSSStyleSheet,i.replace(e)):i=e,Ot.set(t,i)},E=(t,e,n,i)=>{let r=M(e,n),o=Ot.get(r);if(t=11===t.nodeType?t:f,o)if("string"==typeof o){let n,s=C.get(t=t.head||t);if(s||C.set(t,s=new Set),!s.has(r)){if(t.host&&(n=t.querySelector(`[${A}="${r}"]`)))n.innerHTML=o;else{if(m.$cssShim$){n=m.$cssShim$.createHostStyle(i,r,o,!!(10&e.$flags$));const t=n["s-sc"];t&&(r=t,s=null)}else n=f.createElement("style"),n.innerHTML=o;t.insertBefore(n,t.querySelector("link"))}s&&s.add(r)}}else t.adoptedStyleSheets.includes(o)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,o]);return r},M=(t,e)=>"sc-"+(e&&32&t.$flags$?t.$tagName$+"-"+e:t.$tagName$),k=t=>t.replace(/\/\*!@([^\/]+)\*\/[^\{]+\{/g,"$1{"),P=t=>Rt.push(t),D=t=>It(t).$modeName$,L={},O=t=>"object"==(t=typeof t)||"function"===t,R=(t,e,...n)=>{let i=null,r=null,o=null,s=!1,a=!1,l=[];const c=e=>{for(let n=0;n<e.length;n++)i=e[n],Array.isArray(i)?c(i):null!=i&&"boolean"!=typeof i&&((s="function"!=typeof t&&!O(i))&&(i=String(i)),s&&a?l[l.length-1].$text$+=i:l.push(s?z(null,i):i),a=s)};if(c(n),e){e.key&&(r=e.key),e.name&&(o=e.name);{const t=e.className||e.class;t&&(e.class="object"!=typeof t?t:Object.keys(t).filter(e=>t[e]).join(" "))}}if("function"==typeof t)return t(null===e?{}:e,l,F);const u=z(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=r,u.$name$=o,u},z=(t,e)=>({$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null,$attrs$:null,$key$:null,$name$:null}),Z={},F={forEach:(t,e)=>t.map(U).forEach(e),map:(t,e)=>t.map(U).map(e).map(N)},U=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),N=t=>{if("function"==typeof t.vtag){const e=Object.assign({},t.vattrs);return t.vkey&&(e.key=t.vkey),t.vname&&(e.name=t.vname),R(t.vtag,e,...t.vchildren||[])}const e=z(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},B=(t,e,n,i,r,o)=>{if(n!==i){let a=kt(t,e),l=e.toLowerCase();if("class"===e){const e=t.classList,r=$(n),o=$(i);e.remove(...r.filter(t=>t&&!o.includes(t))),e.add(...o.filter(t=>t&&!r.includes(t)))}else if("style"===e){for(const e in n)(!i||null==i[e])&&(e.includes("-")?t.style.removeProperty(e):t.style[e]="");for(const e in i)(!n||i[e]!==n[e])&&(e.includes("-")?t.style.setProperty(e,i[e]):t.style[e]=i[e])}else if("key"!==e)if("ref"===e)i&&i(t);else if(a||"o"!==e[0]||"n"!==e[1]){const c=O(i);if((a||c&&null!==i)&&!r)try{if(t.tagName.includes("-"))t[e]=i;else{let r=null==i?"":i;"list"===e?a=!1:(null==n||t[e]!=r)&&(t[e]=r)}}catch(s){}let u=!1;l!==(l=l.replace(/^xlink\:?/,""))&&(e=l,u=!0),null==i||!1===i?(!1!==i||""===t.getAttribute(e))&&(u?t.removeAttributeNS(S,e):t.removeAttribute(e)):(!a||4&o||r)&&!c&&(i=!0===i?"":i,u?t.setAttributeNS(S,e,i):t.setAttribute(e,i))}else e="-"===e[2]?e.slice(3):kt(d,l)?l.slice(2):l[2]+e.slice(3),n&&m.rel(t,e,n,!1),i&&m.ael(t,e,i,!1)}},q=/\s/,$=t=>t?t.split(q):[],V=(t,e,n,i)=>{const r=11===e.$elm$.nodeType&&e.$elm$.host?e.$elm$.host:e.$elm$,o=t&&t.$attrs$||L,s=e.$attrs$||L;for(i in o)i in s||B(r,i,o[i],void 0,n,e.$flags$);for(i in s)B(r,i,o[i],s[i],n,e.$flags$)},j=(t,e,n,i)=>{let l,h,d,p=e.$children$[n],m=0;if(a||(c=!0,"slot"===p.$tag$&&(r&&i.classList.add(r+"-s"),p.$flags$|=p.$children$?2:1)),null!==p.$text$)l=p.$elm$=f.createTextNode(p.$text$);else if(1&p.$flags$)l=p.$elm$=f.createTextNode("");else{if(u||(u="svg"===p.$tag$),l=p.$elm$=f.createElementNS(u?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",2&p.$flags$?"slot-fb":p.$tag$),u&&"foreignObject"===p.$tag$&&(u=!1),V(null,p,u),(t=>null!=t)(r)&&l["s-si"]!==r&&l.classList.add(l["s-si"]=r),p.$children$)for(m=0;m<p.$children$.length;++m)h=j(t,p,m,l),h&&l.appendChild(h);"svg"===p.$tag$?u=!1:"foreignObject"===l.tagName&&(u=!0)}return l["s-hn"]=s,3&p.$flags$&&(l["s-sr"]=!0,l["s-cr"]=o,l["s-sn"]=p.$name$||"",d=t&&t.$children$&&t.$children$[n],d&&d.$tag$===p.$tag$&&t.$elm$&&G(t.$elm$,!1)),l},G=(t,e)=>{m.$flags$|=1;const n=t.childNodes;for(let i=n.length-1;i>=0;i--){const t=n[i];t["s-hn"]!==s&&t["s-ol"]&&(X(t).insertBefore(t,W(t)),t["s-ol"].remove(),t["s-ol"]=void 0,c=!0),e&&G(t,e)}m.$flags$&=-2},Y=(t,e,n,i,r,o)=>{let a,l=t["s-cr"]&&t["s-cr"].parentNode||t;for(l.shadowRoot&&l.tagName===s&&(l=l.shadowRoot);r<=o;++r)i[r]&&(a=j(null,n,r,t),a&&(i[r].$elm$=a,l.insertBefore(a,W(e))))},H=(t,e,n,i,r)=>{for(;e<=n;++e)(i=t[e])&&(r=i.$elm$,it(i),l=!0,r["s-ol"]?r["s-ol"].remove():G(r,!0),r.remove())},J=(t,e)=>t.$tag$===e.$tag$&&("slot"===t.$tag$?t.$name$===e.$name$:t.$key$===e.$key$),W=t=>t&&t["s-ol"]||t,X=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,Q=(t,e)=>{const n=e.$elm$=t.$elm$,i=t.$children$,r=e.$children$,o=e.$tag$,s=e.$text$;let a;null===s?(u="svg"===o||"foreignObject"!==o&&u,"slot"===o||V(t,e,u),null!==i&&null!==r?((t,e,n,i)=>{let r,o,s=0,a=0,l=0,c=0,u=e.length-1,h=e[0],d=e[u],p=i.length-1,f=i[0],m=i[p];for(;s<=u&&a<=p;)if(null==h)h=e[++s];else if(null==d)d=e[--u];else if(null==f)f=i[++a];else if(null==m)m=i[--p];else if(J(h,f))Q(h,f),h=e[++s],f=i[++a];else if(J(d,m))Q(d,m),d=e[--u],m=i[--p];else if(J(h,m))("slot"===h.$tag$||"slot"===m.$tag$)&&G(h.$elm$.parentNode,!1),Q(h,m),t.insertBefore(h.$elm$,d.$elm$.nextSibling),h=e[++s],m=i[--p];else if(J(d,f))("slot"===h.$tag$||"slot"===m.$tag$)&&G(d.$elm$.parentNode,!1),Q(d,f),t.insertBefore(d.$elm$,h.$elm$),d=e[--u],f=i[++a];else{for(l=-1,c=s;c<=u;++c)if(e[c]&&null!==e[c].$key$&&e[c].$key$===f.$key$){l=c;break}l>=0?(o=e[l],o.$tag$!==f.$tag$?r=j(e&&e[a],n,l,t):(Q(o,f),e[l]=void 0,r=o.$elm$),f=i[++a]):(r=j(e&&e[a],n,a,t),f=i[++a]),r&&X(h.$elm$).insertBefore(r,W(h.$elm$))}s>u?Y(t,null==i[p+1]?null:i[p+1].$elm$,n,i,a,p):a>p&&H(e,s,u)})(n,i,e,r):null!==r?(null!==t.$text$&&(n.textContent=""),Y(n,null,e,r,0,r.length-1)):null!==i&&H(i,0,i.length-1),u&&"svg"===o&&(u=!1)):(a=n["s-cr"])?a.parentNode.textContent=s:t.$text$!==s&&(n.data=s)},K=t=>{let e,n,i,r,o,s,a=t.childNodes;for(n=0,i=a.length;n<i;n++)if(e=a[n],1===e.nodeType){if(e["s-sr"])for(o=e["s-sn"],e.hidden=!1,r=0;r<i;r++)if(s=a[r].nodeType,a[r]["s-hn"]!==e["s-hn"]||""!==o){if(1===s&&o===a[r].getAttribute("slot")){e.hidden=!0;break}}else if(1===s||3===s&&""!==a[r].textContent.trim()){e.hidden=!0;break}K(e)}},tt=[],et=t=>{let e,n,i,r,o,s,a=0,c=t.childNodes,u=c.length;for(;a<u;a++){if(e=c[a],e["s-sr"]&&(n=e["s-cr"])&&n.parentNode)for(i=n.parentNode.childNodes,r=e["s-sn"],s=i.length-1;s>=0;s--)n=i[s],!n["s-cn"]&&!n["s-nr"]&&n["s-hn"]!==e["s-hn"]&&(nt(n,r)?(o=tt.find(t=>t.$nodeToRelocate$===n),l=!0,n["s-sn"]=n["s-sn"]||r,o?o.$slotRefNode$=e:tt.push({$slotRefNode$:e,$nodeToRelocate$:n}),n["s-sr"]&&tt.map(t=>{nt(t.$nodeToRelocate$,n["s-sn"])&&(o=tt.find(t=>t.$nodeToRelocate$===n),o&&!t.$slotRefNode$&&(t.$slotRefNode$=o.$slotRefNode$))})):tt.some(t=>t.$nodeToRelocate$===n)||tt.push({$nodeToRelocate$:n}));1===e.nodeType&&et(e)}},nt=(t,e)=>1===t.nodeType?null===t.getAttribute("slot")&&""===e||t.getAttribute("slot")===e:t["s-sn"]===e||""===e,it=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(it)},rt=t=>It(t).$hostElement$,ot=(t,e,n)=>{const i=rt(t);return{emit:t=>st(i,e,{bubbles:!!(4&n),composed:!!(2&n),cancelable:!!(1&n),detail:t})}},st=(t,e,n)=>{const i=m.ce(e,n);return t.dispatchEvent(i),i},at=(t,e)=>{e&&!t.$onRenderResolve$&&e["s-p"]&&e["s-p"].push(new Promise(e=>t.$onRenderResolve$=e))},lt=(t,e)=>{if(t.$flags$|=16,!(4&t.$flags$))return at(t,t.$ancestorComponent$),$t(()=>ct(t,e));t.$flags$|=512},ct=(t,e)=>{const n=t.$lazyInstance$;let i;return e&&(t.$flags$|=256,t.$queuedListeners$&&(t.$queuedListeners$.map(([t,e])=>mt(n,t,e)),t.$queuedListeners$=null),i=mt(n,"componentWillLoad")),i=gt(i,()=>mt(n,"componentWillRender")),gt(i,()=>ut(t,n,e))},ut=function(){var t=(0,i.Z)(function*(t,e,n){const i=t.$hostElement$,r=i["s-rc"];n&&(t=>{const e=t.$cmpMeta$,n=t.$hostElement$,i=e.$flags$,r=E(g&&n.shadowRoot?n.shadowRoot:n.getRootNode(),e,t.$modeName$,n);10&i&&(n["s-sc"]=r,n.classList.add(r+"-h"),2&i&&n.classList.add(r+"-s"))})(t);ht(t,e),m.$cssShim$&&m.$cssShim$.updateHost(i),r&&(r.map(t=>t()),i["s-rc"]=void 0);{const e=i["s-p"],n=()=>dt(t);0===e.length?n():(Promise.all(e).then(n),t.$flags$|=4,e.length=0)}});return function(e,n,i){return t.apply(this,arguments)}}(),ht=(t,e,n)=>{try{e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,((t,e)=>{const n=t.$hostElement$,i=t.$cmpMeta$,u=t.$vnode$||z(null,null),h=(t=>t&&t.$tag$===Z)(e)?e:R(null,null,e);if(s=n.tagName,i.$attrsToReflect$&&(h.$attrs$=h.$attrs$||{},i.$attrsToReflect$.map(([t,e])=>h.$attrs$[e]=n[t])),h.$tag$=null,h.$flags$|=4,t.$vnode$=h,h.$elm$=u.$elm$=n.shadowRoot||n,r=n["s-sc"],o=n["s-cr"],a=g&&0!=(1&i.$flags$),l=!1,Q(u,h),m.$flags$|=1,c){et(h.$elm$);let t,e,n,i,r,o,s=0;for(;s<tt.length;s++)t=tt[s],e=t.$nodeToRelocate$,e["s-ol"]||(n=f.createTextNode(""),n["s-nr"]=e,e.parentNode.insertBefore(e["s-ol"]=n,e));for(s=0;s<tt.length;s++)if(t=tt[s],e=t.$nodeToRelocate$,t.$slotRefNode$){for(i=t.$slotRefNode$.parentNode,r=t.$slotRefNode$.nextSibling,n=e["s-ol"];n=n.previousSibling;)if(o=n["s-nr"],o&&o["s-sn"]===e["s-sn"]&&i===o.parentNode&&(o=o.nextSibling,!o||!o["s-nr"])){r=o;break}(!r&&i!==e.parentNode||e.nextSibling!==r)&&e!==r&&(!e["s-hn"]&&e["s-ol"]&&(e["s-hn"]=e["s-ol"].parentNode.nodeName),i.insertBefore(e,r))}else 1===e.nodeType&&(e.hidden=!0)}l&&K(h.$elm$),m.$flags$&=-2,tt.length=0})(t,e)}catch(i){Pt(i,t.$hostElement$)}return null},dt=t=>{const e=t.$hostElement$,n=t.$lazyInstance$,i=t.$ancestorComponent$;64&t.$flags$?mt(n,"componentDidUpdate"):(t.$flags$|=64,yt(e),mt(n,"componentDidLoad"),t.$onReadyResolve$(e),i||ft()),t.$onInstanceResolve$(e),t.$onRenderResolve$&&(t.$onRenderResolve$(),t.$onRenderResolve$=void 0),512&t.$flags$&&Bt(()=>lt(t,!1)),t.$flags$&=-517},pt=t=>{{const e=It(t),n=e.$hostElement$.isConnected;return n&&2==(18&e.$flags$)&&lt(e,!1),n}},ft=t=>{yt(f.documentElement),Bt(()=>st(d,"appload",{detail:{namespace:"ionic"}}))},mt=(t,e,n)=>{if(t&&t[e])try{return t[e](n)}catch(i){Pt(i)}},gt=(t,e)=>t&&t.then?t.then(e):e(),yt=t=>t.classList.add("hydrated"),_t=(t,e,n,i,r,o,s)=>{let a,l,c,u;if(1===o.nodeType){for(a=o.getAttribute("c-id"),a&&(l=a.split("."),(l[0]===s||"0"===l[0])&&(c={$flags$:0,$hostId$:l[0],$nodeId$:l[1],$depth$:l[2],$index$:l[3],$tag$:o.tagName.toLowerCase(),$elm$:o,$attrs$:null,$children$:null,$key$:null,$name$:null,$text$:null},e.push(c),o.removeAttribute("c-id"),t.$children$||(t.$children$=[]),t.$children$[c.$index$]=c,t=c,i&&"0"===c.$depth$&&(i[c.$index$]=c.$elm$))),u=o.childNodes.length-1;u>=0;u--)_t(t,e,n,i,r,o.childNodes[u],s);if(o.shadowRoot)for(u=o.shadowRoot.childNodes.length-1;u>=0;u--)_t(t,e,n,i,r,o.shadowRoot.childNodes[u],s)}else if(8===o.nodeType)l=o.nodeValue.split("."),(l[1]===s||"0"===l[1])&&(a=l[0],c={$flags$:0,$hostId$:l[1],$nodeId$:l[2],$depth$:l[3],$index$:l[4],$elm$:o,$attrs$:null,$children$:null,$key$:null,$name$:null,$tag$:null,$text$:null},"t"===a?(c.$elm$=o.nextSibling,c.$elm$&&3===c.$elm$.nodeType&&(c.$text$=c.$elm$.textContent,e.push(c),o.remove(),t.$children$||(t.$children$=[]),t.$children$[c.$index$]=c,i&&"0"===c.$depth$&&(i[c.$index$]=c.$elm$))):c.$hostId$===s&&("s"===a?(c.$tag$="slot",o["s-sn"]=l[5]?c.$name$=l[5]:"",o["s-sr"]=!0,i&&(c.$elm$=f.createElement(c.$tag$),c.$name$&&c.$elm$.setAttribute("name",c.$name$),o.parentNode.insertBefore(c.$elm$,o),o.remove(),"0"===c.$depth$&&(i[c.$index$]=c.$elm$)),n.push(c),t.$children$||(t.$children$=[]),t.$children$[c.$index$]=c):"r"===a&&(i?o.remove():(r["s-cr"]=o,o["s-cn"]=!0))));else if(t&&"style"===t.$tag$){const e=z(null,o.textContent);e.$elm$=o,e.$index$="0",t.$children$=[e]}},vt=(t,e)=>{if(1===t.nodeType){let n=0;for(;n<t.childNodes.length;n++)vt(t.childNodes[n],e);if(t.shadowRoot)for(n=0;n<t.shadowRoot.childNodes.length;n++)vt(t.shadowRoot.childNodes[n],e)}else if(8===t.nodeType){const n=t.nodeValue.split(".");"o"===n[0]&&(e.set(n[1]+"."+n[2],t),t.nodeValue="",t["s-en"]=n[3])}},xt=(t,e,n)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const i=Object.entries(e.$members$),r=t.prototype;if(i.map(([t,[i]])=>{31&i||2&n&&32&i?Object.defineProperty(r,t,{get(){return((t,e)=>It(this).$instanceValues$.get(e))(0,t)},set(n){((t,e,n,i)=>{const r=It(t),o=r.$hostElement$,s=r.$instanceValues$.get(e),a=r.$flags$,l=r.$lazyInstance$;if(n=((t,e)=>null==t||O(t)?t:4&e?"false"!==t&&(""===t||!!t):2&e?parseFloat(t):1&e?String(t):t)(n,i.$members$[e][0]),(!(8&a)||void 0===s)&&n!==s&&(r.$instanceValues$.set(e,n),l)){if(i.$watchers$&&128&a){const t=i.$watchers$[e];t&&t.map(t=>{try{l[t](n,s,e)}catch(i){Pt(i,o)}})}2==(18&a)&&lt(r,!1)}})(this,t,n,e)},configurable:!0,enumerable:!0}):1&n&&64&i&&Object.defineProperty(r,t,{value(...e){const n=It(this);return n.$onInstancePromise$.then(()=>n.$lazyInstance$[t](...e))}})}),1&n){const n=new Map;r.attributeChangedCallback=function(t,e,i){m.jmp(()=>{const e=n.get(t);this[e]=(null!==i||"boolean"!=typeof this[e])&&i})},t.observedAttributes=i.filter(([t,e])=>15&e[0]).map(([t,i])=>{const r=i[1]||t;return n.set(r,t),512&i[0]&&e.$attrsToReflect$.push([t,r]),r})}}return t},bt=function(){var t=(0,i.Z)(function*(t,e,i,r,o){if(0==(32&e.$flags$)){{if(e.$flags$|=32,(o=Lt(i)).then){const t=()=>{};o=yield o,t()}o.isProxied||(i.$watchers$=o.watchers,xt(o,i,2),o.isProxied=!0);const t=()=>{};e.$flags$|=8;try{new o(e)}catch(l){Pt(l)}e.$flags$&=-9,e.$flags$|=128,t(),wt(e.$lazyInstance$)}if(o.style){let r=o.style;"string"!=typeof r&&(r=r[e.$modeName$=(t=>Rt.map(e=>e(t)).find(t=>!!t))(t)]);const s=M(i,e.$modeName$);if(!Ot.has(s)){const t=()=>{};8&i.$flags$&&(r=yield n.e(8810).then(n.bind(n,8810)).then(t=>t.scopeCss(r,s,!1))),I(s,r,!!(1&i.$flags$)),t()}}}const s=e.$ancestorComponent$,a=()=>lt(e,!0);s&&s["s-rc"]?s["s-rc"].push(a):a()});return function(e,n,i,r,o){return t.apply(this,arguments)}}(),wt=t=>{mt(t,"connectedCallback")},Tt=t=>{const e=t["s-cr"]=f.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},At=(t,e={})=>{const n=[],i=e.exclude||[],r=d.customElements,o=f.head,s=o.querySelector("meta[charset]"),a=f.createElement("style"),l=[],c=f.querySelectorAll(`[${A}]`);let u,h=!0,p=0;for(Object.assign(m,e),m.$resourcesUrl$=new URL(e.resourcesUrl||"./",f.baseURI).href,m.$flags$|=2;p<c.length;p++)I(c[p].getAttribute(A),k(c[p].innerHTML),!0);t.map(t=>t[1].map(e=>{const o={$flags$:e[0],$tagName$:e[1],$members$:e[2],$listeners$:e[3]};o.$members$=e[2],o.$listeners$=e[3],o.$attrsToReflect$=[],o.$watchers$={},!g&&1&o.$flags$&&(o.$flags$|=8);const s=o.$tagName$,a=class extends HTMLElement{constructor(t){super(t),Mt(t=this,o),1&o.$flags$&&(g?t.attachShadow({mode:"open",delegatesFocus:!!(16&o.$flags$)}):"shadowRoot"in t||(t.shadowRoot=t))}connectedCallback(){u&&(clearTimeout(u),u=null),h?l.push(this):m.jmp(()=>(t=>{if(0==(1&m.$flags$)){const e=It(t),n=e.$cmpMeta$,i=()=>{};if(1&e.$flags$)v(t,e,n.$listeners$),wt(e.$lazyInstance$);else{let i;if(e.$flags$|=1,i=t.getAttribute(T),i){if(g&&1&n.$flags$){const e=E(t.shadowRoot,n,t.getAttribute("s-mode"));t.classList.remove(e+"-h",e+"-s")}((t,e,n,i)=>{const r=t.shadowRoot,o=[],s=r?[]:null,a=i.$vnode$=z(e,null);m.$orgLocNodes$||vt(f.body,m.$orgLocNodes$=new Map),t[T]=n,t.removeAttribute(T),_t(a,o,[],s,t,t,n),o.map(t=>{const n=t.$hostId$+"."+t.$nodeId$,i=m.$orgLocNodes$.get(n),o=t.$elm$;i&&g&&""===i["s-en"]&&i.parentNode.insertBefore(o,i.nextSibling),r||(o["s-hn"]=e,i&&(o["s-ol"]=i,o["s-ol"]["s-nr"]=o)),m.$orgLocNodes$.delete(n)}),r&&s.map(t=>{t&&r.appendChild(t)})})(t,n.$tagName$,i,e)}i||12&n.$flags$&&Tt(t);{let n=t;for(;n=n.parentNode||n.host;)if(1===n.nodeType&&n.hasAttribute("s-id")&&n["s-p"]||n["s-p"]){at(e,e.$ancestorComponent$=n);break}}n.$members$&&Object.entries(n.$members$).map(([e,[n]])=>{if(31&n&&t.hasOwnProperty(e)){const n=t[e];delete t[e],t[e]=n}}),Bt(()=>bt(t,e,n))}i()}})(this))}disconnectedCallback(){m.jmp(()=>(t=>{if(0==(1&m.$flags$)){const e=It(t),n=e.$lazyInstance$;e.$rmListeners$&&(e.$rmListeners$.map(t=>t()),e.$rmListeners$=void 0),m.$cssShim$&&m.$cssShim$.removeHost(t),mt(n,"disconnectedCallback")}})(this))}componentOnReady(){return It(this).$onReadyPromise$}};o.$lazyBundleId$=t[0],!i.includes(s)&&!r.get(s)&&(n.push(s),r.define(s,xt(a,o,1)))})),a.innerHTML=n+"{visibility:hidden}.hydrated{visibility:inherit}",a.setAttribute("data-styles",""),o.insertBefore(a,s?s.nextSibling:o.firstChild),h=!1,l.length?l.map(t=>t.connectedCallback()):m.jmp(()=>u=setTimeout(ft,30))},St=t=>{const e=new URL(t,m.$resourcesUrl$);return e.origin!==d.location.origin?e.href:e.pathname},Ct=new WeakMap,It=t=>Ct.get(t),Et=(t,e)=>Ct.set(e.$lazyInstance$=t,e),Mt=(t,e)=>{const n={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return n.$onInstancePromise$=new Promise(t=>n.$onInstanceResolve$=t),n.$onReadyPromise$=new Promise(t=>n.$onReadyResolve$=t),t["s-p"]=[],t["s-rc"]=[],v(t,n,e.$listeners$),Ct.set(t,n)},kt=(t,e)=>e in t,Pt=(t,e)=>(0,console.error)(t,e),Dt=new Map,Lt=(t,e,i)=>{const r=t.$tagName$.replace(/-/g,"_"),o=t.$lazyBundleId$,s=Dt.get(o);return s?s[r]:n(863)(`./${o}.entry.js`).then(t=>(Dt.set(o,t),t[r]),Pt)},Ot=new Map,Rt=[],zt=[],Zt=[],Ft=(t,e)=>n=>{t.push(n),h||(h=!0,e&&4&m.$flags$?Bt(Nt):m.raf(Nt))},Ut=t=>{for(let n=0;n<t.length;n++)try{t[n](performance.now())}catch(e){Pt(e)}t.length=0},Nt=()=>{Ut(zt),Ut(Zt),(h=zt.length>0)&&m.raf(Nt)},Bt=t=>y().then(t),qt=Ft(zt,!1),$t=Ft(Zt,!0),Vt={isDev:!1,isBrowser:!0,isServer:!1,isTesting:!1}},4001:function(t,e,n){"use strict";n.d(e,{L:function(){return s},a:function(){return a},b:function(){return l},c:function(){return c},d:function(){return u},e:function(){return S},g:function(){return E},l:function(){return T},s:function(){return C},t:function(){return h}});var i=n(8239),r=n(3150),o=n(2377);const s="ionViewWillEnter",a="ionViewDidEnter",l="ionViewWillLeave",c="ionViewDidLeave",u="ionViewWillUnload",h=t=>new Promise((e,n)=>{(0,r.c)(()=>{d(t),p(t).then(n=>{n.animation&&n.animation.destroy(),f(t),e(n)},e=>{f(t),n(e)})})}),d=t=>{const e=t.enteringEl,n=t.leavingEl;I(e,n,t.direction),t.showGoBack?e.classList.add("can-go-back"):e.classList.remove("can-go-back"),C(e,!1),e.style.setProperty("pointer-events","none"),n&&(C(n,!1),n.style.setProperty("pointer-events","none"))},p=function(){var t=(0,i.Z)(function*(t){const e=yield m(t);return e&&r.B.isBrowser?g(e,t):y(t)});return function(e){return t.apply(this,arguments)}}(),f=t=>{const e=t.enteringEl,n=t.leavingEl;e.classList.remove("ion-page-invisible"),e.style.removeProperty("pointer-events"),void 0!==n&&(n.classList.remove("ion-page-invisible"),n.style.removeProperty("pointer-events"))},m=function(){var t=(0,i.Z)(function*(t){return t.leavingEl&&t.animated&&0!==t.duration?t.animationBuilder?t.animationBuilder:"ios"===t.mode?(yield Promise.resolve().then(n.bind(n,9554))).iosTransitionAnimation:(yield Promise.resolve().then(n.bind(n,7405))).mdTransitionAnimation:void 0});return function(e){return t.apply(this,arguments)}}(),g=function(){var t=(0,i.Z)(function*(t,e){yield _(e,!0);const n=t(e.baseEl,e);b(e.enteringEl,e.leavingEl);const i=yield x(n,e);return e.progressCallback&&e.progressCallback(void 0),i&&w(e.enteringEl,e.leavingEl),{hasCompleted:i,animation:n}});return function(e,n){return t.apply(this,arguments)}}(),y=function(){var t=(0,i.Z)(function*(t){const e=t.enteringEl,n=t.leavingEl;return yield _(t,!1),b(e,n),w(e,n),{hasCompleted:!0}});return function(e){return t.apply(this,arguments)}}(),_=function(){var t=(0,i.Z)(function*(t,e){const n=(void 0!==t.deepWait?t.deepWait:e)?[S(t.enteringEl),S(t.leavingEl)]:[A(t.enteringEl),A(t.leavingEl)];yield Promise.all(n),yield v(t.viewIsReady,t.enteringEl)});return function(e,n){return t.apply(this,arguments)}}(),v=function(){var t=(0,i.Z)(function*(t,e){t&&(yield t(e))});return function(e,n){return t.apply(this,arguments)}}(),x=(t,e)=>{const n=e.progressCallback,i=new Promise(e=>{t.onFinish(t=>e(1===t))});return n?(t.progressStart(!0),n(t)):t.play(),i},b=(t,e)=>{T(e,l),T(t,s)},w=(t,e)=>{T(t,a),T(e,c)},T=(t,e)=>{if(t){const n=new CustomEvent(e,{bubbles:!1,cancelable:!1});t.dispatchEvent(n)}},A=t=>t?new Promise(e=>(0,o.c)(t,e)):Promise.resolve(),S=function(){var t=(0,i.Z)(function*(t){const e=t;if(e){if(null!=e.componentOnReady&&null!=(yield e.componentOnReady()))return;yield Promise.all(Array.from(e.children).map(S))}});return function(e){return t.apply(this,arguments)}}(),C=(t,e)=>{e?(t.setAttribute("aria-hidden","true"),t.classList.add("ion-page-hidden")):(t.hidden=!1,t.removeAttribute("aria-hidden"),t.classList.remove("ion-page-hidden"))},I=(t,e,n)=>{void 0!==t&&(t.style.zIndex="back"===n?"99":"101"),void 0!==e&&(e.style.zIndex="100")},E=t=>t.classList.contains("ion-page")?t:t.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")||t},7585:function(t,e,n){"use strict";n.d(e,{a:function(){return o},b:function(){return b},c:function(){return _},g:function(){return r},i:function(){return w}});var i=n(3150);const r=t=>s(t),o=(t,e)=>("string"==typeof t&&(e=t,t=void 0),r(t).includes(e)),s=(t=window)=>{if(void 0===t)return[];t.Ionic=t.Ionic||{};let e=t.Ionic.platforms;return null==e&&(e=t.Ionic.platforms=a(t),e.forEach(e=>t.document.documentElement.classList.add(`plt-${e}`))),e},a=t=>Object.keys(g).filter(e=>g[e](t)),l=t=>!!(f(t,/iPad/i)||f(t,/Macintosh/i)&&u(t)),c=t=>f(t,/android|sink/i),u=t=>m(t,"(any-pointer:coarse)"),h=t=>d(t)||p(t),d=t=>!!(t.cordova||t.phonegap||t.PhoneGap),p=t=>{const e=t.Capacitor;return!(!e||!e.isNative)},f=(t,e)=>e.test(t.navigator.userAgent),m=(t,e)=>t.matchMedia(e).matches,g={ipad:l,iphone:t=>f(t,/iPhone/i),ios:t=>f(t,/iPhone|iPod/i)||l(t),android:c,phablet:t=>{const e=t.innerWidth,n=t.innerHeight,i=Math.min(e,n),r=Math.max(e,n);return i>390&&i<520&&r>620&&r<800},tablet:t=>{const e=t.innerWidth,n=t.innerHeight,i=Math.min(e,n),r=Math.max(e,n);return l(t)||(t=>c(t)&&!f(t,/mobile/i))(t)||i>460&&i<820&&r>780&&r<1400},cordova:d,capacitor:p,electron:t=>f(t,/electron/i),pwa:t=>!(!t.matchMedia("(display-mode: standalone)").matches&&!t.navigator.standalone),mobile:u,mobileweb:t=>u(t)&&!h(t),desktop:t=>!u(t),hybrid:h};class y{constructor(){this.m=new Map}reset(t){this.m=new Map(Object.entries(t))}get(t,e){const n=this.m.get(t);return void 0!==n?n:e}getBoolean(t,e=!1){const n=this.m.get(t);return void 0===n?e:"string"==typeof n?"true"===n:!!n}getNumber(t,e){const n=parseFloat(this.m.get(t));return isNaN(n)?void 0!==e?e:NaN:n}set(t,e){this.m.set(t,e)}}const _=new y,v="ionic-persist-config";let x;const b=t=>t&&(0,i.g)(t)||x,w=(t={})=>{if("undefined"==typeof window)return;const e=window.document,n=window,r=n.Ionic=n.Ionic||{};s(n);const a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},(t=>{try{const e=t.sessionStorage.getItem(v);return null!==e?JSON.parse(e):{}}catch(e){return{}}})(n)),{persistConfig:!1}),r.config),(t=>{const e={};return t.location.search.slice(1).split("&").map(t=>t.split("=")).map(([t,e])=>[decodeURIComponent(t),decodeURIComponent(e)]).filter(([t])=>((t,e)=>t.substr(0,e.length)===e)(t,"ionic:")).map(([t,e])=>[t.slice("ionic:".length),e]).forEach(([t,n])=>{e[t]=n}),e})(n)),t);_.reset(a),_.getBoolean("persistConfig")&&((t,e)=>{try{t.sessionStorage.setItem(v,JSON.stringify(e))}catch(n){return}})(n,a),r.config=_,r.mode=x=_.get("mode",e.documentElement.getAttribute("mode")||(o(n,"ios")?"ios":"md")),_.set("mode",x),e.documentElement.setAttribute("mode",x),e.documentElement.classList.add(x),_.getBoolean("_testing")&&_.set("animated",!1);const l=t=>t.tagName&&t.tagName.startsWith("ION-"),c=t=>["ios","md"].includes(t);(0,i.s)(t=>{for(;t;){const e=t.mode||t.getAttribute("mode");if(e){if(c(e))return e;l(t)&&console.warn('Invalid ionic mode: "'+e+'", expected: "ios" or "md"')}t=t.parentElement}return x})}},9554:function(t,e,n){"use strict";n.r(e),n.d(e,{iosTransitionAnimation:function(){return h},shadow:function(){return s}});var i=n(4086),r=n(4001);n(3150);const o=t=>document.querySelector(`${t}.ion-cloned-element`),s=t=>t.shadowRoot||t,a=t=>{const e="ION-TABS"===t.tagName?t:t.querySelector("ion-tabs"),n="ion-content ion-header:not(.header-collapse-condense-inactive) ion-title.title-large";if(null!=e){const t=e.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");return null!=t?t.querySelector(n):null}return t.querySelector(n)},l=(t,e)=>{const n="ION-TABS"===t.tagName?t:t.querySelector("ion-tabs");let i=[];if(null!=n){const t=n.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");null!=t&&(i=t.querySelectorAll("ion-buttons"))}else i=t.querySelectorAll("ion-buttons");for(const r of i){const t=r.closest("ion-header"),n=t&&!t.classList.contains("header-collapse-condense-inactive"),i=r.querySelector("ion-back-button"),o=r.classList.contains("buttons-collapse"),s="start"===r.slot||""===r.slot;if(null!==i&&s&&(o&&n&&e||!o))return i}return null},c=(t,e,n,r,a,l)=>{const c=e?`calc(100% - ${l.right+4}px)`:l.left-4+"px",u=e?"7px":"-7px",h=e?"-4px":"4px",d=e?"-4px":"4px",p=e?"right":"left",f=e?"left":"right",m=n?[{offset:0,opacity:1,transform:`translate3d(${h}, ${l.top-46}px, 0) scale(1)`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${u}, ${a.top-40}px, 0) scale(2.1)`}]:[{offset:0,opacity:0,transform:`translate3d(${u}, ${a.top-40}px, 0) scale(2.1)`},{offset:1,opacity:1,transform:`translate3d(${h}, ${l.top-46}px, 0) scale(1)`}],g=n?[{offset:0,opacity:1,transform:`translate3d(${d}, ${l.top-46}px, 0) scale(1)`},{offset:.2,opacity:0,transform:`translate3d(${d}, ${l.top-41}px, 0) scale(0.6)`},{offset:1,opacity:0,transform:`translate3d(${d}, ${l.top-41}px, 0) scale(0.6)`}]:[{offset:0,opacity:0,transform:`translate3d(${d}, ${l.top-41}px, 0) scale(0.6)`},{offset:1,opacity:1,transform:`translate3d(${d}, ${l.top-46}px, 0) scale(1)`}],y=(0,i.c)(),_=(0,i.c)(),v=o("ion-back-button"),x=s(v).querySelector(".button-text"),b=s(v).querySelector("ion-icon");v.text=r.text,v.mode=r.mode,v.icon=r.icon,v.color=r.color,v.disabled=r.disabled,v.style.setProperty("display","block"),v.style.setProperty("position","fixed"),_.addElement(b),y.addElement(x),y.beforeStyles({"transform-origin":`${p} center`}).beforeAddWrite(()=>{r.style.setProperty("display","none"),v.style.setProperty(p,c)}).afterAddWrite(()=>{r.style.setProperty("display",""),v.style.setProperty("display","none"),v.style.removeProperty(p)}).keyframes(m),_.beforeStyles({"transform-origin":`${f} center`}).keyframes(g),t.addAnimation([y,_])},u=(t,e,n,r,s,a)=>{const l=e?`calc(100% - ${s.right}px)`:`${s.left}px`,c=e?"-18px":"18px",u=e?"right":"left",h=n?[{offset:0,opacity:0,transform:`translate3d(${c}, ${a.top-4}px, 0) scale(0.49)`},{offset:.1,opacity:0},{offset:1,opacity:1,transform:`translate3d(0, ${s.top-2}px, 0) scale(1)`}]:[{offset:0,opacity:.99,transform:`translate3d(0, ${s.top-2}px, 0) scale(1)`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${c}, ${a.top-4}px, 0) scale(0.5)`}],d=o("ion-title"),p=(0,i.c)();d.innerText=r.innerText,d.size=r.size,d.color=r.color,p.addElement(d),p.beforeStyles({"transform-origin":`${u} center`,height:"46px",display:"",position:"relative",[u]:l}).beforeAddWrite(()=>{r.style.setProperty("display","none")}).afterAddWrite(()=>{r.style.setProperty("display",""),d.style.setProperty("display","none")}).keyframes(h),t.addAnimation(p)},h=(t,e)=>{try{const n="cubic-bezier(0.32,0.72,0,1)",o="opacity",h="transform",d="0%",p=.8,f="rtl"===t.ownerDocument.dir,m=f?"-99.5%":"99.5%",g=f?"33%":"-33%",y=e.enteringEl,_=e.leavingEl,v="back"===e.direction,x=y.querySelector(":scope > ion-content"),b=y.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *"),w=y.querySelectorAll(":scope > ion-header > ion-toolbar"),T=(0,i.c)(),A=(0,i.c)();if(T.addElement(y).duration(e.duration||540).easing(e.easing||n).fill("both").beforeRemoveClass("ion-page-invisible"),_&&t){const e=(0,i.c)();e.addElement(t),T.addAnimation(e)}if(x||0!==w.length||0!==b.length?(A.addElement(x),A.addElement(b)):A.addElement(y.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),T.addAnimation(A),v?A.beforeClearStyles([o]).fromTo("transform",`translateX(${g})`,`translateX(${d})`).fromTo(o,p,1):A.beforeClearStyles([o]).fromTo("transform",`translateX(${m})`,`translateX(${d})`),x){const t=s(x).querySelector(".transition-effect");if(t){const e=t.querySelector(".transition-cover"),n=t.querySelector(".transition-shadow"),r=(0,i.c)(),s=(0,i.c)(),a=(0,i.c)();r.addElement(t).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),s.addElement(e).beforeClearStyles([o]).fromTo(o,0,.1),a.addElement(n).beforeClearStyles([o]).fromTo(o,.03,.7),r.addAnimation([s,a]),A.addAnimation([r])}}const S=y.querySelector("ion-header.header-collapse-condense"),{forward:C,backward:I}=((t,e,n,i,r)=>{const o=l(i,n),s=a(r),h=a(i),d=l(r,n),p=null!==o&&null!==s&&!n,f=null!==h&&null!==d&&n;if(p){const i=s.getBoundingClientRect(),r=o.getBoundingClientRect();u(t,e,n,s,i,r),c(t,e,n,o,i,r)}else if(f){const i=h.getBoundingClientRect(),r=d.getBoundingClientRect();u(t,e,n,h,i,r),c(t,e,n,d,i,r)}return{forward:p,backward:f}})(T,f,v,y,_);if(w.forEach(t=>{const e=(0,i.c)();e.addElement(t),T.addAnimation(e);const n=(0,i.c)();n.addElement(t.querySelector("ion-title"));const r=(0,i.c)(),a=Array.from(t.querySelectorAll("ion-buttons,[menuToggle]")),l=t.closest("ion-header"),c=l&&l.classList.contains("header-collapse-condense-inactive");let u;u=a.filter(v?t=>{const e=t.classList.contains("buttons-collapse");return e&&!c||!e}:t=>!t.classList.contains("buttons-collapse")),r.addElement(u);const h=(0,i.c)();h.addElement(t.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])"));const p=(0,i.c)();p.addElement(s(t).querySelector(".toolbar-background"));const y=(0,i.c)(),_=t.querySelector("ion-back-button");if(_&&y.addElement(_),e.addAnimation([n,r,h,p,y]),r.fromTo(o,.01,1),h.fromTo(o,.01,1),v)c||n.fromTo("transform",`translateX(${g})`,`translateX(${d})`).fromTo(o,.01,1),h.fromTo("transform",`translateX(${g})`,`translateX(${d})`),y.fromTo(o,.01,1);else if(S||n.fromTo("transform",`translateX(${m})`,`translateX(${d})`).fromTo(o,.01,1),h.fromTo("transform",`translateX(${m})`,`translateX(${d})`),p.beforeClearStyles([o,"transform"]),(null==l?void 0:l.translucent)?p.fromTo("transform",f?"translateX(-100%)":"translateX(100%)","translateX(0px)"):p.fromTo(o,.01,"var(--opacity)"),C||y.fromTo(o,.01,1),_&&!C){const t=(0,i.c)();t.addElement(s(_).querySelector(".button-text")).fromTo("transform",f?"translateX(-100px)":"translateX(100px)","translateX(0px)"),e.addAnimation(t)}}),_){const t=(0,i.c)(),e=_.querySelector(":scope > ion-content"),n=_.querySelectorAll(":scope > ion-header > ion-toolbar"),a=_.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *");if(e||0!==n.length||0!==a.length?(t.addElement(e),t.addElement(a)):t.addElement(_.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),T.addAnimation(t),v){t.beforeClearStyles([o]).fromTo("transform",`translateX(${d})`,f?"translateX(-100%)":"translateX(100%)");const e=(0,r.g)(_);T.afterAddWrite(()=>{"normal"===T.getDirection()&&e.style.setProperty("display","none")})}else t.fromTo("transform",`translateX(${d})`,`translateX(${g})`).fromTo(o,1,p);if(e){const n=s(e).querySelector(".transition-effect");if(n){const e=n.querySelector(".transition-cover"),r=n.querySelector(".transition-shadow"),s=(0,i.c)(),a=(0,i.c)(),l=(0,i.c)();s.addElement(n).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),a.addElement(e).beforeClearStyles([o]).fromTo(o,.1,0),l.addElement(r).beforeClearStyles([o]).fromTo(o,.7,.03),s.addAnimation([a,l]),t.addAnimation([s])}}n.forEach(t=>{const e=(0,i.c)();e.addElement(t);const n=(0,i.c)();n.addElement(t.querySelector("ion-title"));const r=(0,i.c)(),a=t.querySelectorAll("ion-buttons,[menuToggle]"),l=t.closest("ion-header"),c=l&&l.classList.contains("header-collapse-condense-inactive"),u=Array.from(a).filter(t=>{const e=t.classList.contains("buttons-collapse");return e&&!c||!e});r.addElement(u);const p=(0,i.c)(),m=t.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])");m.length>0&&p.addElement(m);const y=(0,i.c)();y.addElement(s(t).querySelector(".toolbar-background"));const _=(0,i.c)(),x=t.querySelector("ion-back-button");if(x&&_.addElement(x),e.addAnimation([n,r,p,_,y]),T.addAnimation(e),_.fromTo(o,.99,0),r.fromTo(o,.99,0),p.fromTo(o,.99,0),v){if(c||n.fromTo("transform",`translateX(${d})`,f?"translateX(-100%)":"translateX(100%)").fromTo(o,.99,0),p.fromTo("transform",`translateX(${d})`,f?"translateX(-100%)":"translateX(100%)"),y.beforeClearStyles([o,"transform"]),(null==l?void 0:l.translucent)?y.fromTo("transform","translateX(0px)",f?"translateX(-100%)":"translateX(100%)"):y.fromTo(o,"var(--opacity)",0),x&&!I){const t=(0,i.c)();t.addElement(s(x).querySelector(".button-text")).fromTo("transform",`translateX(${d})`,`translateX(${(f?-124:124)+"px"})`),e.addAnimation(t)}}else c||n.fromTo("transform",`translateX(${d})`,`translateX(${g})`).fromTo(o,.99,0).afterClearStyles([h,o]),p.fromTo("transform",`translateX(${d})`,`translateX(${g})`).afterClearStyles([h,o]),_.afterClearStyles([o]),n.afterClearStyles([o]),r.afterClearStyles([o])})}return T}catch(n){throw n}}},7405:function(t,e,n){"use strict";n.r(e),n.d(e,{mdTransitionAnimation:function(){return o}});var i=n(4086),r=n(4001);n(3150);const o=(t,e)=>{const n="back"===e.direction,o=e.leavingEl,s=(0,r.g)(e.enteringEl),a=s.querySelector("ion-toolbar"),l=(0,i.c)();if(l.addElement(s).fill("both").beforeRemoveClass("ion-page-invisible"),n?l.duration(e.duration||200).easing("cubic-bezier(0.47,0,0.745,0.715)"):l.duration(e.duration||280).easing("cubic-bezier(0.36,0.66,0.04,1)").fromTo("transform","translateY(40px)","translateY(0px)").fromTo("opacity",.01,1),a){const t=(0,i.c)();t.addElement(a),l.addAnimation(t)}if(o&&n){l.duration(e.duration||200).easing("cubic-bezier(0.47,0,0.745,0.715)");const t=(0,i.c)();t.addElement((0,r.g)(o)).onFinish(e=>{1===e&&t.elements.length>0&&t.elements[0].style.setProperty("display","none")}).fromTo("transform","translateY(0px)","translateY(40px)").fromTo("opacity",1,0),l.addAnimation(t)}return l}},7053:function(t,e,n){"use strict";n.d(e,{B:function(){return R},a:function(){return u},b:function(){return h},c:function(){return m},d:function(){return S},e:function(){return y},f:function(){return I},g:function(){return k},h:function(){return l},i:function(){return D},l:function(){return d},m:function(){return p},p:function(){return f},s:function(){return O},t:function(){return g}});var i=n(8239),r=n(7585),o=n(3087),s=n(2377);let a=0;const l=new WeakMap,c=t=>({create:e=>_(t,e),dismiss:(e,n,i)=>w(document,e,n,t,i),getTop:()=>(0,i.Z)(function*(){return T(document,t)})()}),u=c("ion-alert"),h=c("ion-action-sheet"),d=c("ion-loading"),p=c("ion-modal"),f=c("ion-picker"),m=c("ion-popover"),g=c("ion-toast"),y=t=>{"undefined"!=typeof document&&b(document);const e=a++;t.overlayIndex=e,t.hasAttribute("id")||(t.id=`ion-overlay-${e}`)},_=(t,e)=>"undefined"!=typeof customElements?customElements.whenDefined(t).then(()=>{const n=document.createElement(t);return n.classList.add("overlay-hidden"),Object.assign(n,e),E(document).appendChild(n),new Promise(t=>(0,s.c)(n,t))}):Promise.resolve(),v='[tabindex]:not([tabindex^="-"]), input:not([type=hidden]):not([tabindex^="-"]), textarea:not([tabindex^="-"]), button:not([tabindex^="-"]), select:not([tabindex^="-"]), .ion-focusable:not([tabindex^="-"])',x="input:not([type=hidden]), textarea, button, select",b=t=>{0===a&&(a=1,t.addEventListener("focus",e=>((t,e)=>{const n=T(e),i=t.target;if(n&&i)if(n===i)n.lastFocus=void 0;else{const t=(0,s.g)(n);if(!t.contains(i))return;const r=t.querySelector(".ion-overlay-wrapper");if(!r)return;if(r.contains(i))n.lastFocus=i;else{const t=n.lastFocus;((t,e)=>{let n=t.querySelector(v);const i=n&&n.shadowRoot;i&&(n=i.querySelector(x)||n),n?n.focus():e.focus()})(r,n),t===e.activeElement&&((t,e)=>{const n=Array.from(t.querySelectorAll(v));let i=n.length>0?n[n.length-1]:null;const r=i&&i.shadowRoot;r&&(i=r.querySelector(x)||i),i?i.focus():e.focus()})(r,n),n.lastFocus=e.activeElement}}})(e,t),!0),t.addEventListener("ionBackButton",e=>{const n=T(t);n&&n.backdropDismiss&&e.detail.register(o.OVERLAY_BACK_BUTTON_PRIORITY,()=>n.dismiss(void 0,R))}),t.addEventListener("keyup",e=>{if("Escape"===e.key){const e=T(t);e&&e.backdropDismiss&&e.dismiss(void 0,R)}}))},w=(t,e,n,i,r)=>{const o=T(t,i,r);return o?o.dismiss(e,n):Promise.reject("overlay does not exist")},T=(t,e,n)=>{const i=((t,e)=>(void 0===e&&(e="ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker,ion-popover,ion-toast"),Array.from(t.querySelectorAll(e)).filter(t=>t.overlayIndex>0)))(t,e);return void 0===n?i[i.length-1]:i.find(t=>t.id===n)},A=(t=!1)=>{const e=E(document).querySelector("ion-router-outlet, ion-nav, #ion-view-container-root");!e||(t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden"))},S=function(){var t=(0,i.Z)(function*(t,e,n,i,o){if(t.presented)return;A(!0),t.presented=!0,t.willPresent.emit();const s=(0,r.b)(t),a=t.enterAnimation?t.enterAnimation:r.c.get(e,"ios"===s?n:i);(yield M(t,a,t.el,o))&&t.didPresent.emit(),"ION-TOAST"!==t.el.tagName&&C(t.el),t.keyboardClose&&t.el.focus()});return function(e,n,i,r,o){return t.apply(this,arguments)}}(),C=function(){var t=(0,i.Z)(function*(t){let e=document.activeElement;if(!e)return;const n=e&&e.shadowRoot;n&&(e=n.querySelector(x)||e),yield t.onDidDismiss(),e.focus()});return function(e){return t.apply(this,arguments)}}(),I=function(){var t=(0,i.Z)(function*(t,e,n,i,o,s,a){if(!t.presented)return!1;A(!1),t.presented=!1;try{t.el.style.setProperty("pointer-events","none"),t.willDismiss.emit({data:e,role:n});const c=(0,r.b)(t),u=t.leaveAnimation?t.leaveAnimation:r.c.get(i,"ios"===c?o:s);"gesture"!==n&&(yield M(t,u,t.el,a)),t.didDismiss.emit({data:e,role:n}),l.delete(t)}catch(c){console.error(c)}return t.el.remove(),!0});return function(e,n,i,r,o,s,a){return t.apply(this,arguments)}}(),E=t=>t.querySelector("ion-app")||t.body,M=function(){var t=(0,i.Z)(function*(t,e,n,i){n.classList.remove("overlay-hidden");const o=e(n.shadowRoot||t.el,i);(!t.animated||!r.c.getBoolean("animated",!0))&&o.duration(0),t.keyboardClose&&o.beforeAddWrite(()=>{const t=n.ownerDocument.activeElement;t&&t.matches("input, ion-input, ion-textarea")&&t.blur()});const s=l.get(t)||[];return l.set(t,[...s,o]),yield o.play(),!0});return function(e,n,i,r){return t.apply(this,arguments)}}(),k=(t,e)=>{let n;const i=new Promise(t=>n=t);return P(t,e,t=>{n(t.detail)}),i},P=(t,e,n)=>{const i=r=>{(0,s.b)(t,e,i),n(r)};(0,s.a)(t,e,i)},D=t=>"cancel"===t||t===R,L=t=>t(),O=(t,e)=>{if("function"==typeof t)return r.c.get("_zoneGate",L)(()=>{try{return t(e)}catch(n){console.error(n)}})},R="backdrop"},4516:function(t,e,n){"use strict";n.d(e,{Zw:function(){return M},aw:function(){return H},X$:function(){return Y},sK:function(){return G}});var i=n(639),r=n(7574);function o(t){return!!t&&(t instanceof r.y||"function"==typeof t.lift&&"function"==typeof t.subscribe)}var s=n(5917),a=n(5758),l=n(8071),c=n(1439),u=n(9765),h=n(6465),d=n(6102);const p=new class extends d.v{}(class extends h.o{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}schedule(t,e=0){return e>0?super.schedule(t,e):(this.delay=e,this.state=t,this.scheduler.flush(this),this)}execute(t,e){return e>0||this.closed?super.execute(t,e):this._execute(t,e)}requestAsyncId(t,e,n=0){return null!==n&&n>0||null===n&&this.delay>0?super.requestAsyncId(t,e,n):t.flush(this)}});var f=n(5319),m=n(7393),g=n(9193);class y{constructor(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}observe(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}do(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}}accept(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)}toObservable(){switch(this.kind){case"N":return(0,s.of)(this.value);case"E":return t=this.error,new r.y(e=>e.error(t));case"C":return(0,g.c)()}var t;throw new Error("unexpected notification kind value")}static createNext(t){return void 0!==t?new y("N",t):y.undefinedValueNotification}static createError(t){return new y("E",void 0,t)}static createComplete(){return y.completeNotification}}y.completeNotification=new y("C"),y.undefinedValueNotification=new y("N",void 0);class _ extends m.L{constructor(t,e,n=0){super(t),this.scheduler=e,this.delay=n}static dispatch(t){const{notification:e,destination:n}=t;e.observe(n),this.unsubscribe()}scheduleMessage(t){this.destination.add(this.scheduler.schedule(_.dispatch,this.delay,new v(t,this.destination)))}_next(t){this.scheduleMessage(y.createNext(t))}_error(t){this.scheduleMessage(y.createError(t)),this.unsubscribe()}_complete(){this.scheduleMessage(y.createComplete()),this.unsubscribe()}}class v{constructor(t,e){this.notification=t,this.destination=e}}var x=n(7971),b=n(8858);class w extends u.xQ{constructor(t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n){super(),this.scheduler=n,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=t<1?1:t,this._windowTime=e<1?1:e,e===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(t){if(!this.isStopped){const e=this._events;e.push(t),e.length>this._bufferSize&&e.shift()}super.next(t)}nextTimeWindow(t){this.isStopped||(this._events.push(new T(this._getNow(),t)),this._trimBufferThenGetEvents()),super.next(t)}_subscribe(t){const e=this._infiniteTimeWindow,n=e?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,r=n.length;let o;if(this.closed)throw new x.N;if(this.isStopped||this.hasError?o=f.w.EMPTY:(this.observers.push(t),o=new b.W(this,t)),i&&t.add(t=new _(t,i)),e)for(let s=0;s<r&&!t.closed;s++)t.next(n[s]);else for(let s=0;s<r&&!t.closed;s++)t.next(n[s].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),o}_getNow(){return(this.scheduler||p).now()}_trimBufferThenGetEvents(){const t=this._getNow(),e=this._bufferSize,n=this._windowTime,i=this._events,r=i.length;let o=0;for(;o<r&&!(t-i[o].time<n);)o++;return r>e&&(o=Math.max(o,r-e)),o>0&&i.splice(0,o),i}}class T{constructor(t,e){this.time=t,this.value=e}}function A(t,e,n){let i;return i=t&&"object"==typeof t?t:{bufferSize:t,windowTime:e,refCount:!1,scheduler:n},t=>t.lift(function({bufferSize:t=Number.POSITIVE_INFINITY,windowTime:e=Number.POSITIVE_INFINITY,refCount:n,scheduler:i}){let r,o,s=0,a=!1,l=!1;return function(c){let u;s++,!r||a?(a=!1,r=new w(t,e,i),u=r.subscribe(this),o=c.subscribe({next(t){r.next(t)},error(t){a=!0,r.error(t)},complete(){l=!0,o=void 0,r.complete()}})):u=r.subscribe(this),this.add(()=>{s--,u.unsubscribe(),o&&!l&&n&&0===s&&(o.unsubscribe(),o=void 0,r=void 0)})}}(i))}var S=n(5257),C=n(8002),I=n(4612),E=n(3190);class M{}let k=(()=>{class t extends M{getTranslation(t){return(0,s.of)({})}}return t.\u0275fac=function(){let e;return function(n){return(e||(e=i.n5z(t)))(n||t)}}(),t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac}),t})();class P{}let D=(()=>{class t{handle(t){return t.key}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac}),t})();function L(t,e){if(t===e)return!0;if(null===t||null===e)return!1;if(t!=t&&e!=e)return!0;let n,i,r,o=typeof t;if(o==typeof e&&"object"==o){if(!Array.isArray(t)){if(Array.isArray(e))return!1;for(i in r=Object.create(null),t){if(!L(t[i],e[i]))return!1;r[i]=!0}for(i in e)if(!(i in r)&&void 0!==e[i])return!1;return!0}if(!Array.isArray(e))return!1;if((n=t.length)==e.length){for(i=0;i<n;i++)if(!L(t[i],e[i]))return!1;return!0}}return!1}function O(t){return null!=t}function R(t){return t&&"object"==typeof t&&!Array.isArray(t)}function z(t,e){let n=Object.assign({},t);return R(t)&&R(e)&&Object.keys(e).forEach(i=>{R(e[i])?i in t?n[i]=z(t[i],e[i]):Object.assign(n,{[i]:e[i]}):Object.assign(n,{[i]:e[i]})}),n}class Z{}let F=(()=>{class t extends Z{constructor(){super(...arguments),this.templateMatcher=/{{\s?([^{}\s]*)\s?}}/g}interpolate(t,e){let n;return n="string"==typeof t?this.interpolateString(t,e):"function"==typeof t?this.interpolateFunction(t,e):t,n}getValue(t,e){let n="string"==typeof e?e.split("."):[e];e="";do{e+=n.shift(),!O(t)||!O(t[e])||"object"!=typeof t[e]&&n.length?n.length?e+=".":t=void 0:(t=t[e],e="")}while(n.length);return t}interpolateFunction(t,e){return t(e)}interpolateString(t,e){return e?t.replace(this.templateMatcher,(t,n)=>{let i=this.getValue(e,n);return O(i)?i:t}):t}}return t.\u0275fac=function(){let e;return function(n){return(e||(e=i.n5z(t)))(n||t)}}(),t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac}),t})();class U{}let N=(()=>{class t extends U{compile(t,e){return t}compileTranslations(t,e){return t}}return t.\u0275fac=function(){let e;return function(n){return(e||(e=i.n5z(t)))(n||t)}}(),t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac}),t})();class B{constructor(){this.currentLang=this.defaultLang,this.translations={},this.langs=[],this.onTranslationChange=new i.vpe,this.onLangChange=new i.vpe,this.onDefaultLangChange=new i.vpe}}const q=new i.OlP("USE_STORE"),$=new i.OlP("USE_DEFAULT_LANG"),V=new i.OlP("DEFAULT_LANGUAGE"),j=new i.OlP("USE_EXTEND");let G=(()=>{class t{constructor(t,e,n,r,o,s=!0,a=!1,l=!1,c){this.store=t,this.currentLoader=e,this.compiler=n,this.parser=r,this.missingTranslationHandler=o,this.useDefaultLang=s,this.isolate=a,this.extend=l,this.pending=!1,this._onTranslationChange=new i.vpe,this._onLangChange=new i.vpe,this._onDefaultLangChange=new i.vpe,this._langs=[],this._translations={},this._translationRequests={},c&&this.setDefaultLang(c)}get onTranslationChange(){return this.isolate?this._onTranslationChange:this.store.onTranslationChange}get onLangChange(){return this.isolate?this._onLangChange:this.store.onLangChange}get onDefaultLangChange(){return this.isolate?this._onDefaultLangChange:this.store.onDefaultLangChange}get defaultLang(){return this.isolate?this._defaultLang:this.store.defaultLang}set defaultLang(t){this.isolate?this._defaultLang=t:this.store.defaultLang=t}get currentLang(){return this.isolate?this._currentLang:this.store.currentLang}set currentLang(t){this.isolate?this._currentLang=t:this.store.currentLang=t}get langs(){return this.isolate?this._langs:this.store.langs}set langs(t){this.isolate?this._langs=t:this.store.langs=t}get translations(){return this.isolate?this._translations:this.store.translations}set translations(t){this.isolate?this._translations=t:this.store.translations=t}setDefaultLang(t){if(t===this.defaultLang)return;let e=this.retrieveTranslations(t);void 0!==e?(null==this.defaultLang&&(this.defaultLang=t),e.pipe((0,S.q)(1)).subscribe(e=>{this.changeDefaultLang(t)})):this.changeDefaultLang(t)}getDefaultLang(){return this.defaultLang}use(t){if(t===this.currentLang)return(0,s.of)(this.translations[t]);let e=this.retrieveTranslations(t);return void 0!==e?(this.currentLang||(this.currentLang=t),e.pipe((0,S.q)(1)).subscribe(e=>{this.changeLang(t)}),e):(this.changeLang(t),(0,s.of)(this.translations[t]))}retrieveTranslations(t){let e;return(void 0===this.translations[t]||this.extend)&&(this._translationRequests[t]=this._translationRequests[t]||this.getTranslation(t),e=this._translationRequests[t]),e}getTranslation(t){this.pending=!0;const e=this.currentLoader.getTranslation(t).pipe(A(1),(0,S.q)(1));return this.loadingTranslations=e.pipe((0,C.U)(e=>this.compiler.compileTranslations(e,t)),A(1),(0,S.q)(1)),this.loadingTranslations.subscribe({next:e=>{this.translations[t]=this.extend&&this.translations[t]?Object.assign(Object.assign({},e),this.translations[t]):e,this.updateLangs(),this.pending=!1},error:t=>{this.pending=!1}}),e}setTranslation(t,e,n=!1){e=this.compiler.compileTranslations(e,t),this.translations[t]=(n||this.extend)&&this.translations[t]?z(this.translations[t],e):e,this.updateLangs(),this.onTranslationChange.emit({lang:t,translations:this.translations[t]})}getLangs(){return this.langs}addLangs(t){t.forEach(t=>{-1===this.langs.indexOf(t)&&this.langs.push(t)})}updateLangs(){this.addLangs(Object.keys(this.translations))}getParsedResult(t,e,n){let i;if(e instanceof Array){let i={},r=!1;for(let s of e)i[s]=this.getParsedResult(t,s,n),o(i[s])&&(r=!0);if(r){const t=e.map(t=>o(i[t])?i[t]:(0,s.of)(i[t]));return(0,a.D)(t).pipe((0,C.U)(t=>{let n={};return t.forEach((t,i)=>{n[e[i]]=t}),n}))}return i}if(t&&(i=this.parser.interpolate(this.parser.getValue(t,e),n)),void 0===i&&null!=this.defaultLang&&this.defaultLang!==this.currentLang&&this.useDefaultLang&&(i=this.parser.interpolate(this.parser.getValue(this.translations[this.defaultLang],e),n)),void 0===i){let t={key:e,translateService:this};void 0!==n&&(t.interpolateParams=n),i=this.missingTranslationHandler.handle(t)}return void 0!==i?i:e}get(t,e){if(!O(t)||!t.length)throw new Error('Parameter "key" required');if(this.pending)return this.loadingTranslations.pipe((0,I.b)(n=>o(n=this.getParsedResult(n,t,e))?n:(0,s.of)(n)));{let n=this.getParsedResult(this.translations[this.currentLang],t,e);return o(n)?n:(0,s.of)(n)}}getStreamOnTranslationChange(t,e){if(!O(t)||!t.length)throw new Error('Parameter "key" required');return(0,l.z)((0,c.P)(()=>this.get(t,e)),this.onTranslationChange.pipe((0,E.w)(n=>{const i=this.getParsedResult(n.translations,t,e);return"function"==typeof i.subscribe?i:(0,s.of)(i)})))}stream(t,e){if(!O(t)||!t.length)throw new Error('Parameter "key" required');return(0,l.z)((0,c.P)(()=>this.get(t,e)),this.onLangChange.pipe((0,E.w)(n=>{const i=this.getParsedResult(n.translations,t,e);return o(i)?i:(0,s.of)(i)})))}instant(t,e){if(!O(t)||!t.length)throw new Error('Parameter "key" required');let n=this.getParsedResult(this.translations[this.currentLang],t,e);if(o(n)){if(t instanceof Array){let e={};return t.forEach((n,i)=>{e[t[i]]=t[i]}),e}return t}return n}set(t,e,n=this.currentLang){this.translations[n][t]=this.compiler.compile(e,n),this.updateLangs(),this.onTranslationChange.emit({lang:n,translations:this.translations[n]})}changeLang(t){this.currentLang=t,this.onLangChange.emit({lang:t,translations:this.translations[t]}),null==this.defaultLang&&this.changeDefaultLang(t)}changeDefaultLang(t){this.defaultLang=t,this.onDefaultLangChange.emit({lang:t,translations:this.translations[t]})}reloadLang(t){return this.resetLang(t),this.getTranslation(t)}resetLang(t){this._translationRequests[t]=void 0,this.translations[t]=void 0}getBrowserLang(){if("undefined"==typeof window||void 0===window.navigator)return;let t=window.navigator.languages?window.navigator.languages[0]:null;return t=t||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,void 0!==t?(-1!==t.indexOf("-")&&(t=t.split("-")[0]),-1!==t.indexOf("_")&&(t=t.split("_")[0]),t):void 0}getBrowserCultureLang(){if("undefined"==typeof window||void 0===window.navigator)return;let t=window.navigator.languages?window.navigator.languages[0]:null;return t=t||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,t}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(B),i.LFG(M),i.LFG(U),i.LFG(Z),i.LFG(P),i.LFG($),i.LFG(q),i.LFG(j),i.LFG(V))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac}),t})(),Y=(()=>{class t{constructor(t,e){this.translate=t,this._ref=e,this.value=""}updateValue(t,e,n){let i=e=>{this.value=void 0!==e?e:t,this.lastKey=t,this._ref.markForCheck()};if(n){let r=this.translate.getParsedResult(n,t,e);o(r.subscribe)?r.subscribe(i):i(r)}this.translate.get(t,e).subscribe(i)}transform(t,...e){if(!t||!t.length)return t;if(L(t,this.lastKey)&&L(e,this.lastParams))return this.value;let n;if(O(e[0])&&e.length)if("string"==typeof e[0]&&e[0].length){let t=e[0].replace(/(\')?([a-zA-Z0-9_]+)(\')?(\s)?:/g,'"$2":').replace(/:(\s)?(\')(.*?)(\')/g,':"$3"');try{n=JSON.parse(t)}catch(i){throw new SyntaxError(`Wrong parameter in TranslatePipe. Expected a valid Object, received: ${e[0]}`)}}else"object"==typeof e[0]&&!Array.isArray(e[0])&&(n=e[0]);return this.lastKey=t,this.lastParams=e,this.updateValue(t,n),this._dispose(),this.onTranslationChange||(this.onTranslationChange=this.translate.onTranslationChange.subscribe(e=>{this.lastKey&&e.lang===this.translate.currentLang&&(this.lastKey=null,this.updateValue(t,n,e.translations))})),this.onLangChange||(this.onLangChange=this.translate.onLangChange.subscribe(e=>{this.lastKey&&(this.lastKey=null,this.updateValue(t,n,e.translations))})),this.onDefaultLangChange||(this.onDefaultLangChange=this.translate.onDefaultLangChange.subscribe(()=>{this.lastKey&&(this.lastKey=null,this.updateValue(t,n))})),this.value}_dispose(){void 0!==this.onTranslationChange&&(this.onTranslationChange.unsubscribe(),this.onTranslationChange=void 0),void 0!==this.onLangChange&&(this.onLangChange.unsubscribe(),this.onLangChange=void 0),void 0!==this.onDefaultLangChange&&(this.onDefaultLangChange.unsubscribe(),this.onDefaultLangChange=void 0)}ngOnDestroy(){this._dispose()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(G,16),i.Y36(i.sBO,16))},t.\u0275pipe=i.Yjl({name:"translate",type:t,pure:!1}),t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac}),t})(),H=(()=>{class t{static forRoot(e={}){return{ngModule:t,providers:[e.loader||{provide:M,useClass:k},e.compiler||{provide:U,useClass:N},e.parser||{provide:Z,useClass:F},e.missingTranslationHandler||{provide:P,useClass:D},B,{provide:q,useValue:e.isolate},{provide:$,useValue:e.useDefaultLang},{provide:j,useValue:e.extend},{provide:V,useValue:e.defaultLanguage},G]}}static forChild(e={}){return{ngModule:t,providers:[e.loader||{provide:M,useClass:k},e.compiler||{provide:U,useClass:N},e.parser||{provide:Z,useClass:F},e.missingTranslationHandler||{provide:P,useClass:D},{provide:q,useValue:e.isolate},{provide:$,useValue:e.useDefaultLang},{provide:j,useValue:e.extend},{provide:V,useValue:e.defaultLanguage},G]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({}),t})()},2958:function(t){t.exports=function(){"use strict";var t,e,n;function i(i,r){if(t)if(e){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk); self.onerror = null;",s={};t(s),n=r(s),"undefined"!=typeof window&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=r;else t=r}return i(0,function(t){var e="2.4.1",n=i;function i(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=n,this.p2y=i}i.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},i.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},i.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},i.prototype.solveCurveX=function(t,e){var n,i,r,o,s;for(void 0===e&&(e=1e-6),r=t,s=0;s<8;s++){if(o=this.sampleCurveX(r)-t,Math.abs(o)<e)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=o/a}if((r=t)<(n=0))return n;if(r>(i=1))return i;for(;n<i;){if(o=this.sampleCurveX(r),Math.abs(o-t)<e)return r;t>o?n=r:i=r,r=.5*(i-n)+n}return r},i.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var r=o;function o(t,e){this.x=t,this.y=e}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),r=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t};var s="undefined"!=typeof self?self:{};const a=Math.pow(2,53)-1,l=Math.PI/180,c=180/Math.PI;function u(t){return t*l}const h=[[0,0],[1,0],[1,1],[0,1]];function d(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function p(t,e,i,r){const o=new n(t,e,i,r);return function(t){return o.solve(t)}}const f=p(.25,.1,.25,1);function m(t,e,n){return Math.min(n,Math.max(e,t))}function g(t,e,n){const i=n-e,r=((t-e)%i+i)%i+e;return r===e?n:r}function y(t,e,n){if(!t.length)return n(null,[]);let i=t.length;const r=new Array(t.length);let o=null;t.forEach((t,s)=>{e(t,(t,e)=>{t&&(o=t),r[s]=e,0==--i&&n(o,r)})})}function _(t){const e=[];for(const n in t)e.push(t[n]);return e}function v(t,...e){for(const n of e)for(const e in n)t[e]=n[e];return t}let x=1;function b(){return x++}function w(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function T(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function A(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function S(t,e){t.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function C(t,e){return-1!==t.indexOf(e,t.length-e.length)}function I(t,e,n){const i={};for(const r in t)i[r]=e.call(n||this,t[r],r,t);return i}function E(t,e,n){const i={};for(const r in t)e.call(n||this,t[r],r,t)&&(i[r]=t[r]);return i}function M(t){return Array.isArray(t)?t.map(M):"object"==typeof t&&t?I(t,M):t}const k={};function P(t){k[t]||("undefined"!=typeof console&&console.warn(t),k[t]=!0)}function D(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function L(t){let e=0;for(let n,i,r=0,o=t.length,s=o-1;r<o;s=r++)n=t[r],i=t[s],e+=(i.x-n.x)*(n.y+i.y);return e}function O(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function R(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,n,i,r)=>{const o=i||r;return e[n]=!o||o.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let z,Z,F,U=null;function N(t){if(null==U){const e=t.navigator?t.navigator.userAgent:null;U=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return U}function B(t){try{const e=s[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(e){return!1}}const q={now:()=>void 0!==F?F:s.performance.now(),setNow(t){F=t},restoreNow(){F=void 0},frame(t){const e=s.requestAnimationFrame(t);return{cancel:()=>s.cancelAnimationFrame(e)}},getImageData(t,e=0){const n=s.document.createElement("canvas"),i=n.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return n.width=t.width,n.height=t.height,i.drawImage(t,0,0,t.width,t.height),i.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(z||(z=s.document.createElement("a")),z.href=t,z.href),get devicePixelRatio(){return s.devicePixelRatio},get prefersReducedMotion(){return!!s.matchMedia&&(null==Z&&(Z=s.matchMedia("(prefers-reduced-motion: reduce)")),Z.matches)}};let $;const V={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==$){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{$=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch(t){$=e}}return $},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},j={supported:!1,testSupport:function(t){!H&&Y&&(J?W(t):G=t)}};let G,Y,H=!1,J=!1;function W(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Y),t.isContextLost())return;j.supported=!0}catch(n){}t.deleteTexture(e),H=!0}s.document&&(Y=s.document.createElement("img"),Y.onload=function(){G&&W(G),G=null,J=!0},Y.onerror=function(){H=!0,G=null},Y.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const X="01",Q="NO_ACCESS_TOKEN";function K(t){return 0===t.indexOf("mapbox:")}function tt(t){return V.API_URL_REGEX.test(t)}const et=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function nt(t){const e=t.match(et);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function it(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function rt(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(s.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(n){return null}}class ot{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const e=rt(V.ACCESS_TOKEN);let n="";return n=e&&e.u?s.btoa(encodeURIComponent(e.u).replace(/%([0-9A-F]{2})/g,(t,e)=>String.fromCharCode(Number("0x"+e)))):V.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const t=B("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{const t=s.localStorage.getItem(e);t&&(this.eventData=JSON.parse(t));const i=s.localStorage.getItem(n);i&&(this.anonId=i)}catch(i){P("Unable to read from LocalStorage")}}saveEventData(){const t=B("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{s.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&s.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(i){P("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,i,r){if(!V.EVENTS_URL)return;const o=nt(V.EVENTS_URL);o.params.push(`access_token=${r||V.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:e,skuId:X,userId:this.anonId},a=n?v(s,n):s,l={url:it(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=Ct(l,t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(r)})}queueRequest(t,e){this.queue.push(t),this.processRequests(e)}}const st=new class extends ot{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){V.EVENTS_URL&&V.ACCESS_TOKEN&&Array.isArray(t)&&t.some(t=>K(t)||tt(t))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=rt(V.ACCESS_TOKEN),n=e?e.u:V.ACCESS_TOKEN;let i=n!==this.eventData.tokenU;A(this.anonId)||(this.anonId=w(),i=!0);const r=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),e=new Date(r),n=(r-this.eventData.lastSuccess)/864e5;i=i||n>=1||n<-1||t.getDate()!==e.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(r,{"enabled.telemetry":!1},t=>{t||(this.eventData.lastSuccess=r,this.eventData.tokenU=n)},t)}},at=st.postTurnstileEvent.bind(st),lt=new class extends ot{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,i){this.skuToken=e,this.errorCb=i,V.EVENTS_URL&&(n||V.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Q)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),A(this.anonId)||(this.anonId=w()),this.postEvent(n,{skuToken:this.skuToken},t=>{t?this.errorCb(t):e&&(this.success[e]=!0)},t))}},ct=lt.postMapLoadEvent.bind(lt),ut=new class extends ot{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,i){if(!V.API_URL||!V.SESSION_PATH)return;const r=nt(V.API_URL+V.SESSION_PATH);r.params.push(`sku=${e||""}`),r.params.push(`access_token=${i||V.ACCESS_TOKEN||""}`);const o={url:it(r),headers:{"Content-Type":"text/plain"}};this.pendingRequest=It(o,t=>{this.pendingRequest=null,n(t),this.saveEventData(),this.processRequests(i)})}getSessionAPI(t,e,n,i){this.skuToken=e,this.errorCb=i,V.SESSION_PATH&&V.API_URL&&(n||V.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Q)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,t=>{t?this.errorCb(t):e&&(this.success[e]=!0)},t)}},ht=ut.getSessionAPI.bind(ut),dt=new Set,pt="mapbox-tiles";let ft,mt,gt=500,yt=50;function _t(){s.caches&&!ft&&(ft=s.caches.open(pt))}function vt(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}let xt=1/0;const bt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(bt);class wt extends Error{constructor(t,e,n){401===e&&tt(n)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Tt=O()?()=>self.worker&&self.worker.referrer:()=>("blob:"===s.location.protocol?s.parent:s).location.href,At=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Tt())&&!/^\w+:/.test(n))){if(s.fetch&&s.Request&&s.AbortController&&s.Request.prototype.hasOwnProperty("signal"))return function(t,e){const n=new s.AbortController,i=new s.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:Tt(),signal:n.signal});let r=!1,o=!1;const a=(l=i.url).indexOf("sku=")>0&&tt(l);var l;"json"===t.type&&i.headers.set("Accept","application/json");const c=(n,r,l)=>{if(o)return;if(n&&"SecurityError"!==n.message&&P(n),r&&l)return u(r);const c=Date.now();s.fetch(i).then(n=>{if(n.ok){const t=a?n.clone():null;return u(n,t,c)}return e(new wt(n.statusText,n.status,t.url))}).catch(t=>{20!==t.code&&e(new Error(t.message))})},u=(n,a,l)=>{("arrayBuffer"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text()).then(t=>{o||(a&&l&&function(t,e,n){if(_t(),!ft)return;const i={status:e.status,statusText:e.statusText,headers:new s.Headers};e.headers.forEach((t,e)=>i.headers.set(e,t));const r=R(e.headers.get("Cache-Control")||"");r["no-store"]||(r["max-age"]&&i.headers.set("Expires",new Date(n+1e3*r["max-age"]).toUTCString()),new Date(i.headers.get("Expires")).getTime()-n<42e4||function(t,e){if(void 0===mt)try{new Response(new ReadableStream),mt=!0}catch(n){mt=!1}mt?e(t.body):t.blob().then(e)}(e,e=>{const n=new s.Response(e,i);_t(),ft&&ft.then(e=>e.put(vt(t.url),n)).catch(t=>P(t.message))}))}(i,a,l),r=!0,e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires")))}).catch(t=>{o||e(new Error(t.message))})};return a?function(t,e){if(_t(),!ft)return e(null);const n=vt(t.url);ft.then(t=>{t.match(n).then(i=>{const r=function(t){if(!t)return!1;const e=new Date(t.headers.get("Expires")||0),n=R(t.headers.get("Cache-Control")||"");return e>Date.now()&&!n["no-cache"]}(i);t.delete(n),r&&t.put(n,i.clone()),e(null,i,r)}).catch(e)}).catch(e)}(i,c):c(null,null),{cancel:()=>{o=!0,r||n.abort()}}}(t,e);if(O()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(t,e){const n=new s.XMLHttpRequest;n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer");for(const i in t.headers)n.setRequestHeader(i,t.headers[i]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=()=>{e(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let r=n.response;if("json"===t.type)try{r=JSON.parse(n.response)}catch(i){return e(i)}e(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else e(new wt(n.statusText,n.status,t.url))},n.send(t.body),{cancel:()=>n.abort()}}(t,e)},St=function(t,e){return At(v(t,{type:"arrayBuffer"}),e)},Ct=function(t,e){return At(v(t,{method:"POST"}),e)},It=function(t,e){return At(v(t,{method:"GET"}),e)};function Et(t){const e=s.document.createElement("a");return e.href=t,e.protocol===s.document.location.protocol&&e.host===s.document.location.host}const Mt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let kt,Pt;kt=[],Pt=0;const Dt=function(t,e){if(j.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Pt>=V.MAX_PARALLEL_IMAGE_REQUESTS){const n={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return kt.push(n),n}Pt++;let n=!1;const i=()=>{if(!n)for(n=!0,Pt--;kt.length&&Pt<V.MAX_PARALLEL_IMAGE_REQUESTS;){const t=kt.shift(),{requestParameters:e,callback:n,cancelled:i}=t;i||(t.cancel=Dt(e,n).cancel)}},r=St(t,(t,n,r,o)=>{i(),t?e(t):n&&(s.createImageBitmap?function(t,e){const n=new s.Blob([new Uint8Array(t)],{type:"image/png"});s.createImageBitmap(n).then(t=>{e(null,t)}).catch(t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(n,(t,n)=>e(t,n,r,o)):function(t,e){const n=new s.Image,i=s.URL;n.onload=()=>{e(null,n),i.revokeObjectURL(n.src),n.onload=null,s.requestAnimationFrame(()=>{n.src=Mt})},n.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new s.Blob([new Uint8Array(t)],{type:"image/png"});n.src=t.byteLength?i.createObjectURL(r):Mt}(n,(t,n)=>e(t,n,r,o)))});return{cancel:()=>{r.cancel(),i()}}};function Lt(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Ot(t,e,n){if(n&&n[t]){const i=n[t].indexOf(e);-1!==i&&n[t].splice(i,1)}}class Rt{constructor(t,e={}){v(this,e),this.type=t}}class zt extends Rt{constructor(t,e={}){super("error",v({error:t},e))}}class Zt{on(t,e){return this._listeners=this._listeners||{},Lt(t,e,this._listeners),this}off(t,e){return Ot(t,e,this._listeners),Ot(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Lt(t,e,this._oneTimeListeners),this):new Promise(e=>this.once(t,e))}fire(t,e){"string"==typeof t&&(t=new Rt(t,e||{}));const n=t.type;if(this.listens(n)){t.target=this;const e=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of e)n.call(this,t);const i=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const o of i)Ot(n,o,this._oneTimeListeners),o.call(this,t);const r=this._eventedParent;r&&(v(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(t))}else t instanceof zt&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var Ft={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Ut{constructor(t,e,n,i){this.message=(t?`${t}: `:"")+n,i&&(this.identifier=i),null!=e&&e.__line__&&(this.line=e.__line__)}}function Nt(t){const e=t.value;return e?[new Ut(t.key,e,"constants have been deprecated as of v8")]:[]}function Bt(t,...e){for(const n of e)for(const e in n)t[e]=n[e];return t}function qt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function $t(t){if(Array.isArray(t))return t.map($t);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=$t(t[n]);return e}return qt(t)}class Vt extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class jt{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[n,i]of e)this.bindings[n]=i}concat(t){return new jt(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Gt={kind:"null"},Yt={kind:"number"},Ht={kind:"string"},Jt={kind:"boolean"},Wt={kind:"color"},Xt={kind:"object"},Qt={kind:"value"},Kt={kind:"collator"},te={kind:"formatted"},ee={kind:"resolvedImage"};function ne(t,e){return{kind:"array",itemType:t,N:e}}function ie(t){if("array"===t.kind){const e=ie(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const re=[Gt,Yt,Ht,Jt,Wt,te,Xt,ne(Qt),ee];function oe(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!oe(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of re)if(!oe(t,e))return null}return`Expected ${ie(t)} but found ${ie(e)} instead.`}function se(t,e){return e.some(e=>e.kind===t.kind)}function ae(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}function le(t){var e={exports:{}};return t(e,e.exports),e.exports}var ce=le(function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(t){return(t=Math.round(t))<0?0:t>255?255:t}function r(t){return i("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function s(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,a=t.replace(/ /g,"").toLowerCase();if(a in n)return n[a].slice();if("#"===a[0])return 4===a.length?(e=parseInt(a.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===a.length&&(e=parseInt(a.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=a.indexOf("("),c=a.indexOf(")");if(-1!==l&&c+1===a.length){var u=a.substr(0,l),h=a.substr(l+1,c-(l+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=o(h.pop());case"rgb":return 3!==h.length?null:[r(h[0]),r(h[1]),r(h[2]),d];case"hsla":if(4!==h.length)return null;d=o(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,f=o(h[1]),m=o(h[2]),g=m<=.5?m*(f+1):m+f-m*f,y=2*m-g;return[i(255*s(y,g,p+1/3)),i(255*s(y,g,p)),i(255*s(y,g,p-1/3)),d];default:return null}}return null}}catch(a){}});class ue{constructor(t,e,n,i=1){this.r=t,this.g=e,this.b=n,this.a=i}static parse(t){if(!t)return;if(t instanceof ue)return t;if("string"!=typeof t)return;const e=ce.parseCSSColor(t);return e?new ue(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,n,i]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(n)},${i})`}toArray(){const{r:t,g:e,b:n,a:i}=this;return 0===i?[0,0,0,0]:[255*t/i,255*e/i,255*n/i,i]}}ue.black=new ue(0,0,0,1),ue.white=new ue(1,1,1,1),ue.transparent=new ue(0,0,0,0),ue.red=new ue(1,0,0,1),ue.blue=new ue(0,0,1,1);class he{constructor(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class de{constructor(t,e,n,i,r){this.text=t,this.image=e,this.scale=n,this.fontStack=i,this.textColor=r}}class pe{constructor(t){this.sections=t}static fromString(t){return new pe([new de(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof pe?t:pe.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const n={};e.fontStack&&(n["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(n["font-scale"]=e.scale),e.textColor&&(n["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(n)}return t}}class fe{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new fe({name:t,available:!1}):null}serialize(){return["image",this.name]}}function me(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[t,e,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ge(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof ue||t instanceof he||t instanceof pe||t instanceof fe)return!0;if(Array.isArray(t)){for(const e of t)if(!ge(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!ge(t[e]))return!1;return!0}return!1}function ye(t){if(null===t)return Gt;if("string"==typeof t)return Ht;if("boolean"==typeof t)return Jt;if("number"==typeof t)return Yt;if(t instanceof ue)return Wt;if(t instanceof he)return Kt;if(t instanceof pe)return te;if(t instanceof fe)return ee;if(Array.isArray(t)){const e=t.length;let n;for(const i of t){const t=ye(i);if(n){if(n===t)continue;n=Qt;break}n=t}return ne(n||Qt,e)}return Xt}function _e(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ue||t instanceof pe||t instanceof fe?t.toString():JSON.stringify(t)}class ve{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ge(t[1]))return e.error("invalid value");const n=t[1];let i=ye(n);const r=e.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new ve(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ue?["rgba"].concat(this.value.toArray()):this.value instanceof pe?this.value.serialize():this.value}}class xe{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const be={string:Ht,number:Yt,boolean:Jt,object:Xt};class we{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n,i=1;const r=t[0];if("array"===r){let r,o;if(t.length>2){const n=t[1];if("string"!=typeof n||!(n in be)||"object"===n)return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=be[n],i++}else r=Qt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],i++}n=ne(r,o)}else n=be[r];const o=[];for(;i<t.length;i++){const n=e.parse(t[i],i,Qt);if(!n)return null;o.push(n)}return new we(n,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const n=this.args[e].evaluate(t);if(!oe(this.type,ye(n)))return n;if(e===this.args.length-1)throw new xe(`Expected value to be of type ${ie(this.type)}, but found ${ie(ye(n))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);const i=t.N;("number"==typeof i||this.args.length>1)&&e.push(i)}}return e.concat(this.args.map(t=>t.serialize()))}}class Te{constructor(t){this.type=te,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");const i=[];let r=!1;for(let o=1;o<=t.length-1;++o){const n=t[o];if(r&&"object"==typeof n&&!Array.isArray(n)){r=!1;let t=null;if(n["font-scale"]&&(t=e.parse(n["font-scale"],1,Yt),!t))return null;let o=null;if(n["text-font"]&&(o=e.parse(n["text-font"],1,ne(Ht)),!o))return null;let s=null;if(n["text-color"]&&(s=e.parse(n["text-color"],1,Wt),!s))return null;const a=i[i.length-1];a.scale=t,a.font=o,a.textColor=s}else{const n=e.parse(t[o],1,Qt);if(!n)return null;const s=n.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:n,scale:null,font:null,textColor:null})}}return new Te(i)}evaluate(t){return new pe(this.sections.map(e=>{const n=e.content.evaluate(t);return ye(n)===ee?new de("",n,null,null,null):new de(_e(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)}))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const n={};e.scale&&(n["font-scale"]=e.scale.serialize()),e.font&&(n["text-font"]=e.font.serialize()),e.textColor&&(n["text-color"]=e.textColor.serialize()),t.push(n)}return t}}class Ae{constructor(t){this.type=ee,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,Ht);return n?new Ae(n):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),n=fe.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Se={"to-boolean":Jt,"to-color":Wt,"to-number":Yt,"to-string":Ht};class Ce{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");const i=Se[n],r=[];for(let o=1;o<t.length;o++){const n=e.parse(t[o],o,Qt);if(!n)return null;r.push(n)}return new Ce(i,r)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,n;for(const i of this.args){if(e=i.evaluate(t),n=null,e instanceof ue)return e;if("string"==typeof e){const n=t.parseColor(e);if(n)return n}else if(Array.isArray(e)&&(n=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:me(e[0],e[1],e[2],e[3]),!n))return new ue(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new xe(n||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const n of this.args){if(e=n.evaluate(t),null===e)return 0;const i=Number(e);if(!isNaN(i))return i}throw new xe(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?pe.fromString(_e(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?fe.fromString(_e(this.args[0].evaluate(t))):_e(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Te([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ae(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(e=>{t.push(e.serialize())}),t}}const Ie=["Unknown","Point","LineString","Polygon"];class Ee{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ie[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ue.parse(t)),e}}class Me{constructor(t,e,n,i){this.name=t,this.type=e,this._evaluate=n,this.args=i}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,e){const n=t[0],i=Me.definitions[n];if(!i)return e.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=o.filter(([e])=>!Array.isArray(e)||e.length===t.length-1);let a=null;for(const[l,c]of s){a=new Qe(e.registry,e.path,null,e.scope);const i=[];let o=!1;for(let e=1;e<t.length;e++){const n=t[e],r=Array.isArray(l)?l[e-1]:l.type,s=a.parse(n,1+i.length,r);if(!s){o=!0;break}i.push(s)}if(!o)if(Array.isArray(l)&&l.length!==i.length)a.error(`Expected ${l.length} arguments, but found ${i.length} instead.`);else{for(let t=0;t<i.length;t++){const e=Array.isArray(l)?l[t]:l.type,n=i[t];a.concat(t+1).checkSubtype(e,n.type)}if(0===a.errors.length)return new Me(n,r,c,i)}}if(1===s.length)e.errors.push(...a.errors);else{const n=(s.length?s:o).map(([t])=>{return e=t,Array.isArray(e)?`(${e.map(ie).join(", ")})`:`(${ie(e.type)}...)`;var e}).join(" | "),i=[];for(let r=1;r<t.length;r++){const n=e.parse(t[r],1+i.length);if(!n)return null;i.push(ie(n.type))}e.error(`Expected arguments of type ${n}, but found (${i.join(", ")}) instead.`)}return null}static register(t,e){Me.definitions=e;for(const n in e)t[n]=Me}}class ke{constructor(t,e,n){this.type=Kt,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");const i=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Jt);if(!i)return null;const r=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Jt);if(!r)return null;let o=null;return n.locale&&(o=e.parse(n.locale,1,Ht),!o)?null:new ke(i,r,o)}evaluate(t){return new he(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const Pe=8192;function De(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Le(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Oe(t,e){const n=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(n*r*Pe),Math.round(i*r*Pe)]}function Re(t,e,n){const i=t[0]-e[0],r=t[1]-e[1],o=t[0]-n[0],s=t[1]-n[1];return i*s-o*r==0&&i*o<=0&&r*s<=0}function ze(t,e){let n=!1;for(let s=0,a=e.length;s<a;s++){const a=e[s];for(let e=0,s=a.length;e<s-1;e++){if(Re(t,a[e],a[e+1]))return!1;(r=a[e])[1]>(i=t)[1]!=(o=a[e+1])[1]>i[1]&&i[0]<(o[0]-r[0])*(i[1]-r[1])/(o[1]-r[1])+r[0]&&(n=!n)}}var i,r,o;return n}function Ze(t,e){for(let n=0;n<e.length;n++)if(ze(t,e[n]))return!0;return!1}function Fe(t,e,n,i){const r=i[0]-n[0],o=i[1]-n[1],s=(t[0]-n[0])*o-r*(t[1]-n[1]),a=(e[0]-n[0])*o-r*(e[1]-n[1]);return s>0&&a<0||s<0&&a>0}function Ue(t,e,n){for(const c of n)for(let n=0;n<c.length-1;++n)if((a=[(s=c[n+1])[0]-(o=c[n])[0],s[1]-o[1]])[0]*(l=[(r=e)[0]-(i=t)[0],r[1]-i[1]])[1]-a[1]*l[0]!=0&&Fe(i,r,o,s)&&Fe(o,s,i,r))return!0;var i,r,o,s,a,l;return!1}function Ne(t,e){for(let n=0;n<t.length;++n)if(!ze(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Ue(t[n],t[n+1],e))return!1;return!0}function Be(t,e){for(let n=0;n<e.length;n++)if(Ne(t,e[n]))return!0;return!1}function qe(t,e,n){const i=[];for(let r=0;r<t.length;r++){const o=[];for(let i=0;i<t[r].length;i++){const s=Oe(t[r][i],n);De(e,s),o.push(s)}i.push(o)}return i}function $e(t,e,n){const i=[];for(let r=0;r<t.length;r++){const o=qe(t[r],e,n);i.push(o)}return i}function Ve(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){const e=.5*i;let r=t[0]-n[0]>e?-i:n[0]-t[0]>e?i:0;0===r&&(r=t[0]-n[2]>e?-i:n[2]-t[0]>e?i:0),t[0]+=r}De(e,t)}function je(t,e,n,i){const r=Math.pow(2,i.z)*Pe,o=[i.x*Pe,i.y*Pe],s=[];for(const a of t)for(const t of a){const i=[t.x+o[0],t.y+o[1]];Ve(i,e,n,r),s.push(i)}return s}function Ge(t,e,n,i){const r=Math.pow(2,i.z)*Pe,o=[i.x*Pe,i.y*Pe],s=[];for(const l of t){const t=[];for(const n of l){const i=[n.x+o[0],n.y+o[1]];De(e,i),t.push(i)}s.push(t)}if(e[2]-e[0]<=r/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const i of t)Ve(i,e,n,r)}var a;return s}class Ye{constructor(t,e){this.type=Jt,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ge(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const n=e.features[t].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new Ye(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Ye(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Ye(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const o=qe(e.coordinates,i,r),s=je(t.geometry(),n,i,r);if(!Le(n,i))return!1;for(const t of s)if(!ze(t,o))return!1}if("MultiPolygon"===e.type){const o=$e(e.coordinates,i,r),s=je(t.geometry(),n,i,r);if(!Le(n,i))return!1;for(const t of s)if(!Ze(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const o=qe(e.coordinates,i,r),s=Ge(t.geometry(),n,i,r);if(!Le(n,i))return!1;for(const t of s)if(!Ne(t,o))return!1}if("MultiPolygon"===e.type){const o=$e(e.coordinates,i,r),s=Ge(t.geometry(),n,i,r);if(!Le(n,i))return!1;for(const t of s)if(!Be(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function He(t){if(t instanceof Me&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof Ye)return!1;let e=!0;return t.eachChild(t=>{e&&!He(t)&&(e=!1)}),e}function Je(t){if(t instanceof Me&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(t=>{e&&!Je(t)&&(e=!1)}),e}function We(t,e){if(t instanceof Me&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(t=>{n&&!We(t,e)&&(n=!1)}),n}class Xe{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const n=t[1];return e.scope.has(n)?new Xe(n,e.scope.get(n)):e.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Qe{constructor(t,e=[],n,i=new jt,r=[]){this.registry=t,this.path=e,this.key=e.map(t=>`[${t}]`).join(""),this.scope=i,this.errors=r,this.expectedType=n}parse(t,e,n,i,r={}){return e?this.concat(e,n,i)._parse(t,r):this._parse(t,r)}_parse(t,e){function n(t,e,n){return"assert"===n?new we(e,[t]):"coerce"===n?new Ce(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=t[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const o=this.registry[r];if(o){let r=o.parse(t,this);if(!r)return null;if(this.expectedType){const t=this.expectedType,i=r.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==i.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(t,i))return null}else r=n(r,t,e.typeAnnotation||"coerce");else r=n(r,t,e.typeAnnotation||"assert")}if(!(r instanceof ve)&&"resolvedImage"!==r.type.kind&&Ke(r)){const t=new Ee;try{r=new ve(r.type,r.evaluate(t))}catch(i){return this.error(i.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,n){const i="number"==typeof t?this.path.concat(t):this.path,r=n?this.scope.concat(n):this.scope;return new Qe(this.registry,i,e||null,r,this.errors)}error(t,...e){const n=`${this.key}${e.map(t=>`[${t}]`).join("")}`;this.errors.push(new Vt(n,t))}checkSubtype(t,e){const n=oe(t,e);return n&&this.error(n),n}}function Ke(t){if(t instanceof Xe)return Ke(t.boundExpression);if(t instanceof Me&&"error"===t.name||t instanceof ke||t instanceof Ye)return!1;const e=t instanceof Ce||t instanceof we;let n=!0;return t.eachChild(t=>{n=e?n&&Ke(t):n&&t instanceof ve}),!!n&&He(t)&&We(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}function tn(t,e){const n=t.length-1;let i,r,o=0,s=n,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),i=t[a],r=t[a+1],i<=e){if(a===n||e<r)return a;o=a+1}else{if(!(i>e))throw new xe("Input is not a number.");s=a-1}return 0}class en{constructor(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[i,r]of n)this.labels.push(i),this.outputs.push(r)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const n=e.parse(t[1],1,Yt);if(!n)return null;const i=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let o=1;o<t.length;o+=2){const n=1===o?-1/0:t[o],s=t[o+1],a=o,l=o+1;if("number"!=typeof n)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(i.length&&i[i.length-1][0]>=n)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(s,l,r);if(!c)return null;r=r||c.type,i.push([n,c])}return new en(r,n,i)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;return i>=e[r-1]?n[r-1].evaluate(t):n[tn(e,i)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}function nn(t,e,n){return t*(1-n)+e*n}var rn=Object.freeze({__proto__:null,number:nn,color:function(t,e,n){return new ue(nn(t.r,e.r,n),nn(t.g,e.g,n),nn(t.b,e.b,n),nn(t.a,e.a,n))},array:function(t,e,n){return t.map((t,i)=>nn(t,e[i],n))}});const on=4/29,sn=6/29,an=3*sn*sn,ln=Math.PI/180,cn=180/Math.PI;function un(t){return t>.008856451679035631?Math.pow(t,1/3):t/an+on}function hn(t){return t>sn?t*t*t:an*(t-on)}function dn(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function pn(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function fn(t){const e=pn(t.r),n=pn(t.g),i=pn(t.b),r=un((.4124564*e+.3575761*n+.1804375*i)/.95047),o=un((.2126729*e+.7151522*n+.072175*i)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-un((.0193339*e+.119192*n+.9503041*i)/1.08883)),alpha:t.a}}function mn(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*hn(e),n=.95047*hn(n),i=1.08883*hn(i),new ue(dn(3.2404542*n-1.5371385*e-.4985314*i),dn(-.969266*n+1.8760108*e+.041556*i),dn(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}function gn(t,e,n){const i=e-t;return t+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const yn={forward:fn,reverse:mn,interpolate:function(t,e,n){return{l:nn(t.l,e.l,n),a:nn(t.a,e.a,n),b:nn(t.b,e.b,n),alpha:nn(t.alpha,e.alpha,n)}}},_n={forward:function(t){const{l:e,a:n,b:i}=fn(t),r=Math.atan2(i,n)*cn;return{h:r<0?r+360:r,c:Math.sqrt(n*n+i*i),l:e,alpha:t.a}},reverse:function(t){const e=t.h*ln,n=t.c;return mn({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:gn(t.h,e.h,n),c:nn(t.c,e.c,n),l:nn(t.l,e.l,n),alpha:nn(t.alpha,e.alpha,n)}}};var vn=Object.freeze({__proto__:null,lab:yn,hcl:_n});class xn{constructor(t,e,n,i,r){this.type=t,this.operator=e,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[o,s]of r)this.labels.push(o),this.outputs.push(s)}static interpolationFactor(t,e,i,r){let o=0;if("exponential"===t.name)o=bn(e,t.base,i,r);else if("linear"===t.name)o=bn(e,1,i,r);else if("cubic-bezier"===t.name){const s=t.controlPoints;o=new n(s[0],s[1],s[2],s[3]).solve(bn(e,1,i,r))}return o}static parse(t,e){let[n,i,r,...o]=t;if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const t=i[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:t}}else{if("cubic-bezier"!==i[0])return e.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const t=i.slice(1);if(4!==t.length||t.some(t=>"number"!=typeof t||t<0||t>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,Yt),!r)return null;const s=[];let a=null;"interpolate-hcl"===n||"interpolate-lab"===n?a=Wt:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let l=0;l<o.length;l+=2){const t=o[l],n=o[l+1],i=l+3,r=l+4;if("number"!=typeof t)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(s.length&&s[s.length-1][0]>=t)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=e.parse(n,r,a);if(!c)return null;a=a||c.type,s.push([t,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new xn(a,n,i,r,s):e.error(`Type ${ie(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;if(i>=e[r-1])return n[r-1].evaluate(t);const o=tn(e,i),s=xn.interpolationFactor(this.interpolation,i,e[o],e[o+1]),a=n[o].evaluate(t),l=n[o+1].evaluate(t);return"interpolate"===this.operator?rn[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?_n.reverse(_n.interpolate(_n.forward(a),_n.forward(l),s)):yn.reverse(yn.interpolate(yn.forward(a),yn.forward(l),s))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e}}function bn(t,e,n,i){const r=i-n,o=t-n;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}class wn{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let n=null;const i=e.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const s of t.slice(1)){const t=e.parse(s,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!t)return null;n=n||t.type,r.push(t)}const o=i&&r.some(t=>oe(i,t.type));return new wn(o?Qt:n,r)}evaluate(t){let e,n=null,i=0;for(const r of this.args)if(i++,n=r.evaluate(t),n&&n instanceof fe&&!n.available&&(e||(e=n.name),n=null,i===this.args.length&&(n=e)),null!==n)break;return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class Tn{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const n=[];for(let r=1;r<t.length-1;r+=2){const i=t[r];if("string"!=typeof i)return e.error(`Expected string, but found ${typeof i} instead.`,r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=e.parse(t[r+1],r+1);if(!o)return null;n.push([i,o])}const i=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return i?new Tn(n,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,n]of this.bindings)t.push(e,n.serialize());return t.push(this.result.serialize()),t}}class An{constructor(t,e,n){this.type=t,this.index=e,this.input=n}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Yt),i=e.parse(t[2],2,ne(e.expectedType||Qt));return n&&i?new An(i.type.itemType,n,i):null}evaluate(t){const e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new xe(`Array index out of bounds: ${e} < 0.`);if(e>=n.length)throw new xe(`Array index out of bounds: ${e} > ${n.length-1}.`);if(e!==Math.floor(e))throw new xe(`Array index must be an integer, but found ${e} instead.`);return n[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Sn{constructor(t,e){this.type=Jt,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Qt),i=e.parse(t[2],2,Qt);return n&&i?se(n.type,[Jt,Ht,Yt,Gt,Qt])?new Sn(n,i):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${ie(n.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!ae(e,["boolean","string","number","null"]))throw new xe(`Expected first argument to be of type boolean, string, number or null, but found ${ie(ye(e))} instead.`);if(!ae(n,["string","array"]))throw new xe(`Expected second argument to be of type array or string, but found ${ie(ye(n))} instead.`);return n.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Cn{constructor(t,e,n){this.type=Yt,this.needle=t,this.haystack=e,this.fromIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Qt),i=e.parse(t[2],2,Qt);if(!n||!i)return null;if(!se(n.type,[Jt,Ht,Yt,Gt,Qt]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${ie(n.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,Yt);return r?new Cn(n,i,r):null}return new Cn(n,i)}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!ae(e,["boolean","string","number","null"]))throw new xe(`Expected first argument to be of type boolean, string, number or null, but found ${ie(ye(e))} instead.`);if(!ae(n,["string","array"]))throw new xe(`Expected second argument to be of type array or string, but found ${ie(ye(n))} instead.`);if(this.fromIndex){const i=this.fromIndex.evaluate(t);return n.indexOf(e,i)}return n.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class In{constructor(t,e,n,i,r,o){this.inputType=t,this.type=e,this.input=n,this.cases=i,this.outputs=r,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let n,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const r={},o=[];for(let l=2;l<t.length-1;l+=2){let s=t[l];const a=t[l+1];Array.isArray(s)||(s=[s]);const c=e.concat(l);if(0===s.length)return c.error("Expected at least one branch label.");for(const t of s){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,ye(t)))return null}else n=ye(t);if(void 0!==r[String(t)])return c.error("Branch labels must be unique.");r[String(t)]=o.length}const u=e.parse(a,l,i);if(!u)return null;i=i||u.type,o.push(u)}const s=e.parse(t[1],1,Qt);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,i);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(n,s.type)?null:new In(n,i,s,r,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(ye(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),n=[],i={};for(const o of e){const t=i[this.cases[o]];void 0===t?(i[this.cases[o]]=n.length,n.push([this.cases[o],[o]])):n[t][1].push(o)}const r=t=>"number"===this.inputType.kind?Number(t):t;for(const[o,s]of n)t.push(1===s.length?r(s[0]):s.map(r)),t.push(this.outputs[o].serialize());return t.push(this.otherwise.serialize()),t}}class En{constructor(t,e,n){this.type=t,this.branches=e,this.otherwise=n}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const i=[];for(let o=1;o<t.length-1;o+=2){const r=e.parse(t[o],o,Jt);if(!r)return null;const s=e.parse(t[o+1],o+1,n);if(!s)return null;i.push([r,s]),n=n||s.type}const r=e.parse(t[t.length-1],t.length-1,n);return r?new En(n,i,r):null}evaluate(t){for(const[e,n]of this.branches)if(e.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,n]of this.branches)t(e),t(n);t(this.otherwise)}outputDefined(){return this.branches.every(([t,e])=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class Mn{constructor(t,e,n,i){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Qt),i=e.parse(t[2],2,Yt);if(!n||!i)return null;if(!se(n.type,[ne(Qt),Ht,Qt]))return e.error(`Expected first argument to be of type array or string, but found ${ie(n.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,Yt);return r?new Mn(n.type,n,i,r):null}return new Mn(n.type,n,i)}evaluate(t){const e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!ae(e,["string","array"]))throw new xe(`Expected first argument to be of type array or string, but found ${ie(ye(e))} instead.`);if(this.endIndex){const i=this.endIndex.evaluate(t);return e.slice(n,i)}return e.slice(n)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function kn(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Pn(t,e,n,i){return 0===i.compare(e,n)}function Dn(t,e,n){const i="=="!==t&&"!="!==t;return class r{constructor(t,e,n){this.type=Jt,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const n=t[0];let o=e.parse(t[1],1,Qt);if(!o)return null;if(!kn(n,o.type))return e.concat(1).error(`"${n}" comparisons are not supported for type '${ie(o.type)}'.`);let s=e.parse(t[2],2,Qt);if(!s)return null;if(!kn(n,s.type))return e.concat(2).error(`"${n}" comparisons are not supported for type '${ie(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${ie(o.type)}' and '${ie(s.type)}'.`);i&&("value"===o.type.kind&&"value"!==s.type.kind?o=new we(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new we(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,Kt),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const e=ye(o),n=ye(s);if(e.kind!==n.kind||"string"!==e.kind&&"number"!==e.kind)throw new xe(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${n.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const t=ye(o),n=ye(s);if("string"!==t.kind||"string"!==n.kind)return e(r,o,s)}return this.collator?n(r,o,s,this.collator.evaluate(r)):e(r,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild(t=>{e.push(t.serialize())}),e}}}const Ln=Dn("==",function(t,e,n){return e===n},Pn),On=Dn("!=",function(t,e,n){return e!==n},function(t,e,n,i){return!Pn(0,e,n,i)}),Rn=Dn("<",function(t,e,n){return e<n},function(t,e,n,i){return i.compare(e,n)<0}),zn=Dn(">",function(t,e,n){return e>n},function(t,e,n,i){return i.compare(e,n)>0}),Zn=Dn("<=",function(t,e,n){return e<=n},function(t,e,n,i){return i.compare(e,n)<=0}),Fn=Dn(">=",function(t,e,n){return e>=n},function(t,e,n,i){return i.compare(e,n)>=0});class Un{constructor(t,e,n,i,r){this.type=Ht,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,Yt);if(!n)return null;const i=t[2];if("object"!=typeof i||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=e.parse(i.locale,1,Ht),!r))return null;let o=null;if(i.currency&&(o=e.parse(i.currency,1,Ht),!o))return null;let s=null;if(i["min-fraction-digits"]&&(s=e.parse(i["min-fraction-digits"],1,Yt),!s))return null;let a=null;return i["max-fraction-digits"]&&(a=e.parse(i["max-fraction-digits"],1,Yt),!a)?null:new Un(n,r,o,s,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Nn{constructor(t){this.type=Yt,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error(`Expected argument of type string or array, but found ${ie(n.type)} instead.`):new Nn(n):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e||Array.isArray(e))return e.length;throw new xe(`Expected value to be of type string or array, but found ${ie(ye(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(e=>{t.push(e.serialize())}),t}}const Bn={"==":Ln,"!=":On,">":zn,"<":Rn,">=":Fn,"<=":Zn,array:we,at:An,boolean:we,case:En,coalesce:wn,collator:ke,format:Te,image:Ae,in:Sn,"index-of":Cn,interpolate:xn,"interpolate-hcl":xn,"interpolate-lab":xn,length:Nn,let:Tn,literal:ve,match:In,number:we,"number-format":Un,object:we,slice:Mn,step:en,string:we,"to-boolean":Ce,"to-color":Ce,"to-number":Ce,"to-string":Ce,var:Xe,within:Ye};function qn(t,[e,n,i,r]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);const o=r?r.evaluate(t):1,s=me(e,n,i,o);if(s)throw new xe(s);return new ue(e/255*o,n/255*o,i/255*o,o)}function $n(t,e){return t in e}function Vn(t,e){const n=e[t];return void 0===n?null:n}function jn(t){return{type:t}}function Gn(t){return{result:"success",value:t}}function Yn(t){return{result:"error",value:t}}function Hn(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Jn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Wn(t){return!!t.expression&&t.expression.interpolated}function Xn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Qn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Kn(t){return t}function ti(t,e){const n="color"===e.type,i=t.stops&&"object"==typeof t.stops[0][0],r=i||!(i||void 0!==t.property),o=t.type||(Wn(e)?"exponential":"interval");if(n&&((t=Bt({},t)).stops&&(t.stops=t.stops.map(t=>[t[0],ue.parse(t[1])])),t.default=ue.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!vn[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let s,a,l;if("exponential"===o)s=ri;else if("interval"===o)s=ii;else if("categorical"===o){s=ni,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];l=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=oi}if(i){const n={},i=[];for(let e=0;e<t.stops.length;e++){const r=t.stops[e],o=r[0].zoom;void 0===n[o]&&(n[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},i.push(o)),n[o].stops.push([r[0].value,r[1]])}const r=[];for(const t of i)r.push([n[t].zoom,ti(n[t],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:xn.interpolationFactor.bind(void 0,o),zoomStops:r.map(t=>t[0]),evaluate:({zoom:n},i)=>ri({stops:r,base:t.base},e,n).evaluate(n,i)}}if(r){const n="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:xn.interpolationFactor.bind(void 0,n),zoomStops:t.stops.map(t=>t[0]),evaluate:({zoom:n})=>s(t,e,n,a,l)}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[t.property]:void 0;return void 0===r?ei(t.default,e.default):s(t,e,r,a,l)}}}function ei(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function ni(t,e,n,i,r){return ei(typeof n===r?i[n]:void 0,t.default,e.default)}function ii(t,e,n){if("number"!==Xn(n))return ei(t.default,e.default);const i=t.stops.length;if(1===i||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];const r=tn(t.stops.map(t=>t[0]),n);return t.stops[r][1]}function ri(t,e,n){const i=void 0!==t.base?t.base:1;if("number"!==Xn(n))return ei(t.default,e.default);const r=t.stops.length;if(1===r||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];const o=tn(t.stops.map(t=>t[0]),n),s=function(t,e,n,i){const r=i-n,o=t-n;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}(n,i,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1];let c=rn[e.type]||Kn;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=vn[t.colorSpace];c=(t,n)=>e.reverse(e.interpolate(e.forward(t),e.forward(n),s))}return"function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),n=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==n)return c(e,n,s)}}:c(a,l,s)}function oi(t,e,n){return"color"===e.type?n=ue.parse(n):"formatted"===e.type?n=pe.fromString(n.toString()):"resolvedImage"===e.type?n=fe.fromString(n.toString()):Xn(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),ei(n,t.default,e.default)}Me.register(Bn,{error:[{kind:"error"},[Ht],(t,[e])=>{throw new xe(e.evaluate(t))}],typeof:[Ht,[Qt],(t,[e])=>ie(ye(e.evaluate(t)))],"to-rgba":[ne(Yt,4),[Wt],(t,[e])=>e.evaluate(t).toArray()],rgb:[Wt,[Yt,Yt,Yt],qn],rgba:[Wt,[Yt,Yt,Yt,Yt],qn],has:{type:Jt,overloads:[[[Ht],(t,[e])=>$n(e.evaluate(t),t.properties())],[[Ht,Xt],(t,[e,n])=>$n(e.evaluate(t),n.evaluate(t))]]},get:{type:Qt,overloads:[[[Ht],(t,[e])=>Vn(e.evaluate(t),t.properties())],[[Ht,Xt],(t,[e,n])=>Vn(e.evaluate(t),n.evaluate(t))]]},"feature-state":[Qt,[Ht],(t,[e])=>Vn(e.evaluate(t),t.featureState||{})],properties:[Xt,[],t=>t.properties()],"geometry-type":[Ht,[],t=>t.geometryType()],id:[Qt,[],t=>t.id()],zoom:[Yt,[],t=>t.globals.zoom],"heatmap-density":[Yt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Yt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Yt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Qt,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Yt,jn(Yt),(t,e)=>{let n=0;for(const i of e)n+=i.evaluate(t);return n}],"*":[Yt,jn(Yt),(t,e)=>{let n=1;for(const i of e)n*=i.evaluate(t);return n}],"-":{type:Yt,overloads:[[[Yt,Yt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Yt],(t,[e])=>-e.evaluate(t)]]},"/":[Yt,[Yt,Yt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Yt,[Yt,Yt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Yt,[],()=>Math.LN2],pi:[Yt,[],()=>Math.PI],e:[Yt,[],()=>Math.E],"^":[Yt,[Yt,Yt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Yt,[Yt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Yt,[Yt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Yt,[Yt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Yt,[Yt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Yt,[Yt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Yt,[Yt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Yt,[Yt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Yt,[Yt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Yt,[Yt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Yt,[Yt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Yt,jn(Yt),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[Yt,jn(Yt),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[Yt,[Yt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Yt,[Yt],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Yt,[Yt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Yt,[Yt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Jt,[Ht,Qt],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Jt,[Qt],(t,[e])=>t.id()===e.value],"filter-type-==":[Jt,[Ht],(t,[e])=>t.geometryType()===e.value],"filter-<":[Jt,[Ht,Qt],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i<r}],"filter-id-<":[Jt,[Qt],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n<i}],"filter->":[Jt,[Ht,Qt],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i>r}],"filter-id->":[Jt,[Qt],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n>i}],"filter-<=":[Jt,[Ht,Qt],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i<=r}],"filter-id-<=":[Jt,[Qt],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n<=i}],"filter->=":[Jt,[Ht,Qt],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i>=r}],"filter-id->=":[Jt,[Qt],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n>=i}],"filter-has":[Jt,[Qt],(t,[e])=>e.value in t.properties()],"filter-has-id":[Jt,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Jt,[ne(Ht)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Jt,[ne(Qt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Jt,[Ht,ne(Qt)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Jt,[Ht,ne(Qt)],(t,[e,n])=>function(t,e,n,i){for(;n<=i;){const r=n+i>>1;if(e[r]===t)return!0;e[r]>t?i=r-1:n=r+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Jt,overloads:[[[Jt,Jt],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[jn(Jt),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Jt,overloads:[[[Jt,Jt],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[jn(Jt),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Jt,[Jt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Jt,[Ht],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Ht,[Ht],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Ht,[Ht],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Ht,jn(Qt),(t,e)=>e.map(e=>_e(e.evaluate(t))).join("")],"resolved-locale":[Ht,[Kt],(t,[e])=>e.evaluate(t).resolvedLocale()]});class si{constructor(t,e){var n;this.expression=t,this._warningHistory={},this._evaluator=new Ee,this._defaultValue=e?"color"===(n=e).type&&Qn(n.default)?new ue(0,0,0,0):"color"===n.type?ue.parse(n.default)||null:void 0===n.default?null:n.default:null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,n,i,r,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(t,e,n,i,r,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new xe(`Expected value to be one of ${Object.keys(this._enumValues).map(t=>JSON.stringify(t)).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(s){return this._warningHistory[s.message]||(this._warningHistory[s.message]=!0,"undefined"!=typeof console&&console.warn(s.message)),this._defaultValue}}}function ai(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Bn}function li(t,e){const n=new Qe(Bn,[],e?function(t){const e={color:Wt,string:Ht,number:Yt,enum:Ht,boolean:Jt,formatted:te,resolvedImage:ee};return"array"===t.type?ne(e[t.value]||Qt,t.length):e[t.type]}(e):void 0),i=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return i?Gn(new si(i,e)):Yn(n.errors)}class ci{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Je(e.expression)}evaluateWithoutErrorHandling(t,e,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,o)}evaluate(t,e,n,i,r,o){return this._styleExpression.evaluate(t,e,n,i,r,o)}}class ui{constructor(t,e,n,i){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Je(e.expression),this.interpolationType=i}evaluateWithoutErrorHandling(t,e,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,o)}evaluate(t,e,n,i,r,o){return this._styleExpression.evaluate(t,e,n,i,r,o)}interpolationFactor(t,e,n){return this.interpolationType?xn.interpolationFactor(this.interpolationType,t,e,n):0}}function hi(t,e){if("error"===(t=li(t,e)).result)return t;const n=t.value.expression,i=He(n);if(!i&&!Hn(e))return Yn([new Vt("","data expressions not supported")]);const r=We(n,["zoom"]);if(!r&&!Jn(e))return Yn([new Vt("","zoom expressions not supported")]);const o=pi(n);return o||r?o instanceof Vt?Yn([o]):o instanceof xn&&!Wn(e)?Yn([new Vt("",'"interpolate" expressions cannot be used with this property')]):Gn(o?new ui(i?"camera":"composite",t.value,o.labels,o instanceof xn?o.interpolation:void 0):new ci(i?"constant":"source",t.value)):Yn([new Vt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class di{constructor(t,e){this._parameters=t,this._specification=e,Bt(this,ti(this._parameters,this._specification))}static deserialize(t){return new di(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function pi(t){let e=null;if(t instanceof Tn)e=pi(t.result);else if(t instanceof wn){for(const n of t.args)if(e=pi(n),e)break}else(t instanceof en||t instanceof xn)&&t.input instanceof Me&&"zoom"===t.input.name&&(e=t);return e instanceof Vt||t.eachChild(t=>{const n=pi(t);n instanceof Vt?e=n:!e&&n?e=new Vt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new Vt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function fi(t){const e=t.key,n=t.value,i=t.valueSpec||{},r=t.objectElementValidators||{},o=t.style,s=t.styleSpec;let a=[];const l=Xn(n);if("object"!==l)return[new Ut(e,n,`object expected, ${l} found`)];for(const c in n){const t=c.split(".")[0],l=i[t]||i["*"];let u;if(r[t])u=r[t];else if(i[t])u=$i;else if(r["*"])u=r["*"];else{if(!i["*"]){a.push(new Ut(e,n[c],`unknown property "${c}"`));continue}u=$i}a=a.concat(u({key:(e&&`${e}.`)+c,value:n[c],valueSpec:l,style:o,styleSpec:s,object:n,objectKey:c},n))}for(const c in i)r[c]||i[c].required&&void 0===i[c].default&&void 0===n[c]&&a.push(new Ut(e,n,`missing required property "${c}"`));return a}function mi(t){const e=t.value,n=t.valueSpec,i=t.style,r=t.styleSpec,o=t.key,s=t.arrayElementValidator||$i;if("array"!==Xn(e))return[new Ut(o,e,`array expected, ${Xn(e)} found`)];if(n.length&&e.length!==n.length)return[new Ut(o,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Ut(o,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let a={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum};r.$version<7&&(a.function=n.function),"object"===Xn(n.value)&&(a=n.value);let l=[];for(let c=0;c<e.length;c++)l=l.concat(s({array:e,arrayIndex:c,value:e[c],valueSpec:a,style:i,styleSpec:r,key:`${o}[${c}]`}));return l}function gi(t){const e=t.key,n=t.value,i=t.valueSpec;let r=Xn(n);if("number"===r&&n!=n&&(r="NaN"),"number"!==r)return[new Ut(e,n,`number expected, ${r} found`)];if("minimum"in i){let r=i.minimum;if("array"===Xn(i.minimum)&&(r=i.minimum[t.arrayIndex]),n<r)return[new Ut(e,n,`${n} is less than the minimum value ${r}`)]}if("maximum"in i){let r=i.maximum;if("array"===Xn(i.maximum)&&(r=i.maximum[t.arrayIndex]),n>r)return[new Ut(e,n,`${n} is greater than the maximum value ${r}`)]}return[]}function yi(t){const e=t.valueSpec,n=qt(t.value.type);let i,r,o,s={};const a="categorical"!==n&&void 0===t.value.property,l=!a,c="array"===Xn(t.value.stops)&&"array"===Xn(t.value.stops[0])&&"object"===Xn(t.value.stops[0][0]),u=fi({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===n)return[new Ut(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const i=t.value;return e=e.concat(mi({key:t.key,value:i,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Xn(i)&&0===i.length&&e.push(new Ut(t.key,i,"array must have at least one stop")),e},default:function(t){return $i({key:t.key,value:t.value,valueSpec:e,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===n&&a&&u.push(new Ut(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||u.push(new Ut(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!Wn(t.valueSpec)&&u.push(new Ut(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!Hn(t.valueSpec)?u.push(new Ut(t.key,t.value,"property functions not supported")):a&&!Jn(t.valueSpec)&&u.push(new Ut(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==t.value.property||u.push(new Ut(t.key,t.value,'"property" property is required')),u;function h(t){let n=[];const i=t.value,a=t.key;if("array"!==Xn(i))return[new Ut(a,i,`array expected, ${Xn(i)} found`)];if(2!==i.length)return[new Ut(a,i,`array length 2 expected, length ${i.length} found`)];if(c){if("object"!==Xn(i[0]))return[new Ut(a,i,`object expected, ${Xn(i[0])} found`)];if(void 0===i[0].zoom)return[new Ut(a,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new Ut(a,i,"object stop key must have value")];if(o&&o>qt(i[0].zoom))return[new Ut(a,i[0].zoom,"stop zoom values must appear in ascending order")];qt(i[0].zoom)!==o&&(o=qt(i[0].zoom),r=void 0,s={}),n=n.concat(fi({key:`${a}[0]`,value:i[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:gi,value:d}}))}else n=n.concat(d({key:`${a}[0]`,value:i[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},i));return ai($t(i[1]))?n.concat([new Ut(`${a}[1]`,i[1],"expressions are not allowed in function stops.")]):n.concat($i({key:`${a}[1]`,value:i[1],valueSpec:e,style:t.style,styleSpec:t.styleSpec}))}function d(t,o){const a=Xn(t.value),l=qt(t.value),c=null!==t.value?t.value:o;if(i){if(a!==i)return[new Ut(t.key,c,`${a} stop domain type must match previous stop domain type ${i}`)]}else i=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new Ut(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==n){let i=`number expected, ${a} found`;return Hn(e)&&void 0===n&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ut(t.key,c,i)]}return"categorical"!==n||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===a&&void 0!==r&&l<r?[new Ut(t.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===n&&l in s?[new Ut(t.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new Ut(t.key,c,`integer expected, found ${l}`)]}}function _i(t){const e=("property"===t.expressionContext?hi:li)($t(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new Ut(`${t.key}${e.key}`,t.value,e.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new Ut(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Je(n))return[new Ut(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Je(n))return[new Ut(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!We(n,["zoom","feature-state"]))return[new Ut(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!He(n))return[new Ut(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vi(t){const e=t.key,n=t.value,i=t.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(qt(n))&&r.push(new Ut(e,n,`expected one of [${i.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(i.values).indexOf(qt(n))&&r.push(new Ut(e,n,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(n)} found`)),r}function xi(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!xi(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}const bi={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function wi(t){if(null==t)return{filter:()=>!0,needGeometry:!1};xi(t)||(t=Si(t));const e=li(t,bi);if("error"===e.result)throw new Error(e.value.map(t=>`${t.key}: ${t.message}`).join(", "));return{filter:(t,n,i)=>e.value.evaluate(t,n,{},i),needGeometry:Ai(t)}}function Ti(t,e){return t<e?-1:t>e?1:0}function Ai(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Ai(t[e]))return!0;return!1}function Si(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Ci(t[1],t[2],"=="):"!="===e?Mi(Ci(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Ci(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(Si))):"all"===e?["all"].concat(t.slice(1).map(Si)):"none"===e?["all"].concat(t.slice(1).map(Si).map(Mi)):"in"===e?Ii(t[1],t.slice(2)):"!in"===e?Mi(Ii(t[1],t.slice(2))):"has"===e?Ei(t[1]):"!has"===e?Mi(Ei(t[1])):"within"!==e||t;var n}function Ci(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Ii(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Ti)]]:["filter-in-small",t,["literal",e]]}}function Ei(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Mi(t){return["!",t]}function ki(t){return xi($t(t.value))?_i(Bt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Pi(t)}function Pi(t){const e=t.value,n=t.key;if("array"!==Xn(e))return[new Ut(n,e,`array expected, ${Xn(e)} found`)];const i=t.styleSpec;let r,o=[];if(e.length<1)return[new Ut(n,e,"filter array must have at least 1 element")];switch(o=o.concat(vi({key:`${n}[0]`,value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),qt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===qt(e[1])&&o.push(new Ut(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&o.push(new Ut(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(r=Xn(e[1]),"string"!==r&&o.push(new Ut(`${n}[1]`,e[1],`string expected, ${r} found`)));for(let s=2;s<e.length;s++)r=Xn(e[s]),"$type"===qt(e[1])?o=o.concat(vi({key:`${n}[${s}]`,value:e[s],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new Ut(`${n}[${s}]`,e[s],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let i=1;i<e.length;i++)o=o.concat(Pi({key:`${n}[${i}]`,value:e[i],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":r=Xn(e[1]),2!==e.length?o.push(new Ut(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new Ut(`${n}[1]`,e[1],`string expected, ${r} found`));break;case"within":r=Xn(e[1]),2!==e.length?o.push(new Ut(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==r&&o.push(new Ut(`${n}[1]`,e[1],`object expected, ${r} found`))}return o}function Di(t,e){const n=t.key,i=t.style,r=t.styleSpec,o=t.value,s=t.objectKey,a=r[`${e}_${t.layerType}`];if(!a)return[];const l=s.match(/^(.*)-transition$/);if("paint"===e&&l&&a[l[1]]&&a[l[1]].transition)return $i({key:n,value:o,valueSpec:r.transition,style:i,styleSpec:r});const c=t.valueSpec||a[s];if(!c)return[new Ut(n,o,`unknown property "${s}"`)];let u;if("string"===Xn(o)&&Hn(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new Ut(n,o,`"${s}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===t.layerType&&("text-field"===s&&i&&!i.glyphs&&h.push(new Ut(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Qn($t(o))&&"identity"===qt(o.type)&&h.push(new Ut(n,o,'"text-font" does not support identity functions'))),h.concat($i({key:t.key,value:o,valueSpec:c,style:i,styleSpec:r,expressionContext:"property",propertyType:e,propertyKey:s}))}function Li(t){return Di(t,"paint")}function Oi(t){return Di(t,"layout")}function Ri(t){let e=[];const n=t.value,i=t.key,r=t.style,o=t.styleSpec;n.type||n.ref||e.push(new Ut(i,n,'either "type" or "ref" is required'));let s=qt(n.type);const a=qt(n.ref);if(n.id){const o=qt(n.id);for(let s=0;s<t.arrayIndex;s++){const t=r.layers[s];qt(t.id)===o&&e.push(new Ut(i,n.id,`duplicate layer id "${n.id}", previously used at line ${t.id.__line__}`))}}if("ref"in n){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in n&&e.push(new Ut(i,n[t],`"${t}" is prohibited for ref layers`))}),r.layers.forEach(e=>{qt(e.id)===a&&(t=e)}),t?t.ref?e.push(new Ut(i,n.ref,"ref cannot reference another ref layer")):s=qt(t.type):e.push(new Ut(i,n.ref,`ref layer "${a}" not found`))}else if("background"!==s&&"sky"!==s)if(n.source){const t=r.sources&&r.sources[n.source],o=t&&qt(t.type);t?"vector"===o&&"raster"===s?e.push(new Ut(i,n.source,`layer "${n.id}" requires a raster source`)):"raster"===o&&"raster"!==s?e.push(new Ut(i,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==o||n["source-layer"]?"raster-dem"===o&&"hillshade"!==s?e.push(new Ut(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===o&&t.lineMetrics||e.push(new Ut(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ut(i,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Ut(i,n.source,`source "${n.source}" not found`))}else e.push(new Ut(i,n,'missing required property "source"'));return e=e.concat(fi({key:i,value:n,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$i({key:`${i}.type`,value:n.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:ki,layout:t=>fi({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>Oi(Bt({layerType:s},t))}}),paint:t=>fi({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>Li(Bt({layerType:s},t))}})}})),e}function zi(t){const e=t.value,n=t.key,i=Xn(e);return"string"!==i?[new Ut(n,e,`string expected, ${i} found`)]:[]}const Zi={promoteId:function({key:t,value:e}){if("string"===Xn(e))return zi({key:t,value:e});{const n=[];for(const i in e)n.push(...zi({key:`${t}.${i}`,value:e[i]}));return n}}};function Fi(t){const e=t.value,n=t.key,i=t.styleSpec,r=t.style;if(!e.type)return[new Ut(n,e,'"type" is required')];const o=qt(e.type);let s;switch(o){case"vector":case"raster":case"raster-dem":return s=fi({key:n,value:e,valueSpec:i[`source_${o.replace("-","_")}`],style:t.style,styleSpec:i,objectElementValidators:Zi}),s;case"geojson":if(s=fi({key:n,value:e,valueSpec:i.source_geojson,style:r,styleSpec:i,objectElementValidators:Zi}),e.cluster)for(const t in e.clusterProperties){const[i,r]=e.clusterProperties[t],o="string"==typeof i?[i,["accumulated"],["get",t]]:i;s.push(..._i({key:`${n}.${t}.map`,value:r,expressionContext:"cluster-map"})),s.push(..._i({key:`${n}.${t}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return fi({key:n,value:e,valueSpec:i.source_video,style:r,styleSpec:i});case"image":return fi({key:n,value:e,valueSpec:i.source_image,style:r,styleSpec:i});case"canvas":return[new Ut(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vi({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:i})}}function Ui(t){const e=t.value,n=t.styleSpec,i=n.light,r=t.style;let o=[];const s=Xn(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new Ut("light",e,`object expected, ${s} found`)]),o;for(const a in e){const t=a.match(/^(.*)-transition$/);o=o.concat(t&&i[t[1]]&&i[t[1]].transition?$i({key:a,value:e[a],valueSpec:n.transition,style:r,styleSpec:n}):i[a]?$i({key:a,value:e[a],valueSpec:i[a],style:r,styleSpec:n}):[new Ut(a,e[a],`unknown property "${a}"`)])}return o}function Ni(t){const e=t.value,n=t.key,i=t.style,r=t.styleSpec,o=r.terrain;let s=[];const a=Xn(e);if(void 0===e)return s;if("object"!==a)return s=s.concat([new Ut("terrain",e,`object expected, ${a} found`)]),s;for(const l in e){const t=l.match(/^(.*)-transition$/);s=s.concat(t&&o[t[1]]&&o[t[1]].transition?$i({key:l,value:e[l],valueSpec:r.transition,style:i,styleSpec:r}):o[l]?$i({key:l,value:e[l],valueSpec:o[l],style:i,styleSpec:r}):[new Ut(l,e[l],`unknown property "${l}"`)])}if(e.source){const t=i.sources&&i.sources[e.source],r=t&&qt(t.type);t?"raster-dem"!==r&&s.push(new Ut(n,e.source,`terrain cannot be used with a source of type ${r}, it only be used with a "raster-dem" source type`)):s.push(new Ut(n,e.source,`source "${e.source}" not found`))}else s.push(new Ut(n,e,'terrain is missing required property "source"'));return s}function Bi(t){const e=t.value,n=t.style,i=t.styleSpec,r=i.fog;let o=[];const s=Xn(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new Ut("fog",e,`object expected, ${s} found`)]),o;for(const a in e){const t=a.match(/^(.*)-transition$/);o=o.concat(t&&r[t[1]]&&r[t[1]].transition?$i({key:a,value:e[a],valueSpec:i.transition,style:n,styleSpec:i}):r[a]?$i({key:a,value:e[a],valueSpec:r[a],style:n,styleSpec:i}):[new Ut(a,e[a],`unknown property "${a}"`)])}return o}const qi={"*":()=>[],array:mi,boolean:function(t){const e=t.value,n=t.key,i=Xn(e);return"boolean"!==i?[new Ut(n,e,`boolean expected, ${i} found`)]:[]},number:gi,color:function(t){const e=t.key,n=t.value,i=Xn(n);return"string"!==i?[new Ut(e,n,`color expected, ${i} found`)]:null===ce.parseCSSColor(n)?[new Ut(e,n,`color expected, "${n}" found`)]:[]},constants:Nt,enum:vi,filter:ki,function:yi,layer:Ri,object:fi,source:Fi,light:Ui,terrain:Ni,fog:Bi,string:zi,formatted:function(t){return 0===zi(t).length?[]:_i(t)},resolvedImage:function(t){return 0===zi(t).length?[]:_i(t)}};function $i(t){const e=t.value,n=t.valueSpec,i=t.styleSpec;return n.expression&&Qn(qt(e))?yi(t):n.expression&&ai($t(e))?_i(t):n.type&&qi[n.type]?qi[n.type](t):fi(Bt({},t,{valueSpec:n.type?i[n.type]:n}))}function Vi(t){const e=t.value,n=t.key,i=zi(t);return i.length||(-1===e.indexOf("{fontstack}")&&i.push(new Ut(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new Ut(n,e,'"glyphs" url must include a "{range}" token'))),i}function ji(t,e=Ft){let n=[];return n=n.concat($i({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Vi,"*":()=>[]}})),t.constants&&(n=n.concat(Nt({key:"constants",value:t.constants,style:t,styleSpec:e}))),Gi(n)}function Gi(t){return[].concat(t).sort((t,e)=>t.line-e.line)}function Yi(t){return function(...e){return Gi(t.apply(this,e))}}ji.source=Yi(Fi),ji.light=Yi(Ui),ji.terrain=Yi(Ni),ji.fog=Yi(Bi),ji.layer=Yi(Ri),ji.filter=Yi(ki),ji.paintProperty=Yi(Li),ji.layoutProperty=Yi(Oi);const Hi=ji,Ji=Hi.light,Wi=Hi.fog,Xi=Hi.paintProperty,Qi=Hi.layoutProperty;function Ki(t,e){let n=!1;if(e&&e.length)for(const i of e)t.fire(new zt(new Error(i.message))),n=!0;return n}var tr=er;function er(t,e,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var r=new Int32Array(this.arrayBuffer);t=r[0],this.d=(e=r[1])+2*(n=r[2]);for(var o=0;o<this.d*this.d;o++){var s=r[3+o],a=r[3+o+1];i.push(s===a?null:r.subarray(s,a))}var l=r[3+i.length+1];this.keys=r.subarray(r[3+i.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var u=n/e*t;this.min=-u,this.max=t+u}er.prototype.insert=function(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},er.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},er.prototype._insertCell=function(t,e,n,i,r,o){this.cells[r].push(o)},er.prototype.query=function(t,e,n,i,r){var o=this.min,s=this.max;if(t<=o&&e<=o&&s<=n&&s<=i&&!r)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,n,i,this._queryCell,a,{},r),a},er.prototype._queryCell=function(t,e,n,i,r,o,s,a){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):t<=u[p+2]&&e<=u[p+3]&&n>=u[p+0]&&i>=u[p+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},er.prototype._forEachCell=function(t,e,n,i,r,o,s,a){for(var l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(n),h=this._convertToCellCoord(i),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&r.call(this,t,e,n,i,f,o,s,a))return}},er.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},er.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},er.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var r=new Int32Array(e+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=e,s=0;s<t.length;s++){var a=t[s];r[3+s]=o,r.set(a,o),o+=a.length}return r[3+t.length]=o,r.set(this.keys,o),r[3+t.length+1]=o+=this.keys.length,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};const{ImageData:nr,ImageBitmap:ir}=s,rr={};function or(t,e,n={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),rr[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}or("Object",Object),tr.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},tr.deserialize=function(t){return new tr(t.buffer)},or("Grid",tr),or("Color",ue),or("Error",Error),or("ResolvedImage",fe),or("StylePropertyFunction",di),or("StyleExpression",si,{omit:["_evaluator"]}),or("ZoomDependentExpression",ui),or("ZoomConstantExpression",ci),or("CompoundExpression",Me,{omit:["_evaluate"]});for(const Sd in Bn)Bn[Sd]._classRegistryKey||or(`Expression_${Sd}`,Bn[Sd]);function sr(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function ar(t){return ir&&t instanceof ir}function lr(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(sr(t)||ar(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof nr)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const i of t)n.push(lr(i,e));return n}if("object"==typeof t){const n=t.constructor,i=n._classRegistryKey;if(!i)throw new Error("can't serialize object of unregistered class");const r=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const n in t){if(!t.hasOwnProperty(n)||rr[i].omit.indexOf(n)>=0)continue;const o=t[n];r[n]=rr[i].shallow.indexOf(n)>=0?o:lr(o,e)}t instanceof Error&&(r.message=t.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(r.$name=i),r}throw new Error("can't serialize object of type "+typeof t)}function cr(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||sr(t)||ar(t)||ArrayBuffer.isView(t)||t instanceof nr)return t;if(Array.isArray(t))return t.map(cr);if("object"==typeof t){const e=t.$name||"Object",{klass:n}=rr[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const i=Object.create(n.prototype);for(const r of Object.keys(t)){if("$name"===r)continue;const n=t[r];i[r]=rr[e].shallow.indexOf(r)>=0?n:cr(n)}return i}throw new Error("can't deserialize object of type "+typeof t)}class ur{constructor(){this.first=!0}update(t,e){const n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))}}const hr=t=>t>=1536&&t<=1791,dr=t=>t>=1872&&t<=1919,pr=t=>t>=2208&&t<=2303,fr=t=>t>=11904&&t<=12031,mr=t=>t>=12032&&t<=12255,gr=t=>t>=12272&&t<=12287,yr=t=>t>=12288&&t<=12351,_r=t=>t>=12352&&t<=12447,vr=t=>t>=12448&&t<=12543,xr=t=>t>=12544&&t<=12591,br=t=>t>=12704&&t<=12735,wr=t=>t>=12736&&t<=12783,Tr=t=>t>=12784&&t<=12799,Ar=t=>t>=12800&&t<=13055,Sr=t=>t>=13056&&t<=13311,Cr=t=>t>=13312&&t<=19903,Ir=t=>t>=19968&&t<=40959,Er=t=>t>=40960&&t<=42127,Mr=t=>t>=42128&&t<=42191,kr=t=>t>=44032&&t<=55215,Pr=t=>t>=63744&&t<=64255,Dr=t=>t>=64336&&t<=65023,Lr=t=>t>=65040&&t<=65055,Or=t=>t>=65072&&t<=65103,Rr=t=>t>=65104&&t<=65135,zr=t=>t>=65136&&t<=65279,Zr=t=>t>=65280&&t<=65519;function Fr(t){for(const e of t)if(Br(e.charCodeAt(0)))return!0;return!1}function Ur(t){for(const e of t)if(!Nr(e.charCodeAt(0)))return!1;return!0}function Nr(t){return!(hr(t)||dr(t)||pr(t)||Dr(t)||zr(t))}function Br(t){return!(746!==t&&747!==t&&(t<4352||!(br(t)||xr(t)||Or(t)&&!(t>=65097&&t<=65103)||Pr(t)||Sr(t)||fr(t)||wr(t)||!(!yr(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Cr(t)||Ir(t)||Ar(t)||(e=t,e>=12592&&e<=12687)||(t=>t>=43360&&t<=43391)(t)||(t=>t>=55216&&t<=55295)(t)||(t=>t>=4352&&t<=4607)(t)||kr(t)||_r(t)||gr(t)||(t=>t>=12688&&t<=12703)(t)||mr(t)||Tr(t)||vr(t)&&12540!==t||!(!Zr(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Rr(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(t=>t>=5120&&t<=5759)(t)||(t=>t>=6320&&t<=6399)(t)||Lr(t)||(t=>t>=19904&&t<=19967)(t)||Er(t)||Mr(t))));var e}function qr(t){return!(Br(t)||(e=t,(n=e)>=128&&n<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(t=>t>=8192&&t<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(t=>t>=8448&&t<=8527)(e)||(t=>t>=8528&&t<=8591)(e)||(t=>t>=8960&&t<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(t=>t>=9216&&t<=9279)(e)&&9251!==e||(t=>t>=9280&&t<=9311)(e)||(t=>t>=9312&&t<=9471)(e)||(t=>t>=9632&&t<=9727)(e)||(t=>t>=9728&&t<=9983)(e)&&!(e>=9754&&e<=9759)||(t=>t>=11008&&t<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||yr(e)||vr(e)||(t=>t>=57344&&t<=63743)(e)||Or(e)||Rr(e)||Zr(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,n}function $r(t){return t>=1424&&t<=2303||Dr(t)||zr(t)}function Vr(t,e){return!(!e&&$r(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(n=t,n>=6016&&n<=6143));var n}function jr(t){for(const e of t)if($r(e.charCodeAt(0)))return!0;return!1}const Gr="deferred",Yr="loading",Hr="loaded";let Jr=null,Wr="unavailable",Xr=null;const Qr=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Wr="error"),Jr&&Jr(t)};function Kr(){to.fire(new Rt("pluginStateChange",{pluginStatus:Wr,pluginURL:Xr}))}const to=new Zt,eo=function(){return Wr},no=function(){if(Wr!==Gr||!Xr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Wr=Yr,Kr(),Xr&&St({url:Xr},t=>{t?Qr(t):(Wr=Hr,Kr())})},io={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Wr===Hr||null!=io.applyArabicShaping,isLoading:()=>Wr===Yr,setState(t){Wr=t.pluginStatus,Xr=t.pluginURL},isParsed:()=>null!=io.applyArabicShaping&&null!=io.processBidirectionalText&&null!=io.processStyledBidirectionalText,getPluginURL:()=>Xr};class ro{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ur,this.transition={})}isSupportedScript(t){return function(t,e){for(const n of t)if(!Vr(n.charCodeAt(0),e))return!1;return!0}(t,io.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}}}class oo{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Qn(t))return new di(t,e);if(ai(t)){const n=hi(t,e);if("error"===n.result)throw new Error(n.value.map(t=>`${t.key}: ${t.message}`).join(", "));return n.value}{let n=t;return"string"==typeof t&&"color"===e.type&&(n=ue.parse(t)),{kind:"constant",evaluate:()=>n}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,n){return this.property.possiblyEvaluate(this,t,e,n)}}class so{constructor(t){this.property=t,this.value=new oo(t,void 0)}transitioned(t,e){return new lo(this.property,this.value,e,v({},t.transition,this.transition),t.now)}untransitioned(){return new lo(this.property,this.value,null,{},0)}}class ao{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return M(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new so(this._values[t].property)),this._values[t].value=new oo(this._values[t].property,null===e?void 0:M(e))}getTransition(t){return M(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new so(this._values[t].property)),this._values[t].transition=M(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const n=this.getValue(e);void 0!==n&&(t[e]=n);const i=this.getTransition(e);void 0!==i&&(t[`${e}-transition`]=i)}return t}transitioned(t,e){const n=new co(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(t,e._values[i]);return n}untransitioned(){const t=new co(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class lo{constructor(t,e,n,i,r){const o=i.delay||0,s=i.duration||0;r=r||0,this.property=t,this.value=e,this.begin=r+o,this.end=this.begin+s,t.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(t,e,n){const i=t.now||0,r=this.value.possiblyEvaluate(t,e,n),o=this.prior;if(o){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return o.possiblyEvaluate(t,e,n);{const s=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,n),r,d(s))}}return r}}class co{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,n){const i=new po(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(t,e,n);return i}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class uo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return M(this._values[t].value)}setValue(t,e){this._values[t]=new oo(this._values[t].property,null===e?void 0:M(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const n=this.getValue(e);void 0!==n&&(t[e]=n)}return t}possiblyEvaluate(t,e,n){const i=new po(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(t,e,n);return i}}class ho{constructor(t,e,n){this.property=t,this.value=e,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,n,i){return this.property.evaluate(this.value,this.parameters,t,e,n,i)}}class po{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class fo{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,n){const i=rn[this.specification.type];return i?i(t,e,n):t}}class mo{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,n,i){return new ho(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},n,i)}:t.expression,e)}interpolate(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new ho(this,{kind:"constant",value:void 0},t.parameters);const i=rn[this.specification.type];return i?new ho(this,{kind:"constant",value:i(t.value.value,e.value.value,n)},t.parameters):t}evaluate(t,e,n,i,r,o){return"constant"===t.kind?t.value:t.evaluate(e,n,i,r,o)}}class go extends mo{possiblyEvaluate(t,e,n,i){if(void 0===t.value)return new ho(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},n,i),o="resolvedImage"===t.property.specification.type&&"string"!=typeof r?r.name:r,s=this._calculate(o,o,o,e);return new ho(this,{kind:"constant",value:s},e)}if("camera"===t.expression.kind){const n=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new ho(this,{kind:"constant",value:n},e)}return new ho(this,t.expression,e)}evaluate(t,e,n,i,r,o){if("source"===t.kind){const s=t.evaluate(e,n,i,r,o);return this._calculate(s,s,s,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,i),t.evaluate({zoom:Math.floor(e.zoom)},n,i),t.evaluate({zoom:Math.floor(e.zoom)+1},n,i),e):t.value}_calculate(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e,other:n}:{from:n,to:e,other:t}}interpolate(t){return t}}class yo{constructor(t){this.specification=t}possiblyEvaluate(t,e,n,i){if(void 0!==t.value){if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},n,i);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new ro(Math.floor(e.zoom-1),e)),t.expression.evaluate(new ro(Math.floor(e.zoom),e)),t.expression.evaluate(new ro(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}}interpolate(t){return t}}class _o{constructor(t){this.specification=t}possiblyEvaluate(t,e,n,i){return!!t.expression.evaluate(e,null,{},n,i)}interpolate(){return!1}}class vo{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const n=t[e];n.specification.overridable&&this.overridableProperties.push(e);const i=this.defaultPropertyValues[e]=new oo(n,void 0),r=this.defaultTransitionablePropertyValues[e]=new so(n);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=i.possiblyEvaluate({})}}}function xo(t,e){return 256*(t=m(Math.floor(t),0,255))+m(Math.floor(e),0,255)}or("DataDrivenProperty",mo),or("DataConstantProperty",fo),or("CrossFadedDataDrivenProperty",go),or("CrossFadedProperty",yo),or("ColorRampProperty",_o);const bo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wo{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class To{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ao(t,e=1){let n=0,i=0;return{members:t.map(t=>{const r=bo[t.type].BYTES_PER_ELEMENT,o=n=So(n,Math.max(e,r)),s=t.components||1;return i=Math.max(i,r),n+=r*s,{name:t.name,type:t.type,components:s,offset:o}}),size:So(n,Math.max(i,e)),alignment:e}}function So(t,e){return Math.ceil(t/e)*e}class Co extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.int16[i+0]=e,this.int16[i+1]=n,t}}Co.prototype.bytesPerElement=4,or("StructArrayLayout2i4",Co);class Io extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)}emplace(t,e,n,i,r){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=n,this.int16[o+2]=i,this.int16[o+3]=r,t}}Io.prototype.bytesPerElement=8,or("StructArrayLayout4i8",Io);class Eo extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,i,r,o,s)}emplace(t,e,n,i,r,o,s,a){const l=6*t,c=12*t,u=3*t;return this.int16[l+0]=e,this.int16[l+1]=n,this.uint8[c+4]=i,this.uint8[c+5]=r,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,t}}Eo.prototype.bytesPerElement=12,or("StructArrayLayout2i4ub1f12",Eo);class Mo extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.float32[i+0]=e,this.float32[i+1]=n,t}}Mo.prototype.bytesPerElement=8,or("StructArrayLayout2f8",Mo);class ko extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,i,r,o,s,a,l,c)}emplace(t,e,n,i,r,o,s,a,l,c,u){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=n,this.uint16[h+2]=i,this.uint16[h+3]=r,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t}}ko.prototype.bytesPerElement=20,or("StructArrayLayout10ui20",ko);class Po extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,o,s,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,e,n,i,r,o,s,a)}emplace(t,e,n,i,r,o,s,a,l){const c=8*t;return this.uint16[c+0]=e,this.uint16[c+1]=n,this.uint16[c+2]=i,this.uint16[c+3]=r,this.uint16[c+4]=o,this.uint16[c+5]=s,this.uint16[c+6]=a,this.uint16[c+7]=l,t}}Po.prototype.bytesPerElement=16,or("StructArrayLayout8ui16",Po);class Do extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,n,i,r,o,s,a,l,c,u,h)}emplace(t,e,n,i,r,o,s,a,l,c,u,h,d){const p=12*t;return this.int16[p+0]=e,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,t}}Do.prototype.bytesPerElement=24,or("StructArrayLayout4i4ui4i24",Do);class Lo extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.float32[r+0]=e,this.float32[r+1]=n,this.float32[r+2]=i,t}}Lo.prototype.bytesPerElement=12,or("StructArrayLayout3f12",Lo);class Oo extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}Oo.prototype.bytesPerElement=4,or("StructArrayLayout1ul4",Oo);class Ro extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,i,r,o,s,a,l,c)}emplace(t,e,n,i,r,o,s,a,l,c,u){const h=16*t,d=8*t;return this.int16[h+0]=e,this.int16[h+1]=n,this.float32[d+1]=i,this.float32[d+2]=r,this.float32[d+3]=o,this.float32[d+4]=s,this.int16[h+10]=a,this.uint32[d+6]=l,this.uint16[h+14]=c,this.uint16[h+15]=u,t}}Ro.prototype.bytesPerElement=32,or("StructArrayLayout2i4f1i1ul2ui32",Ro);class zo extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,n,i,r,o)}emplace(t,e,n,i,r,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,t}}zo.prototype.bytesPerElement=12,or("StructArrayLayout2i2i2i12",zo);class Zo extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r)}emplace(t,e,n,i,r,o){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=n,this.float32[s+2]=i,this.int16[a+6]=r,this.int16[a+7]=o,t}}Zo.prototype.bytesPerElement=16,or("StructArrayLayout2f1f2i16",Zo);class Fo extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)}emplace(t,e,n,i,r){const o=12*t,s=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=n,this.float32[s+1]=i,this.float32[s+2]=r,t}}Fo.prototype.bytesPerElement=12,or("StructArrayLayout2ub2f12",Fo);class Uo extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,this.uint16[r+2]=i,t}}Uo.prototype.bytesPerElement=6,or("StructArrayLayout3ui6",Uo);class No extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y){const _=this.length;return this.resize(_+1),this.emplace(_,t,e,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y)}emplace(t,e,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_){const v=13*t,x=26*t,b=52*t;return this.float32[v+0]=e,this.float32[v+1]=n,this.uint16[x+4]=i,this.uint16[x+5]=r,this.uint32[v+3]=o,this.uint32[v+4]=s,this.uint32[v+5]=a,this.uint16[x+12]=l,this.uint16[x+13]=c,this.uint16[x+14]=u,this.float32[v+8]=h,this.float32[v+9]=d,this.uint8[b+40]=p,this.uint8[b+41]=f,this.uint8[b+42]=m,this.uint32[v+11]=g,this.int16[x+24]=y,this.uint8[b+50]=_,t}}No.prototype.bytesPerElement=52,or("StructArrayLayout2f2ui3ul3ui2f3ub1ul1i1ub52",No);class Bo extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,A,S,C){const I=this.length;return this.resize(I+1),this.emplace(I,t,e,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,A,S,C)}emplace(t,e,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,A,S,C,I){const E=17*t,M=34*t;return this.float32[E+0]=e,this.float32[E+1]=n,this.int16[M+4]=i,this.int16[M+5]=r,this.int16[M+6]=o,this.int16[M+7]=s,this.int16[M+8]=a,this.int16[M+9]=l,this.uint16[M+10]=c,this.uint16[M+11]=u,this.uint16[M+12]=h,this.uint16[M+13]=d,this.uint16[M+14]=p,this.uint16[M+15]=f,this.uint16[M+16]=m,this.uint16[M+17]=g,this.uint16[M+18]=y,this.uint16[M+19]=_,this.uint16[M+20]=v,this.uint16[M+21]=x,this.uint16[M+22]=b,this.uint16[M+23]=w,this.uint16[M+24]=T,this.uint32[E+13]=A,this.float32[E+14]=S,this.float32[E+15]=C,this.float32[E+16]=I,t}}Bo.prototype.bytesPerElement=68,or("StructArrayLayout2f6i15ui1ul3f68",Bo);class qo extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}qo.prototype.bytesPerElement=4,or("StructArrayLayout1f4",qo);class $o extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.int16[r+0]=e,this.int16[r+1]=n,this.int16[r+2]=i,t}}$o.prototype.bytesPerElement=6,or("StructArrayLayout3i6",$o);class Vo extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)}emplace(t,e,n,i,r){const o=6*t;return this.uint32[3*t+0]=e,this.uint16[o+2]=n,this.uint16[o+3]=i,this.uint16[o+4]=r,t}}Vo.prototype.bytesPerElement=12,or("StructArrayLayout1ul3ui12",Vo);class jo extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,t}}jo.prototype.bytesPerElement=4,or("StructArrayLayout2ui4",jo);class Go extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}Go.prototype.bytesPerElement=2,or("StructArrayLayout1ui2",Go);class Yo extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)}emplace(t,e,n,i,r){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=i,this.float32[o+3]=r,t}}Yo.prototype.bytesPerElement=16,or("StructArrayLayout4f16",Yo);class Ho extends wo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.float32[this._pos4+1]}get y1(){return this._structArray.float32[this._pos4+2]}get x2(){return this._structArray.float32[this._pos4+3]}get y2(){return this._structArray.float32[this._pos4+4]}get padding(){return this._structArray.int16[this._pos2+10]}get featureIndex(){return this._structArray.uint32[this._pos4+6]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+14]}get bucketIndex(){return this._structArray.uint16[this._pos2+15]}get anchorPoint(){return new r(this.anchorPointX,this.anchorPointY)}}Ho.prototype.size=32;class Jo extends Ro{get(t){return new Ho(this,t)}}or("CollisionBoxArray",Jo);class Wo extends wo{get anchorX(){return this._structArray.float32[this._pos4+0]}get anchorY(){return this._structArray.float32[this._pos4+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+4]}get numGlyphs(){return this._structArray.uint16[this._pos2+5]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineStartIndex(){return this._structArray.uint32[this._pos4+4]}get lineLength(){return this._structArray.uint32[this._pos4+5]}get segment(){return this._structArray.uint16[this._pos2+12]}get lowerSize(){return this._structArray.uint16[this._pos2+13]}get upperSize(){return this._structArray.uint16[this._pos2+14]}get lineOffsetX(){return this._structArray.float32[this._pos4+8]}get lineOffsetY(){return this._structArray.float32[this._pos4+9]}get writingMode(){return this._structArray.uint8[this._pos1+40]}get placedOrientation(){return this._structArray.uint8[this._pos1+41]}set placedOrientation(t){this._structArray.uint8[this._pos1+41]=t}get hidden(){return this._structArray.uint8[this._pos1+42]}set hidden(t){this._structArray.uint8[this._pos1+42]=t}get crossTileID(){return this._structArray.uint32[this._pos4+11]}set crossTileID(t){this._structArray.uint32[this._pos4+11]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+24]}get flipState(){return this._structArray.uint8[this._pos1+50]}set flipState(t){this._structArray.uint8[this._pos1+50]=t}}Wo.prototype.size=52;class Xo extends No{get(t){return new Wo(this,t)}}or("PlacedSymbolArray",Xo);class Qo extends wo{get anchorX(){return this._structArray.float32[this._pos4+0]}get anchorY(){return this._structArray.float32[this._pos4+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+8]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+9]}get key(){return this._structArray.uint16[this._pos2+10]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get featureIndex(){return this._structArray.uint16[this._pos2+19]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+21]}get numIconVertices(){return this._structArray.uint16[this._pos2+22]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+23]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+24]}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Qo.prototype.size=68;class Ko extends Bo{get(t){return new Qo(this,t)}}or("SymbolInstanceArray",Ko);class ts extends qo{getoffsetX(t){return this.float32[1*t+0]}}or("GlyphOffsetArray",ts);class es extends $o{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}or("SymbolLineVertexArray",es);class ns extends wo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ns.prototype.size=12;class is extends Vo{get(t){return new ns(this,t)}}or("FeatureIndexArray",is);class rs extends wo{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}rs.prototype.size=4;class os extends jo{get(t){return new rs(this,t)}}or("FillExtrusionCentroidArray",os);const ss=Ao([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),as=Ao([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var ls=le(function(t){t.exports=function(t,e){var n,i,r,o,s,a,l,c;for(i=t.length-(n=3&t.length),r=e,s=3432918353,a=461845907,c=0;c<i;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}}),cs=le(function(t){t.exports=function(t,e){for(var n,i=t.length,r=e^i,o=0;i>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++o;switch(i){case 3:r^=(255&t.charCodeAt(o+2))<<16;case 2:r^=(255&t.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}}),us=ls,hs=cs;us.murmur3=ls,us.murmur2=hs;class ds{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,n,i){this.ids.push(ps(t)),this.positions.push(e,n,i)}getPositions(t){const e=ps(t);let n=0,i=this.ids.length-1;for(;n<i;){const t=n+i>>1;this.ids[t]>=e?i=t:n=t+1}const r=[];for(;this.ids[n]===e;)r.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return r}static serialize(t,e){const n=new Float64Array(t.ids),i=new Uint32Array(t.positions);return fs(n,i,0,n.length-1),e&&e.push(n.buffer,i.buffer),{ids:n,positions:i}}static deserialize(t){const e=new ds;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function ps(t){const e=+t;return!isNaN(e)&&e<=a?e:us(String(t))}function fs(t,e,n,i){for(;n<i;){const r=t[n+i>>1];let o=n-1,s=i+1;for(;;){do{o++}while(t[o]<r);do{s--}while(t[s]>r);if(o>=s)break;ms(t,o,s),ms(e,3*o,3*s),ms(e,3*o+1,3*s+1),ms(e,3*o+2,3*s+2)}s-n<i-s?(fs(t,e,n,s),n=s+1):(fs(t,e,s+1,i),i=s)}}function ms(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}or("FeaturePositionMap",ds);class gs{constructor(t,e){this.gl=t.gl,this.location=e}}class ys extends gs{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class _s extends gs{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class vs extends gs{constructor(t,e){super(t,e),this.current=ue.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const xs=new Float32Array(16),bs=new Float32Array(9);function ws(t){return[xo(255*t.r,255*t.g),xo(255*t.b,255*t.a)]}class Ts{constructor(t,e,n){this.value=t,this.uniformNames=e.map(t=>`u_${t}`),this.type=n}setUniform(t,e,n){t.set(n.constantOr(this.value))}getBinding(t,e,n){return"color"===this.type?new vs(t,e):new ys(t,e)}}class As{constructor(t,e){this.uniformNames=e.map(t=>`u_${t}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tl.concat(e.br),this.patternTo=t.tl.concat(t.br)}setUniform(t,e,n,i){const r="u_pattern_to"===i||"u_dash_to"===i?this.patternTo:"u_pattern_from"===i||"u_dash_from"===i?this.patternFrom:"u_pixel_ratio_to"===i?this.pixelRatioTo:"u_pixel_ratio_from"===i?this.pixelRatioFrom:null;r&&t.set(r)}getBinding(t,e,n){return"u_pattern_from"===n||"u_pattern_to"===n||"u_dash_from"===n||"u_dash_to"===n?new _s(t,e):new ys(t,e)}}class Ss{constructor(t,e,n,i){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:`a_${t}`,type:"Float32",components:"color"===n?2:1,offset:0})),this.paintVertexArray=new i}populatePaintArray(t,e,n,i,r){const o=this.paintVertexArray.length,s=this.expression.evaluate(new ro(0),e,{},i,[],r);this.paintVertexArray.resize(t),this._setPaintValue(o,t,s)}updatePaintArray(t,e,n,i){const r=this.expression.evaluate({zoom:0},n,i);this._setPaintValue(t,e,r)}_setPaintValue(t,e,n){if("color"===this.type){const i=ws(n);for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i[0],i[1])}else{for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Cs{constructor(t,e,n,i,r,o){this.expression=t,this.uniformNames=e.map(t=>`u_${t}_t`),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:`a_${t}`,type:"Float32",components:"color"===n?4:2,offset:0})),this.paintVertexArray=new o}populatePaintArray(t,e,n,i,r){const o=this.expression.evaluate(new ro(this.zoom),e,{},i,[],r),s=this.expression.evaluate(new ro(this.zoom+1),e,{},i,[],r),a=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(a,t,o,s)}updatePaintArray(t,e,n,i){const r=this.expression.evaluate({zoom:this.zoom},n,i),o=this.expression.evaluate({zoom:this.zoom+1},n,i);this._setPaintValue(t,e,r,o)}_setPaintValue(t,e,n,i){if("color"===this.type){const r=ws(n),o=ws(i);for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,r[0],r[1],o[0],o[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const n=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,i=m(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(i)}getBinding(t,e,n){return new ys(t,e)}}class Is{constructor(t,e,n,i,r,o,s){this.expression=t,this.type=n,this.useIntegerZoom=i,this.zoom=r,this.layerId=s,this.paintVertexAttributes=("array"===n?as:ss).members;for(let a=0;a<e.length;++a);this.zoomInPaintVertexArray=new o,this.zoomOutPaintVertexArray=new o}populatePaintArray(t,e,n){const i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(i,t,e.patterns&&e.patterns[this.layerId],n)}updatePaintArray(t,e,n,i,r){this._setPaintValues(t,e,n.patterns&&n.patterns[this.layerId],r)}_setPaintValues(t,e,n,i){if(!i||!n)return;const{min:r,mid:o,max:s}=n,a=i[r],l=i[o],c=i[s];if(a&&l&&c)for(let u=t;u<e;u++)this._setPaintValue(this.zoomInPaintVertexArray,u,l,a),this._setPaintValue(this.zoomOutPaintVertexArray,u,l,c)}_setPaintValue(t,e,n,i){t.emplace(e,n.tl[0],n.tl[1],n.br[0],n.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],n.pixelRatio,i.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Es{constructor(t,e,n=(()=>!0)){this.binders={},this._buffers=[];const i=[];for(const r in t.paint._values){if(!n(r))continue;const o=t.paint.get(r);if(!(o instanceof ho&&Hn(o.property.specification)))continue;const s=Ps(r,t.type),a=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u,d="line-dasharray"===String(r)&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==a.kind||d)if("source"===a.kind||d||h){const n=Os(r,l,"source");this.binders[r]=h?new Is(a,s,l,c,e,n,t.id):new Ss(a,s,l,n),i.push(`/a_${r}`)}else{const t=Os(r,l,"composite");this.binders[r]=new Cs(a,s,l,c,e,t),i.push(`/z_${r}`)}else this.binders[r]=h?new As(a.value,s):new Ts(a.value,s,l),i.push(`/u_${r}`)}this.cacheKey=i.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof Ss||e instanceof Cs?e.maxValue:0}populatePaintArrays(t,e,n,i,r){for(const o in this.binders){const s=this.binders[o];(s instanceof Ss||s instanceof Cs||s instanceof Is)&&s.populatePaintArray(t,e,n,i,r)}}setConstantPatternPositions(t,e){for(const n in this.binders){const i=this.binders[n];i instanceof As&&i.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,n,i,r){let o=!1;for(const s in t){const a=e.getPositions(s);for(const e of a){const a=n.feature(e.index);for(const n in this.binders){const l=this.binders[n];if((l instanceof Ss||l instanceof Cs||l instanceof Is)&&!0===l.expression.isStateDependent){const c=i.paint.get(n);l.expression=c.value,l.updatePaintArray(e.start,e.end,a,t[s],r),o=!0}}}}return o}defines(){const t=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Ts||n instanceof As)&&t.push(...n.uniformNames.map(t=>`#define HAS_UNIFORM_${t}`))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const n=this.binders[e];if(n instanceof Ss||n instanceof Cs||n instanceof Is)for(let e=0;e<n.paintVertexAttributes.length;e++)t.push(n.paintVertexAttributes[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const n=this.binders[e];if(n instanceof Ts||n instanceof As||n instanceof Cs)for(const e of n.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const n=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Ts||r instanceof As||r instanceof Cs)for(const o of r.uniformNames)if(e[o]){const s=r.getBinding(t,e[o],o);n.push({name:o,property:i,binding:s})}}return n}setUniforms(t,e,n,i){for(const{name:r,property:o,binding:s}of e)this.binders[o].setUniform(s,i,n.get(o),r)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const n=this.binders[e];if(t&&n instanceof Is){const e=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(n instanceof Ss||n instanceof Cs)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(const e in this.binders){const n=this.binders[e];(n instanceof Ss||n instanceof Cs||n instanceof Is)&&n.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof Ss||e instanceof Cs||e instanceof Is)&&e.destroy()}}}class Ms{constructor(t,e,n=(()=>!0)){this.programConfigurations={};for(const i of t)this.programConfigurations[i.id]=new Es(i,e,n);this.needsUpload=!1,this._featureMap=new ds,this._bufferOffset=0}populatePaintArrays(t,e,n,i,r,o){for(const s in this.programConfigurations)this.programConfigurations[s].populatePaintArrays(t,e,i,r,o);void 0!==e.id&&this._featureMap.add(e.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,n,i){for(const r of n)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(t,this._featureMap,e,r,i)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const ks={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Ps(t,e){return ks[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Ds={"line-pattern":{source:ko,composite:ko},"fill-pattern":{source:ko,composite:ko},"fill-extrusion-pattern":{source:ko,composite:ko},"line-dasharray":{source:Po,composite:Po}},Ls={color:{source:Mo,composite:Yo},number:{source:qo,composite:Mo}};function Os(t,e,n){const i=Ds[t];return i&&i[n]||Ls[e][n]}or("ConstantBinder",Ts),or("CrossFadedConstantBinder",As),or("SourceExpressionBinder",Ss),or("CrossFadedCompositeBinder",Is),or("CompositeExpressionBinder",Cs),or("ProgramConfiguration",Es,{omit:["_buffers"]}),or("ProgramConfigurationSet",Ms);const Rs="-transition";class zs extends Zt{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==t.type&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new uo(e.layout)),e.paint)){this._transitionablePaint=new ao(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new po(e.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,n={}){null!=e&&this._validate(Qi,`layers.${this.id}.layout.${t}`,t,e,n)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return C(t,Rs)?this._transitionablePaint.getTransition(t.slice(0,-Rs.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,n={}){if(null!=e&&this._validate(Xi,`layers.${this.id}.paint.${t}`,t,e,n))return!1;if(C(t,Rs))return this._transitionablePaint.setTransition(t.slice(0,-Rs.length),e||void 0),!1;{const n=this._transitionablePaint._values[t],i="cross-faded-data-driven"===n.property.specification["property-type"],r=n.value.isDataDriven(),o=n.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const s=this._transitionablePaint._values[t].value;return s.isDataDriven()||r||i||this._handleOverridablePaintPropertyUpdate(t,o,s)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,e,n){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),E(t,(t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length))}_validate(t,e,n,i,r={}){return(!r||!1!==r.validate)&&Ki(this,t.call(Hi,{key:e,layerType:this.type,objectKey:n,value:i,styleSpec:Ft,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof ho&&Hn(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}}const Zs=Ao([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fs}=Zs;class Us{constructor(t=[]){this.segments=t}prepareSegment(t,e,n,i){let r=this.segments[this.segments.length-1];return t>Us.MAX_VERTEX_ARRAY_LENGTH&&P(`Max vertices per segment is ${Us.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!r||r.vertexLength+t>Us.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i)&&(r={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==i&&(r.sortKey=i),this.segments.push(r)),r}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,n,i){return new Us([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}Us.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,or("SegmentVector",Us);var Ns=8192;const Bs=Math.pow(2,14)-1,qs=-Bs-1;function $s(t){const e=Ns/t.extent,n=t.loadGeometry();for(let i=0;i<n.length;i++){const t=n[i];for(let n=0;n<t.length;n++){const i=t[n],r=Math.round(i.x*e),o=Math.round(i.y*e);i.x=m(r,qs,Bs),i.y=m(o,qs,Bs),(r<i.x||r>i.x+1||o<i.y||o>i.y+1)&&P("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Vs(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?$s(t):[]}}function js(t,e,n,i,r){t.emplaceBack(2*e+(i+1)/2,2*n+(r+1)/2)}class Gs{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Co,this.indexArray=new Uo,this.segments=new Us,this.programConfigurations=new Ms(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n){const i=this.layers[0],r=[];let o=null;"circle"===i.type&&(o=i.layout.get("circle-sort-key"));for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,e=Vs(s,t);if(!this.layers[0]._featureFilter.filter(new ro(this.zoom),e,n))continue;const i=o?o.evaluate(e,{},n):void 0,u={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:t?e.geometry:$s(s),patterns:{},sortKey:i};r.push(u)}o&&r.sort((t,e)=>t.sortKey-e.sortKey);for(const s of r){const{geometry:i,index:r,sourceLayerIndex:o}=s,a=t[r].feature;this.addFeature(s,i,r,n),e.featureIndex.insert(a,i,r,o,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fs),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,n,i){for(const r of e)for(const e of r){const n=e.x,i=e.y;if(n<0||n>=Ns||i<0||i>=Ns)continue;const r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),o=r.vertexLength;js(this.layoutVertexArray,n,i,-1,-1),js(this.layoutVertexArray,n,i,1,-1),js(this.layoutVertexArray,n,i,1,1),js(this.layoutVertexArray,n,i,-1,1),this.indexArray.emplaceBack(o,o+1,o+2),this.indexArray.emplaceBack(o,o+3,o+2),r.vertexLength+=4,r.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},i)}}function Ys(t,e){for(let n=0;n<t.length;n++)if(na(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(na(t,e[n]))return!0;return!!Xs(t,e)}function Hs(t,e,n){return!!na(t,e)||!!Ks(e,t,n)}function Js(t,e){if(1===t.length)return ea(e,t[0]);for(let n=0;n<e.length;n++){const i=e[n];for(let e=0;e<i.length;e++)if(na(t,i[e]))return!0}for(let n=0;n<t.length;n++)if(ea(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Xs(t,e[n]))return!0;return!1}function Ws(t,e,n){if(t.length>1){if(Xs(t,e))return!0;for(let i=0;i<e.length;i++)if(Ks(e[i],t,n))return!0}for(let i=0;i<t.length;i++)if(Ks(t[i],e,n))return!0;return!1}function Xs(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const i=t[n],r=t[n+1];for(let t=0;t<e.length-1;t++)if(Qs(i,r,e[t],e[t+1]))return!0}return!1}function Qs(t,e,n,i){return D(t,n,i)!==D(e,n,i)&&D(t,e,n)!==D(t,e,i)}function Ks(t,e,n){const i=n*n;if(1===e.length)return t.distSqr(e[0])<i;for(let r=1;r<e.length;r++)if(ta(t,e[r-1],e[r])<i)return!0;return!1}function ta(t,e,n){const i=e.distSqr(n);if(0===i)return t.distSqr(e);const r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return t.distSqr(r<0?e:r>1?n:n.sub(e)._mult(r)._add(e))}function ea(t,e){let n,i,r,o=!1;for(let s=0;s<t.length;s++){n=t[s];for(let t=0,s=n.length-1;t<n.length;s=t++)i=n[t],r=n[s],i.y>e.y!=r.y>e.y&&e.x<(r.x-i.x)*(e.y-i.y)/(r.y-i.y)+i.x&&(o=!o)}return o}function na(t,e){let n=!1;for(let i=0,r=t.length-1;i<t.length;r=i++){const o=t[i],s=t[r];o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(n=!n)}return n}function ia(t,e,n,i,o){for(const r of t)if(e<=r.x&&n<=r.y&&i>=r.x&&o>=r.y)return!0;const s=[new r(e,n),new r(e,o),new r(i,o),new r(i,n)];if(t.length>2)for(const r of s)if(na(t,r))return!0;for(let r=0;r<t.length-1;r++)if(ra(t[r],t[r+1],s))return!0;return!1}function ra(t,e,n){const i=n[0],r=n[2];if(t.x<i.x&&e.x<i.x||t.x>r.x&&e.x>r.x||t.y<i.y&&e.y<i.y||t.y>r.y&&e.y>r.y)return!1;const o=D(t,e,n[0]);return o!==D(t,e,n[1])||o!==D(t,e,n[2])||o!==D(t,e,n[3])}function oa(t,e,n){const i=e.paint.get(t).value;return"constant"===i.kind?i.value:n.programConfigurations.get(e.id).getMaxValue(t)}function sa(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function aa(t,e,n,i,o){if(!e[0]&&!e[1])return t;const s=r.convert(e)._mult(o);"viewport"===n&&s._rotate(-i);const a=[];for(let r=0;r<t.length;r++)a.push(t[r].sub(s));return a}function la(t,e,n,i){const o=r.convert(t)._mult(i);return"viewport"===e&&o._rotate(-n),o}or("CircleBucket",Gs,{omit:["layers"]});const ca=new vo({"circle-sort-key":new mo(Ft.layout_circle["circle-sort-key"])});var ua={paint:new vo({"circle-radius":new mo(Ft.paint_circle["circle-radius"]),"circle-color":new mo(Ft.paint_circle["circle-color"]),"circle-blur":new mo(Ft.paint_circle["circle-blur"]),"circle-opacity":new mo(Ft.paint_circle["circle-opacity"]),"circle-translate":new fo(Ft.paint_circle["circle-translate"]),"circle-translate-anchor":new fo(Ft.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new fo(Ft.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new fo(Ft.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new mo(Ft.paint_circle["circle-stroke-width"]),"circle-stroke-color":new mo(Ft.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new mo(Ft.paint_circle["circle-stroke-opacity"])}),layout:ca},ha="undefined"!=typeof Float32Array?Float32Array:Array;function da(){var t=new ha(9);return ha!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function pa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fa(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],y=e[14],_=e[15],v=n[0],x=n[1],b=n[2],w=n[3];return t[0]=v*i+x*a+b*h+w*m,t[1]=v*r+x*l+b*d+w*g,t[2]=v*o+x*c+b*p+w*y,t[3]=v*s+x*u+b*f+w*_,t[4]=(v=n[4])*i+(x=n[5])*a+(b=n[6])*h+(w=n[7])*m,t[5]=v*r+x*l+b*d+w*g,t[6]=v*o+x*c+b*p+w*y,t[7]=v*s+x*u+b*f+w*_,t[8]=(v=n[8])*i+(x=n[9])*a+(b=n[10])*h+(w=n[11])*m,t[9]=v*r+x*l+b*d+w*g,t[10]=v*o+x*c+b*p+w*y,t[11]=v*s+x*u+b*f+w*_,t[12]=(v=n[12])*i+(x=n[13])*a+(b=n[14])*h+(w=n[15])*m,t[13]=v*r+x*l+b*d+w*g,t[14]=v*o+x*c+b*p+w*y,t[15]=v*s+x*u+b*f+w*_,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ma=fa;function ga(){var t=new ha(3);return ha!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ya(t){return Math.hypot(t[0],t[1],t[2])}function _a(t,e,n){var i=new ha(3);return i[0]=t,i[1]=e,i[2]=n,i}function va(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function xa(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ba(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t}function wa(t,e){var n=e[0],i=e[1],r=e[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function Ta(t,e,n){var i=n[0],r=n[1],o=n[2],s=e[0],a=e[1],l=e[2],c=r*l-o*a,u=o*s-i*l,h=i*a-r*s,d=r*h-o*u,p=o*c-i*h,f=i*u-r*c,m=2*n[3];return u*=m,h*=m,p*=2,f*=2,t[0]=s+(c*=m)+(d*=2),t[1]=a+u+p,t[2]=l+h+f,t}var Aa,Sa=va,Ca=xa,Ia=ya;function Ea(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,t[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,t[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,t[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,t}function Ma(){var t=new ha(4);return ha!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function ka(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Pa(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+s*a,t[1]=r*l+o*a,t[2]=o*l-r*a,t[3]=s*l-i*a,t}function Da(t,e,n){const i=Ea([],[t.x,t.y,e,1],n);return new r(i[0]/i[3],i[1]/i[3])}ga(),Aa=new ha(4),ha!=Float32Array&&(Aa[0]=0,Aa[1]=0,Aa[2]=0,Aa[3]=0),ga(),_a(1,0,0),_a(0,1,0),Ma(),Ma(),da();const La=_a(0,0,0),Oa=_a(0,0,1);function Ra(t,e){const n=ga();return La[2]=e,t.intersectsPlane(La,Oa,n),new r(n[0],n[1])}class za extends Gs{}function Za(t,{width:e,height:n},i,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==e*n*i)throw new RangeError("mismatched image size")}else r=new Uint8Array(e*n*i);return t.width=e,t.height=n,t.data=r,t}function Fa(t,{width:e,height:n},i){if(e===t.width&&n===t.height)return;const r=Za({},{width:e,height:n},i);Ua(t,r,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,n)},i),t.width=e,t.height=n,t.data=r.data}function Ua(t,e,n,i,r,o){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;for(let l=0;l<r.height;l++){const c=((n.y+l)*t.width+n.x)*o,u=((i.y+l)*e.width+i.x)*o;for(let t=0;t<r.width*o;t++)a[u+t]=s[c+t]}return e}or("HeatmapBucket",za,{omit:["layers"]});class Na{constructor(t,e){Za(this,t,1,e)}resize(t){Fa(this,t,1)}clone(){return new Na({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,i,r){Ua(t,e,n,i,r,1)}}class Ba{constructor(t,e){Za(this,t,4,e)}resize(t){Fa(this,t,4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ba({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,i,r){Ua(t,e,n,i,r,4)}}or("AlphaImage",Na),or("RGBAImage",Ba);var qa={paint:new vo({"heatmap-radius":new mo(Ft.paint_heatmap["heatmap-radius"]),"heatmap-weight":new mo(Ft.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new fo(Ft.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _o(Ft.paint_heatmap["heatmap-color"]),"heatmap-opacity":new fo(Ft.paint_heatmap["heatmap-opacity"])})};function $a(t){const e={},n=t.resolution||256,i=t.clips?t.clips.length:1,r=t.image||new Ba({width:n,height:i}),o=(n,i,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);r.data[n+i+0]=Math.floor(255*s.r/s.a),r.data[n+i+1]=Math.floor(255*s.g/s.a),r.data[n+i+2]=Math.floor(255*s.b/s.a),r.data[n+i+3]=Math.floor(255*s.a)};if(t.clips)for(let s=0,a=0;s<i;++s,a+=4*n)for(let e=0,i=0;e<n;e++,i+=4){const r=e/(n-1),{start:l,end:c}=t.clips[s];o(a,i,l*(1-r)+c*r)}else for(let s=0,a=0;s<n;s++,a+=4)o(0,a,s/(n-1));return r}var Va={paint:new vo({"hillshade-illumination-direction":new fo(Ft.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new fo(Ft.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new fo(Ft.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new fo(Ft.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new fo(Ft.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new fo(Ft.paint_hillshade["hillshade-accent-color"])})};const ja=Ao([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ga}=ja;var Ya=Ja,Ha=Ja;function Ja(t,e,n){n=n||2;var i,r,o,s,a,l,c,u=e&&e.length,h=u?e[0]*n:t.length,d=Wa(t,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,n,i){var r,o,s,a=[];for(r=0,o=e.length;r<o;r++)(s=Wa(t,e[r]*i,r<o-1?e[r+1]*i:t.length,i,!1))===s.next&&(s.steiner=!0),a.push(al(s));for(a.sort(il),r=0;r<a.length;r++)rl(a[r],n),n=Xa(n,n.next);return n}(t,e,d,n)),t.length>80*n){i=o=t[0],r=s=t[1];for(var f=n;f<h;f+=n)(a=t[f])<i&&(i=a),(l=t[f+1])<r&&(r=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-i,s-r))?1/c:0}return Qa(d,p,n,i,r,c),p}function Wa(t,e,n,i,r){var o,s;if(r===xl(t,e,n,i)>0)for(o=e;o<n;o+=i)s=yl(o,t[o],t[o+1],s);else for(o=n-i;o>=e;o-=i)s=yl(o,t[o],t[o+1],s);return s&&hl(s,s.next)&&(_l(s),s=s.next),s}function Xa(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!hl(i,i.next)&&0!==ul(i.prev,i,i.next))i=i.next;else{if(_l(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function Qa(t,e,n,i,r,o,s){if(t){!s&&o&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=sl(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,o,s,a,l,c=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ);e++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}(t,i,r,o);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?tl(t,i,r,o):Ka(t))e.push(a.i/n),e.push(t.i/n),e.push(l.i/n),_l(t),t=l.next,c=l.next;else if((t=l)===c){s?1===s?Qa(t=el(Xa(t),e,n),e,n,i,r,o,2):2===s&&nl(t,e,n,i,r,o):Qa(Xa(t),e,n,i,r,o,1);break}}}function Ka(t){var e=t.prev,n=t,i=t.next;if(ul(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(ll(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&ul(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function tl(t,e,n,i){var r=t.prev,o=t,s=t.next;if(ul(r,o,s)>=0)return!1;for(var a=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,l=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,c=sl(r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,e,n,i),u=sl(a,l,e,n,i),h=t.prevZ,d=t.nextZ;h&&h.z>=c&&d&&d.z<=u;){if(h!==t.prev&&h!==t.next&&ll(r.x,r.y,o.x,o.y,s.x,s.y,h.x,h.y)&&ul(h.prev,h,h.next)>=0||(h=h.prevZ,d!==t.prev&&d!==t.next&&ll(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&ul(d.prev,d,d.next)>=0))return!1;d=d.nextZ}for(;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&ll(r.x,r.y,o.x,o.y,s.x,s.y,h.x,h.y)&&ul(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;d&&d.z<=u;){if(d!==t.prev&&d!==t.next&&ll(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&ul(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function el(t,e,n){var i=t;do{var r=i.prev,o=i.next.next;!hl(r,o)&&dl(r,i,i.next,o)&&ml(r,o)&&ml(o,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(o.i/n),_l(i),_l(i.next),i=t=o),i=i.next}while(i!==t);return Xa(i)}function nl(t,e,n,i,r,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&cl(s,a)){var l=gl(s,a);return s=Xa(s,s.next),l=Xa(l,l.next),Qa(s,e,n,i,r,o),void Qa(l,e,n,i,r,o)}a=a.next}s=s.next}while(s!==t)}function il(t,e){return t.x-e.x}function rl(t,e){if(e=function(t,e){var n,i=e,r=t.x,o=t.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>s){if(s=a,a===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===s)return n;var l,c=n,u=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&ll(o<h?r:s,o,u,h,o<h?s:r,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(r-i.x),ml(i,t)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&ol(n,i)))&&(n=i,d=l)),i=i.next}while(i!==c);return n}(t,e)){var n=gl(e,t);Xa(e,e.next),Xa(n,n.next)}}function ol(t,e){return ul(t.prev,t,e.prev)<0&&ul(e.next,t,t.next)<0}function sl(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function al(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function ll(t,e,n,i,r,o,s,a){return(r-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(i-a)-(n-s)*(e-a)>=0&&(n-s)*(o-a)-(r-s)*(i-a)>=0}function cl(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&dl(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(ml(t,e)&&ml(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(ul(t.prev,t,e.prev)||ul(t,e.prev,e))||hl(t,e)&&ul(t.prev,t,t.next)>0&&ul(e.prev,e,e.next)>0)}function ul(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function hl(t,e){return t.x===e.x&&t.y===e.y}function dl(t,e,n,i){var r=fl(ul(t,e,n)),o=fl(ul(t,e,i)),s=fl(ul(n,i,t)),a=fl(ul(n,i,e));return r!==o&&s!==a||!(0!==r||!pl(t,n,e))||!(0!==o||!pl(t,i,e))||!(0!==s||!pl(n,t,i))||!(0!==a||!pl(n,e,i))}function pl(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function fl(t){return t>0?1:t<0?-1:0}function ml(t,e){return ul(t.prev,t,t.next)<0?ul(t,e,t.next)>=0&&ul(t,t.prev,e)>=0:ul(t,e,t.prev)<0||ul(t,t.next,e)<0}function gl(t,e){var n=new vl(t.i,t.x,t.y),i=new vl(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function yl(t,e,n,i){var r=new vl(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function _l(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function vl(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xl(t,e,n,i){for(var r=0,o=e,s=n-i;o<n;o+=i)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}function bl(t,e,n,i,r){wl(t,e,n||0,i||t.length-1,r||Al)}function wl(t,e,n,i,r){for(;i>n;){if(i-n>600){var o=i-n+1,s=e-n+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);wl(t,e,Math.max(n,Math.floor(e-s*l/o+c)),Math.min(i,Math.floor(e+(o-s)*l/o+c)),r)}var u=t[e],h=n,d=i;for(Tl(t,n,e),r(t[i],u)>0&&Tl(t,n,i);h<d;){for(Tl(t,h,d),h++,d--;r(t[h],u)<0;)h++;for(;r(t[d],u)>0;)d--}0===r(t[n],u)?Tl(t,n,d):Tl(t,++d,i),d<=e&&(n=d+1),e<=d&&(i=d-1)}}function Tl(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function Al(t,e){return t<e?-1:t>e?1:0}function Sl(t,e){const n=t.length;if(n<=1)return[t];const i=[];let r,o;for(let s=0;s<n;s++){const e=L(t[s]);0!==e&&(t[s].area=Math.abs(e),void 0===o&&(o=e<0),o===e<0?(r&&i.push(r),r=[t[s]]):r.push(t[s]))}if(r&&i.push(r),e>1)for(let s=0;s<i.length;s++)i[s].length<=e||(bl(i[s],e,1,i[s].length-1,Cl),i[s]=i[s].slice(0,e));return i}function Cl(t,e){return e.area-t.area}function Il(t,e,n){const i=n.patternDependencies;let r=!1;for(const o of e){const e=o.paint.get(`${t}-pattern`);e.isConstant()||(r=!0);const n=e.constantOr(null);n&&(r=!0,i[n.to]=!0,i[n.from]=!0)}return r}function El(t,e,n,i,r){const o=r.patternDependencies;for(const s of e){const e=s.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:i-1},n,{},r.availableImages),a=e.evaluate({zoom:i},n,{},r.availableImages),l=e.evaluate({zoom:i+1},n,{},r.availableImages);t=t&&t.name?t.name:t,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[t]=!0,o[a]=!0,o[l]=!0,n.patterns[s.id]={min:t,mid:a,max:l}}}return n}Ja.deviation=function(t,e,n,i){var r=e&&e.length,o=Math.abs(xl(t,0,r?e[0]*n:t.length,n));if(r)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(xl(t,e[s]*n,s<a-1?e[s+1]*n:t.length,n));var l=0;for(s=0;s<i.length;s+=3){var c=i[s]*n,u=i[s+1]*n,h=i[s+2]*n;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Ja.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[r][o][s]);r>0&&n.holes.push(i+=t[r-1].length)}return n},Ya.default=Ha;class Ml{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Co,this.indexArray=new Uo,this.indexArray2=new jo,this.programConfigurations=new Ms(t.layers,t.zoom),this.segments=new Us,this.segments2=new Us,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n){this.hasPattern=Il("fill",this.layers,e);const i=this.layers[0].layout.get("fill-sort-key"),r=[];for(const{feature:o,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Vs(o,t);if(!this.layers[0]._featureFilter.filter(new ro(this.zoom),c,n))continue;const u=i?i.evaluate(c,{},n,e.availableImages):void 0,h={id:s,properties:o.properties,type:o.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:$s(o),patterns:{},sortKey:u};r.push(h)}i&&r.sort((t,e)=>t.sortKey-e.sortKey);for(const o of r){const{geometry:i,index:r,sourceLayerIndex:s}=o;if(this.hasPattern){const t=El("fill",this.layers,o,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(o,i,r,n,{});e.featureIndex.insert(t[r].feature,i,r,s,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}addFeatures(t,e,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,e,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ga),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,n,i,r){for(const o of Sl(e,500)){let t=0;for(const a of o)t+=a.length;const e=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),n=e.vertexLength,i=[],r=[];for(const a of o){if(0===a.length)continue;a!==o[0]&&r.push(i.length/2);const t=this.segments2.prepareSegment(a.length,this.layoutVertexArray,this.indexArray2),e=t.vertexLength;this.layoutVertexArray.emplaceBack(a[0].x,a[0].y),this.indexArray2.emplaceBack(e+a.length-1,e),i.push(a[0].x),i.push(a[0].y);for(let n=1;n<a.length;n++)this.layoutVertexArray.emplaceBack(a[n].x,a[n].y),this.indexArray2.emplaceBack(e+n-1,e+n),i.push(a[n].x),i.push(a[n].y);t.vertexLength+=a.length,t.primitiveLength+=a.length}const s=Ya(i,r);for(let o=0;o<s.length;o+=3)this.indexArray.emplaceBack(n+s[o],n+s[o+1],n+s[o+2]);e.vertexLength+=t,e.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}}or("FillBucket",Ml,{omit:["layers","patternFeatures"]});const kl=new vo({"fill-sort-key":new mo(Ft.layout_fill["fill-sort-key"])});var Pl={paint:new vo({"fill-antialias":new fo(Ft.paint_fill["fill-antialias"]),"fill-opacity":new mo(Ft.paint_fill["fill-opacity"]),"fill-color":new mo(Ft.paint_fill["fill-color"]),"fill-outline-color":new mo(Ft.paint_fill["fill-outline-color"]),"fill-translate":new fo(Ft.paint_fill["fill-translate"]),"fill-translate-anchor":new fo(Ft.paint_fill["fill-translate-anchor"]),"fill-pattern":new go(Ft.paint_fill["fill-pattern"])}),layout:kl};const Dl=Ao([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ll=Ao([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Ol}=Dl;var Rl=zl;function zl(t,e,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=r,t.readFields(Zl,this,e)}function Zl(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function Fl(t){for(var e,n,i=0,r=0,o=t.length,s=o-1;r<o;s=r++)i+=((n=t[s]).x-(e=t[r]).x)*(e.y+n.y);return i}zl.types=["Unknown","Point","LineString","Polygon"],zl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,o=0,s=0,a=0,l=[];t.pos<n;){if(o<=0){var c=t.readVarint();i=7&c,o=c>>3}if(o--,1===i||2===i)s+=t.readSVarint(),a+=t.readSVarint(),1===i&&(e&&l.push(e),e=[]),e.push(new r(s,a));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&l.push(e),l},zl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(i<=0){var u=t.readVarint();n=7&u,i=u>>3}if(i--,1===n||2===n)(r+=t.readSVarint())<s&&(s=r),r>a&&(a=r),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command "+n)}return[s,l,a,c]},zl.prototype.toGeoJSON=function(t,e,n){var i,r,o=this.extent*Math.pow(2,n),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=zl.types[this.type];function u(t){for(var e=0;e<t.length;e++){var n=t[e];t[e]=[360*(n.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];u(l=h);break;case 2:for(i=0;i<l.length;i++)u(l[i]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var n,i,r=[],o=0;o<e;o++){var s=Fl(t[o]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(n&&r.push(n),n=[t[o]]):n.push(t[o]))}return n&&r.push(n),r}(l),i=0;i<l.length;i++)for(r=0;r<l[i].length;r++)u(l[i][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var Ul=Nl;function Nl(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Bl,this,e),this.length=this._features.length}function Bl(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(n))}function ql(t,e,n){if(3===t){var i=new Ul(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}Nl.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Rl(this._pbf,e,this.extent,this._keys,this._values)};var $l={VectorTile:function(t,e){this.layers=t.readFields(ql,{},e)},VectorTileFeature:Rl,VectorTileLayer:Ul};const Vl=$l.VectorTileFeature.types,jl=Math.pow(2,13);function Gl(t,e,n,i,r,o,s,a){t.emplaceBack((e<<1)+s,(n<<1)+o,(Math.floor(i*jl)<<1)+r,Math.round(a))}class Yl{constructor(){this.acc=new r(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new r(t.x,t.y),this.max=new r(t.x,t.y))}append(t,e){this.currentPolyCount.edges++,this.acc._add(t);let n=!!this.borders;const i=this.min,r=this.max;t.x<i.x?(i.x=t.x,n=!0):t.x>r.x&&(r.x=t.x,n=!0),t.y<i.y?(i.y=t.y,n=!0):t.y>r.y&&(r.y=t.y,n=!0),((0===t.x||t.x===Ns)&&t.x===e.x)!=((0===t.y||t.y===Ns)&&t.y===e.y)&&this.processBorderOverlap(t,e),n&&this.checkBorderIntersection(t,e)}checkBorderIntersection(t,e){e.x<0!=t.x<0&&this.addBorderIntersection(0,nn(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>Ns!=t.x>Ns&&this.addBorderIntersection(1,nn(e.y,t.y,(Ns-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,nn(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>Ns!=t.y>Ns&&this.addBorderIntersection(3,nn(e.x,t.x,(Ns-e.y)/(t.y-e.y)))}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[t];e<n[0]&&(n[0]=e),e>n[1]&&(n[1]=e)}processBorderOverlap(t,e){if(t.x===e.x){if(t.y===e.y)return;const n=0===t.x?0:1;this.addBorderIntersection(n,e.y),this.addBorderIntersection(n,t.y)}else{const n=0===t.y?2:3;this.addBorderIntersection(n,e.x),this.addBorderIntersection(n,t.x)}}centroid(){const t=this.polyCount.reduce((t,e)=>t+e.edges,0);return 0!==t?this.acc.div(t)._round():new r(0,0)}span(){return new r(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,e)=>t+ +(e[0]!==Number.MAX_VALUE),0)}}class Hl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Io,this.centroidVertexArray=new os,this.indexArray=new Uo,this.programConfigurations=new Ms(t.layers,t.zoom),this.segments=new Us,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=t.enableTerrain}populate(t,e,n){this.features=[],this.hasPattern=Il("fill-extrusion",this.layers,e),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(t){const e=Math.exp(Math.PI*(1-t.y/(1<<t.z)*2));return 80150034*e/(e*e+1)/Ns/(1<<t.z)}(n);for(const{feature:i,id:r,index:o,sourceLayerIndex:s}of t){const t=this.layers[0]._featureFilter.needGeometry,a=Vs(i,t);if(!this.layers[0]._featureFilter.filter(new ro(this.zoom),a,n))continue;const l={id:r,sourceLayerIndex:s,index:o,geometry:t?a.geometry:$s(i),properties:i.properties,type:i.type,patterns:{}},c=this.layoutVertexArray.length;this.hasPattern?this.features.push(El("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,l.geometry,o,n,{}),e.featureIndex.insert(i,l.geometry,o,s,this.index,c)}this.sortBorders()}addFeatures(t,e,n){for(const i of this.features){const{geometry:t}=i;this.addFeature(i,t,i.index,e,n)}this.sortBorders()}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ol),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ll.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,n,i,r){const o=this.enableTerrain?new Yl:null;for(const a of Sl(e,500)){let e=0,n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===a.length||(s=a[0]).every(t=>t.x<=0)||s.every(t=>t.x>=Ns)||s.every(t=>t.y<=0)||s.every(t=>t.y>=Ns))continue;for(let t=0;t<a.length;t++){const i=a[t];if(0===i.length)continue;e+=i.length;let r=0;o&&o.startRing(i[0]);for(let t=0;t<i.length;t++){const e=i[t];if(t>=1){const s=i[t-1];if(!Jl(e,s)){o&&o.append(e,s),n.vertexLength+4>Us.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=e.sub(s)._perp(),i=t.x/(Math.abs(t.x)+Math.abs(t.y)),a=t.y>0?1:0,l=s.dist(e);r+l>32768&&(r=0),Gl(this.layoutVertexArray,e.x,e.y,i,a,0,0,r),Gl(this.layoutVertexArray,e.x,e.y,i,a,0,1,r),r+=l,Gl(this.layoutVertexArray,s.x,s.y,i,a,0,0,r),Gl(this.layoutVertexArray,s.x,s.y,i,a,0,1,r);const c=n.vertexLength;this.indexArray.emplaceBack(c,c+2,c+1),this.indexArray.emplaceBack(c+1,c+2,c+3),n.vertexLength+=4,n.primitiveLength+=2}}}}if(n.vertexLength+e>Us.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray)),"Polygon"!==Vl[t.type])continue;const i=[],r=[],l=n.vertexLength;for(let t=0;t<a.length;t++){const e=a[t];if(0!==e.length){e!==a[0]&&r.push(i.length/2);for(let t=0;t<e.length;t++){const n=e[t];Gl(this.layoutVertexArray,n.x,n.y,0,0,1,1,0),i.push(n.x),i.push(n.y),o&&o.currentPolyCount.top++}}}const c=Ya(i,r);for(let t=0;t<c.length;t+=3)this.indexArray.emplaceBack(l+c[t],l+c[t+2],l+c[t+1]);n.primitiveLength+=c.length/3,n.vertexLength+=e}var s;if(o&&o.polyCount.length>0){if(o.borders){o.vertexArrayOffset=this.centroidVertexArray.length;const t=o.borders,e=this.featuresOnBorder.push(o)-1;for(let n=0;n<4;n++)t[n][0]!==Number.MAX_VALUE&&this.borders[n].push(e)}this.encodeCentroid(o.borders?void 0:o.centroid(),o)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((e,n)=>this.featuresOnBorder[e].borders[t][0]-this.featuresOnBorder[n].borders[t][0])}encodeCentroid(t,e,n=!0){let i,r;if(t)if(0!==t.y){const n=e.span()._mult(this.tileToMeter);i=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(n.x/10)),r=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(n.y/10))}else i=Math.ceil(7*(t.x+450)),r=0;else i=0,r=+n;let o=n?this.centroidVertexArray.length:e.vertexArrayOffset;for(const s of e.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*s.edges+s.top);for(let t=0;t<2*s.edges;t++)this.centroidVertexArray.emplace(o++,0,r),this.centroidVertexArray.emplace(o++,i,r);for(let t=0;t<s.top;t++)this.centroidVertexArray.emplace(o++,i,r)}}}function Jl(t,e){return t.x===e.x&&(t.x<0||t.x>Ns)||t.y===e.y&&(t.y<0||t.y>Ns)}or("FillExtrusionBucket",Hl,{omit:["layers","features"]}),or("PartMetadata",Yl);var Wl={paint:new vo({"fill-extrusion-opacity":new fo(Ft["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new mo(Ft["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new fo(Ft["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new fo(Ft["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new go(Ft["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new mo(Ft["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new mo(Ft["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new fo(Ft["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Xl(t,e){return t.x*e.x+t.y*e.y}function Ql(t,e){if(1===t.length){let n=0;const i=e[n++];let r;for(;!r||i.equals(r);)if(r=e[n++],!r)return 1/0;for(;n<e.length;n++){const o=e[n],s=t[0],a=r.sub(i),l=o.sub(i),c=s.sub(i),u=Xl(a,a),h=Xl(a,l),d=Xl(l,l),p=Xl(c,a),f=Xl(c,l),m=u*d-h*h,g=(d*p-h*f)/m,y=(u*f-h*p)/m,_=i.z*(1-g-y)+r.z*g+o.z*y;if(isFinite(_))return _}return 1/0}{let t=1/0;for(const n of e)t=Math.min(t,n.z);return t}}function Kl(t){const e=new r(t[0],t[1]);return e.z=t[2],e}function tc(t,e,n,i,r,o,s,a){const l=s*r.getElevationAt(t,e,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(t,e,n){const i=Math.floor(e[0]/8),r=Math.floor(e[1]/8),o=10*(e[0]-8*i),s=10*(e[1]-8*r),a=t.getElevationAt(i,r,!0,!0),l=t.getMeterToDEM(n),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=t.tileCoordToPixel(i,r),d=2*c+1,p=2*u+1,f=(T=d,A=p,[(x=t).getElevationAtPixel(b=h.x-c,w=h.y-u,!0),x.getElevationAtPixel(b+A,w,!0),x.getElevationAtPixel(b,w+A,!0),x.getElevationAtPixel(b+T,w+A,!0)]),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),y=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),_=Math.min(.25,.5*l*(m+g)/d),v=Math.min(.25,.5*l*y/p);var x,b,w,T,A;return a+Math.max(_*o,v*s)}(r,o,a):l;return{base:l+(0===n)?-1:n,top:c?Math.max(u+i,l+n+2):l+i}}const ec=Ao([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:nc}=ec,ic=Ao([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:rc}=ic,oc=$l.VectorTileFeature.types,sc=Math.cos(Math.PI/180*37.5);class ac{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new Eo,this.layoutVertexArray2=new Mo,this.indexArray=new Uo,this.programConfigurations=new Ms(t.layers,t.zoom),this.segments=new Us,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n){this.hasPattern=Il("line",this.layers,e);const i=this.layers[0].layout.get("line-sort-key"),r=[];for(const{feature:l,id:c,index:u,sourceLayerIndex:h}of t){const t=this.layers[0]._featureFilter.needGeometry,e=Vs(l,t);if(!this.layers[0]._featureFilter.filter(new ro(this.zoom),e,n))continue;const o=i?i.evaluate(e,{},n):void 0,s={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:t?e.geometry:$s(l),patterns:{},sortKey:o};r.push(s)}i&&r.sort((t,e)=>t.sortKey-e.sortKey);const{lineAtlas:o,featureIndex:s}=e,a=this.addConstantDashes(o);for(const l of r){const{geometry:i,index:r,sourceLayerIndex:c}=l;if(a&&this.addFeatureDashes(l,o),this.hasPattern){const t=El("line",this.layers,l,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(l,i,r,n,o.positions);s.insert(t[r].feature,i,r,c,this.index)}}addConstantDashes(t){let e=!1;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,r=n.layout.get("line-cap").value;if("constant"!==i.kind||"constant"!==r.kind)e=!0;else{const e=r.value,n=i.value;if(!n)continue;t.addDash(n.from,e),t.addDash(n.to,e),n.other&&t.addDash(n.other,e)}}return e}addFeatureDashes(t,e){const n=this.zoom;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,o=i.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===o.kind)continue;let s,a,l,c,u,h;if("constant"===r.kind){const t=r.value;if(!t)continue;s=t.other||t.to,a=t.to,l=t.from}else s=r.evaluate({zoom:n-1},t),a=r.evaluate({zoom:n},t),l=r.evaluate({zoom:n+1},t);"constant"===o.kind?c=u=h=o.value:(c=o.evaluate({zoom:n-1},t),u=o.evaluate({zoom:n},t),h=o.evaluate({zoom:n+1},t)),e.addDash(s,c),e.addDash(a,u),e.addDash(l,h);const d=e.getKey(s,c),p=e.getKey(a,u),f=e.getKey(l,h);t.patterns[i.id]={min:d,mid:p,max:f}}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}addFeatures(t,e,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,e,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,rc)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,nc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,n,i,r){const o=this.layers[0].layout,s=o.get("line-join").evaluate(t,{}),a=o.get("line-cap").evaluate(t,{}),l=o.get("line-miter-limit"),c=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const u of e)this.addLine(u,t,s,a,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}addLine(t,e,n,i,r,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===oc[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let l=0;for(;l<a-1&&t[l].equals(t[l+1]);)l++;if(a<(s?3:2))return;"bevel"===n&&(r=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,s&&(h=t[a-2],m=t[l].sub(h)._unit()._perp());for(let g=l;g<a;g++){if(p=g===a-1?s?t[l+1]:void 0:t[g+1],p&&t[g].equals(p))continue;m&&(f=m),h&&(d=h),h=t[g],m=p?p.sub(h)._unit()._perp():f,f=f||m;let e=f.add(m);0===e.x&&0===e.y||e._unit();const y=f.x*m.x+f.y*m.y,_=e.x*m.x+e.y*m.y,v=0!==_?1/_:1/0,x=2*Math.sqrt(2-2*_),b=_<sc&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&g>l){const t=h.dist(d);if(t>2*c){const e=h.sub(h.sub(d)._mult(c/t)._round());this.updateDistance(d,e),this.addCurrentVertex(e,f,0,0,u),d=e}}const T=d&&p;let A=T?n:s?"butt":i;if(T&&"round"===A&&(v<o?A="miter":v<=2&&(A="fakeround")),"miter"===A&&v>r&&(A="bevel"),"bevel"===A&&(v>2&&(A="flipbevel"),v<r&&(A="miter")),d&&this.updateDistance(d,h),"miter"===A)e._mult(v),this.addCurrentVertex(h,e,0,0,u);else if("flipbevel"===A){if(v>100)e=m.mult(-1);else{const t=v*f.add(m).mag()/f.sub(m).mag();e._perp()._mult(t*(w?-1:1))}this.addCurrentVertex(h,e,0,0,u),this.addCurrentVertex(h,e.mult(-1),0,0,u)}else if("bevel"===A||"fakeround"===A){const t=-Math.sqrt(v*v-1),e=w?t:0,n=w?0:t;if(d&&this.addCurrentVertex(h,f,e,n,u),"fakeround"===A){const t=Math.round(180*x/Math.PI/20);for(let e=1;e<t;e++){let n=e/t;if(.5!==n){const t=n-.5;n+=n*t*(n-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*t*t+(.848013+y*(.215638*y-1.06021)))}const i=m.sub(f)._mult(n)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,i.x,i.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-e,-n,u)}else if("butt"===A)this.addCurrentVertex(h,e,0,0,u);else if("square"===A){const t=d?1:-1;d||this.addCurrentVertex(h,e,t,t,u),this.addCurrentVertex(h,e,0,0,u),d&&this.addCurrentVertex(h,e,t,t,u)}else"round"===A&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&g<a-1){const t=h.dist(p);if(t>2*c){const e=h.add(p.sub(h)._mult(c/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,m,0,0,u),h=e}}}}addCurrentVertex(t,e,n,i,r,o=!1){const s=e.y*i-e.x,a=-e.y-e.x*i;this.addHalfVertex(t,e.x+e.y*n,e.y-e.x*n,o,!1,n,r),this.addHalfVertex(t,s,a,o,!0,-i,r)}addHalfVertex({x:t,y:e},n,i,r,o,s,a){this.layoutVertexArray.emplaceBack((t<<1)+(r?1:0),(e<<1)+(o?1:0),Math.round(63*n)+128,Math.round(63*i)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}or("LineBucket",ac,{omit:["layers","patternFeatures"]});const lc=new vo({"line-cap":new mo(Ft.layout_line["line-cap"]),"line-join":new mo(Ft.layout_line["line-join"]),"line-miter-limit":new fo(Ft.layout_line["line-miter-limit"]),"line-round-limit":new fo(Ft.layout_line["line-round-limit"]),"line-sort-key":new mo(Ft.layout_line["line-sort-key"])});var cc={paint:new vo({"line-opacity":new mo(Ft.paint_line["line-opacity"]),"line-color":new mo(Ft.paint_line["line-color"]),"line-translate":new fo(Ft.paint_line["line-translate"]),"line-translate-anchor":new fo(Ft.paint_line["line-translate-anchor"]),"line-width":new mo(Ft.paint_line["line-width"]),"line-gap-width":new mo(Ft.paint_line["line-gap-width"]),"line-offset":new mo(Ft.paint_line["line-offset"]),"line-blur":new mo(Ft.paint_line["line-blur"]),"line-dasharray":new go(Ft.paint_line["line-dasharray"]),"line-pattern":new go(Ft.paint_line["line-pattern"]),"line-gradient":new _o(Ft.paint_line["line-gradient"])}),layout:lc};const uc=new class extends mo{possiblyEvaluate(t,e){return e=new ro(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,i){return e=v({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,i)}}(cc.paint.properties["line-width"].specification);function hc(t,e){return e>0?e+2*t:t}uc.useIntegerZoom=!0;const dc=Ao([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),pc=Ao([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ao([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const fc=Ao([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),mc=Ao([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ao([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const gc=Ao([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),yc=Ao([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ao([{name:"triangle",components:3,type:"Uint16"}]),Ao([{type:"Float32",name:"anchorX"},{type:"Float32",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ao([{type:"Float32",name:"anchorX"},{type:"Float32",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ao([{type:"Float32",name:"offsetX"}]),Ao([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const _c=128;function vc(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new ro(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:i}=n;let r=0;for(;r<e.length&&e[r]<=t;)r++;r=Math.max(0,r-1);let o=r;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const s=e[r],a=e[o];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:a,minSize:n.evaluate(new ro(s)),maxSize:n.evaluate(new ro(a)),interpolationType:i}}}function xc(t,{uSize:e,uSizeT:n},{lowerSize:i,upperSize:r}){return"source"===t.kind?i/_c:"composite"===t.kind?nn(i/_c,r/_c,n):e}function bc(t,e){let n=0,i=0;if("constant"===t.kind)i=t.layoutSize;else if("source"!==t.kind){const{interpolationType:r,minZoom:o,maxZoom:s}=t,a=r?m(xn.interpolationFactor(r,e,o,s),0,1):0;"camera"===t.kind?i=nn(t.minSize,t.maxSize,a):n=a}return{uSizeT:n,uSize:i}}var wc=Object.freeze({__proto__:null,getSizeData:vc,evaluateSizeForFeature:xc,evaluateSizeForZoom:bc,SIZE_PACK_FACTOR:_c});function Tc(t,e,n){return t.sections.forEach(t=>{t.text=function(t,e,n){const i=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?t=t.toLocaleUpperCase():"lowercase"===i&&(t=t.toLocaleLowerCase()),io.applyArabicShaping&&(t=io.applyArabicShaping(t)),t}(t.text,e,n)}),t}const Ac={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Sc(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function Cc(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var Ic=function(t,e,n,i,r){var o,s,a=8*r-i-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?r-1:0,d=n?-1:1,p=t[e+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=i;u>0;s=256*s+t[e+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),o-=c}return(p?-1:1)*s*Math.pow(2,o-i)},Ec=function(t,e,n,i,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,r),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;t[n+p]=255&a,p+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;t[n+p]=255&s,p+=f,s/=256,c-=8);t[n+p-f]|=128*m},Mc=kc;function kc(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}kc.Varint=0,kc.Fixed64=1,kc.Bytes=2,kc.Fixed32=5;var Pc=4294967296,Dc=1/Pc,Lc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Oc(t){return t.type===kc.Bytes?t.readVarint()+t.pos:t.pos+1}function Rc(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function zc(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Zc(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Fc(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function Uc(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function Nc(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function Bc(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function qc(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function $c(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function Vc(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function jc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Gc(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function Yc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Hc(t,e,n){e.glyphs=[],1===t&&n.readMessage(Jc,e)}function Jc(t,e,n){if(3===t){const{id:t,bitmap:i,width:r,height:o,left:s,top:a,advance:l}=n.readMessage(Wc,{});e.glyphs.push({id:t,bitmap:new Na({width:r+6,height:o+6},i),metrics:{width:r,height:o,left:s,top:a,advance:l}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function Wc(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function Xc(t){let e=0,n=0;for(const s of t)e+=s.w*s.h,n=Math.max(n,s.w);t.sort((t,e)=>e.h-t.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let r=0,o=0;for(const s of t)for(let t=i.length-1;t>=0;t--){const e=i[t];if(!(s.w>e.w||s.h>e.h)){if(s.x=e.x,s.y=e.y,o=Math.max(o,s.y+s.h),r=Math.max(r,s.x+s.w),s.w===e.w&&s.h===e.h){const e=i.pop();t<i.length&&(i[t]=e)}else s.h===e.h?(e.x+=s.w,e.w-=s.w):s.w===e.w?(e.y+=s.h,e.h-=s.h):(i.push({x:e.x+s.w,y:e.y,w:e.w-s.w,h:s.h}),e.y+=s.h,e.h-=s.h);break}}return{w:r,h:o,fill:e/(r*o)||0}}kc.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=7&i,t(r,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=jc(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Yc(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=jc(this.buf,this.pos)+jc(this.buf,this.pos+4)*Pc;return this.pos+=8,t},readSFixed64:function(){var t=jc(this.buf,this.pos)+Yc(this.buf,this.pos+4)*Pc;return this.pos+=8,t},readFloat:function(){var t=Ic(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Ic(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(t,e,n){var i,r,o=n.buf;if(i=(112&(r=o[n.pos++]))>>4,r<128||(i|=(127&(r=o[n.pos++]))<<3,r<128)||(i|=(127&(r=o[n.pos++]))<<10,r<128)||(i|=(127&(r=o[n.pos++]))<<17,r<128)||(i|=(127&(r=o[n.pos++]))<<24,r<128)||(i|=(1&(r=o[n.pos++]))<<31,r<128))return function(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Lc?Lc.decode(this.buf.subarray(e,t)):function(t,e,n){for(var i="",r=e;r<n;){var o,s,a,l=t[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>n)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=t[r+2],128==(192&(o=t[r+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=t[r+2],a=t[r+3],128==(192&(o=t[r+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),i+=String.fromCharCode(c),r+=u}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==kc.Bytes)return t.push(this.readVarint(e));var n=Oc(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==kc.Bytes)return t.push(this.readSVarint());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==kc.Bytes)return t.push(this.readBoolean());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==kc.Bytes)return t.push(this.readFloat());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==kc.Bytes)return t.push(this.readDouble());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==kc.Bytes)return t.push(this.readFixed32());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==kc.Bytes)return t.push(this.readSFixed32());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==kc.Bytes)return t.push(this.readFixed64());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==kc.Bytes)return t.push(this.readSFixed64());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===kc.Varint)for(;this.buf[this.pos++]>127;);else if(e===kc.Bytes)this.pos=this.readVarint()+this.pos;else if(e===kc.Fixed32)this.pos+=4;else{if(e!==kc.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Gc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Gc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Gc(this.buf,-1&t,this.pos),Gc(this.buf,Math.floor(t*Dc),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Gc(this.buf,-1&t,this.pos),Gc(this.buf,Math.floor(t*Dc),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,i,r,o;if(t>=0?(n=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),r=n,(o=e).buf[o.pos++]=127&r|128,r>>>=7,o.buf[o.pos++]=127&r|128,r>>>=7,o.buf[o.pos++]=127&r|128,r>>>=7,o.buf[o.pos++]=127&r|128,o.buf[o.pos]=127&(r>>>=7),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var i,r,o=0;o<e.length;o++){if((i=e.charCodeAt(o))>55295&&i<57344){if(!r){i>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&Rc(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Ec(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Ec(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&Rc(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,kc.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,zc,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Zc,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Nc,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Fc,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Uc,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Bc,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,qc,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,$c,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Vc,e)},writeBytesField:function(t,e){this.writeTag(t,kc.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,kc.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,kc.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,kc.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,kc.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,kc.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,kc.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,kc.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,kc.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,kc.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Qc{constructor(t,{pixelRatio:e,version:n,stretchX:i,stretchY:r,content:o}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=i,this.stretchY=r,this.content=o,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Kc{constructor(t,e){const n={},i={};this.haveRenderCallbacks=[];const r=[];this.addImages(t,n,r),this.addImages(e,i,r);const{w:o,h:s}=Xc(r),a=new Ba({width:o||1,height:s||1});for(const l in t){const e=t[l],i=n[l].paddedRect;Ba.copy(e.data,a,{x:0,y:0},{x:i.x+1,y:i.y+1},e.data)}for(const l in e){const t=e[l],n=i[l].paddedRect,r=n.x+1,o=n.y+1,s=t.data.width,c=t.data.height;Ba.copy(t.data,a,{x:0,y:0},{x:r,y:o},t.data),Ba.copy(t.data,a,{x:0,y:c-1},{x:r,y:o-1},{width:s,height:1}),Ba.copy(t.data,a,{x:0,y:0},{x:r,y:o+c},{width:s,height:1}),Ba.copy(t.data,a,{x:s-1,y:0},{x:r-1,y:o},{width:1,height:c}),Ba.copy(t.data,a,{x:0,y:0},{x:r+s,y:o},{width:1,height:c})}this.image=a,this.iconPositions=n,this.patternPositions=i}addImages(t,e,n){for(const i in t){const r=t[i],o={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(o),e[i]=new Qc(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)}patchUpdatedImage(t,e,n){if(!t||!e||t.version===e.version)return;t.version=e.version;const[i,r]=t.tl;n.update(e.data,void 0,{x:i,y:r})}}or("ImagePosition",Qc),or("ImageAtlas",Kc);const tu={horizontal:1,vertical:2,horizontalOnly:3};class eu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const n=new eu;return n.scale=t||1,n.fontStack=e,n}static forImage(t){const e=new eu;return e.imageName=t,e}}class nu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const n=new nu;for(let i=0;i<t.sections.length;i++){const r=t.sections[i];r.image?n.addImageSection(r):n.addTextSection(r,e)}return n}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(t,e){let n="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i+1)||null,o=t.charCodeAt(i-1)||null;n+=!e&&(r&&qr(r)&&!Ac[t[i+1]]||o&&qr(o)&&!Ac[t[i-1]])||!Ac[t[i]]?t[i]:Ac[t[i]]}return n}(this.text,t)}trim(){let t=0;for(let n=0;n<this.text.length&&ru[this.text.charCodeAt(n)];n++)t++;let e=this.text.length;for(let n=this.text.length-1;n>=0&&n>=t&&ru[this.text.charCodeAt(n)];n--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const n=new nu;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,e)=>Math.max(t,this.sections[e].scale),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(eu.forText(t.scale,t.fontStack||e));const n=this.sections.length-1;for(let i=0;i<t.text.length;++i)this.sectionIndex.push(n)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void P("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(eu.forImage(e)),this.sectionIndex.push(this.sections.length-1)):P("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function iu(t,e,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const g=nu.fromFeature(t,r);let y;h===tu.vertical&&g.verticalizePunctuation(d);const{processBidirectionalText:_,processStyledBidirectionalText:v}=io;if(_&&1===g.sections.length){y=[];const t=_(g.toString(),hu(g,c,o,e,i,p,f));for(const e of t){const t=new nu;t.text=e,t.sections=g.sections;for(let n=0;n<e.length;n++)t.sectionIndex.push(0);y.push(t)}}else if(v){y=[];const t=v(g.text,g.sectionIndex,hu(g,c,o,e,i,p,f));for(const e of t){const t=new nu;t.text=e[0],t.sectionIndex=e[1],t.sections=g.sections,y.push(t)}}else y=function(t,e){const n=[],i=t.text;let r=0;for(const o of e)n.push(t.substring(r,o)),r=o;return r<i.length&&n.push(t.substring(r,i.length)),n}(g,hu(g,c,o,e,i,p,f));const x=[],b={positionedLines:x,text:g.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(t,e,n,i,r,o,s,a,l,c,u,h){let d=0,p=0,f=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const w of r){const t=w.getSections();for(const n of t){if(n.imageName)continue;const t=e[n.fontStack];if(t&&(g=void 0!==t.ascender&&void 0!==t.descender,!g))break}if(!g)break}let y=0;for(const w of r){w.trim();const r=w.getMaxScale(),s=24*(r-1),a={positionedGlyphs:[],lineOffset:0};t.positionedLines[y]=a;const v=a.positionedGlyphs;let x=0;if(!w.length()){p+=o,++y;continue}let b=0,T=0;for(let o=0;o<w.length();o++){const s=w.getSection(o),a=w.getSectionIndex(o),f=w.getCharCode(o);let m=s.scale,y=null,A=null,S=null,C=24,I=0;const E=!(l===tu.horizontal||!u&&!Br(f)||u&&(ru[f]||(_=f,hr(_)||dr(_)||pr(_)||Dr(_)||zr(_))));if(s.imageName){const e=i[s.imageName];if(!e)continue;S=s.imageName,t.iconsInText=t.iconsInText||!0,A=e.paddedRect;const n=e.displaySize;m=24*m/h,y={width:n[0],height:n[1],left:1,top:-3,advance:E?n[1]:n[0],localGlyph:!1},I=g?-y.height*m:24*r-17-n[1]*m,C=y.advance;const o=(E?n[0]:n[1])*m-24*r;o>0&&o>x&&(x=o)}else{const t=n[s.fontStack];if(!t)continue;t[f]&&(A=t[f]);const i=e[s.fontStack];if(!i)continue;const o=i.glyphs[f];if(!o)continue;if(y=o.metrics,C=8203!==f?24:0,g){const t=void 0!==i.ascender?Math.abs(i.ascender):0,e=void 0!==i.descender?Math.abs(i.descender):0,n=(t+e)*m;b<n&&(b=n,T=(t-e)/2*m),I=-t*m}else I=24*(r-m)-17}E?(t.verticalizable=!0,v.push({glyph:f,imageName:S,x:d,y:p+I,vertical:E,scale:m,localGlyph:y.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:y,rect:A}),d+=C*m+c):(v.push({glyph:f,imageName:S,x:d,y:p+I,vertical:E,scale:m,localGlyph:y.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:y,rect:A}),d+=y.advance*m+c)}0!==v.length&&(f=Math.max(d-c,f),g?pu(v,m,x,T,o*r/2):pu(v,m,x,0,o/2)),d=0;const A=o*r+x;a.lineOffset=Math.max(x,s),p+=A,++y}var _;const v=p,{horizontalAlign:x,verticalAlign:b}=du(s);(function(t,e,n,i,r,o){const s=(e-n)*r,a=-o*i;for(const l of t)for(const t of l.positionedGlyphs)t.x+=s,t.y+=a})(t.positionedLines,m,x,b,f,v),t.top+=-b*v,t.bottom=t.top+v,t.left+=-x*f,t.right=t.left+f,t.hasBaseline=g}(b,e,n,i,y,s,a,l,h,c,d,m),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(x)&&b}const ru={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ou={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function su(t,e,n,i,r,o){if(e.imageName){const t=i[e.imageName];return t?t.displaySize[0]*e.scale*24/o+r:0}{const i=n[e.fontStack],o=i&&i.glyphs[t];return o?o.metrics.advance*e.scale+r:0}}function au(t,e,n,i){const r=Math.pow(t-e,2);return i?t<e?r/2:2*r:r+Math.abs(n)*n}function lu(t,e,n){let i=0;return 10===t&&(i-=1e4),n&&(i+=150),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function cu(t,e,n,i,r,o){let s=null,a=au(e,n,r,o);for(const l of i){const t=au(e-l.x,n,r,o)+l.badness;t<=a&&(s=l,a=t)}return{index:t,x:e,priorBreak:s,badness:a}}function uu(t){return t?uu(t.priorBreak).concat(t.index):[]}function hu(t,e,n,i,r,o,s){if("point"!==o)return[];if(!t)return[];const a=[],l=function(t,e,n,i,r,o){let s=0;for(let a=0;a<t.length();a++){const n=t.getSection(a);s+=su(t.getCharCode(a),n,i,r,e,o)}return s/Math.max(1,Math.ceil(s/n))}(t,e,n,i,r,s),c=t.text.indexOf("\u200b")>=0;let u=0;for(let d=0;d<t.length();d++){const n=t.getSection(d),o=t.getCharCode(d);if(ru[o]||(u+=su(o,n,i,r,e,s)),d<t.length()-1){const e=!((h=o)<11904||!(br(h)||xr(h)||Or(h)||Pr(h)||Sr(h)||fr(h)||wr(h)||yr(h)||Cr(h)||Ir(h)||Ar(h)||Zr(h)||_r(h)||gr(h)||mr(h)||Tr(h)||vr(h)||Lr(h)||Mr(h)||Er(h)));(ou[o]||e||n.imageName)&&a.push(cu(d+1,u,l,a,lu(o,t.getCharCode(d+1),e&&c),!1))}}var h;return uu(cu(t.length(),u,l,a,0,!0))}function du(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function pu(t,e,n,i,r){if(!(e||n||i||r))return;const o=t.length-1,s=t[o],a=(s.x+s.metrics.advance*s.scale)*e;for(let l=0;l<=o;l++)t[l].x-=a,t[l].y+=n+i+r}function fu(t,e,n){const{horizontalAlign:i,verticalAlign:r}=du(n),o=e[0]-t.displaySize[0]*i,s=e[1]-t.displaySize[1]*r;return{image:t,top:s,bottom:s+t.displaySize[1],left:o,right:o+t.displaySize[0]}}function mu(t,e,n,i,r,o){const s=t.image;let a;if(s.content){const t=s.content,e=s.pixelRatio||1;a=[t[0]/e,t[1]/e,s.displaySize[0]-t[2]/e,s.displaySize[1]-t[3]/e]}const l=e.left*o,c=e.right*o;let u,h,d,p;"width"===n||"both"===n?(p=r[0]+l-i[3],h=r[0]+c+i[1]):(p=r[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=e.top*o,m=e.bottom*o;return"height"===n||"both"===n?(u=r[1]+f-i[0],d=r[1]+m+i[2]):(u=r[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class gu extends r{constructor(t,e,n,i){super(t,e),this.angle=n,void 0!==i&&(this.segment=i)}clone(){return new gu(this.x,this.y,this.angle,this.segment)}}function yu(t,e,n,i,r){if(void 0===e.segment)return!0;let o=e,s=e.segment+1,a=0;for(;a>-n/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let c=0;for(;a<n/2;){const e=t[s],n=t[s+1];if(!n)return!1;let o=t[s-1].angleTo(e)-e.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>i;)c-=l.shift().angleDelta;if(c>r)return!1;s++,a+=e.dist(n)}return!0}function _u(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function vu(t,e,n){return t?.6*e*n:0}function xu(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function bu(t,e,n,i,r,o){const s=vu(n,r,o),a=xu(n,i)*o;let l=0;const c=_u(t)/2;for(let u=0;u<t.length-1;u++){const n=t[u],i=t[u+1],r=n.dist(i);if(l+r>c){const o=(c-l)/r,h=nn(n.x,i.x,o),d=nn(n.y,i.y,o),p=new gu(h,d,i.angleTo(n),u);return!s||yu(t,p,a,s,e)?p:void 0}l+=r}}function wu(t,e,n,i,r,o,s,a,l){const c=vu(i,o,s),u=xu(i,r),h=u*s,d=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),Tu(t,d?e/2*a%e:(u/2+2*o)*s*a%e,e,c,n,h,d,!1,l)}function Tu(t,e,n,i,r,o,s,a,l){const c=o/2,u=_u(t);let h=0,d=e-n,p=[];for(let f=0;f<t.length-1;f++){const e=t[f],s=t[f+1],a=e.dist(s),m=s.angleTo(e);for(;d+n<h+a;){d+=n;const g=(d-h)/a,y=nn(e.x,s.x,g),_=nn(e.y,s.y,g);if(y>=0&&y<l&&_>=0&&_<l&&d-c>=0&&d+c<=u){const e=new gu(y,_,m,f);e._round(),i&&!yu(t,e,o,i,r)||p.push(e)}}h+=a}return a||p.length||s||(p=Tu(t,h/2,n,i,r,o,s,!0,l)),p}function Au(t,e,n,i,o){const s=[];for(let a=0;a<t.length;a++){const l=t[a];let c;for(let t=0;t<l.length-1;t++){let a=l[t],u=l[t+1];a.x<e&&u.x<e||(a.x<e?a=new r(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x<e&&(u=new r(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y<n&&u.y<n||(a.y<n?a=new r(a.x+(n-a.y)/(u.y-a.y)*(u.x-a.x),n)._round():u.y<n&&(u=new r(a.x+(n-a.y)/(u.y-a.y)*(u.x-a.x),n)._round()),a.x>=i&&u.x>=i||(a.x>=i?a=new r(i,a.y+(i-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x>=i&&(u=new r(i,a.y+(i-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y>=o&&u.y>=o||(a.y>=o?a=new r(a.x+(o-a.y)/(u.y-a.y)*(u.x-a.x),o)._round():u.y>=o&&(u=new r(a.x+(o-a.y)/(u.y-a.y)*(u.x-a.x),o)._round()),c&&a.equals(c[c.length-1])||(c=[a],s.push(c)),c.push(u)))))}}return s}or("Anchor",gu);var Su=Eu,Cu=Eu,Iu=1e20;function Eu(t,e,n,i,r,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var s=this.size=this.fontSize+2*this.buffer,a=s+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=s,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(s/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Mu(t,e,n,i,r,o){for(var s=0;s<e;s++)ku(t,s,e,n,i,r,o);for(var a=0;a<n;a++)ku(t,a*e,1,e,i,r,o)}function ku(t,e,n,i,r,o,s){var a,l,c,u;for(o[0]=0,s[0]=-Iu,s[1]=Iu,a=0;a<i;a++)r[a]=t[e+a*n];for(a=1,l=0,c=0;a<i;a++){do{c=(r[a]-r[u=o[l]]+a*a-u*u)/(a-u)/2}while(c<=s[l]&&--l>-1);o[++l]=a,s[l]=c,s[l+1]=Iu}for(a=0,l=0;a<i;a++){for(;s[l+1]<a;)l++;t[e+a*n]=r[u=o[l]]+(a-u)*(a-u)}}Eu.prototype._draw=function(t,e){var n,i,r,o,s,a,l,c,u,h=this.ctx.measureText(t),d=h.width,p=2*this.buffer;e&&this.useMetrics?(s=Math.floor(h.actualBoundingBoxAscent),c=this.buffer+Math.ceil(h.actualBoundingBoxAscent),a=this.buffer,l=this.buffer,n=(i=Math.min(this.size,Math.ceil(h.actualBoundingBoxRight-h.actualBoundingBoxLeft)))+p,r=(o=Math.min(this.size-a,Math.ceil(h.actualBoundingBoxAscent+h.actualBoundingBoxDescent)))+p,this.ctx.textBaseline="alphabetic"):(n=i=this.size,r=o=this.size,s=19*this.fontSize/24,a=l=0,c=this.middle,this.ctx.textBaseline="middle"),i&&o&&(this.ctx.clearRect(l,a,i,o),this.ctx.fillText(t,this.buffer,c),u=this.ctx.getImageData(l,a,i,o));var f=new Uint8ClampedArray(n*r);return function(t,e,n,i,r,o,s){o.fill(Iu,0,e*n),s.fill(0,0,e*n);for(var a=(e-i)/2,l=0;l<r;l++)for(var c=0;c<i;c++){var u=(l+a)*e+c+a,h=t.data[4*(l*i+c)+3]/255;if(1===h)o[u]=0,s[u]=Iu;else if(0===h)o[u]=Iu,s[u]=0;else{var d=Math.max(0,.5-h),p=Math.max(0,h-.5);o[u]=d*d,s[u]=p*p}}}(u,n,r,i,o,this.gridOuter,this.gridInner),Mu(this.gridOuter,n,r,this.f,this.v,this.z),Mu(this.gridInner,n,r,this.f,this.v,this.z),function(t,e,n,i,r,o,s){for(var a=0;a<e*n;a++){var l=Math.sqrt(i[a])-Math.sqrt(r[a]);t[a]=Math.round(255-255*(l/o+s))}}(f,n,r,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:f,metrics:{width:i,height:o,sdfWidth:n,sdfHeight:r,top:s,left:0,advance:d}}},Eu.prototype.draw=function(t){return this._draw(t,!1).data},Eu.prototype.drawWithMetrics=function(t){return this._draw(t,!0)},Su.default=Cu;const Pu={none:0,ideographs:1,all:2};class Du{constructor(t,e,n){this.requestManager=t,this.localGlyphMode=e,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,e){const n=[];for(const i in t)for(const e of t[i])n.push({stack:i,id:e});y(n,({stack:t,id:e},n)=>{let i=this.entries[t];i||(i=this.entries[t]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let r=i.glyphs[e];if(void 0!==r)return void n(null,{stack:t,id:e,glyph:r});if(r=this._tinySDF(i,t,e),r)return i.glyphs[e]=r,void n(null,{stack:t,id:e,glyph:r});const o=Math.floor(e/256);if(256*o>65535)return void n(new Error("glyphs > 65535 not supported"));if(i.ranges[o])return void n(null,{stack:t,id:e,glyph:r});let s=i.requests[o];s||(s=i.requests[o]=[],Du.loadGlyphRange(t,o,this.url,this.requestManager,(t,e)=>{if(e){i.ascender=e.ascender,i.descender=e.descender;for(const t in e.glyphs)this._doesCharSupportLocalGlyph(+t)||(i.glyphs[+t]=e.glyphs[+t]);i.ranges[o]=!0}for(const n of s)n(t,e);delete i.requests[o]})),s.push((i,r)=>{i?n(i):r&&n(null,{stack:t,id:e,glyph:r.glyphs[e]||null})})},(t,n)=>{if(t)e(t);else if(n){const t={};for(const{stack:e,id:i,glyph:r}of n)void 0===t[e]&&(t[e]={}),void 0===t[e].glyphs&&(t[e].glyphs={}),t[e].glyphs[i]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics},t[e].ascender=this.entries[e].ascender,t[e].descender=this.entries[e].descender;e(null,t)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==Pu.none&&(this.localGlyphMode===Pu.all?!!this.localFontFamily:!!this.localFontFamily&&(Ir(t)||kr(t)||_r(t)||vr(t))||yr(t))}_tinySDF(t,e,n){const i=this.localFontFamily;if(!i||!this._doesCharSupportLocalGlyph(n))return;let r=t.tinySDF;if(!r){let n="400";/bold/i.test(e)?n="900":/medium/i.test(e)?n="500":/light/i.test(e)&&(n="200"),r=t.tinySDF=new Du.TinySDF(48,6,16,.25,i,n)}if(this.localGlyphs[r.fontWeight][n])return this.localGlyphs[r.fontWeight][n];const{data:o,metrics:s}=r.drawWithMetrics(String.fromCharCode(n)),{sdfWidth:a,sdfHeight:l,width:c,height:u,left:h,top:d,advance:p}=s;return this.localGlyphs[r.fontWeight][n]={id:n,bitmap:new Na({width:a,height:l},o),metrics:{width:c/2,height:u/2,left:h/2,top:d/2-27,advance:p/2,localGlyph:!0}}}}function Lu(t,e,n,i){const o=[],s=t.image,a=s.pixelRatio,l=s.paddedRect.w-2,c=s.paddedRect.h-2,u=t.right-t.left,h=t.bottom-t.top,d=s.stretchX||[[0,l]],p=s.stretchY||[[0,c]],f=(t,e)=>t+e[1]-e[0],m=d.reduce(f,0),g=p.reduce(f,0),y=l-m,_=c-g;let v=0,x=m,b=0,w=g,T=0,A=y,S=0,C=_;if(s.content&&i){const t=s.content;v=Ou(d,0,t[0]),b=Ou(p,0,t[1]),x=Ou(d,t[0],t[2]),w=Ou(p,t[1],t[3]),T=t[0]-v,S=t[1]-b,A=t[2]-t[0]-x,C=t[3]-t[1]-w}const I=(i,o,l,c)=>{const d=zu(i.stretch-v,x,u,t.left),p=Zu(i.fixed-T,A,i.stretch,m),f=zu(o.stretch-b,w,h,t.top),y=Zu(o.fixed-S,C,o.stretch,g),_=zu(l.stretch-v,x,u,t.left),I=Zu(l.fixed-T,A,l.stretch,m),E=zu(c.stretch-b,w,h,t.top),M=Zu(c.fixed-S,C,c.stretch,g),k=new r(d,f),P=new r(_,f),D=new r(_,E),L=new r(d,E),O=new r(p/a,y/a),R=new r(I/a,M/a),z=e*Math.PI/180;if(z){const t=Math.sin(z),e=Math.cos(z),n=[e,-t,t,e];k._matMult(n),P._matMult(n),L._matMult(n),D._matMult(n)}const Z=i.stretch+i.fixed,F=o.stretch+o.fixed;return{tl:k,tr:P,bl:L,br:D,tex:{x:s.paddedRect.x+1+Z,y:s.paddedRect.y+1+F,w:l.stretch+l.fixed-Z,h:c.stretch+c.fixed-F},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:O,pixelOffsetBR:R,minFontScaleX:A/a/u,minFontScaleY:C/a/h,isSDF:n}};if(i&&(s.stretchX||s.stretchY)){const t=Ru(d,y,m),e=Ru(p,_,g);for(let n=0;n<t.length-1;n++){const i=t[n],r=t[n+1];for(let t=0;t<e.length-1;t++)o.push(I(i,e[t],r,e[t+1]))}}else o.push(I({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return o}function Ou(t,e,n){let i=0;for(const r of t)i+=Math.max(e,Math.min(n,r[1]))-Math.max(e,Math.min(n,r[0]));return i}function Ru(t,e,n){const i=[{fixed:-1,stretch:0}];for(const[r,o]of t){const t=i[i.length-1];i.push({fixed:r-t.stretch,stretch:t.stretch}),i.push({fixed:r-t.stretch,stretch:t.stretch+(o-r)})}return i.push({fixed:e+1,stretch:n}),i}function zu(t,e,n,i){return t/e*n+i}function Zu(t,e,n,i){return t-e*n/i}function Fu(t,e,n,i){const r=e+t.positionedLines[i].lineOffset;return 0===i?n+r/2:n+(r+(e+t.positionedLines[i-1].lineOffset))/2}Du.loadGlyphRange=function(t,e,n,i,r){const o=256*e,s=o+255,a=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${o}-${s}`),bt.Glyphs);St(a,(t,e)=>{if(t)r(t);else if(e){const t={},n=new Mc(e).readFields(Hc,{});for(const e of n.glyphs)t[e.id]=e;r(null,{glyphs:t,ascender:n.ascender,descender:n.descender})}})},Du.TinySDF=Su;class Uu{constructor(t=[],e=Nu){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,i=e[t];for(;t>0;){const r=t-1>>1,o=e[r];if(n(i,o)>=0)break;e[t]=o,t=r}e[t]=i}_down(t){const{data:e,compare:n}=this,i=this.length>>1,r=e[t];for(;t<i;){let i=1+(t<<1),o=e[i];const s=i+1;if(s<this.length&&n(e[s],o)<0&&(i=s,o=e[s]),n(o,r)>=0)break;e[t]=o,t=i}e[t]=r}}function Nu(t,e){return t<e?-1:t>e?1:0}function Bu(t,e=1,n=!1){let i=1/0,o=1/0,s=-1/0,a=-1/0;const l=t[0];for(let r=0;r<l.length;r++){const t=l[r];(!r||t.x<i)&&(i=t.x),(!r||t.y<o)&&(o=t.y),(!r||t.x>s)&&(s=t.x),(!r||t.y>a)&&(a=t.y)}const c=Math.min(s-i,a-o);let u=c/2;const h=new Uu([],qu);if(0===c)return new r(i,o);for(let r=i;r<s;r+=c)for(let e=o;e<a;e+=c)h.push(new $u(r+u,e+u,u,t));let d=function(t){let e=0,n=0,i=0;const r=t[0];for(let o=0,s=r.length,a=s-1;o<s;a=o++){const t=r[o],s=r[a],l=t.x*s.y-s.x*t.y;n+=(t.x+s.x)*l,i+=(t.y+s.y)*l,e+=3*l}return new $u(n/e,i/e,0,t)}(t),p=h.length;for(;h.length;){const i=h.pop();(i.d>d.d||!d.d)&&(d=i,n&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,p)),i.max-d.d<=e||(u=i.h/2,h.push(new $u(i.p.x-u,i.p.y-u,u,t)),h.push(new $u(i.p.x+u,i.p.y-u,u,t)),h.push(new $u(i.p.x-u,i.p.y+u,u,t)),h.push(new $u(i.p.x+u,i.p.y+u,u,t)),p+=4)}return n&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function qu(t,e){return e.max-t.max}function $u(t,e,n,i){this.p=new r(t,e),this.h=n,this.d=function(t,e){let n=!1,i=1/0;for(let r=0;r<e.length;r++){const o=e[r];for(let e=0,r=o.length,s=r-1;e<r;s=e++){const r=o[e],a=o[s];r.y>t.y!=a.y>t.y&&t.x<(a.x-r.x)*(t.y-r.y)/(a.y-r.y)+r.x&&(n=!n),i=Math.min(i,ta(t,r,a))}}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}const Vu=Number.POSITIVE_INFINITY,ju=Math.sqrt(2);function Gu(t,e){return e[1]!==Vu?function(t,e,n){let i=0,r=0;switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":r=n-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-n}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}return[i,r]}(t,e[0],e[1]):function(t,e){let n=0,i=0;e<0&&(e=0);const r=e/ju;switch(t){case"top-right":case"top-left":i=r-7;break;case"bottom-right":case"bottom-left":i=7-r;break;case"bottom":i=7-e;break;case"top":i=e-7}switch(t){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=e;break;case"right":n=-e}return[n,i]}(t,e[0])}function Yu(t,e,n,i,r,o,s,a){t.createArrays(),t.tilePixelRatio=Ns/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const l=t.layers[0].layout,c=t.layers[0]._unevaluatedLayout._values,u={};if("composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:n}=t.textSizeData;u.compositeTextSizes=[c["text-size"].possiblyEvaluate(new ro(e),s),c["text-size"].possiblyEvaluate(new ro(n),s)]}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:n}=t.iconSizeData;u.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new ro(e),s),c["icon-size"].possiblyEvaluate(new ro(n),s)]}u.layoutTextSize=c["text-size"].possiblyEvaluate(new ro(a+1),s),u.layoutIconSize=c["icon-size"].possiblyEvaluate(new ro(a+1),s),u.textMaxSize=c["text-size"].possiblyEvaluate(new ro(18),s);const h="map"===l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),d=l.get("text-size");for(const p of t.features){const o=l.get("text-font").evaluate(p,{},s).join(","),a=d.evaluate(p,{},s),c=u.layoutTextSize.evaluate(p,{},s),f=(u.layoutIconSize.evaluate(p,{},s),{horizontal:{},vertical:void 0}),m=p.text;let g,y=[0,0];if(m){const i=m.toString(),u=24*l.get("text-letter-spacing").evaluate(p,{},s),d=24*l.get("text-line-height").evaluate(p,{},s),g=Ur(i)?u:0,_=l.get("text-anchor").evaluate(p,{},s),v=l.get("text-variable-anchor");if(!v){const t=l.get("text-radial-offset").evaluate(p,{},s);y=t?Gu(_,[24*t,Vu]):l.get("text-offset").evaluate(p,{},s).map(t=>24*t)}let x=h?"center":l.get("text-justify").evaluate(p,{},s);const b=l.get("symbol-placement"),w="point"===b,T="point"===b?24*l.get("text-max-width").evaluate(p,{},s):0,A=s=>{t.allowVerticalPlacement&&Fr(i)&&(f.vertical=iu(m,e,n,r,o,T,d,_,s,g,y,tu.vertical,!0,b,c,a))};if(!h&&v){const t="auto"===x?v.map(t=>Hu(t)):[x];let i=!1;for(let s=0;s<t.length;s++){const l=t[s];if(!f.horizontal[l])if(i)f.horizontal[l]=f.horizontal[0];else{const t=iu(m,e,n,r,o,T,d,"center",l,g,y,tu.horizontal,!1,b,c,a);t&&(f.horizontal[l]=t,i=1===t.positionedLines.length)}}A("left")}else{if("auto"===x&&(x=Hu(_)),w||l.get("text-writing-mode").indexOf("horizontal")>=0||!Fr(i)){const t=iu(m,e,n,r,o,T,d,_,x,g,y,tu.horizontal,!1,b,c,a);t&&(f.horizontal[x]=t)}A("point"===b?"left":x)}}let _=!1;if(p.icon&&p.icon.name){const e=i[p.icon.name];e&&(g=fu(r[p.icon.name],l.get("icon-offset").evaluate(p,{},s),l.get("icon-anchor").evaluate(p,{},s)),_=e.sdf,void 0===t.sdfIcons?t.sdfIcons=e.sdf:t.sdfIcons!==e.sdf&&P("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const v=Qu(f.horizontal)||f.vertical;t.iconsInText||(t.iconsInText=!!v&&v.iconsInText),(v||g)&&Ju(t,p,f,g,i,u,c,0,y,_,s)}o&&t.generateCollisionDebugBuffers(a,t.collisionBoxArray)}function Hu(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ju(t,e,n,i,r,o,s,a,l,c,h){let d=o.textMaxSize.evaluate(e,{},h);void 0===d&&(d=s);const p=t.layers[0].layout,f=p.get("icon-offset").evaluate(e,{},h),m=Qu(n.horizontal)||n.vertical,g=s/24,y=t.tilePixelRatio*d/24,_=t.tilePixelRatio*p.get("symbol-spacing"),v=p.get("text-padding")*t.tilePixelRatio,x=p.get("icon-padding")*t.tilePixelRatio,b=u(p.get("text-max-angle")),w="map"===p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),T="map"===p.get("icon-rotation-alignment")&&"point"!==p.get("symbol-placement"),A=p.get("symbol-placement"),S=_/2,C=p.get("icon-text-fit");let I;i&&"none"!==C&&(t.allowVerticalPlacement&&n.vertical&&(I=mu(i,n.vertical,C,p.get("icon-text-fit-padding"),f,g)),m&&(i=mu(i,m,C,p.get("icon-text-fit-padding"),f,g)));const E=(a,u)=>{u.x<0||u.x>=Ns||u.y<0||u.y>=Ns||function(t,e,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T){const A=t.addToLineVertexArray(e,n);let S,C,I,E,M,k,D,L=0,O=0,R=0,z=0,Z=-1,F=-1;const U={};let N=us(""),B=0,q=0;if(void 0===a._unevaluatedLayout.getValue("text-radial-offset")?[B,q]=a.layout.get("text-offset").evaluate(v,{},w).map(t=>24*t):(B=24*a.layout.get("text-radial-offset").evaluate(v,{},w),q=Vu),t.allowVerticalPlacement&&i.vertical){const t=i.vertical;if(p)k=th(t),s&&(D=th(s));else{const n=a.layout.get("text-rotate").evaluate(v,{},w)+90;I=Ku(l,e,c,u,h,t,d,n,f),s&&(E=Ku(l,e,c,u,h,s,g,n))}}if(r){const n=a.layout.get("icon-rotate").evaluate(v,{},w),i="none"!==a.layout.get("icon-text-fit"),o=Lu(r,n,b,i),d=s?Lu(s,n,b,i):void 0;C=Ku(l,e,c,u,h,r,g,n),L=4*o.length;const p=t.iconSizeData;let f=null;"source"===p.kind?(f=[_c*a.layout.get("icon-size").evaluate(v,{},w)],f[0]>Wu&&P(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===p.kind&&(f=[_c*x.compositeIconSizes[0].evaluate(v,{},w),_c*x.compositeIconSizes[1].evaluate(v,{},w)],(f[0]>Wu||f[1]>Wu)&&P(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),t.addSymbols(t.icon,o,f,_,y,v,!1,e,A.lineStartIndex,A.lineLength,-1,w),Z=t.icon.placedSymbolArray.length-1,d&&(O=4*d.length,t.addSymbols(t.icon,d,f,_,y,v,tu.vertical,e,A.lineStartIndex,A.lineLength,-1,w),F=t.icon.placedSymbolArray.length-1)}for(const P in i.horizontal){const n=i.horizontal[P];S||(N=us(n.text),p?M=th(n):S=Ku(l,e,c,u,h,n,d,a.layout.get("text-rotate").evaluate(v,{},w),f));const r=1===n.positionedLines.length;if(R+=Xu(t,e,n,o,a,p,v,f,A,i.vertical?tu.horizontal:tu.horizontalOnly,r?Object.keys(i.horizontal):[P],U,Z,x,w),r)break}i.vertical&&(z+=Xu(t,e,i.vertical,o,a,p,v,f,A,tu.vertical,["vertical"],U,F,x,w));let $=-1;const V=(t,e)=>t?Math.max(t,e):e;$=V(M,$),$=V(k,$),$=V(D,$);const j=$>-1?1:0;j&&($*=T/24),t.glyphOffsetArray.length>=ch.MAX_GLYPHS&&P("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==v.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,v.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,U.right>=0?U.right:-1,U.center>=0?U.center:-1,U.left>=0?U.left:-1,U.vertical>=0?U.vertical:-1,Z,F,N,void 0!==S?S:t.collisionBoxArray.length,void 0!==S?S+1:t.collisionBoxArray.length,void 0!==I?I:t.collisionBoxArray.length,void 0!==I?I+1:t.collisionBoxArray.length,void 0!==C?C:t.collisionBoxArray.length,void 0!==C?C+1:t.collisionBoxArray.length,E||t.collisionBoxArray.length,E?E+1:t.collisionBoxArray.length,c,R,z,L,O,j,0,B,q,$)}(t,u,a,n,i,r,I,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,v,w,l,0,x,T,f,e,o,c,h,s)};if("line"===A)for(const u of Au(e.geometry,0,0,Ns,Ns)){const e=wu(u,_,b,n.vertical||m,i,24,y,t.overscaling,Ns);for(const n of e){const e=m;e&&eh(t,e.text,S,n)||E(u,n)}}else if("line-center"===A){for(const t of e.geometry)if(t.length>1){const e=bu(t,b,n.vertical||m,i,24,y);e&&E(t,e)}}else if("Polygon"===e.type)for(const u of Sl(e.geometry,0)){const t=Bu(u,16);E(u[0],new gu(t.x,t.y,0))}else if("LineString"===e.type)for(const u of e.geometry)E(u,new gu(u[0].x,u[0].y,0));else if("Point"===e.type)for(const u of e.geometry)for(const t of u)E([t],new gu(t.x,t.y,0))}const Wu=32640;function Xu(t,e,n,i,o,s,a,l,c,u,h,d,p,f,m){const g=function(t,e,n,i,o,s,a,l){const c=[];if(0===e.positionedLines.length)return c;const u=i.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,h=function(t){const e=t[0],n=t[1],i=e*n;return i>0?[e,-n]:i<0?[-e,n]:0===e?[n,e]:[n,-e]}(n);let d=Math.abs(e.top-e.bottom);for(const r of e.positionedLines)d-=r.lineOffset;const p=e.positionedLines.length,f=d/p;let m=e.top-n[1];for(let g=0;g<p;++g){const t=e.positionedLines[g];m=Fu(e,f,m,g);for(const i of t.positionedGlyphs){if(!i.rect)continue;const t=i.rect||{};let s=4,d=!0,p=1,f=0;const g=(o||l)&&i.vertical,y=i.metrics.advance*i.scale/2,_=i.metrics,v=i.rect;if(null===v)continue;if(l&&e.verticalizable&&(f=i.imageName?y-i.metrics.width*i.scale/2:0),i.imageName){const t=a[i.imageName];if(!t)continue;d=t.sdf,p=t.pixelRatio,s=1/p}const x=o?[i.x+y,i.y]:[0,0];let b=[0,0],w=[0,0],T=!1;o||(g?(w=[i.x+y+h[0],i.y+h[1]-f],T=!0):b=[i.x+y+n[0],i.y+n[1]-f]);const A=v.w*i.scale/(p*(i.localGlyph?2:1)),S=v.h*i.scale/(p*(i.localGlyph?2:1));let C,I,E,M;if(g){const t=i.y-m,e=new r(-y,y-t),n=-Math.PI/2,o=new r(...w);C=new r(-y+b[0],b[1]),C._rotateAround(n,e)._add(o),C.x+=-t+y,C.y-=(_.left-s)*i.scale;const a=i.imageName?_.advance*i.scale:24*i.scale,l=String.fromCharCode(i.glyph);Sc(l)?C.x+=(1-s)*i.scale:Cc(l)?C.x+=a-_.height*i.scale+(-s-1)*i.scale:C.x+=i.imageName||_.width+2*s===v.w&&_.height+2*s===v.h?(a-S)/2:(a-(_.height+2*s)*i.scale)/2,I=new r(C.x,C.y-A),E=new r(C.x+S,C.y),M=new r(C.x+S,C.y-A)}else{const t=(_.left-s)*i.scale-y+b[0],e=(-_.top-s)*i.scale+b[1],n=t+A,o=e+S;C=new r(t,e),I=new r(n,e),E=new r(t,o),M=new r(n,o)}if(u){let t;t=o?new r(0,0):T?new r(h[0],h[1]):new r(n[0],n[1]),C._rotateAround(u,t),I._rotateAround(u,t),E._rotateAround(u,t),M._rotateAround(u,t)}const k=new r(0,0),P=new r(0,0);c.push({tl:C,tr:I,bl:E,br:M,tex:t,writingMode:e.writingMode,glyphOffset:x,sectionIndex:i.sectionIndex,isSDF:d,pixelOffsetTL:k,pixelOffsetBR:P,minFontScaleX:0,minFontScaleY:0})}}return c}(0,n,l,o,s,a,i,t.allowVerticalPlacement),y=t.textSizeData;let _=null;"source"===y.kind?(_=[_c*o.layout.get("text-size").evaluate(a,{},m)],_[0]>Wu&&P(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===y.kind&&(_=[_c*f.compositeTextSizes[0].evaluate(a,{},m),_c*f.compositeTextSizes[1].evaluate(a,{},m)],(_[0]>Wu||_[1]>Wu)&&P(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,g,_,l,s,a,u,e,c.lineStartIndex,c.lineLength,p,m);for(const r of h)d[r]=t.text.placedSymbolArray.length-1;return 4*g.length}function Qu(t){for(const e in t)return t[e];return null}function Ku(t,e,n,i,o,s,a,l,c){let h=s.top,d=s.bottom,p=s.left,f=s.right;const m=s.collisionPadding;if(m&&(p-=m[0],h-=m[1],f+=m[2],d+=m[3]),l){const t=new r(p,h),e=new r(f,h),n=new r(p,d),i=new r(f,d),o=u(l);let s=new r(0,0);c&&(s=new r(c[0],c[1])),t._rotateAround(o,s),e._rotateAround(o,s),n._rotateAround(o,s),i._rotateAround(o,s),p=Math.min(t.x,e.x,n.x,i.x),f=Math.max(t.x,e.x,n.x,i.x),h=Math.min(t.y,e.y,n.y,i.y),d=Math.max(t.y,e.y,n.y,i.y)}return t.emplaceBack(e.x,e.y,p,h,f,d,a,n,i,o),t.length-1}function th(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function eh(t,e,n,i){const r=t.compareText;if(e in r){const t=r[e];for(let e=t.length-1;e>=0;e--)if(i.dist(t[e])<n)return!0}else r[e]=[];return r[e].push(i),!1}const nh=$l.VectorTileFeature.types,ih=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function rh(t,e,n,i,r,o,s,a,l,c,u,h,d){const p=a?Math.min(Wu,Math.round(a[0])):0,f=a?Math.min(Wu,Math.round(a[1])):0;t.emplaceBack(e,n,Math.round(32*i),Math.round(32*r),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function oh(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function sh(t){for(const e of t.sections)if(jr(e.text))return!0;return!1}class ah{constructor(t){this.layoutVertexArray=new Do,this.indexArray=new Uo,this.programConfigurations=t,this.segments=new Us,this.dynamicLayoutVertexArray=new Lo,this.opacityVertexArray=new Oo,this.placedSymbolArray=new Xo}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,n,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,pc.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,ih,!0),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}or("SymbolBuffers",ah);class lh{constructor(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new Us,this.collisionVertexArray=new Fo,this.collisionVertexArrayExt=new Lo}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,fc.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,mc.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}or("CollisionBuffers",lh);class ch{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=pa([]),this.placementViewportMatrix=pa([]);const e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=vc(this.zoom,e["text-size"]),this.iconSizeData=vc(this.zoom,e["icon-size"]);const n=this.layers[0].layout,i=n.get("symbol-sort-key"),r=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==i.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(t=>tu[t]),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.sourceID=t.sourceID}createArrays(){this.text=new ah(new Ms(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new ah(new Ms(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new ts,this.lineVertexArray=new es,this.symbolInstances=new Ko}calculateGlyphDependencies(t,e,n,i,r){for(let o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,i&&r){const n=Ac[t.charAt(o)];n&&(e[n.charCodeAt(0)]=!0)}}populate(t,e,n){const i=this.layers[0],r=i.layout,o=r.get("text-font"),s=r.get("text-field"),a=r.get("icon-image"),l=("constant"!==s.value.kind||s.value.value instanceof pe&&!s.value.value.isEmpty()||s.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),c="constant"!==a.value.kind||!!a.value.value||Object.keys(a.parameters).length>0,u=r.get("symbol-sort-key");if(this.features=[],!l&&!c)return;const h=e.iconDependencies,d=e.glyphDependencies,p=e.availableImages,f=new ro(this.zoom);for(const{feature:m,id:g,index:y,sourceLayerIndex:_}of t){const t=i._featureFilter.needGeometry,e=Vs(m,t);if(!i._featureFilter.filter(f,e,n))continue;let s,a;if(t||(e.geometry=$s(m)),l){const t=i.getValueAndResolveTokens("text-field",e,n,p),r=pe.factory(t);sh(r)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===eo()||this.hasRTLText&&io.isParsed())&&(s=Tc(r,i,e))}if(c){const t=i.getValueAndResolveTokens("icon-image",e,n,p);a=t instanceof fe?t:fe.fromString(t)}if(!s&&!a)continue;const v=this.sortFeaturesByKey?u.evaluate(e,{},n):void 0;if(this.features.push({id:g,text:s,icon:a,index:y,sourceLayerIndex:_,geometry:e.geometry,properties:m.properties,type:nh[m.type],sortKey:v}),a&&(h[a.name]=!0),s){const t=o.evaluate(e,{},n).join(","),i="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(tu.vertical)>=0;for(const e of s.sections)if(e.image)h[e.image.name]=!0;else{const n=Fr(s.toString()),r=e.fontStack||t,o=d[r]=d[r]||{};this.calculateGlyphDependencies(e.text,o,i,this.allowVerticalPlacement,n)}}}"line"===r.get("symbol-placement")&&(this.features=function(t){const e={},n={},i=[];let r=0;function o(e){i.push(t[e]),r++}function s(t,e,r){const o=n[t];return delete n[t],n[e]=o,i[o].geometry[0].pop(),i[o].geometry[0]=i[o].geometry[0].concat(r[0]),o}function a(t,n,r){const o=e[n];return delete e[n],e[t]=o,i[o].geometry[0].shift(),i[o].geometry[0]=r[0].concat(i[o].geometry[0]),o}function l(t,e,n){const i=n?e[0][e[0].length-1]:e[0][0];return`${t}:${i.x}:${i.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in n&&f in e&&n[p]!==e[f]){const t=a(p,f,h),r=s(p,f,i[t].geometry);delete e[p],delete n[f],n[l(d,i[r].geometry,!0)]=r,i[t].geometry=null}else p in n?s(p,f,h):f in e?a(p,f,h):(o(c),e[p]=r-1,n[f]=r-1)}return i.filter(t=>t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((t,e)=>t.sortKey-e.sortKey)}update(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const n=this.lineVertexArray.length;if(void 0!==t.segment){let n=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]);const r={};for(let o=t.segment+1;o<e.length;o++)r[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:n},o<e.length-1&&(n+=e[o+1].dist(e[o]));for(let o=t.segment||0;o>=0;o--)r[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:i},o>0&&(i+=e[o-1].dist(e[o]));for(let t=0;t<e.length;t++){const e=r[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,e,n,i,r,o,s,a,l,c,u,h){const d=t.indexArray,p=t.layoutVertexArray,f=t.segments.prepareSegment(4*e.length,p,d,this.canOverlap?o.sortKey:void 0),m=this.glyphOffsetArray.length,g=f.vertexLength,y=this.allowVerticalPlacement&&s===tu.vertical?Math.PI/2:0,_=o.text&&o.text.sections;for(let v=0;v<e.length;v++){const{tl:i,tr:r,bl:s,br:l,tex:c,pixelOffsetTL:u,pixelOffsetBR:m,minFontScaleX:g,minFontScaleY:x,glyphOffset:b,isSDF:w,sectionIndex:T}=e[v],A=f.vertexLength,S=b[1];rh(p,a.x,a.y,i.x,S+i.y,c.x,c.y,n,w,u.x,u.y,g,x),rh(p,a.x,a.y,r.x,S+r.y,c.x+c.w,c.y,n,w,m.x,u.y,g,x),rh(p,a.x,a.y,s.x,S+s.y,c.x,c.y+c.h,n,w,u.x,m.y,g,x),rh(p,a.x,a.y,l.x,S+l.y,c.x+c.w,c.y+c.h,n,w,m.x,m.y,g,x),oh(t.dynamicLayoutVertexArray,a,y),d.emplaceBack(A,A+1,A+2),d.emplaceBack(A+1,A+2,A+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(b[0]),v!==e.length-1&&T===e[v+1].sectionIndex||t.programConfigurations.populatePaintArrays(p.length,o,o.index,{},h,_&&_[T])}t.placedSymbolArray.emplaceBack(a.x,a.y,m,this.glyphOffsetArray.length-m,g,l,c,a.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],s,0,!1,0,u,0)}_commitLayoutVertex(t,e,n,i,r){t.emplaceBack(e.x,e.y,n,i,Math.round(r.x),Math.round(r.y))}_addCollisionDebugVertices(t,e,n,i,o){const s=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),a=s.vertexLength,l=o.anchorX,c=o.anchorY;for(let r=0;r<4;r++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(e,-t.padding,-t.padding),n.collisionVertexArrayExt.emplaceBack(e,t.padding,-t.padding),n.collisionVertexArrayExt.emplaceBack(e,t.padding,t.padding),n.collisionVertexArrayExt.emplaceBack(e,-t.padding,t.padding),this._commitLayoutVertex(n.layoutVertexArray,i,l,c,new r(t.x1,t.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,l,c,new r(t.x2,t.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,l,c,new r(t.x2,t.y2)),this._commitLayoutVertex(n.layoutVertexArray,i,l,c,new r(t.x1,t.y2)),s.vertexLength+=4;const u=n.indexArray;u.emplaceBack(a,a+1),u.emplaceBack(a+1,a+2),u.emplaceBack(a+2,a+3),u.emplaceBack(a+3,a),s.primitiveLength+=4}_addTextDebugCollisionBoxes(t,e,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceTextSize(t,o,e,s);this._addCollisionDebugVertices(i,r,this.textCollisionBox,i.anchorPoint,o)}}_addIconDebugCollisionBoxes(t,e,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceIconSize(t,e,s);this._addCollisionDebugVertices(i,r,this.iconCollisionBox,i.anchorPoint,o)}}generateCollisionDebugBuffers(t,e){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lh(zo,gc.members,jo),this.iconCollisionBox=new lh(zo,gc.members,jo);const n=bc(this.iconSizeData,t),i=bc(this.textSizeData,t);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(i,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(i,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(t,e,n,i){const r=this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex>=0?e.rightJustifiedTextSymbolIndex:e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.leftJustifiedTextSymbolIndex>=0?e.leftJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex>=0?e.verticalPlacedTextSymbolIndex:i),o=xc(this.textSizeData,t,r)/24;return this.tilePixelRatio*o}getSymbolInstanceIconSize(t,e,n){const i=this.icon.placedSymbolArray.get(n),r=xc(this.iconSizeData,t,i);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(t,e,n){t.emplaceBack(e,-n,-n),t.emplaceBack(e,n,-n),t.emplaceBack(e,n,n),t.emplaceBack(e,-n,n)}_updateTextDebugCollisionBoxes(t,e,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceTextSize(t,o,e,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,i.padding)}}_updateIconDebugCollisionBoxes(t,e,n,i,r){for(let o=i;o<r;o++){const i=n.get(o),r=this.getSymbolInstanceIconSize(t,e,o);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,i.padding)}}updateCollisionDebugBuffers(t,e){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=bc(this.iconSizeData,t),i=bc(this.textSizeData,t);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._updateTextDebugCollisionBoxes(i,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(i,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(n,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,e,n,i,r,o,s,a,l){const c={};for(let u=e;u<n;u++){const e=t.get(u);c.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.textFeatureIndex=e.featureIndex;break}for(let u=i;u<r;u++){const e=t.get(u);c.verticalTextBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.verticalTextFeatureIndex=e.featureIndex;break}for(let u=o;u<s;u++){const e=t.get(u);c.iconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.iconFeatureIndex=e.featureIndex;break}for(let u=a;u<l;u++){const e=t.get(u);c.verticalIconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.verticalIconFeatureIndex=e.featureIndex;break}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const n=t.placedSymbolArray.get(e),i=n.vertexStartIndex+4*n.numGlyphs;for(let r=n.vertexStartIndex;r<i;r+=4)t.indexArray.emplaceBack(r,r+1,r+2),t.indexArray.emplaceBack(r+1,r+2,r+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),n=Math.cos(t),i=[],r=[],o=[];for(let s=0;s<this.symbolInstances.length;++s){o.push(s);const t=this.symbolInstances.get(s);i.push(0|Math.round(e*t.anchorX+n*t.anchorY)),r.push(t.featureIndex)}return o.sort((t,e)=>i[t]-i[e]||r[e]-r[t]),o}addToSortKeyRanges(t,e){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===e?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach((t,e,n)=>{t>=0&&n.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)}),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}or("SymbolBucket",ch,{omit:["layers","collisionBoxArray","features","compareText"]}),ch.MAX_GLYPHS=65535,ch.addDynamicAttributes=oh;const uh=new vo({"symbol-placement":new fo(Ft.layout_symbol["symbol-placement"]),"symbol-spacing":new fo(Ft.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new fo(Ft.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new mo(Ft.layout_symbol["symbol-sort-key"]),"symbol-z-order":new fo(Ft.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new fo(Ft.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new fo(Ft.layout_symbol["icon-ignore-placement"]),"icon-optional":new fo(Ft.layout_symbol["icon-optional"]),"icon-rotation-alignment":new fo(Ft.layout_symbol["icon-rotation-alignment"]),"icon-size":new mo(Ft.layout_symbol["icon-size"]),"icon-text-fit":new fo(Ft.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new fo(Ft.layout_symbol["icon-text-fit-padding"]),"icon-image":new mo(Ft.layout_symbol["icon-image"]),"icon-rotate":new mo(Ft.layout_symbol["icon-rotate"]),"icon-padding":new fo(Ft.layout_symbol["icon-padding"]),"icon-keep-upright":new fo(Ft.layout_symbol["icon-keep-upright"]),"icon-offset":new mo(Ft.layout_symbol["icon-offset"]),"icon-anchor":new mo(Ft.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new fo(Ft.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new fo(Ft.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new fo(Ft.layout_symbol["text-rotation-alignment"]),"text-field":new mo(Ft.layout_symbol["text-field"]),"text-font":new mo(Ft.layout_symbol["text-font"]),"text-size":new mo(Ft.layout_symbol["text-size"]),"text-max-width":new mo(Ft.layout_symbol["text-max-width"]),"text-line-height":new mo(Ft.layout_symbol["text-line-height"]),"text-letter-spacing":new mo(Ft.layout_symbol["text-letter-spacing"]),"text-justify":new mo(Ft.layout_symbol["text-justify"]),"text-radial-offset":new mo(Ft.layout_symbol["text-radial-offset"]),"text-variable-anchor":new fo(Ft.layout_symbol["text-variable-anchor"]),"text-anchor":new mo(Ft.layout_symbol["text-anchor"]),"text-max-angle":new fo(Ft.layout_symbol["text-max-angle"]),"text-writing-mode":new fo(Ft.layout_symbol["text-writing-mode"]),"text-rotate":new mo(Ft.layout_symbol["text-rotate"]),"text-padding":new fo(Ft.layout_symbol["text-padding"]),"text-keep-upright":new fo(Ft.layout_symbol["text-keep-upright"]),"text-transform":new mo(Ft.layout_symbol["text-transform"]),"text-offset":new mo(Ft.layout_symbol["text-offset"]),"text-allow-overlap":new fo(Ft.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new fo(Ft.layout_symbol["text-ignore-placement"]),"text-optional":new fo(Ft.layout_symbol["text-optional"])});var hh={paint:new vo({"icon-opacity":new mo(Ft.paint_symbol["icon-opacity"]),"icon-color":new mo(Ft.paint_symbol["icon-color"]),"icon-halo-color":new mo(Ft.paint_symbol["icon-halo-color"]),"icon-halo-width":new mo(Ft.paint_symbol["icon-halo-width"]),"icon-halo-blur":new mo(Ft.paint_symbol["icon-halo-blur"]),"icon-translate":new fo(Ft.paint_symbol["icon-translate"]),"icon-translate-anchor":new fo(Ft.paint_symbol["icon-translate-anchor"]),"text-opacity":new mo(Ft.paint_symbol["text-opacity"]),"text-color":new mo(Ft.paint_symbol["text-color"],{runtimeType:Wt,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new mo(Ft.paint_symbol["text-halo-color"]),"text-halo-width":new mo(Ft.paint_symbol["text-halo-width"]),"text-halo-blur":new mo(Ft.paint_symbol["text-halo-blur"]),"text-translate":new fo(Ft.paint_symbol["text-translate"]),"text-translate-anchor":new fo(Ft.paint_symbol["text-translate-anchor"])}),layout:uh};class dh{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Gt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}or("FormatSectionOverride",dh,{omit:["defaultValue"]});class ph extends zs{constructor(t){super(t,hh)}recalculate(t,e){super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const t=[];for(const e of n)t.indexOf(e)<0&&t.push(e);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,e,n,i){const r=this.layout.get(t).evaluate(e,{},n,i),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||ai(o.value)||!r?r:(s=e.properties,r.replace(/{([^{}]+)}/g,(t,e)=>e in s?String(s[e]):""));var s}createBucket(t){return new ch(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of hh.paint.overridableProperties){if(!ph.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),n=new dh(e),i=new si(n,e.property.specification);let r=null;r="constant"===e.value.kind||"source"===e.value.kind?new ci("source",i):new ui("composite",i,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new ho(e.property,r,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven())&&ph.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const n=t.get("text-field"),i=hh.paint.properties[e];let r=!1;const o=t=>{for(const e of t)if(i.overrides&&i.overrides.hasOverride(e))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof pe)o(n.value.value.sections);else if("source"===n.value.kind){const t=e=>{r||(e instanceof ve&&ye(e.value)===te?o(e.value.sections):e instanceof Te?o(e.sections):e.eachChild(t))},e=n.value;e._styleExpression&&t(e._styleExpression.expression)}return r}getProgramConfiguration(t){return new Es(this,t)}}var fh={paint:new vo({"background-color":new fo(Ft.paint_background["background-color"]),"background-pattern":new yo(Ft.paint_background["background-pattern"]),"background-opacity":new fo(Ft.paint_background["background-opacity"])})},mh={paint:new vo({"raster-opacity":new fo(Ft.paint_raster["raster-opacity"]),"raster-hue-rotate":new fo(Ft.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new fo(Ft.paint_raster["raster-brightness-min"]),"raster-brightness-max":new fo(Ft.paint_raster["raster-brightness-max"]),"raster-saturation":new fo(Ft.paint_raster["raster-saturation"]),"raster-contrast":new fo(Ft.paint_raster["raster-contrast"]),"raster-resampling":new fo(Ft.paint_raster["raster-resampling"]),"raster-fade-duration":new fo(Ft.paint_raster["raster-fade-duration"])})};class gh extends zs{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var yh={paint:new vo({"sky-type":new fo(Ft.paint_sky["sky-type"]),"sky-atmosphere-sun":new fo(Ft.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new fo(Ft.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new fo(Ft.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new fo(Ft.paint_sky["sky-gradient-radius"]),"sky-gradient":new _o(Ft.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new fo(Ft.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new fo(Ft.paint_sky["sky-atmosphere-color"]),"sky-opacity":new fo(Ft.paint_sky["sky-opacity"])})};function _h(t,e,n){const i=_a(0,0,1),r=ka(Ma());return function(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(n),l=Math.cos(n);t[0]=i*l-o*a,t[1]=r*l+s*a,t[2]=o*l+i*a,t[3]=s*l-r*a}(r,r,n?-u(t)+Math.PI:u(t)),Pa(r,r,-u(e)),Ta(i,i,r),wa(i,i)}const vh={circle:class extends zs{constructor(t){super(t,ua)}createBucket(t){return new Gs(t)}queryRadius(t){const e=t;return oa("circle-radius",this,e)+oa("circle-stroke-width",this,e)+sa(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,i,r,o,s,a){const l="map"===this.paint.get("circle-pitch-alignment");if(l&&t.queryGeometry.isAboveHorizon)return!1;const c=la(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),u=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),h=l?u*t.pixelToTileUnitsFactor:u;for(const d of i)for(const e of d){const n=e.add(c),i=a&&o.elevation?o.elevation.exaggeration()*a.getElevationAt(n.x,n.y,!0):0,r=l?n:Da(n,i,s),u=l?t.tilespaceRays.map(t=>Ra(t,i)):t.queryGeometry.screenGeometry;let d=h;const p=Ea([],[e.x,e.y,i,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?d*=p[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(d*=o.cameraToCenterDistance/p[3]),Hs(u,r,d))return!0}return!1}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Es(this,t)}},heatmap:class extends zs{createBucket(t){return new za(t)}constructor(t){super(t,qa),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$a({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Es(this,t)}},hillshade:class extends zs{constructor(t){super(t,Va)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(t){return new Es(this,t)}},fill:class extends zs{constructor(t){super(t,Pl)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new Es(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Ml(t)}queryRadius(){return sa(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,i,r,o){return!t.queryGeometry.isAboveHorizon&&Js(aa(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends zs{constructor(t){super(t,Wl)}createBucket(t){return new Hl(t)}queryRadius(){return sa(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Es(this,t)}queryIntersectsFeature(t,e,n,i,o,s,a,l,c){const u=la(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(e,n),d=this.paint.get("fill-extrusion-base").evaluate(e,n),p=[0,0],f=l&&s.elevation,m=s.elevation?s.elevation.exaggeration():1;if(f){const e=t.tile.getBucket(this).centroidVertexArray,n=c+1;if(n<e.length){const t=e.get(n);p[0]=t.a_centroid_pos0,p[1]=t.a_centroid_pos1}}if(0===p[0]&&1===p[1])return!1;const g=(_=i,v=d,x=h,b=u,w=a,(T=f?l:null)?function(t,e,n,i,r,o,s,a,l){const c=[],u=[],h=[0,0,0,1];for(const d of t){const t=[],p=[];for(const c of d){const u=c.x+i.x,d=c.y+i.y,f=tc(u,d,e,n,o,s,a,l);h[0]=u,h[1]=d,h[2]=f.base,h[3]=1,Ea(h,h,r),h[3]=Math.max(h[3],1e-5);const m=Kl([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);h[0]=u,h[1]=d,h[2]=f.top,h[3]=1,Ea(h,h,r),h[3]=Math.max(h[3],1e-5);const g=Kl([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);t.push(m),p.push(g)}c.push(t),u.push(p)}return[c,u]}(_,v,x,b,w,T,p,m,s.center.lat):function(t,e,n,i,o){const s=[],a=[],l=o[8]*e,c=o[9]*e,u=o[10]*e,h=o[11]*e,d=o[8]*n,p=o[9]*n,f=o[10]*n,m=o[11]*n;for(const g of t){const t=[],e=[];for(const n of g){const s=n.x+i.x,a=n.y+i.y,g=o[0]*s+o[4]*a+o[12],y=o[1]*s+o[5]*a+o[13],_=o[2]*s+o[6]*a+o[14],v=o[3]*s+o[7]*a+o[15],x=g+l,b=y+c,w=_+u,T=Math.max(v+h,1e-5),A=g+d,S=y+p,C=_+f,I=Math.max(v+m,1e-5),E=new r(x/T,b/T);E.z=w/T,t.push(E);const M=new r(A/I,S/I);M.z=C/I,e.push(M)}s.push(t),a.push(e)}return[s,a]}(_,v,x,b,w)),y=t.queryGeometry;var _,v,x,b,w,T;return function(t,e,n){let i=1/0;Js(n,e)&&(i=Ql(n,e[0]));for(let r=0;r<e.length;r++){const o=e[r],s=t[r];for(let t=0;t<o.length-1;t++){const e=o[t],r=[e,o[t+1],s[t+1],s[t],e];Ys(n,r)&&(i=Math.min(i,Ql(n,r)))}}return i!==1/0&&i}(g[0],g[1],y.isPointQuery()?y.screenBounds:y.screenGeometry)}},line:class extends zs{constructor(t){super(t,cc),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof en,this.gradientVersion=(this.gradientVersion+1)%a}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=uc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new ac(t)}getProgramIds(){const t=this.paint.get("line-dasharray"),e=this.paint.get("line-pattern").constantOr(1),n=this.paint.get("line-gradient");return[e?"linePattern":t?"lineSDF":n?"lineGradient":"line"]}getProgramConfiguration(t){return new Es(this,t)}queryRadius(t){const e=t,n=hc(oa("line-width",this,e),oa("line-gap-width",this,e)),i=oa("line-offset",this,e);return n/2+Math.abs(i)+sa(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,i,o,s){if(t.queryGeometry.isAboveHorizon)return!1;const a=aa(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),l=t.pixelToTileUnitsFactor/2*hc(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),c=this.paint.get("line-offset").evaluate(e,n);return c&&(i=function(t,e){const n=[],i=new r(0,0);for(let r=0;r<t.length;r++){const o=t[r],s=[];for(let t=0;t<o.length;t++){const n=o[t-1],r=o[t],a=o[t+1],l=0===t?i:r.sub(n)._unit()._perp(),c=t===o.length-1?i:a.sub(r)._unit()._perp(),u=l._add(c)._unit();u._mult(1/(u.x*c.x+u.y*c.y)),s.push(u._mult(e)._add(r))}n.push(s)}return n}(i,c*t.pixelToTileUnitsFactor)),function(t,e,n){for(let i=0;i<e.length;i++){const r=e[i];if(t.length>=3)for(let e=0;e<r.length;e++)if(na(t,r[e]))return!0;if(Ws(t,r,n))return!0}return!1}(a,i,l)}isTileClipped(){return!0}},symbol:ph,background:class extends zs{constructor(t){super(t,fh)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends zs{constructor(t){super(t,mh)}getProgramIds(){return["raster"]}},sky:class extends zs{constructor(t){super(t,yh),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=$a({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(t,e){const n=this.paint.get("sky-type");if("atmosphere"===n){const n=this.paint.get("sky-atmosphere-sun"),i=!n,r=t.style.light,o=r.properties.get("position");return i&&"viewport"===r.properties.get("anchor")&&P("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),i?_h(o.azimuthal,90-o.polar,e):_h(n[0],90-n[1],e)}if("gradient"===n){const t=this.paint.get("sky-gradient-center");return _h(t[0],90-t[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}},{HTMLImageElement:xh,HTMLCanvasElement:bh,HTMLVideoElement:wh,ImageData:Th,ImageBitmap:Ah}=s;class Sh{constructor(t,e,n,i){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,i)}update(t,e,n){const{width:i,height:r}=t,o=!(this.size&&this.size[0]===i&&this.size[1]===r||n),{context:s}=this,{gl:a}=s;if(this.useMipmap=Boolean(e&&e.useMipmap),a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[i,r],t instanceof xh||t instanceof bh||t instanceof wh||t instanceof Th||Ah&&t instanceof Ah?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,t):a.texImage2D(a.TEXTURE_2D,0,this.format,i,r,0,this.format,a.UNSIGNED_BYTE,t.data);else{const{x:e,y:o}=n||{x:0,y:0};t instanceof xh||t instanceof bh||t instanceof wh||t instanceof Th||Ah&&t instanceof Ah?a.texSubImage2D(a.TEXTURE_2D,0,e,o,a.RGBA,a.UNSIGNED_BYTE,t):a.texSubImage2D(a.TEXTURE_2D,0,e,o,i,r,a.RGBA,a.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&a.generateMipmap(a.TEXTURE_2D)}bind(t,e,n){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Ch{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Eh?new Eh(t.lng,t.lat):Eh.convert(t),this}setSouthWest(t){return this._sw=t instanceof Eh?new Eh(t.lng,t.lat):Eh.convert(t),this}extend(t){const e=this._sw,n=this._ne;let i,r;if(t instanceof Eh)i=t,r=t;else{if(!(t instanceof Ch))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Ch.convert(t)):this.extend(Eh.convert(t)):this;if(i=t._sw,r=t._ne,!i||!r)return this}return e||n?(e.lng=Math.min(i.lng,e.lng),e.lat=Math.min(i.lat,e.lat),n.lng=Math.max(r.lng,n.lng),n.lat=Math.max(r.lat,n.lat)):(this._sw=new Eh(i.lng,i.lat),this._ne=new Eh(r.lng,r.lat)),this}getCenter(){return new Eh((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Eh(this.getWest(),this.getNorth())}getSouthEast(){return new Eh(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:n}=Eh.convert(t);let i=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i}static convert(t){return!t||t instanceof Ch?t:new Ch(t)}}const Ih=6371008.8;class Eh{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Eh(g(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,n=this.lat*e,i=t.lat*e,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((t.lng-this.lng)*e);return Ih*Math.acos(Math.min(r,1))}toBounds(t=0){const e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new Ch(new Eh(this.lng-n,this.lat-e),new Eh(this.lng+n,this.lat+e))}static convert(t){if(t instanceof Eh)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Eh(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Eh(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Mh=2*Math.PI*Ih;function kh(t){return Mh*Math.cos(t*Math.PI/180)}function Ph(t){return(180+t)/360}function Dh(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Lh(t,e){return t/kh(e)}function Oh(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Rh(t,e){return t*kh(Oh(e))}class zh{constructor(t,e,n=0){this.x=+t,this.y=+e,this.z=+n}static fromLngLat(t,e=0){const n=Eh.convert(t);return new zh(Ph(n.lng),Dh(n.lat),Lh(e,n.lat))}toLngLat(){return new Eh(360*this.x-180,Oh(this.y))}toAltitude(){return Rh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Mh*(t=Oh(this.y),1/Math.cos(t*Math.PI/180));var t}}class Zh{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.image=new Na({width:t,height:e}),this.positions={},this.uploaded=!1}getDash(t,e){const n=this.getKey(t,e);return this.positions[n]}trim(){const t=this.width,e=this.height=T(this.nextRow);this.image.resize({width:t,height:e})}getKey(t,e){return t.join(",")+e}getDashRanges(t,e,n){const i=[];let r=t.length%2==1?-t[t.length-1]*n:0,o=t[0]*n,s=!0;i.push({left:r,right:o,isDash:s,zeroLength:0===t[0]});let a=t[0];for(let l=1;l<t.length;l++){s=!s;const e=t[l];r=a*n,a+=e,o=a*n,i.push({left:r,right:o,isDash:s,zeroLength:0===e})}return i}addRoundDash(t,e,n){const i=e/2;for(let r=-n;r<=n;r++){const e=this.width*(this.nextRow+n+r);let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=r/n*(i+1);if(s.isDash){const t=i-Math.abs(d);h=Math.sqrt(u*u+t*t)}else h=i-Math.sqrt(u*u+d*d);this.image.data[e+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t,e){for(let a=t.length-1;a>=0;--a){const e=t[a],n=t[a+1];e.zeroLength?t.splice(a,1):n&&n.isDash===e.isDash&&(n.left=e.left,t.splice(a,1))}const n=t[0],i=t[t.length-1];n.isDash===i.isDash&&(n.left=i.left-this.width,i.right=n.right+this.width);const r=this.width*this.nextRow;let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const n=Math.abs(a-s.left),i=Math.abs(a-s.right),l=Math.min(n,i);this.image.data[r+a]=Math.max(0,Math.min(255,(s.isDash?l:-l)+e+128))}}addDash(t,e){const n=this.getKey(t,e);if(this.positions[n])return this.positions[n];const i="round"===e,r=i?7:0,o=2*r+1;if(this.nextRow+o>this.height)return P("LineAtlas out of space"),null;0===t.length&&t.push(1);let s=0;for(let c=0;c<t.length;c++)t[c]<0&&(P("Negative value is found in line dasharray, replacing values with 0"),t[c]=0),s+=t[c];if(0!==s){const n=this.width/s,o=this.getDashRanges(t,this.width,n);i?this.addRoundDash(o,n,r):this.addRegularDash(o,"square"===e?.5*n:0)}const a=this.nextRow+r;this.nextRow+=o;const l={tl:[a,r],br:[s,0]};return this.positions[n]=l,l}}or("LineAtlas",Zh);class Fh{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Uh=s.performance;function Nh(t){const e=t?t.url.toString():void 0;return Uh.getEntriesByName(e)}class Bh{constructor(){this.tasks={},this.taskQueue=[],S(["process"],this),this.invoker=new Fh(this.process),this.nextId=0}add(t,e){const n=this.nextId++,i=function({type:t,isSymbolTile:e,zoom:n}){return n=n||0,"message"===t?0:"maybePrepare"!==t||e?"parseTile"!==t||e?"parseTile"===t&&e?300-n:"maybePrepare"===t&&e?400-n:500:200-n:100-n}(e);if(0===i){O();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:t,metadata:e,priority:i,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){O();try{if(this.taskQueue=this.taskQueue.filter(t=>!!this.tasks[t]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn()}finally{}}pick(){let t=null,e=1/0;for(let i=0;i<this.taskQueue.length;i++){const n=this.tasks[this.taskQueue[i]];n.priority<e&&(e=n.priority,t=i)}if(null===t)return null;const n=this.taskQueue[t];return this.taskQueue.splice(t,1),n}remove(){this.invoker.remove()}}function qh(t,e,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}class $h{constructor(t,e,n){this.z=t,this.x=e,this.y=n,this.key=Gh(0,t,t,e,n)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e){const n=(r=this.y,o=this.z,s=qh(256*(i=this.x),256*(r=Math.pow(2,o)-r-1),o),a=qh(256*(i+1),256*(r+1),o),s[0]+","+s[1]+","+a[0]+","+a[1]);var i,r,o,s,a;const l=function(t,e,n){let i,r="";for(let o=t;o>0;o--)i=1<<o-1,r+=(e&i?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",n)}getTilePoint(t){const e=Math.pow(2,this.z);return new r((t.x*e-this.x)*Ns,(t.y*e-this.y)*Ns)}getTileVec3(t){const e=Math.pow(2,this.z);return _a((t.x*e-this.x)*Ns,(t.y*e-this.y)*Ns,Rh(t.z,t.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class Vh{constructor(t,e){this.wrap=t,this.canonical=e,this.key=Gh(t,e.z,e.z,e.x,e.y)}}class jh{constructor(t,e,n,i,r){this.overscaledZ=t,this.wrap=e,this.canonical=new $h(n,+i,+r),this.key=0===e&&t===n?this.canonical.key:Gh(e,t,n,i,r)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new jh(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new jh(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e=!0){if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return Gh(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-t;return Gh(this.wrap*+e,t,t,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new jh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new jh(e,this.wrap,e,n,i),new jh(e,this.wrap,e,n+1,i),new jh(e,this.wrap,e,n,i+1),new jh(e,this.wrap,e,n+1,i+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new jh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new jh(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Vh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new zh(t.x-this.wrap,t.y))}getTileVec3(t){return this.canonical.getTileVec3(new zh(t.x-this.wrap,t.y,t.z))}}function Gh(t,e,n,i,r){const o=1<<Math.min(n,22);let s=o*(r%o)+i%o;return t&&n<22&&(s+=o*o*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*s+n)+(e-n)}or("CanonicalTileID",$h),or("OverscaledTileID",jh,{omit:["projMatrix"]});class Yh{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class Hh{constructor(t,e,n,i,r){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=i,this.properties=t.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}var Jh=Ao([{name:"a_pos",type:"Int16",components:2}]);class Wh{constructor(t,e,n){this.tileID=t,this.uid=b(),this.uses=0,this.tileSize=e,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const e=t+this.timeAdded;e<q.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(t,e,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const n={};if(!e)return n;for(const i of t){const t=i.layerIds.map(t=>e.getLayer(t)).filter(Boolean);if(0!==t.length){i.layers=t,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map(e=>t.filter(t=>t.id===e)[0]));for(const e of t)n[e.id]=i}}return n}(t.buckets,e.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const e=this.buckets[t];if(e instanceof ch){if(this.hasSymbolBuckets=!0,!n)break;e.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const e=this.buckets[t];if(e instanceof ch&&e.hasRTLText){this.hasRTLText=!0,io.isLoading()||io.isLoaded()||"deferred"!==eo()||no();break}}this.queryPadding=0;for(const t in this.buckets){const n=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(t).queryRadius(n))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new Jo}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const n in this.buckets){const e=this.buckets[n];e.uploadPending()&&e.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Sh(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Sh(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Sh(t,this.lineAtlas.image,e.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,n,i,r,o,s,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:i,pixelPosMatrix:s,transform:o,params:r},t,e,n):{}}querySourceFeatures(t,e){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const i=n.loadVTLayers(),r=e?e.sourceLayer:"",o=i._geojsonTileLayer||i[r];if(!o)return;const s=wi(e&&e.filter),{z:a,x:l,y:c}=this.tileID.canonical,u={z:a,x:l,y:c};for(let h=0;h<o.length;h++){const e=o.feature(h);if(s.needGeometry){const t=Vs(e,!0);if(!s.filter(new ro(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!s.filter(new ro(this.tileID.overscaledZ),e))continue;const i=n.getId(e,r),d=new Hh(e,a,l,c,i);d.tile=u,t.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const e=this.expirationTime;if(t.cacheControl){const e=R(t.cacheControl);e["max-age"]&&(this.expirationTime=Date.now()+1e3*e["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let n=!1;if(this.expirationTime>t)n=!1;else if(e)if(this.expirationTime<e)n=!0;else{const i=this.expirationTime-e;i?this.expirationTime=t+Math.max(i,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length)return;const n=this.latestFeatureIndex.loadVTLayers();for(const i in this.buckets){if(!e.style.hasLayer(i))continue;const r=this.buckets[i],o=r.layers[0].sourceLayer||"_geojsonTileLayer",s=n[o],a=t[o];if(!s||!a||0===Object.keys(a).length)continue;r.update(a,s,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=e&&e.style&&e.style.getLayer(i);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(r)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=q.now()+t}setDependencies(t,e){const n={};for(const i of e)n[i]=!0;this.dependencies[t]=n}hasDependency(t,e){for(const n of t){const t=this.dependencies[n];if(t)for(const n of e)if(t[n])return!0}return!1}clearQueryDebugViz(){}}class Xh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,e,n){const i=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][i]=this.stateChanges[t][i]||{},v(this.stateChanges[t][i],n),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==i&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][i]){this.deletedStates[t][i]={};for(const e in this.state[t][i])n[e]||(this.deletedStates[t][i][e]=null)}else for(const r in n)this.deletedStates[t]&&this.deletedStates[t][i]&&null===this.deletedStates[t][i][r]&&delete this.deletedStates[t][i][r]}removeFeatureState(t,e,n){if(null===this.deletedStates[t])return;const i=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&void 0!==e)null!==this.deletedStates[t][i]&&(this.deletedStates[t][i]=this.deletedStates[t][i]||{},this.deletedStates[t][i][n]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][i])for(n in this.deletedStates[t][i]={},this.stateChanges[t][i])this.deletedStates[t][i][n]=null;else this.deletedStates[t][i]=null;else this.deletedStates[t]=null}getState(t,e){const n=String(e),i=v({},(this.state[t]||{})[n],(this.stateChanges[t]||{})[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const n=this.deletedStates[t][e];if(null===n)return{};for(const t in n)delete i[t]}return i}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,e){const n={};for(const i in this.stateChanges){this.state[i]=this.state[i]||{};const t={};for(const e in this.stateChanges[i])this.state[i][e]||(this.state[i][e]={}),v(this.state[i][e],this.stateChanges[i][e]),t[e]=this.state[i][e];n[i]=t}for(const i in this.deletedStates){this.state[i]=this.state[i]||{};const t={};if(null===this.deletedStates[i])for(const e in this.state[i])t[e]={},this.state[i][e]={};else for(const e in this.deletedStates[i]){if(null===this.deletedStates[i][e])this.state[i][e]={};else for(const t of Object.keys(this.deletedStates[i][e]))delete this.state[i][e][t];t[e]=this.state[i][e]}n[i]=n[i]||{},v(n[i],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const i in t)t[i].setFeatureState(n,e)}}class Qh{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,e){const n=this.toIdx(t,e);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function Kh(t,e,n,i){let r=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(i[s])<1e-15){if(n[s]<t[s]||n[s]>e[s])return null}else{const a=1/i[s];let l=(t[s]-n[s])*a,c=(e[s]-n[s])*a;if(l>c){const t=l;l=c,c=t}if(l>r&&(r=l),c<o&&(o=c),r>o)return null}return r}function td(t,e,n,i,r,o,s,a,l,c,u){const h=i-t,d=r-e,p=o-n,f=s-t,m=a-e,g=l-n,y=u[1]*g-u[2]*m,_=u[2]*f-u[0]*g,v=u[0]*m-u[1]*f,x=h*y+d*_+p*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-t,T=c[1]-e,A=c[2]-n,S=(w*y+T*_+A*v)*b;if(S<0||S>1)return null;const C=T*p-A*d,I=A*h-w*p,E=w*d-T*h,M=(u[0]*C+u[1]*I+u[2]*E)*b;return M<0||S+M>1?null:(f*C+m*I+g*E)*b}function ed(t,e,n){return(t-e)/(n-e)}function nd(t,e,n,i,r,o,s,a,l){const c=1<<n,u=o-i,h=s-r,d=(t+1)/c*u+i,p=(e+0)/c*h+r,f=(e+1)/c*h+r;a[0]=(t+0)/c*u+i,a[1]=p,l[0]=d,l[1]=f}class id{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),n=[];let i=Math.ceil(Math.pow(2,e));const r=1/i,o=(t,e,n,i,r)=>{const o=i?1:0,s=(t+1)*n-o,a=e*n,l=(e+1)*n-o;r[0]=t*n,r[1]=a,r[2]=s,r[3]=l};let s=new Qh(i);const a=[];for(let l=0;l<i*i;l++){o(l%i,Math.floor(l/i),r,!1,a);const e=od(a[0],a[1],t),n=od(a[2],a[1],t),c=od(a[2],a[3],t),u=od(a[0],a[3],t);s.minimums.push(Math.min(e,n,c,u)),s.maximums.push(Math.max(e,n,c,u)),s.leaves.push(1)}for(n.push(s),i/=2;i>=1;i/=2){const t=n[n.length-1];s=new Qh(i);for(let e=0;e<i*i;e++){o(e%i,Math.floor(e/i),2,!0,a);const n=t.getElevation(a[0],a[1]),r=t.getElevation(a[2],a[1]),l=t.getElevation(a[2],a[3]),c=t.getElevation(a[0],a[3]),u=t.isLeaf(a[0],a[1]),h=t.isLeaf(a[2],a[1]),d=t.isLeaf(a[2],a[3]),p=t.isLeaf(a[0],a[3]),f=Math.min(n.min,r.min,l.min,c.min),m=Math.max(n.max,r.max,l.max,c.max),g=u&&h&&d&&p;s.maximums.push(m),s.minimums.push(f),s.leaves.push(m-f<=5&&g?1:0)}n.push(s)}return n}(this.dem),n=e.length-1,i=e[n];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(e,0,0,n,0)}raycastRoot(t,e,n,i,r,o,s=1){return Kh([t,e,-100],[n,i,this.maximums[0]*s],r,o)}raycast(t,e,n,i,r,o,s=1){if(!this.nodeCount)return null;const a=this.raycastRoot(t,e,n,i,r,o,s);if(null==a)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:p,nodex:f,nodey:m,depth:g}=d.pop();if(this.leaves[a]){nd(f,m,g,t,e,n,i,u,h);const a=1<<g,l=(f+0)/a,c=(f+1)/a,d=(m+0)/a,y=(m+1)/a,_=od(l,d,this.dem)*s,v=od(c,d,this.dem)*s,x=od(c,y,this.dem)*s,b=od(l,y,this.dem)*s,w=td(u[0],u[1],_,h[0],u[1],v,h[0],h[1],x,r,o),T=td(h[0],h[1],x,u[0],h[1],b,u[0],u[1],_,r,o),A=Math.min(null!==w?w:Number.MAX_VALUE,null!==T?T:Number.MAX_VALUE);if(A!==Number.MAX_VALUE)return A;{const t=ba([],r,o,p);if(rd(_,v,b,x,ed(t[0],u[0],h[0]),ed(t[1],u[1],h[1]))>=t[2])return p}continue}let y=0;for(let d=0;d<this._siblingOffset.length;d++){nd((f<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,t,e,n,i,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const p=Kh(u,h,r,o);if(null!=p){const t=p;l[d]=t;let e=!1;for(let n=0;n<y&&!e;n++)t>=l[c[n]]&&(c.splice(n,0,d),e=!0);e||(c[y]=d),y++}}for(let t=0;t<y;t++){const e=c[t];d.push({idx:this.childOffsets[a]+e,t:l[e],nodex:(f<<1)+this._siblingOffset[e][0],nodey:(m<<1)+this._siblingOffset[e][1],depth:g+1})}}return null}_addNode(t,e,n){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(t,e,n,i,r){if(1===t[i].isLeaf(e,n))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const o=i-1,s=t[o];let a,l=0;for(let c=0;c<this._siblingOffset.length;c++){const t=2*e+this._siblingOffset[c][0],i=2*n+this._siblingOffset[c][1],r=s.getElevation(t,i),o=s.isLeaf(t,i),u=this._addNode(r.min,r.max,o);o&&(l|=1<<c),a||(a=u)}for(let c=0;c<this._siblingOffset.length;c++)l&1<<c||this._construct(t,2*e+this._siblingOffset[c][0],2*n+this._siblingOffset[c][1],o,a+c)}}function rd(t,e,n,i,r,o){return nn(nn(t,n,o),nn(e,i,o),r)}function od(t,e,n){const i=n.dim,r=m(t*i-.5,0,i-1),o=m(e*i-.5,0,i-1),s=Math.floor(r),a=Math.floor(o),l=Math.min(s+1,i-1),c=Math.min(a+1,i-1);return rd(n.get(s,a),n.get(l,a),n.get(s,c),n.get(l,c),r-s,o-a)}const sd={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ad{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,n,i=!1,r=!1){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return P(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const o=this.dim=e.height-2;if(this.data=new Uint32Array(e.data.buffer),this.encoding=n||"mapbox",this.borderReady=i,!i){for(let t=0;t<o;t++)this.data[this._idx(-1,t)]=this.data[this._idx(0,t)],this.data[this._idx(o,t)]=this.data[this._idx(o-1,t)],this.data[this._idx(t,-1)]=this.data[this._idx(t,0)],this.data[this._idx(t,o)]=this.data[this._idx(t,o-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(o,-1)]=this.data[this._idx(o-1,0)],this.data[this._idx(-1,o)]=this.data[this._idx(0,o-1)],this.data[this._idx(o,o)]=this.data[this._idx(o-1,o-1)],r&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new id(this)}get(t,e,n=!1){const i=new Uint8Array(this.data.buffer);n&&(t=m(t,-1,this.dim),e=m(e,-1,this.dim));const r=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(i[r],i[r+1],i[r+2])}static getUnpackVector(t){return sd[t]}get unpackVector(){return sd[this.encoding]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}_unpackMapbox(t,e,n){return(256*t*256+256*e+n)/10-1e4}_unpackTerrarium(t,e,n){return 256*t+e+n/256-32768}static pack(t,e){const n=[0,0,0,0],i=ad.getUnpackVector(e);let r=Math.floor((t+i[3])/i[2]);return n[2]=r%256,r=Math.floor(r/256),n[1]=r%256,r=Math.floor(r/256),n[0]=r,n}getPixels(){return new Ba({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let i=e*this.dim,r=e*this.dim+this.dim,o=n*this.dim,s=n*this.dim+this.dim;switch(e){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:o=s-1;break;case 1:s=o+1}const a=-e*this.dim,l=-n*this.dim;for(let c=o;c<s;c++)for(let e=i;e<r;e++)this.data[this._idx(e,c)]=t.data[this._idx(e+a,c+l)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}or("DEMData",ad),or("DemMinMaxQuadTree",id,{omit:["dem"]});class ld{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,n){const i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const r={value:e,timeout:void 0};if(void 0!==n&&(r.timeout=setTimeout(()=>{this.remove(t,r)},n)),this.data[i].push(r),this.order.push(i),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const n=t.wrapped().key,i=void 0===e?0:this.data[n].indexOf(e),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const n in this.data)for(const i of this.data[n])t(i.value)||e.push(i);for(const n of e)this.remove(n.value.tileID,n)}}class cd{constructor(t,e,n){this.func=t,this.mask=e,this.range=n}}cd.ReadOnly=!1,cd.ReadWrite=!0,cd.disabled=new cd(519,cd.ReadOnly,[0,1]);class ud{constructor(t,e,n,i,r,o){this.test=t,this.ref=e,this.mask=n,this.fail=i,this.depthFail=r,this.pass=o}}ud.disabled=new ud({func:519,mask:0},0,0,7680,7680,7680);class hd{constructor(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n}}hd.Replace=[1,0],hd.disabled=new hd(hd.Replace,ue.transparent,[!1,!1,!1,!1]),hd.unblended=new hd(hd.Replace,ue.transparent,[!0,!0,!0,!0]),hd.alphaBlended=new hd([1,771],ue.transparent,[!0,!0,!0,!0]);class dd{constructor(t,e,n){this.enable=t,this.mode=e,this.frontFace=n}}dd.disabled=new dd(!1,1029,2305),dd.backCCW=new dd(!0,1029,2305),dd.backCW=new dd(!0,1029,2304),dd.frontCW=new dd(!0,1028,2304),dd.frontCCW=new dd(!0,1028,2305);class pd extends Zt{constructor(t,e,n){super(),this.id=t,this._onlySymbols=n,e.on("data",t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),e.on("error",()=>{this._sourceErrored=!0}),this._source=e,this._tiles={},this._cache=new ld(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Xh}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,e){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}}getIds(){return _(this._tiles).map(t=>t.tileID).sort(fd).map(t=>t.key)}getRenderableIds(t){const e=[];for(const n in this._tiles)this._isIdRenderable(+n,t)&&e.push(this._tiles[n]);return t?e.sort((t,e)=>{const n=t.tileID,i=e.tileID,o=new r(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),s=new r(i.canonical.x,i.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-i.overscaledZ||s.y-o.y||s.x-o.x}).map(t=>t.tileID.key):e.map(t=>t.tileID).sort(fd).map(t=>t.key)}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,e){const n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this._loadTile(n,this._tileLoaded.bind(this,n,t,e)))}_tileLoaded(t,e,n,i){if(i)return t.state="errored",void(404!==i.status?this._source.fire(new zt(i,{tile:t})):this.update(this.transform));t.timeAdded=q.now(),"expired"===n&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Rt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const e=this.getRenderableIds();for(let i=0;i<e.length;i++){const r=e[i];if(t.neighboringTiles&&t.neighboringTiles[r]){const e=this.getTileByID(r);n(t,e),n(e,t)}}function n(t,e){if(!t.dem||t.dem.borderReady)return;t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let n=e.tileID.canonical.x-t.tileID.canonical.x;const i=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,i),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,n,i){for(const r in this._tiles){let o=this._tiles[r];if(i[r]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>n)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(s=t)}let a=s;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){i[s.key]=s;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const n=this._loadedParentTiles[t.key];return n&&n.tileID.overscaledZ>=e?n:null}for(let n=t.overscaledZ-1;n>=e;n--){const e=t.scaledTo(n),i=this._getLoadedTile(e);if(i)return i}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,e){e=e||this._source.tileSize;const n=Math.ceil(t.width/e)+1,i=Math.ceil(t.height/e)+1,r=Math.floor(n*i*5),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(o)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const n in this._tiles){const i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),t[i.tileID.key]=i}this._tiles=t;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(t,e,n){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let i;this.updateCacheSize(t,e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?i=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new jh(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)):(i=t.coveringTiles({tileSize:e||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(i=i.filter(t=>this._source.hasTile(t)))):i=[];const r=this._updateRetainedTiles(i);if(md(this._source.type)&&0!==i.length){const t={},e={},n=Object.keys(r);for(const i of n){const n=r[i],o=this._tiles[i];if(!o||o.fadeEndTime&&o.fadeEndTime<=q.now())continue;const s=this.findLoadedParent(n,Math.max(n.overscaledZ-pd.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),t[s.tileID.key]=s.tileID),e[i]=n}const o=i[i.length-1].overscaledZ;for(const i in this._tiles){const t=this._tiles[i];if(r[i]||!t.hasData())continue;let n=t.tileID;for(;n.overscaledZ>o;){n=n.scaledTo(n.overscaledZ-1);const o=this._tiles[n.key];if(o&&o.hasData()&&e[n.key]){r[i]=t.tileID;break}}}for(const i in t)r[i]||(this._coveredTiles[i]=!0,r[i]=t[i])}for(const s in r)this._tiles[s].clearFadeHold();const o=function(t,e){const n=[];for(const i in t)i in e||n.push(i);return n}(this._tiles,r);for(const s of o){const t=this._tiles[s];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+s)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const e={};if(0===t.length)return e;const n={},i=t[t.length-1].overscaledZ,r=t[0].overscaledZ,o=Math.max(r-pd.maxOverzooming,this._source.minzoom),s=Math.max(r+pd.maxUnderzooming,this._source.minzoom),a={};for(const l of t){const t=this._addTile(l);e[l.key]=l,t.hasData()||i<this._source.maxzoom&&(a[l.key]=l)}this._retainLoadedChildren(a,i,s,e);for(const l of t){let t=this._tiles[l.key];if(t.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const t=l.children(this._source.maxzoom)[0],n=this.getTile(t);if(n&&n.hasData()){e[t.key]=t;continue}}else{const t=l.children(this._source.maxzoom);if(e[t[0].key]&&e[t[1].key]&&e[t[2].key]&&e[t[3].key])continue}let i=t.wasRequested();for(let r=l.overscaledZ-1;r>=o;--r){const o=l.scaledTo(r);if(n[o.key]||(n[o.key]=!0,t=this.getTile(o),!t&&i&&(t=this._addTile(o)),t&&(e[o.key]=o,i=t.wasRequested(),t.hasData())))break}}return e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let n,i=this._tiles[t].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}e.push(i.key);const t=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(t),n)break;i=t}for(const t of e)this._loadedParentTiles[t]=n}}_addTile(t){let e=this._tiles[t.key];if(e)return e;e=this._cache.getAndRemove(t),e&&(this._setTileReloadTimer(t.key,e),e.tileID=t,this._state.initializeTileState(e,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e)));const n=Boolean(e);return n||(e=new Wh(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom),this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))),e?(e.uses++,this._tiles[t.key]=e,n||this._source.fire(new Rt("dataloading",{tile:e,coord:e.tileID,dataType:"source"})),e):null}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},n))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._cache.reset()}tilesIn(t,e,n){const i=[],r=this.transform;if(!r)return i;for(const o in this._tiles){const s=this._tiles[o];if(n&&s.clearQueryDebugViz(),s.holdingForFade())continue;const a=t.containsTile(s,r,e);a&&i.push(a)}return i}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map(t=>this._tiles[t].tileID);for(const n of e)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return e}hasTransition(){if(this._source.hasTransition())return!0;if(md(this._source.type))for(const t in this._tiles){const e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=q.now())return!0}return!1}setFeatureState(t,e,n){this._state.updateState(t=t||"_geojsonTileLayer",e,n)}removeFeatureState(t,e,n){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,n)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,n){const i=this._tiles[t];i&&i.setDependencies(e,n)}reloadTilesForDependencies(t,e){for(const n in this._tiles)this._tiles[n].hasDependency(t,e)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(t,e))}}function fd(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function md(t){return"raster"===t||"image"===t||"video"===t}pd.maxOverzooming=10,pd.maxUnderzooming=3;class gd{constructor(t,e,n){this._demTile=t,this._dem=this._demTile.dem,this._scale=e,this._offset=n}static create(t,e,n){const i=n||t.findDEMTileFor(e);if(!i||!i.dem)return;const r=i.dem,o=i.tileID,s=1<<e.canonical.z-o.canonical.z;return new gd(i,i.tileSize/Ns/s,[(e.canonical.x/s-o.canonical.x)*r.dim,(e.canonical.y/s-o.canonical.y)*r.dim])}tileCoordToPixel(t,e){const n=e*this._scale+this._offset[1],i=Math.floor(t*this._scale+this._offset[0]),o=Math.floor(n);return new r(i,o)}getElevationAt(t,e,n,i){const r=t*this._scale+this._offset[0],o=e*this._scale+this._offset[1],s=Math.floor(r),a=Math.floor(o),l=this._dem;return i=!!i,n?nn(nn(l.get(s,a,i),l.get(s,a+1,i),o-a),nn(l.get(s+1,a,i),l.get(s+1,a+1,i),o-a),r-s):l.get(s,a,i)}getElevationAtPixel(t,e,n){return this._dem.get(t,e,!!n)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Lh(1,t)*this._dem.stride}}class yd{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new tr(Ns,16,0),this.featureIndexArray=new is,this.promoteId=e}insert(t,e,n,i,r,o=0){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r,o);const a=this.grid;for(let l=0;l<e.length;l++){const t=e[l],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<t.length;e++){const i=t[e];n[0]=Math.min(n[0],i.x),n[1]=Math.min(n[1],i.y),n[2]=Math.max(n[2],i.x),n[3]=Math.max(n[3],i.y)}n[0]<Ns&&n[1]<Ns&&n[2]>=0&&n[3]>=0&&a.insert(s,n[0],n[1],n[2],n[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new $l.VectorTile(new Mc(this.rawTileData)).layers,this.sourceLayerCoder=new Yh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,e,n,i){this.loadVTLayers();const r=t.params||{},o=wi(r.filter),s=t.tileResult,a=t.transform,l=s.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,(t,e,n,i)=>ia(s.bufferedTilespaceGeometry,t,e,n,i));c.sort(vd);let u=null;a.elevation&&c.length>0&&(u=gd.create(a.elevation,this.tileID));const h={};let d;for(let p=0;p<c.length;p++){const a=c[p];if(a===d)continue;d=a;const l=this.featureIndexArray.get(a);let f=null;this.loadMatchingFeature(h,l,o,r.layers,r.availableImages,e,n,i,(e,n,i,r=0)=>(f||(f=$s(e)),n.queryIntersectsFeature(s,e,i,f,this.z,t.transform,t.pixelPosMatrix,u,r)))}return h}loadMatchingFeature(t,e,n,i,r,o,s,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=e,p=this.bucketLayerIDs[u];if(i&&!function(t,e){for(let n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}(i,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(n.needGeometry){const t=Vs(m,!0);if(!n.filter(new ro(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!n.filter(new ro(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let y=0;y<p.length;y++){const e=p[y];if(i&&i.indexOf(e)<0)continue;const n=o[e];if(!n)continue;let u={};void 0!==g&&a&&(u=a.getState(n.sourceLayer||"_geojsonTileLayer",g));const h=v({},s[e]);h.paint=_d(h.paint,n.paint,m,u,r),h.layout=_d(h.layout,n.layout,m,u,r);const f=!l||l(m,n,u,d);if(!f)continue;const _=new Hh(m,this.z,this.x,this.y,g);_.layer=h;let x=t[e];void 0===x&&(x=t[e]=[]),x.push({featureIndex:c,feature:_,intersectionZ:f})}}lookupSymbolFeatures(t,e,n,i,r,o,s,a){const l={};this.loadVTLayers();const c=wi(r);for(const u of t)this.loadMatchingFeature(l,{bucketIndex:n,sourceLayerIndex:i,featureIndex:u,layoutVertexArrayOffset:0},c,o,s,a,e);return l}hasLayer(t){for(const e of this.bucketLayerIDs)for(const n of e)if(t===n)return!0;return!1}getId(t,e){let n=t.id;return this.promoteId&&(n=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof n&&(n=Number(n))),n}}function _d(t,e,n,i,r){return I(t,(t,o)=>{const s=e instanceof po?e.get(o):null;return s&&s.evaluate?s.evaluate(n,i,r):s})}function vd(t,e){return e-t}or("FeatureIndex",yd,{omit:["rawTileData","sourceLayerCoder"]});class xd{constructor(t){const e={},n=[];for(const s in t){const i=t[s],r=e[s]={};for(const t in i.glyphs){const e=i.glyphs[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const o=e.metrics.localGlyph?2:1,s={x:0,y:0,w:e.bitmap.width+2*o,h:e.bitmap.height+2*o};n.push(s),r[t]=s}}const{w:i,h:r}=Xc(n),o=new Na({width:i||1,height:r||1});for(const s in t){const n=t[s];for(const t in n.glyphs){const i=n.glyphs[+t];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const r=e[s][t],a=i.metrics.localGlyph?2:1;Na.copy(i.bitmap,o,{x:0,y:0},{x:r.x+a,y:r.y+a},i.bitmap)}}this.image=o,this.positions=e}}or("GlyphAtlas",xd);class bd{constructor(t){this.tileID=new jh(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile}parse(t,e,n,i,r){this.status="parsing",this.data=t,this.collisionBoxArray=new Jo;const o=new Yh(Object.keys(t.layers).sort()),s=new yd(this.tileID,this.promoteId);s.bucketLayerIDs=[];const a={},l=new Zh(256,256),c={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:n},u=e.familiesBySource[this.source];for(const _ in u){const e=t.layers[_];if(!e)continue;let i=!1,r=!1;for(const t of u[_])"symbol"===t[0].type?i=!0:r=!0;if(!0===this.isSymbolTile&&!i||!1===this.isSymbolTile&&!r)continue;1===e.version&&P(`Vector tile source "${this.source}" layer "${_}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const l=o.encode(_),h=[];for(let t=0;t<e.length;t++){const n=e.feature(t),i=s.getId(n,_);h.push({feature:n,id:i,index:t,sourceLayerIndex:l})}for(const t of u[_]){const e=t[0];void 0!==this.isSymbolTile&&"symbol"===e.type!==this.isSymbolTile||e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(wd(t,this.zoom,n),(a[e.id]=e.createBucket({index:s.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:l,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(h,c,this.tileID.canonical),s.bucketLayerIDs.push(t.map(t=>t.id)))}}let h,d,p,f;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=I(c.glyphDependencies,t=>Object.keys(t).map(Number));Object.keys(g).length?i.send("getGlyphs",{uid:this.uid,stacks:g},(t,e)=>{h||(h=t,d=e,x.call(this))},void 0,!1,m):d={};const y=Object.keys(c.iconDependencies);y.length?i.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"icons"},(t,e)=>{h||(h=t,p=e,x.call(this))},void 0,!1,m):p={};const v=Object.keys(c.patternDependencies);function x(){if(h)return r(h);if(d&&p&&f){const t=new xd(d),e=new Kc(p,f);for(const i in a){const r=a[i];r instanceof ch?(wd(r.layers,this.zoom,n),Yu(r,d,t.positions,p,e.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):r.hasPattern&&(r instanceof ac||r instanceof Ml||r instanceof Hl)&&(wd(r.layers,this.zoom,n),r.addFeatures(c,this.tileID.canonical,e.patternPositions))}this.status="done",r(null,{buckets:_(a).filter(t=>!t.isEmpty()),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,lineAtlas:l,imageAtlas:e,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?t.positions:null})}}v.length?i.send("getImages",{icons:v,source:this.source,tileID:this.tileID,type:"patterns"},(t,e)=>{h||(h=t,f=e,x.call(this))},void 0,!1,m):f={},x.call(this)}}function wd(t,e,n){const i=new ro(e);for(const r of t)r.recalculate(i,n)}class Td{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,i){const r=this.entries[t]=this.entries[t]||{callbacks:[]};if(r.result){const[t,n]=r.result;return this.scheduler?this.scheduler.add(()=>{i(t,n)},e):i(t,n),()=>{}}return r.callbacks.push(i),r.cancel||(r.cancel=n((n,i)=>{r.result=[n,i];for(const t of r.callbacks)this.scheduler?this.scheduler.add(()=>{t(n,i)},e):t(n,i);setTimeout(()=>delete this.entries[t],3e3)})),()=>{r.result||(r.callbacks=r.callbacks.filter(t=>t!==i),r.callbacks.length||(r.cancel(),delete this.entries[t]))}}}function Ad(t,e,n){const i=JSON.stringify(t.request);return t.data&&(this.deduped.entries[i]={result:[null,t.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},e=>{const i=St(t.request,(t,i,r,o)=>{t?e(t):i&&e(null,{vectorTile:n?void 0:new $l.VectorTile(new Mc(i)),rawData:i,cacheControl:r,expires:o})});return()=>{i.cancel(),e()}},e)}t.ARRAY_TYPE=ha,t.AUTH_ERR_MSG=Q,t.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},S(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=O()?t:s,this.scheduler=new Bh}send(t,e,n,i,r=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=o,this.callbacks[s]=n);const a=N(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:t,hasCallback:!!n,targetMapId:i,mustQueue:r,sourceMapId:this.mapId,data:lr(e,a)},a),{cancel:()=>{n&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[n];delete this.cancelCallbacks[n],t&&t.cancel()}else if(e.mustQueue||O()){const t=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),t&&t.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if("<response>"===e.type){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(cr(e.error)):n(null,cr(e.data)))}else{const n=N(this.globalScope)?void 0:[],i=e.hasCallback?(e,i)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?lr(e):null,data:lr(i,n)},n)}:t=>{},r=cr(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,r,i);else if(this.parent.getWorkerSource){const t=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,t[0],r.source)[t[1]](r,i)}else i(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},t.CanonicalTileID=$h,t.Color=ue,t.ColorMode=hd,t.CullFaceMode=dd,t.DEMData=ad,t.DataConstantProperty=fo,t.DedupedRequest=Td,t.DepthMode=cd,t.EXTENT=Ns,t.Elevation=class{getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){null==e&&(e=null);const i=this._source();if(!i||t.y<0||t.y>1)return e;const r=i.getSource().maxzoom,o=1<<r,s=Math.floor(t.x),a=t.x-s,l=new jh(r,s,r,Math.floor(a*o),Math.floor(t.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return e;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,p=(t.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(n?this.exaggeration():1)*nn(nn(u.get(f,m),u.get(f,m+1),p-m),nn(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(t,e,n){const i=1<<t.canonical.z;return this.getAtPointOrZero(new zh(t.wrap+(t.canonical.x+e/Ns)/i,(t.canonical.y+n/Ns)/i))}getForTilePoints(t,e,n,i){const r=gd.create(this,t,i);return!!r&&(e.forEach(t=>{t[2]=this.exaggeration()*r.getElevationAt(t[0],t[1],n)}),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,i=e.tileID,r=1<<t.canonical.z-i.canonical.z;let o=t.canonical.x/r-i.canonical.x,s=t.canonical.y/r-i.canonical.y,a=0;for(let l=0;l<t.canonical.z-i.canonical.z&&!n.leaves[a];l++){o*=2,s*=2;const t=2*Math.floor(s)+Math.floor(o);a=n.childOffsets[a]+t,o%=1,s%=1}return{min:this.exaggeration()*n.minimums[a],max:this.exaggeration()*n.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},t.ErrorEvent=zt,t.EvaluationParameters=ro,t.Event=Rt,t.Evented=Zt,t.GlyphManager=Du,t.ImagePosition=Qc,t.LineAtlas=Zh,t.LngLat=Eh,t.LngLatBounds=Ch,t.LocalGlyphMode=Pu,t.MAX_SAFE_INTEGER=a,t.MercatorCoordinate=zh,t.ONE_EM=24,t.OverscaledTileID=jh,t.Properties=vo,t.RGBAImage=Ba,t.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",X,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!K(t))return t;const n=nt(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!K(t))return t;const n=nt(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!K(t))return t;const n=nt(t);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,i){const r=nt(t);return K(t)?(r.path=`/styles/v1${r.path}/sprite${e}${n}`,this._makeAPIURL(r,this._customAccessToken||i)):(r.path+=`${e}${n}`,it(r))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!K(t))return t;const i=nt(t);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&"raster"!==i.authority&&512===n?"@2x":""}${j.supported?".webp":"$1"}`),"raster"===i.authority?i.path=`/${V.RASTER_URL_PREFIX}${i.path}`:(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path=`/${V.TILE_URL_VERSION}${i.path}`);const r=this._customAccessToken||function(t){for(const e of t){const t=e.match(/^access_token=(.*)$/);if(t)return t[1]}return null}(i.params)||V.ACCESS_TOKEN;return V.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&i.params.push(`sku=${this._skuToken}`),this._makeAPIURL(i,r)}canonicalizeTileURL(t,e){const n=nt(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let i="mapbox://";n.path.match(/^\/raster\/v1\//)?i+=`raster/${n.path.replace(`/${V.RASTER_URL_PREFIX}/`,"")}`:i+=`tiles/${n.path.replace(`/${V.TILE_URL_VERSION}/`,"")}`;let r=n.params;return e&&(r=r.filter(t=>!t.match(/^access_token=/))),r.length&&(i+=`?${r.join("&")}`),i}canonicalizeTileset(t,e){const n=!!e&&K(e),i=[];for(const r of t.tiles||[])tt(r)?i.push(this.canonicalizeTileURL(r,n)):i.push(r);return i}_makeAPIURL(t,e){const n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",i=nt(V.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==i.path&&(t.path=`${i.path}${t.path}`),!V.REQUIRE_ACCESS_TOKEN)return it(t);if(e=e||V.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(t=>-1===t.indexOf("access_token")),t.params.push(`access_token=${e||""}`),it(t)}},t.ResourceType=bt,t.SegmentVector=Us,t.SourceCache=pd,t.StencilMode=ud,t.StructArrayLayout1ui2=Go,t.StructArrayLayout2f1f2i16=Zo,t.StructArrayLayout2i4=Co,t.StructArrayLayout2ui4=jo,t.StructArrayLayout3f12=Lo,t.StructArrayLayout3ui6=Uo,t.StructArrayLayout4i8=Io,t.Texture=Sh,t.Tile=Wh,t.Transitionable=ao,t.Uniform1f=ys,t.Uniform1i=class extends gs{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.Uniform2f=class extends gs{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.Uniform3f=class extends gs{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.Uniform4f=_s,t.UniformColor=vs,t.UniformMatrix3f=class extends gs{constructor(t,e){super(t,e),this.current=bs}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},t.UniformMatrix4f=class extends gs{constructor(t,e){super(t,e),this.current=xs}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},t.UnwrappedTileID=Vh,t.ValidationError=Ut,t.VectorTileWorkerSource=class extends Zt{constructor(t,e,n,i,r){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=r||Ad,this.loading={},this.loaded={},this.deduped=new Td(t.scheduler),this.isSpriteLoaded=i,this.scheduler=t.scheduler}loadTile(t,e){const n=t.uid,i=t&&t.request,r=i&&i.collectResourceTiming,o=this.loading[n]=new bd(t);o.abort=this.loadVectorData(t,(s,a)=>{const l=!this.loading[n];if(delete this.loading[n],l||s||!a)return o.status="done",l||(this.loaded[n]=o),e(s);const c=a.rawData,u={};a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),o.vectorTile=a.vectorTile||new $l.VectorTile(new Mc(c));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,(t,n)=>{if(t||!n)return e(t);const o={};if(r){const t=Nh(i);t.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(t)))}e(null,v({rawTileData:c.slice(0)},n,u,o))})};this.isSpriteLoaded?h():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):h()}),this.loaded=this.loaded||{},this.loaded[n]=o})}reloadTile(t,e){const n=this.loaded,i=t.uid,r=this;if(n&&n[i]){const o=n[i];o.showCollisionBoxes=t.showCollisionBoxes,o.enableTerrain=!!t.enableTerrain;const s=(t,n)=>{const i=o.reloadCallback;i&&(delete o.reloadCallback,o.parse(o.vectorTile,r.layerIndex,this.availableImages,r.actor,i)),e(t,n)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}abortTile(t,e){const n=t.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,i=t.uid;n&&n[i]&&delete n[i],e()}},t.WritingMode=tu,t.ZoomHistory=ur,t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},t.addDynamicAttributes=oh,t.altitudeFromMercatorZ=Rh,t.asyncAll=y,t.bezier=p,t.bindAll=S,t.bufferConvexPolygon=function(t,e){const n=[];for(let i=0;i<t.length;i++){const r=g(i-1,-1,t.length-1),o=g(i+1,-1,t.length-1),s=t[i],a=t[o],l=t[r].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*e/Math.sin(u/2));n.push(s.add(h))}return n},t.cacheEntryPossiblyAdded=function(t){xt++,xt>yt&&(t.getActor().send("enforceCacheSizeLimit",gt),xt=0)},t.clamp=m,t.clearTileCache=function(t){const e=s.caches.delete(pt);t&&e.catch(t).then(()=>t())},t.clipLine=Au,t.clone=function(t){var e=new ha(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.clone$1=function(t){var e=new ha(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$2=M,t.collisionCircleLayout=yc,t.config=V,t.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},t.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.create=ga,t.create$1=function(){var t=new ha(16);return ha!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$2=da,t.createExpression=li,t.createFilter=wi,t.createLayout=Ao,t.createStyleLayer=function(t){return"custom"===t.type?new gh(t):new vh[t.type](t)},t.cross=function(t,e,n){var i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],l=n[2];return t[0]=r*l-o*a,t[1]=o*s-i*l,t[2]=i*a-r*s,t},t.degToRad=u,t.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=f,t.easeCubicInOut=d,t.emitValidationErrors=Ki,t.endsWith=C,t.enforceCacheSizeLimit=function(t){_t(),ft&&ft.then(e=>{e.keys().then(n=>{for(let i=0;i<n.length-t;i++)e.delete(n[i])})})},t.evaluateSizeForFeature=xc,t.evaluateSizeForZoom=bc,t.evaluateVariableOffset=Gu,t.evented=to,t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},t.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},t.exported=q,t.exported$1=j,t.extend=v,t.filterObject=E,t.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},t.fromQuat=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=n+n,a=i+i,l=r+r,c=n*s,u=i*s,h=i*a,d=r*s,p=r*a,f=r*l,m=o*s,g=o*a,y=o*l;return t[0]=1-h-f,t[1]=u+y,t[2]=d-g,t[3]=0,t[4]=u-y,t[5]=1-c-f,t[6]=p+m,t[7]=0,t[8]=d+g,t[9]=p-m,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return h[e]},t.getAABBPointSquareDist=function(t,e,n){let i=0;for(let r=0;r<2;++r){const o=n?n[r]:0;t[r]>o&&(i+=(t[r]-o)*(t[r]-o)),e[r]<o&&(i+=(o-e[r])*(o-e[r]))}return i},t.getAnchorAlignment=du,t.getAnchorJustification=Hu,t.getBounds=function(t){let e=1/0,n=1/0,i=-1/0,o=-1/0;for(const r of t)e=Math.min(e,r.x),n=Math.min(n,r.y),i=Math.max(i,r.x),o=Math.max(o,r.y);return{min:new r(e,n),max:new r(i,o)}},t.getImage=Dt,t.getJSON=function(t,e){return At(v(t,{type:"json"}),e)},t.getMapSessionAPI=ht,t.getPerformanceMeasurement=Nh,t.getRTLTextPluginStatus=eo,t.getReferrer=Tt,t.getVideo=function(t,e){const n=s.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let i=0;i<t.length;i++){const e=s.document.createElement("source");Et(t[i])||(n.crossOrigin="Anonymous"),e.src=t[i],n.appendChild(e)}return{cancel:()=>{}}},t.identity=pa,t.identity$1=ka,t.invert=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],y=e[15],_=n*a-i*s,v=n*l-r*s,x=n*c-o*s,b=i*l-r*a,w=i*c-o*a,T=r*c-o*l,A=u*m-h*f,S=u*g-d*f,C=u*y-p*f,I=h*g-d*m,E=h*y-p*m,M=d*y-p*g,k=_*M-v*E+x*I+b*C-w*S+T*A;return k?(t[0]=(a*M-l*E+c*I)*(k=1/k),t[1]=(r*E-i*M-o*I)*k,t[2]=(m*T-g*w+y*b)*k,t[3]=(d*w-h*T-p*b)*k,t[4]=(l*C-s*M-c*S)*k,t[5]=(n*M-r*C+o*S)*k,t[6]=(g*x-f*T-y*v)*k,t[7]=(u*T-d*x+p*v)*k,t[8]=(s*E-a*C+c*A)*k,t[9]=(i*C-n*E-o*A)*k,t[10]=(f*w-m*x+y*_)*k,t[11]=(h*x-u*w-p*_)*k,t[12]=(a*S-s*I-l*A)*k,t[13]=(n*I-i*S+r*A)*k,t[14]=(m*v-f*b-g*_)*k,t[15]=(u*b-h*v+d*_)*k,t):null},t.isMapAuthenticated=function(t){return dt.has(t)},t.isMapboxURL=K,t.latFromMercatorY=Oh,t.len=Ia,t.length=ya,t.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},t.loadVectorTile=Ad,t.makeRequest=At,t.mercatorXfromLng=Ph,t.mercatorYfromLat=Dh,t.mercatorZfromAltitude=Lh,t.mul=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t},t.mul$1=ma,t.mul$2=Ca,t.multiply=fa,t.multiply$1=xa,t.nextPowerOfTwo=T,t.normalize=wa,t.normalize$1=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=n*n+i*i+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=n*s,t[1]=i*s,t[2]=r*s,t[3]=o*s,t},t.number=nn,t.ortho=function(t,e,n,i,r,o,s){var a=1/(e-n),l=1/(i-r),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*l,t[14]=(s+o)*c,t[15]=1,t},t.pbf=Mc,t.perspective=function(t,e,n,i,r){var o,s=1/Math.tan(e/2);return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=(r+i)*(o=1/(i-r)),t[14]=2*r*i*o):(t[10]=-1,t[14]=-2*i),t},t.pick=function(t,e){const n={};for(let i=0;i<e.length;i++){const r=e[i];r in t&&(n[r]=t[r])}return n},t.plugin=io,t.pointGeometry=r,t.polygonIntersectsBox=ia,t.polygonIntersectsPolygon=Ys,t.polygonizeBounds=function(t,e,n=0,i=!0){const o=new r(n,n),s=t.sub(o),a=e.add(o),l=[s,new r(a.x,s.y),a,new r(s.x,a.y)];return i&&l.push(s),l},t.posAttributes=Jh,t.postMapLoadEvent=ct,t.postTurnstileEvent=at,t.potpack=Xc,t.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},t.radToDeg=function(t){return t*c},t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.registerForPluginStateChange=function(t){return t({pluginStatus:Wr,pluginURL:Xr}),to.on("pluginStateChange",t),t},t.removeAuthState=function(t){dt.delete(t)},t.renderColorRamp=$a,t.rotateX=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+c*i,t[5]=s*r+u*i,t[6]=a*r+h*i,t[7]=l*r+d*i,t[8]=c*r-o*i,t[9]=u*r-s*i,t[10]=h*r-a*i,t[11]=d*r-l*i,t},t.rotateX$1=Pa,t.rotateY=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],s=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-c*i,t[1]=s*r-u*i,t[2]=a*r-h*i,t[3]=l*r-d*i,t[8]=o*i+c*r,t[9]=s*i+u*r,t[10]=a*i+h*r,t[11]=l*i+d*r,t},t.rotateZ=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],s=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+c*i,t[1]=s*r+u*i,t[2]=a*r+h*i,t[3]=l*r+d*i,t[4]=c*r-o*i,t[5]=u*r-s*i,t[6]=h*r-a*i,t[7]=d*r-l*i,t},t.rotateZ$1=function(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+r*a,t[1]=r*l-i*a,t[2]=o*l+s*a,t[3]=s*l-o*a,t},t.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},t.scale$1=function(t,e,n){var i=n[0],r=n[1],o=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$2=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},t.scaleAndAdd=ba,t.setCacheLimits=function(t,e){gt=t,yt=e},t.setRTLTextPlugin=function(t,e,n=!1){if(Wr===Gr||Wr===Yr||Wr===Hr)throw new Error("setRTLTextPlugin cannot be called multiple times.");Xr=q.resolveURL(t),Wr=Gr,Jr=e,Kr(),n||no()},t.smoothstep=function(t,e,n){return(n=m((n-t)/(e-t),0,1))*n*(3-2*n)},t.spec=Ft,t.storeAuthState=function(t,e){e?dt.add(t):dt.delete(t)},t.sub=Sa,t.subtract=va,t.symbolSize=wc,t.transformMat3=function(t,e,n){var i=e[0],r=e[1],o=e[2];return t[0]=i*n[0]+r*n[3]+o*n[6],t[1]=i*n[1]+r*n[4]+o*n[7],t[2]=i*n[2]+r*n[5]+o*n[8],t},t.transformMat4=Ea,t.transformMat4$1=function(t,e,n){var i=e[0],r=e[1],o=e[2],s=n[3]*i+n[7]*r+n[11]*o+n[15];return t[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/(s=s||1),t[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,t[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,t},t.transformQuat=Ta,t.translate=function(t,e,n){var i,r,o,s,a,l,c,u,h,d,p,f,m=n[0],g=n[1],y=n[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=i=e[0],t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=i*m+a*g+h*y+e[12],t[13]=r*m+l*g+d*y+e[13],t[14]=o*m+c*g+p*y+e[14],t[15]=s*m+u*g+f*y+e[15]),t},t.triggerPluginCompletionEvent=Qr,t.uniqueId=b,t.validateCustomStyleLayer=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:`layers.${n}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},t.validateFog=Wi,t.validateLight=Ji,t.validateStyle=Hi,t.values=_,t.vectorTile=$l,t.version=e,t.warnOnce=P,t.window=s,t.wrap=g}),i(0,function(t){function e(t){const n=typeof t;if("number"===n||"boolean"===n||"string"===n||null==t)return JSON.stringify(t);if(Array.isArray(t)){let n="[";for(const i of t)n+=`${e(i)},`;return`${n}]`}const i=Object.keys(t).sort();let r="{";for(let o=0;o<i.length;o++)r+=`${JSON.stringify(i[o])}:${e(t[i[o]])},`;return`${r}}`}function n(n){let i="";for(const r of t.refProperties)i+=`/${e(n[r])}`;return i}class i{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,i){for(const n of e){this._layerConfigs[n.id]=n;const e=this._layers[n.id]=t.createStyleLayer(n);e._featureFilter=t.createFilter(e.filter),this.keyCache[n.id]&&delete this.keyCache[n.id]}for(const t of i)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const r=function(t,e){const i={};for(let o=0;o<t.length;o++){const r=e&&e[t[o].id]||n(t[o]);e&&(e[t[o].id]=r);let s=i[r];s||(s=i[r]=[]),s.push(t[o])}const r=[];for(const n in i)r.push(i[n]);return r}(t.values(this._layerConfigs),this.keyCache);for(const t of r){const e=t.map(t=>this._layers[t.id]),n=e[0];if("none"===n.visibility)continue;const i=n.source||"";let r=this.familiesBySource[i];r||(r=this.familiesBySource[i]={});const o=n.sourceLayer||"_geojsonTileLayer";let s=r[o];s||(s=r[o]=[]),s.push(e)}}}const{ImageBitmap:r}=t.window;class o{loadTile(e,n){const{uid:i,encoding:o,rawImageData:s,padding:a,buildQuadTree:l}=e,c=r&&s instanceof r?this.getImageData(s,a):s;n(null,new t.DEMData(i,c,o,a<1,l))}getImageData(e,n){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const i=this.offscreenCanvasContext.getImageData(-n,-n,e.width+2*n,e.height+2*n);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:i.width,height:i.height},i.data)}}var s=function t(e,n){var i,r=e&&e.type;if("FeatureCollection"===r)for(i=0;i<e.features.length;i++)t(e.features[i],n);else if("GeometryCollection"===r)for(i=0;i<e.geometries.length;i++)t(e.geometries[i],n);else if("Feature"===r)t(e.geometry,n);else if("Polygon"===r)a(e.coordinates,n);else if("MultiPolygon"===r)for(i=0;i<e.coordinates.length;i++)a(e.coordinates[i],n);return e};function a(t,e){if(0!==t.length){l(t[0],e);for(var n=1;n<t.length;n++)l(t[n],!e)}}function l(t,e){for(var n=0,i=0,r=t.length,o=r-1;i<r;o=i++)n+=(t[i][0]-t[o][0])*(t[o][1]+t[i][1]);n>=0!=!!e&&t.reverse()}const c=t.vectorTile.VectorTileFeature.prototype.toGeoJSON;class u{constructor(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const n of this._feature.geometry)e.push([new t.pointGeometry(n[0],n[1])]);return e}{const e=[];for(const n of this._feature.geometry){const i=[];for(const e of n)i.push(new t.pointGeometry(e[0],e[1]));e.push(i)}return e}}toGeoJSON(t,e,n){return c.call(this,t,e,n)}}class h{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e}feature(t){return new u(this._features[t])}}var d=t.vectorTile.VectorTileFeature,p=f;function f(t,e){this.options=e||{},this.features=t,this.length=t.length}function m(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}f.prototype.feature=function(t){return new m(this.features[t],this.options.extent)},m.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var n=0;n<e.length;n++){for(var i=e[n],r=[],o=0;o<i.length;o++)r.push(new t.pointGeometry(i[o][0],i[o][1]));this.geometry.push(r)}return this.geometry},m.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,i=1/0,r=-1/0,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),n=Math.max(n,l.x),i=Math.min(i,l.y),r=Math.max(r,l.y)}return[e,i,n,r]},m.prototype.toGeoJSON=d.prototype.toGeoJSON;var g=_,y=p;function _(e){var n=new t.pbf;return function(t,e){for(var n in t.layers)e.writeMessage(3,v,t.layers[n])}(e,n),n.finish()}function v(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)i.feature=t.feature(n),e.writeMessage(2,x,i);var r=i.keys;for(n=0;n<r.length;n++)e.writeStringField(3,r[n]);var o=i.values;for(n=0;n<o.length;n++)e.writeMessage(4,S,o[n])}function x(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,b,t),e.writeVarintField(3,n.type),e.writeMessage(4,A,n)}function b(t,e){var n=t.feature,i=t.keys,r=t.values,o=t.keycache,s=t.valuecache;for(var a in n.properties){var l=o[a];void 0===l&&(i.push(a),o[a]=l=i.length-1),e.writeVarint(l);var c=n.properties[a],u=typeof c;"string"!==u&&"boolean"!==u&&"number"!==u&&(c=JSON.stringify(c));var h=u+":"+c,d=s[h];void 0===d&&(r.push(c),s[h]=d=r.length-1),e.writeVarint(d)}}function w(t,e){return(e<<3)+(7&t)}function T(t){return t<<1^t>>31}function A(t,e){for(var n=t.loadGeometry(),i=t.type,r=0,o=0,s=n.length,a=0;a<s;a++){var l=n[a],c=1;1===i&&(c=l.length),e.writeVarint(w(1,c));for(var u=3===i?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==i&&e.writeVarint(w(2,u-1));var d=l[h].x-r,p=l[h].y-o;e.writeVarint(T(d)),e.writeVarint(T(p)),r+=d,o+=p}3===i&&e.writeVarint(w(7,1))}}function S(t,e){var n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function C(t,e,n,i,r,o){if(r-i<=n)return;const s=i+r>>1;I(t,e,s,i,r,o%2),C(t,e,n,i,s-1,o+1),C(t,e,n,s+1,r,o+1)}function I(t,e,n,i,r,o){for(;r>i;){if(r-i>600){const s=r-i+1,a=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);I(t,e,n,Math.max(i,Math.floor(n-a*c/s+u)),Math.min(r,Math.floor(n+(s-a)*c/s+u)),o)}const s=e[2*n+o];let a=i,l=r;for(E(t,e,i,n),e[2*r+o]>s&&E(t,e,i,r);a<l;){for(E(t,e,a,l),a++,l--;e[2*a+o]<s;)a++;for(;e[2*l+o]>s;)l--}e[2*i+o]===s?E(t,e,i,l):(l++,E(t,e,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function E(t,e,n,i){M(t,n,i),M(e,2*n,2*i),M(e,2*n+1,2*i+1)}function M(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function k(t,e,n,i){const r=t-n,o=e-i;return r*r+o*o}g.fromVectorTileJs=_,g.fromGeojsonVt=function(t,e){e=e||{};var n={};for(var i in t)n[i]=new p(t[i].features,e),n[i].name=i,n[i].version=e.version,n[i].extent=e.extent;return _({layers:n})},g.GeoJSONWrapper=y;const P=t=>t[0],D=t=>t[1];class L{constructor(t,e=P,n=D,i=64,r=Float64Array){this.nodeSize=i,this.points=t;const o=t.length<65536?Uint16Array:Uint32Array,s=this.ids=new o(t.length),a=this.coords=new r(2*t.length);for(let l=0;l<t.length;l++)s[l]=l,a[2*l]=e(t[l]),a[2*l+1]=n(t[l]);C(s,a,i,0,s.length-1,0)}range(t,e,n,i){return function(t,e,n,i,r,o,s){const a=[0,t.length-1,0],l=[];let c,u;for(;a.length;){const h=a.pop(),d=a.pop(),p=a.pop();if(d-p<=s){for(let s=p;s<=d;s++)c=e[2*s],u=e[2*s+1],c>=n&&c<=r&&u>=i&&u<=o&&l.push(t[s]);continue}const f=Math.floor((p+d)/2);c=e[2*f],u=e[2*f+1],c>=n&&c<=r&&u>=i&&u<=o&&l.push(t[f]);const m=(h+1)%2;(0===h?n<=c:i<=u)&&(a.push(p),a.push(f-1),a.push(m)),(0===h?r>=c:o>=u)&&(a.push(f+1),a.push(d),a.push(m))}return l}(this.ids,this.coords,t,e,n,i,this.nodeSize)}within(t,e,n){return function(t,e,n,i,r,o){const s=[0,t.length-1,0],a=[],l=r*r;for(;s.length;){const c=s.pop(),u=s.pop(),h=s.pop();if(u-h<=o){for(let r=h;r<=u;r++)k(e[2*r],e[2*r+1],n,i)<=l&&a.push(t[r]);continue}const d=Math.floor((h+u)/2),p=e[2*d],f=e[2*d+1];k(p,f,n,i)<=l&&a.push(t[d]);const m=(c+1)%2;(0===c?n-r<=p:i-r<=f)&&(s.push(h),s.push(d-1),s.push(m)),(0===c?n+r>=p:i+r>=f)&&(s.push(d+1),s.push(u),s.push(m))}return a}(this.ids,this.coords,t,e,n,this.nodeSize)}}const O={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},R=Math.fround||(z=new Float32Array(1),t=>(z[0]=+t,z[0]));var z;class Z{constructor(t){this.options=j(Object.create(O),t),this.trees=new Array(this.options.maxZoom+1)}load(t){const{log:e,minZoom:n,maxZoom:i,nodeSize:r}=this.options;e&&console.time("total time");const o=`prepare ${t.length} points`;e&&console.time(o),this.points=t;let s=[];for(let a=0;a<t.length;a++)t[a].geometry&&s.push(U(t[a],a));this.trees[i+1]=new L(s,G,Y,r,Float32Array),e&&console.timeEnd(o);for(let a=i;a>=n;a--){const t=+Date.now();s=this._cluster(s,a),this.trees[a]=new L(s,G,Y,r,Float32Array),e&&console.log("z%d: %d clusters in %dms",a,s.length,+Date.now()-t)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let n=((t[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,t[1]));let r=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,r=180;else if(n>r){const t=this.getClusters([n,i,180,o],e),s=this.getClusters([-180,i,r,o],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(q(n),$(o),q(r),$(i)),l=[];for(const c of a){const t=s.points[c];l.push(t.numPoints?N(t):this.points[t.index])}return l}getChildren(t){const e=this._getOriginId(t),n=this._getOriginZoom(t),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const o=r.points[e];if(!o)throw new Error(i);const s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=r.within(o.x,o.y,s),l=[];for(const c of a){const e=r.points[c];e.parentId===t&&l.push(e.numPoints?N(e):this.points[e.index])}if(0===l.length)throw new Error(i);return l}getLeaves(t,e,n){const i=[];return this._appendLeaves(i,t,e=e||10,n=n||0,0),i}getTile(t,e,n){const i=this.trees[this._limitZoom(t)],r=Math.pow(2,t),{extent:o,radius:s}=this.options,a=s/o,l=(n-a)/r,c=(n+1+a)/r,u={features:[]};return this._addTileFeatures(i.range((e-a)/r,l,(e+1+a)/r,c),i.points,e,n,r,u),0===e&&this._addTileFeatures(i.range(1-a/r,l,1,c),i.points,r,n,r,u),e===r-1&&this._addTileFeatures(i.range(0,l,a/r,c),i.points,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e}_appendLeaves(t,e,n,i,r){const o=this.getChildren(e);for(const s of o){const e=s.properties;if(e&&e.cluster?r+e.point_count<=i?r+=e.point_count:r=this._appendLeaves(t,e.cluster_id,n,i,r):r<i?r++:t.push(s),t.length===n)break}return r}_addTileFeatures(t,e,n,i,r,o){for(const s of t){const t=e[s],a=t.numPoints;let l,c,u;if(a)l=B(t),c=t.x,u=t.y;else{const e=this.points[t.index];l=e.properties,c=q(e.geometry.coordinates[0]),u=$(e.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;a?d=t.id:this.options.generateId?d=t.index:this.points[t.index].id&&(d=this.points[t.index].id),void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))}_cluster(t,e){const n=[],{radius:i,extent:r,reduce:o,minPoints:s}=this.options,a=i/(r*Math.pow(2,e));for(let l=0;l<t.length;l++){const i=t[l];if(i.zoom<=e)continue;i.zoom=e;const r=this.trees[e+1],c=r.within(i.x,i.y,a),u=i.numPoints||1;let h=u;for(const t of c){const n=r.points[t];n.zoom>e&&(h+=n.numPoints||1)}if(h>=s){let t=i.x*u,s=i.y*u,a=o&&u>1?this._map(i,!0):null;const d=(l<<5)+(e+1)+this.points.length;for(const n of c){const l=r.points[n];if(l.zoom<=e)continue;l.zoom=e;const c=l.numPoints||1;t+=l.x*c,s+=l.y*c,l.parentId=d,o&&(a||(a=this._map(i,!0)),o(a,this._map(l)))}i.parentId=d,n.push(F(t/h,s/h,d,h,a))}else if(n.push(i),h>1)for(const t of c){const i=r.points[t];i.zoom<=e||(i.zoom=e,n.push(i))}}return n}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e){if(t.numPoints)return e?j({},t.properties):t.properties;const n=this.points[t.index].properties,i=this.options.map(n);return e&&i===n?j({},i):i}}function F(t,e,n,i,r){return{x:R(t),y:R(e),zoom:1/0,id:n,parentId:-1,numPoints:i,properties:r}}function U(t,e){const[n,i]=t.geometry.coordinates;return{x:R(q(n)),y:R($(i)),zoom:1/0,index:e,parentId:-1}}function N(t){return{type:"Feature",id:t.id,properties:B(t),geometry:{type:"Point",coordinates:[(e=t.x,360*(e-.5)),V(t.y)]}};var e}function B(t){const e=t.numPoints,n=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?Math.round(e/100)/10+"k":e;return j(j({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function q(t){return t/360+.5}function $(t){const e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function V(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function j(t,e){for(const n in e)t[n]=e[n];return t}function G(t){return t.x}function Y(t){return t.y}function H(t,e,n,i){for(var r,o=i,s=n-e>>1,a=n-e,l=t[e],c=t[e+1],u=t[n],h=t[n+1],d=e+3;d<n;d+=3){var p=J(t[d],t[d+1],l,c,u,h);if(p>o)r=d,o=p;else if(p===o){var f=Math.abs(d-s);f<a&&(r=d,a=f)}}o>i&&(r-e>3&&H(t,e,r,i),t[r+2]=o,n-r>3&&H(t,r,n,i))}function J(t,e,n,i,r,o){var s=r-n,a=o-i;if(0!==s||0!==a){var l=((t-n)*s+(e-i)*a)/(s*s+a*a);l>1?(n=r,i=o):l>0&&(n+=s*l,i+=a*l)}return(s=t-n)*s+(a=e-i)*a}function W(t,e,n,i){var r={id:void 0===t?null:t,type:e,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)X(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var i=0;i<e.length;i++)X(t,e[i]);else if("MultiPolygon"===n)for(i=0;i<e.length;i++)for(var r=0;r<e[i].length;r++)X(t,e[i][r])}(r),r}function X(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function Q(t,e,n,i){if(e.geometry){var r=e.geometry.coordinates,o=e.geometry.type,s=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),a=[],l=e.id;if(n.promoteId?l=e.properties[n.promoteId]:n.generateId&&(l=i||0),"Point"===o)K(r,a);else if("MultiPoint"===o)for(var c=0;c<r.length;c++)K(r[c],a);else if("LineString"===o)tt(r,a,s,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(c=0;c<r.length;c++)tt(r[c],a=[],s,!1),t.push(W(l,"LineString",a,e.properties));return}et(r,a,s,!1)}else if("Polygon"===o)et(r,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<e.geometry.geometries.length;c++)Q(t,{id:l,geometry:e.geometry.geometries[c],properties:e.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<r.length;c++){var u=[];et(r[c],u,s,!0),a.push(u)}}t.push(W(l,o,a,e.properties))}}function K(t,e){e.push(nt(t[0])),e.push(it(t[1])),e.push(0)}function tt(t,e,n,i){for(var r,o,s=0,a=0;a<t.length;a++){var l=nt(t[a][0]),c=it(t[a][1]);e.push(l),e.push(c),e.push(0),a>0&&(s+=i?(r*c-l*o)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(c-o,2))),r=l,o=c}var u=e.length-3;e[2]=1,H(e,0,u,n),e[u+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function et(t,e,n,i){for(var r=0;r<t.length;r++){var o=[];tt(t[r],o,n,i),e.push(o)}}function nt(t){return t/360+.5}function it(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function rt(t,e,n,i,r,o,s,a){if(i/=e,o>=(n/=e)&&s<i)return t;if(s<n||o>=i)return null;for(var l=[],c=0;c<t.length;c++){var u=t[c],h=u.geometry,d=u.type,p=0===r?u.minX:u.minY,f=0===r?u.maxX:u.maxY;if(p>=n&&f<i)l.push(u);else if(!(f<n||p>=i)){var m=[];if("Point"===d||"MultiPoint"===d)ot(h,m,n,i,r);else if("LineString"===d)st(h,m,n,i,r,!1,a.lineMetrics);else if("MultiLineString"===d)lt(h,m,n,i,r,!1);else if("Polygon"===d)lt(h,m,n,i,r,!0);else if("MultiPolygon"===d)for(var g=0;g<h.length;g++){var y=[];lt(h[g],y,n,i,r,!0),y.length&&m.push(y)}if(m.length){if(a.lineMetrics&&"LineString"===d){for(g=0;g<m.length;g++)l.push(W(u.id,d,m[g],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),l.push(W(u.id,d,m,u.tags))}}}return l.length?l:null}function ot(t,e,n,i,r){for(var o=0;o<t.length;o+=3){var s=t[o+r];s>=n&&s<=i&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function st(t,e,n,i,r,o,s){for(var a,l,c=at(t),u=0===r?ut:ht,h=t.start,d=0;d<t.length-3;d+=3){var p=t[d],f=t[d+1],m=t[d+2],g=t[d+3],y=t[d+4],_=0===r?p:f,v=0===r?g:y,x=!1;s&&(a=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-y,2))),_<n?v>n&&(l=u(c,p,f,g,y,n),s&&(c.start=h+a*l)):_>i?v<i&&(l=u(c,p,f,g,y,i),s&&(c.start=h+a*l)):ct(c,p,f,m),v<n&&_>=n&&(l=u(c,p,f,g,y,n),x=!0),v>i&&_<=i&&(l=u(c,p,f,g,y,i),x=!0),!o&&x&&(s&&(c.end=h+a*l),e.push(c),c=at(t)),s&&(h+=a)}var b=t.length-3;p=t[b],f=t[b+1],m=t[b+2],(_=0===r?p:f)>=n&&_<=i&&ct(c,p,f,m),b=c.length-3,o&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&ct(c,c[0],c[1],c[2]),c.length&&e.push(c)}function at(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function lt(t,e,n,i,r,o){for(var s=0;s<t.length;s++)st(t[s],e,n,i,r,o,!1)}function ct(t,e,n,i){t.push(e),t.push(n),t.push(i)}function ut(t,e,n,i,r,o){var s=(o-e)/(i-e);return t.push(o),t.push(n+(r-n)*s),t.push(1),s}function ht(t,e,n,i,r,o){var s=(o-n)/(r-n);return t.push(e+(i-e)*s),t.push(o),t.push(1),s}function dt(t,e){for(var n=[],i=0;i<t.length;i++){var r,o=t[i],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)r=pt(o.geometry,e);else if("MultiLineString"===s||"Polygon"===s){r=[];for(var a=0;a<o.geometry.length;a++)r.push(pt(o.geometry[a],e))}else if("MultiPolygon"===s)for(r=[],a=0;a<o.geometry.length;a++){for(var l=[],c=0;c<o.geometry[a].length;c++)l.push(pt(o.geometry[a][c],e));r.push(l)}n.push(W(o.id,s,r,o.tags))}return n}function pt(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var i=0;i<t.length;i+=3)n.push(t[i]+e,t[i+1],t[i+2]);return n}function ft(t,e){if(t.transformed)return t;var n,i,r,o=1<<t.z,s=t.x,a=t.y;for(n=0;n<t.features.length;n++){var l=t.features[n],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(i=0;i<c.length;i+=2)l.geometry.push(mt(c[i],c[i+1],e,o,s,a));else for(i=0;i<c.length;i++){var h=[];for(r=0;r<c[i].length;r+=2)h.push(mt(c[i][r],c[i][r+1],e,o,s,a));l.geometry.push(h)}}return t.transformed=!0,t}function mt(t,e,n,i,r,o){return[Math.round(n*(t*i-r)),Math.round(n*(e*i-o))]}function gt(t,e,n,i,r){for(var o=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){s.numFeatures++,yt(s,t[a],o,r);var l=t[a].minX,c=t[a].minY,u=t[a].maxX,h=t[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function yt(t,e,n,i){var r=e.geometry,o=e.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<r.length;a+=3)s.push(r[a]),s.push(r[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)_t(s,r,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<r.length;a++)_t(s,r[a],t,n,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)_t(s,c[a],t,n,!0,0===a)}if(s.length){var u=e.tags||null;if("LineString"===o&&i.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==e.id&&(d.id=e.id),t.features.push(d)}}function _t(t,e,n,i,r,o){var s=i*i;if(i>0&&e.size<(r?s:i))n.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===i||e[l+2]>s)&&(n.numSimplified++,a.push(e[l]),a.push(e[l+1])),n.numPoints++;r&&function(t,e){for(var n=0,i=0,r=t.length,o=r-2;i<r;o=i,i+=2)n+=(t[i]-t[o])*(t[i+1]+t[o+1]);if(n>0===e)for(i=0,r=t.length;i<r/2;i+=2){var s=t[i],a=t[i+1];t[i]=t[r-2-i],t[i+1]=t[r-1-i],t[r-2-i]=s,t[r-1-i]=a}}(a,o),t.push(a)}}function vt(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i,r,o,s,a,l,c=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)Q(n,t.features[i],e,i);else Q(n,"Feature"===t.type?t:{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=c,r=e,o=r.buffer/r.extent,s=i,a=rt(i,1,-1-o,o,0,-1,2,r),l=rt(i,1,1-o,2+o,0,-1,2,r),(a||l)&&(s=rt(i,1,-o,1+o,0,-1,2,r)||[],a&&(s=dt(a,1).concat(s)),l&&(s=s.concat(dt(l,-1)))),c=s).length&&this.splitTile(c,0,0,0),n&&(c.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function xt(t,e,n){return 32*((1<<t)*n+e)+t}function bt(t,e){const n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return e(null,null);const r=new h(i.features);let o=g(r);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:r,rawData:o.buffer})}vt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vt.prototype.splitTile=function(t,e,n,i,r,o,s){for(var a=[t,e,n,i],l=this.options,c=l.debug;a.length;){i=a.pop(),n=a.pop(),e=a.pop(),t=a.pop();var u=1<<e,h=xt(e,n,i),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=gt(t,e,n,i,l),this.tileCoords.push({z:e,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=t,r){if(e===l.maxZoom||e===r)continue;var f=1<<r-e;if(n!==Math.floor(o/f)||i!==Math.floor(s/f))continue}else if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==t.length){c>1&&console.time("clipping");var m,g,y,_,v,x,b=.5*l.buffer/l.extent,w=.5-b,T=.5+b,A=1+b;m=g=y=_=null,v=rt(t,u,n-b,n+T,0,d.minX,d.maxX,l),x=rt(t,u,n+w,n+A,0,d.minX,d.maxX,l),t=null,v&&(m=rt(v,u,i-b,i+T,1,d.minY,d.maxY,l),g=rt(v,u,i+w,i+A,1,d.minY,d.maxY,l),v=null),x&&(y=rt(x,u,i-b,i+T,1,d.minY,d.maxY,l),_=rt(x,u,i+w,i+A,1,d.minY,d.maxY,l),x=null),c>1&&console.timeEnd("clipping"),a.push(m||[],e+1,2*n,2*i),a.push(g||[],e+1,2*n,2*i+1),a.push(y||[],e+1,2*n+1,2*i),a.push(_||[],e+1,2*n+1,2*i+1)}}},vt.prototype.getTile=function(t,e,n){var i=this.options,r=i.extent,o=i.debug;if(t<0||t>24)return null;var s=1<<t,a=xt(t,e=(e%s+s)%s,n);if(this.tiles[a])return ft(this.tiles[a],r);o>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var l,c=t,u=e,h=n;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[xt(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,n),o>1&&console.timeEnd("drilling down"),this.tiles[a]?ft(this.tiles[a],r):null):null};class wt extends t.VectorTileWorkerSource{constructor(t,e,n,i,r){super(t,e,n,i,bt),r&&(this.loadGeoJSON=r)}loadData(e,n){const i=e&&e.request,r=i&&i.collectResourceTiming;this.loadGeoJSON(e,(o,a)=>{if(o||!a)return n(o);if("object"!=typeof a)return n(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));{s(a,!0);try{if(e.filter){const n=t.createExpression(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map(t=>`${t.key}: ${t.message}`).join(", "));const i=a.features.filter(t=>n.value.evaluate({zoom:0},t));a={type:"FeatureCollection",features:i}}this._geoJSONIndex=e.cluster?new Z(function({superclusterOptions:e,clusterProperties:n}){if(!n||!e)return e;const i={},r={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(n);for(const l of a){const[e,o]=n[l],s=t.createExpression(o),a=t.createExpression("string"==typeof e?[e,["accumulated"],["get",l]]:e);i[l]=s.value,r[l]=a.value}return e.map=t=>{s.properties=t;const e={};for(const n of a)e[n]=i[n].evaluate(o,s);return e},e.reduce=(t,e)=>{s.properties=e;for(const n of a)o.accumulated=t[n],t[n]=r[n].evaluate(o,s)},e}(e)).load(a.features):new vt(l=a,e.geojsonVtOptions)}catch(l){return n(l)}this.loaded={};const o={};if(r){const n=t.getPerformanceMeasurement(i);n&&(o.resourceTiming={},o.resourceTiming[e.source]=JSON.parse(JSON.stringify(n)))}n(null,o)}var l})}reloadTile(t,e){const n=this.loaded;return n&&n[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,n){if(e.request)t.getJSON(e.request,n);else{if("string"!=typeof e.data)return n(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return n(null,JSON.parse(e.data))}catch(i){return n(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(n){e(n)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(n){e(n)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(n){e(n)}}}class Tt{constructor(e){this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:t.VectorTileWorkerSource,geojson:wt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}}checkIfReady(t,e,n){n()}setReferrer(t,e){this.referrer=e}spriteLoaded(e,n){this.isSpriteLoaded=n;for(const i in this.workerSources[e]){const r=this.workerSources[e][i];for(const e in r)r[e]instanceof t.VectorTileWorkerSource&&(r[e].isSpriteLoaded=n,r[e].fire(new t.Event("isSpriteLoaded")))}}setImages(t,e,n){this.availableImages[t]=e;for(const i in this.workerSources[t]){const n=this.workerSources[t][i];for(const t in n)n[t].availableImages=e}n()}enableTerrain(t,e,n){this.terrain=e,n()}setLayers(t,e,n){this.getLayerIndex(t).replace(e),n()}updateLayers(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()}loadTile(e,n,i){const r=this.enableTerrain?t.extend({enableTerrain:this.terrain},n):n;this.getWorkerSource(e,n.type,n.source).loadTile(r,i)}loadDEMTile(e,n,i){const r=this.enableTerrain?t.extend({buildQuadTree:this.terrain},n):n;this.getDEMWorkerSource(e,n.source).loadTile(r,i)}reloadTile(e,n,i){const r=this.enableTerrain?t.extend({enableTerrain:this.terrain},n):n;this.getWorkerSource(e,n.type,n.source).reloadTile(r,i)}abortTile(t,e,n){this.getWorkerSource(t,e.type,e.source).abortTile(e,n)}removeTile(t,e,n){this.getWorkerSource(t,e.type,e.source).removeTile(e,n)}removeSource(t,e,n){if(!this.workerSources[t]||!this.workerSources[t][e.type]||!this.workerSources[t][e.type][e.source])return;const i=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==i.removeSource?i.removeSource(e,n):n()}loadWorkerSource(t,e,n){try{this.self.importScripts(e.url),n()}catch(i){n(i.toString())}}syncRTLPluginState(e,n,i){try{t.plugin.setState(n);const e=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=e){this.self.importScripts(e);const n=t.plugin.isParsed();i(n?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),n)}}catch(r){i(r.toString())}}getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}getLayerIndex(t){let e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new i),e}getWorkerSource(t,e,n){return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][n]||(this.workerSources[t][e][n]=new this.workerSourceTypes[e]({send:(e,n,i,r,o,s)=>{this.actor.send(e,n,i,t,o,s)},scheduler:this.actor.scheduler},this.getLayerIndex(t),this.getAvailableImages(t),this.isSpriteLoaded)),this.workerSources[t][e][n]}getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new o),this.demWorkerSources[t][e]}enforceCacheSizeLimit(e,n){t.enforceCacheSizeLimit(n)}getWorkerPerformanceMetrics(t,e,n){n(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Tt(self)),Tt}),i(0,function(t){var e=n;function n(t){return e=t,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{e=new Worker(i),t=!0}catch(r){t=!1}return e&&e.terminate(),URL.revokeObjectURL(i),t}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var n=e.getImageData(0,0,1,1);return n&&n.width===t.width}()||(void 0===i[r=e&&e.failIfMajorPerformanceCaveat]&&(i[r]=function(t){var e,i,r,o,s=(i=t,r=document.createElement("canvas"),(o=Object.create(n.webGLContextAttributes)).failIfMajorPerformanceCaveat=i,r.getContext("webgl",o)||r.getContext("experimental-webgl",o));if(!s)return!1;try{e=s.createShader(s.VERTEX_SHADER)}catch(i){return!1}return!(!e||s.isContextLost())&&(s.shaderSource(e,"void main() {}"),s.compileShader(e),!0===s.getShaderParameter(e,s.COMPILE_STATUS))}(r)),!i[r]||document.documentMode));var e,r}var i={};function r(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!r(t[n],e[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!r(t[n],e[n]))return!1;return!0}return t===e}n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const o={create:function(e,n,i){const r=t.window.document.createElement(e);return void 0!==n&&(r.className=n),i&&i.appendChild(r),r},createNS:function(e,n){return t.window.document.createElementNS(e,n)}},s=t.window.document&&t.window.document.documentElement.style,a=s&&void 0!==s.userSelect?"userSelect":"WebkitUserSelect";let l;o.disableDrag=function(){s&&a&&(l=s[a],s[a]="none")},o.enableDrag=function(){s&&a&&(s[a]=l)},o.setTransform=function(t,e){t.style.transform=e};let c=!1;try{const e=Object.defineProperty({},"passive",{get(){c=!0}});t.window.addEventListener("test",e,e),t.window.removeEventListener("test",e,e)}catch(Hr){c=!1}o.addEventListener=function(t,e,n,i={}){t.addEventListener(e,n,"passive"in i&&c?i:i.capture)},o.removeEventListener=function(t,e,n,i={}){t.removeEventListener(e,n,"passive"in i&&c?i:i.capture)};const u=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",u,!0)};function h(e,n,i){const r=e.offsetWidth===n.width?1:e.offsetWidth/n.width;return new t.pointGeometry((i.clientX-n.left)*r,(i.clientY-n.top)*r)}o.suppressClick=function(){t.window.addEventListener("click",u,!0),t.window.setTimeout(()=>{t.window.removeEventListener("click",u,!0)},0)},o.mousePos=function(t,e){const n=t.getBoundingClientRect();return h(t,n,e)},o.touchPos=function(t,e){const n=t.getBoundingClientRect(),i=[];for(let r=0;r<e.length;r++)i.push(h(t,n,e[r]));return i},o.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},o.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};class d{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(e,n,i){const r=t.dot(n,this.dir);if(Math.abs(r)<1e-6)return!1;const o=t.dot(t.sub(t.create(),e,this.pos),n)/r,s=t.scaleAndAdd(t.create(),this.pos,this.dir,o);return t.copy(i,s),!0}}class p{constructor(t,e){this.points=t,this.planes=e}static fromInvProjectionMatrix(e,n,i){const r=Math.pow(2,i),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(i=>{const o=t.transformMat4([],i,e),s=1/o[3]/n*r;return t.mul(o,o,[s,s,1/o[3],s])}),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(e=>{const n=t.sub([],o[e[0]],o[e[1]]),i=t.sub([],o[e[2]],o[e[1]]),r=t.normalize([],t.cross([],n,i)),s=-t.dot(r,o[e[1]]);return r.concat(s)});return new p(o,s)}}class f{constructor(e,n){this.min=e,this.max=n,this.center=t.scale([],t.add([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],i=t.clone(this.min),r=t.clone(this.max);for(let t=0;t<n.length;t++)i[t]=n[t]?this.min[t]:this.center[t],r[t]=n[t]?this.center[t]:this.max[t];return r[2]=this.max[2],new f(i,r)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}intersects(e){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let i=!0;for(let r=0;r<e.planes.length;r++){const o=e.planes[r];let s=0;for(let e=0;e<n.length;e++)s+=t.dot$1(o,n[e])>=0;if(0===s)return 0;s!==n.length&&(i=!1)}if(i)return 2;for(let t=0;t<3;t++){let n=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let r=0;r<e.points.length;r++){const o=e.points[r][t]-this.min[t];n=Math.min(n,o),i=Math.max(i,o)}if(i<0||n>this.max[t]-this.min[t])return 0}return 1}}function m(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class g extends t.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,callback:e}of this.requestors)this._notify(t,e);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,e){this._validate(t,e)&&(this.images[t]=e)}_validate(e,n){let i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),i=!1),this._validateContent(n.content,n)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),i=!1),i}_validateStretch(t,e){if(!t)return!0;let n=0;for(const i of t){if(i[0]<n||i[1]<i[0]||e<i[1])return!1;n=i[1]}return!0}_validateContent(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,e){let n=!0;if(!this.isLoaded())for(const i of t)this.images[i]||(n=!1);this.isLoaded()||n?this._notify(t,e):this.requestors.push({ids:t,callback:e})}_notify(e,n){const i={};for(const r of e){this.images[r]||this.fire(new t.Event("styleimagemissing",{id:r}));const e=this.images[r];e?i[r]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.warnOnce(`Image "${r}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,i)}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(e){const n=this.patterns[e],i=this.getImage(e);if(!i)return null;if(n&&n.position.version===i.version)return n.position;if(n)n.position.version=i.version;else{const n={w:i.data.width+2,h:i.data.height+2,x:0,y:0},r=new t.ImagePosition(n,i);this.patterns[e]={bin:n,position:r}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:n,h:i}=t.potpack(e),r=this.atlasImage;r.resize({width:n||1,height:i||1});for(const o in this.patterns){const{bin:e}=this.patterns[o],n=e.x+1,i=e.y+1,s=this.images[o].data,a=s.width,l=s.height;t.RGBAImage.copy(s,r,{x:0,y:0},{x:n,y:i},{width:a,height:l}),t.RGBAImage.copy(s,r,{x:0,y:l-1},{x:n,y:i-1},{width:a,height:1}),t.RGBAImage.copy(s,r,{x:0,y:0},{x:n,y:i+l},{width:a,height:1}),t.RGBAImage.copy(s,r,{x:a-1,y:0},{x:n-1,y:i},{width:1,height:l}),t.RGBAImage.copy(s,r,{x:0,y:0},{x:n+a,y:i},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const e of t){if(this.callbackDispatchedThisFrame[e])continue;this.callbackDispatchedThisFrame[e]=!0;const t=this.images[e];m(t)&&this.updateImage(e,t)}}}const y=new t.Properties({anchor:new t.DataConstantProperty(t.spec.light.anchor),position:new class{constructor(){this.specification=t.spec.light.position}possiblyEvaluate(e,n){return function([e,n,i]){const r=t.degToRad(n+90),o=t.degToRad(i);return{x:e*Math.cos(r)*Math.sin(o),y:e*Math.sin(r)*Math.sin(o),z:e*Math.cos(o),azimuthal:n,polar:i}}(e.expression.evaluate(n))}interpolate(e,n,i){return{x:t.number(e.x,n.x,i),y:t.number(e.y,n.y,i),z:t.number(e.z,n.z,i),azimuthal:t.number(e.azimuthal,n.azimuthal,i),polar:t.number(e.polar,n.polar,i)}}},color:new t.DataConstantProperty(t.spec.light.color),intensity:new t.DataConstantProperty(t.spec.light.intensity)}),_="-transition";class v extends t.Evented{constructor(e){super(),this._transitionable=new t.Transitionable(y),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(t.validateLight,e,n))for(const i in e){const n=e[i];t.endsWith(i,_)?this._transitionable.setTransition(i.slice(0,-_.length),n):this._transitionable.setValue(i,n)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,n,i){return(!i||!1!==i.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}const x=new t.Properties({source:new t.DataConstantProperty(t.spec.terrain.source),exaggeration:new t.DataConstantProperty(t.spec.terrain.exaggeration)}),b="-transition";class w extends t.Evented{constructor(e){super(),this._transitionable=new t.Transitionable(x),this.set(e),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(e){for(const n in e){const i=e[n];t.endsWith(n,b)?this._transitionable.setTransition(n.slice(0,-b.length),i):this._transitionable.setValue(n,i)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function T(e,n,i,r){const o=t.smoothstep(45,65,i),[s,a]=A(e,r),l=t.length(n);let c=1-Math.min(1,Math.exp((l-s)/(a-s)*-6));return c*=c*c,c=Math.min(1,1.00747*c),c*o*e.alpha}function A(t,e){const n=.5/Math.tan(.5*e);return[t.range[0]+n,t.range[1]+n]}const S=new t.Properties({range:new t.DataConstantProperty(t.spec.fog.range),color:new t.DataConstantProperty(t.spec.fog.color),"horizon-blend":new t.DataConstantProperty(t.spec.fog["horizon-blend"])}),C="-transition";class I extends t.Evented{constructor(e){super(),this._transitionable=new t.Transitionable(S),this.set(e),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,n={}){if(!this._validate(t.validateFog,e,n))for(const i in e){const n=e[i];t.endsWith(i,C)?this._transitionable.setTransition(i.slice(0,-C.length),n):this._transitionable.setValue(i,n)}}getOpacity(e){const n=this.properties&&this.properties.get("color")||1;return t.smoothstep(45,65,e)*n.a}getOpacityAtLatLng(e,n){return function(e,n,i){const r=t.MercatorCoordinate.fromLngLat(n),o=i.elevation?i.elevation.getAtPointOrZero(r):0,s=[r.x,r.y,o];return t.transformMat4$1(s,s,i.mercatorFogMatrix),T(e,s,i.pitch,i._fov)}(this.state,e,n)}getFovAdjustedRange(t){return A(this.state,t)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,n,i){return(!i||!1!==i.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}class E{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=t.uniqueId();const i=this.workerPool.acquire(this.id);for(let t=0;t<i.length;t++){const e=new E.Actor(i[t],n,this.id);e.name=`Worker ${t}`,this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,n,i){t.asyncAll(this.actors,(t,i)=>{t.send(e,n,i)},i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function M(e,n,i){return n*(t.EXTENT/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}E.Actor=t.Actor;class k{constructor(t,e,n,i){this.screenBounds=t,this.cameraPoint=e,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=n,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(t=>i.pointCoordinate3D(t)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(e,n){let i,r;if(e instanceof t.pointGeometry||"number"==typeof e[0]){const o=t.pointGeometry.convert(e);i=[t.pointGeometry.convert(e)],r=n.isPointAboveHorizon(o)}else{const o=t.pointGeometry.convert(e[0]),s=t.pointGeometry.convert(e[1]);i=[o,s],r=t.polygonizeBounds(o,s).every(t=>n.isPointAboveHorizon(t))}return new k(i,n.getCameraPoint(),r,n)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return t.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new t.pointGeometry(1,1)):this.screenBounds[1],r=t.polygonizeBounds(n,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<i.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?r[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(r[3]=this.cameraPoint)),t.bufferConvexPolygon(r,e)}containsTile(e,n,i){const r=e.queryPadding+1,o=i?this._bufferedCameraMercator(r,n).map(t=>e.tileID.getTilePoint(t)):this._bufferedScreenMercator(r,n).map(t=>e.tileID.getTilePoint(t)),s=this.screenGeometryMercator.map(t=>e.tileID.getTileVec3(t)),a=s.map(e=>new t.pointGeometry(e[0],e[1])),l=n.getFreeCameraOptions().position||new t.MercatorCoordinate(0,0,0),c=e.tileID.getTileVec3(l),u=s.map(e=>{const n=t.sub(e,e,c);return t.normalize(n,n),new d(c,n)}),h=M(e,1,n.zoom);if(t.polygonIntersectsBox(o,0,0,t.EXTENT,t.EXTENT))return{queryGeometry:this,tilespaceGeometry:a,tilespaceRays:u,bufferedTilespaceGeometry:o,bufferedTilespaceBounds:(p=t.getBounds(o),p.min.x=t.clamp(p.min.x,0,t.EXTENT),p.min.y=t.clamp(p.min.y,0,t.EXTENT),p.max.x=t.clamp(p.max.x,0,t.EXTENT),p.max.y=t.clamp(p.max.y,0,t.EXTENT),p),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:h};var p}_bufferedScreenMercator(t,e){const n=P(t);if(this._screenRaycastCache[n])return this._screenRaycastCache[n];{const i=this.bufferedScreenGeometry(t).map(t=>e.pointCoordinate3D(t));return this._screenRaycastCache[n]=i,i}}_bufferedCameraMercator(t,e){const n=P(t);if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];{const i=this.bufferedCameraGeometry(t).map(t=>e.pointCoordinate3D(t));return this._cameraRaycastCache[n]=i,i}}}function P(t){return 100*t|0}function D(e,n,i){const r=function(r,o){if(r)return i(r);if(o){const r=t.pick(t.extend(o,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(r.vectorLayers=o.vector_layers,r.vectorLayerIds=r.vectorLayers.map(t=>t.id)),r.tiles=n.canonicalizeTileset(r,e.url),i(null,r)}};return e.url?t.getJSON(n.transformRequest(n.normalizeSourceURL(e.url),t.ResourceType.Source),r):t.exported.frame(()=>r(null,e))}class L{constructor(e,n,i){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=i||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),i=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*n),r=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*n),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*n),s=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*n);return e.x>=i&&e.x<o&&e.y>=r&&e.y<s}}class O{constructor(t,e,n){this.context=t;const i=t.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const R={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class z{constructor(t,e,n,i){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=i,this.context=t;const r=t.gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let n=0;n<this.attributes.length;n++){const i=e.attributes[this.attributes[n].name];void 0!==i&&t.enableVertexAttribArray(i)}}setVertexAttribPointers(t,e,n){for(let i=0;i<this.attributes.length;i++){const r=this.attributes[i],o=e.attributes[r.name];void 0!==o&&t.vertexAttribPointer(o,r.components,t[R[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Z{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class F extends Z{getDefault(){return t.Color.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class U extends Z{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class N extends Z{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class B extends Z{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class q extends Z{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class $ extends Z{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class V extends Z{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class j extends Z{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class G extends Z{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class Y extends Z{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class H extends Z{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class J extends Z{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class W extends Z{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class X extends Z{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Q extends Z{getDefault(){return t.Color.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class K extends Z{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class tt extends Z{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class et extends Z{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class nt extends Z{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class it extends Z{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class rt extends Z{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ot extends Z{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class st extends Z{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class at extends Z{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class lt extends Z{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ct extends Z{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ut extends Z{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ht extends Z{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class dt extends Z{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class pt extends Z{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ft extends Z{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class mt extends Z{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class gt extends mt{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class yt extends mt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,this.attachment(),e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class _t extends yt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class vt{constructor(t,e,n,i){this.context=t,this.width=e,this.height=n;const r=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new gt(t,r),i&&(this.depthAttachment=new yt(t,r))}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class xt{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new F(this),this.clearDepth=new U(this),this.clearStencil=new N(this),this.colorMask=new B(this),this.depthMask=new q(this),this.stencilMask=new $(this),this.stencilFunc=new V(this),this.stencilOp=new j(this),this.stencilTest=new G(this),this.depthRange=new Y(this),this.depthTest=new H(this),this.depthFunc=new J(this),this.blend=new W(this),this.blendFunc=new X(this),this.blendColor=new Q(this),this.blendEquation=new K(this),this.cullFace=new tt(this),this.cullFaceSide=new et(this),this.frontFace=new nt(this),this.program=new it(this),this.activeTexture=new rt(this),this.viewport=new ot(this),this.bindFramebuffer=new st(this),this.bindRenderbuffer=new at(this),this.bindTexture=new lt(this),this.bindVertexBuffer=new ct(this),this.bindElementBuffer=new ut(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ht(this),this.pixelStoreUnpack=new dt(this),this.pixelStoreUnpackPremultiplyAlpha=new pt(this),this.pixelStoreUnpackFlipY=new ft(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new O(this,t,e)}createVertexBuffer(t,e,n){return new z(this,t,e,n)}createRenderbuffer(t,e,n){const i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),r}createFramebuffer(t,e,n){return new vt(this,t,e,n)}clear({color:t,depth:e,stencil:n}){const i=this.gl;let r=0;t&&(r|=i.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==e&&(r|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==n&&(r|=i.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),i.clear(r)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(e){r(e.blendFunction,t.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class bt extends t.Evented{constructor(e,n,i,r){super(),this.id=e,this.dispatcher=i,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},n),t.extend(this,t.pick(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=D(this._options,this.map._requestManager,(e,n)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):n&&(t.extend(this,n),n.bounds&&(this.tileBounds=new L(n.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(n.tiles),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,n){const i=t.exported.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),(i,r,o,s)=>{if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(r){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:o,expires:s});const i=this.map.painter.context,a=i.gl;e.texture=this.map.painter.getTileTexture(r.width),e.texture?e.texture.update(r,{useMipmap:!0}):(e.texture=new t.Texture(i,r,a.RGBA,{useMipmap:!0}),e.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),i.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(this.dispatcher),n(null)}})}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e()}unloadTile(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()}hasTransition(){return!1}}let wt;var Tt=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class At extends t.Evented{constructor(t,e,n,i){super(),this.id=t,this.dispatcher=n,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=e}load(e,n){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(i,r)=>{this._loaded=!0,i?this.fire(new t.ErrorEvent(i)):r&&(this.image=t.exported.getImageData(r),e&&(this.coordinates=e),n&&n(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(e){this.coordinates=e;const n=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){let n=1/0,i=1/0,r=-1/0,o=-1/0;for(const t of e)n=Math.min(n,t.x),i=Math.min(i,t.y),r=Math.max(r,t.x),o=Math.max(o,t.y);const s=Math.max(r-n,o-i),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new t.CanonicalTileID(a,Math.floor((n+r)/2*l),Math.floor((i+o)/2*l))}(n),this.minzoom=this.maxzoom=this.tileID.z;const i=n.map(t=>this.tileID.getTilePoint(t)._round());return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Tt.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const St={vector:class extends t.Evented{constructor(e,n,i,r){if(super(),this.id=e,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(n,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new t.DedupedRequest}load(){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=D(this._options,this.map._requestManager,(e,n)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):n&&(t.extend(this,n),n.bounds&&(this.tileBounds=new L(n.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(n.tiles,this.map._requestManager._customAccessToken),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t();const e=this.map.style._getSourceCaches(this.id);for(const n of e)n.clearTiles();this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}loadTile(e,n){const i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(i,t.ResourceType.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile};if(r.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=n:e.request=e.actor.send("reloadTile",r,o.bind(this));else if(e.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",r,o.bind(this),void 0,!0);else{const n=t.loadVectorTile.call({deduped:this._deduped},r,(t,n)=>{t||!n?o.call(this,t):(r.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},e.actor&&e.actor.send("loadTile",r,o.bind(this),void 0,!0))},!0);e.request={cancel:n}}function o(i,r){return delete e.request,e.aborted?n(null):i&&404!==i.status?n(i):(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id})}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:bt,"raster-dem":class extends bt{constructor(e,n,i,r){super(e,n,i,r),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(e,n){const i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(t,i){t&&(e.state="errored",n(t)),i&&(e.dem=i,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",n(null))}e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),(function(i,o,s,a){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:s,expires:a});const n=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap&&(null==wt&&(wt=t.window.OffscreenCanvas&&new t.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof t.window.createImageBitmap),wt),i=1-(o.width-t.prevPowerOfTwo(o.width))/2;i<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const l=n?o:t.exported.getImageData(o,i),c={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:l,encoding:this.encoding,padding:i};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",c,r.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(e){const n=e.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,o=0===n.x?e.wrap-1:e.wrap,s=(n.x+1+i)%i,a=n.x+1===i?e.wrap+1:e.wrap,l={};return l[new t.OverscaledTileID(e.overscaledZ,o,n.z,r,n.y).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,n.z,s,n.y).key]={backfilled:!1},n.y>0&&(l[new t.OverscaledTileID(e.overscaledZ,o,n.z,r,n.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,n.z,s,n.y-1).key]={backfilled:!1}),n.y+1<i&&(l[new t.OverscaledTileID(e.overscaledZ,o,n.z,r,n.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,n.z,s,n.y+1).key]={backfilled:!1}),l}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded"}},geojson:class extends t.Evented{constructor(e,n,i,r){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(r),this._data=n.data,this._options=t.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const o=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*o,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*o,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:t.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*o,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this}getClusterLeaves(t,e,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:n},i),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.Event("dataloading",{dataType:"source"})),this._loaded=!1;const e=t.extend({},this.workerOptions),n=this._data;"string"==typeof n?(e.request=this.map._requestManager.transformRequest(t.exported.resolveURL(n),t.ResourceType.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,(e,n)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new t.ErrorEvent(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&n&&n.resourceTiming&&n.resourceTiming[this.id]&&(e.resourceTiming=n.resourceTiming[this.id]),this.fire(new t.Event("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(e,n){const i=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(i,{type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(t,r)=>(delete e.request,e.unloadVectorData(),e.aborted?n(null):t?n(t):(e.loadVectorData(r,this.map.painter,"reloadTile"===i),n(null))),void 0,"loadTile"===i)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends At{constructor(t,e,n,i){super(t,e,n,i),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,t.ResourceType.Source).url);t.getVideo(this.urls,(e,n)=>{this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):n&&(this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Tt.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:At,canvas:class extends At{constructor(e,n,i,r){super(e,n,i,r),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(t=>!Array.isArray(t)||2!==t.length||t.some(t=>"number"!=typeof t))||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,i=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Tt.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(n,this.canvas,i.RGBA,{premultiply:!0});for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}},Ct=function(e,n,i,r){const o=new St[n.type](e,n,i,r);if(o.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${o.id}`);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o};function It(e,n){const i=t.identity([]);return t.scale$1(i,i,[.5*e.width,.5*-e.height,1]),t.translate(i,i,[1,-1,0]),t.multiply(i,i,e.calculateProjMatrix(n.toUnwrapped()))}function Et(t,e,n,i,r,o,s,a=!1){const l=t.tilesIn(i,s,a);l.sort(kt);const c=[];for(const h of l)c.push({wrappedTileID:h.tile.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,n,t._state,h,r,o,It(t.transform,h.tile.tileID),a)});const u=function(t){const e={},n={};for(const i of t){const t=i.queryResults,r=i.wrappedTileID,o=n[r]=n[r]||{};for(const n in t){const i=t[n],r=o[n]=o[n]||{},s=e[n]=e[n]||[];for(const t of i)r[t.featureIndex]||(r[t.featureIndex]=!0,s.push(t))}}return e}(c);for(const h in u)u[h].forEach(e=>{const n=e.feature,i=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=i});return u}function Mt(t,e){const n=t.getRenderableIds().map(e=>t.getTileByID(e)),i=[],r={};for(let o=0;o<n.length;o++){const t=n[o],s=t.tileID.canonical.key;r[s]||(r[s]=!0,t.querySourceFeatures(i,e))}return i}function kt(t,e){const n=t.tileID,i=e.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}function Pt(){return null!=Yr.workerClass?new Yr.workerClass:new t.window.Worker(Yr.workerUrl)}const Dt="mapboxgl_preloaded_worker_pool";class Lt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Lt.workerCount;)this.workers.push(new Pt);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach(t=>{t.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Dt]}numActive(){return Object.keys(this.active).length}}let Ot;function Rt(){return Ot||(Ot=new Lt),Ot}function zt(e,n){const i={};for(const t in e)"ref"!==t&&(i[t]=e[t]);return t.refProperties.forEach(t=>{t in n&&(i[t]=n[t])}),i}function Zt(t){t=t.slice();const e=Object.create(null);for(let n=0;n<t.length;n++)e[t[n].id]=t[n];for(let n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=zt(t[n],e[t[n].ref]));return t}Lt.workerCount=2;const Ft={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function Ut(t,e,n){n.push({command:Ft.addSource,args:[t,e[t]]})}function Nt(t,e,n){e.push({command:Ft.removeSource,args:[t]}),n[t]=!0}function Bt(t,e,n,i){Nt(t,n,i),Ut(t,e,n)}function qt(t,e,n){let i;for(i in t[n])if(t[n].hasOwnProperty(i)&&"data"!==i&&!r(t[n][i],e[n][i]))return!1;for(i in e[n])if(e[n].hasOwnProperty(i)&&"data"!==i&&!r(t[n][i],e[n][i]))return!1;return!0}function $t(t,e,n,i,o,s){let a;for(a in e=e||{},t=t||{})t.hasOwnProperty(a)&&(r(t[a],e[a])||n.push({command:s,args:[i,a,e[a],o]}));for(a in e)e.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(r(t[a],e[a])||n.push({command:s,args:[i,a,e[a],o]}))}function Vt(t){return t.id}function jt(t,e){return t[e.id]=e,t}class Gt{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);let n=1,i=this._distances[n];const r=e*this.paddedLength+this.padding;for(;i<r&&n<this._distances.length;)i=this._distances[++n];const o=n-1,s=this._distances[o],a=i-s,l=a>0?(r-s)/a:0;return this.points[o].mult(1-l).add(this.points[n].mult(l))}}class Yt{constructor(t,e,n){const i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(let o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}insertCircle(t,e,n,i){this._forEachCell(e-i,n-i,e+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(i)}_insertBoxCell(t,e,n,i,r,o){this.boxCells[r].push(o)}_insertCircleCell(t,e,n,i,r,o){this.circleCells[r].push(o)}_query(t,e,n,i,r,o){if(n<0||t>this.width||i<0||e>this.height)return!r&&[];const s=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=i){if(r)return!0;for(let t=0;t<this.boxKeys.length;t++)s.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],n=this.circles[3*t+1],i=this.circles[3*t+2];s.push({key:this.circleKeys[t],x1:e-i,y1:n-i,x2:e+i,y2:n+i})}return o?s.filter(o):s}return this._forEachCell(t,e,n,i,this._queryCell,s,{hitTest:r,seenUids:{box:{},circle:{}}},o),r?s.length>0:s}_queryCircle(t,e,n,i,r){const o=t-n,s=t+n,a=e-n,l=e+n;if(s<0||o>this.width||l<0||a>this.height)return!i&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:i,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}},r),i?c.length>0:c}query(t,e,n,i,r){return this._query(t,e,n,i,!1,r)}hitTest(t,e,n,i,r){return this._query(t,e,n,i,!0,r)}hitTestCircle(t,e,n,i){return this._queryCircle(t,e,n,!0,i)}_queryCell(t,e,n,i,r,o,s,a){const l=s.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(t<=r[c+2]&&e<=r[c+3]&&n>=r[c+0]&&i>=r[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(r[u],r[u+1],r[u+2],t,e,n,i)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const t=r[u],e=r[u+1],n=r[u+2];o.push({key:this.circleKeys[c],x1:t-n,y1:e-n,x2:t+n,y2:e+n})}}}}}_queryCellCircle(t,e,n,i,r,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[r];if(null!==u){const t=this.bboxes;for(const e of u)if(!c.box[e]){c.box[e]=!0;const n=4*e;if(this._circleAndRectCollide(l.x,l.y,l.radius,t[n+0],t[n+1],t[n+2],t[n+3])&&(!a||a(this.boxKeys[e])))return o.push(!0),!0}}const h=this.circleCells[r];if(null!==h){const t=this.circles;for(const e of h)if(!c.circle[e]){c.circle[e]=!0;const n=3*e;if(this._circlesCollide(t[n],t[n+1],t[n+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[e])))return o.push(!0),!0}}}_forEachCell(t,e,n,i,r,o,s,a){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,t,e,n,i,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,n,i,r,o){const s=i-t,a=r-e,l=n+o;return l*l>s*s+a*a}_circleAndRectCollide(t,e,n,i,r,o,s){const a=(o-i)/2,l=Math.abs(t-(i+a));if(l>a+n)return!1;const c=(s-r)/2,u=Math.abs(e-(r+c));if(u>c+n)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=n*n}}const Ht=Math.tan(85*Math.PI/180);function Jt(e,n,i,r,o){const s=t.create$1();return n?(t.scale$1(s,s,[1/o,1/o,1]),i||t.rotateZ(s,s,r.angle)):t.multiply(s,r.labelPlaneMatrix,e),s}function Wt(e,n,i,r,o){if(n){const n=t.clone$1(e);return t.scale$1(n,n,[o,o,1]),i||t.rotateZ(n,n,-r.angle),n}return r.glCoordMatrix}function Xt(e,n,i=0){const r=[e.x,e.y,i,1];i?t.transformMat4(r,r,n):le(r,r,n);const o=r[3];return{point:new t.pointGeometry(r[0]/o,r[1]/o),signedDistanceFromCamera:o}}function Qt(t,e){return Math.min(.5+t/e*.5,1.5)}function Kt(t,e){const n=t[0]/t[3],i=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&i>=-e[1]&&i<=e[1]}function te(e,n,i,r,o,s,a,l,c){const u=r?e.textSizeData:e.iconSizeData,h=t.evaluateSizeForZoom(u,i.transform.zoom),d=[256/i.width*2+1,256/i.height*2+1],p=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();const f=e.lineVertexArray,m=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,g=i.transform.width/i.transform.height;let y=!1;for(let _=0;_<m.length;_++){const r=m.get(_);if(r.writingMode!==t.WritingMode.vertical||y||0!==_&&m.get(_-1).writingMode===t.WritingMode.horizontal||(y=!0),r.hidden||r.writingMode===t.WritingMode.vertical&&!y){ae(r.numGlyphs,p);continue}y=!1;const v=c?c({x:r.anchorX,y:r.anchorY}):0,x=[r.anchorX,r.anchorY,v,1];if(t.transformMat4(x,x,n),!Kt(x,d)){ae(r.numGlyphs,p);continue}const b=Qt(i.transform.cameraToCenterDistance,x[3]),w=t.evaluateSizeForFeature(u,h,r),T=a?w/b:w*b,A=new t.pointGeometry(r.anchorX,r.anchorY),S=Xt(A,o,v);if(S.signedDistanceFromCamera<=0){ae(r.numGlyphs,p);continue}const C=S.point;let I={};const E=a?null:c,M=ie(r,T,!1,l,n,o,s,e.glyphOffsetArray,f,p,C,A,I,g,E);y=M.useVertical,E&&M.needsFlipping&&(I={}),(M.notEnoughRoom||y||M.needsFlipping&&ie(r,T,!0,l,n,o,s,e.glyphOffsetArray,f,p,C,A,I,g,E).notEnoughRoom)&&ae(r.numGlyphs,p)}r?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function ee(t,e,n,i,r,o,s,a,l,c,u,h,d){const p=a.glyphStartIndex+a.numGlyphs,f=a.lineStartIndex,m=a.lineStartIndex+a.lineLength,g=e.getoffsetX(a.glyphStartIndex),y=e.getoffsetX(p-1),_=oe(t*g,n,i,r,o,s,a.segment,f,m,l,c,u,h,d,!0);if(!_)return null;const v=oe(t*y,n,i,r,o,s,a.segment,f,m,l,c,u,h,d,!0);return v?{first:_,last:v}:null}function ne(e,n,i,r){return e.writingMode===t.WritingMode.horizontal&&Math.abs(i.y-n.y)>Math.abs(i.x-n.x)*r?{useVertical:!0}:e.writingMode===t.WritingMode.vertical?n.y<i.y?{needsFlipping:!0}:null:0!==e.flipState&&function(t,e,n){const i=(e.x-t.x)*n;return 0===i||Math.abs((e.y-t.y)/i)>Ht}(n,i,r)?1===e.flipState?{needsFlipping:!0}:null:n.x>i.x?{needsFlipping:!0}:null}function ie(e,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const g=n/24,y=e.lineOffsetX*g,_=e.lineOffsetY*g;let v;if(e.numGlyphs>1){const t=e.glyphStartIndex+e.numGlyphs,n=e.lineStartIndex,o=e.lineStartIndex+e.lineLength,u=ee(g,l,y,_,i,h,d,e,c,s,p,m);if(!u)return{notEnoughRoom:!0};const x=Xt(u.first.point,a).point,b=Xt(u.last.point,a).point;if(r&&!i){const t=ne(e,x,b,f);if(e.flipState=t&&t.needsFlipping?1:2,t)return t}v=[u.first];for(let r=e.glyphStartIndex+1;r<t-1;r++)v.push(oe(g*l.getoffsetX(r),y,_,i,h,d,e.segment,n,o,c,s,p,m));v.push(u.last)}else{if(r&&!i){const n=Xt(d,o).point,i=e.lineStartIndex+e.segment+1,r=new t.pointGeometry(c.getx(i),c.gety(i)),s=Xt(r,o),a=ne(e,n,s.signedDistanceFromCamera>0?s.point:re(d,r,n,1,o),f);if(e.flipState=a&&a.needsFlipping?1:2,a)return a}const n=oe(g*l.getoffsetX(e.glyphStartIndex),y,_,i,h,d,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,c,s,p,m);if(!n)return{notEnoughRoom:!0};v=[n]}for(const x of v)t.addDynamicAttributes(u,x.point,x.angle);return{}}function re(t,e,n,i,r,o){const s=t.add(t.sub(e)._unit()),a=Xt(s,r,o?o(s):0).point,l=n.sub(a);return n.add(l._mult(i/l.mag()))}function oe(e,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const g=r?e-n:e+n;let y=g>0?1:-1,_=0;r&&(y*=-1,_=Math.PI),y<0&&(_+=Math.PI);let v=y>0?l+a:l+a+1,x=o,b=o,w=0,T=0;const A=Math.abs(g),S=[],C=[];let I=s;const E=()=>{const e=v-y;return 0===w?s:new t.pointGeometry(u.getx(e),u.gety(e))},M=()=>re(E(),I,b,A-w+1,h,p);for(;w+T<=A;){if(v+=y,v<l||v>=c)return null;if(b=x,S.push(x),f&&C.push(I||E()),x=d[v],void 0===x){I=new t.pointGeometry(u.getx(v),u.gety(v));const e=Xt(I,h,p?p(I):0);x=e.signedDistanceFromCamera>0?d[v]=e.point:M()}else I=null;w+=T,T=b.dist(x)}m&&p&&(I=I||new t.pointGeometry(u.getx(v),u.gety(v)),d[v]=x=void 0===d[v]?x:M(),T=b.dist(x));const k=(A-w)/T,P=x.sub(b),D=P.mult(k)._add(b);i&&D._add(P._unit()._perp()._mult(i*y));const L=_+Math.atan2(x.y-b.y,x.x-b.x);return S.push(D),f&&(I=I||new t.pointGeometry(u.getx(v),u.gety(v)),C.push(function(e,n,i){const r=1-i;return new t.pointGeometry(e.x*r+n.x*i,e.y*r+n.y*i)}(C.length>0?C[C.length-1]:I,I,k))),{point:D,angle:L,path:S,tilePath:C}}const se=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ae(t,e){for(let n=0;n<t;n++){const t=e.length;e.resize(t+4),e.float32.set(se,3*t)}}function le(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t[3]=n[3]*i+n[7]*r+n[15],t}const ce=100;class ue{constructor(t,e,n=new Yt(t.width+200,t.height+200,25),i=new Yt(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=i,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ce,this.screenBottomBoundary=t.height+ce,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=e}placeCollisionBox(t,e,n,i,r,o,s){const a=this.projectAndGetPerspectiveRatio(o,e.anchorPointX,e.anchorPointY,e.elevation,e.tileID),l=r*a.perspectiveRatio,c=(e.x1*t+n.x-e.padding)*l+a.point.x,u=(e.y1*t+n.y-e.padding)*l+a.point.y,h=(e.x2*t+n.x+e.padding)*l+a.point.x,d=(e.y2*t+n.y+e.padding)*l+a.point.y,p=a.perspectiveRatio<=.55||a.aboveHorizon;return!this.isInsideGrid(c,u,h,d)||!i&&this.grid.hitTest(c,u,h,d,s)||p?{box:[],offscreen:!1}:{box:[c,u,h,d],offscreen:this.isOffscreen(c,u,h,d)}}placeCollisionCircles(e,n,i,r,o,s,a,l,c,u,h,d,p,f){const m=[],g=this.transform.elevation,y=g?t=>g.getAtTileOffset(f,t.x,t.y):t=>0,_=new t.pointGeometry(n.anchorX,n.anchorY),v=y(_),x=this.projectAndGetPerspectiveRatio(s,_.x,_.y,v,f),{perspectiveRatio:b}=x,w=(u?o/b:o*b)/t.ONE_EM,T=Xt(_,a,v).point,A=x.signedDistanceFromCamera>0?ee(w,r,n.lineOffsetX*w,n.lineOffsetY*w,!1,T,_,n,i,a,{},g&&!u?y:null,u&&!!g):null;let S=!1,C=!1,I=!0;if(A&&!x.aboveHorizon){const n=.5*d*b+p,i=new t.pointGeometry(-100,-100),r=new t.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),o=new Gt,s=A.first,a=A.last;let u=[];for(let t=s.path.length-1;t>=1;t--)u.push(s.path[t]);for(let t=1;t<a.path.length;t++)u.push(a.path[t]);const f=2.5*n;if(l){const t=u.map(g?(t,e)=>{const n=y(e<s.path.length-1?s.tilePath[s.path.length-1-e]:a.tilePath[e-s.path.length+2]);return Xt(t,l,n)}:t=>Xt(t,l));u=t.some(t=>t.signedDistanceFromCamera<=0)?[]:t.map(t=>t.point)}let _=[];if(u.length>0){const e=u[0].clone(),n=u[0].clone();for(let t=1;t<u.length;t++)e.x=Math.min(e.x,u[t].x),e.y=Math.min(e.y,u[t].y),n.x=Math.max(n.x,u[t].x),n.y=Math.max(n.y,u[t].y);_=e.x>=i.x&&n.x<=r.x&&e.y>=i.y&&n.y<=r.y?[u]:n.x<i.x||e.x>r.x||n.y<i.y||e.y>r.y?[]:t.clipLine([u],i.x,i.y,r.x,r.y)}for(const t of _){o.reset(t,.25*n);let i=0;i=o.length<=.5*n?1:Math.ceil(o.paddedLength/f)+1;for(let t=0;t<i;t++){const r=t/Math.max(i-1,1),s=o.lerp(r),a=s.x+ce,l=s.y+ce;m.push(a,l,n,0);const u=a-n,d=l-n,p=a+n,f=l+n;if(I=I&&this.isOffscreen(u,d,p,f),C=C||this.isInsideGrid(u,d,p,f),!e&&this.grid.hitTestCircle(a,l,n,h)&&(S=!0,!c))return{circles:[],offscreen:!1,collisionDetected:S}}}}return{circles:!c&&S||!C?[]:m,offscreen:I,collisionDetected:S}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let i=1/0,r=1/0,o=-1/0,s=-1/0;for(const u of e){const e=new t.pointGeometry(u.x+ce,u.y+ce);i=Math.min(i,e.x),r=Math.min(r,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y),n.push(e)}const a=this.grid.query(i,r,o,s).concat(this.ignoredGrid.query(i,r,o,s)),l={},c={};for(const u of a){const e=u.key;if(void 0===l[e.bucketInstanceId]&&(l[e.bucketInstanceId]={}),l[e.bucketInstanceId][e.featureIndex])continue;const i=[new t.pointGeometry(u.x1,u.y1),new t.pointGeometry(u.x2,u.y1),new t.pointGeometry(u.x2,u.y2),new t.pointGeometry(u.x1,u.y2)];t.polygonIntersectsPolygon(n,i)&&(l[e.bucketInstanceId][e.featureIndex]=!0,void 0===c[e.bucketInstanceId]&&(c[e.bucketInstanceId]=[]),c[e.bucketInstanceId].push(e.featureIndex))}return c}insertCollisionBox(t,e,n,i,r){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:i,collisionGroupID:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,n,i,r){const o=e?this.ignoredGrid:this.grid,s={bucketInstanceId:n,featureIndex:i,collisionGroupID:r};for(let a=0;a<t.length;a+=4)o.insertCircle(s,t[a],t[a+1],t[a+2])}projectAndGetPerspectiveRatio(e,n,i,r,o){const s=[n,i,r||0,1];let a=!1;if(r||this.transform.pitch>0){t.transformMat4(s,s,e);let l=!1;this.fogState&&o&&(l=function(e,n,i,r,o,s){const a=s.calculateFogTileMatrix(o),l=[n,i,r];return t.transformMat4$1(l,l,a),T(e,l,s.pitch,s._fov)}(this.fogState,n,i,r||0,o.toUnwrapped(),this.transform)>.9),a=s[2]>s[3]||l}else le(s,s,e);return{point:new t.pointGeometry((s[0]/s[3]+1)/2*this.transform.width+ce,(-s[1]/s[3]+1)/2*this.transform.height+ce),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/s[3]*.5,1.5),signedDistanceFromCamera:s[3],aboveHorizon:a}}isOffscreen(t,e,n,i){return n<ce||t>=this.screenRightBoundary||i<ce||e>this.screenBottomBoundary}isInsideGrid(t,e,n,i){return n>=0&&t<this.gridRightBoundary&&i>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e}}class he{constructor(t,e,n,i){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):i&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class de{constructor(t,e,n,i,r){this.text=new he(t?t.text:null,e,n,r),this.icon=new he(t?t.icon:null,e,i,r)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class pe{constructor(t,e,n){this.text=t,this.icon=e,this.skipFade=n}}class fe{constructor(){this.invProjMatrix=t.create$1(),this.viewportMatrix=t.create$1(),this.circles=[]}}class me{constructor(t,e,n,i,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r}}class ge{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function ye(e,n,i,r,o){const{horizontalAlign:s,verticalAlign:a}=t.getAnchorAlignment(e),l=-(s-.5)*n,c=-(a-.5)*i,u=t.evaluateVariableOffset(e,r);return new t.pointGeometry(l+u[0]*o,c+u[1]*o)}function _e(e,n,i,r,o){const s=new t.pointGeometry(e,n);return i&&s._rotate(r?o:-o),s}class ve{constructor(t,e,n,i,r){this.transform=t.clone(),this.collisionIndex=new ue(this.transform,r),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new ge(n),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,n,i,r){const o=i.getBucket(n),s=i.latestFeatureIndex;if(!o||!s||n.id!==o.layerIds[0])return;const a=i.collisionBoxArray,l=o.layers[0].layout,c=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),u=i.tileSize/t.EXTENT,h=this.transform.calculateProjMatrix(i.tileID.toUnwrapped()),d="map"===l.get("text-pitch-alignment"),p="map"===l.get("text-rotation-alignment"),f=M(i,1,this.transform.zoom),m=Jt(h,d,p,this.transform,f);let g=null;if(d){const e=Wt(h,d,p,this.transform,f);g=t.multiply([],this.transform.labelPlaneMatrix,e)}this.retainedQueryData[o.bucketInstanceId]=new me(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,i.tileID);const y={bucket:o,layout:l,posMatrix:h,textLabelPlaneMatrix:m,labelToScreenMatrix:g,scale:c,textPixelRatio:u,holdingForFade:i.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.evaluateSizeForZoom(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(r)for(const t of o.sortKeyRanges){const{sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r}=t;e.push({sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r,parameters:y})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:y})}attemptAnchorPlacement(t,e,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y){const _=[h.textOffset0,h.textOffset1],v=ye(t,n,i,_,r),x=this.collisionIndex.placeCollisionBox(r,e,_e(v.x,v.y,o,s,this.transform.angle),u,a,l,c.predicate);if((!m||0!==this.collisionIndex.placeCollisionBox(p.getSymbolInstanceIconSize(y,this.transform.zoom,d),m,_e(v.x,v.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)&&x.box.length>0){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(e=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:_,width:n,height:i,anchor:t,textScale:r,prevAnchor:e},this.markUsedJustification(p,t,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[h.crossTileID]=f),{shift:v,placedGlyphBoxes:x}}}placeLayerBucketPart(e,n,i){const{bucket:r,layout:o,posMatrix:s,textLabelPlaneMatrix:a,labelToScreenMatrix:l,textPixelRatio:c,holdingForFade:u,collisionBoxArray:h,partiallyEvaluatedTextSize:d,partiallyEvaluatedIconSize:p,collisionGroup:f}=e.parameters,m=o.get("text-optional"),g=o.get("icon-optional"),y=o.get("text-allow-overlap"),_=o.get("icon-allow-overlap"),v="map"===o.get("text-rotation-alignment"),x="map"===o.get("text-pitch-alignment"),b="none"!==o.get("icon-text-fit"),w="viewport-y"===o.get("symbol-z-order"),T=y&&(_||!r.hasIconData()||g),A=_&&(y||!r.hasTextData()||m);!r.collisionArrays&&h&&r.deserializeCollisionBoxes(h),i&&r.updateCollisionDebugBuffers(this.transform.zoom,h);const S=(e,h,w)=>{if(n[e.crossTileID])return;if(u)return void(this.placements[e.crossTileID]=new pe(!1,!1,!1));let S=!1,C=!1,I=!0,E=null,M={box:null,offscreen:null},k={box:null,offscreen:null},P=null,D=null,L=null,O=0,R=0,z=0;w.textFeatureIndex?O=w.textFeatureIndex:e.useRuntimeCollisionCircles&&(O=e.featureIndex),w.verticalTextFeatureIndex&&(R=w.verticalTextFeatureIndex);const Z=t=>{t.tileID=this.retainedQueryData[r.bucketInstanceId].tileID,(this.transform.elevation||t.elevation)&&(t.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[r.bucketInstanceId].tileID,t.anchorPointX,t.anchorPointY):0)},F=w.textBox;if(F){Z(F);const n=n=>{let i=t.WritingMode.horizontal;if(r.allowVerticalPlacement&&!n&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,i=t,this.markUsedOrientation(r,i,e))}return i},i=(n,i)=>{if(r.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&w.verticalTextBox){for(const e of r.writingModes)if(e===t.WritingMode.vertical?(M=i(),k=M):M=n(),M&&M.box&&M.box.length)break}else M=n()};if(o.get("text-variable-anchor")){let a=o.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[e.crossTileID]){const t=this.prevPlacement.variableOffsets[e.crossTileID];a.indexOf(t.anchor)>0&&(a=a.filter(e=>e!==t.anchor),a.unshift(t.anchor))}const l=(t,n,i)=>{const o=r.getSymbolInstanceTextSize(d,e,this.transform.zoom,h),l=(t.x2-t.x1)*o+2*t.padding,u=(t.y2-t.y1)*o+2*t.padding,m=b&&!_?n:null;m&&Z(m);let g={box:[],offscreen:!1};const w=y?2*a.length:a.length;for(let y=0;y<w;++y){const n=this.attemptAnchorPlacement(a[y%a.length],t,l,u,o,v,x,c,s,f,y>=a.length,e,h,r,i,m,d,p);if(n&&(g=n.placedGlyphBoxes,g&&g.box&&g.box.length)){S=!0,E=n.shift;break}}return g};i(()=>l(F,w.iconBox,t.WritingMode.horizontal),()=>{const n=w.verticalTextBox;return n&&Z(n),r.allowVerticalPlacement&&!(M&&M.box&&M.box.length)&&e.numVerticalGlyphVertices>0&&n?l(n,w.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}}),M&&(S=M.box,I=M.offscreen);const u=n(M&&M.box);if(!S&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(r,t.anchor,e,u))}}else{const o=(n,i)=>{const o=r.getSymbolInstanceTextSize(d,e,this.transform.zoom,h),a=this.collisionIndex.placeCollisionBox(o,n,new t.pointGeometry(0,0),y,c,s,f.predicate);return a&&a.box&&a.box.length&&(this.markUsedOrientation(r,i,e),this.placedOrientations[e.crossTileID]=i),a};i(()=>o(F,t.WritingMode.horizontal),()=>{const n=w.verticalTextBox;return r.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&n?(Z(n),o(n,t.WritingMode.vertical)):{box:null,offscreen:null}}),n(M&&M.box&&M.box.length)}}if(P=M,S=P&&P.box&&P.box.length>0,I=P&&P.offscreen,e.useRuntimeCollisionCircles){const n=r.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex),c=t.evaluateSizeForFeature(r.textSizeData,d,n),u=o.get("text-padding");D=this.collisionIndex.placeCollisionCircles(y,n,r.lineVertexArray,r.glyphOffsetArray,c,s,a,l,i,x,f.predicate,e.collisionCircleDiameter,u,this.retainedQueryData[r.bucketInstanceId].tileID),S=y||D.circles.length>0&&!D.collisionDetected,I=I&&D.offscreen}if(w.iconFeatureIndex&&(z=w.iconFeatureIndex),w.iconBox){const e=e=>{Z(e);const n=b&&E?_e(E.x,E.y,v,x,this.transform.angle):new t.pointGeometry(0,0),i=r.getSymbolInstanceIconSize(p,this.transform.zoom,h);return this.collisionIndex.placeCollisionBox(i,e,n,_,c,s,f.predicate)};k&&k.box&&k.box.length&&w.verticalIconBox?(L=e(w.verticalIconBox),C=L.box.length>0):(L=e(w.iconBox),C=L.box.length>0),I=I&&L.offscreen}const U=m||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,N=g||0===e.numIconVertices;if(U||N?N?U||(C=C&&S):S=C&&S:C=S=C&&S,S&&P&&P.box&&this.collisionIndex.insertCollisionBox(P.box,o.get("text-ignore-placement"),r.bucketInstanceId,k&&k.box&&R?R:O,f.ID),C&&L&&this.collisionIndex.insertCollisionBox(L.box,o.get("icon-ignore-placement"),r.bucketInstanceId,z,f.ID),D&&(S&&this.collisionIndex.insertCollisionCircles(D.circles,o.get("text-ignore-placement"),r.bucketInstanceId,O,f.ID),i)){const t=r.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new fe);for(let n=0;n<D.circles.length;n+=4)e.circles.push(D.circles[n+0]),e.circles.push(D.circles[n+1]),e.circles.push(D.circles[n+2]),e.circles.push(D.collisionDetected?1:0)}this.placements[e.crossTileID]=new pe(S||T,C||A,I||r.justReloaded),n[e.crossTileID]=!0};if(w){const t=r.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const n=t[e];S(r.symbolInstances.get(n),n,r.collisionArrays[n])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)S(r.symbolInstances.get(t),t,r.collisionArrays[t]);if(i&&r.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[r.bucketInstanceId];t.invert(e.invProjMatrix,s),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}r.justReloaded=!1}markUsedJustification(e,n,i,r){let o;o=r===t.WritingMode.vertical?i.verticalPlacedTextSymbolIndex:{left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(n)];const s=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex];for(const t of s)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=o>=0&&t!==o?0:i.crossTileID)}markUsedOrientation(e,n,i){const r=n===t.WritingMode.horizontal||n===t.WritingMode.horizontalOnly?n:0,o=n===t.WritingMode.vertical?n:0,s=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex];for(const t of s)e.text.placedSymbolArray.get(t).placedOrientation=r;i.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let n=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const i=e?e.symbolFadeChange(t):1,r=e?e.opacities:{},o=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const a in this.placements){const t=this.placements[a],e=r[a];e?(this.opacities[a]=new de(e,i,t.text,t.icon),n=n||t.text!==e.text.placed||t.icon!==e.icon.placed):(this.opacities[a]=new de(null,i,t.text,t.icon,t.skipFade),n=n||t.text||t.icon)}for(const a in r){const t=r[a];if(!this.opacities[a]){const e=new de(t,i,!1,!1);e.isHidden()||(this.opacities[a]=e,n=n||t.text.placed||t.icon.placed)}}for(const a in o)this.variableOffsets[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.variableOffsets[a]=o[a]);for(const a in s)this.placedOrientations[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.placedOrientations[a]=s[a]);n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const n={};for(const i of e){const e=i.getBucket(t);e&&i.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,n,i.collisionBoxArray)}}updateBucketOpacities(e,n,i){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const r=e.layers[0].layout,o=new de(null,0,!1,!1,!0),s=r.get("text-allow-overlap"),a=r.get("icon-allow-overlap"),l=r.get("text-variable-anchor"),c="map"===r.get("text-rotation-alignment"),u="map"===r.get("text-pitch-alignment"),h="none"!==r.get("icon-text-fit"),d=new de(null,0,s&&(a||!e.hasIconData()||r.get("icon-optional")),a&&(s||!e.hasTextData()||r.get("text-optional")),!0);!e.collisionArrays&&i&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(i);const p=(t,e,n)=>{for(let i=0;i<e/4;i++)t.opacityVertexArray.emplaceBack(n)};for(let f=0;f<e.symbolInstances.length;f++){const i=e.symbolInstances.get(f),{numHorizontalGlyphVertices:r,numVerticalGlyphVertices:s,crossTileID:a}=i;let m=this.opacities[a];n[a]?m=o:m||(m=d,this.opacities[a]=m),n[a]=!0;const g=i.numIconVertices>0,y=this.placedOrientations[i.crossTileID],_=y===t.WritingMode.vertical,v=y===t.WritingMode.horizontal||y===t.WritingMode.horizontalOnly;if(r>0||s>0){const t=Ee(m.text);p(e.text,r,_?Me:t),p(e.text,s,v?Me:t);const n=m.text.isHidden();[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach(t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=n||_?1:0)}),i.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).hidden=n||v?1:0);const o=this.variableOffsets[i.crossTileID];o&&this.markUsedJustification(e,o.anchor,i,y);const a=this.placedOrientations[i.crossTileID];a&&(this.markUsedJustification(e,"left",i,a),this.markUsedOrientation(e,a,i))}if(g){const t=Ee(m.icon);i.placedIconSymbolIndex>=0&&(p(e.icon,i.numIconVertices,_?Me:t),e.icon.placedSymbolArray.get(i.placedIconSymbolIndex).hidden=m.icon.isHidden()),i.verticalPlacedIconSymbolIndex>=0&&(p(e.icon,i.numVerticalIconVertices,v?Me:t),e.icon.placedSymbolArray.get(i.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const n=e.collisionArrays[f];if(n){let i=new t.pointGeometry(0,0);if(n.textBox||n.verticalTextBox){let t=!0;if(l){const e=this.variableOffsets[a];e?(i=ye(e.anchor,e.width,e.height,e.textOffset,e.textScale),c&&i._rotate(u?this.transform.angle:-this.transform.angle)):t=!1}n.textBox&&xe(e.textCollisionBox.collisionVertexArray,m.text.placed,!t||_,i.x,i.y),n.verticalTextBox&&xe(e.textCollisionBox.collisionVertexArray,m.text.placed,!t||v,i.x,i.y)}const r=Boolean(!v&&n.verticalIconBox);n.iconBox&&xe(e.iconCollisionBox.collisionVertexArray,m.icon.placed,r,h?i.x:0,h?i.y:0),n.verticalIconBox&&xe(e.iconCollisionBox.collisionVertexArray,m.icon.placed,!r,h?i.x:0,h?i.y:0)}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const n=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*n>t}setStale(){this.stale=!0}}function xe(t,e,n,i,r){t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0)}const be=Math.pow(2,25),we=Math.pow(2,24),Te=Math.pow(2,17),Ae=Math.pow(2,16),Se=Math.pow(2,9),Ce=Math.pow(2,8),Ie=Math.pow(2,1);function Ee(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*be+e*we+n*Te+e*Ae+n*Se+e*Ce+n*Ie+e}const Me=0;class ke{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,n,i,r){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,i,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((t,e)=>t.sortKey-e.sortKey));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,r())return!0;return!1}}class Pe{constructor(t,e,n,i,r,o,s,a){this.placement=new ve(t,r,o,s,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(e,n,i){const r=t.exported.now(),o=()=>{const e=t.exported.now()-r;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const t=n[e[this._currentPlacementIndex]],r=this.placement.collisionIndex.transform.zoom;if("symbol"===t.type&&(!t.minzoom||t.minzoom<=r)&&(!t.maxzoom||t.maxzoom>r)){if(this._inProgressLayer||(this._inProgressLayer=new ke(t)),this._inProgressLayer.continuePlacement(i[t.source],this.placement,this._showCollisionBoxes,t,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const De=512/t.EXTENT/2;class Le{constructor(t,e,n){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(let i=0;i<e.length;i++){const n=e.get(i),r=n.key;this.indexedSymbolInstances[r]||(this.indexedSymbolInstances[r]=[]),this.indexedSymbolInstances[r].push({crossTileID:n.crossTileID,coord:this.getScaledCoordinates(n,t)})}}getScaledCoordinates(e,n){const i=De/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*t.EXTENT+e.anchorX)*i),y:Math.floor((n.canonical.y*t.EXTENT+e.anchorY)*i)}}findMatches(t,e,n){const i=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z);for(let r=0;r<t.length;r++){const o=t.get(r);if(o.crossTileID)continue;const s=this.indexedSymbolInstances[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,e);for(const t of s)if(Math.abs(t.coord.x-a.x)<=i&&Math.abs(t.coord.y-a.y)<=i&&!n[t.crossTileID]){n[t.crossTileID]=!0,o.crossTileID=t.crossTileID;break}}}}class Oe{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Re{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const n in this.indexes){const t=this.indexes[n],i={};for(const n in t){const r=t[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),i[r.tileID.key]=r}this.indexes[n]=i}this.lng=t}addBucket(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let r=0;r<e.symbolInstances.length;r++)e.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const i=this.usedCrossTileIDs[t.overscaledZ];for(const r in this.indexes){const n=this.indexes[r];if(Number(r)>t.overscaledZ)for(const r in n){const o=n[r];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,i)}else{const o=n[t.scaledTo(Number(r)).key];o&&o.findMatches(e.symbolInstances,t,i)}}for(let r=0;r<e.symbolInstances.length;r++){const t=e.symbolInstances.get(r);t.crossTileID||(t.crossTileID=n.generate(),i[t.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Le(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const n in e.indexedSymbolInstances)for(const i of e.indexedSymbolInstances[n])delete this.usedCrossTileIDs[t][i.crossTileID]}removeStaleBuckets(t){let e=!1;for(const n in this.indexes){const i=this.indexes[n];for(const r in i)t[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],e=!0)}return e}}class ze{constructor(){this.layerIndexes={},this.crossTileIDs=new Oe,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,n){let i=this.layerIndexes[t.id];void 0===i&&(i=this.layerIndexes[t.id]=new Re);let r=!1;const o={};i.handleWrapJump(n);for(const s of e){const e=s.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(s.tileID,e,this.crossTileIDs)&&(r=!0),o[e.bucketInstanceId]=!0)}return i.removeStaleBuckets(o)&&(r=!0),r}pruneUnusedLayers(t){const e={};t.forEach(t=>{e[t]=!0});for(const n in this.layerIndexes)e[n]||delete this.layerIndexes[n]}}const Ze=(e,n)=>t.emitValidationErrors(e,n&&n.filter(t=>"source.canvas"!==t.identifier)),Fe=t.pick(Ft,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),Ue=t.pick(Ft,["setCenter","setZoom","setBearing","setPitch"]),Ne=function(){const e={},n=t.spec.$version;for(const i in t.spec.$root){const r=t.spec.$root[i];if(r.required){let t=null;t="version"===i?n:"array"===r.type?[]:{},null!=t&&(e[i]=t)}}return e}(),Be={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class qe extends t.Evented{constructor(e,n={}){super(),this.map=e,this.dispatcher=new E(Rt(),this),this.imageManager=new g,this.imageManager.setEventedParent(this),this.glyphManager=new t.GlyphManager(e._requestManager,n.localFontFamily?t.LocalGlyphMode.all:n.localIdeographFontFamily?t.LocalGlyphMode.ideographs:t.LocalGlyphMode.none,n.localFontFamily||n.localIdeographFontFamily),this.lineAtlas=new t.LineAtlas(256,512),this.crossTileSymbolIndex=new ze,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());const i=this;this._rtlTextPluginCallback=qe.registerForPluginStateChange(e=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(e,n)=>{if(t.triggerPluginCompletionEvent(e),n&&n.every(t=>t))for(const t in i._sourceCaches){const e=i._sourceCaches[t],n=e.getSource().type;"vector"!==n&&"geojson"!==n||e.reload()}})}),this.on("data",t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.getSource(t.sourceId);if(e&&e.vectorLayerIds)for(const n in this._layers){const t=this._layers[n];t.source===e.id&&this._validateLayer(t)}})}loadURL(e,n={}){this.fire(new t.Event("dataloading",{dataType:"style"}));const i="boolean"==typeof n.validate?n.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken);const r=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(r,(e,n)=>{this._request=null,e?this.fire(new t.ErrorEvent(e)):n&&this._load(n,i)})}loadJSON(e,n={}){this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.exported.frame(()=>{this._request=null,this._load(e,!1!==n.validate)})}loadEmpty(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ne,!1)}_updateLayerCount(t,e){const n=e?1:-1;t.is3D()&&(this._num3DLayers+=n),"circle"===t.type&&(this._numCircleLayers+=n),"symbol"===t.type&&(this._numSymbolLayers+=n)}_load(e,n){if(n&&Ze(this,t.validateStyle(e)))return;this._loaded=!0,this.stylesheet=e;for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1});this._changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(e.glyphs);const i=Zt(this.stylesheet.layers);this._order=i.map(t=>t.id),this._layers={},this._serializedLayers={};for(let r of i)r=t.createStyleLayer(r),r.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=r,this._serializedLayers[r.id]=r.serialize(),this._updateLayerCount(r,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new v(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}_loadSprite(e){this._spriteRequest=function(e,n,i){let r,o,s;const a=t.exported.devicePixelRatio>1?"@2x":"";let l=t.getJSON(n.transformRequest(n.normalizeSpriteURL(e,a,".json"),t.ResourceType.SpriteJSON),(t,e)=>{l=null,s||(s=t,r=e,u())}),c=t.getImage(n.transformRequest(n.normalizeSpriteURL(e,a,".png"),t.ResourceType.SpriteImage),(t,e)=>{c=null,s||(s=t,o=e,u())});function u(){if(s)i(s);else if(r&&o){const e=t.exported.getImageData(o),n={};for(const i in r){const{width:o,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=r[i],f=new t.RGBAImage({width:o,height:s});t.RGBAImage.copy(e,f,{x:a,y:l},{x:0,y:0},{width:o,height:s}),n[i]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p}}i(null,n)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(e,this.map._requestManager,(e,n)=>{if(this._spriteRequest=null,e)this.fire(new t.ErrorEvent(e));else if(n)for(const t in n)this.imageManager.addImage(t,n[t]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new t.Event("data",{dataType:"style"}))})}_validateLayer(e){const n=this.getSource(e.source);if(!n)return;const i=e.sourceLayer;i&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire(new t.ErrorEvent(new Error(`Source layer "${i}" does not exist on source "${n.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const e=[];for(const n of t){const t=this._layers[n];"custom"!==t.type&&e.push(t.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&Be[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(e){if(!this._loaded)return;const n=this._changed;if(this._changed){const t=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);(t.length||n.length)&&this._updateWorkerLayers(t,n);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e)}this._updateTilesForChangedImages();for(const i in this._updatedPaintProps)this._layers[i].updateTransitions(e);this.light.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._resetUpdates()}const i={};for(const t in this._sourceCaches){const e=this._sourceCaches[t];i[t]=e.used,e.used=!1}for(const t of this._order){const n=this._layers[t];if(n.recalculate(e,this._availableImages),!n.isHidden(e.zoom)){const t=this._getLayerSourceCache(n);t&&(t.used=!0)}const i=this.map.painter;if(i){const t=n.getProgramIds();if(!t)continue;const r=n.getProgramConfiguration(e.zoom);for(const e of t)i.useProgram(e,r)}}for(const r in i){const e=this._sourceCaches[r];i[r]!==e.used&&e.getSource().fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:e.getSource().id}))}this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),n&&this.fire(new t.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this._sourceCaches)this._sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(e){if(this._checkLoaded(),Ze(this,t.validateStyle(e)))return!1;(e=t.clone$2(e)).layers=Zt(e.layers);const n=function(t,e){if(!t)return[{command:Ft.setStyle,args:[e]}];let n=[];try{if(!r(t.version,e.version))return[{command:Ft.setStyle,args:[e]}];r(t.center,e.center)||n.push({command:Ft.setCenter,args:[e.center]}),r(t.zoom,e.zoom)||n.push({command:Ft.setZoom,args:[e.zoom]}),r(t.bearing,e.bearing)||n.push({command:Ft.setBearing,args:[e.bearing]}),r(t.pitch,e.pitch)||n.push({command:Ft.setPitch,args:[e.pitch]}),r(t.sprite,e.sprite)||n.push({command:Ft.setSprite,args:[e.sprite]}),r(t.glyphs,e.glyphs)||n.push({command:Ft.setGlyphs,args:[e.glyphs]}),r(t.transition,e.transition)||n.push({command:Ft.setTransition,args:[e.transition]}),r(t.light,e.light)||n.push({command:Ft.setLight,args:[e.light]}),r(t.fog,e.fog)||n.push({command:Ft.setFog,args:[e.fog]});const i={},o=[];!function(t,e,n,i){let o;for(o in e=e||{},t=t||{})t.hasOwnProperty(o)&&(e.hasOwnProperty(o)||Nt(o,n,i));for(o in e)e.hasOwnProperty(o)&&(t.hasOwnProperty(o)?r(t[o],e[o])||("geojson"===t[o].type&&"geojson"===e[o].type&&qt(t,e,o)?n.push({command:Ft.setGeoJSONSourceData,args:[o,e[o].data]}):Bt(o,e,n,i)):Ut(o,e,n))}(t.sources,e.sources,o,i);const s=[];t.layers&&t.layers.forEach(t=>{i[t.source]?n.push({command:Ft.removeLayer,args:[t.id]}):s.push(t)});let a=t.terrain;a&&i[a.source]&&(n.push({command:Ft.setTerrain,args:[void 0]}),a=void 0),n=n.concat(o),r(a,e.terrain)||n.push({command:Ft.setTerrain,args:[e.terrain]}),function(t,e,n){e=e||[];const i=(t=t||[]).map(Vt),o=e.map(Vt),s=t.reduce(jt,{}),a=e.reduce(jt,{}),l=i.slice(),c=Object.create(null);let u,h,d,p,f,m,g;for(u=0,h=0;u<i.length;u++)d=i[u],a.hasOwnProperty(d)?h++:(n.push({command:Ft.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<o.length;u++)d=o[o.length-1-u],l[l.length-1-u]!==d&&(s.hasOwnProperty(d)?(n.push({command:Ft.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-u],n.push({command:Ft.addLayer,args:[a[d],m]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<o.length;u++)if(d=o[u],p=s[d],f=a[d],!c[d]&&!r(p,f))if(r(p.source,f.source)&&r(p["source-layer"],f["source-layer"])&&r(p.type,f.type)){for(g in $t(p.layout,f.layout,n,d,null,Ft.setLayoutProperty),$t(p.paint,f.paint,n,d,null,Ft.setPaintProperty),r(p.filter,f.filter)||n.push({command:Ft.setFilter,args:[d,f.filter]}),r(p.minzoom,f.minzoom)&&r(p.maxzoom,f.maxzoom)||n.push({command:Ft.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?$t(p[g],f[g],n,d,g.slice(6),Ft.setPaintProperty):r(p[g],f[g])||n.push({command:Ft.setLayerProperty,args:[d,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?$t(p[g],f[g],n,d,g.slice(6),Ft.setPaintProperty):r(p[g],f[g])||n.push({command:Ft.setLayerProperty,args:[d,g,f[g]]}))}else n.push({command:Ft.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],n.push({command:Ft.addLayer,args:[f,m]})}(s,e.layers,n)}catch(i){console.warn("Unable to compute style diff:",i),n=[{command:Ft.setStyle,args:[e]}]}return n}(this.serialize(),e).filter(t=>!(t.command in Ue));if(0===n.length)return!1;const i=n.filter(t=>!(t.command in Fe));if(i.length>0)throw new Error(`Unimplemented: ${i.map(t=>t.command).join(", ")}.`);return n.forEach(t=>{"setTransition"!==t.command&&this[t.command].apply(this,t.args)}),this.stylesheet=e,!0}addImage(e,n){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,i={}){if(this._checkLoaded(),void 0!==this.getSource(e))throw new Error("There is already a source with this ID");if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.validateStyle.source,`sources.${e}`,n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const r=Ct(e,n,this.dispatcher,this);r.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:r.serialize(),sourceId:e}));const o=n=>{const i=(n?"symbol:":"other:")+e,o=this._sourceCaches[i]=new t.SourceCache(i,r,n);(n?this._symbolSourceCaches:this._otherSourceCaches)[e]=o,o.style=this,o.onAdd(this.map)};o(!1),"vector"!==n.type&&"geojson"!==n.type||o(!0),r.onAdd&&r.onAdd(this.map),this._changed=!0}removeSource(e){this._checkLoaded();const n=this.getSource(e);if(void 0===n)throw new Error("There is no source with this ID");for(const r in this._layers)if(this._layers[r].source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${r}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const i=this._getSourceCaches(e);for(const r of i)delete this._sourceCaches[r.id],delete this._updatedSources[r.id],r.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:r.getSource().id})),r.setEventedParent(null),r.clearTiles();delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,e){this._checkLoaded(),this.getSource(t).setData(e),this._changed=!0}getSource(t){const e=this._getSourceCache(t);return e&&e.getSource()}addLayer(e,n,i={}){this._checkLoaded();const r=e.id;if(this.getLayer(r))return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${r}" already exists on this map`)));let o;if("custom"===e.type){if(Ze(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(r,e.source),e=t.clone$2(e),e=t.extend(e,{source:r})),this._validate(t.validateStyle.layer,`layers.${r}`,e,{arrayIndex:-1},i))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[o.id]=o.serialize(),this._updateLayerCount(o,!0)}const s=n?this._order.indexOf(n):this._order.length;if(n&&-1===s)return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${n}" does not exist on this map.`)));this._order.splice(s,0,r),this._layerOrderChanged=!0,this._layers[r]=o;const a=this._getLayerSourceCache(o);if(this._removedLayers[r]&&o.source&&a&&"custom"!==o.type){const t=this._removedLayers[r];delete this._removedLayers[r],t.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const i=this._order.indexOf(e);this._order.splice(i,1);const r=n?this._order.indexOf(n):this._order.length;n&&-1===r?this.fire(new t.ErrorEvent(new Error(`Layer with id "${n}" does not exist on this map.`))):(this._order.splice(r,0,e),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be removed.`)));n.setEventedParent(null),this._updateLayerCount(n,!1);const i=this._order.indexOf(e);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const e in this._layers)if(this._layers[e].type===t)return!0;return!1}setLayerZoomRange(e,n,i){this._checkLoaded();const r=this.getLayer(e);r?r.minzoom===n&&r.maxzoom===i||(null!=n&&(r.minzoom=n),null!=i&&(r.maxzoom=i),this._updateLayer(r)):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(e,n,i={}){this._checkLoaded();const o=this.getLayer(e);if(o){if(!r(o.filter,n))return null==n?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(t.validateStyle.filter,`layers.${o.id}.filter`,n,null,i)||(o.filter=t.clone$2(n),this._updateLayer(o)))}else this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be filtered.`)))}getFilter(e){return t.clone$2(this.getLayer(e).filter)}setLayoutProperty(e,n,i,o={}){this._checkLoaded();const s=this.getLayer(e);s?r(s.getLayoutProperty(n),i)||(s.setLayoutProperty(n,i,o),this._updateLayer(s)):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(e,n){const i=this.getLayer(e);if(i)return i.getLayoutProperty(n);this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style.`)))}setPaintProperty(e,n,i,o={}){this._checkLoaded();const s=this.getLayer(e);s?r(s.getPaintProperty(n),i)||(s.setPaintProperty(n,i,o)&&this._updateLayer(s),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,e){return this.getLayer(t).getPaintProperty(e)}setFeatureState(e,n){this._checkLoaded();const i=e.source,r=e.sourceLayer,o=this.getSource(i);if(void 0===o)return void this.fire(new t.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)));const s=o.type;if("geojson"===s&&r)return void this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!r)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided.")));const a=this._getSourceCaches(i);for(const t of a)t.setFeatureState(r,e.id,n)}removeFeatureState(e,n){this._checkLoaded();const i=e.source,r=this.getSource(i);if(void 0===r)return void this.fire(new t.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)));const o=r.type,s="vector"===o?e.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const a=this._getSourceCaches(i);for(const t of a)t.removeFeatureState(s,e.id,n)}getFeatureState(e){this._checkLoaded();const n=e.source,i=e.sourceLayer,r=this.getSource(n);if(void 0!==r){if("vector"!==r.type||i)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(n)[0].getFeatureState(i,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const e={};for(const t in this._sourceCaches){const n=this._sourceCaches[t].getSource();e[n.id]||(e[n.id]=n.serialize())}return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:e,layers:this._serializeLayers(this._order)},t=>void 0!==t)}_updateLayer(t){this._updatedLayers[t.id]=!0;const e=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&e&&"raster"!==e.getSource().type&&(this._updatedSources[t.source]="reload",e.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,n={},i=[];for(let o=this._order.length-1;o>=0;o--){const r=this._order[o];if(e(r)){n[r]=o;for(const e of t){const t=e[r];if(t)for(const e of t)i.push(e)}}}i.sort((t,e)=>e.intersectionZ-t.intersectionZ);const r=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(e(s))for(let t=i.length-1;t>=0;t--){const e=i[t].feature;if(n[e.layer.id]<o)break;r.push(e),i.pop()}else for(const e of t){const t=e[s];if(t)for(const e of t)r.push(e.feature)}}return r}queryRenderedFeatures(e,n,i){n&&n.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);const r={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const e of n.layers){const n=this._layers[e];if(!n)return this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];r[n.source]=!0}}const o=[];n.availableImages=this._availableImages;const s=n&&n.layers?n.layers.some(t=>{const e=this.getLayer(t);return e&&e.is3D()}):this.has3DLayers(),a=k.createFromScreenPoints(e,i);for(const t in this._sourceCaches){const e=this._sourceCaches[t].getSource().id;n.layers&&!r[e]||o.push(Et(this._sourceCaches[t],this._layers,this._serializedLayers,a,n,i,s,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(t,e,n,i,r,o,s){const a={},l=o.queryRenderedSymbols(i),c=[];for(const u of Object.keys(l).map(Number))c.push(s[u]);c.sort(kt);for(const u of c){const n=u.featureIndex.lookupSymbolFeatures(l[u.bucketInstanceId],e,u.bucketIndex,u.sourceLayerIndex,r.filter,r.layers,r.availableImages,t);for(const t in n){const e=a[t]=a[t]||[],i=n[t];i.sort((t,e)=>{const n=u.featureSortOrder;if(n){const i=n.indexOf(t.featureIndex);return n.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex});for(const t of i)e.push(t)}}for(const u in a)a[u].forEach(e=>{const i=e.feature,r=n(t[u]).getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=r});return a}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),a.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,n){n&&n.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);const i=this._getSourceCaches(e);let r=[];for(const t of i)r=r.concat(Mt(t,n));return r}addSourceType(t,e,n){return qe.getSourceType(t)?n(new Error(`A source type called "${t}" already exists.`)):(qe.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},n):n(null,null))}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const i=this.light.getLight();let o=!1;for(const t in e)if(!r(e[t],i[t])){o=!0;break}if(!o)return;const s={now:t.exported.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(s)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(e){if(this._checkLoaded(),!e)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof e.source){const n="terrain-dem-src";this.addSource(n,e.source),e=t.clone$2(e),e=t.extend(e,{source:n})}if(!this._validate(t.validateStyle.terrain,"terrain",e)){if(this.terrain){const n=this.terrain,i=n.get();for(const o in e)if(!r(e[o],i[o])){n.set(e),this.stylesheet.terrain=e;const i={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(i);break}}else this._createTerrain(e);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(e){const n=this.fog=new I(e);this.stylesheet.fog=e;const i={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog,i=n.get();for(const o in e)if(!r(e[o],i[o])){n.set(e),this.stylesheet.fog=e;const i={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(i);break}}else this._createFog(e);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(t=>this.isLayerDraped(this._layers[t])),e=this._order.filter(t=>!this.isLayerDraped(this._layers[t]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...e)}_createTerrain(e){const n=this.terrain=new w(e);this.stylesheet.terrain=e,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const i={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(i)}_force3DLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_validate(e,n,i,r,o={}){return(!o||!1!==o.validate)&&Ze(this,e.call(t.validateStyle,t.extend({key:n,style:this.serialize(),value:i,styleSpec:t.spec},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const e=this._getSourceCaches(t);for(const n of e)n.clearTiles()}_reloadSource(t){const e=this._getSourceCaches(t);for(const n of e)n.resume(),n.reload()}_updateSources(t){for(const e in this._sourceCaches)this._sourceCaches[e].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(e,n,i,r,o=!1){let s=!1,a=!1;const l={};for(const t of this._order){const n=this._layers[t];if("symbol"!==n.type)continue;if(!l[n.source]){const t=this._getLayerSourceCache(n);if(!t)continue;l[n.source]=t.getRenderableIds(!0).map(e=>t.getTileByID(e)).sort((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1))}const i=this.crossTileSymbolIndex.addLayer(n,l[n.source],e.center.lng);s=s||i}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),o=o||this._layerOrderChanged||0===i,this._layerOrderChanged&&this.fire(new t.Event("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.exported.now(),e.zoom))&&(this.pauseablePlacement=new Pe(e,this._order,o,n,i,r,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.exported.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const t of this._order){const e=this._layers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,l[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,e,n){this.imageManager.getImages(e.icons,n),this._updateTilesForChangedImages();const i=t=>{t&&t.setDependencies(e.tileID.key,e.type,e.icons)};i(this._otherSourceCaches[e.source]),i(this._symbolSourceCaches[e.source])}getGlyphs(t,e,n){this.glyphManager.getGlyphs(e.stacks,n)}getResource(e,n,i){return t.makeRequest(n,i)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const e=[];return this._otherSourceCaches[t]&&e.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&e.push(this._symbolSourceCaches[t]),e}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}qe.getSourceType=function(t){return St[t]},qe.setSourceType=function(t,e){St[t]=e},qe.registerForPluginStateChange=t.registerForPluginStateChange;var $e="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Ve="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let je={},Ge={};je=We("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Ge=We("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Ye=We("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),He=$e;var Je={background:We("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:We("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:We("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:We("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:We("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:We("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:We("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=u_matrix*vec4(a_pos,elevation(a_pos),1.0);gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:We("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:We("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:We("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:We("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:We("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:We("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:We("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);gl_Position=u_matrix*vec4(pos,1);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:We("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);\n#else\nvec3 p=vec3(pos_nx.xy,z);gl_Position=u_matrix*vec4(p,1);\n#endif\nvec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:We("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:We("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:We("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),lineGradient:We("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:We("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),lineSDF:We("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dash_from\n#pragma mapbox: initialize mediump vec4 dash_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);vec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dash_from\n#pragma mapbox: initialize mediump vec4 dash_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);v_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:We("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:We("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),symbolSDF:We("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:We("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrainRaster:We("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:We("#ifdef GL_ES\nprecision highp float;\n#endif\nvec4 pack_depth(float ndc_z) {float depth=ndc_z*0.5+0.5;const vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:We("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ve),skyboxGradient:We("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ve),skyboxCapture:We("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}")};function We(t,e,n){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,o=e.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),s=t.match(r),a=e.match(r),l=$e.match(r);let c=a?a.concat(s):s;n||(je.staticUniforms&&(c=je.staticUniforms.concat(c)),Ge.staticUniforms&&(c=Ge.staticUniforms.concat(c))),c&&(c=c.concat(l));const u={};return{fragmentSource:t=t.replace(i,(t,e,n,i,r)=>(u[r]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nvarying ${n} ${i} ${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = u_${r};\n#endif\n`)),vertexSource:e=e.replace(i,(t,e,n,i,r)=>{const o="float"===i?"vec2":"vec4",s=r.match(/color/)?"color":o;return u[r]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${n} ${o} a_${r};\nvarying ${n} ${i} ${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${n} ${o} a_${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = a_${r};\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`}),staticAttributes:o,staticUniforms:c}}class Xe{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,n,i,r,o,s,a){this.context=t;let l=this.boundPaintVertexBuffers.length!==i.length;for(let c=0;!l&&c<i.length;c++)this.boundPaintVertexBuffers[c]!==i[c]&&(l=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===n&&!l&&this.boundIndexBuffer===r&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===s&&this.boundDynamicVertexBuffer2===a?(t.bindVertexArrayOES.set(this.vao),s&&s.bind(),r&&r.dynamicDraw&&r.bind(),a&&a.bind()):this.freshBind(e,n,i,r,o,s,a)}freshBind(t,e,n,i,r,o,s){let a;const l=t.numAttributes,c=this.context,u=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),a=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s;else{a=c.currentNumAttributes||0;for(let t=l;t<a;t++)u.disableVertexAttribArray(t)}e.enableAttributes(u,t);for(const h of n)h.enableAttributes(u,t);o&&o.enableAttributes(u,t),s&&s.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,r);for(const h of n)h.bind(),h.setVertexAttribPointers(u,t,r);o&&(o.bind(),o.setVertexAttribPointers(u,t,r)),i&&i.bind(),s&&(s.bind(),s.setVertexAttribPointers(u,t,r)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Qe(e,n){const i=Math.pow(2,n.canonical.z),r=n.canonical.y;return[new t.MercatorCoordinate(0,r/i).toLngLat().lat,new t.MercatorCoordinate(0,(r+1)/i).toLngLat().lat]}function Ke(e,n,i,r,o,s,a){const l=e.context,c=l.gl,u=i.fbo;if(!u)return;e.prepareDrawTile(n);const h=e.useProgram("hillshade");l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const d=((t,e,n,i)=>{const r=n.paint.get("hillshade-shadow-color"),o=n.paint.get("hillshade-highlight-color"),s=n.paint.get("hillshade-accent-color");let a=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);const l=!t.options.moving;return{u_matrix:i||t.transform.calculateProjMatrix(e.tileID.toUnwrapped(),l),u_image:0,u_latrange:Qe(0,e.tileID),u_light:[n.paint.get("hillshade-exaggeration"),a],u_shadow:r,u_highlight:o,u_accent:s}})(e,i,r,e.terrain?n.projMatrix:null);e.prepareDrawProgram(l,h,n.toUnwrapped()),h.draw(l,c.TRIANGLES,o,s,a,t.CullFaceMode.disabled,d,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}function tn(e,n,i){if(!n.needsDEMTextureUpload)return;const r=e.context,o=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||e.getTileTexture(i.stride);const s=i.getPixels();n.demTexture?n.demTexture.update(s,{premultiply:!1}):n.demTexture=new t.Texture(r,s,o.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function en(e,n,i,r,o,s){const a=e.context,l=a.gl;if(!n.dem)return;const c=n.dem;if(a.activeTexture.set(l.TEXTURE1),tn(e,n,c),!n.demTexture)return;n.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const u=c.dim;a.activeTexture.set(l.TEXTURE0);let h=n.fbo;if(!h){const e=new t.Texture(a,{width:u,height:u,data:null},l.RGBA);e.bind(l.LINEAR,l.CLAMP_TO_EDGE),h=n.fbo=a.createFramebuffer(u,u,!0),h.colorAttachment.set(e.texture)}a.bindFramebuffer.set(h.framebuffer),a.viewport.set([0,0,u,u]),e.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,r,o,s,t.CullFaceMode.disabled,((e,n)=>{const i=n.stride,r=t.create$1();return t.ortho(r,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(r,r,[0,-t.EXTENT,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:e.overscaledZ,u_unpack:n.unpackVector}})(n.tileID,c),i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),n.needsHillshadePrepare=!1}const nn=(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image0:new t.Uniform1i(e,n.u_image0),u_skirt_height:new t.Uniform1f(e,n.u_skirt_height)}),rn=(t,e)=>({u_matrix:t,u_image0:0,u_skirt_height:e}),on=new class{constructor(){this.operations={}}newMorphing(t,e,n,i,r){if(t in this.operations){const e=this.operations[t];e.to.tileID.key!==n.tileID.key&&(e.queued=n)}else this.operations[t]={startTime:i,phase:0,duration:r,from:e,to:n,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const n=this.operations[e];for(n.phase=(t-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},sn={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function an(t,e){const n=1<<t.z;return!e&&(0===t.x||t.x===n-1)||0===t.y||t.y===n-1}const ln=t=>({u_matrix:t});function cn(e,n,i,r,o){if(o>0){const s=t.exported.now(),a=(s-e.timeAdded)/o,l=n?(s-n.timeAdded)/o:-1,c=i.getSource(),u=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!n||Math.abs(n.tileID.overscaledZ-u)>Math.abs(e.tileID.overscaledZ-u),d=h&&e.refreshedUponExpiration?1:t.clamp(h?a:1-l,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class un extends t.SourceCache{constructor(t){const e=Ct("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new E(Rt(),null),t.style);super("proxy",e,!1),e.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,n,i){if(e.freezeTileCoverage)return;this.transform=e;const r=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((n,i)=>{if(n[i.key]="",!this._tiles[i.key]){const n=new t.Tile(i,this._source.tileSize*i.overscaleFactor(),e.tileZoom);n.state="loaded",this._tiles[i.key]=n}return n},{});for(const t in this._tiles)t in r||(this.freeFBO(t),this._tiles[t].state="unloaded",delete this._tiles[t])}freeFBO(t){const e=this.proxyCachedFBO[t];if(void 0!==e){const n=Object.values(e);this.renderCachePool.push(...n),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class hn extends t.OverscaledTileID{constructor(t,e,n){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=e,this.projMatrix=n}}class dn extends t.Elevation{constructor(e,n){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[i,r,o]=function(e){const n=new t.StructArrayLayout4i8,i=new t.StructArrayLayout3ui6;n.reserve(17161),i.reserve(33800);const r=t.EXTENT/128,o=t.EXTENT+r/2,s=o+r;for(let l=-r;l<s;l+=r)for(let e=-r;e<s;e+=r){const i=e<0||e>o||l<0||l>o?24575:0,r=t.clamp(Math.round(e),0,t.EXTENT),s=t.clamp(Math.round(l),0,t.EXTENT);n.emplaceBack(r+i,s,r,s)}const a=(t,e)=>{const n=131*e+t;i.emplaceBack(n+1,n,n+131),i.emplaceBack(n+131,n+131+1,n+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)a(e,t);return[0,129].forEach(t=>{for(let e=0;e<130;e++)a(e,t),a(t,e)}),[n,i,32768]}(),s=e.context;this.gridBuffer=s.createVertexBuffer(i,Tt.members),this.gridIndexBuffer=s.createIndexBuffer(r),this.gridSegments=t.SegmentVector.simpleSegment(0,0,i.length,r.length),this.gridNoSkirtSegments=t.SegmentVector.simpleSegment(0,0,i.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new un(n.map),this.orthoMatrix=t.create$1(),t.ortho(this.orthoMatrix,0,t.EXTENT,0,t.EXTENT,0,1);const a=s.gl;this._overlapStencilMode=new t.StencilMode({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(e,n,i){if(e&&e.terrain){this._style!==e&&(this.style=e),this.enabled=!0;const r=e.terrain.properties;this.sourceCache=e._getSourceCache(r.get("source")),this._exaggeration=r.get("exaggeration");const o=()=>{this.sourceCache.used&&t.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const e=this.sourceCache.getSource().tileSize/128,i=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(n,e*i,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,o(),this._initializing=!0),o(),n.updateElevation(!i),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const e=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==e.efficiency&&t.warnOnce(`Terrain render cache efficiency is not optimal (${e.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${e.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=0===i._centerAltitude&&-1===this.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(i.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.proxyCoords=n.getIds().map(t=>{const e=n.getTileByID(t).tileID;return e.projMatrix=i.calculateProjMatrix(e.toUnwrapped()),e});(function(e,n){const i=n.transform.pointCoordinate(n.transform.getCameraPoint()),r=new t.pointGeometry(i.x,i.y);e.sort((e,n)=>{if(n.overscaledZ-e.overscaledZ)return n.overscaledZ-e.overscaledZ;const i=new t.pointGeometry(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),o=new t.pointGeometry(n.canonical.x+(1<<n.canonical.z)*n.wrap,n.canonical.y),s=r.mult(1<<e.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(i)-s.distSqr(o)})})(r,this.painter),this._previousZoom=i.zoom;const o=this.proxyToSource||{};this.proxyToSource={},r.forEach(t=>{this.proxyToSource[t.key]={}}),this.terrainTileForTile={};const s=this._style._sourceCaches;for(const t in s){const n=s[t];if(!n.used||(n!==this.sourceCache&&(this._findCoveringTileCache[n.id]={}),this._setupProxiedCoordsForOrtho(n,e[t],o),n.usedForTerrain))continue;const i=e[t];n.getSource().reparseOverscaled&&this._assignTerrainTiles(i)}this.proxiedCoords[n.id]=r.map(t=>new hn(t,t.key,this.orthoMatrix)),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1,this._updateTimestamp=t.exported.now();const a={};this._visibleDemTiles=[];for(const t of this.proxyCoords){const e=this.terrainTileForTile[t.key];if(!e)continue;const n=e.tileID.key;n in a||(this._visibleDemTiles.push(e),a[n]=n)}}_assignTerrainTiles(t){this._initializing||t.forEach(t=>{if(this.terrainTileForTile[t.key])return;const e=this._findTileCoveringTileID(t,this.sourceCache);e&&(this.terrainTileForTile[t.key]=e)})}_prepareDEMTextures(){const t=this.painter.context,e=t.gl;for(const n in this.terrainTileForTile){const i=this.terrainTileForTile[n],r=i.dem;!r||i.demTexture&&!i.needsDEMTextureUpload||(t.activeTexture.set(e.TEXTURE1),tn(this.painter,i,r))}}_prepareDemTileUniforms(t,e,n,i){if(!e||null==e.demTexture)return!1;const r=t.tileID.canonical,o=Math.pow(2,e.tileID.canonical.z-r.z),s=i||"";return n[`u_dem_tl${s}`]=[r.x*o%1,r.y*o%1],n[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let t=0;const e=this._visibleDemTiles.reduce((e,n)=>{if(!n.dem)return e;const i=n.dem.tree.minimums[0];return i>0&&t++,e+i},0);return t?e/t:0}_updateEmptyDEMTexture(){const e=this.painter.context,n=e.gl;e.activeTexture.set(n.TEXTURE2);const i=this._getLoadedAreaMinimum(),r={width:1,height:1,data:new Uint8Array(t.DEMData.pack(i,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(r,{premultiply:!1}):o=this._emptyDEMTexture=new t.Texture(e,r,n.RGBA,{premultiply:!1}),o}setupElevationDraw(e,n,i){const r=this.painter.context,o=r.gl,s=(a=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:t.DEMData.getUnpackVector(a),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var a;s.u_dem_size=this.sourceCache.getSource().tileSize,s.u_exaggeration=this.exaggeration();let l=null,c=null,u=1;if(i&&i.morphing&&this._useVertexMorphing){const t=i.morphing.srcDemTile,n=i.morphing.dstDemTile;u=i.morphing.phase,t&&n&&(this._prepareDemTileUniforms(e,t,s,"_prev")&&(c=t),this._prepareDemTileUniforms(e,n,s)&&(l=n))}if(c&&l?(r.activeTexture.set(o.TEXTURE2),l.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),r.activeTexture.set(o.TEXTURE4),c.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),s.u_dem_lerp=u):(l=this.terrainTileForTile[e.tileID.key],r.activeTexture.set(o.TEXTURE2),(this._prepareDemTileUniforms(e,l,s)?l.demTexture:this.emptyDEMTexture).bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST)),i&&i.useDepthForOcclusion&&(r.activeTexture.set(o.TEXTURE3),this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),i&&i.useMeterToDem&&l){const e=(1<<l.tileID.canonical.z)*t.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=e}i&&i.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),n.setTerrainUniformValues(r,s)}renderToBackBuffer(e){const n=this.painter,i=this.painter.context;0!==e.length&&(i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),this.renderingToTexture=!1,function(e,n,i,r,o){const s=e.context,a=s.gl;let l,c;const u=e.options.showTerrainWireframe?2:0,h=(t,n)=>{if(c===t)return;const i=[sn[t]];n&&i.push(sn[u]),l=e.useProgram("terrainRaster",null,i),c=t},d=e.colorModeForRenderPass(),p=new t.DepthMode(a.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);on.update(o);const f=e.transform,m=6*Math.pow(1.5,22-f.zoom)*n.exaggeration();(u?[!1,!0]:[!1]).forEach(u=>{c=-1;const g=u?a.LINES:a.TRIANGLES,[y,_]=u?n.getWirefameBuffer():[n.gridIndexBuffer,n.gridSegments];for(const c of r){const r=i.getTile(c),b=t.StencilMode.disabled,w=n.prevTerrainTileForTile[c.key],T=n.terrainTileForTile[c.key];x=T,null!=(v=w)&&null!=x&&v.hasData()&&x.hasData()&&null!=v.demTexture&&null!=x.demTexture&&v.tileID.key!==x.tileID.key&&on.newMorphing(c.key,w,T,o,250),s.activeTexture.set(a.TEXTURE0),r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);const A=on.getMorphValuesForProxy(c.key),S=A?1:0;let C;A&&(C={morphing:{srcDemTile:A.from,dstDemTile:A.to,phase:t.easeCubicInOut(A.phase)}});const I=rn(c.projMatrix,an(c.canonical,f.renderWorldCopies)?m/10:m);h(S,u),n.setupElevationDraw(r,l,C),e.prepareDrawProgram(s,l,c.toUnwrapped()),l.draw(s,g,p,b,d,t.CullFaceMode.backCCW,I,"terrain_raster",n.gridBuffer,y,_)}var v,x})}(n,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const n=this.painter,i=this.painter.context,r=this.proxySourceCache,o=this.proxiedCoords[r.id],s=this._drapedRenderBatches.shift(),a=[],l=n.style.order;let c=0;for(const u of o){const o=r.getTileByID(u.proxyTileKey),h=r.proxyCachedFBO[u.key]?r.proxyCachedFBO[u.key][e]:void 0,d=void 0!==h?r.renderCache[h]:this.pool[c++],p=void 0!==h;if(o.texture=d.tex,p&&!d.dirty){a.push(o.tileID);continue}let f;i.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(i.clear({color:t.Color.transparent}),d.dirty=!1);for(let t=s.start;t<=s.end;++t){const e=n.style._layers[l[t]];if(e.isHidden(n.transform.zoom))continue;const r=n.style._getLayerSourceCache(e),o=r?this.proxyToSource[u.key][r.id]:[u];if(!o)continue;const s=o;i.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(r?r.id:null)&&(this._setupStencil(d,o,e,r),f=r?r.id:null),n.renderLayer(n,r,e,s)}this.renderedToTile?(d.dirty=!0,a.push(o.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(a))}return this.renderToBackBuffer(a),this.renderingToTexture=!1,i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),s.end+1}postRender(){}renderCacheEfficiency(t){const e=t.order.length;if(0===e)return{efficiency:100};let n,i=0,r=0,o=!1;for(let s=0;s<e;++s){const e=t._layers[t.order[s]];this._style.isLayerDraped(e)?(o&&++i,++r):o||(o=!0,n=e.id)}return 0===r?{efficiency:100}:{efficiency:100*(1-i/r),firstUndrapedLayer:n}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(t=>t.dem).forEach(e=>{t=Math.min(t,e.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,e,n){if(!this._visibleDemTiles)return null;const i=this._visibleDemTiles.filter(t=>t.dem).map(i=>{const r=i.tileID,o=Math.pow(2,r.overscaledZ),{x:s,y:a}=r.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:i.dem.tree.raycastRoot(l,u,c,h,t,e,n),tile:i}});i.sort((t,e)=>(null!==t.t?t.t:Number.MAX_VALUE)-(null!==e.t?e.t:Number.MAX_VALUE));for(const r of i){if(null==r.t)return null;const i=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,t,e,n);if(null!=i)return i}return null}_createFBO(){const e=this.painter.context,n=e.gl,i=this.drapeBufferSize;e.activeTexture.set(n.TEXTURE0);const r=new t.Texture(e,{width:i[0],height:i[1],data:null},n.RGBA);r.bind(n.LINEAR,n.CLAMP_TO_EDGE);const o=e.createFramebuffer(i[0],i[1],!1);return o.colorAttachment.set(r.texture),o.depthAttachment=new _t(e,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&n.texParameterf(n.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:o,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const e=this._style._layers[t],n=e.isHidden(this.painter.transform.zoom),i=e.getCrossfadeParameters(),r=!!i&&1!==i.t,o=e.hasTransition();return"custom"!==e.type&&!n&&(r||o)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e]._source instanceof bt){t=!0;break}if(t)for(let e=0;e<this._style.order.length;++e){const t=this._style._layers[this._style.order[e]],n=t.isHidden(this.painter.transform.zoom),i=this._style._getLayerSourceCache(t);if("raster"!==t.type||n||!i)continue;const r=t.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][i.id];if(t)for(const e of t){const t=cn(i.getTile(e),i.findLoadedParent(e,0),i,this.painter.transform,r);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(i.id,e)}}}}_setupDrapedRenderBatches(){const t=this._style.order,e=t.length;if(0===e)return;const n=[];let i,r=0,o=this._style._layers[t[r]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++r<e;)o=this._style._layers[t[r]];for(;r<e;++r){const e=this._style._layers[t[r]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===i&&(i=r):void 0!==i&&(n.push({start:i,end:r-1}),i=void 0))}void 0!==i&&n.push({start:i,end:r-1}),this._drapedRenderBatches=n}_setupRenderCache(t){const e=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,e.renderCache.length>e.renderCachePool.length){const t=Object.values(e.proxyCachedFBO);e.proxyCachedFBO={};for(let n=0;n<t.length;++n){const i=Object.values(t[n]);e.renderCachePool.push(...i)}}return}this._clearRasterFadeFromRenderCache();const n=this.proxyCoords,i=this._tilesDirty;for(let o=n.length-1;o>=0;o--){const r=n[o];if(e.getTileByID(r.key),void 0!==e.proxyCachedFBO[r.key]){const n=t[r.key],o=this.proxyToSource[r.key];let s=0;for(const t in o){const e=o[t],r=n[t];if(!r||r.length!==e.length||e.some((e,n)=>e!==r[n]||i[t]&&i[t].hasOwnProperty(e.key))){s=-1;break}++s}for(const t in e.proxyCachedFBO[r.key])e.renderCache[e.proxyCachedFBO[r.key][t]].dirty=s<0||s!==Object.values(n).length}}const r=[...this._drapedRenderBatches];r.sort((t,e)=>e.end-e.start-(t.end-t.start));for(const o of r)for(const t of n){if(e.proxyCachedFBO[t.key])continue;let n=e.renderCachePool.pop();void 0===n&&e.renderCache.length<50&&(n=e.renderCache.length,e.renderCache.push(this._createFBO())),void 0!==n&&(e.proxyCachedFBO[t.key]={},e.proxyCachedFBO[t.key][o.start]=n,e.renderCache[n].dirty=!0)}this._tilesDirty={}}_setupStencil(t,e,n,i){if(!i||!this._sourceTilesOverlap[i.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const r=this.painter.context,o=r.gl;if(e.length<=1)return void(this._overlapStencilType=!1);let s;if(n.isTileClipped())s=e.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(e[0].overscaledZ>e[e.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,n.isTileClipped()&&this._renderTileClippingMasks(e,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):t.StencilMode.disabled}_renderTileClippingMasks(e,n){const i=this.painter,r=this.painter.context,o=r.gl;i._tileClippingMaskIDs={},r.setColorMode(t.ColorMode.disabled),r.setDepthMode(t.DepthMode.disabled);const s=i.useProgram("clippingMask");for(const a of e){const e=i._tileClippingMaskIDs[a.key]=--n;s.draw(r,o.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:o.ALWAYS,mask:0},e,255,o.KEEP,o.KEEP,o.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,ln(a.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(e){const n=this.painter.transform;if(e.x<0||e.x>n.width||e.y<0||e.y>n.height)return null;const i=[e.x,e.y,1,1];t.transformMat4(i,i,n.pixelMatrixInverse),t.scale$2(i,i,1/i[3]),i[0]/=n.worldSize,i[1]/=n.worldSize;const r=n._camera.position,o=t.mercatorZfromAltitude(1,n.center.lat),s=[r[0],r[1],r[2]/o,0],a=t.subtract([],i.slice(0,3),s);t.normalize(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(t.scaleAndAdd(s,s,a,l),s[3]=s[2],s[2]*=o,s):null}drawDepth(){const e=this.painter,n=e.context,i=this.proxySourceCache,r=Math.ceil(e.width),o=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===o||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const e=n.gl,i=n.createFramebuffer(r,o,!0);n.activeTexture.set(e.TEXTURE0);const s=new t.Texture(n,{width:r,height:o,data:null},e.RGBA);s.bind(e.NEAREST,e.CLAMP_TO_EDGE),i.colorAttachment.set(s.texture);const a=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,r,o);i.depthAttachment.set(a),this._depthFBO=i,this._depthTexture=s}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,r,o]),function(e,n,i,r){const o=e.context,s=o.gl;o.clear({depth:1});const a=e.useProgram("terrainDepth"),l=new t.DepthMode(s.LESS,t.DepthMode.ReadWrite,e.depthRangeFor3D);for(const c of r){const e=i.getTile(c),r=rn(c.projMatrix,0);n.setupElevationDraw(e,a),a.draw(o,s.TRIANGLES,l,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.backCCW,r,"terrain_depth",n.gridBuffer,n.gridIndexBuffer,n.gridNoSkirtSegments)}}(e,this,i,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,e,n){if(t.getSource()instanceof At)return this._setupProxiedCoordsForImageSource(t,e,n);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const i=this.proxiedCoords[t.id]=[],r=this.proxyCoords;for(let s=0;s<r.length;s++){const e=r[s],o=this._findTileCoveringTileID(e,t);if(o){const r=this._createProxiedId(e,o,n[e.key]&&n[e.key][t.id]);i.push(r),this.proxyToSource[e.key][t.id]=[r]}}let o=!1;for(let s=0;s<e.length;s++){const r=t.getTile(e[s]);if(!r||!r.hasData())continue;const a=this._findTileCoveringTileID(r.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==r.tileID.canonical.z){const e=this.proxyToSource[a.tileID.key][t.id],s=this._createProxiedId(a.tileID,r,n[a.tileID.key]&&n[a.tileID.key][t.id]);e?e.splice(e.length-1,0,s):this.proxyToSource[a.tileID.key][t.id]=[s],i.push(s),o=!0}}this._sourceTilesOverlap[t.id]=o}_setupProxiedCoordsForImageSource(e,n,i){if(!e.getSource().loaded())return;const r=this.proxiedCoords[e.id]=[],o=this.proxyCoords,s=e.getSource(),a=new t.pointGeometry(s.tileID.x,s.tileID.y)._div(1<<s.tileID.z),l=s.coordinates.map(t.MercatorCoordinate.fromLngLat).reduce((t,e)=>(t.min.x=Math.min(t.min.x,e.x-a.x),t.min.y=Math.min(t.min.y,e.y-a.y),t.max.x=Math.max(t.max.x,e.x-a.x),t.max.y=Math.max(t.max.y,e.y-a.y),t),{min:new t.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(e,n)=>{const i=e.wrap+e.canonical.x/(1<<e.canonical.z),r=e.canonical.y/(1<<e.canonical.z),o=t.EXTENT/(1<<e.canonical.z),s=n.wrap+n.canonical.x/(1<<n.canonical.z),a=n.canonical.y/(1<<n.canonical.z);return i+o<s+l.min.x||i>s+l.max.x||r+o<a+l.min.y||r>a+l.max.y};for(let t=0;t<o.length;t++){const s=o[t];for(let t=0;t<n.length;t++){const o=e.getTile(n[t]);if(!o||!o.hasData()||c(s,o.tileID))continue;const a=this._createProxiedId(s,o,i[s.key]&&i[s.key][e.id]),l=this.proxyToSource[s.key][e.id];l?l.push(a):this.proxyToSource[s.key][e.id]=[a],r.push(a)}}}_createProxiedId(e,n,i){let r=this.orthoMatrix;if(i){const t=i.find(t=>t.key===n.tileID.key);if(t)return t}if(n.tileID.key!==e.key){const i=e.canonical.z-n.tileID.canonical.z;let o,s,a;r=t.create$1();const l=n.tileID.wrap-e.wrap<<e.overscaledZ;i>0?(o=t.EXTENT>>i,s=o*((n.tileID.canonical.x<<i)-e.canonical.x+l),a=o*((n.tileID.canonical.y<<i)-e.canonical.y)):(o=t.EXTENT<<-i,s=t.EXTENT*(n.tileID.canonical.x-(e.canonical.x+l<<-i)),a=t.EXTENT*(n.tileID.canonical.y-(e.canonical.y<<-i))),t.ortho(r,0,o,0,o,0,1),t.translate(r,r,[s,a,0])}return new hn(n.tileID,e.key,r)}_findTileCoveringTileID(e,n){let i=n.getTile(e);if(i&&i.hasData())return i;const r=this._findCoveringTileCache[n.id],o=r[e.key];if(i=o?n.getTileByID(o):null,i&&i.hasData()||null===o)return i;let s=i?i.tileID:e,a=s.overscaledZ;const l=n.getSource().minzoom,c=[];if(!o){const r=n.getSource().maxzoom;if(e.canonical.z>=r){const i=e.canonical.z-r;n.getSource().reparseOverscaled?(a=Math.max(e.canonical.z+2,n.transform.tileZoom),s=new t.OverscaledTileID(a,e.wrap,r,e.canonical.x>>i,e.canonical.y>>i)):0!==i&&(a=r,s=new t.OverscaledTileID(a,e.wrap,r,e.canonical.x>>i,e.canonical.y>>i))}s.key!==e.key&&(c.push(s.key),i=n.getTile(s))}const u=t=>{c.forEach(e=>{r[e]=t}),c.length=0};for(a-=1;a>=l&&(!i||!i.hasData());a--){i&&u(i.tileID.key);const t=s.calculateScaledKey(a);if(i=n.getTileByID(t),i&&i.hasData())break;const e=r[t];if(null===e)break;void 0===e?c.push(t):i=n.getTileByID(e)}return u(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(t){this.renderedToTile=!0}_clearRenderCacheForTile(t,e){let n=this._tilesDirty[t];n||(n=this._tilesDirty[t]={}),n[e.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const e=function(e){let n,i,r;const o=new t.StructArrayLayout2ui4,s=131;for(i=1;i<129;i++){for(n=1;n<129;n++)r=i*s+n,o.emplaceBack(r,r+1),o.emplaceBack(r,r+s),o.emplaceBack(r+1,r+s),128===i&&o.emplaceBack(r+s,r+s+1);o.emplaceBack(r+1,r+1+s)}return o}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(e),this.wireframeSegments=t.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,e.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function pn(t){const e=[];for(let n=0;n<t.length;n++){if(null===t[n])continue;const i=t[n].split(" ");e.push(i.pop())}return e}class fn{static cacheKey(t,e,n){let i=`${t}${n?n.cacheKey:""}`;for(const r of e)i+=`/${r}`;return i}constructor(e,n,i,r,o,s){const a=e.gl;this.program=a.createProgram();const l=pn(i.staticAttributes),c=r?r.getBinderAttributes():[],u=l.concat(c),h=i.staticUniforms?pn(i.staticUniforms):[],d=r?r.getBinderUniforms():[],p=h.concat(d),f=[];for(const t of p)f.indexOf(t)<0&&f.push(t);let m=r?r.defines():[];m=m.concat(s.map(t=>`#define ${t}`));const g=m.concat(Ye.fragmentSource,He,Ge.fragmentSource,i.fragmentSource).join("\n"),y=m.concat(Ye.vertexSource,He,Ge.vertexSource,je.vertexSource,i.vertexSource).join("\n"),_=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(_,g),a.compileShader(_),a.attachShader(this.program,_);const v=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(v,y),a.compileShader(v),a.attachShader(this.program,v),this.attributes={};const x={};this.numAttributes=u.length;for(let t=0;t<this.numAttributes;t++)u[t]&&(a.bindAttribLocation(this.program,t,u[t]),this.attributes[u[t]]=t);a.linkProgram(this.program),a.deleteShader(v),a.deleteShader(_);for(let t=0;t<f.length;t++){const e=f[t];if(e&&!x[e]){const t=a.getUniformLocation(this.program,e);t&&(x[e]=t)}}var b,w;this.fixedUniforms=o(e,x),this.binderUniforms=r?r.getUniforms(e,x):[],-1!==s.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new t.Uniform1i(b=e,(w=x).u_dem),u_dem_prev:new t.Uniform1i(b,w.u_dem_prev),u_dem_unpack:new t.Uniform4f(b,w.u_dem_unpack),u_dem_tl:new t.Uniform2f(b,w.u_dem_tl),u_dem_scale:new t.Uniform1f(b,w.u_dem_scale),u_dem_tl_prev:new t.Uniform2f(b,w.u_dem_tl_prev),u_dem_scale_prev:new t.Uniform1f(b,w.u_dem_scale_prev),u_dem_size:new t.Uniform1f(b,w.u_dem_size),u_dem_lerp:new t.Uniform1f(b,w.u_dem_lerp),u_exaggeration:new t.Uniform1f(b,w.u_exaggeration),u_depth:new t.Uniform1i(b,w.u_depth),u_depth_size_inv:new t.Uniform2f(b,w.u_depth_size_inv),u_meter_to_dem:new t.Uniform1f(b,w.u_meter_to_dem),u_label_plane_matrix_inv:new t.UniformMatrix4f(b,w.u_label_plane_matrix_inv)}),-1!==s.indexOf("FOG")&&(this.fogUniforms=((e,n)=>({u_fog_matrix:new t.UniformMatrix4f(e,n.u_fog_matrix),u_fog_range:new t.Uniform2f(e,n.u_fog_range),u_fog_color:new t.Uniform4f(e,n.u_fog_color),u_fog_horizon_blend:new t.Uniform1f(e,n.u_fog_horizon_blend),u_fog_temporal_offset:new t.Uniform1f(e,n.u_fog_temporal_offset)}))(e,x))}setTerrainUniformValues(t,e){if(!this.terrainUniforms)return;const n=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)n[t].set(e[t])}}setFogUniformValues(t,e){if(!this.fogUniforms)return;const n=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)n[t].location&&n[t].set(e[t])}}draw(t,e,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const g=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(i),t.setColorMode(r),t.setCullFace(o);for(const _ in this.fixedUniforms)this.fixedUniforms[_].set(s[_]);p&&p.setUniforms(t,this.binderUniforms,h,{zoom:d});const y={[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[e];for(const _ of u.get()){const n=_.vaos||(_.vaos={});(n[a]||(n[a]=new Xe)).bind(t,this,l,p?p.getPaintVertexBuffers():[],c,_.vertexOffset,f,m),g.drawElements(e,_.primitiveLength*y,g.UNSIGNED_SHORT,_.primitiveOffset*y*2)}}}function mn(t,e,n){const i=1/M(n,1,e.transform.tileZoom),r=Math.pow(2,n.tileID.overscaledZ),o=n.tileSize*Math.pow(2,e.transform.tileZoom)/r,s=o*(n.tileID.canonical.x+n.tileID.wrap*r),a=o*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[i,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[s>>16,a>>16],u_pixel_coord_lower:[65535&s,65535&a]}}const gn=(e,n,i,r)=>{const o=n.style.light,s=o.properties.get("position"),a=[s.x,s.y,s.z],l=t.create$2();"viewport"===o.properties.get("anchor")&&(t.fromRotation(l,-n.transform.angle),t.transformMat3(a,a,l));const c=o.properties.get("color");return{u_matrix:e,u_lightpos:a,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+i,u_opacity:r}},yn=(e,n,i,r,o,s,a)=>t.extend(gn(e,n,i,r),mn(s,n,a),{u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8}),_n=t=>({u_matrix:t}),vn=(e,n,i,r)=>t.extend(_n(e),mn(i,n,r)),xn=(t,e)=>({u_matrix:t,u_world:e}),bn=(e,n,i,r,o)=>t.extend(vn(e,n,i,r),{u_world:o}),wn=(e,n,i,r)=>{const o=e.transform;let s;if("map"===r.paint.get("circle-pitch-alignment")){const t=M(i,1,o.zoom);s=[t,t]}else s=o.pixelsToGLUnits;return{u_camera_to_center_distance:o.cameraToCenterDistance,u_matrix:e.translatePosMatrix(n.projMatrix,i,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor")),u_device_pixel_ratio:t.exported.devicePixelRatio,u_extrude_scale:s}},Tn=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e},An=(e,n,i)=>{const r=t.EXTENT/i.tileSize;return{u_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/r,n.pixelsToGLUnits[1]/r]}},Sn=(t,e,n=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}),Cn=(t,e,n,i)=>({u_matrix:t,u_extrude_scale:M(e,1,n),u_intensity:i}),In=(e,n,i,r)=>{const o=e.transform;return{u_matrix:Dn(e,n,i,r),u_ratio:1/M(n,1,o.zoom),u_device_pixel_ratio:t.exported.devicePixelRatio,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},En=(e,n,i,r,o)=>t.extend(In(e,n,i,r),{u_image:0,u_image_height:o}),Mn=(e,n,i,r,o)=>{const s=e.transform,a=Pn(n,s);return{u_matrix:Dn(e,n,i,o),u_texsize:n.imageAtlasTexture.size,u_ratio:1/M(n,1,s.zoom),u_device_pixel_ratio:t.exported.devicePixelRatio,u_image:0,u_scale:[a,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},kn=(e,n,i,r,o)=>{const s=Pn(n,e.transform);return t.extend(In(e,n,i,o),{u_texsize:n.lineAtlasTexture.size,u_scale:[s,r.fromScale,r.toScale],u_image:0,u_mix:r.t})};function Pn(t,e){return 1/M(t,1,e.tileZoom)}function Dn(t,e,n,i){return t.translatePosMatrix(i||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Ln=(t,e,n,i,r)=>{return{u_matrix:t,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(s=r.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(o=r.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:On(r.paint.get("raster-hue-rotate"))};var o,s};function On(t){t*=Math.PI/180;const e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const Rn=(t,e,n,i,r,o,s,a,l,c)=>{const u=r.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:u.cameraToCenterDistance,u_pitch:u.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:u.width/u.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:s,u_coord_matrix:a,u_is_text:+l,u_pitch_with_map:+i,u_texsize:c,u_texture:0}},zn=(e,n,i,r,o,s,a,l,c,u,h)=>{const{cameraToCenterDistance:d,_pitch:p}=o.transform;return t.extend(Rn(e,n,i,r,o,s,a,l,c,u),{u_gamma_scale:r?d*Math.cos(o.terrain?0:p):1,u_device_pixel_ratio:t.exported.devicePixelRatio,u_is_halo:+h})},Zn=(e,n,i,r,o,s,a,l,c,u)=>t.extend(zn(e,n,i,r,o,s,a,l,!0,c,!0),{u_texsize_icon:u,u_texture_icon:1}),Fn=(t,e,n)=>({u_matrix:t,u_opacity:e,u_color:n}),Un=(e,n,i,r,o,s)=>t.extend(function(t,e,n,i){const r=n.imageManager.getPattern(t.from.toString()),o=n.imageManager.getPattern(t.to.toString()),{width:s,height:a}=n.imageManager.getPixelSize(),l=Math.pow(2,i.tileID.overscaledZ),c=i.tileSize*Math.pow(2,n.transform.tileZoom)/l,u=c*(i.tileID.canonical.x+i.tileID.wrap*l),h=c*i.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,a],u_mix:e.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/M(i,1,n.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(r,s,i,o),{u_matrix:e,u_opacity:n}),Nn={fillExtrusion:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_opacity:new t.Uniform1f(e,n.u_opacity)}),fillExtrusionPattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,n.u_height_factor),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade),u_opacity:new t.Uniform1f(e,n.u_opacity)}),fill:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}),fillPattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}),fillOutline:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world)}),fillOutlinePattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}),circle:(e,n)=>({u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}),collisionBox:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale)}),collisionCircle:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,n.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,n.u_viewport_size)}),debug:(e,n)=>({u_color:new t.UniformColor(e,n.u_color),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_overlay:new t.Uniform1i(e,n.u_overlay),u_overlay_scale:new t.Uniform1f(e,n.u_overlay_scale)}),clippingMask:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}),heatmap:(e,n)=>({u_extrude_scale:new t.Uniform1f(e,n.u_extrude_scale),u_intensity:new t.Uniform1f(e,n.u_intensity),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}),heatmapTexture:(e,n)=>({u_image:new t.Uniform1i(e,n.u_image),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_opacity:new t.Uniform1f(e,n.u_opacity)}),hillshade:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_latrange:new t.Uniform2f(e,n.u_latrange),u_light:new t.Uniform2f(e,n.u_light),u_shadow:new t.UniformColor(e,n.u_shadow),u_highlight:new t.UniformColor(e,n.u_highlight),u_accent:new t.UniformColor(e,n.u_accent)}),hillshadePrepare:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_dimension:new t.Uniform2f(e,n.u_dimension),u_zoom:new t.Uniform1f(e,n.u_zoom),u_unpack:new t.Uniform4f(e,n.u_unpack)}),line:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels)}),lineGradient:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_image:new t.Uniform1i(e,n.u_image),u_image_height:new t.Uniform1f(e,n.u_image_height)}),linePattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_texsize:new t.Uniform2f(e,n.u_texsize),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_image:new t.Uniform1i(e,n.u_image),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}),lineSDF:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_texsize:new t.Uniform2f(e,n.u_texsize),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_image:new t.Uniform1i(e,n.u_image),u_scale:new t.Uniform3f(e,n.u_scale),u_mix:new t.Uniform1f(e,n.u_mix)}),raster:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_tl_parent:new t.Uniform2f(e,n.u_tl_parent),u_scale_parent:new t.Uniform1f(e,n.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,n.u_buffer_scale),u_fade_t:new t.Uniform1f(e,n.u_fade_t),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image0:new t.Uniform1i(e,n.u_image0),u_image1:new t.Uniform1i(e,n.u_image1),u_brightness_low:new t.Uniform1f(e,n.u_brightness_low),u_brightness_high:new t.Uniform1f(e,n.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,n.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,n.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,n.u_spin_weights)}),symbolIcon:(e,n)=>({u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture)}),symbolSDF:(e,n)=>({u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}),symbolTextAndIcon:(e,n)=>({u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texsize_icon:new t.Uniform2f(e,n.u_texsize_icon),u_texture:new t.Uniform1i(e,n.u_texture),u_texture_icon:new t.Uniform1i(e,n.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}),background:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_color:new t.UniformColor(e,n.u_color)}),backgroundPattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image:new t.Uniform1i(e,n.u_image),u_pattern_tl_a:new t.Uniform2f(e,n.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,n.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,n.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,n.u_pattern_br_b),u_texsize:new t.Uniform2f(e,n.u_texsize),u_mix:new t.Uniform1f(e,n.u_mix),u_pattern_size_a:new t.Uniform2f(e,n.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,n.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,n.u_scale_a),u_scale_b:new t.Uniform1f(e,n.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,n.u_tile_units_to_pixels)}),terrainRaster:nn,terrainDepth:nn,skybox:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_sun_direction:new t.Uniform3f(e,n.u_sun_direction),u_cubemap:new t.Uniform1i(e,n.u_cubemap),u_opacity:new t.Uniform1f(e,n.u_opacity),u_temporal_offset:new t.Uniform1f(e,n.u_temporal_offset)}),skyboxGradient:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_center_direction:new t.Uniform3f(e,n.u_center_direction),u_radius:new t.Uniform1f(e,n.u_radius),u_opacity:new t.Uniform1f(e,n.u_opacity),u_temporal_offset:new t.Uniform1f(e,n.u_temporal_offset)}),skyboxCapture:(e,n)=>({u_matrix_3f:new t.UniformMatrix3f(e,n.u_matrix_3f),u_sun_direction:new t.Uniform3f(e,n.u_sun_direction),u_sun_intensity:new t.Uniform1f(e,n.u_sun_intensity),u_color_tint_r:new t.Uniform4f(e,n.u_color_tint_r),u_color_tint_m:new t.Uniform4f(e,n.u_color_tint_m),u_luminance:new t.Uniform1f(e,n.u_luminance)})};let Bn;function qn(e,n,i,r,o,s,a){const l=e.context,c=l.gl,u=e.useProgram("collisionBox"),h=[];let d=0,p=0;for(let x=0;x<r.length;x++){const f=r[x],m=n.getTile(f),g=m.getBucket(i);if(!g)continue;let y=f.projMatrix;0===o[0]&&0===o[1]||(y=e.translatePosMatrix(f.projMatrix,m,o,s));const _=a?g.textCollisionBox:g.iconCollisionBox,v=g.collisionCircleArray;if(v.length>0){const n=t.create$1(),i=y;t.mul$1(n,g.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul$1(n,n,g.placementViewportMatrix),h.push({circleArray:v,circleOffset:p,transform:i,invTransform:n}),d+=v.length/4,p=d}_&&(e.terrain&&e.terrain.setupElevationDraw(m,u),u.draw(l,c.LINES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,An(y,e.transform,m),i.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,e.transform.zoom,null,_.collisionVertexBuffer,_.collisionVertexBufferExt))}if(!a||!h.length)return;const f=e.useProgram("collisionCircle"),m=new t.StructArrayLayout2f1f2i16;m.resize(4*d),m._trim();let g=0;for(const t of h)for(let e=0;e<t.circleArray.length/4;e++){const n=4*e,i=t.circleArray[n+0],r=t.circleArray[n+1],o=t.circleArray[n+2],s=t.circleArray[n+3];m.emplace(g++,i,r,o,s,0),m.emplace(g++,i,r,o,s,1),m.emplace(g++,i,r,o,s,2),m.emplace(g++,i,r,o,s,3)}(!Bn||Bn.length<2*d)&&(Bn=function(e){const n=2*e,i=new t.StructArrayLayout3ui6;i.resize(n),i._trim();for(let t=0;t<n;t++){const e=6*t;i.uint16[e+0]=4*t+0,i.uint16[e+1]=4*t+1,i.uint16[e+2]=4*t+2,i.uint16[e+3]=4*t+2,i.uint16[e+4]=4*t+3,i.uint16[e+5]=4*t+0}return i}(d));const y=l.createIndexBuffer(Bn,!0),_=l.createVertexBuffer(m,t.collisionCircleLayout.members,!0);for(const x of h){const n={u_matrix:x.transform,u_inv_matrix:x.invTransform,u_camera_to_center_distance:(v=e.transform).cameraToCenterDistance,u_viewport_size:[v.width,v.height]};f.draw(l,c.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,n,i.id,_,y,t.SegmentVector.simpleSegment(0,2*x.circleOffset,x.circleArray.length,x.circleArray.length/2),null,e.transform.zoom,null,null,null)}var v;_.destroy(),y.destroy()}const $n=t.identity(new Float32Array(16));function Vn(e,n,i,r,o,s){const{horizontalAlign:a,verticalAlign:l}=t.getAnchorAlignment(e),c=-(a-.5)*n,u=-(l-.5)*i,h=t.evaluateVariableOffset(e,r);return new t.pointGeometry((c/o+h[0])*s,(u/o+h[1])*s)}function jn(e,n,i,r,o,s,a,l,c,u,h,d){const p=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,m=e.icon.dynamicLayoutVertexArray,g={};f.clear();for(let y=0;y<p.length;y++){const m=p.get(y),_=e.allowVerticalPlacement&&!m.placedOrientation,v=m.hidden||!m.crossTileID||_?null:r[m.crossTileID];if(v){const r=new t.pointGeometry(m.anchorX,m.anchorY),p=d(r),y=Xt(r,i?l:a,p),_=Qt(s.cameraToCenterDistance,y.signedDistanceFromCamera);let x=o.evaluateSizeForFeature(e.textSizeData,u,m)*_/t.ONE_EM;i&&(x*=e.tilePixelRatio/c);const{width:b,height:w,anchor:T,textOffset:A,textScale:S}=v,C=Vn(T,b,w,A,S,x),I=i?Xt(r.add(C),a,p).point:y.point.add(n?C.rotate(-s.angle):C),E=e.allowVerticalPlacement&&m.placedOrientation===t.WritingMode.vertical?Math.PI/2:0;for(let e=0;e<m.numGlyphs;e++)t.addDynamicAttributes(f,I,E);h&&m.associatedIconIndex>=0&&(g[m.associatedIconIndex]={shiftedAnchor:I,angle:E})}else ae(m.numGlyphs,f)}if(h){m.clear();const n=e.icon.placedSymbolArray;for(let e=0;e<n.length;e++){const i=n.get(e);if(i.hidden)ae(i.numGlyphs,m);else{const n=g[e];if(n)for(let e=0;e<i.numGlyphs;e++)t.addDynamicAttributes(m,n.shiftedAnchor,n.angle);else ae(i.numGlyphs,m)}}e.icon.dynamicLayoutVertexBuffer.updateData(m)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function Gn(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function Yn(e,n,i,r,o,s,a,l,c,u,h,d){const p=e.context,f=p.gl,m=e.transform,g="map"===l,y="map"===c,_=g&&"point"!==i.layout.get("symbol-placement"),v=g&&!y&&!_,x=void 0!==i.layout.get("symbol-sort-key").constantOr(1);let b=!1;const w=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),T=i.layout.get("text-variable-anchor"),A=[],S=e.terrain&&y?["PITCH_WITH_MAP_TERRAIN"]:null;for(const C of r){const r=n.getTile(C),l=r.getBucket(i);if(!l)continue;const c=o?l.text:l.icon;if(!c||!c.segments.get().length)continue;const h=c.programConfigurations.get(i.id),d=o||l.sdfIcons,p=o?l.textSizeData:l.iconSizeData,w=y||0!==m.pitch,I=e.useProgram(Gn(d,o,l),h,S),E=t.evaluateSizeForZoom(p,m.zoom);let k,P,D,L,O=[0,0],R=null;if(o){if(P=r.glyphAtlasTexture,D=f.LINEAR,k=r.glyphAtlasTexture.size,l.iconsInText){O=r.imageAtlasTexture.size,R=r.imageAtlasTexture;const t="composite"===p.kind||"camera"===p.kind;L=w||e.options.rotating||e.options.zooming||t?f.LINEAR:f.NEAREST}}else{const t=1!==i.layout.get("icon-size").constantOr(0)||l.iconsNeedLinear;P=r.imageAtlasTexture,D=d||e.options.rotating||e.options.zooming||t||w?f.LINEAR:f.NEAREST,k=r.imageAtlasTexture.size}const z=M(r,1,e.transform.zoom),Z=Jt(C.projMatrix,y,g,e.transform,z),F=e.terrain&&y&&_?t.invert(new Float32Array(16),Z):$n,U=Wt(C.projMatrix,y,g,e.transform,z),N=T&&l.hasTextData(),B="none"!==i.layout.get("icon-text-fit")&&N&&l.hasIconData();if(_){const t=m.elevation;te(l,C.projMatrix,e,o,Z,U,y,u,t?e=>t.getAtTileOffset(C,e.x,e.y):null)}const q=e.translatePosMatrix(C.projMatrix,r,s,a),$=_||o&&T||B?$n:Z,V=e.translatePosMatrix(U,r,s,a,!0),j=d&&0!==i.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let G;G=d?l.iconsInText?Zn(p.kind,E,v,y,e,q,$,V,k,O):zn(p.kind,E,v,y,e,q,$,V,o,k,!0):Rn(p.kind,E,v,y,e,q,$,V,o,k);const Y={program:I,buffers:c,uniformValues:G,atlasTexture:P,atlasTextureIcon:R,atlasInterpolation:D,atlasInterpolationIcon:L,isSDF:d,hasHalo:j,tile:r,labelPlaneMatrixInv:F};if(x&&l.canOverlap){b=!0;const e=c.segments.get();for(const n of e)A.push({segments:new t.SegmentVector([n]),sortKey:n.sortKey,state:Y})}else A.push({segments:c.segments,sortKey:0,state:Y})}b&&A.sort((t,e)=>t.sortKey-e.sortKey);for(const t of A){const n=t.state;if(e.terrain&&e.terrain.setupElevationDraw(n.tile,n.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:n.labelPlaneMatrixInv}),p.activeTexture.set(f.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,f.CLAMP_TO_EDGE),n.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),n.isSDF){const r=n.uniformValues;n.hasHalo&&(r.u_is_halo=1,Hn(n.buffers,t.segments,i,e,n.program,w,h,d,r)),r.u_is_halo=0}Hn(n.buffers,t.segments,i,e,n.program,w,h,d,n.uniformValues)}}function Hn(e,n,i,r,o,s,a,l,c){const u=r.context;o.draw(u,u.gl.TRIANGLES,s,a,l,t.CullFaceMode.disabled,c,i.id,e.layoutVertexBuffer,e.indexBuffer,n,i.paint,r.transform.zoom,e.programConfigurations.get(i.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function Jn(e,n,i,r,o,s,a){const l=e.context.gl,c=i.paint.get("fill-pattern"),u=c&&c.constantOr(1),h=i.getCrossfadeParameters();let d,p,f,m,g;a?(p=u&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d=l.LINES):(p=u?"fillPattern":"fill",d=l.TRIANGLES);for(const y of r){const r=n.getTile(y);if(u&&!r.patternsLoaded())continue;const _=r.getBucket(i);if(!_)continue;e.prepareDrawTile(y);const v=_.programConfigurations.get(i.id),x=e.useProgram(p,v);u&&(e.context.activeTexture.set(l.TEXTURE0),r.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),v.updatePaintBuffers(h));const b=c.constantOr(null);if(b&&r.imageAtlas){const t=r.imageAtlas,e=t.patternPositions[b.to.toString()],n=t.patternPositions[b.from.toString()];e&&n&&v.setConstantPatternPositions(e,n)}const w=e.translatePosMatrix(y.projMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(a){m=_.indexBuffer2,g=_.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];f="fillOutlinePattern"===p&&u?bn(w,e,h,r,t):xn(w,t)}else m=_.indexBuffer,g=_.segments,f=u?vn(w,e,h,r):_n(w);e.prepareDrawProgram(e.context,x,y.toUnwrapped()),x.draw(e.context,d,o,e.stencilModeForClipping(y),s,t.CullFaceMode.disabled,f,i.id,_.layoutVertexBuffer,m,g,i.paint,e.transform.zoom,v)}}function Wn(e,n,i,r,o,s,a){const l=e.context,c=l.gl,u=i.paint.get("fill-extrusion-pattern"),h=u.constantOr(1),d=i.getCrossfadeParameters(),p=i.paint.get("fill-extrusion-opacity");for(const f of r){const r=n.getTile(f),m=r.getBucket(i);if(!m)continue;const g=m.programConfigurations.get(i.id),y=e.useProgram(h?"fillExtrusionPattern":"fillExtrusion",g);if(e.terrain){const t=e.terrain;if(!m.enableTerrain)continue;if(t.setupElevationDraw(r,y,{useMeterToDem:!0}),Xn(l,n,f,m,i,t),!m.centroidVertexBuffer){const t=y.attributes.a_centroid_pos;void 0!==t&&c.vertexAttrib2f(t,0,0)}}h&&(e.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),g.updatePaintBuffers(d));const _=u.constantOr(null);if(_&&r.imageAtlas){const t=r.imageAtlas,e=t.patternPositions[_.to.toString()],n=t.patternPositions[_.from.toString()];e&&n&&g.setConstantPatternPositions(e,n)}const v=e.translatePosMatrix(f.projMatrix,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),x=i.paint.get("fill-extrusion-vertical-gradient"),b=h?yn(v,e,x,p,f,d,r):gn(v,e,x,p);e.prepareDrawProgram(l,y,f.toUnwrapped()),y.draw(l,l.gl.TRIANGLES,o,s,a,t.CullFaceMode.backCCW,b,i.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,i.paint,e.transform.zoom,g,e.terrain?m.centroidVertexBuffer:null)}}function Xn(e,n,i,r,o,s){const a=[e=>{let n=e.canonical.x-1,i=e.wrap;return n<0&&(n=(1<<e.canonical.z)-1,i--),new t.OverscaledTileID(e.overscaledZ,i,e.canonical.z,n,e.canonical.y)},e=>{let n=e.canonical.x+1,i=e.wrap;return n===1<<e.canonical.z&&(n=0,i++),new t.OverscaledTileID(e.overscaledZ,i,e.canonical.z,n,e.canonical.y)},e=>new t.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new t.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)],l=t=>{const e=n.getSource().maxzoom,i=t=>{const e=n.getTileByID(t);if(e&&e.hasData())return e.getBucket(o)};let r,s,a;return(t.overscaledZ===t.canonical.z||t.overscaledZ>=e)&&(r=i(t.key)),t.overscaledZ>=e&&(s=i(t.calculateScaledKey(t.overscaledZ+1))),t.overscaledZ>e&&(a=i(t.calculateScaledKey(t.overscaledZ-1))),r||s||a},c=[0,0,0],u=(e,n)=>(c[0]=Math.min(e.min.y,n.min.y),c[1]=Math.max(e.max.y,n.max.y),c[2]=t.EXTENT-n.min.x>e.max.x?n.min.x-t.EXTENT:e.max.x,c),h=(e,n)=>(c[0]=Math.min(e.min.x,n.min.x),c[1]=Math.max(e.max.x,n.max.x),c[2]=t.EXTENT-n.min.y>e.max.y?n.min.y-t.EXTENT:e.max.y,c),d=[(t,e)=>u(t,e),(t,e)=>u(e,t),(t,e)=>h(t,e),(t,e)=>h(e,t)],p=new t.pointGeometry(0,0);let f,m,g;const y=(e,n,r,o,a)=>{const l=[[o?r:e,o?e:r,0],[o?r:n,o?n:r,0]],c=a<0?t.EXTENT+a:a,u=[o?c:(e+n)/2,o?(e+n)/2:c,0];return 0===r&&a<0||0!==r&&a>0?s.getForTilePoints(g,[u],!0,m):l.push(u),s.getForTilePoints(i,l,!0,f),Math.max(l[0][2],l[1][2],u[2])/s.exaggeration()};for(let _=0;_<4;_++){const e=r.borders[_];if(0===e.length&&(r.borderDone[_]=!0),r.borderDone[_])continue;const n=g=a[_](i),o=l(n);if(!(o&&o.enableTerrain&&(m=s.findDEMTileFor(n),m&&m.dem)))continue;if(!f){const t=s.findDEMTileFor(i);if(!t||!t.dem)return;f=t}const c=(_<2?1:5)-_,u=o.borders[c];let h=0;for(let i=0;i<e.length;i++){const n=r.featuresOnBorder[e[i]],s=n.borders[_];let a;for(;h<u.length&&(a=o.featuresOnBorder[u[h]],!(a.borders[c][1]>s[0]+3));)o.borderDone[c]||o.encodeCentroid(void 0,a,!1),h++;if(a&&h<u.length){const e=h;let i=0;for(;!(a.borders[c][0]>s[1]-3)&&(i++,++h!==u.length);)a=o.featuresOnBorder[u[h]];if(a=o.featuresOnBorder[u[e]],n.intersectsCount()>1||a.intersectsCount()>1||1!==i){1!==i&&(h=e),r.encodeCentroid(void 0,n,!1),o.borderDone[c]||o.encodeCentroid(void 0,a,!1);continue}const l=d[_](n,a),f=_%2?t.EXTENT-1:0;p.x=y(l[0],Math.min(t.EXTENT-1,l[1]),f,_<2,l[2]),p.y=0,r.encodeCentroid(p,n,!1),o.borderDone[c]||o.encodeCentroid(p,a,!1)}else r.encodeCentroid(void 0,n,!1)}r.borderDone[_]=r.needsCentroidUpdate=!0,o.borderDone[c]||(o.borderDone[c]=o.needsCentroidUpdate=!0)}(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(e)}const Qn=new t.Color(1,0,0,1),Kn=new t.Color(0,1,0,1),ti=new t.Color(0,0,1,1),ei=new t.Color(1,0,1,1),ni=new t.Color(0,1,1,1);function ii(t,e,n,i){oi(t,0,e+n/2,t.transform.width,n,i)}function ri(t,e,n,i){oi(t,e-n/2,0,n,t.transform.height,i)}function oi(e,n,i,r,o,s){const a=e.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(n*t.exported.devicePixelRatio,i*t.exported.devicePixelRatio,r*t.exported.devicePixelRatio,o*t.exported.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}function si(e,n,i){const r=e.context,o=r.gl,s=i.projMatrix,a=e.useProgram("debug"),l=n.getTileByID(i.key);e.terrain&&e.terrain.setupElevationDraw(l,a);const c=t.DepthMode.disabled,u=t.StencilMode.disabled,h=e.colorModeForRenderPass();r.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),a.draw(r,o.LINE_STRIP,c,u,h,t.CullFaceMode.disabled,Sn(s,t.Color.red),"$debug",e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);const d=l.latestRawTileData,p=Math.floor((d&&d.byteLength||0)/1024),f=n.getTile(i).tileSize,m=512/Math.min(f,512)*(i.overscaledZ/e.transform.zoom)*.5;let g=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(g+=` => ${i.overscaledZ}`),function(t,e){t.initDebugOverlayCanvas();const n=t.debugOverlayCanvas,i=t.context.gl,r=t.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(e,5,5),r.strokeText(e,5,5),t.debugOverlayTexture.update(n),t.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(e,`${g} ${p}kb`),a.draw(r,o.TRIANGLES,c,u,t.ColorMode.alphaBlended,t.CullFaceMode.disabled,Sn(s,t.Color.transparent,m),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}const ai=t.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:li}=ai;function ci(t,e,n,i){t.emplaceBack(e,n,i)}class ui{constructor(e){this.vertexArray=new t.StructArrayLayout3f12,this.indices=new t.StructArrayLayout3ui6,ci(this.vertexArray,-1,-1,1),ci(this.vertexArray,1,-1,1),ci(this.vertexArray,-1,1,1),ci(this.vertexArray,1,1,1),ci(this.vertexArray,-1,-1,-1),ci(this.vertexArray,1,-1,-1),ci(this.vertexArray,-1,1,-1),ci(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,li),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=t.SegmentVector.simpleSegment(0,0,36,12)}}function hi(e,n,i,r,o,s){const a=e.gl,l=n.paint.get("sky-atmosphere-color"),c=n.paint.get("sky-atmosphere-halo-color"),u=n.paint.get("sky-atmosphere-sun-intensity"),h={u_matrix_3f:t.fromMat4([],r),u_sun_direction:o,u_sun_intensity:u,u_color_tint_r:[(d=l).r,d.g,d.b,d.a],u_color_tint_m:[(p=c).r,p.g,p.b,p.a],u_luminance:5e-5};var d,p;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,n.skyboxTexture,0),i.draw(e,a.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.frontCW,h,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const di={symbol:function(e,n,i,r,o){if("translucent"!==e.renderPass)return;const s=t.StencilMode.disabled,a=e.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(e,n,i,r,o,s,a){const l=n.transform,c="map"===o,u="map"===s;for(const h of e){const e=r.getTile(h),o=e.getBucket(i);if(!o||!o.text||!o.text.segments.get().length)continue;const s=t.evaluateSizeForZoom(o.textSizeData,l.zoom),d=M(e,1,n.transform.zoom),p=Jt(h.projMatrix,u,c,n.transform,d),f="none"!==i.layout.get("icon-text-fit")&&o.hasIconData();if(s){const n=Math.pow(2,l.zoom-e.tileID.overscaledZ),i=l.elevation;jn(o,c,u,a,t.symbolSize,l,p,h.projMatrix,n,s,f,i?t=>i.getAtTileOffset(h,t.x,t.y):t=>0)}}}(r,e,i,n,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),o),0!==i.paint.get("icon-opacity").constantOr(1)&&Yn(e,n,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),s,a),0!==i.paint.get("text-opacity").constantOr(1)&&Yn(e,n,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),s,a),n.map.showCollisionBoxes&&(qn(e,n,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),qn(e,n,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(e,n,i,r){if("translucent"!==e.renderPass)return;const o=i.paint.get("circle-opacity"),s=i.paint.get("circle-stroke-width"),a=i.paint.get("circle-stroke-opacity"),l=void 0!==i.layout.get("circle-sort-key").constantOr(1);if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const c=e.context,u=c.gl,h=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),d=t.StencilMode.disabled,p=e.colorModeForRenderPass(),f=[];for(let m=0;m<r.length;m++){const o=r[m],s=n.getTile(o),a=s.getBucket(i);if(!a)continue;const c=a.programConfigurations.get(i.id),u=Tn(i),h={programConfiguration:c,program:e.useProgram("circle",c,u),layoutVertexBuffer:a.layoutVertexBuffer,indexBuffer:a.indexBuffer,uniformValues:wn(e,o,s,i),tile:s};if(l){const e=a.segments.get();for(const n of e)f.push({segments:new t.SegmentVector([n]),sortKey:n.sortKey,state:h})}else f.push({segments:a.segments,sortKey:0,state:h})}l&&f.sort((t,e)=>t.sortKey-e.sortKey);for(const m of f){const{programConfiguration:n,program:r,layoutVertexBuffer:o,indexBuffer:s,uniformValues:a,tile:l}=m.state,f=m.segments;e.terrain&&e.terrain.setupElevationDraw(l,r,{useDepthForOcclusion:!0}),e.prepareDrawProgram(c,r,l.tileID.toUnwrapped()),r.draw(c,u.TRIANGLES,h,d,p,t.CullFaceMode.disabled,a,i.id,o,s,f,i.paint,e.transform.zoom,n)}},heatmap:function(e,n,i,r){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const o=e.context,s=o.gl,a=t.StencilMode.disabled,l=new t.ColorMode([s.ONE,s.ONE],t.Color.transparent,[!0,!0,!0,!0]);(function(t,e,n){const i=t.gl;t.activeTexture.set(i.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);let r=n.heatmapFbo;if(r)i.bindTexture(i.TEXTURE_2D,r.colorAttachment.get()),t.bindFramebuffer.set(r.framebuffer);else{const o=i.createTexture();i.bindTexture(i.TEXTURE_2D,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),r=n.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,n,i){const r=t.gl;r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e.width/4,e.height/4,0,r.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:r.UNSIGNED_BYTE,null),i.colorAttachment.set(n)}(t,e,o,r)}})(o,e,i),o.clear({color:t.Color.transparent});for(let c=0;c<r.length;c++){const u=r[c];if(n.hasRenderableParent(u))continue;const h=n.getTile(u),d=h.getBucket(i);if(!d)continue;const p=d.programConfigurations.get(i.id),f=e.useProgram("heatmap",p),{zoom:m}=e.transform;e.terrain&&e.terrain.setupElevationDraw(h,f),e.prepareDrawProgram(o,f,u.toUnwrapped()),f.draw(o,s.TRIANGLES,t.DepthMode.disabled,a,l,t.CullFaceMode.disabled,Cn(u.projMatrix,h,m,i.paint.get("heatmap-intensity")),i.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,i.paint,e.transform.zoom,p)}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,n){const i=e.context,r=i.gl,o=n.heatmapFbo;if(!o)return;i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);let s=n.colorRampTexture;s||(s=n.colorRampTexture=new t.Texture(i,n.colorRamp,r.RGBA)),s.bind(r.LINEAR,r.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(i,r.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:n.paint.get("heatmap-opacity")},n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom)}(e,i))},line:function(e,n,i,r){if("translucent"!==e.renderPass)return;const o=i.paint.get("line-opacity"),s=i.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),l=e.colorModeForRenderPass(),c=i.paint.get("line-dasharray"),u=c.constantOr(1),h=i.layout.get("line-cap"),d=i.paint.get("line-pattern"),p=d.constantOr(1),f=i.paint.get("line-gradient"),m=i.getCrossfadeParameters(),g=p?"linePattern":u?"lineSDF":f?"lineGradient":"line",y=e.context,_=y.gl;for(const v of r){const r=n.getTile(v);if(p&&!r.patternsLoaded())continue;const o=r.getBucket(i);if(!o)continue;e.prepareDrawTile(v);const s=o.programConfigurations.get(i.id),x=e.useProgram(g,s),b=d.constantOr(null);if(b&&r.imageAtlas){const t=r.imageAtlas,e=t.patternPositions[b.to.toString()],n=t.patternPositions[b.from.toString()];e&&n&&s.setConstantPatternPositions(e,n)}const w=c.constantOr(null),T=h.constantOr(null);if(!p&&w&&T&&r.lineAtlas){const t=r.lineAtlas,e=t.getDash(w.to,T),n=t.getDash(w.from,T);e&&n&&s.setConstantPatternPositions(e,n)}const A=e.terrain?v.projMatrix:null,S=p?Mn(e,r,i,m,A):u?kn(e,r,i,m,A):f?En(e,r,i,A,o.lineClipsArray.length):In(e,r,i,A);if(p)y.activeTexture.set(_.TEXTURE0),r.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),s.updatePaintBuffers(m);else if(u)y.activeTexture.set(_.TEXTURE0),r.lineAtlasTexture.bind(_.LINEAR,_.REPEAT),s.updatePaintBuffers(m);else if(f){const r=o.gradients[i.id];let s=r.texture;if(i.gradientVersion!==r.version){let a=256;if(i.stepInterpolant){const i=n.getSource().maxzoom,r=v.canonical.z===i?Math.ceil(1<<e.transform.maxZoom-v.canonical.z):1;a=t.clamp(t.nextPowerOfTwo(o.maxLineLength/t.EXTENT*1024*r),256,y.maxTextureSize)}r.gradient=t.renderColorRamp({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:a,image:r.gradient||void 0,clips:o.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new t.Texture(y,r.gradient,_.RGBA),r.version=i.gradientVersion,s=r.texture}y.activeTexture.set(_.TEXTURE0),s.bind(i.stepInterpolant?_.NEAREST:_.LINEAR,_.CLAMP_TO_EDGE)}e.prepareDrawProgram(y,x,v.toUnwrapped()),x.draw(y,_.TRIANGLES,a,e.stencilModeForClipping(v),l,t.CullFaceMode.disabled,S,i.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,i.paint,e.transform.zoom,s,o.layoutVertexBuffer2)}},fill:function(e,n,i,r){const o=i.paint.get("fill-color"),s=i.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=e.colorModeForRenderPass(),l=i.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){const o=e.depthModeForSublayer(1,"opaque"===e.renderPass?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly);Jn(e,n,i,r,o,a,!1)}if("translucent"===e.renderPass&&i.paint.get("fill-antialias")){const o=e.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,t.DepthMode.ReadOnly);Jn(e,n,i,r,o,a,!0)}},"fill-extrusion":function(e,n,i,r){const o=i.paint.get("fill-extrusion-opacity");if(0!==o&&"translucent"===e.renderPass){const s=new t.DepthMode(e.context.gl.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);if(1!==o||i.paint.get("fill-extrusion-pattern").constantOr(1))Wn(e,n,i,r,s,t.StencilMode.disabled,t.ColorMode.disabled),Wn(e,n,i,r,s,e.stencilModeFor3D(),e.colorModeForRenderPass());else{const o=e.colorModeForRenderPass();Wn(e,n,i,r,s,t.StencilMode.disabled,o)}}},hillshade:function(e,n,i,r){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const o=e.context,s=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),a=e.colorModeForRenderPass(),l=e.terrain&&e.terrain.renderingToTexture,[c,u]="translucent"!==e.renderPass||l?[{},r]:e.stencilConfigForOverlap(r);for(const h of u){const r=n.getTile(h);if(r.needsHillshadePrepare&&"offscreen"===e.renderPass)en(e,r,i,s,t.StencilMode.disabled,a);else if("translucent"===e.renderPass){const t=l&&e.terrain?e.terrain.stencilModeForRTTOverlap(h):c[h.overscaledZ];Ke(e,h,r,i,s,t,a)}}o.viewport.set([0,0,e.width,e.height])},raster:function(e,n,i,r,o,s){if("translucent"!==e.renderPass||0===i.paint.get("raster-opacity")||!r.length)return;const a=e.context,l=a.gl,c=n.getSource(),u=e.useProgram("raster"),h=e.colorModeForRenderPass(),d=e.terrain&&e.terrain.renderingToTexture,[p,f]=c instanceof At||d?[{},r]:e.stencilConfigForOverlap(r),m=f[f.length-1].overscaledZ,g=!e.options.moving;for(const y of f){const r=d?t.DepthMode.disabled:e.depthModeForSublayer(y.overscaledZ-m,1===i.paint.get("raster-opacity")?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly,l.LESS),o=y.toUnwrapped(),f=n.getTile(y);if(d&&(!f||!f.hasData()))continue;const _=d?y.projMatrix:e.transform.calculateProjMatrix(o,g),v=e.terrain&&d?e.terrain.stencilModeForRTTOverlap(y):p[y.overscaledZ],x=s?0:i.paint.get("raster-fade-duration");f.registerFadeDuration(x);const b=n.findLoadedParent(y,0),w=cn(f,b,n,e.transform,x);let T,A;e.terrain&&e.terrain.prepareDrawTile(y);const S="nearest"===i.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;a.activeTexture.set(l.TEXTURE0),f.texture.bind(S,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),a.activeTexture.set(l.TEXTURE1),b?(b.texture.bind(S,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),T=Math.pow(2,b.tileID.overscaledZ-f.tileID.overscaledZ),A=[f.tileID.canonical.x*T%1,f.tileID.canonical.y*T%1]):f.texture.bind(S,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST);const C=Ln(_,A||[0,0],T||1,w,i);e.prepareDrawProgram(a,u,o),c instanceof At?u.draw(a,l.TRIANGLES,r,t.StencilMode.disabled,h,t.CullFaceMode.disabled,C,i.id,c.boundsBuffer,e.quadTriangleIndexBuffer,c.boundsSegments):u.draw(a,l.TRIANGLES,r,v,h,t.CullFaceMode.disabled,C,i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}},background:function(e,n,i,r){const o=i.paint.get("background-color"),s=i.paint.get("background-opacity");if(0===s)return;const a=e.context,l=a.gl,c=e.transform,u=c.tileSize,h=i.paint.get("background-pattern");if(e.isPatternMissing(h))return;const d=!h&&1===o.a&&1===s&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==d)return;const p=t.StencilMode.disabled,f=e.depthModeForSublayer(0,"opaque"===d?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly),m=e.colorModeForRenderPass(),g=e.useProgram(h?"backgroundPattern":"background"),y=r||c.coveringTiles({tileSize:u});h&&(a.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context));const _=i.getCrossfadeParameters();for(const v of y){const n=v.toUnwrapped(),c=r?v.projMatrix:e.transform.calculateProjMatrix(n);e.prepareDrawTile(v);const d=h?Un(c,s,e,h,{tileID:v,tileSize:u},_):Fn(c,s,o);e.prepareDrawProgram(a,g,n),g.draw(a,l.TRIANGLES,f,p,m,t.CullFaceMode.disabled,d,i.id,e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments)}},sky:function(e,n,i){const r=i.paint.get("sky-opacity");if(0===r)return;const o=e.context,s=i.paint.get("sky-type"),a=new t.DepthMode(o.gl.LEQUAL,t.DepthMode.ReadOnly,[0,1]),l=e.frameCounter/1e3%1;"atmosphere"===s?"offscreen"===e.renderPass?i.needsSkyboxCapture(e)&&(function(e,n,i,r){const o=e.context,s=o.gl;let a=n.skyboxFbo;if(!a){a=n.skyboxFbo=o.createFramebuffer(32,32,!1),n.skyboxGeometry=new ui(o),n.skyboxTexture=o.gl.createTexture(),s.bindTexture(s.TEXTURE_CUBE_MAP,n.skyboxTexture),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR);for(let t=0;t<6;++t)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,s.RGBA,32,32,0,s.RGBA,s.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(a.framebuffer),o.viewport.set([0,0,32,32]);const l=n.getCenter(e,!0),c=e.useProgram("skyboxCapture"),u=new Float64Array(16);t.identity(u),t.rotateY(u,u,.5*-Math.PI),hi(o,n,c,u,l,0),t.identity(u),t.rotateY(u,u,.5*Math.PI),hi(o,n,c,u,l,1),t.identity(u),t.rotateX(u,u,.5*-Math.PI),hi(o,n,c,u,l,2),t.identity(u),t.rotateX(u,u,.5*Math.PI),hi(o,n,c,u,l,3),t.identity(u),hi(o,n,c,u,l,4),t.identity(u),t.rotateY(u,u,Math.PI),hi(o,n,c,u,l,5),o.viewport.set([0,0,e.width,e.height])}(e,i),i.markSkyboxValid(e)):"sky"===e.renderPass&&function(e,n,i,r,o){const s=e.context,a=s.gl,l=e.transform,c=e.useProgram("skybox");s.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,n.skyboxTexture);const u={u_matrix:l.skyboxMatrix,u_sun_direction:n.getCenter(e,!1),u_cubemap:0,u_opacity:r,u_temporal_offset:o};e.prepareDrawProgram(s,c),c.draw(s,a.TRIANGLES,i,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.backCW,u,"skybox",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(e,i,a,r,l):"gradient"===s&&"sky"===e.renderPass&&function(e,n,i,r,o){const s=e.context,a=s.gl,l=e.transform,c=e.useProgram("skyboxGradient");n.skyboxGeometry||(n.skyboxGeometry=new ui(s)),s.activeTexture.set(a.TEXTURE0);let u=n.colorRampTexture;u||(u=n.colorRampTexture=new t.Texture(s,n.colorRamp,a.RGBA)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=(d=l.skyboxMatrix,p=n.getCenter(e,!1),f=n.paint.get("sky-gradient-radius"),m=r,g=o,{u_matrix:d,u_color_ramp:0,u_center_direction:p,u_radius:t.degToRad(f),u_opacity:m,u_temporal_offset:g});var d,p,f,m,g;e.prepareDrawProgram(s,c),c.draw(s,a.TRIANGLES,i,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.backCW,h,"skyboxGradient",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(e,i,a,r,l)},debug:function(t,e,n){for(let i=0;i<n.length;i++)si(t,e,n[i])},custom:function(e,n,i){const r=e.context,o=i.implementation;if("offscreen"===e.renderPass){const t=o.prerender;t&&(e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),t.call(o,r.gl,e.transform.customLayerMatrix()),r.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),r.setStencilMode(t.StencilMode.disabled);const n="3d"===o.renderingMode?new t.DepthMode(e.context.gl.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,t.DepthMode.ReadOnly);r.setDepthMode(n),o.render(r.gl,e.transform.customLayerMatrix()),r.setDirty(),e.setBaseState(),r.bindFramebuffer.set(null)}}};class pi{constructor(e,n){this.context=new xt(e),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=t.SourceCache.maxUnderzooming+t.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ze,this.gpuTimers={},this.frameCounter=0}updateTerrain(t,e){const n=!!t&&!!t.terrain;if(!(n||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new dn(this,t));const i=this._terrain;this.transform.elevation=n?i:null,i.update(t,this.transform,e)}_updateFog(t){const e=t.fog;if(!e||e.getOpacity(this.transform.pitch)<1||e.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[n,i]=e.getFovAdjustedRange(this.transform._fov);if(n>i)return void(this.transform.fogCullDistSq=null);const r=n+.78*(i-n);this.transform.fogCullDistSq=r*r}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(e,n){if(this.width=e*t.exported.devicePixelRatio,this.height=n*t.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style.order)this.style._layers[t].resize()}setup(){const e=this.context,n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(n,t.posAttributes.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);const i=new t.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(t.EXTENT,0),i.emplaceBack(0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(i,t.posAttributes.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);const r=new t.StructArrayLayout4i8;r.emplaceBack(0,0,0,0),r.emplaceBack(t.EXTENT,0,t.EXTENT,0),r.emplaceBack(0,t.EXTENT,0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(r,Tt.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);const o=new t.StructArrayLayout2i4;o.emplaceBack(-1,-1),o.emplaceBack(1,-1),o.emplaceBack(-1,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,t.posAttributes.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);const s=new t.StructArrayLayout1ui2;s.emplaceBack(0),s.emplaceBack(1),s.emplaceBack(3),s.emplaceBack(2),s.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(s);const a=new t.StructArrayLayout3ui6;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(a),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA),this.identityMat=t.create$1();const l=this.context.gl;this.stencilClearMode=new t.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(t.window.performance.now())}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(e,n.TRIANGLES,t.DepthMode.disabled,this.stencilClearMode,t.ColorMode.disabled,t.CullFaceMode.disabled,ln(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n,i){if(!(n&&this.currentStencilSource!==n.id&&e.isTileClipped()&&i&&i.length))return;this.currentStencilSource=n.id;const r=this.context,o=r.gl;this.nextStencilID+i.length>256&&this.clearStencil(),r.setColorMode(t.ColorMode.disabled),r.setDepthMode(t.DepthMode.disabled);const s=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const a of i){const e=this._tileClippingMaskIDs[a.key]=this.nextStencilID++;s.draw(r,o.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:o.ALWAYS,mask:0},e,255,o.KEEP,o.KEEP,o.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,ln(a.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new t.StencilMode({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const n=this.context.gl;return new t.StencilMode({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){const n=this.context.gl,i=e.sort((t,e)=>e.overscaledZ-t.overscaledZ),r=i[i.length-1].overscaledZ,o=i[0].overscaledZ-r+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const e={};for(let i=0;i<o;i++)e[i+r]=new t.StencilMode({func:n.GEQUAL,mask:255},i+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[e,i]}return[{[r]:t.StencilMode.disabled},i]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new t.ColorMode([e.CONSTANT_COLOR,e.ONE],new t.Color(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?t.ColorMode.unblended:t.ColorMode.alphaBlended}depthModeForSublayer(e,n,i){if(!this.opaquePassEnabledForLayer())return t.DepthMode.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new t.DepthMode(i||this.context.gl.LEQUAL,n,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.exported.now()),this.imageManager.beginFrame();const i=this.style.order,r=this.style._sourceCaches;for(const t in r){const e=r[t];e.used&&e.prepare(this.context)}const o={},s={},a={};for(const t in r){const e=r[t];o[t]=e.getVisibleCoordinates(),s[t]=o[t].slice().reverse(),a[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<i.length;t++)if(this.style._layers[i[t]].is3D()){this.opaquePassCutoff=t;break}if(this.terrain&&(this.terrain.updateTileBinding(a),this.opaquePassCutoff=0),!t.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const t of i){const n=this.style._layers[t],i=e._getLayerSourceCache(n);if(!n.hasOffscreenPass()||n.isHidden(this.transform.zoom))continue;const r=i?s[i.id]:void 0;("custom"===n.type||n.isSky()||r&&r.length)&&this.renderLayer(this,i,n,r)}this.depthRangeFor3D=[0,1-(e.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let l=t.Color.transparent;if(this.style.fog&&(l=this.style.fog.properties.get("color")),this.context.clear({color:n.showOverdrawInspector?t.Color.black:l,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[i[this.currentLayer]],n=e._getLayerSourceCache(t);if(t.isSky())continue;const r=n?s[n.id]:void 0;this._renderTileClippingMasks(t,n,r),this.renderLayer(this,n,t,r)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){const t=this.style._layers[i[this.currentLayer]],n=e._getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,n,t,n?s[n.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;){const t=this.style._layers[i[this.currentLayer]],n=e._getLayerSourceCache(t);if(t.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const r=n?("symbol"===t.type?a:s)[n.id]:void 0;this._renderTileClippingMasks(t,n,n?o[n.id]:void 0),this.renderLayer(this,n,t,r),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let n=null;t.values(this.style._layers).forEach(t=>{const i=e._getLayerSourceCache(t);i&&!t.isHidden(this.transform.zoom)&&(!n||n.getSource().maxzoom<i.getSource().maxzoom)&&(n=i)}),n&&this.options.showTileBoundaries&&di.debug(this,n,n.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;ii(t,t.transform.height-(e.top||0),3,Qn),ii(t,e.bottom||0,3,Kn),ri(t,e.left||0,3,ti),ri(t,t.transform.width-(e.right||0),3,ei);const n=t.transform.centerPoint;var i,r,o,s;oi(i=t,(r=n.x)-1,(o=t.transform.height-n.y)-10,2,20,s=ni),oi(i,r-10,o-1,20,2,s)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%t.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(t.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,e,n,i){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||i&&i.length)&&(this.id=n.id,this.gpuTimingStart(n),di[n.type](t,e,n,i,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;let n=this.gpuTimers[t.id];n||(n=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),n.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,n.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const e={};for(const n in t){const i=t[n],r=this.context.extTimerQuery,o=r.getQueryObjectEXT(i.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(i.query),e[n]=o}return e}translatePosMatrix(e,n,i,r,o){if(!i[0]&&!i[1])return e;const s=o?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(s){const t=Math.sin(s),e=Math.cos(s);i=[i[0]*e-i[1]*t,i[0]*t+i[1]*e]}const a=[o?i[0]:M(n,i[0],this.transform.zoom),o?i[1]:M(n,i[1],this.transform.zoom),0],l=new Float32Array(16);return t.translate(l,e,a),l}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const e=this.imageManager.getPattern(t.from.toString()),n=this.imageManager.getPattern(t.to.toString());return!e||!n}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,e=this.style&&this.style.fog,n=[];return this.terrain&&!this.terrain.renderingToTexture&&n.push("TERRAIN"),e&&!t&&0!==e.getOpacity(this.transform.pitch)&&n.push("FOG"),t&&n.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&n.push("OVERDRAW_INSPECTOR"),n}useProgram(t,e,n){this.cache=this.cache||{};const i=n||[],r=this.currentGlobalDefines().concat(i),o=fn.cacheKey(t,r,e);return this.cache[o]||(this.cache[o]=new fn(this.context,t,Je[t],e,Nn[t],r)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(t){this.terrain&&this.terrain.prepareDrawTile(t)}prepareDrawProgram(t,e,n){if(this.terrain&&this.terrain.renderingToTexture)return;const i=this.style.fog;if(i){const r=i.getOpacity(this.transform.pitch);0!==r&&e.setFogUniformValues(t,((t,e,n,i)=>{const r=e.properties.get("color"),o=t.frameCounter/1e3%1,s=[r.r/r.a,r.g/r.a,r.b/r.a,i];return{u_fog_matrix:n?t.transform.calculateFogTileMatrix(n):t.identityMat,u_fog_range:e.getFovAdjustedRange(t.transform._fov),u_fog_color:s,u_fog_horizon_blend:e.properties.get("horizon-blend"),u_fog_temporal_offset:o}})(this,i,n,r))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}}class fi{constructor(t=0,e=0,n=0,i=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=n,this.right=i}interpolate(e,n,i){return null!=n.top&&null!=e.top&&(this.top=t.number(e.top,n.top,i)),null!=n.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,n.bottom,i)),null!=n.left&&null!=e.left&&(this.left=t.number(e.left,n.left,i)),null!=n.right&&null!=e.right&&(this.right=t.number(e.right,n.right,i)),this}getCenter(e,n){const i=t.clamp((this.left+e-this.right)/2,0,e),r=t.clamp((this.top+n-this.bottom)/2,0,n);return new t.pointGeometry(i,r)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new fi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function mi(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function gi(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]}function yi(e,n){const i=mi(e,3);t.fromQuat(e,n),gi(e,3,i)}function _i(t,e){gi(t,3,[e[0],e[1],e[2],1])}function vi(e,n){const i=t.identity$1([]);return t.rotateZ$1(i,i,-n),t.rotateX$1(i,i,-e),i}function xi(e,n){const i=[e[0],e[1],0],r=[n[0],n[1],0];if(t.length(i)>=1e-15){const e=t.normalize([],i);t.scale(r,e,t.dot(r,e)),n[0]=r[0],n[1]=r[1]}const o=t.cross([],n,e);if(t.len(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return vi(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),s)}class bi{constructor(t,e){this.position=t,this.orientation=e}get position(){return this._position}set position(e){this._position=this._renderWorldCopies?function(e){if(!e)return;const n=Array.isArray(e)?new t.MercatorCoordinate(e[0],e[1],e[2]):e;return n.x=t.wrap(n.x,0,1),n}(e):e}lookAtPoint(e,n){if(this.orientation=null,!this.position)return;const i=this._elevation?this._elevation.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(e)):0,r=this.position,o=t.MercatorCoordinate.fromLngLat(e,i),s=[o.x-r.x,o.y-r.y,o.z-r.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=xi(s,n)}setPitchBearing(e,n){this.orientation=vi(t.degToRad(e),t.degToRad(-n))}}class wi{constructor(e,n){this._transform=t.identity([]),this._orientation=t.identity$1([]),n&&(this._orientation=n,yi(this._transform,this._orientation)),e&&_i(this._transform,e)}get mercatorPosition(){const e=this.position;return new t.MercatorCoordinate(e[0],e[1],e[2])}get position(){const t=mi(this._transform,3);return[t[0],t[1],t[2]]}set position(t){_i(this._transform,t)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,yi(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,e){this._orientation=vi(t,e),yi(this._transform,this._orientation)}forward(){const t=mi(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=mi(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=mi(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(e,n){const i=new Float64Array(16);return t.invert(i,this.getWorldToCamera(e,n)),i}getWorldToCameraPosition(e,n,i){const r=this.position;t.scale(r,r,-e);const o=new Float64Array(16);return t.fromScaling(o,[i,i,i]),t.translate(o,o,r),o[10]*=n,o}getWorldToCamera(e,n){const i=new Float64Array(16),r=new Float64Array(4),o=this.position;return t.conjugate(r,this._orientation),t.scale(o,o,-e),t.fromQuat(i,r),t.translate(i,i,o),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=n,i[9]*=n,i[10]*=n,i[11]*=n,i}getCameraToClipPerspective(e,n,i,r){const o=new Float64Array(16);return t.perspective(o,e,n,i,r),o}getDistanceToElevation(e){const n=0===e?0:t.mercatorZfromAltitude(e,this.position[1]),i=this.forward();return(n-this.position[2])/i[2]}clone(){return new wi([...this.position],[...this.orientation])}}class Ti{constructor(e,n,i,r,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==i?0:i,this._maxPitch=null==r?60:r,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new fi,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new wi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const t=new Ti(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._cameraZoom=this._cameraZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,t?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(t){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),t&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return t.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const n=-t.wrap(e,-180,180)*Math.PI/180;var i,r,o,s,a,l,c,u,h,d;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=(i=new t.ARRAY_TYPE(4),t.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i),r=this.rotationMatrix,s=this.angle,a=(o=this.rotationMatrix)[0],l=o[1],c=o[2],u=o[3],h=Math.sin(s),d=Math.cos(s),r[0]=a*d+c*h,r[1]=l*d+u*h,r[2]=a*-h+c*d,r[3]=l*-h+u*d)}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const e=this._elevation.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(this.center),-1);return-1===e?(this._cameraZoom=null,!1):(this._centerAltitude=e,!0)}_updateCameraOnTerrain(){const e=this.cameraToCenterDistance/this.worldSize,n=t.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(n+e)}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop();let r=0,o=0;for(let s=0;s<n.length;s++){const a=new t.pointGeometry(n[s][0]*this.width,i+n[s][1]*(this.height-i)),l=e.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*c,o+=c}return 0===o?NaN:r/o}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const e=this._cameraZoom,n=this._elevation.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(this.center)),i=t.mercatorZfromAltitude(n,this.center.lat),r=this._mercatorZfromZoom(e),o=this._mercatorZfromZoom(this._maxZoom),s=Math.max(r-i,o);this._setZoom(this._zoomFromMercatorZ(s))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(e){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let i;i=e.z<this._camera.position[2]?[n.x,n.y,n.z]:[e.x,e.y,e.z];const r=t.length(t.sub([],this._camera.position,i));return t.clamp(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height||!e.position&&!e.orientation)return;this._updateCameraState();let n=!1;if(e.orientation&&!t.exactEquals(e.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(e.orientation)),e.position){const i=[e.position.x,e.position.y,e.position.z];t.exactEquals$1(i,this._camera.position)||(this._setCameraPosition(i),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,n=new bi;return n.position=new t.MercatorCoordinate(e[0],e[1],e[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this._renderWorldCopies,n}_setCameraOrientation(e){if(!t.length$1(e))return!1;t.normalize$1(e,e);const n=t.transformQuat([],[0,0,-1],e),i=t.transformQuat([],[0,-1,0],e);if(i[2]<0)return!1;const r=xi(n,i);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(e){const n=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;e[2]=t.clamp(e[2],r/i,r/n),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,n){this._unmodified=!1,this._edgeInsets.interpolate(t,e,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const n=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies){const i=this.pointCoordinate(new t.pointGeometry(0,0)),r=this.pointCoordinate(new t.pointGeometry(this.width,0)),o=this.pointCoordinate(new t.pointGeometry(this.width,this.height)),s=this.pointCoordinate(new t.pointGeometry(0,this.height)),a=Math.floor(Math.min(i.x,r.x,o.x,s.x)),l=Math.floor(Math.max(i.x,r.x,o.x,s.x)),c=1;for(let u=a-c;u<=l+c;u++)0!==u&&n.push(new t.UnwrappedTileID(u,e))}return n}coveringTiles(e){let n=this.coveringZoomLevel(e);const i=n,r=this.elevation&&!e.isTerrainDEM;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);const o=t.MercatorCoordinate.fromLngLat(this.center),s=1<<n,a=[s*o.x,s*o.y,0],l=p.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n),c=this.pointCoordinate(this.getCameraPoint()),u=s*t.mercatorZfromAltitude(1,this.center.lat),h=this._camera.position[2]/t.mercatorZfromAltitude(1,this.center.lat),d=[s*c.x,s*c.y,h],m=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),g=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?n:0,y=e.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,_=e.isTerrainDEM?-y:this._elevation?this._elevation.getMinElevationBelowMSL():0,v=t=>({aabb:new f([t*s,0,_],[(t+1)*s,s,y]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}),x=[],b=[],w=n,T=e.reparseOverscaled?i:n,A=t=>{if(!this._elevation||!t.tileID)return;const e=this._elevation.getMinMaxForTile(t.tileID),n=t.aabb;e?(n.min[2]=e.min,n.max[2]=e.max,n.center[2]=(n.min[2]+n.max[2])/2):(t.shouldSplit=I(t),t.shouldSplit||(n.min[2]=n.max[2]=n.center[2]=this._centerAltitude))},S=t=>t*t,C=S((h-this._centerAltitude)*u),I=t=>{if(t.zoom<g)return!0;if(t.zoom===w)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const e=t.aabb.distanceX(d),n=t.aabb.distanceY(d);let i=C;r&&(i=S(t.aabb.distanceZ(d)*u));const o=e*e+n*n+i;return o<S((1<<w-t.zoom)*m*((t,e)=>{if(e*S(.707)<t)return 1;const n=Math.sqrt(e/t);return n/(1.4144271570014144+(Math.pow(1.1,n-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(i,C),o))};if(this._renderWorldCopies)for(let t=1;t<=3;t++)x.push(v(-t)),x.push(v(t));for(x.push(v(0));x.length>0;){const i=x.pop(),o=i.x,s=i.y;let c=i.fullyVisible;if(!c){const t=i.aabb.intersects(l);if(0===t)continue;c=2===t}if(i.zoom!==w&&I(i))for(let e=0;e<4;e++){const n=(o<<1)+e%2,a=(s<<1)+(e>>1),l={aabb:i.aabb.quadrant(e),zoom:i.zoom+1,x:n,y:a,wrap:i.wrap,fullyVisible:c,tileID:void 0,shouldSplit:void 0};r&&(l.tileID=new t.OverscaledTileID(i.zoom+1===w?T:i.zoom+1,i.wrap,i.zoom+1,n,a),A(l)),x.push(l)}else{const r=i.zoom===w?T:i.zoom;if(e.minzoom&&e.minzoom>r)continue;const l=a[0]-(.5+o+(i.wrap<<i.zoom))*(1<<n-i.zoom),c=a[1]-.5-s,u=i.tileID?i.tileID:new t.OverscaledTileID(r,i.wrap,i.zoom,o,s);b.push({tileID:u,distanceSq:l*l+c*c})}}if(this.fogCullDistSq){const e=this.fogCullDistSq;b.splice(0,b.length,...b.filter(n=>{const i=[0,0,0,1],o=[t.EXTENT,t.EXTENT,0,1],s=this.calculateFogTileMatrix(n.tileID.toUnwrapped());t.transformMat4(i,i,s),t.transformMat4(o,o,s);const a=t.getAABBPointSquareDist(i,o);if(0===a)return!0;let l=!1;const c=this.horizonLineFromTop();if(a>e&&0!==c){const e=this.calculateProjMatrix(n.tileID.toUnwrapped());let i;r&&this._elevation&&(i=this._elevation.getMinMaxForTile(n.tileID)),i||(i={min:_,max:y});const o=t.furthestTileCorner(this.bearing),s=[o[0]*t.EXTENT,o[1]*t.EXTENT,i.max];t.transformMat4$1(s,s,e),l=(1-s[1])*this.height*.5<c}return a<e||l}))}return b.sort((t,e)=>t.distanceSq-e.distanceSq).map(t=>t.tileID)}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const n=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.pointGeometry(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(n)*this.worldSize)}unproject(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(e,n){const i=this.pointCoordinate(n),r=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),s=new t.MercatorCoordinate(o.x-(i.x-r.x),o.y-(i.y-r.y));this.center=this.coordinateLocation(s),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(t){this.center=this.coordinateLocation(t),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this._coordinatePoint(this.locationCoordinate(t),!1)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(e){return t.MercatorCoordinate.fromLngLat(e)}coordinateLocation(t){return t.toLngLat()}pointRayIntersection(e,n){const i=null!=n?n:this._centerAltitude,r=[e.x,e.y,0,1],o=[e.x,e.y,1,1];t.transformMat4(r,r,this.pixelMatrixInverse),t.transformMat4(o,o,this.pixelMatrixInverse);const s=o[3];t.scale$2(r,r,1/r[3]),t.scale$2(o,o,1/s);const a=r[2],l=o[2];return{p0:r,p1:o,t:a===l?0:(i-a)/(l-a)}}screenPointToMercatorRay(e){const n=[e.x,e.y,0,1],i=[e.x,e.y,1,1];return t.transformMat4(n,n,this.pixelMatrixInverse),t.transformMat4(i,i,this.pixelMatrixInverse),t.scale$2(n,n,1/n[3]),t.scale$2(i,i,1/i[3]),n[2]=t.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,i[2]=t.mercatorZfromAltitude(i[2],this._center.lat)*this.worldSize,t.scale$2(n,n,1/this.worldSize),t.scale$2(i,i,1/this.worldSize),new d([n[0],n[1],n[2]],t.normalize([],t.sub([],i,n)))}rayIntersectionCoordinate(e){const{p0:n,p1:i,t:r}=e,o=t.mercatorZfromAltitude(n[2],this._center.lat),s=t.mercatorZfromAltitude(i[2],this._center.lat);return new t.MercatorCoordinate(t.number(n[0],i[0],r)/this.worldSize,t.number(n[1],i[1],r)/this.worldSize,t.number(o,s,r))}pointCoordinate(e){const n=this.horizonLineFromTop(!1),i=new t.pointGeometry(e.x,Math.max(n,e.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(i))}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);const n=this.elevation;let i=this.elevation.pointCoordinate(e);if(i)return new t.MercatorCoordinate(i[0],i[1],i[2]);let r=0,o=this.horizonLineFromTop();if(e.y>o)return this.pointCoordinate(e);const s=.02*o,a=e.clone();for(let l=0;l<10&&o-r>s;l++){a.y=t.number(r,o,.66);const e=n.pointCoordinate(a);e?(o=a.y,i=e):r=a.y}return i?new t.MercatorCoordinate(i[0],i[1],i[2]):this.pointCoordinate(e)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const e=this.horizonLineFromTop();return t.y<e}}_coordinatePoint(e,n){const i=n&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,r=[e.x*this.worldSize,e.y*this.worldSize,i+e.toAltitude(),1];return t.transformMat4(r,r,this.pixelMatrix),r[3]>0?new t.pointGeometry(r[0]/r[3],r[1]/r[3]):new t.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}getBounds(){return this._terrainEnabled()?this._getBounds3D():(new t.LngLatBounds).extend(this.pointLocation(new t.pointGeometry(this._edgeInsets.left,this._edgeInsets.top))).extend(this.pointLocation(new t.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top))).extend(this.pointLocation(new t.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom))).extend(this.pointLocation(new t.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom)))}_getBounds3D(){const e=this.elevation,n=e.visibleDemTiles.reduce((t,e)=>{if(e.dem){const n=e.dem.tree;t.min=Math.min(t.min,n.minimums[0]),t.max=Math.max(t.max,n.maximums[0])}return t},{min:Number.MAX_VALUE,max:0});n.min*=e.exaggeration(),n.max*=e.exaggeration();const i=this.horizonLineFromTop();return[new t.pointGeometry(0,i),new t.pointGeometry(this.width,i),new t.pointGeometry(this.width,this.height),new t.pointGeometry(0,this.height)].reduce((t,e)=>t.extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(e,n.min)))).extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(e,n.max)))),new t.LngLatBounds)}horizonLineFromTop(t=!0){const e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,n=this.height/2-.97*e;return t?Math.max(0,n):n}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(e,n){const i=e.canonical,r=n/this.zoomScale(i.z),o=i.x+Math.pow(2,i.z)*e.wrap,s=t.identity(new Float64Array(16));return t.translate(s,s,[o*r,i.y*r,0]),t.scale$1(s,s,[r/t.EXTENT,r/t.EXTENT,1]),s}calculateFogTileMatrix(e){const n=e.key,i=this._fogTileMatrixCache;if(i[n])return i[n];const r=this.calculatePosMatrix(e,this.cameraWorldSize);return t.multiply(r,this.worldToFogMatrix,r),i[n]=new Float32Array(r),i[n]}calculateProjMatrix(e,n=!1){const i=e.key,r=n?this._alignedProjMatrixCache:this._projMatrixCache;if(r[i])return r[i];const o=this.calculatePosMatrix(e,this.worldSize);return t.multiply(o,n?this.alignedProjMatrix:this.projMatrix,o),r[i]=new Float32Array(o),r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const e=this._elevation;this._updateCameraState();const n=this._camera.position,i=this._camera.forward();if(n[2]<=0||i[2]>=0)return;const r=t.mercatorZfromAltitude(1,this._center.lat);n[2]/=r,i[2]/=r,t.normalize(i,i);const o=e.raycast(n,i,e.exaggeration());if(o){const e=t.scaleAndAdd([],n,i,o),r=new t.MercatorCoordinate(e[0],e[1],t.mercatorZfromAltitude(e[2],t.latFromMercatorY(e[1]))),s=this._camera.position,a=r.z+t.length([r.x-s[0],r.y-s[1],r.z-s[2]]);this._cameraZoom=this._zoomFromMercatorZ(a),this._centerAltitude=r.toAltitude(),this._center=r.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const e=this._elevation;this._updateCameraState();const n=e.getAtPointOrZero(this._camera.mercatorPosition),i=this._minimumHeightOverTerrain()*Math.cos(t.degToRad(this._maxPitch)),r=t.mercatorZfromAltitude(n,this._center.lat),o=this._camera.position[2]-r;if(o<i){const e=t.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),n=this._camera.mercatorPosition,r=[e.x-n.x,e.y-n.y,e.z-n.z],s=t.length(r);r[2]-=i-o;const a=t.length(r);if(0===a)return;t.scale(r,r,s/a),this._camera.position=[e.x-r[0],e.y-r[1],e.z-r[2]],this._camera.orientation=xi(r,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e,n,i,r,o=-90,s=90,a=-180,l=180;const c=this.size,u=this._unmodified;if(this.latRange){const n=this.latRange;o=t.mercatorYfromLat(n[1])*this.worldSize,s=t.mercatorYfromLat(n[0])*this.worldSize,e=s-o<c.y?c.y/(s-o):0}if(this.lngRange){const e=this.lngRange;a=t.mercatorXfromLng(e[0])*this.worldSize,l=t.mercatorXfromLng(e[1])*this.worldSize,n=l-a<c.x?c.x/(l-a):0}const h=this.point,d=Math.max(n||0,e||0);if(d)return this.center=this.unproject(new t.pointGeometry(n?(l+a)/2:h.x,e?(s+o)/2:h.y)),this.zoom+=this.scaleZoom(d),this._unmodified=u,void(this._constraining=!1);if(this.latRange){const t=h.y,e=c.y/2;t-e<o&&(r=o+e),t+e>s&&(r=s-e)}if(this.lngRange){const t=h.x,e=c.x/2;t-e<a&&(i=a+e),t+e>l&&(i=l-e)}void 0===i&&void 0===r||(this.center=this.unproject(new t.pointGeometry(void 0!==i?i:h.x,void 0!==r?r:h.y))),this._constrainCameraAltitude(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){const e=(t,e)=>Math.log2(t/(this.tileSize*Math.abs(e[1]-e[0])));let n=0;if(this.latRange){const i=this.latRange;n=e(this.height,[t.mercatorYfromLat(i[0]),t.mercatorYfromLat(i[1])])}let i=0;if(this.lngRange){const n=this.lngRange;i=e(this.width,[t.mercatorXfromLng(n[0]),t.mercatorXfromLng(n[1])])}return Math.max(n,i)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const n=this.pixelsPerMeter;this._updateCameraState();const i=Math.PI/2+this._pitch,r=this.fovAboveCenter,o=this.elevation?this.elevation.getMinElevationBelowMSL()*n:0,s=(this._camera.position[2]*this.worldSize-o)/Math.cos(this._pitch),a=Math.sin(r)*s/Math.sin(t.clamp(Math.PI-i-r,.01,Math.PI-.01)),l=this.point,c=l.x,u=l.y,h=Math.cos(Math.PI/2-this._pitch)*a+s,d=Math.min(1.01*h,s*(1/this._horizonShift)),p=this.height/50,f=this._camera.getWorldToCamera(this.worldSize,n),m=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,p,d);m[8]=2*-e.x/this.width,m[9]=2*e.y/this.height;let g=t.mul$1([],m,f);this.mercatorMatrix=t.scale$1([],g,[this.worldSize,this.worldSize,this.worldSize/n]),this.projMatrix=g,this.invProjMatrix=t.invert(new Float64Array(16),this.projMatrix);const y=new Float32Array(16);t.identity(y),t.scale$1(y,y,[1,-1,1]),t.rotateX(y,y,this._pitch),t.rotateZ(y,y,this.angle);const _=t.perspective(new Float32Array(16),this._fov,this.width/this.height,p,d),v=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;_[8]=2*-e.x/this.width,_[9]=2*(e.y+v)/this.height,this.skyboxMatrix=t.multiply(y,_,y);const x=this.width%2/2,b=this.height%2/2,w=Math.cos(this.angle),T=Math.sin(this.angle),A=c-Math.round(c)+w*x+T*b,S=u-Math.round(u)+w*b+T*x,C=new Float64Array(g);if(t.translate(C,C,[A>.5?A-1:A,S>.5?S-1:S,0]),this.alignedProjMatrix=C,g=t.create$1(),t.scale$1(g,g,[this.width/2,-this.height/2,1]),t.translate(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=t.create$1(),t.scale$1(g,g,[1,-1,1]),t.translate(g,g,[-1,-1,0]),t.scale$1(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),g=t.invert(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSize,n=this.cameraPixelsPerMeter,i=this._camera.position,r=1/this.height,o=[e,e,n];t.scale(o,o,r),t.scale(i,i,-1),t.multiply$1(i,i,o);const s=t.create$1();t.translate(s,s,i),t.scale$1(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,n,r)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const e=this._camera.forward(),n=this.cameraToCenterDistance,i=this.point,r=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-t.mercatorZfromAltitude(this._centerAltitude,this.center.lat),o=this.cameraToCenterDistance/r;this._camera.position=[i.x/this.worldSize-e[0]*n/o,i.y/this.worldSize-e[1]*n/o,t.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-e[2]*n/o]}_translateCameraConstrained(e){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=e[2];let r=1;i>0&&(r=Math.min((n-this._camera.position[2])/i,1)),this._camera.position=t.scaleAndAdd([],this._camera.position,e,r),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,n=this._camera.forward(),{pitch:i,bearing:r}=this._camera.getPitchBearing(),o=t.mercatorZfromAltitude(this._centerAltitude,this.center.lat),s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.degToRad(this._maxPitch)),a=Math.max((e[2]-o)/Math.cos(i),s),l=this._zoomFromMercatorZ(a);t.scaleAndAdd(e,e,n,a),this._pitch=t.clamp(i,t.degToRad(this.minPitch),t.degToRad(this.maxPitch)),this.angle=t.wrap(r,-Math.PI,Math.PI),this._setZoom(t.clamp(l,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new t.MercatorCoordinate(e[0],e[1],e[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!!this._elevation}isHorizonVisibleForPoints(e,n){const i=Math.min(e.x,n.x),r=Math.max(e.x,n.x),o=Math.min(e.y,n.y),s=Math.max(e.y,n.y),a=[new t.pointGeometry(i,o),new t.pointGeometry(r,s),new t.pointGeometry(i,s),new t.pointGeometry(r,o)],l=this._renderWorldCopies?-3:0,c=this._renderWorldCopies?4:1;for(const t of a){const e=this.pointRayIntersection(t);if(e.t<0)return!0;const n=this.rayIntersectionCoordinate(e);if(n.x<l||n.y<0||n.x>c||n.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.radToDeg(this.fovAboveCenter)>88||this.isHorizonVisibleForPoints(new t.pointGeometry(0,0),new t.pointGeometry(this.width,this.height))}zoomDeltaToMovement(e,n){const i=t.length(t.sub([],this._camera.position,e)),r=this._zoomFromMercatorZ(i)+n;return i-this._mercatorZfromZoom(r)}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.pointGeometry(0,e))}}function Ai(t,e){let n=!1,i=null;const r=()=>{i=null,n&&(t(),i=setTimeout(r,e),n=!1)};return()=>(n=!0,i||r(),i)}class Si{constructor(e){this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ai(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){const n=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,r),s=Math.round(n.lng*o)/o,a=Math.round(n.lat*o)/o,l=this._map.getBearing(),c=this._map.getPitch();let u="";if(u+=e?`/${s}/${a}/${i}`:`${i}/${a}/${s}`,(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),this._hashName){const e=this._hashName;let n=!1;const i=t.window.location.hash.slice(1).split("&").map(t=>{const i=t.split("=")[0];return i===e?(n=!0,`${i}=${u}`):t}).filter(t=>t);return n||i.push(`${e}=${u}`),`#${i.join("&")}`}return`#${u}`}_getCurrentHash(){const e=t.window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(t=>t.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(t=>isNaN(t))){const e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());t.window.history.replaceState(t.window.history.state,null,e)}}const Ci={linearity:.3,easing:t.bezier(0,0,.3,1)},Ii=t.extend({deceleration:2500,maxSpeed:1400},Ci),Ei=t.extend({deceleration:20,maxSpeed:1400},Ci),Mi=t.extend({deceleration:1e3,maxSpeed:360},Ci),ki=t.extend({deceleration:1e3,maxSpeed:90},Ci);class Pi{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.exported.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=t.exported.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new t.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)n.zoom+=t.zoomDelta||0,n.bearing+=t.bearingDelta||0,n.pitch+=t.pitchDelta||0,t.panDelta&&n.pan._add(t.panDelta),t.around&&(n.around=t.around),t.pinchAround&&(n.pinchAround=t.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(n.pan.mag()){const o=Li(n.pan.mag(),i,t.extend({},Ii,e||{}));r.offset=n.pan.mult(o.amount/n.pan.mag()),r.center=this._map.transform.center,Di(r,o)}if(n.zoom){const t=Li(n.zoom,i,Ei);r.zoom=this._map.transform.zoom+t.amount,Di(r,t)}if(n.bearing){const e=Li(n.bearing,i,Mi);r.bearing=this._map.transform.bearing+t.clamp(e.amount,-179,179),Di(r,e)}if(n.pitch){const t=Li(n.pitch,i,ki);r.pitch=this._map.transform.pitch+t.amount,Di(r,t)}if(r.zoom||r.bearing){const t=void 0===n.pinchAround?n.around:n.pinchAround;r.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),t.extend(r,{noMoveStart:!0})}}function Di(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Li(e,n,i){const{maxSpeed:r,linearity:o,deceleration:s}=i,a=t.clamp(e*o/(n/1e3),-r,r),l=Math.abs(a)/(s*o);return{easing:i.easing,duration:1e3*l,amount:a*(l/2)}}class Oi extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i,r={}){const s=o.mousePos(n.getCanvasContainer(),i),a=n.unproject(s);super(e,t.extend({point:s,lngLat:a,originalEvent:i},r)),this._defaultPrevented=!1,this.target=n}}class Ri extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i){const r="touchend"===e?i.changedTouches:i.touches,s=o.touchPos(n.getCanvasContainer(),r),a=s.map(t=>n.unproject(t)),l=s.reduce((t,e,n,i)=>t.add(e.div(i.length)),new t.pointGeometry(0,0));super(e,{points:s,point:l,lngLats:a,lngLat:n.unproject(l),originalEvent:i}),this._defaultPrevented=!1}}class zi extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,n){super(t,{originalEvent:n}),this._defaultPrevented=!1}}class Zi{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new zi(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new Oi(t.type,this._map,t))}mouseup(t){this._map.fire(new Oi(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Oi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Oi(t.type,this._map,t))}mouseover(t){this._map.fire(new Oi(t.type,this._map,t))}mouseout(t){this._map.fire(new Oi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ri(t.type,this._map,t))}touchmove(t){this._map.fire(new Ri(t.type,this._map,t))}touchend(t){this._map.fire(new Ri(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ri(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fi{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Oi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Oi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Oi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ui{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(o.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const n=e;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const i=this._startPos;this._lastPos=n,this._box||(this._box=o.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const r=Math.min(i.x,n.x),s=Math.max(i.x,n.x),a=Math.min(i.y,n.y),l=Math.max(i.y,n.y);this._map._requestDomTask(()=>{this._box&&(o.setTransform(this._box,`translate(${r}px,${a}px)`),this._box.style.width=s-r+"px",this._box.style.height=l-a+"px")})}mouseupWindow(e,n){if(!this._active||0!==e.button)return;const i=this._startPos,r=n;if(this.reset(),o.suppressClick(),i.x!==r.x||i.y!==r.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(i,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(o.remove(this._box),this._box=null),o.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new t.Event(e,{originalEvent:n}))}}function Ni(t,e){const n={};for(let i=0;i<t.length;i++)n[t[i].identifier]=e[i];return n}class Bi{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),i.length===this.numTouches&&(this.centroid=function(e){const n=new t.pointGeometry(0,0);for(const t of e)n._add(t);return n.div(e.length)}(n),this.touches=Ni(i,n)))}touchmove(t,e,n){if(this.aborted||!this.centroid)return;const i=Ni(n,e);for(const r in this.touches){const t=this.touches[r],e=i[r];(!e||e.dist(t)>30)&&(this.aborted=!0)}}touchend(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class qi{constructor(t){this.singleTap=new Bi(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,n){this.singleTap.touchstart(t,e,n)}touchmove(t,e,n){this.singleTap.touchmove(t,e,n)}touchend(t,e,n){const i=this.singleTap.touchend(t,e,n);if(i){const e=t.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(i)<30;if(e&&n||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class $i{constructor(){this._zoomIn=new qi({numTouches:1,numTaps:2}),this._zoomOut=new qi({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,n){this._zoomIn.touchstart(t,e,n),this._zoomOut.touchstart(t,e,n)}touchmove(t,e,n){this._zoomIn.touchmove(t,e,n),this._zoomOut.touchmove(t,e,n)}touchend(t,e,n){const i=this._zoomIn.touchend(t,e,n),r=this._zoomOut.touchend(t,e,n);return i?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}):r?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(r)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Vi={0:1,2:2};class ji{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){if(this._lastPoint)return;const n=o.mouseButton(t);this._correctButton(t,n)&&(this._lastPoint=e,this._eventButton=n)}mousemoveWindow(t,e){const n=this._lastPoint;if(n)if(t.preventDefault(),function(t,e){const n=Vi[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(n,e)}mouseupWindow(t){this._lastPoint&&o.mouseButton(t)===this._eventButton&&(this._moved&&o.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gi extends ji{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class Yi extends ji{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const n=.8*(e.x-t.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(t){t.preventDefault()}}class Hi extends ji{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const n=-.5*(e.y-t.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(t){t.preventDefault()}}class Ji{constructor(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new t.pointGeometry(0,0)}touchstart(t,e,n){return this._calculateTransform(t,e,n)}touchmove(t,e,n){if(this._active&&!(n.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,n)}touchend(t,e,n){this._calculateTransform(t,e,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,i){i.length>0&&(this._active=!0);const r=Ni(i,n),o=new t.pointGeometry(0,0),s=new t.pointGeometry(0,0);let a=0;for(const t in r){const e=r[t],n=this._touches[t];n&&(o._add(e),s._add(e.sub(n)),a++,r[t]=e)}if(this._touches=r,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wi{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,e,n){return{}}touchstart(t,e,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,n){if(!this._firstTwoTouches)return;t.preventDefault();const[i,r]=this._firstTwoTouches,o=Xi(n,e,i),s=Xi(n,e,r);if(!o||!s)return;const a=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],a,t)}touchend(t,e,n){if(!this._firstTwoTouches)return;const[i,r]=this._firstTwoTouches,s=Xi(n,e,i),a=Xi(n,e,r);s&&a||(this._active&&o.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xi(t,e,n){for(let i=0;i<t.length;i++)if(t[i].identifier===n)return e[i]}function Qi(t,e){return Math.log(t/e)/Math.LN2}class Ki extends Wi{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const n=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Qi(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Qi(this._distance,n),pinchAround:e}}}function tr(t,e){return 180*t.angleWith(e)/Math.PI}class er extends Wi{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const n=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tr(this._vector,n),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,n=tr(t,this._startVector);return Math.abs(n)<e}}function nr(t){return Math.abs(t.y)>Math.abs(t.x)}class ir extends Wi{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(t){this._lastPoints=t,nr(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,n){const i=t[0].sub(this._lastPoints[0]),r=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(i,r,n.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(i.y+r.y)/2*-.5}}gestureBeginsVertically(t,e,n){if(void 0!==this._valid)return this._valid;const i=t.mag()>=2,r=e.mag()>=2;if(!i&&!r)return;if(!i||!r)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return nr(t)&&nr(e)&&o}}const rr={panStep:100,bearingStep:15,pitchStep:10};class or{constructor(){const t=rr;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,n=0,i=0,r=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:sr,zoom:e?Math.round(a)+e*(t.shiftKey?2:1):a,bearing:s.getBearing()+n*this._bearingStep,pitch:s.getPitch()+i*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function sr(t){return t*(2-t)}const ar=4.000244140625;class lr{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,t.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;let n=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const i=t.exported.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%ar==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=o.mousePos(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._map.transform,n=()=>e._terrainEnabled()?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>ar?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==i&&(i=1/i);const r=n(),o=Math.pow(2,r),s="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(s*i))),"wheel"===this._type&&(this._startZoom=n(),this._easing=this._smoothOutEasing(200)),this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:n(),r=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&r&&o){const e=Math.min((t.exported.now()-this._lastWheelEventTime)/200,1),n=o(e);s=t.number(r,i,n),e<1?this._frameId||(this._frameId=!0):a=!0}else s=i,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:s-n(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=t.ease;if(this._prevEase){const e=this._prevEase,i=(t.exported.now()-e.start)/e.duration,r=e.easing(i+.01)-e.easing(i),o=.27/Math.sqrt(r*r+1e-4)*.01,s=Math.sqrt(.0729-o*o);n=t.bezier(o,s,.25,1)}return this._prevEase={start:t.exported.now(),duration:e,easing:n},n}reset(){this._active=!1}}class cr{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ur{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,e){return t.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hr{constructor(){this._tap=new qi({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,e,n){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=e[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(t,e,n))}touchmove(t,e,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const i=e[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,t.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(t,e,n)}touchend(t,e,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(t,e,n)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dr{constructor(t,e,n){this._el=t,this._mousePan=e,this._touchPan=n}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pr{constructor(t,e,n){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class fr{constructor(t,e,n,i){this._el=t,this._touchZoom=e,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const mr=t=>t.zoom||t.drag||t.pitch||t.rotate;class gr extends t.Event{}class yr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,n){const i=t.sub([],n,e);this.radius=t.length(i[2]<0?t.div([],i,this.constants):[i[0],i[1],0])}projectRay(e){t.div(e,e,this.constants),t.normalize(e,e),t.mul$2(e,e,this.constants);const n=t.scale([],e,this.radius);if(n[2]>0){const e=t.scale([],[0,0,1],t.dot(n,[0,0,1])),i=t.scale([],t.normalize([],[n[0],n[1],0]),this.radius),r=t.add([],n,t.scale([],t.sub([],t.add([],i,e),n),2));n[0]=r[0],n[1]=r[1]}return n}}function _r(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class vr{constructor(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pi(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new yr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),t.bindAll(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[t.window,"blur",void 0]];for(const[r,s,a]of this._listeners)o.addEventListener(r,s,r===t.window.document?this.handleWindowEvent:this.handleEvent,a)}destroy(){for(const[e,n,i]of this._listeners)o.removeEventListener(e,n,e===t.window.document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(t){const e=this._map,n=e.getCanvasContainer();this._add("mapEvent",new Zi(e,t));const i=e.boxZoom=new Ui(e,t);this._add("boxZoom",i);const r=new $i,o=new ur;e.doubleClickZoom=new cr(o,r),this._add("tapZoom",r),this._add("clickZoom",o);const s=new hr;this._add("tapDragZoom",s);const a=e.touchPitch=new ir;this._add("touchPitch",a);const l=new Yi(t),c=new Hi(t);e.dragRotate=new pr(t,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new Gi(t),h=new Ji(t);e.dragPan=new dr(n,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new er,p=new Ki;e.touchZoomRotate=new fr(n,p,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Fi(e));const f=e.scrollZoom=new lr(e,this);this._add("scrollZoom",f,["mousePan"]);const m=e.keyboard=new or;this._add("keyboard",m);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[g]&&e[g].enable(t[g])}_add(t,e,n){this._handlers.push({handlerName:t,handler:e,allowed:n}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(mr(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,e,n){for(const i in t)if(i!==n&&(!e||e.indexOf(i)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const e=[];for(const n of t)this._el.contains(n.target)&&e.push(n);return e}handleEvent(t,e){if("blur"===t.type)return void this.stop(!0);this._updatingCamera=!0;const n="renderFrame"===t.type,i=n?void 0:t,r={needsRenderFrame:!1},s={},a={},l=t.touches?this._getMapTouches(t.touches):void 0,c=l?o.touchPos(this._el,l):n?void 0:o.mousePos(this._el,t);for(const{handlerName:o,handler:d,allowed:p}of this._handlers){if(!d.isEnabled())continue;let n;this._blockedByActive(a,p,o)?d.reset():d[e||t.type]&&(n=d[e||t.type](t,c,l),this.mergeHandlerResult(r,s,n,o,i),n&&n.needsRenderFrame&&this._triggerRenderFrame()),(n||d.isActive())&&(a[o]=d)}const u={};for(const o in this._previousActiveHandlers)a[o]||(u[o]=i);this._previousActiveHandlers=a,(Object.keys(u).length||_r(r))&&(this._changes.push([r,s,u]),this._triggerRenderFrame()),(Object.keys(a).length||_r(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:h}=r;h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map))}mergeHandlerResult(e,n,i,r,o){if(!i)return;t.extend(e,i);const s={handlerName:r,originalEvent:i.originalEvent||o};void 0!==i.zoomDelta&&(n.zoom=s),void 0!==i.panDelta&&(n.drag=s),void 0!==i.pitchDelta&&(n.pitch=s),void 0!==i.bearingDelta&&(n.rotate=s)}_applyChanges(){const e={},n={},i={};for(const[r,o,s]of this._changes)r.panDelta&&(e.panDelta=(e.panDelta||new t.pointGeometry(0,0))._add(r.panDelta)),r.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(e.around=r.around),void 0!==r.aroundCoord&&(e.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(e.pinchAround=r.pinchAround),r.noInertia&&(e.noInertia=r.noInertia),t.extend(n,o),t.extend(i,s);this._updateMapTransform(e,n,i),this._changes=[]}_updateMapTransform(e,n,i){const r=this._map,o=r.transform,s=t=>[t.x,t.y,t.z];if((t=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!_r(e)){const t=o.zoom;o.cameraElevationReference="sea",o.recenterOnTerrain(),o.cameraElevationReference="ground",t!==o.zoom&&this._map._update(!0)}if(!_r(e))return this._fireEvents(n,i,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:p}=e;void 0!==p&&(h=p),(t=>n.drag&&!this._eventsInProgress.drag)()&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",r._stop(!0),h=h||r.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(a){const t=o.screenPointToMercatorRay(h),e=o.screenPointToMercatorRay(h.sub(a)),n=this._trackingEllipsoid.projectRay(t.dir),i=this._trackingEllipsoid.projectRay(e.dir);f[0]=i[0]-n[0],f[1]=i[1]-n[1]}const m=o.zoom,g=[0,0,0];if(l){const e=s(d||o.pointCoordinate3D(h)),n={dir:t.normalize([],t.sub([],e,o._camera.position))},i=o.screenPointToMercatorRay(o.centerPoint);if(n.dir[2]<0){const r=t.altitudeFromMercatorZ(e[2],e[1]),a=o.rayIntersectionCoordinate(o.pointRayIntersection(o.centerPoint,r)),c=o.zoomDeltaToMovement(s(a),l)*(i.dir[2]/n.dir[2]);t.scale(g,n.dir,c)}else if(o._terrainEnabled()){const i=o.zoomDeltaToMovement(e,l);t.scale(g,n.dir,i)}}const y=t.add(f,f,g);o._translateCameraConstrained(y),l&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,i,!0)}_fireEvents(e,n,i){const r=mr(this._eventsInProgress),o=mr(e),s={};for(const t in e){const{originalEvent:n}=e[t];this._eventsInProgress[t]||(s[`${t}start`]=n),this._eventsInProgress[t]=e[t]}!r&&o&&this._fireEvent("movestart",o.originalEvent);for(const t in s)this._fireEvent(t,s[t]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:n}=e[t];this._fireEvent(t,n)}const a={};let l;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:i}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],l=n[e]||i,a[`${t}end`]=l)}for(const t in a)this._fireEvent(t,a[t]);const c=mr(this._eventsInProgress);if(i&&(r||o)&&!c){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;e?(n(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:l})):(this._map.fire(new t.Event("moveend",{originalEvent:l})),n(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new gr("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class xr extends t.Evented{constructor(e,n){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}getCenter(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,n,i){return e=t.pointGeometry.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},n),i)}panTo(e,n,i){return this.easeTo(t.extend({center:e},n),i)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,n,i){return this.easeTo(t.extend({zoom:e},n),i)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,n,i){return this.easeTo(t.extend({bearing:e},n),i)}resetNorth(e,n){return this.rotateTo(0,t.extend({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(e,n){e=t.LngLatBounds.convert(e);const i=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),i,n)}_extendCameraOptions(e){const n={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=t.extend({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const t=e.padding;e.padding={top:t,bottom:t,right:t,left:t}}return e.padding=t.extend(n,e.padding),e}_cameraForBoxAndBearing(e,n,i,r){const o=this._extendCameraOptions(r),s=this.transform,a=s.padding,l=s.project(t.LngLat.convert(e)),c=s.project(t.LngLat.convert(n)),u=l.rotate(-t.degToRad(i)),h=c.rotate(-t.degToRad(i)),d=new t.pointGeometry(Math.max(u.x,h.x),Math.max(u.y,h.y)),p=new t.pointGeometry(Math.min(u.x,h.x),Math.min(u.y,h.y)),f=d.sub(p),m=(s.width-(a.left+a.right+o.padding.left+o.padding.right))/f.x,g=(s.height-(a.top+a.bottom+o.padding.top+o.padding.bottom))/f.y;if(g<0||m<0)return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const y=Math.min(s.scaleZoom(s.scale*Math.min(m,g)),o.maxZoom),_="number"==typeof o.offset.x?new t.pointGeometry(o.offset.x,o.offset.y):t.pointGeometry.convert(o.offset),v=new t.pointGeometry((o.padding.left-o.padding.right)/2,(o.padding.top-o.padding.bottom)/2).rotate(i*Math.PI/180),x=_.add(v).mult(s.scale/s.zoomScale(y));return{center:s.unproject(l.add(c).div(2).sub(x)),zoom:y,bearing:i}}_cameraForBox(e,n,i,r,o){const s=this._extendCameraOptions(o);i=i||0,r=r||0,e=t.LngLat.convert(e),n=t.LngLat.convert(n);const a=this.transform.clone();a.padding=s.padding;const l=this.getFreeCameraOptions(),c=new t.LngLat(.5*(e.lng+n.lng),.5*(e.lat+n.lat)),u=.5*(i+r);if(a._camera.position[2]<t.mercatorZfromAltitude(u,c.lat))return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");l.lookAtPoint(c),a.setFreeCameraOptions(l);const h=t.MercatorCoordinate.fromLngLat(e),d=t.MercatorCoordinate.fromLngLat(n),m=a.pointRayIntersection(a.centerPoint,u),g=[(y=a.rayIntersectionCoordinate(m)).x,y.y,y.z];var y;const _=a.screenPointToMercatorRay(a.centerPoint);let v,x=0;do{const e=Math.floor(a.zoom),n=1<<e,o=Math.min(n*h.x,n*d.x),s=Math.min(n*h.y,n*d.y),l=Math.max(n*h.x,n*d.x),c=Math.max(n*h.y,n*d.y),u=new f([o,s,i],[l,c,r]),m=p.fromInvProjectionMatrix(a.invProjMatrix,a.worldSize,e);if(2!==u.intersects(m)){v&&(a._camera.position=t.scaleAndAdd([],a._camera.position,_.dir,-v),a._updateStateFromCamera());break}const y=t.sub([],a._camera.position,g);v=.5*t.length(y),a._camera.position=t.scaleAndAdd([],a._camera.position,_.dir,v);try{a._updateStateFromCamera()}catch(b){return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++x<10);return{center:a.center,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch}}fitBounds(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)}_raycastElevationBox(e,n){const i=this.transform.elevation;if(!i)return;const r=new t.pointGeometry(e.x,n.y),o=new t.pointGeometry(n.x,e.y),s=i.pointCoordinate(e);if(!s)return;const a=i.pointCoordinate(n);if(!a)return;const l=i.pointCoordinate(r);if(!l)return;const c=i.pointCoordinate(o);if(!c)return;const u=new t.MercatorCoordinate(s[0],s[1]).toLngLat(),h=new t.MercatorCoordinate(a[0],a[1]).toLngLat(),d=new t.MercatorCoordinate(l[0],l[1]).toLngLat(),p=new t.MercatorCoordinate(c[0],c[1]).toLngLat(),f=Math.min(u.lng,Math.min(h.lng,Math.min(d.lng,p.lng))),m=Math.min(u.lat,Math.min(h.lat,Math.min(d.lat,p.lat))),g=Math.max(u.lng,Math.max(h.lng,Math.max(d.lng,p.lng))),y=Math.max(u.lat,Math.max(h.lat,Math.max(d.lat,p.lat))),_=Math.min(s[3],Math.min(a[3],Math.min(l[3],c[3]))),v=Math.max(s[3],Math.max(a[3],Math.max(l[3],c[3])));return{minLngLat:new t.LngLat(f,m),maxLngLat:new t.LngLat(g,y),minAltitude:_,maxAltitude:v}}fitScreenCoordinates(e,n,i,r,o){let s,a,l,c;const u=t.pointGeometry.convert(e),h=t.pointGeometry.convert(n),d=this._raycastElevationBox(u,h);if(d)s=d.minLngLat,a=d.maxLngLat,l=d.minAltitude,c=d.maxAltitude;else{if(this.transform.isHorizonVisibleForPoints(u,h))return this;s=this.transform.pointLocation(u),a=this.transform.pointLocation(h)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(t.pointGeometry.convert(e)),this.transform.pointLocation(t.pointGeometry.convert(n)),i,r):this._cameraForBox(s,a,l,c,r),r,o)}_fitInternal(e,n,i){return e?(delete(n=t.extend(e,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}jumpTo(e,n){this.stop();const i=this.transform;let r=!1,o=!1,s=!1;return"zoom"in e&&i.zoom!==+e.zoom&&(r=!0,i.zoom=+e.zoom),void 0!==e.center&&(i.center=t.LngLat.convert(e.center)),"bearing"in e&&i.bearing!==+e.bearing&&(o=!0,i.bearing=+e.bearing),"pitch"in e&&i.pitch!==+e.pitch&&(s=!0,i.pitch=+e.pitch),null==e.padding||i.isPaddingEqual(e.padding)||(i.padding=e.padding),this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),r&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),o&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),s&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,n){this.stop();const i=this.transform,r=i.zoom,o=i.pitch,s=i.bearing;i.setFreeCameraOptions(e);const a=r!==i.zoom,l=o!==i.pitch,c=s!==i.bearing;return this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),a&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),c&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),l&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n)),this}easeTo(e,n){this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.exported.prefersReducedMotion)&&(e.duration=0);const i=this.transform,r=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?+e.zoom:r,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:i.padding,d=t.pointGeometry.convert(e.offset);let p=i.centerPoint.add(d);const f=i.pointLocation(p),m=t.LngLat.convert(e.center||f);this._normalizeCenter(m);const g=i.project(f),y=i.project(m).sub(g),_=i.zoomScale(l-r);let v,x;e.around&&(v=t.LngLat.convert(e.around),x=i.locationPoint(v));const b={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==r,this._rotating=this._rotating||o!==c,this._pitching=this._pitching||u!==s,this._padding=!i.isPaddingEqual(h),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,b),this._ease(e=>{if(this._zooming&&(i.zoom=t.number(r,l,e)),this._rotating&&(i.bearing=t.number(o,c,e)),this._pitching&&(i.pitch=t.number(s,u,e)),this._padding&&(i.interpolatePadding(a,h,e),p=i.centerPoint.add(d)),v)i.setLocationAtPoint(v,x);else{const t=i.zoomScale(i.zoom-r),n=l>r?Math.min(2,_):Math.max(.5,_),o=Math.pow(n,1-e),s=i.unproject(g.add(y.mult(e*o)).mult(t));i.setLocationAtPoint(i.renderWorldCopies?s.wrap():s,p)}this._fireMoveEvents(n)},t=>{i.recenterOnTerrain(),this._afterEase(n,t)},e),this}_prepareEase(e,n,i={}){this._moving=!0,this.transform.cameraElevationReference="sea",n||i.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!i.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!i.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!i.pitching&&this.fire(new t.Event("pitchstart",e))}_fireMoveEvents(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId,this.transform.cameraElevationReference="ground";const i=this._zooming,r=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new t.Event("zoomend",e)),r&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}flyTo(e,n){if(!e.essential&&t.exported.prefersReducedMotion){const i=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,n)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);const i=this.transform,r=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?t.clamp(+e.zoom,i.minZoom,i.maxZoom):r,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:i.padding,d=i.zoomScale(l-r),p=t.pointGeometry.convert(e.offset);let f=i.centerPoint.add(p);const m=i.pointLocation(f),g=t.LngLat.convert(e.center||m);this._normalizeCenter(g);const y=i.project(m),_=i.project(g).sub(y);let v=e.curve;const x=Math.max(i.width,i.height),b=x/d,w=_.mag();if("minZoom"in e){const n=t.clamp(Math.min(e.minZoom,r,l),i.minZoom,i.maxZoom),o=x/i.zoomScale(n-r);v=Math.sqrt(o/w*2)}const T=v*v;function A(t){const e=(b*b-x*x+(t?-1:1)*T*T*w*w)/(2*(t?b:x)*T*w);return Math.log(Math.sqrt(e*e+1)-e)}function S(t){return(Math.exp(t)-Math.exp(-t))/2}function C(t){return(Math.exp(t)+Math.exp(-t))/2}const I=A(0);let E=function(t){return C(I)/C(I+v*t)},M=function(t){return x*((C(I)*(S(e=I+v*t)/C(e))-S(I))/T)/w;var e},k=(A(1)-I)/v;if(Math.abs(w)<1e-6||!isFinite(k)){if(Math.abs(x-b)<1e-6)return this.easeTo(e,n);const t=b<x?-1:1;k=Math.abs(Math.log(b/x))/v,M=function(){return 0},E=function(e){return Math.exp(t*v*e)}}return e.duration="duration"in e?+e.duration:1e3*k/("screenSpeed"in e?+e.screenSpeed/v:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=o!==c,this._pitching=u!==s,this._padding=!i.isPaddingEqual(h),this._prepareEase(n,!1),this._ease(e=>{const d=e*k,m=1/E(d);i.zoom=1===e?l:r+i.scaleZoom(m),this._rotating&&(i.bearing=t.number(o,c,e)),this._pitching&&(i.pitch=t.number(s,u,e)),this._padding&&(i.interpolatePadding(a,h,e),f=i.centerPoint.add(p));const v=1===e?g:i.unproject(y.add(_.mult(M(d))).mult(m));i.setLocationAtPoint(i.renderWorldCopies?v.wrap():v,f),i._updateCenterElevation(),this._fireMoveEvents(n)},()=>this._afterEase(n),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const t=this._onEaseEnd;delete this._onEaseEnd,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,n,i){!1===i.animate||0===i.duration?(e(1),n()):(this._easeStart=t.exported.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((t.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,n){e=t.wrap(e,-180,180);const i=Math.abs(e-n);return Math.abs(e-360-n)<i&&(e-=360),Math.abs(e+360-n)<i&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(!e.renderWorldCopies||e.lngRange)return;const n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}}class br{constructor(e={}){this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const e=this.options&&this.options.compact;return this._map=t,this._container=o.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){o.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const n=this._map._getUIString(`AttributionControl.${e}`);t.title=n,t.setAttribute("aria-label",n)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){const i=n.reduce((t,e,i)=>(e.value&&(t+=`${e.key}=${e.value}${i<n.length-1?"&":""}`),t),"?");e.href=`${t.config.FEEDBACK_URL}/${i}${this._map._hash?this._map._hash.getHashString(!0):""}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(t=>"string"!=typeof t?"":t)):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style._sourceCaches;for(const i in e){const n=e[i];if(n.used){const e=n.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t.sort((t,e)=>t.length-e.length),t=t.filter((e,n)=>{for(let i=n+1;i<t.length;i++)if(t[i].indexOf(e)>=0)return!1;return!0});const n=t.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,t.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class wr{constructor(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)}onAdd(t){this._map=t,this._container=o.create("div","mapboxgl-ctrl");const e=o.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){o.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const e in t){const n=t[e].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}}}class Tr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,n=e?this._queue.concat(e):this._queue;for(const i of n)if(i.id===t)return void(i.cancelled=!0)}run(t=0){const e=this._currentlyRunning=this._queue;this._queue=[];for(const n of e)if(!n.cancelled&&(n.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ar(e,n,i){if(e=new t.LngLat(e.lng,e.lat),n){const r=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),s=360*Math.ceil(Math.abs(e.lng-i.center.lng)/360),a=i.locationPoint(e).distSqr(n),l=n.x<0||n.y<0||n.x>i.width||n.y>i.height;i.locationPoint(r).distSqr(n)<a&&(l||Math.abs(r.lng-i.center.lng)<s)?e=r:i.locationPoint(o).distSqr(n)<a&&(l||Math.abs(o.lng-i.center.lng)<s)&&(e=o)}for(;Math.abs(e.lng-i.center.lng)>180;){const t=i.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=i.width&&t.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e}const Sr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Cr(t,e,n){const i=t.classList;for(const r in Sr)i.remove(`mapboxgl-${n}-anchor-${r}`);i.add(`mapboxgl-${n}-anchor-${e}`)}class Ir extends t.Evented{constructor(e,n){if(super(),(e instanceof t.window.HTMLElement||n)&&(e=t.extend({element:e},n)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=t.pointGeometry.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=o.create("div"),this._element.setAttribute("aria-label","Map marker");const n=o.createNS("http://www.w3.org/2000/svg","svg"),i=41,r=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${i}px`),n.setAttributeNS(null,"width",`${r}px`),n.setAttributeNS(null,"viewBox",`0 0 ${r} ${i}`);const s=o.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"stroke","none"),s.setAttributeNS(null,"stroke-width","1"),s.setAttributeNS(null,"fill","none"),s.setAttributeNS(null,"fill-rule","evenodd");const a=o.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");const l=o.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const t of c){const e=o.createNS("http://www.w3.org/2000/svg","ellipse");e.setAttributeNS(null,"opacity","0.04"),e.setAttributeNS(null,"cx","10.5"),e.setAttributeNS(null,"cy","5.80029008"),e.setAttributeNS(null,"rx",t.rx),e.setAttributeNS(null,"ry",t.ry),l.appendChild(e)}const u=o.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=o.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const d=o.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=o.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=o.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=o.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=o.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const y=o.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#FFFFFF"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(y),a.appendChild(l),a.appendChild(u),a.appendChild(d),a.appendChild(f),a.appendChild(m),n.appendChild(a),n.setAttributeNS(null,"height",i*this._scale+"px"),n.setAttributeNS(null,"width",r*this._scale+"px"),this._element.appendChild(n),this._offset=t.pointGeometry.convert(e&&e.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",t=>{t.preventDefault()}),this._element.addEventListener("mousedown",t=>{t.preventDefault()}),Cr(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),o.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,n=13.5,i=Math.sqrt(Math.pow(n,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[i,-1*(e-n+i)],"bottom-right":[-i,-1*(e-n+i)],left:[n,-1*(e-n)],right:[-n,-1*(e-n)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const e=t.code,n=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==n&&13!==n||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_evaluateOpacity(){const t=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(t))return void this._clearFadeTimer();const e=this._map.unproject(t);let n=!1;if(this._map.getTerrain()){const t=this._map.getFreeCameraOptions();if(t.position){const i=t.position.toLngLat();n=i.distanceTo(e)<.9*i.distanceTo(this._lngLat)}}const i=(1-this._map._queryFogOpacity(e))*(n?.2:1);this._element.style.opacity=`${i}`,this._popup&&this._popup._setOpacity(`${i}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(t){const e=this._map.transform;return!!t&&t.x>=0&&t.x<e.width&&t.y>=0&&t.y<e.height}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Ar(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(e=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let n="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?n="rotateX(0deg)":"map"===this._pitchAlignment&&(n=`rotateX(${this._map.getPitch()}deg)`),t&&"moveend"!==t.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&o.setTransform(this._element,`${Sr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${n} ${e}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const t=this._map.transform,e=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&e._rotate(t.angle),"map"===this._pitchAlignment&&(e.y*=Math.cos(t._pitch)),e}getOffset(){return this._offset}setOffset(e){return this._offset=t.pointGeometry.convert(e),this._update(),this}_onMove(e){if(!this._isDragging){const t=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Er{constructor(t){this.jumpTo(t)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const n=t.easeCubicInOut((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,e,n){this._start=this.getValue(e),this._end=t,this._startTime=e,this._endTime=e+n}}const Mr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:kr,HTMLElement:Pr,ImageBitmap:Dr}=t.window,Lr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Or(t){t.parentNode&&t.parentNode.removeChild(t)}const Rr={showCompass:!0,showZoom:!0,visualizePitch:!1};class zr{constructor(e,n,i=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new Yi({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new Hi({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener(n,"mousedown",this.mousedown),o.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),o.addEventListener(n,"touchmove",this.touchmove),o.addEventListener(n,"touchend",this.touchend),o.addEventListener(n,"touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),o.disableDrag()}move(t,e){const n=this.map,i=this.mouseRotate.mousemoveWindow(t,e);if(i&&i.bearingDelta&&n.setBearing(n.getBearing()+i.bearingDelta),this.mousePitch){const i=this.mousePitch.mousemoveWindow(t,e);i&&i.pitchDelta&&n.setPitch(n.getPitch()+i.pitchDelta)}}off(){const t=this.element;o.removeEventListener(t,"mousedown",this.mousedown),o.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),o.removeEventListener(t,"touchmove",this.touchmove),o.removeEventListener(t,"touchend",this.touchend),o.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){o.enableDrag(),o.removeEventListener(t.window,"mousemove",this.mousemove),o.removeEventListener(t.window,"mouseup",this.mouseup)}mousedown(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),o.mousePos(this.element,e)),o.addEventListener(t.window,"mousemove",this.mousemove),o.addEventListener(t.window,"mouseup",this.mouseup)}mousemove(t){this.move(t,o.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=o.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=o.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Zr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Fr,Ur=0,Nr=!1;const Br={maxWidth:100,unit:"metric"};function qr(t,e,n){const i=n&&n.maxWidth||100,r=t._container.clientHeight/2,o=t.unproject([0,r]),s=t.unproject([i,r]),a=o.distanceTo(s);if(n&&"imperial"===n.unit){const n=3.2808*a;n>5280?$r(e,i,n/5280,t._getUIString("ScaleControl.Miles"),t):$r(e,i,n,t._getUIString("ScaleControl.Feet"),t)}else n&&"nautical"===n.unit?$r(e,i,a/1852,t._getUIString("ScaleControl.NauticalMiles"),t):a>=1e3?$r(e,i,a/1e3,t._getUIString("ScaleControl.Kilometers"),t):$r(e,i,a,t._getUIString("ScaleControl.Meters"),t)}function $r(t,e,n,i,r){const o=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(n),e*n}(n),s=o/n;r._requestDomTask(()=>{t.style.width=e*s+"px",t.innerHTML=`${o}&nbsp;${i}`})}const Vr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},jr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Gr(e){if(e){if("number"==typeof e){const n=Math.round(Math.sqrt(.5*Math.pow(e,2)));return{center:new t.pointGeometry(0,0),top:new t.pointGeometry(0,e),"top-left":new t.pointGeometry(n,n),"top-right":new t.pointGeometry(-n,n),bottom:new t.pointGeometry(0,-e),"bottom-left":new t.pointGeometry(n,-n),"bottom-right":new t.pointGeometry(-n,-n),left:new t.pointGeometry(e,0),right:new t.pointGeometry(-e,0)}}if(e instanceof t.pointGeometry||Array.isArray(e)){const n=t.pointGeometry.convert(e);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:t.pointGeometry.convert(e.center||[0,0]),top:t.pointGeometry.convert(e.top||[0,0]),"top-left":t.pointGeometry.convert(e["top-left"]||[0,0]),"top-right":t.pointGeometry.convert(e["top-right"]||[0,0]),bottom:t.pointGeometry.convert(e.bottom||[0,0]),"bottom-left":t.pointGeometry.convert(e["bottom-left"]||[0,0]),"bottom-right":t.pointGeometry.convert(e["bottom-right"]||[0,0]),left:t.pointGeometry.convert(e.left||[0,0]),right:t.pointGeometry.convert(e.right||[0,0])}}return Gr(new t.pointGeometry(0,0))}const Yr={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:class extends xr{constructor(e){if(null!=(e=t.extend({},Lr,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ti(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._optimizeForTerrain=e.optimizeForTerrain,this._renderTaskQueue=new Tr,this._domRenderTaskQueue=new Tr,this._controls=[],this._markers=[],this._mapId=t.uniqueId(),this._locale=t.extend({},Mr,e.locale),this._clickTolerance=e.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Er(0),this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof Pr))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1),t.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new vr(this,e),this._hash=e.hash&&new Si("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.attributionControl&&this.addControl(new br({customAttribution:e.customAttribution})),this._logoControl=new wr,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update("style"===e.dataType),this.fire(new t.Event(`${e.dataType}data`,e))}),this.on("dataloading",e=>{this.fire(new t.Event(`${e.dataType}dataloading`,e))})}_getMapId(){return this._mapId}addControl(e,n){if(void 0===n&&(n=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=e.onAdd(this);this._controls.push(e);const r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){const n=this._containerDimensions(),i=n[0],r=n[1];this._resizeCanvas(i,r),this.transform.resize(i,r),this.painter.resize(i,r);const o=!this._moving;return o&&(this.stop(),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e))),this.fire(new t.Event("resize",e)),o&&this.fire(new t.Event("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this._update()}project(e){return this.transform.locationPoint3D(t.LngLat.convert(e))}unproject(e){return this.transform.pointLocation3D(t.pointGeometry.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(t,e,n){if("mouseenter"===t||"mouseover"===t){let i=!1;return{layer:e,listener:n,delegates:{mousemove:r=>{const o=this.getLayer(e)?this.queryRenderedFeatures(r.point,{layers:[e]}):[];o.length?i||(i=!0,n.call(this,new Oi(t,this,r.originalEvent,{features:o}))):i=!1},mouseout:()=>{i=!1}}}}if("mouseleave"===t||"mouseout"===t){let i=!1;return{layer:e,listener:n,delegates:{mousemove:r=>{(this.getLayer(e)?this.queryRenderedFeatures(r.point,{layers:[e]}):[]).length?i=!0:i&&(i=!1,n.call(this,new Oi(t,this,r.originalEvent)))},mouseout:e=>{i&&(i=!1,n.call(this,new Oi(t,this,e.originalEvent)))}}}}{const i=t=>{const i=this.getLayer(e)?this.queryRenderedFeatures(t.point,{layers:[e]}):[];i.length&&(t.features=i,n.call(this,t),delete t.features)};return{layer:e,listener:n,delegates:{[t]:i}}}}on(t,e,n){if(void 0===n)return super.on(t,e);const i=this._createDelegatedListener(t,e,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(i);for(const r in i.delegates)this.on(r,i.delegates[r]);return this}once(t,e,n){if(void 0===n)return super.once(t,e);const i=this._createDelegatedListener(t,e,n);for(const r in i.delegates)this.once(r,i.delegates[r]);return this}off(t,e,n){return void 0===n?super.off(t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&(i=>{const r=this._delegatedListeners[t];for(let t=0;t<r.length;t++){const i=r[t];if(i.layer===e&&i.listener===n){for(const t in i.delegates)this.off(t,i.delegates[t]);return r.splice(t,1),this}}})(),this)}queryRenderedFeatures(e,n){return this.style?(void 0!==n||void 0===e||e instanceof t.pointGeometry||Array.isArray(e)||(n=e,e=void 0),this.style.queryRenderedFeatures(e=e||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}queryTerrainElevation(e,n){const i=this.transform.elevation;return i?(n=t.extend({},{exaggerated:!0},n),i.getAtPoint(t.MercatorCoordinate.fromLngLat(e),null,n.exaggerated)):null}setStyle(e,n){return!1!==(n=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(e,n))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),t&&(this.style=new qe(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new qe(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,n){if("string"==typeof e){const i=this._requestManager.normalizeStyleURL(e),r=this._requestManager.transformRequest(i,t.ResourceType.Style);t.getJSON(r,(e,i)=>{e?this.fire(new t.ErrorEvent(e)):i&&this._updateDiff(i,n)})}else"object"==typeof e&&this._updateDiff(e,n)}_updateDiff(e,n){try{this.style.setState(e)&&this._update(!0)}catch(i){t.warnOnce(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(e,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(e){const n=this.style&&this.style._getSourceCaches(e);if(0!==n.length)return n.every(t=>t.loaded());this.fire(new t.ErrorEvent(new Error(`There is no source with ID '${e}'`)))}areTilesLoaded(){const t=this.style&&this.style._sourceCaches;for(const e in t){const n=t[e]._tiles;for(const t in n){const e=n[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}addSourceType(t,e,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)}removeSource(t){return this.style.removeSource(t),this._updateTerrain(),this._update(!0)}getSource(t){return this.style.getSource(t)}addImage(e,n,{pixelRatio:i=1,sdf:r=!1,stretchX:o,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),n instanceof kr||Dr&&n instanceof Dr){const{width:l,height:c,data:u}=t.exported.getImageData(n);this.style.addImage(e,{data:new t.RGBAImage({width:l,height:c},u),pixelRatio:i,stretchX:o,stretchY:s,content:a,sdf:r,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:l,height:c,data:u}=n,h=n;this.style.addImage(e,{data:new t.RGBAImage({width:l,height:c},new Uint8Array(u)),pixelRatio:i,stretchX:o,stretchY:s,content:a,sdf:r,version:0,userImage:h}),h.onAdd&&h.onAdd(this,e)}}}updateImage(e,n){const i=this.style.getImage(e);if(!i)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=n instanceof kr||Dr&&n instanceof Dr?t.exported.getImageData(n):n,{width:o,height:s,data:a}=r;return void 0===o||void 0===s?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==i.data.width||s!==i.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(i.data.replace(a,!(n instanceof kr||Dr&&n instanceof Dr)),void this.style.updateImage(e,i))}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(e,n){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),(e,i)=>{n(e,i instanceof kr?t.exported.getImageData(i):i)})}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}setLayerZoomRange(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)}setFilter(t,e,n={}){return this.style.setFilter(t,e,n),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,n,i={}){return this.style.setPaintProperty(t,e,n,i),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,n,i={}){return this.style.setLayoutProperty(t,e,n,i),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setLight(t,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(t){return this._lazyInitEmptyStyle(),this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.LngLat.convert(e),this.transform):0}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_detectMissingCSS(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=o.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=o.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=o.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions();this._resizeCanvas(n[0],n[1]);const i=this._controlContainer=o.create("div","mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(t=>{r[t]=o.create("div",`mapboxgl-ctrl-${t}`,i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,n){const i=t.exported.devicePixelRatio||1;this._canvas.width=i*e,this._canvas.height=i*n,this._canvas.style.width=`${e}px`,this._canvas.style.height=`${n}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_setupPainter(){const n=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);i?(t.storeAuthState(i,!0),this.painter=new pi(i,this.transform),this.on("data",t=>{"source"===t.dataType&&this.painter.setTileLoadedFlag(!0)}),t.exported$1.testSupport(i)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.isMoving()&&this.loaded()?t():this._domRenderTaskQueue.add(t)}_render(e){let n;const i=this.painter.context.extTimerQuery,r=t.exported.now();this.listens("gpu-timing-frame")&&(n=i.createQueryEXT(),i.beginQueryEXT(i.TIME_ELAPSED_EXT,n));let o=this._updateAverageElevation(r);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;let s=!1;const a=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,n=t.exported.now();this.style.zoomHistory.update(e,n);const i=new t.EvaluationParameters(e,{now:n,fadeDuration:a,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),r=i.crossFadingFactor();1===r&&r===this._crossFadingFactor||(s=!0,this._crossFadingFactor=r),this.style.update(i)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const e=t.exported.now()-r;i.endQueryEXT(i.TIME_ELAPSED_EXT,n),setTimeout(()=>{const r=i.getQueryObjectEXT(n,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(n),this.fire(new t.Event("gpu-timing-frame",{cpuTime:e,gpuTime:r}))},50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout(()=>{const n=this.painter.queryGpuTimers(e);this.fire(new t.Event("gpu-timing-layer",{layerTimes:n}))},50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||o;if(l||this._repaint)this.triggerRepaint();else{const e=!this.isMoving()&&this.loaded();if(e&&(o=this._updateAverageElevation(r,!0)),o)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new t.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new t.Event("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._authenticate()),this}_updateAverageElevation(t,e=!1){const n=t=>(this.transform.averageElevation=t,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);if((e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const e=this.transform.averageElevation;let i=this.transform.sampleAverageElevation();isNaN(i)?i=0:this._averageElevationLastSampledAt=t;const r=Math.abs(e-i);if(r>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(i),n(i);this._averageElevation.easeTo(i,t,300)}else if(r>1e-4)return this._averageElevation.jumpTo(i),n(i)}return!!this._averageElevation.isEasing(t)&&n(this._averageElevation.getValue(t))}_authenticate(){t.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===t.AUTH_ERR_MSG||401===e.status)){const e=this.painter.context.gl;t.storeAuthState(e,!1),this._logoControl instanceof wr&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),t.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const n=this.painter.context.gl,i=n.createFramebuffer();function r(t){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const e=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,e),e}return n.bindFramebuffer(n.FRAMEBUFFER,i),this._canvasPixelComparison(r(t),e.canvasCopies.map(r),e.timeStamps)}_canvasPixelComparison(t,e,n){let i=n[1]-n[0];const r=t.length/4;for(let o=0;o<e.length;o++){const s=e[o];let a=0;for(let e=0;e<s.length;e+=4)s[e]===t[e]&&s[e+1]===t[e+1]&&s[e+2]===t[e+2]&&s[e+3]===t[e+3]&&(a+=1);i+=(n[o+2]-n[o+1])*(1-a/r)}return i}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),Or(this._canvasContainer),Or(this._controlContainer),Or(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),t.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new t.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=t.exported.frame(t=>{const e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,e&&this._render(t)}))}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}_setCacheLimits(e,n){t.setCacheLimits(e,n)}get version(){return t.version}},NavigationControl:class{constructor(e){this.options=t.extend({},Rr,e),this._container=o.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),o.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),o.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=o.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const t=this._map.getZoom(),e=t===this._map.getMaxZoom(),n=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){o.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(t,e){const n=o.create("button",t,this._container);return n.type="button",n.addEventListener("click",e),n}_setButtonTitle(t,e){const n=this._map._getUIString(`NavigationControl.${e}`);t.title=n,t.setAttribute("aria-label",n)}},GeolocateControl:class extends t.Evented{constructor(e){super(),this.options=t.extend({},Zr,e),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Ai(this._updateMarkerRotation,20)}onAdd(e){var n;return this._map=e,this._container=o.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==Fr?n(Fr):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then(t=>{Fr="denied"!==t.state,n(Fr)}):(Fr=!!t.window.navigator.geolocation,n(Fr)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),o.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ur=0,Nr=!1}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),n=t.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}}_updateCamera(e){const n=new t.LngLat(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,r=this._map.getBearing(),o=t.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(i),o,{geolocateSource:!0})}_updateMarker(e){if(e){const n=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),n=this._map.unproject([100,t]),i=e.distanceTo(n)/100,r=Math.ceil(2*this._accuracy/i);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Nr)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=o.create("button","mapboxgl-ctrl-geolocate",this._container),o.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o.create("div","mapboxgl-user-location"),this._dotElement.appendChild(o.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ir({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ir({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.Event("trackuserlocationend")))})}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:!0===t.absolute&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ur--,Nr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ur++,Ur>1?(e={maximumAge:6e5,timeout:0},Nr=!0):(e=this.options.positionOptions,Nr=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{t.window.addEventListener("ondeviceorientationabsolute"in t.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==t.window.DeviceMotionEvent&&"function"==typeof t.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&e()}).catch(console.error):e()}_clearWatch(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),t.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),t.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:br,ScaleControl:class{constructor(e){this.options=t.extend({},Br,e),t.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){qr(this._map,this._container,this.options)}onAdd(t){return this._map=t,this._container=o.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){o.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(t){this.options.unit=t,qr(this._map,this._container,this.options)}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in t.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=o.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){o.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!t.window.document.fullscreenEnabled&&!t.window.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=o.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(t.window.document.fullscreenElement||t.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.Evented{constructor(e){super(),this.options=t.extend(Object.create(Vr),e),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&o.remove(this._content),this._container&&(o.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(t.window.document.createTextNode(e))}setHTML(e){const n=t.window.document.createDocumentFragment(),i=t.window.document.createElement("body");let r;for(i.innerHTML=e;r=i.firstChild,r;)n.appendChild(r);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=o.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(t){this._container&&this._container.classList.add(t)}removeClassName(t){this._container&&this._container.classList.remove(t)}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){if(this._container)return this._container.classList.toggle(t)}_createCloseButton(){this.options.closeButton&&(this._closeButton=o.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(t){this._update(t.point)}_onMouseMove(t){this._update(t.point)}_onDrag(t){this._update(t.point)}_update(t){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=o.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=o.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(t=>this._container.classList.add(t)),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ar(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t))return;const e=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let n=this.options.anchor;const i=Gr(this.options.offset);if(!n){const t=this._container.offsetWidth,r=this._container.offsetHeight;let o;o=e.y+i.bottom.y<r?["top"]:e.y>this._map.transform.height-r?["bottom"]:[],e.x<t/2?o.push("left"):e.x>this._map.transform.width-t/2&&o.push("right"),n=0===o.length?"bottom":o.join("-")}const r=e.add(i[n]).round();this._map._requestDomTask(()=>{this._container&&n&&(o.setTransform(this._container,`${Sr[n]} translate(${r.x}px,${r.y}px)`),Cr(this._container,n,"popup"))})}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(jr);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._content&&(this._content.style.opacity=t),this._tip&&(this._tip.style.opacity=t)}},Marker:Ir,Style:qe,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.pointGeometry,MercatorCoordinate:t.MercatorCoordinate,FreeCameraOptions:bi,Evented:t.Evented,config:t.config,prewarm:function(){Rt().acquire(Dt)},clearPrewarmedResources:function(){const t=Ot;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Dt),Ot=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Lt.workerCount},set workerCount(t){Lt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){t.clearTileCache(e)},workerUrl:"",workerClass:null,setNow:t.exported.setNow,restoreNow:t.exported.restoreNow};return Yr}),n}()},6215:function(t,e,n){"use strict";n.d(e,{X:function(){return o}});var i=n(9765),r=n(7971);class o extends i.xQ{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return e&&!e.closed&&t.next(this._value),e}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new r.N;return this._value}next(t){super.next(this._value=t)}}},7574:function(t,e,n){"use strict";n.d(e,{y:function(){return c}});var i=n(7393),r=n(9181),o=n(6490),s=n(6554),a=n(4487);var l=n(2494);let c=(()=>{class t{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(e){const n=new t;return n.source=this,n.operator=e,n}subscribe(t,e,n){const{operator:s}=this,a=function(t,e,n){if(t){if(t instanceof i.L)return t;if(t[r.b])return t[r.b]()}return t||e||n?new i.L(t,e,n):new i.L(o.c)}(t,e,n);if(a.add(s?s.call(a,this.source):this.source||l.v.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),l.v.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a}_trySubscribe(t){try{return this._subscribe(t)}catch(e){l.v.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){const{closed:e,destination:n,isStopped:r}=t;if(e||r)return!1;t=n&&n instanceof i.L?n:null}return!0}(t)?t.error(e):console.warn(e)}}forEach(t,e){return new(e=u(e))((e,n)=>{let i;i=this.subscribe(e=>{try{t(e)}catch(r){n(r),i&&i.unsubscribe()}},n,e)})}_subscribe(t){const{source:e}=this;return e&&e.subscribe(t)}[s.L](){return this}pipe(...t){return 0===t.length?this:function(t){return 0===t.length?a.y:1===t.length?t[0]:function(e){return t.reduce((t,e)=>e(t),e)}}(t)(this)}toPromise(t){return new(t=u(t))((t,e)=>{let n;this.subscribe(t=>n=t,t=>e(t),()=>t(n))})}}return t.create=e=>new t(e),t})();function u(t){if(t||(t=l.v.Promise||Promise),!t)throw new Error("no Promise impl found");return t}},6490:function(t,e,n){"use strict";n.d(e,{c:function(){return o}});var i=n(2494),r=n(4449);const o={closed:!0,next(t){},error(t){if(i.v.useDeprecatedSynchronousErrorHandling)throw t;(0,r.z)(t)},complete(){}}},9765:function(t,e,n){"use strict";n.d(e,{Yc:function(){return c},xQ:function(){return u}});var i=n(7574),r=n(7393),o=n(5319),s=n(7971),a=n(8858),l=n(9181);class c extends r.L{constructor(t){super(t),this.destination=t}}let u=(()=>{class t extends i.y{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[l.b](){return new c(this)}lift(t){const e=new h(this,this);return e.operator=t,e}next(t){if(this.closed)throw new s.N;if(!this.isStopped){const{observers:e}=this,n=e.length,i=e.slice();for(let r=0;r<n;r++)i[r].next(t)}}error(t){if(this.closed)throw new s.N;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:e}=this,n=e.length,i=e.slice();for(let r=0;r<n;r++)i[r].error(t);this.observers.length=0}complete(){if(this.closed)throw new s.N;this.isStopped=!0;const{observers:t}=this,e=t.length,n=t.slice();for(let i=0;i<e;i++)n[i].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new s.N;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new s.N;return this.hasError?(t.error(this.thrownError),o.w.EMPTY):this.isStopped?(t.complete(),o.w.EMPTY):(this.observers.push(t),new a.W(this,t))}asObservable(){const t=new i.y;return t.source=this,t}}return t.create=(t,e)=>new h(t,e),t})();class h extends u{constructor(t,e){super(),this.destination=t,this.source=e}next(t){const{destination:e}=this;e&&e.next&&e.next(t)}error(t){const{destination:e}=this;e&&e.error&&this.destination.error(t)}complete(){const{destination:t}=this;t&&t.complete&&this.destination.complete()}_subscribe(t){const{source:e}=this;return e?this.source.subscribe(t):o.w.EMPTY}}},8858:function(t,e,n){"use strict";n.d(e,{W:function(){return r}});var i=n(5319);class r extends i.w{constructor(t,e){super(),this.subject=t,this.subscriber=e,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const t=this.subject,e=t.observers;if(this.subject=null,!e||0===e.length||t.isStopped||t.closed)return;const n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},7393:function(t,e,n){"use strict";n.d(e,{L:function(){return c}});var i=n(9105),r=n(6490),o=n(5319),s=n(9181),a=n(2494),l=n(4449);class c extends o.w{constructor(t,e,n){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=r.c;break;case 1:if(!t){this.destination=r.c;break}if("object"==typeof t){t instanceof c?(this.syncErrorThrowable=t.syncErrorThrowable,this.destination=t,t.add(this)):(this.syncErrorThrowable=!0,this.destination=new u(this,t));break}default:this.syncErrorThrowable=!0,this.destination=new u(this,t,e,n)}}[s.b](){return this}static create(t,e,n){const i=new c(t,e,n);return i.syncErrorThrowable=!1,i}next(t){this.isStopped||this._next(t)}error(t){this.isStopped||(this.isStopped=!0,this._error(t))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(t){this.destination.next(t)}_error(t){this.destination.error(t),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:t}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this}}class u extends c{constructor(t,e,n,o){super(),this._parentSubscriber=t;let s,a=this;(0,i.m)(e)?s=e:e&&(s=e.next,n=e.error,o=e.complete,e!==r.c&&(a=Object.create(e),(0,i.m)(a.unsubscribe)&&this.add(a.unsubscribe.bind(a)),a.unsubscribe=this.unsubscribe.bind(this))),this._context=a,this._next=s,this._error=n,this._complete=o}next(t){if(!this.isStopped&&this._next){const{_parentSubscriber:e}=this;a.v.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}}error(t){if(!this.isStopped){const{_parentSubscriber:e}=this,{useDeprecatedSynchronousErrorHandling:n}=a.v;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):(0,l.z)(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;(0,l.z)(t)}}}complete(){if(!this.isStopped){const{_parentSubscriber:t}=this;if(this._complete){const e=()=>this._complete.call(this._context);a.v.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(t,e){try{t.call(this._context,e)}catch(n){if(this.unsubscribe(),a.v.useDeprecatedSynchronousErrorHandling)throw n;(0,l.z)(n)}}__tryOrSetError(t,e,n){if(!a.v.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(i){return a.v.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=i,t.syncErrorThrown=!0,!0):((0,l.z)(i),!0)}return!1}_unsubscribe(){const{_parentSubscriber:t}=this;this._context=null,this._parentSubscriber=null,t.unsubscribe()}}},5319:function(t,e,n){"use strict";n.d(e,{w:function(){return a}});var i=n(9796),r=n(1555),o=n(9105);const s=(()=>{function t(t){return Error.call(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((t,e)=>`${e+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t})();class a{constructor(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}unsubscribe(){let t;if(this.closed)return;let{_parentOrParents:e,_ctorUnsubscribe:n,_unsubscribe:l,_subscriptions:u}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,e instanceof a)e.remove(this);else if(null!==e)for(let i=0;i<e.length;++i)e[i].remove(this);if((0,o.m)(l)){n&&(this._unsubscribe=void 0);try{l.call(this)}catch(h){t=h instanceof s?c(h.errors):[h]}}if((0,i.k)(u)){let e=-1,n=u.length;for(;++e<n;){const n=u[e];if((0,r.K)(n))try{n.unsubscribe()}catch(d){t=t||[],d instanceof s?t=t.concat(c(d.errors)):t.push(d)}}}if(t)throw new s(t)}add(t){let e=t;if(!t)return a.EMPTY;switch(typeof t){case"function":e=new a(t);case"object":if(e===this||e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof a)){const t=e;e=new a,e._subscriptions=[t]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}let{_parentOrParents:n}=e;if(null===n)e._parentOrParents=this;else if(n instanceof a){if(n===this)return e;e._parentOrParents=[n,this]}else{if(-1!==n.indexOf(this))return e;n.push(this)}const i=this._subscriptions;return null===i?this._subscriptions=[e]:i.push(e),e}remove(t){const e=this._subscriptions;if(e){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}}}var l;function c(t){return t.reduce((t,e)=>t.concat(e instanceof s?e.errors:e),[])}a.EMPTY=((l=new a).closed=!0,l)},2494:function(t,e,n){"use strict";n.d(e,{v:function(){return r}});let i=!1;const r={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){const t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else i&&console.log("RxJS: Back to a better error behavior. Thank you. <3");i=t},get useDeprecatedSynchronousErrorHandling(){return i}}},5345:function(t,e,n){"use strict";n.d(e,{IY:function(){return s},Ds:function(){return a},ft:function(){return l}});var i=n(7393),r=n(7574),o=n(7444);class s extends i.L{constructor(t){super(),this.parent=t}_next(t){this.parent.notifyNext(t)}_error(t){this.parent.notifyError(t),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class a extends i.L{notifyNext(t){this.destination.next(t)}notifyError(t){this.destination.error(t)}notifyComplete(){this.destination.complete()}}function l(t,e){if(!e.closed)return t instanceof r.y?t.subscribe(e):(0,o.s)(t)(e)}},2441:function(t,e,n){"use strict";n.d(e,{c:function(){return a},N:function(){return l}});var i=n(9765),r=n(7574),o=n(5319),s=n(1307);class a extends r.y{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._refCount=0,this._isComplete=!1}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let t=this._connection;return t||(this._isComplete=!1,t=this._connection=new o.w,t.add(this.source.subscribe(new c(this.getSubject(),this))),t.closed&&(this._connection=null,t=o.w.EMPTY)),t}refCount(){return(0,s.x)()(this)}}const l=(()=>{const t=a.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}})();class c extends i.Yc{constructor(t,e){super(t),this.connectable=e}_error(t){this._unsubscribe(),super._error(t)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const t=this.connectable;if(t){this.connectable=null;const e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}}}},8071:function(t,e,n){"use strict";n.d(e,{z:function(){return o}});var i=n(5917),r=n(3282);function o(...t){return(0,r.J)(1)((0,i.of)(...t))}},1439:function(t,e,n){"use strict";n.d(e,{P:function(){return s}});var i=n(7574),r=n(4402),o=n(9193);function s(t){return new i.y(e=>{let n;try{n=t()}catch(i){return void e.error(i)}return(n?(0,r.D)(n):(0,o.c)()).subscribe(e)})}},9193:function(t,e,n){"use strict";n.d(e,{E:function(){return r},c:function(){return o}});var i=n(7574);const r=new i.y(t=>t.complete());function o(t){return t?function(t){return new i.y(e=>t.schedule(()=>e.complete()))}(t):r}},5758:function(t,e,n){"use strict";n.d(e,{D:function(){return l}});var i=n(7574),r=n(9796),o=n(8002),s=n(1555),a=n(4402);function l(...t){if(1===t.length){const e=t[0];if((0,r.k)(e))return c(e,null);if((0,s.K)(e)&&Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);return c(t.map(t=>e[t]),t)}}if("function"==typeof t[t.length-1]){const e=t.pop();return c(t=1===t.length&&(0,r.k)(t[0])?t[0]:t,null).pipe((0,o.U)(t=>e(...t)))}return c(t,null)}function c(t,e){return new i.y(n=>{const i=t.length;if(0===i)return void n.complete();const r=new Array(i);let o=0,s=0;for(let l=0;l<i;l++){const c=(0,a.D)(t[l]);let u=!1;n.add(c.subscribe({next:t=>{u||(u=!0,s++),r[l]=t},error:t=>n.error(t),complete:()=>{o++,(o===i||!u)&&(s===i&&n.next(e?e.reduce((t,e,n)=>(t[e]=r[n],t),{}):r),n.complete())}}))}})}},4402:function(t,e,n){"use strict";n.d(e,{D:function(){return h}});var i=n(7574),r=n(7444),o=n(5319),s=n(6554),a=n(4087),l=n(377),c=n(4072),u=n(9489);function h(t,e){return e?function(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[s.L]}(t))return function(t,e){return new i.y(n=>{const i=new o.w;return i.add(e.schedule(()=>{const r=t[s.L]();i.add(r.subscribe({next(t){i.add(e.schedule(()=>n.next(t)))},error(t){i.add(e.schedule(()=>n.error(t)))},complete(){i.add(e.schedule(()=>n.complete()))}}))})),i})}(t,e);if((0,c.t)(t))return function(t,e){return new i.y(n=>{const i=new o.w;return i.add(e.schedule(()=>t.then(t=>{i.add(e.schedule(()=>{n.next(t),i.add(e.schedule(()=>n.complete()))}))},t=>{i.add(e.schedule(()=>n.error(t)))}))),i})}(t,e);if((0,u.z)(t))return(0,a.r)(t,e);if(function(t){return t&&"function"==typeof t[l.hZ]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new i.y(n=>{const i=new o.w;let r;return i.add(()=>{r&&"function"==typeof r.return&&r.return()}),i.add(e.schedule(()=>{r=t[l.hZ](),i.add(e.schedule(function(){if(n.closed)return;let t,e;try{const n=r.next();t=n.value,e=n.done}catch(i){return void n.error(i)}e?n.complete():(n.next(t),this.schedule())}))})),i})}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,e):t instanceof i.y?t:new i.y((0,r.s)(t))}},6693:function(t,e,n){"use strict";n.d(e,{n:function(){return s}});var i=n(7574),r=n(5015),o=n(4087);function s(t,e){return e?(0,o.r)(t,e):new i.y((0,r.V)(t))}},2759:function(t,e,n){"use strict";n.d(e,{R:function(){return a}});var i=n(7574),r=n(9796),o=n(9105),s=n(8002);function a(t,e,n,c){return(0,o.m)(n)&&(c=n,n=void 0),c?a(t,e,n).pipe((0,s.U)(t=>(0,r.k)(t)?c(...t):c(t))):new i.y(i=>{l(t,e,function(t){i.next(arguments.length>1?Array.prototype.slice.call(arguments):t)},i,n)})}function l(t,e,n,i,r){let o;if(function(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){const i=t;t.addEventListener(e,n,r),o=()=>i.removeEventListener(e,n,r)}else if(function(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){const i=t;t.on(e,n),o=()=>i.off(e,n)}else if(function(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t)){const i=t;t.addListener(e,n),o=()=>i.removeListener(e,n)}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(let o=0,s=t.length;o<s;o++)l(t[o],e,n,i,r)}i.add(o)}},5917:function(t,e,n){"use strict";n.d(e,{of:function(){return s}});var i=n(4869),r=n(6693),o=n(4087);function s(...t){let e=t[t.length-1];return(0,i.K)(e)?(t.pop(),(0,o.r)(t,e)):(0,r.n)(t)}},4612:function(t,e,n){"use strict";n.d(e,{b:function(){return r}});var i=n(9773);function r(t,e){return(0,i.zg)(t,e,1)}},5435:function(t,e,n){"use strict";n.d(e,{h:function(){return r}});var i=n(7393);function r(t,e){return function(n){return n.lift(new o(t,e))}}class o{constructor(t,e){this.predicate=t,this.thisArg=e}call(t,e){return e.subscribe(new s(t,this.predicate,this.thisArg))}}class s extends i.L{constructor(t,e,n){super(t),this.predicate=e,this.thisArg=n,this.count=0}_next(t){let e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}e&&this.destination.next(t)}}},8002:function(t,e,n){"use strict";n.d(e,{U:function(){return r}});var i=n(7393);function r(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new o(t,e))}}class o{constructor(t,e){this.project=t,this.thisArg=e}call(t,e){return e.subscribe(new s(t,this.project,this.thisArg))}}class s extends i.L{constructor(t,e,n){super(t),this.project=e,this.count=0,this.thisArg=n||this}_next(t){let e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(e)}}},3282:function(t,e,n){"use strict";n.d(e,{J:function(){return o}});var i=n(9773),r=n(4487);function o(t=Number.POSITIVE_INFINITY){return(0,i.zg)(r.y,t)}},9773:function(t,e,n){"use strict";n.d(e,{zg:function(){return s}});var i=n(8002),r=n(4402),o=n(5345);function s(t,e,n=Number.POSITIVE_INFINITY){return"function"==typeof e?o=>o.pipe(s((n,o)=>(0,r.D)(t(n,o)).pipe((0,i.U)((t,i)=>e(n,t,o,i))),n)):("number"==typeof e&&(n=e),e=>e.lift(new a(t,n)))}class a{constructor(t,e=Number.POSITIVE_INFINITY){this.project=t,this.concurrent=e}call(t,e){return e.subscribe(new l(t,this.project,this.concurrent))}}class l extends o.Ds{constructor(t,e,n=Number.POSITIVE_INFINITY){super(t),this.project=e,this.concurrent=n,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)}_tryNext(t){let e;const n=this.index++;try{e=this.project(t,n)}catch(i){return void this.destination.error(i)}this.active++,this._innerSub(e)}_innerSub(t){const e=new o.IY(this),n=this.destination;n.add(e);const i=(0,o.ft)(t,e);i!==e&&n.add(i)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(t){this.destination.next(t)}notifyComplete(){const t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}},1307:function(t,e,n){"use strict";n.d(e,{x:function(){return r}});var i=n(7393);function r(){return function(t){return t.lift(new o(t))}}class o{constructor(t){this.connectable=t}call(t,e){const{connectable:n}=this;n._refCount++;const i=new s(t,n),r=e.subscribe(i);return i.closed||(i.connection=n.connect()),r}}class s extends i.L{constructor(t,e){super(t),this.connectable=e}_unsubscribe(){const{connectable:t}=this;if(!t)return void(this.connection=null);this.connectable=null;const e=t._refCount;if(e<=0)return void(this.connection=null);if(t._refCount=e-1,e>1)return void(this.connection=null);const{connection:n}=this,i=t._connection;this.connection=null,i&&(!n||i===n)&&i.unsubscribe()}}},3190:function(t,e,n){"use strict";n.d(e,{w:function(){return s}});var i=n(8002),r=n(4402),o=n(5345);function s(t,e){return"function"==typeof e?n=>n.pipe(s((n,o)=>(0,r.D)(t(n,o)).pipe((0,i.U)((t,i)=>e(n,t,o,i))))):e=>e.lift(new a(t))}class a{constructor(t){this.project=t}call(t,e){return e.subscribe(new l(t,this.project))}}class l extends o.Ds{constructor(t,e){super(t),this.project=e,this.index=0}_next(t){let e;const n=this.index++;try{e=this.project(t,n)}catch(i){return void this.destination.error(i)}this._innerSub(e)}_innerSub(t){const e=this.innerSubscription;e&&e.unsubscribe();const n=new o.IY(this),i=this.destination;i.add(n),this.innerSubscription=(0,o.ft)(t,n),this.innerSubscription!==n&&i.add(this.innerSubscription)}_complete(){const{innerSubscription:t}=this;(!t||t.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(t){this.destination.next(t)}}},5257:function(t,e,n){"use strict";n.d(e,{q:function(){return s}});var i=n(7393),r=n(7108),o=n(9193);function s(t){return e=>0===t?(0,o.c)():e.lift(new a(t))}class a{constructor(t){if(this.total=t,this.total<0)throw new r.W}call(t,e){return e.subscribe(new l(t,this.total))}}class l extends i.L{constructor(t,e){super(t),this.total=e,this.count=0}_next(t){const e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))}}},4087:function(t,e,n){"use strict";n.d(e,{r:function(){return o}});var i=n(7574),r=n(5319);function o(t,e){return new i.y(n=>{const i=new r.w;let o=0;return i.add(e.schedule(function(){o!==t.length?(n.next(t[o++]),n.closed||i.add(this.schedule())):n.complete()})),i})}},6465:function(t,e,n){"use strict";n.d(e,{o:function(){return o}});var i=n(5319);class r extends i.w{constructor(t,e){super()}schedule(t,e=0){return this}}class o extends r{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(i,this.id,e),this}requestAsyncId(t,e,n=0){return setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,e,n=0){if(null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let n,i=!1;try{this.work(t)}catch(r){i=!0,n=!!r&&r||new Error(r)}if(i)return this.unsubscribe(),n}_unsubscribe(){const t=this.id,e=this.scheduler,n=e.actions,i=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==i&&n.splice(i,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}},6102:function(t,e,n){"use strict";n.d(e,{v:function(){return r}});let i=(()=>{class t{constructor(e,n=t.now){this.SchedulerAction=e,this.now=n}schedule(t,e=0,n){return new this.SchedulerAction(this,t).schedule(n,e)}}return t.now=()=>Date.now(),t})();class r extends i{constructor(t,e=i.now){super(t,()=>r.delegate&&r.delegate!==this?r.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,n){return r.delegate&&r.delegate!==this?r.delegate.schedule(t,e,n):super.schedule(t,e,n)}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}}},377:function(t,e,n){"use strict";n.d(e,{hZ:function(){return i}});const i="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"},6554:function(t,e,n){"use strict";n.d(e,{L:function(){return i}});const i="function"==typeof Symbol&&Symbol.observable||"@@observable"},9181:function(t,e,n){"use strict";n.d(e,{b:function(){return i}});const i="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()},7108:function(t,e,n){"use strict";n.d(e,{W:function(){return i}});const i=(()=>{function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t})()},7971:function(t,e,n){"use strict";n.d(e,{N:function(){return i}});const i=(()=>{function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t})()},4449:function(t,e,n){"use strict";function i(t){setTimeout(()=>{throw t},0)}n.d(e,{z:function(){return i}})},4487:function(t,e,n){"use strict";function i(t){return t}n.d(e,{y:function(){return i}})},9796:function(t,e,n){"use strict";n.d(e,{k:function(){return i}});const i=Array.isArray||(t=>t&&"number"==typeof t.length)},9489:function(t,e,n){"use strict";n.d(e,{z:function(){return i}});const i=t=>t&&"number"==typeof t.length&&"function"!=typeof t},9105:function(t,e,n){"use strict";function i(t){return"function"==typeof t}n.d(e,{m:function(){return i}})},1555:function(t,e,n){"use strict";function i(t){return null!==t&&"object"==typeof t}n.d(e,{K:function(){return i}})},4072:function(t,e,n){"use strict";function i(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}n.d(e,{t:function(){return i}})},4869:function(t,e,n){"use strict";function i(t){return t&&"function"==typeof t.schedule}n.d(e,{K:function(){return i}})},7444:function(t,e,n){"use strict";n.d(e,{s:function(){return u}});var i=n(5015),r=n(4449),o=n(377),s=n(6554),a=n(9489),l=n(4072),c=n(1555);const u=t=>{if(t&&"function"==typeof t[s.L])return(t=>e=>{const n=t[s.L]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)})(t);if((0,a.z)(t))return(0,i.V)(t);if((0,l.t)(t))return(t=>e=>(t.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,r.z),e))(t);if(t&&"function"==typeof t[o.hZ])return(t=>e=>{const n=t[o.hZ]();for(;;){let t;try{t=n.next()}catch(i){return e.error(i),e}if(t.done){e.complete();break}if(e.next(t.value),e.closed)break}return"function"==typeof n.return&&e.add(()=>{n.return&&n.return()}),e})(t);{const e=`You provided ${(0,c.K)(t)?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(e)}}},5015:function(t,e,n){"use strict";n.d(e,{V:function(){return i}});const i=t=>e=>{for(let n=0,i=t.length;n<i&&!e.closed;n++)e.next(t[n]);e.complete()}},9666:function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(n(8983).default);e.default=o},8983:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(650),r=n(877),o=function(){function t(t){this.root=null,this.compare=t||i.defaultCompare,this.nElements=0}return t.prototype.add=function(t){return!i.isUndefined(t)&&null!==this.insertNode(this.createNode(t))&&(this.nElements++,!0)},t.prototype.clear=function(){this.root=null,this.nElements=0},t.prototype.isEmpty=function(){return 0===this.nElements},t.prototype.size=function(){return this.nElements},t.prototype.contains=function(t){return!i.isUndefined(t)&&null!==this.searchNode(this.root,t)},t.prototype.search=function(t){var e=this.searchNode(this.root,t);if(null!==e)return e.element},t.prototype.remove=function(t){var e=this.searchNode(this.root,t);return null!==e&&(this.removeNode(e),this.nElements--,!0)},t.prototype.inorderTraversal=function(t){this.inorderTraversalAux(this.root,t,{stop:!1})},t.prototype.preorderTraversal=function(t){this.preorderTraversalAux(this.root,t,{stop:!1})},t.prototype.postorderTraversal=function(t){this.postorderTraversalAux(this.root,t,{stop:!1})},t.prototype.levelTraversal=function(t){this.levelTraversalAux(this.root,t)},t.prototype.minimum=function(){if(!this.isEmpty()&&null!==this.root)return this.minimumAux(this.root).element},t.prototype.maximum=function(){if(!this.isEmpty()&&null!==this.root)return this.maximumAux(this.root).element},t.prototype.forEach=function(t){this.inorderTraversal(t)},t.prototype.toArray=function(){var t=[];return this.inorderTraversal(function(e){return t.push(e),!0}),t},t.prototype.height=function(){return this.heightAux(this.root)},t.prototype.searchNode=function(t,e){for(var n=1;null!==t&&0!==n;)(n=this.compare(e,t.element))<0?t=t.leftCh:n>0&&(t=t.rightCh);return t},t.prototype.transplant=function(t,e){null===t.parent?this.root=e:t===t.parent.leftCh?t.parent.leftCh=e:t.parent.rightCh=e,null!==e&&(e.parent=t.parent)},t.prototype.removeNode=function(t){if(null===t.leftCh)this.transplant(t,t.rightCh);else if(null===t.rightCh)this.transplant(t,t.leftCh);else{var e=this.minimumAux(t.rightCh);e.parent!==t&&(this.transplant(e,e.rightCh),e.rightCh=t.rightCh,e.rightCh.parent=e),this.transplant(t,e),e.leftCh=t.leftCh,e.leftCh.parent=e}},t.prototype.inorderTraversalAux=function(t,e,n){null===t||n.stop||(this.inorderTraversalAux(t.leftCh,e,n),!n.stop&&(n.stop=!1===e(t.element),!n.stop&&this.inorderTraversalAux(t.rightCh,e,n)))},t.prototype.levelTraversalAux=function(t,e){var n=new r.default;for(null!==t&&n.enqueue(t),t=n.dequeue()||null;null!=t;){if(!1===e(t.element))return;null!==t.leftCh&&n.enqueue(t.leftCh),null!==t.rightCh&&n.enqueue(t.rightCh),t=n.dequeue()||null}},t.prototype.preorderTraversalAux=function(t,e,n){null===t||n.stop||(n.stop=!1===e(t.element),!n.stop&&(this.preorderTraversalAux(t.leftCh,e,n),!n.stop&&this.preorderTraversalAux(t.rightCh,e,n)))},t.prototype.postorderTraversalAux=function(t,e,n){null===t||n.stop||(this.postorderTraversalAux(t.leftCh,e,n),!n.stop&&(this.postorderTraversalAux(t.rightCh,e,n),!n.stop&&(n.stop=!1===e(t.element))))},t.prototype.minimumAux=function(t){for(;null!=t&&null!==t.leftCh;)t=t.leftCh;return t},t.prototype.maximumAux=function(t){for(;null!=t&&null!==t.rightCh;)t=t.rightCh;return t},t.prototype.heightAux=function(t){return null===t?-1:Math.max(this.heightAux(t.leftCh),this.heightAux(t.rightCh))+1},t.prototype.insertNode=function(t){for(var e=null,n=this.root;null!==n;){var i=this.compare(t.element,n.element);if(0===i)return null;i<0?(e=n,n=n.leftCh):(e=n,n=n.rightCh)}return t.parent=e,null===e?this.root=t:this.compare(t.element,e.element)<0?e.leftCh=t:e.rightCh=t,t},t.prototype.createNode=function(t){return{element:t,leftCh:null,rightCh:null,parent:null}},t}();e.default=o},69:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(650),r=n(9310),o=n(378),s=function(){function t(t){this.toStrF=t||i.defaultToString,this.dictionary=new r.default(this.toStrF),this.nElements=0}return t.prototype.add=function(t,e){return void 0===e&&(e=1),!(i.isUndefined(t)||e<=0)&&(this.contains(t)?this.dictionary.getValue(t).copies+=e:this.dictionary.setValue(t,{value:t,copies:e}),this.nElements+=e,!0)},t.prototype.count=function(t){return this.contains(t)?this.dictionary.getValue(t).copies:0},t.prototype.contains=function(t){return this.dictionary.containsKey(t)},t.prototype.remove=function(t,e){if(void 0===e&&(e=1),i.isUndefined(t)||e<=0)return!1;if(this.contains(t)){var n=this.dictionary.getValue(t);return this.nElements-=e>n.copies?n.copies:e,n.copies-=e,n.copies<=0&&this.dictionary.remove(t),!0}return!1},t.prototype.toArray=function(){for(var t=[],e=0,n=this.dictionary.values();e<n.length;e++)for(var i=n[e],r=i.value,o=i.copies,s=0;s<o;s++)t.push(r);return t},t.prototype.toSet=function(){for(var t=new o.default(this.toStrF),e=0,n=this.dictionary.values();e<n.length;e++)t.add(n[e].value);return t},t.prototype.forEach=function(t){this.dictionary.forEach(function(e,n){for(var i=n.value,r=n.copies,o=0;o<r;o++)if(!1===t(i))return!1;return!0})},t.prototype.size=function(){return this.nElements},t.prototype.isEmpty=function(){return 0===this.nElements},t.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},t}();e.default=s},9310:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(650),r=function(){function t(t){this.table={},this.nElements=0,this.toStr=t||i.defaultToString}return t.prototype.getValue=function(t){var e=this.table["$"+this.toStr(t)];if(!i.isUndefined(e))return e.value},t.prototype.setValue=function(t,e){if(!i.isUndefined(t)&&!i.isUndefined(e)){var n,r="$"+this.toStr(t),o=this.table[r];return i.isUndefined(o)?(this.nElements++,n=void 0):n=o.value,this.table[r]={key:t,value:e},n}},t.prototype.remove=function(t){var e="$"+this.toStr(t),n=this.table[e];if(!i.isUndefined(n))return delete this.table[e],this.nElements--,n.value},t.prototype.keys=function(){var t=[];for(var e in this.table)i.has(this.table,e)&&t.push(this.table[e].key);return t},t.prototype.values=function(){var t=[];for(var e in this.table)i.has(this.table,e)&&t.push(this.table[e].value);return t},t.prototype.forEach=function(t){for(var e in this.table)if(i.has(this.table,e)){var n=this.table[e];if(!1===t(n.key,n.value))return}},t.prototype.containsKey=function(t){return!i.isUndefined(this.getValue(t))},t.prototype.clear=function(){this.table={},this.nElements=0},t.prototype.size=function(){return this.nElements},t.prototype.isEmpty=function(){return this.nElements<=0},t.prototype.toString=function(){var t="{";return this.forEach(function(e,n){t+="\n\t"+e+" : "+n}),t+"\n}"},t}();e.default=r},7397:function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(9310),s=n(650),a=function(t){function e(e,n){var i=t.call(this,n)||this;return i.defaultFactoryFunction=e,i}return r(e,t),e.prototype.setDefault=function(e,n){var i=t.prototype.getValue.call(this,e);return s.isUndefined(i)?(this.setValue(e,n),n):i},e.prototype.getValue=function(t){return this.setDefault(t,this.defaultFactoryFunction())},e}(o.default);e.default=a},1140:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(650),r=n(1960),o=function(){function t(t){this.data=[],this.compare=t||i.defaultCompare}return t.prototype.leftChildIndex=function(t){return 2*t+1},t.prototype.rightChildIndex=function(t){return 2*t+2},t.prototype.parentIndex=function(t){return Math.floor((t-1)/2)},t.prototype.minIndex=function(t,e){return e>=this.data.length?t>=this.data.length?-1:t:this.compare(this.data[t],this.data[e])<=0?t:e},t.prototype.siftUp=function(t){for(var e=this.parentIndex(t);t>0&&this.compare(this.data[e],this.data[t])>0;)r.swap(this.data,e,t),e=this.parentIndex(t=e)},t.prototype.siftDown=function(t){for(var e=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t));e>=0&&this.compare(this.data[t],this.data[e])>0;)r.swap(this.data,e,t),e=this.minIndex(this.leftChildIndex(t=e),this.rightChildIndex(t))},t.prototype.peek=function(){if(this.data.length>0)return this.data[0]},t.prototype.add=function(t){return!i.isUndefined(t)&&(this.data.push(t),this.siftUp(this.data.length-1),!0)},t.prototype.removeRoot=function(){if(this.data.length>0){var t=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),t}},t.prototype.contains=function(t){var e=i.compareToEquals(this.compare);return r.contains(this.data,t,e)},t.prototype.size=function(){return this.data.length},t.prototype.isEmpty=function(){return this.data.length<=0},t.prototype.clear=function(){this.data.length=0},t.prototype.forEach=function(t){r.forEach(this.data,t)},t}();e.default=o},2445:function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(9310),s=n(650),a=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},t}(),l=function(){function t(){this.key=null,this.value=null}return t.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},t}();function c(t){return!t.next}var u=function(t){function e(e){var n=t.call(this,e)||this;return n.head=new l,n.tail=new l,n.head.next=n.tail,n.tail.prev=n.head,n}return r(e,t),e.prototype.appendToTail=function(t){var e=this.tail.prev;e.next=t,t.prev=e,t.next=this.tail,this.tail.prev=t},e.prototype.getLinkedDictionaryPair=function(t){if(!s.isUndefined(t)){var e="$"+this.toStr(t);return this.table[e]}},e.prototype.getValue=function(t){var e=this.getLinkedDictionaryPair(t);if(!s.isUndefined(e))return e.value},e.prototype.remove=function(e){var n=this.getLinkedDictionaryPair(e);if(!s.isUndefined(n))return t.prototype.remove.call(this,e),n.unlink(),n.value},e.prototype.clear=function(){t.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},e.prototype.replace=function(t,e){var n="$"+this.toStr(e.key);e.next=t.next,e.prev=t.prev,this.remove(t.key),e.prev.next=e,e.next.prev=e,this.table[n]=e,++this.nElements},e.prototype.setValue=function(t,e){if(!s.isUndefined(t)&&!s.isUndefined(e)){var n=this.getLinkedDictionaryPair(t),i=new a(t,e),r="$"+this.toStr(t);return s.isUndefined(n)?(this.appendToTail(i),this.table[r]=i,void++this.nElements):(this.replace(n,i),n.value)}},e.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(e)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),t},e.prototype.forEach=function(t){for(var e=this.head.next;!c(e);){if(!1===t(e.key,e.value))return;e=e.next}},e}(o.default);e.default=u},2374:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(650),r=n(1960),o=function(){function t(){this.firstNode=null,this.lastNode=null,this.nElements=0}return t.prototype.add=function(t,e){if(i.isUndefined(e)&&(e=this.nElements),e<0||e>this.nElements||i.isUndefined(t))return!1;var n=this.createNode(t);if(0===this.nElements||null===this.lastNode)this.firstNode=n,this.lastNode=n;else if(e===this.nElements)this.lastNode.next=n,this.lastNode=n;else if(0===e)n.next=this.firstNode,this.firstNode=n;else{var r=this.nodeAtIndex(e-1);if(null===r)return!1;n.next=r.next,r.next=n}return this.nElements++,!0},t.prototype.first=function(){if(null!==this.firstNode)return this.firstNode.element},t.prototype.last=function(){if(null!==this.lastNode)return this.lastNode.element},t.prototype.elementAtIndex=function(t){var e=this.nodeAtIndex(t);if(null!==e)return e.element},t.prototype.indexOf=function(t,e){var n=e||i.defaultEquals;if(i.isUndefined(t))return-1;for(var r=this.firstNode,o=0;null!==r;){if(n(r.element,t))return o;o++,r=r.next}return-1},t.prototype.contains=function(t,e){return this.indexOf(t,e)>=0},t.prototype.remove=function(t,e){var n=e||i.defaultEquals;if(this.nElements<1||i.isUndefined(t))return!1;for(var r=null,o=this.firstNode;null!==o;){if(n(o.element,t))return null===r?(this.firstNode=o.next,o===this.lastNode&&(this.lastNode=null)):o===this.lastNode?(this.lastNode=r,r.next=o.next,o.next=null):(r.next=o.next,o.next=null),this.nElements--,!0;r=o,o=o.next}return!1},t.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},t.prototype.equals=function(e,n){var r=n||i.defaultEquals;return e instanceof t&&this.size()===e.size()&&this.equalsAux(this.firstNode,e.firstNode,r)},t.prototype.equalsAux=function(t,e,n){for(;null!==t&&null!==e;){if(!n(t.element,e.element))return!1;t=t.next,e=e.next}return!0},t.prototype.removeElementAtIndex=function(t){if(!(t<0||t>=this.nElements||null===this.firstNode||null===this.lastNode)){var e;if(1===this.nElements)e=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var n=this.nodeAtIndex(t-1);null===n?(e=this.firstNode.element,this.firstNode=this.firstNode.next):n.next===this.lastNode&&(e=this.lastNode.element,this.lastNode=n),null!==n&&null!==n.next&&(e=n.next.element,n.next=n.next.next)}return this.nElements--,e}},t.prototype.forEach=function(t){for(var e=this.firstNode;null!==e&&!1!==t(e.element);)e=e.next},t.prototype.reverse=function(){for(var t=null,e=this.firstNode,n=null;null!==e;)n=e.next,e.next=t,t=e,e=n;n=this.firstNode,this.firstNode=this.lastNode,this.lastNode=n},t.prototype.toArray=function(){for(var t=[],e=this.firstNode;null!==e;)t.push(e.element),e=e.next;return t},t.prototype.size=function(){return this.nElements},t.prototype.isEmpty=function(){return this.nElements<=0},t.prototype.toString=function(){return r.toString(this.toArray())},t.prototype.nodeAtIndex=function(t){if(t<0||t>=this.nElements)return null;if(t===this.nElements-1)return this.lastNode;for(var e=this.firstNode,n=0;n<t&&null!==e;n++)e=e.next;return e},t.prototype.createNode=function(t){return{element:t,next:null}},t}();e.default=o},7139:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(650),r=n(9310),o=n(1960),s=function(){function t(t,e,n){void 0===n&&(n=!1),this.dict=new r.default(t),this.equalsF=e||i.defaultEquals,this.allowDuplicate=n}return t.prototype.getValue=function(t){var e=this.dict.getValue(t);return i.isUndefined(e)?[]:o.copy(e)},t.prototype.setValue=function(t,e){if(i.isUndefined(t)||i.isUndefined(e))return!1;var n=this.dict.getValue(t);return i.isUndefined(n)?(this.dict.setValue(t,[e]),!0):!(!this.allowDuplicate&&o.contains(n,e,this.equalsF)||(n.push(e),0))},t.prototype.remove=function(t,e){if(i.isUndefined(e)){var n=this.dict.remove(t);return!i.isUndefined(n)}var r=this.dict.getValue(t);return!(i.isUndefined(r)||!o.remove(r,e,this.equalsF)||(0===r.length&&this.dict.remove(t),0))},t.prototype.keys=function(){return this.dict.keys()},t.prototype.values=function(){for(var t=[],e=0,n=this.dict.values();e<n.length;e++)for(var i=0,r=n[e];i<r.length;i++)t.push(r[i]);return t},t.prototype.containsKey=function(t){return this.dict.containsKey(t)},t.prototype.clear=function(){this.dict.clear()},t.prototype.size=function(){return this.dict.size()},t.prototype.isEmpty=function(){return this.dict.isEmpty()},t}();e.default=s},8260:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(()=>{return(t=n||(n={}))[t.BEFORE=0]="BEFORE",t[t.AFTER=1]="AFTER",t[t.INSIDE_AT_END=2]="INSIDE_AT_END",t[t.INSIDE_AT_START=3]="INSIDE_AT_START",n;var t})(),i=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.rootIds=t,this.nodes=e,this.initRootIds(),this.initNodes()}return t.prototype.initRootIds=function(){for(var t=0,e=this.rootIds;t<e.length;t++)this.createEmptyNodeIfNotExist(e[t])},t.prototype.initNodes=function(){for(var t in this.nodes)if(this.nodes.hasOwnProperty(t))for(var e=0,n=this.nodes[t];e<n.length;e++)this.createEmptyNodeIfNotExist(n[e])},t.prototype.createEmptyNodeIfNotExist=function(t){this.nodes[t]||(this.nodes[t]=[])},t.prototype.getRootIds=function(){return this.rootIds.slice()},t.prototype.getNodes=function(){var t={};for(var e in this.nodes)this.nodes.hasOwnProperty(e)&&(t[e]=this.nodes[e].slice());return t},t.prototype.getObject=function(){return{rootIds:this.getRootIds(),nodes:this.getNodes()}},t.prototype.toObject=function(){return this.getObject()},t.prototype.flatten=function(){for(var t=this,e=[],n=0;n<this.rootIds.length;n++){var i=this.rootIds[n];e.push({id:i,level:0,hasParent:!1,childrenCount:0}),l(i,this.nodes,e,0)}for(var r=0,o=e;r<o.length;r++){var s=o[r];s.childrenCount=t.nodes[a=s.id]?t.nodes[a].length:0}var a;return e;function l(t,e,n,i){if(void 0===i&&(i=0),t&&e&&n&&e[t]){i++;for(var r=e[t],o=0;o<r.length;o++){var s=r[o];n.push({id:s,level:i,hasParent:!0}),l(s,e,n,i)}i--}}},t.prototype.moveIdBeforeId=function(t,e){return this.moveId(t,e,n.BEFORE)},t.prototype.moveIdAfterId=function(t,e){return this.moveId(t,e,n.AFTER)},t.prototype.moveIdIntoId=function(t,e,i){return void 0===i&&(i=!0),this.moveId(t,e,i?n.INSIDE_AT_START:n.INSIDE_AT_END)},t.prototype.swapRootIdWithRootId=function(t,e){var n=this.findRootId(t),i=this.findRootId(e);this.swapRootPositionWithRootPosition(n,i)},t.prototype.swapRootPositionWithRootPosition=function(t,e){var n=this.rootIds[e];this.rootIds[e]=this.rootIds[t],this.rootIds[t]=n},t.prototype.deleteId=function(t){this.rootDeleteId(t),this.nodeAndSubNodesDelete(t),this.nodeRefrencesDelete(t)},t.prototype.insertIdBeforeId=function(t,e){var n=this.findRootId(t);for(var i in n>-1&&this.insertIdIntoRoot(e,n),this.nodes)if(this.nodes.hasOwnProperty(i)){var r=this.findNodeId(i,t);r>-1&&this.insertIdIntoNode(i,e,r)}},t.prototype.insertIdAfterId=function(t,e){var n=this.findRootId(t);for(var i in n>-1&&this.insertIdIntoRoot(e,n+1),this.nodes)if(this.nodes.hasOwnProperty(i)){var r=this.findNodeId(i,t);r>-1&&this.insertIdIntoNode(i,e,r+1)}},t.prototype.insertIdIntoId=function(t,e){this.nodeInsertAtEnd(t,e),this.nodes[e]=[]},t.prototype.insertIdIntoRoot=function(t,e){void 0===e?this.rootInsertAtEnd(t):this.rootIds.splice(e<0?e+this.rootIds.length+1:e,0,t),this.nodes[t]=this.nodes[t]||[]},t.prototype.insertIdIntoNode=function(t,e,n){this.nodes[t]=this.nodes[t]||[],this.nodes[e]=this.nodes[e]||[],void 0===n?this.nodeInsertAtEnd(t,e):this.nodes[t].splice(n<0?n+this.nodes[t].length+1:n,0,e)},t.prototype.moveId=function(t,e,i){var r=t,o=this.findRootId(r);for(var s in this.nodes)if(this.nodes.hasOwnProperty(s)){this.findNodeId(s,e);break}var a=e,l=this.findRootId(a);for(var s in this.nodes)if(this.nodes.hasOwnProperty(s)){this.findNodeId(s,e);break}if(o>-1){if(l>-1)switch(this.rootDelete(o),l>o&&l--,i){case n.BEFORE:this.insertIdIntoRoot(r,l);break;case n.AFTER:this.insertIdIntoRoot(r,l+1);break;case n.INSIDE_AT_START:this.nodeInsertAtStart(a,r);break;case n.INSIDE_AT_END:this.nodeInsertAtEnd(a,r)}else for(var s in this.rootDelete(o),this.nodes)if(this.nodes.hasOwnProperty(s)&&(c=this.findNodeId(s,a))>-1){switch(i){case n.BEFORE:this.insertIdIntoNode(s,r,c);break;case n.AFTER:this.insertIdIntoNode(s,r,c+1);break;case n.INSIDE_AT_START:this.nodeInsertAtStart(a,r);break;case n.INSIDE_AT_END:this.nodeInsertAtEnd(a,r)}break}}else if(l>-1){for(var s in this.nodes)if(this.nodes.hasOwnProperty(s)&&(c=this.findNodeId(s,r))>-1){this.nodeDeleteAtIndex(s,c);break}switch(i){case n.BEFORE:this.insertIdIntoRoot(r,l);break;case n.AFTER:this.insertIdIntoRoot(r,l+1);break;case n.INSIDE_AT_START:this.nodeInsertAtStart(a,r);break;case n.INSIDE_AT_END:this.nodeInsertAtEnd(a,r)}}else{for(var s in this.nodes)if(this.nodes.hasOwnProperty(s)&&(c=this.findNodeId(s,r))>-1){this.nodeDeleteAtIndex(s,c);break}for(var s in this.nodes)if(this.nodes.hasOwnProperty(s)){var c;if((c=this.findNodeId(s,a))>-1){switch(i){case n.BEFORE:this.insertIdIntoNode(s,r,c);break;case n.AFTER:this.insertIdIntoNode(s,r,c+1);break;case n.INSIDE_AT_START:this.nodeInsertAtStart(a,r);break;case n.INSIDE_AT_END:this.nodeInsertAtEnd(a,r)}break}}}},t.prototype.swapArrayElements=function(t,e,n){var i=t[e];return t[e]=t[n],t[n]=i,t},t.prototype.rootDeleteId=function(t){var e=this.findRootId(t);e>-1&&this.rootDelete(e)},t.prototype.nodeAndSubNodesDelete=function(t){for(var e=[],n=0;n<this.nodes[t].length;n++)this.nodeAndSubNodesDelete(this.nodes[t][n]),e.push(t);for(this.nodeDelete(t),n=0;n<e.length;n++)this.nodeDelete(e[n])},t.prototype.nodeRefrencesDelete=function(t){for(var e in this.nodes)if(this.nodes.hasOwnProperty(e))for(var n=0;n<this.nodes[e].length;n++)this.nodes[e][n]===t&&this.nodeDeleteAtIndex(e,n)},t.prototype.nodeDelete=function(t){delete this.nodes[t]},t.prototype.findRootId=function(t){return this.rootIds.indexOf(t)},t.prototype.findNodeId=function(t,e){return this.nodes[t].indexOf(e)},t.prototype.findNode=function(t){return this.nodes[t]},t.prototype.nodeInsertAtStart=function(t,e){this.nodes[t].unshift(e)},t.prototype.nodeInsertAtEnd=function(t,e){this.nodes[t].push(e)},t.prototype.rootDelete=function(t){this.rootIds.splice(t,1)},t.prototype.nodeDeleteAtIndex=function(t,e){this.nodes[t].splice(e,1)},t.prototype.rootInsertAtStart=function(t){this.rootIds.unshift(t)},t.prototype.rootInsertAtEnd=function(t){this.rootIds.push(t)},t}();e.default=i},3938:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(650),r=n(1140),o=function(){function t(t){this.heap=new r.default(i.reverseCompareFunction(t))}return t.prototype.enqueue=function(t){return this.heap.add(t)},t.prototype.add=function(t){return this.heap.add(t)},t.prototype.dequeue=function(){if(0!==this.heap.size()){var t=this.heap.peek();return this.heap.removeRoot(),t}},t.prototype.peek=function(){return this.heap.peek()},t.prototype.contains=function(t){return this.heap.contains(t)},t.prototype.isEmpty=function(){return this.heap.isEmpty()},t.prototype.size=function(){return this.heap.size()},t.prototype.clear=function(){this.heap.clear()},t.prototype.forEach=function(t){this.heap.forEach(t)},t}();e.default=o},877:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2374),r=function(){function t(){this.list=new i.default}return t.prototype.enqueue=function(t){return this.list.add(t)},t.prototype.add=function(t){return this.list.add(t)},t.prototype.dequeue=function(){if(0!==this.list.size()){var t=this.list.first();return this.list.removeElementAtIndex(0),t}},t.prototype.peek=function(){if(0!==this.list.size())return this.list.first()},t.prototype.size=function(){return this.list.size()},t.prototype.contains=function(t,e){return this.list.contains(t,e)},t.prototype.isEmpty=function(){return this.list.size()<=0},t.prototype.clear=function(){this.list.clear()},t.prototype.forEach=function(t){this.list.forEach(t)},t}();e.default=r},378:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(650),r=n(1960),o=n(9310),s=function(){function t(t){this.dictionary=new o.default(t)}return t.prototype.contains=function(t){return this.dictionary.containsKey(t)},t.prototype.add=function(t){return!this.contains(t)&&!i.isUndefined(t)&&(this.dictionary.setValue(t,t),!0)},t.prototype.intersection=function(t){var e=this;this.forEach(function(n){return t.contains(n)||e.remove(n),!0})},t.prototype.union=function(t){var e=this;t.forEach(function(t){return e.add(t),!0})},t.prototype.difference=function(t){var e=this;t.forEach(function(t){return e.remove(t),!0})},t.prototype.isSubsetOf=function(t){if(this.size()>t.size())return!1;var e=!0;return this.forEach(function(n){return!!t.contains(n)||(e=!1,!1)}),e},t.prototype.remove=function(t){return!!this.contains(t)&&(this.dictionary.remove(t),!0)},t.prototype.forEach=function(t){this.dictionary.forEach(function(e,n){return t(n)})},t.prototype.toArray=function(){return this.dictionary.values()},t.prototype.isEmpty=function(){return this.dictionary.isEmpty()},t.prototype.size=function(){return this.dictionary.size()},t.prototype.clear=function(){this.dictionary.clear()},t.prototype.toString=function(){return r.toString(this.toArray())},t}();e.default=s},8647:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2374),r=function(){function t(){this.list=new i.default}return t.prototype.push=function(t){return this.list.add(t,0)},t.prototype.add=function(t){return this.list.add(t,0)},t.prototype.pop=function(){return this.list.removeElementAtIndex(0)},t.prototype.peek=function(){return this.list.first()},t.prototype.size=function(){return this.list.size()},t.prototype.contains=function(t,e){return this.list.contains(t,e)},t.prototype.isEmpty=function(){return this.list.isEmpty()},t.prototype.clear=function(){this.list.clear()},t.prototype.forEach=function(t){this.list.forEach(t)},t}();e.default=r},1960:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(650);function r(t,e,n){for(var r=n||i.defaultEquals,o=t.length,s=0;s<o;s++)if(r(t[s],e))return s;return-1}e.indexOf=r,e.lastIndexOf=function(t,e,n){for(var r=n||i.defaultEquals,o=t.length-1;o>=0;o--)if(r(t[o],e))return o;return-1},e.contains=function(t,e,n){return r(t,e,n)>=0},e.remove=function(t,e,n){var i=r(t,e,n);return!(i<0||(t.splice(i,1),0))},e.frequency=function(t,e,n){for(var r=n||i.defaultEquals,o=t.length,s=0,a=0;a<o;a++)r(t[a],e)&&s++;return s},e.equals=function(t,e,n){var r=n||i.defaultEquals;if(t.length!==e.length)return!1;for(var o=t.length,s=0;s<o;s++)if(!r(t[s],e[s]))return!1;return!0},e.copy=function(t){return t.concat()},e.swap=function(t,e,n){if(e<0||e>=t.length||n<0||n>=t.length)return!1;var i=t[e];return t[e]=t[n],t[n]=i,!0},e.toString=function(t){return"["+t.toString()+"]"},e.forEach=function(t,e){for(var n=0,i=t;n<i.length;n++)if(!1===e(i[n]))return}},9226:function(t,e,n){"use strict";n(1960),n(69),n(9666),n(8983);var i=n(9310);e.Xy=i.default,n(1140),n(2445),n(2374),n(7139),n(7397),n(7397),n(877),n(3938),n(378),n(8647),n(8260),n(650)},650:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Object.prototype.hasOwnProperty;function i(t){return"function"==typeof t}function r(t){return void 0===t}function o(t){return"[object String]"===Object.prototype.toString.call(t)}e.has=function(t,e){return n.call(t,e)},e.defaultCompare=function(t,e){return t<e?-1:t===e?0:1},e.defaultEquals=function(t,e){return t===e},e.defaultToString=function(t){return null===t?"COLLECTION_NULL":r(t)?"COLLECTION_UNDEFINED":o(t)?"$s"+t:"$o"+t.toString()},e.makeString=function(t,n){if(void 0===n&&(n=","),null===t)return"COLLECTION_NULL";if(r(t))return"COLLECTION_UNDEFINED";if(o(t))return t.toString();var i="{",s=!0;for(var a in t)e.has(t,a)&&(s?s=!1:i+=n,i=i+a+":"+t[a]);return i+"}"},e.isFunction=i,e.isUndefined=r,e.isString=o,e.reverseCompareFunction=function(t){return r(t)||!i(t)?function(t,e){return t<e?1:t===e?0:-1}:function(e,n){return-1*t(e,n)}},e.compareToEquals=function(t){return function(e,n){return 0===t(e,n)}}},1099:function(t,e,n){"use strict";n.d(e,{B:function(){return f}});var i=n(639),r=n(6579),o=n(2517),s=n(8583);function a(t,e){if(1&t&&(i.TgZ(0,"ion-badge",7),i._uU(1),i.qZA()),2&t){const t=i.oxw().$implicit;i.xp6(1),i.hij("",t.Quantity," x")}}function l(t,e){if(1&t&&(i.TgZ(0,"strong"),i._uU(1),i.qZA()),2&t){const t=i.oxw().$implicit;i.xp6(1),i.hij("",t.PowerKW," kW ")}}function c(t,e){if(1&t&&(i.TgZ(0,"div"),i._uU(1),i.qZA()),2&t){const t=i.oxw().$implicit;i.xp6(1),i.hij("",null==t.CurrentType?null:t.CurrentType.Title," ")}}function u(t,e){if(1&t&&(i.TgZ(0,"span"),i._uU(1),i.qZA()),2&t){const t=i.oxw().$implicit;i.xp6(1),i.hij("",t.Amps,"A ")}}function h(t,e){if(1&t&&(i.TgZ(0,"span"),i._uU(1),i.qZA()),2&t){const t=i.oxw().$implicit;i.xp6(1),i.hij("",t.Voltage,"V ")}}function d(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"ion-col"),i.TgZ(1,"ion-button",8),i.NdJ("click",function(){i.CHM(t);const e=i.oxw().$implicit;return i.oxw().editConnection(e)}),i._UZ(2,"ion-icon",9),i.qZA(),i._UZ(3,"br"),i.TgZ(4,"ion-button",10),i.NdJ("click",function(){i.CHM(t);const e=i.oxw().$implicit;return i.oxw().deleteConnection(e)}),i._UZ(5,"ion-icon",11),i.qZA(),i.qZA()}}function p(t,e){if(1&t&&(i.TgZ(0,"ion-row"),i.TgZ(1,"ion-col"),i.TgZ(2,"ion-row"),i.TgZ(3,"ion-col",1),i._UZ(4,"img",2),i.YNc(5,a,2,1,"ion-badge",3),i.TgZ(6,"div",4),i._uU(7),i.qZA(),i.qZA(),i.TgZ(8,"ion-col"),i.TgZ(9,"ion-row"),i.TgZ(10,"ion-col"),i.TgZ(11,"ion-note"),i.TgZ(12,"div"),i.TgZ(13,"strong",5),i._uU(14),i.qZA(),i.qZA(),i.YNc(15,l,2,1,"strong",6),i.YNc(16,c,2,1,"div",6),i.qZA(),i.TgZ(17,"ion-note"),i.YNc(18,u,2,1,"span",6),i.YNc(19,h,2,1,"span",6),i.qZA(),i.qZA(),i.qZA(),i.TgZ(20,"ion-row"),i.TgZ(21,"ion-col",4),i._uU(22),i.qZA(),i.TgZ(23,"ion-col",4),i._uU(24),i.qZA(),i.qZA(),i.qZA(),i.YNc(25,d,6,0,"ion-col",6),i.qZA(),i.qZA(),i.qZA()),2&t){const t=e.$implicit,n=i.oxw();i.xp6(4),i.Q6J("src",n.getConnectorTypeIcon(t.ConnectionTypeID),i.LSH),i.xp6(1),i.Q6J("ngIf",t.Quantity),i.xp6(2),i.Oqu(null==t.StatusType?null:t.StatusType.Title),i.xp6(6),i.s9C("title",null==t.ConnectionType?null:t.ConnectionType.FormalName),i.xp6(1),i.hij("",null==t.ConnectionType?null:t.ConnectionType.Title," "),i.xp6(1),i.Q6J("ngIf",t.PowerKW),i.xp6(1),i.Q6J("ngIf",t.CurrentTypeID),i.xp6(2),i.Q6J("ngIf",t.Amps),i.xp6(1),i.Q6J("ngIf",t.Voltage),i.xp6(3),i.Oqu(t.Reference),i.xp6(2),i.Oqu(t.Comments),i.xp6(1),i.Q6J("ngIf",n.enableEdit)}}let f=(()=>{class t{constructor(){this.enableEdit=!1,this.onEdit=new i.vpe,this.onDelete=new i.vpe}ngOnInit(){}editConnection(t){this.onEdit.emit(t)}deleteConnection(t){this.onDelete.emit(t)}getConnectorTypeIcon(t){return r.c.getIconForConnector(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-equipment-details"]],inputs:{item:"item",enableEdit:"enableEdit"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],["size","3"],[2,"max-width","64px",3,"src"],["color","primary",4,"ngIf"],[1,"info"],[3,"title"],[4,"ngIf"],["color","primary"],["size","small","color","secondary",3,"click"],["name","create","slot","icon-only"],["size","small","color","danger",3,"click"],["name","trash","slot","icon-only"]],template:function(t,e){1&t&&(i.TgZ(0,"ion-grid"),i.YNc(1,p,26,12,"ion-row",0),i.qZA()),2&t&&(i.xp6(1),i.Q6J("ngForOf",e.item.Connections))},directives:[o.jY,s.sg,o.Nd,o.wI,s.O5,o.uN,o.yp,o.YG,o.gu],styles:[""]}),t})()},2428:function(t,e,n){"use strict";n.d(e,{v:function(){return f}});var i=n(8239),r=n(7689),o=n(639),s=n(553),a=n(2517),l=n(1841),c=n(6260),u=n(8583);function h(t,e){1&t&&(o.TgZ(0,"div"),o._UZ(1,"ion-spinner"),o.qZA())}function d(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"ion-item",5),o.NdJ("click",function(){const e=o.CHM(t).$implicit;return o.oxw(2).placeSelected(e)}),o.TgZ(1,"ion-avatar",6),o._UZ(2,"ion-icon",7),o.qZA(),o.TgZ(3,"ion-label"),o.TgZ(4,"p"),o._uU(5),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=e.$implicit;o.xp6(5),o.Oqu(t.Address)}}function p(t,e){if(1&t&&(o.TgZ(0,"div",1),o.YNc(1,h,2,0,"div",2),o.TgZ(2,"ion-list"),o.YNc(3,d,6,1,"ion-item",3),o.TgZ(4,"ion-item"),o.TgZ(5,"p",4),o._uU(6),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&t){const t=o.oxw();o.xp6(1),o.Q6J("ngIf",t.searchInProgress),o.xp6(2),o.Q6J("ngForOf",t.placeList),o.xp6(3),o.hij(" ",t.placeAttribution," ")}}let f=(()=>{class t{constructor(t,e,n,i,r){this.logging=t,this.changeDetector=e,this.platform=n,this.http=i,this.events=r,this.searchInProgress=!1,this.placeSearchActive=!1,this.placeAttribution="",this.placeChanged=new o.vpe,this.searchKeyword="",this.searchInProgress=!1,this.mapService=new s.k(r,t,i)}ngOnInit(){var t=this;return(0,i.Z)(function*(){yield t.platform.ready(),t.mapService.initAPI()})()}onSearchFocus(){this.placeSearchFocused=!0}onSearchBlur(){this.placeSearchFocused=!1}onSearchCancel(){}getPlacesAutoComplete(t,e){var n=this;return(0,i.Z)(function*(){n.placeSearchType=e;let i=t.target.value;if(i&&i.length>3){n.logging.log("Starting place lookup for:"+i),n.placeSearchActive=!0,n.searchInProgress=!0,n.searchInProgress=!1,n.placeSearchActive=!0;try{n.placeList=yield n.mapService.placeSearch(i),n.placeList&&n.placeList.length>0&&(n.placeAttribution=n.placeList[0].Attribution)}catch(r){}n.searchInProgress=!1,n.placeSearchActive=!0}else n.searchInProgress=!1,n.placeSearchActive=!1})()}placeSelected(t){this.logging.log("Looking up place details:"+t.Title+"::"+t.ReferenceID),this.selectedPlace=t,this.placeChanged.emit(t),this.placeSearchActive=!1}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(r.z),o.Y36(o.sBO),o.Y36(a.t4),o.Y36(l.eN),o.Y36(c.z))},t.\u0275cmp=o.Xpm({type:t,selectors:[["place-search"]],inputs:{searchKeyword:"searchKeyword"},outputs:{selectedPlace:"selectedPlace",placeChanged:"placeChanged"},decls:1,vars:1,consts:[["class","place-search",4,"ngIf"],[1,"place-search"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],[1,"place-attribution"],[3,"click"],["item-left",""],["name","locate"]],template:function(t,e){1&t&&o.YNc(0,p,7,3,"div",0),2&t&&o.Q6J("ngIf",e.placeSearchActive)},directives:[u.O5,a.q_,u.sg,a.Ie,a.PQ,a.BJ,a.gu,a.Q$],styles:[".place-search[_ngcontent-%COMP%]{position:absolute;z-index:1000}.place-attribution[_ngcontent-%COMP%]{font-size:9px;color:#dcdcdc;max-width:100%}"]}),t})()},6585:function(t,e,n){"use strict";n.d(e,{o:function(){return u}});var i=n(639),r=n(6579),o=n(2517),s=n(8583);function a(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"ion-button",5),i.NdJ("click",function(){i.CHM(t);const e=i.oxw().$implicit;return i.oxw().onCopyCommand(e)}),i._uU(1,"Copy"),i.qZA()}}function l(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"ion-button",5),i.NdJ("click",function(){i.CHM(t);const e=i.oxw().$implicit;return i.oxw().onEditCommand(e)}),i._uU(1,"Edit"),i.qZA()}}function c(t,e){if(1&t&&(i.TgZ(0,"ion-item",1),i.TgZ(1,"ion-grid"),i.TgZ(2,"ion-row"),i.TgZ(3,"ion-col"),i._uU(4),i.qZA(),i.qZA(),i.TgZ(5,"ion-row"),i.TgZ(6,"ion-col",2),i.TgZ(7,"p"),i._UZ(8,"img",3),i.qZA(),i.TgZ(9,"ion-note"),i._uU(10),i.qZA(),i.YNc(11,a,2,0,"ion-button",4),i.YNc(12,l,2,0,"ion-button",4),i.qZA(),i.TgZ(13,"ion-col"),i.TgZ(14,"ion-row"),i.TgZ(15,"ion-col"),i.TgZ(16,"p"),i._uU(17),i.qZA(),i.TgZ(18,"ion-note"),i._uU(19),i.qZA(),i.qZA(),i.qZA(),i.TgZ(20,"ion-row"),i.TgZ(21,"ion-col"),i._uU(22),i.qZA(),i.TgZ(23,"ion-col"),i._uU(24),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i.qZA()),2&t){const t=e.$implicit,n=i.oxw();i.xp6(4),i.hij(" ",t.AddressInfo.Title," "),i.xp6(4),i.Q6J("src",n.getIconForPOI(t),i.LSH),i.xp6(2),i.hij(" ",n.getFormattedDistance(t)," "),i.xp6(1),i.Q6J("ngIf",n.enableCopyOption),i.xp6(1),i.Q6J("ngIf",n.enableEditOption),i.xp6(5),i.hij(" ",n.getFormattedAddress(t)," "),i.xp6(2),i.hij(" ",n.getFormattedConnectorList(t)," "),i.xp6(3),i.hij(" ",null==t.UsageType?null:t.UsageType.Title," "),i.xp6(2),i.hij(" ",null==t.OperatorInfo?null:t.OperatorInfo.Title," ")}}let u=(()=>{class t{constructor(){this.enableCopyOption=!1,this.enableEditOption=!1,this.poiList=[],this.onCopy=new i.vpe,this.onEdit=new i.vpe}ngOnInit(){}onCopyCommand(t){this.onCopy.emit(t)}onEditCommand(t){this.onEdit.emit(t)}getFormattedAddress(t){let e="";return e+=t.AddressInfo.Title!=t.AddressInfo.AddressLine1?t.AddressInfo.Title:t.AddressInfo.Town,e}getFormattedConnectorList(t){if(!t.Connections)return;let e=[];for(let n of t.Connections)null!=n.ConnectionType&&(e.find(t=>t==n.ConnectionType.Title)||e.push(n.ConnectionType.Title));return e.join(", ")}getIconForPOI(t){return r.c.getIconForPOI(t)}getFormattedDistance(t){return r.c.getFormattedDistance(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-poi-list"]],inputs:{enableCopyOption:"enableCopyOption",enableEditOption:"enableEditOption",poiList:"poiList"},outputs:{onCopy:"onCopy",onEdit:"onEdit"},decls:2,vars:1,consts:[["style","max-width:400px;",4,"ngFor","ngForOf"],[2,"max-width","400px"],["size","3"],[2,"width","24px",3,"src"],["size","small",3,"click",4,"ngIf"],["size","small",3,"click"]],template:function(t,e){1&t&&(i.TgZ(0,"ion-list"),i.YNc(1,c,25,9,"ion-item",0),i.qZA()),2&t&&(i.xp6(1),i.Q6J("ngForOf",e.poiList))},directives:[o.q_,s.sg,o.Ie,o.jY,o.Nd,o.wI,o.uN,s.O5,o.YG],styles:[""]}),t})()},8936:function(t,e,n){"use strict";n.d(e,{e:function(){return l}});var i=n(8583),r=n(2517),o=n(3679),s=n(4516),a=n(639);let l=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({providers:[i.JJ],imports:[[i.ez,r.Pc,o.u5,s.aw]]}),t})()},2951:function(t,e,n){"use strict";n.d(e,{X:function(){return r}});var i=n(2340);class r{constructor(){this.baseURL="https://map.openchargemap.io",this.loginProviderRedirectBaseURL="https://openchargemap.org/site/loginprovider/?_mode=silent&_forceLogin=true&_redirectURL=",this.loginProviderRedirectURL=this.loginProviderRedirectBaseURL+this.baseURL,this.enableLiveMapQuerying=!0,this.googleMapsAPIKey=i.N.googleMapsKey,this.enableStaticMaps=i.N.enableStaticMaps}}},6579:function(t,e,n){"use strict";n.d(e,{c:function(){return r}});var i=n(2340);let r=(()=>{class t{static isFeatureEnabled(t){return!!i.N.enabledFeatures.find(e=>e===t)}static getClientHeight(){const t=document.body,e=document.documentElement;return Math.max(t.scrollHeight,t.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight)}static getClientWidth(){const t=document.body,e=document.documentElement;return Math.max(t.scrollWidth,t.offsetWidth,e.clientWidth,e.scrollWidth,e.offsetWidth)}static getMaxLevelOfPOI(t){let e=0;if(null!=t.Connections)for(let n=0;n<t.Connections.length;n++)null!=t.Connections[n].Level&&t.Connections[n].Level.ID>e&&(e=t.Connections[n].Level.ID);return 4===e&&(e=2),e>4&&(e=3),e}static getIconForPOI(e){let n="assets/images/icons/map/level"+t.getMaxLevelOfPOI(e);return null!=e.UsageType&&e.UsageType.Title.indexOf("Private")>-1?n+="_private":n+=null!=e.StatusType&&!0!==e.StatusType.IsOperational?"_nonoperational":"_operational",n+="_icon.png",n}static getColorForPOI(e){const n=t.getMaxLevelOfPOI(e);let i="#c0c0c0";return null!=e.UsageType&&e.UsageType.Title.indexOf("Private")>-1?i="#FF0000":null!=e.StatusType&&!0!==e.StatusType.IsOperational?i="#a0a0a0":2==n?i="#72EB0D":3==n&&(i="#EB800D"),i}static getIconForConnector(t){let e="assets/images/icons/connectors/";return e+=1===t?"Type1_J1772.svg":2===t?"Chademo_type4.svg":25===t?"Type2_socket.svg":32===t?"Type1_CCS.svg":33===t?"Type2_CCS.svg":1036===t?"Type2_tethered.svg":28===t?"schuko.svg":"Unknown.svg",e}static getFormattedDistance(t){return t&&t.AddressInfo&&t.AddressInfo.Distance?t.AddressInfo.Distance.toFixed(1)+" "+(1===t.AddressInfo.DistanceUnit?"km":"miles"):""}static fixJSONDate(t){if(null==t)return null;if(0==t.indexOf("/")){let e=/Date\(([^)]+)\)/.exec(t);t=new Date(parseFloat(e[1]))}else t=new Date(t);return t}static formatMapLinkFromPosition(t,e,n,i,r){return'<a href="https://maps.google.com/maps?saddr='+e+","+n+"&daddr="+t.AddressInfo.Latitude+","+t.AddressInfo.Longitude+'">Map ('+Math.ceil(i)+" "+r+")</a>"}static formatSystemWebLink(t,e){return"<a href='#' onclick=\"window.open('"+t+"', '_system');return false;\">"+e+"</a>"}static formatMapLink(t,e,n){return n?device&&"WinCE"==device.platform?this.formatSystemWebLink("maps:"+t.AddressInfo.Latitude+","+t.AddressInfo.Longitude,e):device&&"iOS"===device.platform?this.formatSystemWebLink("https://maps.apple.com/?q="+t.AddressInfo.Latitude+","+t.AddressInfo.Longitude,e):this.formatSystemWebLink("https://maps.google.com/maps?q="+t.AddressInfo.Latitude+","+t.AddressInfo.Longitude,e):'<a target="_blank"  href="https://maps.google.com/maps?q='+t.AddressInfo.Latitude+","+t.AddressInfo.Longitude+'">'+e+"</a>"}static formatURL(t,e=null){return null==t||""==t?"":(-1==t.indexOf("http")&&(t="https://"+t),'<a target="_blank" href="'+t+'">'+(null!=e?e:t)+"</a>")}static formatString(t){return null==t?"":t.toString()}static formatTextField(t,e=null,n=!1,i=!1,r=null){if(null==t||""==t||null==t)return"";let o=(null!=e?"<strong class='ocm-label' "+(null!=r?"data-localize='"+r+"' ":"")+">"+e+"</strong>: ":"")+(n?"<br/>":"")+t.toString().replace("\n","<br/>")+"<br/>";return 1==i&&(o="<p>"+o+"</p>"),o}static formatEmailAddress(t){return null!=t&&null!=t&&""!=t?"<i class='fa fa-envelope fa-fw'></i> <a href=\"mailto:"+t+'">'+t+"</a><br/>":""}static formatPhone(t,e=null){return null!=t&&null!=t&&""!=t?(null==e?e="<i class='fa fa-phone fa-fw '></i> ":e+=": ",e+'<a href="tel:'+t+'">'+t+"</a><br/>"):""}static formatPOIDetails(t,e){let n=new Date;null==e&&(e=!1);let i=this.formatPOIAddress(t,!1),r="";r+=this.formatPhone(t.AddressInfo.ContactTelephone1),r+=this.formatPhone(t.AddressInfo.ContactTelephone2),r+=this.formatEmailAddress(t.AddressInfo.ContactEmail);let o="";if(null!=t.AddressInfo.Distance){let e="https://maps.google.com/maps?saddr=&daddr="+t.AddressInfo.Latitude+","+t.AddressInfo.Longitude;o+="<strong id='addr_distance'><span data-localize='details.approxDistance'>Distance</span>: "+t.AddressInfo.Distance.toFixed(1)+" "+(2==t.AddressInfo.DistanceUnit?"Miles":"KM")+"</strong>",o+="<p>"+this.formatSystemWebLink(e,"Get Directions")+"</p>"}if(null!=t.AddressInfo.RelatedURL&&""!=t.AddressInfo.RelatedURL){let e=t.AddressInfo.RelatedURL;e=e.replace(/.*?:\/\//g,""),e.length>40&&(e=e.substr(0,40)+".."),r+="<i class='fa fa-fw fa-external-link'></i>  "+this.formatSystemWebLink(t.AddressInfo.RelatedURL,"<span data-localize='details.addressRelatedURL'>"+e+"</span>")}r+="</p>";const s=this.formatTextField(t.GeneralComments,null,!1,!0)+this.formatTextField(t.AddressInfo.AccessComments,"Access",!0,!0,"details.accessComments");let a="";null!=t.NumberOfPoints&&(a+=this.formatTextField(t.NumberOfPoints,"Bays",!1,!0,"details.numberOfPoints")),null!=t.UsageType&&(a+=this.formatTextField(t.UsageType.Title,"Usage",!1,!0,"details.usageType")),null!=t.UsageCost&&(a+=this.formatTextField(t.UsageCost,"Usage Cost",!1,!0,"details.usageCost")),null!=t.OperatorInfo&&1!=t.OperatorInfo.ID&&(a+=this.formatTextField(t.OperatorInfo.Title,"Operator",!1,!0,"details.operatorTitle"),null!=t.OperatorInfo.WebsiteURL&&(a+=this.formatTextField(this.formatURL(t.OperatorInfo.WebsiteURL),"Operator Website",!0,!0,"details.operatorWebsite")));let l="";if(null!=t.StatusType&&(l+=this.formatTextField(t.StatusType.Title,"Status",!1,!0,"details.operationalStatus"),null!=t.DateLastStatusUpdate&&(l+=this.formatTextField(Math.round((n-this.fixJSONDate(t.DateLastStatusUpdate))/864e5)+" days ago","Last Updated",!1,!0,"details.lastUpdated"))),null!=t.Connections&&t.Connections.length>0){l+="<table class='table table-striped'>",l+="<tr><th data-localize='details.equipment.connectionType'>Connection</th><th data-localize='details.equipment.powerLevel'>Power Level</th><th data-localize='details.operationalStatus'>Status</th></tr>";for(let e=0;e<t.Connections.length;e++){let n=t.Connections[e];""==n.Amps&&(n.Amps=null),""==n.Voltage&&(n.Voltage=null),""==n.Quantity&&(n.Quantity=null),""==n.PowerKW&&(n.PowerKW=null),l+="<tr><td>"+(null!=n.ConnectionType?n.ConnectionType.Title:"")+"</td><td>"+(null!=n.Level?"<strong>"+n.Level.Title+"</strong><br/>":"")+(null!=n.Amps?this.formatString(n.Amps)+"A/ ":"")+(null!=n.Voltage?this.formatString(n.Voltage)+"V/ ":"")+(null!=n.PowerKW?this.formatString(n.PowerKW)+"kW <br/>":"")+(null!=n.CurrentType?n.CurrentType.Title:"")+"<br/>"+(null!=n.Quantity?this.formatString(n.Quantity):"1")+" Present</td><td>"+(null!=n.StatusType?n.StatusType.Title:"-")+"</td></tr>"}l+="</table>"}let c="";return c+=this.formatTextField("<a target='_blank' href='https://openchargemap.org/site/poi/details/"+t.ID+"'>OCM-"+t.ID+"</a>","OpenChargeMap Ref",!1,!0,"details.refNumber"),null!=t.DataProvider&&(c+=this.formatTextField(t.DataProvider.Title,"Data Provider",!1,!0,"details.dataProviderTitle"),null!=t.DataProvider.WebsiteURL&&(c+=this.formatTextField(this.formatURL(t.DataProvider.WebsiteURL),"Website",!1,!0,"details.dataProviderWebsite")),c+=this.formatTextField(t.AddressInfo.Latitude,"Latitude",!1,!0,null),c+=this.formatTextField(t.AddressInfo.Longitude,"Longitude",!1,!0,null)),{address:i,drivingInfo:o,contactInfo:r,additionalInfo:s+a+l,advancedInfo:c}}static debounce(t,e,n){let i;return function(){let r=this,o=arguments,s=function(){i=null,n||t.apply(r,o)},a=n&&!i;clearTimeout(i),i=setTimeout(s,e),a&&t.apply(r,o)}}static getRandomInt(t){return Math.floor(Math.random()*Math.floor(t))}}return t.formatPOIAddress=function(t,e=!0){let n="";return n=e?""+this.formatTextField(t.AddressInfo.AddressLine1)+this.formatTextField(t.AddressInfo.AddressLine2)+this.formatTextField(t.AddressInfo.Town)+this.formatTextField(t.AddressInfo.StateOrProvince)+this.formatTextField(t.AddressInfo.Postcode)+(null!=t.AddressInfo.Country?this.formatTextField(t.AddressInfo.Country.Title):""):this.formatStringArray([t.AddressInfo.AddressLine1,t.AddressInfo.AddressLine2,t.AddressInfo.Town,t.AddressInfo.StateOrProvince,t.AddressInfo.Postcode,null!=t.AddressInfo.Country?t.AddressInfo.Country.Title:""]),n},t.formatStringArray=function(t,e=", "){if(null==t)return"";let n="";for(let i=0;i<t.length;i++)null!=t[i]&&""!=t[i].trim()&&(n+=i==t.length-1?t[i]:t[i]+e);return n},t})()},4120:function(t,e,n){"use strict";n.d(e,{wC:function(){return i},jR:function(){return r},LL:function(){return o}});class i{constructor(t=null,e=null){this.latitude=t,this.longitude=e}}class r{constructor(t=null,e=null){this.coords=new i,this.coords.latitude=t,this.coords.longitude=e}static fromPosition(t){return new r(t.coords.latitude,t.coords.longitude)}}class o{constructor(t,e){this.northEast=t,this.southWest=e}}},1122:function(t,e,n){"use strict";n.d(e,{Qp:function(){return o},fw:function(){return l},JJ:function(){return u},eN:function(){return c},vw:function(){return a},kA:function(){return s}});class i{constructor(t,e){this.itemType=t,this.itemId=i.getNewItemId(),this.version=1,this.schemaVersion=e,this.syncTimeStamp=i.getNewSyncTimeStamp()}static getNewSyncTimeStamp(){return Date.now().toString()}static getNewItemId(){return"_syncitem_"+Date.now().toString()}}class r{constructor(t,e){this._sync=new i(t,e)}}class o extends r{}class s extends r{constructor(){super("waypoint",1)}}class a extends r{constructor(){super("journey_stage",1),this.WayPoints=[]}}class l extends r{constructor(){super("journey",1),this.ID=""+Date.now(),this.Stages=[]}}class c{}class u{}},2206:function(t,e,n){"use strict";n.d(e,{b:function(){return i}});class i{constructor(){this.poiIdList=null,this.countryCode=null,this.latitude=null,this.longitude=null,this.locationTitle=null,this.distance=null,this.distanceUnit=null,this.connectionTypeIdList=null,this.operatorIdList=null,this.levelIdList=null,this.countryIdList=null,this.usageTypeIdList=null,this.statusTypeIdList=null,this.minPowerKW=null,this.maxPowerKW=null,this.submissionStatusTypeIdList=null,this.maxResults=250,this.additionalParams=null,this.includeComments=!1,this.compact=!0,this.enableCaching=!0,this.levelOfDetail=1,this.polyline=null,this.boundingbox=null}}},4209:function(t,e,n){"use strict";n.d(e,{n:function(){return i}});class i{}},7627:function(t,e,n){"use strict";n.d(e,{U:function(){return i},N:function(){return r}});const i=650;class r{constructor(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MaxPowerKW=null,this.MinPowerKW=null,this.HasActiveFilters=!1,this.FilterOptionsByCountryId=null,this.UseDistanceInKM=!0,this.MapType="ROADMAP",this.EnableAdvancedEditorFeatures=!1}LoadSettings(){}SaveSettings(){}ClearActiveFilters(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MinPowerKW=null,this.MaxPowerKW=null}CheckForActiveFilters(){return this.HasActiveFilters=this.OperatorList.length>0||this.ConnectionTypeList.length>0||this.CountryList.length>0||this.UsageTypeList.length>0||this.StatusTypeList.length>0||this.MinPowerKW>0||this.MaxPowerKW>0||null!=this.MaxPowerKW&&this.MaxPowerKW<i,this.HasActiveFilters}}},8649:function(t,e,n){"use strict";n.d(e,{q:function(){return i}});var i=(()=>{return(t=i||(i={}))[t.POI=0]="POI",t[t.Comment=1]="Comment",t[t.Media=2]="Media",i;var t})()},323:function(t,e,n){"use strict";n.r(e),n.d(e,{AboutPageModule:function(){return d}});var i=n(8583),r=n(3679),o=n(2517),s=n(8093),a=n(388),l=n(639);const c=[{path:"",component:a.t}];let u=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[s.Bz.forChild(c)],s.Bz]}),t})();var h=n(4516);let d=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[i.ez,r.u5,o.Pc,h.aw,u]]}),t})()},388:function(t,e,n){"use strict";n.d(e,{t:function(){return a}});var i=n(2340),r=n(639),o=n(2517),s=n(4516);let a=(()=>{class t{constructor(t){this.modalController=t}get appVersion(){return i.N.version}get apiUrl(){return i.N.apiBase}ngOnInit(){}close(){this.modalController.dismiss()}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(o.IN))},t.\u0275cmp=r.Xpm({type:t,selectors:[["app-about"]],decls:49,vars:5,consts:[[1,"ion-padding"],["size","2"],["src","assets/images/icons/branding/AppIcon_128x128.png",2,"padding-top","2em"],["href","https://openchargemap.org"],["href","https://community.openchargemap.org"],["href","https://github.com/openchargemap/ocm-system/issues"],["href","https://webprofusion.com"],["href","https://opencollective.com/openchargemap"],["slot","end"],[3,"click"],["name","close","slot","start"]],template:function(t,e){1&t&&(r.TgZ(0,"ion-header"),r.TgZ(1,"ion-toolbar"),r.TgZ(2,"ion-title"),r._uU(3),r.ALo(4,"translate"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(5,"ion-content",0),r.TgZ(6,"ion-grid"),r.TgZ(7,"ion-row"),r.TgZ(8,"ion-col",1),r._UZ(9,"img",2),r.qZA(),r.TgZ(10,"ion-col"),r.TgZ(11,"h1"),r._uU(12,"Open Charge Map"),r.qZA(),r.TgZ(13,"h2"),r._uU(14,"The global public registry of Electric Vehicle charging locations"),r.qZA(),r.TgZ(15,"p"),r._uU(16,"Web: "),r.TgZ(17,"a",3),r._uU(18,"https://openchargemap.org"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(19,"p"),r._uU(20,"Community Discussions: "),r.TgZ(21,"a",4),r._uU(22,"https://community.openchargemap.org"),r.qZA(),r.qZA(),r.TgZ(23,"p"),r._uU(24,"App or System Bugs and feature suggestions: "),r.TgZ(25,"a",5),r._uU(26,"GitHub"),r.qZA(),r.qZA(),r.TgZ(27,"p"),r._uU(28,"App development by Webprofusion Pty Ltd ("),r.TgZ(29,"a",6),r._uU(30,"https://webprofusion.com"),r.qZA(),r._uU(31,")"),r.qZA(),r.TgZ(32,"h3"),r._uU(33,"Funding"),r.qZA(),r.TgZ(34,"p"),r._uU(35,"Our software is developed and hosted by volunteers, our data is crowdsourced by you. To help further development please encourage your organisation to sponsor us: "),r.TgZ(36,"a",7),r._uU(37,"Open Collective"),r.qZA(),r.qZA(),r.TgZ(38,"ion-note"),r.TgZ(39,"p"),r._uU(40),r.qZA(),r.TgZ(41,"p"),r._uU(42),r.qZA(),r.qZA(),r.qZA(),r.TgZ(43,"ion-footer"),r.TgZ(44,"ion-toolbar"),r.TgZ(45,"ion-buttons",8),r.TgZ(46,"ion-button",9),r.NdJ("click",function(){return e.close()}),r._UZ(47,"ion-icon",10),r._uU(48," Close "),r.qZA(),r.qZA(),r.qZA(),r.qZA()),2&t&&(r.xp6(3),r.Oqu(r.lcZ(4,3,"ocm.general.about")),r.xp6(37),r.hij("App Version: ",e.appVersion,""),r.xp6(2),r.hij("API: ",e.apiUrl,""))},directives:[o.Gu,o.sr,o.wd,o.W2,o.jY,o.Nd,o.wI,o.uN,o.fr,o.Sm,o.YG,o.gu],pipes:[s.X$],styles:[""]}),t})()},5476:function(t,e,n){"use strict";n.r(e),n.d(e,{JourneysModule:function(){return h}});var i=n(9741),r=n(8936),o=n(4516),s=n(8583),a=n(3679),l=n(2517),c=n(8093),u=n(639);let h=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[s.ez,a.u5,l.Pc,o.aw,r.e,c.Bz.forChild([{path:"",component:i.g}])]]}),t})()},9741:function(t,e,n){"use strict";n.d(e,{g:function(){return w}});var i=n(3912),r=n(7814),o=n(8118),s=n(4120),a=n(1820),l=n(639),c=n(2517),u=n(8583);function h(t,e){1&t&&(l.TgZ(0,"p"),l._uU(1," You have no journeys yet. Start by browsing to a charging location, then add it as Favourite to start a new Journey. "),l.qZA())}function d(t,e){if(1&t&&(l.TgZ(0,"p"),l._uU(1),l.qZA()),2&t){const t=l.oxw(2).$implicit;l.xp6(1),l.hij(" ",t.Poi.AddressInfo.AddressLine1,"")}}function p(t,e){if(1&t&&(l.TgZ(0,"p"),l._uU(1),l.qZA()),2&t){const t=l.oxw(2).$implicit;l.xp6(1),l.hij(" ",t.Poi.AddressInfo.AddressLine2,"")}}function f(t,e){if(1&t&&(l.TgZ(0,"p"),l._uU(1),l.qZA()),2&t){const t=l.oxw(2).$implicit;l.xp6(1),l.hij(" ",t.Poi.AddressInfo.Town,"")}}function m(t,e){if(1&t&&(l.TgZ(0,"p"),l._uU(1),l.qZA()),2&t){const t=l.oxw(2).$implicit;l.xp6(1),l.hij(" ",t.Poi.AddressInfo.StateOrProvince,"")}}function g(t,e){if(1&t&&(l.TgZ(0,"p"),l._uU(1),l.qZA()),2&t){const t=l.oxw(2).$implicit;l.xp6(1),l.hij(" ",t.Poi.AddressInfo.Postcode,"")}}function y(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div"),l.TgZ(1,"div",18),l.NdJ("click",function(){l.CHM(t);const e=l.oxw().$implicit;return l.oxw(4).viewPOIDetails(e.Poi)}),l.YNc(2,d,2,1,"p",4),l.YNc(3,p,2,1,"p",4),l.YNc(4,f,2,1,"p",4),l.YNc(5,m,2,1,"p",4),l.YNc(6,g,2,1,"p",4),l.qZA(),l.TgZ(7,"ion-button",19),l.NdJ("click",function(){l.CHM(t);const e=l.oxw().$implicit;return l.oxw(4).launchNavigation(e.Poi)}),l._UZ(8,"ion-icon",20),l._uU(9," Navigate "),l.qZA(),l.qZA()}if(2&t){const t=l.oxw().$implicit;l.xp6(2),l.Q6J("ngIf",t.Poi.AddressInfo.AddressLine1),l.xp6(1),l.Q6J("ngIf",t.Poi.AddressInfo.AddressLine2),l.xp6(1),l.Q6J("ngIf",t.Poi.AddressInfo.Town),l.xp6(1),l.Q6J("ngIf",t.Poi.AddressInfo.StateOrProvince),l.xp6(1),l.Q6J("ngIf",t.Poi.AddressInfo.Postcode)}}function _(t,e){if(1&t&&(l.TgZ(0,"div",17),l.YNc(1,y,10,5,"div",4),l.qZA()),2&t){const t=e.$implicit;l.xp6(1),l.Q6J("ngIf",t.Poi)}}function v(t,e){if(1&t&&(l.TgZ(0,"ion-item"),l.TgZ(1,"h2"),l._uU(2),l.qZA(),l.TgZ(3,"ion-thumbnail",0),l._UZ(4,"ion-icon",15),l.qZA(),l.TgZ(5,"p"),l._uU(6),l.qZA(),l.YNc(7,_,2,1,"div",16),l.qZA()),2&t){const t=e.$implicit;l.xp6(2),l.Oqu(t.Title),l.xp6(4),l.Oqu(t.Notes),l.xp6(1),l.Q6J("ngForOf",t.PoiList)}}function x(t,e){if(1&t&&(l.TgZ(0,"ion-list"),l.TgZ(1,"ion-list-header",11),l._uU(2),l._UZ(3,"ion-icon",12),l._uU(4," -- "),l._UZ(5,"ion-icon",13),l._uU(6," -- "),l._UZ(7,"ion-icon",14),l._uU(8," -- "),l.qZA(),l.YNc(9,v,8,3,"ion-item",5),l.qZA()),2&t){const t=e.$implicit;l.xp6(2),l.hij(" ",t.Title," "),l.xp6(7),l.Q6J("ngForOf",t.WayPoints)}}function b(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"ion-card"),l.TgZ(1,"ion-card-content"),l.TgZ(2,"ion-toolbar",8),l.TgZ(3,"ion-title"),l._uU(4),l.qZA(),l.TgZ(5,"ion-buttons",9),l.TgZ(6,"ion-button",1),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw().deleteJourney(e.ID)}),l._UZ(7,"ion-icon",10),l.qZA(),l.qZA(),l.qZA(),l.TgZ(8,"p"),l._uU(9),l.qZA(),l.YNc(10,x,10,2,"ion-list",5),l.qZA(),l.qZA()}if(2&t){const t=e.$implicit;l.xp6(4),l.hij(" ",t.Title,""),l.xp6(5),l.Oqu(t.Notes),l.xp6(1),l.Q6J("ngForOf",t.Stages)}}let w=(()=>{class t{constructor(t,e,n,i,r){this.appManager=t,this.journeyManager=e,this.api=n,this.modalController=i,this.alertController=r}dismiss(){this.modalController.dismiss()}discoverImages(){this.journeyManager.journeys.forEach(t=>{t.Stages.forEach(t=>{t.WayPoints.forEach(t=>{null!=t.PoiList&&t.PoiList.forEach(t=>{t.Poi&&this.api.getPanoramioLocationPhotos(new s.wC(t.Poi.AddressInfo.Latitude,t.Poi.AddressInfo.Longitude)).then(e=>{t.Photos=e})})})})})}getJson(t){return JSON.stringify(t,null,4)}viewPOIDetails(t){this.modalController.create({component:a.H,componentProps:{item:t}}).then(t=>t.present())}get staticMapSize(){return"60x60"}getStaticMapURL(t){return"https://maps.googleapis.com/maps/api/staticmap?center="+t.AddressInfo.Latitude+","+t.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+t.AddressInfo.Latitude+","+t.AddressInfo.Longitude}deleteJourney(t){this.alertController.create({header:"Delete this Journey?",message:"Are you sure you want to delete this Journey?",buttons:[{text:"No",handler:()=>{}},{text:"Delete",handler:()=>{this.journeyManager.deleteJourney(t)}}]}).then(t=>t.present())}launchNavigation(t){let e="https://maps.google.com/?q="+t.AddressInfo.Latitude+","+t.AddressInfo.Longitude;this.appManager.platform.is("ios")&&(e="https://maps.apple.com?q="+t.AddressInfo.Latitude+","+t.AddressInfo.Longitude),window.open(e,"_system")}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(o.c),l.Y36(i.i),l.Y36(r.l),l.Y36(c.IN),l.Y36(c.Br))},t.\u0275cmp=l.Xpm({type:t,selectors:[["ng-component"]],decls:18,vars:2,consts:[["slot","start"],[3,"click"],[1,"journeys-page"],[1,"ion-padding"],[4,"ngIf"],[4,"ngFor","ngForOf"],["slot","end"],["name","close","slot","start"],["primary",""],["slot","primary"],["name","close","slot","icon-only"],[2,"font-size","1.5rem"],["name","car"],["name","time"],["name","flash"],["name","caret-down",2,"font-size","4rem"],["style","text-align:right;width:100%;",4,"ngFor","ngForOf"],[2,"text-align","right","width","100%"],["tappable","",3,"click"],["clear","","item-right","",3,"click"],["name","navigate","slot","start"]],template:function(t,e){1&t&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-buttons",0),l.TgZ(3,"ion-back-button",1),l.NdJ("click",function(){return e.dismiss()}),l.qZA(),l.qZA(),l.TgZ(4,"ion-title"),l._uU(5," Journeys "),l.qZA(),l.qZA(),l.qZA(),l.TgZ(6,"ion-content",2),l.TgZ(7,"div",3),l.TgZ(8,"p"),l._uU(9," You can create and plan journeys to group your favourite charging routes together. "),l.qZA(),l.YNc(10,h,2,0,"p",4),l.qZA(),l.YNc(11,b,11,3,"ion-card",5),l.qZA(),l.TgZ(12,"ion-footer"),l.TgZ(13,"ion-toolbar"),l.TgZ(14,"ion-buttons",6),l.TgZ(15,"ion-button",1),l.NdJ("click",function(){return e.dismiss()}),l._UZ(16,"ion-icon",7),l._uU(17," Close "),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&t&&(l.xp6(10),l.Q6J("ngIf",null==e.journeyManager.journeys||0==e.journeyManager.journeys.length),l.xp6(1),l.Q6J("ngForOf",e.journeyManager.journeys))},directives:[c.Gu,c.sr,c.Sm,c.oU,c.cs,c.wd,c.W2,u.O5,u.sg,c.fr,c.YG,c.gu,c.PM,c.FN,c.q_,c.yh,c.Ie,c.Bs],encapsulation:2}),t})()},3102:function(t,e,n){"use strict";n.r(e),n.d(e,{LayerEditorPageModule:function(){return d}});var i=n(8583),r=n(3679),o=n(2517),s=n(8093),a=n(6588),l=n(639);const c=[{path:"",component:a.A}];let u=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[s.Bz.forChild(c)],s.Bz]}),t})();var h=n(8936);let d=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[i.ez,r.u5,o.Pc,u,h.e]]}),t})()},6588:function(t,e,n){"use strict";n.d(e,{A:function(){return u}});var i=n(8239),r=n(6799),o=n(639),s=n(2517),a=n(8583),l=n(6585);function c(t,e){if(1&t&&(o.TgZ(0,"div"),o._uU(1),o._UZ(2,"app-poi-list",10),o.qZA()),2&t){const t=o.oxw();o.xp6(1),o.hij(" Items Parsed: ",t.fileData.length," "),o.xp6(1),o.Q6J("poiList",t.fileData)}}let u=(()=>{class t{constructor(t,e){this.modalController=t,this.refData=e}ngOnInit(){}previewFile(){var t=this;return(0,i.Z)(function*(){yield t.loadFile(!1)})()}cancel(){var t=this;return(0,i.Z)(function*(){yield t.modalController.dismiss(t.fileData)})()}loadFile(t=!0){var e=this;return(0,i.Z)(function*(){const n=new FileReader;n.onload=()=>{let i=JSON.parse(n.result);for(let t of i)t.ID="imp_"+t.ID;e.fileData=e.refData.hydrateCompactPOIList(i),t&&e.modalController.dismiss(e.fileData)},n.onerror=()=>{},n.readAsText(document.getElementById("file-upload").files[0])})()}add(){var t=this;return(0,i.Z)(function*(){t.modalController.dismiss(t.fileData)})()}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(s.IN),o.Y36(r.W))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-layer-editor"]],decls:27,vars:1,consts:[[1,"ion-padding"],[1,"upload"],["name","file","aria-label","file","slot","start"],["type","file","required","","id","file-upload",3,"change"],[4,"ngIf"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","checkmark-circle-outline","slot","end"],[3,"poiList"]],template:function(t,e){1&t&&(o.TgZ(0,"ion-header"),o.TgZ(1,"ion-toolbar"),o.TgZ(2,"ion-title"),o._uU(3," Edit Layer "),o.qZA(),o.qZA(),o.qZA(),o.TgZ(4,"ion-content",0),o.TgZ(5,"p"),o._uU(6,"POI layers are used to preview data from other Open Data sources. "),o.qZA(),o.TgZ(7,"p"),o._uU(8,"Select a POI layer JSON file: "),o.qZA(),o.TgZ(9,"div"),o.TgZ(10,"label",1),o.TgZ(11,"ion-button"),o._UZ(12,"ion-icon",2),o.TgZ(13,"ion-label"),o._uU(14,"Choose File.."),o.qZA(),o.qZA(),o.TgZ(15,"input",3),o.NdJ("change",function(){return e.previewFile()}),o.qZA(),o.qZA(),o.qZA(),o.YNc(16,c,3,2,"div",4),o.qZA(),o.TgZ(17,"ion-footer"),o.TgZ(18,"ion-toolbar"),o.TgZ(19,"ion-buttons",5),o.TgZ(20,"ion-button",6),o.NdJ("click",function(){return e.cancel()}),o._UZ(21,"ion-icon",7),o._uU(22," Cancel "),o.qZA(),o.qZA(),o.TgZ(23,"ion-buttons",8),o.TgZ(24,"ion-button",6),o.NdJ("click",function(){return e.add()}),o._uU(25," Add "),o._UZ(26,"ion-icon",9),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&t&&(o.xp6(16),o.Q6J("ngIf",e.fileData&&e.fileData.length>0))},directives:[s.Gu,s.sr,s.wd,s.W2,s.YG,s.gu,s.Q$,a.O5,s.fr,s.Sm,l.o],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]}),t})()},1820:function(t,e,n){"use strict";n.d(e,{H:function(){return Mt}});var i=n(8118),r=n(639),o=n(2517),s=n(8239),a=n(3912),l=n(1122),c=n(3679),u=n(8583);function h(t,e){if(1&t&&(r.TgZ(0,"ion-select-option",13),r._uU(1),r.qZA()),2&t){const t=e.$implicit;r.Q6J("value",t.ID),r.xp6(1),r.Oqu(t.Title)}}function d(t,e){if(1&t&&(r.TgZ(0,"ion-select-option",16),r._uU(1),r.qZA()),2&t){const t=e.$implicit;r.Q6J("value",e.index),r.xp6(1),r.Oqu(t.Title)}}function p(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"ion-item"),r.TgZ(1,"ion-label",2),r._uU(2,"Journey Stage"),r.qZA(),r.TgZ(3,"ion-select",3),r.NdJ("ngModelChange",function(e){return r.CHM(t),r.oxw().selectedStageIndex=e}),r.TgZ(4,"ion-select-option",14),r._uU(5,"Create a Journey Stage"),r.qZA(),r.YNc(6,d,2,2,"ion-select-option",15),r.qZA(),r.qZA()}if(2&t){const t=r.oxw();r.xp6(3),r.Q6J("ngModel",t.selectedStageIndex),r.xp6(3),r.Q6J("ngForOf",t.journeyManager.getJourneyStages(t.selectedJourneyID))}}function f(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"ion-item"),r.TgZ(1,"ion-label",2),r._uU(2,"New Journey Name"),r.qZA(),r.TgZ(3,"ion-input",7),r.NdJ("ngModelChange",function(e){return r.CHM(t),r.oxw().newJourneyName=e}),r.qZA(),r.qZA()}if(2&t){const t=r.oxw();r.xp6(3),r.Q6J("ngModel",t.newJourneyName)}}let m=(()=>{class t{constructor(t,e,n,i){this.appManager=t,this.navParams=e,this.journeyManager=n,this.modalController=i,this.poi=this.navParams.get("poi"),this.waypoint=new l.kA,this.waypoint.Title=this.poi.AddressInfo.Title,this.waypoint.PoiIDs=[this.poi.ID],this.waypoint.PoiList=[];const r=new l.Qp("charging",1);r.Poi=this.poi,r.PoiID=this.poi.ID,this.waypoint.PoiList.push(r),this.newJourneyName="Trip to "+this.poi.AddressInfo.Title}cancel(){this.modalController.dismiss()}add(){if(null!=this.selectedJourneyID&&""!==this.selectedJourneyID)this.journeyManager.addJourneyWaypoint(this.selectedJourneyID,this.selectedStageIndex,this.waypoint);else{const t=new l.fw;t.ID=Date.now().toString(),""===this.newJourneyName&&(this.newJourneyName="New Journey"),t.Title=this.newJourneyName,this.journeyManager.addJourney(t,this.waypoint)}this.journeyManager.saveJourneys(),this.modalController.dismiss()}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(i.c),r.Y36(o.X1),r.Y36(a.i),r.Y36(o.IN))},t.\u0275cmp=r.Xpm({type:t,selectors:[["ng-component"]],decls:39,vars:8,consts:[[1,"journeys-page","ion-padding"],[1,"banner"],["position","stacked"],[3,"ngModel","ngModelChange"],["value","","checked",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","text",3,"ngModel","ngModelChange"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","add","slot","end"],[3,"value"],["value",""],["checked","",3,"value",4,"ngFor","ngForOf"],["checked","",3,"value"]],template:function(t,e){1&t&&(r.TgZ(0,"ion-header"),r.TgZ(1,"ion-toolbar"),r.TgZ(2,"ion-title"),r._uU(3," Edit Favourite "),r.qZA(),r.qZA(),r.qZA(),r.TgZ(4,"ion-content",0),r.TgZ(5,"div",1),r.TgZ(6,"h1"),r._uU(7),r.qZA(),r.TgZ(8,"p"),r._uU(9),r.qZA(),r.qZA(),r.TgZ(10,"p"),r._uU(11," Add Charging Location as a Journey Waypoint "),r.qZA(),r.TgZ(12,"ion-item"),r.TgZ(13,"ion-label",2),r._uU(14,"Add to a Journey"),r.qZA(),r.TgZ(15,"ion-select",3),r.NdJ("ngModelChange",function(t){return e.selectedJourneyID=t}),r.TgZ(16,"ion-select-option",4),r._uU(17,"Create a New Journey"),r.qZA(),r.YNc(18,h,2,2,"ion-select-option",5),r.qZA(),r.qZA(),r.YNc(19,p,7,2,"ion-item",6),r.YNc(20,f,4,1,"ion-item",6),r.TgZ(21,"ion-item"),r.TgZ(22,"ion-label",2),r._uU(23,"Name for this step of your journey"),r.qZA(),r.TgZ(24,"ion-input",7),r.NdJ("ngModelChange",function(t){return e.waypoint.Title=t}),r.qZA(),r.qZA(),r.TgZ(25,"ion-item"),r.TgZ(26,"ion-label",2),r._uU(27,"Other Notes"),r.qZA(),r.TgZ(28,"ion-textarea",3),r.NdJ("ngModelChange",function(t){return e.waypoint.Notes=t}),r.qZA(),r.qZA(),r.qZA(),r.TgZ(29,"ion-footer"),r.TgZ(30,"ion-toolbar"),r.TgZ(31,"ion-buttons",8),r.TgZ(32,"ion-button",9),r.NdJ("click",function(){return e.cancel()}),r._UZ(33,"ion-icon",10),r._uU(34," Cancel "),r.qZA(),r.qZA(),r.TgZ(35,"ion-buttons",11),r.TgZ(36,"ion-button",9),r.NdJ("click",function(){return e.add()}),r._uU(37," Add "),r._UZ(38,"ion-icon",12),r.qZA(),r.qZA(),r.qZA(),r.qZA()),2&t&&(r.xp6(7),r.Oqu(e.poi.AddressInfo.Title),r.xp6(2),r.Oqu(e.poi.AddressInfo.AddressLine1),r.xp6(6),r.Q6J("ngModel",e.selectedJourneyID),r.xp6(3),r.Q6J("ngForOf",e.journeyManager.journeys),r.xp6(1),r.Q6J("ngIf",e.selectedJourneyID),r.xp6(1),r.Q6J("ngIf",!e.selectedJourneyID),r.xp6(4),r.Q6J("ngModel",e.waypoint.Title),r.xp6(4),r.Q6J("ngModel",e.waypoint.Notes))},directives:[o.Gu,o.sr,o.wd,o.W2,o.Ie,o.Q$,o.t9,o.QI,c.JJ,c.On,o.n0,u.sg,u.O5,o.pK,o.j9,o.g2,o.fr,o.Sm,o.YG,o.gu],encapsulation:2}),t})();var g=n(7689);function y(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"ion-card"),r.TgZ(1,"ion-toolbar"),r.TgZ(2,"ion-title",14),r._uU(3,"Preview"),r.qZA(),r.TgZ(4,"ion-buttons",15),r.TgZ(5,"ion-button",4),r.NdJ("click",function(){return r.CHM(t),r.oxw().rotateImage()}),r._UZ(6,"ion-icon",16),r.TgZ(7,"ion-label"),r._uU(8,"Rotate"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(9,"ion-card-content"),r.TgZ(10,"ion-list"),r.TgZ(11,"ion-item"),r.TgZ(12,"ion-label",17),r._uU(13,"Comment"),r.qZA(),r.TgZ(14,"ion-input",18),r.NdJ("ngModelChange",function(e){return r.CHM(t),r.oxw().comment=e}),r.qZA(),r.qZA(),r.qZA(),r._UZ(15,"img",19),r.qZA(),r.qZA()}if(2&t){const t=r.oxw();r.xp6(14),r.Q6J("ngModel",t.comment)}}let _=(()=>{class t{constructor(t,e,n,i,r){this.navParams=t,this.appManager=e,this.nav=n,this.modalController=i,this.logging=r,this.processingQuality=.8,this.targetWidth=1024,this.targetHeight=800,this.mode=e.platformMode,this.chargePointId=this.navParams.get("id"),this.poi=this.navParams.get("poi"),this.comment=""}processNativeImageSource(t){let e=t;const n=document.getElementById("img-upload-canvas"),i=n.getContext("2d"),r=new Image;r.onload=()=>{this.logging.log("img load:"+r.width),n.width=r.width,n.height=r.height,i.fillStyle="rgb(0,0,0)",i.fillRect(0,0,n.width,n.height),i.drawImage(r,0,0,n.width,n.height),this.imgData=n.toDataURL("image/png"),this.processImage()},r.src=e}loadCameraOrLibraryImage(t=!1){this.logging.log("PWA mode: fetching image");const e=new FileReader;e.onload=()=>{this.imgData=e.result,this.processImage()},e.onerror=()=>{},e.readAsDataURL(document.getElementById("img-upload-media").files[0])}isBrowserMode(){return this.appManager.isPlatform("desktop")||this.appManager.isPlatform("hybrid")}processImage(){if(null!=this.imgData){const t=document.getElementById("img-upload-canvas"),e=t.getContext("2d"),n=new Image;n.onload=()=>{t.width=n.width,t.height=n.height,e.fillStyle="rgb(0,0,0)",e.fillRect(0,0,t.width,t.height),e.drawImage(n,0,0,t.width,t.height),this.refreshImageFromCanvas()},n.src=this.imgData}else this.logging.log("processImage: nothing to process.")}refreshImageFromCanvas(){const t=document.getElementById("img-upload-canvas");this.imgData=t.toDataURL("image/jpeg",.8),document.getElementById("preview").src=this.imgData}rotateImage(){const t=document.getElementById("img-upload-canvas");let e=new Image;e.src=t.toDataURL(),e.onload=()=>{let n=t.height,i=t.width;t.width=n,t.height=i,n=t.height,i=t.width;const r=t.getContext("2d");r.save(),r.translate(i,n/i),r.rotate(Math.PI/2),r.drawImage(e,0,0),r.restore(),e=null,this.refreshImageFromCanvas()}}performUpload(){var t=this;return(0,s.Z)(function*(){if(!t.imgData)return void(yield t.appManager.showToastNotification("Select an image to upload."));const e={chargePointID:t.chargePointId,comment:t.comment,imageDataBase64:t.imgData};yield t.appManager.showLoadingProgress("Uploading photo..");try{yield t.appManager.submitMediaItem(e),t.appManager.dismissLoadingProgress().then(()=>{t.appManager.showToastNotification("Upload completed"),t.modalController.dismiss()}),t.appManager.analytics.appEvent("MediaUpload","Completed")}catch(n){yield t.appManager.dismissLoadingProgress(),yield t.appManager.showToastNotification("Upload failed, please try again."),t.appManager.analytics.appEvent("MediaUpload","Failed")}})()}cancel(){var t=this;return(0,s.Z)(function*(){yield t.modalController.dismiss()})()}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(o.X1),r.Y36(i.c),r.Y36(o.SH),r.Y36(o.IN),r.Y36(g.z))},t.\u0275cmp=r.Xpm({type:t,selectors:[["ng-component"]],decls:32,vars:3,consts:[[1,"media-upload"],[1,"ion-padding"],[1,"banner"],[1,"upload"],[3,"click"],["name","camera","aria-label","camera","slot","start"],["type","file","required","","id","img-upload-media",3,"change"],["inputFile",""],["id","img-upload-canvas",2,"display","none","width","500","height","500","border","1px solid red"],[4,"ngIf"],["slot","secondary"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],["slot","start"],["slot","end"],["name","refresh","slot","start"],["position","floating"],["type","text","placeholder","(optional comment)",3,"ngModel","ngModelChange"],["id","preview",2,"max-width","500px"]],template:function(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"ion-header"),r.TgZ(1,"ion-toolbar"),r.TgZ(2,"ion-title"),r._uU(3," Share Photo "),r.qZA(),r.qZA(),r.qZA(),r.TgZ(4,"ion-content",0),r.TgZ(5,"div",1),r.TgZ(6,"div",2),r.TgZ(7,"h1"),r._uU(8),r.qZA(),r.TgZ(9,"p"),r._uU(10),r.qZA(),r.qZA(),r.TgZ(11,"p"),r._uU(12,"You can upload a photo from your device or take a new photo: "),r.qZA(),r.TgZ(13,"div",3),r.TgZ(14,"ion-button",4),r.NdJ("click",function(){return r.CHM(t),r.MAs(19).click()}),r._UZ(15,"ion-icon",5),r.TgZ(16,"ion-label"),r._uU(17,"Choose Photo.."),r.qZA(),r.qZA(),r.TgZ(18,"input",6,7),r.NdJ("change",function(){return e.loadCameraOrLibraryImage()}),r.qZA(),r.qZA(),r._UZ(20,"canvas",8),r.YNc(21,y,16,1,"ion-card",9),r.qZA(),r.qZA(),r.TgZ(22,"ion-footer"),r.TgZ(23,"ion-toolbar"),r.TgZ(24,"ion-buttons",10),r.TgZ(25,"ion-button",4),r.NdJ("click",function(){return e.cancel()}),r._UZ(26,"ion-icon",11),r._uU(27," Cancel "),r.qZA(),r.qZA(),r.TgZ(28,"ion-buttons",12),r.TgZ(29,"ion-button",4),r.NdJ("click",function(){return e.performUpload()}),r._uU(30," Upload "),r._UZ(31,"ion-icon",13),r.qZA(),r.qZA(),r.qZA(),r.qZA()}2&t&&(r.xp6(8),r.Oqu(e.poi.AddressInfo.Title),r.xp6(2),r.Oqu(e.poi.AddressInfo.AddressLine1),r.xp6(11),r.Q6J("ngIf",null!=e.imgData))},directives:[o.Gu,o.sr,o.wd,o.W2,o.YG,o.gu,o.Q$,u.O5,o.fr,o.Sm,o.PM,o.FN,o.q_,o.Ie,o.pK,o.j9,c.JJ,c.On],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]}),t})();var v=n(8093);function x(t,e){if(1&t&&(r.TgZ(0,"ion-select-option",19),r._uU(1),r.qZA()),2&t){const t=e.$implicit;r.Q6J("value",t.ID),r.xp6(1),r.Oqu(t.Title)}}function b(t,e){if(1&t&&(r.TgZ(0,"ion-select-option",19),r._uU(1),r.qZA()),2&t){const t=e.$implicit;r.Q6J("value",t.ID),r.xp6(1),r.Oqu(t.Title)}}let w=(()=>{class t{constructor(t,e,n,i,r,o,s,a){this.navParams=t,this.appManager=e,this.nav=n,this.zone=i,this.loadingController=r,this.modalController=o,this.logging=s,this.router=a,this.commentModel={ChargePointID:this.navParams.get("id"),Comment:"",CheckinStatusTypeID:10,CommentTypeID:10,Rating:null},this.poi=this.navParams.get("poi"),this.commentTypes=e.referenceDataManager.getCommentTypes(!0,!0),this.checkinTypes=e.referenceDataManager.getCheckinStatusTypes(!0,!0)}onPageWillEnter(){}cancel(){this.modalController.dismiss()}add(){var t=this;return(0,s.Z)(function*(){const e=yield t.loadingController.create({message:"Sending .."});yield e.present(),(yield t.appManager.submitComment(t.commentModel).catch(e=>{t.appManager.showToastNotification("There was a problem submitting your comment."),t.loadingController.dismiss(),t.appManager.analytics.appEvent("Comment","Failed")}))&&(t.logging.log("Comment submitted"),yield e.dismiss(),yield t.modalController.dismiss(),t.appManager.analytics.appEvent("Comment","Submitted"))})()}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(o.X1),r.Y36(i.c),r.Y36(o.SH),r.Y36(r.R0b),r.Y36(o.HT),r.Y36(o.IN),r.Y36(g.z),r.Y36(v.F0))},t.\u0275cmp=r.Xpm({type:t,selectors:[["ng-component"]],decls:53,vars:8,consts:[["color","primary"],[1,"comment-page","ion-padding"],[1,"banner"],[1,"ion-padding"],["position","stacked"],[3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","(optional comment)",3,"ngModel","ngModelChange"],["value","5"],["value","4"],["value","3"],["value","2"],["value","1"],["value",""],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],[3,"value"]],template:function(t,e){1&t&&(r.TgZ(0,"ion-header"),r.TgZ(1,"ion-toolbar",0),r.TgZ(2,"ion-title"),r._uU(3," Add Comment "),r.qZA(),r.qZA(),r.qZA(),r.TgZ(4,"ion-content",1),r.TgZ(5,"div",2),r.TgZ(6,"h1"),r._uU(7),r.qZA(),r.TgZ(8,"p"),r._uU(9),r.qZA(),r.qZA(),r.TgZ(10,"p",3),r._uU(11,"Recent Check-ins are a big help to other drivers when planning their journey. Tell everyone what you thought about this charging location. "),r.qZA(),r.TgZ(12,"ion-list"),r.TgZ(13,"ion-item"),r.TgZ(14,"ion-label",4),r._uU(15,"Comment Type"),r.qZA(),r.TgZ(16,"ion-select",5),r.NdJ("ngModelChange",function(t){return e.commentModel.CommentTypeID=t}),r.YNc(17,x,2,2,"ion-select-option",6),r.qZA(),r.qZA(),r.TgZ(18,"ion-item"),r.TgZ(19,"ion-label",4),r._uU(20,"What Did You Think?"),r.qZA(),r.TgZ(21,"ion-input",7),r.NdJ("ngModelChange",function(t){return e.commentModel.Comment=t}),r.qZA(),r.qZA(),r.TgZ(22,"ion-item"),r.TgZ(23,"ion-label",4),r._uU(24,"Did You Successfully Charge?"),r.qZA(),r.TgZ(25,"ion-select",5),r.NdJ("ngModelChange",function(t){return e.commentModel.CheckinStatusTypeID=t}),r.YNc(26,b,2,2,"ion-select-option",6),r.qZA(),r.qZA(),r.TgZ(27,"ion-item"),r.TgZ(28,"ion-label",4),r._uU(29,"Your Rating"),r.qZA(),r.TgZ(30,"ion-select",5),r.NdJ("ngModelChange",function(t){return e.commentModel.Rating=t}),r.TgZ(31,"ion-select-option",8),r._uU(32,"5 - Excellent"),r.qZA(),r.TgZ(33,"ion-select-option",9),r._uU(34,"4 - Good"),r.qZA(),r.TgZ(35,"ion-select-option",10),r._uU(36,"3 - Average"),r.qZA(),r.TgZ(37,"ion-select-option",11),r._uU(38,"2 - Not Good"),r.qZA(),r.TgZ(39,"ion-select-option",12),r._uU(40,"1 - Bad"),r.qZA(),r.TgZ(41,"ion-select-option",13),r._uU(42,"Not Rated"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(43,"ion-footer"),r.TgZ(44,"ion-toolbar"),r.TgZ(45,"ion-buttons",14),r.TgZ(46,"ion-button",15),r.NdJ("click",function(){return e.cancel()}),r._UZ(47,"ion-icon",16),r._uU(48," Cancel "),r.qZA(),r.qZA(),r.TgZ(49,"ion-buttons",17),r.TgZ(50,"ion-button",15),r.NdJ("click",function(){return e.add()}),r._uU(51," Submit "),r._UZ(52,"ion-icon",18),r.qZA(),r.qZA(),r.qZA(),r.qZA()),2&t&&(r.xp6(7),r.Oqu(e.poi.AddressInfo.Title),r.xp6(2),r.Oqu(e.poi.AddressInfo.AddressLine1),r.xp6(7),r.Q6J("ngModel",e.commentModel.CommentTypeID),r.xp6(1),r.Q6J("ngForOf",e.commentTypes),r.xp6(4),r.Q6J("ngModel",e.commentModel.Comment),r.xp6(4),r.Q6J("ngModel",e.commentModel.CheckinStatusTypeID),r.xp6(1),r.Q6J("ngForOf",e.checkinTypes),r.xp6(4),r.Q6J("ngModel",e.commentModel.Rating))},directives:[o.Gu,o.sr,o.wd,o.W2,o.q_,o.Ie,o.Q$,o.t9,o.QI,c.JJ,c.On,u.sg,o.pK,o.j9,o.n0,o.fr,o.Sm,o.YG,o.gu],encapsulation:2}),t})();var T=n(2951),A=n(9698),S=n(9492),C=n(7877),I=n(6579),E=n(4516),M=n(1099);function k(t,e){if(1&t&&(r.TgZ(0,"div"),r.TgZ(1,"small"),r._uU(2),r.qZA(),r.qZA()),2&t){const t=r.oxw(2);r.xp6(2),r.Oqu(t.connectionSummary)}}function P(t,e){if(1&t&&(r.TgZ(0,"div"),r.TgZ(1,"small"),r._uU(2),r.qZA(),r.qZA()),2&t){const t=r.oxw(2);r.xp6(2),r.Oqu(t.poi.OperatorInfo.Title)}}function D(t,e){if(1&t){const t=r.EpF();r.ynx(0),r.TgZ(1,"ion-button",28),r.NdJ("click",function(){return r.CHM(t),r.oxw(2).addFavourite()}),r._UZ(2,"ion-icon",29),r.TgZ(3,"ion-label"),r._uU(4,"Favourite"),r.qZA(),r.qZA(),r.TgZ(5,"ion-button",13),r.NdJ("click",function(){return r.CHM(t),r.oxw(2).edit()}),r._UZ(6,"ion-icon",30),r.TgZ(7,"ion-label"),r._uU(8,"Edit"),r.qZA(),r.qZA(),r.BQk()}}function L(t,e){if(1&t){const t=r.EpF();r.ynx(0),r.TgZ(1,"ion-button",31),r.NdJ("click",function(){return r.CHM(t),r.oxw(2).launchNavigation()}),r._UZ(2,"ion-icon",32),r.TgZ(3,"ion-label"),r._uU(4,"Navigate"),r.qZA(),r.qZA(),r.BQk()}}function O(t,e){if(1&t){const t=r.EpF();r.ynx(0),r.TgZ(1,"ion-button",33),r.NdJ("click",function(){return r.CHM(t),r.oxw(2).addComment()}),r._UZ(2,"ion-icon",34),r.TgZ(3,"ion-label"),r._uU(4,"Add Comment"),r.qZA(),r.qZA(),r.BQk()}}function R(t,e){if(1&t){const t=r.EpF();r.ynx(0),r.TgZ(1,"ion-button",35),r.NdJ("click",function(){return r.CHM(t),r.oxw(2).addMedia()}),r._UZ(2,"ion-icon",36),r.TgZ(3,"ion-label"),r._uU(4," Add Photo"),r.qZA(),r.qZA(),r.BQk()}}function z(t,e){if(1&t&&(r.TgZ(0,"div"),r._uU(1),r.qZA()),2&t){const t=r.oxw(4);r.xp6(1),r.hij(" ",t.poi.AddressInfo.AddressLine1,"")}}function Z(t,e){if(1&t&&(r.TgZ(0,"div"),r._uU(1),r.qZA()),2&t){const t=r.oxw(4);r.xp6(1),r.hij(" ",t.poi.AddressInfo.AddressLine2,"")}}function F(t,e){if(1&t&&(r.TgZ(0,"div"),r._uU(1),r.qZA()),2&t){const t=r.oxw(4);r.xp6(1),r.hij(" ",t.poi.AddressInfo.Town,"")}}function U(t,e){if(1&t&&(r.TgZ(0,"div"),r._uU(1),r.qZA()),2&t){const t=r.oxw(4);r.xp6(1),r.hij(" ",t.poi.AddressInfo.StateOrProvince,"")}}function N(t,e){if(1&t&&(r.TgZ(0,"div"),r._uU(1),r.qZA()),2&t){const t=r.oxw(4);r.xp6(1),r.hij(" ",t.poi.AddressInfo.Postcode,"")}}function B(t,e){if(1&t&&(r.TgZ(0,"div"),r._uU(1),r.qZA()),2&t){const t=r.oxw(4);r.xp6(1),r.hij(" ",t.poi.AddressInfo.Country.Title,"")}}function q(t,e){if(1&t&&(r.TgZ(0,"p"),r._uU(1),r.qZA()),2&t){const t=r.oxw(4);r.xp6(1),r.hij(" ",t.poi.AddressInfo.AccessComments," ")}}function $(t,e){if(1&t&&(r.TgZ(0,"p"),r._UZ(1,"ion-icon",48),r.TgZ(2,"span",45),r._uU(3),r.qZA(),r.qZA()),2&t){const t=r.oxw(4);r.xp6(3),r.Oqu(t.poi.AddressInfo.ContactTelephone1)}}function V(t,e){if(1&t&&(r.TgZ(0,"p"),r._UZ(1,"ion-icon",48),r.TgZ(2,"span",45),r._uU(3),r.qZA(),r.qZA()),2&t){const t=r.oxw(4);r.xp6(3),r.Oqu(t.poi.AddressInfo.ContactTelephone2)}}function j(t,e){if(1&t&&(r.TgZ(0,"p"),r._UZ(1,"ion-icon",49),r.TgZ(2,"span",45),r._uU(3),r.qZA(),r.qZA()),2&t){const t=r.oxw(4);r.xp6(3),r.Oqu(t.poi.AddressInfo.ContactEmail)}}function G(t,e){if(1&t&&(r.TgZ(0,"p"),r._UZ(1,"ion-icon",50),r.TgZ(2,"span",45),r.TgZ(3,"a",51),r._uU(4),r.qZA(),r.qZA(),r.qZA()),2&t){const t=r.oxw(4);r.xp6(3),r.s9C("href",t.poi.AddressInfo.RelatedURL,r.LSH),r.xp6(1),r.Oqu(t.poi.AddressInfo.RelatedURL)}}function Y(t,e){if(1&t&&(r.TgZ(0,"ion-card"),r.TgZ(1,"ion-card-header"),r._UZ(2,"ion-icon",43),r._uU(3),r.ALo(4,"translate"),r.qZA(),r.TgZ(5,"ion-card-content"),r.TgZ(6,"ion-grid"),r.TgZ(7,"ion-row"),r.TgZ(8,"ion-col"),r.TgZ(9,"ion-label",44),r._uU(10),r.ALo(11,"translate"),r.qZA(),r.TgZ(12,"div",45),r.YNc(13,z,2,1,"div",0),r.YNc(14,Z,2,1,"div",0),r.YNc(15,F,2,1,"div",0),r.YNc(16,U,2,1,"div",0),r.YNc(17,N,2,1,"div",0),r.YNc(18,B,2,1,"div",0),r.qZA(),r.qZA(),r.TgZ(19,"ion-col"),r.YNc(20,q,2,1,"p",0),r.YNc(21,$,4,1,"p",0),r.YNc(22,V,4,1,"p",0),r.YNc(23,j,4,1,"p",0),r.YNc(24,G,5,2,"p",0),r.qZA(),r.qZA(),r.TgZ(25,"ion-row"),r.TgZ(26,"ion-col"),r._UZ(27,"ion-icon",46),r.TgZ(28,"ion-label",47),r._uU(29),r.ALo(30,"number"),r.ALo(31,"number"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA()),2&t){const t=r.oxw(3);r.xp6(3),r.hij(" ",r.lcZ(4,15,"ocm.details.location.sectionTitle")," "),r.xp6(7),r.hij(" ",r.lcZ(11,17,"ocm.details.location.address"),""),r.xp6(3),r.Q6J("ngIf",t.poi.AddressInfo.AddressLine1),r.xp6(1),r.Q6J("ngIf",t.poi.AddressInfo.AddressLine2),r.xp6(1),r.Q6J("ngIf",t.poi.AddressInfo.Town),r.xp6(1),r.Q6J("ngIf",t.poi.AddressInfo.StateOrProvince),r.xp6(1),r.Q6J("ngIf",t.poi.AddressInfo.Postcode),r.xp6(1),r.Q6J("ngIf",t.poi.AddressInfo.Country),r.xp6(2),r.Q6J("ngIf",t.poi.AddressInfo.AccessComments),r.xp6(1),r.Q6J("ngIf",t.poi.AddressInfo.ContactTelephone1),r.xp6(1),r.Q6J("ngIf",t.poi.AddressInfo.ContactTelephone2),r.xp6(1),r.Q6J("ngIf",t.poi.AddressInfo.ContactEmail),r.xp6(1),r.Q6J("ngIf",t.poi.AddressInfo.RelatedURL),r.xp6(5),r.AsE(" ",r.xi3(30,19,t.poi.AddressInfo.Latitude,"1.1-13")," , ",r.xi3(31,22,t.poi.AddressInfo.Longitude,"1.1-13")," ")}}function H(t,e){if(1&t&&(r.TgZ(0,"p"),r.TgZ(1,"span",44),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.TgZ(4,"span",45),r._uU(5),r.qZA(),r.qZA()),2&t){const t=r.oxw(3);r.xp6(2),r.hij("",r.lcZ(3,2,"ocm.details.numberOfPoints"),":"),r.xp6(3),r.Oqu(t.poi.NumberOfPoints)}}function J(t,e){if(1&t&&(r.TgZ(0,"p"),r.TgZ(1,"span",44),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.TgZ(4,"span",45),r._uU(5),r.qZA(),r.qZA()),2&t){const t=r.oxw(3);r.xp6(2),r.hij("",r.lcZ(3,2,"ocm.details.operationalStatus"),":"),r.xp6(3),r.hij(" ",t.poi.StatusType.Title," ")}}function W(t,e){if(1&t&&(r.TgZ(0,"p"),r.TgZ(1,"span",44),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.TgZ(4,"span",45),r._uU(5),r.qZA(),r.qZA()),2&t){const t=r.oxw(3);r.xp6(2),r.hij("",r.lcZ(3,2,"ocm.details.usageType"),":"),r.xp6(3),r.Oqu(t.poi.UsageType.Title)}}function X(t,e){if(1&t&&(r.TgZ(0,"p"),r.TgZ(1,"span",44),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.TgZ(4,"span",45),r._uU(5),r.qZA(),r.qZA()),2&t){const t=r.oxw(3);r.xp6(2),r.hij("",r.lcZ(3,2,"ocm.details.usageCost"),":"),r.xp6(3),r.hij(" ",t.poi.UsageCost,"")}}function Q(t,e){if(1&t&&(r.TgZ(0,"p"),r._UZ(1,"br"),r._uU(2),r.ALo(3,"translate"),r._UZ(4,"br"),r.TgZ(5,"span",45),r._uU(6),r.qZA(),r.qZA()),2&t){const t=r.oxw(3);r.xp6(2),r.hij("",r.lcZ(3,2,"ocm.details.generalComments"),": "),r.xp6(4),r.Oqu(t.poi.GeneralComments)}}function K(t,e){if(1&t&&(r.TgZ(0,"p"),r._UZ(1,"ion-icon",54),r._uU(2),r.qZA()),2&t){const t=r.oxw(4);r.xp6(2),r.hij(" ",t.poi.OperatorInfo.WebsiteURL," ")}}function tt(t,e){if(1&t&&(r.TgZ(0,"p"),r._UZ(1,"ion-icon",49),r._uU(2),r.qZA()),2&t){const t=r.oxw(4);r.xp6(2),r.hij(" ",t.poi.OperatorInfo.ContactEmail," ")}}function et(t,e){if(1&t&&(r.TgZ(0,"p"),r._UZ(1,"ion-icon",49),r._uU(2),r.qZA()),2&t){const t=r.oxw(4);r.xp6(2),r.hij(" ",t.poi.OperatorInfo.FaultReportEmail," ")}}function nt(t,e){if(1&t&&(r.TgZ(0,"ion-card"),r.TgZ(1,"ion-card-header"),r._UZ(2,"ion-icon",52),r._uU(3),r.ALo(4,"translate"),r.qZA(),r.TgZ(5,"ion-card-content"),r.TgZ(6,"div",45),r.TgZ(7,"p",53),r._uU(8),r.qZA(),r.YNc(9,K,3,1,"p",0),r.YNc(10,tt,3,1,"p",0),r.YNc(11,et,3,1,"p",0),r.qZA(),r.qZA(),r.qZA()),2&t){const t=r.oxw(3);r.xp6(3),r.hij(" ",r.lcZ(4,5,"ocm.details.operator.sectionTitle")," "),r.xp6(5),r.hij(" ",t.poi.OperatorInfo.Title," "),r.xp6(1),r.Q6J("ngIf",t.poi.OperatorInfo.WebsiteURL),r.xp6(1),r.Q6J("ngIf",null!=t.poi.OperatorInfo.ContactEmail),r.xp6(1),r.Q6J("ngIf",null!=t.poi.OperatorInfo.FaultReportEmail&&t.poi.OperatorInfo.FaultReportEmail!=t.poi.OperatorInfo.ContactEmail)}}function it(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"a",56),r.NdJ("click",function(){r.CHM(t);const e=r.oxw(4);return e.launchURL(e.poi.DataProvider.WebsiteURL)}),r._uU(1),r.qZA()}if(2&t){const t=r.oxw(4);r.xp6(1),r.Oqu(t.poi.DataProvider.WebsiteURL)}}function rt(t,e){if(1&t&&(r.TgZ(0,"div",45),r.TgZ(1,"h3"),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.TgZ(4,"p"),r._uU(5),r.qZA(),r.YNc(6,it,2,1,"a",55),r.TgZ(7,"p"),r._uU(8),r.qZA(),r.qZA()),2&t){const t=r.oxw(3);r.xp6(2),r.hij(" ",r.lcZ(3,4,"ocm.details.dataProvider.sectionTitle")," "),r.xp6(3),r.Oqu(null==t.poi.DataProvider?null:t.poi.DataProvider.Title),r.xp6(1),r.Q6J("ngIf",t.poi.DataProvider.WebsiteURL),r.xp6(2),r.Oqu(null==t.poi.DataProvider?null:t.poi.DataProvider.License)}}function ot(t,e){if(1&t&&(r.TgZ(0,"div",37),r.YNc(1,Y,32,25,"ion-card",0),r.TgZ(2,"ion-card"),r.TgZ(3,"ion-card-header"),r._UZ(4,"ion-icon",38),r._uU(5),r.ALo(6,"translate"),r.qZA(),r.TgZ(7,"ion-card-content"),r.YNc(8,H,6,4,"p",0),r._UZ(9,"app-equipment-details",39),r.qZA(),r.qZA(),r.TgZ(10,"ion-card"),r.TgZ(11,"ion-card-header"),r._UZ(12,"ion-icon",40),r._uU(13," Usage Restrictions "),r.qZA(),r.TgZ(14,"ion-card-content"),r.YNc(15,J,6,4,"p",0),r.YNc(16,W,6,4,"p",0),r.YNc(17,X,6,4,"p",0),r.YNc(18,Q,7,4,"p",0),r.qZA(),r.qZA(),r.YNc(19,nt,12,7,"ion-card",0),r.TgZ(20,"ion-card"),r.TgZ(21,"ion-card-header"),r._UZ(22,"ion-icon",41),r._uU(23),r.ALo(24,"translate"),r.qZA(),r.TgZ(25,"ion-card-content"),r.YNc(26,rt,9,6,"div",42),r.qZA(),r.qZA(),r.qZA()),2&t){const t=r.oxw(2);r.xp6(1),r.Q6J("ngIf",t.poi.AddressInfo),r.xp6(4),r.hij(" ",r.lcZ(6,11,"ocm.details.equipment.sectionTitle")," "),r.xp6(3),r.Q6J("ngIf",null!=t.poi.NumberOfPoints),r.xp6(1),r.Q6J("item",t.poi),r.xp6(6),r.Q6J("ngIf",null!=t.poi.StatusType),r.xp6(1),r.Q6J("ngIf",null!=t.poi.UsageType),r.xp6(1),r.Q6J("ngIf",null!=t.poi.UsageCost),r.xp6(1),r.Q6J("ngIf",null!=t.poi.GeneralComments),r.xp6(1),r.Q6J("ngIf",t.poi.OperatorInfo),r.xp6(4),r.hij(" ",r.lcZ(24,13,"ocm.details.advancedDetails")," "),r.xp6(3),r.Q6J("ngIf",t.poi.DataProvider)}}function st(t,e){if(1&t&&r._UZ(0,"img",60),2&t){const t=r.oxw().$implicit;r.s9C("src",null==t.User?null:t.User.ProfileImageURL,r.LSH)}}function at(t,e){if(1&t&&(r.TgZ(0,"span"),r._uU(1),r.qZA()),2&t){const t=r.oxw().$implicit;r.xp6(1),r.Oqu(t.User.Username)}}function lt(t,e){if(1&t&&(r.TgZ(0,"span"),r._uU(1),r.qZA()),2&t){const t=r.oxw().$implicit;r.xp6(1),r.Oqu(t.Username)}}function ct(t,e){if(1&t&&(r.TgZ(0,"p",45),r._uU(1),r.qZA()),2&t){const t=r.oxw().$implicit;r.xp6(1),r.hij(" ",null==t.CommentType?null:t.CommentType.Title," ")}}function ut(t,e){if(1&t&&(r.TgZ(0,"p"),r.TgZ(1,"span",44),r._uU(2,"Rating:"),r.qZA(),r.TgZ(3,"span",45),r._uU(4),r.qZA(),r.qZA()),2&t){const t=r.oxw().$implicit;r.xp6(4),r.hij("",t.Rating," out of 5")}}function ht(t,e){1&t&&(r.ynx(0),r._UZ(1,"ion-icon",61),r.BQk())}function dt(t,e){1&t&&(r.ynx(0),r._UZ(1,"ion-icon",62),r.BQk())}function pt(t,e){if(1&t&&(r.TgZ(0,"p"),r.YNc(1,ht,2,0,"ng-container",0),r.YNc(2,dt,2,0,"ng-container",0),r._uU(3),r.qZA()),2&t){const t=r.oxw().$implicit;r.xp6(1),r.Q6J("ngIf",!0===t.CheckinStatusType.IsPositive),r.xp6(1),r.Q6J("ngIf",!1===t.CheckinStatusType.IsPositive),r.xp6(1),r.hij(" ",t.CheckinStatusType.Title," ")}}function ft(t,e){if(1&t&&(r.TgZ(0,"ion-card"),r.TgZ(1,"ion-item"),r.TgZ(2,"ion-avatar",19),r.YNc(3,st,1,1,"img",59),r.qZA(),r.TgZ(4,"ion-label"),r.YNc(5,at,2,1,"span",0),r.YNc(6,lt,2,1,"span",0),r.qZA(),r.TgZ(7,"ion-label",20),r._uU(8),r.ALo(9,"date"),r.qZA(),r.qZA(),r.TgZ(10,"ion-card-content"),r.TgZ(11,"p"),r._uU(12),r.qZA(),r.YNc(13,ct,2,1,"p",42),r.YNc(14,ut,5,1,"p",0),r.YNc(15,pt,4,3,"p",0),r.qZA(),r.qZA()),2&t){const t=e.$implicit;r.xp6(3),r.Q6J("ngIf",t.User&&t.User.ProfileImageURL),r.xp6(2),r.Q6J("ngIf",t.User),r.xp6(1),r.Q6J("ngIf",!t.User),r.xp6(2),r.hij(" ",r.lcZ(9,8,t.DateCreated)," "),r.xp6(4),r.Oqu(t.Comment),r.xp6(1),r.Q6J("ngIf",10!=t.CommentTypeID),r.xp6(1),r.Q6J("ngIf",t.Rating),r.xp6(1),r.Q6J("ngIf",t.CheckinStatusType)}}function mt(t,e){if(1&t&&(r.ynx(0),r.YNc(1,ft,16,10,"ion-card",58),r.BQk()),2&t){const t=r.oxw(3);r.xp6(1),r.Q6J("ngForOf",t.poi.UserComments)}}function gt(t,e){1&t&&(r.TgZ(0,"p",21),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&t&&(r.xp6(1),r.hij(" ",r.lcZ(2,1,"ocm.details.commentsAndRatings.zeroComments")," "))}function yt(t,e){if(1&t&&(r.TgZ(0,"div"),r.YNc(1,mt,2,1,"ng-container",0),r.YNc(2,gt,3,3,"p",57),r.qZA()),2&t){const t=r.oxw(2);r.xp6(1),r.Q6J("ngIf",1==t.poi._hasComments),r.xp6(1),r.Q6J("ngIf",0==t.poi._hasComments)}}function _t(t,e){if(1&t&&r._UZ(0,"img",60),2&t){const t=r.oxw().$implicit;r.s9C("src",null==t.User?null:t.User.ProfileImageURL,r.LSH)}}function vt(t,e){if(1&t&&(r.TgZ(0,"span"),r._uU(1),r.qZA()),2&t){const t=r.oxw().$implicit;r.xp6(1),r.Oqu(t.User.Username)}}function xt(t,e){if(1&t&&(r.TgZ(0,"span"),r._uU(1),r.qZA()),2&t){const t=r.oxw().$implicit;r.xp6(1),r.Oqu(t.Username)}}function bt(t,e){if(1&t&&(r.TgZ(0,"ion-card"),r._UZ(1,"img",60),r.TgZ(2,"ion-item"),r.TgZ(3,"ion-avatar",19),r.YNc(4,_t,1,1,"img",59),r.qZA(),r.TgZ(5,"ion-label"),r.YNc(6,vt,2,1,"span",0),r.YNc(7,xt,2,1,"span",0),r.qZA(),r.TgZ(8,"ion-label",20),r._uU(9),r.ALo(10,"date"),r.qZA(),r.qZA(),r.TgZ(11,"ion-card-content"),r.TgZ(12,"p"),r._uU(13),r.qZA(),r.qZA(),r.qZA()),2&t){const t=e.$implicit;r.xp6(1),r.s9C("src",t.ItemMediumURL,r.LSH),r.xp6(3),r.Q6J("ngIf",t.User&&t.User.ProfileImageURL),r.xp6(2),r.Q6J("ngIf",t.User),r.xp6(1),r.Q6J("ngIf",!t.User),r.xp6(2),r.hij(" ",r.lcZ(10,6,t.DateCreated)," "),r.xp6(4),r.Oqu(t.Comment)}}function wt(t,e){if(1&t&&(r.TgZ(0,"div"),r.YNc(1,bt,14,8,"ion-card",58),r.qZA()),2&t){const t=r.oxw(3);r.xp6(1),r.Q6J("ngForOf",t.poi.MediaItems)}}function Tt(t,e){1&t&&(r.TgZ(0,"div",21),r.TgZ(1,"p",63),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.qZA()),2&t&&(r.xp6(2),r.hij(" ",r.lcZ(3,1,"ocm.details.mediaItems.addPrompt"),""))}function At(t,e){if(1&t&&(r.TgZ(0,"div"),r.YNc(1,wt,2,1,"div",0),r.YNc(2,Tt,4,3,"div",57),r.qZA()),2&t){const t=r.oxw(2);r.xp6(1),r.Q6J("ngIf",t.poi._hasPhotos),r.xp6(1),r.Q6J("ngIf",!t.poi._hasPhotos)}}function St(t,e){if(1&t&&(r.TgZ(0,"p",64),r._uU(1),r.qZA()),2&t){const t=r.oxw(2);r.xp6(1),r.hij(" ",t.json,"")}}function Ct(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"div"),r.TgZ(1,"div",1),r.TgZ(2,"div",2),r.TgZ(3,"h2"),r._uU(4),r.qZA(),r.TgZ(5,"div"),r.TgZ(6,"small"),r._uU(7),r.qZA(),r.qZA(),r.YNc(8,k,3,1,"div",0),r.YNc(9,P,3,1,"div",0),r.TgZ(10,"ion-badge",3),r._uU(11),r.ALo(12,"number"),r.qZA(),r.qZA(),r.TgZ(13,"ion-fab",4),r.TgZ(14,"ion-fab-button"),r._UZ(15,"ion-icon",5),r.qZA(),r.TgZ(16,"ion-fab-list",6),r.TgZ(17,"ion-fab-button",7),r.NdJ("click",function(){return r.CHM(t),r.oxw().addComment()}),r._UZ(18,"ion-icon",8),r.qZA(),r.TgZ(19,"ion-fab-button",9),r.NdJ("click",function(){return r.CHM(t),r.oxw().addMedia()}),r._UZ(20,"ion-icon",10),r.qZA(),r.TgZ(21,"ion-fab-button",11),r.NdJ("click",function(){return r.CHM(t),r.oxw().addFavourite()}),r._UZ(22,"ion-icon",12),r.qZA(),r.TgZ(23,"ion-fab-button",13),r.NdJ("click",function(){return r.CHM(t),r.oxw().edit()}),r._UZ(24,"ion-icon",14),r.qZA(),r.TgZ(25,"ion-fab-button",15),r.NdJ("click",function(){return r.CHM(t),r.oxw().refresh()}),r._UZ(26,"ion-icon",16),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(27,"ion-refresher",17),r.NdJ("ionRefresh",function(e){return r.CHM(t),r.oxw().refresh(e)}),r._UZ(28,"ion-refresher-content",18),r.qZA(),r.TgZ(29,"ion-toolbar"),r.TgZ(30,"ion-buttons",19),r.YNc(31,D,9,0,"ng-container",0),r.qZA(),r.TgZ(32,"ion-buttons",20),r.YNc(33,L,5,0,"ng-container",0),r.YNc(34,O,5,0,"ng-container",0),r.YNc(35,R,5,0,"ng-container",0),r.qZA(),r.qZA(),r.TgZ(36,"div",21),r.TgZ(37,"ion-segment",22),r.NdJ("ngModelChange",function(e){return r.CHM(t),r.oxw().selectedTab=e}),r.TgZ(38,"ion-segment-button",23),r.TgZ(39,"ion-label"),r._uU(40," Details "),r.qZA(),r.qZA(),r.TgZ(41,"ion-segment-button",24),r.TgZ(42,"ion-label"),r._uU(43),r.qZA(),r.qZA(),r.TgZ(44,"ion-segment-button",25),r.TgZ(45,"ion-label"),r._uU(46),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.YNc(47,ot,27,15,"div",26),r.YNc(48,yt,3,2,"div",0),r.YNc(49,At,3,2,"div",0),r.YNc(50,St,2,1,"p",27),r.qZA()}if(2&t){const t=r.oxw();r.xp6(1),r.Udp("background-image",t.backdropImage?"url("+t.backdropImage+")":""),r.xp6(3),r.hij(" ",t.poi.AddressInfo.Title," "),r.xp6(3),r.hij("OCM-",t.poi.ID,""),r.xp6(1),r.Q6J("ngIf",t.connectionSummary),r.xp6(1),r.Q6J("ngIf",t.poi.OperatorInfo),r.xp6(2),r.Oqu(r.xi3(12,18,t.avgRating,"1.1-1")),r.xp6(20),r.Q6J("ngIf","location"==t.selectedTab),r.xp6(2),r.Q6J("ngIf","location"==t.selectedTab),r.xp6(1),r.Q6J("ngIf","comments"==t.selectedTab),r.xp6(1),r.Q6J("ngIf","media"==t.selectedTab),r.xp6(2),r.Q6J("ngModel",t.selectedTab),r.xp6(6),r.hij("Comments (",t.poi.UserComments?t.poi.UserComments.length:0,")"),r.xp6(3),r.hij(" Photos (",t.poi.MediaItems?t.poi.MediaItems.length:0,")"),r.xp6(1),r.Q6J("ngIf","location"==t.selectedTab),r.xp6(1),r.Q6J("ngIf","comments"==t.selectedTab),r.xp6(1),r.Q6J("ngIf","media"==t.selectedTab),r.xp6(1),r.Q6J("ngIf",1==t.appManager.isDebugMode)}}function It(t,e){1&t&&(r.TgZ(0,"div"),r.TgZ(1,"h2"),r._uU(2,"POI Not Found"),r.qZA(),r.TgZ(3,"p"),r._uU(4,"The POI details could not be loaded."),r.qZA(),r.qZA())}let Et=(()=>{class t{constructor(t,e,n,i,r,o,s,a){this.appManager=t,this.nav=e,this.translate=n,this.logging=i,this.modalController=r,this.actionSheetController=o,this.poiManager=s,this.router=a,this.hasNavBar=!1}ngOnChanges(t){if(this.logging.log("In ngOnChanges of POI Details"),null!=this.poi&&null!=this.poi.AddressInfo){if(this.selectedTab="location",null!=this.poi.MediaItems&&this.poi.MediaItems.length>0){this.poi._hasPhotos=!0;for(let t of this.poi.MediaItems)t.ItemMediumURL=t.ItemThumbnailURL.replace(".thmb.",".medi.");this.backdropImage=this.poi.MediaItems[this.poi.MediaItems.length-1].ItemThumbnailURL.replace(".thmb.",".medi.")}else this.poi._hasPhotos=!1,this.backdropImage=null;if(null!=this.poi.UserComments&&this.poi.UserComments.length>0){this.poi._hasComments=!0;try{let t=this.poi.UserComments.filter(t=>t.Rating>0);if(t.length>0){let e=0;for(let n of t)e+=n.Rating;this.avgRating=e/t.length}else this.avgRating=null}catch(e){}}else this.poi._hasComments=!1;if(this.poi.Connections&&this.poi.Connections.length>0){let t="";for(let e of this.poi.Connections)-1==t.indexOf(e.ConnectionType.Title)&&(t+=(""!=t?", ":"")+e.ConnectionType.Title);this.connectionSummary=t}}}ngOnInit(){this.logging.log("In ngInit of POI Details")}get staticMapURL(){return"https://maps.googleapis.com/maps/api/staticmap?key="+(new T.X).googleMapsAPIKey+"&center="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude}get staticMapSize(){return 0===this.appManager.clientWidth?"240x100":this.appManager.clientWidth>=800?"640x100":this.appManager.clientWidth>=400?"400x100":"240x100"}continueAddComment(){var t=this;return(0,s.Z)(function*(){const e=yield t.modalController.create({component:w,componentProps:{id:t.poi.ID,poi:t.poi}});setTimeout(()=>{t.refresh()},1e3),yield e.present()})()}addComment(){var t=this;return(0,s.Z)(function*(){if(t.appManager.isUserAuthenticated(!0))yield t.continueAddComment();else{const e=yield t.modalController.create({component:S.F});e.onDidDismiss().then((0,s.Z)(function*(){t.appManager.isUserAuthenticated(!0)&&(yield t.continueAddComment())})),yield e.present()}})()}continueAddMedia(){var t=this;return(0,s.Z)(function*(){const e=yield t.modalController.create({component:_,componentProps:{id:t.poi.ID,poi:t.poi}});e.onDidDismiss().then(()=>{setTimeout(()=>{t.refresh()},1e3)}),yield e.present()})()}addMedia(){var t=this;return(0,s.Z)(function*(){if(t.appManager.isUserAuthenticated(!0))yield t.continueAddMedia();else{const e=yield t.modalController.create({component:S.F});e.onDidDismiss().then((0,s.Z)(function*(){t.appManager.isUserAuthenticated(!0)&&(yield t.continueAddMedia())})),yield e.present()}})()}addFavourite(){var t=this;return(0,s.Z)(function*(){yield(yield t.actionSheetController.create({header:"Add Favourite",buttons:[{text:"Add to Journey",handler:()=>{t.modalController.create({component:m,componentProps:{poi:t.poi}}).then(t=>t.present())}},{text:"Cancel",role:"cancel",handler:()=>{}}]})).present()})()}launchNavigation(){this.appManager.isPlatform("ios")?this.appManager.launchWebPage("https://maps.apple.com/?ll="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude):this.appManager.launchWebPage("https://maps.google.com/?q="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude)}launchURL(t){this.appManager.launchWebPage(t)}continueEdit(){var t=this;return(0,s.Z)(function*(){const e=yield t.modalController.create({component:C.Y,componentProps:{id:t.poi.ID}});return e.onDidDismiss().then(e=>{t.refresh()}),yield e.present()})()}edit(){var t=this;return(0,s.Z)(function*(){if(I.c.isFeatureEnabled("EDIT_POI"))if(t.appManager.isUserAuthenticated(!0))yield t.continueEdit();else{const e=yield t.modalController.create({component:S.F});e.onDidDismiss().then((0,s.Z)(function*(){t.appManager.isUserAuthenticated(!0)&&(yield t.continueEdit())})),yield e.present()}else t.appManager.launchOCMWebPage("/poi/edit/"+t.poi.ID)})()}refresh(t=null){this.poi&&this.poiManager.getPOIById(this.poi.ID,!0,!0).then(e=>{e&&(this.poi=e,this.ngOnChanges(null)),t&&t.target.complete()})}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(i.c),r.Y36(o.SH),r.Y36(E.sK),r.Y36(g.z),r.Y36(o.IN),r.Y36(o.BX),r.Y36(A.R),r.Y36(v.F0))},t.\u0275cmp=r.Xpm({type:t,selectors:[["poi-details"]],inputs:{poi:"poi"},features:[r.TTD],decls:2,vars:2,consts:[[4,"ngIf"],[1,"banner"],[1,"banner-content"],["color","primary","title","Average User Rating"],["vertical","top","horizontal","end","slot","fixed"],["name","add"],["side","bottom"],["title","Add a comment or charging check-in",3,"click"],["name","chatbubbles"],["title","Add a Photo",3,"click"],["name","camera"],["title","Add to Favourites",3,"click"],["name","star"],["title","Submit an Edit",3,"click"],["name","create"],["title","Refresh",3,"click"],["name","refresh"],["slot","fixed",3,"ionRefresh"],["pullingIcon","caret-down","pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refreshing..."],["slot","start"],["slot","end"],[1,"ion-padding"],[3,"ngModel","ngModelChange"],["value","location","selected",""],["value","comments"],["value","media"],["class","address-details",4,"ngIf"],["style","white-space: pre-wrap;",4,"ngIf"],["size","small","title","Add to Favourites",3,"click"],["name","star","slot","start"],["name","create","slot","start"],[3,"click"],["name","navigate","slot","start"],["size","small","title","Add a comment or charging check-in",3,"click"],["name","chatbubbles","slot","start"],["size","small","title","Add a Photo",3,"click"],["name","camera","slot","start"],[1,"address-details"],["name","battery-charging"],[3,"item"],["name","book"],["name","information-circle"],["class","details",4,"ngIf"],["name","map"],[1,"label"],[1,"details"],["name","pin"],[1,"details-minor"],["name","call"],["name","mail"],["name","globe"],["target","_system",3,"href"],["name","help-circle"],[1,"ion-padding-left"],["name","link"],["href","javascript:void(0)",3,"click",4,"ngIf"],["href","javascript:void(0)",3,"click"],["class","ion-padding",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"src",4,"ngIf"],[3,"src"],["name","checkmark-circle","color","success",2,"font-size","2em"],["name","close-circle","color","danger"],[1,"subtle"],[2,"white-space","pre-wrap"]],template:function(t,e){1&t&&(r.YNc(0,Ct,51,21,"div",0),r.YNc(1,It,5,0,"div",0)),2&t&&(r.Q6J("ngIf",null!=e.poi&&null!=e.poi.AddressInfo),r.xp6(1),r.Q6J("ngIf",null==e.poi||null==e.poi.AddressInfo))},directives:[u.O5,o.yp,o.IJ,o.W4,o.gu,o.zq,o.nJ,o.Wo,o.sr,o.Sm,o.cJ,o.QI,c.JJ,c.On,o.GO,o.Q$,o.YG,o.PM,o.Zi,o.FN,M.B,o.jY,o.Nd,o.wI,u.sg,o.Ie,o.BJ],pipes:[u.JJ,E.X$,u.uU],styles:[".banner[_ngcontent-%COMP%]{background-color:#4f712f;color:#ffffffec;padding:1em;text-shadow:#000 1px 1px 1px;min-height:180px;background-size:cover}.banner[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.banner-content[_ngcontent-%COMP%]{padding-right:48px}h3[_ngcontent-%COMP%]{font-weight:bold}.label[_ngcontent-%COMP%]{color:#000;font-weight:bold;font-size:12px}.details[_ngcontent-%COMP%]{color:#707d61;margin-left:1em;font-size:12px}.details-minor[_ngcontent-%COMP%]{color:#707d61;font-size:12px}p[_ngcontent-%COMP%]{display:block;padding:4px}ion-card-header[_ngcontent-%COMP%]{font-weight:bold;padding-bottom:0}ion-card-content[_ngcontent-%COMP%]{padding-top:4px}"]}),t})(),Mt=(()=>{class t{constructor(t,e,n){this.modalController=t,this.navParams=e,this.appManager=n,this.hasNavbar=!1,this.poi=this.navParams.get("item"),this.appManager.analytics.viewEvent("POIDetails")}close(){this.modalController.dismiss()}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(o.IN),r.Y36(o.X1),r.Y36(i.c))},t.\u0275cmp=r.Xpm({type:t,selectors:[["ng-component"]],decls:11,vars:3,consts:[["color","primary"],["slot","start"],[3,"click"],["name","close","slot","icon-only"],[1,"poi-details"],[3,"poi"]],template:function(t,e){1&t&&(r.TgZ(0,"ion-header"),r.TgZ(1,"ion-toolbar",0),r.TgZ(2,"ion-title"),r._uU(3),r.TgZ(4,"small"),r._uU(5),r.qZA(),r.qZA(),r.TgZ(6,"ion-buttons",1),r.TgZ(7,"ion-button",2),r.NdJ("click",function(){return e.close()}),r._UZ(8,"ion-icon",3),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(9,"ion-content",4),r._UZ(10,"poi-details",5),r.qZA()),2&t&&(r.xp6(3),r.hij(" ",e.poi.AddressInfo.Title," "),r.xp6(2),r.hij("OCM-",e.poi.ID,""),r.xp6(5),r.Q6J("poi",e.poi))},directives:[o.Gu,o.sr,o.wd,o.Sm,o.YG,o.gu,o.W2,Et],styles:['.left-col[_ngcontent-%COMP%]{float:left;width:50%;overflow:auto}.right-col[_ngcontent-%COMP%]{float:right;width:50%;overflow:auto}.row[_ngcontent-%COMP%]:after{content:"";display:table;clear:both;overflow:auto}.row[_ngcontent-%COMP%]{margin-bottom:1em}.subtle[_ngcontent-%COMP%]{color:silver}@media screen and (max-width: 768px){.left-col[_ngcontent-%COMP%]{float:none;width:100%}.right-col[_ngcontent-%COMP%]{margin-top:1em;float:none;width:100%}}.address-details[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:200px;width:auto}ion-label[_ngcontent-%COMP%]{overflow:inherit}ion-title[_ngcontent-%COMP%] > small[_ngcontent-%COMP%]{color:#ffffffbf}']}),t})()},1948:function(t,e,n){"use strict";n.r(e),n.d(e,{PoiEditorPageModule:function(){return d}});var i=n(8583),r=n(3679),o=n(8093),s=n(2517),a=n(7877),l=n(4516),c=n(8936),u=n(639);const h=[{path:"",component:a.Y}];let d=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[i.ez,r.u5,s.Pc,l.aw,c.e,o.Bz.forChild(h)]]}),t})()},7877:function(t,e,n){"use strict";n.d(e,{Y:function(){return at}});var i=n(8239),r=n(8118),o=n(2206),s=n(6579),a=n(9698),l=n(7919),c=n(639),u=n(4120),h=n(5906),d=n(553),p=n(7689),f=n(6260),m=n(1841),g=n(8583),y=n(2517);function _(t,e){if(1&t){const t=c.EpF();c.ynx(0),c.TgZ(1,"ion-note"),c.TgZ(2,"p"),c._uU(3," The closest address to this position is: "),c.qZA(),c.TgZ(4,"p"),c.TgZ(5,"strong"),c._uU(6),c.qZA(),c._UZ(7,"br"),c._uU(8),c._UZ(9,"br"),c.TgZ(10,"ion-button",3),c.NdJ("click",function(){return c.CHM(t),c.oxw().useAddressSelection()}),c._uU(11,"Use this address below "),c._UZ(12,"ion-icon",4),c.qZA(),c.qZA(),c.qZA(),c.BQk()}if(2&t){const t=c.oxw();c.xp6(6),c.Oqu(t.suggestedAddress.AddressLine1),c.xp6(2),c.HOy(" ",t.suggestedAddress.AddressLine2," ",t.suggestedAddress.Town," ",t.suggestedAddress.StateOrProvince," ",t.suggestedAddress.Postcode," ")}}let v=(()=>{class t{constructor(t,e,n,i,r){this.mapping=t,this.events=e,this.logging=n,this.http=i,this.appManager=r,this.latitudeChange=new c.vpe,this.longitudeChange=new c.vpe,this.suggestedAddress=null,this.suggestedAddressChange=new c.vpe,this.onUseSuggestedAddress=new c.vpe,this.suggestedAddressAttribution=null,this.suggestedAddressAttributionChange=new c.vpe,this.isMapInitialised=!1}ngOnInit(){this.mapService=new d.k(this.events,this.logging,this.http),this.mapService.initAPI(),this.mapOptions=new h._,this.mapOptions.mapType=this.appManager.searchSettings.MapType,this.mapOptions.onMapMoveCompleted=()=>{let t;t=this.mapService.getMapCenter(),t.subscribe(t=>{t&&(this.latitude=t.coords.latitude,this.longitude=t.coords.longitude,this.latitudeChange.emit(this.latitude),this.longitudeChange.emit(this.longitude),this.getAddressForCurrentLatLng())})}}ngAfterContentInit(){this.focusMap()}focusMap(){0==this.isMapInitialised&&this.mapService&&0!=this.latitude&&0!=this.longitude&&(this.isMapInitialised=!0,this.mapService.initMap("editor-map",this.mapOptions,null),this.mapService.setMapCenter(new u.jR(this.latitude,this.longitude)),this.originalMarkerPos=new u.wC(this.latitude,this.longitude))}ngOnChanges(t){this.focusMap()}getAddressForCurrentLatLng(){var t=this;return(0,i.Z)(function*(){t.latitude&&t.longitude&&t.appManager.api.fetchReverseGeocodeResult(t.latitude,t.longitude).then(e=>{e.AddressInfo&&(t.suggestedAddress=e.AddressInfo)})})()}useAddressSelection(){this.onUseSuggestedAddress.emit({suggestedAddress:this.suggestedAddress,attribution:this.suggestedAddressAttribution}),this.suggestedAddress=null,this.suggestedAddressAttribution=null}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(l.v),c.Y36(f.z),c.Y36(p.z),c.Y36(m.eN),c.Y36(r.c))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-poi-location-editor"]],inputs:{latitude:"latitude",longitude:"longitude"},outputs:{latitudeChange:"latitudeChange",longitudeChange:"longitudeChange",suggestedAddressChange:"suggestedAddressChange",onUseSuggestedAddress:"onUseSuggestedAddress",suggestedAddressAttributionChange:"suggestedAddressAttributionChange"},features:[c.TTD],decls:4,vars:1,consts:[[1,"instruction"],["id","editor-map"],[4,"ngIf"],["size","small",3,"click"],["slot","end","name","copy"]],template:function(t,e){1&t&&(c.TgZ(0,"p",0),c._uU(1,"Drag the map to center the marker on the charging location:"),c.qZA(),c._UZ(2,"div",1),c.YNc(3,_,13,5,"ng-container",2)),2&t&&(c.xp6(3),c.Q6J("ngIf",e.suggestedAddress))},directives:[g.O5,y.uN,y.YG,y.gu],styles:["#editor-map[_ngcontent-%COMP%]{border:1px solid gainsboro;background-color:gray;width:100%;height:128px}"]}),t})();var x=n(6799),b=n(3679);function w(t,e){if(1&t&&(c.TgZ(0,"ion-select-option",14),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t.ID),c.xp6(1),c.Oqu(t.Title)}}function T(t,e){if(1&t&&(c.TgZ(0,"ion-select-option",14),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t.ID),c.xp6(1),c.Oqu(t.Title)}}function A(t,e){if(1&t&&(c.TgZ(0,"ion-select-option",14),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t.ID),c.xp6(1),c.Oqu(t.Title)}}let S=(()=>{class t{constructor(t,e){this.modalController=t,this.referenceDataManager=e,this.useFilteredConnectionTypes=!0,this.useFilteredOperators=!0}get isAddMode(){return!(null!=this.conn&&this.conn.ID>0)}get connectionTypes(){return this.referenceDataManager.getConnectionTypes(this.useFilteredConnectionTypes)}get currentTypes(){return this.referenceDataManager.getOutputCurrentTypes()}get statusTypes(){return this.referenceDataManager.getStatusTypes().filter(t=>1==t.IsUserSelectable)}ngOnInit(){}save(){this.modalController.dismiss({item:this.conn})}cancel(){this.modalController.dismiss()}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(y.IN),c.Y36(x.W))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-poi-equipment-editor"]],decls:60,vars:13,consts:[[1,"ion-padding"],["position","floating"],[3,"ngModel","ngModelChange"],["value","0"],[3,"value",4,"ngFor","ngForOf"],["type","number",3,"ngModel","ngModelChange"],["type","text","placeholder","(optional) other comments",3,"ngModel","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],["slot","start"],[3,"click"],["name","close","slot","start"],["slot","end"],["color","success",3,"click"],["name","send","slot","end"],[3,"value"]],template:function(t,e){1&t&&(c.TgZ(0,"ion-header"),c.TgZ(1,"ion-toolbar"),c.TgZ(2,"ion-title"),c._uU(3),c.qZA(),c.qZA(),c.qZA(),c.TgZ(4,"ion-content",0),c.TgZ(5,"p"),c._uU(6,"Please provide as much information as you can about the equipment. If you don't know then leave the field blank. At a minimum you should include the Connection Type and approximate Power kW (max)."),c.qZA(),c.TgZ(7,"ion-item"),c.TgZ(8,"ion-label",1),c._uU(9,"Connection Type"),c.qZA(),c.TgZ(10,"ion-select",2),c.NdJ("ngModelChange",function(t){return e.conn.ConnectionTypeID=t}),c.TgZ(11,"ion-select-option",3),c._uU(12,"Unknown"),c.qZA(),c.YNc(13,w,2,2,"ion-select-option",4),c.qZA(),c.qZA(),c.TgZ(14,"ion-item"),c.TgZ(15,"ion-label",1),c._uU(16,"Supply Type"),c.qZA(),c.TgZ(17,"ion-select",2),c.NdJ("ngModelChange",function(t){return e.conn.CurrentTypeID=t}),c.TgZ(18,"ion-select-option",3),c._uU(19,"Unknown"),c.qZA(),c.YNc(20,T,2,2,"ion-select-option",4),c.qZA(),c.qZA(),c.TgZ(21,"ion-item"),c.TgZ(22,"ion-label",1),c._uU(23,"Power (kW)"),c.qZA(),c.TgZ(24,"ion-input",5),c.NdJ("ngModelChange",function(t){return e.conn.PowerKW=t}),c.qZA(),c.qZA(),c.TgZ(25,"ion-item"),c.TgZ(26,"ion-label",1),c._uU(27,"Amps"),c.qZA(),c.TgZ(28,"ion-input",5),c.NdJ("ngModelChange",function(t){return e.conn.Amps=t}),c.qZA(),c.qZA(),c.TgZ(29,"ion-item"),c.TgZ(30,"ion-label",1),c._uU(31,"Voltage"),c.qZA(),c.TgZ(32,"ion-input",5),c.NdJ("ngModelChange",function(t){return e.conn.Voltage=t}),c.qZA(),c.qZA(),c.TgZ(33,"ion-item"),c.TgZ(34,"ion-label",1),c._uU(35,"Status"),c.qZA(),c.TgZ(36,"ion-select",2),c.NdJ("ngModelChange",function(t){return e.conn.StatusTypeID=t}),c.YNc(37,A,2,2,"ion-select-option",4),c.qZA(),c.qZA(),c.TgZ(38,"ion-item"),c.TgZ(39,"ion-label",1),c._uU(40,"Quantity Available"),c.qZA(),c.TgZ(41,"ion-input",5),c.NdJ("ngModelChange",function(t){return e.conn.Quantity=t}),c.qZA(),c.qZA(),c.TgZ(42,"ion-item"),c.TgZ(43,"ion-label",1),c._uU(44,"Comment"),c.qZA(),c.TgZ(45,"ion-input",6),c.NdJ("ngModelChange",function(t){return e.conn.Comments=t}),c.qZA(),c.qZA(),c.TgZ(46,"ion-item"),c.TgZ(47,"ion-label",1),c._uU(48,"Operators Reference"),c.qZA(),c.TgZ(49,"ion-input",7),c.NdJ("ngModelChange",function(t){return e.conn.Reference=t}),c.qZA(),c.qZA(),c.qZA(),c.TgZ(50,"ion-footer"),c.TgZ(51,"ion-toolbar"),c.TgZ(52,"ion-buttons",8),c.TgZ(53,"ion-button",9),c.NdJ("click",function(){return e.cancel()}),c._UZ(54,"ion-icon",10),c._uU(55," Cancel "),c.qZA(),c.qZA(),c.TgZ(56,"ion-buttons",11),c.TgZ(57,"ion-button",12),c.NdJ("click",function(){return e.save()}),c._uU(58," OK "),c._UZ(59,"ion-icon",13),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&t&&(c.xp6(3),c.Oqu(e.isAddMode?"Add Equipment":"Edit Equipment"),c.xp6(7),c.Q6J("ngModel",e.conn.ConnectionTypeID),c.xp6(3),c.Q6J("ngForOf",e.connectionTypes),c.xp6(4),c.Q6J("ngModel",e.conn.CurrentTypeID),c.xp6(3),c.Q6J("ngForOf",e.currentTypes),c.xp6(4),c.Q6J("ngModel",e.conn.PowerKW),c.xp6(4),c.Q6J("ngModel",e.conn.Amps),c.xp6(4),c.Q6J("ngModel",e.conn.Voltage),c.xp6(4),c.Q6J("ngModel",e.conn.StatusTypeID),c.xp6(1),c.Q6J("ngForOf",e.statusTypes),c.xp6(4),c.Q6J("ngModel",e.conn.Quantity),c.xp6(4),c.Q6J("ngModel",e.conn.Comments),c.xp6(4),c.Q6J("ngModel",e.conn.Reference))},directives:[y.Gu,y.sr,y.wd,y.W2,y.Ie,y.Q$,y.t9,y.QI,b.JJ,b.On,y.n0,g.sg,y.pK,y.as,y.j9,y.fr,y.Sm,y.YG,y.gu],styles:[""]}),t})();var C=(()=>{return(t=C||(C={}))[t.Unknown=0]="Unknown",t[t.CurrentlyAvailable=10]="CurrentlyAvailable",t[t.CurrentlyInUse=20]="CurrentlyInUse",t[t.TemporarilyUnavailable=30]="TemporarilyUnavailable",t[t.Operational=50]="Operational",t[t.PartlyOperational=75]="PartlyOperational",t[t.NotOperational=100]="NotOperational",t[t.PlannedForFutureDate=150]="PlannedForFutureDate",t[t.RemovedDecomissioned=200]="RemovedDecomissioned",C;var t})(),I=(()=>{return(t=I||(I={}))[t.UnknownOperator=1]="UnknownOperator",t[t.SiteOwner=45]="SiteOwner",I;var t})(),E=n(6585);function M(t,e){if(1&t&&(c.TgZ(0,"ion-select-option",5),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t.ID),c.xp6(1),c.Oqu(t.Title)}}function k(t,e){1&t&&(c.TgZ(0,"ion-select-option",6),c._uU(1,"Other..."),c.qZA())}function P(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"ion-item"),c.TgZ(1,"ion-label",1),c._uU(2,"Network Operator"),c.qZA(),c.TgZ(3,"ion-select",2),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw().operatorId=e})("ionChange",function(){return c.CHM(t),c.oxw().onOperatorChange()}),c.YNc(4,M,2,2,"ion-select-option",3),c.YNc(5,k,2,0,"ion-select-option",4),c.qZA(),c.qZA()}if(2&t){const t=c.oxw();c.xp6(3),c.Q6J("ngModel",t.operatorId),c.xp6(1),c.Q6J("ngForOf",t.operators),c.xp6(1),c.Q6J("ngIf",t.useFilteredOperators)}}function D(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"ion-item"),c.TgZ(1,"ion-label"),c._uU(2,"Network Operator"),c.qZA(),c.TgZ(3,"ion-searchbar",7),c.NdJ("ionCancel",function(){return c.CHM(t),c.oxw().cancelOperatorLookup()})("ngModelChange",function(e){return c.CHM(t),c.oxw().operatorSearchKeyword=e})("ionChange",function(e){return c.CHM(t),c.oxw().searchOperators(e)}),c.qZA(),c.qZA()}if(2&t){const t=c.oxw();c.xp6(3),c.Q6J("ngModel",t.operatorSearchKeyword)}}function L(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"ion-item",9),c.NdJ("click",function(){const e=c.CHM(t).$implicit;return c.oxw(2).onOperatorChange(e)}),c.TgZ(1,"ion-avatar",10),c._UZ(2,"ion-icon",11),c.qZA(),c.TgZ(3,"ion-label"),c.TgZ(4,"p"),c._uU(5),c.qZA(),c.TgZ(6,"p"),c._uU(7),c.qZA(),c.qZA(),c.qZA()}if(2&t){const t=e.$implicit;c.xp6(5),c.Oqu(t.Title),c.xp6(2),c.Oqu(t.WebsiteURL)}}function O(t,e){if(1&t&&(c.ynx(0),c.TgZ(1,"ion-list"),c.YNc(2,L,8,2,"ion-item",8),c.qZA(),c.BQk()),2&t){const t=c.oxw();c.xp6(2),c.Q6J("ngForOf",t.operatorSearchResults)}}function R(t,e){if(1&t){const t=c.EpF();c.ynx(0),c.TgZ(1,"ion-item"),c.TgZ(2,"ion-avatar",10),c._UZ(3,"ion-icon",12),c.qZA(),c.TgZ(4,"ion-label"),c.TgZ(5,"p"),c._uU(6),c.qZA(),c.TgZ(7,"p"),c._uU(8),c.qZA(),c.TgZ(9,"ion-button",9),c.NdJ("click",function(){return c.CHM(t),c.oxw().selectedOperator=null}),c._uU(10,"Change"),c.qZA(),c.qZA(),c.qZA(),c.BQk()}if(2&t){const t=c.oxw();c.xp6(6),c.Oqu(t.selectedOperator.Title),c.xp6(2),c.Oqu(t.selectedOperator.WebsiteURL)}}let z=(()=>{class t{constructor(t){this.referenceDataManager=t,this.operatorId=null,this.useFilteredOperators=null,this.operatorChanged=new c.vpe,this.operatorCache=[],this.operatorSearchResults=[],this.operatorSearchKeyword="",this.selectedOperator=null}get operators(){return this.referenceDataManager.getNetworkOperators(this.useFilteredOperators)}ngOnInit(){this.operatorCache=this.referenceDataManager.getNetworkOperators(!1),null!=this.operatorId&&(this.selectedOperator=this.operatorCache.find(t=>t.ID==this.operatorId))}searchOperators(){this.operatorSearchResults=[],0!=this.operatorSearchKeyword.length&&(this.operatorSearchResults=this.operatorCache?this.operatorCache.filter(t=>t.Title.toLowerCase().startsWith(this.operatorSearchKeyword.toLowerCase())||t.Title.toLowerCase().startsWith("("+this.operatorSearchKeyword.toLowerCase())).slice(0,10):[])}onOperatorChange(t=null){var e=this;return(0,i.Z)(function*(){null==t&&e.operatorId&&(t=e.operatorCache.find(t=>t.ID==e.operatorId)),null!=t&&(e.operatorSearchResults=[],e.selectedOperator=t,e.operatorId=t.ID),e.operatorId?e.operatorChanged.emit(e.selectedOperator):e.useFilteredOperators=!1})()}cancelOperatorLookup(){this.selectedOperator=null}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(x.W))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-operator-lookup"]],inputs:{operatorId:"operatorId",useFilteredOperators:"useFilteredOperators"},outputs:{operatorChanged:"operatorChanged"},decls:4,vars:4,consts:[[4,"ngIf"],["position","floating"],[3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["value","",4,"ngIf"],[3,"value"],["value",""],["placeholder","Search by network name (in any country)","showCancelButton","focus","autocomplete","on",3,"ngModel","ionCancel","ngModelChange","ionChange"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["item-left",""],["name","card"],["name","locate"]],template:function(t,e){1&t&&(c.YNc(0,P,6,3,"ion-item",0),c.YNc(1,D,4,1,"ion-item",0),c.YNc(2,O,3,1,"ng-container",0),c.YNc(3,R,11,2,"ng-container",0)),2&t&&(c.Q6J("ngIf",e.useFilteredOperators&&!e.selectedOperator),c.xp6(1),c.Q6J("ngIf",!e.useFilteredOperators&&!e.selectedOperator),c.xp6(1),c.Q6J("ngIf",e.operatorSearchResults.length>0),c.xp6(1),c.Q6J("ngIf",null!=e.selectedOperator))},directives:[g.O5,y.Ie,y.Q$,y.t9,y.QI,b.JJ,b.On,g.sg,y.n0,y.VI,y.j9,y.q_,y.BJ,y.gu,y.YG],styles:[""]}),t})();var Z=n(1099);function F(t,e){1&t&&c._UZ(0,"ion-icon",13)}function U(t,e){1&t&&c._UZ(0,"ion-icon",13)}function N(t,e){1&t&&c._UZ(0,"ion-icon",13)}function B(t,e){if(1&t&&(c.TgZ(0,"ion-select-option",27),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t.ID),c.xp6(1),c.Oqu(t.Title)}}function q(t,e){if(1&t){const t=c.EpF();c.ynx(0),c.TgZ(1,"app-poi-location-editor",14,15),c.NdJ("latitudeChange",function(e){return c.CHM(t),c.oxw(2).item.AddressInfo.Latitude=e})("longitudeChange",function(e){return c.CHM(t),c.oxw(2).item.AddressInfo.Longitude=e})("onUseSuggestedAddress",function(e){return c.CHM(t),c.oxw(2).useSuggestedAddress(e)}),c.qZA(),c.TgZ(3,"ion-list"),c.TgZ(4,"ion-item"),c.TgZ(5,"ion-label",16),c._uU(6,"Location Name"),c.qZA(),c.TgZ(7,"ion-input",17),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw(2).item.AddressInfo.Title=e}),c.qZA(),c.qZA(),c.TgZ(8,"ion-item"),c.TgZ(9,"ion-label",16),c._uU(10,"Address Line 1"),c.qZA(),c.TgZ(11,"ion-input",18),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw(2).item.AddressInfo.AddressLine1=e}),c.qZA(),c.qZA(),c.TgZ(12,"ion-item"),c.TgZ(13,"ion-label",16),c._uU(14,"Address Line 2"),c.qZA(),c.TgZ(15,"ion-input",19),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw(2).item.AddressInfo.AddressLine2=e}),c.qZA(),c.qZA(),c.TgZ(16,"ion-item"),c.TgZ(17,"ion-label",16),c._uU(18,"Town"),c.qZA(),c.TgZ(19,"ion-input",20),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw(2).item.AddressInfo.Town=e}),c.qZA(),c.qZA(),c.TgZ(20,"ion-item"),c.TgZ(21,"ion-label",16),c._uU(22,"State or Province"),c.qZA(),c.TgZ(23,"ion-input",21),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw(2).item.AddressInfo.StateOrProvince=e}),c.qZA(),c.qZA(),c.TgZ(24,"ion-item"),c.TgZ(25,"ion-label",16),c._uU(26,"Postal Code"),c.qZA(),c.TgZ(27,"ion-input",22),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw(2).item.AddressInfo.Postcode=e}),c.qZA(),c.qZA(),c.TgZ(28,"ion-item"),c.TgZ(29,"ion-label",16),c._uU(30,"Country"),c.qZA(),c.TgZ(31,"ion-select",23),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw(2).item.AddressInfo.CountryID=e})("ionChange",function(){return c.CHM(t),c.oxw(2).onCountryChange()}),c.YNc(32,B,2,2,"ion-select-option",24),c.qZA(),c.qZA(),c.TgZ(33,"ion-item"),c.TgZ(34,"ion-label",16),c._uU(35,"Latitude"),c.qZA(),c.TgZ(36,"ion-input",25),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw(2).item.AddressInfo.Latitude=e}),c.qZA(),c.qZA(),c.TgZ(37,"ion-item"),c.TgZ(38,"ion-label",16),c._uU(39,"Longitude"),c.qZA(),c.TgZ(40,"ion-input",26),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw(2).item.AddressInfo.Longitude=e}),c.qZA(),c.qZA(),c.qZA(),c.BQk()}if(2&t){const t=c.oxw(2);c.xp6(1),c.Q6J("latitude",t.item.AddressInfo.Latitude)("longitude",t.item.AddressInfo.Longitude),c.xp6(6),c.Q6J("ngModel",t.item.AddressInfo.Title),c.xp6(4),c.Q6J("ngModel",t.item.AddressInfo.AddressLine1),c.xp6(4),c.Q6J("ngModel",t.item.AddressInfo.AddressLine2),c.xp6(4),c.Q6J("ngModel",t.item.AddressInfo.Town),c.xp6(4),c.Q6J("ngModel",t.item.AddressInfo.StateOrProvince),c.xp6(4),c.Q6J("ngModel",t.item.AddressInfo.Postcode),c.xp6(4),c.Q6J("ngModel",t.item.AddressInfo.CountryID),c.xp6(1),c.Q6J("ngForOf",t.countries),c.xp6(4),c.Q6J("ngModel",t.item.AddressInfo.Latitude),c.xp6(4),c.Q6J("ngModel",t.item.AddressInfo.Longitude)}}function $(t,e){if(1&t){const t=c.EpF();c.ynx(0),c.TgZ(1,"h3"),c._uU(2,"Locations Nearby"),c.qZA(),c.TgZ(3,"p"),c.TgZ(4,"strong"),c._uU(5,"The following locations already exist nearby."),c.qZA(),c.qZA(),c.TgZ(6,"div",28),c.TgZ(7,"p"),c._uU(8,"Ensure you are not adding a duplicate site unless it is for different equipment from another network operator."),c.qZA(),c.TgZ(9,"p"),c._uU(10,"You can edit any of these listings if required instead:"),c.qZA(),c.qZA(),c.TgZ(11,"app-poi-list",29),c.NdJ("onEdit",function(e){return c.CHM(t),c.oxw(2).editPOI(e)}),c.qZA(),c.BQk()}if(2&t){const t=c.oxw(2);c.xp6(11),c.Q6J("poiList",t.nearbySites)("enableEditOption",!0)}}function V(t,e){if(1&t&&(c.ynx(0),c.YNc(1,q,41,12,"ng-container",9),c.YNc(2,$,12,2,"ng-container",9),c.BQk()),2&t){const t=c.oxw();c.xp6(1),c.Q6J("ngIf","location"==t.step),c.xp6(1),c.Q6J("ngIf","poi-nearby"==t.step)}}function j(t,e){if(1&t){const t=c.EpF();c.ynx(0),c.TgZ(1,"p"),c._uU(2,"Copied the equipment configuration from:"),c.qZA(),c.TgZ(3,"ion-item"),c.TgZ(4,"ion-label"),c._uU(5),c._UZ(6,"br"),c._uU(7),c._UZ(8,"br"),c._uU(9),c._UZ(10,"br"),c._uU(11),c._UZ(12,"br"),c._uU(13),c.qZA(),c.TgZ(14,"ion-button",31),c.NdJ("click",function(){return c.CHM(t),c.oxw(5).changeTemplatePOI()}),c._uU(15,"Change.."),c.qZA(),c.qZA(),c.BQk()}if(2&t){const t=c.oxw(5);c.xp6(5),c.hij(" ",t.selectedTemplatePOI.AddressInfo.Title," "),c.xp6(2),c.hij(" ",t.selectedTemplatePOI.AddressInfo.AddressLine1," "),c.xp6(2),c.hij(" ",null==t.selectedTemplatePOI.Connections[0].ConnectionType?null:t.selectedTemplatePOI.Connections[0].ConnectionType.Title," "),c.xp6(2),c.hij(" ",t.selectedTemplatePOI.Connections[0].PowerKW," "),c.xp6(2),c.hij(" ",t.selectedTemplatePOI.DateCreated," ")}}function G(t,e){if(1&t){const t=c.EpF();c.ynx(0),c.TgZ(1,"h4"),c._uU(2,"Similar Sites"),c.qZA(),c.TgZ(3,"app-poi-list",32),c.NdJ("onCopy",function(e){return c.CHM(t),c.oxw(6).useTemplatePOI(e)}),c.qZA(),c.BQk()}if(2&t){const t=c.oxw(6);c.xp6(3),c.Q6J("enableCopyOption",!0)("poiList",t.templateSites)}}function Y(t,e){1&t&&(c.ynx(0),c.TgZ(1,"p"),c._uU(2," There are no suggested sites to copy for this network operator. "),c.qZA(),c.BQk())}function H(t,e){if(1&t&&(c.ynx(0),c.YNc(1,G,4,2,"ng-container",9),c.YNc(2,Y,3,0,"ng-container",9),c.BQk()),2&t){const t=c.oxw(5);c.xp6(1),c.Q6J("ngIf",t.templateSites.length>0),c.xp6(1),c.Q6J("ngIf",0==t.templateSites.length)}}function J(t,e){if(1&t&&(c.ynx(0),c.YNc(1,j,16,5,"ng-container",9),c.YNc(2,H,3,2,"ng-container",9),c.BQk()),2&t){const t=c.oxw(4);c.xp6(1),c.Q6J("ngIf",t.selectedTemplatePOI),c.xp6(1),c.Q6J("ngIf",!t.selectedTemplatePOI)}}function W(t,e){if(1&t){const t=c.EpF();c.ynx(0),c.TgZ(1,"p",28),c._uU(2,"You can copy the equipment settings from other sites operated by the same network operator or choose 'Next' to skip this step: "),c.qZA(),c.TgZ(3,"app-operator-lookup",30),c.NdJ("operatorChanged",function(e){return c.CHM(t),c.oxw(3).onOperatorChange(e)}),c.qZA(),c.YNc(4,J,3,2,"ng-container",9),c.BQk()}if(2&t){const t=c.oxw(3);c.xp6(3),c.Q6J("operatorId",t.item.OperatorID),c.xp6(1),c.Q6J("ngIf",t.item.AddressInfo.CountryID&&t.item.OperatorID)}}function X(t,e){if(1&t&&(c.ynx(0),c.YNc(1,W,5,2,"ng-container",9),c.BQk()),2&t){const t=c.oxw(2);c.xp6(1),c.Q6J("ngIf",!t.skipPOICopy)}}function Q(t,e){if(1&t){const t=c.EpF();c.ynx(0),c.TgZ(1,"app-operator-lookup",33),c.NdJ("operatorChanged",function(e){return c.CHM(t),c.oxw(2).onOperatorChange(e)}),c.qZA(),c.TgZ(2,"ion-item"),c.TgZ(3,"ion-label",16),c._uU(4,"Number of Stations or Parking Bays"),c.qZA(),c.TgZ(5,"ion-input",21),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw(2).item.NumberOfPoints=e}),c.qZA(),c.qZA(),c.TgZ(6,"h4"),c._uU(7,"Equipment"),c.qZA(),c.TgZ(8,"ion-button",34),c.NdJ("click",function(){return c.CHM(t),c.oxw(2).addConnection()}),c._UZ(9,"ion-icon",35),c.qZA(),c.TgZ(10,"app-equipment-details",36),c.NdJ("onEdit",function(e){return c.CHM(t),c.oxw(2).editConnection(e)})("onDelete",function(e){return c.CHM(t),c.oxw(2).deleteConnection(e)}),c.qZA(),c.BQk()}if(2&t){const t=c.oxw(2);c.xp6(1),c.Q6J("operatorId",t.item.OperatorID)("useFilteredOperators",!1),c.xp6(4),c.Q6J("ngModel",t.item.NumberOfPoints),c.xp6(5),c.Q6J("item",t.item)("enableEdit",!0)}}function K(t,e){if(1&t&&(c.ynx(0),c.YNc(1,X,2,1,"ng-container",9),c.YNc(2,Q,11,5,"ng-container",9),c.BQk()),2&t){const t=c.oxw();c.xp6(1),c.Q6J("ngIf","copy-equipment"==t.step),c.xp6(1),c.Q6J("ngIf","edit-equipment"==t.step)}}function tt(t,e){if(1&t&&(c.TgZ(0,"p",43),c.TgZ(1,"strong"),c._uU(2,"Your changes cannot be saved until the following issues are resolved:"),c.qZA(),c.TgZ(3,"ion-label",44),c._uU(4),c.qZA(),c.qZA()),2&t){const t=c.oxw(2);c.xp6(4),c.hij(" ",t.validationMsg,"")}}function et(t,e){if(1&t&&(c.TgZ(0,"ion-select-option",27),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t.ID),c.xp6(1),c.Oqu(t.Title)}}function nt(t,e){if(1&t&&(c.TgZ(0,"ion-select-option",27),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t.ID),c.xp6(1),c.Oqu(t.Title)}}function it(t,e){if(1&t){const t=c.EpF();c.ynx(0),c.YNc(1,tt,5,1,"p",37),c.TgZ(2,"p"),c._uU(3,"Please provide any other facts related to this site. Additional comments (your charging experiences etc) can be added as check-in comments once the site is listed."),c.qZA(),c.TgZ(4,"ion-item"),c.TgZ(5,"ion-label",16),c._uU(6,"Operational Status (All Equipment))"),c.qZA(),c.TgZ(7,"ion-select",38),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw().item.StatusTypeID=e}),c.YNc(8,et,2,2,"ion-select-option",24),c.qZA(),c.qZA(),c.TgZ(9,"ion-item"),c.TgZ(10,"ion-label",16),c._uU(11,"Usage Type"),c.qZA(),c.TgZ(12,"ion-select",38),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw().item.UsageTypeID=e}),c.YNc(13,nt,2,2,"ion-select-option",24),c.qZA(),c.qZA(),c.TgZ(14,"ion-item"),c.TgZ(15,"ion-label",16),c._uU(16,"Usage Cost"),c.qZA(),c.TgZ(17,"ion-input",21),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw().item.UsageCost=e}),c.qZA(),c.qZA(),c.TgZ(18,"ion-item"),c.TgZ(19,"ion-label",16),c._uU(20,"General Comments"),c.qZA(),c.TgZ(21,"ion-input",39),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw().item.GeneralComments=e}),c.qZA(),c.qZA(),c.TgZ(22,"ion-item"),c.TgZ(23,"ion-label",16),c._uU(24,"Main Telephone Number "),c.qZA(),c.TgZ(25,"ion-input",40),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw().item.AddressInfo.ContactTelephone1=e}),c.qZA(),c.qZA(),c.TgZ(26,"ion-item"),c.TgZ(27,"ion-label",16),c._uU(28,"Other Telephone Number "),c.qZA(),c.TgZ(29,"ion-input",40),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw().item.AddressInfo.ContactTelephone2=e}),c.qZA(),c.qZA(),c.TgZ(30,"ion-item"),c.TgZ(31,"ion-label",16),c._uU(32,"Access Comments"),c.qZA(),c.TgZ(33,"ion-input",41),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw().item.AddressInfo.AccessComments=e}),c.qZA(),c.qZA(),c.TgZ(34,"ion-item"),c.TgZ(35,"ion-label",16),c._uU(36,"Related Website"),c.qZA(),c.TgZ(37,"ion-input",42),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw().item.AddressInfo.RelatedURL=e}),c.qZA(),c.qZA(),c.BQk()}if(2&t){const t=c.oxw();c.xp6(1),c.Q6J("ngIf",t.validationMsg),c.xp6(6),c.Q6J("ngModel",t.item.StatusTypeID),c.xp6(1),c.Q6J("ngForOf",t.statusTypes),c.xp6(4),c.Q6J("ngModel",t.item.UsageTypeID),c.xp6(1),c.Q6J("ngForOf",t.usageTypes),c.xp6(4),c.Q6J("ngModel",t.item.UsageCost),c.xp6(4),c.Q6J("ngModel",t.item.GeneralComments),c.xp6(4),c.Q6J("ngModel",t.item.AddressInfo.ContactTelephone1),c.xp6(4),c.Q6J("ngModel",t.item.AddressInfo.ContactTelephone2),c.xp6(4),c.Q6J("ngModel",t.item.AddressInfo.AccessComments),c.xp6(4),c.Q6J("ngModel",t.item.AddressInfo.RelatedURL)}}function rt(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"ion-button",1),c.NdJ("click",function(){return c.CHM(t),c.oxw().previous()}),c._uU(1," Previous "),c._UZ(2,"ion-icon",45),c.qZA()}}function ot(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"ion-button",1),c.NdJ("click",function(){return c.CHM(t),c.oxw().next()}),c._uU(1," Next "),c._UZ(2,"ion-icon",46),c.qZA()}}function st(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"ion-button",47),c.NdJ("click",function(){return c.CHM(t),c.oxw().save()}),c._uU(1," Submit "),c._UZ(2,"ion-icon",48),c.qZA()}}let at=(()=>{class t{constructor(t,e,n,i,r,o){this.appManager=t,this.modalController=e,this.poiManager=n,this.mapping=i,this.loadingController=r,this.alertController=o,this.useFilteredConnectionTypes=!0,this.templateSites=[],this.nearbySites=[],this.selectedTemplatePOI=null,this.suggestedAddress=null,this.suggestedAddressAttribution=null,this.isNonDuplicateConfirmed=!1,this.skipPOICopy=!1,this.validationMsg=null,this.initNewItem()}get countries(){return this.appManager.referenceDataManager.getCountries()}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes()}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes().filter(t=>1==t.IsUserSelectable)}get isAddMode(){return this.item.ID<=0}initNewItem(){this.item={ID:-1,DataProviderID:1,DataProvidersReference:null,OperatorsReference:null,OperatorID:1,UsageCost:null,UsageTypeID:4,NumberOfPoints:1,GeneralComments:null,DatePlanned:null,StatusTypeID:50,SubmissionStatusTypeID:null,Connections:[],MetadataValues:[],AddressInfo:{ID:-1,CountryID:18,Title:"",AddressLine1:"",Latitude:0,Longitude:0}},this.step="location",this.selectedTab="location"}get isReadyToSubmit(){return this.validate().isValid&&"info"==this.step}ngOnInit(){}presentLoadingUI(){var t=this;return(0,i.Z)(function*(){t.loading=yield t.loadingController.create({message:"Please Wait.."}),yield t.loading.present()})()}dismissLoadingUI(){var t=this;return(0,i.Z)(function*(){t.loading&&(yield t.loading.dismiss())})()}ionViewDidEnter(){if(null!=this.id)this.editExistingPOI(this.id);else{let t=localStorage.getItem("_editor-operatorid");t&&(this.item.OperatorID=parseInt(t,10)),this.startPos?(this.item.AddressInfo.Latitude=this.startPos.latitude,this.item.AddressInfo.Longitude=this.startPos.longitude):this.mapping&&this.mapping.getMapCenter().subscribe(t=>{t&&(this.item.AddressInfo.Latitude=t.coords.latitude,this.item.AddressInfo.Longitude=t.coords.longitude)})}this.refreshFilteredReferenceData()}previous(){var t=this;return(0,i.Z)(function*(){switch(t.step){case"info":t.step="edit-equipment";break;case"edit-equipment":t.step=t.isAddMode?"copy-equipment":"location";break;case"copy-equipment":case"poi-nearby":t.step="location"}yield t.initCurrentStep(!1)})()}next(){var t=this;return(0,i.Z)(function*(){if("poi-nearby"==t.step&&t.nearbySites.length>0&&!t.isNonDuplicateConfirmed)return void(yield t.alertController.create({header:"Confirm",message:"Please confirm you are not adding a duplicate site.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:t=>{}},{text:"Confirm",handler:()=>{t.isNonDuplicateConfirmed=!0,t.next()}}]})).present();const e=t.validate(t.step);if(e.isValid){switch(t.step){case"location":t.step=t.isAddMode?"poi-nearby":"edit-equipment";break;case"poi-nearby":t.step=t.isAddMode?"copy-equipment":"edit-equipment";break;case"copy-equipment":t.step="edit-equipment";break;case"edit-equipment":t.step="info"}yield t.initCurrentStep(!0)}else(yield t.alertController.create({message:e.msg})).present()})()}initCurrentStep(t){var e=this;return(0,i.Z)(function*(){"poi-nearby"==e.step?(e.selectedTab="location",0==(yield e.refreshNearbySites())&&(t?yield e.next():yield e.previous())):"location"==e.step?e.selectedTab="location":"copy-equipment"==e.step?(e.selectedTab="equipment",yield e.refreshTemplateSites()):"edit-equipment"==e.step?e.selectedTab="equipment":"info"==e.step&&(e.selectedTab="info")})()}onCountryChange(){var t=this;return(0,i.Z)(function*(){t.refreshFilteredReferenceData()})()}onOperatorChange(t=null){var e=this;return(0,i.Z)(function*(){null!=t&&e.item.OperatorID!=t.ID&&(e.item.OperatorID=t.ID,localStorage.setItem("_editor-operatorid",e.item.OperatorID.toString()),yield e.refreshTemplateSites())})()}useSuggestedAddress(t=null){t&&(this.suggestedAddress=t.suggestedAddress,this.suggestedAddressAttribution=t.suggestedAddressAttribution),Object.assign(this.item.AddressInfo,this.suggestedAddress),this.suggestedAddressAttribution&&(this.item.MetadataValues.find(t=>4==t.MetadataFieldID)||this.item.MetadataValues.push({ID:-1,MetadataFieldID:4,ItemValue:this.suggestedAddressAttribution,MetadataFieldOptionID:null,MetadataFieldOption:null}))}editConnection(t){var e=this;return(0,i.Z)(function*(){const n=e.item.Connections.find(e=>e.ID==t.ID),i=Object.assign({},n),r=yield e.modalController.create({component:S,componentProps:{conn:i}});return r.onWillDismiss().then(t=>{t&&t.data&&t.data.item&&e.updateConnection(t.data.item)}),yield r.present()})()}deleteConnection(t){var e=this;return(0,i.Z)(function*(){const n=e.item.Connections.find(e=>e.ID==t.ID);(yield e.alertController.create({header:"Confirm Delete",message:"Are you sure you want to delete this connection information?",buttons:[{text:"No",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Yes",handler:()=>{e.item.Connections=e.item.Connections.filter(t=>t.ID!=n.ID),e.appManager.referenceDataManager.hydrateCompactPOI(e.item,!0)}}]})).present()})()}addConnection(){var t=this;return(0,i.Z)(function*(){const e={ID:-s.c.getRandomInt(1e4),ConnectionTypeID:null,StatusTypeID:50,PowerKW:null,Quantity:1},n=yield t.modalController.create({component:S,componentProps:{conn:e}});return n.onWillDismiss().then(e=>{e&&e.data&&e.data.item&&t.updateConnection(e.data.item)}),yield n.present()})()}refreshFilteredReferenceData(){this.appManager.referenceDataManager.refreshFilteredReferenceData(this.appManager.api,{CountryIds:[this.item.AddressInfo.CountryID]})}updateConnection(t){if(t){let e=this.item.Connections.find(e=>e.ID==t.ID);e?Object.assign(e,t):this.item.Connections.push(t)}this.appManager.referenceDataManager.hydrateCompactPOI(this.item,!0)}validate(t="all"){let e=null;return("all"==t||"location"==t)&&((!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(e="Location is required"),""==this.item.AddressInfo.Title&&(e="A location title is required"),this.item.AddressInfo.CountryID||(e="A country selection is required"),(!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(e="A location latitude and longitude is required")),("all"==t||"poi-nearby"==t)&&this.nearbySites.length>0&&!this.isNonDuplicateConfirmed&&(e="Please confirm that the site is not a duplicate"),("all"==t||"equipment"==t)&&(this.item.OperatorID||(e="Please confirm the charging network or equipment operator."),0==this.item.Connections.length&&(e="Equipment information is required")),e?(this.validationMsg=e,{isValid:!1,msg:e}):(this.validationMsg=null,{isValid:!0,msg:null})}save(){var t=this;return(0,i.Z)(function*(){let e=t.validate();if(e.isValid){yield t.presentLoadingUI();try{yield t.appManager.submitPOI(t.item),yield t.dismissLoadingUI(),t.appManager.showToastNotification("You submission will be reviewed (if required) and published shortly."),t.modalController.dismiss()}catch(n){yield t.dismissLoadingUI(),n.error&&alert("Sorry, your submission could not be completed at this time. Please try again later.")}}else alert(e.msg)})()}cancel(){var t=this;return(0,i.Z)(function*(){t.modalController.dismiss()})()}refreshTemplateSites(){var t=this;return(0,i.Z)(function*(){if(t.item.AddressInfo.CountryID&&t.item.OperatorID){yield t.presentLoadingUI(),t.templateSites=[];let e=new o.b;e.countryIdList=[t.item.AddressInfo.CountryID],e.minPowerKW=1,e.operatorIdList=[t.item.OperatorID],e.maxResults=10;let n=yield t.poiManager.fetchPOIList(e);n.sort((t,e)=>new Date(t.DateCreated).getTime()-new Date(e.DateCreated).getTime()),t.templateSites=n,t.dismissLoadingUI()}})()}refreshNearbySites(){var t=this;return(0,i.Z)(function*(){if(t.item.AddressInfo.Latitude&&t.item.AddressInfo.Longitude){yield t.presentLoadingUI(),t.nearbySites=[];let e=new o.b;e.latitude=t.item.AddressInfo.Latitude,e.longitude=t.item.AddressInfo.Longitude,e.distance=5,e.distanceUnit="km",e.maxResults=10;let n=yield t.poiManager.fetchPOIList(e);return n.sort((t,e)=>t.Distance-e.Distance),t.nearbySites=n,t.dismissLoadingUI(),n.length}return 0})()}confirmNonDuplicate(){this.isNonDuplicateConfirmed=!0,this.next()}changeTemplatePOI(){this.selectedTemplatePOI=null}editPOI(t){this.editExistingPOI(t.ID)}editExistingPOI(t){var e=this;return(0,i.Z)(function*(){e.skipPOICopy=!0,e.isNonDuplicateConfirmed=!0,yield e.presentLoadingUI(),e.poiManager.getPOIById(t,!0,!0).then(t=>{e.item=Object.assign({},t),null==e.item.OperatorID&&(e.item.OperatorID=I.UnknownOperator),e.refreshFilteredReferenceData(),e.dismissLoadingUI()})})()}useTemplatePOI(t){this.selectedTemplatePOI=t,Object.assign(this.item.Connections,t.Connections);for(let e of this.item.Connections)e.ID=-s.c.getRandomInt(1e4),e.Reference=null,e.Comments=null,e.StatusTypeID=C.Operational;this.item.UsageCost=t.UsageCost,this.item.UsageTypeID=t.UsageTypeID,this.appManager.referenceDataManager.hydrateCompactPOI(this.item)}skipCopyingPOI(){this.skipPOICopy=!0}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(r.c),c.Y36(y.IN),c.Y36(a.R),c.Y36(l.v),c.Y36(y.HT),c.Y36(y.Br))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-poi-editor"]],viewQuery:function(t,e){if(1&t&&c.Gf(v,5),2&t){let t;c.iGM(t=c.CRH())&&(e.editorMap=t.first)}},decls:33,vars:14,consts:[["slot","end"],[3,"click"],["name","close","slot","start"],[1,"ion-padding"],[3,"ngModel"],["value","location","layout","icon-start",3,"disabled"],["name","caret-forward",4,"ngIf"],["value","equipment","layout","icon-start",3,"disabled"],["value","info","layout","icon-start",3,"disabled"],[4,"ngIf"],["slot","start"],[3,"click",4,"ngIf"],["color","success",3,"click",4,"ngIf"],["name","caret-forward"],[3,"latitude","longitude","latitudeChange","longitudeChange","onUseSuggestedAddress"],["editorMap",""],["position","floating"],["type","text","autocapitalize","words","placeholder","A title for this location",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","The nearest street address",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Optional",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Town or City",3,"ngModel","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Optional Postal Code",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["type","number","placeholder","Latitude (if entering manually)",3,"ngModel","ngModelChange"],["type","number","placeholder","Longitude (if entering manually)",3,"ngModel","ngModelChange"],[3,"value"],[1,"instruction"],[3,"poiList","enableEditOption","onEdit"],[3,"operatorId","operatorChanged"],["slot","start","size","small",3,"click"],[3,"enableCopyOption","poiList","onCopy"],[3,"operatorId","useFilteredOperators","operatorChanged"],["size","small",3,"click"],["name","add","slot","icon-only"],[3,"item","enableEdit","onEdit","onDelete"],["color","warning",4,"ngIf"],[3,"ngModel","ngModelChange"],["type","text","autocapitalize","sentences",3,"ngModel","ngModelChange"],["type","tel","placeholder","",3,"ngModel","ngModelChange"],["type","text","autocapitalize","sentences","placeholder","Instructions for access or tips for finding charging location",3,"ngModel","ngModelChange"],["type","url","placeholder","Website related to this site",3,"ngModel","ngModelChange"],["color","warning"],["color","danger"],["name","caret-back","slot","start"],["name","caret-forward","slot","end"],["color","success",3,"click"],["name","send","slot","end"]],template:function(t,e){1&t&&(c.TgZ(0,"ion-header"),c.TgZ(1,"ion-toolbar"),c.TgZ(2,"ion-title"),c._uU(3),c.qZA(),c.TgZ(4,"ion-buttons",0),c.TgZ(5,"ion-button",1),c.NdJ("click",function(){return e.cancel()}),c._UZ(6,"ion-icon",2),c._uU(7," Cancel "),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(8,"ion-content",3),c.ynx(9),c.TgZ(10,"ion-segment",4),c.TgZ(11,"ion-segment-button",5),c.YNc(12,F,1,0,"ion-icon",6),c.TgZ(13,"ion-label"),c._uU(14,"Location"),c.qZA(),c.qZA(),c.TgZ(15,"ion-segment-button",7),c.YNc(16,U,1,0,"ion-icon",6),c.TgZ(17,"ion-label"),c._uU(18,"Equipment"),c.qZA(),c.qZA(),c.TgZ(19,"ion-segment-button",8),c.YNc(20,N,1,0,"ion-icon",6),c.TgZ(21,"ion-label"),c._uU(22,"Info"),c.qZA(),c.qZA(),c.qZA(),c.YNc(23,V,3,2,"ng-container",9),c.YNc(24,K,3,2,"ng-container",9),c.YNc(25,it,38,11,"ng-container",9),c.BQk(),c.qZA(),c.TgZ(26,"ion-footer"),c.TgZ(27,"ion-toolbar"),c.TgZ(28,"ion-buttons",10),c.YNc(29,rt,3,0,"ion-button",11),c.qZA(),c.TgZ(30,"ion-buttons",0),c.YNc(31,ot,3,0,"ion-button",11),c.YNc(32,st,3,0,"ion-button",12),c.qZA(),c.qZA(),c.qZA()),2&t&&(c.xp6(3),c.Oqu(e.isAddMode?"Add Location":"Edit Location"),c.xp6(7),c.Q6J("ngModel",e.selectedTab),c.xp6(1),c.Q6J("disabled",!0),c.xp6(1),c.Q6J("ngIf","location"==e.selectedTab),c.xp6(3),c.Q6J("disabled",!0),c.xp6(1),c.Q6J("ngIf","equipment"==e.selectedTab),c.xp6(3),c.Q6J("disabled",!0),c.xp6(1),c.Q6J("ngIf","info"==e.selectedTab),c.xp6(3),c.Q6J("ngIf","location"==e.selectedTab),c.xp6(1),c.Q6J("ngIf","equipment"==e.selectedTab),c.xp6(1),c.Q6J("ngIf","info"==e.selectedTab),c.xp6(4),c.Q6J("ngIf","location"!=e.step),c.xp6(2),c.Q6J("ngIf",!e.isReadyToSubmit&&"info"!=e.step),c.xp6(1),c.Q6J("ngIf",e.isReadyToSubmit))},directives:[y.Gu,y.sr,y.wd,y.Sm,y.YG,y.gu,y.W2,y.cJ,y.QI,b.JJ,b.On,y.GO,g.O5,y.Q$,y.fr,v,y.q_,y.Ie,y.pK,y.j9,y.t9,g.sg,y.as,y.n0,E.o,z,Z.B],styles:['ul.breadcrumb[_ngcontent-%COMP%]{display:inline-flex;margin:0;padding:0}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-flex;margin-right:6px;color:var(--ion-color-light-shade);font-size:10px}ul.breadcrumb[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{color:var(--ion-color-dark-shade)}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:">";padding-right:4px}']}),t})()},6153:function(t,e,n){"use strict";n.d(e,{u:function(){return C}});var i=n(639),r=n(2517),o=n(4120),s=n(3912),a=n(7689),l=n(1122),c=n(1841);let u=(()=>{class t{constructor(t,e){this.http=t,this.journeyManager=e}getDirections(t,e){return new Promise((n,i)=>{(new google.maps.DirectionsService).route({origin:t,destination:e,travelMode:google.maps.TravelMode.DRIVING},(t,e)=>{e===google.maps.DirectionsStatus.OK?n(t):i(e)})})}analyseRoutes(t,e){const n=new Array;return t.routes.forEach(t=>{const i=new l.JJ;i.Title=""+n.length+1,i.JourneyRouteLegs=new Array,i.TotalDistanceKM=0,i.TotalDurationMinutes=0,i.TotalEnergykWh=0,t.legs.forEach(t=>{const n=t.duration.value,r=t.distance.value/1e3,o=this.journeyManager.calculateEnergyConsumptionkWh(r,0,null,e),s=new l.eN;s.DistanceKM=r,s.DurationMinutes=n/60,s.EnergyConsumptionkWh=o,i.JourneyRouteLegs.push(s),i.TotalDistanceKM+=s.DistanceKM,i.TotalDurationMinutes+=s.DurationMinutes,i.TotalEnergykWh=s.EnergyConsumptionkWh}),n.push(i)}),n}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(c.eN),i.LFG(s.i))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var h=n(7919),d=n(8583),p=n(2428),f=n(3679);function m(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"ion-item"),i._UZ(1,"ion-icon",12),i.TgZ(2,"ion-searchbar",13),i.NdJ("ngModelChange",function(e){return i.CHM(t),i.oxw().routeStart=e})("ionInput",function(e){return i.CHM(t),i.oxw(),i.MAs(18).getPlacesAutoComplete(e,"routeStart")})("ionCancel",function(e){return i.CHM(t),i.oxw().onPlaceSearchCancel(e)}),i.qZA(),i.qZA()}if(2&t){const t=i.oxw();i.xp6(2),i.Q6J("ngModel",t.routeStart)("debounce",500)}}function g(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"ion-item",14),i.NdJ("click",function(){return i.CHM(t),i.oxw().clearRouteStart()}),i._UZ(1,"ion-icon",12),i.TgZ(2,"h2"),i._uU(3),i.qZA(),i.qZA()}if(2&t){i.oxw();const t=i.MAs(18);i.xp6(3),i.Oqu(null==t.selectedPlace?null:t.selectedPlace.name)}}function y(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"ion-item"),i._UZ(1,"ion-icon",15),i.TgZ(2,"ion-searchbar",16),i.NdJ("ngModelChange",function(e){return i.CHM(t),i.oxw().routeDestination=e})("ionInput",function(e){return i.CHM(t),i.oxw(),i.MAs(20).getPlacesAutoComplete(e,"routeDestination")})("ionCancel",function(e){return i.CHM(t),i.oxw().onPlaceSearchCancel(e)}),i.qZA(),i.qZA()}if(2&t){const t=i.oxw();i.xp6(2),i.Q6J("ngModel",t.routeDestination)("debounce",500)}}function _(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"ion-item",14),i.NdJ("click",function(){return i.CHM(t),i.oxw().clearRouteDestination()}),i._UZ(1,"ion-icon",15),i.TgZ(2,"h2"),i._uU(3),i.qZA(),i.qZA()}if(2&t){i.oxw();const t=i.MAs(20);i.xp6(3),i.Oqu(null==t.selectedPlace?null:t.selectedPlace.name)}}function v(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"ion-button",14),i.NdJ("click",function(){return i.CHM(t),i.oxw().clearRoute()}),i._UZ(1,"ion-icon",17),i._uU(2," Clear Route "),i.qZA()}}function x(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"ion-button",14),i.NdJ("click",function(){return i.CHM(t),i.oxw().showSettings()}),i._uU(1," Show Settings "),i._UZ(2,"ion-icon",18),i.qZA()}}function b(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"ion-button",14),i.NdJ("click",function(){return i.CHM(t),i.oxw().hideSettings()}),i._uU(1," Hide Settings "),i._UZ(2,"ion-icon",18),i.qZA()}}function w(t,e){1&t&&(i.TgZ(0,"p",19),i._UZ(1,"ion-spinner",19),i._uU(2," Calculating Route.. "),i.qZA())}function T(t,e){if(1&t&&(i.TgZ(0,"ion-list"),i.TgZ(1,"ion-list-header"),i._uU(2),i.ALo(3,"number"),i.ALo(4,"number"),i.qZA(),i.qZA()),2&t){const t=i.oxw();i.xp6(2),i.lnq(" Total Distance ",i.xi3(3,3,t.selectedJourneyRoute.TotalDistanceKM,"1.0-2")," km, ",t.formatDuration(t.selectedJourneyRoute.TotalDurationMinutes),", ",i.xi3(4,6,t.selectedJourneyRoute.TotalEnergykWh,"1.0-2")," kWh ")}}function A(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"div"),i.TgZ(1,"ion-list"),i.TgZ(2,"ion-list-header"),i._UZ(3,"ion-icon",20),i._uU(4," Route Settings "),i.qZA(),i.TgZ(5,"ion-item"),i.TgZ(6,"ion-label",21),i._uU(7),i.qZA(),i.TgZ(8,"ion-range",22),i.NdJ("ngModelChange",function(e){return i.CHM(t),i.oxw().routeSearchDistance=e}),i._UZ(9,"ion-icon",23),i._UZ(10,"ion-icon",24),i.qZA(),i.qZA(),i.TgZ(11,"ion-item"),i.TgZ(12,"ion-label",21),i._uU(13,"Energy Efficiency (kWh Per km)"),i.qZA(),i.TgZ(14,"ion-input",25),i.NdJ("ngModelChange",function(e){return i.CHM(t),i.oxw().kWhPerKM=e}),i.qZA(),i.qZA(),i.qZA(),i.qZA()}if(2&t){const t=i.oxw();i.xp6(7),i.hij("Search Distance (",t.routeSearchDistance,")"),i.xp6(1),i.Q6J("ngModel",t.routeSearchDistance),i.xp6(6),i.Q6J("ngModel",t.kWhPerKM)}}let S=(()=>{class t{constructor(t,e,n,i,r,o){this.mapping=t,this.logging=e,this.directions=n,this.journeyManager=i,this.changeDetector=r,this.numberPipe=o,this.routeSearchDistance=5,this.routeCalcInProgress=!1,this.advancedSettingsMode=!1,this.routeStart="",this.routeDestination="",this.kWhPerKM=.212}get isRouteSet(){return null!=this.routeStartPlace&&null!=this.routeDestinationPlace}showSettings(){this.advancedSettingsMode=!0}hideSettings(){this.advancedSettingsMode=!1}routeStartSelected(t){this.routeStartPlace=t,this.calculateRoute(),this.changeDetector.detectChanges()}routeDestinationSelected(t){this.routeDestinationPlace=t,this.calculateRoute(),this.changeDetector.detectChanges()}clearRouteStart(){this.routeStartPlace=null,this.changeDetector.detectChanges()}clearRouteDestination(){this.routeDestinationPlace=null,this.changeDetector.detectChanges()}clearRoute(){this.routeStartPlace=null,this.routeDestinationPlace=null,this.journeyManager.setRoutePolyline(null),this.mapping.clearPolyline()}formatDuration(t){if(t<=60)return this.numberPipe.transform(t,"1.0-2")+" mins";{const e=Math.round(t/60),n=Math.floor(t-60*e);return e+" hours "+(n>0?n+" mins":"")}}calculateRoute(){null!=this.routeStartPlace&&null!=this.routeDestinationPlace&&(this.logging.log("Fetching route directions.."),this.routeCalcInProgress=!0,this.directions.getDirections(this.routeStartPlace.Location.latitude+","+this.routeStartPlace.Location.longitude,this.routeDestinationPlace.Location.latitude+","+this.routeDestinationPlace.Location.longitude).then(t=>{if(null!=t.routes&&t.routes.length>0){this.logging.log("Got route directions, analysing.."),this.routePolyline=t.routes[0].overview_polyline;const e=t.routes[0].bounds.getSouthWest(),n=t.routes[0].bounds.getNorthEast(),i=new o.wC(n.lat(),n.lng()),r=new o.wC(e.lat(),e.lng()),s=new o.LL(i,r);this.journeyRoutes=this.directions.analyseRoutes(t,this.kWhPerKM),this.journeyRoutes.length>0&&(this.selectedJourneyRoute=this.journeyRoutes[0]),this.journeyManager.setRoutePolyline(this.routePolyline),this.mapping.renderPolyline(this.routePolyline),this.mapping.moveToMapBounds(s)}else this.logging.log("No route returned..");this.routeCalcInProgress=!1}))}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(h.v),i.Y36(a.z),i.Y36(u),i.Y36(s.i),i.Y36(i.sBO),i.Y36(d.JJ))},t.\u0275cmp=i.Xpm({type:t,selectors:[["route-planner"]],decls:24,vars:10,consts:[[1,"route"],[1,"route-places"],["name","map","slot","start"],[4,"ngIf"],[3,"click",4,"ngIf"],["primary",""],["slot","secondary"],["slot","primary"],[3,"placeChanged"],["placeSearchRouteStart",""],["placeSearchRouteDestination",""],["class","ion-padding",4,"ngIf"],["name","ionic","item-left",""],["placeholder","Starting Point",3,"ngModel","debounce","ngModelChange","ionInput","ionCancel"],[3,"click"],["name","pin","item-left",""],["placeholder","Destination",3,"ngModel","debounce","ngModelChange","ionInput","ionCancel"],["name","close","slot","start"],["name","cog","slot","end"],[1,"ion-padding"],["name","cog"],["position","stacked"],["min","1","max","200","step","5","snaps","true","pin","true","light","",3,"ngModel","ngModelChange"],["slot","start","small","","name","map"],["slot","end","large","","name","map"],["type","number","min","0.1","max","1",3,"ngModel","ngModelChange"]],template:function(t,e){1&t&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i.TgZ(2,"ion-list"),i.TgZ(3,"ion-list-header"),i._UZ(4,"ion-icon",2),i.TgZ(5,"ion-label"),i._uU(6,"Plan Your Journey"),i.qZA(),i.qZA(),i.YNc(7,m,3,2,"ion-item",3),i.YNc(8,g,4,1,"ion-item",4),i.YNc(9,y,3,2,"ion-item",3),i.YNc(10,_,4,1,"ion-item",4),i.qZA(),i.TgZ(11,"ion-toolbar",5),i.TgZ(12,"ion-buttons",6),i.YNc(13,v,3,0,"ion-button",4),i.qZA(),i.TgZ(14,"ion-buttons",7),i.YNc(15,x,3,0,"ion-button",4),i.YNc(16,b,3,0,"ion-button",4),i.qZA(),i.qZA(),i.qZA(),i.TgZ(17,"place-search",8,9),i.NdJ("placeChanged",function(t){return e.routeStartSelected(t)}),i.qZA(),i.TgZ(19,"place-search",8,10),i.NdJ("placeChanged",function(t){return e.routeDestinationSelected(t)}),i.qZA(),i.YNc(21,w,3,0,"p",11),i.YNc(22,T,5,9,"ion-list",3),i.YNc(23,A,15,3,"div",3),i.qZA()),2&t&&(i.xp6(7),i.Q6J("ngIf",null==e.routeStartPlace),i.xp6(1),i.Q6J("ngIf",null!=e.routeStartPlace),i.xp6(1),i.Q6J("ngIf",null==e.routeDestinationPlace),i.xp6(1),i.Q6J("ngIf",null!=e.routeDestinationPlace),i.xp6(3),i.Q6J("ngIf",e.isRouteSet),i.xp6(2),i.Q6J("ngIf",!e.advancedSettingsMode),i.xp6(1),i.Q6J("ngIf",e.advancedSettingsMode),i.xp6(5),i.Q6J("ngIf",e.routeCalcInProgress),i.xp6(1),i.Q6J("ngIf",null!=e.selectedJourneyRoute),i.xp6(1),i.Q6J("ngIf",e.advancedSettingsMode))},directives:[r.q_,r.yh,r.gu,r.Q$,d.O5,r.sr,r.Sm,p.v,r.Ie,r.VI,r.j9,f.JJ,f.On,r.YG,r.PQ,r.I_,r.QI,r.pK,r.as],pipes:[d.JJ],encapsulation:2}),t})(),C=(()=>{class t{constructor(t){this.modalController=t,this.hasNavbar=!1}close(){this.modalController.dismiss()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(r.IN))},t.\u0275cmp=i.Xpm({type:t,selectors:[["ng-component"]],decls:10,vars:0,consts:[["slot","end"],[3,"click"],["name","close","slot","end"],[1,"route-planner","ion-padding"]],template:function(t,e){1&t&&(i.TgZ(0,"ion-header"),i.TgZ(1,"ion-toolbar"),i.TgZ(2,"ion-title"),i._uU(3," Route Planner "),i.qZA(),i.TgZ(4,"ion-buttons",0),i.TgZ(5,"ion-button",1),i.NdJ("click",function(){return e.close()}),i._UZ(6,"ion-icon",2),i._uU(7," Close "),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i.TgZ(8,"ion-content",3),i._UZ(9,"route-planner"),i.qZA())},directives:[r.Gu,r.sr,r.wd,r.Sm,r.YG,r.gu,r.W2,S],encapsulation:2}),t})()},3947:function(t,e,n){"use strict";n.r(e),n.d(e,{SearchPageModule:function(){return U}});var i=n(8936),r=n(4516),o=n(8583),s=n(3679),a=n(2517),l=n(8093),c=n(8239),u=n(2340),h=n(2951),d=n(4207),p=n(6153),f=n(1820),m=n(4120),g=n(2206),y=n(6579),_=n(7689),v=n(3912),x=n(7919),b=n(9698),w=n(8118),T=n(2428),A=n(2759),S=n(7393),C=n(6465);const I=new(n(6102).v)(C.o);class E{constructor(t,e){this.dueTime=t,this.scheduler=e}call(t,e){return e.subscribe(new M(t,this.dueTime,this.scheduler))}}class M extends S.L{constructor(t,e,n){super(t),this.dueTime=e,this.scheduler=n,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(k,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:t}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}}clearDebounce(){const t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)}}function k(t){t.debouncedNext()}const P=(0,n(8384).fo)("Geolocation",{web:()=>n.e(3384).then(n.bind(n,3384)).then(t=>new t.GeolocationWeb)});var D=n(639),L=n(6260);function O(t,e){1&t&&D._UZ(0,"ion-icon",13)}function R(t,e){1&t&&D._UZ(0,"ion-spinner")}function z(t,e){if(1&t){const t=D.EpF();D.TgZ(0,"ion-button",3),D.NdJ("click",function(){return D.CHM(t),D.oxw().openSideView()}),D._UZ(1,"ion-icon",14),D.qZA()}}function Z(t,e){1&t&&(D.ynx(0),D.TgZ(1,"div",15),D.TgZ(2,"p"),D._uU(3,"There was a problem communicating with Open Charge Map. Please check your data connection."),D.qZA(),D.qZA(),D.BQk())}let F=(()=>{class t{constructor(t,e,n,i,r,o,s,a,l,c,d,p){this.appManager=t,this.nav=e,this.events=n,this.translate=i,this.platform=r,this.poiManager=o,this.mapping=s,this.journeyManager=a,this.zone=l,this.modalController=c,this.alertController=d,this.logging=p,this.mapDisplayed=!1,this.initialResultsShown=!1,this.searchOnDemand=!1,this.poiViewMode="modal",this.sideViewAvailable=!1,this.routePlanningMode=!0,this.searchKeyword="",this.appConfig=new h.X,this.defaultMapZoom=15,this.defaultStartPos=new m.wC(37.415328,-122.076575),this._watchId=null,this.mapCanvasID="map-canvas",this.mapping.setMapType(t.searchSettings.MapType),this.mapping.setMapAPI(u.N.defaultMapProvider),(0,A.R)(window,"resize").pipe(function(t,e=I){return n=>n.lift(new E(t,e))}(500)).subscribe(t=>{let e={width:y.c.getClientHeight(),height:y.c.getClientWidth()};this.events.publish("ocm:window:resized",[e])})}ionViewDidEnter(){this.logging.log("Entered search page.",_.i.VERBOSE),this.mapping.focusMap(),this.mapping.updateMapSize()}ionViewWillLeave(){this.logging.log("Leaving search page.",_.i.VERBOSE),this.mapping.unfocusMap()}getPreferredMapHeight(t){return null==t&&(t=y.c.getClientHeight()),t-56}enforceMapHeight(t){this.logging.log("Would resize map:"+t.width+" "+t.height,_.i.VERBOSE),this.checkViewportMode();const e=this.getPreferredMapHeight(t[0]);document.getElementById(this.mapCanvasID).offsetHeight!==e&&(document.getElementById(this.mapCanvasID).style.height=e+"px"),this.mapping&&(this.logging.log("Map height:"+e,_.i.VERBOSE),this.mapping.updateMapSize())}checkViewportMode(){}initialiseMapping(){var t=this;return(0,c.Z)(function*(){yield t.platform.ready(),t.debouncedRefreshMapResults=y.c.debounce(t.refreshMapResults,1e3,!1),t.events.subscribe("ocm:mapping:ready",(0,c.Z)(function*(){if(t.logging.log("init map: mapping ready"),t.mapping&&t.mapping.updateMapSize(),!t.initialResultsShown)if(t.appManager.searchSettings.StartSearchPosition)t.searchOnDemand=!0,t.mapping.updateMapCentrePos(t.appManager.searchSettings.StartSearchPosition.latitude,t.appManager.searchSettings.StartSearchPosition.longitude,!0,t.defaultMapZoom);else{let n=localStorage.getItem("_locationEnabled");1==t.appManager.isEmbeddedMode&&"true"!=n?yield(yield t.alertController.create({header:"Search using your location?",message:"Select OK to continue.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:(e=(0,c.Z)(function*(e){yield t.useFallbackPosition()}),function(t){return e.apply(this,arguments)})},{text:"OK",handler:function(){var e=(0,c.Z)(function*(){yield t.locateUser()});return function(){return e.apply(this,arguments)}}()}]})).present():(yield t.locateUser(),t.mapping&&t.mapping.updateMapSize())}var e})),t.events.subscribe("ocm:mapping:zoom",()=>{t.debouncedRefreshMapResults()}),t.events.subscribe("ocm:mapping:dragend",()=>{t.debouncedRefreshMapResults()}),t.events.subscribe("ocm:poiList:updated",e=>{t.showPOIListOnMap(e)}),t.events.subscribe("ocm:poiList:cleared",()=>{t.mapping.clearMarkers(),setTimeout(()=>{t.debouncedRefreshMapResults()},500)}),t.events.subscribe("ocm:window:resized",e=>{null!=e&&e.length>0&&t.enforceMapHeight(e[0])}),t.events.subscribe("ocm:poi:selected",e=>{if(e.poi)t.viewPOIDetails(e,e.poi);else{let n=t.getPOIByID(e.poiId);t.viewPOIDetails(e,n)}}),t.checkViewportMode(),t.mapping.initMap(t.mapCanvasID)})()}ngAfterViewInit(){var t=this;return(0,c.Z)(function*(){yield t.initialiseMapping()})()}ngOnInit(){var t=this;return(0,c.Z)(function*(){t.logging.log("Refreshing reference data ..",_.i.VERBOSE),(yield t.appManager.referenceDataManager.refreshReferenceData(t.appManager.api))||(t.appManager.isOffline=!0)})()}showPOIListOnMap(t){const e=this.getPreferredMapHeight(null);this.mapping.refreshMapView(e,this.poiManager.poiList,null),this.mapDisplayed||(this.mapDisplayed=!0)}getIconForPOI(t){return y.c.getIconForPOI(t)}getPOIByID(t){const e=this.poiManager.poiList;for(let n=0;n<e.length;n++)if(e[n].ID===t)return e[n];return null}refreshMapResults(){var t=this;return(0,c.Z)(function*(){if(!t.searchOnDemand)return void t.logging.log("Skipping refresh, search on demand disabled..",_.i.VERBOSE);t.logging.log("Refreshing Results..",_.i.VERBOSE);const e=new g.b;let n=null;if(t.appManager.searchSettings.StartSearchPosition&&(n=new m.jR(t.appManager.searchSettings.StartSearchPosition.latitude,t.appManager.searchSettings.StartSearchPosition.longitude),t.appManager.searchSettings.StartSearchPosition=null),n&&0==n.coords.latitude&&0==n.coords.longitude)return void t.logging.log("Map center is zero. No query will be performed",_.i.WARNING);if(null!=n)e.latitude=n.coords.latitude,e.longitude=n.coords.longitude,e.distance=25,e.boundingbox=null,t.appManager.searchSettings.LastSearchPosition=new m.wC(n.coords.latitude,n.coords.longitude);else{e.latitude=null,e.longitude=null;let n=yield t.mapping.getMapBounds().toPromise();e.boundingbox="("+n[0].latitude+","+n[0].longitude+"),("+n[1].latitude+","+n[1].longitude+")",t.logging.log(JSON.stringify(n),_.i.VERBOSE)}e.includeComments=!0,e.enableCaching=!0,null!=t.appManager.searchSettings&&(null!=t.appManager.searchSettings.ConnectionTypeList&&(e.connectionTypeIdList=t.appManager.searchSettings.ConnectionTypeList),null!=t.appManager.searchSettings.UsageTypeList&&(e.usageTypeIdList=t.appManager.searchSettings.UsageTypeList),null!=t.appManager.searchSettings.StatusTypeList&&(e.statusTypeIdList=t.appManager.searchSettings.StatusTypeList),null!=t.appManager.searchSettings.OperatorList&&(e.operatorIdList=t.appManager.searchSettings.OperatorList),null!=t.appManager.searchSettings.MinPowerKW&&t.appManager.searchSettings.MinPowerKW>0&&(e.minPowerKW=t.appManager.searchSettings.MinPowerKW),null!=t.appManager.searchSettings.MaxPowerKW&&t.appManager.searchSettings.MaxPowerKW>0&&(e.maxPowerKW=t.appManager.searchSettings.MaxPowerKW),null!=t.journeyManager.getRoutePolyline()&&(e.polyline=t.journeyManager.getRoutePolyline(),e.boundingbox=null,e.levelOfDetail=null,e.latitude=null,e.longitude=null)),t.appManager.isRequestInProgress=!0;let i=yield t.poiManager.refreshPOIList(e);t.appManager.isRequestInProgress=!1,t.initialResultsShown=!0,i>=e.maxResults&&t.appManager.showToastNotification("A maximum of "+i+" results are returned per search. Zoom in for details.")})()}viewPOIDetails(t,e){this.logging.log("Viewing/fetching ["+this.poiViewMode+"] POI Details "+t.poiId),null!=e?(this.mapping.unfocusMap(),this.modalController.create({component:f.H,componentProps:{item:e}}).then(t=>{t.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),t.present()})):this.poiManager.getPOIById(t.poiId,!0).then(t=>{this.logging.log("Got POI Details "+t.ID),"modal"===this.poiViewMode&&(this.searchOnDemand=!1,this.modalController.create({component:f.H,componentProps:{item:t}}).then(t=>{t.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),t.present()}),this.mapping.unfocusMap()),"side"===this.poiViewMode&&(this.selectedPOI=t)},t=>{this.appManager.showToastNotification("POI Details not available")})}closePOIDetails(){this.selectedPOI=null}openRoutePlannerModal(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:p.u}).then(t=>{t.onDidDismiss().then(t=>{this.logging.log("Dismissing Route Planner Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),t.present()})}openSearchOptions(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:d.N}).then(t=>{t.onDidDismiss().then(t=>{this.mapping.focusMap(),this.searchOnDemand=!0}),t.present()})}openSideView(){this.poiViewMode="side",this.mapping.updateMapSize()}closeSideView(){this.poiViewMode="modal",this.mapping.updateMapSize()}planRoute(){this.routePlanningMode=!0}search(t){this.placeSearchMapPOI.getPlacesAutoComplete(t,"poiSearch")}useFallbackPosition(){let t=this.defaultStartPos;null!=this.appManager.searchSettings.LastSearchPosition&&(t=this.appManager.searchSettings.LastSearchPosition),this.appManager.searchSettings.StartSearchPosition=t,this.appManager.searchSettings.LastSearchPosition=null,this.searchOnDemand=!0,this.mapping.updateMapCentrePos(t.latitude,t.longitude,!0,this.defaultMapZoom)}getPosition(t={}){var e=this;return(0,c.Z)(function*(){return new Promise((n,i)=>{e._watchId=P.watchPosition(t,(t,r)=>{P.clearWatch({id:e._watchId}),r?i(r):n(t)})})})()}locateUser(){var t=this;return(0,c.Z)(function*(){try{t.logging.log("Attempting to locate user..");const e=yield t.getPosition();if(!e)throw"Failed to get user location.";return t.logging.log("Got user location."),t.appManager.searchSettings.StartSearchPosition=new m.wC(e.coords.latitude,e.coords.longitude),t.searchOnDemand=!0,t.mapping.updateMapCentrePos(e.coords.latitude,e.coords.longitude,!0,t.defaultMapZoom),localStorage.setItem("_locationEnabled","true"),!0}catch(e){return t.logging.log("Failed to get user location. Searching using default or last position."+e),t.appManager.showToastNotification("Your location could not be determined."),t.useFallbackPosition(),!1}})()}placeSelected(t){this.searchKeyword=t.Address,this.logging.log("Got place details:"+t.Address),this.mapping.focusMap(),this.mapping.updateMapCentrePos(t.Location.latitude,t.Location.longitude,!0),this.debouncedRefreshMapResults()}}return t.\u0275fac=function(e){return new(e||t)(D.Y36(w.c),D.Y36(a.SH),D.Y36(L.z),D.Y36(r.sK),D.Y36(a.t4),D.Y36(b.R),D.Y36(x.v),D.Y36(v.i),D.Y36(D.R0b),D.Y36(a.IN),D.Y36(a.Br),D.Y36(_.z))},t.\u0275cmp=D.Xpm({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){if(1&t&&D.Gf(T.v,7),2&t){let t;D.iGM(t=D.CRH())&&(e.placeSearchMapPOI=t.first)}},decls:18,vars:10,consts:[["slot","start"],["autocapitalize","on","autocomplete","on",3,"ngModel","placeholder","debounce","ngModelChange","ionInput"],["slot","end"],[3,"click"],["name","locate","slot","start",4,"ngIf"],[4,"ngIf"],[3,"color","click"],["name","options","slot","end"],[3,"click",4,"ngIf"],[1,"search-page"],[3,"placeChanged"],["placeSearchMapPOI",""],["id","map-canvas",2,"height","100%","width","100%","min-height","300px"],["name","locate","slot","start"],["name","car","title","Route","slot","end"],[2,"position","absolute"]],template:function(t,e){1&t&&(D.TgZ(0,"ion-header"),D.TgZ(1,"ion-toolbar"),D.TgZ(2,"ion-buttons",0),D._UZ(3,"ion-menu-button"),D.qZA(),D.TgZ(4,"ion-searchbar",1),D.NdJ("ngModelChange",function(t){return e.searchKeyword=t})("ionInput",function(t){return e.search(t)}),D.ALo(5,"translate"),D.qZA(),D.TgZ(6,"ion-buttons",2),D.TgZ(7,"ion-button",3),D.NdJ("click",function(){return e.locateUser()}),D.YNc(8,O,1,0,"ion-icon",4),D.YNc(9,R,1,0,"ion-spinner",5),D.qZA(),D.TgZ(10,"ion-button",6),D.NdJ("click",function(){return e.openSearchOptions()}),D._UZ(11,"ion-icon",7),D.qZA(),D.YNc(12,z,2,0,"ion-button",8),D.qZA(),D.qZA(),D.qZA(),D.TgZ(13,"ion-content",9),D.TgZ(14,"place-search",10,11),D.NdJ("placeChanged",function(t){return e.placeSelected(t)}),D.qZA(),D.YNc(16,Z,4,0,"ng-container",5),D._UZ(17,"div",12),D.qZA()),2&t&&(D.xp6(4),D.Q6J("ngModel",e.searchKeyword)("placeholder",D.lcZ(5,8,"ocm.search.performSearch"))("debounce",500),D.xp6(4),D.Q6J("ngIf",!e.appManager.isRequestInProgress),D.xp6(1),D.Q6J("ngIf",e.appManager.isRequestInProgress),D.xp6(1),D.Q6J("color",e.appManager.searchSettings.HasActiveFilters?"danger":"default"),D.xp6(2),D.Q6J("ngIf",1==e.sideViewAvailable&&"modal"==e.poiViewMode),D.xp6(4),D.Q6J("ngIf",e.appManager.isOffline))},directives:[a.Gu,a.sr,a.Sm,a.fG,a.VI,a.j9,s.JJ,s.On,a.YG,o.O5,a.gu,a.W2,T.v,a.PQ],pipes:[r.X$],styles:[".search-page[_ngcontent-%COMP%]   #map-canvas[_ngcontent-%COMP%]{width:100%;height:98%}.search-page[_ngcontent-%COMP%]   #place-search[_ngcontent-%COMP%]{min-height:300px;background-color:#f0f0f0;position:absolute;z-index:100;width:100%}.search-page[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]{flex:.4}.search-page[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%], .search-page[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%], .search-page[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding:0}.search-page[_ngcontent-%COMP%]   scroll-content[_ngcontent-%COMP%]{overflow-y:hidden}.search-page[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]{padding-left:2em}.search-page[_ngcontent-%COMP%]   .sideview[_ngcontent-%COMP%]{background:#eeeeee;background:linear-gradient(to bottom,#eeeeee 0%,white 100%)}"]}),t})(),U=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=D.oAB({type:t}),t.\u0275inj=D.cJS({imports:[[o.ez,s.u5,a.Pc,r.aw,i.e,l.Bz.forChild([{path:"",component:F}])]]}),t})()},4207:function(t,e,n){"use strict";n.d(e,{N:function(){return A}});var i=n(8239),r=n(9698),o=n(8118),s=n(7627),a=n(6579),l=n(7919),c=n(639),u=n(2517),h=n(6260),d=n(8583),p=n(3679),f=n(4516);let m=(()=>{class t extends f.X${constructor(t,e){super(t,e)}transform(t,...e){let n=super.transform(t,...e);return n==t?null!=e&&e[0].default?e[0].default:e[0].Title?e[0].Title:n:n}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(f.sK,16),c.Y36(c.sBO,16))},t.\u0275pipe=c.Yjl({name:"nullableTranslate",type:t,pure:!0}),t.\u0275prov=c.Yz7({token:t,factory:t.\u0275fac}),t})();function g(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"p",21),c._UZ(1,"ion-icon",22),c._uU(2," One or more filters are currently being applied. "),c.TgZ(3,"ion-button",23),c.NdJ("click",function(){return c.CHM(t),c.oxw().clearFilters()}),c._UZ(4,"ion-icon",24),c.TgZ(5,"ion-label"),c._uU(6,"Clear"),c.qZA(),c.qZA(),c.qZA()}}function y(t,e){if(1&t&&(c.TgZ(0,"ion-select-option",26),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t.ID),c.xp6(1),c.Oqu(t.Title)}}function _(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"ion-item"),c.TgZ(1,"ion-label"),c._uU(2),c.ALo(3,"translate"),c.qZA(),c.TgZ(4,"ion-select",14),c.NdJ("ngModelChange",function(e){return c.CHM(t),c.oxw().searchSettings.FilterOptionsByCountryId=e})("ionChange",function(){return c.CHM(t),c.oxw().onCountryChange()}),c.TgZ(5,"ion-select",25),c._uU(6,"(All Countries)"),c.qZA(),c.YNc(7,y,2,2,"ion-select-option",4),c.qZA(),c.qZA()}if(2&t){const t=c.oxw();c.xp6(2),c.Oqu(c.lcZ(3,3,"ocm.search.countries")),c.xp6(2),c.Q6J("ngModel",t.searchSettings.FilterOptionsByCountryId),c.xp6(3),c.Q6J("ngForOf",t.countries)}}function v(t,e){if(1&t&&(c.TgZ(0,"ion-select-option",26),c._uU(1),c.ALo(2,"nullableTranslate"),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t.ID),c.xp6(1),c.Oqu(c.xi3(2,2,"ocm.reference.operatorInfo.value_"+t.ID,t))}}function x(t,e){if(1&t&&(c.TgZ(0,"ion-select-option",26),c._uU(1),c.ALo(2,"nullableTranslate"),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t.ID),c.xp6(1),c.Oqu(c.xi3(2,2,"ocm.reference.usageType.value_"+t.ID,t))}}function b(t,e){if(1&t&&(c.TgZ(0,"ion-select-option",26),c._uU(1),c.ALo(2,"nullableTranslate"),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t.ID),c.xp6(1),c.Oqu(c.xi3(2,2,"ocm.reference.statusType.value_"+t.ID,t))}}function w(t,e){if(1&t&&(c.TgZ(0,"ion-select-option",26),c._uU(1),c.ALo(2,"nullableTranslate"),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t.ID),c.xp6(1),c.Oqu(c.xi3(2,2,"ocm.reference.connectionType.value_"+t.ID,t))}}function T(t,e){if(1&t&&(c.TgZ(0,"ion-select-option",26),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t.code),c.xp6(1),c.Oqu(t.title)}}let A=(()=>{class t{constructor(t,e,n,i,r){this.appManager=t,this.poiManager=e,this.mapping=n,this.modalController=i,this.events=r,this.maxPower=s.U,this.powerRange={lower:0,upper:this.maxPower},this._languages=[],this.searchSettings=t.searchSettings}ngOnInit(){var t=this;return(0,i.Z)(function*(){null!=t.searchSettings.MinPowerKW&&(t.powerRange.lower=t.searchSettings.MinPowerKW),null!=t.searchSettings.MaxPowerKW&&(t.powerRange.upper=t.searchSettings.MaxPowerKW),0==t.powerRange.upper&&(t.powerRange.upper=t.maxPower),t.appManager.analytics.viewEvent("Settings"),t.useFilteredOptions&&(yield t.onCountryChange())})()}get useFilteredOptions(){return this.searchSettings.FilterOptionsByCountryId>0}clearFilters(){this.searchSettings.ClearActiveFilters(),this.powerRange={lower:0,upper:this.maxPower},this.searchSettings.CheckForActiveFilters()}get operators(){return this.appManager.referenceDataManager.getNetworkOperators(this.useFilteredOptions)}get connectionTypes(){return this.appManager.referenceDataManager.getConnectionTypes(this.useFilteredOptions)}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes(this.useFilteredOptions)}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes(this.useFilteredOptions)}get countries(){return this.appManager.referenceDataManager.getCountries(this.useFilteredOptions)}get isCountryFilterFeatureEnabled(){return a.c.isFeatureEnabled("FILTER_OPTIONS_BY_COUNTRY")}get languages(){return this._languages.length>0||(this._languages=this.appManager.getLanguages()),this._languages}ionViewWillLeave(){null!=this.searchSettings.Language&&this.appManager.setLanguage(this.searchSettings.Language),this.searchSettings.MinPowerKW=this.powerRange.lower,this.searchSettings.MaxPowerKW=this.powerRange.upper,1==this.searchSettings.MinPowerKW&&(this.searchSettings.MinPowerKW=null),this.searchSettings.MaxPowerKW==this.maxPower&&(this.searchSettings.MaxPowerKW=null),this.appManager.searchSettings=this.searchSettings,this.appManager.saveSearchSettings(),this.events.publish("ocm:poiList:cleared")}onLanguageChange(){null!=this.searchSettings.Language&&""!=this.searchSettings.Language&&this.appManager.setLanguage(this.searchSettings.Language)}onCountryChange(){var t=this;return(0,i.Z)(function*(){t.appManager.referenceDataManager.refreshFilteredReferenceData(t.appManager.api,{CountryIds:[t.searchSettings.FilterOptionsByCountryId]})})()}onMapTypeChange(){var t=this;return(0,i.Z)(function*(){t.mapping.setMapType(t.searchSettings.MapType)})()}close(){this.modalController.dismiss()}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(o.c),c.Y36(r.R),c.Y36(l.v),c.Y36(u.IN),c.Y36(h.z))},t.\u0275cmp=c.Xpm({type:t,selectors:[["ng-component"]],decls:77,vars:38,consts:[[1,"settings-page","ion-padding"],["danger","",4,"ngIf"],[4,"ngIf"],["multiple","true","cancelText","Cancel","okText","OK",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["lines","none"],["dualKnobs","true","min","0","max","650","pin","true",3,"ngModel","ngModelChange"],["slot","start","size","small","name","flash"],["slot","end","name","flash"],["slot","start",2,"padding-top","0"],["type","number","min","0",2,"width","3em","border","none",3,"ngModel","max","ngModelChange"],["slot","end",2,"padding-top","0"],["type","number",2,"width","3em","border","none",3,"ngModel","max","min","ngModelChange"],["multiple","false",3,"ngModel","ngModelChange","ionChange"],["multiple","false","cancelText","Cancel","okText","OK",3,"ngModel","ngModelChange","ionChange"],["value","ROADMAP"],["value","SATELLITE"],[3,"ngModel","ngModelChange"],["slot","end"],[3,"click"],["name","close","slot","start"],["danger",""],["name","alert"],["size","small","color","light",3,"click"],["slot","start","name","close"],["value",""],[3,"value"]],template:function(t,e){1&t&&(c.TgZ(0,"ion-header"),c.TgZ(1,"ion-toolbar"),c.TgZ(2,"ion-title"),c._uU(3),c.ALo(4,"translate"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(5,"ion-content",0),c.TgZ(6,"h2"),c._uU(7,"Search Filters"),c.qZA(),c.TgZ(8,"p"),c._uU(9,"Note: Filters will remove usable charging locations from your search results if we do not have complete data (i.e Operator or Power Levels)."),c.qZA(),c.YNc(10,g,7,0,"p",1),c.TgZ(11,"ion-list"),c.YNc(12,_,8,5,"ion-item",2),c.TgZ(13,"ion-item"),c.TgZ(14,"ion-label"),c._uU(15),c.ALo(16,"translate"),c.qZA(),c.TgZ(17,"ion-select",3),c.NdJ("ngModelChange",function(t){return e.searchSettings.OperatorList=t}),c.YNc(18,v,3,5,"ion-select-option",4),c.qZA(),c.qZA(),c.TgZ(19,"ion-item"),c.TgZ(20,"ion-label"),c._uU(21),c.ALo(22,"translate"),c.qZA(),c.TgZ(23,"ion-select",3),c.NdJ("ngModelChange",function(t){return e.searchSettings.UsageTypeList=t}),c.YNc(24,x,3,5,"ion-select-option",4),c.qZA(),c.qZA(),c.TgZ(25,"ion-item"),c.TgZ(26,"ion-label"),c._uU(27),c.ALo(28,"translate"),c.qZA(),c.TgZ(29,"ion-select",3),c.NdJ("ngModelChange",function(t){return e.searchSettings.StatusTypeList=t}),c.YNc(30,b,3,5,"ion-select-option",4),c.qZA(),c.qZA(),c.TgZ(31,"ion-item"),c.TgZ(32,"ion-label"),c._uU(33),c.ALo(34,"translate"),c.qZA(),c.TgZ(35,"ion-select",3),c.NdJ("ngModelChange",function(t){return e.searchSettings.ConnectionTypeList=t}),c.YNc(36,w,3,5,"ion-select-option",4),c.qZA(),c.qZA(),c.TgZ(37,"ion-item",5),c.TgZ(38,"ion-range",6),c.NdJ("ngModelChange",function(t){return e.powerRange=t}),c.TgZ(39,"ion-icon",7),c._uU(40,"0"),c.qZA(),c._UZ(41,"ion-icon",8),c.qZA(),c.qZA(),c.TgZ(42,"ion-item",5),c.TgZ(43,"ion-note",9),c._uU(44,"Min. Power (kW)"),c._UZ(45,"br"),c.TgZ(46,"input",10),c.NdJ("ngModelChange",function(t){return e.powerRange.lower=t}),c.qZA(),c.qZA(),c.TgZ(47,"ion-note",11),c._uU(48,"Max. Power (kW)"),c._UZ(49,"br"),c.TgZ(50,"input",12),c.NdJ("ngModelChange",function(t){return e.powerRange.upper=t}),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(51,"h2"),c._uU(52," General Settings "),c.qZA(),c.TgZ(53,"ion-item"),c.TgZ(54,"ion-label"),c._uU(55,"Language"),c.qZA(),c.TgZ(56,"ion-select",13),c.NdJ("ngModelChange",function(t){return e.searchSettings.Language=t})("ionChange",function(){return e.onLanguageChange()}),c.YNc(57,T,2,2,"ion-select-option",4),c.qZA(),c.qZA(),c.TgZ(58,"ion-item"),c.TgZ(59,"ion-label"),c._uU(60),c.ALo(61,"translate"),c.qZA(),c.TgZ(62,"ion-select",14),c.NdJ("ngModelChange",function(t){return e.searchSettings.MapType=t})("ionChange",function(){return e.onMapTypeChange()}),c.TgZ(63,"ion-select-option",15),c._uU(64,"Road Map"),c.qZA(),c.TgZ(65,"ion-select-option",16),c._uU(66,"Satellite"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(67,"ion-item"),c.TgZ(68,"ion-label"),c._uU(69,"Enable Advanced Editor Options"),c.qZA(),c.TgZ(70,"ion-toggle",17),c.NdJ("ngModelChange",function(t){return e.searchSettings.EnableAdvancedEditorFeatures=t}),c.qZA(),c.qZA(),c.qZA(),c.TgZ(71,"ion-footer"),c.TgZ(72,"ion-toolbar"),c.TgZ(73,"ion-buttons",18),c.TgZ(74,"ion-button",19),c.NdJ("click",function(){return e.close()}),c._UZ(75,"ion-icon",20),c._uU(76," Close "),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&t&&(c.xp6(3),c.hij(" ",c.lcZ(4,26,"ocm.general.settings")," "),c.xp6(7),c.Q6J("ngIf",1==e.searchSettings.HasActiveFilters),c.xp6(2),c.Q6J("ngIf",e.isCountryFilterFeatureEnabled),c.xp6(3),c.Oqu(c.lcZ(16,28,"ocm.search.networkOperators")),c.xp6(2),c.Q6J("ngModel",e.searchSettings.OperatorList),c.xp6(1),c.Q6J("ngForOf",e.operators),c.xp6(3),c.Oqu(c.lcZ(22,30,"ocm.search.usageTypes")),c.xp6(2),c.Q6J("ngModel",e.searchSettings.UsageTypeList),c.xp6(1),c.Q6J("ngForOf",e.usageTypes),c.xp6(3),c.Oqu(c.lcZ(28,32,"ocm.search.operationalStatusTypes")),c.xp6(2),c.Q6J("ngModel",e.searchSettings.StatusTypeList),c.xp6(1),c.Q6J("ngForOf",e.statusTypes),c.xp6(3),c.Oqu(c.lcZ(34,34,"ocm.search.connectionTypes")),c.xp6(2),c.Q6J("ngModel",e.searchSettings.ConnectionTypeList),c.xp6(1),c.Q6J("ngForOf",e.connectionTypes),c.xp6(2),c.Q6J("ngModel",e.powerRange),c.xp6(8),c.Q6J("ngModel",e.powerRange.lower)("max",e.powerRange.upper),c.xp6(4),c.Q6J("ngModel",e.powerRange.upper)("max",e.maxPower)("min",e.powerRange.lower),c.xp6(6),c.Q6J("ngModel",e.searchSettings.Language),c.xp6(1),c.Q6J("ngForOf",e.languages),c.xp6(3),c.Oqu(c.lcZ(61,36,"ocm.details.location.map")),c.xp6(2),c.Q6J("ngModel",e.searchSettings.MapType),c.xp6(8),c.Q6J("ngModel",e.searchSettings.EnableAdvancedEditorFeatures))},directives:[u.Gu,u.sr,u.wd,u.W2,d.O5,u.q_,u.Ie,u.Q$,u.t9,u.QI,p.JJ,p.On,d.sg,u.I_,u.gu,u.uN,p.qQ,p.wV,p.Fd,p.Fj,u.n0,u.ho,u.w,u.fr,u.Sm,u.YG],pipes:[f.X$,m],encapsulation:2}),t})()},6779:function(t,e,n){"use strict";n.r(e),n.d(e,{SignInModule:function(){return h}});var i=n(9492),r=n(8936),o=n(4516),s=n(8583),a=n(3679),l=n(2517),c=n(8093),u=n(639);let h=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[s.ez,a.u5,l.Pc,o.aw,r.e,c.Bz.forChild([{path:"",component:i.F}])]]}),t})()},9492:function(t,e,n){"use strict";n.d(e,{F:function(){return d}});var i=n(8239),r=n(7689),o=n(8118),s=n(639),a=n(2517),l=n(4516),c=n(8093),u=n(8583),h=n(3679);let d=(()=>{class t{constructor(t,e,n,i,r,o,s,a){this.appManager=t,this.modalController=e,this.translate=n,this.alertController=i,this.loadingController=r,this.logging=o,this.router=s,this.location=a,this.email=""}cancelSignIn(){this.modalController.dismiss()}performSignIn(){var t=this;return(0,i.Z)(function*(){const e=yield t.loadingController.create({message:"Signing In.."});yield e.present();let n=!1;try{yield t.appManager.api.performSignIn(t.email,t.password),e.dismiss(),localStorage.setItem("authResponse",JSON.stringify(t.appManager.api.authResponse)),t.appManager.isUserAuthenticated(!0),t.modalController.dismiss(),t.appManager.analytics.appEvent("Profile","SignedIn")}catch(i){n=!0,e.dismiss(),yield(yield t.alertController.create({header:"Open Charge Map",subHeader:"Email or Password not recognised",buttons:["Ok"]})).present(),t.logging.log("Error logging in:"+i)}})()}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(o.c),s.Y36(a.IN),s.Y36(l.sK),s.Y36(a.Br),s.Y36(a.HT),s.Y36(r.z),s.Y36(c.F0),s.Y36(u.Ye))},t.\u0275cmp=s.Xpm({type:t,selectors:[["ng-component"]],decls:37,vars:8,consts:[[1,"signin-page","ion-padding"],["item-left",""],["src","assets/images/icons/branding/AppIcon_128x128.png"],[1,"ion-padding"],["position","floating"],["type","text",3,"ngModel","ngModelChange"],["type","password",3,"ngModel","ngModelChange"],[3,"click"],["slot","secondary"],["name","close","slot","start"],["slot","primary"],["type","submit","color","primary",3,"click"],["name","log-in","slot","start"]],template:function(t,e){1&t&&(s.TgZ(0,"ion-header"),s.TgZ(1,"ion-toolbar"),s.TgZ(2,"ion-title"),s._uU(3),s.ALo(4,"translate"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(5,"ion-content",0),s.TgZ(6,"ion-avatar",1),s._UZ(7,"img",2),s.qZA(),s.TgZ(8,"p",3),s._uU(9," Sign in using your Open Charge Map account. "),s.qZA(),s.TgZ(10,"ion-list"),s.TgZ(11,"ion-item"),s.TgZ(12,"ion-label",4),s._uU(13,"Email"),s.qZA(),s.TgZ(14,"ion-input",5),s.NdJ("ngModelChange",function(t){return e.email=t}),s.qZA(),s.qZA(),s.TgZ(15,"ion-item"),s.TgZ(16,"ion-label",4),s._uU(17,"Password"),s.qZA(),s.TgZ(18,"ion-input",6),s.NdJ("ngModelChange",function(t){return e.password=t}),s.qZA(),s.qZA(),s.qZA(),s.TgZ(19,"p"),s._uU(20,"or "),s.TgZ(21,"a",7),s.NdJ("click",function(){return e.appManager.launchWebPage("https://openchargemap.org/site/loginprovider/register")}),s._uU(22,"Register as New User"),s.qZA(),s._uU(23," or "),s.TgZ(24,"a",7),s.NdJ("click",function(){return e.appManager.launchWebPage("https://openchargemap.org/site/loginprovider/passwordreset")}),s._uU(25,"Reset your password"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(26,"ion-footer"),s.TgZ(27,"ion-toolbar"),s.TgZ(28,"ion-buttons",8),s.TgZ(29,"ion-button",7),s.NdJ("click",function(){return e.cancelSignIn()}),s._UZ(30,"ion-icon",9),s._uU(31," Cancel"),s.qZA(),s.qZA(),s.TgZ(32,"ion-buttons",10),s.TgZ(33,"ion-button",11),s.NdJ("click",function(){return e.performSignIn()}),s._UZ(34,"ion-icon",12),s._uU(35),s.ALo(36,"translate"),s.qZA(),s.qZA(),s.qZA(),s.qZA()),2&t&&(s.xp6(3),s.hij(" ",s.lcZ(4,4,"ocm.general.signIn")," "),s.xp6(11),s.Q6J("ngModel",e.email),s.xp6(4),s.Q6J("ngModel",e.password),s.xp6(17),s.hij(" ",s.lcZ(36,6,"ocm.general.signIn"),""))},directives:[a.Gu,a.sr,a.wd,a.W2,a.BJ,a.q_,a.Ie,a.Q$,a.pK,a.j9,h.JJ,h.On,a.fr,a.Sm,a.YG,a.gu],pipes:[l.X$],encapsulation:2}),t})()},7814:function(t,e,n){"use strict";n.d(e,{l:function(){return u}});var i=n(8239),r=n(7689),o=n(6799),s=n(8649),a=n(1841),l=n(2340),c=n(639);let u=(()=>{class t{constructor(t,e,n){this.http=t,this.refData=e,this.logging=n,this.serviceBase="https://api.openchargemap.io",this.serviceBaseURL=this.serviceBase+"/v3",this.hasAuthorizationError=!1,this.ATTRIBUTION_METADATAFIELDID=4,this.clientName="ocm.api.default",this.allowMirror=!1,this.lastPOIApiCallURL="",this.serviceBaseURL=l.N.apiBase+"/v3"}getNumberListString(t){let e="";for(let n=0;n<t.length;n++)e+=t[n],n<t.length&&(e+=",");return e}fetchPOIListByParam(t){var e=this;return(0,i.Z)(function*(){const n=e.serviceBaseURL+"/poi/?client="+e.clientName+(e.allowMirror?" &allowmirror=true":"")+"&verbose=false&output=json";t.compact=!0;let i="";null!=t.countryCode&&(i+="&countrycode="+t.countryCode),null!=t.latitude&&(i+="&latitude="+t.latitude),null!=t.longitude&&(i+="&longitude="+t.longitude),null!=t.distance&&(i+="&distance="+t.distance),null!=t.distanceUnit&&(i+="&distanceunit="+t.distanceUnit),null!=t.includeComments&&(i+="&includecomments="+t.includeComments),null!=t.maxResults&&(i+="&maxresults="+t.maxResults),null!=t.countryIdList&&(i+="&countryid="+e.getNumberListString(t.countryIdList)),null!=t.levelIdList&&(i+="&levelid="+e.getNumberListString(t.levelIdList)),null!=t.connectionTypeIdList&&t.connectionTypeIdList.length>0&&(i+="&connectiontypeid="+e.getNumberListString(t.connectionTypeIdList)),null!=t.operatorIdList&&t.operatorIdList.length>0&&(i+="&operatorid="+e.getNumberListString(t.operatorIdList)),null!=t.usageTypeIdList&&t.usageTypeIdList.length>0&&(i+="&usagetypeid="+e.getNumberListString(t.usageTypeIdList)),null!=t.statusTypeIdList&&t.statusTypeIdList.length>0&&(i+="&statustypeid="+e.getNumberListString(t.statusTypeIdList)),null!=t.locationTitle&&(i+="&locationtitle="+t.locationTitle),null!=t.minPowerKW&&t.minPowerKW>0&&(i+="&minpowerkw="+t.minPowerKW),null!=t.maxPowerKW&&t.maxPowerKW>0&&(i+="&maxpowerkw="+t.maxPowerKW),null!=t.submissionStatusTypeIdList&&(i+="&submissionstatustypeid="+e.getNumberListString(t.submissionStatusTypeIdList)),null!=t.poiIdList&&t.poiIdList.length>0&&(i+="&chargepointid="+e.getNumberListString(t.poiIdList)),0==t.enableCaching&&(i+="&enablecaching=false"),null!=t.compact&&(i+="&compact="+t.compact),t.levelOfDetail>1&&(i+="&levelofdetail="+t.levelOfDetail),null!=t.polyline&&(i+="&polyline="+t.polyline),null!=t.boundingbox&&(i+="&boundingbox="+t.boundingbox),null!=t.additionalParams&&(i+="&"+t.additionalParams);const o=n+i;if(e.lastPOIApiCallURL===o&&0!=t.enableCaching)return e.logging.log("Skipped API call due to same query being repeated."),[];e.lastPOIApiCallURL=o,e.logging.log("API Call:"+o,r.i.VERBOSE);try{let t=yield e.http.get(o,e.getHttpRequestOptions()).toPromise();return e.refData.hydrateCompactPOIList(t)}catch(s){const t=s.message||"Could not fetch POI list from server.";throw e.logging.log("API Client: "+JSON.stringify(s),r.i.ERROR),t}})()}getHttpRequestOptions(t=!0){let e=new a.WM;return t&&(e=e.append("Content-Type","application/json")),this.authResponse&&this.authResponse.Data&&this.authResponse.Data.access_token&&(e=e.append("Authorization","Bearer "+this.authResponse.Data.access_token)),e=e.append("X-API-Key",l.N.apiKey),{headers:e}}fetchCoreReferenceData(t){let e=this.serviceBaseURL+"/referencedata/?client="+this.clientName+"&output=json"+(this.allowMirror?"&allowmirror=true":"")+"&verbose=false&compact=true";return null!=t&&null!=t.CountryIds&&(e+="&countryid="+this.getNumberListString(t.CountryIds)),this.logging.log("API Call:"+e,r.i.VERBOSE),this.http.get(e,this.getHttpRequestOptions())}performSignIn(t,e){return this.http.post(this.serviceBaseURL+"/profile/authenticate/",JSON.stringify({emailaddress:t,password:e}),this.getHttpRequestOptions()).toPromise().then(t=>(this.authResponse=t,this.authResponse))}performSubmission(t,e){return t===s.q.POI?this.submitPOI(e):t===s.q.Comment?this.submitUserComment(e):t===s.q.Media?this.submitMediaItem(e):void 0}submitUserComment(t){const e=JSON.stringify(t);return this.logging.log("[api] Submitting user comment"),this.http.post(this.serviceBaseURL+"/comment/",e,this.getHttpRequestOptions()).toPromise()}submitMediaItem(t){const e=JSON.stringify(t);return this.http.post(this.serviceBaseURL+"/mediaitem/",e,this.getHttpRequestOptions()).toPromise()}submitPOI(t){const e=JSON.stringify(t);return this.http.post(this.serviceBaseURL+"/poi/",e,this.getHttpRequestOptions()).toPromise()}getPanoramioLocationPhotos(t){return new Promise(e=>{const n=.001,i="https://www.panoramio.com/map/get_panoramas.php?set=public&from=0&to=2&minx="+(t.longitude-n)+"&miny="+(t.latitude-n)+"&maxx="+(t.longitude+n)+"maxy="+(t.latitude+n)+"&size=medium&mapfilter=true&callback=?";return console.log(i),this.http.get(i).toPromise()})}fetchReverseGeocodeResult(t,e){return this.http.get(this.serviceBaseURL+"/geocode/?client="+this.clientName+"&output=json&camelcase=false&latitude="+t+"&longitude="+e,this.getHttpRequestOptions()).toPromise()}isLocalStorageAvailable(){return void 0!==window.localStorage}setCachedDataObject(t,e){this.isLocalStorageAvailable()&&(void 0===e&&(e=null),null===e?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(e)))}getCachedDataObject(t){if(this.isLocalStorageAvailable()){const e=localStorage.getItem(t);if(null!=e&&e.length>0)return JSON.parse(e)}return null}}return t.\u0275fac=function(e){return new(e||t)(c.LFG(a.eN),c.LFG(o.W),c.LFG(r.z))},t.\u0275prov=c.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},56:function(t,e,n){"use strict";n.d(e,{c:function(){return a}});var i=n(8239),r=n(7689),o=n(639),s=n(2517);let a=(()=>{class t{constructor(t,e){this.logger=t,this.platform=e,this.isCordova=!1,this.ga=null,this.isCordova=!(!e.is("cordova")&&!e.is("capacitor"))}init(t){var e=this;return(0,i.Z)(function*(){e.isCordova&&e.ga?yield e.ga.startTrackerWithId(t):e.logger.log("Could not initialise analytics")})()}setAppVersion(t){var e=this;return(0,i.Z)(function*(){if(e.isCordova&&e.ga)return e.ga.setAppVersion(t);e.logger.log(t)})()}appEvent(t,e){var n=this;return(0,i.Z)(function*(){if(n.isCordova&&n.ga)return n.ga.trackEvent(t,e);n.logger.log(e)})()}viewEvent(t){var e=this;return(0,i.Z)(function*(){if(e.isCordova&&e.ga)return e.ga.trackView(t);e.logger.log(t)})()}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(r.z),o.LFG(s.t4))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},8118:function(t,e,n){"use strict";n.d(e,{c:function(){return b}});var i=n(8239),r=n(7689),o=n(7814),s=n(7627),a=n(4120),l=n(8649),c=n(6799),u=n(3912),h=n(56),d=n(2340),p=n(639),f=n(1841),m=n(6260);class g{constructor(t,e){this.SubmissionType=t,this.Data=e,this.DateQueued=new Date,this.IsSubmitted=!1,this.IsInProgress=!1,this.IsCancelled=!1,this.IsFailure=!1,this.Attempts=0,this.ID=new Date+"_"+100*Math.random()}}let y=(()=>{class t{constructor(t){this.events=t,this.isQueueProcessing=!1}setAppManager(t){this.appManager=t}add(t,e){let n=this.getQueueItems();n.push(new g(t,e)),this.saveQueueItems(n)}update(t){let e=this.getQueueItems(),n=new Array;return e.forEach(e=>{n.push(e.ID==t.ID?t:e)}),n}processNextQueueItem(){let t=this.getNextQueueItem();null!=t&&null!=this.appManager&&this.appManager.api.performSubmission(t.SubmissionType,t.Data).then(()=>{t.IsSubmitted=!0,t.Attempts++,this.update(t),this.clear()})}getNextQueueItem(){let t=this.getQueueItems(),e=null;return t.forEach(t=>{null==e&&!t.IsCancelled&&!t.IsInProgress&&!t.IsSubmitted&&(e=t)}),e}hasPendingItems(){let t=!1;return this.getQueueItems().forEach(e=>{!e.IsFailure&&!e.IsCancelled&&!e.IsSubmitted&&(t=!0)}),t}isCompleted(){let t=this.getQueueItems(),e=!0;return t.forEach(t=>{(t.IsInProgress||t.IsFailure)&&(e=!1)}),e}clear(t=!1){let e=this.getQueueItems(),n=new Array;t||e.forEach(t=>{(t.IsInProgress||t.IsFailure)&&n.push(t)}),this.saveQueueItems(n)}saveQueueItems(t){localStorage.setItem("submissionQueue",JSON.stringify(t))}getQueueItems(){let t=localStorage.getItem("submissionQueue");return null!=t?JSON.parse(t):new Array}}return t.\u0275fac=function(e){return new(e||t)(p.LFG(m.z))},t.\u0275prov=p.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var _=n(2517),v=n(4516),x=n(6686);let b=(()=>{class t{constructor(t,e,n,i,r,o,a,l,c,u,h,p,f){this.http=t,this.events=e,this.api=n,this.submissionQueue=i,this.platform=r,this.referenceDataManager=o,this.journeyManager=a,this.translateService=l,this.toastController=c,this.loadingController=u,this.jwtHelper=h,this.logging=p,this.analytics=f,this.isRequestInProgress=!1,this.title="Open Charge Map",this._isUserAuthenticated=null,this.isEmbeddedMode=!1,this.isOffline=!1,this.api.clientName="ocm.app.ionic."+d.N.version,this.isDebugMode=!1,this.enableSubmissionQueue=!1,this.submissionQueue.setAppManager(this),this.platformMode=r.is("cordova")?"cordova":"web",this.initAppManager(),this.searchSettings=new s.N,this.loadSearchSettings(),this.applyURLQueryStringOptions(),this.searchSettings.CheckForActiveFilters(),this.journeyManager.loadJourneys()}loadSearchSettings(){if(null!=localStorage.getItem("searchSettings")){this.searchSettings=new s.N;try{let t=JSON.parse(localStorage.getItem("searchSettings"));Object.assign(this.searchSettings,t)}catch(t){}}}savePushRegistration(t){localStorage.setItem("_pushToken",t.toString())}getPushRegistration(){localStorage.getItem("_pushToken")}getQueryVariable(t){let e=window.location.search.substring(1).split("&");for(let n=0;n<e.length;n++){let i=e[n].split("=");if(decodeURIComponent(i[0])==t)return i[1].split(",").map(t=>decodeURIComponent(t))}return null}applyURLQueryStringOptions(){if(this.getQueryVariable("mode")&&"embedded"==this.getQueryVariable("mode")[0]&&(this.isEmbeddedMode=!0),this.getQueryVariable("operatorid")){let t=this.getQueryVariable("operatorid");for(let e of t)this.searchSettings.OperatorList.unshift(parseInt(e,10))}if(this.getQueryVariable("latitude")&&this.getQueryVariable("longitude")){let t=this.getQueryVariable("latitude")[0],e=this.getQueryVariable("longitude")[0];this.searchSettings.StartSearchPosition=new a.wC(parseFloat(t),parseFloat(e))}this.getQueryVariable("title")&&(this.title=this.getQueryVariable("title")[0])}saveSearchSettings(){this.searchSettings.CheckForActiveFilters(),localStorage.setItem("searchSettings",JSON.stringify(this.searchSettings))}getLanguages(){return[{code:"ar",title:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629 / Arabic"},{code:"bg",title:"Bulgarian / \u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438"},{code:"cs",title:"Czech / \u010ce\u0161tina"},{code:"de",title:"German / Deutsch"},{code:"el",title:"Greek / \u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ae"},{code:"en",title:"English"},{code:"es",title:"Spanish / Espa\xf1ol"},{code:"et",title:"Estonian / Eesti"},{code:"fi",title:"Finnish / Suomi"},{code:"fr",title:"French / Fran\xe7ais"},{code:"fy",title:"West Frisian / Frysk"},{code:"hu",title:"Hungarian / Magyar"},{code:"it",title:"Italian / Italiano"},{code:"ja",title:"Japanese / \u65e5\u672c\u8a9e"},{code:"lt",title:"Lithuanian / Lietuvi\u0173"},{code:"nl",title:"Dutch / Nederlands"},{code:"pt",title:"Portuguese / portugu\xeas"},{code:"ru",title:"Russian / P\u0443\u0441\u0441\u043a\u0438\u0439"},{code:"sk",title:"Slovak / Sloven\u010dina"},{code:"tr",title:"Turkish / T\xfcrk\xe7e"},{code:"zh",title:"Chinese / \u4e2d\u56fd\u7684"}]}setLanguage(t){(null==t||""==t)&&(t="en"),this.logging.log("Changing language: "+t),this.translateService.use(t)}initAppManager(){this.initAuthFromStorage(),this.isUserAuthenticated(!0)&&this.enableSubmissionQueue&&null!=this.submissionQueue&&this.submissionQueue.hasPendingItems()&&this.submissionQueue.processNextQueueItem()}initAuthFromStorage(){let t=localStorage.getItem("authResponse");if(null!=t){let e=JSON.parse(t);null!=e.Data&&null!=e.Data.access_token&&(this.jwtHelper.decodeToken(e.Data.access_token),this.jwtHelper.isTokenExpired(e.Data.access_token)?localStorage.removeItem("authResponse"):(this.api.authResponse=e,this.logging.log("User has valid auth token in local storage",r.i.VERBOSE)))}}isUserAuthenticated(t=!1){return!1===t&&null!=this._isUserAuthenticated||(this._isUserAuthenticated=!1,null!=this.api.authResponse&&(this.jwtHelper.isTokenExpired(this.api.authResponse.Data.access_token)||(this._isUserAuthenticated=!0))),this._isUserAuthenticated}getCurrentAuthToken(){return null!=this.api.authResponse?this.api.authResponse.Data.access_token:null}getUserProfile(){return null!=this.api.authResponse?this.api.authResponse.Data.UserProfile:null}signOutCurrentUser(){localStorage.removeItem("authResponse"),this.api.authResponse=null,this._isUserAuthenticated=!1}submitComment(t){if(!this.enableSubmissionQueue)return this.api.performSubmission(l.q.Comment,t);this.submissionQueue.add(l.q.Comment,t),this.submissionQueue.processNextQueueItem()}submitMediaItem(t){if(!this.enableSubmissionQueue)return this.api.performSubmission(l.q.Media,t);this.submissionQueue.add(l.q.Media,t),this.submissionQueue.processNextQueueItem()}submitPOI(t){if(!this.enableSubmissionQueue)return this.api.performSubmission(l.q.POI,t);this.submissionQueue.add(l.q.POI,t),this.submissionQueue.processNextQueueItem()}showToastNotification(t){var e=this;return(0,i.Z)(function*(){yield(yield e.toastController.create({message:t,duration:3e3})).present()})()}showLoadingProgress(t){var e=this;return(0,i.Z)(function*(){yield(yield e.loadingController.create({message:t})).present()})()}dismissLoadingProgress(){var t=this;return(0,i.Z)(function*(){return t.loadingController.dismiss()})()}launchOCMWebPage(t){this.isUserAuthenticated(!0)&&(-1===t.indexOf("?")&&(t+="?"),t+="&auth="+this.getCurrentAuthToken()),t="https://openchargemap.org/site"+t,window.open(t,"_system")}launchWebPage(t){window.open(t,"_system")}isPlatform(t){return this.platform.is(t)}}return t.\u0275fac=function(e){return new(e||t)(p.LFG(f.eN),p.LFG(m.z),p.LFG(o.l),p.LFG(y),p.LFG(_.t4),p.LFG(c.W),p.LFG(u.i),p.LFG(v.sK),p.LFG(_.yF),p.LFG(_.HT),p.LFG(x.N0),p.LFG(r.z),p.LFG(h.c))},t.\u0275prov=p.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},6260:function(t,e,n){"use strict";n.d(e,{z:function(){return r}});var i=n(639);let r=(()=>{class t{constructor(){this.c=new Map}subscribe(t,...e){let n=this.c.get(t);n||this.c.set(t,n=[]),n.push(...e)}unsubscribe(t,e){if(!e)return this.c.delete(t);const n=this.c.get(t);if(!n)return!1;const i=n.indexOf(e);return!(i<0||(n.splice(i,1),0===n.length&&this.c.delete(t),0))}publish(t,...e){const n=this.c.get(t);return n?n.map(t=>{try{return t(...e)}catch(n){return console.error(n),null}}):null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},3912:function(t,e,n){"use strict";n.d(e,{i:function(){return u}});var i=n(7689),r=n(7814),o=n(9698),s=n(2206),a=n(1122),l=n(4120),c=n(639);let u=(()=>{class t{constructor(t,e,n){this.api=t,this.poiManager=e,this.logging=n,this.journeys=[],this.favourites=[]}loadJourneys(){let t=localStorage.getItem("journeys");if(null!=t&&(this.journeys=JSON.parse(t)),null!=this.journeys)for(let e of this.journeys)this.fetchAllJourneyPOIDetails(e)}fetchAllJourneyPOIDetails(t){this.logging.log("Journeys - fetching poi details for Journey "+t.Title);let e=new s.b;e.poiIdList=[];for(let n of t.Stages)for(let t of n.WayPoints)for(let n of t.PoiIDs)e.poiIdList.push(n);this.api.fetchPOIListByParam(e).then(t=>{for(let e of t)this.updateStoredPOI(e)})}updateStoredPOI(t){if(this.journeys.forEach(e=>{e.Stages.forEach(e=>{e.WayPoints.forEach(e=>{e.PoiIDs.forEach(n=>{if(n==t.ID)if(null==e.PoiList){e.PoiList=[];let n=new a.Qp("charging",1);n.Poi=t,n.PoiID=t.ID,e.PoiList.push(n)}else for(let i of e.PoiList)i.PoiID==t.ID&&(i.Poi=t)})})})}),null!=this.favourites)for(let e of this.favourites)"charging"==e.Type&&e.PoiID==t.ID&&(e.Poi=t)}saveJourneys(){let t=JSON.parse(JSON.stringify(this.journeys));for(let n of t)for(const t of n.Stages)for(let e of t.WayPoints)for(let t of e.PoiList)t.Poi=null,t.Photos=null;const e=JSON.stringify(t);localStorage.setItem("journeys",e)}addJourney(t,e){let n=new a.vw;n.Title="Stage 1",null!=e&&n.WayPoints.push(e),t.Stages.push(n),this.journeys.push(t)}deleteJourney(t){this.journeys=this.journeys.filter(e=>e.ID!=t),this.saveJourneys()}getJourney(t){let e=this.journeys.filter(e=>e.ID==t);return e.length>0?e[0]:null}getJourneyStages(t){return this.getJourney(t).Stages}addJourneyWaypoint(t,e,n){let i=this.getJourney(t);if(null==e){let t=new a.vw;t.Title="Stage "+(i.Stages.length+1),t.WayPoints.push(n),i.Stages.push(t)}else{let t=i.Stages[e];null==t.WayPoints&&(t.WayPoints=[]),t.WayPoints.push(n)}}addJourneyStage(t,e){return this.getJourney(t).Stages.push(e)-1}setupTestJourneys(){this.journeys=[];let t=new a.fw;t.Title="New York to Brooklyn",t.Notes="A little jaunt to Brooklyn",t.Stages=[];let e=new a.vw,n=new a.kA;n.Notes="Starting point",n.Position=new l.wC(40,1.2),n.Title="Start",e.WayPoints.push(n);let i=new a.kA;i.Notes="Middle point",i.Position=new l.wC(40,1.33),i.Title="Middle",e.WayPoints.push(i);let r=new a.kA;r.Notes="End point",r.Position=new l.wC(40,1.33),r.Title="End",e.WayPoints.push(r),t.Stages.push(e),this.journeys.push(t);let o=new a.fw;o.Title="Aberdeen to London",o.Notes="Roadtrip",o.Stages=[],this.journeys.push(o)}calculateEnergyConsumptionkWh(t,e,n=0,i){return t*i}setRoutePolyline(t){this.routePolyline=t}getRoutePolyline(){return this.routePolyline}}return t.\u0275fac=function(e){return new(e||t)(c.LFG(r.l),c.LFG(o.R),c.LFG(i.z))},t.\u0275prov=c.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},7689:function(t,e,n){"use strict";n.d(e,{i:function(){return o},z:function(){return s}});var i=n(2340),r=n(639),o=(()=>{return(t=o||(o={}))[t.VERBOSE=0]="VERBOSE",t[t.INFO=1]="INFO",t[t.WARNING=2]="WARNING",t[t.ERROR=3]="ERROR",o;var t})();let s=(()=>{class t{constructor(){this.logLevel=o.VERBOSE,i.N.production&&(this.logLevel=o.INFO)}log(t,e=o.VERBOSE){console&&console.log&&e>=this.logLevel&&console.log("["+o[e]+"] {"+(new Date).toLocaleTimeString()+"} "+t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},9698:function(t,e,n){"use strict";n.d(e,{R:function(){return c}});var i=n(8239),r=n(7689),o=n(7814),s=n(56),a=n(639),l=n(6260);let c=(()=>{class t{constructor(t,e,n,i){this.api=t,this.events=e,this.logging=n,this.analytics=i,this.isRequestInProgress=!1}refreshPOIList(t){var e=this;return(0,i.Z)(function*(){try{return e.poiList=yield e.fetchPOIList(t),e.events.publish("ocm:poiList:updated"),e.analytics.appEvent("Search","Fetched Results"),e.poiList.length}catch(n){return 0}})()}fetchPOIList(t){var e=this;return(0,i.Z)(function*(){e.isRequestInProgress=!0;try{let n=yield e.api.fetchPOIListByParam(t);return e.isRequestInProgress=!1,n&&n.length&&e.logging.log("fetched POI list ["+n.length+"]"),n}catch(n){return e.isRequestInProgress=!1,[]}})()}clearResults(){this.poiList=[],this.events.publish("ocm:poiList:cleared"),this.logging.log("clearing results after settings change",r.i.VERBOSE)}getPOIById(t,e=!1,n=!1){var r=this;return(0,i.Z)(function*(){if(!n&&null!=r.poiList){const e=r.poiList.find(e=>e.ID==t);if(e)return e}const e={poiIdList:[t],enableCaching:!n,includeComments:!0},i=yield r.api.fetchPOIListByParam(e);return i&&i.length>0?(r.poiList&&i[0].ID==t&&(r.poiList=r.poiList.filter(e=>e.ID!=t),r.poiList.push(i[0]),r.logging.log("POI refreshed in cache "+t)),i[0]):null})()}}return t.\u0275fac=function(e){return new(e||t)(a.LFG(o.l),a.LFG(l.z),a.LFG(r.z),a.LFG(s.c))},t.\u0275prov=a.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},6799:function(t,e,n){"use strict";n.d(e,{W:function(){return a}});var i=n(8239),r=n(7689),o=n(639),s=n(1841);let a=(()=>{class t{constructor(t,e){this.http=t,this.logging=e,this.loadCachedRefData()}refreshReferenceData(t){var e=this;return(0,i.Z)(function*(){try{const n=yield t.fetchCoreReferenceData(null).toPromise();return e.setCoreReferenceData(n),e.setFilteredReferenceData(n),e.logging.log("Got refreshed core ref data.",r.i.VERBOSE),e.sortCoreReferenceData(),e.cacheCurrentRefData(),!0}catch(n){return e.logging.log("Error fetching core ref data:"+n),!1}})()}refreshFilteredReferenceData(t,e){t.fetchCoreReferenceData(e).subscribe(t=>{this.setFilteredReferenceData(t),this.sortCoreReferenceData(),this.logging.log("Got refreshed filtered reference data.",r.i.VERBOSE)},t=>{this.logging.log("Error fetching filtered reference data:"+t)})}setCoreReferenceData(t){this.referenceData=t}setFilteredReferenceData(t){this.filteredReferenceData=t}referenceDataLoaded(){return null!=this.referenceData}getCountries(t=!1){return 1==t?this.filteredReferenceData.Countries:this.referenceData.Countries}getCountryByID(t){return this.getRefDataByID(this.referenceData.Countries,t)}getConnectionTypes(t=!1){return 1==t?this.filteredReferenceData.ConnectionTypes:this.referenceData.ConnectionTypes}getConnectionTypeByID(t){return this.getRefDataByID(this.referenceData.ConnectionTypes,t)}getUsageTypes(t=!1){return 1==t?this.filteredReferenceData.UsageTypes:this.referenceData.UsageTypes.filter(t=>t.ID>0)}getUsageTypeByID(t){return this.getRefDataByID(this.referenceData.UsageTypes,t)}getStatusTypes(t=!1){return 1==t?this.filteredReferenceData.StatusTypes:this.referenceData.StatusTypes.filter(t=>t.ID>0)}getStatusTypeByID(t){return this.getRefDataByID(this.referenceData.StatusTypes,t)}getNetworkOperators(t=!1){return 1==t?this.filteredReferenceData.Operators:this.referenceData.Operators}getNetworkOperatorByID(t){return this.getRefDataByID(this.referenceData.Operators,t)}getDataProviders(t=!1){return 1==t?this.filteredReferenceData.DataProviders:this.referenceData.DataProviders}getDataProviderByID(t){return this.getRefDataByID(this.referenceData.DataProviders,t)}getCheckinStatusTypes(t=!1,e=!0){let n=null;return n=1==t?this.filteredReferenceData.CheckinStatusTypes:this.referenceData.CheckinStatusTypes,e&&(n=n.filter(t=>!1===t.IsAutomatedCheckin)),n}getCheckinStatusTypeByID(t){return this.getRefDataByID(this.referenceData.CheckinStatusTypes,t)}getCommentTypes(t=!1,e=!0){let n;return n=1==t?this.filteredReferenceData.UserCommentTypes:this.referenceData.UserCommentTypes,e&&(n=n.filter(t=>100!==t.ID&&110!==t.ID)),n}getCommentTypeByID(t){return this.getRefDataByID(this.referenceData.UserCommentTypes,t)}getSubmissionStatusTypes(t=!1){return 1==t?this.filteredReferenceData.SubmissionStatusTypes:this.referenceData.SubmissionStatusTypes}getSubmissionStatusTypesByID(t){return this.getRefDataByID(this.referenceData.SubmissionStatusTypes,t)}getChargingLevelTypes(t=!1){return 1==t?this.filteredReferenceData.ChargerTypes:this.referenceData.ChargerTypes}getChargingLevelTypeByID(t){return this.getRefDataByID(this.referenceData.ChargerTypes,t)}getOutputCurrentTypes(t=!1){return t?this.referenceData.CurrentTypes:this.filteredReferenceData.CurrentTypes}getOutputCurrentTypeByID(t){return this.getRefDataByID(this.referenceData.CurrentTypes,t)}loadCachedRefData(){const t=localStorage.getItem("referenceData");if(null==t)this.http.get("./assets/data/CoreReferenceData.json").subscribe(t=>{this.logging.log("Using bundled reference data as cached ref data."),this.setCoreReferenceData(t),this.setFilteredReferenceData(t)});else{let e=JSON.parse(t);this.setCoreReferenceData(e)}this.setFilteredReferenceData(this.referenceData)}cacheCurrentRefData(){null!=this.referenceData&&(this.referenceData.CacheDate=new Date,localStorage.setItem("referenceData",JSON.stringify(this.referenceData)))}getRefDataByID(t,e){if(""!==e&&(e=parseInt(e,10)),null!=t)for(let n=0;n<t.length;n++)if(t[n].ID===e)return t[n];return null}sortCoreReferenceData(){this.sortReferenceData(this.referenceData.ConnectionTypes),this.sortReferenceData(this.referenceData.Countries),this.sortReferenceData(this.referenceData.Operators),this.sortReferenceData(this.referenceData.DataProviders),this.sortReferenceData(this.referenceData.UsageTypes),this.sortReferenceData(this.referenceData.StatusTypes),this.sortReferenceData(this.referenceData.CheckinStatusTypes),this.sortReferenceData(this.referenceData.SubmissionStatusTypes),this.filteredReferenceData&&(this.sortReferenceData(this.filteredReferenceData.ConnectionTypes),this.sortReferenceData(this.filteredReferenceData.Operators))}sortReferenceData(t){t.sort(this.sortListByTitle)}sortListByTitle(t,e){return t.Title<e.Title?-1:t.Title>e.Title?1:0}getMetadataValueByMetadataFieldID(t,e){if(""!==e&&(e=parseInt(e,10)),null!=t)for(let n=0;n<t.length;n++)if(t[n].ID===e)return t[n];return null}hydrateCompactPOI(t,e=!1){const n=this;if(null!=t.DataProviderID&&(e||null==t.DataProvider)&&(t.DataProvider=n.getDataProviderByID(t.DataProviderID)),null!=t.OperatorID&&(e||null==t.OperatorInfo)&&(t.OperatorInfo=n.getNetworkOperatorByID(t.OperatorID)),null!=t.UsageTypeID&&(e||null==t.UsageType)&&(t.UsageType=n.getUsageTypeByID(t.UsageTypeID)),null!=t.AddressInfo.CountryID&&(e||null==t.AddressInfo.Country)&&(t.AddressInfo.Country=n.getCountryByID(t.AddressInfo.CountryID)),null!=t.StatusTypeID&&(e||null==t.StatusType)&&(t.StatusType=n.getStatusTypeByID(t.StatusTypeID)),null!=t.SubmissionStatusTypeID&&(e||null==t.SubmissionStatusType)&&(t.SubmissionStatusType=n.getSubmissionStatusTypesByID(t.SubmissionStatusTypeID)),null!=t.Connections)for(let i=0;i<t.Connections.length;i++){const r=t.Connections[i];null!=r.ConnectionTypeID&&(e||null==r.ConnectionType)&&(r.ConnectionType=n.getConnectionTypeByID(r.ConnectionTypeID)),null!=r.LevelID&&(e||null==r.Level)&&(r.Level=n.getChargingLevelTypeByID(r.LevelID)),null!=r.CurrentTypeID&&(e||null==r.CurrentType)&&(r.CurrentType=n.getOutputCurrentTypeByID(r.CurrentTypeID)),null!=r.StatusTypeID&&(e||null==r.StatusType)&&(r.StatusType=n.getStatusTypeByID(r.StatusTypeID)),t.Connections[i]=r}if(null!=t.UserComments)for(let i=0;i<t.UserComments.length;i++){const r=t.UserComments[i];null!=r.CommentTypeID&&(e||null==r.CommentType)&&(r.CommentType=n.getCommentTypeByID(r.CommentTypeID)),null!=r.CheckinStatusTypeID&&(e||null==r.CheckinStatusType)&&(r.CheckinStatusType=n.getCheckinStatusTypeByID(r.CheckinStatusTypeID)),t.UserComments[i]=r}return t}hydrateCompactPOIList(t){for(let e=0;e<t.length;e++)t[e]=this.hydrateCompactPOI(t[e]);return t}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(s.eN),o.LFG(r.z))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},7919:function(t,e,n){"use strict";n.d(e,{v:function(){return v}});var i=n(553),r=n(5906),o=n(6579),s=n(7689),a=n(8239),l=n(7574),c=n(9226),u=n(4120),h=n(2340),d=n(4209);class p{constructor(t,e){this.events=t,this.logging=e,this.events=t,this.mapAPIType=r.b.MAPKIT_JS,this.mapReady=!1,this.markerList=new c.Xy,this.mapkitUtils=new f}initAPI(){mapkit&&mapkit.init({authorizationCallback:function(t){t(h.N.mapKitToken)}})}initMap(t,e,n){this.mapCanvasID=t;let i=!0;if(i="undefined"!=typeof mapkit,!i)return this.logging.log("Call to initMap before API is ready:"+r.b[this.mapAPIType],s.i.ERROR),this.mapReady=!1,!1;this.initAPI(),null==this.map&&(document.getElementById(t),this.map=new mapkit.Map(t),this.map.annotationForCluster=function(t){"poi"===t.clusteringIdentifier&&(t.title="Charging Location",t.subtitle=t.memberAnnotations.reduce((t,e)=>t+e.population,0))},this.mapReady=!0,mapkit.addEventListener("configuration-change",t=>{this.events.publish("ocm:mapping:ready")}),this.map.addEventListener("scroll-end",t=>{this.events.publish("ocm:mapping:dragend")}),this.map.addEventListener("zoom-end",t=>{this.events.publish("ocm:mapping:zoom")}))}clearMarkers(){null!=this.markerList&&this.markerList.forEach((t,e)=>{try{this.map.removeAnnotation(e)}catch(n){}}),this.markerList=new c.Xy}showPOIListOnMap(t,e){let n=0,i=0==this.markerList.size();if(null!=t){let e=[];for(let i=0;i<t.length;i++)if(null!=t[i].AddressInfo&&null!=t[i].AddressInfo.Latitude&&null!=t[i].AddressInfo.Longitude){let r=t[i],s=!0;if(null!=this.markerList&&this.markerList.containsKey(r.ID)&&(s=!1),s){let t=null;t=o.c.getIconForPOI(r);let i="OCM-"+r.ID+": "+r.AddressInfo.Title+":";null!=r.UsageType&&(i+=" "+r.UsageType.Title),null!=r.StatusType&&(i+=" "+r.StatusType.Title);const s=new mapkit.Coordinate(r.AddressInfo.Latitude,r.AddressInfo.Longitude);let a=new mapkit.ImageAnnotation(s,{title:i,size:{width:34,height:50},url:{1:t},clusteringIdentifier:"poi"});a.poi=r,a.addEventListener("select",t=>{const e=t.target.poi;this.events.publish("ocm:poi:selected",{poi:e,poiId:e.ID})}),this.markerList.setValue(r.ID,a),e.push(a),n++}}e.length>0&&(this.map.addAnnotations(e),i&&this.map.showItems(e,{animate:!0,padding:new mapkit.Padding(60,25,60,25)})),this.logging.log(n+" new map markers added out of a total "+this.markerList.size())}}refreshMapLayout(){null!=this.map&&setTimeout(()=>{this.logging.log("MapKit: refreshMapLayout",s.i.VERBOSE)},200)}setMapCenter(t,e){this.map&&(this.map.setCenterAnimated(new mapkit.Coordinate(t.coords.latitude,t.coords.longitude),!1),e&&this.setMapZoom(e))}getMapCenter(){return new l.y(t=>{if(null!=this.map){let e=this.map.center;null!=e&&(t.next(new u.jR(e.latitude,e.longitude)),t.complete())}})}setMapZoom(t){const e=Math.min(t,28),n=this.mapkitUtils.deltaFromZoomLevel(this.map,this.map.center,Math.round(e)),i=new mapkit.CoordinateSpan(111*n.latitudeDelta,111*n.longitudeDelta),r=new mapkit.CoordinateRegion(this.map.center,i);this.map.setRegionAnimated(r)}getMapZoom(){return new l.y(t=>{this.logging.log("MapKit: getMapZoom not supported",s.i.VERBOSE),t.next(this.map._impl.zoomLevel),t.complete()})}setMapType(t){this.logging.log("MapKit: skipped setting Map Type :"+t)}getMapBounds(){return new l.y(t=>{let e=new Array,n=this.map.region.toBoundingRegion();e.push(new u.wC(n.southLatitude,n.westLongitude)),e.push(new u.wC(n.northLatitude,n.eastLongitude)),t.next(e),t.complete()})}moveToMapBounds(t){this.logging.log("MapKit: map bounds not implemented")}renderMap(t,e,n){return document.getElementById(this.mapCanvasID).style.height=e+"px",this.mapReady&&this.showPOIListOnMap(t,n),!0}renderPolyline(t){this.clearPolyline()}clearPolyline(){null!=this.polylinePath&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(t){return(0,a.Z)(function*(){let e=new mapkit.Search({getsUserLocation:!0});return new Promise(function(){var n=(0,a.Z)(function*(n,i){let r=[];e.search(t,function(){var t=(0,a.Z)(function*(t,e){t&&i(t),r=[],e.places.map(t=>{let e=new d.n;e.Title=t.name,e.Address=t.formattedAddress,e.Type="place",e.Location=new u.wC(t.coordinate.latitude,t.coordinate.longitude),r.push(e)}),n(r)});return function(e,n){return t.apply(this,arguments)}}())});return function(t,e){return n.apply(this,arguments)}}())})()}addPOILayer(t){this.logging.log("Add POI Layer not implemented in this provider.")}}class f{constructor(){this.mercatorRadius=85445659.44705395,this.mercatorOffset=268435456}longitudeToPixelSpaceX(t){return Math.round(this.mercatorOffset+this.mercatorRadius*t*Math.PI/180)}latitudeToPixelSpaceY(t){return Math.round(this.mercatorOffset-this.mercatorRadius*Math.log((1+Math.sin(t*Math.PI/180))/(1-Math.sin(t*Math.PI/180)))/2)}pixelSpaceXToLongitude(t){return(Math.round(t)-this.mercatorOffset)/this.mercatorRadius*180/Math.PI}pixelSpaceYToLatitude(t){return 180*(Math.PI/2-2*Math.atan(Math.exp((Math.round(t)-this.mercatorOffset)/this.mercatorRadius)))/Math.PI}deltaFromZoomLevel(t,e,n){let i=this.longitudeToPixelSpaceX(e.longitude),r=this.latitudeToPixelSpaceY(e.latitude),o=Math.pow(2,20-n),s=t.visibleMapRect.size,a=s.width*o,l=s.height*o,c=i-a/2,u=r-l/2,h=this.pixelSpaceXToLongitude(c),d=this.pixelSpaceXToLongitude(c+a)-h,p=this.pixelSpaceYToLatitude(u);return{latitudeDelta:-1*(this.pixelSpaceYToLatitude(u+l)-p),longitudeDelta:d}}}var m=n(639),g=n(6260),y=n(1841);let _=(()=>{class t extends i.k{constructor(t,e,n){super(t,e,n),this.mapAPIType=r.b.MAPTILER,this.mapTileSet="https://maps.tilehosting.com/styles/streets/style.json?key=Gs9z7krALe3CGI60d5cL"}initAPI(){}}return t.\u0275fac=function(e){return new(e||t)(m.LFG(g.z),m.LFG(s.z),m.LFG(y.eN))},t.\u0275prov=m.Yz7({token:t,factory:t.\u0275fac}),t})(),v=(()=>{class t{constructor(t,e,n){this.logging=e,this.http=n,this.isFocused=!1,this.events=t,this.mapOptions=new r._,this.mapAPIReady=!1,this.mapsInitialised=!1,this.setMapAPI(this.mapOptions.mapAPI);let i=this;this.debouncedMapPositionUpdate=o.c.debounce(()=>{this.logging.log("signaling map position change:"),i.mapProvider.mapReady&&i.getMapCenter().subscribe(t=>{null!=t?(this.logging.log("Map centre/zoom changed, updating search position:"+t),this.updateMapCentrePos(t.coords.latitude,t.coords.longitude,!1)):this.logging.log("Map centre/zoom changed - map not ready to change centre pos:")})},300,!1)}setParentAppContext(t){this.parentAppContext=t}setMapAPI(t){this.mapOptions.mapAPI=t,this.mapOptions.mapAPI==r.b.MAPBOX&&(this.mapProvider=new i.k(this.events,this.logging,this.http)),this.mapOptions.mapAPI==r.b.MAPKIT_JS&&(this.mapProvider=new p(this.events,this.logging)),this.mapOptions.mapAPI==r.b.MAPTILER&&(this.mapProvider=new _(this.events,this.logging,this.http))}isMapReady(){return null!=this.mapProvider&&this.mapProvider.mapReady}externalAPILoaded(t){this.mapAPIReady=!0,this.logging.log("Mapping API Loaded: "+r.b[t])}initMap(t){if(!this.isMapReady())if(null!=this.mapProvider)this.mapsInitialised&&this.logging.log("initMap: Map provider already initialised"),this.logging.log("Mapping Manager: Init "+r.b[this.mapProvider.mapAPIType]),this.mapProvider.initMap(t,this.mapOptions,this);else{if(this.mapsInitialised)return void this.logging.log("initMap: map already initialised");this.logging.log("initMap: "+this.mapOptions.mapAPI)}}mapManipulationPerformed(t){this.logging.log("map manipulated:"+t),("drag"==t||"zoom"==t)&&this.debouncedMapPositionUpdate()}updateMapSize(){this.mapProvider&&this.mapProvider.refreshMapLayout()}updateMapCentrePos(t,e,n,i){n&&null!=this.mapProvider&&this.mapProvider.setMapCenter(new u.jR(t,e),i),this.mapOptions.mapCentre=new u.jR(t,e)}moveToMapBounds(t){this.mapProvider.moveToMapBounds(t)}refreshMapView(t,e,n){return null!=this.mapProvider?(this.logging.log("Mapping Manager: renderMap "+r.b[this.mapProvider.mapAPIType]),this.isMapReady()?this.mapProvider.renderMap(e,t,this.parentAppContext):this.logging.log("refreshMapView: map provider not initialised..")):this.logging.log("Unsupported Map API: refreshMapView",s.i.ERROR),!0}setMapType(t){this.mapOptions.mapType!=t&&(this.mapOptions.mapType=t,this.isMapReady()&&null!=this.mapProvider?(this.logging.log("Changing map type:"+t),this.mapProvider.setMapType(t)):this.logging.log("Map type set, maps not initialised yet."))}unfocusMap(){this.logging.log("[mapping] Unfocus Map."),this.isFocused=!1,this.mapProvider.unfocusMap()}focusMap(){this.logging.log("[mapping] Focus Map."),this.isFocused=!0,this.mapProvider.focusMap()}getMapBounds(){return this.mapProvider.getMapBounds()}getMapZoom(){return this.mapProvider.getMapZoom()}setMapZoom(t){this.mapProvider.setMapZoom(t)}getMapCenter(){return this.mapProvider.getMapCenter()}showPOIOnStaticMap(t,e,n=!1,i=!1,r=200,s=200){let a=document.getElementById(t);if(null!=a){let t=e.AddressInfo.Latitude,l=e.AddressInfo.Longitude;r>640&&(r=640),s>640&&(s=640);let c=r,u=s,h="https://maps.googleapis.com/maps/api/staticmap?center="+t+","+l+"&zoom=14&size="+c+"x"+u+"&maptype=roadmap&markers=color:blue%7Clabel:A%7C"+t+","+l+"&sensor=false",d="";d+=1==n?"<div>"+o.c.formatMapLink(e,'<div><img width="'+c+'" height="'+u+'" src="'+h+'" /></div>',i)+"</div>":'<div><img width="'+c+'" height="'+u+'" src="'+h+'" /></div>',a.innerHTML=d}}renderPolyline(t){this.mapProvider.renderPolyline(t)}clearPolyline(){this.mapProvider.clearPolyline()}clearMarkers(){this.logging.log("mapping: clearing markers"),this.mapProvider.clearMarkers()}addPOILayer(t){this.mapProvider.addPOILayer(t)}}return t.\u0275fac=function(e){return new(e||t)(m.LFG(g.z),m.LFG(s.z),m.LFG(y.eN))},t.\u0275prov=m.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},5906:function(t,e,n){"use strict";n.d(e,{b:function(){return r},_:function(){return o}});var i=n(2340),r=(()=>{return(t=r||(r={}))[t.GOOGLE_WEB=1]="GOOGLE_WEB",t[t.GOOGLE_NATIVE=2]="GOOGLE_NATIVE",t[t.LEAFLET=3]="LEAFLET",t[t.MAPBOX=4]="MAPBOX",t[t.MAPKIT_JS=5]="MAPKIT_JS",t[t.MAPTILER=6]="MAPTILER",r;var t})();class o{constructor(){this.enableClustering=!1,this.resultBatchID=-1,this.useMarkerIcons=!0,this.useMarkerAnimation=!0,this.enableTrackingMapCentre=!1,this.enableSearchByWatchingLocation=!1,this.mapCentre=null,this.mapAPI=i.N.defaultMapProvider,this.mapType="ROADMAP",this.searchDistanceKM=1e5,this.mapMoveQueryRefreshMS=300,this.enableSearchRadiusIndicator=!1,this.minZoomLevel=2}}},553:function(t,e,n){"use strict";n.d(e,{k:function(){return g}});var i=n(8239),r=n(6579),o=n(5906),s=n(7574),a=n(9226),l=n(4120),c=n(7689),u=n(2958),h=n(2340),d=n(4209),p=n(639),f=n(6260),m=n(1841);let g=(()=>{class t{constructor(t,e,n){this.events=t,this.logging=e,this.http=n,this._isMapAnimating=!1,this.events=t,this.mapAPIType=o.b.MAPBOX,this.mapReady=!1,this.markerList=new a.Xy}initAPI(){u&&(u.accessToken=h.N.mapBoxToken)}getCurrentMapTileSet(t){return"SATELLITE"==t?"mapbox://styles/mapbox/satellite-streets-v11?optimize=true":"mapbox://styles/mapbox/streets-v11?optimize=true"}flyAroundPoint(t){if(this._isMapAnimating){this.map.rotateTo(t/100%360,{duration:0});const e=this;requestAnimationFrame(function(t){e.flyAroundPoint(t)})}}initMap(t,e,n){this.mapCanvasID=t;let i=!0;if(i=void 0!==u,!i)return this.logging.log("Call to initMap before API is ready:"+o.b[this.mapAPIType],c.i.ERROR),this.mapReady=!1,!1;if(null==this.map){let n=function(t){return t*(2-t)};document.getElementById(t),this.initAPI(),this.map=new u.Map({container:t,style:this.getCurrentMapTileSet(e.mapType),zoom:15,attributionControl:!1}),this.map.addControl(new u.AttributionControl({compact:!0,customAttribution:["Open Charge Map Contributors"]})),this.map.addControl(new u.NavigationControl),this.mapReady=!0,this.map.getCanvas().focus();let i=100,o=25;this.map.getCanvas().addEventListener("keydown",t=>{t.preventDefault(),38===t.which?this.map.panBy([0,-i],{easing:n}):40===t.which?this.map.panBy([0,i],{easing:n}):37===t.which?this.map.easeTo({bearing:this.map.getBearing()-o,easing:n}):39===t.which?this.map.easeTo({bearing:this.map.getBearing()+o,easing:n}):32===t.which&&(this._isMapAnimating?this._isMapAnimating=!1:(this._isMapAnimating=!0,this.flyAroundPoint(0)))},!0),this.map.on("load",()=>{this.events.publish("ocm:mapping:ready")});let s=r.c.debounce(()=>{this.getMapCenter().subscribe(t=>{this.searchMarker.setLngLat(new u.LngLat(t.coords.longitude,t.coords.latitude))})},500,!1);this.map.on("move",()=>{this.searchMarker&&s()}),this.map.on("moveend",()=>{this.events.publish("ocm:mapping:dragend"),e.onMapMoveCompleted&&e.onMapMoveCompleted()}),this.map.on("zoomend",()=>{this.events.publish("ocm:mapping:zoom")})}}clearMarkers(){null!=this.markerList&&this.markerList.forEach((t,e)=>{try{e.remove()}catch(n){}}),this.markerList=new a.Xy}showPOIListOnMap(t,e,n=!0){let i=this.map,o=new u.LngLatBounds,s=0;if(i.getZoom(),null!=t){for(let e=0;e<t.length;e++)if(null!=t[e].AddressInfo&&null!=t[e].AddressInfo.Latitude&&null!=t[e].AddressInfo.Longitude){let a=t[e],l=!0;if(null!=this.markerList&&this.markerList.containsKey(a.ID)){l=!1;let t=this.markerList.getValue(a.ID);t&&t.poi&&t.poi.DateLastStatusUpdate!=a.DateLastStatusUpdate&&(t.remove(),l=!0)}if(l){let t=null,e=null;n?(t=document.createElement("img"),t.src=r.c.getIconForPOI(a),t.width=34,t.height=50):(t=null,e=r.c.getColorForPOI(a));let l=(n?"OCM-":"EXT-")+a.ID+": "+a.AddressInfo.Title+":";null!=a.UsageType&&(l+=" "+a.UsageType.Title),null!=a.StatusType&&(l+=" "+a.StatusType.Title);let c=new u.Marker({element:t,color:e}).setLngLat([a.AddressInfo.Longitude,a.AddressInfo.Latitude]).addTo(i);c.poi=a;let h=c.getElement();h.poi=a,h.addEventListener("click",t=>{const e=t.currentTarget.poi;this.events.publish("ocm:poi:selected",{poiId:e.ID,poi:e})}),o.extend(c.getLngLat()),this.markerList.setValue(a.ID,c),s++}}this.logging.log(s+" new map markers added out of a total "+this.markerList.size())}if(null!=t&&t.length>0)if(null==e||e.appConfig.enableLiveMapQuerying)null==i.getCenter()&&i.setCenter(o.getCenter());else{this.logging.log("Fitting to marker bounds:"+o),i.setCenter(o.getCenter()),this.logging.log("zoom before fit bounds:"+i.getZoom()),i.fitBounds(o);let t=i.getZoom();i.setZoom(t<6?6:t)}}refreshMapLayout(){null!=this.map&&setTimeout(()=>{this.logging.log("MapBoxGL: refreshMapLayout",c.i.VERBOSE),this.map.resize()},200)}setMapCenter(t){this.mapReady&&(this.map.setCenter(new u.LngLat(t.coords.longitude,t.coords.latitude)),this.searchMarker||(this.searchMarker=new u.Marker({color:"#99ccff",anchor:"top"}).setLngLat(new u.LngLat(t.coords.longitude,t.coords.latitude)).addTo(this.map),this.searchMarker.getElement().addEventListener("click",()=>{let t=this.searchMarker.getLngLat();this.events.publish("ocm:mapping:addpoi",new l.wC(t.lat,t.lng))})))}getMapCenter(){return new s.y(t=>{if(null!=this.map){let e=this.map.getCenter();null!=e&&(t.next(new l.jR(e.lat,e.lng)),t.complete())}})}setMapZoom(t){this.map.setZoom(t)}getMapZoom(){return new s.y(t=>{let e=this.map.getZoom();t.next(e),t.complete()})}setMapType(t){this.map.setStyle(this.getCurrentMapTileSet(t))}getMapBounds(){return new s.y(t=>{let e=new Array,n=this.map.getBounds();e.push(new l.wC(n.getSouthWest().lat,n.getSouthWest().lng)),e.push(new l.wC(n.getNorthEast().lat,n.getNorthEast().lng)),t.next(e),t.complete()})}moveToMapBounds(t){this.map.fitBounds(new u.LngLatBounds(new u.LngLat(t.southWest.longitude,t.southWest.latitude),new u.LngLat(t.northEast.longitude,t.northEast.latitude)))}renderMap(t,e,n){return document.getElementById(this.mapCanvasID).style.height=e+"px",this.mapReady&&this.showPOIListOnMap(t,n),!0}renderPolyline(t){this.clearPolyline()}clearPolyline(){null!=this.polylinePath&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(t,e,n){var r=this;return(0,i.Z)(function*(){let o=`https://api.mapbox.com/geocoding/v5/mapbox.places/${t||n+","+e}.json?access_token=${h.N.mapBoxToken}`;return new Promise(function(){var t=(0,i.Z)(function*(t,e){r.http.get(o).toPromise().then(e=>{let n=[];n=[],e.features&&e.features.map(t=>{let i=new d.n;i.Title=t.place_name,i.Address=t.place_name,i.Type="place",i.Location=new l.wC(t.center[1],t.center[0]),i.Attribution=e.attribution,n.push(i)}),t(n)})});return function(e,n){return t.apply(this,arguments)}}())})()}addPOILayer(t){this.logging.log("Add POI Layer not implemented in this provider."),this.showPOIListOnMap(t,null,!1)}}return t.\u0275fac=function(e){return new(e||t)(p.LFG(f.z),p.LFG(c.z),p.LFG(m.eN))},t.\u0275prov=p.Yz7({token:t,factory:t.\u0275fac}),t})()},2340:function(t,e,n){"use strict";n.d(e,{N:function(){return i}});const i={name:"prod",version:"8.0.0",production:!0,analyticsId:"",googleMapsKey:"",mapBoxToken:"pk.eyJ1Ijoid2VicHJvZnVzaW9uIiwiYSI6ImNrdHZlc2N5dTI5Zjcydm8zYWFwc2JnbTMifQ.M7b5SOzbPcg_8XAHCOeP0w",mapKitToken:"",enableStaticMaps:!1,defaultMapProvider:4,apiBase:"https://api.openchargemap.io",apiKey:"9bb03e5b-0fb2-4916-9b2b-26c6bd27a56a",enabledFeatures:["MAP","ADD_COMMENT","ADD_PHOTO","FAVOURITES","FILTER_OPTIONS_BY_COUNTRY","ADD_POI","EDIT_POI","LAYERS"]}},1970:function(t,e,n){"use strict";var i=n(8583),r=n(639);class o extends i.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class s extends o{static makeCurrent(){(0,i.HT)(new s)}onAndCancel(t,e,n){return t.addEventListener(e,n,!1),()=>{t.removeEventListener(e,n,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=(l=l||document.querySelector("base"),l?l.getAttribute("href"):null);return null==e?null:function(t){a=a||document.createElement("a"),a.setAttribute("href",t);const e=a.pathname;return"/"===e.charAt(0)?e:`/${e}`}(e)}resetBaseElement(){l=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return(0,i.Mx)(document.cookie,t)}}let a,l=null;const c=new r.OlP("TRANSITION_ID"),u=[{provide:r.ip1,useFactory:function(t,e,n){return()=>{n.get(r.CZH).donePromise.then(()=>{const n=(0,i.q)(),r=e.querySelectorAll(`style[ng-transition="${t}"]`);for(let t=0;t<r.length;t++)n.remove(r[t])})}},deps:[c,i.K0,r.zs3],multi:!0}];class h{static init(){(0,r.VLi)(new h)}addToWindow(t){r.dqk.getAngularTestability=(e,n=!0)=>{const i=t.findTestabilityInTree(e,n);if(null==i)throw new Error("Could not find testability for element.");return i},r.dqk.getAllAngularTestabilities=()=>t.getAllTestabilities(),r.dqk.getAllAngularRootElements=()=>t.getAllRootElements(),r.dqk.frameworkStabilizers||(r.dqk.frameworkStabilizers=[]),r.dqk.frameworkStabilizers.push(t=>{const e=r.dqk.getAllAngularTestabilities();let n=e.length,i=!1;const o=function(e){i=i||e,n--,0==n&&t(i)};e.forEach(function(t){t.whenStable(o)})})}findTestabilityInTree(t,e,n){if(null==e)return null;const r=t.getTestability(e);return null!=r?r:n?(0,i.q)().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}}let d=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})();const p=new r.OlP("EventManagerPlugins");let f=(()=>{class t{constructor(t,e){this._zone=e,this._eventNameToPlugin=new Map,t.forEach(t=>t.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,e,n){return this._findPluginFor(e).addEventListener(t,e,n)}addGlobalEventListener(t,e,n){return this._findPluginFor(e).addGlobalEventListener(t,e,n)}getZone(){return this._zone}_findPluginFor(t){const e=this._eventNameToPlugin.get(t);if(e)return e;const n=this._plugins;for(let i=0;i<n.length;i++){const e=n[i];if(e.supports(t))return this._eventNameToPlugin.set(t,e),e}throw new Error(`No event manager plugin found for event ${t}`)}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(p),r.LFG(r.R0b))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})();class m{constructor(t){this._doc=t}addGlobalEventListener(t,e,n){const r=(0,i.q)().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${e}`);return this.addEventListener(r,e,n)}}let g=(()=>{class t{constructor(){this._stylesSet=new Set}addStyles(t){const e=new Set;t.forEach(t=>{this._stylesSet.has(t)||(this._stylesSet.add(t),e.add(t))}),this.onStylesAdded(e)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})(),y=(()=>{class t extends g{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,e,n){t.forEach(t=>{const i=this._doc.createElement("style");i.textContent=t,n.push(e.appendChild(i))})}addHost(t){const e=[];this._addStylesToHost(this._stylesSet,t,e),this._hostNodes.set(t,e)}removeHost(t){const e=this._hostNodes.get(t);e&&e.forEach(_),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((e,n)=>{this._addStylesToHost(t,n,e)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(_))}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(i.K0))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})();function _(t){(0,i.q)().remove(t)}const v={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},x=/%COMP%/g;function b(t,e,n){for(let i=0;i<e.length;i++){let r=e[i];Array.isArray(r)?b(t,r,n):(r=r.replace(x,t),n.push(r))}return n}function w(t){return e=>{if("__ngUnwrap__"===e)return t;!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}let T=(()=>{class t{constructor(t,e,n){this.eventManager=t,this.sharedStylesHost=e,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new A(t)}createRenderer(t,e){if(!t||!e)return this.defaultRenderer;switch(e.encapsulation){case r.ifc.Emulated:{let n=this.rendererByCompId.get(e.id);return n||(n=new S(this.eventManager,this.sharedStylesHost,e,this.appId),this.rendererByCompId.set(e.id,n)),n.applyToHost(t),n}case 1:case r.ifc.ShadowDom:return new C(this.eventManager,this.sharedStylesHost,t,e);default:if(!this.rendererByCompId.has(e.id)){const t=b(e.id,e.styles,[]);this.sharedStylesHost.addStyles(t),this.rendererByCompId.set(e.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(f),r.LFG(y),r.LFG(r.AFp))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})();class A{constructor(t){this.eventManager=t,this.data=Object.create(null)}destroy(){}createElement(t,e){return e?document.createElementNS(v[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){t.appendChild(e)}insertBefore(t,e,n){t&&t.insertBefore(e,n)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error(`The selector "${t}" did not match any elements`);return e||(n.textContent=""),n}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,n,i){if(i){e=i+":"+e;const r=v[i];r?t.setAttributeNS(r,e,n):t.setAttribute(e,n)}else t.setAttribute(e,n)}removeAttribute(t,e,n){if(n){const i=v[n];i?t.removeAttributeNS(i,e):t.removeAttribute(`${n}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,n,i){i&(r.JOm.DashCase|r.JOm.Important)?t.style.setProperty(e,n,i&r.JOm.Important?"important":""):t.style[e]=n}removeStyle(t,e,n){n&r.JOm.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,n){t[e]=n}setValue(t,e){t.nodeValue=e}listen(t,e,n){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,w(n)):this.eventManager.addEventListener(t,e,w(n))}}class S extends A{constructor(t,e,n,i){super(t),this.component=n;const r=b(i+"-"+n.id,n.styles,[]);e.addStyles(r),this.contentAttr="_ngcontent-%COMP%".replace(x,i+"-"+n.id),this.hostAttr="_nghost-%COMP%".replace(x,i+"-"+n.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const n=super.createElement(t,e);return super.setAttribute(n,this.contentAttr,""),n}}class C extends A{constructor(t,e,n,i){super(t),this.sharedStylesHost=e,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const r=b(i.id,i.styles,[]);for(let o=0;o<r.length;o++){const t=document.createElement("style");t.textContent=r[o],this.shadowRoot.appendChild(t)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,n){return super.insertBefore(this.nodeOrShadowRoot(t),e,n)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let I=(()=>{class t extends m{constructor(t){super(t)}supports(t){return!0}addEventListener(t,e,n){return t.addEventListener(e,n,!1),()=>this.removeEventListener(t,e,n)}removeEventListener(t,e,n){return t.removeEventListener(e,n)}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(i.K0))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})();const E=["alt","control","meta","shift"],M={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},k={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},P={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let D=(()=>{class t extends m{constructor(t){super(t)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,n,r){const o=t.parseEventName(n),s=t.eventCallback(o.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,i.q)().onAndCancel(e,o.domEventName,s))}static parseEventName(e){const n=e.toLowerCase().split("."),i=n.shift();if(0===n.length||"keydown"!==i&&"keyup"!==i)return null;const r=t._normalizeKey(n.pop());let o="";if(E.forEach(t=>{const e=n.indexOf(t);e>-1&&(n.splice(e,1),o+=t+".")}),o+=r,0!=n.length||0===r.length)return null;const s={};return s.domEventName=i,s.fullKey=o,s}static getEventFullKey(t){let e="",n=function(t){let e=t.key;if(null==e){if(e=t.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&k.hasOwnProperty(e)&&(e=k[e]))}return M[e]||e}(t);return n=n.toLowerCase()," "===n?n="space":"."===n&&(n="dot"),E.forEach(i=>{i!=n&&P[i](t)&&(e+=i+".")}),e+=n,e}static eventCallback(e,n,i){return r=>{t.getEventFullKey(r)===e&&i.runGuarded(()=>n(r))}}static _normalizeKey(t){switch(t){case"esc":return"escape";default:return t}}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(i.K0))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac}),t})();const L=(0,r.eFA)(r._c5,"browser",[{provide:r.Lbi,useValue:i.bD},{provide:r.g9A,useValue:function(){s.makeCurrent(),h.init()},multi:!0},{provide:i.K0,useFactory:function(){return(0,r.RDi)(document),document},deps:[]}]),O=[[],{provide:r.zSh,useValue:"root"},{provide:r.qLn,useFactory:function(){return new r.qLn},deps:[]},{provide:p,useClass:I,multi:!0,deps:[i.K0,r.R0b,r.Lbi]},{provide:p,useClass:D,multi:!0,deps:[i.K0]},[],{provide:T,useClass:T,deps:[f,y,r.AFp]},{provide:r.FYo,useExisting:T},{provide:g,useExisting:y},{provide:y,useClass:y,deps:[i.K0]},{provide:r.dDg,useClass:r.dDg,deps:[r.R0b]},{provide:f,useClass:f,deps:[p,r.R0b]},{provide:i.JF,useClass:d,deps:[]},[]];let R=(()=>{class t{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(e){return{ngModule:t,providers:[{provide:r.AFp,useValue:e.appId},{provide:c,useExisting:r.AFp},u]}}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(t,12))},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({providers:O,imports:[i.ez,r.hGG]}),t})();"undefined"!=typeof window&&window;var z=n(8936),Z=n(4516),F=n(3679),U=n(2517);let N=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[[i.ez,F.u5,U.Pc,Z.aw,z.e]]}),t})(),B=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[[i.ez,F.u5,U.Pc,Z.aw,z.e]]}),t})(),q=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[[i.ez,F.u5,U.Pc,Z.aw,z.e]]}),t})();var $=n(3947),V=n(1841),j=n(8093),G=n(6686);class Y{constructor(t,e="/assets/i18n/",n=".json"){this.http=t,this.prefix=e,this.suffix=n}getTranslation(t){return this.http.get(`${this.prefix}${t}${this.suffix}`)}}var H=n(8239),J=n(7919),W=n(6153),X=n(9492),Q=n(9741),K=n(8118);function tt(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"div"),r._uU(1," You are not signed in. "),r.TgZ(2,"button",5),r.NdJ("click",function(){return r.CHM(t),r.oxw().showSignInModal()}),r._uU(3),r.ALo(4,"translate"),r.qZA(),r.qZA()}2&t&&(r.xp6(3),r.Oqu(r.lcZ(4,1,"ocm.general.signIn")))}function et(t,e){if(1&t&&(r.TgZ(0,"div"),r.TgZ(1,"ion-card"),r.TgZ(2,"ion-item"),r.TgZ(3,"ion-avatar",6),r._UZ(4,"img",7),r.qZA(),r.TgZ(5,"h2"),r._uU(6),r.qZA(),r.qZA(),r.TgZ(7,"ion-card-content"),r.TgZ(8,"p"),r._uU(9),r.qZA(),r.TgZ(10,"p"),r._uU(11),r.qZA(),r.qZA(),r.TgZ(12,"ion-item"),r.TgZ(13,"ion-note",8),r._UZ(14,"ion-icon",9),r._uU(15),r.qZA(),r.qZA(),r.qZA(),r.qZA()),2&t){const t=r.oxw();r.xp6(4),r.s9C("src",t.userProfile.ProfileImageURL,r.LSH),r.xp6(2),r.Oqu(t.userProfile.Username),r.xp6(3),r.hij(" ",t.userProfile.Profile,""),r.xp6(2),r.hij(" Date Joined: ",t.userProfile.DateCreated," "),r.xp6(4),r.hij(" ",t.userProfile.ReputationPoints," Contributor Points ")}}let nt=(()=>{class t{constructor(t,e,n,i){this.appManager=t,this.nav=e,this.translate=n,this.modalController=i}ionViewDidEnter(){this.userProfile=this.appManager.getUserProfile(),null!=this.userProfile&&this.appManager.isUserAuthenticated(!0)?this.refreshProfileView():this.showSignInModal(),this.appManager.analytics.viewEvent("Profile")}refreshProfileView(){this.userProfile=this.appManager.getUserProfile()}showSignInModal(){this.modalController.create({component:X.F,componentProps:{Profile:this.userProfile}}).then(t=>{t.onDidDismiss().then(()=>{this.refreshProfileView()}),t.present()})}close(){this.modalController.dismiss()}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(K.c),r.Y36(U.SH),r.Y36(Z.sK),r.Y36(U.IN))},t.\u0275cmp=r.Xpm({type:t,selectors:[["ng-component"]],decls:14,vars:5,consts:[[1,"profile-page","ion-padding"],[4,"ngIf"],["slot","end"],[3,"click"],["name","close","slot","start"],["ion-button","",3,"click"],["slot","start"],[3,"src"],["item-left",""],["name","star"]],template:function(t,e){1&t&&(r.TgZ(0,"ion-header"),r.TgZ(1,"ion-toolbar"),r.TgZ(2,"ion-title"),r._uU(3),r.ALo(4,"translate"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(5,"ion-content",0),r.YNc(6,tt,5,3,"div",1),r.YNc(7,et,16,5,"div",1),r.qZA(),r.TgZ(8,"ion-footer"),r.TgZ(9,"ion-toolbar"),r.TgZ(10,"ion-buttons",2),r.TgZ(11,"ion-button",3),r.NdJ("click",function(){return e.close()}),r._UZ(12,"ion-icon",4),r._uU(13," Close "),r.qZA(),r.qZA(),r.qZA(),r.qZA()),2&t&&(r.xp6(3),r.hij(" ",r.lcZ(4,3,"ocm.navigation.profile.sectionTitle")," "),r.xp6(3),r.Q6J("ngIf",null==e.userProfile),r.xp6(1),r.Q6J("ngIf",null!=e.userProfile))},directives:[U.Gu,U.sr,U.wd,U.W2,i.O5,U.fr,U.Sm,U.YG,U.gu,U.PM,U.Ie,U.BJ,U.FN,U.uN],pipes:[Z.X$],encapsulation:2}),t})();var it=n(7689),rt=n(2340),ot=n(7877),st=n(56),at=n(6579),lt=n(388),ct=n(6588),ut=n(8384);const ht=(0,ut.fo)("PushNotifications",{}),dt=(0,ut.fo)("StatusBar"),pt=(0,ut.fo)("SplashScreen",{web:()=>n.e(8962).then(n.bind(n,8962)).then(t=>new t.SplashScreenWeb)}),ft=(0,ut.fo)("App",{web:()=>n.e(6141).then(n.bind(n,6141)).then(t=>new t.AppWeb)});var mt=n(6260);function gt(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"ion-item",9),r.NdJ("click",function(){return r.CHM(t),r.oxw().openRoutePlannerModal()}),r._UZ(1,"ion-icon",12),r.TgZ(2,"ion-label"),r._uU(3," Route Planner "),r.qZA(),r.qZA()}}function yt(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"ion-item",9),r.NdJ("click",function(){return r.CHM(t),r.oxw().add()}),r._UZ(1,"ion-icon",13),r.TgZ(2,"ion-label"),r._uU(3),r.ALo(4,"translate"),r.qZA(),r.qZA()}2&t&&(r.xp6(3),r.hij(" ",r.lcZ(4,1,"ocm.general.addLocation")," "))}function _t(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"ion-item",9),r.NdJ("click",function(){return r.CHM(t),r.oxw().journeys()}),r._UZ(1,"ion-icon",12),r.TgZ(2,"ion-label"),r._uU(3," Journeys "),r.qZA(),r.qZA()}}function vt(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"ion-item",9),r.NdJ("click",function(){return r.CHM(t),r.oxw().addLayer()}),r._UZ(1,"ion-icon",14),r.TgZ(2,"ion-label"),r._uU(3," Add Layer "),r.qZA(),r.qZA()}}function xt(t,e){if(1&t){const t=r.EpF();r.ynx(0),r.TgZ(1,"ion-item",9),r.NdJ("click",function(){return r.CHM(t),r.oxw().signIn()}),r._UZ(2,"ion-icon",15),r.TgZ(3,"ion-label"),r._uU(4),r.ALo(5,"translate"),r.qZA(),r.qZA(),r.BQk()}2&t&&(r.xp6(4),r.hij(" ",r.lcZ(5,1,"ocm.general.signIn")," "))}function bt(t,e){if(1&t){const t=r.EpF();r.ynx(0),r.TgZ(1,"ion-item",9),r.NdJ("click",function(){return r.CHM(t),r.oxw().profile()}),r._UZ(2,"ion-icon",15),r.TgZ(3,"ion-label"),r._uU(4),r.ALo(5,"translate"),r.qZA(),r.qZA(),r.TgZ(6,"ion-item",9),r.NdJ("click",function(){return r.CHM(t),r.oxw().signOut()}),r._UZ(7,"ion-icon",16),r.TgZ(8,"ion-label"),r._uU(9),r.ALo(10,"translate"),r._UZ(11,"br"),r.TgZ(12,"small",17),r._uU(13),r.qZA(),r.qZA(),r.qZA(),r.BQk()}if(2&t){const t=r.oxw();r.xp6(4),r.hij(" ",r.lcZ(5,3,"ocm.navigation.profile.sectionTitle")," "),r.xp6(5),r.hij(" ",r.lcZ(10,5,"ocm.general.signOut")," "),r.xp6(4),r.hij(" ",t.getUserName(),"")}}const wt=function(){return["/search"]};let Tt=(()=>{class t{constructor(t,e,n,i,r,o,s,a){this.platform=t,this.translate=e,this.mapping=n,this.modalController=i,this.appManager=r,this.logger=o,this.analytics=s,this.events=a,this.logger.log("Environment: "+rt.N.name),this.initializeApp(),this.enabledFeatures=rt.N.enabledFeatures,1!=r.searchSettings.EnableAdvancedEditorFeatures&&(this.enabledFeatures=this.enabledFeatures.filter(t=>"LAYERS"!=t))}configurePushNotifications(){ht.register(),ht.addListener("registration",t=>{this.logger.log("Push registration success, token: "+t.value),this.appManager.savePushRegistration(t.value)}),ht.addListener("registrationError",t=>{this.logger.log("Error on registration: "+JSON.stringify(t))}),ht.addListener("pushNotificationReceived",t=>{this.logger.log("Push received: "+JSON.stringify(t),it.i.INFO)}),ht.addListener("pushNotificationActionPerformed",t=>{this.logger.log("Push action performed: "+JSON.stringify(t))})}isUserAuthenticated(){return this.appManager.isUserAuthenticated()}getUserName(){let t=this.appManager.getUserProfile();return t?t.EmailAddress?t.EmailAddress:t.Username:"Not Signed In"}initializeApp(){var t=this;this.platform.ready().then(()=>{this.platform.is("capacitor")&&(dt.show(),pt.hide()),this.translate.addLangs(this.appManager.getLanguages().map(t=>t.code)),this.translate.setDefaultLang("en"),this.translate.use(null!=this.appManager.searchSettings.Language?this.appManager.searchSettings.Language:"en"),this.translate.get("ocm.search.performSearch").toPromise().then(t=>{}),this.analytics.init(rt.N.analyticsId).then(()=>{this.analytics.setAppVersion(rt.N.version),this.analytics.appEvent("Startup","App Loaded")}).catch(t=>this.logger.log("Error starting analytics")),this.events.subscribe("ocm:mapping:addpoi",function(){var e=(0,H.Z)(function*(e){at.c.isFeatureEnabled("ADD_POI")&&t.add(e)});return function(t){return e.apply(this,arguments)}}()),(this.platform.is("ios")||this.platform.is("android"))&&(this.configurePushNotifications(),this.checkForAppOpenUrl())})}checkForAppOpenUrl(){return(0,H.Z)(function*(){ft.addListener("appUrlOpen",t=>{alert("App (re)opened with URL: "+t.url)});let t=yield ft.getLaunchUrl();t&&t.url&&alert("App opened with URL: "+t.url)})()}openRoutePlannerModal(){var t=this;return(0,H.Z)(function*(){t.mapping.unfocusMap();const e=yield t.modalController.create({component:W.u});e.onDidDismiss().then(e=>{t.mapping.focusMap()}),yield e.present()})()}continueAdd(t){var e=this;return(0,H.Z)(function*(){const n=yield e.modalController.create({component:ot.Y,componentProps:{startPos:t}});n.onDidDismiss().then(t=>{e.mapping.focusMap()}),yield n.present()})()}add(t){var e=this;return(0,H.Z)(function*(){if(e.mapping.unfocusMap(),!e.appManager.isUserAuthenticated(!0)){const n=yield e.modalController.create({component:X.F});return n.onDidDismiss().then(function(){var n=(0,H.Z)(function*(n){e.mapping.focusMap(),e.appManager.isUserAuthenticated(!0)&&(yield e.continueAdd(t))});return function(t){return n.apply(this,arguments)}}()),yield n.present()}yield e.continueAdd(t)})()}signIn(){var t=this;return(0,H.Z)(function*(){t.mapping.unfocusMap();const e=yield t.modalController.create({component:X.F});return e.onDidDismiss().then(e=>{t.mapping.focusMap(),t.appManager.isUserAuthenticated(!0)}),yield e.present()})()}signOut(){var t=this;return(0,H.Z)(function*(){t.appManager.signOutCurrentUser()})()}profile(){var t=this;return(0,H.Z)(function*(){t.mapping.unfocusMap();const e=yield t.modalController.create({component:nt});e.onDidDismiss().then(e=>{t.mapping.focusMap()}),yield e.present()})()}journeys(){var t=this;return(0,H.Z)(function*(){t.mapping.unfocusMap();const e=yield t.modalController.create({component:Q.g});e.onDidDismiss().then(e=>{t.mapping.focusMap()}),yield e.present()})()}addLayer(){var t=this;return(0,H.Z)(function*(){const e=yield t.modalController.create({component:ct.A});yield e.present();const{data:n}=yield e.onWillDismiss();n&&t.mapping.addPOILayer(n)})()}about(){var t=this;return(0,H.Z)(function*(){t.mapping.unfocusMap();const e=yield t.modalController.create({component:lt.t});e.onDidDismiss().then(e=>{t.mapping.focusMap()}),yield e.present()})()}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(U.t4),r.Y36(Z.sK),r.Y36(J.v),r.Y36(U.IN),r.Y36(K.c),r.Y36(it.z),r.Y36(st.c),r.Y36(mt.z))},t.\u0275cmp=r.Xpm({type:t,selectors:[["app-root"]],decls:29,vars:17,consts:[["contentId","main-content",3,"disabled"],["contentId","main-content","swipeGesture","false"],["slot","start"],["src","assets/images/icons/branding/AppIcon_128x128.png"],["auto-hide","false"],[3,"routerDirection","routerLink"],["slot","start","name","home"],[3,"click",4,"ngIf"],[4,"ngIf"],[3,"click"],["slot","start","name","information-circle-outline"],["id","main-content"],["slot","start","name","map"],["slot","start","name","add-circle-outline"],["slot","start","name","albums"],["slot","start","name","person"],["slot","start","name","log-out"],[2,"color","#c0c0c0"]],template:function(t,e){1&t&&(r.TgZ(0,"ion-app"),r.TgZ(1,"ion-split-pane",0),r.TgZ(2,"ion-menu",1),r.TgZ(3,"ion-header"),r.TgZ(4,"ion-toolbar"),r.TgZ(5,"ion-thumbnail",2),r._UZ(6,"img",3),r.qZA(),r.TgZ(7,"ion-title"),r._uU(8),r.qZA(),r.qZA(),r.qZA(),r.TgZ(9,"ion-content"),r.TgZ(10,"ion-list"),r.TgZ(11,"ion-menu-toggle",4),r.TgZ(12,"ion-item",5),r._UZ(13,"ion-icon",6),r.TgZ(14,"ion-label"),r._uU(15),r.ALo(16,"translate"),r.qZA(),r.qZA(),r.YNc(17,gt,4,0,"ion-item",7),r.YNc(18,yt,5,3,"ion-item",7),r.YNc(19,_t,4,0,"ion-item",7),r.YNc(20,vt,4,0,"ion-item",7),r.YNc(21,xt,6,3,"ng-container",8),r.YNc(22,bt,14,7,"ng-container",8),r.TgZ(23,"ion-item",9),r.NdJ("click",function(){return e.about()}),r._UZ(24,"ion-icon",10),r.TgZ(25,"ion-label"),r._uU(26),r.ALo(27,"translate"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r._UZ(28,"ion-router-outlet",11),r.qZA(),r.qZA()),2&t&&(r.xp6(1),r.Q6J("disabled",!0),r.xp6(7),r.Oqu(e.appManager.title),r.xp6(4),r.Q6J("routerDirection","root")("routerLink",r.DdM(16,wt)),r.xp6(3),r.hij(" ",r.lcZ(16,12,"ocm.search.sectionTitle")," "),r.xp6(2),r.Q6J("ngIf",e.enabledFeatures.includes("ROUTE_PLANNER")),r.xp6(1),r.Q6J("ngIf",e.enabledFeatures.includes("ADD_POI")),r.xp6(1),r.Q6J("ngIf",e.enabledFeatures.includes("FAVOURITES")),r.xp6(1),r.Q6J("ngIf",e.enabledFeatures.includes("LAYERS")),r.xp6(1),r.Q6J("ngIf",!e.isUserAuthenticated()),r.xp6(1),r.Q6J("ngIf",e.isUserAuthenticated()),r.xp6(4),r.hij(" ",r.lcZ(27,14,"ocm.general.about")," "))},directives:[U.dr,U.jI,U.z0,U.Gu,U.sr,U.Bs,U.wd,U.W2,U.q_,U.zc,U.Ie,U.YI,j.rH,U.gu,U.Q$,i.O5,U.jP],pipes:[Z.X$],encapsulation:2}),t})();const At=[{path:"",redirectTo:"search",pathMatch:"full"},{path:"search",loadChildren:()=>Promise.resolve().then(n.bind(n,3947)).then(t=>t.SearchPageModule)},{path:"journeys",loadChildren:()=>Promise.resolve().then(n.bind(n,5476)).then(t=>t.JourneysModule)},{path:"signin",loadChildren:()=>Promise.resolve().then(n.bind(n,6779)).then(t=>t.SignInModule)},{path:"poi-editor/:id",loadChildren:()=>Promise.resolve().then(n.bind(n,1948)).then(t=>t.PoiEditorPageModule)},{path:"about",loadChildren:()=>Promise.resolve().then(n.bind(n,323)).then(t=>t.AboutPageModule)},{path:"layer-editor",loadChildren:()=>Promise.resolve().then(n.bind(n,3102)).then(t=>t.LayerEditorPageModule)}];let St=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[[j.Bz.forRoot(At,{useHash:!0})],j.Bz]}),t})(),Ct=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[[i.ez,F.u5,U.Pc,Z.aw,z.e]]}),t})();var It=n(6779);let Et=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[[i.ez,F.u5,U.Pc,Z.aw,z.e,j.Bz.forChild([{path:"",component:nt}])]]}),t})();var Mt=n(4207);let kt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[[i.ez,F.u5,U.Pc,Z.aw,z.e,j.Bz.forChild([{path:"",component:Mt.N}])]]}),t})();var Pt=n(5476),Dt=n(1948),Lt=n(323),Ot=n(3102);function Rt(){return localStorage.getItem("access_token")}function zt(t){return new Y(t,"/assets/i18n/",".json")}let Zt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t,bootstrap:[Tt]}),t.\u0275inj=r.cJS({providers:[{provide:j.wN,useClass:U.r4}],imports:[[R,V.JF,Z.aw.forRoot({loader:{provide:Z.Zw,useFactory:zt,deps:[V.eN]}}),U.Pc.forRoot(),St,G.Ar.forRoot({config:{tokenGetter:Rt}}),$.SearchPageModule,Ct,Pt.JourneysModule,It.SignInModule,q,N,B,Dt.PoiEditorPageModule,Et,kt,Lt.AboutPageModule,Ot.LayerEditorPageModule]]}),t})();rt.N.production&&(0,r.G48)(),L().bootstrapModule(Zt).catch(t=>console.log(t))},863:function(t,e,n){var i={"./ion-action-sheet.entry.js":[7321,8592,7321],"./ion-alert.entry.js":[6108,8592,6108],"./ion-app_8.entry.js":[1489,8592,1489],"./ion-avatar_3.entry.js":[305,8592,305],"./ion-back-button.entry.js":[5830,8592,5830],"./ion-backdrop.entry.js":[7757,7757],"./ion-button_2.entry.js":[392,8592,392],"./ion-card_5.entry.js":[6911,8592,6911],"./ion-checkbox.entry.js":[937,8592,937],"./ion-chip.entry.js":[8695,8592,8695],"./ion-col_3.entry.js":[6034,6034],"./ion-datetime_3.entry.js":[8837,8592,8837],"./ion-fab_3.entry.js":[4195,8592,4195],"./ion-img.entry.js":[1709,1709],"./ion-infinite-scroll_2.entry.js":[5931,8592,3087],"./ion-input.entry.js":[4513,8592,4513],"./ion-item-option_3.entry.js":[8056,8592,8056],"./ion-item_8.entry.js":[862,8592,862],"./ion-loading.entry.js":[7509,8592,7509],"./ion-menu_3.entry.js":[6272,8592,6272],"./ion-modal.entry.js":[1855,8592,1855],"./ion-nav_2.entry.js":[8708,8592,8708],"./ion-popover.entry.js":[3527,8592,3527],"./ion-progress-bar.entry.js":[4694,8592,4694],"./ion-radio_2.entry.js":[9222,8592,9222],"./ion-range.entry.js":[5277,8592,5277],"./ion-refresher_2.entry.js":[9921,8592,9921],"./ion-reorder_2.entry.js":[3122,8592,3122],"./ion-ripple-effect.entry.js":[1602,1602],"./ion-route_4.entry.js":[1202,8592,5174],"./ion-searchbar.entry.js":[7895,8592,7895],"./ion-segment_2.entry.js":[6164,8592,6164],"./ion-select_3.entry.js":[592,8592,592],"./ion-slide_2.entry.js":[7162,7162],"./ion-spinner.entry.js":[1374,8592,1374],"./ion-split-pane.entry.js":[7896,7896],"./ion-tab-bar_2.entry.js":[5043,8592,5043],"./ion-tab_2.entry.js":[7802,8592,7802],"./ion-text.entry.js":[9072,8592,9072],"./ion-textarea.entry.js":[2191,8592,2191],"./ion-toast.entry.js":[801,8592,801],"./ion-toggle.entry.js":[7110,8592,7110],"./ion-virtual-scroll.entry.js":[431,431]};function r(t){if(!n.o(i,t))return Promise.resolve().then(function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e});var e=i[t],r=e[0];return Promise.all(e.slice(1).map(n.e)).then(function(){return n(r)})}r.keys=function(){return Object.keys(i)},r.id=863,t.exports=r},8239:function(t,e,n){"use strict";function i(t,e,n,i,r,o,s){try{var a=t[o](s),l=a.value}catch(c){return void n(c)}a.done?e(l):Promise.resolve(l).then(i,r)}function r(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var s=t.apply(e,n);function a(t){i(s,r,o,a,l,"next",t)}function l(t){i(s,r,o,a,l,"throw",t)}a(void 0)})}}n.d(e,{Z:function(){return r}})}},function(t){t(t.s=1970)}]);